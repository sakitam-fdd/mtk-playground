import{d as t}from"./common-DJbht5QT.js";var e={exports:{}};!function(e){var n="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"];function i(){return"undefined"!=typeof globalThis?globalThis:t||self}var r={isTest:!1,idleLog:!1,idleForceTimeThreshold:48,workerCount:i().MAPTALKS_WORKER_COUNT||0,messagePostRatioPerWorker:.3,maxFPS:0};function o(){return Date.now()}function s(t,...e){for(var n=0;n<e.length;n++){var i=e[n];for(var r in i)t[r]=i[r]}return t}function a(t){return null==t}function h(t){return"number"==typeof t&&!isNaN(t)}function l(t){return(0|t)===t}function u(t){return"object"==typeof t&&!!t}function c(t){return!a(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function A(t){return!a(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}var f=Object.prototype.hasOwnProperty;function d(t,e){return f.call(t,e)}var p=Math.PI/180;function g(t){return t*p}function m(t){return t/p}var y={};function v(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!n){var _=navigator.userAgent.toLowerCase(),x=document.documentElement||{style:{}},b="ActiveXObject"in window,w=-1!==_.indexOf("webkit"),C=-1!==_.indexOf("phantom"),P=-1!==_.search("android [23]"),M=-1!==_.indexOf("chrome"),T=-1!==_.indexOf("gecko")&&!w&&!window.opera&&!b,S=/iphone/i.test(_)&&/micromessenger/i.test(_),I="undefined"!=typeof orientation||-1!==_.indexOf("mobile"),E=!window.PointerEvent&&window.MSPointerEvent,O=window.PointerEvent&&navigator.pointerEnabled||E,R=b&&"transition"in x.style,D="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!P,k="MozPerspective"in x.style,L="OTransition"in x.style,F=(R||D||k)&&!L&&!C,N="undefined"!=typeof window&&A(window.createImageBitmap),z="undefined"!=typeof window&&A(window.ResizeObserver),B="undefined"!=typeof window&&A(window.btoa),H="undefined"!=typeof window&&A(window.Proxy),j="undefined"!=typeof window&&A(window.requestIdleCallback),U=0;M&&(U=_.match(/chrome\/([\d.]+)/)[1]);var G=!C&&(O||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),V="undefined"!=typeof window&&"WebGLRenderingContext"in window,W=v(),q=!1;try{new OffscreenCanvas(2,2).getContext("2d"),q=!0}catch(uft){q=!1}var Z=!1;try{window.addEventListener("testPassive",(function(){}),{get passive(){return Z=!0,!0}})}catch(cft){}y={IS_NODE:n,isTest:!1,ie:b,ielt9:b&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:w,gecko:T,android:-1!==_.indexOf("android"),android23:P,chrome:M,chromeVersion:U,safari:!M&&-1!==_.indexOf("safari"),phantomjs:C,ie3d:R,webkit3d:D,gecko3d:k,opera12:L,any3d:F,iosWeixin:S,mobile:I,mobileWebkit:I&&w,mobileWebkit3d:I&&D,mobileOpera:I&&window.opera,mobileGecko:I&&T,touch:!!G,msPointer:!!E,pointer:!!O,retina:W>1,devicePixelRatio:W,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:b&&9===document.documentMode,ie10:b&&10===document.documentMode,webgl:V,imageBitMap:N,resizeObserver:z,btoa:B,decodeImageInWorker:q,monitorDPRChange:!0,supportsPassive:Z,proxy:H,requestIdleCallback:j,checkDevicePixelRatio:function(){if("undefined"!=typeof window&&y.monitorDPRChange){var t=v(),e=t!==y.devicePixelRatio;return e&&(y.devicePixelRatio=t),e}return!1}}}var Q=y;function X(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(X=function(){return!!t})()}function Y(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e);if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function J(t,e,n){return e&&function(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,Y(i.key),i)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function K(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,tt(t,e)}function $(t){return($=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function tt(t,e){return(tt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function et(t){var e="function"==typeof Map?new Map:void 0;return et=function(t){if(null===t||!function(t){try{return-1!==Function.toString.call(t).indexOf("[native code]")}catch(e){return"function"==typeof t}}(t))return t;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return function(t,e,n){if(X())return Reflect.construct.apply(null,arguments);var i=[null];i.push.apply(i,e);var r=new(t.bind.apply(t,i));return n&&tt(r,n.prototype),r}(t,arguments,$(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),tt(n,t)},et(t)}function nt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function it(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function rt(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return it(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?it(t,e):void 0}}(t))||e){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var ot,st,at=function(){function t(t,e,n){if(a(t)||a(e)?a(t.x)||a(t.y)?Array.isArray(t)&&(this.x=+t[0],this.y=+t[1],this.z=t[2]):(this.x=+t.x,this.y=+t.y,this.z=t.z):(this.x=+t,this.y=+e,this.z=n),this._isNaN())throw new Error("Position is NaN")}var e=t.prototype;return e.set=function(t,e,n){return this.x=t,this.y=e,this.z=n||0,this},e._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},e._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},e._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},e.distanceTo=function(t){var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},e.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},e._add=function(t,e){return a(t.x)?a(t[0])?(this.x+=t,this.y+=e):(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},e._sub=function(t,e){return a(t.x)?a(t[0])?(this.x-=t,this.y-=e):(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},e._substract=function(t,e){return h(e)?this._sub(t,e):this._sub(t)},e.substract=function(t,e){return this.sub(t,e)},e._multi=function(t){return this.x*=t,this.y*=t,this},e.div=function(t){return this.multi(1/t)},e._div=function(t){return this._multi(1/t)},e._isNaN=function(){return isNaN(this.x)||isNaN(this.y)||h(this.z)&&isNaN(this.z)},e.isZero=function(){return 0===this.x&&0===this.y},e.toArray=function(){return h(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},e.toJSON=function(){var t={x:this.x,y:this.y};return h(this.z)&&(t.z=this.z),t},t}(),ht=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},n.unit=function(){return this.copy()._unit()},n._unit=function(){return this._div(this.mag()),this},n.perp=function(){return this.copy()._perp()},n._perp=function(){return[this.x,this.y]=[-this.y,this.x],this},n.angleWith=function(t){return this.angleWithSep(t.x,t.y)},n.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},n._rotate=function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},n.rotate=function(t){return this.copy()._rotate(t)},n.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},n.round=function(){return new e(Math.round(this.x),Math.round(this.y))},n.ceil=function(){return new e(Math.ceil(this.x),Math.ceil(this.y))},n.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},n.copy=function(){return new e(this.x,this.y,this.z)},n.toFixed=function(t){return new e(this.x.toFixed(t),this.y.toFixed(t),h(this.z)?this.z.toFixed(t):void 0)},n.add=function(t,n){var i,r;return a(t.x)?a(t[0])?(i=this.x+t,r=this.y+n):(i=this.x+t[0],r=this.y+t[1]):(i=this.x+t.x,r=this.y+t.y),new e(i,r)},n.sub=function(t,n){var i,r;return a(t.x)?a(t[0])?(i=this.x-t,r=this.y-n):(i=this.x-t[0],r=this.y-t[1]):(i=this.x-t.x,r=this.y-t.y),new e(i,r)},n.multi=function(t){return new e(this.x*t,this.y*t)},n.equals=function(t){return t instanceof this.constructor&&this.x===t.x&&this.y===t.y&&this.z===t.z},e}(at);function lt(t){var e="data:image/svg+xml";return t.length>4&&".svg"===t.slice(-4)?1:t.slice(0,18)===e?2:0}function ut(t,e){n&&ut.node?ut.node(t,e):t.src=e[0]}!function(){if(n)return ot=function(t){return setTimeout(t,16)},void(st=clearTimeout);var t,e,i=1e3/30;function r(t){return setTimeout(t,i)}function o(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}"undefined"!=typeof window?(t=window.requestAnimationFrame||o("RequestAnimationFrame")||r,e=window.cancelAnimationFrame||o("CancelAnimationFrame")||o("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(t=r,e=clearTimeout),ot=function(e){return t(e)},st=function(t){t&&e(t)}}();var ct=0;function At(){return ct++}var ft=At;function dt(t){return t&&c(t)?JSON.parse(t):t}function pt(...t){for(var e=t[0],n=1;n<t.length;n++){var i=t[n];if(i&&i.length)for(var r=0,o=i.length;r<o;r++)e.push(i[r])}return e.length}function gt(t,e){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function mt(t,e,n){if(!Array.isArray(t))return n?e.call(n,t):e(t);for(var i,r,o=[],s=0,h=t.length;s<h;s++)a(i=t[s])?o.push(null):Array.isArray(i)?o.push(mt(i,e,n)):(r=n?e.call(n,i):e(i),o.push(r));return o}function yt(t,e){return void 0===t?e:t}function vt(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}function _t(t,e,n){return t*(1-n)+e*n}function xt(t,e,n){if(t===n||t===e)return t;var i=n-e;return((t-e)%i+i)%i+e}function bt(t,e,n){return Math.min(n,Math.max(e,t))}function wt(t){return Array.isArray(t)&&t.length>0}var Ct=/^([a-z][a-z\d+\-.]*:)?\/\//i;function Pt(t){return Ct.test(t)}var Mt=/^url\((['"])(.+)\1\)$/i,Tt=/^url\(([^'"].*[^'"])\)$/i;function St(t){return c(t)?Tt.test(t)?1:Mt.test(t)?2:3:0}function It(t){var e=St(t);return 3===e?t:1===e?Tt.exec(t)[1]:2===e?Mt.exec(t)[2]:t}var Et="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function Ot(t){if(Q.btoa)return window.btoa(t);for(var e,n,i=String(t),r="",o=0,s=Et;i.charAt(0|o)||(s="=",o%1);r+=s.charAt(63&e>>8-o%1*8)){if((n=i.charCodeAt(o+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");e=e<<8|n}return r}function Rt(t,e){for(var n=atob(t),i=new ArrayBuffer(n.length),r=new Uint8Array(i),o=0;o<n.length;o++)r[o]=255&n.charCodeAt(o);return new Blob([i],{type:e})}function Dt(t,e,n,i){return Math.atan2(i-e,n-t)}var kt="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function Lt(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;for(var n in t)if("center"===n){if(!e[n]||!Ft(t[n][0],e[n][0])||!Ft(t[n][1],e[n][1]))return!1}else if(t[n]!==e[n])return!1;return!0}function Ft(t,e,n){return null==n&&(n=1e-6),t>=e-n&&t<=e+n}function Nt(t=100,e=4,n=null,i=null){t||(t=100),e||(e=4);var r=this,o=this.isVisible();return e*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout((function s(){if(0===e)return o?r.show():r.hide(),void(n&&(i?n.call(i):n()));e%2==0?r.hide():r.show(),e--,r._flashTimeout=setTimeout(s,t)}),t),this}function zt(t=[],e="_pt"){for(var n=[],i=0,r=t.length;i<r;i++){var o=t[i];if(o){o[e]||(o[e]=new ht(0,0));var s=o[e];s.x=0,s.y=0,n.push(s)}else n.push(null)}return n}function Bt(t,e){e(t.data)}function Ht(t){if(t&&0===t.indexOf("http://")||0===t.indexOf("https://"))return t;var e=document.createElement("a");return e.href=t,t=e.href,e=null,t}var jt={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function Ut(t,e=1){var{width:n,height:i}=t;return jt.cssWidth=n+"px",jt.cssHeight=i+"px",jt.width=Math.round(n*e),jt.height=Math.round(i*e),jt}var Gt="_maptalks__internal_layer_",Vt=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],Wt=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(Vt),qt=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],Zt=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],Qt={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},Xt=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],Yt=14,Jt=function(){function t(t,e){h(t)&&h(e)?(this.width=t,this.height=e):h(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}var e=t.prototype;return e.copy=function(){return new t(this.width,this.height)},e.add=function(e,n){var i,r;return e instanceof t?(i=this.width+e.width,r=this.height+e.height):(i=this.width+e,r=this.height+n),new t(i,r)},e.equals=function(t){return this.width===t.width&&this.height===t.height},e.multi=function(e){return new t(this.width*e,this.height*e)},e._multi=function(t){return this.width*=t,this.height*=t,this},e._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},e.toPoint=function(){return new ht(this.width,this.height)},e.toArray=function(){return[this.width,this.height]},e.toJSON=function(){return{width:this.width,height:this.height}},t}(),Kt="";function $t(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function te(t,e,n){if(!t)return t;for(;t.indexOf(e)>-1;)t=t.replace(e,n);return t}var ee=/[\b\t\r\v\f]/gim;function ne(t){return c(t)?t.replace(ee,Kt):t}function ie(t){return $t(t).split(/\s+/)}var re="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function oe(t,e){return oe.node?oe.node(t,e):(re.font=e,re.measureText(t).width)}function se(t,e,n){var i=oe(t,e);return new Jt(i,n||Yt)}function ae(t,e,n,i){if(!t||0===t.length)return[{text:"",width:0}];var r=a(i)?oe(t,e):i,o=r/t.length,s=Math.floor(n/o/2);if(o>=n||s<=0)return[{text:"",width:n}];if(r<=n)return[{text:t,width:r}];for(var h=[],l=t.substring(0,s),u=o*s,c=s,A=t.length;c<A;c++){var f=t[c],d=oe(l+f);d>=n?(h.push({text:l,width:u}),l=t.substring(c,s+c),c+=s-1,u=o*s):(l+=f,u=d),c>=A-1&&(u=oe(l),h.push({text:l,width:u}))}return h}var he=["{","}"];function le(t,e){if(!c(t))return t;function n(t){if(!e)return Kt;var n=e[t];return a(n)?Kt:Array.isArray(n)?n.join():n}for(var[i,r]=he,o=function(t){t+=Kt;for(var[e,n]=he,i=[],r=!1,o=Kt,s=0,a=t.length;s<a;s++){var h=t[s];r||h!==e||(r=!0),h===e&&r&&(o=Kt),r&&h!==e&&h!==n&&(o+=h),h===n&&o&&(r=!1,i.push(o),o=Kt)}return i}(t),s=0,h=o.length;s<h;s++){var l=o[s];t=te(t,""+i+l+r,n(l))}return t}function ue(t,e){h(t)&&(t+="");var n=e.textMaxHeight||0,i=pe(t=t||"",e);return n&&n<i.size.height&&(i.size.height=n),i}function ce(t,e,n){var i=t.width,r=t.height;return new ht("left"===e?-i:"right"===e?0:-i/2,"top"===n?-r:"bottom"===n?0:-r/2)}var Ae="sans-serif",fe=14;function de(t){if(t.textFont)return t.textFont;var e=t.textSize;return a(e)&&(e=fe),(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+e+"px "+(t.textFaceName&&function(t){for(var e=t.split(","),n=0;n<e.length;n++)e[n].trim&&(e[n]=e[n].trim()),e[n].indexOf(" ")>0&&'"'!==e[n][0]&&"'"!==e[n][0]&&(e[n]='"'+e[n]+'"');return e.join(",")}(t.textFaceName)||Ae)}function pe(t,e){var n=de(e),i=e.textLineSpacing||0,r=se(t,n,e.textSize),o=r.width,s=r.height,a=e.textWrapCharacter||"\n",h=[],l=e.textWrapWidth;(!l||l>o)&&(l=o),c(t)||(t+="");var u=0;if(a&&t.indexOf(a)>=0)for(var A=t.split(a),f=0,d=A.length;f<d;f++){var p=A[f],g=oe(p,n);if(g>l)for(var m=ae(p,n,l,g),y=0,v=m.length;y<v;y++){var _=m[y].width;_>u&&(u=_),h.push({text:m[y].text,size:new Jt(_,s)})}else g>u&&(u=g),h.push({text:p,size:new Jt(g,s)})}else if(o>l)for(var x=ae(t,n,l,o),b=0;b<x.length;b++){var w=x[b].width;w>u&&(u=w),h.push({text:x[b].text,size:new Jt(w,s)})}else o>u&&(u=o),h.push({text:t,size:r});var C=h.length;return{total:C,size:new Jt(u,s*C+i*(C-1)),rows:h,rawSize:r}}function ge(t){var e=0,n=t&&t.length||0;if(!n)return e;for(var i=0;i<n;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}var me=Object.freeze({__proto__:null,DEFAULT_FONT:Ae,DEFAULT_TEXTSIZE:fe,EMPTY_STRING:Kt,describeText:ue,escapeSpecialChars:ne,getAlignPoint:ce,getFont:de,hashCode:ge,replaceAll:te,replaceVariable:le,splitContent:ae,splitTextToRow:pe,splitWords:ie,stringLength:se,stringWidth:oe,trim:$t}),ye=n?function(t){return t[0]}:function(t){for(var e=document.documentElement&&document.documentElement.style||{},n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1},ve=ye(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),_e=ye(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),xe=ye(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]),be=ye(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);function we(t,e){var n=document.createElement(t);return e&&ze(n,e),n}function Ce(t,e,n){var i=we(t);return e&&Le(i,e),n&&n.appendChild(i),i}function Pe(t){if(!t)return this;if(Q.ielt9||Q.ie9){var e=we("div");e.appendChild(t),e.innerHTML="",e=null}else t.parentNode&&t.parentNode.removeChild(t);return this}function Me(t,e,n,i){if(!(t&&t.addEventListener&&e&&n))return this;for(var r=function(e){e||(e=window.event),n.call(i||t,e)},o=e.split(" "),s=o.length-1;s>=0;s--){var a=o[s];a&&(t["Z__"+a]||(t["Z__"+a]=[]),Se(t,a,n)>=0&&(console.warn(t,"find '"+a+"' handler:",n," The old listener function will be removed"),Te(t,a,n)),t["Z__"+a].push({callback:r,src:n}),t.addEventListener(a,r,!!Q.supportsPassive&&{capture:!1,passive:!1}))}return this}function Te(t,e,n){function i(e,n){"mousewheel"===e&&Q.gecko&&(e="DOMMouseScroll"),t.removeEventListener(e,n,!1)}if(!t||!t.removeEventListener||!e)return this;for(var r=e.split(" "),o=r.length-1;o>=0;o--){var s=r[o];if(s){if(!n&&t["Z__"+s]){for(var a=t["Z__"+s],h=0,l=a.length;h<l;h++)i(a[h].callback);return delete t["Z__"+s],this}var u=Se(t,s,n);if(u<0)return this;i(s,t["Z__"+s][u].callback),t["Z__"+s].splice(u,1)}}return this}function Se(t,e,n){if(!t||!t["Z__"+e]||!n)return-1;for(var i=t["Z__"+e],r=0,o=i.length;r<o;r++)if(i[r].src===n)return r;return-1}function Ie(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Ee(t){return t._cancelBubble=!0,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function Oe(t){return t.onselectstart=function(){return!1},t.ondragstart=function(){return!1},t.setAttribute("unselectable","on"),this}function Re(t,e){return t?(Q.any3d?He(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null}function De(t){var e=window.getComputedStyle(t),n=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],i=t.getBoundingClientRect(),r=t.offsetWidth,o=t.offsetHeight;return t.__position=[i.left+n[0],i.top+n[1],r?i.width/r:1,o?i.height/o:1],t.__position}function ke(t,e){t||(t=window.event);var n=e.__position;n||(n=De(e));var i=t;return i.touches&&i.touches.length&&(t=i.touches[0]),i.changedTouches&&i.changedTouches.length&&(t=i.changedTouches[0]),new ht((t.clientX-n[0]-e.clientLeft)/n[2],(t.clientY-n[1]-e.clientTop)/n[3])}function Le(t,e){var n,i,r,o=t.style.cssText;return i=";",(r=(n=o).length-i.length)>=0&&n.indexOf(i,r)===r||(o+=";"),t.style.cssText=o+e,this}function Fe(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=Be(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function Ne(t,e){if(void 0===t.classList||Fe(t,e)){var n=Be(t);ze(t,(n?n+" ":"")+e)}else for(var i=ie(e),r=0,o=i.length;r<o;r++)t.classList.add(i[r]);return this}function ze(t,e){return a(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function Be(t){return a(t.className.baseVal)?t.className:t.className.baseVal}function He(t,e){var n=e||new ht(0,0);return t.style[ve]=Q.any3d?"translate3d("+n.x+"px,"+n.y+"px,0px)":"translate("+n.x+"px,"+n.y+"px)",this}function je(t){return/<[a-z\][\s\S]*>/i.test(t)}function Ue(t,e){var n=Ge(t);c(e)?n.innerHTML=e:n.appendChild(e);var i=new Jt(n.clientWidth,n.clientHeight);return Pe(n),i}function Ge(t){var e=document.createElement(t);return e.style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(e),e}var Ve=Me,We=Te;function qe(t){return t&&("mousemove"===t||"touchmove"===t)}function Ze(t,e){var n=o();return!!(t._mousemoveTime&&n-t._mousemoveTime<(e||48))||(t._mousemoveTime=n,!1)}var Qe=Object.freeze({__proto__:null,CSSFILTER:be,MOUSEMOVE_THROTTLE_TIME:48,TRANSFORM:ve,TRANSFORMORIGIN:_e,TRANSITION:xe,addClass:Ne,addDomEvent:Me,computeDomPosition:De,createEl:we,createElOn:Ce,getClass:Be,getDomRuler:Ge,getEventContainerPoint:ke,hasClass:Fe,isHTML:je,isMousemoveEventBlocked:Ze,isMoveEvent:qe,listensDomEvent:Se,measureDom:Ue,off:We,offsetDom:Re,on:Ve,preventDefault:Ie,preventSelection:Oe,removeDomEvent:Te,removeDomNode:Pe,removeTransform:function(t){return t.style[ve]&&(t.style[ve]=""),this},setClass:ze,setOpacity:function(t,e){return t.style.opacity=e,this},setStyle:Le,setTransform:He,setTransformMatrix:function(t,e){var n="matrix("+(c(e)?e:e.join())+")";return t.style[ve]!==n&&(t.style[ve]=n),this},stopPropagation:Ee}),Xe={jsonp:function(t,e){var n="_maptalks_jsonp_"+At();t.match(/\?/)?t+="&callback="+n:t+="?callback="+n;var i=document.createElement("script");return i.type="text/javascript",i.src=t,window[n]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(t,e,i){if(A(e)){var r=i;i=e,e=r}if(n&&Xe.get.node)return Xe.get.node(t,i,e);var o=Xe._getClient(i);if(o.open("GET",t,!0),e){for(var s in e.headers)o.setRequestHeader(s,e.headers[s]);o.withCredentials="include"===e.credentials,e.responseType&&(o.responseType=e.responseType)}return o.send(null),o},post:function(t,e,i){var r;if(c(t)){if(A(e)){var o=i;i=e,e=o}r=(e=e||{}).postData}else r=e,t=(e=t).url;if(n&&Xe.post.node)return e.url=t,Xe.post.node(e,r,i);var s=Xe._getClient(i);if(s.open("POST",e.url,!0),e.headers||(e.headers={}),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in s)for(var a in e.headers)e.headers.hasOwnProperty(a)&&s.setRequestHeader(a,e.headers[a]);return c(r)||(r=JSON.stringify(r)),s.send(r),s},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){var e;try{e=new XMLHttpRequest}catch(n){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}}}return e.onreadystatechange=Xe._wrapCallback(e,t),e},getArrayBuffer:function(t,e,n){if(A(e)){var i=n;n=e,e=i}return e||(e={}),e.responseType="arraybuffer",Xe.get(t,e,n)},getImage:function(t,e,n){return Xe.getArrayBuffer(e,n,(function(e,n){if(e)t.onerror&&t.onerror(e);else if(n){var i=window.URL||window.webkitURL,r=t.onload;t.onload=function(){r&&r(),i.revokeObjectURL(t.src)};var o=new Blob([new Uint8Array(n.data)],{type:n.contentType});t.cacheControl=n.cacheControl,t.expires=n.expires,t.src=n.data.byteLength?i.createObjectURL(o):kt}}))},getJSON:function(t,e,n){}};Xe.getJSON=function(t,e,n){if(A(e)){var i=n;n=e,e=i}var r=function(t,e){var i=e?dt(e):null;n(t,i)};return e&&e.jsonp?Xe.jsonp(t,r):Xe.get(t,e,r)};var Ye="",Je=/data:image\/.*;base64,/;function Ke(t,e={}){for(var n in e){var i=e[n];if(i&&i.target&&(s=n,h(o=t)&&(o+=Ye),h(s)&&(s+=Ye),o&&s&&(o.includes?o.includes(s):o.indexOf(s)>-1))){var{target:r}=i;return t.replace(n,r)}}var o,s;return Ye}var $e={host:Ye,resources:{},proxy:{},origin:{},fromJSON:function(t){try{c(t)&&(t=JSON.parse(t)),u(t)&&s($e,t)}catch(e){console.error(e)}},toJSON:function(){return{host:$e.host,proxy:s({},$e.proxy||{}),origin:s({},$e.origin||{})}},getResource:function(t){return $e.resources[t]},removeResource:function(t){delete $e.resources[t]},addResource:function(t,e){$e.resources[t]?console.warn(t+" resource Already exists,the "+t+" Cannot be added,the resource name Cannot repeat "):$e.resources[t]=e},updateResource:function(t,e){$e.resources[t]=e},allResource:function(){return $e.resources},loadSprite:function(t={imgUrl:"",jsonUrl:""}){return new Promise((function(e,n){var{imgUrl:i,jsonUrl:r}=t;if(!i||!r)return n(new Error("not find imgUrl/jsonUrl from options")),void console.error(t);function o(t,e,n){t.width=e,t.height=n;var i=t.getContext("2d");return i.clearRect(0,0,e,n),i}function s(i={},r){var s,a=(Q.IS_NODE?console.error("Current environment does not support canvas dom"):s=we("canvas"),s);if(a){var h=[];for(var l in i)h.push({name:l,spriteItem:i[l]});var u=function(){var t;return Q.decodeImageInWorker&&(t=new OffscreenCanvas(2,2)),t}(),c=t.sourceName||"";h.forEach((function(t){var e,{name:n,spriteItem:i}=t,{x:s,y:h,width:l,height:A}=i;u?(o(u,l,A).drawImage(r,s,h,l,A,0,0,l,A),e=u.transferToImageBitmap()):(o(a,l,A).drawImage(r,s,h,l,A,0,0,l,A),e=a.toDataURL()),t.resource=e,$e.addResource(c+n,e)})),e(h)}else n(new Error("can not create canvas"))}Xe.getJSON(r,{},(function(t,e){if(t)n(t);else{var r=new Image;r.onload=function(){s(e,r)},r.onerror=function(t){n(t)},Xe.getImage(r,i,{})}}))}))},loadSvgs:function(t){return new Promise((function(e,n){var i="",r=[],o="",s="",a="";if(Array.isArray(t)||t instanceof NodeList?r=t:u(t)?(i=t.url,r=t.symbols,o=t.fill,s=t.stroke,a=t.sourceName||""):c(t)&&(i=t),i||!r||0!==r.length){var h=[],l=function(t,e){var n=rn(e);n&&(n.forEach((function(t){o&&(t.fill=o),s&&(t.stroke=s)})),$e.addResource(a+t,n)),h.push({name:t,paths:n,body:e})};if(i&&c(i))fetch(i).then((function(t){return t.json()})).then((function(t){t.forEach((function(t){var{name:e,body:n}=t;l(e,n)})),e(h)})).catch((function(t){n(t)}));else if(r){for(var A=0,f=r.length;A<f;A++){var d=r[A],p=d.id;p&&l(p,"<xml><svg>"+d.innerHTML+"</svg></xml>")}e(h)}else n(new Error("not support svgs params type"))}else n(new Error("not find svgs data"))}))}};function tn(t){if(h(t)&&(t+=Ye),!t)return console.error("resouce path is null,path:",t),t;if(!c(t))return t;if(e=t,Je.test(e)||function(t){return 0===t.indexOf("blob:")}(t))return t;var e;if("$"===t[0])return $e.getResource(t.substring(1,1/0))||"";var n=$e.origin||{},i=Pt(t);if(i&&u(n))return Ke(t,n)||t;var r=$e.proxy||{};if(u(r)){var o=Ke(t,r);if(o)return o}var{host:s}=$e;return!i&&s&&c(s)?""+s+t:Ht(t)}var en=new DOMParser;function nn(t,e){return t?t[e]&&t[e].value:null}function rn(t){var e=en.parseFromString(t,"text/xml").querySelector("svg");if(!e)return null;for(var n=e.childNodes,i=[],r=e.attributes,o=nn(r,"fill"),s=nn(r,"fill-opacity"),a=nn(r,"stroke"),h=nn(r,"stroke-opacity"),l=nn(r,"stroke-width"),u=0,c=n.length;u<c;u++){var A=n[u],f=A.attributes;if(f){var d=void 0,p="path"===(A.tagName||"").toLowerCase();if(d=p?nn(f,"d"):A){var g=nn(f,"fill")||o,m=nn(f,"stroke")||a,y={path:d};if(g&&(y.fill=g,y["fill-opacity"]=nn(f,"fill-opacity")||s||1),m&&(y.stroke=m,y["stroke-opacity"]=nn(f,"stroke-opacity")||h||1,y["stroke-width"]=nn(f,"stroke-width")||l||1),i.push(y),!p)for(var v in y)"path"!==v&&y.hasOwnProperty(v)&&A.setAttribute(v,y[v])}}}return i}let on;const sn={width:100,height:10};let an=!1;try{new OffscreenCanvas(1,1).getContext("2d").fillText("hello",0,0),an=!0}catch(uft){an=!1}let hn=class{constructor(t,e={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let n=1/0,i=-1/0;for(let r=0,o=t.length;r<o;r++){const e=t[r][0];n=Math.min(e,n),i=Math.max(e,i)}this.min=n,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},sn,e),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const t=function(){if(!on){const{width:t,height:e}=sn;an?on=new OffscreenCanvas(t,e):(on=document.createElement("canvas"),on.width=t,on.height=e)}return on}(),{width:e,height:n}=this.options;t.width=e,t.height=n;const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);const r=i.createLinearGradient(0,0,t.width,0),{colors:o,valueOffset:s}=this;for(let a=0,h=o.length;a<h;a++){const[t,e]=o[a];r.addColorStop((t-this.min)/s,e)}i.fillStyle=r,i.fillRect(0,0,t.width,t.height),this.imgData=i.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t),t=Math.min(t,this.max);let e=Math.round((t-this.min)/this.valueOffset*this.imgData.width);e=Math.min(e,this.imgData.width-1);const n=4*e;return[this.imgData.data[n],this.imgData.data[n+1],this.imgData.data[n+2],this.imgData.data[n+3]]}};var ln;function un(t,e){var n,i,r;if(_n(t)){var o,s=t.stops&&"object"==typeof t.stops[0][0],a=s||!(s||void 0!==t.property),h=t.type||e||"exponential";if("exponential"===h)o=fn;else if("interval"===h)o=An;else if("categorical"===h)o=cn;else if("identity"===h)o=gn;else if("color-interpolate"===h)o=pn;else{if("calculate-expression"!==h)throw new Error('Unknown function type "'+h+'"');o=mn}if(s){var l={},u=[];for(let e=0;e<t.stops.length;e++){var c=t.stops[e];void 0===l[c[0].zoom]&&(l[c[0].zoom]={zoom:c[0].zoom,type:t.type,property:t.property,default:t.default,stops:[]}),l[c[0].zoom].stops.push([c[0].value,c[1]])}for(let t in l)u.push([l[t].zoom,un(l[t])]);n=function(e,n){const i=fn({stops:u,base:t.base},e)(e,n);return"function"==typeof i?i(e,n):i},i=!1,r=!1}else a?(n=function(e){const n=o(t,e);return"function"==typeof n?n(e):n},i=!0,r=!1):(n=function(e,n){const i=o(t,n?n[t.property]:null);return"function"==typeof i?i(e,n):i},i=!1,r=!0)}else n=function(){return t},i=!0,r=!0;return n.isZoomConstant=r,n.isFeatureConstant=i,n}function cn(t,e){for(let n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.default}function An(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function fn(t,e){for(var n=void 0!==t.base?t.base:1,i=0;!(i>=t.stops.length||e<=t.stops[i][0]);)i++;return 0===i?t.stops[i][1]:i===t.stops.length?t.stops[i-1][1]:yn(e,n,t.stops[i-1][0],t.stops[i][0],t.stops[i-1][1],t.stops[i][1])}"function"==typeof Map&&(ln=new Map);const dn={width:100,height:1};function pn(t,e){const n=t.stops;if(n&&n.length>1){let t;if(ln){const e=JSON.stringify(n);if(!ln.has(e)){const t=new hn(n,dn);ln.set(e,t)}t=ln.get(e)}else t=new hn(n,dn);const[i,r,o,s]=t.getColor(e);return[i/255,r/255,o/255,s/255]}return n&&1===n.length?n[0][1]:null}function gn(t,e){return function(t,e){return void 0!==t?t:void 0!==e?e:null}(e,t.default)}function mn(t,e){const n=String(t.property),i=t.expression,r=e;function o(e){return null==e||""===e||isNaN(e)?t.default:e}return null==e||""===e||isNaN(e)||e<0?o(t.default):o(function e(n){if(!Array.isArray(n)){if("number"==typeof n)return n;throw new Error("Invalid expression format")}{const i=n[0];if(!["+","-","*","/"].includes(i))throw new Error(`Unknown operator: ${i}`);const r=n.slice(1).map((t=>e(t)));switch(i){case"+":return r.reduce(((t,e)=>t+e),0);case"-":return r.reduce(((t,e)=>t-e));case"*":return r.reduce(((t,e)=>t*e),1);case"/":return r.some((t=>0===t))?t.default:r.reduce(((t,e)=>t/e));default:throw new Error(`Unsupported operator: ${i}`)}}}(function t(e,n,i){const r=Number(i),o=String(n);return Array.isArray(e)?e.map((e=>t(e,o,r))):e===o?r:e}(i,n,r)))}function yn(t,e,n,i,r,o){return"function"==typeof r?function(){var s=r.apply(void 0,arguments),a=o.apply(void 0,arguments);return yn(t,e,n,i,s,a)}:r.length?function(t,e,n,i,r,o){var s=[];for(let a=0;a<r.length;a++)s[a]=vn(t,e,n,i,r[a],o[a]);return s}(t,e,n,i,r,o):vn(t,e,n,i,r,o)}function vn(t,e,n,i,r,o){var s,a=i-n,h=t-n;return r*(1-(s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)))+o*s}function _n(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type||t.expression&&"calculate-expression"===t.type)}function xn(t){for(const e in t)if(_n(t[e]))return!0;return!1}function bn(t){return Pn(t,"exponential")}function wn(t,e){if(!t)return null;var n=!1;if(Array.isArray(t)){var i,r=[];for(let o=0;o<t.length;o++)(i=wn(t[o],e))?(r.push(i),n=!0):r.push(t[o]);return n?r:t}var o,s={__fn_types_loaded:!0},a=[];for(o in t)t.hasOwnProperty(o)&&a.push(o);const h=function(t){Object.defineProperty(s,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=bn(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})};for(let l=0,u=a.length;l<u;l++)_n(t[o=a[l]])?(n=!0,s["_"+o]=t[o],h(o)):s[o]=t[o];return n?s:t}function Cn(t){if(!t||!t.stops)return[];const e=[];for(let n=0,i=t.stops.length;n<i;n++)e.push(t.stops[n][1]);return e}function Pn(t,e){if(!_n(t))return function(){return t};let n=!0,i=!0;const r=(t=JSON.parse(JSON.stringify(t))).stops;if(r)for(let s=0;s<r.length;s++)if(_n(r[s][1])){const t=Pn(r[s][1],e);n=n&&t.isZoomConstant,i=i&&t.isFeatureConstant,r[s]=[r[s][0],t]}const o=un(t,e);return o.isZoomConstant=n&&o.isZoomConstant,o.isFeatureConstant=i&&o.isFeatureConstant,o}const Mn=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Tn(t){return new Function("f",`var p = (f && f.properties || {}); return ${Sn(t)}`)}function Sn(t){if(!t)return"true";const e=t[0];return t.length<=1?"any"===e?"false":"true":`(${"=="===e?En(t[1],t[2],"===",!1):"!="===e?En(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?En(t[1],t[2],e,!0):"any"===e?Rn(t.slice(1),"||"):"all"===e?Rn(t.slice(1),"&&"):"none"===e?Ln(Rn(t.slice(1),"||")):"in"===e?Dn(t[1],t.slice(2)):"!in"===e?Ln(Dn(t[1],t.slice(2))):"has"===e?kn(t[1]):"!has"===e?Ln(kn(t[1])):"contains"===e?function(t,e,n){const i=In(t);return void 0!==n?`(${i} + '').indexOf("${e}") === ${n}`:`(${i} + '').indexOf("${e}") >= 0`}(t[1],t[2],t[3]):"true"})`}function In(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function En(t,e,n,i){return"object"==typeof(r=t)&&r&&t.op?function(t,e,n,i){const r=t.property,o=t.op;let s=In(r);return"length"!==o?(console.error(`not support ${o} op`),"false"):(s=`((${s}+='').length)`,On(s,r,e,n,i))}(t,e,n,i):On(In(t),t,e,n,i);var r}function On(t,e,n,i,r){const o="$type"===e?Mn.indexOf(n):JSON.stringify(n);return(r?`typeof ${t}=== typeof ${o}&&`:"")+t+i+o}function Rn(t,e){return t.map(Sn).join(e)}function Dn(t,e){"$type"===t&&(e=e.map((t=>Mn.indexOf(t))));const n=JSON.stringify(e.sort(Fn)),i=In(t);return e.length<=200?`${n}.indexOf(${i}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${i}, ${n},0,${e.length-1})`}function kn(t){return"$id"===t?'"id" in f':`${JSON.stringify(t)} in p`}function Ln(t){return`!(${t})`}function Fn(t,e){return t<e?-1:t>e?1:0}function Nn(t){const e=t._toJSON(),n=e.feature;return n.type=Mn.indexOf(n.geometry.type),n.subType=e.subType,n}function zn(t){if(!Array.isArray(t))return zn([t]);const e=[];for(let n=0;n<t.length;n++){let i;i=!0===t[n].filter?function(){return!0}:Tn(t[n].filter),e.push(Bn({},t[n],{filter:i}))}return e}function Bn(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}var Hn=[],jn={};function Un(t,e){return wn(t,(function(){var t,n,i,r,o=e.getMap();return function(t,e,n){return t[0]=e,t[1]=n,t}(Hn,o?o.getZoom():12,s({},e.getProperties(),(t=jn,n=o&&o.getBearing()||0,i=o&&o.getPitch()||0,r=o?o.getZoom():10,t["{bearing}"]=n,t["{pitch}"]=i,t["{zoom}"]=r,t)))}))}var Gn=Object.freeze({__proto__:null,compileStyle:zn,createFilter:Tn,getFilterFeature:Nn,getFunctionTypeResources:Cn,hasFunctionDefinition:xn,interpolated:bn,isFeatureFilter:function t(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":case"!has":return 2===e.length&&("string"==typeof e[1]||e[1].property&&e[1].op);case"in":case"!in":return e.length>=2&&("string"==typeof e[1]||e[1].property&&e[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===e.length&&("string"==typeof e[1]||e[1].property&&e[1].op);case"none":case"any":case"all":for(const n of e.slice(1))if(!t(n)&&"boolean"!=typeof n)return!1;return!0;case"contains":return!0;default:return!1}},isFunctionDefinition:_n,loadFunctionTypes:wn,loadGeoSymbol:Un});function Vn(t){var e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}function Wn(t,e,n){if(!t.markerPath)return null;var i=1,r=Vn(t);h(t.markerOpacity)&&(i=t.markerOpacity),h(t.opacity)&&(i*=t.opacity);var o,l={};if(r){for(var u in r.stroke)r.stroke.hasOwnProperty(u)&&(a(r.stroke[u])||(l[u]=r.stroke[u]));for(var A in r.fill)r.fill.hasOwnProperty(A)&&(a(r.fill[A])||(l[A]=r.fill[A]))}var f,d=t.markerPath;o=c(d)&&"$"===d[0]?$e.getResource(d.substring(1,1/0))||[]:Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];for(var p=[],g=0;g<o.length;g++)(f=s({},f=c(o[g])?{path:o[g]}:o[g],l)).d=f.path,delete f.path,p.push(f);var m=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];i<1&&m.push('opacity="'+i+'"'),t.markerPathWidth&&t.markerPathHeight&&m.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),m.push('preserveAspectRatio="none"'),e&&m.push('width="'+e+'"'),n&&m.push('height="'+n+'"'),m.push("><defs></defs>");for(var y=0;y<p.length;y++)if(p[y].d instanceof Element)m.push(p[y].d.outerHTML);else{var v="<path ";for(var _ in p[y])p[y].hasOwnProperty(_)&&(v+=" "+_+'="'+p[y][_]+'"');m.push(v+="></path>")}return m.push("</svg>"),"data:image/svg+xml;base64,"+Ot(m.join(" "))}function qn(t,e){if(!t)return[];var n=t;Array.isArray(t)||(n=[t]);for(var i,r,o,s,a=[],h=qt,l=n.length-1;l>=0;l--)if(t=n[l]){e&&(t=Zn(t));for(var u=0;u<h.length;u++)if(_n(i=t[h[u]])&&(i=Cn(i)),i){Array.isArray(i)||(i=[i]);for(var c=0;c<i.length;c++)"url("===i[c].slice(0,4)&&(i[c]=It(i[c])),a.push([i[c],t[(r=Zt[u])[0]],t[r[1]]])}if("path"===t.markerType&&t.markerPath)if(o=_n(t.markerWidth)?200:t.markerWidth,s=_n(t.markerHeight)?200:t.markerHeight,_n(t.markerPath)){i=Cn(t.markerPath);for(var A=t.markerPath,f=0;f<i.length;f++)t.markerPath=i[f],a.push([Wn(t),o,s]);t.markerPath=A}else a.push([Wn(t),o,s])}return a}function Zn(t){if(!t)return null;var e=t;if(n)return e;for(var i,r=qt,o=0,s=r.length;o<s;o++)(i=e[r[o]])&&(e[r[o]]=Qn(i));return e}function Qn(t){if(_n(t)&&t.stops){for(var e=t.stops,n=0;n<e.length;n++)e[n][1]=Qn(e[n][1]);return t}return"url("===t.slice(0,4)&&(t=It(t)),t}function Xn(t){return t&&Q.decodeImageInWorker&&t instanceof ImageBitmap}function Yn(t){return t&&t.colorStops}function Jn(t){var e=[t.type];if(t.places&&e.push(t.places.join()),t.colorStops){for(var n=[],i=t.colorStops.length-1;i>=0;i--)n.push(t.colorStops[i].join());e.push(n.join(","))}return e.join("_")}function Kn(t,e){if(!t)return 1;var n=[];if(Array.isArray(t)){for(var i=0;i<t.length;i++)n.push(Kn(t[i],e));return n.sort().join(",")}var r=Object.keys(t).sort().reduce((function(n,i){return e&&0!==i.indexOf(e)||(n[i]=t[i]),n}),{});return ge(JSON.stringify(r))}function $n(t,e){function n(t,e){a(t.opacity)?t.opacity=e:t.opacity*=e}var i;if(Array.isArray(t)){i=[];for(var r=0;r<t.length;r++){var o=s({},t[r]);n(o,e),i.push(o)}}else n(i=s({},t),e);return i}function ti(...t){var e=t[0],n=Array.prototype.slice.call(t,1);if(n&&n.length||(n=[{}]),Array.isArray(e)){for(var i,r,o=[],h=0,l=e.length;h<l;h++){i=e[h],r={};for(var u=0,c=n.length;u<c;u++)Array.isArray(n[u])?a(n[u][h])?s(r,i||{}):s(r,i,n[u][h]):s(r,i,n[u]?n[u]:{});o.push(r)}return o}var A=[{},e];return A.push.apply(A,n),s.apply(this,A)}function ei(t){if(t.symbol&&(t=[t]),Array.isArray(t))return t;var e=t.$root,n=t.$iconset;return t=t.style,(e||n)&&(e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),n&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),ni(t,(function(t){return"{$root}"===t?e:"{$iconset}"===t?n:null}))),t}function ni(t,e){for(var n=0;n<t.length;n++){var{symbol:i}=t[n];i&&ri(i,e)}}var ii=/(\{\$root\}|\{\$iconset\})/g;function ri(t,e){for(var n in t)t.hasOwnProperty(n)&&"textName"!==n&&(c(t[n])&&t[n].length>2?t[n]=t[n].replace(ii,e):_n(t[n])?t[n]=oi(t[n],e):u(t[n])&&ri(t[n],e))}function oi(t,e){var n=t.default;c(n)&&(t.default=n.replace(ii,e));var i=t.stops;if(!i)return t;for(var r=0;r<i.length;r++)Array.isArray(i[r])&&(c(i[r][1])?i[r][1]=i[r][1].replace(ii,e):_n(i[r][1])&&(i[r][1]=oi(i[r][1],e)));return t}function si(t=[]){Array.isArray(t)||(t=[t]);for(var e=t.length,n=0;n<e;n++){var i=t[n];if(i.style){var{lineDasharray:r,lineWidth:o}=i.style;if(o&&h(o)&&o>0&&r&&Array.isArray(r)&&r.length)return!0}}return!1}function ai(t,e,n,i,r){var o=1/Math.tan(e/2),s=1/(i-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*s,t[15]=0,t}function hi(t,e,n){var i,r,o,s,a,h,l,u,c,A,f,d,p=n[0],g=n[1],m=n[2];return e===t?(t[12]=e[0]*p+e[4]*g+e[8]*m+e[12],t[13]=e[1]*p+e[5]*g+e[9]*m+e[13],t[14]=e[2]*p+e[6]*g+e[10]*m+e[14],t[15]=e[3]*p+e[7]*g+e[11]*m+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=e[9],f=e[10],d=e[11],t[0]=i=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=l,t[7]=u,t[8]=c,t[9]=A,t[10]=f,t[11]=d,t[12]=i*p+a*g+c*m+e[12],t[13]=r*p+h*g+A*m+e[13],t[14]=o*p+l*g+f*m+e[14],t[15]=s*p+u*g+d*m+e[15]),t}function li(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function ui(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],s=e[5],a=e[6],h=e[7],l=e[8],u=e[9],c=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+l*i,t[5]=s*r+u*i,t[6]=a*r+c*i,t[7]=h*r+A*i,t[8]=l*r-o*i,t[9]=u*r-s*i,t[10]=c*r-a*i,t[11]=A*r-h*i,t}function ci(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],s=e[1],a=e[2],h=e[3],l=e[4],u=e[5],c=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+l*i,t[1]=s*r+u*i,t[2]=a*r+c*i,t[3]=h*r+A*i,t[4]=l*r-o*i,t[5]=u*r-s*i,t[6]=c*r-a*i,t[7]=A*r-h*i,t}function Ai(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=e[9],f=e[10],d=e[11],p=e[12],g=e[13],m=e[14],y=e[15],v=n[0],_=n[1],x=n[2],b=n[3];return t[0]=v*i+_*a+x*c+b*p,t[1]=v*r+_*h+x*A+b*g,t[2]=v*o+_*l+x*f+b*m,t[3]=v*s+_*u+x*d+b*y,t[4]=(v=n[4])*i+(_=n[5])*a+(x=n[6])*c+(b=n[7])*p,t[5]=v*r+_*h+x*A+b*g,t[6]=v*o+_*l+x*f+b*m,t[7]=v*s+_*u+x*d+b*y,t[8]=(v=n[8])*i+(_=n[9])*a+(x=n[10])*c+(b=n[11])*p,t[9]=v*r+_*h+x*A+b*g,t[10]=v*o+_*l+x*f+b*m,t[11]=v*s+_*u+x*d+b*y,t[12]=(v=n[12])*i+(_=n[13])*a+(x=n[14])*c+(b=n[15])*p,t[13]=v*r+_*h+x*A+b*g,t[14]=v*o+_*l+x*f+b*m,t[15]=v*s+_*u+x*d+b*y,t}function fi(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],A=e[10],f=e[11],d=e[12],p=e[13],g=e[14],m=e[15],y=n*a-i*s,v=n*h-r*s,_=n*l-o*s,x=i*h-r*a,b=i*l-o*a,w=r*l-o*h,C=u*p-c*d,P=u*g-A*d,M=u*m-f*d,T=c*g-A*p,S=c*m-f*p,I=A*m-f*g,E=y*I-v*S+_*T+x*M-b*P+w*C;return E?(t[0]=(a*I-h*S+l*T)*(E=1/E),t[1]=(r*S-i*I-o*T)*E,t[2]=(p*w-g*b+m*x)*E,t[3]=(A*b-c*w-f*x)*E,t[4]=(h*M-s*I-l*P)*E,t[5]=(n*I-r*M+o*P)*E,t[6]=(g*_-d*w-m*v)*E,t[7]=(u*w-A*_+f*v)*E,t[8]=(s*S-a*M+l*C)*E,t[9]=(i*M-n*S-o*C)*E,t[10]=(d*b-p*_+m*y)*E,t[11]=(c*_-u*b-f*y)*E,t[12]=(a*P-s*T-h*C)*E,t[13]=(n*T-i*P+r*C)*E,t[14]=(p*v-d*x-g*y)*E,t[15]=(u*x-c*v+A*y)*E,t):null}function di(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function pi(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}var gi=Object.freeze({__proto__:null,DEFAULT_FONT:Ae,DEFAULT_TEXTSIZE:fe,EMPTY_STRING:Kt,GUID:ft,IS_NODE:n,UID:At,_defaults:function(t,e){for(var n=Object.getOwnPropertyNames(e),i=0;i<n.length;i++){var r=n[i],o=Object.getOwnPropertyDescriptor(e,r);o&&o.configurable&&void 0===t[r]&&Object.defineProperty(t,r,o)}return t},b64toBlob:Rt,btoa:Ot,calCanvasSize:Ut,get cancelAnimFrame(){return st},clamp:bt,computeDegree:Dt,convertResourceUrl:Zn,convertStylePath:ni,copy:pi,describeText:ue,emptyImageUrl:kt,equalMapView:Lt,escapeSpecialChars:ne,extend:s,extendSymbol:ti,extractCssUrl:It,flash:Nt,forEachCoord:mt,getAbsoluteURL:Ht,getAlignPoint:ce,getExternalResources:qn,getFont:de,getGlobalThis:i,getGradientStamp:Jn,getImageBitMap:Bt,getMarkerPathBase64:Wn,getPointsResultPts:zt,getSymbolHash:Kn,getSymbolStamp:function(t,e){return Kn(t,e)},getValueOrDefault:yt,hasOwn:d,hashCode:ge,identity:di,interpolate:_t,invert:fi,isArrayHasData:wt,isCssUrl:St,isDashLine:si,isEmpty:function(t){var e;for(e in t)return!1;return!e},isFunction:A,isGradient:Yn,isImageBitMap:Xn,isInteger:l,isNil:a,isNoContentHttpCode:function(t){return 204===t||t>=400&&t<500||501===t},isNumber:h,isObject:u,isSVG:lt,isString:c,isURL:Pt,join:function(t,e){return t.join?t.join(e||","):Array.prototype.join.call(t,e||",")},loadImage:ut,log2:function(t){if(Math.log2)return Math.log2(t);var e=Math.log(t)*Math.LOG2E,n=Math.round(e);return Math.abs(n-e)<1e-14?n:e},lowerSymbolOpacity:$n,multiply:Ai,now:o,parseJSON:dt,parseStyleRootPath:ei,parseSymbolPath:ri,perspective:ai,pushIn:pt,removeFromArray:gt,replaceAll:te,replaceVariable:le,get requestAnimFrame(){return ot},rotateX:ui,rotateZ:ci,scale:li,sign:vt,splitContent:ae,splitTextToRow:pe,splitWords:ie,stringLength:se,stringWidth:oe,toDegree:m,toRadian:g,translate:hi,translateToSVGStyles:Vn,trim:$t,wrap:xt});function mi(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var yi=vi;function vi(t,e,n){var i,r,o,s,a,h=t.length,l=xi(t[0],e),u=[];for(n||(n=[]),i=1;i<h;i++){for(r=t[i-1],s=a=xi(o=t[i],e);;){if(!(l|s)){u.push(r),s!==a?(u.push(o),i<h-1&&(n.push(u),u=[])):i===h-1&&u.push(o);break}if(l&s)break;l?l=xi(r=_i(r,o,l,e),e):s=xi(o=_i(r,o,s,e),e)}l=a}return u.length&&n.push(u),n}function _i(t,e,n,i){return 8&n?[t[0]+(e[0]-t[0])*(i[3]-t[1])/(e[1]-t[1]),i[3]]:4&n?[t[0]+(e[0]-t[0])*(i[1]-t[1])/(e[1]-t[1]),i[1]]:2&n?[i[2],t[1]+(e[1]-t[1])*(i[2]-t[0])/(e[0]-t[0])]:1&n?[i[0],t[1]+(e[1]-t[1])*(i[0]-t[0])/(e[0]-t[0])]:null}function xi(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}vi.polyline=vi,vi.polygon=function(t,e){var n,i,r,o,s,a,h;for(i=1;i<=8;i*=2){for(n=[],o=!(xi(r=t[t.length-1],e)&i),s=0;s<t.length;s++)(h=!(xi(a=t[s],e)&i))!==o&&n.push(_i(r,a,i,e)),h&&n.push(a),r=a,o=h;if(!(t=n).length)break}return n};var bi=mi(yi),wi=1/0,Ci=1/0,Pi=-1/0,Mi=-1/0;function Ti(){return[wi,Ci,Pi,Mi]}var Si=Ti();function Ii(t){t[0]=wi,t[1]=Ci,t[2]=Pi,t[3]=Mi}function Ei(t,e){if(t)if(Array.isArray(t[0]))for(var n=0,i=t.length;n<i;n++)Ei(t[n],e);else if(Array.isArray(t))for(var r=0,o=t.length;r<o;r++){var{x:s,y:a}=t[r];e[0]=Math.min(s,e[0]),e[1]=Math.min(a,e[1]),e[2]=Math.max(s,e[2]),e[3]=Math.max(a,e[3])}else{var{x:h,y:l}=t;e[0]=Math.min(h,e[0]),e[1]=Math.min(l,e[1]),e[2]=Math.max(h,e[2]),e[3]=Math.max(l,e[3])}}function Oi(t,e,n,i,r){(0===e||e)&&(Array.isArray(e)&&(n=e[1],i=e[2],r=e[3],e=e[0]),t[0]=Math.min(e,t[0]),t[1]=Math.min(n,t[1]),t[2]=Math.max(i,t[2]),t[3]=Math.max(r,t[3]))}function Ri(t){return t&&t[0]!==1/0&&void 0!==t[0]}function Di(t,e=0){t[0]-=e,t[1]-=e,t[2]+=e,t[3]+=e}function ki(t,e){return!(t[2]<e[0]||t[1]>e[3]||t[0]>e[2]||t[3]<e[1])}function Li(t,e){var[n,i,r,o]=t;return n>=e[0]&&r<=e[2]&&i>=e[1]&&o<=e[3]}function Fi(t,e){var n=e.bbox;if(!n)return console.error("maskGeoJSON bbox is null:",e),!1;if(ki(n,t)){var i=e.geometry;if(!i)return console.error("maskGeoJSON is error,not find geometry.",e),!1;var{coordinates:r}=i;"Polygon"===i.type&&(r=[r]);for(var o=0,s=r.length;o<s;o++){var a=bi.polygon(r[o][0],t);if(a.length>0){for(var h=1/0,l=-1/0,u=1/0,c=-1/0,A=0,f=a.length;A<f;A++){var[d,p]=a[A];h=Math.min(d,h),u=Math.min(p,u),l=Math.max(d,l),c=Math.max(p,c)}if(h!==l&&u!==c)return!0}}return!1}return!1}var Ni=Object.freeze({__proto__:null,BBOX_TEMP:Si,bboxInBBOX:Li,bboxInMask:Fi,bboxIntersect:ki,bufferBBOX:Di,getDefaultBBOX:Ti,pointsBBOX:Ei,resetBBOX:Ii,setBBOX:Oi,validateBBOX:Ri});function zi(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function Bi(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Hi(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ji(t,e,n){return Hi(t,e,n)}function Ui(t){var e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function Gi(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function Vi(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Wi(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function qi(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2];return t[0]=r*h-o*a,t[1]=o*s-i*h,t[2]=i*a-r*s,t}function Zi(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.hypot?Math.hypot(n,i,r):function(...t){for(var e=0,n=t.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)}(n,i,r)}function Qi(t,e){Gi(t,t),Gi(e,e);var n=Vi(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}var Xi,Yi=function(){function t(t,e){this.normal=t,this.constant=e}return t.prototype.distanceToPoint=function(t){return Vi(this.normal,t)+this.constant},t}(),Ji=[0,0,0],Ki=[0,0,0],$i=[0,0,0],tr=[0,0,0],er=[0,0,0],nr=new Yi([0,0,1],0),ir=function(){function t(t,e){this.setFromTo(t,e)}var e=t.prototype;return e.setFromTo=function(t,e){this.origin=t;var n=this.direction||[0,0,0];this.direction=Gi(n,ji(n,e,t))},e.distanceToPlane=function(t){var e=Vi(t.normal,this.direction);if(0===e)return 0===t.distanceToPoint(this.origin)?0:null;var n=-(Vi(this.origin,t.normal)+t.constant)/e;return n>=0?n:null},e.intersectGround=function(t){return this.intersectPlane(nr,t)},e.distanceToGround=function(){return this.distanceToPlane(nr)},e.intersectPlane=function(t,e){var n=this.distanceToPlane(t);return null===n?null:this.at(n,e)},e.intersectBox=function(t,e){var n,i,r,o,s,a,h=1/this.direction[0],l=1/this.direction[1],u=1/this.direction[2],c=this.origin;return h>=0?(n=(t[0][0]-c[0])*h,i=(t[1][0]-c[0])*h):(n=(t[1][0]-c[0])*h,i=(t[0][0]-c[0])*h),l>=0?(r=(t[0][1]-c[1])*l,o=(t[1][1]-c[1])*l):(r=(t[1][1]-c[1])*l,o=(t[0][1]-c[1])*l),n>o||r>i?null:((r>n||isNaN(n))&&(n=r),(o<i||isNaN(i))&&(i=o),u>=0?(s=(t[0][2]-c[2])*u,a=(t[1][2]-c[2])*u):(s=(t[1][2]-c[2])*u,a=(t[0][2]-c[2])*u),n>a||s>i?null:((s>n||n!=n)&&(n=s),(a<i||i!=i)&&(i=a),i<0?null:this.at(n>=0?n:i,e)))},e.intersectTriangle=function(t,e,n,i,r){ji(Ki,e,t),ji($i,n,t),qi(tr,Ki,$i);var o,s=Vi(this.direction,tr);if(s>0){if(i)return null;o=1}else{if(!(s<0))return null;o=-1,s=-s}ji(er,this.origin,t),qi($i,er,$i);var a=o*Vi(this.direction,$i);if(a<0)return null;qi(Ki,Ki,er);var h=o*Vi(this.direction,Ki);if(h<0)return null;if(a+h>s)return null;var l=-o*Vi(er,tr);return l<0?null:this.at(l/s,r)},e.at=function(t,e){return n=e,i=this.origin,n[0]=i[0],n[1]=i[1],n[2]=i[2],Bi(e,e,Wi(Ji,this.direction,t));var n,i},t}(),rr=Object.freeze({__proto__:null,Plane:Yi,Ray:ir}),or="core-fetch-image",sr=!1,ar=[];function hr(t){return ar.indexOf(t)>-1}function lr(t){hr(t)||ar.push(t)}var ur={};function cr(t,e){ur[t]=e}var Ar,fr="\n    var adapters = {};\n    // Dynamic Create Adapter\n    function createAdapter(key,code){\n        if(adapters[key]||!code){\n            return;\n        }\n        var func=new Function('exports',code+'(exports)');\n        var workerExports={};\n        func(workerExports,self);\n        adapters[key]=workerExports;\n        workerExports.initialize && workerExports.initialize(self);\n\n    }\n    onmessage = function (msg) {\n        msg = msg.data;\n        //createAdapter\n        if (msg.messageType === 'createAdapter') {\n           var key=msg.key;\n           var code=msg.code;\n           createAdapter(key,code);\n           postMessage({adapterName:key});\n           return;\n        }\n        // postMessage when main thread idle\n        if(msg.messageType==='idle'){\n            var messageRatio = msg.messageRatio;\n            handleMessageQueue(messageRatio);\n            return;\n        }\n        if (msg.messageType === 'batch') {\n            const messages = msg.messages;\n            if (messages) {\n                for (let i = 0; i < messages.length; i++) {\n                    dispatch(messages[i]);\n                }\n            }\n        } else {\n            dispatch(msg);\n        }\n    };\n\n    function dispatch(msg) {\n        var workerKey = msg.workerKey;\n        var adapter = adapters[workerKey];\n        if (!adapter) {\n            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);\n            return;\n        }\n        try {\n            adapter.onmessage(msg, wrap(msg.callback));\n        } catch (err) {\n            post(msg.callback, workerKey + ':' + err.message);\n            console.error(err);\n            throw err;\n        }\n    }\n\n    var messageResultQueue = [];\n\n    function handleMessageQueue(messageRatio){\n       if(messageResultQueue.length===0){\n          return;\n       }\n       var count = Math.ceil((messageRatio || 1) * messageResultQueue.length);\n       var queues = messageResultQueue.slice(0, count);\n       queues.forEach(function(queue){\n          post(queue.callback,queue.err,queue.data,queue.buffers);\n       });\n       messageResultQueue=messageResultQueue.slice(count, Infinity);\n    }\n\n    function post(callback, err, data, buffers) {\n        var msg = {\n            callback : callback\n        };\n        if (err) {\n            msg.error = err;\n        } else {\n            msg.data = data;\n        }\n        if (buffers && buffers.length > 0) {\n            postMessage(msg, buffers);\n        } else {\n            postMessage(msg);\n        }\n    }\n\n    function joinQueue(callback,err,data,buffers){\n        messageResultQueue.push({\n            callback:callback,\n            err:err,\n            data:data,\n            buffers:buffers\n        });\n    }\n\n    function wrap(callback) {\n        return function (err, data, buffers) {\n            joinQueue(callback, err, data, buffers);\n        };\n    }\n    var workerExports;\n",dr="\n    workerExports = null;\n";function pr(){if("undefined"==typeof window)return null;if(!Ar){var t=function(){var t=fr;for(var e in ur){var n=ur[e];lr(e),A(n)&&0===n.length&&(n=n()),t+="\n    workerExports = {};\n    ("+n+")(workerExports, self);\n    adapters['"+e+"'] = workerExports",t+="\n    workerExports.initialize && workerExports.initialize(self);\n        "}return t+dr}();Ar=window.URL.createObjectURL(new Blob([t],{type:"text/javascript"})),ur={}}return Ar}function gr(t,e){if(ur[t]){var n=ur[t];if(A(n)&&0===n.length&&(n=n()),n="("+n+")",Xi){var i=Xi.workers||[];0===i.length&&console.error("workerpool workers count is 0");var r=0,o=function n(o){(o=o.data||{}).adapterName===t&&++r===i.length&&(i.forEach((function(t){t.removeEventListener("message",n)})),delete ur[t],e())};i.forEach((function(e){e.addEventListener("message",o),e.postMessage({key:t,code:n,messageType:"createAdapter"})}))}}else console.error("not find "+t+" adapter")}var mr,yr="undefined"!=typeof window?window.navigator.hardwareConcurrency||4:0,vr=Math.max(Math.floor(yr/2),1),_r=function(){function t(t=50){this._limit=t,this._messages=[],this.buffers=[]}var e=t.prototype;return e.addMessage=function(t,e){if(this._messages.push(t),Array.isArray(e))for(var n=0;n<e.length;n++)this.buffers.indexOf(e[n])<0&&this.buffers.push(e[n])},e.isFull=function(){return this._messages.length>=this._limit},e.getMessage=function(){return{messageType:"batch",messages:this._messages}},t}(),xr=function(){function t(){this.active={},this.workerCount="undefined"!=typeof window?r.workerCount||vr:0,this._messages=[],this._messageBuffers=[]}var e=t.prototype;return e.acquire=function(t){if(!this.workers){this.workers=[];for(var e=pr(),n=0;n<this.workerCount;n++){var i=new Worker(e);i.id=n,this.workers.push(i)}URL.revokeObjectURL(e),sr=!0}return this.active[t]=!0,this.workers.slice()},e.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},e.addMessage=function(t,e,n){var i=this._messages[t];i&&i.length||(i=this._messages[t]=[new _r]);var r=i[i.length-1];r.isFull()&&(r=new _r,this._messages[t].push(r)),r.addMessage(e,n)},e.commit=function(){if(this.workers&&this._messages.length)for(var t=0;t<this._messages.length;t++)if(this._messages[t]&&this._messages[t].length){var e=this._messages[t].shift();this.workers[t].postMessage(e.getMessage(),e.buffers)}},e.getWorkers=function(){return this.workers||[]},e.broadcastIdleMessage=function(t){return this.getWorkers().forEach((function(e){e.postMessage({messageType:"idle",messageRatio:t})})),this},t}();function br(){return mr||(mr=new xr,Xi=mr),mr}var wr=[],Cr=[];function Pr(t){return Or(),new Promise((function(e,n){if(t)if(A(t)&&(t={count:1,run:t}),t.run)if(a(t.count)&&(t.count=1),t.count=Math.ceil(t.count),h(t.count)){var i=t;i.results=[],wr.push(i),i.resolve=e}else n(new Error("task.count is not number"));else n(new Error("task.run is null"));else n(new Error("task is null"))}))}function Mr(t){var e=r.messagePostRatioPerWorker*(t?.5:1);br().commit(),br().broadcastIdleMessage(e),function(){if(0!==wr.length){for(var t=[],e=[],n=wr.length,i=0;i<n;i++){var r=wr[i];if(r.count--,-1===r.count)e.push(r);else{t.push(r);var o=r.run();r.results.push(o)}}wr=t,n=e.length;for(var s=0;s<n;s++){var a=e[s];a.resolve&&a.resolve(a.results)}}}(),Cr.forEach((function(t){t()}))}var Tr=o();function Sr(){Mr(),Tr=o(),requestIdleCallback(Sr)}function Ir(){if(Q.requestIdleCallback){var{idleForceTimeThreshold:t,idleLog:e}=r;o()-Tr>t&&(Mr(!0),Tr=o(),e&&console.warn("did not apply for availability, forced run idle"))}else Mr();ot(Ir)}var Er=!1;function Or(){Er||(Er=!0,Q.requestIdleCallback&&requestIdleCallback(Sr),ot(Ir))}function Rr(t){Cr.indexOf(t)>-1||A(t)&&Cr.push(t)}var Dr,kr=Object.freeze({__proto__:null,pushLoopHook:Rr,runTaskAsync:Pr,startTasks:Or}),Lr="function"==typeof Map,Fr=function(){},Nr=function(){function t(t,e){this.max=t,this.onRemove=e||Fr,this.reset()}var e=t.prototype;return e.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var n=this.getAndRemove(this.order[0]);n&&this.onRemove(n)}return this},e.has=function(t){return t in this.data},e.keys=function(){return this.order},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},e.get=function(t){return this.has(t)?this.data[t]:null},e.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},e.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},t}();Lr&&(Dr=function(){function t(t,e){this.max=t,this.onRemove=e||Fr,this.reset()}var e=t.prototype;return e.reset=function(){if(this.data)for(var t,e=rt(this.data.values());!(t=e()).done;)this.onRemove(t.value);return this.data=new Map,this},e.clear=function(){this.reset(),delete this.onRemove},e.add=function(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e)):this.data.set(t,e),this):this},e.keys=function(){for(var t,e=new Array(this.data.size),n=0,i=rt(this.data.keys());!(t=i()).done;)e[n++]=t.value;return e},e.shrink=function(){for(var t=this.data.keys(),e=t.next();this.data.size>this.max;){var n=this.getAndRemove(e.value);n&&this.onRemove(n),e=t.next()}},e.has=function(t){return this.data.has(t)},e.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data.get(t);return this.data.delete(t),e},e.get=function(t){return this.has(t)?this.data.get(t):null},e.remove=function(t){if(!this.has(t))return this;var e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this},e.setMaxSize=function(t){return this.max=t,this.data.size>this.max&&this.shrink(),this},t}());var zr=Lr?Dr:Nr,Br={exports:{}},Hr={exports:{}};Hr.exports=function(){function t(t,n,r,o,s){e(t,n,r||0,o||t.length-1,s||i)}function e(t,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,h=i-r+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(h-a/2<0?-1:1);e(t,i,Math.max(r,Math.floor(i-h*u/a+c)),Math.min(o,Math.floor(i+(a-h)*u/a+c)),s)}var A=t[i],f=r,d=o;for(n(t,r,i),s(t[o],A)>0&&n(t,r,o);f<d;){for(n(t,f,d),f++,d--;s(t[f],A)<0;)f++;for(;s(t[d],A)>0;)d--}0===s(t[r],A)?n(t,r,d):n(t,++d,o),d<=i&&(r=d+1),i<=d&&(o=d-1)}}function n(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function i(t,e){return t<e?-1:t>e?1:0}return t}();var jr=Hr.exports;Br.exports=Gr,Br.exports.default=Gr;var Ur=jr;function Gr(t,e){if(!(this instanceof Gr))return new Gr(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function Vr(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function Wr(t,e){qr(t,0,t.children.length,e,t)}function qr(t,e,n,i,r){r||(r=no(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],Zr(r,t.leaf?i(o):o);return r}function Zr(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Qr(t,e){return t.minX-e.minX}function Xr(t,e){return t.minY-e.minY}function Yr(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Jr(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Kr(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function $r(t,e){var n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,o-i)}function to(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function eo(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function no(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function io(t,e,n,i,r){for(var o,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=i||(o=e+Math.ceil((n-e)/i/2)*i,Ur(t,o,e,n,r),s.push(e,o,o,n))}Gr.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],i=this.toBBox;if(!eo(t,e))return n;for(var r,o,s,a,h=[];e;){for(r=0,o=e.children.length;r<o;r++)s=e.children[r],eo(t,a=e.leaf?i(s):s)&&(e.leaf?n.push(s):to(t,a)?this._all(s,n):h.push(s));e=h.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!eo(t,e))return!1;for(var i,r,o,s,a=[];e;){for(i=0,r=e.children.length;i<r;i++)if(o=e.children[i],eo(t,s=e.leaf?n(o):o)){if(e.leaf||to(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=no([]),this},remove:function(t,e){if(!t)return this;for(var n,i,r,o,s=this.data,a=this.toBBox(t),h=[],l=[];s||h.length;){if(s||(s=h.pop(),i=h[h.length-1],n=l.pop(),o=!0),s.leaf&&-1!==(r=Vr(t,s.children,e)))return s.children.splice(r,1),h.push(s),this._condense(h),this;o||s.leaf||!to(s,a)?i?(n++,s=i.children[n],o=!1):s=null:(h.push(s),l.push(n),n=0,i=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:Qr,compareMinY:Xr,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,i){var r,o=n-e+1,s=this._maxEntries;if(o<=s)return Wr(r=no(t.slice(e,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),(r=no([])).leaf=!1,r.height=i;var a,h,l,u,c=Math.ceil(o/s),A=c*Math.ceil(Math.sqrt(s));for(io(t,e,n,A,this.compareMinX),a=e;a<=n;a+=A)for(io(t,a,l=Math.min(a+A-1,n),c,this.compareMinY),h=a;h<=l;h+=c)u=Math.min(h+c-1,l),r.children.push(this._build(t,h,u,i-1));return Wr(r,this.toBBox),r},_chooseSubtree:function(t,e,n,i){for(var r,o,s,a,h,l,u,c;i.push(e),!e.leaf&&i.length-1!==n;){for(u=c=1/0,r=0,o=e.children.length;r<o;r++)h=Yr(s=e.children[r]),(l=Kr(t,s)-h)<c?(c=l,u=h<u?h:u,a=s):l===c&&h<u&&(u=h,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var i=n?t:(0,this.toBBox)(t),r=[],o=this._chooseSubtree(i,this.data,e,r);for(o.children.push(t),Zr(o,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)},_split:function(t,e){var n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var o=this._chooseSplitIndex(n,r,i),s=no(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,Wr(n,this.toBBox),Wr(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=no([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Wr(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var i,r,o,s,a,h,l,u;for(h=l=1/0,i=e;i<=n-e;i++)s=$r(r=qr(t,0,i,this.toBBox),o=qr(t,i,n,this.toBBox)),a=Yr(r)+Yr(o),s<h?(h=s,u=i,l=a<l?a:l):s===h&&a<l&&(l=a,u=i);return u},_chooseSplitAxis:function(t,e,n){var i=t.leaf?this.compareMinX:Qr,r=t.leaf?this.compareMinY:Xr;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)},_allDistMargin:function(t,e,n,i){t.children.sort(i);var r,o,s=this.toBBox,a=qr(t,0,e,s),h=qr(t,n-e,n,s),l=Jr(a)+Jr(h);for(r=e;r<n-e;r++)o=t.children[r],Zr(a,t.leaf?s(o):o),l+=Jr(a);for(r=n-e-1;r>=e;r--)o=t.children[r],Zr(h,t.leaf?s(o):o),l+=Jr(h);return l},_adjustParentBBoxes:function(t,e,n){for(var i=n;i>=0;i--)Zr(e[i],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():Wr(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var ro=mi(Br.exports),oo={},so=function(){function t(){this._tree=ro(9,["[0]","[1]","[2]","[3]"])}var e=t.prototype;return e.collides=function(t){return[oo.minX,oo.minY,oo.maxX,oo.maxY]=t,this._tree.collides(oo)},e.insertBox=function(t){return this._tree.insert(t),this},e.bulkInsertBox=function(t){return this._tree.load(t),this},e.clear=function(){return this._tree.clear(),this},t}(),ao=new zr(5e4);function ho(t,e,n){var i=t.font,r=t.fillStyle,o=t.strokeStyle,s=e.textHaloFill||lo,a=e.textHaloRadius||0,l=e.textHaloOpacity;h(l)||(l=1);var u=i+"_"+r+"_"+s+"_"+a+"_"+l+"_"+n,c=ao.get(u);if(!c){var A=0!==l&&0!==a,f=2*(1.2*(e.textSize||14)+a),d=Mo.createCanvas(f,f);d.style.width=f/2+"px",d.style.height=f/2+"px";var p=f/4,g=f/4,m=Mo.getCanvas2DContext(d);m.scale(2,2),m.font=i,m.textAlign="center",m.textBaseline="middle",A&&(m.strokeStyle=o,m.lineWidth=2*a,m.globalAlpha=1,m.globalAlpha*=l,m.strokeText(n,p,g),m.globalAlpha=1),m.fillStyle=r,m.fillText(n,p,g),ao.add(u,c=d)}return c}var lo="#000",uo=!1,co=null,Ao=Math.PI/180,fo=new so,po=new so,go=function(){for(var t={},e=32;e<128;e++){var n=String.fromCharCode(e);t[n]=n}return t}();function mo(t){if(t.toReversed)return t.toReversed();for(var e=[],n=0,i=t.length-1;n<=i;n++)e[n]=t[i-n];return e}function yo(t,e,n,i,r){var o=Math.atan2(e.y-t.y,e.x-t.x),s=o/Math.PI*180;return"left"===i?o=(s+=180)/180*Math.PI:"down"!==i||r?"up"!==i||r?o:o=(s+=90)/180*Math.PI:o=(s-=90)/180*Math.PI}function vo(t,e){var n=e,i=e;return go[t]&&(n=e/4,i=e),Math.sqrt(n*n+i*i)}function _o(t,e){var{distance:n,p1:i,p2:r}=t,o=e/n;return new ht(i.x+o*(r.x-i.x),i.y+o*(r.y-i.y),(i.z||0)+o*((r.z||0)-(i.z||0)))}function xo(t){for(var e=t[0].point,n=t[t.length-1].point,i=Ti(),r=0,o=t.length;r<o;r++)Ei(t[r].point,i);var[s,a,h,l]=i,u=!0;return l-a>h-s&&(u=!1),u?e.x<n.x?"right":"left":e.y<n.y?"down":"up"}function bo(t,e,n,i){var r=Co(t),o=[],s=0,a=!1;fo.clear();for(var h=1,l=0,u=e.length;l<u;l++){for(var c=e[l],A=vo(c,n),f=A+s,d=h,p=t.length;d<p;d++){var g=t[d-1],m=t[d];if(!(m.distance<f)){h=d;var y=(f-g.distance)/(m.distance-g.distance),v=new ht(g.x+(m.x-g.x)*y,g.y+(m.y-g.y)*y),{x:_,y:x}=v,b=A/3,w=[_-b,x-b,_+b,x+b];if(i&&i.collides(w)){a=!0;break}if(fo.collides(w)){a=!0;break}fo.insertBox(w),o.push({char:c,charSize:A,point:v,bbox:[_-(b=A/2),x-b,_+b,x+b]}),s+=A;break}}if(a)break}return a||r<s?[]:o}function wo(t,e,n,i,r,o,s,a,h,l){var u,c,A,f,d,p,g,m,y,v,_,x,b,w,C,P,M=(t+n)/2,T=(e+i)/2,S=(n+r)/2,I=(i+o)/2,E=(r+s)/2,O=(o+a)/2,R=Math.sqrt((n-t)*(n-t)+(i-e)*(i-e)),D=Math.sqrt((r-n)*(r-n)+(o-i)*(o-i)),k=R/(R+D),L=D/(D+Math.sqrt((s-r)*(s-r)+(a-o)*(a-o))),F=M+(S-M)*k,N=T+(I-T)*k,z=S+(E-S)*L,B=I+(O-I)*L,H=F+(S-F)*h+n-F,j=N+(I-N)*h+i-N,U=z+(S-z)*h+r-z,G=B+(I-B)*h+o-B;return l<1?[((A=n)*(_=1-(u=0))*_+2*(d=H)*u*_+(g=U)*u*u)*(x=1-(c=l))+(d*_*_+2*g*u*_+(y=r)*u*u)*c,((f=i)*_*_+2*(p=j)*u*_+(m=G)*u*u)*x+(p*_*_+2*m*u*_+(v=o)*u*u)*c,(b=A*x*x+2*d*c*x+g*c*c)*_+(w=d*x*x+2*g*c*x+y*c*c)*u,(C=f*x*x+2*p*c*x+m*c*c)*_+(P=p*x*x+2*m*c*x+v*c*c)*u,b*x+w*c,C*x+P*c]:[H,j,U,G]}function Co(t){if(t.length<2)return 0;var e=0;t[0].distance=0;for(var n=1,i=t.length;n<i;n++){var r=t[n-1],o=t[n],s=r.distanceTo(o);o.distance=s+r.distance,e+=s}return e}function Po(t,e,n){var i=t.x,r=t.y;return new ht(i+(e.x-i)*n,r+(e.y-r)*n)}var Mo={getCanvas2DContext:function(t){return t.getContext("2d",{willReadFrequently:!0})},setHitTesting:function(t){uo=t},createCanvas:function(t,e,i){var r;return n?r=new i(t,e):((r=we("canvas")).width=t,r.height=e),r},prepareCanvasFont:function(t,e){"top"!==t.textBaseline&&(t.textBaseline="top");var n=de(e);t.font!==n&&(t.font=n);var i=e.textFill;i||(i="#000");var r=Mo.getRgba(i,e.textOpacity);t.fillStyle!==r&&(t.fillStyle=r)},prepareCanvas:function(t,e,n,i){if(e){var r=e.lineWidth;a(r)||t.lineWidth===r||(t.lineWidth=r);var o=e.linePatternFile,s=e.lineColor||lo;if(i)t.strokeStyle="#000";else if(o&&n){var h;(e.linePatternDx||e.linePatternDy)&&(h=[e.linePatternDx,e.linePatternDy]),Mo._setStrokePattern(t,o,r,h,n),e.lineDasharray=[]}else Yn(s)?t.strokeStyle=e.lineGradientExtent?Mo._createGradient(t,s,e.lineGradientExtent):lo:(Array.isArray(s)&&(s=Mo.normalizeColorToRGBA(s)),t.strokeStyle=s);e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&wt(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var l=e.polygonPatternFile,u=e.polygonFill||"rgba(255,255,255,0)";if(i)t.fillStyle="#000";else if(l&&n){var c=Io(l),A=n.getImage([c,null,null]);if(A||(A=n.getImage([c+"-texture",null,r])),lt(c)&&A instanceof Image&&(Q.edge||Q.ie)){var f=A.width||20,d=A.height||20,p=Mo.createCanvas(f,d);Mo.image(p.getContext("2d"),A,0,0,f,d),A=p}A?(t.fillStyle=t.createPattern(A,"repeat"),(e.polygonPatternDx||e.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[e.polygonPatternDx,e.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",c)}else Yn(u)?t.fillStyle=e.polygonGradientExtent?Mo._createGradient(t,u,e.polygonGradientExtent):"rgba(255,255,255,0)":(Array.isArray(u)&&(u=Mo.normalizeColorToRGBA(u)),t.fillStyle=u)}},_createGradient:function(t,e,n){var i=null,r=e.places,o=n.getMin(),s=n.getMax(),a=n.getWidth(),h=n.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,a*r[2],o.x+r[3]*a,o.y+r[4]*h,a*r[5]]}else{var l=n.getCenter()._round();r=[l.x,l.y,Math.abs(l.x-o.x),l.x,l.y,0]}i=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,o.x+r[2]*a,o.y+r[3]*h]}else r=[o.x,o.y,s.x,o.y];i=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach((function(t){i.addColorStop.apply(i,t)})),i},_setStrokePattern:function(t,e,i,r,o){var s,a=Io(e);if(n)s=o.getImage([a,null,i]);else{var h=a+"-texture-"+i;if(!(s=o.getImage(h))){var l=o.getImage([a,null,null]);if(l){var u;u=l.width&&l.height?Math.round(l.width*i/l.height):i;var c=Mo.createCanvas(u,i,t.canvas.constructor);Mo.image(c.getContext("2d"),l,0,0,u,i),o.addResource([h,null,i],c),s=c}}}s?(t.strokeStyle=t.createPattern(s,"repeat"),t.strokeStyle.linePatternOffset=r):"undefined"!=typeof console&&console.warn("img not found for",a)},clearRect:function(t,e,n,i,r){t.canvas._drawn=!1,t.clearRect(e,n,i,r)},fillCanvas:function(t,e,n,i){if(uo&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=Mo._isPattern(t.fillStyle),s=t.fillStyle&&t.fillStyle.polygonPatternOffset,h=s?s[0]:0,l=s?s[1]:0;a(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),o&&t.translate((n=n||0)+h,(i=i||0)+l),t.fill(),o&&t.translate(-n-h,-i-l),e<1&&(t.globalAlpha=r)}},getRgba:function(t,e){return a(e)&&(e=1),"#"!==t[0]?(Array.isArray(t)&&(t=Mo.normalizeColorToRGBA(t,e)),t):(7===t.length?(n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(n=17*parseInt(t.substring(1,2),16),i=17*parseInt(t.substring(2,3),16),r=17*parseInt(t.substring(3,4),16)),"rgba("+n+","+i+","+r+","+e+")");var n,i,r},normalizeColorToRGBA:function(t,e=1){return"rgba("+255*t[0]+", "+255*t[1]+", "+255*t[2]+", "+(4===t.length?t[3]:1)*e+")"},image:function(t,e,n,i,r,o){t.canvas._drawn=!0;try{h(r)&&h(o)?t.drawImage(e,n,i,r,o):t.drawImage(e,n,i)}catch(s){console&&(console.warn("error when drawing image on canvas:",s),console.warn(e))}},text:function(t,e,n,i,r){return Mo._textOnMultiRow(t,r.rows,i,n,r.size,r.rawSize)},_textOnMultiRow:function(t,e,n,i,r,o){var s,a,h=ce(r,n.textHorizontalAlignment,n.textVerticalAlignment),l=o.height+n.textLineSpacing,u=i.add(0,h.y),c=n.textMaxHeight,A=0;Ii(Si);for(var f=0,d=e.length;f<d;f++){s=e[f].text,a=ce(e[f].size,n.textHorizontalAlignment,n.textVerticalAlignment);var p=u.add(a.x,f*l);Mo._textOnLine(t,s,p,n.textHaloRadius,n.textHaloFill,n.textHaloOpacity);var g=e[f].size,m=p.x,y=p.y;if(Oi(Si,m,y,m+g.width,y+g.height),c>0&&(A+=l)+g.height>=c)break}return Si},_textOnLine:function(t,e,n,i,r,o){uo&&(o=1);var s,a,h=0!==o&&0!==i;t.textBaseline="top";var l=t.shadowBlur,u=t.shadowOffsetX,c=t.shadowOffsetY;if(h){var A=t.globalAlpha;t.globalAlpha*=o,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*i,Array.isArray(r)&&(r=Mo.normalizeColorToRGBA(r)),t.strokeStyle=r,t.strokeText(e,n.x,n.y+1),t.miterLimit=10,t.globalAlpha=A,s=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",a=t.fillStyle,t.fillStyle="#000"}l&&h&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),Mo.fillText(t,e,n),s&&(t.globalCompositeOperation=s,Mo.fillText(t,e,n,a),l&&(t.shadowBlur=l,t.shadowOffsetX=u,t.shadowOffsetY=c))},fillText:function(t,e,n,i){t.canvas._drawn=!0,i&&(t.fillStyle=i),t.fillText(e,n.x,n.y+1)},textAlongLine:function(t,e,n,i,r,o){if(e){var s=i.textSize||14,a=i.textSpacing||0,l=function(t,e){for(var n=0,i=0,r=t.length;i<r;i++)n+=vo(t[i],e);return n}(e,s);if(!(a<l)){Array.isArray(n[0])||(n=[n]);var u=t.textBaseline,c=t.textAlign,A=t.strokeStyle,f=t.globalAlpha,d=t.lineWidth,p=i.textAlongDebug,g=i.textHaloFill||lo,m=i.textHaloRadius||0,y=i.textHaloOpacity;h(y)||(y=1);var v=0!==y&&0!==m;t.textBaseline="middle",t.textAlign="center",v&&(Array.isArray(g)&&(g=Mo.normalizeColorToRGBA(g)),t.strokeStyle=g,t.lineWidth=2*m),po.clear();var _=Ti(),x=e.split(""),b=function(t){for(var e=0,n=t.length;e<n;e++)if(!go[t[e]])return!1;return!0}(x);if(n.forEach((function(e){if(!(Co(e)<l)){var n=function(t,e){e=Object.assign({segDistance:1,isGeo:!0},e);for(var n=Math.max(e.segDistance,1e-17),i=[],r=0,o=0,s=0,a=t.length;s<a-1;s++){var h=t[s],l=t[s+1],u=l.distanceTo(h);i[o]={p1:h,distance:u,p2:l},o++,r+=u}if(r<=n)return[{distance:r,points:t}];var c,A=i.length;o=0;for(var f=0,d=[],p=[i[0].p1];o<A;){var{distance:g,p2:m}=i[o];if((f+=g)<n)p.push(m),o++;else if(f!==n){if(f>n){var y=n-(f-g);c=_o(i[o],y),p.push(c),d.push(p),f=0,i[o].p1=c,i[o].distance=g-y,p=[c]}}else p.push(m),f=0,d.push(p),p=[m],o++}p.length&&d.push(p);for(var v=[],_=0,x=d.length;_<x;_++){var b=d[_];v[_]={points:b,distance:Co(b)}}return v}(e,{segDistance:a});if(n&&n.length)for(var r=0,h=n.length;r<h;r++){var u=n[r];if(!(u.distance<l)){var c=u.points;if(p){var A=t.fillStyle;t.fillStyle="red";var{x:f,y:d}=c[0];t.beginPath(),t.fillRect(f-2,d-2,4,4),t.fillStyle=A}var g=x,m=bo(c,g,s,o);if(m.length){var y=xo(m);"left"===y&&(m=bo(c,g=mo(g),s,o)),"up"!==y||b||(m=bo(c,g=mo(g),s,o));for(var v=!1,w=0,C=m.length;w<C;w++){var{bbox:P}=m[w];if(po.collides(P)){v=!0;break}if(o&&o.collides(P)){v=!0;break}}if(!v)for(var M=0,T=m.length;M<T;M++){var S=void 0,I=void 0;0===M?(S=m[M].point,I=m[1].point):M===T-1?(S=m[T-2].point,I=m[T-1].point):(S=m[M-1].point,I=m[M].point);var E=g[M],{point:O,bbox:R}=m[M];po.insertBox(R),o&&o.insertBox(R);var{x:D,y:k}=O,L=yo(S,I,0,y,b);t.save(),t.translate(D,k),t.rotate(L);var F=ho(t,i,E),{width:N,height:z}=F;if(t.drawImage(F,-N/4,-z/4,N/2,z/2),t.restore(),Oi(_,R),p){var B=t.strokeStyle,H=t.lineWidth;t.strokeStyle="red",t.lineWidth=.5;var[j,U,G,V]=R;t.beginPath(),t.rect(j,U,G-j,V-U),t.stroke(),t.lineWidth=H,t.strokeStyle=B}}}}}}})),t.textBaseline=u,t.textAlign=c,t.strokeStyle=A,t.globalAlpha=f,t.lineWidth=d,Ri(_))return _}}},_stroke:function(t,e,n,i){if(uo&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=t.strokeStyle&&t.strokeStyle.linePatternOffset,s=o?o[0]:0,h=o?o[1]:0,l=Mo._isPattern(t.strokeStyle)&&(!a(n)&&!a(i)||!a(s)&&!a(h));a(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),l&&t.translate((n=n||0)+s,(i=i||0)+h),t.stroke(),l&&t.translate(-n-s,-i-h),e<1&&(t.globalAlpha=r)}},_gradientPath:function(t,e,n,i,r=!1){if(h(i)||(i=1),uo&&(i=1),0!==i&&0!==t.lineWidth){var o=t.globalAlpha;t.globalAlpha*=i;var s,a,l,u,c,A,f,d=t.lineColorIn,p=function(t){if(h(t.minStep))return t.minStep;for(var e=t.colors||[],n=e.length,i=[],r=0;r<n;r++)i[r]=e[r][0];i.sort((function(t,e){return t-e}));for(var o=1/0,s=1;s<n;s++)o=Math.min(o,i[s]-i[s-1]);return t.minStep=o,o}(d),g=Co(e),m=0,[y,v,_,x]=d.getColor(0);s="rgba("+y+", "+v+", "+_+", "+x+")";var b=e[0];l=b.x,u=b.y,r&&(b.equals(e[e.length-1])||e.push(b));for(var w=n&&Array.isArray(n)&&n.length>1,C=function(){!w&&f&&(t.strokeStyle=a,t.beginPath(),t.moveTo(l,u),t.lineTo(c,A),t.lineTo(f.x,f.y),t.stroke());var e=t.createLinearGradient(l,u,c,A);e.addColorStop(0,s),e.addColorStop(1,a),t.strokeStyle=e,t.beginPath(),t.moveTo(l,u),t.lineTo(c,A),t.stroke(),s=a,l=c,u=A},P=1,M=e.length;P<M;P++){var T=e[P-1],S=e[P];f=e[P+1];var I=S.x,E=S.y,O=S.distanceTo(T)/g;if(O<=p){var[R,D,k,L]=d.getColor(m+O);a="rgba("+R+", "+D+", "+k+", "+L+")",c=I,A=E,C()}else{var F=Math.ceil(O/p);f=S;for(var N=1;N<=F;N++){var z=Math.min(N*p,O),[B,H,j,U]=d.getColor(m+z);if((a="rgba("+B+", "+H+", "+j+", "+U+")")!==s){var G=Po(T,S,z/O);c=G.x,A=G.y,C()}}}m+=O}t.globalAlpha=o}},_path:function(t,e,n,i,r){if(wt(e))for(var o,s=wt(n),a=!0!==r&&Mo._isPattern(t.strokeStyle),h=0,l=e.length;h<l;h++)if(o=e[h],!s||t.setLineDash)t.lineTo(o.x,o.y),a&&h>0&&(u(e[h-1],o),t.beginPath(),t.moveTo(o.x,o.y));else if(s){if(h===l-1)break;To(t,o,e[h+1],n)}function u(e,n){var r=Dt(e.x,e.y,n.x,n.y);t.save(),t.rotate(r),Mo._stroke(t,i),t.restore()}},path:function(t,e,n,i,r){wt(e)&&(t.lineColorIn?this._gradientPath(t,e,r,n):(t.beginPath(),t.moveTo(e[0].x,e[0].y),Mo._path(t,e,r,n)),Mo._stroke(t,n))},_multiClip:function(t,e){e&&0!==e.length&&e.forEach((function(e){for(var n=0,i=e.length;n<i;n++){var r=e[n],o=r.x,s=r.y;0===n?t.moveTo(o,s):t.lineTo(o,s),n===i-1&&t.lineTo(o=e[0].x,s=e[0].y)}}))},polygon:function(t,e,i,r,o,s){if(t.isMultiClip)Mo._multiClip(t,e);else if(t.isClip)Mo._multiClip(t,Array.isArray(e[0])?e:[e]);else if(wt(e)){var a=Mo._isPattern(t.strokeStyle),h=wt(o)&&!t.setLineDash||a&&!s;wt(e[0])||(e=[e]);var l=t,u=t.dpr||1,c=1!==u;e.length>1&&!n&&(co||(co=Mo.createCanvas(1,1)),t.canvas._drawn=!1,co.width=t.canvas.width,co.height=t.canvas.height,Oo(t=co.getContext("2d"),[]),Oo(t,o),Eo(t,l),c&&t.scale(u,u));var A,f,d,p=t.lineColorIn,g=t.lineWidth;if(h){for(t.save(),f=0,d=e.length;f<d;f++)wt(e[f])&&(p&&(t.lineWidth=.1),Mo._ring(t,e[f],null,0,!0),A=r,f>0&&(t.globalCompositeOperation="destination-out",A=1),Mo.fillCanvas(t,A,e[f][0].x,e[f][0].y),f>0?t.globalCompositeOperation="source-over":d>1&&(t.fillStyle="#fff"),Mo._stroke(t,0),t.lineWidth=g,p&&Mo._gradientPath(t,e,null,0,!0));t.restore()}var m=t.fillStyle;for(f=0,d=e.length;f<d;f++)wt(e[f])&&(p&&(t.lineWidth=.1),s?(Mo.paintSmoothLine(t,e[f],i,s,!0),t.closePath()):Mo._ring(t,e[f],o,i),h||(A=r,f>0&&(t.globalCompositeOperation="destination-out",A=1),Mo.fillCanvas(t,A,e[f][0].x,e[f][0].y),f>0?t.globalCompositeOperation="source-over":d>1&&(t.fillStyle="#fff")),Mo._stroke(t,i),t.lineWidth=g,p&&Mo._gradientPath(t,e[f],o,i,!0));if(t.fillStyle!==m&&(t.fillStyle=m),e.length>1&&!n){if(c){var y=1/u;l.scale(y,y)}l.drawImage(co,0,0),c&&l.scale(u,u),l.canvas._drawn=t.canvas._drawn,Eo(l,t)}}},_ring:function(t,e,n,i,r){var o=Mo._isPattern(t.strokeStyle);r||!o||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),Mo._path(t,e,n,i,r),o||t.closePath()},paintSmoothLine_bak:function(t,e,n,i,r,o,s){if(e)if(e.length<=2||!i)Mo.path(t,e,n);else{var a,h=e.length,l=r?h:h-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==s&&(l-=Math.max(l-o-1,0));for(var u=0;u<l;u++){var c=void 0,A=void 0,f=void 0,d=void 0,p=void 0,g=void 0;u-1<0?r?(c=e[l-1].x,A=e[l-1].y):(c=e[u+1].x,A=e[u+1].y):(c=e[u-1].x,A=e[u-1].y),u+1<h?(f=e[u+1].x,d=e[u+1].y):(f=e[u+1-h].x,d=e[u+1-h].y),u+2<h?(p=e[u+2].x,g=e[u+2].y):r?(p=e[u+2-h].x,g=e[u+2-h].y):(p=e[u].x,g=e[u].y);var m=wo(c,A,e[u].x,e[u].y,f,d,p,g,i,u===l-1?s:1);if(u===l-1&&s>=0&&s<1){t.bezierCurveTo(m[0],m[1],m[2],m[3],m[4],m[5]),e.splice(l-1,h-(l-1)-1);var y=new ht(m[4],m[5]);y.prevCtrlPoint=new ht(m[2],m[3]),e.push(y),h=e.length}else t.bezierCurveTo(m[0],m[1],m[2],m[3],f,d);e[u].nextCtrlPoint=m.slice(0,2),e[u].prevCtrlPoint=a?a.slice(2):null,a=m}!r&&e[1].prevCtrlPoint&&(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[h-1].prevCtrlPoint||(e[h-1].prevCtrlPoint=e[h-2].nextCtrlPoint),Mo._stroke(t,n)}},paintSmoothLine:function(t,e,n,i,r,o,s){if(e)if(e.length<=2||!i)Mo.path(t,e,n);else{var a,h,l=e.length,u=r?l:l-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==s&&(u-=Math.max(u-o-1,0));for(var c=0;c<u;c++){var A=void 0,f=void 0,d=void 0,p=void 0,g=void 0,m=void 0;c-1<0?r?(A=e[u-1].x,f=e[u-1].y):(A=e[c+1].x,f=e[c+1].y):(A=e[c-1].x,f=e[c-1].y),c+1<l?(d=e[c+1].x,p=e[c+1].y):(d=e[c+1-l].x,p=e[c+1-l].y),c+2<l?(g=e[c+2].x,m=e[c+2].y):r?(g=e[c+2-l].x,m=e[c+2-l].y):(g=e[c].x,m=e[c].y);var y=e[c],v=wo(A,f,e[c].x,e[c].y,d,p,g,m,i,c===u-1?s:1);if(c===u-1&&s>=0&&s<1){t.bezierCurveTo(v[0],v[1],v[2],v[3],v[4],v[5]),e.splice(u-1,l-(u-1)-1);var _=new ht(v[4],v[5]);e.push(_),l=e.length}else t.bezierCurveTo(v[0],v[1],v[2],v[3],d,p);0===c?(y.arrowNextPoint=y.arrowNextPoint||new ht(0,0),h=v[3],y.arrowNextPoint.x=a=v[2],y.arrowNextPoint.y=h):(y.arrowPrePoint=y.arrowPrePoint||new ht(0,0),y.arrowPrePoint.x=a,y.arrowPrePoint.y=h,a=v[2],h=v[3],c===u-1&&e[c+1]&&(e[c+1].arrowPrePoint=e[c+1].arrowPrePoint||new ht(0,0),e[c+1].arrowPrePoint.x=v[0],e[c+1].arrowPrePoint.y=v[1]))}Mo._stroke(t,n)}},_arcBetween:function(t,e,n,i){var r=Math.abs(i),o=e.distanceTo(n),s=Math.abs(o/2/Math.sin(r/2)),a=Math.asin((n.y-e.y)/o);e.x>n.x&&(a=Math.PI-a);var h=a-(90*Ao-r/2),l=Math.cos(h)*s,u=Math.sin(h)*s,c=e.x+l,A=e.y+u,f=Math.asin((n.y-A)/s);c>n.x&&(f=Math.PI-f);var d=f+r;if(i<0){f+=Math.PI,d+=Math.PI;var p=(e.x+n.x)/2,g=(e.y+n.y)/2;c=p-(c-p),A=g-(A-g)}t.beginPath(),t.arc(c,A,s,f,d);var m=(d-f)/100,y=Math.cos(f+m)*s+c,v=Math.sin(f+m)*s+A,_=Math.cos(d-m)*s+c,x=Math.sin(d-m)*s+A;return e.arrowNextPoint=e.arrowNextPoint||new ht(0,0),n.arrowPrePoint=n.arrowPrePoint||new ht(0,0),i<0?(e.arrowNextPoint.x=y,e.arrowNextPoint.y=v,n.arrowPrePoint.x=_,n.arrowPrePoint.y=x):(e.arrowNextPoint.x=_,e.arrowNextPoint.y=x,n.arrowPrePoint.x=y,n.arrowPrePoint.y=v),[c,A]},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,n,i){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var o=[t];o.push.apply(o,e.splice(1)),Mo._bezierCurveTo.apply(Mo,o),Mo.fillCanvas(t,i),Mo._stroke(t,n)},_bezierCurveTo:function(t,e,n,i){t.bezierCurveTo(e.x,e.y,n.x,n.y,i.x,i.y)},ellipse:function(t,e,n,i,r,o,s){var a,h,l,u,c,A,f,d,p;t.beginPath(),n===i&&n===r?t.arc(e.x,e.y,n,0,2*Math.PI):t.ellipse?i!==r?(t.ellipse(e.x,e.y,n,i,0,180*Ao,360*Ao,!1),t.ellipse(e.x,e.y,n,r,0,0,180*Ao,!1)):t.ellipse(e.x,e.y,n,i,0,0,360*Ao,!1):(a=e.x,h=e.y,f=(l=n)*(A=.5522848),d=(u=i)*A,p=(c=r)*A,t.moveTo(a-l,h),t.bezierCurveTo(a-l,h-d,a-f,h-u,a,h-u),t.bezierCurveTo(a+f,h-u,a+l,h-d,a+l,h),t.bezierCurveTo(a+l,h+p,a+f,h+c,a,h+c),t.bezierCurveTo(a-f,h+c,a-l,h+p,a-l,h),t.closePath()),Mo.fillCanvas(t,s,e.x-n,e.y-i),Mo._stroke(t,o,e.x-n,e.y-i)},rectangle:function(t,e,n,i,r){var{x:o,y:s}=e;t.beginPath(),t.rect(o,s,n.width,n.height),Mo.fillCanvas(t,r,o,s),Mo._stroke(t,i,o,s)},sector:function(t,e,n,i,r,o){var s=Ao;function a(t,e,n,i,a,h){var l=s*-h,u=s*-a;t.beginPath(),t.moveTo(e,n),t.arc(e,n,i,l,u),t.lineTo(e,n),Mo.fillCanvas(t,o,e-i,n-i),Mo._stroke(t,r,e-i,n-i)}a(t,e.x,e.y,n,i[0],i[1])},_isPattern:function(t){return!c(t)&&!("addColorStop"in t)},drawCross:function(t,e,n,i,r){t.canvas._drawn=!0,t.strokeStyle=r,t.lineWidth=i,t.beginPath(),t.moveTo(e-5,n),t.lineTo(e+5,n),t.moveTo(e,n-5),t.lineTo(e,n+5),t.stroke()},copy:function(t,e){var n=e||we("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),n},pixelRect:function(t,e,n,i){var r=t.globalAlpha,o=!1;if(t.lineWidth>0&&n>0)o=!0,n<1&&(t.globalAlpha*=n);else{if(!(i>0))return;i<1&&(t.globalAlpha*=i)}t.canvas._drawn=!0,o?t.strokeRect(e[0],e[1],1,1):t.fillRect(e[0],e[1],1,1),t.globalAlpha!==r&&(t.globalAlpha=r)}};function To(t,e,n,i){var r=e.x,o=e.y,s=n.x,a=n.y,h=i,l=function(t,e){return t<=e},u=function(t,e){return t>=e},c=function(t,e){return Math.min(t,e)},A=function(t,e){return Math.max(t,e)},f={thereYet:u,cap:c},d={thereYet:u,cap:c};o-a>0&&(d.thereYet=l,d.cap=A),r-s>0&&(f.thereYet=l,f.cap=A),t.moveTo(r,o);for(var p,g,m=r,y=o,v=0,_=!0;!f.thereYet(m,s)||!d.thereYet(y,a);)p=Math.atan2(a-o,s-r),g=h[v],m=f.cap(s,m+Math.cos(p)*g),y=d.cap(a,y+Math.sin(p)*g),_?t.lineTo(m,y):t.moveTo(m,y),v=(v+1)%h.length,_=!_}var So="data:image/";function Io(t){return t.substring(0,So.length)===So?t:It(t)}function Eo(t,e){t.filter=e.filter,t.fillStyle=e.fillStyle,t.globalAlpha=e.globalAlpha,t.lineCap=e.lineCap,t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle,t.lineColorIn=e.lineColorIn}function Oo(t,e){e&&t.setLineDash&&Array.isArray(e)&&t.setLineDash(e)}function Ro(t){return"Z__"+t}function Do(t){return function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.on=function(t,e,n){if(!t)return this;if(!c(t))return this._switch("on",t,e);if(!e)return this;this._eventMap||(this._eventMap={});var i,o=t.toLowerCase().split(" ");n||(n=this);var s,a=h(e._id);e._id=At();for(var l=0,u=o.length;l<u;l++){var A=Ro(i=o[l]);if(e[A]&&(e[A]._id=e._id),(s=this._eventMap[i])||(this._eventMap[i]=s=[]),a){var f=s.length;if(f>0)for(var d=0;d<f;d++)if(e===s[d].handler&&s[d].context===n)return r.isTest||console.warn(this,"find '"+t+"' handler:",e," The old listener function will be removed"),this;s.push({handler:e,context:n})}else s.push({handler:e,context:n})}return this},n.addEventListener=function(...t){return this.on.call(this,...t)},n.once=function(t,e,n){if(!c(t)){var i={};for(var r in t)t.hasOwnProperty(r)&&(i[r]=this._wrapOnceHandler(r,t[r],e));return this._switch("on",i)}for(var o=t.split(" "),s=0,a=o.length;s<a;s++)this.on(o[s],this._wrapOnceHandler(o[s],e,n));return this},n.off=function(t,e,n){if(!this._eventMap||!t)return this;if(!c(t))return this._switch("off",t,e);if(!e)return this;if(!h(e._id))return this;var i,r,o,s=t.split(" ");n||(n=this);for(var a=0,l=s.length;a<l;a++)if(o=Ro(i=s[a].toLowerCase()),r=this._eventMap[i]){for(var u=r.length-1;u>=0;u--){var A=r[u];e!==A.handler&&e!==A.handler[o]||A.context!==n||(delete A.handler[o],r.splice(u,1))}r.length||delete this._eventMap[i]}return this},n.removeEventListener=function(...t){return this.off.call(this,...t)},n.listens=function(t,e,n){if(!this._eventMap||!c(t))return 0;var i=this._eventMap[t.toLowerCase()];if(!i||!i.length)return 0;if(!e)return i.length;for(var r=0,o=i.length;r<o;r++)if(e===i[r].handler&&(a(n)||i[r].context===n))return 1;return 0},n.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},n.copyEventListeners=function(t){var e,n=t._eventMap;if(!n)return this;for(var i in n)for(var r=0,o=(e=n[i]).length;r<o;r++)this.on(i,e[r].handler,e[r].context);return this},n.fire=function(t,e){return this._eventParent?this._eventParent.fire.call(this._eventParent,t,e):this._fire.call(this,t,e)},n._wrapOnceHandler=function(t,e,n){var i=Ro(t),r=!1,o=function t(...s){r||(delete o[i],r=!0,n?e.call(n,...s):e.call(this,...s),t._called=!0)};return o[i]=e,o},n._switch=function(t,e,n){for(var i in e)e.hasOwnProperty(i)&&this[t](i,e[i],n);return this},n._clearListeners=function(t){this._eventMap&&c(t)&&this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null)},n._clearAllListeners=function(){this._eventMap=null},n._setEventParent=function(t){return this._eventParent=t,this},n._setEventTarget=function(t){return this._eventTarget=t,this},n._fire=function(t,e){if(!this._eventMap)return this;t=t.toLowerCase();var n=this._eventMap[t];if(!n)return this;e||(e={type:t,target:this._eventTarget||this}),e.type=t,e.target=this._eventTarget||this;for(var i,r,o=n.slice(0),a=0,h=o.length;a<h;a++)o[a]&&(o[a].handler._called||(i=o[a].context,r=s({},e),!1===(i?o[a].handler.call(i,r):o[a].handler(r))&&e.domEvent&&Ee(e.domEvent)));var l=this._eventMap[t];if(l){for(var u=[],c=0,A=l.length;c<A;c++)l[c].handler._called||u.push(l[c]);this._eventMap[t]=u}return this},e}(t)}var ko=function(t){function e(e){var n;return(n=t.call(this)||this)._enabled=!1,n.target=e,n}K(e,t);var n=e.prototype;return n.enable=function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},n.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},n.enabled=function(){return!!this._enabled},n.remove=function(){this.disable(),delete this.target,delete this.dom},e}(Do((function(){}))),Lo=function(){function t(t){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(t),this.callInitHooks(),this._isUpdatingOptions=!1}var e=t.prototype;return e.proxyOptions=function(){var t=this;return Q.proxy?(this.options=new Proxy(this.options,{set:function(e,n,i){if(e[n]===i)return!0;if(e[n]=i,t._isUpdatingOptions)return!0;var r={};return r[n]=i,t.config(r),!0}}),this):this},e.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},e.setOptions=function(t){if(this.hasOwnProperty("options")&&!a(this.options)||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},e.config=function(t,e){if(this._isUpdatingOptions=!0,!t){var n={};for(var i in this.options)this.options.hasOwnProperty(i)&&(n[i]=this.options[i]);return this._isUpdatingOptions=!1,n}if(2===arguments.length&&"string"==typeof t){var r={};r[t]=e,t=r}for(var o in t)this.options[o]=t[o],this[o]&&this[o]instanceof ko&&(t[o]?this[o].enable():this[o].disable());return this.onConfig(t),this._isUpdatingOptions=!1,this},e.onConfig=function(t){},e._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var n=t._initHooks;if(n&&n!==e._initHooks)for(var i=0;i<n.length;i++)n[i].call(this)}},t.addInitHook=function(t,...e){var n="function"==typeof t?t:function(){this[t].call(this,...e)},i=this.prototype,r=Object.getPrototypeOf(i);return i._initHooks&&i._initHooks!==r._initHooks||(i._initHooks=[]),i._initHooks.push(n),this},t.include=function(...t){for(var e=0;e<t.length;e++)s(this.prototype,t[e]);return this},t.mergeOptions=function(t){var e=this.prototype,n=Object.getPrototypeOf(e);return e.options&&e.options!==n.options||(e.options=e.options?Object.create(e.options):{}),s(e.options,t),this},t}(),Fo=function(t){function e(){return t.apply(this,arguments)||this}return K(e,t),e}(Do((function(){}))),No=new Fo,zo="dprchange",Bo="docvisibilitychange",Ho="dragstart",jo="dragend";if("undefined"!=typeof window&&window.matchMedia)for(var Uo=1;Uo<500;Uo++){var Go=(.01*Uo).toFixed(2),Vo=window.matchMedia("screen and (resolution: "+Go+"dppx)");Vo&&(Vo.addEventListener?Vo.addEventListener("change",Q.checkDevicePixelRatio):Vo.addListener&&Vo.addListener(Q.checkDevicePixelRatio))}if(Q.devicePixelRatio){var Wo=Q.devicePixelRatio;Object.defineProperty(Q,"devicePixelRatio",{get:function(){return Wo},set:function(t){t!==Wo&&(Wo=t,Q.monitorDPRChange&&No.fire(zo,{devicePixelRatio:t}))}})}Q.webgl&&"undefined"!=typeof document&&(Me(document,"visibilitychange",(function(){No.fire(Bo,{visibilityState:document.visibilityState})})),Me(document,"dragstart",(function(){No.fire(Ho)})),Me(document,"dragend",(function(){No.fire(jo)})));var qo={};function Zo(t){return function(t){function e(){return t.apply(this,arguments)||this}return K(e,t),e.registerJSONType=function(t){t&&(qo[t]?console.error(t+" has register. please use Different name for:",this):qo[t]=this)},e.getJSONClass=function(t){return t?qo[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in qo)if(qo[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered Layer/Geometry class!");return this._jsonType},e}(t)}function Qo(t){return function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},n.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var n=this._handlers.indexOf(e);n>=0&&this._handlers.splice(n,1),this[t].remove(),delete this[t]}return this},n._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)}var Xo="touchstart mousedown",Yo={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},Jo={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},Ko=function(t){function e(e,n={}){var i;return(i=t.call(this,null)||this).dom=e,i.options=n,i}K(e,t);var n=e.prototype;return n.addHooks=function(){},n.removeHooks=function(){},n.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},Ve(this.dom,Xo,this._onMouseDown,this),this):this},n.disable=function(){return this.dom?(this._offEvents(),We(this.dom,Xo,this._onMouseDown),delete this._onMouseDown,this):this},n.onMouseDown=function(t){if(this.options.rightclick||2!==t.button){var e=t;if(!(e.touches&&e.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(t))){var n=this.dom;n.setCapture?n.setCapture():window.captureEvents&&window.captureEvents(),n.ondragstart=function(){return!1},delete this.moved;var i=e.touches?e.touches[0]:t;this.startPos=new ht(i.clientX,i.clientY),We(document,Yo[t.type],this.onMouseMove),We(document,Jo[t.type],this.onMouseUp),Ve(document,Yo[t.type],this.onMouseMove,this),Ve(document,Jo[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||(We(this.dom,"mouseleave",this.onMouseUp),Ve(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:t,mousePos:new ht(i.clientX,i.clientY)})}}},n.onMouseMove=function(t){var e=t;if(e.touches&&e.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(t));else{var n=e.touches?e.touches[0]:t,i=new ht(n.clientX,n.clientY).sub(this.startPos);(i.x||i.y)&&(this.moved?this.fire("dragging",{domEvent:t,mousePos:new ht(n.clientX,n.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))}},n.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var n={domEvent:t};h(e.clientX)&&(n.mousePos=new ht(parseInt(e.clientX+"",0),parseInt(e.clientY+"",0))),this.moved&&(n.interupted=this.interupted,this.fire("dragend",n),delete this.interupted,delete this.moved),this.fire("mouseup",n)},n._offEvents=function(){var t=this.dom;if(We(t,"mouseleave",this.onMouseUp),"undefined"!=typeof document&&"undefined"!=typeof window){for(var e in Yo)We(document,Yo[e],this.onMouseMove),We(document,Jo[e],this.onMouseUp);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents()}},e}(ko),$o=function(t){function e(){return t.apply(this,arguments)||this}K(e,t),e.toNumberArrays=function(t){return Array.isArray(t)?mt(t,(function(t){return t.toArray()})):t.toArray()},e.toCoordinates=function(t){if(h(t[0])&&h(t[1]))return new e(t);if(t instanceof e)return t;for(var n=[],i=0,r=t.length;i<r;i++){var o=t[i];Array.isArray(o)?h(o[0])?n.push(new e(o)):n.push(e.toCoordinates(o)):n.push(o instanceof e?o:new e(o))}return n};var n=e.prototype;return n.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},n.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},n.round=function(){return new e(Math.round(this.x),Math.round(this.y))},n.ceil=function(){return new e(Math.ceil(this.x),Math.ceil(this.y))},n.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},n.copy=function(){return new e(this.x,this.y,this.z)},n.toFixed=function(t){return new e(this.x.toFixed(t),this.y.toFixed(t),h(this.z)?this.z.toFixed(t):void 0)},n.add=function(t,n,i){var r,o,s=this.z;return a(t.x)?a(t[0])?(r=this.x+t,o=this.y+n,a(i)||(s=(this.z||0)+i)):(r=this.x+t[0],o=this.y+t[1],a(t[2])||(s=(this.z||0)+t[2])):(r=this.x+t.x,o=this.y+t.y,a(t.z)||(s=(this.z||0)+t.z)),new e(r,o,s)},n.sub=function(t,n,i){var r,o,s=this.z;return a(t.x)?a(t[0])?(r=this.x-t,o=this.y-n,a(i)||(s=(this.z||0)-i)):(r=this.x-t[0],o=this.y-t[1],a(t[2])||(s=(this.z||0)-t[2])):(r=this.x-t.x,o=this.y-t.y,a(t.z)||(s=(this.z||0)-t.z)),new e(r,o,s)},n.multi=function(t){return new e(this.x*t,this.y*t,a(this.z)?this.z:this.z*t)},n.equals=function(t){return t instanceof this.constructor&&this.x===t.x&&this.y===t.y&&this.z===t.z},e}(at),ts=function(){function t(t,e){this.type=t,this.properties=e}return t.createProj4=function(e){return new t("proj4",{proj:e})},t.fromProjectionCode=function(e){return e&&t[e=e.toUpperCase().replace(":","")]||null},t}();ts.WGS84=ts.createProj4("+proj=longlat +datum=WGS84 +no_defs"),ts.EPSG3857=ts.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),ts.IDENTITY=ts.createProj4("+proj=identity +no_defs"),ts.CGCS2000=ts.createProj4("+proj=longlat +datum=CGCS2000"),ts.EPSG4490=ts.CGCS2000,ts.BD09LL=ts.createProj4("+proj=longlat +datum=BD09"),ts.GCJ02=ts.createProj4("+proj=longlat +datum=GCJ02");var es,ns=new ht(0,0),is=new $o(0,0),rs=new $o(0,0),os=new $o(0,0),ss=new $o(0,0),as=new $o(0,0),hs=new $o(0,0),ls=new $o(0,0),us=new $o(0,0),cs=[],As=[],fs=function(){function t(...t){this._clazz=$o;var e=t.length,n=e>0?t[e-1]:null;n&&n.unproject&&(this.projection=t[e-1]),this._dirty=!0,this.antiMeridian=!1,this._initialize(t[0],t[1],t[2],t[3])}var e=t.prototype;return e._initialize=function(t,e,n,i){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!a(t)){var r=this.projection;if(h(t)&&h(e)&&h(n)&&h(i))r?this.set(t,e,n,i):this.set(Math.min(t,n),Math.min(e,i),Math.max(t,n),Math.max(e,i));else if(Array.isArray(t))r?this.set(t[0],t[1],t[2],t[3]):this.set(Math.min(t[0],t[2]),Math.min(t[1],t[3]),Math.max(t[0],t[2]),Math.max(t[1],t[3]));else if(h(t.x)&&h(e.x)&&h(t.y)&&h(e.y)){var o=t,s=e;r?this.set(o.x,o.y,s.x,s.y):(o.x>s.x?(this.xmin=s.x,this.xmax=o.x):(this.xmin=o.x,this.xmax=s.x),o.y>s.y?(this.ymin=s.y,this.ymax=o.y):(this.ymin=o.y,this.ymax=s.y))}else h(t.xmin)&&h(t.xmax)&&h(t.ymin)&&h(t.ymax)&&this.set(t.xmin,t.ymin,t.xmax,t.ymax)}},e._add=function(t){return this._dirty=!0,a(t.x)?a(t.xmin)?a(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},e.add=function(t){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)._add(t)},e._scale=function(t){return this._dirty=!0,this.xmin*=t,this.ymin*=t,this.xmax*=t,this.ymax*=t,this},e._sub=function(t){return this._dirty=!0,a(t.x)?a(t.xmin)?a(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},e._substract=function(t){return this._sub(t)},e.sub=function(t){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)._sub(t)},e.substract=function(t){return this.sub(t)},e.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},e._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},e.getMin=function(t){return t?(t.set(this.xmin,this.ymin),t):new this._clazz(this.xmin,this.ymin)},e.getMax=function(t){return t?(t.set(this.xmax,this.ymax),t):new this._clazz(this.xmax,this.ymax)},e.getCenter=function(t){var e=(this.xmin+this.xmax)/2,n=(this.ymin+this.ymax)/2;return t?(t.set(e,n),t):new this._clazz(e,n)},e.isValid=function(){return!(a(this.xmin)||a(this.ymin)||a(this.xmax)||a(this.ymax))},e.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},e.intersects=function(t){this._project(this),this._project(t);var e=Math.max(this.pxmin,t.pxmin),n=Math.max(this.pymin,t.pymin),i=Math.min(this.pxmax,t.pxmax),r=Math.min(this.pymax,t.pymax);return!(e>i||n>r)},e.within=function(t){return this._project(this),this._project(t),this.pxmin>=t.pxmin&&this.pxmax<=t.pxmax&&this.pymin>=t.pymin&&this.pymax<=t.pymax},e.contains=function(t){if(!t)return!1;this._project(this);var e=this.projection;if(e){var n=is;Array.isArray(t)?(n.x=t[0],n.y=t[1],t=e.project(n,n)):void 0!==t.x?(n.x=t.x,n.y=t.y,t=e.project(n,n)):void 0!==t.xmin&&this._project(t)}return(t.x||t.pxmin||0)>=this.pxmin&&(t.x||t.pxmax||0)<=this.pxmax&&(t.y||t.pymin||0)>=this.pymin&&(t.y||t.pymax||0)<=this.pymax},e.getWidth=function(){return Math.abs(this.xmax-this.xmin)},e.getHeight=function(){return Math.abs(this.ymax-this.ymin)},e.getSize=function(){return new Jt(this.getWidth(),this.getHeight())},e.set=function(t,e,n,i){return this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i,this._dirty=!0,this},e.__combine=function(t){var e,n,i,r;void 0!==t.x&&(es.xmin=es.xmax=t.x,es.ymin=es.ymax=t.y,t=es),this._project(t),this._project(this),h(this.pxmin)?(e=Math.min(this.pxmin,t.pxmin),n=Math.min(this.pymin,t.pymin),i=Math.max(this.pxmax,t.pxmax),r=Math.max(this.pymax,t.pymax)):(e=t.pxmin,n=t.pymin,i=t.pxmax,r=t.pymax);var o=this.projection;if(o){rs.set(e,n),os.set(i,r);var s=o.unproject(rs,rs),a=o.unproject(os,os);e=s.x,n=s.y,i=a.x,r=a.y}return As[0]=e,As[1]=n,As[2]=i,As[3]=r,As},e._combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return this.set(e[0],e[1],e[2],e[3]),this._dirty=!0,this},e.combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},e.intersection=function(t){if(!this.intersects(t))return null;ss.x=Math.max(this.pxmin,t.pxmin),ss.y=Math.max(this.pymin,t.pymin),as.x=Math.min(this.pxmax,t.pxmax),as.y=Math.min(this.pymax,t.pymax);var e=ss,n=as,i=this.projection;return i&&(e=i.unproject(e,e),n=i.unproject(n,n)),new this.constructor(e,n,i)},e.expand=function(t){var e,n;return h(t)?e=n=t:(e=t.width||t.x||t[0]||0,n=t.height||t.y||t[1]||0),new this.constructor(this.xmin-e,this.ymin-n,this.xmax+e,this.ymax+n,this.projection)},e._expand=function(t){var e,n;return h(t)?e=n=t:(e=t.width||t.x||t[0]||0,n=t.height||t.y||t[1]||0),this.xmin-=e,this.ymin-=n,this.xmax+=e,this.ymax+=n,this._dirty=!0,this},e.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},e.toArray=function(t){var e=this.xmin,n=this.ymin,i=this.xmax,r=this.ymax;return t?(t[0].x=e,t[0].y=r,t[1].x=i,t[1].y=r,t[2].x=i,t[2].y=n,t[3].x=e,t[3].y=n,t[4].x=e,t[4].y=r,t):[new this._clazz([e,r]),new this._clazz([i,r]),new this._clazz([i,n]),new this._clazz([e,n]),new this._clazz([e,r])]},e.toString=function(){return this.xmin+","+this.ymin+","+this.xmax+","+this.ymax},e.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},e.convertTo=function(t,e){if(!this.isValid())return null;var n,i=e||new this.constructor;return e&&i.set(null,null,null,null),this._clazz===$o?n=hs:this._clazz===ht&&(n=ns),n.x=this.xmin,n.y=this.ymax,i._combine(t(n)),n.x=this.xmax,i._combine(t(n)),n.y=this.ymin,i._combine(t(n)),n.x=this.xmin,i._combine(t(n)),i},e._project=function(t){if(t&&t.isValid()){var e=this.projection;if(e){if(t._dirty){ls.set(t.xmin,t.ymin),us.set(t.xmax,t.ymax),cs[0]=ls,cs[1]=us;var n=e.projectCoords(cs,this.antiMeridian),i=n[0],r=n[1];t.pxmin=Math.min(i.x,r.x),t.pymin=Math.min(i.y,r.y),t.pxmax=Math.max(i.x,r.x),t.pymax=Math.max(i.y,r.y)}delete t._dirty}else t.pxmin=t.xmin,t.pxmax=t.xmax,t.pymin=t.ymin,t.pymax=t.ymax}else t&&(t.pxmin=t.pxmax=t.pymin=t.pymax=null)},t}();es=new fs(0,0,0,0);var ds,ps=function(t){function e(...e){var n;return(n=t.call(this,...e)||this)._clazz=ht,n}return K(e,t),e}(fs),gs=function(){function t(t){this.matrix=t}var e=t.prototype;return e.transform=function(t,e,n){var i=this.matrix[0]*(t.x-this.matrix[2])/e,r=-this.matrix[1]*(t.y-this.matrix[3])/e;return n?(n.x=i,n.y=r,n):new ht(i,r)},e.untransform=function(t,e,n){var i=t.x*e/this.matrix[0]+this.matrix[2],r=t.y*e/-this.matrix[1]+this.matrix[3];return n?(n.x=i,n.y=r,n):new $o(i,r)},t}(),ms={code:"",is:function(t){if(this.code===t)return!0;if(!this.aliases)return!1;for(var e=0;e<this.aliases.length;e++)if(this.aliases[e]===t)return!0;return!1},project:function(t){return t},unproject:function(t){return t},projectCoords:function(t,e){var n=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(0===t.length)return[];if(!this.isSphere())return mt(t,this.project,this);if(Array.isArray(t[0]))return t.map((function(t){return n.projectCoords(t,e)}));for(var i,r,o,s,a,h=e,l=this.getCircum(),u=this.getSphereExtent().sy,c=t[0],A=[this.project(c)],f=1,d=t.length;f<d;f++){o=(r=t[f]).x-c.x,s=r.y-c.y,a=this.project(r);var p=!1;Math.abs(o)>180&&h&&(r.x=o<0?360-Math.abs(r.x):-180-(180-Math.abs(r.x)),p=!0),Math.abs(s)>90&&h&&(void 0===i&&(i=r.y<c.y),i&&(a._add(0,-l.y*vt(s)*u),r._add(0,-180*vt(s)))),p&&(a=this.project(r)),c=r,A.push(a)}return A},unprojectCoords:function(t){return t?Array.isArray(t)?mt(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){return!!this.isSphere()&&!this.getSphereExtent().contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var e=this.getSphereExtent(),n=new $o(t);return e.contains(n)||(n.x=xt(t.x,e.xmin,e.xmax),n.y=xt(t.y,e.ymin,e.ymax)),n},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new $o(180,90)),e=this.project(new $o(-180,-90));this.extent=new fs(e,t,this),this.extent.sx=t.x>e.x?1:-1,this.extent.sy=t.y>e.y?1:-1}return this.extent}},ys={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var n=0,i=0,r=t.length;i<r-1;i++)n+=this.measureLenBetween(t[i],t[i+1]);return n}},vs=s({measure:"IDENTITY",measureLenBetween:function(t,e,n=!1){if(!t||!e)return 0;try{var i=Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2));if(n)return i;var r=(t.z||0)-(e.z||0);return 0===r?i:Math.sqrt(i*i+r*r)}catch(o){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,n=0,i=t.length;n<i;n++){var r=t[n],o=null;e+=r.x*(o=n===i-1?t[0]:t[n+1]).y-r.y*o.x}return Math.abs(e/2)},locate:function(t,e,n,i){return(i=i||new $o(0,0)).set(t.x,t.y),this._locate(i,e,n)},_locate:function(t,e,n){return t?(e||(e=0),n||(n=0),e||n?(t.x=t.x+e,t.y=t.y+n,t):t):null},rotate:function(t,e,n){return t=new $o(t.x,t.y),this._rotate(t,e,n)},_rotate:(ds=new ht(0,0),function(t,e,n){return ds.x=t.x-e.x,ds.y=t.y-e.y,ds._rotate(n*Math.PI/180),t.x=e.x+ds.x,t.y=e.y+ds.y,t})},ys),_s=function(){function t(t){this.radius=t}var e=t.prototype;return e.measureLenBetween=function(t,e,n=!1){if(!t||!e)return 0;var i=g(t.y),r=g(e.y),o=i-r,s=g(t.x)-g(e.x);if(i=2*Math.asin(Math.sqrt(Math.pow(Math.sin(o/2),2)+Math.cos(i)*Math.cos(r)*Math.pow(Math.sin(s/2),2))),i*=this.radius,n)return i;var a=(t.z||0)-(e.z||0);return 0===a?i:Math.sqrt(i*i+a*a)},e.measureArea=function(t){var e,n=g(this.radius),i=0,r=t,o=r.length;if(o<3)return 0;for(e=0;e<o-1;e++){var s=r[e],a=r[e+1];i+=s.x*n*Math.cos(g(s.y))*a.y*n-a.x*n*Math.cos(g(a.y))*s.y*n}var h=r[e],l=r[0];return i+=h.x*n*Math.cos(g(h.y))*l.y*n-l.x*n*Math.cos(g(l.y))*h.y*n,.5*Math.abs(i)},e.locate=function(t,e,n,i){return(i=i||new $o(0,0)).set(t.x,t.y),this._locate(i,e,n)},e._locate=function(t,e,n){if(!t)return null;if(e||(e=0),n||(n=0),!e&&!n)return t;var i,r,o=g(t.y);if(0!==n){var s=Math.abs(n);r=xt(180*(o+=2*Math.sin(s/(2*this.radius))*(n>0?1:-1))/Math.PI,-90,90)}else r=t.y;if(0!==e){var a=Math.abs(e),h=g(t.x);i=xt(180*(h+=2*Math.sqrt(Math.pow(Math.sin(a/(2*this.radius)),2)/Math.pow(Math.cos(o),2))*(e>0?1:-1))/Math.PI,-180,180)}else i=t.x;return t.x=i,t.y=r,t},e.rotate=function(t,e,n){var i=new $o(t);return this._rotate(i,e,n)},e._rotate=function(t,e,n){var i=function(t,e,n={}){var i;return(i=n.final?xs(e,t):xs(t,e))>180?-(360-i):i}(e,t)-n,r=this.measureLenBetween(e,t,!0);return t.x=e.x,t.y=e.y,function(t,e,n,i){var r=e/i,o=t.x*Math.PI/180,s=g(t.y),a=g(n),h=r*Math.cos(a),l=s+h;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);var u=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),c=Math.abs(u)>1e-11?h/u:Math.cos(s),A=r*Math.sin(a)/c;return t.x=(180*(o+A)/Math.PI+540)%360-180,t.y=180*l/Math.PI,t}(t,r,i,this.radius)},t}();function xs(t,e){var n=g(t.y),i=g(e.y),r=g(e.x-t.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(m(Math.atan2(r,o))+360)%360}var bs=s({measure:"EPSG:4326",sphere:new _s(6378137),measureLenBetween:function(t,e){return this.sphere.measureLenBetween(t,e)},measureArea:function(t){return this.sphere.measureArea.call(this.sphere,t)},_locate:function(t,e,n){return this.sphere._locate.call(this.sphere,t,e,n)},locate:function(t,e,n,i){return this.sphere.locate.call(this.sphere,t,e,n,i)},_rotate:function(t,e,n){return this.sphere._rotate.call(this.sphere,t,e,n)},rotate:function(t,e,n){return this.sphere.rotate.call(this.sphere,t,e,n)}},ys),ws=s({measure:"BAIDU",sphere:new _s(6370996.81),measureLenBetween:function(t,e){return this.sphere.measureLenBetween.call(this.sphere,t,e)},measureArea:function(t){return this.sphere.measureArea.call(this.sphere,t)},_locate:function(t,e,n){return this.sphere._locate.call(this.sphere,t,e,n)},locate:function(t,e,n,i){return this.sphere.locate.call(this.sphere,t,e,n,i)},_rotate:function(t,e,n){return this.sphere._rotate.call(this.sphere,t,e,n)},rotate:function(t,e,n){return this.sphere.rotate.call(this.sphere,t,e,n)}},ys),Cs=bs,Ps={};function Ms(t){Ps[t.measure]=t}Ms(vs),Ms(bs),Ms(ws);var Ts={getInstance:function(t){if(!t)return Cs;for(var e in Ps)if(d(Ps,e)){var n=Ps[e].measure;if(!n)continue;if(t.toLowerCase()===n.toLowerCase())return Ps[e]}return null}},Ss=Object.freeze({__proto__:null,BaiduSphere:ws,DEFAULT:Cs,Identity:vs,Measurer:Ts,WGS84Sphere:bs}),Is={code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t,e){var n=this.rad,i=this.metersPerDegree,r=this.maxLatitude,o=t.x,s=Math.max(Math.min(r,t.y),-r),a=o*i,h=(0===s?0:Math.log(Math.tan((90+s)*n/2))/n)*i;return e?(e.x=a,e.y=h,e):new $o(a,h)},unproject:function(t,e){var n,i=this.rad,r=this.metersPerDegree,o=t.x/r,s=t.y;0===s?n=0:(n=s/r,n=(2*Math.atan(Math.exp(n*i))-Math.PI/2)/i),Math.abs(Math.abs(o)-180)<1e-7&&(o=180*vt(o)),Math.abs(Math.abs(n)-this.maxLatitude)<1e-7&&(n=vt(n)*this.maxLatitude);var a=o,h=n;return e?(e.x=a,e.y=h,e):new $o(a,h)}},Es=s({},ms,Is,bs),Os=s({},ms,{code:"EPSG:4326",aliases:["EPSG:4490"],project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new $o(t)},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new $o(t)}},bs),Rs=Math.abs,Ds=Math.sin,ks=Math.cos,Ls=Math.tan,Fs=Math.atan,Ns=Math.atan2,zs=Math.sqrt,Bs=Math.log,Hs=Math.hypot,js=Math.sinh,Us=Math.cosh,Gs=1/0;function Vs(t){var e,n,i,r,o,s,a=[],h=[],l=[],u=[];function c(t,e){for(var n,i=2*ks(2*e),r=t.length-1,o=t[r],s=0;--r>=0;)n=i*o-s+t[r],s=o,o=n;return e+n*Ds(2*e)}function A(t,e,n){for(var i,r,o=Ds(e),s=ks(e),a=js(n),h=Us(n),l=2*s*h,u=-2*o*a,c=t.length-1,A=t[c],f=0,d=0,p=0;--c>=0;)i=d,r=f,A=l*(d=A)-i-u*(f=p)+t[c],p=u*d-r+l*f;return[(l=o*h)*A-(u=s*a)*p,l*p+u*A]}o=r=(i=t.es/(1+zs(1-t.es)))/(2-i),a[0]=r*(2+r*(-2/3+r*(r*(116/45+r*(26/45+r*(-2854/675)))-2))),h[0]=r*(r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))-2),a[1]=(o*=r)*(7/3+r*(r*(-227/45+r*(2704/315+r*(2323/945)))-1.6)),h[1]=o*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),a[2]=(o*=r)*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),h[2]=o*(-26/15+r*(34/21+r*(1.6+r*(-12686/2835)))),a[3]=(o*=r)*(4279/630+r*(-332/35+r*(-399572/14175))),h[3]=o*(1237/630+r*(r*(-24832/14175)-2.4)),a[4]=(o*=r)*(4174/315+r*(-144838/6237)),h[4]=o*(-734/315+r*(109598/31185)),a[5]=(o*=r)*(601676/22275),h[5]=o*(444337/155925),e=t.k0/(1+r)*(1+(o=r*r)*(1/4+o*(1/64+o/256))),l[0]=r*(r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))-.5),u[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),l[1]=o*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),u[1]=o*(13/48+r*(r*(557/1440+r*(281/630+r*(-1983433/1935360)))-.6)),l[2]=(o*=r)*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),u[2]=o*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),l[3]=(o*=r)*(-4397/161280+r*(11/504+r*(830251/7257600))),u[3]=o*(49561/161280+r*(-179/168+r*(6601661/7257600))),l[4]=(o*=r)*(-4583/161280+r*(108847/3991680)),u[4]=o*(34729/80640+r*(-3418889/1995840)),l[5]=(o*=r)*(-20648693/638668800),u[5]=.6650675310896665*o,s=c(h,t.phi0),n=-e*(s+function(t,e){for(var n,i=2*ks(e),r=t.length-1,o=t[r],s=0;--r>=0;)n=i*o-s+t[r],s=o,o=n;return Ds(e)*n}(u,2*s)),t.fwd=function(t,i){var r,o,s,a,l,f,d,p,g,m,y=t.phi,v=t.lam;y=c(h,y),r=Ds(y),o=ks(y),a=Ds(v),s=ks(v),y=Ns(r,s*o),v=Ns(a*o,Hs(r,o*s)),f=Ls(v),m=Rs(f),d=m*(1+m/(Hs(1,m)+1)),m=0==(g=(p=1+d)-1)?d:d*Bs(p)/g,y+=(l=A(u,2*y,2*(v=f<0?-m:m)))[0],v+=l[1],Rs(v)<=2.623395162778?(i.y=e*y+n,i.x=e*v):i.x=i.y=Gs},t.inv=function(t,i){var r,o,s,h,u,f=t.y,d=t.x;f=(f-n)/e,Rs(d/=e)<=2.623395162778?(f+=(u=A(l,2*f,2*d))[0],d=Fs(js(d+=u[1])),r=Ds(f),o=ks(f),h=Ds(d),s=ks(d),d=Ns(h,s*o),f=Ns(r*s,Hs(h,s*o)),i.phi=c(a,f),i.lam=d):i.phi=i.lam=Gs}}var Ws=57.29577951308232,qs=.017453292519943295,Zs=["Traverse_Mercator"],Qs={code:"EPSG:9807",aliases:Zs,centralMeridian:0,create:function(t){var e={a:6378137,es:.0066943799901413165,x0:a(t.falseEasting)?5e5:t.falseEasting,y0:a(t.falseNorthing)?0:t.falseNorthing,k0:t.scaleFactor||.9996,lam0:(t.centralMeridian||0)*qs,phi0:(t.latitudeOfOrigin||0)*qs,originLam0:t.startLongtitude||0,originPhi0:t.startLatitude||0};Vs(e);var n={lam:0,phi:0},i={},r=0,o=0;(e.originLam0||e.originPhi0)&&(n.lam=e.originLam0*qs-e.lam0,n.phi=e.originPhi0*qs,e.fwd(n,i),r=e.a*i.x+e.x0,o=e.a*i.y+e.y0);var h={code:"EPSG:9807",aliases:Zs,centralMeridian:t.centralMeridian,project:function(t,s){n.lam=t.x*qs-e.lam0,n.phi=t.y*qs,e.fwd(n,i);var a=e.a*i.x+e.x0-r,h=e.a*i.y+e.y0-o;return s?(s.x=a,s.y=h,s):new $o(a,h)},unproject:function(t,s){i.x=(t.x-e.x0+r)/e.a,i.y=(t.y-e.y0+o)/e.a,e.inv(i,n);var a=(n.lam+e.lam0)*Ws,h=n.phi*Ws;return s?(s.x=a,s.y=h,s):new $o(a,h)}};return s({},ms,h,bs)}},Xs=s({},ms,Qs),Ys={code:"utm",aliases:[],create:function(t){var e={},n=parseInt(t.zone);if(e.falseNorthing=t.south?1e7:0,e.falseEasting=5e5,!(n>0&&n<=60))throw new Error("zone must be > 0 and <= 60.");return n--,e.centralMeridian=6*(n+.5)-180,e.scaleFactor=.9996,Xs.create(e)}},Js=s({},Xs,Ys),Ks=s({},ms,{code:"BAIDU",project:function(t,e){return this.convertLL2MC(t,e)},unproject:function(t,e){return this.convertMC2LL(t,e)}},ws,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t,e){for(var n,i=0,r=this.MCBAND.length;i<r;i++)if(Math.abs(t.y)>=this.MCBAND[i]){n=this.MC2LL[i];break}return this.convertor(t,n,e)},convertLL2MC:function(t,e){var n,i,r;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var o=new $o(t.x,t.y);for(i=0,r=this.LLBAND.length;i<r;i++)if(o.y>=this.LLBAND[i]){n=this.LL2MC[i];break}if(!n)for(i=this.LLBAND.length-1;i>=0;i--)if(o.y<=-this.LLBAND[i]){n=this.LL2MC[i];break}return this.convertor(t,n,e)},convertor:function(t,e,n){if(!t||!e)return null;var i=e[0]+e[1]*Math.abs(t.x),r=Math.abs(t.y)/e[9],o=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return i*=t.x<0?-1:1,o*=t.y<0?-1:1,n?(n.x=i,n.y=o,n):new $o(i,o)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,n){return null!=e&&(t=Math.max(t,e)),null!=n&&(t=Math.min(t,n)),t},getLoop:function(t,e,n){if(t===1/0)return n;if(t===-1/0)return e;for(;t>n;)t-=n-e;for(;t<e;)t+=n-e;return t}}),$s=s({},ms,{code:"IDENTITY",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()}},vs),ta=Es,ea=Object.freeze({__proto__:null,BAIDU:Ks,Common:ms,DEFAULT:ta,EPSG3857:Es,EPSG4326:Os,EPSG9807:Xs,IDENTITY:$s,UTM:Js});function na(t){return function(t){function e(){return t.apply(this,arguments)||this}return K(e,t),e.registerRenderer=function(t,e){var n=this.prototype,i=Object.getPrototypeOf(n);return n._rendererClasses&&n._rendererClasses!==i._rendererClasses||(n._rendererClasses=n._rendererClasses?Object.create(n._rendererClasses):{}),n._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)}var ia="check_browser_max_fps";cr(ia,(function(){return"function (exports) {\n    exports.initialize = function () {};\n    function now(){\n        return  new Date().getTime();\n    }\n    function checkFPS(cb) {\n        if (!requestAnimationFrame) {\n            cb(-1);\n            return;\n        }\n        const count = 100;\n        let idx = 0;\n        let id;\n        let startTime;\n        function loop() {\n            idx++;\n            if (idx === count) {\n                cancelAnimationFrame(id);\n                const endTime = now();\n                const timePerFPS = (endTime - startTime) / count;\n                const fps = Math.floor(1000 / timePerFPS);\n                cb(fps);\n            } else {\n                id = requestAnimationFrame(loop);\n            }\n        }\n        startTime = now();\n        id = requestAnimationFrame(loop);\n    }\n    //recive message\n    exports.onmessage = function (msg, postResponse) {\n        checkFPS((fps) => {\n            if (fps < -1) {\n                postResponse('check fps fail');\n            } else {\n                postResponse(null, { fps });\n            }\n        })\n    }\n}"}));var ra,oa=0,sa=[],aa=function(){function t(t){var e=this;Or(),this._delayMessages=[],this.initializing=!1;var n=hr(t);sr&&!n&&(this.initializing=!0,gr(t,(function(){e.initializing=!1,e.created()}))),this.workerKey=t,this.workerPool=br(),this.currentActor=0,this.actorId=At(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach((function(t){t.addEventListener("message",e.receiveFn,!1)})),lr(t)}var e=t.prototype;return e.created=function(){var t=this;this._delayMessages.forEach((function(e){var{command:n,data:i,buffers:r,cb:o,workerId:s}=e;t[n](i,r,o,s)})),this._delayMessages=[]},e.isActive=function(){return!!this.workers},e.broadcast=function(t,e,n){var i=this;return this.initializing?(this._delayMessages.push({command:"broadcast",data:t,buffers:e,cb:n}),this):(function(t,e,n){t.length||n(null,[]);var i=t.length,r=new Array(t.length),o=null;t.forEach((function(t,s){e(t,(function(t,e){t&&(o=t),r[s]=e,0==--i&&n(o,r)}))}))}(this.workers,(function(n,r){i.send(t,e,r,n.id)}),n=n||function(){}),this)},e.send=function(t,e,n,i){if(this.initializing)return this._delayMessages.push({command:"send",data:t,buffers:e,cb:n,workerId:i}),this;var r=n?this.actorId+":"+this.callbackID++:null;return n&&(this.callbacks[r]=n),this.post({data:t,callback:String(r)},e,i),this},e.receive=function(t){var e=this,n=t.data,i=n.callback,r=this.callbacks[i];delete this.callbacks[i],"<request>"===n.type?this.actorId===n.actorId&&this[n.command](n.params,(function(t,i,r){var o={type:"<response>",callback:n.callback};t?o.error=t.message:o.data=i,e.post(o,r||sa,n.workerId)})):r&&n.error?r(n.error):r&&r(null,n.data)},e.remove=function(){var t=this;this.workers.forEach((function(e){e.removeEventListener("message",t.receiveFn,!1)})),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},e.post=function(t,e,n){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),t.workerId=n,t.workerKey=this.workerKey,t.actorId=this.actorId,this.workerPool.addMessage(n,t,e||sa),n},e.getDedicatedWorker=function(){return oa=(oa+1)%this.workerPool.workerCount},t}(),ha=function(t){function e(){return t.call(this,ia)||this}return K(e,t),e}(aa),la=!1;Rr((function(){var t;la||r.maxFPS<=0&&(la=!0,t=function(t){h(t)&&t>0&&r.maxFPS<=0&&(r.maxFPS=t),la=!1},ra||(ra=new ha),ra.send({},[],(function(e,n){e?(console.error(e),t()):t(n.fps)})))}));var ua=[],ca=function(t){function e(){return t.call(this,or)||this}return K(e,t),e.prototype.fetchImage=function(t,e){this.send({url:t},ua,e)},e}(aa),Aa=function(t){function e(e){var n;return(n=t.call(this)||this).layer=e,n._painted=!1,n._drawTime=0,!Q.decodeImageInWorker||Q.safari||Q.iosWeixin||(n._resWorkerConn=new ca),n.setToRedraw(),n}K(e,t);var i=e.prototype;return i.render=function(t){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new fa),this.checkAndDraw(this._tryToDraw,t),this._frameTime=t)},i.getFrameTimestamp=function(){return this._frameTime||0},i.checkAndDraw=function(t,...e){var n=this;if(this._toRedraw=!1,this.checkResources){var i=this.checkResources();i.length>0?(this._loadingResource=!0,this.loadResources(i).then((function(){if(n._loadingResource=!1,n.layer){n.layer.fire("resourceload");var t=n.layer.getMap();n.setToRedraw(),t.getRenderer().callInNextFrame((function(){n.setToRedraw()}))}}))):t.call(this,...e)}else t.call(this,...e)},i.testIfNeedRedraw=function(){var t=this.getMap();return!(this._loadingResource||!this._toRedraw&&(t.isInteracting()&&!this.drawOnInteracting||!this.needToRedraw()))},i.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()&&!t.getRenderer().isViewChanged()||!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving)},i.onSkipDrawOnInteracting=function(){},i.isLoadingResource=function(){return this._loadingResource},i.isRenderComplete=function(){return!!this._renderComplete},i.mustRenderOnInteracting=function(){return!this._painted},i.setToRedraw=function(){return this._toRedraw=!0,this},i.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},i.isCanvasUpdated=function(){return!!this._canvasUpdated},i.remove=function(){this.onRemove(),delete this._loadingResource,delete this.middleWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,this._resWorkerConn&&(this._resWorkerConn.remove(),delete this._resWorkerConn),delete this.layer},i.onRemove=function(){},i.onAdd=function(){},i.getMap=function(){return this.layer?this.layer.getMap():null},i.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.middleWest)._add(0,-t.height/2);return{image:this.canvas,layer:this.layer,point:e}},i.clear=function(){this.clearCanvas()},i.isBlank=function(){return!this._painted},i.show=function(){this.setToRedraw()},i.hide=function(){this.clear(),this.setToRedraw()},i.setZIndex=function(t){this.setToRedraw()},i.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var e=this.getMap(),n=e.getDevicePixelRatio(),i=e.getSize();if(t.x<0||t.x>i.width*n||t.y<0||t.y>i.height*n)return!1;var r=this.getImageData&&this.getImageData();if(r){var o=Math.round(n*t.x),s=Math.round(n*t.y);return r.data[s*r.width*4+4*o+3]>0}try{if(this.context.getImageData(n*t.x,n*t.y,1,1).data[3]>0)return!0}catch(a){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",a),this._errorThrown=!0),!1}return!1},i.loadResources=function(t){this.resources||(this.resources=new fa);var e=this.resources,n=[];if(wt(t))for(var i={},r=t.length-1;r>=0;r--){var o=t[r];o&&o.length&&!i[o.join("-")]&&(i[o.join("-")]=1,e.isResourceLoaded(o,!0)||n.push(new Promise(this._promiseResource(o))))}return Promise.all(n)},i.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t.get2DExtent(),this.middleWest=t._containerPointToPoint(new ht(0,t.height/2))},i.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),n=t.getDevicePixelRatio(),i=Math.round(n*e.width),r=Math.round(n*e.height);if(this.layer._canvas){var o=this.layer._canvas;o.width=i,o.height=r,o.style&&(o.style.width=e.width+"px",o.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=Mo.createCanvas(i,r,t.CanvasClass);this.onCanvasCreate()}},i.onCanvasCreate=function(){},i._canvasContextScale=function(t,e){return t.scale(e,e),t.dpr=e,this},i.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=Mo.getCanvas2DContext(this.canvas),this.context)){this.context.dpr=1,this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();1!==t&&this._canvasContextScale(this.context,t)}},i.resetCanvasTransform=function(){if(this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},i.resizeCanvas=function(t){var e=this.canvas;if(e){var n=t||this.getMap().getSize(),i=this.getMap().getDevicePixelRatio(),{width:r,height:o,cssWidth:s,cssHeight:a}=Ut(n,i);!this.layer._canvas||e.style.width===s&&e.style.height===a||(e.style.width=s,e.style.height=a),e.width===r&&e.height===o||(e.height=o,e.width=r,this.context&&(this.context.dpr=1),1!==i&&this.context&&this._canvasContextScale(this.context,i))}},i.clearCanvas=function(){if(this.context&&this.getMap()){var t=1/this.getMap().getDevicePixelRatio(),e=this.canvas.height*t;Mo.clearRect(this.context,0,0,Math.max(this.canvas.width*t,this.canvas.width),Math.max(e,this.canvas.height))}},i.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getMaskPainter().get2DExtent();return e&&this._extent2D&&e.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e},i.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;if(!this.layer.options.maskClip)return!1;var n=this.middleWest,i=this.getMap();this.middleWest=i._containerPointToPoint(new ht(0,i.height/2)),t.save();var r=i.getDevicePixelRatio();if(1!==r&&(t.save(),this._canvasContextScale(t,r)),e.getGeometries){t.isMultiClip=!0;var o=e.getGeometries()||[];t.beginPath(),o.forEach((function(e){e._getMaskPainter().paint(null,t)})),t.stroke(),t.isMultiClip=!1}else t.isClip=!0,t.beginPath(),e._getMaskPainter().paint(null,t),t.isClip=!1;1!==r&&t.restore();try{t.clip("evenodd")}catch(s){console.error(s)}return this.middleWest=n,!0},i.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,middleWest:this.middleWest}},i.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},i.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},i.onZoomStart=function(t){},i.onZoomEnd=function(t){this.setToRedraw()},i.onZooming=function(t){},i.onMoveStart=function(t){},i.onMoving=function(t){},i.onMoveEnd=function(t){this.setToRedraw()},i.onResize=function(t){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},i.onDragRotateStart=function(t){},i.onDragRotating=function(t){},i.onDragRotateEnd=function(t){this.setToRedraw()},i.onSpatialReferenceChange=function(t){},i.getDrawTime=function(){return this._drawTime},i._tryToDraw=function(t){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(t)},i._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var n=o();this.draw(t),n=o()-n,this._drawTime=e?n:n/2,e&&this.layer&&this.layer.options.logDrawTime&&(this.layer.getId(),this._drawTime)}},i._promiseResource=function(t){var e=this,i=this.layer,r=this.resources,o=i.options.crossOrigin,s=i.options.renderer||"";return function(h){if(r.isResourceLoaded(t,!0))h(t);else{var l=tn(t[0]);if(Xn(l))createImageBitmap(l).then((function(n){e._cacheResource(t,n),h(t)})).catch((function(e){console.error(e),h(t)}));else if(lt(t[0])||!e._resWorkerConn||"canvas"===i.options.renderer&&!i.options.decodeImageInWorker){var u=new Image;a(o)?"canvas"!==s&&(u.crossOrigin=""):u.crossOrigin=o,lt(t[0])&&!n&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),u.onload=function(){e._cacheResource(t,u),h(t)},u.onabort=function(e){console&&console.warn("image loading aborted: "+t[0]),e&&console&&console.warn(e),h(t)},u.onerror=function(e){e&&"undefined"!=typeof console&&console.warn(e),r.markErrorResource(t),h(t)},ut(u,[l])}else e._resWorkerConn.fetchImage(l,(function(n,i){if(n)return n&&"undefined"!=typeof console&&console.warn(n),void h(t);Bt(i,(function(n){e._cacheResource(t,n),h(t)}))}))}}},i._cacheResource=function(t,e){if(this.layer&&this.resources){var n=t[1],i=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===lt(t[0])&&(Q.edge||Q.ie)){a(n)&&(n=e.width||this.layer.options.defaultIconSize[0]),a(i)&&(i=e.height||this.layer.options.defaultIconSize[1]);var r=Mo.createCanvas(n,i);Mo.image(r.getContext("2d"),e,0,0,n,i),e=r}this.resources.addResource(t,e)}},e}(Lo),fa=function(){function t(){this.resources={},this._errors={}}var e=t.prototype;return e.addResource=function(t,e){var n=this;if(this.resources[t[0]]={image:e,width:+t[1],height:+t[2],refCnt:0},e&&e.width&&e.height&&!e.close&&Q.imageBitMap&&!Q.safari&&!Q.iosWeixin){if(e.src&&lt(e.src))return;createImageBitmap(e).then((function(e){n.resources[t[0]]&&(n.resources[t[0]].image=e)}))}},e.isResourceLoaded=function(t,e){if(!t)return!1;var n=this._getImgUrl(t);if(this._errors[n])return!0;var i=this.resources[n];return!(!i||e&&lt(t[0])&&(+t[1]>i.width||+t[2]>i.height))},e.login=function(t){var e=this.resources[t];e&&e.refCnt++},e.logout=function(t){var e=this.resources[t];e&&e.refCnt--<=0&&(e.image&&e.image.close&&e.image.close(),delete this.resources[t])},e.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},e.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},e.merge=function(t){if(!t)return this;for(var e in t.resources){var n=t.resources[e];this.addResource([e,n.width,n.height],n.image)}return this},e.forEach=function(t){if(!this.resources)return this;for(var e in this.resources)d(this.resources,e)&&t(e,this.resources[e]);return this},e._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},e.remove=function(){for(var t in this.resources){var e=this.resources[t];e&&e.image&&e.image.close&&e.image.close()}this.resources={}},t}();Q.decodeImageInWorker&&cr(or,(function(){return"\nfunction (exports) {\n    exports.onmessage = function (msg, postResponse) {\n        var url = msg.data.url;\n        var fetchOptions = msg.data.fetchOptions;\n        requestImageOffscreen(url, function (err, data) {\n            var buffers = [];\n            if (data && data.data) {\n                buffers.push(data.data);\n            }\n            postResponse(err, data, buffers);\n        }, fetchOptions);\n    };\n\n    function requestImageOffscreen(url, cb, fetchOptions) {\n        fetch(url, fetchOptions ? fetchOptions : {})\n            .then(response => response.arrayBuffer())\n            .then(arrayBuffer => {\n                const blob=new Blob([arrayBuffer]);\n                return createImageBitmap(blob);\n            })\n            .then(bitmap => {\n                cb(null, {data:bitmap});\n            }).catch(err => {\n                console.warn('error when loading tile:', url);\n                console.warn(err);\n                cb(err);\n            });\n    }\n}"}));var da={markerWidth:10,markerHeight:10,markerLineWidth:1},pa=new ht(0,0);function ga(t,e,n,i,r,o){var s=r.x+o.x,a=r.y+o.y;pa.x=s,pa.y=a;var h=function(t){if(!t)return 0;var{x:e,y:n}=t;if(0===e&&0===n)return 0;if(0===e||!e){if(n<0)return-Math.PI/2;if(n>0)return Math.PI/2}var i=n/e;return n<0&&e<0?Math.atan(i)-Math.PI:n>0&&e<0?Math.atan(i)+Math.PI:Math.atan(i)}(pa),l=Math.sqrt(s*s+a*a),u=0,c=0;u+=Math.cos(e+h)*l,c+=Math.sin(e+h)*l;var A,f,d,p,g,m,y,v,_,x,b,w,C,P,M,T,S,[I,E,O,R]=(A=n,f=i,d=e,p=Math.PI/2+d,g=Math.PI/4+d,m=d,y=f,v=Math.sqrt(A*A+f*f),_=A,x=Math.cos(p)*y,b=Math.sin(p)*y,w=Math.cos(g)*v,C=Math.sin(g)*v,P=Math.cos(m)*_,M=Math.sin(m)*_,T=Math.min(x,w,P,0),S=Math.min(b,C,M,0),[T,S,Math.max(x,w,P,0)-T,Math.max(b,C,M,0)-S]);c+=E;var D=(u+=I)+Math.max(n,O),k=c+Math.max(i,R);return t.set(u,c,D,k),t}var ma=new ht(0,0);function ya(t,e,n,i,r,o,s){var a=ma.set(e,n);if(i)return ga(t,i,o,s,a,r);var h=t.set(a.x,a.y,a.x+o,a.y+s);return h._add(r),i&&function(t,e){var{xmin:n,ymin:i,xmax:r,ymax:o}=t;Ma.set(n,i,r,o),Ma.convertTo((function(t){return t._rotate(e)}),t)}(h,i),h}var va=[];function _a(t,e,n){if((n=n||Pa(va,e))&&(0===n[0]||0===n[1]))return Ba(t),t;var i=Ca(e,n[0],n[1]);return ya(t,e.markerDx||0,e.markerDy||0,Ta(e),i,n[0],n[1])}function xa(t){return"rectangle"===t?"right":"middle"}function ba(t){return"bar"===t||"pie"===t||"pin"===t?"top":"rectangle"===t?"bottom":"middle"}var wa=new Jt(0,0);function Ca(t,e,n){var i=2*(t.shadowBlur||0)+.5;wa.width=e,wa.height=n;var r=t.markerType,o=ce(wa,t.markerHorizontalAlignment||xa(r),t.markerVerticalAlignment||ba(r));return o.x!==-e/2&&(o.x-=vt(o.x+e/2)*i),o.y!==-n/2&&(o.y-=vt(o.y+n/2)*i),o}function Pa(t,e){var n=yt(e.markerWidth,da.markerWidth),i=yt(e.markerHeight,da.markerHeight);if(0===n||0===i)return t[0]=0,t[1]=0,t;var r=yt(e.markerLineWidth,da.markerLineWidth),o=2*((e.shadowBlur||0)+Math.max(Math.abs(e.shadowOffsetX||0)+Math.abs(e.shadowOffsetY||0))),s=Math.round(n+r+o+1),a=Math.round(i+r+o+1);return t[0]=s,t[1]=a,t}var Ma=new ps;function Ta(t,e="markerRotation"){var n=t[e];return h(n)?-n*Math.PI/180:0}function Sa(t,e,n){var i=n?n.getImage(e.markerFile):null,r=e.markerWidth||(i?i.width:0),o=e.markerHeight||(i?i.height:0);if(wa.width=r,wa.height=o,0===e.markerWidth||0===e.markerHeight)return Ba(t),t;var s=ce(wa,e.markerHorizontalAlignment||"middle",e.markerVerticalAlignment||"top");return ya(t,e.markerDx||0,e.markerDy||0,Ta(e),s,r,o)}function Ia(t,e,n){var i=n.size;if(i&&(0===i.width||0===i.height))return Ba(t),t;var r=ce(i,e.textHorizontalAlignment,e.textVerticalAlignment),o=e.textHaloRadius||0,s=ya(t,e.textDx||0,e.textDy||0,Ta(e,"textRotation"),r,i.width,i.height);return s.xmin-=o,s.xmax+=o,s.ymin-=o,s.ymax+=o,s}var Ea=new ps;function Oa(t,e,n,i){var r=t||new ps;if(Array.isArray(e)){for(var o=e,s=0;s<o.length;s++)Oa(r,o[s],n,i[s]);return r}return Ra(e)&&r._combine(Ia(Ea,e,i)),Da(e)&&r._combine(Sa(Ea,e,n)),ka(e)&&r._combine(_a(Ea,e)),La(e)&&r._combine(Sa(Ea,e)),r}function Ra(t){return!!t&&!a(t.textName)}function Da(t){return!!t&&!a(t.markerFile)}function ka(t){return!!t&&!(!a(t.markerFile)||a(t.markerType)||"path"===t.markerType)}function La(t){return!!t&&!(!a(t.markerFile)||"path"!==t.markerType)}var Fa,Na=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","markerRotation","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation","textWrapWidth"],za=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY","textWrapWidth"];function Ba(t){t&&(t.xmin=1/0,t.ymin=1/0,t.xmax=-1/0,t.ymax=-1/0)}function Ha(t,e,n,i){for(var r,o=[],s=0,a=0,h=t.length;a<h-1;a++)(r=ja(t[a],t[a+1],e,a,n,i))&&(o[s]=o[s]||[],o[s].push({point:r[0],index:a}),r[1]===t[a+1]&&a!==h-2||(o[s].push({point:r[1],index:a+1}),s++));return o}function ja(t,e,n,i,r,o){var s,a,h,l=i?Fa:Va(t,n),u=Va(e,n);for(Fa=u;;){if(!(l|u))return[t,e];if(l&u)return!1;if(o)return[t,e];h=Va(a=Ga(t,e,s=l||u,n,r),n),s===l?(t=a,l=h):(e=a,u=h)}}function Ua(t,e,n){var i,r,o,s,a,h,l,u,c,A=[1,4,2,8];for(r=0,l=t.length;r<l;r++)t[r]._code=Va(t[r],e);for(s=0;s<4;s++){for(u=A[s],i=[],r=0,o=(l=t.length)-1;r<l;o=r++)h=t[o],(a=t[r])._code&u?h._code&u||((c=Ga(h,a,u,e,n))._code=Va(c,e),i.push(c)):(h._code&u&&((c=Ga(h,a,u,e,n))._code=Va(c,e),i.push(c)),i.push(a));t=i}return t}function Ga(t,e,n,i,r){var o,s,a=e.x-t.x,h=e.y-t.y,l=i.getMin(),u=i.getMax();8&n?(o=t.x+a*(u.y-t.y)/h,s=u.y):4&n?(o=t.x+a*(l.y-t.y)/h,s=l.y):2&n?(o=u.x,s=t.y+h*(u.x-t.x)/a):1&n&&(o=l.x,s=t.y+h*(l.x-t.x)/a);var c=new ht(o,s);return r&&c._round(),c}function Va(t,e){var n=0;return t.x<e.getMin().x?n|=1:t.x>e.getMax().x&&(n|=2),t.y<e.getMin().y?n|=4:t.y>e.getMax().y&&(n|=8),n}function Wa(t,e,n,i){t=new ht(t);var r,o,s,a=Math.abs(n.x-e.x),h=Math.abs(n.y-e.y),l=Math.sqrt(Math.abs(a*a-h*h));return a>=h?(r=new ht(e.x-l,e.y),o=new ht(e.x+l,e.y),s=2*a):(r=new ht(e.x,e.y-l),o=new ht(e.x,e.y+l),s=2*h),t.distanceTo(r)+t.distanceTo(o)<=s+2*i}function qa(t){if(!t)return[0,0];var e=1/0,n=-1/0;if(h(t))return[e=n=t,n];var i=function(t){for(var i=0,r=t.length;i<r;i++){var o=t[i];e=Math.min(e,o),n=Math.max(n,o)}};if(!Array.isArray(t[0]))return i(t),[e,n];for(var r=0,o=t.length;r<o;r++)i(t[r]);return[e,n]}var Za=function(){function t(){this.bbox=Ti()}var e=t.prototype;return e._setBBOX=function(t,e,n,i,r){return t.isHitTesting||Oi(this.bbox,e,n,i,r),this},e._bufferBBOX=function(t,e){return t.isHitTesting||Di(this.bbox,e),this},e.getMap=function(){return this.geometry.getMap()},e.getPainter=function(){return this.painter},e.isDynamicSize=function(){return!1},e.isVisible=function(){if(!this.style)return!0;var t=this.style.visible;return!1!==t&&0!==t&&!(this.style.opacity<=0)},t.testColor=function(t){return!(!t||!c(t))&&Xt.indexOf(t)>=0},t}(),Qa=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n._prepareContext=function(t){if(_n(this.symbol.opacity)?this._opacityFn||(this._opacityFn=bn(this.symbol.opacity)):delete this._opacityFn,h(this.symbol.opacity))t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var e=this.getMap();t.globalAlpha=this._opacityFn(e.getZoom())}else 1!==t.globalAlpha&&(t.globalAlpha=1)},n.prepareCanvas=function(t,e,n){t.setLineDash&&wt(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var i=this.getPainter().isHitTesting();Mo.prepareCanvas(t,e,n,i)},n.remove=function(){},n.setZIndex=function(){},n.show=function(){},n.hide=function(){},n._defineStyle=function(t){return this.symbol&&(t.visible=this.symbol.visible,t.opacity=this.symbol.opacity),Un(t,this.geometry)},e}(Za);function Xa(t,e,n,i){var r,o,s,a,h,l=Ya(n),u=n,c=u.markerType.toLowerCase(),A=Ja(c,u.markerWidth,u.markerHeight),f=l.lineOpacity,d=l.polygonOpacity;Yn(l.polygonFill)&&Yn(l.polygonFill)&&(r||(o=e,s=u.markerWidth,a=u.markerHeight,(h=new ps)._combine(o),h.xmin+=-s/2,h.ymin+=-a/2,h.xmax+=s/2,h.ymax+=a/2,r=h),l.polygonGradientExtent=r),Mo.prepareCanvas(t,l,i);var p=u.markerWidth,g=u.markerHeight,m=u.markerLineWidth/2;if("ellipse"===c)Mo.ellipse(t,e,p/2,g/2,g/2,f,d);else if("cross"===c||"x"===c){for(var y=A.length-1;y>=0;y--)A[y]._add(e);Mo.path(t,A.slice(0,2),f),Mo.path(t,A.slice(2,4),f)}else if("diamond"===c||"bar"===c||"square"===c||"rectangle"===c||"triangle"===c){"bar"===c?e=e.add(0,-m):"rectangle"===c&&(e=e.add(m,m));for(var v=A.length-1;v>=0;v--)A[v]._add(e);Mo.polygon(t,A,f,d)}else if("pin"===c){e=e.add(0,-m);for(var _=A.length-1;_>=0;_--)A[_]._add(e);var x=t.lineCap;t.lineCap="round",Mo.bezierCurveAndFill(t,A,f,d),t.lineCap=x}else{if("pie"!==c)throw new Error("unsupported markerType: "+c);e=e.add(0,-m);var b=180*Math.atan(p/2/g)/Math.PI,w=t.lineCap;t.lineCap="round",Mo.sector(t,e,g,[90-b,90+b],f,d),t.lineCap=w}return t.canvas}function Ya(t){var e={lineColor:t.markerLineColor,linePatternFile:t.markerLinePatternFile,lineWidth:t.markerLineWidth,lineOpacity:t.markerLineOpacity,lineDasharray:t.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:t.markerFill,polygonPatternFile:t.markerFillPatternFile,polygonOpacity:t.markerFillOpacity};return 0===e.lineWidth&&(e.lineOpacity=0),e}function Ja(t,e,n){var i,r,o,s,a=n/2,h=e/2;if("triangle"===t)return[i=new ht(0,0-a),r=new ht(0-h,0+a),o=new ht(0+h,0+a)];if("cross"===t)return[i=new ht(0-h,0),r=new ht(0+h,0),o=new ht(0,0-a),s=new ht(0,0+a)];if("diamond"===t)return[i=new ht(0-h,0),r=new ht(0,0-a),o=new ht(0+h,0),s=new ht(0,0+a)];if("square"===t)return[i=new ht(0-h,0+a),r=new ht(0+h,0+a),o=new ht(0+h,0-a),s=new ht(0-h,0-a)];if("rectangle"===t)return r=(i=new ht(0,0)).add(e,0),o=i.add(e,n),s=i.add(0,n),[i,r,o,s];if("x"===t)return[i=new ht(0-h,0+a),r=new ht(0+h,0-a),o=new ht(0+h,0+a),s=new ht(0-h,0-a)];if("bar"===t)return[i=new ht(0-h,0-n),r=new ht(0+h,0-n),o=new ht(0+h,0),s=new ht(0-h,0)];if("pin"===t||"pie"===t){var l=n*Math.atan(h/a);return[i=new ht(0,0),r=new ht(0-l,0-n),o=new ht(0+l,0-n),s=new ht(0,0)]}return[]}var Ka=new ht(0,0),$a=new ht(0,0),th=new ht(0,0),eh=new ht(0,0),nh=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).symbol=e,r.geometry=n,r.painter=i,r.rotations=[],r}K(e,t);var n=e.prototype;return n.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLRes(),n=new ps,i=this._getRenderPoints()[0],r=i.length-1;r>=0;r--)i[r]&&n._combine(t._pointAtResToPoint(i[r],e));return n},n.isDynamicSize=function(){var t=this.symbol;return _n(t.markerWidth)||_n(t.markerHeight)||_n(t.textSize)},n._rotateExtent=function(t,e){return t.convertTo((function(t){return t._rotate(e)}))},n._getRenderPoints=function(){var t=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(t)},n._getRenderContainerPoints=function(t){var e=this.getPainter();if(e.isSpriting())return this._getRenderPoints()[0];var n,i=this.geometry,r=this.getDxDy();if(i._cPoint&&!t){var o=t?th:eh;o.set(i._cPoint.x,i._cPoint.y),o._sub(e.containerOffset);var s=r.x,a=r.y;(s||a)&&o._add(s||0,a||0),n=[o]}else{var h=this._getRenderPoints()[0];n=this.painter._pointContainerPoints(h,r.x,r.y,t,!0,this.getPlacement())}if(!n||!Array.isArray(n[0]))return n;for(var l=[],u=0,c=n.length;u<c;u++)for(var A=0,f=n[u].length;A<f;A++)l.push(n[u][A]);return l},n.getPlacement=function(){return this.symbol.markerPlacement},n.getRotation=function(){return Ta(this.style)},n.getDxDy=function(){var t=this.style;return new ht(t.markerDx,t.markerDy)},n._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var n=this._getRenderPoints()[1];if(!n||!n[t])return e;var i=this.getMap(),r=n[t][0],o=n[t][1];if(!r||!o)return e;if(i.isTransforming()){var s=i.getGLRes();return r=i._pointAtResToContainerPoint(n[t][0],s,0,Ka),o=i._pointAtResToContainerPoint(n[t][1],s,0,$a),e+Dt(r.x,r.y,o.x,o.y)}return e+-Dt(r.x,r.y,o.x,o.y)},n._rotate=function(t,e,n){if(n){var i=this.getDxDy(),r=e.sub(i);return t.save(),t.translate(r.x,r.y),t.rotate(n),i}return null},e}(Qa),ih=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.getPlacement=function(){return"point"},n.getDxDy=function(){return new ht(0,0)},n.symbolize=function(t){var e=this.geometry,n=e.getLayer();if(e.options.debug||!n||n.options.debug){var i=this.getMap();if(i&&!i.isZooming()){var r=n.options.debugOutline;t.strokeStyle=r,t.fillStyle=r,t.lineWidth=1,t.font="18px  serif";var o=e.getContainerExtent().toArray();Mo.polygon(t,[o],1,0);for(var s=this._getRenderContainerPoints(),h=this.geometry.getId(),l=Ja("cross",10,10),u=0;u<s.length;u++){var c=s[u];a(h)||Mo.fillText(t,h,c.add(8,-4),r);for(var A=[],f=0;f<l.length;f++)A.push(l[f].add(c));Mo.path(t,A.slice(0,2),1),Mo.path(t,A.slice(2,4),1)}}}},e}(nh),rh=new Jt(1,1),oh=new ps,sh=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this).style=r._defineStyle(r.translate()),r}K(e,t),e.test=function(t){return Da(t)};var n=e.prototype;return n.symbolize=function(t,e){if(this.isVisible()){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&0!==n.markerOpacity){var i=this._getRenderContainerPoints();if(wt(i)){var r=this._getImage(e);if(r){this._prepareContext(t);var o,s=n.markerWidth,a=n.markerHeight;if(!h(s)||!h(a)){a=r.height,n.markerWidth=s=r.width,n.markerHeight=a;var l=n.markerFile;e.isResourceLoaded(l)||e.addResource(l,r);var u=this.getPainter();u.isSpriting()||u.removeCache()}"path"!==this.symbol.markerType&&h(n.markerOpacity)&&n.markerOpacity<1&&(o=t.globalAlpha,t.globalAlpha*=n.markerOpacity),rh.width=s,rh.height=a;var c=ce(rh,n.markerHorizontalAlignment,n.markerVerticalAlignment);this.rotations=[];for(var A=0,f=i.length;A<f;A++){var d=i[A],p=this._rotate(t,d,this._getRotationAt(A)),g=void 0;if(p){var m=d.sub(p);d=p;var y=this._getRotationAt(A);(g=ga(oh,y,s,a,d,c))._add(m),this.rotations.push(y)}var v=d.x+c.x,_=d.y+c.y;Mo.image(t,r,v,_,s,a),p&&t.restore(),p?this._setBBOX(t,g.xmin,g.ymin,g.xmax,g.ymax):this._setBBOX(t,v,_,v+s,_+a)}void 0!==o&&(t.globalAlpha=o)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}}},n._getImage=function(t){return e=t,n=this.style.markerFile,e&&e.getImage(n)||null;var e,n},n.getFixedExtent=function(t){return this._fixedExtent=this._fixedExtent||new ps,Sa(this._fixedExtent,this.style,t)},n.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:yt(t.markerOpacity,1),markerWidth:yt(t.markerWidth,null),markerHeight:yt(t.markerHeight,null),markerRotation:yt(t.markerRotation,0),markerDx:yt(t.markerDx,0),markerDy:yt(t.markerDy,0),markerHorizontalAlignment:yt(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:yt(t.markerVerticalAlignment,"top")}},e}(nh);let ah;const hh={width:100,height:10};let lh=!1;try{new OffscreenCanvas(1,1).getContext("2d").fillText("hello",0,0),lh=!0}catch(uft){lh=!1}let uh=class{constructor(t,e={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let n=1/0,i=-1/0;for(let r=0,o=t.length;r<o;r++){const e=t[r][0];n=Math.min(e,n),i=Math.max(e,i)}this.min=n,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},hh,e),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const t=function(){if(!ah){const{width:t,height:e}=hh;lh?ah=new OffscreenCanvas(t,e):(ah=document.createElement("canvas"),ah.width=t,ah.height=e)}return ah}(),{width:e,height:n}=this.options;t.width=e,t.height=n;const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);const r=i.createLinearGradient(0,0,t.width,0),{colors:o,valueOffset:s}=this;for(let a=0,h=o.length;a<h;a++){const[t,e]=o[a];r.addColorStop((t-this.min)/s,e)}i.fillStyle=r,i.fillRect(0,0,t.width,t.height),this.imgData=i.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t),t=Math.min(t,this.max);let e=Math.round((t-this.min)/this.valueOffset*this.imgData.width);e=Math.min(e,this.imgData.width-1);const n=4*e;return[this.imgData.data[n],this.imgData.data[n+1],this.imgData.data[n+2],this.imgData.data[n+3]]}};var ch,Ah=new $o(0,0),fh=new $o(0,0),dh=function(t){function e(e,n,i){var r;return(r=t.call(this)||this).symbol=e,r.geometry=n,r.painter=i,n.isPoint?nt(r):(r.style=r._defineStyle(r.translate()),r)}K(e,t),e.test=function(t,e){if(!t)return!1;if(e&&e.isPoint)return!1;for(var n in t){var i=n.slice(0,4);if("line"===i||"poly"===i)return!0}return!1};var n=e.prototype;return n.symbolize=function(t,e){if(this.isVisible()){var n=this.style;if(0!==n.polygonOpacity||0!==n.lineOpacity||this.painter.isHitTesting()){var i=this._getPaintParams();if(i){this._prepareContext(t);var r=Yn(n.lineColor)||n.lineGradientProperty,o="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!r||!n.lineColor.places&&o||(n.lineGradientExtent=this.geometry.getContainerExtent()._expand(n.lineWidth)),Yn(n.polygonFill)&&(n.polygonGradientExtent=this.geometry.getContainerExtent());var s=this.geometry.getLayer().options.geometryEventTolerance||0,a=this.geometry._hitTestTolerance()+s,h=i[0];if("Polygon"===this.geometry.getJSONType()&&h.length>0&&Array.isArray(h[0][0])||"LineString"===this.geometry.type&&h.length>0&&Array.isArray(h[0]))for(var l=0;l<h.length;l++){this.prepareCanvas(t,n,e),r&&o&&!n.lineColor.places&&this._createGradient(t,h[l],n.lineColor);var u=[t,h[l]];i.length>1&&u.push(...i.slice(1)),u.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray),r&&u.push(this._lineColorIn);var c=this.geometry._paintOn(...u);this._setBBOX(t,c),this._bufferBBOX(t,a)}else{this.prepareCanvas(t,n,e),r&&o&&!n.lineColor.places&&this._createGradient(t,h,n.lineColor);var A=[t];A.push(...i),A.push(n.lineOpacity,n.polygonOpacity,n.lineDasharray),r&&A.push(this._lineColorIn);var f=this.geometry._paintOn(...A);this._setBBOX(t,f),this._bufferBBOX(t,a)}t.setLineDash&&Array.isArray(n.lineDasharray)&&t.setLineDash([]),this._tempRenderPoints=h}}}},n.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new $o(0,0),this._extMax=new $o(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var n=t._prjToPoint(this._extMin,void 0,Ah),i=t._prjToPoint(this._extMax,void 0,fh);return this._pxExtent?this._pxExtent.set(Math.min(n.x,i.x),Math.min(n.y,i.y),Math.max(n.x,i.x),Math.max(n.y,i.y)):this._pxExtent=new ps(n,i),this._pxExtent},n.getFixedExtent=function(){var t=this.style.lineWidth/2;return new ps(-t,-t,t,t)},n._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},n.translate=function(){var t=this.symbol,e={lineColor:yt(t.lineColor,"#000"),lineWidth:yt(t.lineWidth,2),lineOpacity:yt(t.lineOpacity,1),lineDasharray:yt(t.lineDasharray,[]),lineCap:yt(t.lineCap,"butt"),lineJoin:yt(t.lineJoin,"miter"),linePatternFile:yt(t.linePatternFile,null),lineDx:yt(t.lineDx,0),lineDy:yt(t.lineDy,0),polygonFill:yt(t.polygonFill,null),polygonOpacity:yt(t.polygonOpacity,1),polygonPatternFile:yt(t.polygonPatternFile,null),polygonPatternDx:yt(t.polygonPatternDx,0),polygonPatternDy:yt(t.polygonPatternDy,0),linePatternDx:yt(t.linePatternDx,0),linePatternDy:yt(t.linePatternDy,0),lineGradientProperty:yt(t.lineGradientProperty,null)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},n._createGradient=function(t,e,n){if(Array.isArray(e)&&e.length){var i,[r,o]=function(t){var e,n=!0;Array.isArray(t[0])?(e=t[0],n=!1):e=t;var i=e.length;if(n)return[e[0],e[i-1]];for(var r,o=e[0],s=0,a=1;a<i;a++){var h=e[a],l=o.distanceTo(h);l>s&&(s=l,r=h)}return[o,r]}(e);if(r&&o){if(n.colorStops&&(i=n.colorStops),i||(i=(this.geometry.properties||{})[(this.style||{}).lineGradientProperty]),i&&Array.isArray(i)&&!(i.length<2)){if(!Array.isArray(i[0])){for(var s=[],a=[],h=0,l=0,u=i.length;l<u;l+=2)a[0]=i[l],a[1]=i[l+1],s[h]=a,h++,a=[];i=s}var c=t.createLinearGradient(r.x,r.y,o.x,o.y);i.forEach((function(t){c.addColorStop(...t)})),t.strokeStyle=c;var A=JSON.stringify(i);if(A!==this._lineColorStopsKey){this._lineColorStopsKey=A;var f=i.map((function(t){return[parseFloat(t[0]),t[1]]}));this._lineColorIn=new uh(f,{height:1,width:100})}}}else console.error("unable create canvas LinearGradient,error data:",e)}},e}(Qa),ph=new ps,gh=function(t){function e(e,n,i){var r,o=(r=t.call(this,e,n,i)||this).translate();return r._dynamic=xn(o),r.style=r._defineStyle(o),0===r.style.textWrapWidth?nt(r):(r.strokeAndFill=r._defineStyle(r.translateLineAndFill(r.style)),r)}K(e,t),e.test=function(t){return Ra(t)};var n=e.prototype;return n.isAlongLine=function(){var t=this.getPlacement(),e=this.style.textSpacing;return"line"===t&&h(e)&&e>0},n.symbolize=function(t,e){if(this.isVisible()&&(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth)){var n=this.style,i=this.strokeAndFill,r=le(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var o=this._textDesc=this._textDesc||ue(r,this.style);this._prepareContext(t),this.prepareCanvas(t,i,e),Mo.prepareCanvasFont(t,n);var s=n.textHaloRadius||0;if(this.rotations=[],this.isAlongLine()){var a=this.getPainter().getPathTempRenderPoints();if(!a)return;if(a=function(t,e){var{width:n,height:i}=e,r=n+0,o=i+0;ph.xmin=-0,ph.ymin=-0,ph.xmax=r,ph.ymax=o,Array.isArray(t[0])||(t=[t]);var s=[];return t.forEach((function(t){for(var e=!1,n=0,i=t.length;n<i;n++){var{x:a,y:h}=t[n];if(a<-0||a>r||h<-0||h>o){e=!0;break}}e?Ha(t,ph,!1,!1).forEach((function(t){for(var e=[],n=0,i=t.length;n<i;n++)e[n]=t[n].point;s.push(e)})):s.push(t)})),s}(a,this.getMap().getSize())){var h=this.geometry.getLayer(),l=Mo.textAlongLine(t,r,a,n,o,h.options.collision?h.getCollisionIndex():null);l&&(this._setBBOX(t,l),this._bufferBBOX(t,s))}}else{var u=this._getRenderContainerPoints();if(!wt(u))return;for(var c=0,A=u.length;c<A;c++){var f=u[c],d=this._rotate(t,f,this._getRotationAt(c)),p=void 0;if(d){var g=f.sub(d);f=d;var m=this._getRotationAt(c),{width:y,height:v}=o.size||{width:0,height:0},_=ce(o.size,n.textHorizontalAlignment,n.textVerticalAlignment);(p=ga(ph,m,y,v,f,_))._add(g),this.rotations.push(m)}var x=Mo.text(t,r,f,n,o);d?(this._setBBOX(t,p.xmin,p.ymin,p.xmax,p.ymax),t.restore()):this._setBBOX(t,x),this._bufferBBOX(t,s)}}}},n.getPlacement=function(){return this.symbol.textPlacement},n.getRotation=function(){var t=this.style.textRotation;return h(t)?-t*Math.PI/180:null},n.getDxDy=function(){var t=this.style;return new ht(t.textDx,t.textDy)},n.getFixedExtent=function(){var t=this.geometry.getTextDesc();return Array.isArray(t)&&(t=t[this._index]),this._fixedExtent=this._fixedExtent||new ps,t?Ia(this._fixedExtent,this.style,t):this._fixedExtent},n.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:yt(t.textFaceName,"monospace"),textWeight:yt(t.textWeight,"normal"),textStyle:yt(t.textStyle,"normal"),textSize:yt(t.textSize,Yt),textFont:yt(t.textFont,null),textFill:yt(t.textFill,"#000"),textOpacity:yt(t.textOpacity,1),textHaloFill:yt(t.textHaloFill,"#ffffff"),textHaloRadius:yt(t.textHaloRadius,0),textHaloOpacity:yt(t.textHaloOpacity,1),textWrapWidth:yt(t.textWrapWidth,null),textWrapCharacter:yt(t.textWrapCharacter,"\n"),textLineSpacing:yt(t.textLineSpacing,0),textDx:yt(t.textDx,0),textDy:yt(t.textDy,0),textHorizontalAlignment:yt(t.textHorizontalAlignment,"middle"),textVerticalAlignment:yt(t.textVerticalAlignment,"middle"),textAlign:yt(t.textAlign,"center"),textRotation:yt(t.textRotation,0),textMaxWidth:yt(t.textMaxWidth,0),textMaxHeight:yt(t.textMaxHeight,0),textSpacing:yt(t.textSpacing,0),textAlongDebug:yt(t.textAlongDebug,!1)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},n.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},e}(nh),mh=[0,0],yh=new ps,vh=new ht(0,0),_h=function(t){function e(e,n,i){var r,o=(r=t.call(this,e,n,i)||this).translate();return r._dynamic=xn(o),r.style=r._defineStyle(o),r.strokeAndFill=r._defineStyle(Ya(r.style)),r.padding=0,r}K(e,t),e.test=function(t){return ka(t)};var n=e.prototype;return n.symbolize=function(t,e){if(this.isVisible()){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&(0!==n.polygonOpacity||0!==n.lineOpacity)){var i=this._getRenderContainerPoints();wt(i)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(t,i,e):this._drawMarkersWithCache(t,i,e))}}},n._drawMarkers=function(t,e,n){for(var i=e.length-1;i>=0;i--){var r=e[i],o=Pa(mh,this.style),[s,a]=o,h=this._rotate(t,r,this._getRotationAt(i));this.rotations=[];var l=void 0;if(h){var u=r.sub(h);r=h;var c=this._getRotationAt(i);(l=ga(yh,c,s,a,r,vh))._add(u),this.rotations.push(c)}if(this._drawVectorMarker(t,r,n),h)t.restore(),this._setBBOX(t,l.xmin,l.ymin,l.xmax,l.ymax);else{var{x:A,y:f}=r;this._setBBOX(t,A,f,A+s,f+a)}}},n._drawMarkersWithCache=function(t,e,n){var i=this._stampSymbol(),r=n.getImage(i);r||(r=this._createMarkerImage(t,n),n.addResource([i,r.width,r.height],r));for(var o=Ca(this.style,r.width,r.height),s=e.length-1;s>=0;s--){var a=e[s],h=this._rotate(t,a,this._getRotationAt(s));this.rotations=[];var l=void 0;if(h){var u=a.sub(h);a=h;var c=this._getRotationAt(s);(l=ga(yh,c,r.width,r.height,a,o))._add(u),this.rotations.push(c)}var A=a.x+o.x,f=a.y+o.y;Mo.image(t,r,A,f),h?(t.restore(),this._setBBOX(t,l.xmin,l.ymin,l.xmax,l.ymax)):this._setBBOX(t,A,f,A+r.width,f+r.height)}},n._createMarkerImage=function(t,e){var n=t.canvas.constructor,i=Pa(mh,this.style),r=Mo.createCanvas(i[0],i[1],n),o=this._getCacheImageAnchor(i[0],i[1]),s=r.getContext("2d");return this._drawVectorMarker(s,o,e),r},n._stampSymbol=function(){return this._stamp||(this._stamp=ge([this.style.markerType,Yn(this.style.markerFill)?Jn(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,Yn(this.style.markerLineColor)?Jn(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},n._getCacheImageAnchor=function(t,e){var n=2*(this.symbol.shadowBlur||0)+this.padding,i=this.style.markerType;return"bar"===i||"pie"===i||"pin"===i?new ht(t/2,e-n):"rectangle"===i?new ht(n,n):new ht(t/2,e/2)},n._getGraidentExtent=function(t){var e=new ps,n=this.getDxDy(),i=this.getFixedExtent();if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)e._combine(t[r]);else e._combine(t);return e.xmin+=i.xmin-n.x,e.ymin+=i.ymin-n.y,e.xmax+=i.xmax-n.x,e.ymax+=i.ymax-n.y,e},n._drawVectorMarker=function(t,e,n){Xa(t,e,this.style,n)},n.getFixedExtent=function(){var t=this.isDynamicSize(),e=this.style.markerWidth,n=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new ps,_a(this._fixedExtent,this.style,t?[128,128*(0===e?1:n/e)]:null)},n.translate=function(){var t=this.symbol,e={markerType:yt(t.markerType,"ellipse"),markerFill:yt(t.markerFill,"#00f"),markerFillOpacity:yt(t.markerFillOpacity,1),markerFillPatternFile:yt(t.markerFillPatternFile,null),markerLineColor:yt(t.markerLineColor,"#000"),markerLineWidth:yt(t.markerLineWidth,da.markerLineWidth),markerLineOpacity:yt(t.markerLineOpacity,1),markerLineDasharray:yt(t.markerLineDasharray,[]),markerLinePatternFile:yt(t.markerLinePatternFile,null),markerDx:yt(t.markerDx,0),markerDy:yt(t.markerDy,0),markerWidth:yt(t.markerWidth,da.markerWidth),markerHeight:yt(t.markerHeight,da.markerHeight),markerRotation:yt(t.markerRotation,0),shadowBlur:yt(t.shadowBlur,0),shadowOffsetX:yt(t.shadowOffsetX,0),shadowOffsetY:yt(t.shadowOffsetY,0)},n=e.markerType,i=xa(n),r=ba(n);return e.markerHorizontalAlignment=yt(t.markerHorizontalAlignment,i),e.markerVerticalAlignment=yt(t.markerVerticalAlignment,r),h(t.markerOpacity)&&(h(t.markerFillOpacity)&&(e.markerFillOpacity*=t.markerOpacity),h(t.markerLineOpacity)&&(e.markerLineOpacity*=t.markerOpacity)),e},e}(nh),xh=function(t){function e(e,n,i){var r;a(e.markerWidth)&&(e.markerWidth=80),a(e.markerHeight)&&(e.markerHeight=80),e=s({},e,(r=t.call(this,e,n,i)||this).translate());var o=r.style=r._defineStyle(e);return r._url=Q.gecko?[Wn(o,o.markerWidth,o.markerHeight),o.markerWidth,o.markerHeight]:[Wn(o),o.markerWidth,o.markerHeight],r}K(e,t),e.test=function(t){return La(t)};var n=e.prototype;return n._prepareContext=function(){},n._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var n=this.painter,i=new Image;return i.onload=function(){var t=n.getLayer()&&n.getLayer().getRenderer();t&&t.setToRedraw()},i.onerror=function(n){n&&"undefined"!=typeof console&&console.warn(n),t.markErrorResource(e._url)},i.src=this._url[0],t&&t.addResource(this._url,i),i},e}(sh),bh={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},wh=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this).style=n.getLayer().options.drawAltitude,r.style&&u(r.style)||(r.style={lineWidth:2}),r.style.lineWidth||(r.style.lineWidth=0),r.dxdy=r._defineStyle({dx:e.textDx||e.markerDx,dy:e.textDy||e.markerDy}),r}K(e,t),e.test=function(t,e){if(!e.getLayer())return!1;var n=e.getJSONType();return"Marker"===n||"LineString"===n};var n=e.prototype;return n.symbolize=function(t){if(this.geometry.getLayer().options.drawAltitude&&this.geometry.hasAltitude()){var e=this._getStyle();if(this._prepareContext(t),"LineString"===this.geometry.type){var n=this._getPaintParams(e.lineDx,e.lineDy);if(!n)return;var i=this.getPainter().getPaintParams(e.lineDx,e.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(t,n[0],i)}else{var r=this._getRenderContainerPoints(),o=this._getRenderContainerPoints(!0);if(!r||0===r.length)return;this._drawMarkerAltitude(t,r[0],o[0])}}},n.getDxDy=function(){var t=this.dxdy;return new ht(t.dx||0,t.dy||0)},n.get2DExtent=function(){return"LineString"===this.geometry.type?dh.prototype.get2DExtent.apply(this):t.prototype.get2DExtent.call(this)},n.getPlacement=function(){return"point"},n._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0,null,!0,"_altpt")},n._drawMarkerAltitude=function(t,e,n){var i=this._getStyle();this.prepareCanvas(t,i),Mo.path(t,[e,n],i.lineOpacity,null,i.lineDasharray)},n._drawLineAltitude=function(t,e,n){var i=this._getStyle();if(e.length>0&&Array.isArray(e[0]))for(var r=0;r<e.length;r++)this._drawLine(t,e[r],n[r]);else this._drawLine(t,e,n);t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])},n._drawLine=function(t,e,n){var i=this._getStyle();this.prepareCanvas(t,i);for(var r=0,o=e.length-1;r<o;r++)Mo.polygon(t,[e[r],e[r+1],n[r+1],n[r]],i.lineOpacity,i.polygonOpacity,i.lineDasharray)},n._getStyle=function(){var t=this.geometry.getLayer(),e=t.options.drawAltitude;if(Array.isArray(e)){var n=(t.getGeometries()||[]).indexOf(this.geometry);n>=0&&(e=e[n]||bh)}return u(e)||(e=bh),e.lineWidth||(e.lineWidth=0,e.lineOpacity=0),e},e}(nh),Ch=Object.freeze({__proto__:null,CanvasSymbolizer:Qa,DebugSymbolizer:ih,DrawAltitudeSymbolizer:wh,ImageMarkerSymbolizer:sh,PointSymbolizer:nh,StrokeAndFillSymbolizer:dh,Symbolizer:Za,TextMarkerSymbolizer:gh,VectorMarkerSymbolizer:_h,VectorPathMarkerSymbolizer:xh}),Ph=[wh,dh,sh,xh,_h,gh],Mh=new ht(0,0),Th=new ps,Sh=new ps,Ih=new ps,Eh=new ps,Oh=new ps,Rh={code:void 0},Dh={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},kh=function(t){function e(e){var n;return(n=t.call(this)||this).geometry=e,n.symbolizers=n._createSymbolizers(),n._altAtGL=n._getGeometryAltitude(),n.bbox=Ti(),n._drawTime=0,n}K(e,t);var n=e.prototype;return n._setDrawTime=function(t){return this._drawTime=t,this},n.getRenderBBOX=function(){var t=this.getLayer();if(t&&t._drawTime!==this._drawTime)return null;Ii(this.bbox);for(var e=this.symbolizers.length-1;e>=0;e--){var n=this.symbolizers[e].bbox;Ri(n)&&Oi(this.bbox,n)}return Ri(this.bbox)?this.bbox:null},n.getMap=function(){return this.geometry.getMap()},n.getLayer=function(){return this.geometry&&this.geometry.getLayer()},n._createSymbolizers=function(){var t=this.getSymbol(),e=[],n=Ph,i=t;Array.isArray(t)||(i=[t]);for(var r=i.length-1;r>=0;r--)for(var o=i[r],s=n.length-1;s>=0;s--)if(n[s].test(o,this.geometry)){var a=new n[s](o,this.geometry,this);a._index=r,e.push(a),a instanceof nh&&(this._hasPoint=!0)}if(!e.length&&console){var h=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(h?":"+h:""):"")+") to draw : "+JSON.stringify(t))}return this._debugSymbolizer=new ih(t,this.geometry,this),e},n.hasPoint=function(){return!!this._hasPoint},n.getRenderPoints=function(t){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},n.getPaintParams=function(t,e,n,i,r="_pt"){var o,s,a,l,u,c=this.getLayer()._getRenderer().mapStateCache,A=this.getMap();c&&!this._hitPoint?(o=c.resolution,s=c.pitch,a=c.bearing,l=c.glScale,u=c.containerExtent):(o=A.getResolution(),s=A.getPitch(),a=A.getBearing(),l=A.getGLScale(),u=A.getContainerExtent());var f=this.geometry,d=o,p=0!==s,g=0!==a,m=this._cachedParams,y=f._paintAsPath&&f._paintAsPath();if(y&&this._unsimpledParams&&d<=this._unsimpledParams._res)m=this._unsimpledParams;else if(!m||m._res!==o||this._pitched!==p&&f._redrawWhenPitch()||this._rotated!==g&&f._redrawWhenRotate()){if(!(m=f._getPaintParams()))return null;m._res=d,!f._simplified&&y&&(this._unsimpledParams||(this._unsimpledParams=m),d>this._unsimpledParams._res&&(this._unsimpledParams._res=d)),this._cachedParams=m}if(!m)return null;this._pitched=p,this._rotated=g;var v=l,_=[],x=this._pointContainerPoints(m[0],t,e,n,i||this._hitPoint&&!u.contains(this._hitPoint),null,r);if(!x)return null;_.push(x);for(var b=1,w=m.length;b<w;b++)h(m[b])||m[b]instanceof Jt?h(m[b])?_.push(m[b]/v):_.push(m[b].multi(1/v)):_.push(m[b]);return _},n._pointContainerPoints=function(t,e,n,i,r,o,s="_pt"){if(this._aboveCamera())return null;var a,l,u,c=this.getLayer()._getRenderer(),A=c.mapStateCache,f=this.getMap(),d=this.geometry,p=this.containerOffset;A?(a=A.glRes,l=A.containerExtent):(a=f.getGLRes(),l=f.getContainerExtent());var g=this.getLayer().options.roundPoint,m=1/0,y=1/0,v=-1/0,_=-1/0,x=!r,b=c.layer.options.clipBBoxBufferSize||3,w=this.symbolizers,C=d.options.enableClip;function P(t=[],i=[]){for(var r=zt(t,s),o=0,h=(r=f._pointsAtResToContainerPoints(t,a,i,r)).length;o<h;o++){var u=r[o];u._sub(p),(e||n)&&u._add(e||0,n||0),g&&(u.x=Math.ceil(u.x),u.y=Math.ceil(u.y)),m=Math.min(u.x,m),y=Math.min(u.y,y),v=Math.max(u.x,v),_=Math.max(u.y,_)}if(C&&x&&si(w)){if(Oh.ymin=l.ymin,Oh.ymin<b&&(Oh.ymin=l.ymin-b),Oh.xmin=l.xmin-b,Oh.xmax=l.xmax+b,Oh.ymax=l.ymax+b,d.getShell&&d.getHoles)return Ua(r,Oh);var c=Ha(r,Oh,!1);if(c.length){var A=[];return c.forEach((function(t){for(var e=0,n=t.length;e<n;e++)A.push(t[e].point)})),A}}return r}var M=this.getAltitude();if(Array.isArray(t)){var T;!r&&this.geometry.options.enableClip?(T=this._clip(t,M)).inView&&(x=!1):T={points:t,altitude:M};var S=T.points;M=T.altitude,i&&(M=0);var I=M;u=[];for(var E=[],O=h(M),R=0,D=S.length;R<D;R++){var k=S[R];if(Array.isArray(k)){if(O){var L=P(k,M);u.push(L);continue}for(var F=[],N=0,z=k.length;N<z;N++)Array.isArray(M)&&(I=M[R]?M[R][N]:0),F.push(I);var B=P(k,F);u.push(B)}else Array.isArray(M)&&(I="vertex-last"===o?M[M.length-1-R]:"line"===o?(M[R]+M[R+1])/2:M[R]),E.push(I)}E.length&&(u=P(S,E))}else t instanceof ht&&(i&&(M=0),u=f._pointAtResToContainerPoint(t,a,M)._sub(p),(e||n)&&u._add(e,n));return Dh.minx=m,Dh.miny=y,Dh.maxx=v,Dh.maxy=_,this._containerBbox=Dh,u},n._clip=function(t,e){if(h(e)&&0!==e)return{points:t,altitude:e};if(Array.isArray(e)){for(var n=!1,i=0,r=e.length;i<r;i++)if(0!==e[i]){n=!0;break}if(n)return{points:t,altitude:e}}var o=this.getMap(),s=this.geometry,a=this.getSymbol().lineWidth;h(a)||(a=4);var l,u,c,A=this.getLayer()._getRenderer().mapStateCache;A?(l=A._2DExtent,u=A.glExtent,c=A.pitch):(l=o.get2DExtent(),u=o.get2DExtentAtRes(o.getGLRes()),c=o.getPitch());var f=l._expand(a);if(c>0&&e){var d=o.cameraLookAt,p=o.cameraPosition;Mh.set(p[0],p[1]),f=f._combine(Mh._add(vt(d[0]-p[0]),vt(d[1]-p[1])))}var g=t;if(this.get2DExtent(null,Eh).within(f))return{points:g,altitude:e,inView:!0};var m=u._expand(a*o.getGLScale());Ih.xmin=m.xmin,Ih.xmax=m.xmax,Ih.ymin=m.ymin,Ih.ymax=m.ymax;var y=s.options.smoothness;if(s.getShell&&this.geometry.getHoles&&!y){var{xmin:v,ymin:_,xmax:x,ymax:b}=m,w=Math.abs(x-v),C=Math.abs(b-_),P=Math.sqrt(w*w+C*C),M=(P-w)/2,T=(P-C)/2;if(Ih.xmin=m.xmin-M,Ih.xmax=m.xmax+M,Ih.ymin=m.ymin-T,Ih.ymax=m.ymax+T,Array.isArray(t[0])){g=[];for(var S=0;S<t.length;S++){var I=Ua(t[S],Ih);I.length&&g.push(I)}}else g=Ua(t,Ih)}else if("LineString"===s.getJSONType()&&!y){if(Array.isArray(t[0])){g=[];for(var E=0;E<t.length;E++)pt(g,Ha(t[E],Ih,!1,!!y))}else g=Ha(t,Ih,!1,!!y);return this._interpolateSegAlt(g,t,e)}return{points:g,altitude:e}},n._interpolateSegAlt=function(t,e,n){if(!Array.isArray(n)){var i=function(t){return t.point};return{points:t.map((function(t){return Array.isArray(t)?t.map(i):t.point})),altitude:n}}var r=Lh(t,e,n);return n=[],{points:r.map((function(t){if(Array.isArray(t)){var e=[],i=t.map((function(t){return e.push(t.altitude),t.point}));return n.push(e),i}return n.push(t.altitude),t.point})),altitude:n}},n.getSymbol=function(){return this.geometry._getInternalSymbol()},n._resetSymbolizersBBOX=function(){for(var t=this.symbolizers.length-1;t>=0;t--)Ii(this.symbolizers[t].bbox);return this},n.paint=function(t,e,n){if(this.symbolizers){var i=this.getLayer(),r=i._getRenderer();if(r&&(r.context||e)){var o=r.mapStateCache||{offset:void 0};if(this.geometry._isCheck||!t||t.intersects(this.get2DExtent(r.resources,Th))){var s=this.getMap();if(!this._aboveCamera()){this.containerOffset=n||o.offset||s._pointToContainerPoint(r.middleWest)._add(0,-s.height/2),this._beforePaint();var a=e||r.context;a.isHitTesting||this._resetSymbolizersBBOX();for(var h=[a,r.resources],l=this.symbolizers.length-1;l>=0;l--)(a.shadowBlur||this.symbolizers[l].symbol.shadowBlur)&&this._prepareShadow(a,this.symbolizers[l].symbol),this.symbolizers[l].symbolize(...h);this._afterPaint(),this._painted=!0,(this.geometry.options.debug||i.options.debug)&&this._debugSymbolizer.symbolize(a)}}}}},n.getSprite=function(t,e){if(!this.geometry.isPoint)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var n=new ps;this.symbolizers.forEach((function(e){var i=e.getFixedExtent(t);n._combine(i)}));var i,r=n.getMin().multi(-1),o=e||(this.getMap()?this.getMap().CanvasClass:null),s=Mo.createCanvas(n.getWidth(),n.getHeight(),o);this._renderPoints&&(i=this._renderPoints);for(var a=s.getContext("2d"),h=[a,t],l=this.symbolizers.length-1;l>=0;l--){var u=this.symbolizers[l].getDxDy();this._renderPoints={center:[[r.add(u)]]},this._prepareShadow(a,this.symbolizers[l].symbol),this.symbolizers[l].symbolize(...h)}i&&(this._renderPoints=i),this._sprite={canvas:s,offset:n.getCenter()}}return this._spriting=!1,this._sprite},n.isSpriting=function(){return!!this._spriting},n.hitTest=function(t,e){if((!e||e<.5)&&(e=.5),this._hitPoint=t.sub(e,e),!ch){var n=this.getMap()?this.getMap().CanvasClass:null;ch=Mo.createCanvas(1,1,n)}Mo.setHitTesting(!0),ch.width=ch.height=2*e;var i=Mo.getCanvas2DContext(ch);i.isHitTesting=!0;try{this.paint(null,i,this._hitPoint)}finally{Mo.setHitTesting(!1)}delete this._hitPoint;for(var r=i.getImageData(0,0,ch.width,ch.height).data,o=3,s=r.length;o<s;o+=4)if(r[o]>0)return!0;return!1},n.isHitTesting=function(){return!!this._hitPoint},n._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},n._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var n=this.symbolizers.length-1;n>=0;n--)t.apply(e,[this.symbolizers[n]])}},n.get2DExtent=function(t,e){this._verifyProjection();var n=this.getMap();t=t||this.getLayer()._getRenderer().resources;var i=n.getZoom(),r=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===i&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==i&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new ps),this._extent2D._zoom=i),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(t,new ps)))),!this._extent2D)return r&&delete this._fixedExtent,null;var{xmin:o,ymin:s,xmax:a,ymax:h}=this._fixedExtent;return r&&delete this._fixedExtent,Sh.set(o,-h,a,-s),e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(Sh),e):this._extent2D.add(Sh)},n._computeExtent2D=function(t){for(var e=this.symbolizers.length-1;e>=0;e--)t._combine(this.symbolizers[e].get2DExtent());return t},n._computeFixedExtent=function(t,e){for(var n=this.symbolizers.length-1;n>=0;n--){var i=this.symbolizers[n];i.getFixedExtent&&e._combine(i.getFixedExtent(t))}return e},n._isDynamicSize=function(){for(var t=this.symbolizers.length-1;t>=0;t--)if(this.symbolizers[t].isDynamicSize())return!0;return!1},n._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap(),n=e.getGLRes();t=e.altitudeToPoint(t,n)*vt(t);var i=e.getFrustumAltitude();return t&&i&&i<t},n.getFixedExtent=function(){var t=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new ps):(this._extent2D&&this._extent2D._zoom===t||this.get2DExtent(null,Sh),this._fixedExtent)},n.setZIndex=function(t){this._eachSymbolizer((function(e){e.setZIndex(t)}))},n.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer((function(t){t.show()}))):this.getLayer().isCanvasRender()||this.paint()},n.hide=function(){this._eachSymbolizer((function(t){t.hide()}))},n.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();e&&e.setToRedraw()&&e.setToRedraw()}},n.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},n.remove=function(){this.removeCache(),this._removeSymbolizers()},n._removeSymbolizers=function(){this._eachSymbolizer((function(t){delete t.painter,t.remove()})),delete this.symbolizers},n.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},n.getAltitude=function(){return this.geometry._getAltitude()!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},n.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},n.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},n._getGeometryAltitude=function(){if(!this.getMap())return 0;var t=this.geometry._getAltitude();this._propAlt=t;var[e,n]=qa(t);return this.minAltitude=e,this.maxAltitude=n,t&&this.geometry.getCenter()?t:0},n._verifyProjection=function(){var t=this.geometry._getProjection()||Rh;this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},n._beforePaint=function(){},n._afterPaint=function(){},n.getPathTempRenderPoints=function(){for(var t=0,e=(this.symbolizers||[]).length;t<e;t++){var n=this.symbolizers[t];if(n instanceof dh&&n._tempRenderPoints)return n._tempRenderPoints}},e}(Lo);function Lh(t,e,n){if(!Array.isArray(n))return t;for(var i=[],r=0,o=t.length;r<o;r++)if(Array.isArray(t[r]))i.push(Lh(t[r],e,n));else{var s=t[r];if(s.point.equals(e[s.index]))s.altitude=n[s.index],i.push(s);else{var a=void 0,h=void 0;0===s.index?(a=s.index,h=s.index+1):(a=s.index-1,h=s.index);var l=s.point.distanceTo(e[h]),u=l/(l+e[a].distanceTo(s.point)),c=_t(n[a],n[h],1-u);s.altitude=c,i.push(s)}}return i}var Fh=new ps,Nh=function(t){function e(e,n){var i;return(i=t.call(this)||this).geometry=e,i.isMask=n,i.bbox=Ti(),i._drawTime=0,i}K(e,t);var n=e.prototype;return n._setDrawTime=function(t){return this._drawTime=t,this._eachPainter((function(e){e._setDrawTime(t)})),this},n.getRenderBBOX=function(){var t=this,e=this.getLayer();return e&&e._drawTime!==this._drawTime?null:(Ii(this.bbox),this._eachPainter((function(e){var n=e.getRenderBBOX();Ri(n)&&Oi(t.bbox,n)})),Ri(this.bbox)?this.bbox:null)},n._eachPainter=function(t){for(var e,n=this.geometry.getGeometries(),i=0,r=n.length;i<r&&(!(e=this.isMask?n[i]._getMaskPainter():n[i]._getPainter())||!e||!1!==t.call(this,e));i++);},n.getLayer=function(){return this.geometry&&this.geometry.getLayer()},n.paint=function(t){this.geometry&&this._eachPainter((function(e){e.paint(t)}))},n.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var n=e||new ps;return this._eachPainter((function(e){n=n._combine(e.get2DExtent(t,Fh))})),n},n.remove=function(){this._eachPainter((function(t){t.remove()}))},n.setZIndex=function(t){this._eachPainter((function(e){e.setZIndex(t)}))},n.show=function(){this._eachPainter((function(t){t.show()}))},n.hide=function(){this._eachPainter((function(t){t.hide()}))},n.repaint=function(){this._eachPainter((function(t){t.repaint()}))},n.refreshSymbol=function(){this._eachPainter((function(t){t.refreshSymbol()}))},n.hasPoint=function(){var t=!1;return this._eachPainter((function(e){return!e.hasPoint()||(t=!0,!1)})),t},n.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter((function(n){var i=n.getMinAltitude();(t||i<e)&&(t=!1,e=i)})),e},n.getMaxAltitude=function(){var t=0;return this._eachPainter((function(e){var n=e.getMaxAltitude();n>t&&(t=n)})),t},e}(Lo);function zh(t,e=[]){return e.forEach((function(e){var[n,i]=e;t=t.replace(n,i)})),t}function Bh(t){var{projection:e,isArcgis:n,isGeoServer:i,isSuperMap:r}=t,o=.0002645833333333333;return(n||i||r)&&(o=28e-5),e&&e.indexOf("4326")>-1&&(o=2.3767925226029154e-9,(n||r)&&(o=2.518101729011901e-9),i&&(o=2.51528279553466e-9)),o}var Hh="wmts";function jh(t,e){var n=t.getElementsByTagName(e);return n&&n.length?n:t.getElementsByTagName(Hh+":"+e)}function Uh(t,e){for(var n=0;n<t.length;n++){var i=t[n];if((i=i.getElementsByTagName("ows:Identifier")[0])&&i.textContent===e)return t[n]}return null}function Gh(t,e={}){var n,i,r,o,s=jh(t,"TileMatrix"),a=[],h=[],l=[],u=!1;if(!n){var c=t.getElementsByTagName("ows:SupportedCRS")[0];c&&(n=function(t){for(var e="",n=t.split(""),i=n.length-1;i>=0&&!isNaN(n[i]);i--)e=n[i]+e;return e}(n=(n=c.textContent).split("EPSG")[1]),n=zh((o=n).indexOf("EPSG")>-1?o:"EPSG:"+o,[["4490","4326"],["102100","3857"],["900913","3857"]]))}i||(i=t.getElementsByTagName("ows:Identifier")[0])&&(i=i.textContent),e.projection=n;for(var A=1/0,f=0;f<s.length;f++){var d=s[f],p=d.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(p))?(r=p.substr(0,p.lastIndexOf(":")),p=(p=p.split(":"))[p.length-1],p=parseInt(p),u=!0,e.isGeoServer=!0):p=parseInt(p),A=Math.min(A,p);var g=jh(d,"ScaleDenominator")[0].textContent,m=jh(d,"TopLeftCorner")[0].textContent,y=jh(d,"TileWidth")[0].textContent,v=jh(d,"TileHeight")[0].textContent;if(0===l.length&&l.push(parseInt(y),parseInt(v)),0===h.length){var[_,x]=m.split(" ").filter((function(t){return""!==t})).map((function(t){return parseFloat(t)}));_>0?h.push(1,-1,x,_):h.push(1,-1,_,x)}var b=Bh(e),w=parseFloat(g)*b;a.push(w)}if(A>0)for(var C=a[0],P=A-1;P>=0;P--)a.splice(0,0,C*=2);return{resolutions:a,tileSize:l,tileSystem:h,projection:n,TileMatrixSet:i,isGeoServer:u,levelStr:r}}var Vh=function(t,e,n={jsonp:!0}){c(t)&&Xe.get(t,(function(i,r){if(i)e(i);else{var o=function(t,e,n){["isArcgis","isSuperMap","isGeoServer"].every((function(t){return null==n[t]}))&&console.warn("Please specify the server type, such as isArcgis, isSuperMap, isGeoServer, Otherwise, the system will determine by itself"),null==n.isArcgis&&(n.isArcgis=["arcgis","geoscene"].some((function(e){return t.indexOf(e)>-1}))),null==n.isSuperMap&&(n.isSuperMap=t.indexOf("supermap")>-1);var i=(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("Contents")[0];if(!i)return[];var r=jh(i,"Layer");if(!r.length)return[];for(var o=[],s=0,a=i.childNodes.length;s<a;s++)"TileMatrixSet"===i.childNodes[s].localName&&o.push(i.childNodes[s]);if(!o.length)return[];for(var h=[],l=0,u=r.length;l<u;l++){var c=r[l],A=c.querySelectorAll("Style")[0];A&&(A=A.getElementsByTagName("ows:Identifier")[0])&&(A=A.textContent);var f=c.getElementsByTagName("ows:Identifier")[0];f&&(f=f.textContent);var d=jh(c,"TileMatrixSetLink");if(0!==d.length)for(var p=0,g=d.length;p<g;p++){var m=d[p];(m=jh(m,"TileMatrixSet")[0])&&(m=m.textContent);var y=Uh(o,m);if(y){var v=c.querySelectorAll("ResourceURL")[0],_="";v&&(_=v.attributes.template.value);var{resolutions:x,tileSize:b,tileSystem:w,projection:C,TileMatrixSet:P,isGeoServer:M,levelStr:T}=Gh(y,n);_.length||(_=e.substr(0,e.lastIndexOf("?")),_+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var S=zh(_,[["{LAYER}",f],["{Layer}",f],["{layer}",f],["{STYLE}",A],["{Style}",A],["{style}",A],["{TileMatrixSet}",P],["{TileMatrix}",M?T+":{z}":"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",M?"image/png":"tiles"]]);h.push({tileSize:b,tileSystem:w,spatialReference:{resolutions:x,projection:C},urlTemplate:S,info:{layerName:f,TileMatrixSet:P,style:A,tileSize:b,tileSystem:w,resolutions:x,projection:C,urlTemplate:S}})}}}return h}(r,t,n);e(null,o)}}),n)};function Wh(t){for(var e=t.tileInfo,n=[e.cols,e.rows],i=[],r=e.lods,o=0,s=r.length;o<s;o++)i.push(r[o].resolution);var a=t.fullExtent,h=e.origin,l=[1,-1,h.x,h.y];return delete a.spatialReference,{spatialReference:{resolutions:i,fullExtent:a},tileSystem:l,tileSize:n}}var qh=23,Zh={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=12756274*Math.PI,n=0;n<qh;n++)t[n]=e/(256*Math.pow(2,n));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<qh;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{projection:"baidu",resolutions:function(){for(var t=Math.pow(2,18),e=[],n=0;n<qh;n++)e[n]=t,t*=.5;return e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var t=Math.pow(2,8),e=[],n=0;n<qh;n++)e[n]=t,t*=.5;return e}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=6378137*Math.PI,n=0;n<qh;n++)t[n]=e/(256*Math.pow(2,n));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"PRESET-VT-4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<qh;e++)t[e]=45/(128*Math.pow(2,e));return t}()}};Zh["EPSG:4490"]=Zh["EPSG:4326"],Zh["PRESET-3857-512"]=Zh["PRESET-VT-3857"],Zh["PRESET-4326-512"]=Zh["PRESET-VT-4326"],Zh["PRESET-4490-512"]=Zh["PRESET-VT-4326"];var Qh=function(){function t(t={}){this.options=t,this._initSpatialRef()}t.registerPreset=function(t,e){t=t&&t.toUpperCase(),Zh[t]&&console.warn("Spatial reference "+t+" already registered."),Zh[t]=e},t.getPreset=function(t){return Zh[t.toUpperCase()]},t.getAllPresets=function(){return Object.keys(Zh)},t.loadArcgis=function(t,e,n){return function(t,e,n={jsonp:!0}){if(c(t)&&"{"!==t.substring(0,1))Xe.getJSON(t,(function(t,n){if(t)e(t);else{var i=Wh(n);e(null,i)}}),n);else{c(t)&&(t=dt(t));var i=Wh(t);e(null,i)}}(t,e,n),this},t.loadWMTS=function(t,e,n){return Vh(t,e,n),this},t.getProjectionInstance=function(t){var e;if(!t)return null;if((e=c(t)?{code:t}:t).project)return e.locate||(e=s({},e),s(e,Ts.getInstance("identity"===e.measure?"IDENTITY":"EPSG:4326"))),e;var n=(e.code+"").toLowerCase();for(var i in ea)if(d(ea,i)){var r=ea[i].aliases||[],o=ea[i].code;o&&r.push(o);for(var a=0;a<r.length;a++)if(r[a].toLowerCase()===n){if(ea[i].create){var h=ea[i].create(t);return h.code=r[a],h}if(ea[i].code===r[a])return ea[i];var l=s({},ea[i]);return l.code=r[a],l}}return null},t.equals=function(t,e){if(c(t)||c(e))return t===e;if(!t&&!e)return!0;if(!t||!e)return!1;if(t.projection!==e.projection)return!1;var n=t.fullExtent,i=e.fullExtent;if(n&&!i||!n&&i)return!1;if(n&&i&&(n.top!==i.top||n.bottom!==i.bottom||n.left!==i.left||n.right!==i.right))return!1;var r=t.resolutions,o=e.resolutions;if(r&&o){if(r.length!==o.length)return!1;for(var s=0;s<r.length;s++)if(r[s]!==o[s])return!1}else if(r||o)return!1;return!0};var e=t.prototype;return e._initSpatialRef=function(){var e;if(!(e=this.options.projection?t.getProjectionInstance(this.options.projection):ta))throw new Error("must provide a valid projection in map's spatial reference.");(e=s({},ms,e)).measureLength||s(e,Cs),this._projection=e;var n,i=this.options.resolutions;if(!i&&(e.code&&(n=Zh[e.code.toUpperCase()])&&(i=n.resolutions,this.isEPSG="IDENTITY"!==e.code),!i))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=i,this._pyramid=!0,this._pyramid)for(var r=0;r<i.length;r++)if(i[r]&&i[r-1]&&Math.round(i[r-1]/i[r]*1e4)/1e4!=2){this._pyramid=!1;break}var o=this.options.fullExtent;if(!o&&(e.code&&(n=Zh[e.code.toUpperCase()])&&(o=n.fullExtent),!o))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(a(o.left)?(this._fullExtent=new fs(o),o.left=o.xmin,o.right=o.xmax,o.top=o.ymax,o.bottom=o.ymin):this._fullExtent=new fs(new $o(o.left,o.top),new $o(o.right,o.bottom)),a(o.top)||a(o.bottom)||a(o.left)||a(o.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");s(this._fullExtent,o),this._projection.fullExtent=o,this._transformation=new gs([o.right>=o.left?1:-1,o.top>=o.bottom?-1:1,0,0])},e.getResolutions=function(){return this._resolutions||[]},e.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var n=this._resolutions[e];return e!==t&&t>0&&e<this._resolutions.length-1?n+(this._resolutions[e+1]-n)*(t-e):n},e.getProjection=function(){return this._projection},e.getFullExtent=function(){return this._fullExtent},e.getTransformation=function(){return this._transformation},e.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!a(this._resolutions[t]))return t;return 0},e.getMaxZoom=function(){for(var t=this._resolutions.length-1;t>=0;t--)if(!a(this._resolutions[t]))return t;return this._resolutions.length-1},e.getZoomDirection=function(){return vt(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},e.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},e.isPyramid=function(){return this._pyramid},t}(),Xh=new ht(0,0),Yh=new ps,Jh={},Kh=function(t){function e(e){var n,i=s({},e),r=i.symbol,o=i.properties,l=i.id;return delete i.symbol,delete i.id,delete i.properties,n=t.call(this,i)||this,r?n.setSymbol(r):n._genSizeSymbol(),o&&n.setProperties(o),a(l)||n.setId(l),e&&h(e.rotateAngle)&&(n._dirtyRotate=!0),n}K(e,t),e.fromJSON=function(t){return t};var n=e.prototype;return n.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[0]}while(Array.isArray(e)&&e.length>0);return e},n.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[e.length-1]}while(Array.isArray(e)&&e.length>0);return e},n.addTo=function(t,e){return t.addGeometry(this,e),this},n.getLayer=function(){return this._layer?this._layer:null},n.getMap=function(){return this._layer?this._layer.getMap():null},n.getId=function(){return this._id},n.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},n.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},n.setProperties=function(t){var e=this.properties;return this.properties=u(t)?s({},t):t,this._clearAltitudeCache(),this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},n.getType=function(){return this.type},n.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?ti(t):s({},t):null},n.setSymbol=function(t){return this._symbolUpdated=t,this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},n.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=Kn(this._symbolUpdated)),this._symbolHash},n.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Parameter of updateSymbol is not an array.");for(var n=0;n<t.length;n++)Ra(t[n])&&delete this._textDesc,e[n]&&t[n]&&(e[n]=ti(e[n],t[n]))}else{if(Array.isArray(t))throw new Error("Geometry's symbol is not an array to update.");Ra(e)&&delete this._textDesc,e=ti(e||this._getInternalSymbol(),t)}return this._eventSymbolProperties=t,delete this._compiledSymbol,this.setSymbol(e)},n.getTextContent=function(){var t=this._getInternalSymbol();if(Array.isArray(t)){for(var e=[],n=!1,i=0;i<t.length;i++)e[i]=le(t[i]&&t[i].textName,this.getProperties()),a(e[i])||(n=!0);return n?e:null}return le(t&&t.textName,this.getProperties())},n.getTextDesc=function(){if(!this._textDesc){var t=this.getTextContent(),e=this._sizeSymbol,n=Array.isArray(t);this._textDesc=Array.isArray(e)?e.map((function(e,i){return ue(n?t[i]:"",e)})):ue(t,e)}return this._textDesc},n.getCenter=function(){return this._computeCenter(this._getMeasurer())},n.getExtent=function(){var t=this._getPrjExtent(),e=this._getProjection();if(t&&e){var n=e.unproject(new $o(t.xmin,t.ymin)),i=e.unproject(new $o(t.xmax,t.ymax));return new fs(n,i,e)}return this._computeExtent(this._getMeasurer())},n.getContainerExtent=function(t){var e=this.get2DExtent();if(!e||!e.isValid())return null;var n=this.getMap(),i=n.getGLRes(),r=this.getMinAltitude(),o=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,r,Xh)}),t),s=this.getMaxAltitude();if(s!==r){var a=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,s,Xh)}),Yh);o._combine(a)}var h=this.getLayer();if(h&&"LineString"===this.type&&s&&h.options.drawAltitude){var l=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,0,Xh)}),Yh);o._combine(l)}if(o){var u=this._getFixedExtent();(function(t){if(!t)return!1;var{xmin:e,ymin:n,xmax:i,ymax:r}=t;return i-e>0&&r-n>0})(u)&&o._add(u)}return this.options.smoothness&&o._expand(.15*o.getWidth()),o},n._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new ps);var t=this._sizeSymbol,e=(t&&t.lineWidth||1)/2;return this._fixedExtent.set(-e,-e,e,e),this._fixedExtent._add([t&&t.lineDx||0,0]),this._fixedExtent._add([0,t&&t.lineDy||0]),this._fixedExtent},n.get2DExtent=function(){var t=this.getMap();if(!t)return null;if(this._extent2d)return this._extent2d;var e=this._getPrjExtent();if(!e||!e.isValid())return null;var n=e.getMin(),i=e.getMax(),r=t.getGLRes();return t._prjToPointAtRes(n,r,n),t._prjToPointAtRes(i,r,i),this._extent2d=new ps(n,i),this._extent2d.z=t.getZoom(),this._extent2d},n.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},n.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof $o&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},n._containsPoint=function(t,e){var n=this._getPainter();return!!n&&(e=e||0,this._hitTestTolerance&&(e+=this._hitTestTolerance()),n.hitTest(t,e))},n.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},n.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},n.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(!this.symbolIsVisible())return!1;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,n=t.length;e<n;e++)if(a(t[e].opacity)||t[e].opacity>0)return!0;return!1}return a(t.opacity)||u(t.opacity)||h(t.opacity)&&t.opacity>0},n.symbolIsVisible=function(){var t=this._getCompiledSymbol();if(!t)return!0;Array.isArray(t)||(t=[t]);for(var e=0,n=t.length;e<n;e++){var i=t[e];if(i){var r=i.visible;if(!1!==r&&0!==r)return!0}}return!1},n.getZIndex=function(){return this.options.zIndex||0},n.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},n.setZIndexSilently=function(t){return this.options.zIndex=t,this},n.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},n.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},n.translate=function(t,e,n){if(a(t))return this;var i=new $o(t,e,n);if(0===i.x&&0===i.y&&(a(i.z)||0===i.z))return this;var r=this.getCoordinates();if(this._silence=!0,r)if(Array.isArray(r)){var o=mt(r,(function(t){return t.add(i)}));this.setCoordinates(o)}else this.setCoordinates(r.add(i));return this._silence=!1,this._fireEvent("positionchange"),this},n._translateRotatePivot=function(t){if(!this._pivot||!t)return this;if(this.options.rotatePivot){var e=this.getCoordinates();if(!e)return this;t instanceof $o||(t=new $o(t));var n=t.sub(e);if(0===n.x&&0===n.y)return this;this._pivot._add(n),this.options.rotatePivot=this._pivot.toArray()}return this},n.flash=function(t,e,n,i){return Nt.call(this,t,e,n,i)},n.copy=function(){var t=this.toJSON(),n=e.fromJSON(t);return n.options.visible=!0,n},n.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},n.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},n.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(a(t.geometry)||t.geometry){var n=this._exportGeoJSONGeometry();e.geometry=n}var i,r=this.getId();return a(r)||(e.id=r),(a(t.properties)||t.properties)&&(i=this._exportProperties()),e.properties=i,e},n.toJSON=function(t){t||(t={});var e=this._toJSON(t);return s(e,this._exportGraphicOptions(t)),e},n.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},n.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},n.rotate=function(t,e){if(!h(t))return console.error("angle:"+t+" is not number"),this;if(this._painter||(this._dirtyRotate=!0),"GeometryCollection"===this.type)return this.getGeometries().forEach((function(n){return n.rotate(t,e)})),this;e=e?new $o(e):this.getCenter(),this._angle=t,this._pivot=e;var n=this._getMeasurer(),i=this.getCoordinates();if(!Array.isArray(i)){if(e.x===i.x&&e.y===i.y||this.getShell)this.onPositionChanged();else{var r=n._rotate(i,e,t);this.setCoordinates(r)}return this.getShell&&(this.options.rotateAngle=t,this.options.rotatePivot=e.toArray()),this}return mt(i,(function(i){return n._rotate(i,e,t)})),this.setCoordinates(i),this},n._rotatePrjCoordinates=function(t){if(!t||0===this._angle||!this._pivot)return t;var e=this._getProjection();if(!e)return t;var n,i,r=0,o=Array.isArray(t),s=o?t:[t],a=[];if(this.getRotateOffsetAngle){r=this.getRotateOffsetAngle();var h=s[s.length-1];n=h.x,i=h.y}else{var l=Ti();Ei(s,l);var[u,c,A,f]=l;n=(u+A)/2,i=(c+f)/2}for(var d=0,p=s.length;d<p;d++){var g=s[d],{x:m,y:y}=g,v=m-n,_=y-i,x=Math.sqrt(v*v+_*_),b=(rl(n,i,m,y)-this._angle+r)/180*Math.PI,w=Math.cos(b)*x,C=Math.sin(b)*x,P=new $o(n+w,i+C);a.push(P)}for(var M=e.project(this._pivot),T=n-M.x,S=i-M.y,I=0,E=a.length;I<E;I++){var O=a[I];O.x-=T,O.y-=S}return o?a:a[0]},n.isRotated=function(){return!(!h(this._angle)||!this._pivot)},n._getConnectPoints=function(){return[this.getCenter()]},n._initOptions=function(t){var e=s({},t),n=e.symbol,i=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),n&&this.setSymbol(n),i&&this.setProperties(i),a(r)||this.setId(r)},n._bindLayer=function(t){if(t!==this.getLayer()){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._bindInfoWindow(),this._bindMenu()}},n._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(Zn(this._checkAndCopySymbol(t[n])));return e}return t?Zn(t=this._checkAndCopySymbol(t)):null},n._checkAndCopySymbol=function(t){var e={};for(var n in t)e[n]=Qt[n]&&c(t[n])?+t[n]:t[n];return e},n._getSymbol=function(){return this._symbol},n._setExternSymbol=function(t){return this._eventSymbolProperties=t,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},n._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},n._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},n._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},n._getInternalId=function(){return this._internalId},n._setInternalId=function(t){this._internalId=t},n._getMeasurer=function(){return this._getProjection()?this._getProjection():Qh.getProjectionInstance(this.options.defaultProjection)},n._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},n._verifyProjection=function(){var t=this._getProjection();this._projCode&&t&&this._projCode!==t.code&&this._clearProjection(),this._projCode=t?t.code:this._projCode},n._getExternalResources=function(){return qn(this._getInternalSymbol())},n._getPainter=function(){if(this._painter)return this._painter;var t=this.getLayer();if(!this._painter&&t)if(-1!==Vt.indexOf(this.type)){if(t.constructor.getCollectionPainterClass){var e=t.constructor.getCollectionPainterClass();e&&(this._painter=new e(this))}}else if(t.constructor.getPainterClass){var n=t.constructor.getPainterClass();n&&(this._painter=new n(this))}return this._painter},n._getMaskPainter=function(){return this._maskPainter||(this._maskPainter=this.getGeometries&&this.getGeometries()?new Nh(this,!0):new kh(this)),this._maskPainter},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},n._paint=function(t){if(this.symbolIsVisible()&&this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var e=this._getProjection();e&&(this._pcenter=e.project(this._coordinates),this._clearCache())}this._dirtyRotate&&h(this.options.rotateAngle)&&this.rotate(this.options.rotateAngle,this.options.rotatePivot),this._dirtyRotate=!1,this._painter.paint(t)}},n._clearCache=function(){delete this._extent,delete this._extent2d,this._clearAltitudeCache()},n._clearProjection=function(){delete this._extent,delete this._extent2d},n._repaint=function(){this._painter&&this._painter.repaint()},n.onHide=function(){this.closeMenu(),this.closeInfoWindow()},n.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},n.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},n.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var t={};this._eventSymbolProperties?(t.properties=JSON.parse(JSON.stringify(this._eventSymbolProperties)),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",t)},n._genSizeSymbol=function(){var t=this._getInternalSymbol();if(t)if(Array.isArray(t)){this._sizeSymbol=[];for(var e=!1,n=0;n<t.length;n++){var i=this._sizeSymbol[n]=this._getSizeSymbol(t[n]);!e&&i&&i._dynamic&&(e=!0)}this._sizeSymbol._dynamic=e}else this._sizeSymbol=this._getSizeSymbol(t);else delete this._sizeSymbol},n._getSizeSymbol=function(t){var e=Un({lineWidth:t.lineWidth,lineDx:t.lineDx,lineDy:t.lineDy},this);return(_n(t.lineWidth)||_n(t.lineDx)||_n(t.lineDy))&&(e._dynamic=!0),e},n._getCompiledSymbol=function(){return this._compiledSymbol||(this._compiledSymbol=Un(this._getInternalSymbol(),this)),this._compiledSymbol},n.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var n=!1;for(var i in t)if(t.hasOwnProperty(i)){var r=i.slice(0,5);if("arrow"===r||"smoot"===r){n=!0;break}}e?(this.setProperties(e),this._repaint()):n&&this._repaint()},n._setParent=function(t){t&&(this._parent=t)},n._getParent=function(){return this._parent},n._fireEvent=function(t,e){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e))},n._toJSON=function(t){return{feature:this.toGeoJSON(t)}},n._recordVisible=function(){var t=this.options.visible;a(t)&&(t=!0),this._savedVisible=t},n._recoveryVisible=function(){delete this._savedVisible},n._exportGraphicOptions=function(t){var e={};return(a(t.options)||t.options)&&(e.options=this.config()),e.options&&this.isEditing&&this.isEditing()&&(e.options.visible=this._savedVisible),(a(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(a(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},n._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=$o.toNumberArrays(t);return{type:this.getType(),coordinates:e}},n._exportProperties=function(){var t=null,e=this.getProperties();return a(e)||(t=u(e)?s({},e):e),t},n._hitTestTolerance=function(){return 0},n._getAltitude=function(){var t=this.getLayer();if(!t)return 0;var e=t.options,n=t.getAltitude?t.getAltitude():0,i=e.enableAltitude;if(!i&&t.isVectorLayer)return n;var r=$h(t),o=(this.properties||Jh)[r];if(a(o)){var s=tl(this,n,i);return a(s)?n:s}return Array.isArray(o)?o.map((function(t){return t+n})):o+n},n.getAltitude=function(){var t=$h(this.getLayer()),e=(this.properties||Jh)[t];if(!a(e))return e;var n=tl(this,0,!1);return a(n)?0:n},n.hasAltitude=function(){return this._genMinMaxAlt(),!!this._minAlt||!!this._maxAlt},n.setAltitude=function(t){if(!h(t))return this;var e=this.getLayer(),n=$h(e),i=this.properties||Jh,r=i[n];if(!a(r))if(Array.isArray(r))for(var o=0,s=r.length;o<s;o++)r[o]=t;else i[n]=t;var l=this.getCoordinates?this.getCoordinates():null;if(!l)return this;if(el(l,t),e){var u=e.getRenderer();u&&u.gl?this.setCoordinates(l):u&&this._repaint()}return this._clearAltitudeCache(),this.onPositionChanged(),this},n._genMinMaxAlt=function(){if(void 0===this._minAlt||void 0===this._maxAlt){var t=this._getAltitude(),[e,n]=qa(t);this._minAlt=e,this._maxAlt=n}},n.getMinAltitude=function(){return this._genMinMaxAlt(),this._minAlt},n.getMaxAltitude=function(){return this._genMinMaxAlt(),this._maxAlt},n._clearAltitudeCache=function(){return this._minAlt=void 0,this._maxAlt=void 0,this},n._getEditCenter=function(){var t=this.getCenter().copy();t.z=0;var e=this.getAltitude();if(h(e))return t.z=e,t;var n=0,i=0;return Array.isArray(e)&&(function t(e){for(var r=0,o=e.length;r<o;r++)Array.isArray(e[r])?t(e[r]):(i++,n+=e[r])}(e),t.z=n/i),t},e}(Zo(Do(Qo(Lo))));function $h(t){var e="altitude";if(t){if(!t.isVectorLayer)return null;e=t.options.altitudeProperty}return e}function tl(t,e,n){var i=t.getCoordinates?t.getCoordinates():null;if(i){var r=[];if(nl(i,r),r.length)return il(i,e,n)}return null}function el(t,e){if(Array.isArray(t))for(var n=0,i=t.length;n<i;n++)el(t[n],e);else t.z=e}function nl(t,e){if(!e.length)if(Array.isArray(t))for(var n=0,i=t.length;n<i;n++)nl(t[n],e);else h(t.z)&&e.push(t.z)}function il(t,e,n){if(Array.isArray(t)){for(var i=[],r=0,o=t.length;r<o;r++)i.push(il(t[r],e,n));return i}return h(t.z)?n?e+t.z:t.z:n?e:0}function rl(t,e,n,i){return t===n?i>e?-90:90:(n-=t,i=-(i-=e),Math.atan2(i,n)/Math.PI*180)}Kh.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"});var ol={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:!Q.mobile,maskClip:!0},sl=function(t){function e(e,n){var i,r;return n&&(r=n.canvas,delete n.canvas),(i=t.call(this,n)||this)._canvas=r,i.setId(e),n&&(i.setZIndex(n.zIndex),n.mask&&i.setMask(Kh.fromJSON(n.mask))),i.proxyOptions(),i}K(e,t);var n=e.prototype;return n.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();a(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},n.getId=function(){return this._id},n.setId=function(t){var e=this._id;return a(t)||(t+=""),this._id=t,this.fire("idchange",{type:"idchange",target:this,old:e,new:t}),this},n.addTo=function(t){return t.addLayer(this),this},n.setZIndex=function(t){return this._zIndex=t,a(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this.fire("setzindex",{type:"setzindex",target:this,zIndex:t}),this},n.getZIndex=function(){return this._zIndex||0},n.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},n.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),a(e)?1/0:e):e},n.getOpacity=function(){return this.options.opacity},n.setOpacity=function(t){return this.config("opacity",t),this.fire("setopacity",{type:"setopacity",target:this,opacity:t}),this},n.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof Aa},n.getMap=function(){return this.map?this.map:null},n.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},n.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var n=e.getZIndex();return this.setZIndex(n+1),this},n.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var n=e.getZIndex();return this.setZIndex(n-1),this},n.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var n=this.getMap();e&&n&&n.getRenderer()?n.getRenderer().callInNextFrame((function(){n.getRenderer().callInNextFrame((function(){t.fire("show")}))})):this.fire("show")}return this},n.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var n=this.getMap();e&&n&&n.getRenderer()?n.getRenderer().callInNextFrame((function(){n.getRenderer().callInNextFrame((function(){t.fire("hide")}))})):this.fire("hide")}return this},n.isVisible=function(){if(h(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!a(this.options.maxZoom)&&this.options.maxZoom<e||!a(this.options.minZoom)&&this.options.minZoom>e)return!1}return a(this.options.visible)&&(this.options.visible=!0),this.options.visible},n.remove=function(){if(this.map){var t=this.map.getRenderer();this.map.removeLayer(this),t&&t.setToRedraw()}else this.fire("remove");return this},n.getMask=function(){return this._mask},n.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type||"MultiPolygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(t._bindLayer(this),"Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=t,t&&t.toGeoJSON)try{this._maskGeoJSON=t.toGeoJSON()}catch(n){delete this._maskGeoJSON,console.error(n)}if(this.options.mask=t.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},n.removeMask=function(){if(delete this._mask,delete this._maskGeoJSON,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},n.onLoad=function(){return!0},n.onLoadEnd=function(){},n.isLoaded=function(){return!!this._loaded},n.getCollisionIndex=function(){if("layer"===this.options.collisionScope)return this._collisionIndex||(this._collisionIndex=new so),this._collisionIndex;var t=this.getMap();return t?t.getCollisionIndex():null},n.clearCollisionIndex=function(){return"layer"===this.options.collisionScope&&this._collisionIndex&&this._collisionIndex.clear(),this},n.getRenderer=function(){return this._getRenderer()},n.onConfig=function(t){if(t&&Object.keys&&Object.keys(t).length>0&&a(t.animation)){if(this._optionsHook&&A(this._optionsHook)&&this._optionsHook(t),this._silentConfig)return;var e=this.getRenderer();if(e&&e.setToRedraw&&e.setToRedraw(),"attribution"in t){var n=this.getMap();n&&n.attributionControl&&n.attributionControl._update&&n.attributionControl._update()}}},n.onAdd=function(){},n.onRendererCreate=function(){},n.onCanvasCreate=function(){},n.onRemove=function(){},n._bindMap=function(t,e){t&&(this.map=t,a(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},n._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{type:"renderercreate",target:this,renderer:this._renderer})}},n._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},n._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()&&this.getMap()[t](e.getEvents(),e)},n._getRenderer=function(){return this._renderer},n._getLayerList=function(){if(!this.map)return[];var t=+!!this.map.getBaseLayer();return this.map.getLayers().slice(t)},n._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getMaskPainter();return t?t.get2DExtent():null},n.toJSON=function(t){return{type:"Layer",id:this.getId(),options:t||this.config()}},e.fromJSON=function(t){if(!t)return null;var n=t.type,i=e.getJSONClass(n);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+n);return i.fromJSON(t)},e}(Zo(Do(na(Lo))));sl.mergeOptions(ol);var al=sl.prototype.fire;sl.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={type:null,target:null}),e.type=t,e.target=this,this.map._onLayerEvent(e)),al.apply(this,arguments),["show","hide"].indexOf(t)>-1&&this.fire("visiblechange",Object.assign({},e,{visible:this.options.visible})),this};var hl=new $o(0,0),ll=new ht(0,0),ul=["centerCross","fog","fogColor","debugSky"],cl={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!n,zoomAnimationDuration:330,panAnimation:!n,panAnimationDuration:600,rotateAnimation:!n,zoomable:!0,enableInfoWindow:!0,hitDetect:!Q.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,limitExtentOnMaxExtent:!1,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0,preventWheelScroll:!0,preventTouch:!0,supportPluginEvent:!0,switchDragButton:!1,mousemoveThrottleTime:48,maxFPS:0,debug:!1,cameraFarUndergroundInMeter:2e3},Al=function(t){function e(n,i){var r;if(!i)throw new Error("Invalid options when creating map.");if(!i.center)throw new Error("Invalid center when creating map.");var o=s({},i),a=o.zoom;delete o.zoom;var h=new $o(o.center);delete o.center;var l=o.baseLayer;delete o.baseLayer;var u=o.layers;return delete o.layers,(r=t.call(this,o)||this).VERSION=e.VERSION,Object.defineProperty(r,"id",{value:At(),writable:!1}),r._loaded=!1,r._initContainer(n),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=a,r._center=h,r._centerZ=h.z,r.setSpatialReference(o.spatialReference||o.view),r._mapViewPoint=new ht(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),l&&r.setBaseLayer(l),u&&r.addLayer(u),r.setMaxExtent(o.maxExtent),r._Load(),r.proxyOptions(),r.isMap=!0,r}K(e,t),e.addOnLoadHook=function(t,...e){var n="function"==typeof t?t:function(){this[t].call(this,...e)};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(n),this};var i=e.prototype;return i.isLoaded=function(){return!!this._loaded},i.getContainer=function(){return this._containerDOM},i.getSpatialReference=function(){return this._spatialReference},i.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&Qh.equals(e,t)||this._updateSpatialReference(t,e),this},i._updateSpatialReference=function(t,e){c(t)&&(t=Qh.getPreset(t)),t=s({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new Qh(t);var n=this._spatialReference.getProjection();return this.options.spatialReference&&A(this.options.spatialReference.projection)&&(this.options.spatialReference.projection=n.code),this._resetMapStatus(),Xs.is(n.code)&&(this._originLng=n.centralMeridian,this._altitudeOriginDirty=!0),this._fireEvent("spatialreferencechange",{old:e,new:s({},this.options.spatialReference)}),this},i.onConfig=function(t){var e=t.spatialReference||t.view;a(e)||this._updateSpatialReference(e,null);for(var n=!1,i=0,r=ul.length;i<r;i++)if(!a(t[ul[i]])){n=!0;break}if(!n)return this;var o=this.getRenderer();return o&&o.setToRedraw(),this},i.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},i.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},i.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},i.resetCursor=function(){return this.setCursor(null)},i.getCenter=function(){if(!this._loaded||!this._prjCenter)return this._center;var t=this.getProjection().unproject(this._prjCenter);return t.x=Math.round(1e8*t.x)/1e8,t.y=Math.round(1e8*t.y)/1e8,t.z=this._centerZ,this.centerAltitude&&(t.z=this.centerAltitude),t},i.setCenter=function(t,e){if(!t)return this;t=new $o(t),e&&(t=this._getCenterByPadding(t,this.getZoom(),e));var n=this.getProjection().project(t);return this._verifyExtent(n)||this.options.limitExtentOnMaxExtent?this._loaded?(this._centerZ=t.z,this.onMoveStart(),this._setPrjCenter(n),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},i.getSize=function(){return a(this.width)||a(this.height)?this._getContainerDomSize():new Jt(this.width,this.height)},i.getContainerExtent=function(){var t=this.height,e=this.getPitch(),n=this.options.maxVisualPitch;return n&&e>n&&(t=this._getVisualHeight(n)),new ps(0,this.height-t,this.width,this.height)},i._getVisualHeight=function(t){t=t||.01;var e=(90-this.getPitch())*Math.PI/180,n=this.getFov()*Math.PI/180;t*=Math.PI/180;var i=this.cameraCenterDistance/this.getGLScale(),r=Math.tan(n/2),o=i*r/(1/Math.tan(t)-r)/Math.sin(t),s=i*(Math.sin(e)*o/(i+Math.cos(e)*o));return this.height/2+s},i.getExtent=function(){return this.pointToExtent(this.get2DExtent())},i.getProjExtent=function(){var t=this.get2DExtent();return new fs(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},i.getPrjExtent=function(){return this.getProjExtent()},i.getMaxExtent=function(){return this.options.maxExtent?new fs(this.options.maxExtent,this.getProjection()):null},i.setMaxExtent=function(t){if(t){var e=new fs(t,this.getProjection());this.options.maxExtent=e;var n=this.getProjection();this._prjMaxExtent=e.convertTo((function(t){return n.project(t)})),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=n.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},i.getZoom=function(){return this._zoomLevel},i.getZoomForScale=function(t,e,n){var i=this.getZoom();if(a(e)&&(e=i),1===t&&e===i)return i;var r=this._getResolution(e),o=this.getZoomFromRes(r/t);if(n)return o;var s=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(o-s):Math.floor(o+s)},i.getZoomFromRes=function(t){var e=this._getResolutions(),n=this._getResolution(this.getMinZoom()),i=this._getResolution(this.getMaxZoom());if(n<=i){if(t<=n)return this.getMinZoom();if(t>=i)return this.getMaxZoom()}else{if(t>=n)return this.getMinZoom();if(t<=i)return this.getMaxZoom()}for(var r=e.length,o=0;o<r-1;o++)if(e[o]){var s=e[o+1]-e[o],a=t-e[o];if(vt(s)===vt(a)&&Math.abs(s)>=Math.abs(a))return o+a/s}return r-1},i.setZoom=function(t,e={animation:!0}){return isNaN(t)||a(t)||(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t)),this},i.getMaxZoom=function(){return a(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},i.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),null!==t&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},i.getMinZoom=function(){return a(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},i.setMinZoom=function(t){if(null!==t){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},i.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},i.getGLRes=function(){if(this._glRes)return this._glRes;var t=this.getSpatialReference().getFullExtent();return this._glRes=(t.right-t.left)/Math.pow(2,19),this._glRes},i.getGLScale=function(t){return a(t)&&(t=this.getZoom()),this._getResolution(t)/this.getGLRes()},i.zoomIn=function(){return this.setZoom(this.getZoom()+1)},i.zoomOut=function(){return this.setZoom(this.getZoom()-1)},i.isZooming=function(){return!!this._zooming},i.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},i.setCenterAndZoom=function(t,e){return a(e)||this._zoomLevel===e?this.setCenter(t):(this.setCenter(t),this.setZoom(e,{animation:!1})),this},i._getPaddingSize=function(t={}){return t.paddingLeft||t.paddingTop||t.paddingRight||t.paddingBottom?{width:(t.paddingLeft||0)+(t.paddingRight||0),height:(t.paddingTop||0)+(t.paddingBottom||0)}:null},i.getFitZoom=function(t,e,n){var i=this;if(!(t&&t instanceof fs))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var r=this.getSize(),o=this._getPaddingSize(n);if(o){var s={width:r.width-(o.width||0),height:r.height-(o.height||0)};r=new Jt(s.width,s.height)}var a=t.convertTo((function(t){return i.coordToPoint(t)})),h=a.getWidth(),l=a.getHeight(),u=r.width/h,c=r.height/l,A=this.getSpatialReference().getZoomDirection()<0?Math.max(u,c):Math.min(u,c);return this.getZoomForScale(A,null,e)},i.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},i._validateView=function(t){if(t&&u(t)){if(h(t.bearing)){var e=t.bearing;(e%=360)>180&&(e=-180+Math.abs(e-180)),e<-180&&(e=180-Math.abs(e+180)),t.bearing=e}h(t.pitch)&&(t.pitch=Math.max(0,t.pitch),t.pitch=Math.min(this.options.maxPitch,t.pitch));var n=this.getMaxZoom();h(t.zoom)&&(t.zoom=Math.max(0,t.zoom),t.zoom=Math.min(n,t.zoom))}},i.setView=function(t){return t?(this._validateView(t),t.center&&this.setCenter(t.center),null===t.zoom||isNaN(+t.zoom)||this.setZoom(+t.zoom,{animation:!1}),null===t.pitch||isNaN(+t.pitch)||this.setPitch(+t.pitch),null===t.bearing||isNaN(+t.bearing)||this.setBearing(+t.bearing),this):this},i.getResolution=function(t){return this._getResolution(t)},i.getScale=function(t){var e=a(t)?this.getZoom():t,n=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/n},i._getCenterByPadding=function(t,e,n){var i=this.coordinateToPoint(t,e),{paddingLeft:r=0,paddingRight:o=0,paddingTop:s=0,paddingBottom:a=0}=n||{},h=0,l=0;(r||o)&&(h=(o-r)/2),(s||a)&&(l=(s-a)/2);var u=new ht({x:i.x+h,y:i.y+l});return this.pointToCoordinate(u,e)},i.fitExtent=function(t,e,n,i){if(n=n||{},!t)return this;t=new fs(t,this.getProjection());var r=this.getFitZoom(t,n.isFraction||!1,n)+(e||0),o=t.getCenter();return this._getPaddingSize(n)&&(o=this._getCenterByPadding(o,r,n)),void 0===n.animation||n.animation?this._animateTo({center:o,zoom:r},{duration:n.duration||this.options.zoomAnimationDuration,easing:n.easing||"out"},i):this.setCenterAndZoom(o,r)},i.getBaseLayer=function(){return this._baseLayer},i.setBaseLayer=function(t){var e=!1;return this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),t?(this._baseLayer=t,t._bindMap(this,-1),this._baseLayer.on("layerload",(function(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))}),this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this):(delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this)},i.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},i.getLayers=function(t){return this._getLayers((function(e){return!(e===this._baseLayer||e.getId().indexOf(Gt)>=0)&&(!t||t(e))}))},i.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var n=this.getBaseLayer();return n&&n.getId()===t?n:null},i.addLayer=function(t,...e){if(!t)return this;Array.isArray(t)||(t=[t]),e&&e.length&&(t=t.concat(e)),this._layerCache||(this._layerCache={});for(var n=this._layers,i=0,r=t.length;i<r;i++){var o=t[i],s=o.getId();if(a(s))throw new Error("Invalid id for the layer: "+s);if(o.getMap()!==this){if(this._layerCache[s])throw new Error("Duplicate layer id in the map: "+s);this._layerCache[s]=o,o._bindMap(this),n.push(o),this._loaded&&o.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},i.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];if(r instanceof sl||(r=this.getLayer(r)),r){var o=r.getMap();if(o&&o===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var s=r.getId();this._layerCache&&delete this._layerCache[s]}}}if(e.length>0){var a=this.getRenderer();a&&a.setLayerCanvasUpdated(),this.once("frameend",(function(){e.forEach((function(t){t.fire("remove")}))}))}return this._fireEvent("removelayer",{layers:t}),this},i.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],n=Number.MAX_VALUE,i=0,r=t.length;i<r;i++){var o=t[i];if(c(t[i])&&(o=this.getLayer(o)),!(o instanceof sl&&o.getMap()&&o.getMap()===this))throw new Error("It must be a layer added to this map to order.");o.getZIndex()<n&&(n=o.getZIndex()),e.push(o)}for(var s=0,a=e.length;s<a;s++)e[s].setZIndex(n+s);return this},i.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var n=t.save,i=this._getRenderer();if(i&&i.toDataURL){var r=t.fileName;r||(r="export");var o=i.toDataURL(e,t.quality||.92);if(n&&o){var s;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var a=Rt(o.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),e);s=URL.createObjectURL(a)}else s=o;var h=document.createElement("a");h.download=r,h.href=s,document.body.appendChild(h),h.click(),document.body.removeChild(h)}return o}return null},i.coordToPoint=function(t,e,n){return this.coordinateToPoint(t,e,n)},i.coordToPointAtRes=function(t,e,n){return this.coordinateToPointAtRes(t,e,n)},i.pointToCoord=function(t,e,n){return this.pointToCoordinate(t,e,n)},i.pointAtResToCoord=function(t,e,n){return this.pointAtResToCoordinate(t,e,n)},i.coordToViewPoint=function(t,e,n){return this.coordinateToViewPoint(t,e,n)},i.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},i.coordToContainerPoint=function(t,e,n){return this.coordinateToContainerPoint(t,e,n)},i.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},i.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},i.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},i.checkSize=function(t){var e=o()-this._initTime<1500&&0===this.width||0===this.height,n=this._getContainerDomSize(),i=this.height,r=this.width;if(!t&&n.width===r&&n.height===i)return this;De(this._containerDOM);var s=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(n);else{var a=this._getVisualHeight(this.getPitch()),h=new ht(0,this.height-a),l=this._containerPointToPrj(h);this._updateMapSize(n);var u=this._getVisualHeight(this.getPitch()),c=new ht(0,this.height-u);this._setPrjCoordAtContainerPoint(l,c),this._mapViewCoord=this._getPrjCenter()}return(e||0===n.width||0===n.height||0===r||0===i)&&(this._eventSilence=!0,this.setCenter(s),delete this._eventSilence),this._fireEvent("resize"),this},i.locate=function(t,e,n){return this.getProjection()._locate(new $o(t),e,n)},i.getMainPanel=function(){var t=this._getRenderer();return t?t.getMainPanel():null},i.getPanels=function(){return this._panels},i.remove=function(){var t=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var e=this.getLayers(),n=0;n<e.length;n++)e[n].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter((function(t){return"maptalks-wrapper"===t.className})).forEach((function(e){return t._containerDOM.removeChild(e)})),delete this._panels,delete this._containerDOM,delete this._renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},i.isRemoved=function(){return!this._containerDOM},i.isMoving=function(){return!!this._moving},i.onMoveStart=function(t){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var e=this._getPrjCenter();this._originCenter&&!this._verifyExtent(e)||(this._originCenter=e),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},i.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving")),this._limitMaxExtent()},i.onMoveEnd=function(t){this._moving=!1,this._suppressRecenter||this._recenterOnTerrain(),this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),this._verifyExtent(this._getPrjCenter())||!this._originCenter||this.options.limitExtentOnMaxExtent||this._panTo(this._originCenter),this._limitMaxExtent()},i.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},i.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},i.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},i.isDragRotating=function(){return!!this._dragRotating},i.isOffscreen=function(t,e=0){var{width:n,height:i}=this,r=n+e,o=i+e,{xmin:s,ymin:a,xmax:h,ymax:l}=t;return Array.isArray(t)&&([s,a,h,l]=t),h<e||s>=r||l<e||a>o},i.getRenderer=function(){return this._getRenderer()},i.getDevicePixelRatio=function(){return this.options.devicePixelRatio||Q.devicePixelRatio||1},i.setDevicePixelRatio=function(t){return h(t)&&t>0&&t!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=t,this.checkSize(!0)),this},i._initContainer=function(t){if(c(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,n&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},i._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},i._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},i._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},i._removeLayer=function(t,e){if(t&&e){var n=e.indexOf(t);n>-1&&e.splice(n,1)}},i._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++){var n=this._layers[t];n._order=t,n.sortLayersByZIndex&&n.sortLayersByZIndex()}this._layers.sort((function(t,e){var n=t.getZIndex()-e.getZIndex();return 0===n?t._order-e._order:n}))}},i._fireEvent=function(t,e){this._eventSilence||("_"!==t[0]&&this.fire("_"+t,e),this.fire(t,e))},i._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=o()},i._initRenderer=function(){var t=e.getRendererClass(this.options.renderer);this._renderer=new t(this),this._renderer.load()},i._getRenderer=function(){return this._renderer},i._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer((function(t){t&&t.load()}),this.getLayers())},i._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,n=[],i=0;i<e.length;i++)t&&!t.call(this,e[i])||n.push(e[i]);return n},i._eachLayer=function(t,...e){if(!(arguments.length<2)){e&&!Array.isArray(e)&&(e=[e]);for(var n=[],i=0,r=e.length;i<r;i++)n=n.concat(e[i]);for(var o=0,s=n.length;o<s;o++)t.call(t,n[o])}},i._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},i._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),n=this._spatialReference.getMaxZoom(),i=this._spatialReference.getMinZoom();(a(t)||-1===t||t>n)&&this.setMaxZoom(n),(a(e)||-1===e||e<i)&&this.setMinZoom(i),(t=this.getMaxZoom())<(e=this.getMinZoom())&&this.setMaxZoom(e),(a(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter,delete this._glRes;var r=this.getProjection();this._prjCenter=r.project(this._center),this._prjCenter.z=this._center.z,this._calcMatrices();var o=this._getRenderer();o&&o.resetContainer()},i.setContainerDomRect=function(t){this._containerDomContentRect=t},i._getContainerDomSize=function(){if(!this._containerDOM)return null;var t,e,n=this._containerDOM;if(this._containerDomContentRect)return new Jt(t=this._containerDomContentRect.width,e=this._containerDomContentRect.height);var i=n;if(a(i.width)||a(i.height)){if(a(n.clientWidth)||a(n.clientHeight))throw new Error("can not get size of container");t=parseInt(n.clientWidth+"",0),e=parseInt(n.clientHeight+"",0)}else{t=i.width,e=i.height;var r=this.getDevicePixelRatio();1!==r&&n.layer&&(t/=r,e/=r)}return new Jt(t,e)},i._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},i._getPrjCenter=function(){return this._prjCenter},i._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},i._setPrjCoordAtContainerPoint=function(t,e){if(!this.centerAltitude&&e.x===this.width/2&&e.y===this.height/2)return this;var n=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),i=this._pointToPrj(this._prjToPoint(t)._sub(n));return this._setPrjCenter(i),this},i._setPrjCoordAtOffsetToCenter=function(t,e){var n=this._pointToPrj(this._prjToPoint(t)._sub(e));return this._setPrjCenter(n),this},i._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return!e||e.contains(t)},i._limitMaxExtent=function(){var t=this;if(this._limitMaxExtenting||!this.options.limitExtentOnMaxExtent)return this;var e=this._prjMaxExtent,n=this.getMaxExtent();if(!e||!n)return this;var i=e.toArray().map((function(e){return t.prjToContainerPoint(e)})),r=Ti();Ei(i,r);var{width:o,height:s}=this.getSize(),a=[0,0,o,s];if(Li(a,r))return this;if(Li(r,a))return this;var h=0,l=0,u=0,c=0,A=0,f=0,d=Math.abs,[p,g,m,y]=r;if(p>0&&m>o&&(h=u=d(p)),p<0&&m<o&&(h=u=-d(p)),p<0&&m<o&&(h=c=-d(o-m)),p>0&&m>o&&(h=c=d(o-m)),g>0&&y>s&&(l=A=d(g)),g<0&&y<s&&(l=A=-d(g)),g<0&&y<s&&(l=f=-d(s-y)),g>0&&y>s&&(l=f=d(s-y)),0!==u&&0!==c&&(h=u,d(c)<d(u)&&(h=c)),0!==A&&0!==f&&(l=A,d(f)<d(A)&&(l=f)),0!==h||0!==l){var v=new ht(o/2+h,s/2+l),_=this.containerPointToCoord(v);this._limitMaxExtenting=!0,this.setCenter(_),this._limitMaxExtenting=!1}return this},i._offsetCenterByPixel=function(t){var e=ll.set(this.width/2-t.x,this.height/2-t.y),n=this._containerPointToPrj(e,hl),i=ll.set(this.width/2,this.height/2);this._setPrjCoordAtContainerPoint(n,i)},i.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this._mapViewPoint):this._mapViewPoint},i.getViewPoint=function(){var t=this.getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},i._resetMapViewPoint=function(){this._mapViewPoint=new ht(0,0),this._mapViewCoord=this._getPrjCenter()},i._getResolution=function(t){return void 0!==t&&t!==this._zoomLevel||void 0===this._mapRes?(a(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t)):this._mapRes},i._getResolutions=function(){return this._spatialReference.getResolutions()},i._prjToPoint=function(t,e,n){e=a(e)?this.getZoom():e;var i=this._getResolution(e);return this._prjToPointAtRes(t,i,n)},i._prjToPointAtRes=function(t,e,n){return this._spatialReference.getTransformation().transform(t,e,n)},i._prjsToPointsAtRes=function(t,e,n=[]){for(var i=this._spatialReference.getTransformation(),r=[],o=0,s=t.length;o<s;o++){var a=i.transform(t[o],e,n[o]);r.push(a)}return r},i._pointToPrj=function(t,e,n){e=a(e)?this.getZoom():e;var i=this._getResolution(e);return this._pointToPrjAtRes(t,i,n)},i._pointToPrjAtRes=function(t,e,n){return this._spatialReference.getTransformation().untransform(t,e,n)},i._pointToPoint=function(t,e,n){return a(e)?(n?(n.x=t.x,n.y=t.y):n=t.copy(),n):this._pointAtResToPoint(t,this._getResolution(e),n)},i._pointAtResToPoint=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(e/this._getResolution())},i._pointToPointAtRes=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(this._getResolution()/e)},i._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},i._callOnLoadHooks=function(){var t=e.prototype;if(t._onLoadHooks)for(var n=0,i=t._onLoadHooks.length;n<i;n++)t._onLoadHooks[n].call(this)},i._fixPrjOnWorldWide=function(t){var e=this.getProjection();if(e&&e.fullExtent&&t){var{left:n,bottom:i,top:r,right:o}=e.fullExtent||{};h(n)&&(t.x=Math.max(n,t.x)),h(o)&&(t.x=Math.min(o,t.x)),h(i)&&(t.y=Math.max(i,t.y)),h(r)&&(t.y=Math.min(r,t.y))}return this},i.toJSON=function(t){t||(t={});var e={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};e.options=this.config(),e.options.center=this.getCenter(),e.options.zoom=this.getZoom(),e.options.bearing=this.getBearing(),e.options.pitch=this.getPitch();var n=this.getBaseLayer();(a(t.baseLayer)||t.baseLayer)&&n&&(e.baseLayer=n.toJSON(t.baseLayer));var i={};t.clipExtent&&(i.clipExtent=!0===t.clipExtent?this.getExtent():t.clipExtent);var r=[];if(a(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var o=this.getLayers(),h=0,l=o.length;h<l;h++)if(o[h].toJSON){var c=s({},u(t.layers)?t.layers:{},i);r.push(o[h].toJSON(c))}e.layers=r}else if(wt(t.layers)){for(var A=t.layers,f=0;f<A.length;f++){var d=A[f],p=this.getLayer(d.id);if(p.toJSON){var g=s({},d.options,i);r.push(p.toJSON(g))}}e.layers=r}else e.layers=[];return e},e.fromJSON=function(t,n,i){if(!t||!n)return null;i||(i={});var r=new e(t,n.options);if(a(i.baseLayer)||i.baseLayer){var o=sl.fromJSON(n.baseLayer);o&&r.setBaseLayer(o)}if(a(i.layers)||i.layers){for(var s=[],h=n.layers,l=0;l<h.length;l++){var u=sl.fromJSON(h[l]);s.push(u)}r.addLayer(s)}return r},e}(Qo(Do(na(Lo))));Al.mergeOptions(cl);var fl=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},n.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},n._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var n=e.getZoom(),i=t.domEvent.shiftKey?Math.ceil(n)-1:Math.floor(n)+1;e._zoomAnimation(i,t.containerPoint)}},e}(ko);Al.mergeOptions({doubleClickZoom:!0}),Al.addOnLoadHook("addHandler","doubleClickZoom",fl);var dl=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.addHooks=function(){var t=this.target;if(t){var e=t.getPanels().mapWrapper||t.getContainer();this._dragHandler=new Ko(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},n.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},n._cancelOn=function(t){return!(!this.target.isZooming()&&!this._ignore(t))},n._ignore=function(t){return!!t&&(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t))},n._onMouseDown=function(t){delete this.startDragTime,delete this._mode;var e=this.target.options.switchDragButton;e&&"touchstart"===t.domEvent.type||t.domEvent.button===(e?0:2)||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),Ie(t.domEvent)},n._onDragStart=function(t){this.startDragTime=o(),"move"===this._mode?this._moveStart(t):"rotatePitch"===this._mode&&this._rotateStart(t)},n._onDragging=function(t){"move"===this._mode?this._moving(t):"rotatePitch"===this._mode&&this._rotating(t)},n._onDragEnd=function(t){"move"===this._mode?this._moveEnd(t):"rotatePitch"===this._mode&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},n._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},n._moveStart=function(t){delete this.startContainerPoint,this._start(t);var e=this.target;e.onMoveStart(t);var n=ke(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=e.queryPrjCoordAtContainerPoint(n),e._isContainerPointOutOfMap(n)&&void 0===this.startPrjCoord.z&&(this.startContainerPoint=n)},n._moving=function(t){if(this.startDragTime){var e=this.target,n=ke(e._getActualEvent(t.domEvent),e.getContainer());if(this.startContainerPoint){var i=n._sub(this.startContainerPoint);n.set(e.width/2+i.x,e.height/2+i.y)}var r=e._containerPointToPoint(n,void 0,void 0,this.startPrjCoord.z)._sub(e._prjToPoint(e._getPrjCenter()));e._setPrjCoordAtOffsetToCenter(this.startPrjCoord,r),e.onMoving(t)}},n._moveEnd=function(t){if(this.startDragTime){var e="touchend"===t.domEvent.type,n=this.target,i=o()-this.startDragTime,r=t.mousePos.x-this.startX,s=t.mousePos.y-this.startY,a=n._getPrjCenter(),h=a.sub(this._startPrjCenter);if(this._clear(),n.options.panAnimation&&!t.interupted&&n._verifyExtent(n._getPrjCenter())&&i<280&&Math.abs(s)+Math.abs(r)>5){i*=5;var l=a.add(h._multi(e?5:2.8));n._panTo(l,{duration:e?3*i:2*i,easing:n.options.dragPanEasing||"outExpo"})}else n.onMoveEnd(t)}},n._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},n._rotating=function(t){var e=this.target,n=t.mousePos.x,i=t.mousePos.y,r=e.getPitch(),o=e.getBearing(),s=Math.abs(n-this.preX),a=Math.abs(i-this.preY);if(this._rotateMode||(this._rotateMode=e.options.dragRotatePitch?"rotate_pitch":s>a?"rotate":s<a?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&a<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var h=.15,l=0;l=e.options.dragPitch||s>a?-.15*(this.preX-n):n>e.width/2?h*(this.preY-i):-.15*(this.preY-i);var u=e.getBearing()+l;this._db=this._db||0,this._db+=l,e._setBearing(u)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e._setPitch(e.getPitch()+.15*(this.preY-i)),this.preX=n,this.preY=i,e.getBearing()===o&&e.getPitch()===r||e.onDragRotating(t)}},n._rotateEnd=function(t){var e=this.target,n=e.getBearing();this._clear();var i=o()-this.startDragTime;if(e.onDragRotateEnd(t),e.options.rotateAnimation&&Math.abs(n-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!t.interupted&&i<400){var r=e.getBearing();e._animateTo({bearing:r+this._db/1.5},{easing:"outQuint",duration:1600})}},n._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},e}(ko);Al.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),Al.addOnLoadHook("addHandler","draggable",dl);var pl="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend mouseout",gl={mousemove:["mousemove","mouseover","mouseout","mouseenter"],touchend:["touchend","click"]},ml=function(t){return t&&t.getLayer&&t.on&&t.fire},yl=function(t,e,n){if(t._onEvent)return t._onEvent(e,n);var i=t.getLayer();return i&&i.fireGeoEvent?i.fireGeoEvent(t,e,n):null},vl=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.addHooks=function(){var t=this.target,e=t.getPanels().allLayers||t.getContainer();Ve(e,pl,this._identifyGeometryEvents,this)},n.removeHooks=function(){var t=this.target,e=t.getPanels().allLayers||t.getContainer();We(e,pl,this._identifyGeometryEvents)},n._identifyGeometryEvents=function(t,e){var n=this.target;if(!n.isInteracting()&&!n._ignoreEvent(t)){var i=null,s=e||t.type;if(qe(s)&&!r.isTest&&Ze(this,n.options.mousemoveThrottleTime))Ee(t);else{var a="mousedown"===s||"touchstart"===s&&t.touches&&1===t.touches.length;if(a)this._mouseDownTime=o();else if(("click"===s||"touchend"===s)&&this._mouseDownTime){var h=this._mouseDownTime;if(delete this._mouseDownTime,o()-h>300){if("click"===s)return}else"touchend"===s&&(i="click")}var l=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(l){var u=ke(l,n.getContainer());"touchstart"===s&&n.options.preventTouch&&Ie(t);for(var c=null,A=this.target.getRenderer().getTopElements(),f=a&&2!==t.button,d=0;d<A.length;d++)if(A[d].hitTest(u)){var p=A[d].options.cursor;if(p&&(c=p),f||A[d].events&&A[d].events.indexOf(s)>=0){var g={target:n,type:s,domEvent:t,containerPoint:u};if(f)return n._setPriorityCursor(c),void A[d].mousedown(g);A[d].onEvent(g)}}var m=n._getLayers((function(t){return!(!t.identify||!t.options.geometryEvents)}));if(m.length){var y={includeInternals:!0,filter:function(e){if(e instanceof Kh){var n=e._getEventTypeToFire(t);return"mousemove"===s?(!c&&e.options.cursor&&(c=e.options.cursor),!0):!(!e.listens(n)&&!e.listens(i))}return!!ml(e)},count:1,onlyVisible:n.options.onlyVisibleGeometryEvents,containerPoint:u,layers:m,eventTypes:gl[s]||[s],domEvent:t},v=function(e){var r,o=this,a=!0,h=function(){return o._prevOverGeos&&o._prevOverGeos.geos||[]},l=function(e=[],n=[]){if(e&&e.length>0)for(var i=e.length-1;i>=0;i--){var r=e[i];ml(r)&&-1===n.indexOf(r)&&(a=yl(r,t,"mouseout"))}};if("mouseout"===s){var u=h();this._prevOverGeos={geos:[],geomap:{}},l(u,[])}else if("mousemove"===s){var A={};if(e.length>0)for(var f=e.length-1;f>=0;f--){var d=e[f];if(ml(d)){var p=(r=d)._getInternalId?r._getInternalId():r.getId?r.getId():null;A[p]=d,yl(d,t),this._prevOverGeos&&this._prevOverGeos.geomap[p]||yl(d,t,"mouseenter"),a=yl(d,t,"mouseover")}}n._setPriorityCursor(c);var g=h();this._prevOverGeos={geos:e,geomap:A},l(g,e)}else{if(!e||!e.length)return;for(var m=e.length-1;m>=0;m--)if(ml(e[m])){a=yl(e[m],t),i&&yl(e[m],t,i);break}}!1===a&&Ee(t)}.bind(this);qe(s)?this._queryIdentifyTimeout=n.getRenderer().callInNextFrame((function(){n.isInteracting()||n.identifyAtPoint(y,v)})):n.identifyAtPoint(y,v)}}}}},e}(ko);Al.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),Al.addOnLoadHook("addHandler","geometryEvents",vl);var _l=4.000244140625,xl=1/450,bl=function(t){function e(e){var n;return(n=t.call(this,e)||this)._thisScrollZoom=n._scrollZoom.bind(n),n._thisCheckIfEndZoom=n._checkIfEndZoom.bind(n),n._wheelZoomRate=xl,n._defaultZoomRate=.01,n._delta=0,n}K(e,t);var n=e.prototype;return n.addHooks=function(){Me(this.target._containerDOM,"wheel",this._onWheelScroll,this)},n.removeHooks=function(){Te(this.target._containerDOM,"wheel",this._onWheelScroll)},n._currentZoomCanScroll=function(t){if(h(t)){var e=this.target,n=e.getZoom(),i=e.getMinZoom(),r=e.getMaxZoom();if(n===i&&t>0)return!1;if(n===r&&t<0)return!1}return!0},n._onWheelScroll=function(t){var e=this.target;if(e.options.preventWheelScroll&&(Ie(t),Ee(t)),e._ignoreEvent(t)||!e.options.zoomable)return!1;var n=e.getContainer(),i=e._checkZoomOrigin(ke(t,n));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,i)):this._interval(t,i)},n._seamless=function(t,e){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*t.deltaY:t.deltaY;if(n%_l!=0&&(this._ensureTrackpad||(Math.abs(n)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(n*=14)),t.shiftKey&&n&&(n/=4),this._lastWheelEvent=t,a(this._delta)&&(this._delta=0),this._delta-=n,this._currentZoomCanScroll(n)){if(!this._zooming&&this._delta){var i=this.target;this._zoomOrigin=e,i.onZoomStart(null,e)}this._start()}},n._start=function(){this._delta&&(this._zooming=!0,this._active||(this.target.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0))},n._scrollZoom=function(){if(this._active=!1,this._delta){var t=Math.abs(this._delta)>_l?this._wheelZoomRate:this._defaultZoomRate,e=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==e&&(e=1/e);var n=this.target,i=n.getZoom(),r=n.getZoomForScale(e,i,!0);this._delta=0,n.onZooming(r,this._zoomOrigin),this._scrollTime=performance.now(),n.getRenderer().callInNextFrame(this._thisCheckIfEndZoom)}},n._checkIfEndZoom=function(){if(this._zooming){var t=this.target;performance.now()-this._scrollTime>210?(this._zooming=!1,t.onZoomEnd(t.getZoom(),this._zoomOrigin)):t.getRenderer().callInNextFrame(this._thisCheckIfEndZoom)}},n._interval=function(t,e){var n=this,i=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var r=(t.deltaY?-1*t.deltaY:t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(r*=-1);var o=i.getZoom(),s=o+r;return(s=i._checkZoom(r>0?Math.ceil(s):Math.floor(s)))===o||(this._zooming=!0,this._delta||(i.onZoomStart(null,e),this._origin=e,this._delta=r,this._startZoom=i.getZoom()),i._animateTo({zoom:s-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},(function(e){"finished"===e.state.playState?n._requesting<1||Math.abs(s-n._startZoom)>2||s===i.getMaxZoom()||s===i.getMinZoom()?(i._animateTo({zoom:s,around:n._origin},{continueOnViewChanged:!0,duration:100},(function(t){"running"!==t.state.playState&&(delete n._zooming,delete n._requesting)})),delete n._startZoom,delete n._origin,delete n._delta,n._requesting=0):a(n._requesting)||(delete n._zooming,n._onWheelScroll(t)):"running"!==e.state.playState&&(delete n._zooming,delete n._requesting)}))),!1},e}(ko);Al.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0}),Al.addOnLoadHook("addHandler","scrollWheelZoom",bl);var wl=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.addHooks=function(){Me(this.target.getContainer(),"touchstart",this._onTouchStart,this)},n.removeHooks=function(){Te(this.target.getContainer(),"touchstart",this._onTouchStart)},n._onTouchStart=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var n=e.getContainer(),i=ke(t.touches[0],n),r=ke(t.touches[1],n);this.preY=i.y,this._startP1=i,this._startP2=r,this._startDist=i.distanceTo(r),this._startVector=i.sub(r),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),We(document,"touchmove",this._onTouchMove),We(document,"touchend",this._onTouchEnd),Me(document,"touchmove",this._onTouchMove,this),Me(document,"touchend",this._onTouchEnd,this),e.options.preventTouch&&Ie(t),e._fireEvent("touchactstart")}},n._onTouchMove=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var n=e.getContainer(),i=ke(t.touches[0],n),r=ke(t.touches[1],n),o=i.sub(this._startP1),s=r.sub(this._startP2),a=i.sub(r),h=i.distanceTo(r)/this._startDist,l=180*a.angleWith(this._startVector)/Math.PI,u=.4*((this.preY||i.y)-i.y);this.preY=i.y;var c={domEvent:t,mousePos:[i,r]};if(this.mode||(e.options.touchRotate&&Math.abs(l)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&o.y*s.y>0&&Math.abs(o.y)>10&&Math.abs(s.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-h)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(c)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=h;var A=e._getResolution(this._startZoom)/h,f=e.getZoomFromRes(A);e.onZooming(f,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(e._setBearing(this._startBearing+l),e.onDragRotating(c)):"pitch"===this.mode&&(e._setPitch(e.getPitch()+u),e.onDragRotating(c)),e._fireEvent("touchactinging")}},n._startTouching=function(t){var e=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var n=e.getSize();this._Origin=new ht(n.width/2,n.height/2),e.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateStart(t)},n._onTouchEnd=function(t){delete this.preY;var e=this.target;if(We(document,"touchmove",this._onTouchMove),We(document,"touchend",this._onTouchEnd),"zoom"===this.mode||"rotate_zoom"===this.mode){var n=this._scale,i=e._getResolution(this._startZoom)/n,r=e.getZoomFromRes(i);e.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},e}(ko);Al.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),Al.addOnLoadHook("addHandler","touchGesture",wl);var Cl="__anim_player",Pl={outExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},outQuint:function(t){return 1-Math.pow(1-t,5)},in:function(t){return Math.pow(t,2)},out:function(t){return 1-Pl.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?Pl.inAndOut(2*t):1-Pl.inAndOut(2*(t-.5))}},Ml=J((function(t,e){this.state=t,this.styles=e}),[{key:"playState",get:function(){return this.state.playState}},{key:"symbol",get:function(){return this.styles.symbol}}]),Tl=function(){function t(t,e,n,i){this._animation=t,this.options=e,this._onFrame=n,this.playState="idle",this.ready=!0,this.finished=!1,this.target=i}var e=t.prototype;return e._prepare=function(){var t=this.options,e=t.speed||t.duration;c(e)&&((e=Sl.speed[e])||(e=+e)),e||(e=Sl.speed.normal),this.duration=e,this._framer=t.framer||Sl._requestAnimFrame.bind(Sl)},e.play=function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[Cl])return this;this.target&&(this.target[Cl]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=o();if(!this.startTime){var e=this.options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},e.pause=function(){return"paused"===this.playState||(this.playState="paused",this._run()),this},e.cancel=function(){return"idle"===this.playState||(this.playState="idle",this.finished=!1,this._run()),this},e.finish=function(){return"finished"===this.playState||(this.playState="finished",this.finished=!0,this._run()),this},e.reverse=function(){},e._run=function(){var t=this,e=this._onFrame,n=o(),i=n-this._playStartTime;if(this.options.repeat&&i>=this.duration&&(this._playStartTime=n,i=0),"running"===this.playState){var r=this._animation(i,this.duration);this.playState=r.state.playState,"running"!==this.playState&&this.target&&delete this.target[Cl],"idle"===this.playState?this.startTime>n&&setTimeout(this._run.bind(this),this.startTime-n):"running"===this.playState?this._framer((function(){"running"===t.playState&&(t.currentTime=i,e&&e(r),t._run())})):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(this.target&&delete this.target[Cl],e){"finished"===this.playState?i=this.duration:"idle"===this.playState&&(i=0);var s=this._animation(i,this.duration);s.state.playState=this.playState,e(s)}},t}(),Sl={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function e(t){if(!Array.isArray(t))return Sl._resolveStyles(t);for(var e=[],n=[],i=[],r=0;r<t.length;r++){var o=Sl._resolveStyles(t[r]);o&&(e.push(o[0]),n.push(o[1]),i.push(o[2]))}return e.length?[e,n,i]:null}function n(t){var e,n=t;Array.isArray(t)||(n=h(t)?[0,t]:t instanceof ht||t instanceof $o?[new(e=t.constructor)(0,0),t]:[t,t]);var i=n[0],r=n[1];return h(i)&&h(r)?i===r?null:[i,r-i,r]:Array.isArray(i)&&h(i[0])||i instanceof $o||i instanceof ht?(Array.isArray(i)?(i=new $o(i),r=new $o(r)):(i=new(e=i.constructor)(i),r=new e(r)),i.equals(r)?null:[i,r.sub(i),r]):[i,r,r]}var i,r={},o={},s={};for(var l in t)if(t.hasOwnProperty(l)){var u=t[l];if(!u)continue;if(Array.isArray(u)&&(a(u[0])||a(u[1])))continue;var c=void 0;i=u,(c=!Array.isArray(i)&&i.constructor===Object||Array.isArray(i)&&i[0].constructor===Object?e(u):n(u))&&(o[l]=c[0],r[l]=c[1],s[l]=c[2])}return[o,r,s]},framing:function(t,e){e||(e={});var n,i,r,o=e.easing?Pl[e.easing]:Pl.linear;o||(o=Pl.linear),(t=Sl._resolveStyles(t))&&(i=t[0],n=t[1],r=t[2]);var s=function t(e,n,i){if(!n||!i)return null;var o={};for(var s in i)if(i.hasOwnProperty(s)){if(n[s]===r[s]){o[s]=n[s];continue}var a=n[s],l=i[s];if(h(l))o[s]=a+e*l;else if(Array.isArray(l)){for(var u=[],c=0;c<l.length;c++)u.push(t(e,a[c],l[c]));o[s]=u}else o[s]=l.constructor===Object?t(e,a,l):a instanceof ht||a instanceof $o?a.add(l.multi(e)):l}return o};return function(t,e){var a,h;if(t<0)a={playState:"idle",delta:0},h=i;else if(t<e){var l=o(t/e);a={playState:"running",delta:l},h=s(l,i,n)}else a={playState:"finished",delta:1},h=r;return a.startStyles=i,a.destStyles=r,a.progress=t,a.remainingMs=e-t,new Ml(a,h)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=ot(Sl._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]();this._frameQueue.length?this._animationFrameId=ot(Sl._frameFn):delete this._animationFrameId}},animate:function(t,e,n,i){e||(e={});var r=Sl.framing(t,e);return new Tl(r,e,n,i)},_frameFn:function(){}};Sl._frameFn=Sl._run.bind(Sl);var Il=Sl.animate,El=Object.freeze({__proto__:null,Animation:Sl,Easing:Pl,Frame:Ml,Player:Tl,animate:Il}),Ol={exports:{}};!function(t){!function(){function e(t,e,n){var i=e.x,r=e.y,o=n.x-i,s=n.y-r;if(0!==o||0!==s){var a=((t.x-i)*o+(t.y-r)*s)/(o*o+s*s);a>1?(i=n.x,r=n.y):a>0&&(i+=o*a,r+=s*a)}return(o=t.x-i)*o+(s=t.y-r)*s}function n(t,i,r,o,s){for(var a,h=o,l=i+1;l<r;l++){var u=e(t[l],t[i],t[r]);u>h&&(a=l,h=u)}h>o&&(a-i>1&&n(t,i,a,o,s),s.push(t[a]),r-a>1&&n(t,a,r,o,s))}function i(t,e){var i=t.length-1,r=[t[0]];return n(t,0,i,e,r),r.push(t[i]),r}function r(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return i(t=n?t:function(t,e){for(var n,i,r,o,s,a=t[0],h=[a],l=1,u=t.length;l<u;l++)o=void 0,s=void 0,(o=(i=n=t[l]).x-(r=a).x)*o+(s=i.y-r.y)*s>e&&(h.push(n),a=n);return a!==n&&h.push(n),h}(t,r),r)}t.exports=r,t.exports.default=r}()}(Ol);var Rl=mi(Ol.exports),Dl="not find Geometry' Projection. please add Geometry to Layer and add Layer to Map",kl=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.animateShow=function(t={},e){var n=this;this._showPlayer&&this._showPlayer.finish(),A(t)&&(e=t={});var i=this.getCoordinates();if(0!==i.length){this._animIdx=0,this._animLenSoFar=0,this.show();var r=this.getShell?this.getShell().concat(this.getShell()[0]):i,o=this._getProjection();if(o){var s=o.projectCoords(r,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=o.unproject(this._prjAniShowCenter);var a=t.duration||1e3,h=t.easing||"out";this.setCoordinates([]);var l=0;s.length&&(s[0]._distance=0);for(var u=1;u<s.length;u++){var c=s[u].distanceTo(s[u-1]);s[u]._distance=c,l+=c}this._tempCoord=new $o(0,0),this._tempPrjCoord=new ht(0,0);var f=this._showPlayer=Sl.animate({t:a},{duration:a,easing:h},(function(t){if(n.getMap()){var o=n._drawAnimShowFrame(t.styles.t,a,l,r,s);"finished"===t.state.playState&&(delete n._showPlayer,delete n._aniShowCenter,delete n._prjAniShowCenter,delete n._animIdx,delete n._animLenSoFar,delete n._animTailRatio,delete n._tempCoord,delete n._tempPrjCoord,n.setCoordinates(i)),e&&e(t,o)}else if("finished"!==f.playState&&(f.finish(),e)){var h=n.getCoordinates();e(t,h[h.length-1])}}),this);return f.play(),f}console.error(Dl)}},n._drawAnimShowFrame=function(t,e,n,i,r){if(0===t)return i[0];var o,s,a=t/e*n,h=0;for(o=this._animIdx+1,s=r.length;o<s&&!(this._animLenSoFar+(h=r[o]._distance)>a);o++)this._animLenSoFar+=h;if(this._animIdx=o-1,this._animIdx>=s-1)return this.setCoordinates(i),i[i.length-1];var l=this._animIdx,u=r[l],c=r[l+1],A=(a-this._animLenSoFar)/h;this._animTailRatio=A;var f=u.y+(c.y-u.y)*A;this._tempPrjCoord.x=u.x+(c.x-u.x)*A,this._tempPrjCoord.y=f;var d=this._tempPrjCoord,p=i[l],g=i[l+1],m=p.y+(g.y-p.y)*A;this._tempCoord.x=p.x+(g.x-p.x)*A,this._tempCoord.y=m;var y=this._tempCoord,v=!!this.getShell;if(!v&&this.options.smoothness>0){for(var _=[],x=[],b=0;b<=this._animIdx;b++)_.push(i[b]),x.push(r[b]);_.push(y,y),x.push(d,d),this.setCoordinates(_),this._setPrjCoordinates(x)}else{var w=i.slice(0,this._animIdx+1);w.push(y);var C=r.slice(0,this._animIdx+1);C.push(d),v?(this.setCoordinates([this._aniShowCenter].concat(w)),this._setPrjCoordinates([this._prjAniShowCenter].concat(C))):(this.setCoordinates(w),this._setPrjCoordinates(C))}return y},n._getCenterInExtent=function(t,e,n){var i=this.getExtent();if(!t.intersects(i))return null;var r=n(e,t);if(0===r.length)return null;var[o,s,a]=[0,0,0];r.forEach((function(t){Array.isArray(t)?t.forEach((function(t){t.point&&(t=t.point),o+=t.x,s+=t.y,a++})):(t.point&&(t=t.point),o+=t.x,s+=t.y,a++)}));var h=new $o(o,s)._multi(1/a);return h.count=a,h},n._getPath2DPoints=function(t,e,n){if(!wt(t))return[];var i=this.getMap(),r=!e&&this._shouldSimplify(),o=this.options.simplifyTolerance*i._getResolution(),s=Array.isArray(t[0]);if(delete this._simplified,r&&!s){var a=t.length;t=Rl(t,o,!1),this._simplified=t.length<a}if(n||(n=i._getResolution()),Array.isArray(t)){var h=[],l="_glPt";if(!Array.isArray(t[0]))return h=zt(t,l),i._prjsToPointsAtRes(t,n,h);for(var u=[],c=0,A=t.length;c<A;c++){var f=t[c];h=zt(f,l);var d=i._prjsToPointsAtRes(f,n,h);u.push(d)}return u}return i._prjToPointAtRes(t,n)},n._shouldSimplify=function(){var t=this.getLayer();return t&&t.options.enableSimplify&&!t.options.enableAltitude&&this.options.enableSimplify&&!this._showPlayer},n._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},n._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},n._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},n._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},n._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t,this.options.antiMeridian):[]},n._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},n._computeCenter=function(){var t=this._coordinates;if(!wt(t))return null;for(var e=0,n=0,i=0,r=t.length,o=0;o<r;o++)t[o]&&h(t[o].x)&&h(t[o].y)&&(e+=t[o].x,n+=t[o].y,i++);return new $o(e/i,n/i)},n._computeExtent=function(t){var e=this._coordinates;if(!wt(e))return null;var n=[e];return this.hasHoles&&this.hasHoles()&&n.push.call(n,...this.getHoles()),this._coords2Extent(n,this._getProjection())},n._computePrjExtent=function(t){var e=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&e.push.call(e,...this._getPrjHoles()),this._coords2Extent(e)},n._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,n=1,i=t.length;n<i;n++)e+=t[n].distanceTo(t[n-1]);return e},n._hitTestTolerance=function(){var e,n=this._getInternalSymbol();if(Array.isArray(n)){e=0;for(var i=0;i<n.length;i++)h(n[i].lineWidth)&&n[i].lineWidth>e&&(e=n[i].lineWidth)}else e=n.lineWidth;return t.prototype._hitTestTolerance.call(this)+(h(e)?e/2:1.5)},n._coords2Extent=function(t,e){if(!t||0===t.length||Array.isArray(t[0])&&0===t[0].length)return null;for(var n=new fs(e),i=0,r=t.length;i<r;i++)for(var o=0,s=t[i].length;o<s;o++)n._combine(t[i][o]);return n},e}(Kh);kl.mergeOptions({smoothness:!1,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var Ll="Polygon",Fl=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="Polygon",e&&i.setCoordinates(e),i}K(e,t);var n=e.prototype;return n.getOutline=function(){return this._getPainter()?new e(this.getExtent().toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}}):null},n.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=$o.toCoordinates(t),n=e.length;if(Array.isArray(e[0]))if(this._coordinates=this._trimRing(e[0]),n>1){for(var i=[],r=1;r<n;r++)e[r]&&i.push(this._trimRing(e[r]));this._holes=i}else this._holes=null;else this._coordinates=this._trimRing(e);return this._projectRings(),this},n.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],n=0,i=t.length;n<i;n++)e.push(this._copyAndCloseRing(t[n]));return e},n.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),Ua)},n.getShell=function(){return this._coordinates||[]},n.getHoles=function(){return this._holes||[]},n.hasHoles=function(){return this.getHoles().length>0},n._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},n._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},n._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},n._checkRing=function(t){if(this._cleanRing(t),!t||!wt(t))return!1;var e=t[t.length-1],n=!0;return t[0].x===e.x&&t[0].y===e.y||(n=!1),n},n._trimRing=function(t){var e=this._checkRing(t);return wt(t)&&e&&t.splice(t.length-1,1),t},n._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return wt(t)&&!e?(t.push(t[0].copy()),t):t},n._getPrjShell=function(){return this.getJSONType()===Ll?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this._getShell?this._getShell():this.getShell())),this._prjShell)},n._getPrjHoles=function(){var t=this._getProjection();return this._verifyProjection(),t&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},n._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!wt(e))return 0;for(var n=0,i=0,r=e.length;i<r;i++)n+=t.measureLength(e[i]);return n},n._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!wt(e))return 0;for(var n=t.measureArea(e[0]),i=1,r=e.length;i<r;i++)n-=t.measureArea(e[i]);return n},n._updateCache=function(){t.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},n._clearCache=function(){return delete this._prjShell,t.prototype._clearCache.call(this)},n._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),t.prototype._clearProjection.call(this)},e}(kl);function Nl(t){return function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(t){var e=t instanceof $o?t:new $o(t);if(this._translateRotatePivot(e),this._coordinates=e,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var n=this._getProjection();return this._setPrjCoordinates(n.project(this._coordinates)),this},n._getCenter2DPoint=function(t){var e=this.getMap();if(!e)return null;var n=this._getPrjCoordinates();return n?(t||(t=e._getResolution()),e._prjToPointAtRes(n,t)):null},n._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pcenter&&t&&this._coordinates&&(this._pcenter=t.project(this._coordinates)),this._pcenter},n._setPrjCoordinates=function(t){this._pcenter=t,this.onPositionChanged()},n._updateCache=function(){this._clearCache();var t=this._getProjection();this._pcenter&&t&&(this._coordinates=t.unproject(this._pcenter))},n._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},n._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},e}(t)}Fl.registerJSONType(Ll);var zl=new ps,Bl=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="Point",i.isPoint=!0,e&&i.setCoordinates(e),i}K(e,t);var n=e.prototype;return n.getOutline=function(){var t=this.getCoordinates(),n=this.getContainerExtent(),i=this.getMap().coordToContainerPoint(t);return new e(t,{symbol:{markerType:"square",markerWidth:n.getWidth(),markerHeight:n.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:n.xmin-(i.x-n.getWidth()/2),markerDy:n.ymin-(i.y-n.getHeight()/2)}})},n.setSymbol=function(e){return delete this._fixedExtent,t.prototype.setSymbol.call(this,e)},n._getSizeSymbol=function(t){for(var e,n={},i=!1,r=!1,o=0;o<Na.length;o++){var s=t[Na[o]];a(s)||(!i&&_n(s)&&(i=!0,r=!0),n[Na[o]]=s)}for(var h=0;h<za.length;h++){var l=t[za[h]];a(l)||(!i&&_n(l)&&(i=!0),n[za[h]]=l)}return i?(e=Un(n,this),r&&(e._dynamic=!0)):e=n,e},n._setExternSymbol=function(e){return this._symbol||delete this._fixedExtent,t.prototype._setExternSymbol.call(this,e)},n._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},n._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new ps,this._fixedExtent.set(null,null,null,null);var t=this._sizeSymbol;if(!t)return this._fixedExtent;var e=this.getLayer()&&this.getLayer().getRenderer(),n=e&&e.resources,i=this.getTextDesc();if(Array.isArray(t)){zl.set(1/0,1/0,-1/0,-1/0);for(var r=0;r<t.length;r++)t[r]&&this._fixedExtent._combine(Oa(zl,t[r],n,i&&i[r]))}else this._fixedExtent=Oa(this._fixedExtent,t,n,i);return this._fixedExtent},n._isVectorMarker=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&ka(t)},n._canEdit=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&(ka(t)||La(t)||Da(t))},n._containsPoint=function(e,n){var i=this.getContainerExtent();return n&&(i=i.expand(n)),!!i.contains(e)&&(!this.options.hitTestForEvent||t.prototype._containsPoint.call(this,e,n))},n._computeExtent=function(){return Hl.call(this,"getCenter")},n._computePrjExtent=function(){return Hl.call(this,"_getPrjCoordinates")},n._computeGeodesicLength=function(){return 0},n._computeGeodesicArea=function(){return 0},n._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new kh(this).getSprite(t,e)},e}(Nl(Kh));function Hl(t){var e=this[t]();return e?new fs(e,e,this._getProjection()):null}Bl.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1,collision:!0}),Bl.registerJSONType("Marker");var jl=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="LineString",e&&i.setCoordinates(e),i}K(e,t);var n=e.prototype;return n.getOutline=function(){return Fl.prototype.getOutline.call(this)},n.setCoordinates=function(t){return t?(this._coordinates=$o.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},n.getCoordinates=function(){return this._coordinates||[]},n.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),Ha)},n._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},n._computeGeodesicArea=function(){return 0},e}(kl);jl.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),jl.registerJSONType("LineString");var Ul=new ps,Gl=function(t){function e(e,n){var i;return(i=t.call(this,n)||this).type="GeometryCollection",i.setGeometries(e),i}K(e,t);var n=e.prototype;return n.getContainerExtent=function(t){var e=t||new ps;return this.forEach((function(t){e._combine(t.getContainerExtent(Ul))})),e},n.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),n=this._getSymbol(),i=this.config(),r=this.getProperties(),o=e.length-1;o>=0;o--)e[o]._initOptions(i),e[o]._setParent(this),e[o]._setEventParent(this),n&&e[o].setSymbol(n),r&&e[o].setProperties(r);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},n.getGeometries=function(){return this._geometries||[]},n.forEach=function(t,e){for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i]&&(e?t.call(e,n[i],i):t(n[i],i));return this},n.filter=function(t,n){if(!t)return new e;var i=[],r=A(t),o=r?t:Tn(t);return this.forEach((function(t){var e=r?t:Nn(t);(n?o.call(n,e):o(e))&&i.push(t)}),this),new e(i)},n.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach((function(t){t&&t.translate&&t.translate.apply(t,e)})),this},n.isEmpty=function(){return!wt(this.getGeometries())},n.remove=function(){return this.forEach((function(t){t._unbind()})),Kh.prototype.remove.apply(this,arguments)},n.show=function(){return this.options.visible=!0,this.forEach((function(t){t.show()})),this},n.hide=function(){return this.options.visible=!1,this.forEach((function(t){t.hide()})),this},n.onConfig=function(t){this.forEach((function(e){e.config(t)}))},n.getSymbol=function(){var e=t.prototype.getSymbol.call(this);if(!e){var n=[],i=!1;this.forEach((function(t){t.getSymbol()&&!i&&(i=!0),n.push(t.getSymbol())})),i&&(e={children:n})}return e},n.setSymbol=function(t){var e=this;if(t&&t.children)this._symbol=null,this.forEach((function(n,i){n._eventSymbolProperties=e._eventSymbolProperties,n.setSymbol(t.children[i])}));else{var n=this._prepareSymbol(t);this._symbol=n,this.forEach((function(t){t._eventSymbolProperties=e._eventSymbolProperties,t.setSymbol(n)}))}return this.onSymbolChanged(),this},n._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach((function(e){e._setExternSymbol(t)})),this.onSymbolChanged(),this},n._bindLayer=function(){t.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},n._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach((function(e){e._bindLayer(t)}))},n._checkGeometries=function(t){for(var e=[],n=0,i=(t=Array.isArray(t)?t:[t]).length;n<i;n++){var o=t[n];o&&(this._checkGeo(o)?o instanceof Gl?r.isTest||console.error(o," is GeometryCollection sub class,it Cannot be placed in GeometryCollection"):e.push(o):console.error("The geometry added to collection is invalid. Index: "+n))}return e},n._checkGeo=function(t){return t instanceof Kh},n._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach((function(t){t&&t._updateCache&&t._updateCache()}))},n._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach((function(t){t._removePainter()}))},n._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,n=0,i=0,r=this.getGeometries(),o=0,s=r.length;o<s;o++)if(r[o]){var a=r[o]._computeCenter(t);a&&(e+=a.x,n+=a.y,i++)}return 0===i?null:new $o(e/i,n/i)},n._containsPoint=function(t,e){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)if(n[i]._containsPoint(t,e))return this._pickGeometryIndex=i,!0;return!1},n._hitTestTolerance=function(){for(var t=this.getGeometries(),e=0,n=0,i=t.length;n<i;n++){var r=t[n]._hitTestTolerance();e=Math.max(e,r)}return e},n._computeExtent=function(t){return Vl.call(this,t,"_computeExtent")},n._computePrjExtent=function(t){return Vl.call(this,t,"_computePrjExtent")},n._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,i=0,r=e.length;i<r;i++)e[i]&&(n+=e[i]._computeGeodesicLength(t));return n},n._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,i=0,r=e.length;i<r;i++)e[i]&&(n+=e[i]._computeGeodesicArea(t));return n},n._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),n=0,i=e.length;n<i;n++)e[n]&&t.push(e[n]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},n._toJSON=function(t){t=s({},t);var e,n={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter((function(t){return t&&t._toJSON})).map((function(t){var e=t._toJSON();return e.subType?e:t._exportGeoJSONGeometry()}))}},i=this.getId();return a(i)||(n.id=i),(a(t.properties)||t.properties)&&(e=this._exportProperties()),n.properties=e,t.feature=n,t},n._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e]&&t[e]._clearProjection()},n._getConnectPoints=function(){var t=this.getExtent();return[new $o(t.xmin,t.ymax),new $o(t.xmax,t.ymin),new $o(t.xmin,t.ymin),new $o(t.xmax,t.ymax)]},n._getExternalResources=function(){if(this.isEmpty())return[];for(var t,e,n=this.getGeometries(),i=[],r={},o=0,s=n.length;o<s;o++)if(n[o])for(var a=0,h=(t=qn(n[o]._getInternalSymbol())).length;a<h;a++)r[e=t[a].join()]||(i.push(t[a]),r[e]=1);return i},n.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1),this._recordVisible();for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i].startEdit(t);this._editing=!0;var o=this.getLayer();return o&&"canvas"===o.options.renderer&&this.hide(),setTimeout((function(){e.fire("editstart")}),1),this},n.endEdit=function(){if(this.isEmpty())return this;this._recoveryVisible();for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},n.isEditing=function(){return!!this._editing},e}(Kh);function Vl(t,e){if(this.isEmpty())return null;for(var n=new fs,i=this.getGeometries(),r=0,o=i.length;r<o;r++)if(i[r]){var s=i[r][e](t);s&&n._combine(s)}return n}Gl.registerJSONType("GeometryCollection");var Wl=function(t){function e(e,n,i,r){var o;return(o=t.call(this,null,r)||this).GeometryType=e,o.type=n,o._initData(i),o}K(e,t);var n=e.prototype;return n.getCoordinates=function(){for(var t=[],e=this.getGeometries(),n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.getShell&&"Polygon"!==r.getJSONType()?[r.getShell()]:r.getCoordinates())}return t},n.setCoordinates=function(t){for(var e=[],n=0,i=(t=t||[]).length;n<i;n++){var r=new this.GeometryType(t[n],this.config());e.push(r)}return this.setGeometries(e),this},n._initData=function(t){(t=t||[]).length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},n._checkGeo=function(t){return t instanceof this.GeometryType},n._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=$o.toNumberArrays(t);return{type:this.getType(),coordinates:e}},n._toJSON=function(t){return{feature:this.toGeoJSON(t)}},e}(Gl),ql=function(t){function e(e,n){return t.call(this,Bl,"MultiPoint",e,n)||this}return K(e,t),e.prototype.findClosest=function(t){if(!t)return null;var e=this.getCoordinates(),n=null,i=1/0;return e.forEach((function(e){var r,o,s,a,h=(r=e,s=(o=t).x-r.x,a=o.y-r.y,Math.sqrt(s*s+a*a));h<i&&(n=e,i=h)})),n},e}(Wl);ql.registerJSONType("MultiPoint");var Zl=function(t){function e(){return t.apply(this,arguments)||this}return K(e,t),e.prototype.getCenterInExtent=function(t){var e=this.getGeometries(),[n,i,r]=[0,0,0];return e.forEach((function(e){var o=e.getCenterInExtent(t);o&&(n+=o.x*o.count,i+=o.y*o.count,r+=o.count)})),0===r?null:new $o(n,i)._multi(1/r)},e}(Wl),Ql=function(t){function e(e,n){return t.call(this,jl,"MultiLineString",e,n)||this}return K(e,t),e}(Zl);Ql.registerJSONType("MultiLineString");var Xl=function(t){function e(e,n){return t.call(this,Fl,"MultiPolygon",e,n)||this}return K(e,t),e}(Zl);Xl.registerJSONType("MultiPolygon");var Yl,Jl={Marker:Bl,LineString:jl,Polygon:Fl,MultiPoint:ql,MultiLineString:Ql,MultiPolygon:Xl},Kl="geojson-fetch-worker-page-async",$l=function(t){function e(){return t.call(this,Kl)||this}K(e,t);var n=e.prototype;return n._sendMsg=function(t,e,n){var i=this;this.send(t,[],(function(r,o){r?n(r):i._pageFeatures(t,o,e,n)}),t.workerId)},n._fetchGeoJSON=function(t,e,n=[],i){var r=s({},e);r.type="fetchdata",r.url=t,this._sendMsg(r,n,i)},n._pageFeatures=function(t,e,n,i){if(n.push(e),0!==e.length){var r=s({},t);r.type="pagefeatures",this._sendMsg(r,n,i)}else i(null,n)},e}(aa);cr(Kl,(function(){return"\nfunction (exports) {\n    const resultMap = {};\n\n    function handleResult(msg, postResponse) {\n        const data = msg.data || {};\n        const { taskId } = data;\n        const features = resultMap[taskId];\n        if (!features) {\n            postResponse('not find geojson dataset the taskId:' + taskId);\n            return;\n        }\n        if (features.length === 0) {\n            delete resultMap[taskId];\n            postResponse(null, []);\n            return;\n        }\n        const pageSize = data.pageSize || 2000;\n        const pageFeatures = features.slice(0, pageSize);\n        resultMap[taskId] = features.slice(pageSize, Infinity);\n        postResponse(null, pageFeatures);\n    }\n    //worker init\n    exports.initialize = function () {\n        // console.log(\"geojson fetch init\");\n    };\n    //recive message\n    exports.onmessage = function (msg, postResponse) {\n        const { taskId, type, url } = msg.data || {};\n        if (!taskId) {\n            postResponse('not find task id for get geojson dataset,taskId=' + taskId);\n            return;\n        }\n        if (type === 'fetchdata') {\n            if (!url) {\n                postResponse('url is null,url=' + url);\n                return;\n            }\n            fetch(url).then(res => res.json()).then(geojson => {\n                let features;\n                if (Array.isArray(geojson)) {\n                    features = geojson;\n                } else if (geojson.features) {\n                    features = geojson.features;\n                } else {\n                    features = [geojson];\n                }\n                resultMap[taskId] = features;\n                handleResult(msg, postResponse);\n            }).catch(errror => {\n                postResponse(errror.message);\n            });\n        } else if (type === 'pagefeatures') {\n            handleResult(msg, postResponse);\n        } else {\n            postResponse('not support task type:' + type);\n        }\n    };\n}"}));var tu={toGeometry:function(t,e){if(c(t)&&(t=dt(t)),Array.isArray(t)){for(var n=[],i=0,r=t.length;i<r;i++){var o=tu._convert(t[i],e);Array.isArray(o)?pt(n,o):n.push(o)}return n}return tu._convert(t,e)},toGeometryAsync:function(t,e,n=2e3){return c(t)&&(t=dt(t)),new Promise((function(i){var r=[];if(t&&(Array.isArray(t)||Array.isArray(t.features))){var o=h(n)?Math.round(n):2e3,s=t.features||t,a=Math.ceil(s.length/o),l=1;Pr({count:a,run:function(){var t=s.slice((l-1)*o,l*o),n=tu.toGeometry(t,e);return l++,n}}).then((function(t){for(var e=0,n=t.length;e<n;e++){var o=t[e];o&&(Array.isArray(o)?pt(r,o):r.push(o))}i(r)}))}else{var u=tu.toGeometry(t,e);i(u)}}))},_convert:function(t,e){if(!t||a(t.type))return null;var n=t.type;if("Feature"===n){var i=tu._convert(t.geometry);return i?(i.setId(t.id),i.setProperties(t.properties),e&&e(i),i):null}if("FeatureCollection"===n){var r=t.features;return r?tu.toGeometry(r,e):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(n)>=0){var o=new Jl["Point"===n?"Marker":n](t.coordinates);return e&&e(o),o}if("GeometryCollection"===n){var s=t.geometries;if(!wt(s)){var h=new Gl;return e&&e(h),h}for(var l=[],u=s.length,c=0;c<u;c++)l.push(s[c].subType?Kh.getJSONClass(s[c].subType).fromJSON(s[c]):tu._convert(s[c]));var A=new Gl(l);return e&&e(A),A}return null},_isGeoJSON:function(t){if(!t)return!1;if(t=t||{},Array.isArray(t)&&t.length)return tu.isGeoJSON(t[0]);var e=t.type;if(!e)return!1;if(-1===Wt.indexOf(e))return!1;var{features:n,geometries:i,geometry:r,coordinates:o}=t;if(o&&Array.isArray(o))return!0;if(Array.isArray(i))return!0;if(Array.isArray(n))return!0;if(r){var s=r.coordinates;if(s&&Array.isArray(s))return!0}return!1},fetch:function(t,e=2e3){return new Promise((function(n,i){if(t&&c(t)){var r=s({pageSize:2e3},{pageSize:e});t=Ht(t),Yl||(Yl=new $l);var o=Yl.workers.length,a=Math.floor(Math.random()*o);a=Math.min(o-1,a),r.workerId=a,r.taskId=ft(),Yl._fetchGeoJSON(t,r,[],(function(t,e){if(t)i(t);else{var r=[];e.forEach((function(t){for(var e=0,n=t.length;e<n;e++)r.push(t[e])})),n({type:"FeatureCollection",features:r})}}))}else i("url is error,It should be string")}))}},eu=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,e&&r.setCoordinates(e),r._radius=n,r}K(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.radius,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getRadius=function(){return this._radius},n.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},n.getShell=function(){for(var t,e,n,i=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints,s=this.getRadius(),a=[],h=0,l=o-1;h<l;h++){t=360*h/l*Math.PI/180,e=s*Math.cos(t),n=s*Math.sin(t);var u=i.locate(r,e,n);u.z=r.z,a.push(u)}return a.push(a[0]),a},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._containsPoint=function(e,n){var i=this.getMap();if(i.getPitch())return t.prototype._containsPoint.call(this,e,n);var r=i._pointToContainerPoint(this._getCenter2DPoint()),o=this.getSize(),s=this._hitTestTolerance()+(n||0),a=r.add(o.width/2,o.height/2);return Wa(e,r,a,s)},n._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var n=this._getPrjCoordinates(),i=e.map((function(e){return t.project(e)})),r=i[1].x-n.x,o=i[3].y-n.y;return new fs(n.add(i[0].x-n.x,i[2].y-n.y),n.add(r,o))},n._computeExtent=function(t){var e=this._getMinMax(t);return e?new fs(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},n._getMinMax=function(t){if(!t||!this._coordinates||a(this._radius))return null;var e=this._radius;return[t.locate(this._coordinates,-e,0),t.locate(this._coordinates,e,0),t.locate(this._coordinates,0,e),t.locate(this._coordinates,0,-e)]},n._computeGeodesicLength=function(){return a(this._radius)?0:2*Math.PI*this._radius},n._computeGeodesicArea=function(){return a(this._radius)?0:Math.PI*Math.pow(this._radius,2)},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:$o.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=this.getCenter(),n=s({},t);n.geometry=!1;var i=this.toGeoJSON(n);return i.geometry={type:"Polygon"},{feature:i,subType:"Circle",coordinates:e.toArray(),radius:this.getRadius()}},e}(Nl(Fl));function nu(t){return t*t*t*t}eu.mergeOptions({numberOfShellPoints:60}),eu.registerJSONType("Circle");var iu=function(t){function e(e,n,i,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o.width=n,o.height=i,o}K(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getWidth=function(){return this.width},n.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},n.getHeight=function(){return this.height},n.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},n.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},n._getShell=function(){var t,e,n,i,r=this._getMeasurer(),o=this.getCoordinates(),s=this.options.numberOfShellPoints-1,a=this.getWidth(),h=this.getHeight(),l=[],u=Math.pow(a/2,2)*Math.pow(h/2,2),c=Math.pow(a/2,2),A=Math.pow(h/2,2),f=[];if(Math.max(a/h,h/a)>2){var{fs:d,sum:p}=function(t){for(var e=[],n=[],i=0;i<t;i++)n.push(nu(i/t));var r=n.map((function(t){return t})).reverse(),o=[];pt(o,n,r,n,r);for(var s=0,a=0,h=o.length;a<h;a+=4)e.push(o[a]),s+=o[a];return{fs:e,sum:s}}(s),g=360/p,m=0;h>a&&(m=90);for(var y=0,v=0,_=d.length;v<_;v++)f.push((y+=g*d[v])+m)}else for(var x=0;x<s;x++)f.push(360*x/s);this.options.debug;for(var b=0;b<f.length;b++){e=(t=f[b])*Math.PI/180,n=Math.sqrt(u/(c*Math.pow(Math.tan(e),2)+A)),i=Math.sqrt(u/(A*Math.pow(1/Math.tan(e),2)+c)),t>90&&t<270&&(n*=-1),t>180&&t<360&&(i*=-1);var w=r.locate(o,n,i);w.z=o.z,l.push(w)}return l.push(l[0].copy()),l},n._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(e)},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=i.getProjection(),o=this._hitTestTolerance()+(n||0),s=r.projectCoords([this._coordinates,i.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian);return Wa(e,i.prjToContainerPoint(s[0]),i.prjToContainerPoint(s[1]),o)},n._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():eu.prototype._computePrjExtent.apply(this,arguments)},n._computeExtent=function(){return eu.prototype._computeExtent.apply(this,arguments)},n._getMinMax=function(t){if(!t||!this._coordinates||a(this.width)||a(this.height))return null;var e=this.getWidth(),n=this.getHeight();return[t.locate(this._coordinates,-e/2,0),t.locate(this._coordinates,e/2,0),t.locate(this._coordinates,0,-n/2),t.locate(this._coordinates,0,n/2)]},n._computeGeodesicLength=function(){return a(this.width)||a(this.height)?0:2*Math.PI*(this.width>this.height?this.width:this.height)/2-4*Math.abs(this.width-this.height)},n._computeGeodesicArea=function(){return a(this.width)||a(this.height)?0:Math.PI*this.width*this.height/4},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:$o.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=s({},t),n=this.getCenter();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Ellipse",coordinates:n.toArray(),width:this.getWidth(),height:this.getHeight()}},e}(Nl(Fl));iu.mergeOptions({numberOfShellPoints:81}),iu.registerJSONType("Ellipse");var ru=function(t){function e(e,n,i,r){var o;return o=t.call(this,null,r)||this,e&&o.setCoordinates(e),o._width=n,o._height=i,o}K(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getCoordinates=function(){return this._coordinates},n.setCoordinates=function(t){var e=t instanceof $o?t:new $o(t);if(this._translateRotatePivot(e),this._coordinates=e,!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var n=this._getProjection();return this._setPrjCoordinates(n.project(this._coordinates)),this},n.getWidth=function(){return this._width},n.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},n.getHeight=function(){return this._height},n.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},n.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},n._getShell=function(){var t=this._getMeasurer(),e=this._coordinates,n=this.getMap(),i=1,r=-1;if(n){var o=n.getFullExtent();o.left>o.right&&(i=-1),o.bottom>o.top&&(r=1)}var s=[];s.push(e);var a=t.locate(e,i*this._width,0);a.z=e.z,s.push(a);var h=t.locate(e,i*this._width,r*this._height);h.z=e.z,s.push(h);var l=t.locate(e,0,r*this._height);return s.push(l),l.z=e.z,s.push(e),s},n.getHoles=function(){return[]},n.animateShow=function(){return this.show()},n._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pnw&&t&&this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw},n._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},n._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this),n=this._getProjection();if(!n.isSphere())return this._rotatePrjCoordinates(e);for(var i=n.getSphereExtent(),r=i.sx,o=i.sy,s=this._getProjection().getCircum(),a=e[0],h=1,l=e.length;h<l;h++){var u=e[h],c=0,A=0;r*(a.x-u.x)>0&&(c=s.x*r),o*(a.y-u.y)<0&&(A=s.y*o),e[h]._add(c,A)}return this._rotatePrjCoordinates(e)},n._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},n._clearProjection=function(){this._pnw=null,t.prototype._clearProjection.call(this)},n._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=a(n)?this._hitTestTolerance():n,o=i._getResolution()*r,s=this._getPrjExtent().expand(o),h=i._containerPointToPrj(e);return s.contains(h)},n._computePrjExtent=function(t){if(this.isRotated())return this._computeRotatedPrjExtent();var e=this._getSouthEast(t);if(!e)return null;var n=t.projectCoords([new $o(this._coordinates.x,e.y),new $o(e.x,this._coordinates.y)],this.options.antiMeridian);return new fs(n[0],n[1])},n._computeExtent=function(t){var e=this._getSouthEast(t);return e?new fs(this._coordinates,e,this._getProjection()):null},n._getSouthEast=function(t){if(!t||!this._coordinates||a(this._width)||a(this._height))return null;var e=this.getWidth(),n=-this.getHeight();if(t.fullExtent){var i=t.fullExtent;e*=i.right>i.left?1:-1,n*=i.top>i.bottom?1:-1}var r=t.locate(this._coordinates,e,0),o=t.locate(this._coordinates,0,n);return r.y=o.y,r},n._computeGeodesicLength=function(){return a(this._width)||a(this._height)?0:2*(this._width+this._height)},n._computeGeodesicArea=function(){return a(this._width)||a(this._height)?0:this._width*this._height},n._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:$o.toNumberArrays([this.getShell()])}},n._toJSON=function(t){var e=s({},t),n=this.getCoordinates();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Rectangle",coordinates:n.toArray(),width:this.getWidth(),height:this.getHeight()}},e}(Fl);ru.registerJSONType("Rectangle");var ou=function(t){function e(e,n,i,r,o){var s;return(s=t.call(this,e,n,o)||this).startAngle=i,s.endAngle=r,s}K(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n.getStartAngle=function(){return this.startAngle},n.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},n.getEndAngle=function(){return this.endAngle},n.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},n._correctAngles=function(){var t=this.getStartAngle(),e=this.getEndAngle();return e<t?(console.error("The ending angle should be greater than the starting angle ",t,e),[0,0]):e-t>360?(console.error("The difference between the end angle and the start angle is greater than 360 degrees ",t,e),[0,0]):(t<0&&(t+=360,e+=360),[t,e])},n.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},n._getShell=function(){for(var t,e,n,[i,r]=this._correctAngles(),o=this._getMeasurer(),s=this.getCoordinates(),a=this.options.numberOfShellPoints-2,h=this.getRadius(),l=[s.copy()],u=r-i,c=0;c<a;c++){t=(u*c/(a-1)+i)*Math.PI/180,e=h*Math.cos(t),n=h*Math.sin(t);var A=o.locate(s,e,n);A.z=s.z,l.push(A)}return l.push(s.copy()),l},n.getRotateOffsetAngle=function(){return 90},n._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(e)},n._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():eu.prototype._computePrjExtent.apply(this,arguments)},n._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=i._pointToContainerPoint(this._getCenter2DPoint()),o=this._hitTestTolerance()+(n||0),s=this.getSize(),a=r,h=e,l=Math.atan2(a.y-h.y,h.x-a.x),u=l<0?360*(l+2*Math.PI)/(2*Math.PI):360*l/(2*Math.PI),[c,A]=this._correctAngles(),f=c%360,d=A%360,p=!1;return p=f>d?!(u>d&&u<f):u>=f&&u<=d,h.distanceTo(a)<=s.width/2+o&&p},n._computeGeodesicLength=function(){if(a(this._radius))return 0;var[t,e]=this._correctAngles();return 2*Math.PI*this._radius*Math.abs(t-e)/360+2*this._radius},n._computeGeodesicArea=function(){if(a(this._radius))return 0;var[t,e]=this._correctAngles();return Math.PI*Math.pow(this._radius,2)*Math.abs(t-e)/360},n._toJSON=function(t){var e=s({},t),n=this.getCenter();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Sector",coordinates:n.toArray(),radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},e}(eu);ou.mergeOptions({numberOfShellPoints:60}),ou.registerJSONType("Sector");var su=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n._arc=function(t,e,n){var i=this.options.arcDegree;0===i&&(i=1);for(var r=i*Math.PI/180,o=1,s=e.length;o<s;o++)Mo._arcBetween(t,e[o-1],e[o],r),Mo._stroke(t,n)},n._quadraticCurve=function(t,e){if(e.length<=2)Mo._path(t,e);else{var n,i;for(n=2,i=e.length;n<i;n+=2)t.quadraticCurveTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y);if((n-=1)<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},n._bezierCurve=function(t,e){if(e.length<=3)Mo._path(t,e);else{var n,i;for(n=1,i=e.length;n+2<i;n+=3)t.bezierCurveTo(e[n].x,e[n].y,e[n+1].x,e[n+1].y,e[n+2].x,e[n+2].y);if(n<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},n._getCurveArrowPoints=function(t,e,n,i,r,o){var s,a=e.length;for(s=o;s<a;s+=o){var h=this._getArrowShape(e[s-1],e[s],n,i,r);h&&t.push(h)}if((s-=o)<a-1)for(s+=1;s<a;s++){var l=this._getArrowShape(e[s-1],e[s],n,i,r);l&&t.push(l)}},e}(jl);su.mergeOptions({enableSimplify:!1,enableClip:!1});var au=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},n._paintOn=function(t,e,n){t.beginPath(),this._arc(t,e,n),Mo._stroke(t,n),this._paintArrow(t,e,n)},e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i},e}(su);au.registerJSONType("ArcCurve"),au.mergeOptions({arcDegree:90});var hu=function(t){function e(){return t.apply(this,arguments)||this}K(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},n._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),Mo._stroke(t,n),this._paintArrow(t,e,n)},n._getArrowPoints=function(t,e,n,i,r){return this._getCurveArrowPoints(t,e,n,i,r,3)},e}(su);hu.registerJSONType("CubicBezierCurve");var lu=function(t){function e(){return t.apply(this,arguments)||this}K(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i};var n=e.prototype;return n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},n._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,n),Mo._stroke(t,n),this._paintArrow(t,e,n)},n._getArrowPoints=function(t,e,n,i,r){return this._getCurveArrowPoints(t,e,n,i,r,2)},e}(su);lu.registerJSONType("QuadBezierCurve");var uu={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},cu={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},Au=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.getContent=function(){return this._content},n.setContent=function(t){var e=this._content;return this._content=ne(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},n.onAdd=function(){this._refresh()},n.toJSON=function(){var e=t.prototype.toJSON.call(this);return delete e.symbol,e},n.setSymbol=function(e){if(this._refreshing||!e)return t.prototype.setSymbol.call(this,e);var n=this._parseSymbol(e);if(this.setTextStyle){var i=this.getTextStyle()||{};i.symbol=n[0],this.setTextStyle(i)}else this.setTextSymbol&&this.setTextSymbol(n[0]);if(this.setBoxStyle){var r=this.getBoxStyle()||{};r.symbol=n[1],this.setBoxStyle(r)}else this.setBoxSymbol&&this.setBoxSymbol(n[1]);return this},n._parseSymbol=function(t){var e={},n={};for(var i in t)d(t,i)&&(0===i.indexOf("text")?e[i]=t[i]:n[i]=t[i]);return[e,n]},n._getTextSize=function(t){return pe(this._content,t).size},n._getInternalSymbol=function(){return this._symbol},n._getDefaultTextSymbol=function(){return s({},uu)},n._getDefaultBoxSymbol=function(){return s({},cu)},n._getDefaultPadding=function(){return[12,8]},e}(Bl),fu=function(t){function e(e,n,i,r,o={}){var s;return(s=t.call(this,n,o)||this)._content=ne(e),s._width=a(i)?100:i,s._height=a(r)?40:r,o.boxSymbol&&s.setBoxSymbol(o.boxSymbol),o.textStyle&&s.setTextStyle(o.textStyle),s._refresh(),s}K(e,t);var n=e.prototype;return n.getWidth=function(){return this._width},n.setWidth=function(t){return this._width=t,this._refresh(),this},n.getHeight=function(){return this._height},n.setHeight=function(t){return this._height=t,this._refresh(),this},n.getBoxSymbol=function(){return s({},this.options.boxSymbol)},n.setBoxSymbol=function(t){return this.options.boxSymbol=t?s({},t):t,this.getSymbol()&&this._refresh(),this},n.getTextStyle=function(){return this.options.textStyle?s({},this.options.textStyle):null},n.setTextStyle=function(t){return this.options.textStyle=t?s({},t):t,this.getSymbol()&&this._refresh(),this},e.fromJSON=function(t){var n=t.feature,i=new e(t.content,n.geometry.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i.setId(n.id),t.symbol&&i.setSymbol(t.symbol),i},n._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},n._refresh=function(){var t,e,n=this.getTextStyle()||{},i=n.padding||[12,8];if(_n(this._width)){var r=(t=JSON.parse(JSON.stringify(this._width))).stops;if(r)for(var o=0;o<r.length;o++)r[o][1]=r[o][1]-2*i[0]}else t=this._width-2*i[0];if(_n(this._height)){var a=(e=JSON.parse(JSON.stringify(this._height))).stops;if(a)for(var h=0;h<a.length;h++)a[h][1]=a[h][1]-2*i[1]}else e=this._height-2*i[1];var l=s({},n.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:t,textMaxHeight:e});n.wrap&&!l.textWrapWidth&&(l.textWrapWidth=t);var u,c=n.horizontalAlignment;if(l.textDx=l.markerDx||0,_n(this._width)){var A=(u=JSON.parse(JSON.stringify(this._width))).stops;if(A)for(var f=0;f<A.length;f++)A[f][1]=A[f][1]/2-i[0],"left"===c&&(A[f][1]*=-1)}else u=l.markerWidth/2-i[0],"left"===c&&(u*=-1);"left"===c?(l.textHorizontalAlignment="right",l.textDx=u):"right"===c&&(l.textHorizontalAlignment="left",l.textDx=u);var d,p=n.verticalAlignment;if(l.textDy=l.markerDy||0,_n(this._height)){var g=(d=JSON.parse(JSON.stringify(this._height))).stops;if(g)for(var m=0;m<g.length;m++)g[m][1]=g[m][1]/2-i[1],"top"===p&&(g[m][1]*=-1)}else d=l.markerHeight/2-i[1],"top"===p&&(d*=-1);"top"===p?(l.textVerticalAlignment="bottom",l.textDy=d):"bottom"===p&&(l.textVerticalAlignment="top",l.textDy=d),this._refreshing=!0,this.updateSymbol(l),delete this._refreshing},n.startEdit=function(e){var n=this._getCompiledSymbol();if(_n(this._width)){var i=n.markerWidth;this._oldWidth=this._width,this.setWidth(i)}if(_n(this._height)){var r=n.markerHeight;this._oldHeight=this._height,this.setHeight(r)}return t.prototype.startEdit.call(this,e)},n.endEdit=function(){var e=this.getMap(),n=e&&e.getZoom();if(this._oldWidth){for(var i=this._width/bn(this._oldWidth)(n),r=this._oldWidth.stops,o=0;o<r.length;o++)r[o][1]*=i;this.setWidth(this._oldWidth),delete this._oldWidth}if(this._oldHeight){for(var s=this._height/bn(this._oldHeight)(n),a=this._oldHeight.stops,h=0;h<a.length;h++)a[h][1]*=s;this.setHeight(this._oldHeight),delete this._oldHeight}return t.prototype.endEdit.call(this)},e}(Au);fu.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),fu.registerJSONType("TextBox");var du=function(t){function e(e,n,i={}){var r;return r=t.call(this,n,i)||this,i.textSymbol&&r.setTextSymbol(i.textSymbol),i.boxStyle&&r.setBoxStyle(i.boxStyle),r._content=ne(e),r._refresh(),r}K(e,t);var n=e.prototype;return n.getBoxStyle=function(){return this.options.boxStyle?s({},this.options.boxStyle):null},n.setBoxStyle=function(t){return this.options.boxStyle=t?s({},t):t,this._refresh(),this},n.getTextSymbol=function(){return s({},this._getDefaultTextSymbol(),this.options.textSymbol)},n.setTextSymbol=function(t){return this.options.textSymbol=t?s({},t):t,this._refresh(),this},e.fromJSON=function(t){var n=t.feature,i=new e(t.content,n.geometry.coordinates,t.options);return i.setProperties(n.properties),i.setId(n.id),t.symbol&&i.setSymbol(t.symbol),i},n._canEdit=function(){return!1},n._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},n._refresh=function(){var t=s({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){s(t,e.symbol);var n=this._getBoxSize(t),i=n[1],r=e.padding||this._getDefaultPadding(),o=n[0];t.markerWidth=o.width,t.markerHeight=o.height;var a=t.textDx||0,h=t.textDy||0,l=ce(i,t.textHorizontalAlignment,t.textVerticalAlignment)._add(a,h),u=e.horizontalAlignment||"middle";t.markerDx=l.x,"left"===u?t.markerDx+=t.markerWidth/2-r[0]:"right"===u?t.markerDx-=t.markerWidth/2-i.width-r[0]:t.markerDx+=i.width/2;var c=e.verticalAlignment||"middle";t.markerDy=l.y,"top"===c?t.markerDy+=t.markerHeight/2-r[1]:"bottom"===c?t.markerDy-=t.markerHeight/2-i.height-r[1]:t.markerDy+=i.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},n._getBoxSize=function(t){t.markerType||(t.markerType="square");var e,n,i=this.getBoxStyle(),r=this._getTextSize(t),o=i.padding||this._getDefaultPadding();return e=r.width+2*o[0],n=r.height+2*o[1],i.minWidth&&(!e||e<i.minWidth)&&(e=i.minWidth),i.minHeight&&(!n||n<i.minHeight)&&(n=i.minHeight),[new Jt(e,n),r]},e}(Au);du.mergeOptions({boxStyle:null,textSymbol:null}),du.registerJSONType("Label");var pu=function(t){return function(t){function e(...e){return t.call(this,...e)||this}K(e,t),e._hasConnectors=function(t){return!a(t.__connectors)&&t.__connectors.length>0},e._getConnectors=function(t){return t.__connectors};var n=e.prototype;return n.getConnectSource=function(){return this._connSource},n.setConnectSource=function(t){var e=this._connTarget;return this.onRemove(),this._connSource=t,this._connTarget=e,this.onAdd(),this},n.getConnectTarget=function(){return this._connTarget},n.setConnectTarget=function(t){var e=this._connSource;return this.onRemove(),this._connSource=e,this._connTarget=t,this._updateCoordinates(),this._registerEvents(),this},n._updateCoordinates=function(){var t=this.getMap();if(!t&&this._connSource&&(t=this._connSource.getMap()),!t&&this._connTarget&&(t=this._connTarget.getMap()),t&&this._connSource&&this._connTarget){for(var e,n,i=this._connSource._getConnectPoints(),r=this._connTarget._getConnectPoints(),o=0,s=this.getCoordinates(),a=0,h=i.length;a<h;a++)for(var l=i[a],u=0,c=r.length;u<c;u++){var A=r[u],f=t.computeLength(l,A);0===a&&0===u?(e=l,n=A,o=f):f<o&&(e=l,n=A)}wt(s)&&s[0].equals(e)&&s[1].equals(n)||this.setCoordinates([e,n])}},n.onAdd=function(){this._registerEvents(),this._updateCoordinates()},n.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&gt(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(gt(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof Kh&&this._connTarget instanceof Kh)){var t=this.getMap();t&&t.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},n._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},n._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var t=this.options.showOn;if(this.hide(),"moving"===t?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===t?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===t?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof Kh&&this._connTarget instanceof Kh)){var e=this.getMap();e&&e.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},e}(t)},gu={showOn:"always"},mu=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,1===arguments.length&&(i=e,e=null,n=null),r._connSource=e,r._connTarget=n,r}return K(e,t),e}(pu(jl));mu.mergeOptions(gu),mu.registerJSONType("ConnectorLine");var yu=function(t){function e(e,n,i){var r;return r=t.call(this,null,i)||this,1===arguments.length&&(i=e,e=null,n=null),r._connSource=e,r._connTarget=n,r}return K(e,t),e}(pu(au));function vu(t){return t&&t instanceof Kh}yu.mergeOptions(gu),yu.registerJSONType("ArcConnectorLine");var _u=[],xu=function(t){function e(e,n,i){var r;n&&!vu(n)&&!Array.isArray(n)&&Wt.indexOf(n.type)<0&&(i=n,n=null),(r=t.call(this,e,i)||this)._maxZIndex=0,r._minZIndex=0,r._initCache(),n&&r.addGeometry(n);var o=r.options.style;return o&&r.setStyle(o),r}K(e,t);var n=e.prototype;return n.getAltitude=function(){return 0},n.getGeometryById=function(t){return a(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},n.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var n,i=[],r=0,o=this._geoList.length;r<o;r++)n=this._geoList[r],(e?t.call(e,n):t(n))&&i.push(n);return i},n.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},n.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},n.getCount=function(){return this._geoList.length},n.getExtent=function(){if(0===this.getCount())return null;var t=new fs(this.getProjection());return this.forEach((function(e){t._combine(e.getExtent())})),t},n.forEach=function(t,e){for(var n=this._geoList.slice(0),i=0,r=n.length;i<r;i++)e?t.call(e,n[i],i):t(n[i],i);return this},n.filter=function(t,e){var n=[],i=A(t),r=i?t:Tn(t);return this.forEach((function(t){var o=i?t:Nn(t);(e?r.call(e,o):r(o))&&n.push(t)}),this),n},n.isEmpty=function(){return!this._geoList.length},n.addGeometry=function(t,e){if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(tu.toGeometry(t),e);if(!Array.isArray(t)){var n=arguments.length,i=arguments[n-1];return t=Array.prototype.slice.call(arguments,0,n-1),e=i,i&&u(i)&&("type"in i||vu(i))&&(t.push(i),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;var r;this._initCache(),e&&(r=new fs),this._toSort=this._maxZIndex>0;for(var o=[],h=0,l=t.length;h<l;h++){var c=t[h];if(!c||!tu._isGeoJSON(c)&&!vu(c))throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+h);if(!c.getLayer||c.getLayer()!==this){if(!vu(c)&&(c=Kh.fromJSON(c),Array.isArray(c)))for(var f=0,d=c.length;f<d;f++)this._add(c[f],r,h),o.push(c[f]);if(!c)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+h);Array.isArray(c)||(this._add(c,r,h),o.push(c))}}var p=this.getMap();if(p&&(this._getRenderer().onGeometryAdd(o),r&&!a(r.xmin))){var g=r.getCenter(),m=p.getFitZoom(r);if(u(e)){var y=A(e.step)?e.step:function(){};p.animateTo({center:g,zoom:m},s({duration:p.options.zoomAnimationDuration,easing:"out"},e),y)}else!0===e&&p.setCenterAndZoom(g,m)}return this.fire("addgeo",{type:"addgeo",target:this,geometries:t}),this},n.getGeoMinZIndex=function(){return this._minZIndex},n.getGeoMaxZIndex=function(){return this._maxZIndex},n._add=function(t,e,n){this._toSort||(this._toSort=0!==t.getZIndex()),this._updateZIndex(t.getZIndex());var i=t.getId();if(!a(i)){if(!a(this._geoMap[i]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+i+", at index:"+n);this._geoMap[i]=t}var r=At();t._setInternalId(r),this._geoList.push(t),this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(t)},n.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof Kh||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{type:"removegeo",target:this,geometries:t}),this},n.clear=function(){this._clearing=!0,this.forEach((function(t){t.remove()})),this._geoMap={};var t=this._geoList;this._geoList=[];var e=this._getRenderer();return e&&(e.onGeometryRemove(t),e.clearImageData&&(e.clearImageData(),delete e._lastGeosToDraw)),this._clearing=!1,this.fire("clear"),this},n.onRemoveGeometry=function(t){if(t&&!this._clearing&&this===t.getLayer()&&!a(t._getInternalId())){var e=t.getId();a(e)||delete this._geoMap[e];var n=this._findInList(t);n>=0&&this._geoList.splice(n,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}},n.getStyle=function(){return this.options.style?this.options.style:null},n.setStyle=function(t){return this.options.style=t,t=ei(t),this._cookedStyles=zn(t),this.forEach((function(t){this._styleGeometry(t)}),this),this.fire("setstyle",{type:"setstyle",target:this,style:t}),this},n._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=Nn(t),n=0,i=this._cookedStyles.length;n<i;n++)if(!0===this._cookedStyles[n].filter(e))return t._setExternSymbol(this._cookedStyles[n].symbol),!0;return!1},n.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach((function(t){t._setExternSymbol(null)}),this),this.fire("removestyle"),this):this},n.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},n.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return sl.prototype.hide.call(this)},n._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},n._updateZIndex=function(...t){this._maxZIndex=Math.max(this._maxZIndex,Math.max(...t)),this._minZIndex=Math.min(this._minZIndex,Math.min(...t))},n._sortGeometries=function(){var t=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort((function(e,n){return t._updateZIndex(e.getZIndex(),n.getZIndex()),t._compare(e,n)})),this._toSort=!1)},n._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},n._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;this._sortGeometries();for(var n,i=0,r=e-1;i<=r;){if(n=Math.floor((i+r)/2),this._geoList[n]===t)return n;this._compare(this._geoList[n],t)>0?r=n-1:i=n+1}return-1},n.onGeometryEvent=function(t){return this._onGeometryEvent(t)},n._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},n._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!a(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}a(t.old)||t.new===t.old||delete this._geoMap[t.old]}},n._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},n._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},n._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},n._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},n._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},n._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},n._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},n._hasGeoListeners=function(t){if(!t)return!1;Array.isArray(t)||(_u[0]=t,t=_u);for(var e=this.getGeometries()||[],n=0,i=e.length;n<i;n++){var r=e[n];if(r){if(r.options.cursor)return!0;for(var o=0,s=t.length;o<s;o++)if(r.listens(t[o])>0)return!0}}return!1},n._getRenderer=function(){return t.prototype._getRenderer.call(this)},e}(sl);xu.mergeOptions({drawImmediate:!1,geometryEvents:!0,geometryEventTolerance:1});var bu=new ps,wu={debug:!1,enableSimplify:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:Q.gecko,enableAltitude:!0,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,collision:!1,collisionBufferSize:2,collisionDelay:250,collisionScope:"layer",progressiveRender:!1,progressiveRenderCount:1e3,progressiveRenderDebug:!1},Cu=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this).isVectorLayer=!0,r}K(e,t);var n=e.prototype;return n.onConfig=function(e){if(t.prototype.onConfig.call(this,e),!a(e.enableAltitude))for(var n=this.getGeometries()||[],i=0,r=n.length;i<r;i++){var o=n[i];o&&(o._clearAltitudeCache(),o.fire("positionchange"))}if(e.enableAltitude||e.drawAltitude||e.altitudeProperty){var s=this.getRenderer();s&&s.setToRedraw&&s.setToRedraw()}},n.identify=function(t,e){e=e||{};var n=this.getRenderer();t instanceof $o||(t=new $o(t));var i=this.getMap().coordToContainerPoint(t);return e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(i,e):this._hitGeos(this._geoList,i,e)},n.identifyAtPoint=function(t,e){e=e||{};var n=this.getRenderer();return t instanceof ht||(t=new ht(t)),e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(t,e):this._hitGeos(this._geoList,t,e)},n._hitGeos=function(t,e,n={}){if(!t||!t.length)return[];for(var i=[],r=0,o=0,s=t.length;o<s;o++){var a=t[o];a.isPoint&&!0===a._collided||(i[r]=a,r++)}t=i;var l=n.filter,u=[],c=n.tolerance,A=this.getMap(),f=this.getRenderer(),d=f&&f.getImageData&&f.getImageData();if(d){var p=0,g=f.maxTolerance;if(h(g))p=g;else for(var m=t.length-1;m>=0;m--){var y=t[m]._hitTestTolerance()+(c||0);y>p&&(p=y)}var v=A.getDevicePixelRatio();d.r=v;for(var _=!1,x=e.x-p,b=e.y-p,w=-p;w<=p;w++){for(var C=-p;C<=p;C++){var P=Math.round((x+w)*v),M=Math.round((b+C)*v);if(d.data[M*d.width*4+4*P+3]>0){_=!0;break}}if(_)break}if(!_)return u}for(var T=n.onlyVisible,S=t.length-1;S>=0;S--){var I=t[S];if(I&&I.options.interactive&&(T||I.isVisible())){var E=I._getPainter();if(E){var O=E.getRenderBBOX&&E.getRenderBBOX();if(O){var{x:R,y:D}=e;if(R<O[0]||D<O[1]||R>O[2]||D>O[3])continue}if(!(I instanceof jl&&(I._getArrowStyle()||I instanceof su))){var k=I.getContainerExtent(bu);if(c&&(k=k._expand(c)),!k||!k.contains(e))continue}if(I._containsPoint(e,c)&&(!l||l(I))&&(u.push(I),n.count&&u.length>=n.count))break}}}return u},n.getAltitude=function(){return this.options.altitude||0},n.toJSON=function(t){t||(t={clipExtent:null,geometries:null});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if(a(t.geometries)||t.geometries){var n;if(t.clipExtent){var i=this.getMap(),r=i?i.getProjection():null;n=new fs(t.clipExtent,r)}for(var o=[],s=this.getGeometries(),h=0,l=s.length;h<l;h++){var u=s[h],c=u.getExtent();if(c&&(!n||n.intersects(c))){var A=u.toJSON(t.geometries);o.push(A)}}e.geometries=o}return e},n.getRenderer=function(){return t.prototype.getRenderer.call(this)},e.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var n=new e(t.id,t.options),i=t.geometries,r=[],o=0;o<i.length;o++){var s=Kh.fromJSON(i[o]);s&&r.push(s)}return n.addGeometry(r),n},e.getPainterClass=function(){return kh},e.getCollectionPainterClass=function(){return Nh},e}(xu);Cu.mergeOptions(wu),Cu.registerJSONType("VectorLayer");var Pu="_map_tool",Mu=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.addTo=function(t){return t?(this._map=t,t[Pu]&&t[Pu].disable(),this.onAdd&&this.onAdd(),this.enable(),t[Pu]=this,this._fireEvent("add"),this):this},n.getMap=function(){return this._map},n.enable=function(){return!this._map||this._enabled||(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable")),this},n.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},n.isEnabled=function(){return!!this._enabled},n.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[Pu],delete this._map),this._fireEvent("remove"),this):this},n._registerEvents=function(){this._switchEvents("on")},n._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},n._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},e}(Do(Lo)),Tu={symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1,zIndex:Number.MAX_VALUE,enableAltitude:!0,interactive:!0,transformCoordinate:null},Su={},Iu=function(t){function e(e){var n;return(n=t.call(this,e)||this)._checkMode(),n._events={click:n._clickHandler,"mousemove touchmove":n._mouseMoveHandler,dblclick:n._doubleClickHandler,"mousedown touchstart":n._mouseDownHandler,"mouseup touchend":n._mouseUpHandler,mousemove:n._mouseMoveHandler,mousedown:n._mouseDownHandler,mouseup:n._mouseUpHandler},n}K(e,t),e.registerMode=function(t,e){Su[t.toLowerCase()]=e},e.getRegisterMode=function(t){return Su[t.toLowerCase()]};var n=e.prototype;return n.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},n.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},n.getSymbol=function(){return ti(this.options.symbol||this.options.symbol)},n.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},n.getCurrentGeometry=function(){return this._geometry},n.onAdd=function(){this._checkMode()},n.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var t=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})),this._geometryEvents=t.options.geometryEvents,this.options.blockGeometryEvents&&t.config("geometryEvents",!1),this},n.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw({ignoreEndEvent:!0}),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&t.config("geometryEvents",this._geometryEvents),this},n.undo=function(){var t=this._getRegisterMode();if(!this._shouldRecordHistory(t.action)||!this._historyPointer)return this;var e=this._clickCoords.slice(0,--this._historyPointer);return t.update(this.getMap().getProjection(),e,this._geometry),this},n.redo=function(){var t=this._getRegisterMode();if(!this._shouldRecordHistory(t.action)||a(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var e=this._clickCoords.slice(0,++this._historyPointer);return t.update(this.getMap().getProjection(),e,this._geometry),this},n._shouldRecordHistory=function(t){return Array.isArray(t)&&"click"===t[0]&&"mousemove"===t[1]&&"dblclick"===t[2]},n._checkMode=function(){this._getRegisterMode()},n._saveMapCfg=function(){var t=this.getMap();this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom});for(var e=this._getRegisterMode().action,n=!1,i=0;i<e.length;i++)if(e[i].indexOf("mousedown")>=0||e[i].indexOf("touchstart")>=0){n=!0;break}if(n){var r=this.getMap();this._mapDraggable=r.options.draggable,r.config({draggable:!1})}},n._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),a(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},n._loadResources=function(){var t=qn(this.getSymbol());t.length>0&&this._drawToolLayer._getRenderer().loadResources(t)},n._getProjection=function(){return this._map.getProjection()},n._getRegisterMode=function(){var t=this.getMode(),n=e.getRegisterMode(t);if(!n)throw new Error(t+" is not a valid mode of DrawTool.");return n},n.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var n=0;n<t.length;n++)e[t[n]]=this._events[t[n]];return e}return null},n._mouseDownHandler=function(t){(null==t?void 0:t.coordinate)&&this._createGeometry(t)},n._mouseUpHandler=function(t){(null==t?void 0:t.coordinate)&&this.endDraw(t)},n._clickHandler=function(t){if(null==t?void 0:t.coordinate){if(!this.options.interactive)return this;t.enableAltitude=this.options.enableAltitude;var e=this.getMap(),n=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var i=this._clickCoords.length,r=e._pointToPrj(t.point2d);if(this._clickCoords[i-1].equals(r))return}if(this._geometry){var o=e._pointToPrj(t.point2d);a(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer));var s=this._geometry.snapTo;if(s&&A(s)){var h=this._getSnapResult(s,t.containerPoint);if(o=h.prjCoord,this._clickCoords=this._clickCoords.concat(h.effectedVertex),this._clickCoords[this._clickCoords.length-1].equals(o))return}if(this._clickCoords.push(o),this._historyPointer=this._clickCoords.length,t.drawTool=this,n.update(e.getProjection(),this._clickCoords,this._geometry,t),"point"===this.getMode())return void this.endDraw(t);this._fireEvent(this._clickCoords.length<=1?"drawstart":"drawvertex",t),n.clickLimit&&n.clickLimit===this._historyPointer&&this.endDraw(t)}else this._createGeometry(t)}},n._createGeometry=function(t){var e=this.getMode(),n=this.getMap(),i=this._getRegisterMode(),r=n._pointToPrj(t.point2d),o=this.getSymbol();if(!this._geometry){this._fireEvent("drawprepare",t),this._clickCoords=[r],t.drawTool=this,this._geometry=i.create(this.getMap().getProjection(),this._clickCoords,t),o&&"point"!==e?this._geometry.setSymbol(o):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t);var s=this._geometry.snapTo;if(s&&A(s)){var a=this._getSnapResult(s,t.containerPoint),h=this.getMap();h&&a&&(this._clickCoords=[a.prjCoord],i.update(h.getProjection(),this._clickCoords,this._geometry,t))}}"point"===e&&"mousemove"!==t.type&&this.endDraw(t)},n._mouseMoveHandler=function(t){if(null==t?void 0:t.coordinate){if(!this.options.interactive)return this;t.enableAltitude=this.options.enableAltitude;var e=this.getMap();if(e&&!e.isInteracting())if("point"!==this.getMode()||this._geometry){if(this._geometry){var n=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(n)){var i=e._pointToPrj(t.point2d),r=[],o=this._geometry.snapTo;if(o&&A(o)){var s=this._getSnapResult(o,n);i=s.prjCoord,r=s.effectedVertex}var a=e.getProjection();t.drawTool=this;var h=this._getRegisterMode();if(this._shouldRecordHistory(h.action)){var l=this._clickCoords.slice(0,this._historyPointer);if(l&&l.length>0&&i.equals(l[l.length-1]))return;h.update(a,l.concat(r,[i]),this._geometry,t)}else h.update(a,i,this._geometry,t);this._fireEvent("mousemove",t)}}}else this._createGeometry(t)}},n._doubleClickHandler=function(t){if(null==t?void 0:t.coordinate){if(!this.options.interactive)return this;if(t.enableAltitude=this.options.enableAltitude,this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var n=this._getRegisterMode(),i=this._clickCoords;if(i&&!(i.length<2)){var r=this.getMode();if(!(r&&r.indexOf("polygon")>-1&&i.length<3)){for(var o=this.getMap().getProjection(),s=[i[0]],a=1,h=i.length;a<h;a++)i[a].x===i[a-1].x&&i[a].y===i[a-1].y||s.push(i[a]);s.length<2||this._geometry&&this._geometry instanceof Fl&&s.length<3||(t.drawTool=this,n.update(o,s,this._geometry,t),this.endDraw(t))}}}}}},n._addGeometryToStage=function(t){this._getDrawLayer().addGeometry(t)},n.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,t.ignoreEndEvent||this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},n._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},n._getMouseContainerPoint=function(t){var e=this._getRegisterMode().action;return(e[0].indexOf("mousedown")>=0||e[0].indexOf("touchstart")>=0)&&Ee(t.domEvent),t.containerPoint},n._isValidContainerPoint=function(t){var e=this._map.getSize();return!(t.x<0||t.y<0||t.x>e.width||t.y>e.height)},n._getSnapResult=function(t,e){var n=this.getMap(),i=[];if(this.options.edgeAutoComplete){i.push(n.prjToContainerPoint(this._clickCoords[(this._historyPointer||1)-1]));var r=this._clickCoords[(this._historyPointer||1)-2];r&&i.push(n.prjToContainerPoint(r))}var o=t(e,i),s=n._containerPointToPrj(e=(o.effectedVertex?o.point:o)||e);return o.effectedVertex&&(o.effectedVertex=o.effectedVertex.map((function(t){return n._containerPointToPrj(t)}))),{prjCoord:s,effectedVertex:o.effectedVertex||[]}},n._getDrawLayer=function(){var t=Gt+"drawtool",e=this._map.getLayer(t);return e||(e=new Cu(t,{enableSimplify:!1,enableAltitude:this.options.enableAltitude,zIndex:this.options.zIndex}),this._map.addLayer(e)),this._pushLayers(e),e},n._fireEvent=function(t,e){e||(e={}),e=s({},e),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),e.tempGeometry=this._geometry),Mu.prototype._fireEvent.call(this,t,e)},n._pushLayers=function(t){var e=this;return t?(Array.isArray(t)||(t=[t]),this._layers=this._layers||[],t.forEach((function(t){-1===e._layers.indexOf(t)&&e._layers.push(t)})),this):this},n._outLayers=function(t){var e=this;return t?(Array.isArray(t)||(t=[t]),this._layers=this._layers||[],t.forEach((function(t){for(var n=0,i=e._layers.length;n<i;n++)if(t===e._layers[n]){e._layers.splice(n,1);break}})),this):this},n.setLayerZIndex=function(t){return h(t)?(this.options.zIndex=t,this._layers=this._layers||[],this._layers.forEach((function(e){e&&e.setZIndex&&e.setZIndex(t)})),this):this},n.addCoordinate=function(t){if(!this.isEnabled())return this;var e=this.getMap();if(!e)return this;t=new $o(t);var n=e._parseEventFromCoord(t);return this._clickHandler(n),this},n.getTempGeometry=function(){return this._geometry},e}(Mu);Iu.mergeOptions(Tu);var Eu=function(t){function e(e){var n;return(n=t.call(this,e)||this).drawTool=new Iu({mode:"boxZoom",ignoreMouseleave:!1}),n}K(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},n.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},n._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},n._boxZoom=function(t){var e=this.target;this.drawTool.remove();var n=t.geometry,i=n.getCenter(),r=n.getSymbol(),o=new fs(i,e.locateByPoint(i,r.markerWidth,r.markerHeight),e.getProjection()),s=e.getFitZoom(o);e._animateTo({center:o.getCenter(),zoom:s})},e}(ko);Al.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),Al.addOnLoadHook("addHandler","boxZoom",Eu);var Ou=30,Ru=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},n.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},n._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var{containerPoint:n}=t,i=e.getContainerExtent();if(i){var r,{x:o,y:s}=n,{xmax:a,ymax:h}=i;o<Ou&&(r=[Math.abs(o-Ou),0]),s<Ou&&(r=[0,Math.abs(s-Ou)]),o+Ou>a&&(r=[-Math.abs(o+Ou-a),0]),s+Ou>h&&(r=[0,-Math.abs(s+Ou-h)]),r&&e.panBy(r,{duration:1})}}},e}(ko);function Du(t,e){var n=t.bearing,i=e.getBearing();return!(i>=0&&n>180||i<=0&&n<-180)}function ku(t,e){var n=t.bearing,i=e.getBearing();i>=0&&n<0&&(t.bearing=180-Math.abs(n)+180),i<=0&&n>0&&(t.bearing=-180-(180-Math.abs(n))),i>=0&&n>0&&(t.bearing=-180-(180-Math.abs(n))),i<=0&&n<0&&(t.bearing=180-Math.abs(n)+180)}function Lu(t,e,n){return t*(1-n)+e*n}Al.mergeOptions({autoPanAtEdge:!1}),Al.addOnLoadHook("addHandler","autoPanAtEdge",Ru),Al.include({animateTo:function(t,e={},n){var i=this;(t=s({},this.getView(),t)).bearing=t.bearing%360,A(e)&&(n=e,e={}),e.counterclockwise&&ku(t,this),Du(t,this)&&this._validateView(t);var r=this.getProjection(),o=this.getView(),h={},l=!0;for(var u in t)if(d(t,u)&&!a(t[u])&&("prjCenter"===u||!a(o[u])))if(l=!1,"center"===u){var c=new $o(o[u]),f=new $o(t[u]);c.equals(f)||(h.center=[c,f])}else if("prjCenter"===u){var p=new $o(this._getPrjCenter()),g=new $o(t[u]);p.equals(g)||(h.prjCenter=[p,g])}else o[u]!==t[u]&&"around"!==u&&(h[u]=[o[u],t[u]]);if(l)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var m=t.around||null,y=this._getRenderer(),v=this._animPlayer=Sl.animate(h,{easing:e.easing||"out",duration:e.duration||this.options.zoomAnimationDuration,framer:function(t){y.callInNextFrame(t)},repeat:e.repeat},(function(t){i.isRemoved()?v.finish():("running"===v.playState?(t.styles.center?(i._setPrjCenter(r.project(t.styles.center)),i.onMoving(i._parseEventFromCoord(i.getCenter()))):t.styles.prjCenter&&(i._setPrjCenter(t.styles.prjCenter),i.onMoving(i._parseEventFromCoord(i.getCenter()))),a(t.styles.zoom)||i.onZooming(t.styles.zoom,m),a(t.styles.pitch)||i._setPitch(t.styles.pitch),a(t.styles.bearing)||i._setBearing(t.styles.bearing),i._fireEvent("animating")):"paused"===v.playState&&v!==i._mapAnimPlayer||(v._interupted||(h.center?i._setPrjCenter(r.project(h.center[1])):h.prjCenter&&i._setPrjCenter(h.prjCenter[1]),a(h.pitch)||i._setPitch(h.pitch[1]),a(h.bearing)||i._setBearing(h.bearing[1])),i._endAnim(v,h,m,e)),n&&n(t))}),this);return this._startAnim(h,m),v},_animateTo:function(t,e={},n){return this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(t,e,n),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(t,e={},n){var i=this;(t=s({},this.getView(),t)).bearing=t.bearing%360,e.counterclockwise&&ku(t,this),Du(t,this)&&this._validateView(t),this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),A(e)&&(n=e,e={}),e=s({curve:1.42},e);var r=this;function o(t,e){return r.getResolution(e)/r.getResolution(t)}var a=t.around||new ht(this.width/2,this.height/2),h=this.getMinZoom(),l=this.getMaxZoom(),u=this.getProjection(),c=this.getView(),f=c.zoom,d=c.bearing,p=c.pitch,g="zoom"in t?bt(+t.zoom,h,l):f,m="bearing"in t?+t.bearing:d,y="pitch"in t?+t.pitch:p,v=u.project(t.center&&new $o(t.center)||this.getCenter()),_=o(g,f),x=u.project(this.getCenter()),b=v.sub(x),w=e.curve,C=Math.max(this.width,this.height),P=C/_,M=b.mag();if("minZoom"in e){var T=bt(Math.min(e.minZoom,f,g),h,l),S=C/o(T,f);w=Math.sqrt(S/M*2)}var I=w*w;function E(t){var e=(P*P-C*C+(t?-1:1)*I*I*M*M)/(2*(t?P:C)*I*M);return Math.log(Math.sqrt(e*e+1)-e)}function O(t){return(Math.exp(t)-Math.exp(-t))/2}function R(t){return(Math.exp(t)+Math.exp(-t))/2}var D=E(0),k=function(t){return R(D)/R(D+w*t)},L=function(t){return C*((R(D)*(O(e=D+w*t)/R(e))-O(D))/I)/M;var e},F=(E(1)-D)/w;if(Math.abs(M)<1e-6||!isFinite(F)){if(Math.abs(C-P)<1e-6)return this.animateTo(t,e,n);var N=P<C?-1:1;F=Math.abs(Math.log(P/C))/w,L=function(){return 0},k=function(t){return Math.exp(N*w*t)}}var z=this._getRenderer(),B=this._animPlayer=Sl.animate({k:[0,1]},{easing:e.easing||"out",duration:e.duration||8,framer:function(t){z.callInNextFrame(t)}},(function(r){if(i.isRemoved())B.finish();else{var o=r.styles.k,s=o*F,h=1/k(s),l={};if(t.center){var u=1===o?v:x.add(b.multi(L(s)));l.prjCenter=[v,u]}if(f!==g){var c=1===o?g:i.getZoomForScale(h,f,!0);l.zoom=[f,c]}if(p!==y){var A=Lu(p,y,o);l.pitch=[y,A]}if(d!==m){var _=Lu(d,m,o);l.bearing=[m,_]}"running"===B.playState?(l.prjCenter&&(i._setPrjCenter(l.prjCenter[1]),i.onMoving(i._parseEventFromCoord(i.getCenter()))),l.zoom&&i.onZooming(l.zoom[1],a),l.pitch&&i._setPitch(l.pitch[1]),l.bearing&&i._setBearing(l.bearing[1]),i._fireEvent("animating")):"paused"===B.playState&&B!==i._mapAnimPlayer||(B._interupted||(l.prjCenter&&i._setPrjCenter(l.prjCenter[1]),l.pitch&&i._setPitch(l.pitch[1]),l.bearing&&i._setBearing(l.bearing[1])),i._endAnim(B,l,a,e)),n&&n(r)}}),{});return this._startAnim({center:t.center,zoom:t.zoom!==f,pitch:y!==p,bearing:m!==d},a),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,e,n,i){delete this._animRotating;var r,o=t._interupted?"animateinterrupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer,e.center)r=t._interupted?this.getCenter():e.center[1],this.onMoveEnd(this._parseEventFromCoord(r));else if(e.prjCenter){var s;s=t._interupted?this._getPrjCenter():e.prjCenter[1];var h=this._parseEventFromCoord(this.getProjection().unproject(s));h.point2d=this._prjToPoint(s),this.onMoveEnd(h)}a(e.zoom)||(t._interupted?this.onZoomEnd(this.getZoom()):i.wheelZoom?this.onZooming(e.zoom[1],n):this.onZoomEnd(e.zoom[1])),o&&this._fireEvent(o),a(e.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),i.wheelZoom||this._resumePrev(t)},_startAnim:function(t,e){this._animPlayer&&((t.center||t.prjCenter)&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],e),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){t&&(delete this._animRotating,"finished"!==t.playState&&(t._interupted=!0,t.cancel()),t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(t){if(this._prevAnimPlayer){var e=this._prevAnimPlayer;"paused"!==e.playState&&delete this._prevAnimPlayer,t!==e&&(this._animPlayer=e,e.play())}}});var Fu=[60,120];function Nu(t){t.stopPropagation(),t.preventDefault()}var zu=["dragstart","dragenter","dragend","dragleave","dragover"].join(" ").toString(),Bu="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend drop ";function Hu(t,e,n){var i=e[0],r=e[1],o=e[2],s=1/(n[3]*i+n[7]*r+n[11]*o+n[15]);return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])*s,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])*s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])*s,t}Al.include({_registerDomEvents:function(){var t=this._panels.mapWrapper||this._containerDOM;Me(t,Bu,this._handleDOMEvent,this),Me(t,zu,Nu,this)},_removeDomEvents:function(){var t=this._panels.mapWrapper||this._containerDOM;Te(t,Bu,this._handleDOMEvent),Te(t,zu,Nu)},_handleDOMEvent:function(t){if(t&&"drop"===t.type){t.stopPropagation(),t.preventDefault();var e=this._parseEvent(t,t.type);return e=s({},e,{dataTransfer:t.dataTransfer}),void this._fireEvent(t.type,e)}var n=this.options.clickTimeThreshold,i=t.type;if(!qe(i)||r.isTest||!Ze(this,this.options.mousemoveThrottleTime)){var a="mousedown"===i||"touchstart"===i&&(!t.touches||1===t.touches.length);a&&(this._domMouseDownTime=o(),this._domMouseDownView=this.getView());var h="contextmenu"===i&&function(t){if(!t._domMouseDownView)return!0;var e=t.getView(),n=t._domMouseDownView;return e.bearing!==n.bearing||e.pitch!==n.pitch}(this);if("contextmenu"===i){Ie(t);var l=this._domMouseDownTime;o()-l<=n&&!h&&this._fireDOMEvent(this,t,"dom:"+t.type)}else this._fireDOMEvent(this,t,"dom:"+t.type);if(!this._ignoreEvent(t)){var u,c=!1;if(a)this._mouseDownTime=o();else if("click"===i||"touchend"===i||"contextmenu"===i){if(!this._mouseDownTime)return;var A=this._mouseDownTime;if(delete this._mouseDownTime,o()-A>n){if("click"===i||"contextmenu"===i)return}else if("contextmenu"===i){if(h)return}else"touchend"===i&&(c=!0)}c&&(this._clickTime&&o()-this._clickTime<=n?(delete this._clickTime,u="dblclick",this._fireDOMEvent(this,t,"dom:dblclick")):(this._clickTime=o(),u="click",this._fireDOMEvent(this,t,"dom:click"))),this._ignoreEvent(t)||(this._fireDOMEvent(this,t,i),u&&this._fireDOMEvent(this,t,u))}}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;var e,n=t.srcElement||t.target;if(n)for(;n&&n!==this._containerDOM;){if(n.className&&n.className.indexOf&&(n.className.indexOf("maptalks-control")>=0||n.className.indexOf("maptalks-ui")>=0&&e&&!e.eventsPropagation))return!0;e=n,n=n.parentNode}return!1},_isEventOutMap:function(t){var e=ke(this._getActualEvent(t),this._containerDOM);return this._isContainerPointOutOfMap(e)},_isContainerPointOutOfMap:function(){var t=[0,0,0],e=[0,0,0],n=new ir(t,e),i=[0,0,0];return function(r){var o=this.getPitch();if(o>Fu[0]&&o<Fu[1]){if(this.getContainerPointRay(t,e,r,0,.5),n.setFromTo(t,e),!n.intersectGround(i))return!0;if(n.distanceToGround()<=0)return!0}return!1}}(),_wrapTerrainData:function(t){t.containerPoint&&!t.terrain&&(t.terrain=this._queryTerrainInfo(t.containerPoint))},_parseEvent:function(t,e){if(!t)return null;var n={domEvent:t};if("keypress"!==e){var i=this._getActualEvent(t);if(i&&void 0!==i.clientX){var r=ke(i,this._containerDOM);n=s(n,{containerPoint:r,viewPoint:this.containerPointToViewPoint(r)}),this._isContainerPointOutOfMap(r)||(n=s(n,{coordinate:this.containerPointToCoord(r),point2d:this._containerPointToPoint(r)}))}}return this._wrapTerrainData(n),n},_parseEventFromCoord:function(t){var e=this.coordToContainerPoint(t);return{coordinate:t,containerPoint:e,viewPoint:this.containerPointToViewPoint(e),point2d:this.coordToPoint(t)}},_getActualEvent:function(t){return t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t},_fireDOMEvent:function(t,e,n){var i=this;if(!this.isRemoved()){var r=this._parseEvent(e,n);this._wrapTerrainData(r),qe(n)?this.getRenderer().callInNextFrame((function(){i._fireEvent(r.domEvent&&r.domEvent._cancelBubble?"_"+n:n,r)})):this._fireEvent(n,r)}},_getEventParams:function(t){var e=this,n={domEvent:t},i=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(i){var r=ke(i,e.getContainer());n.coordinate=e.containerPointToCoordinate(r),n.containerPoint=r,n.viewPoint=e.containerPointToViewPoint(r),n.point2d=e._containerPointToPoint(r)}return this._wrapTerrainData(n),n}}),Al.addOnLoadHook("_registerDomEvents"),Al.include({isFullScreen:function(){var t=document;return!!(t.webkitIsFullScreen||t.mozFullScreen||t.msFullscreenElement||t.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullscreen)t.requestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var e="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",e)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){var t=document;document.exitFullscreen?document.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}),Al.include({panTo:function(t,e={},n){if(!t)return this;if(A(e)&&(n=e,e={}),t=new $o(t),void 0===e.animation||e.animation){var i=this.getProjection().project(t);return this._panAnimation(i,e.duration,n)}return this.setCenter(t),this},_panTo:function(t,e={}){return void 0===e.animation||e.animation?this._panAnimation(t,e.duration):(this.onMoveStart(),this._setPrjCenter(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(t,e={},n){if(!t)return this;if(A(e)&&(n=e,e={}),t=new ht(t),this.getContainerExtent().ymin>0&&t.y>30){var i=t.y;t.y=30,t.x=30*t.x/i,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(void 0===e.animation||e.animation){t=t.multi(-1);var r=this._containerPointToPrj(new ht(this.width/2+t.x,this.height/2+t.y));this._panAnimation(r,e.duration,n)}else{this.onMoveStart(),this._offsetCenterByPixel(t);var o=this.containerPointToCoord(new ht(this.width/2,this.height/2));this.onMoveEnd(this._parseEventFromCoord(o))}return this},_panAnimation:function(t,e,n){return this._animateTo({prjCenter:t},{duration:e||this.options.panAnimationDuration},n)}}),Al.include({computeLength:function(t,e){if(!this.getProjection())return null;var n=new $o(t),i=new $o(e);return n.equals(i)?0:this.getProjection().measureLength(n,i)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,e){var n=new $o((t=t||{}).coordinate);return this._identify(t,e,(function(e){return e.identify(n,t)}))},identifyAtPoint:function(t,e){var n=t.includeInternals,i=t.tolerance,r=new ht((t=t||{}).containerPoint),o=this.containerPointToCoord(r);return this._identify(t,e,(function(e){var r,s=t.containerPoint;return n&&!a(e.options.geometryEventTolerance)&&(t.tolerance=t.tolerance||0,t.tolerance+=e.options.geometryEventTolerance),e._hasGeoListeners&&n&&t.eventTypes.indexOf("mousemove")>=0&&!e._hasGeoListeners(t.eventTypes)?[]:(r=e.identifyAtPoint?e.identifyAtPoint(s,t):o&&e.identify?e.identify(o,t):[],n&&(a(i)?delete t.tolerance:t.tolerance=i),r&&r.length||(e.fire("identifyempty",t),e.getLayers&&A(e.getLayers)&&(e.getLayers()||[]).filter((function(t){return t})).forEach((function(e){e.fire("identifyempty",t)}))),r)}))},_identify:function(t,e,n){var i=t.layers;if(!wt(i))return this;for(var r=t.eventTypes,o=[],s=0,h=i.length;s<h;s++)c(i[s])?o.push(this.getLayer(i[s])):o.push(i[s]);r&&(o=o.filter((function(t){return!t._hasGeoListeners||t._hasGeoListeners(r)})));for(var l=[],u=o.length-1;u>=0&&!(t.count&&l.length>=t.count);u--){var A=o[u];if(A&&A.getMap()&&(t.includeInvisible||A.isVisible())&&(t.includeInternals||!(A.getId().indexOf(Gt)>=0))){var f=n(A),d=A.getId();if(f)if(Array.isArray(f)){for(var p=0;p<f.length;p++)f[p]&&!f[p].getLayer&&a(f[p].layer)&&(f[p].layer=d);pt(l,f)}else!f.getLayer&&a(f.layer)&&(f.layer=d),l.push(f)}}return e.call(this,l),this}}),Al.include({_zoom:function(t,e){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoomOrigin(e),t=this._checkZoom(t),this.onZoomStart(t,e),this._frameZoom=this.getZoom(),this.onZoomEnd(t,e))},_zoomAnimation:function(t,e,n){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoom(t),this.getZoom()!==t&&(e=this._checkZoomOrigin(e),this._startZoomAnim(t,e,n)))},_checkZoomOrigin:function(t){return(!t||this.options.zoomInCenter||this._isContainerPointOutOfMap(t))&&(t=new ht(this.width/2,this.height/2)),this.options.zoomOrigin&&(t=new ht(this.options.zoomOrigin)),t},_startZoomAnim:function(t,e,n){a(n)&&(n=1);var i=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(i-n)/Math.abs(i-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:t,around:e},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,e){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),delete this.cameraZenithDistance,this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=e&&this._containerPointToPrj(e),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,e,n){if(this.options.zoomable&&this._frameZoom!==t){a(n)&&(n=1),this._zoomTo(t,e);var i=this.getResolution(t),r=this.getResolution(this._startZoomVal)/i/n,o=this._startZoomCoord&&this.prjToContainerPoint(this._startZoomCoord,this._startZoomVal),s=this.getViewPoint();if(!this.isRotating()&&o&&!o.equals(e)&&1!==r){var h=this.getPitch(),l=o._sub(e)._multi(1/(1-r));h&&(l.y/=Math.cos(h*Math.PI/180)),e=e.add(l)}var u=e&&e.x||this.width/2,c=e&&e.y||this.height/2,A={view:[r,0,0,r,(u-s.x)*(1-r),(c-s.y)*(1-r)]},f=this.getDevicePixelRatio();A.container=[r,0,0,r,u*f*(1-r),c*f*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:new ht(u,c),matrix:A}),this._frameZoom=t}},onZoomEnd:function(t,e){if(this.options.zoomable){var n=this._startZoomVal;this._zoomTo(t,e),this._zooming=!1,this._getRenderer().onZoomEnd(),this._suppressRecenter||this._recenterOnTerrain(),this._fireEvent("zoomend",{from:n,to:t}),this._verifyExtent(this._getPrjCenter())||this.options.limitExtentOnMaxExtent||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(t,e){if(this._zoomLevel=t,this._calcMatrices(),e&&this._startZoomCoord){var n=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter()));this._setPrjCoordAtOffsetToCenter(this._startZoomCoord,n)}},_checkZoom:function(t){var e=this.getMaxZoom(),n=this.getMinZoom();return t<n&&(t=n),t>e&&(t=e),t}});var ju,Uu=Math.PI/180,Gu=new $o(0,0),Vu=new ht(0,0),Wu=[0,-1,0],qu=[];function Zu(){return di(new Array(16))}Al.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/Uu},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*Uu,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/Uu:0},setBearing:function(t){var e={bearing:t};return this._validateView(e),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(e.bearing)},_setBearing:function(t){if(Q.ie9)throw new Error("map can't rotate in IE9.");var e=-xt(t,-180,180)*Uu;if(this._angle===e)return this;var n=this.getBearing();return this._fireEvent("rotatestart",{from:n,to:e}),this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:n,to:e}),this._fireEvent("rotateend",{from:n,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){var e={pitch:t};return this._validateView(e),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(e.pitch)},_setPitch:function(t){if(Q.ie9)throw new Error("map can't tilt in IE9.");var e=bt(t,0,this.options.maxPitch)*Uu;if(this._pitch===e)return this;var n=this.getPitch();return this._fireEvent("pitchstart",{from:n,to:e}),this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:n,to:e}),this._fireEvent("pitchend",{from:n,to:e}),this},setCameraMovements:function(t,e){var n=this;if(!Array.isArray(t)||!t.length)return this;if(t.forEach((function(t){n._validateView(t)})),this.setView({center:t[0].center,zoom:t[0].zoom,pitch:t[0].pitch,bearing:t[0].bearing}),1===t.length)return this;var i=1,r=function(o){if("finished"===o.state.playState){++i==t.length-1&&(r=null);var s=t[i];s.duration=s.timestamp-t[i-1].timestamp,e&&e.autoRotate&&(s.bearing=(a=t[i-1].center,h=s.center,l=g(a[0]),u=g(h[0]),c=g(a[1]),A=g(h[1]),f=Math.sin(u-l)*Math.cos(A),d=Math.cos(c)*Math.sin(A)-Math.sin(c)*Math.cos(A)*Math.cos(u-l),m(Math.atan2(f,d)))),n._setCameraMovement(s,r)}var a,h,l,u,c,A,f,d};2===t.length&&(r=null);var o=this.getBearing();return this._setCameraMovement(Object.assign({bearing:o,duration:t[i].timestamp-t[i-1].timestamp},t[i]),r),{play:function(){n._animPlayer.play()},pause:function(){n._animPlayer.pause()},cancel:function(){n._animPlayer.cancel()},finish:function(){n._animPlayer.finish()},reverse:function(){n._animPlayer.reverse()}}},_setCameraMovement:function(t,e){this.animateTo({zoom:t.zoom,center:t.center,pitch:t.pitch,bearing:t.bearing},{duration:t.duration,easing:"out"},e)},setCameraOrientation:function(t){var{position:e}=t;this._validateView(t);var{pitch:n,bearing:i}=t;n=n||0,i=i||0;var{zoom:r,cameraToGroundDistance:o}=this.getFitZoomForCamera(e,n),s=Math.sin(n*Uu)*o,a=xt(i,-180,180)*Uu,h=this.getGLRes(),l=new $o(e[0],e[1]),u=this.coordToPointAtRes(l,h),c=new ht(0,0);c.x=u.x+s*Math.sin(a),c.y=u.y+s*Math.cos(a);var A=this._pointToPrjAtRes(c,this.getGLRes());return this._setPrjCenter(A),this.setView({bearing:i,pitch:n,zoom:r}),this},setCameraPosition:function(t){var e=this.getGLRes(),n=this.coordToPointAtRes(t,e);n.z=this.altitudeToPoint(t.z||0,e);var i=this.getCenter(),r=this.coordToPointAtRes(i,e);r.z=this.altitudeToPoint(i.z,e);var o=Hi([],n.toArray(),r.toArray());zi(this.cameraUp||[0,0,0],0,0,1),this._pitch=Qi(o,this.cameraUp),zi(qu,o[0],o[1],0),this._angle=-Qi(qu,Wu),this._zoomLevel=this.getFitZoomForCamera(t,this._pitch).zoom,this._calcMatrices()},getFitZoomForCamera:function(t,e){var n=Array.isArray(t)?t[2]:t.z,i=(this.centerAltitude||0)*this._meterToGLPoint,r=(n*this._meterToGLPoint-i)/Math.cos(e*Uu);return{zoom:this.getFitZoomForAltitude(r+i),cameraToGroundDistance:r}},getFitZoomForAltitude:function(t){for(var e=t*this._getFovRatio()*2/(this.height||1)*this.getGLRes(),n=this._getResolutions(),i=0;i<n.length-1;i++){if(n[i]===e)return i;if(n[i+1]===e)return i+1;if(e<n[i]&&e>n[i+1])return(i=(e-n[i])/(n[i+1]-n[i])+i)-1}return i},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var t=90-this.getPitch(),e=this.getFov()/2,n=this.cameraPosition?this.cameraPosition[2]:0;if(e<=t)return n;e=Math.PI*e/180;var i=new ht(this.cameraPosition).distanceTo(new ht(this.cameraLookAt)),r=n*Math.tan(2*e);return n+Math.tan(e)*(i+r)},_pointToContainerPoint:function(t,e,n=0,i){var r=this._getResolution(e);return this._pointAtResToContainerPoint(t,r,n,i)},_pointAtResToContainerPoint:function(t,e,n=0,i){i||(i=new ht(0,0)),t=this._pointAtResToPoint(t,e,i);var r,o=this.isTransforming();return o||n||(r=this._prjToPoint(this._getPrjCenter(),void 0,Gu)),this._toContainerPoint(i,o,n,r),i},_pointsAtResToContainerPoints:function(t,e,n=[],i=[]){var r=this.getPitch(),o=this.getBearing(),s=e/this._getResolution();if(0===r&&0===o&&!function(t){if(h(t))return 0!==t;if(Array.isArray(t)&&t.length>0)for(var e=0,n=t.length;e<n;e++)if(h(t[e])&&0!==t[e])return!0;return!1}(n)){var{xmin:a,ymin:l,xmax:u,ymax:c}=this.get2DExtent();if(u>a&&c>l){for(var{width:A,height:f}=this.getSize(),d=(u-a)/A,p=(c-l)/f,g=0,m=t.length;g<m;g++)if(t[g]){var y=i[g];y.x=t[g].x,y.y=t[g].y,y._multi(s),y.x=(y.x-a)*d,y.y=f-(y.y-l)*p}else i[g]=null;return i}}for(var v=Array.isArray(n),_=this.isTransforming(),x=this._prjToPoint(this._getPrjCenter(),void 0,Gu),b=0,w=t.length;b<w;b++)if(t[b]){var C=i[b];C.x=t[b].x,C.y=t[b].y,C._multi(s),this._toContainerPoint(C,_,v?n[b]||0:n,x)}else i[b]=null;return i},_toContainerPoint:function(){var t=[0,0,0];return function(e,n,i,r){var o=this.width/2,s=this.height/2;if(n||i){this._altitudeScale||(this._altitudeScale=this.altitudeToPoint(100,this.getGLRes())/100);var a=this._glScale;zi(t,e.x*a,e.y*a,i*this._altitudeScale);var h=this._projIfBehindCamera(t,this.cameraPosition,this.cameraForward);Hu(h,h,this.projViewMatrix),e.x=h[0]*o+o,e.y=-h[1]*s+s}else e._sub(r.x,r.y),e.set(e.x,-e.y),e._add(o,s)}}(),_projIfBehindCamera:function(){var t=new Array(3),e=new Array(3),n=new Array(3);return function(i,r,o){Hi(t,i,r);var s=Vi(o,t);return s<=0&&(Wi(e,o,1.01*s),Bi(i,r,Hi(n,t,e))),i}}(),_containerPointToPoint:function(t,e,n,i){var r=this._getResolution(e);return this._containerPointToPointAtRes(t,r,n,i)},_containerPointToPointAtRes:function(){var t=[0,0,0],e=[0,0,0];return function(n,i,r,o){if(this.isTransforming()){this.getContainerPointRay(t,e,n);var s=t[0],a=e[0],h=t[1],l=e[1],u=t[2],c=e[2],A=o?this.altitudeToPoint(o,i)*this._glScale:0,f=u===c?A:(A-u)/(c-u),d=_t(s,a,f),p=_t(h,l,f);return r?(r.x=d,r.y=p):r=new ht(d,p),r._multi(1/this._glScale),this._getResolution()===i?r:this._pointToPointAtRes(r,i,r)}var g=this._prjToPointAtRes(this._getPrjCenter(),i,r),m=this._getResolution()/i;return g._add(m*(n.x-this.width/2),-m*(n.y-this.height/2))}}(),getContainerPointRay:function(){var t=[0,0,0],e=[0,0,0,1],n=[0,0,0,1];return function(i,r,o,s=0,a=1){var h=this.width/2||1,l=this.height/2||1;zi(t,(o.x-h)/h,(l-o.y)/l,0),zi(e,t[0],t[1],s),zi(n,t[0],t[1],a),e[3]=n[3]=1,Hu(i,e,this.projViewMatrixInverse),Hu(r,n,this.projViewMatrixInverse)}}(),_calcMatrices:(ju=Zu(),function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var t=this.getSize(),e=t.width||1,n=t.height||1;this._glScale=this.getGLScale();var i=this._getCameraWorldMatrix(),r=this.getFov()*Math.PI/180,o=this._getCameraFar(r,this.getPitch());this.cameraFar=o,this.cameraNear=this.cameraCenterDistance/20;var s=this.projMatrix||Zu();ai(s,r,e/n,this.cameraNear,o),this.projMatrix=s,this.viewMatrix=fi(this.viewMatrix||Zu(),i),this.projViewMatrix=Ai(this.projViewMatrix||Zu(),s,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=Ai(this.projViewMatrixInverse||Zu(),i,fi(ju,s)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this.get2DExtent(),this._mapGlExtent2D=this.get2DExtentAtRes(this._mapGlRes)}),_getCameraFar:function(t,e){var n=this.cameraCenterDistance=Zi(this.cameraPosition,this.cameraLookAt),i=n/this._meterToGLPoint;e=(e=Math.min(e,85))*Math.PI/180;var r=i+this.options.cameraFarUndergroundInMeter/Math.cos(e);return Math.max(r*this._meterToGLPoint,5*n)},_calcCascadeMatrixes:function(){var t=Zu();function e(e,n,i){var r=this.width,o=this.height,s=this.getFov()*Math.PI/180,a=this._getCameraFar(s,n),h=this.cameraCenterDistance;return a=h+(a-h)/Math.cos((90-n)*Math.PI/180)*Math.cos((90-e)*Math.PI/180),ai(t,s,r/o,.1,a),Ai(i,t,this.viewMatrix)}return function(){var t=this.getPitch(),n=this.options.cascadePitches[0],i=this.options.cascadePitches[1],r=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||Zu(),o=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||Zu();t>n?e.call(this,t,n,r):pi(this.cascadeFrustumMatrix0,this.projViewMatrix),t>i?e.call(this,t,i,o):pi(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var t=Zu(),e=Zu(),n=[1,-1,1],i=[0,0,0];return function(){var r=this.width||1,o=this.height||1,s=.5/Math.tan(this._fov/2)*o;return li(t,this.projMatrix,n),hi(t,t,zi(i,0,0,-s)),this._pitch&&ui(t,t,this._pitch),this._angle&&ci(t,t,this._angle),di(e),li(e,e,zi(i,r/2,-o/2,1)),Ai(this.domCssMatrix||Zu(),e,t)}}(),_getFovZ:function(t){var e=this.getGLScale(t),n=this._getFovRatio();return e*(this.height||1)/2/n},_getCameraWorldMatrix:function(){var t={};return function(){var e=this.getGLRes();this._meterToGLPoint||(this._meterToGLPoint=this.distanceToPointAtRes(100,0,e).x/100);var n=this._prjToPointAtRes(this._prjCenter,e,Vu),i=this.getCenter().z,r=(void 0!==i?i:this.centerAltitude||0)*this._meterToGLPoint;this.cameraLookAt=zi(this.cameraLookAt||[0,0,0],n.x,n.y,r);var o=this.getPitch()*Uu,s=this.getBearing()*Uu,a=this._getFovZ(),h=(void 0===this.cameraZenithDistance?a:this.cameraZenithDistance)-r,l=h*Math.cos(o),u=Math.sin(o)*h,c=n.x-u*Math.sin(s),A=n.y-u*Math.cos(s);this.cameraPosition=zi(this.cameraPosition||[0,0,0],c,A,l+r),this.cameraToCenterDistance=a,this.cameraUp=this.cameraUp||[0,0,0],this.cameraUp=this._getCameraUp(this.cameraUp,this.cameraLookAt,this.cameraPosition,o,s);var f,d,p,g,m,y,v,_=this.cameraWorldMatrix=this.cameraWorldMatrix||Zu();f=_,d=this.cameraPosition,p=this.cameraLookAt,g=this.cameraUp,m=[0,0,0],y=[0,0,0],Hi(v=[0,0,0],d,p),0===Ui(v)&&(v[2]=1),Gi(v,v),qi(m,g,v),0===Ui(v)&&(1===Math.abs(g[2])?v[0]+=1e-4:v[2]+=1e-4,Gi(v,v),qi(m,g,v)),Gi(m,m),qi(y,v,m),f[0]=m[0],f[4]=y[0],f[8]=v[0],f[1]=m[1],f[5]=y[1],f[9]=v[1],f[2]=m[2],f[6]=y[2],f[10]=v[2];var x=this.cameraForward||[0,0,0];return Hi(x,this.cameraLookAt,this.cameraPosition),this.cameraForward=Gi(x,x),function(t,e){var n,i=e[0],r=e[4],o=e[8],s=e[1],a=e[5],h=e[9],l=e[2],u=e[6],c=e[10],A=i+a+c;A>0?(n=.5/Math.sqrt(A+1),t.w=.25/n,t.x=(u-h)*n,t.y=(o-l)*n,t.z=(s-r)*n):i>a&&i>c?(n=2*Math.sqrt(1+i-a-c),t.w=(u-h)/n,t.x=.25*n,t.y=(r+s)/n,t.z=(o+l)/n):a>c?(n=2*Math.sqrt(1+a-i-c),t.w=(o-l)/n,t.x=(r+s)/n,t.y=.25*n,t.z=(h+u)/n):(n=2*Math.sqrt(1+c-i-a),t.w=(s-r)/n,t.x=(o+l)/n,t.y=(h+u)/n,t.z=.25*n)}(t,_),function(t,e){var n=t,i=e.x,r=e.y,o=e.z,s=e.w,a=i+i,h=r+r,l=o+o,u=i*a,c=i*h,A=i*l,f=r*h,d=r*l,p=o*l,g=s*a,m=s*h,y=s*l;n[0]=1-(f+p),n[4]=c-y,n[8]=A+m,n[1]=c+y,n[5]=1-(u+p),n[9]=d-g,n[2]=A-m,n[6]=d+g,n[10]=1-(u+f),n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}(_,t),function(t,e){var n=t;n[12]=e[0],n[13]=e[1],n[14]=e[2]}(_,this.cameraPosition),_}}(),_getCameraUp:function(){var t=[0,0,0],e=[0,0,0],n=[0,0,0];return function(i,r,o,s,a){zi(n,0,0,1),0===s?zi(n,Math.sin(a),Math.cos(a),0):s===Math.PI&&zi(n,-Math.sin(a),-Math.cos(a),0);var h=Hi(t,r,o);Gi(h,h);var l=qi(e,h,n);return qi(i,l,h)}}(),updateCenterAltitude:function(){this.getRenderer().setToRedraw(),!this.centerAltitude&&this._hasAltitudeLayer()&&(this.centerAltitude=0),this._recenterOnTerrain()},_recenterOnTerrain:function(){if(void 0!==this.centerAltitude&&void 0===this._centerZ){var t=this._queryTerrainByProjCoord(this._prjCenter);a(t)&&this._hasAltitudeLayer()&&(t=this.centerAltitude);var e=t||0,n=this.getPitch()*Uu,i=this.getBearing()*Uu,r=(e-this.centerAltitude)*this._meterToGLPoint,o=this._getFovZ(),s=(void 0===this.cameraZenithDistance?o:this.cameraZenithDistance)-this.centerAltitude*this._meterToGLPoint-r/Math.cos(n),h=this.cameraPosition,l=Math.sin(n)*s,u=Vu;u.x=h[0]+l*Math.sin(i),u.y=h[1]+l*Math.cos(i);var c=e*this._meterToGLPoint;this.cameraZenithDistance=(h[2]-c)/Math.cos(n)+c,this.centerAltitude=e;var A=this.pointAtResToCoordinate(u,this.getGLRes(),Gu);this._eventSilence=!0,this._suppressRecenter=!0,this.setCenter(A),delete this._suppressRecenter,delete this._eventSilence,a(t)&&delete this.centerAltitude}},_queryTerrainByProjCoord:function(t){for(var e=this._getLayers(),n=0;n<e.length;n++)if(e[n].queryTerrainByProjCoord)return e[n].queryTerrainByProjCoord(t)[0];return 0},_hasAltitudeLayer:function(){for(var t=this._getLayers(),e=0;e<t.length;e++)if(t[e].getTerrainLayer&&t[e].getTerrainLayer())return!0;return!1},_queryTerrainInfo:function(t){for(var e=this._getLayers()||[],n=0;n<e.length;n++){var i=e[n];if(t&&i&&i.queryTerrainAtPoint&&i.getTerrainLayer&&i.getTerrainLayer()){var r=i.queryTerrainAtPoint(t);if(r)return{coordinate:r,altitude:r.z};break}}return null},_query3DTilesInfo:function(t){for(var e=this._getLayers()||[],n=0;n<e.length;n++){var i=e[n];if(t&&i&&i.query3DTilesAtPoint){var r=i.query3DTilesAtPoint(t);if(r)return{coordinate:r,altitude:r.z};break}}return null},queryPrjCoordAtContainerPoint:function(t){var e=this._query3DTilesInfo(t);if(e||(e=this._queryTerrainInfo(t)),e){var n=this.getProjection().project(e.coordinate);return n.z=e.altitude,n}return this._isContainerPointOutOfMap(t)&&(t=new ht(this.width/2,this.height/2)),this._containerPointToPrj(t)},_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*Uu)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach((function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}}))}}),Al.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var e=this._getCurrentView(),n=this._viewHistory.length-1;n>=0;n--)if(Lt(t,this._viewHistory[n]))return this._viewHistoryPointer=n,void this._fireViewChange(e,t);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var i=this.options.viewHistoryCount;i>0&&this._viewHistory.length>i&&this._viewHistory.splice(0,this._viewHistory.length-i),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(e,t)},zoomToPreviousView:function(t={}){if(!this.hasPreviousView())return null;var e=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(e,t),e},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(t={}){if(!this.hasNextView())return null;var e=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(e,t),e},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(t,e){var n=this,i=this.getView();e.animation?this._animateTo(t,{duration:e.duration},(function(e){"finished"===e.state.playState&&n._fireViewChange(i,t)})):(this.setView(t),this._fireViewChange(i,t))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,e){this._fireEvent("viewchange",{old:t,new:e}),this._insertUICollidesQueue()},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),Al.mergeOptions({viewHistory:!0,viewHistoryCount:10});var Qu=new so;Al.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new so,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this},_insertUICollidesQueue:function(){return this._uiCollidesQueue||(this._uiCollidesQueue=[]),this._uiCollidesQueue.push(1),this},uiCollides:function(){if(!this.uiList||0===this.uiList.length||!this._uiCollidesQueue||0===this._uiCollidesQueue.length)return this;var t=Qu;t.clear();for(var e=this.uiList,n=0,i=e.length;n<i;n++){var r=e[n],{collisionBufferSize:o,collision:s}=r.options;if(s){var a=r.getDOM();if(r.isVisible()&&a&&a.getBoundingClientRect){r.bbox||(r.bbox=[0,0,0,0]);var h=a.getBoundingClientRect(),{x:l,y:u}=h,{width:c,height:A}=h;if(0===c||0===A){var f=r.getSize();f&&(c=f.width,A=f.height)}var d=l+c+o,p=u-o,g=u+A+o;r.bbox[0]=l-o,r.bbox[1]=p,r.bbox[2]=d,r.bbox[3]=g,t.collides(r.bbox)?r._collidesEffect(!1):(t.insertBox(r.bbox),r._collidesEffect(!0))}}}return this._uiCollidesQueue=[],this},_addUI:function(t){return this.uiList||(this.uiList=[]),this.uiList.indexOf(t)>-1||(this.uiList.push(t),this.uiList=this.uiList.sort((function(t,e){return e.options.collisionWeight-t.options.collisionWeight}))),this},_removeUI:function(t){if(!this.uiList)return-1;var e=this.uiList.indexOf(t);return e<0||this.uiList.splice(e,1),e}});var Xu,Yu,Ju=new $o(0,0);Al.include({coordinateToPoint:function(t,e,n){var i=this._getResolution(e);return this.coordinateToPointAtRes(t,i,n)},coordinateToPointAtRes:function(){var t=new $o(0,0);return function(e,n,i){var r=this.getProjection().project(e,t);return this._prjToPointAtRes(r,n,i)}}(),pointToCoordinate:function(){var t=new $o(0,0);return function(e,n,i){var r=this._pointToPrj(e,n,t);return this.getProjection().unproject(r,i)}}(),pointAtResToCoordinate:function(){var t=new $o(0,0);return function(e,n,i){var r=this._pointToPrjAtRes(e,n,t);return this.getProjection().unproject(r,i)}}(),coordinateToViewPoint:function(){var t=new $o(0,0);return function(e,n,i){return this._prjToViewPoint(this.getProjection().project(e,t),n,i)}}(),viewPointToCoordinate:function(){var t=new $o(0,0);return function(e,n){return this.getProjection().unproject(this._viewPointToPrj(e,t),n)}}(),coordinateToContainerPoint:function(t,e,n){var i=this._getResolution(e);return this.coordinateToContainerPointAtRes(t,i,n)},coordinateToContainerPointAtRes:function(){var t=new $o(0,0);return function(e,n,i){var r=this.getProjection().project(e,t);return this._prjToContainerPointAtRes(r,n,i)}}(),coordinatesToContainerPoints:function(t,e){var n=this._getResolution(e);return this.coordinatesToContainerPointsAtRes(t,n)},coordinatesToContainerPointsAtRes:function(t,e){for(var n=[],i=this._spatialReference.getTransformation(),r=e/this._getResolution(),o=this.getProjection(),s=new $o(0,0),a=this.isTransforming(),h=this._prjToPoint(this._getPrjCenter(),void 0,Ju),l=0,u=t.length;l<u;l++){var c=o.project(t[l],s),A=i.transform(c,e);A=A._multi(r),this._toContainerPoint(A,a,t[l].z,h),n.push(A)}return n},containerPointToCoordinate:function(){var t=new $o(0,0);return function(e,n){var i=this._containerPointToPrj(e,t);return this.getProjection().unproject(i,n)}}(),containerToExtent:function(){var t=new ht(0,0),e=new ht(0,0);return function(n){var i=new ps(this._containerPointToPoint(n.getMin(t),void 0,t),this._containerPointToPoint(n.getMax(e),void 0,e));return this._pointToExtent(i)}}(),distanceToPixel:function(){var t=new ht(0,0),e=new ht(0,0);return function(n,i,r){var o=this.getProjection();if(!o)return null;var s=this.getScale()/this.getScale(r),a=this.getCenter(),h=o.locate(a,n,i),l=this.coordToContainerPoint(a,void 0,t),u=this.coordToContainerPoint(h,void 0,e);return u._sub(l)._multi(s)._abs(),new Jt(u.x,u.y)}}(),distanceToPoint:function(t,e,n,i){var r=this._getResolution(n);return this.distanceToPointAtRes(t,e,r,i)},distanceToPointAtRes:function(){var t=new ht(0,0),e=new $o(0,0);return function(n,i,r,o,s){var a=this.getProjection();if(!a)return null;var h=o||this.getCenter(),l=a.locate(h,n,i,e),u=this.coordToPointAtRes(h,r,t),c=this.coordToPointAtRes(l,r,s);return c._sub(u)._abs(),c}}(),altitudeToPoint:(Xu=new $o(0,40),Yu=new ht(0,0),function(t=0,e,n){this._altitudeOriginDirty&&(Xu.x=this._originLng,this._altitudeOriginDirty=!1);var i=this.distanceToPointAtRes(t,t,e,n||Xu,Yu);t<0&&i.x>0&&(i.x=-i.x);var r=this.options.heightFactor;return r&&1!==r&&(i.x*=r,i.y*=r),i.x}),pointAtResToAltitude:function(){var t=new $o(0,40);return function(e=0,n,i){return this.pointAtResToDistance(e,0,n,i||t)}}(),pixelToDistance:function(){var t=new $o(0,0),e=new $o(0,0),n=new $o(0,0),i=new $o(0,0);return function(r,o){var s=this.getProjection();if(!s)return null;var a=this.getFullExtent(),h=a.top>a.bottom?-1:1,l=t.set(this.width/2,this.height/2),u=e.set(this.width/2+r,this.height/2+h*o),c=this.containerPointToCoord(l,n),A=this.containerPointToCoord(u,i);return s.measureLength(c,A)}}(),pointToDistance:function(t,e,n){var i=this.getResolution(n);return this.pointAtResToDistance(t,e,i)},pointAtResToDistance:function(){var t=new ht(0,0),e=new $o(0,0),n=new $o(0,0),i=new $o(0,0);return function(r,o,s,a){var h=this.getProjection();if(!h)return null;var l=a?h.project(a,e):this._getPrjCenter(),u=this._prjToPointAtRes(l,s,t);u._add(r,o);var c=this.pointAtResToCoord(u,s,n),A=a||h.unproject(l,i);return h.measureLength(A,c)}}(),locateByPoint:function(){var t=new ht(0,0);return function(e,n,i){var r=this.coordToContainerPoint(e,void 0,t);return this.containerPointToCoord(r._add(n,i))}}(),_get2DExtent:function(t,e){var n;if(void 0!==t&&t!==this._zoomLevel||!this._mapExtent2D||(n=this._mapExtent2D),n)return e?(e.set(n.xmin,n.ymin,n.xmax,n.ymax),e):n.copy();var i=this._getResolution(t);return this._get2DExtentAtRes(i,e)},get2DExtent:function(t,e){return this._get2DExtent(t,e)},_get2DExtentAtRes:function(){var t=new ht(0,0);return function(e,n){var i=this;return e===this._mapGlRes&&this._mapGlExtent2D?this._mapGlExtent2D:this.getContainerExtent().convertTo((function(n){return i._containerPointToPointAtRes(n,e,t)}),n)}}(),get2DExtentAtRes:function(t,e){return this._get2DExtentAtRes(t,e)},pointToExtent:function(t){return this._pointToExtent(t)},_pointToExtent:function(){var t=new $o(0,0),e=new $o(0,0);return function(n){var i=n.getMin(),r=n.getMax(),o=this.getFullExtent(),[s,a]=!o||o.left<=o.right?[i.x,r.x]:[r.x,i.x],[h,l]=!o||o.top>o.bottom?[r.y,i.y]:[i.y,r.y],u=i.set(s,l),c=r.set(a,h);return new fs(this.pointToCoord(u,void 0,t),this.pointToCoord(c,void 0,e),this.getProjection())}}(),getViewPointFrameOffset:function(){var t=new ht(0,0);return function(){if(this.isZooming())return null;var e=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(e)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(e,void 0,t)):null}}(),_viewPointToPrj:function(){var t=new ht(0,0);return function(e,n){return this._containerPointToPrj(this.viewPointToContainerPoint(e,t),n)}}(),viewPointToPrj:function(t,e){return this._viewPointToPrj(t,e)},_prjToContainerPoint:function(t,e,n,i){var r=this._getResolution(e);return this._prjToContainerPointAtRes(t,r,n,i)},prjToContainerPoint:function(t,e,n,i){return this._prjToContainerPoint(t,e,n,i)},_prjToContainerPointAtRes:function(){var t=new ht(0,0);return function(e,n,i,r){return this._pointAtResToContainerPoint(this._prjToPointAtRes(e,n,t),n,r||0,i)}}(),prjToContainerPointAtRes:function(t,e,n,i){return this.prjToContainerPointAtRes(t,e,n,i)},_prjToViewPoint:function(){var t=new ht(0,0);return function(e,n,i){var r=this._prjToContainerPoint(e,void 0,t,i);return this.containerPointToViewPoint(r,n)}}(),prjToViewPoint:function(t,e,n){return this._prjToViewPoint(t,e,n)},_viewPointToPoint:function(){var t=new ht(0,0);return function(e,n,i){return this._containerPointToPoint(this.viewPointToContainerPoint(e,t),n,i)}}(),viewPointToPoint:function(t,e,n){return this._viewPointToPoint(t,e,n)},_pointToViewPoint:function(){var t=new $o(0,0);return function(e,n,i){return this._prjToViewPoint(this._pointToPrj(e,n,t),i)}}(),pointToViewPoint:function(t,e,n){return this._pointToViewPoint(t,e,n)}});var Ku={distancetool:{start:"起点",units:{mile:" 英里",feet:" 英尺",kilometer:" 公里",meter:" 米"}},areatool:{units:{mile:" 平方英里",feet:" 平方英尺",kilometer:" 平方公里",meter:" 平方米"}}},$u={distancetool:{start:"Inicio",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},areatool:{units:{mile:" mi²",feet:" ft²",kilometer:" km²",meter:" m²"}}},tc={distancetool:{start:"Start",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},areatool:{units:{mile:" mi²",feet:" ft²",kilometer:" km²",meter:" m²"}}},ec=function(t){function e(e){var n;return(n=t.call(this,"Translator: "+e)||this).name="TranslatorError",n}return K(e,t),e}(et(Error)),nc=function(t){function e(e){var n;return(n=t.call(this)||this).languages={"zh-CN":Ku,"es-MX":$u,"en-US":tc},n.setLang(e||"zh-CN"),n}K(e,t);var n=e.prototype;return n.setLang=function(t){var e=this.languages[t];if(!e)throw new ec("Setted Lang does not exist");this.nodes=e},n._validateNestedProps=function(t){t.forEach((function(t){if(""===t)throw new ec('Any of sides of a dot "." cannot be empty')}))},n.translate=function(t=null){if(null==t)throw new ec("Missing parameter textNode");if("string"!=typeof t)throw new ec("Param passed has to be a String");if(!t.includes("."))return this.nodes[t];var e=t.split(".");if(e.length>3)throw new ec("Translate function can only access through 3 nested properties, trying to access -> "+e.length);this._validateNestedProps(e);try{var n=null;switch(e.length){case 2:n=this.nodes[e[0]][e[1]];break;case 3:n=this.nodes[e[0]][e[1]][e[2]]}return n}catch(i){throw new ec("Unable to find the text translated in lang json"+i.message)}},e}(Lo),ic=function(t){function e(e){var n;return(n=t.call(this,e)||this).on("enable",n._afterEnable,n).on("disable",n._afterDisable,n),n._measureLayers=[],n.translator=new nc(n.options.language),n}K(e,t);var n=e.prototype;return n.clear=function(){if(wt(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._outLayers(this._measureLayers),this._measureLayers=[],this},n.getMeasureLayers=function(){return this._measureLayers},n.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},n.undo=function(){t.prototype.undo.call(this);var e=this._historyPointer;if(e!==this._vertexes.length)for(var n=e;n<this._vertexes.length;n++)this._vertexes[n].label&&this._vertexes[n].label.remove(),this._vertexes[n].marker.remove();return this},n.redo=function(){t.prototype.redo.call(this);var e=this._historyPointer-1;return this._vertexes[e]&&(this._vertexes[e].marker.getLayer()||(this._vertexes[e].label&&this._vertexes[e].label.addTo(this._measureMarkerLayer),this._vertexes[e].marker.addTo(this._measureMarkerLayer))),this},n._formatLabelContent=function(t){var e=this.options.formatLabelContent;return e&&A(e)?e.call(this,t)+"":null},n._measure=function(t){var e,n=this.getMap();t instanceof Kh?e=n.computeGeometryLength(t):Array.isArray(t)&&(e=n.getProjection().measureLength(t)),this._lastMeasure=e;var i=this._formatLabelContent(e);if(i)return i;var r=[this.translator.translate("distancetool.units.meter"),this.translator.translate("distancetool.units.kilometer"),this.translator.translate("distancetool.units.feet"),this.translator.translate("distancetool.units.mile")],o="",s=this.options.decimalPlaces;return this.options.metric&&(o+=e<1e3?e.toFixed(s)+r[0]:(e/1e3).toFixed(s)+r[1]),this.options.imperial&&(o.length>0&&(o+="\n"),o+=(e*=3.2808399)<5280?e.toFixed(s)+r[2]:(e/5280).toFixed(s)+r[3]),o},n._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},n._afterEnable=function(){this._registerMeasureEvents()},n._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},n._msOnDrawStart=function(t){var e=this.getMap(),n=At(),i="distancetool_"+n,r="distancetool_markers_"+n,o=this.options.zIndex,s=this.options.enableAltitude;e.getLayer(i)?(this._measureLineLayer=e.getLayer(i),this._measureMarkerLayer=e.getLayer(r)):(this._measureLineLayer=new Cu(i,{zIndex:o,enableAltitude:s}).addTo(e),this._measureMarkerLayer=new Cu(r,{zIndex:o,enableAltitude:s}).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer),this._pushLayers([this._measureLineLayer,this._measureMarkerLayer]);var a=this._getFirstCoordinate()||t.coordinate,h=new Bl(a.copy(),{symbol:this.options.vertexSymbol}),l=this.translator.translate("distancetool.start"),u=new du(l,a.copy(),this.options.labelOptions);this._lastVertex=u,this._addVertexMarker(h,u)},n._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var n=ti(this.options.vertexSymbol);n.markerWidth/=2,n.markerHeight/=2,this._tailMarker=new Bl(t.coordinate,{symbol:n}).addTo(this._measureMarkerLayer),this._tailLabel=new du(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var i=this._getLasttCoordinate()||t.coordinate;this._tailMarker.setCoordinates(i.copy()),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(i.copy())},n._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},n._msOnDrawVertex=function(t){var e=this._getLasttCoordinate()||t.coordinate,n=t.geometry,i=new Bl(e.copy(),{symbol:this.options.vertexSymbol}),r=this._measure(n),o=new du(r,e.copy(),this.options.labelOptions);this._addVertexMarker(i,o),this._lastVertex=o},n._addVertexMarker=function(t,e){this._vertexes||(this._vertexes=[]),void 0!==this._historyPointer&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:e,marker:t}),this._measureMarkerLayer.addGeometry(t),e&&this._measureMarkerLayer.addGeometry(e)},n._msOnDrawEnd=function(t){if(this._clearTailMarker(),t.geometry.getCoordinates().length<2)return this._lastMeasure=0,void this._clearMeasureLayers();var e=this._lastVertex.getSize();e||(e=new Jt(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),e.width);var n=t.geometry.copy();n.setCoordinates(t.geometry.getCoordinates()),n.addTo(this._measureLineLayer),this._lastMeasure=n.getLength()},n._addClearMarker=function(t,e,n){var i=this.options.clearButtonSymbol,r={markerDx:(i.markerDx||0)+n,textDx:(i.textDx||0)+n};Array.isArray(i)&&(r=i.map((function(t){return t?{markerDx:(t.markerDx||0)+n,textDx:(t.textDx||0)+n}:null}))),i=ti(i,r);var o=new Bl(t,{symbol:i}),s=this._measureLineLayer,a=this._measureMarkerLayer;o.on("click",(function(){return s.remove(),a.remove(),!1}),this),o.addTo(this._measureMarkerLayer)},n._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},n._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},n._getFirstCoordinate=function(){return this._geometry?(this._geometry.getCoordinates()||[])[0]:null},n._getLasttCoordinate=function(){if(!this._geometry)return null;var t=this._geometry.getCoordinates()||[];return t[t.length-1]},e}(Iu);ic.mergeOptions({formatLabelContent:null,decimalPlaces:2,mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]});var rc=function(t){function e(e){var n;return(n=t.call(this,e)||this).translator=new nc(n.options.language),n._measureLayers=[],n}K(e,t);var n=e.prototype;return n._measure=function(t){var e,n=this.getMap();t instanceof Kh?e=n.computeGeometryArea(t):Array.isArray(t)&&(e=n.getProjection().measureArea(t)),this._lastMeasure=e;var i=this._formatLabelContent(e);if(i)return i;var r=[this.translator.translate("areatool.units.meter"),this.translator.translate("areatool.units.kilometer"),this.translator.translate("areatool.units.feet"),this.translator.translate("areatool.units.mile")],o="",s=this.options.decimalPlaces;if(this.options.metric&&(o+=e<1e6?e.toFixed(s)+r[0]:(e/1e6).toFixed(s)+r[1]),this.options.imperial){e*=Math.pow(3.2808399,2),o.length>0&&(o+="\n");var a=27878400;o+=e<a?e.toFixed(s)+r[2]:(e/a).toFixed(s)+r[3]}return o},n._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},n._msOnDrawVertex=function(t){var e=this._getLasttCoordinate()||t.coordinate,n=new Bl(e.copy(),{symbol:this.options.vertexSymbol});this._measure(t.geometry),this._lastVertex=n,this._addVertexMarker(n)},n._msOnDrawEnd=function(t){var e;this._clearTailMarker();var n=this.getMap();if(t.point2d)e=n._pointToPrj(t.point2d);else{var i=t.geometry._getPrjCoordinates()||[];e=(i=i.slice(0,i.length-1))[i.length-1]}if(t.geometry.getShell().length<3)return this._lastMeasure=0,void this._clearMeasureLayers();var r=this._measure(t.geometry),o=this._getLasttCoordinate(),s=new du(r,o.copy(),this.options.labelOptions).addTo(this._measureMarkerLayer).getSize();s||(s=new Jt(10,10)),this._addClearMarker(o.copy(),e,s.width);var a=t.geometry.copy();a.setCoordinates(t.geometry.getCoordinates()),a.addTo(this._measureLineLayer),this._lastMeasure=a.getArea()},e}(ic);function oc(t,e,n){var i,r,o=Array.isArray(e);if(o||(e=[e]),n&&n.drawTool&&n.drawTool.options&&(r=n.drawTool.options.transformCoordinate),r&&A(r))i=(i=e.map((function(e){return t.unproject(e)}))).map((function(t){return r(t,n)||t}));else{if(!n||!n.target||!n.target._queryTerrainInfo)return i=e.map((function(e){return t.unproject(e)})),o?i:i[0];var s=n.target,a=n.enableAltitude;i=e.map((function(e){if(a){var n=s.prjToContainerPoint(e),i=s._queryTerrainInfo(n);if(i&&i.coordinate)return i.coordinate}return t.unproject(e)}))}return o?i:i[0]}rc.mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5},language:"zh-CN"});var sc={create:function(t,e,n){var i=oc(t,e[0],n);return new eu(i,0)},update:function(t,e,n,i){var r=n.getMap(),o=oc(t,Array.isArray(e)?e[e.length-1]:e,i),s=r.computeLength(n.getCenter(),o);n.setRadius(s)},generate:function(t){return t}};Iu.registerMode("circle",s({clickLimit:2,action:["click","mousemove","click"]},sc)),Iu.registerMode("freeHandCircle",s({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},sc));var ac={create:function(t,e,n){var i=oc(t,e[0],n);return new iu(i,0,0)},update:function(t,e,n,i){var r=n.getMap(),o=n.getCenter(),s=oc(t,Array.isArray(e)?e[e.length-1]:e,i),a=r.computeLength(o,new $o({x:s.x,y:o.y})),h=r.computeLength(o,new $o({x:o.x,y:s.y}));n.setWidth(2*a),n.setHeight(2*h)},generate:function(t){return t}};Iu.registerMode("ellipse",s({clickLimit:2,action:["click","mousemove","click"]},ac)),Iu.registerMode("freeHandEllipse",s({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},ac));var hc={create:function(t,e){var n=new Fl([]);return n._firstClick=e[0],n},update:function(t,e,n,i){var r=n.getMap(),o=i.containerPoint,s=r.prjToContainerPoint(n._firstClick),a=oc(t,[[s.x,s.y],[o.x,s.y],[o.x,o.y],[s.x,o.y]].map((function(t){return r._containerPointToPrj(new ht(t))})),i);n.setCoordinates(a)},generate:function(t){return t}};Iu.registerMode("rectangle",s({clickLimit:2,action:["click","mousemove","click"]},hc)),Iu.registerMode("freeHandRectangle",s({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},hc)),Iu.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(t,e,n){var i=oc(t,e[0],n);return new Bl(i)},generate:function(t){return t},update:function(t,e,n,i){if(Array.isArray(e)&&(e=e[e.length-1]),!e)return n;var r=oc(t,e,i);return n.setCoordinates(r),n}});var lc={create:function(t,e,n){var i=oc(t,e,n),r=new jl(i);return r.setCoordinates(i),r},update:function(t,e,n,i){var r,o=n.getSymbol();Array.isArray(e)?r=e:(r=n._drawPrjs||[]).push(e),n._drawPrjs=r;var s=oc(t,r,i);n.setCoordinates(s);var a=n.getLayer();if(a){var h=a.getGeometryById("polygon");if(!h&&r.length>=3){if(h=new Fl([s],{id:"polygon",zIndex:-1}),o){var l=ti(o,{lineOpacity:0});h.setSymbol(l)}h.addTo(a)}h&&h.setCoordinates([s])}},generate:function(t){var e=new Fl(t.getCoordinates(),{symbol:t.getSymbol(),properties:t.getProperties()});return e._projCode=t._projCode,e}};Iu.registerMode("polygon",s({action:["click","mousemove","dblclick"]},lc)),Iu.registerMode("freeHandPolygon",s({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},lc));var uc={create:function(t,e,n){var i=oc(t,e,n),r=new jl(i);return r.setCoordinates(i),r},update:function(t,e,n,i){var r;Array.isArray(e)?r=e:(r=n._drawPrjs||[]).push(e),n._drawPrjs=r;var o=oc(t,r,i);n.setCoordinates(o)},generate:function(t){return t}};Iu.registerMode("linestring",s({action:["click","mousemove","dblclick"]},uc)),Iu.registerMode("freeHandLinestring",s({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},uc)),Iu.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new au(n);return i._setPrjCoordinates(e),i},update:uc.update,generate:function(t){return t}}),Iu.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new lu(n);return i._setPrjCoordinates(e),i},update:uc.update,generate:function(t){return t}}),Iu.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new hu(n);return i._setPrjCoordinates(e),i},update:uc.update,generate:function(t){return t}}),Iu.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t,e){var n=t.unproject(e=e[0]),i=new Bl(n);return i._firstClick=e,i},update:function(t,e,n,i){var r=n.getMap(),o=r.prjToContainerPoint(n._firstClick),s=i.containerPoint;e=r._containerPointToPrj(new $o(Math.min(o.x,s.x),Math.min(o.y,s.y)));var a=t.unproject(e);n.setCoordinates(a)._setPrjCoordinates(e),n.updateSymbol({markerWidth:Math.abs(o.x-s.x),markerHeight:Math.abs(o.y-s.y)})},generate:function(t){return t}});var cc=function(t){function e(e){var n;return(n=t.call(this,e)||this).proxyOptions(),n}K(e,t);var n=e.prototype;return n._appendCustomClass=function(t){if(!t)return console.warn("dom is null:",t),this;if(this.options.cssName){var e=this.options.cssName;Array.isArray(e)||(e=[e]),e.forEach((function(e){t.classList.add(e)}))}return this},n.onAdd=function(){},n.onRemove=function(){},n.onDomRemove=function(){},n.getEvents=function(){return{}},n.getOwnerEvents=function(){return{}},n.buildOn=function(){return null},n.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},n.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},n._collides=function(){var t=this.getMap();return t?(t._addUI(this),t._insertUICollidesQueue(),this):this},n._collidesEffect=function(t){var e=this.getDOM();if(!e)return this;if(e.style.visibility=t?"visible":"hidden",!e.classList||!e.classList.add)return this;if(!this.options.collisionFadeIn)return this;var n="mtk-ui-fadein",i=e.classList.contains(n);return t&&!i?e.classList.add(n):!t&&i&&e.classList.remove(n),this},n.show=function(t){var e=this,n=this.getMap();if(!n)return this;this.options.visible=!0,(t=t||this._coordinate||this._owner.getCenter())instanceof $o||(t=new $o(t));var i=this.isVisible();this._showBySymbolChange||this.fire("showstart");var r=this._getUIContainer();this._coordinate=t,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var o=this.__uiDOM=this.buildOn();o.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(o);var s=this.options.zIndex;if(!o)return this._showBySymbolChange||this.fire("showend"),this._collides(),this.setZIndex(s),this;this._measureSize(o),this._singleton()&&(o._uiComponent=this,n[this._uiDomKey()]=o),this._setPosition(),o.style[xe]=null,r.appendChild(o);var a=this._getAnimation();if(i&&(a.ok=!1),a.ok&&(a.fade&&(o.style.opacity="0"),a.scale)){if(this.getTransformOrigin){var h=this.getTransformOrigin();o.style[_e]=h}o.style[ve]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(o.style.display=""),this.options.eventsToStop&&Ve(o,this.options.eventsToStop,Ee);var l=a.transition;return a.ok&&l&&(l&&(o.style[xe]=l),a.fade&&(o.style.opacity="1"),a.scale&&(o.style[ve]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this._collides(),clearTimeout(this._autoPanId),this.options.autoPan&&(this._autoPanId=setTimeout((function(){e._autoPan()}),32)),this.setZIndex(s),this},n.hide=function(){var t=this;if(!this.getDOM())return this;this._onDomMouseout&&this._onDomMouseout(),this.options.visible=!1;var e=this._getAnimation(),n=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(n.style[xe]=e.transition,setTimeout((function(){n.style.display="none",t.fire("hide")}),this.options.animationDuration)):(n.style.display="none",this.fire("hide")),e.fade&&(n.style.opacity="0"),e.scale&&(n.style[ve]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this._collides(),this},n.isVisible=function(){if(!this.options.visible)return!1;var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&"none"!==t.style.display},n.remove=function(){if(delete this._mapEventsOn,!this._owner)return this;var t=this.getMap();return t&&t._removeUI(this),this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this._collides(),this},n.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},n.getOwner=function(){return this._owner},n.getDOM=function(){return this.__uiDOM},n.setZIndex=function(t){if(!h(t))return this;var e=this.getDOM();return e?(e.style.zIndex=t+"",t!==this.options.zIndex&&(this.options.zIndex=t),this):this},n._roundPoint=function(t){return this.options.roundPoint&&(t=t._round()),t},n.getPosition=function(){if(!this.getMap())return null;var t=this._roundPoint(this._getViewPoint());if(this.getOffset){var e=this._roundPoint(this.getOffset());e&&t._add(e)}return t},n._getAnimation=function(){for(var t={fade:!1,scale:!1,ok:!1,transition:""},e=this.options.animation?this.options.animation.split(","):[],n=0;n<e.length;n++){var i=$t(e[n]);"fade"===i?t.fade=!0:"scale"===i&&(t.scale=!0)}var r=null;return t.fade&&(r="opacity "+this.options.animationDuration+"ms"),t.scale&&(r=r?r+",":"",r+=ve+" "+this.options.animationDuration+"ms"),t.transition=r,t.ok=null!==r,t},n._getViewPoint=function(){var t=0,e=this._coordinate||{};if(h(e.z)?t=e.z:this._owner&&this._owner.getAltitude&&(h(t=this._owner.getAltitude()||0)||(t=0)),this._owner.getLayer){var n=this._owner.getLayer();n&&n.isVectorLayer&&(h(t=this._owner._getAltitude()||0)||(t=0))}var i=this._meterToPoint(this._coordinate,t);return this.getMap().coordToViewPoint(this._coordinate,void 0,i)._add(this.options.dx,this.options.dy)},n._meterToPoint=function(t,e){return e},n._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(e&&t&&!t.isMoving()){var n=this._getViewPoint()._round(),i=t.width,r=t.height,o=t.getContainer();if(e&&o&&e.getBoundingClientRect){var s=o.getBoundingClientRect(),a=s.left,h=s.top,l=50,u=e.getBoundingClientRect(),c=0,A=0,{left:f,right:d,top:p,bottom:g}=u,{width:m,height:y}=u;if(f-=a,d-=a,p-=h,g-=h,m>0&&y>0)return f<l&&(c=l-f),0===c&&d+l>i&&(c=-(d+l-i)),p<l&&(A=l-p),0===A&&g+l>r&&(A=-(g+l-r)),void((0!==c||0!==A)&&(t.getPitch()>40&&0!==A&&this._coordinate?t.animateTo({center:this._coordinate},{duration:t.options.panAnimationDuration}):t.panBy([Math.ceil(c),Math.ceil(A)])))}var v=t.viewPointToContainerPoint(n),_=this.getOffset(),x=v.add(_),b=t.viewPointToPrj(n),w=parseInt(e.clientWidth+""),C=parseInt(e.clientHeight+""),P=0,M=0;if(x.x<0?P=50-x.x:x.x+w>i&&(P=-(x.x+w-i)-50),x.y-C<0?M=Math.abs(x.y-C)+50:x.y+C>r&&(M=r-(x.y+C)-50),w>=i&&(P=i/2-v.x),0!==M||0!==P){var T=v.add(P,M),S=t._containerPointToPoint(T)._sub(t._prjToPoint(t._getPrjCenter())),I=t._pointToPrj(t._prjToPoint(b).sub(S));t._panAnimation(I)}}},n._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute";var n=t.style.bottom?"bottom":"top";if(t.style.display="",e.appendChild(t),t.getBoundingClientRect){var i=t.getBoundingClientRect();this._size=new Jt(i.width,i.height)}else this._size=new Jt(t.clientWidth,t.clientHeight);return t.style.display="none",t.style.left="0px",t.style[n]="0px",this._size},n._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),n=this._uiDomKey();if(e[n]){t&&We(e[n],t,Ee);var i=e[n]._uiComponent;i&&i!==this&&i.isVisible()&&i.fire("hide"),Pe(e[n]),i&&!this.hideDom&&i._switchMapEvents("off"),delete e[n]}delete this.__uiDOM}else this.__uiDOM&&(t&&We(this.__uiDOM,t,Ee),Pe(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},n._uiDomKey=function(){return"__ui_"+this._getClassName()},n._singleton=function(){return this.options.single},n._getUIContainer=function(){return this.getMap().getPanels().ui},n._getClassName=function(){return"UIComponent"},n._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn="on"===t;var n=this._getDefaultEvents();if(this.getEvents&&s(n,this.getEvents()),n)for(var i in n)n.hasOwnProperty(i)&&e[t](i,n[i],this)}},n._switchEvents=function(t){var e=this._getOwnerEvents();if(this._owner)for(var n in e)e.hasOwnProperty(n)&&this._owner[t](n,e[n],this)},n._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},n._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof Kh&&(t.positionchange=this.onGeometryPositionChange,t.symbolchange=this._updatePosition),this.getOwnerEvents&&s(t,this.getOwnerEvents()),t},n.onGeometryPositionChange=function(t){if(this._owner&&this.isVisible()){this._showBySymbolChange=!0;var e=t.target,n=e.getCenter();if(e._getAltitude){var i=e._getAltitude();h(i)&&(n.z=i)}this.show(n),delete this._showBySymbolChange}},n.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},n.onEvent=function(){this.isVisible()&&this._updatePosition()},n.onZoomEnd=function(){this.isVisible()&&this._setPosition()},n.onResize=function(){this.isVisible()&&this._setPosition()},n.onDomSizeChange=function(){this.isVisible()&&(this._setPosition(),this._collides())},n._updatePosition=function(){return this.getMap()?(this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this)),this):this},n._setPosition=function(){var t=this.getDOM();if(t){t.style[xe]=null;var e=this.getPosition();this._pos=e,t.style[ve]=this._toCSSTranslate(e)+" scale(1)"}},n._toCSSTranslate=function(t){if(!t)return"";if(Q.any3d){var e=this.getMap(),n=e?e.getBearing():0,i=e?e.getPitch():0,r="";return this.options.pitchWithMap&&i&&(r+=" rotateX("+Math.round(i)+"deg)"),this.options.rotateWithMap&&n&&(r+=" rotateZ("+Math.round(-n)+"deg)"),"translate3d("+Math.fround(t.x)+"px,"+Math.fround(t.y)+"px, 0px)"+r}return"translate("+Math.fround(t.x)+"px,"+Math.fround(t.y)+"px)"},n._observerDomSize=function(t){var e=this;return t&&Q.resizeObserver&&!this._resizeObserver?(this._resizeObserver=new ResizeObserver((function(t){if(t.length){var n=t[0].borderBoxSize;e._domContentRect=n&&n.length?{width:n[0].inlineSize,height:n[0].blockSize}:t[0].contentRect}else delete e._domContentRect;e.onDomSizeChange&&e.onDomSizeChange()})),this._resizeObserver.observe(t),this):this},n.isSupportZoomFilter=function(){return!1},n.onConfig=function(){return this._updatePosition(),this},e.isSupport=function(t){return!!(t&&A(t.on)&&A(t.off)&&A(t.getCenter))},n._bindDomEvents=function(t,e){if(t){var n=this._getDomEvents()||{},i="on"===e?Ve:We;for(var r in n)"on"===e&&We(t,r,n[r]),i(t,r,n[r],this)}},n._getDomEvents=function(){return{mouseover:this._onDomMouseover,mouseout:this._onDomMouseout}},n._configMapPreventWheelScroll=function(t){var e=this.getMap();e&&(this.options.eventsPropagation||(e.options.preventWheelScroll=t))},n._onDomMouseover=function(){this._configMapPreventWheelScroll(!1)},n._onDomMouseout=function(){this._configMapPreventWheelScroll(!0)},e}(Do(Lo));cc.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1,collision:!1,collisionBufferSize:2,collisionWeight:0,collisionFadeIn:!1,zIndex:0});var Ac="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",fc=function(t){function e(e,n){var i;return(i=t.call(this,n)||this)._markerCoord=new $o(e),i}K(e,t);var n=e.prototype;return n._getClassName=function(){return"UIMarker"},n.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition(),this._collides()),this},n.getCoordinates=function(){return this._markerCoord},n.getCenter=function(){return this.getCoordinates()},n.getAltitude=function(){var t=this.getCoordinates()||{};return h(t.z)?t.z:this.options.altitude||0},n.setAltitude=function(t){return h(t)&&this._markerCoord&&(this._markerCoord.z=t,this._updatePosition&&(this._updatePosition(),this._collides())),this},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},n.getContent=function(){return this.options.content},n.onAdd=function(){if(this._owner&&!this._owner.isMap){var t=this._owner;throw new Error("UIMarker Can only be added to the map, but owner is:"+t.getJSONType&&t.getJSONType())}return this.show(),this},n.show=function(){return t.prototype.show.call(this,this._markerCoord)},n.flash=function(t,e,n,i){return Nt.call(this,t,e,n,i)},n.buildOn=function(){var t,e=this.getDOM();this._bindDomEvents(e,"off");var n=this.options.content,i=c(n);return i||A(n)?(t=we("div"),i?t.innerHTML=this.options.content:n.bind(this)(t)):t=this.options.content,this.options.containerClass&&(t.className=this.options.containerClass),this._registerDOMEvents(t),this._bindDomEvents(t,"on"),this._appendCustomClass(t),t},n.getOffset=function(){var t=this.getSize(),e=-t.width/2,n=-t.height/2,{horizontalAlignment:i,verticalAlignment:r}=this.options;return"left"===i?e=-t.width:"right"===i&&(e=0),"top"===r?n=-t.height:"bottom"===r&&(n=0),new ht(e,n)},n.getTransformOrigin=function(){return"center center"},n.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},n.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},n._registerDOMEvents=function(t){Ve(t,Ac,this._onDomEvents,this)},n._onDomEvents=function(t,e){var n=this.getMap()._parseEvent(t,t.type);if("mousedown"===(e=e||t.type)&&(this._mousedownEvent=t),"mouseup"===e&&(this._mouseupEvent=t),("click"!==e||!this._mouseClickPositionIsChange())&&("touchstart"===e&&(this._touchstartTime=o()),this.fire(e,n),"touchend"===e&&Q.touch)){var i=this.getMap().options.clickTimeThreshold||280;o()-this._touchstartTime<i&&this._onDomEvents(t,"click")}},n._removeDOMEvents=function(t){We(t,Ac,this._onDomEvents)},n._mouseClickPositionIsChange=function(){var{x:t,y:e}=this._mousedownEvent||{},{x:n,y:i}=this._mouseupEvent||{};return t!==n||e!==i},n._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),n=this.getSize(),i=n.width,r=n.height;return[t.containerPointToCoordinate(e.add(-i/2,0)),t.containerPointToCoordinate(e.add(i/2,0)),t.containerPointToCoordinate(e.add(0,r/2)),t.containerPointToCoordinate(e.add(0,-r/2))]},n._getViewPoint=function(){var t=0;if(this._owner){var e=this.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},n._getDefaultEvents=function(){return s({},t.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},n._setPosition=function(){this.onZoomFilter(),t.prototype._setPosition.call(this)},n.onZoomFilter=function(){var t=this.getDOM();t&&(this.isVisible()||"none"===t.style.display?this.isVisible()&&"none"===t.style.display&&(t.style.display=""):t.style.display="none")},n.isVisible=function(){var t=this.getMap();if(!t)return!1;if(!this.options.visible)return!1;var e=t.getZoom(),{minZoom:n,maxZoom:i}=this.options;return!(!a(n)&&e<n||!a(i)&&e>i)&&this.getDOM()&&!0},n.isSupportZoomFilter=function(){return!0},e}(Qo(cc));fc.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null,horizontalAlignment:"middle",verticalAlignment:"middle"});var dc=Q.touch?"touchstart mousedown":"mousedown",pc=function(t){function e(e){return t.call(this,e)||this}K(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on(dc,this._startDrag,this)},n.removeHooks=function(){this.target.off(dc,this._startDrag,this)},n._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||2===e.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},n._prepareDragHandler=function(){this._dragHandler=new Ko(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},n._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},n._onMouseDown=function(t){Ee(t.domEvent)},n._dragging=function(t){var e=this.target,n=e.getMap()._parseEvent(t.domEvent),i=n.domEvent;if(!(i.touches&&i.touches.length>1))if(this._isDragging){var r=n.coordinate,o=n.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=o);var s=r.sub(this._lastCoord),a=o.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=o,this.target.setCoordinates(this.target.getCoordinates().add(s)),n.coordOffset=s,n.pointOffset=a,e.fire("dragging",n)}else this._isDragging=!0},n._endDrag=function(t){var e=this.target,n=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,n){var i=n._parseEvent(t.domEvent);e&&e._mouseClickPositionIsChange&&e._mouseClickPositionIsChange()&&e.fire("dragend",i)}},n.isDragging=function(){return!!this._isDragging},e}(ko);fc.addInitHook("addHandler","draggable",pc);var gc=/\{ *([\w_]+) *\}/g,mc={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},yc=new Jt(0,0),vc=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n._getClassName=function(){return"InfoWindow"},n.addTo=function(e){return e instanceof Kh&&(e.getInfoWindow()&&e.getInfoWindow()!==this&&e.removeInfoWindow(),e._infoWindow=this),t.prototype.addTo.call(this,e)},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},n.getContent=function(){return this.options.content},n.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},n.getTitle=function(){return this.options.title},n.buildOn=function(){var t=this,e=A(this.options.content),n=c(this.options.content);if(this.options.custom){var i,r=this.getDOM();if(this._bindDomEvents(r,"off"),n||e){var o=we("div");n?(o.innerHTML=this.options.content,this._replaceTemplate(o)):this.options.content.bind(this)(o),i=o}else this._replaceTemplate(this.options.content),i=this.options.content;return this._bindDomEvents(i,"on"),this._appendCustomClass(i),i}this._bindDomEvents(this.getDOM(),"off");var s=we("div");this.options.containerClass&&(s.className=this.options.containerClass);var a=this._getWindowWidth();s.style.width=h(a)?a+"px":"auto",s.style.bottom="0px";var l='<em class="maptalks-ico"></em>';this.options.title&&(l+="<h2>"+this.options.title+"</h2>"),s.innerHTML=l+='<a href="javascript:void(0);" class="maptalks-close">×</a><div class="maptalks-msgContent"></div>',this._replaceTemplate(s);var u=s.querySelector(".maptalks-msgContent");return n||e?n?u.innerHTML=this.options.content:this.options.content.bind(this)(u):u.appendChild(this.options.content),this._onCloseBtnClick=function(e){t.options.eventsPropagation||(Ie(e),Ee(e)),t.hide()},Me(s.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),e||this._replaceTemplate(u),this._bindDomEvents(s,"on"),this._appendCustomClass(s),s},n._replaceTemplate=function(t){var e=this._owner;if(this.options.enableTemplate&&e&&e.getProperties&&t&&t.innerHTML){var n=e.getProperties()||{};u(n)&&(t.innerHTML=t.innerHTML.replace(gc,(function(t,e){return n[e]})))}return this},n.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},n.getOffset=function(){var t=this.getSize(),e=new ht(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var n=this.getOwner();if(n instanceof Bl||n instanceof ql){var i,r;if(n instanceof Bl)i=n._getPainter(),r=n.getSize();else{var o=n.getGeometries();if(!o||!o.length)return e;i=o[0]._getPainter(),r=o[0].getSize()}if(r||(r=yc),i){var s=i.getFixedExtent();e._add(s.xmax-r.width/2,s.ymin)}else e._add(0,-r.height)}return e},n.show=function(e){return this.getMap()&&this.getMap().options.enableInfoWindow?t.prototype.show.call(this,e):this},n.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},n.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},n.onRemove=function(){this._onDomMouseout(),this.onDomRemove()},n.onDomRemove=function(){this._onCloseBtnClick&&(Te(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},n._onAutoOpen=function(t){var e=this,n=this.getOwner();setTimeout((function(){n instanceof Bl||n instanceof cc?e.show(n.getCoordinates()):n instanceof ql?e.show(n.findClosest(t.coordinate)):n instanceof jl||n instanceof Ql?(e.getMap().getScale()>=8&&(t.coordinate=e._rectifyMouseCoordinte(n,t.coordinate)),e.show(t.coordinate)):e.show(t.coordinate)}),1)},n._rectifyMouseCoordinte=function(t,e){var n=this;return t instanceof jl?this._rectifyLineStringMouseCoordinate(t,e).coordinate:t instanceof Ql?t.getGeometries().map((function(t){return n._rectifyLineStringMouseCoordinate(t,e)})).sort((function(t,e){return t.dis-e.dis}))[0].coordinate:e},n._rectifyLineStringMouseCoordinate=function(t,e){for(var n=this.getMap(),i=t.getCoordinates()||[],r=n.getGLRes(),o=i.map((function(t){var e=n.coordToPointAtRes(t,r);return n._pointAtResToContainerPoint(e,r,t.z||0)})),s=n.coordToContainerPoint(e),a=1/0,h=-1,l=0,u=o.length;l<u;l++){var c=s.distanceTo(o[l]);c<a&&(a=c,h=l)}for(var A=[h-1,h,h+1].filter((function(t){return t>=0&&t<=o.length-1})),f=A.map((function(t){return o[t]})),d=[],{width:p,height:g}=n.getSize(),m=0,y=f.length-1;m<y;m++){var v=m,_=f[m],x=f[m+1];if(_.x===x.x)for(var b=Math.max(0,Math.min(_.y,x.y)),w=Math.min(g,Math.max(_.y,x.y)),C=b;C<=w;C++)d.push({point:new ht(_.x,C),coordinateIndex:v});else for(var P=(x.y-_.y)/(x.x-_.x),M=Math.max(0,Math.min(_.x,x.x)),T=Math.min(p,Math.max(_.x,x.x)),S=M;S<=T;S++)d.push({point:new ht(S,P*(S-_.x)+_.y),coordinateIndex:v})}for(var I,E=1/0,O=-1,R=-1,D=0,k=d.length;D<k;D++){var{point:L,coordinateIndex:F}=d[D],N=s.distanceTo(L);N<E&&(E=N,O=D,R=F,I=L)}if(O<0)return{dis:E,coordinate:e};var z=f[R],B=z.distanceTo(f[R+1]),H=I.distanceTo(z)/B,j=A.map((function(t){return i[t]})),U=j[R],G=j[R+1],V=U.x,W=U.y,q=U.z||0;return{dis:E,coordinate:new $o(V+(G.x-V)*H,W+(G.y-W)*H,q+((G.z||0)-q)*H)}},n._getWindowWidth=function(){var t=this.options.width;return t||(t=mc.width),t},e}(cc);vc.mergeOptions(mc);var _c="remove hide shapechange positionchange dragend animatestart",xc=function(t){function e(e,n={}){var i;return(i=t.call(this,n)||this)._content=e,i}K(e,t);var n=e.prototype;return n._getClassName=function(){return"ToolTip"},n.addTo=function(n){if(e.isSupport(n))return n.on("mousemove",this.onMouseMove,this),n.on("mouseout",this.onMouseOut,this),n.on(_c,this.hideDom,this),t.prototype.addTo.call(this,n);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},n.setStyle=function(t){return this.options.containerClass=t,this},n.getStyle=function(){return this.options.containerClass},n.getContent=function(){return this._content},n.buildOn=function(){var t=we("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var n=e.containerClass||e.cssName;return!n&&e.height&&(t.style.lineHeight=e.height+"px"),A(this._content)?this._content.bind(this)(t):t.innerHTML='<div class="'+n+'">'+this._content+"</div>",this._appendCustomClass(t),t},n.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},n.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var n=this.getMap();if(n){var i=n.locateByPoint(t.coordinate,-5,25);0===this.options.showTimeout?this.show(i):this._timeout=setTimeout((function(){n&&e.show(i)}),this.options.showTimeout)}},n.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mousemove",this.onMouseMove,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(_c,this.hideDom,this))},n.hideDom=function(){this.hide()},n.onEvent=function(){return t.prototype.onEvent.call(this),this.hideDom(),this},n._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},e}(cc);xc.mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var bc=function(t){function e(e){return t.call(this,e)||this}K(e,t);var n=e.prototype;return n._getClassName=function(){return"Menu"},n.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,this._owner=t,cc.prototype.addTo.apply(this,[t])},n.setItems=function(t){return this.options.items=t,this},n.getItems=function(){return this.options.items||[]},n.buildOn=function(){var t;if(this.options.custom)if(c(this.options.items)){var e=we("div");e.innerHTML=this.options.items,this._appendCustomClass(e),t=e}else t=this.options.items;else{t=we("div"),this.options.containerClass&&Ne(t,this.options.containerClass),t.style.width=this._getMenuWidth()+"px";var n=this._createMenuItemDom();t.appendChild(n),Ve(t,"contextmenu",Ie),this._appendCustomClass(t)}return t&&(this._bindDomEvents(t,"off"),this._bindDomEvents(t,"on")),t},n.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),n=this.getSize(),i=0,r=0;return e.x+n.width>t.width&&(i=-n.width),e.y+n.height>t.height&&(r=-n.height),new ht(i,r)},n.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},n.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},n._createMenuItemDom=function(){var t=this,e=this.getMap(),n=we("ul");Ne(n,"maptalks-menu-items");var i,r,o=this.getItems();function s(n){return function(i){var r=e._parseEvent(i,"click");r.target=t,r.owner=t._owner,r.index=n,!1!==this._callback(r)&&(t.hide(),t._owner&&t._owner.fire("closemenu"))}}for(var a=0,h=o.length;a<h;a++){if("-"===(i=o[a])||"_"===i)Ne(r=we("li"),"maptalks-menu-splitter");else{r=we("li");var l=i.item;A(l)&&(l=l({owner:this._owner,index:a})),r.innerHTML=l,r._callback=i.click,Ve(r,"click",s(a))}n.appendChild(r)}var u=this.options.maxHeight||0;return u>0&&Le(n,"max-height: "+u+"px; overflow-y: auto;"),n},n._getMenuWidth=function(){return this.options.width||160},e}(cc);bc.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var wc={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(t){var e=this instanceof Al?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&e&&(this._bindMenu(),this._menu.show(t)),this.fire("openmenu",{coordinate:t}),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new bc(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return this.openMenu(t.coordinate),!1}};Al.include(wc),Kh.include(wc);var Cc=Object.freeze({__proto__:null,InfoWindow:vc,Menu:bc,Menuable:wc,ToolTip:xc,UIComponent:cc,UIMarker:fc}),Pc=function(t){function e(e){return e&&e.position&&!c(e.position)&&(e.position=s({},e.position)),t.call(this,e)||this}K(e,t);var n=e.prototype;return n._appendCustomClass=function(t){if(!t)return console.warn("dom is null:",t),this;if(this.options.cssName){var e=this.options.cssName;Array.isArray(e)||(e=[e]),e.forEach((function(e){t.classList.add(e)}))}return this},n.onAdd=function(){},n.onRemove=function(){},n.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t.getPanels().control;return this.__ctrlContainer=we("div"),Le(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},n.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},n.getMap=function(){return this._map},n.getPosition=function(){return s({},this._parse(this.options.position))},n.setPosition=function(t){return this.options.position=c(t)?t:s({},t),this._updatePosition(),this},n.getContainerPoint=function(){var t,e,n=this.getPosition(),i=this.getMap().getSize();return a(n.left)?a(n.right)||(t=i.width-parseInt(n.right+"")):t=parseInt(n.left+""),a(n.top)?a(n.bottom)||(e=i.height-parseInt(n.bottom+"")):e=parseInt(n.top+""),new ht(t,e)},n.getContainer=function(){return this.__ctrlContainer},n.getDOM=function(){return this._controlDom},n.show=function(){return this.__ctrlContainer.style.display="",this},n.hide=function(){return this.__ctrlContainer.style.display="none",this},n.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},n.remove=function(){return this._map?(Pe(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},n._parse=function(t){var n=t;return c(t)&&(n=e.positions[n]),n},n._updatePosition=function(){var t=this.getPosition();for(var e in t||(t={top:20,left:20}),t)if(t.hasOwnProperty(e)){var n=t[e]||0;h(n)&&(n+="px"),this.__ctrlContainer.style[e]=n}this.fire("positionchange",{position:s({},t)})},e}(Do(Lo));Pc.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},Al.mergeOptions({control:!0}),Al.include({addControl:function(t){return this._containerDOM.getContext||t.addTo(this),this},removeControl:function(t){return t&&t.getMap()===this?(t.remove(),this):this}});var Mc="addlayer removelayer setbaselayer baselayerremove",Tc=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(){return this._attributionContainer=we("div"),this._attributionContainer.className="maptalks-attribution",this._appendCustomClass(this._attributionContainer),this._update(),this._attributionContainer},n.getContent=function(){return this.options.content},n.setContent=function(t){return this.options.content=t,this._update(),this},n.onAdd=function(){this.getMap().on(Mc,this._update,this)},n.onRemove=function(){this.getMap().off(Mc,this._update,this)},n._updateContent=function(){var t=this._attributionContainer,e=this.options.content||"";return t&&(t.innerHTML="",c(e)?t.innerHTML=e:e instanceof HTMLElement&&t.appendChild(t)),this},n._update=function(){if(this.options.custom)this._updateContent();else{var t=this.getMap();if(t){var e=t._getLayers((function(t){return!!t.options.attribution})).reverse().map((function(t){return t.options.attribution})),n=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+n+"</span>"}}},e}(Pc);Tc.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>',custom:!1}),Al.mergeOptions({attribution:!0}),Al.addOnLoadHook((function(){var t=this.options.attribution||this.options.attributionControl;t&&(this.attributionControl=new Tc(t),this.addControl(this.attributionControl))}));var Sc=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(t){var e=this._getCompass();return this._appendCustomClass(e),this._compass=e,this._registerDomEvents(),t.on("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),e},n.onAdd=function(){this._rotateCompass()},n._getCompass=function(){return we("div","maptalks-compass")},n._registerDomEvents=function(){Ve(this._compass,"click",this._resetView,this)},n._rotateCompass=function(){var t=this.getMap().getBearing().toFixed(1),e=parseFloat(t);e<=180&&(e*=-1),e!==this._bearing&&(this._bearing=e,Le(this._compass,"transform: rotate("+this._bearing+"deg);"))},n.onRemove=function(){this.getMap().off("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),delete this._compass,delete this._bearing},n._resetView=function(){this.getMap().animateTo({bearing:0})},e}(Pc);Sc.mergeOptions({position:{top:120,left:20}}),Al.mergeOptions({compassControl:!1}),Al.addOnLoadHook((function(){this.options.compassControl&&(this.compassControl=new Sc(this.options.compassControl),this.addControl(this.compassControl))}));var Ic=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(){var t=this.container=we("div",this.options.containerClass),e=this.panel=we("div","panel"),n=this.button=we("button");return t.appendChild(n),t.appendChild(e),this._appendCustomClass(t),t},n.onAdd=function(){Ve(this.button,"mouseover",this._show,this),Ve(this.panel,"mouseleave",this._hide,this)},n.onRemove=function(){this.panel&&(We(this.button,"mouseover",this._show),We(this.panel,"mouseleave",this._hide),Pe(this.panel),Pe(this.button),delete this.panel,delete this.button,delete this.container)},n._show=function(){Fe(this.container,"shown")||(Ne(this.container,"shown"),this._createPanel())},n._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||ze(this.container,this.options.containerClass)},n._createPanel=function(){this.panel.innerHTML="";var t=we("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},n._renderLayers=function(t,e){var n=this,i=t.getBaseLayer(),r=t.getLayers(),o=r.length;if(i){var s=i.layers||[i],a=we("li","group"),h=we("ul"),l=we("label");l.innerHTML=this.options.baseTitle,a.appendChild(l);for(var u=0,c=s.length;u<c;u++)this._isExcluded(s[u])&&(h.appendChild(this._renderLayer(s[u],!0)),a.appendChild(h),e.appendChild(a))}if(o){var A=we("li","group"),f=we("ul"),d=we("label"),p=we("input");p.type="checkbox",p.checked=!0,d.innerHTML=this.options.overlayTitle,A.appendChild(p),A.appendChild(d);for(var g=function(t){var e=t.target.checked,n=t.target.parentNode;if(n){var i=n.getElementsByTagName("ul")[0];if(i){var r=function(t){var n=t._layer;n&&n[e?"show":"hide"]()},o=function(t){var n=t._layer,i=t.childNodes[0];i&&(i.checked=e),n&&n[e?"show":"hide"]()};r(n),i.childNodes.forEach((function(t){o(t);var e=t.getElementsByTagName("ul")[0];e&&(r(t),e.childNodes.forEach((function(t){o(t)})))}))}}},m=function(){var t=r[y];if(n._isExcluded(t)){if(t.getLayers){var e=we("li","group"),i=we("ul"),o=we("label"),s=we("input");o.innerHTML=t.getId(),s.type="checkbox",s.checked=t.isVisible(),s.onchange=g,e.appendChild(s),e.appendChild(o),e.appendChild(i),e._layer=t,f.appendChild(e),(t.getLayers()||[]).forEach((function(t){i.appendChild(n._renderLayer(t,!1,s.checked))}))}else f.appendChild(n._renderLayer(t));t&&!t.isVisible()&&(p.checked=!1)}},y=0;y<o;y++)m();A.appendChild(f),e.appendChild(A),p.onchange=g}},n._isExcluded=function(t){var e=t.getId(),n=this.options.excludeLayers;return!(n.length&&n.indexOf(e)>=0)},n._renderLayer=function(t,e,n=!0){var i=this,r=we("li","layer"),o=we("label"),s=we("input"),a=this.getMap(),h=t.options.visible;t.options.visible=!0;var l=t.isVisible();t.options.visible=h,r.className="layer";var u=s;return e?(u.type="radio",u.name="base"):u.type="checkbox",u.checked=h&&l,n||(u.checked=!1),l||u.setAttribute("disabled","disabled"),u.onchange=function(e){if("radio"===e.target.type){var n=a.getBaseLayer(),r=n.layers;if(r)for(var o=0,s=r.length;o<s;o++){var h=r[o];h[h===t?"show":"hide"]()}else n.isVisible()||n.show();a._fireEvent("setbaselayer")}else t[e.target.checked?"show":"hide"]();i.fire("layerchange",{target:t})},r.appendChild(s),o.innerHTML=t.getId(),r.appendChild(o),r._layer=t,r},e}(Pc);Ic.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),Al.mergeOptions({layerSwitcherControl:!1}),Al.addOnLoadHook((function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new Ic(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))}));var Ec=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=we("div");this._appendCustomClass(e);var n=this.mapContainer=we("div");n.style.width=t[0]+"px",n.style.height=t[1]+"px",n.className=this.options.containerClass;var i=this.button=we("div");return i.className=this.options.buttonClass,e.appendChild(n),e.appendChild(i),e},n.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),Ve(this.button,"click",this._onButtonClick,this),this._updateButtonText()},n.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),We(this.button,"click",this._onButtonClick)},n.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},n.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width="0px",t.style.height="0px",this},n.getOverviewMap=function(){return this._overview},n._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},n._updateButtonText=function(){this.button.innerHTML=this._overview?"-":"+"},n._createOverview=function(){var t=this.getMap(),e=this.mapContainer,n=t.config();s(n,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new Al(e,n),this._updateBaseLayer(),this._perspective=new Fl(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new Cu("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},n._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),n=t.getMinZoom(),i=this.options.level;if(i>0){for(var r=i;r>0;r--)if(e-r>=n)return e-r}else for(var o=i;o<0;o++)if(e-o>=n)return e-o;return e},n._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},n._getPerspectiveCoords=function(){var t=this.getMap(),e=t.getProjection();return t.getContainerExtent().toArray().map((function(n){if(e){var i=t._containerPointToPrj(n);return t._fixPrjOnWorldWide(i),e.unproject(i)}return t.containerPointToCoordinate(n)}))},n._update=function(){if(this._overview){De(this._overview.getContainer());var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},n._updateSpatialReference=function(){if(this._overview){var t=this.getMap();this._overview.setSpatialReference(t.options.spatialReference)}},n._updateBaseLayer=function(){if(this._overview){var t=this.getMap().getBaseLayer();if(t){var e=t.layers,n=0;if(e)for(var i=0,r=e.length;i<r;i++)if(e[i].isVisible()){n=i;break}var o=t.toJSON(),s=null;e?(s=o.layers[n].options).visible=!0:s=o.options,this._overview.setMinZoom(s.minZoom||null).setMaxZoom(s.maxZoom||null),delete s.minZoom,delete s.maxZoom,delete o.options.canvas,o.options.visible=!0,o.options.renderer="canvas";var a=sl.fromJSON(o);for(var h in t)A(t[h])&&t.hasOwnProperty(h)&&t[h]!==t.constructor.prototype[h]&&(a[h]=t[h]);this._overview.setBaseLayer(a)}else this._overview.setBaseLayer(null)}},e}(Pc);Ec.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),Al.mergeOptions({overviewControl:!1}),Al.addOnLoadHook((function(){this.options.overviewControl&&(this.overviewControl=new Ec(this.options.overviewControl),this.addControl(this.overviewControl))}));var Oc=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(){var t,e=this;if(this.options.custom)c(this.options.content)?((t=we("div")).innerHTML=this.options.content,this._appendCustomClass(t)):t=this.options.content;else{if(t=we("div","maptalks-panel"),this._appendCustomClass(t),this.options.closeButton){var n=we("a","maptalks-close");n.innerText="×",n.href="javascript:;",n.onclick=function(){t.style.display="none",e.fire("close")},t.appendChild(n)}var i=we("div","maptalks-panel-content");c(this.options.content)?i.innerHTML=this.options.content:i.appendChild(this.options.content),t.appendChild(i)}return this.draggable=new Ko(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},n.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),Pc.prototype.update.call(this)},n.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},n.getContent=function(){return this.options.content},n._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},n._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=s({},this.getPosition()),this.fire("dragstart",t)},n._onDragging=function(t){var e=t.mousePos.sub(this._startPos),n=this._startPosition,i=this.getPosition();a(i.top)||(i.top=parseInt(n.top)+e.y),a(i.bottom)||(i.bottom=parseInt(n.bottom)-e.y),a(i.left)||(i.left=parseInt(n.left)+e.x),a(i.right)||(i.right=parseInt(n.right)-e.x),this.setPosition(i),this.fire("dragging",t)},n._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},n._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),n=this.getDOM(),i=parseInt(n.clientWidth+""),r=parseInt(n.clientHeight+"");return[t.containerPointToCoordinate(e.add(i/2,0)),t.containerPointToCoordinate(e.add(i,r/2)),t.containerPointToCoordinate(e.add(i/2,r)),t.containerPointToCoordinate(e.add(0,r/2))]},e}(Pc);Oc.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var Rc=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(){var t=this._getReset();return this._appendCustomClass(t),this._reset=t,this._registerDomEvents(),t},n.onAdd=function(){this._view=this.options.view?this.options.view:this.getMap().getView()},n.setView=function(t){this._view=t},n._getReset=function(){return we("div","maptalks-reset")},n._registerDomEvents=function(){Ve(this._reset,"click",this._resetView,this)},n.onRemove=function(){delete this._reset,delete this._view},n._resetView=function(){this.getMap().setView(this._view)},e}(Pc);Rc.mergeOptions({position:{top:156,left:20},view:null}),Al.mergeOptions({resetControl:!1}),Al.addOnLoadHook((function(){this.options.resetControl&&(this.resetControl=new Rc(this.options.resetControl),this.addControl(this.resetControl))}));var Dc="zoomend moving moveend",kc=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(t){return this._map=t,this._scaleContainer=we("div",this.options.containerClass),this._addScales(),t.on(Dc,this._update,this),this._map.isLoaded()&&this._update(),this._appendCustomClass(this._scaleContainer),this._scaleContainer},n.onRemove=function(){this.getMap().off(Dc,this._update,this)},n._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=Ce("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=Ce("div",this.options.containerClass?null:t,this._scaleContainer))},n._update=function(){var t=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(t)},n._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},n._updateMetric=function(t){var e=this._getRoundNum(t);this._updateScale(this._mScale,e<1e3?e+" m":e/1e3+" km",e/t)},n._updateImperial=function(t){var e,n,i,r=3.2808399*t;r>5280?(n=this._getRoundNum(e=r/5280),this._updateScale(this._iScale,n+" mile",n/e)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" feet",i/r))},n._updateScale=function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},n._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)},e}(Pc);kc.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),Al.mergeOptions({scaleControl:!1}),Al.addOnLoadHook((function(){this.options.scaleControl&&(this.scaleControl=new kc(this.options.scaleControl),this.addControl(this.scaleControl))}));var Lc=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(t){this._map=t;var e=we("div"),n=we("ul","maptalks-toolbar-hx");e.appendChild(n),Ne(e,this.options.vertical?"maptalks-toolbar-vertical":"maptalks-toolbar-horizonal");var i=this;function r(t,e,n,r){var o=i._getItems()[e];return function(i){return Ee(i),t({target:o,index:e,childIndex:n,dom:r})}}var o=this.options.items;if(wt(o))for(var s=0,a=o.length;s<a;s++){var h=o[s],l=we("li");if(28!==this.options.height&&(l.style.lineHeight=this.options.height+"px"),l.style.height=this.options.height+"px",l.style.cursor="pointer",je(h.item)){l.style.textAlign="center";var u=Ue("div",h.item);l.innerHTML='<div style="margin-top:'+(this.options.height-u.height)/2+'px;">'+h.item+"</div>"}else l.innerHTML=h.item;if(h.click&&Ve(l,"click",r(h.click,s,null,l)),wt(h.children)){var c=this._createDropMenu(s);l.appendChild(c),l._menu=c,Ve(l,"mouseover",(function(){this._menu.style.display=""})),Ve(l,"mouseout",(function(){this._menu.style.display="none"}))}n.appendChild(l)}return this._appendCustomClass(e),e},n._createDropMenu=function(t){var e=this;function n(t,n,i){var r=e._getItems()[n].children[i];return function(e){return Ee(e),t({target:r,index:n,childIndex:i})}}var i=we("div","maptalks-dropMenu"),r=this._getItems(),o=r.length,s=we("ul"),a=r[t].children;t===o-1&&a&&(i.style.cssText="right: 0px;",s.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(s.style.bottom="0")),i.appendChild(we("em","maptalks-ico"));for(var h=0,l=0,u=a.length;l<u;l++){var c=se(a[l].item,"12px");c.width>h&&(h=c.width)}for(var A=0,f=a.length;A<f;A++){var d=a[A],p=we("li");p.innerHTML='<a href="javascript:;">'+d.item+"</a>",p.style.cursor="pointer",p.style.width=h+24+"px",Ve(p.childNodes[0],"click",n(d.click,t,A)),s.appendChild(p)}if(this.options.vertical){var g=h<95?95:h;this.options.reverseMenu?i.style.right=-(g+20+2)+"px":i.style.left=-(g+20+2)+"px"}else this.options.reverseMenu?i.style.bottom="28px":i.style.top="29px";return i.appendChild(s),i.style.display="none",i},n._getItems=function(){return this.options.items||[]},e}(Pc);Lc.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:[]});var Fc=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.buildOn=function(t){var e=this.options,n=we("div","maptalks-zoom");if(this._appendCustomClass(n),e.zoomLevel){var i=we("span","maptalks-zoom-zoomlevel"),r=we("span","maptalks-zoom-zoomlevel-text");i.appendChild(r),n.appendChild(i),this._levelDOM=r}var o=we("div","maptalks-zoom-slider"),s=we("a","maptalks-zoom-zoomin");s.href="javascript:;",o.appendChild(s),this._zoomInButton=s;var a=we("a","maptalks-zoom-zoomout");return a.href="javascript:;",o.appendChild(a),this._zoomOutButton=a,n.appendChild(o),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),n},n.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this)},n._update=function(){this._updateText()},n._updateText=function(){if(this._levelDOM){var t=this.getMap().getZoom();l(t)||(t=Math.floor(10*t)/10),this._levelDOM.innerHTML=t+""}},n._registerDomEvents=function(){this._zoomInButton&&Ve(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&Ve(this._zoomOutButton,"click",this._onZoomOutClick,this)},n._onZoomInClick=function(t){Ie(t),this.getMap().zoomIn()},n._onZoomOutClick=function(t){Ie(t),this.getMap().zoomOut()},e}(Pc);Fc.mergeOptions({position:"top-left",zoomLevel:!0,seamless:!1}),Al.mergeOptions({zoomControl:!1}),Al.addOnLoadHook((function(){this.options.zoomControl&&(this.zoomControl=new Fc(this.options.zoomControl),this.addControl(this.zoomControl))}));var Nc=Object.freeze({__proto__:null,Attribution:Tc,Compass:Sc,Control:Pc,LayerSwitcher:Ic,Overview:Ec,Panel:Oc,Reset:Rc,Scale:kc,Toolbar:Lc,Zoom:Fc}),zc=function(){function t(t,e,n,i){Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:e},this.origin={x:n,y:i})}return t.getDefault=function(t){var e=t.code.toLowerCase();return"baidu"===e?"baidu":e==="EPSG:4326".toLowerCase()||e==="EPSG:4490".toLowerCase()?"tms-global-geodetic":"identity"===e?[1,-1,0,0]:"web-mercator"},t}(),Bc=6378137*Math.PI;s(zc,{"web-mercator":new zc([1,-1,-Bc,Bc]),"tms-global-mercator":new zc([1,1,-Bc,-Bc]),"tms-global-geodetic":new zc([1,1,-180,-90]),baidu:new zc([1,1,0,0])});for(var Hc=function(){function t(t,e,n,i){this.map=t,this.tileSize=i,this.fullExtent=n,this.prepareTileInfo(e,n),this._xScale=n.right>=n.left?1:-1,this._yScale=n.top>=n.bottom?1:-1;var r=t.getGLRes();this._pointOrigin=t._prjToPointAtRes(new ht(this.tileSystem.origin),r),this._glRes=r}var e=t.prototype;return e.prepareTileInfo=function(t,e){if(c(t)?t=zc[t.toLowerCase()]:Array.isArray(t)&&(t=new zc(t)),!t)throw new Error("Invalid TileSystem");this.tileSystem=t,this.transformation=new gs([e.right>e.left?1:-1,e.top>e.bottom?-1:1,t.origin.x,t.origin.y])},e._getTileNum=function(t,e){var n=this.tileSystem,i=this.tileSize,r=Math.floor(1e-7*n.scale.x+t.x/(i.width*e)),o=Math.ceil(1e-7*n.scale.y+t.y/(i.height*e));return{x:n.scale.x*r,y:n.scale.y*o}},e.getTileIndex=function(t,e,n){var i=this.tileSystem,r=this.transformation.transform(t,1),o=this._getTileNum(r,e);return i.scale.x<0&&(o.x-=1),i.scale.y>0&&(o.y-=1),this.getNeighorTileIndex(o.x,o.y,0,0,e,n)},e.getNeighorTileIndex=function(t,e,n,i,r,o){var s=this.tileSystem,a=t+s.scale.x*n,h=e-s.scale.y*i,l=!1,u=a,c=h,A=this._getTileFullIndex(r);return o&&(!0!==o&&"x"!==o||(A.xmax===A.xmin?a=A.xmin:a<A.xmin?(a=A.xmax-(A.xmin-a)%(A.xmax-A.xmin))===A.xmax&&(a=A.xmin):a>=A.xmax&&(a=A.xmin+(a-A.xmin)%(A.xmax-A.xmin))),!0!==o&&"y"!==o||(A.ymax===A.ymin?h=A.ymin:h>=A.ymax?h=A.ymin+(h-A.ymin)%(A.ymax-A.ymin):h<A.ymin&&(h=A.ymax-(A.ymin-h)%(A.ymax-A.ymin))===A.ymax&&(h=A.ymin))),(a<A.xmin||a>A.xmax||h>A.ymax||h<A.ymin)&&(l=!0),{x:a,y:h,idx:u,idy:c,out:l}},e._getTileFullIndex=function(t){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[t])return this._tileFullIndex[t];var e=this.fullExtent,n=this.transformation,i=this._getTileNum(n.transform(new $o(e.left,e.top),1),t),r=this._getTileNum(n.transform(new $o(e.right,e.bottom),1),t),o=this.tileSystem;return o.scale.x<0&&(i.x-=1,r.x-=1),o.scale.y>0&&(i.y-=1,r.y-=1),this._tileFullIndex[t]=new fs(i,r,null),this._tileFullIndex[t]},e.getTilePrjNW=function(t,e,n,i){var r=this.tileSystem,o=this.tileSize,s=r.origin.y+this._yScale*r.scale.y*(e+(1===r.scale.y?1:0))*n*o.height,a=r.origin.x+this._xScale*r.scale.x*(t+(1===r.scale.x?0:1))*n*o.width;return i?(i.set(a,s),i):new $o(a,s)},e.getTilePointNW=function(t,e,n,i){var r=this._glRes/n,o=this.tileSystem,s=this.tileSize,a=this._pointOrigin.y*r+this._yScale*o.scale.y*(e+(1===o.scale.y?1:0))*s.height,h=this._pointOrigin.x*r+this._xScale*o.scale.x*(t+(1===o.scale.x?0:1))*s.width;return i?(i.set(h,a),i):new ht(h,a)},e.getTilePrjSE=function(t,e,n,i){var r=this.tileSystem,o=this.tileSize,s=r.origin.y+this._yScale*r.scale.y*(e+(1===r.scale.y?0:1))*n*o.height,a=r.origin.x+this._xScale*r.scale.x*(t+(1===r.scale.x?1:0))*n*o.width;return i?(i.set(a,s),i):new $o(a,s)},e.getTilePointSE=function(t,e,n,i){var r=this._glRes/n,o=this.tileSystem,s=this.tileSize,a=this._pointOrigin.y*r+this._yScale*o.scale.y*(e+(1===o.scale.y?0:1))*s.height,h=this._pointOrigin.x*r+this._xScale*o.scale.x*(t+(1===o.scale.x?1:0))*s.width;return i?(i.set(h,a),i):new ht(h,a)},e.getTilePrjExtent=function(t,e,n){var i=this.getTilePrjNW(t,e,n),r=this.getTilePrjSE(t,e,n);return new fs(i,r)},t}(),jc=[],Uc=0;Uc<6;Uc++)jc[Uc]=[];var Gc=[];function Vc(t,e,n){var i,r,o,s,a,h,l,u,c,A,f,d,p,g,m,y,v;r=(i=t)[0],o=i[1],s=i[2],a=i[3],h=i[4],l=i[5],u=i[6],c=i[7],A=i[8],f=i[9],d=i[10],p=i[11],g=i[12],m=i[13],y=i[14],v=i[15],qc(jc[0],a-r,c-h,p-A,v-g),qc(jc[1],a+r,c+h,p+A,v+g),qc(jc[2],a+o,c+l,p+f,v+m),qc(jc[3],a-o,c-l,p-f,v-m),qc(jc[4],a-s,c-u,p-d,v-y),qc(jc[5],a+s,c+u,p+d,v+y);for(var _=0;_<6;_++){var x=jc[_];if(Gc[0]=x[0]>0?e[1][0]:e[0][0],Gc[1]=x[1]>0?e[1][1]:e[0][1],Gc[2]=x[2]>0?e[1][2]:e[0][2],Zc(x,Gc)<0)return!1}return!0}var Wc=1/6;function qc(t,e,n,i,r){return t[0]=e*Wc,t[1]=n*Wc,t[2]=i*Wc,t[3]=r*Wc,t}function Zc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}var Qc=new ht(0,0),Xc="undefined"!=typeof Set,Yc=function(){function t(){this._table=Xc?new Set:{}}var e=t.prototype;return e.add=function(t){Xc?this._table.add(t):this._table[t]=!0},e.has=function(t){return Xc?this._table.has(t):this._table[t]},e.reset=function(){Xc?this._table.clear():this._table={}},t}(),Jc={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,loadingLimitOnInteracting:3,loadingLimit:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!n,fadeDuration:1e3/60*10,debug:!1,spatialReference:null,maxCacheSize:256,renderer:Q.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,tileStackStartDepth:7,tileStackDepth:6,awareOfTerrain:!0,bufferPixel:.5,mipmapTexture:!0,depthMask:!0,currentTilesFirst:!0,forceRenderOnMoving:!0,tileErrorScale:1},Kc=/\{ *([\w_]+) *\}/g,$c=new ht(0,0),tA=new ht(0,0),eA=new ht(0,0),nA=new ht(0,0),iA=new ht(0,0),rA=new ht(0,0),oA=[[0,0,0],[0,0,0]],sA=[0,0,0],aA=[0,0,0],hA=[0,0,0],lA=function(t){function e(e,n){return t.call(this,e,n)||this}K(e,t),e.fromJSON=function(t){return t&&"TileLayer"===t.type?new e(t.id,t.options):null};var n=e.prototype;return n.forceReload=function(){return this.fire("forcereloadstart"),this.clear(),this._renderer&&this._renderer.setToRedraw(),this.fire("forcereloadend"),this},n.getTileSize=function(t){if(this._tileSize)return this._tileSize;var e=this.options.tileSize;return h(e)&&(e=[e,e]),this._tileSize=new Jt(e),this._tileSize},n.getTiles=function(t,e){var n,i=this;if(this._coordCache={},n=this._isPyramidMode()?this._getPyramidTiles(t,e):this._getCascadeTiles(t,e),!this._maskGeoJSON)return n;var r=0;return(n.tileGrids||[]).forEach((function(t){t.tiles=(t.tiles||[]).filter((function(t){return i._tileInMask(t)})),r+=t.tiles.length;var e=t.tiles.map((function(t){return t.parent}));t.parents=t.parents.filter((function(t){return e.indexOf(t.id)>-1}))})),n.count=r,n},n._isPyramidMode=function(){var t=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&t&&t.isPyramid()},n._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var t=this.getSpatialReference(),e=t.getFullExtent(),n=t.getResolution(0),i=this.getMap();return this._tileFullExtent=e.convertTo((function(t){return i._prjToPointAtRes(t,n,Qc)})),this._tileFullExtent},n._getRootNodes=function(t){var e=this.getMap();if(this._rootNodes){var{tiles:n,mapWidth:i,mapHeight:r}=this._rootNodes;if(e.width!==i||e.height!==r){for(var o=this._getRootError(),s=0;s<n.length;s++)n[s].error=o;this._rootNodes.mapWidth=e.width,this._rootNodes.mapHeight=e.height}for(var a=0;a<n.length;a++)n[a].offset[0]=t[0],n[a].offset[1]=t[1];return this._rootNodes}var h=this.getSpatialReference(),l=h.getResolution(0),u=this._getTileConfig(),c=h.getFullExtent(),{origin:A,scale:f}=u.tileSystem,d=u.getTilePrjExtent(0,0,l),p=d.getWidth(),g=d.getHeight(),m=1e-5,y=Math.abs((A.x-c.left)/p);y=Math.ceil(y-m);var v=Math.abs((c.right-A.x)/p);v=Math.ceil(v-m);var _=Math.ceil(Math.abs(c.top-A.y)/g);_=Math.ceil(_-m);var x=Math.ceil(Math.abs(c.bottom-A.y)/g);if((v+y)*((x=Math.ceil(x-m))+_)>32)return{status:0,error:"Too many root nodes"};for(var b=this._getRootError(),w=[],C=-y;C<v;C++)for(var P=-_;P<x;P++){var M=f.y<0?P:-(P+1);w.push(this.createTileNode(C,M,0,C,M,l,b))}return this._rootNodes={status:1,tiles:w,mapWidth:e.width,mapHeight:e.height},this._getRootNodes(t)},n.createTileNode=function(t,e,n,i,r,o,s,a,h,l){var u=this.getMap(),c=this.options.zoomOffset;h||(h=this._getTileConfig().getTilePrjExtent(t,e,o).convertTo((function(t){return u._prjToPointAtRes(t,o,Qc)})));var A=this._getTileOffset(n),f=this.getTileUrl(t,e,n+c);return{parent:a,layer:this.getId(),x:t,y:e,z:n,idx:i,idy:r,res:o,extent2d:h,id:l||this._getTileId(t,e,n),url:tn(f),offset:A,error:s,children:[]}},n._getRootError=function(){var t=this.getMap(),e=g(t.getFov()),n=t.width/t.height,i=t.cameraPosition[2],r=i*Math.tan(.5*e),o=r*n,s=Math.sqrt(i*i+r*r+o*o);return t._getFovZ(0)*(s/i)*this.getSpatialReference().getResolution(0)/t.getResolution(0)},n._getPyramidTiles=function(t,e){var n=this.getMap();isNaN(+t)&&(t=this._getTileZoom(n.getZoom()));var i,r=this.getSpatialReference(),o=Math.min(t,this.getMaxZoom(),this.getMaxAvailableZoom()||1/0),s=n.projViewMatrix,a=this._getTileFullExtent(),h=this._getTileOffset(0);if(this.options.repeatWorld){var l=n.getContainerExtent(),u=this._convertToExtent2d(l),c=r.getResolution(0)/n.getResolution();if(u.within(a.copy()._scale(c))){var A=this._getRootNodes(h);if(1!==A.status)return console.warn(A.error),this._disablePyramid=!0,this.getTiles(t,e);i=[...A.tiles]}else{var f=n.getPitch(),d=n.options.cascadePitches[1],p=Math.floor(n._getVisualHeight(d)),g=f<=d?l:new ps(0,n.height-p,n.width,n.height);this._visitedTiles=new Yc;var m=this._getTiles(0-this.options.zoomOffset,g,2,e&&e.getRenderer(),!0),y=this._getRootError()*Math.pow(2,this.options.zoomOffset);m.tiles.forEach((function(t){t.error=y})),i=m.tiles}}else{var v=this._getRootNodes(h);if(1!==v.status)return console.warn(v.error),this._disablePyramid=!0,this.getTiles(t,e);i=[...v.tiles]}for(var _=n.getGLRes(),x={0:h},b=new ps,w=[],C=[];i.length>0;){var P=i.pop();P.z!==o?(x[P.z+1]||(x[P.z+1]=this._getTileOffset(P.z+1)),this._splitNode(P,s,i,w,b,o,x[P.z+1],e&&e.getRenderer(),_),this.isParentTile(t,o,P)&&C.push(P)):(b._combine(P.extent2d),w.push(P))}return C.sort(uA),{tileGrids:[{extent:b,count:w.length,tiles:w,parents:C,offset:[0,0],zoom:t}],count:w.length}},n.isParentTile=function(t,e,n){var i=Math.max(this.getMinZoom(),t-this.options.tileStackStartDepth),r=Math.min(e,i+this.options.tileStackDepth);return n.z>=i&&n.z<r},n._splitNode=function(t,e,n,i,r,o,s,a,h){for(var l=t.z+1,u=this.getSpatialReference(),{idx:c,idy:A}=t,f=a||this.getRenderer(),d=!1,p=[],g=u.getResolution(l)/h,m=0;m<4;m++){var y=m%2,v=m>>1,_=(c<<1)+y,x=(A<<1)+v;t.children||(t.children=[]);var b=t.children[m];b||(b=this._getTileId(_,x,l),t.children[m]=b);var w=f.isTileCachedOrLoading(b),C=w&&w.info;C||(this.tileInfoCache||(this.tileInfoCache=new zr(4*this.options.maxCacheSize)),(C=this.tileInfoCache.get(b))||(C=this._createChildNode(t,y,v,s,b))),C.error=t.error/2,C.offset[0]=s[0],C.offset[1]=s[1];var P=this._isTileVisible(C,e,g,o,s);if(1===P)d=!0;else{if(-1===P)continue;if(0===P&&l!==o)return i.push(t),void r._combine(t.extent2d)}p.push(C)}l===o?d?n.push(...p):(i.push(t),r._combine(t.extent2d)):n.push(...p)},n._createChildNode=function(t,e,n,i,r){var o,{x:s,y:a,idx:h,idy:l,extent2d:u}=t,c=t.z+1,A=(s<<1)+e,f=(a<<1)+n,d=(h<<1)+e,p=(l<<1)+n,g=u.getWidth()/2*2,m=u.getHeight()/2*2,y=2*u.xmin,v=2*u.ymax,_=2*u.ymin,x=this._getTileConfig().tileSystem.scale.y;if(r=r||this._getTileId(d,p,c),x<0){var b=y+e*g,w=v-n*m;o=new ps(b,w-m,b+g,w)}else{var C=y+e*g,P=_+n*m;o=new ps(C,P,C+g,P+m)}var M=this.createTileNode(A,f,c,d,p,t.res/2,t.error/2,t.id,o,r);return this.tileInfoCache.add(r,M),M},n._isTileVisible=function(t,e,n,i,r){if(0===t.z)return 1;if(!this._isTileInFrustum(t,e,n,r))return-1;var o=this.options.maxError;return a(o)&&(o=1),this._getScreenSpaceError(t,n,i,r)>=o?1:0},n._isTileInFrustum=function(t,e,n,i){if(!this._zScale){var r=this.getMap(),o=r.getGLRes();this._zScale=r.altitudeToPoint(100,o)/100}var s=this.getRenderer(),{xmin:a,ymin:h,xmax:l,ymax:u}=t.extent2d;if(t.offset&&!A(this.options.offset)){var[c,f]=t.offset;a+=c,l+=c,h+=f,u+=f}return oA[0][0]=(a-i[0])*n,oA[0][1]=(h-i[1])*n,oA[0][2]=(t.minAltitude||s&&s.avgMinAltitude||0)*this._zScale,oA[1][0]=(l-i[0])*n,oA[1][1]=(u-i[1])*n,oA[1][2]=(t.maxAltitude||s&&s.avgMaxAltitude||0)*this._zScale,Vc(e,oA)},n._getScreenSpaceError=function(t,e,n,i){var r=t.error,o=this.getMap(),{xmin:s,ymin:a,xmax:h,ymax:l}=t.extent2d;sA[0]=(s-i[0])*e,sA[1]=(a-i[1])*e,aA[0]=(h-i[0])*e,aA[1]=(l-i[1])*e;var u,c,A,f,d,p,g=(u=sA,c=aA,A=o.cameraPosition,f=Math.max(u[0]-A[0],0,A[0]-c[0]),d=Math.max(u[1]-A[1],0,A[1]-c[1]),p=Math.max(u[2]-A[2],0,A[2]-c[2]),Math.sqrt(f*f+d*d+p*p)),m=Math.max(Math.abs(g),1e-7),y=Math.abs(t.z-n),v=r*(o.height<1e3||y<=1?1:y<=2?.7:.605)/m*this.options.tileErrorScale;return this.getMap().getPitch()<=60?1.45*v:v},n._getCascadeTiles=function(t,e){var n=this.getMap(),i=n.getPitch(),r=e&&e.getRenderer(),o=n.getContainerExtent(),s=[],h=0,l=this.getMinZoom(),u=n.options.cascadePitches[0],c=n.options.cascadePitches[1],A=Math.floor(n._getVisualHeight(c)),f=a(t)?this._getTileZoom(n.getZoom()):t;if(this._visitedTiles=new Yc,!a(t)||!this.options.cascadeTiles||i<=u||!a(l)&&f<=l){var d=i<=c?o:new ps(0,n.height-A,n.width,n.height),p=this._getTiles(f,d,2,r);return p&&(h+=p.tiles.length,s.push(p)),{tileGrids:s,count:h}}var g=Math.floor(n._getVisualHeight(u)),m=new ps(0,n.height-g,n.width,n.height),y=this._getTiles(f,m,0,r);h+=y?y.tiles.length:0,s.push(y);var v,_,x=m.ymin,b=n.getSpatialReference().getZoomDirection(),w=b;if(i>c){f-w<=l&&(w=0);var C=new ps(0,n.height-A,n.width,x);h+=(v=this._getTiles(f-w,C,1,r))?v.tiles.length:0,x=C.ymin,w+=4*b,s.push(v)}if(f-w>=l){var P=new ps(0,o.ymin,n.width,x);h+=(_=this._getTiles(f-w,P,2,r))?_.tiles.length:0,s.push(_)}return v&&_&&(s[1]=_,s[2]=v),{tileGrids:s,count:h}},n.getTileUrl=function(t,e,n){var i=this.options.urlTemplate,r="";if(this.options.subdomains){var o=this.options.subdomains;if(wt(o)){var a=(t+e)%o.length;a<0&&(a=0),r=o[a]}}if(A(i))return i(t,e,n,r);var h={x:t,y:e,z:n,s:r};return this.options.token&&(h.token=this.options.token),this.options.customTags&&s(h,this.options.customTags),i.replace(Kc,(function(t,e){var n=h[e];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(h)),n}))},n.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},n.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},n.getSpatialReference=function(){var t=this.getMap();if(t&&(!this.options.spatialReference||Qh.equals(this.options.spatialReference,t.options.spatialReference)))return t.getSpatialReference();if(this._sr)return this._sr;var e=this.options.spatialReference;if(c(e)&&!(e=Qh.getPreset(e)))throw new Error("Unsupported spatial reference: "+this.options.spatialReference+", possible values: "+Qh.getAllPresets().join());return this._sr=new Qh(e),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==t.getSpatialReference().toJSON().projection,this._sr},n.getMinZoom=function(){var t=this.options.minZoom||0;return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(t,this._srMinZoom):t},n.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(t.prototype.getMaxZoom.call(this),this._srMaxZoom):t.prototype.getMaxZoom.call(this)},n._getTileZoom=function(t){if(!this._hasOwnSR){var e=this.getMap().getResolution(t),n=this.getSpatialReference().getResolution(t);t+=Math.log(n/e)*Math.LOG2E}var i=this.getMaxAvailableZoom();return!a(i)&&t>i&&(t=i),l(t)||(t=Math.round(t)),Math.max(0,t)},n.getMaxAvailableZoom=function(){var t=this.getSpatialReference();return this.options.maxAvailableZoom||t&&t.getMaxZoom()},n._getTiles=function(t,e,n,i,r){var o=this.getMap(),s=t,h=o.projViewMatrix,l=o.getResolution(t)/o.getResolution(t-1)==.5;n<2&&(0===n&&l&&(s-=1),h=0===n?o.cascadeFrustumMatrix0:1===n?o.cascadeFrustumMatrix1:o.projViewMatrix);var u=s+this.options.zoomOffset,c=this._getTileOffset(s),A=c[0]||c[1],f={zoom:s,extent:null,offset:c,tiles:[]};if(u<0)return f;if(!(o&&this.isVisible()&&o.width&&o.height))return f;if(!r){var d=this.getMinZoom(),p=this.getMaxZoom();if(!a(d)&&s<d||!a(p)&&s>p)return f}var g=this._getTileConfig();if(!g)return f;var m,y={zoom:c},v=this.getSpatialReference().getResolution(s);m=this._hasOwnSR?o.getGLScale(s):v/o.getGLRes();var _=!this._hasOwnSR&&this.options.repeatWorld,x=this._convertToExtent2d(e),b=this._getMask2DExtent();if(b){var w=b.intersection(x);if(!w)return f;e=w.convertTo((function(t){return o._pointToContainerPoint(t,void 0,0,Qc)}))}var C,P=o._containerPointToPrj(e.getCenter(),$c),M=o._prjToPoint(P,s,tA);C=this._project(A?o._pointToPrj(M._add(c),s,tA):P,tA);var T=o.getGLScale()/o.getGLScale(s);eA.x=x.xmin*T,eA.y=x.ymax*T,nA.x=x.xmax*T,nA.y=x.ymin*T;for(var S=this._project(o._pointToPrj(eA._add(c),s,eA),eA),I=this._project(o._pointToPrj(nA._add(c),s,nA),nA),E=g.getTileIndex(C,v,_),O=g.getTileIndex(S,v,_),R=g.getTileIndex(I,v,_),D=Math.ceil(Math.abs(E.idy-O.idy)),k=Math.ceil(Math.abs(E.idx-O.idx)),L=Math.ceil(Math.abs(E.idy-R.idy)),F=Math.ceil(Math.abs(E.idx-R.idx)),N=(D+L+1)*(k+F+1),z=this.getTileSize(),B=this.getRenderer()||i,H=this._getTileConfig().tileSystem.scale,j=[],U=new ps,G=new ht(0,0),V=-D;V<=L;V++)for(var W=-k,q=-1/0,Z=!1;W>=q&&W<=F;){var Q=g.getNeighorTileIndex(E.idx,E.idy,W,V,v,_);q===-1/0?W++:W--;var X=this._getTileId(Q.idx,Q.idy,s);if(!(Q.out||this._visitedTiles&&this._visitedTiles.has(X))){var Y=B&&B.isTileCachedOrLoading(X);Y&&(Y=Y.info);var J=void 0;if(Y){var{extent2d:K}=Y;G.set(K.xmin,K.ymax),J=G}else if(this._hasOwnSR){var $=g.getTilePrjNW(Q.x,Q.y,v);J=o._prjToPoint(this._unproject($,nA),s)}else J=g.getTilePointNW(Q.x,Q.y,v);var tt=void 0,et=void 0;if(this._hasOwnSR){var nt=void 0;if(this._hasOwnSR){var it=g.getTilePrjSE(Q.x,Q.y,v);nt=o._prjToPoint(this._unproject(it,nA),s,nA)}else nt=g.getTilePointSE(Q.x,Q.y,v);tt=Math.ceil(Math.abs(nt.x-J.x)),et=Math.ceil(Math.abs(nt.y-J.y))}else tt=z.width,et=z.height;var rt=H.x*(Q.idx-Q.x)*tt,ot=H.y*(Q.idy-Q.y)*et;Y||!rt&&!ot||J._add(rt,ot);var st=Y&&Y.extent2d||new ps(J.x,J.y-et,J.x+tt,J.y);if(N<=4||Z||this._isTileInExtent(h,st,c,m)){var at=this._hasOwnSR?o._getResolution(s):v;this._visitedTiles&&0===n&&this._visitedTiles.add(X),l&&0===n?(this._splitTiles(h,j,B,Q,s+1,at,st,rt,ot,y),U._combine(st)):(Y?(Y.offset[0]=c[0],Y.offset[1]=c[1]):Y=this.createTileNode(Q.x,Q.y,s,Q.idx,Q.idy,at,0,null,st,X),j.push(Y),U._combine(st)),q===-1/0?(q=W,W=F):Z||(Z=!0)}}}if(j.length){var lt=o._containerPointToPoint(e.getCenter(),s,Qc)._add(c),ut=new ht(0,0),ct=new ht(0,0);j.sort((function(t,e){return ut.set((t.extent2d.xmin+t.extent2d.xmax)/2,(t.extent2d.ymin+t.extent2d.ymax)/2),ct.set((e.extent2d.xmin+e.extent2d.xmax)/2,(e.extent2d.ymin+e.extent2d.ymax)/2),ut.distanceTo(lt)-ct.distanceTo(lt)}))}return{offset:c,zoom:t,extent:U,tiles:j}},n._convertToExtent2d=function(t){var e=this,n=this.getMap();return t.convertTo((function(t){if(t.y>0&&t.y<n.height){var i=(0===t.x?0:1)+t.y;e._coordCache[i]||(e._coordCache[i]=n._containerPointToPoint(t)),e._coordCache[i]}return n._containerPointToPoint(t,void 0,Qc)}))},n._splitTiles=function(t,e,n,i,r,o,s,a,h,l){var u=this._getTileConfig().tileSystem.scale.y,c=this.getMap().getGLScale(r),A=iA.set(2*s.xmin,u<0?2*s.ymax:2*s.ymin),f=s.getWidth(),d=s.getHeight(),p=2*i.idx,g=2*i.idy,m=2*i.x,y=2*i.y,v=this._checkAndAddTile(t,n,p,g,m,y,r,o,0,0,f,d,A,c,l);v&&e.push(v),(v=this._checkAndAddTile(t,n,p,g,m,y,r,o,0,1,f,d,A,c,l))&&e.push(v),(v=this._checkAndAddTile(t,n,p,g,m,y,r,o,1,0,f,d,A,c,l))&&e.push(v),(v=this._checkAndAddTile(t,n,p,g,m,y,r,o,1,1,f,d,A,c,l))&&e.push(v)},n._checkAndAddTile=function(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d){var p=this._getTileId(n+h,i+l,s);if(this._visitedTiles&&this._visitedTiles.has(p))return null;var g=d[s];g||(g=d[s]=this._getTileOffset(s));var m=this._getTileConfig().tileSystem.scale.y,y=new ps(A.x+h*u,A.y+m*l*c,A.x+(h+1)*u,A.y+m*(l+1)*c);if(!this._isSplittedTileInExtent(t,y,g,f))return null;var v=a/2,_=e&&e.isTileCachedOrLoading(p);return _?_.info:this.createTileNode(r+h,o+l,s,n+h,n+o,v,0,null,y,p)},n._getTileOffset=function(...t){var e=this.options.offset;return A(e)&&(e=e.call(this,...t)),h(e)&&(e=[e,e]),e||[0,0]},n.getTileId=function(t,e,n,i){return this._getTileId(t,e,n,i)},n._getTileId=function(t,e,n,i){return(i||this.getId())+"_"+t+"_"+e+"_"+n},n._project=function(t,e){if(this._hasOwnSR){var n=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(n.unproject(t,e),e)}return t},n._unproject=function(t,e){if(this._hasOwnSR){var n=this.getMap(),i=this.getSpatialReference(),r=n.getProjection(),o=i.getProjection();return r.project(o.unproject(t,e),e)}return t},n._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),n=this.getSpatialReference(),i=n.getProjection(),r=n.getFullExtent();this._defaultTileConfig=new Hc(t,zc.getDefault(i),r,e),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new Hc(t,this.options.tileSystem,r,e)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},n._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},n._bindMap=function(e){return this._onSpatialReferenceChange(),t.prototype._bindMap.apply(this,arguments)},n._isTileInExtent=function(t,e,n,i){var r,o,s,a,h,l,u,c,A=this.getMap();if(t!==A.projViewMatrix){var f=e.getCenter(rA)._sub(n[0],n[1])._multi(i);zi(hA,f.x,f.y,0),r=(o=hA,s=hA,a=A.projViewMatrix,h=s[0],l=s[1],u=s[2],c=a[3]*h+a[7]*l+a[11]*u+a[15],o[0]=(a[0]*h+a[4]*l+a[8]*u+a[12])/(c=c||1),o[1]=(a[1]*h+a[5]*l+a[9]*u+a[13])/c,o[2]=(a[2]*h+a[6]*l+a[10]*u+a[14])/c,o)[1]<0?A.projViewMatrix:t}else r=A.projViewMatrix;return oA[0][0]=(e.xmin-n[0])*i,oA[0][1]=(e.ymin-n[1])*i,oA[1][0]=(e.xmax-n[0])*i,oA[1][1]=(e.ymax-n[1])*i,Vc(r,oA)},n._isSplittedTileInExtent=function(t,e,n,i){var r=this.getMap();return oA[0][0]=(e.xmin-n[0])*i,oA[0][1]=(e.ymin-n[1])*i,oA[1][0]=(e.xmax-n[0])*i,oA[1][1]=(e.ymax-n[1])*i,Vc(r.projViewMatrix,oA)},n.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},n._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var t=this.getRenderer();t&&t.clear()},n.getPolygonOffsetCount=function(){return 2},n.getPolygonOffset=function(){return this._polygonOffset||0},n.setPolygonOffset=function(t){return this._polygonOffset=t,this},n.getRenderer=function(){return t.prototype.getRenderer.call(this)},n._getTileBBox=function(t){var e=this.getMap();if(e){var n=t.extent2d,i=t.offset||[0,0];if(n){var r=t.res,[o,s]=i,{xmin:a,ymin:h,xmax:l,ymax:u}=n;l-=o,u-=s;var c=new ht(a-=o,h-=s),A=new ht(l,u),f=e.pointAtResToCoordinate(c,r,$c),d=e.pointAtResToCoordinate(A,r,tA);return[f.x,f.y,d.x,d.y]}}},n._tileInMask=function(t){var e=this.getMask();if(!e)return!0;var n=e.type;if(!n||-1===n.indexOf("Polygon"))return!0;var i=this._maskGeoJSON;if(!i||!i.geometry)return!0;var{coordinates:r,type:o}=i.geometry;if(!r||!o)return!0;if(-1===o.indexOf("Polygon"))return!0;if(!i.bbox){var s=e.getExtent();if(!s)return!0;i.bbox=[s.xmin,s.ymin,s.xmax,s.ymax]}var a=this._getTileBBox(t);return!a||Fi(a,this._maskGeoJSON)},e}(sl);function uA(t,e){return t.z-e.z}lA.registerJSONType("TileLayer"),lA.mergeOptions(Jc);var cA=new Jt(256,256),AA="show hide remove setzindex forcereloadstart";function fA(t){return Array.isArray(t)||(t=[t]),t}var dA=function(t){function e(e,n,i){var r;return(r=t.call(this,e,i)||this).layers=n||[],r._checkChildren(),r.layerMap={},r._groupChildren=[],r}K(e,t),e.fromJSON=function(t){if(!t||"GroupTileLayer"!==t.type)return null;var n=t.layers.map((function(t){return sl.fromJSON(t)}));return new e(t.id,n,t.options)};var n=e.prototype;return n.getLayers=function(){return this.layers},n.addLayer=function(t=[]){var e=this;t=fA(t);var n=this.layers.length;return t.forEach((function(t){t instanceof lA&&(-1!==e.layers.indexOf(t)||e.layerMap[t.getId()]||e.layers.push(t))})),n!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},n.removeLayer=function(t=[]){var e=this;t=fA(t);var n=this.layers.length;return t.forEach((function(t){if(t instanceof lA||(t=e.layerMap[t]),t instanceof lA){var n=e.layers.indexOf(t);n>=0&&(e.layers.splice(n,1),t._doRemove(),t.off(AA,e._onLayerShowHide,e))}})),n!==this.layers.length&&(this._refresh(),this._renderLayers()),this},n.clearLayers=function(){var t=this;return this.layers.forEach((function(e){e._doRemove(),e.off(AA,t._onLayerShowHide,t)})),this.layers=[],this._refresh(),this._renderLayers(),this},n.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map((function(t){return t.toJSON()})),options:this.config()}},n.getTileSize=function(t){var e=this.getLayer(t);return e?e.getTileSize():cA},n.getTiles=function(t,e){for(var n=this.layers,i=[],r=0,o=0,s=n.length;o<s;o++){var a=n[o];if(a&&a.options.visible&&a.isVisible()&&a.getMap()){var h=a.getTiles(t,e||this);h&&0!==h.count&&(r+=h.count,pt(i,h.tileGrids))}}return{count:r,tileGrids:i}},n.onAdd=function(){this._sortLayers(),this._refresh(),t.prototype.onAdd.call(this)},n.onRemove=function(){var e=this;this.layers.forEach((function(t){t._doRemove(),t.off(AA,e._onLayerShowHide,e)})),this.layerMap={},this._groupChildren=[],t.prototype.onRemove.call(this)},n.getLayer=function(t){return this.getChildLayer(t)},n.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var n=0;n<this._groupChildren.length;n++){var i=this._groupChildren[n].getChildLayer(t);if(i)return i}return null},n._removeChildTileCache=function(t){if(!t)return this;var e,n=this.getRenderer();if(!n)return this;var i=t.getId(),r=function(){return e&&e.info&&e.info.layer===i};n.tileCache&&n.tileCache.keys().forEach((function(t){e=n.tileCache.get(t),r()&&n.tileCache.remove(t)}));var o=n.tilesInView||{};for(var s in o)e=o[s],r()&&delete o[s];var a=n.tilesLoading||{};for(var h in a)e=a[h],r()&&n.abortTileLoading(e.image,e.info);return this},n._onLayerShowHide=function(t){var{type:e,target:n}=t||{};"remove"===e&&n?(this.layers.splice(this.layers.indexOf(n),1),n._doRemove(),n.off(AA,this._onLayerShowHide,this),this._refresh()):"setzindex"===e?this._sortLayers():"forcereloadstart"===e&&this._removeChildTileCache(n),this._renderLayers()},n._renderLayers=function(){var t=this.getRenderer();return t&&t.setToRedraw(),this},n._refresh=function(){var t=this,e=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach((function(n){t.layerMap[n.getId()]=n,n.getChildLayer&&t._groupChildren.push(n),n.getMap()||n._bindMap(e),n.off(AA,t._onLayerShowHide,t),n.on(AA,t._onLayerShowHide,t)})),this},n.isVisible=function(){if(!t.prototype.isVisible.call(this))return!1;for(var e=this.layers,n=0,i=e.length;n<i;n++)if(e[n].isVisible())return!0;return!1},n._checkChildren=function(){var t=this,e={};this.layers.forEach((function(n){var i=n.getId();if(e[i])throw new Error("Duplicate child layer id ("+i+") in the GroupTileLayer ("+t.getId()+")");e[i]=1}))},n._sortLayers=function(){this.layers.sort((function(t,e){return t.options.zIndex-e.options.zIndex}))},e}(lA);dA.registerJSONType("GroupTileLayer"),dA.mergeOptions({urlTemplate:"",maxCacheSize:1024});var pA,gA={urlTemplate:"",crs:null,uppercase:!1,detectRetina:!1},mA={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},yA=function(t){function e(e,n){var i;return i=t.call(this,e)||this,pA||(pA=s({},i.options)),i.wmsParams=s({},mA),i.setOptions(n),i.setZIndex(n.zIndex),Q.proxy||i._optionsHook(n),i}K(e,t);var n=e.prototype;return n._optionsHook=function(t={}){for(var e in t)"tileSize"===e&&(this._tileSize=null),e in pA||(this.wmsParams[e]=t[e]);var n=this.getTileSize();return this.wmsParams.width=n.width,this.wmsParams.height=n.height,this._wmsVersion=parseFloat(this.wmsParams.version),this},n.onAdd=function(){var e=this.getMap().getDevicePixelRatio(),n=gA.detectRetina?e:1;this.wmsParams.width*=n,this.wmsParams.height*=n;var i=this.options.crs||this.getMap().getProjection().code;this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=i,t.prototype.onAdd.call(this)},n.getTileUrl=function(e,n,i){var r=this.getSpatialReference().getResolution(i),o=this._getTileConfig().getTilePrjExtent(e,n,r),s=o.getMax(),a=o.getMin(),h=(this._wmsVersion>=1.3&&("EPSG:4326"===this.wmsParams.crs||"EPSG:4490"===this.wmsParams.crs)?[a.y,a.x,s.y,s.x]:[a.x,a.y,s.x,s.y]).join(","),l=t.prototype.getTileUrl.call(this,e,n,i);return l+function(t,e,n){var i=[];for(var r in t)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}(this.wmsParams,l,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},n.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"WMSTileLayer"===t.type?new e(t.id,t.options):null},e}(lA);yA.registerJSONType("WMSTileLayer"),yA.mergeOptions(gA);var vA=function(t){function e(e,n){var i;return(i=t.call(this,e,n)||this).options.hasOwnProperty("forceRenderOnMoving")||(i.options.forceRenderOnMoving=!1),i}K(e,t);var n=e.prototype;return n.drawTile=function(){},n.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"CanvasTileLayer"===t.type?new e(t.id,t.options):null},e}(lA);function _A(t,e,n){var i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(i);throw t.deleteShader(i),new Error("Failed to compile shader: "+r)}return i}function xA(t,e,n){var i=_A(t,t.VERTEX_SHADER,e),r=_A(t,t.FRAGMENT_SHADER,n);if(!i||!r)return null;var o=t.createProgram();return o?(t.attachShader(o,i),t.attachShader(o,r),t.linkProgram(o),{program:o,vertexShader:i,fragmentShader:r}):null}function bA(t,e,n){if(Array.isArray(n[0])){for(var i=Float32Array.BYTES_PER_ELEMENT,r=0,o=0;o<n.length;o++)r+=n[o][1]||0;for(var s=0,a=0;a<n.length;a++){var h=t.getAttribLocation(e,n[a][0]);if(h<0)throw new Error("Failed to get the storage location of "+n[a][0]);t.vertexAttribPointer(h,n[a][1],t[n[a][2]||"FLOAT"],!1,i*r,i*s),s+=n[a][1]||0,t.enableVertexAttribArray(h)}}else{var l=t.getAttribLocation(e,n[0]);t.vertexAttribPointer(l,n[1],t[n[2]||"FLOAT"],!1,0,0),t.enableVertexAttribArray(l)}}vA.registerJSONType("CanvasTileLayer");var wA={never:512,"<":513,"=":514,"<=":515,">":516,"!=":517,">=":518,always:519},CA=[1,1,1,1],PA=new Float32Array(8),MA=new Int16Array(8),TA="\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",SA="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n        uniform vec4 u_base_color;\n        uniform float u_alpha_test;\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n            gl_FragColor *= u_base_color;\n            if (gl_FragColor.a < u_alpha_test) {\n                discard;\n            }\n        }\n    ",IA=["",0],EA=[0,0,0],OA=new Array(16),RA=new ht(20,20),DA=function(t){var e=function(t){function e(){var e;return(e=t.apply(this,arguments)||this)._layerAlt=0,e._layerAltitude=0,e}K(e,t);var i=e.prototype;return i.drawGLImage=function(t,e,n,i,r,o,s,l,u){this.gl.program!==this.program&&this.useProgram(this.program);var c=this.gl;if(this.loadTexture(t),this.canvas.gl&&this.canvas.gl.wrap){var A=this.layer&&this.layer.options.opacity;a(A)&&(A=1),s*=A}EA[0]=e||0,EA[1]=n||0,EA[2]=0;var f=this.layer;if(f){var{altitude:d}=f.options,p=h(d);if(p||(this._layerAlt=0),this._layerAltitude!==d&&p){var g=f.getMap();if(g){var m=g.altitudeToPoint(d,g.getGLRes());this._layerAltitude=d,this._layerAlt=m}}}EA[2]=this._layerAlt||0;var y=di(OA);hi(y,y,EA),li(y,y,[o,o,1]),Ai(y,this.getMap().projViewMatrix,y),c.uniformMatrix4fv(this.program.u_matrix,!1,y),c.uniform1f(this.program.u_opacity,s),c.uniform1f(this.program.u_debug_line,0),c.uniform4fv(this.program.u_base_color,u||CA),c.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0);var{glBuffer:v}=t;!v||v.width===i&&v.height===r||(this.saveImageBuffer(v),delete t.glBuffer),t.glBuffer?c.bindBuffer(c.ARRAY_BUFFER,v):t.glBuffer=this.bufferTileData(0,0,i,r),IA[0]="a_position",IA[1]=2,IA[2]=t.glBuffer.type,this.enableVertexAttrib(IA),c.bindBuffer(c.ARRAY_BUFFER,this.texBuffer),IA[0]="a_texCoord",IA[1]=2,IA[2]="UNSIGNED_BYTE",this.enableVertexAttrib(IA),c.drawArrays(c.TRIANGLE_STRIP,0,4),l&&this.drawDebug(y,0,0,i,r,l)},i.drawDebug=function(t,e,n,i,r,o){var s=this.gl;s.disable(s.DEPTH_TEST),s.bindBuffer(s.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),s.bufferData(s.ARRAY_BUFFER,new Float32Array([e,n,e+i,n,e+i,n-r,e,n-r,e,n]),s.DYNAMIC_DRAW),s.uniformMatrix4fv(this.program.u_matrix,!1,t),s.uniform1f(this.program.u_opacity,1),s.uniform1f(this.program.u_debug_line,1),s.uniform4fv(this.program.u_base_color,CA),s.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0),s.drawArrays(s.LINE_STRIP,0,5);var a=this._debugInfoCanvas;if(!a){var h=this.getMap().getDevicePixelRatio()>1?2:1;(a=this._debugInfoCanvas=document.createElement("canvas")).width=256*h,a.height=32*h;var l=a.getContext("2d");l.font="20px monospace",l.scale(h,h)}var u=a.getContext("2d");u.clearRect(0,0,a.width,a.height),Mo.fillText(u,o,RA,this.layer.options.debugOutline),this.loadTexture(a),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,a);var c=e+(i=256),A=n-r+32,f=n-r;s.bufferData(s.ARRAY_BUFFER,this.set8(e,A,e,f,c,A,c,f),s.DYNAMIC_DRAW),s.uniform1f(this.program.u_debug_line,0),s.bindBuffer(s.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),s.drawArrays(s.TRIANGLE_STRIP,0,4),s.enable(s.DEPTH_TEST)},i.bufferTileData=function(t,e,n,i,r){var o,s=t,a=t+n,h=e,u=e-i;o=l(s)&&l(a)&&l(h)&&l(u)?this.set8Int(s,h,s,u,a,h,a,u):this.set8(s,h,s,u,a,h,a,u);var c=this.loadImageBuffer(o,r);return c.width=n,c.height=i,c.type=o instanceof Int16Array?"SHORT":"FLOAT",c},i.createCanvas2=function(){this.canvas2=Mo.createCanvas(this.canvas.width,this.canvas.height)},i.createGLContext=function(){this.gl=this.canvas.gl&&this.canvas.gl.wrap?this.canvas.gl.wrap():function(t,e){for(var n={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},i=["webgl","experimental-webgl"],r=null,o=0;o<i.length;++o){try{r=t.getContext(i[o],e||n)}catch(s){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);var t=this.gl;t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(TA,this.layer.options.fragmentShader||SA),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),t.bufferData(t.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.enableSampler("u_image"),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},i.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},i.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)),this.gl.wrap||this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},i.disposeImage=function(t){t&&(t.texture&&this.saveTexture(t.texture),t.glBuffer&&this.saveImageBuffer(t.glBuffer),delete t.texture,delete t.glBuffer)},i._createTexture=function(t){var e=this.gl,n=this.getTexture()||e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);var i=this.layer.options.mipmapTexture;return!i||kA(t.width)&&kA(t.height)||(t=function(t){if(kA(t.width)&&kA(t.height))return t;var e=t.width,n=t.height;kA(e)||(e=LA(e)),kA(n)||(n=LA(n));var i=document.createElement("canvas");i.width=e,i.height=n;var r=i.getContext("2d");return r.imageSmoothingEnabled=!1,r.drawImage(t,0,0,e,n),i}(t)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i&&e.generateMipmap(e.TEXTURE_2D),n},i.getTexture=function(){this._textures||(this._textures=[]);var t=this._textures;return t&&t.length>0?t.pop():null},i.saveTexture=function(t){this._textures.push(t)},i.loadTexture=function(t){var e=this.getMap(),n=this.gl,i=t.texture;return i||(i=this._createTexture(t),t.texture=i),n.bindTexture(n.TEXTURE_2D,i),this.layer.options.mipmapTexture&&(e.isMoving()&&e.getRenderer().isViewChanged()?n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)),i},i.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var t=this._imageBuffers;return t&&t.length>0?t.pop():null},i.saveImageBuffer=function(t){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(t)},i.loadImageBuffer=function(t,e){var n=this.gl,i=e||this.createImageBuffer();return n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),i},i.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},i.removeGLCanvas=function(){var t=this.gl;if(t){if(this._debugBuffer&&(t.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach((function(e){t.deleteBuffer(e)})),delete this._buffers),this._textures&&(this._textures.forEach((function(e){return t.deleteTexture(e)})),delete this._textures),this._debugInfoCanvas){var e=this._debugInfoCanvas.texture;e&&t.deleteTexture(e),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var n=t.program;t.deleteShader(n.fragmentShader),t.deleteShader(n.vertexShader),t.deleteProgram(n),delete this.gl,delete this.canvas2}},i.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},i.enableVertexAttrib=function(t){bA(this.gl,this.gl.program,t)},i.createProgram=function(t,e){for(var n=this.gl,{program:i,vertexShader:r,fragmentShader:o}=xA(n,t,e),s=n.getProgramParameter(i,35718),a=[],h=0;h<s;++h){var l=n.getActiveUniform(i,h);a.push(l.name)}return i.vertexShader=r,i.fragmentShader=o,this._initUniforms(i,a),i},i.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},i.enableSampler=function(t,e){var n=this.gl,i=this._getUniform(n.program,t);return e||(e=0),n.uniform1i(i,e),i},i._initUniforms=function(t,e){for(var i=0;i<e.length;i++){var r=e[i],o=e[i],s=r.indexOf("[");s>=0&&(r=r.substring(0,s),n||(o=o.substring(0,s))),t[r]=this._getUniform(t,o)}},i._getUniform=function(t,e){var n=this.gl.getUniformLocation(t,e);if(!n)throw new Error("Failed to get the storage location of "+e);return n},i.set8=function(t,e,n,i,r,o,s,a){var h=PA;return h[0]=t,h[1]=e,h[2]=n,h[3]=i,h[4]=r,h[5]=o,h[6]=s,h[7]=a,h},i.set8Int=function(t,e,n,i,r,o,s,a){var h=MA;return h[0]=t,h[1]=e,h[2]=n,h[3]=i,h[4]=r,h[5]=o,h[6]=s,h[7]=a,h},e}(t);return e};function kA(t){return!(t&t-1)&&0!==t}function LA(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}var FA={renderer:Q.webgl?"gl":"canvas",crossOrigin:null,alphaTest:!1,depthMask:!0,depthFunc:"<="},NA=new ht(0,0),zA=function(t){function e(e,n,i){var r;return!n||Array.isArray(n)||n.url||(i=n,n=null),(r=t.call(this,e,i)||this)._images=n,r}K(e,t);var n=e.prototype;return n.onAdd=function(){this._prepareImages(this._images)},n.setImages=function(t){return this._images=t,this._prepareImages(t),this},n.getImages=function(){return this._images},n._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap(),n=e.getGLRes();this._imageData=t.map((function(t){var i=new fs(t.extent);return s({},t,{extent:i,extent2d:i.convertTo((function(t){return e.coordToPointAtRes(t,n)}))})})),this._images=t;var i=this.getRenderer();i&&i.refreshImages()},n.getRenderer=function(){return t.prototype.getRenderer.call(this)},e}(sl);zA.mergeOptions(FA);var BA,HA=[],jA=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},n.checkResources=function(){var t=this;if(this._imageLoaded)return HA;var e=this.layer._imageData.map((function(t){return[t.url,null,null]}));if(this.resources){var n=[],i=new fa;e.forEach((function(e){if(t.resources.isResourceLoaded(e)){var r=t.resources.getImage(e);i.addResource(e,r)}else n.push(e)})),this.resources.forEach((function(e,n){i.isResourceLoaded(e)||t.retireImage(n.image)})),this.resources=i,e=n}return this._imageLoaded=!0,e},n.retireImage=function(t){t.close&&t.close()},n.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},n.draw=function(t,e){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(t,e),this.completeRender())},n._drawImages=function(t,e){var n=this.layer._imageData,i=this.getMap(),r=i.get2DExtentAtRes(i.getGLRes());if(n&&n.length)for(var o=0;o<n.length;o++){var s=n[o].extent2d,a=this.resources&&this.resources.getImage(n[o].url);if(a&&r.intersects(s)){this._painted=!0;var l=n[o].opacity;h(l)||(l=1),this._drawImage(a,s,l)}}},n._drawImage=function(t,e,n){var i=0,r=this.context;n<1&&(i=r.globalAlpha,r.globalAlpha=n);var o=this.getMap(),s=NA.set(e.xmin,e.ymax),a=o._pointAtResToContainerPoint(s,o.getGLRes()),h=a.x,l=a.y,u=o.getBearing();u&&(r.save(),r.translate(h,l),u&&r.rotate(-u*Math.PI/180),h=l=0);var c=o.getGLScale();r.drawImage(t,h,l,e.getWidth()/c,e.getHeight()/c),u&&r.restore(),i&&(r.globalAlpha=i)},n.drawOnInteracting=function(t,e,n){this.draw()},e}(Aa),UA=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.drawOnInteracting=function(t,e,n){this.draw(e,n)},n._prepareGLContext=function(){var t,e=this.gl;e&&(e.disable(e.STENCIL_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.depthFunc((t=this.layer.options.depthFunc,wA[t])),e.depthMask(!!this.layer.options.depthMask))},n._drawImages=function(e,n){var i=this.gl;if(n&&n.renderTarget){var r=n.renderTarget.fbo;if(r){var o=n.renderTarget.getFramebuffer(r);i.bindFramebuffer(i.FRAMEBUFFER,o)}}this._prepareGLContext(),t.prototype._drawImages.call(this),n&&n.renderTarget&&n.renderTarget.fbo&&i.bindFramebuffer(i.FRAMEBUFFER,null)},n.isDrawable=function(){return!0},n._drawImage=function(t,e,n){this.drawGLImage(t,e.xmin,e.ymax,e.getWidth(),e.getHeight(),1,n)},n.createContext=function(){this.createGLContext()},n.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},n.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.retireImage=function(t){t.close&&t.close(),this.disposeImage(t)},n.onRemove=function(){this.removeGLCanvas(),t.prototype.onRemove.call(this)},e}(DA(jA));zA.registerRenderer("canvas",jA),zA.registerRenderer("gl",UA),function(t){t[t.never=0]="never",t[t["<"]=1]="<",t[t["="]=2]="=",t[t["<="]=3]="<=",t[t[" >"]=4]=" >",t[t["!="]=5]="!=",t[t[">="]=6]=">=",t[t.always=7]="always"}(BA||(BA={}));var GA=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.getPrepareParams=function(){return[]},n.getDrawParams=function(){return[]},n.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=Mo.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},n.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&t.prototype.needToRedraw.call(this)},n.draw=function(...t){this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer(...t)},n.drawOnInteracting=function(...t){this._drawLayerOnInteracting(...t)},n.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.layer.options.doubleBuffer){var n=e.image;this.buffer.width===n.width&&this.buffer.height===n.height||(this.buffer.width=n.width,this.buffer.height=n.height);var i=this.buffer.getContext("2d"),r=this.layer.doubleBuffer(i,this.context);(void 0===r||r)&&(Mo.image(i,n,0,0),e.image=this.buffer)}return e},n.remove=function(){return delete this._drawContext,t.prototype.remove.call(this)},n.onZoomStart=function(e){this.layer.onZoomStart(e),t.prototype.onZoomStart.call(this,e)},n.onZooming=function(e){this.layer.onZooming(e),t.prototype.onZooming.call(this,e)},n.onZoomEnd=function(e){this.layer.onZoomEnd(e),t.prototype.onZoomEnd.call(this,e)},n.onMoveStart=function(e){this.layer.onMoveStart(e),t.prototype.onMoveStart.call(this,e)},n.onMoving=function(e){this.layer.onMoving(e),t.prototype.onMoving.call(this,e)},n.onMoveEnd=function(e){this.layer.onMoveEnd(e),t.prototype.onMoveEnd.call(this,e)},n.onResize=function(e){this.layer.onResize(e),t.prototype.onResize.call(this,e)},n.prepareDrawContext=function(){if(!this._predrawed){var t=VA(this.getPrepareParams());this._drawContext=this.layer.prepareToDraw(this.context,...t),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},n._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();return t.maskExtent&&!t.extent.intersects(t.maskExtent)?(this.completeRender(),null):[this.context,t,...VA(this.getDrawParams()),...this._drawContext]},n._drawLayer=function(...t){var e=this._prepareDrawParams();e&&(this.layer.draw.apply(this.layer,e.concat(t)),this.completeRender())},n._drawLayerOnInteracting=function(...t){if(this.layer.drawOnInteracting){var e=this._prepareDrawParams();e&&(this.layer.drawOnInteracting(...e,...t),this.completeRender())}},e}(Aa);function VA(t){return t||(t=[]),Array.isArray(t)||(t=[t]),t}var WA=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.isCanvasRender=function(){return!0},n.prepareToDraw=function(){},n.draw=function(...t){},n.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},n.play=function(){return this.config("animation",!0),this},n.pause=function(){return this.config("animation",!1),this},n.isPlaying=function(){return this.options.animation},n.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},n.requestMapToRender=function(){var t=this._getRenderer();return t&&t.requestMapToRender&&t.requestMapToRender(),this},n.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},n.onCanvasCreate=function(){return this},n.onZoomStart=function(){},n.onZooming=function(){},n.onZoomEnd=function(){},n.onMoveStart=function(){},n.onMoving=function(){},n.onMoveEnd=function(){},n.onResize=function(){},n.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},n._getRenderer=function(){return t.prototype._getRenderer.call(this)},e}(sl);WA.mergeOptions({doubleBuffer:!1,animation:!1}),WA.registerRenderer("canvas",GA);var qA=new ht(0,0),ZA=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.getParticles=function(t){},n.draw=function(t,e){var n=this.getParticles(o());if(n&&0!==n.length){var i=this.getMap(),r=e.extent;e.maskExtent&&(r=e.extent.intersection(e.maskExtent)),r=r.convertTo((function(t){return i._pointToContainerPoint(t,void 0,0,qA)}));for(var s=2*Math.PI,a=0,h=n.length;a<h;a++){var l=n[a].point;if(r.contains(l)){var u=n[a].color||this.options.lineColor||"#fff",c=n[a].r;t.fillStyle!==u&&(t.fillStyle=u),c<=2?t.fillRect(l.x-c/2,l.y-c/2,c,c):(t.beginPath(),t.arc(l.x,l.y,c/2,0,s),t.fill())}}this._fillCanvas(t)}else this._getRenderer()&&(this._getRenderer()._shouldClear=!0)},n._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, "+1/(this.options.trail||30)+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},e}(WA);ZA.mergeOptions({animation:!0}),ZA.registerRenderer("canvas",function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},n.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},n.onSkipDrawOnInteracting=function(){this._shouldClear=!0},e}(GA));var QA,XA,YA=new fa,JA=function(t){function e(e,n,i){var r;(r=t.call(this,i)||this).target=e,e.once("remove",r.delete,r);var o=r.options.symbol,s=o.markerLineWidth||1;return r.w=o.markerWidth+s,r.h=o.markerHeight+s,r.opacity=a(o.opacity)?1:o.opacity,r.map=n,r.events=i.events,r._fetchImage(),r.addTo(n),r}K(e,t);var n=e.prototype;return n.getCursor=function(){return this.options.cursor||"default"},n._fetchImage=function(){var t=this.map,e=this.options.symbol,{markerFile:n}=e;this.url=n||Kn(e);var i=YA.getImage(this.url);if(!i){var r=this.w,o=this.h;if(n)(i=new Image).onload=function(){var e=t.getRenderer();e&&e.setToRedraw()},i.src=this.url;else{var s=document.createElement("canvas");s.width=r,s.height=o,i=Xa(s.getContext("2d"),{x:r/2,y:o/2},e,YA)}YA.addResource([this.url,r,o],i)}YA.login(this.url),this._img=i},n.setContainerPoint=function(t){this._point=t,this._point._sub(this.w/2,this.h/2)},n.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},n.offset=function(t){this._point._add(t)},n.render=function(t){if(!this._img)return!1;var e=this.options.symbol,n=e.markerDx||0,i=e.markerDy||0,r=this.map,{x:o,y:s}=this._point,a=this.w,h=this.h;if(o+a>0&&o<r.width&&s+h>0&&s<r.height){var l=r.getDevicePixelRatio();return t.globalAlpha=this.opacity,t.drawImage(this._img,Math.round((o+n)*l),Math.round((s+i)*l),Math.round(a*l),Math.round(h*l)),!0}return!1},n.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}YA.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},n.hitTest=function(t){var e=this.options.symbol,n=this._point.x+(e.markerDx||0),i=this._point.y+(e.markerDy||0);return t.x>=n&&t.x<=n+this.w&&t.y>=i&&t.y<=i+this.h},n.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},n.onEvent=function(t){this.fire(t.type,t)},n.mousedown=function(t){var e=this.options.cursor;e&&t.target.setCursor(e),this.onDragstart(t)},n.onDragstart=function(t){var{containerPoint:e,target:n}=t,i=n.getPanels().mapWrapper||n.getContainer(),r=this._dragger=new Ko(i);r.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),r.onMouseDown(t.domEvent),QA=e.x,XA=e.y,this.fire("dragstart",{containerPoint:e})},n.onDragging=function(t){if(this._dragger){var e=this.map,n=ke(t.domEvent,e.getContainer()),i={x:n.x-QA,y:n.y-XA},r=e.containerPointToCoord(new ht(QA,XA)),o=e.containerPointToCoord(n);QA=n.x,XA=n.y,this.offset(i),this.fire("dragging",{containerPoint:n,coordOffset:o._sub(r)})}},n.onDragend=function(t){if(this._dragger){var e=this.map;e.resetCursor();var n=ke(t.domEvent,e.getContainer());this.offset({x:n.x-QA,y:n.y-XA}),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:n})}},n.needCollision=function(){var{target:t}=this;return!this.options.ignoreCollision&&t&&t.options&&t.options.collision},n.getRenderBBOX=function(t){var{target:e,map:n}=this;if(!e||!e.options||!n)return null;var i=this.options.symbol,r=i.markerDx||0,o=i.markerDy||0,{x:s,y:a}=this._point,h=this.w,l=this.h;t=t||n.getDevicePixelRatio(),this.bbox=this.bbox||Ti();var u=Math.round((s+r)*t),c=Math.round((a+o)*t),A=Math.round(h*t),f=Math.round(l*t);this.bbox[0]=u,this.bbox[1]=c,this.bbox[2]=u+A,this.bbox[3]=c+f;var{options:d}=e;return Di(this.bbox,d.collisionBufferSize||0),this.bbox},n.setZIndex=function(t){this.options.zIndex=t},e}(Do(Lo)),KA=function(){function t(t,e,n){this.target=t,t.once("remove",this.delete,this),this.map=e,this.options=n,this.addTo(e)}var e=t.prototype;return e.setPoints=function(t){this.points=t;var e=t.map((function(t){return t.x})),n=t.map((function(t){return t.y}));this.xmin=Math.min(...e),this.xmax=Math.max(...e),this.ymin=Math.min(...n),this.ymax=Math.max(...n)},e.hitTest=function(){return!1},e.render=function(t){var e=this.map;if(!(this.xmax<=0||this.xmin>=e.width||this.ymax<=0||this.ymin>=e.height)){var n=e.getDevicePixelRatio();t.lineWidth=1,t.strokeStyle="#000",t.globalAlpha=1,t.beginPath();var i=this.points;t.moveTo(o(i[0].x),o(i[0].y));for(var r=1;r<this.points.length;r++)t.lineTo(o(i[r].x),o(i[r].y));t.closePath(),t.stroke()}function o(t){return Math.round(t)*n+.5}},e.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},e.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}},t}(),$A=Gt+"_edit_stage_";function tf(t,e){return{markerType:t,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:e}}function ef(t,e){var n=t.getGLRes(),i=t.coordToPointAtRes(e,n);return t._pointAtResToContainerPoint(i,n,e.z||0)}function nf(t,e,n){var i=t.getMap();if(!e||0===e.z)return i.containerPointToCoord(n);var r=e.z,o=i.getGLRes(),s=i.coordToPointAtRes(e,o),a=i._pointAtResToContainerPoint(s,o,0),h=i._pointAtResToContainerPoint(s,o,r).sub(a),l=n.sub(h),u=i.containerPointToCoord(l);return u.z=0,!t.getGeometries&&t.isPoint&&(u.z=r),u}function rf(t){var e=this.target,n=this.paramOptions;return e._updating=!0,n.onDown&&(n.onDown.call(e,t.containerPoint,t),e._geometry.fire("handledragstart")),!1}function of(t){var e=this.target,n=this.paramOptions;return e._hideContext(),n.onMove&&(n.onMove.call(e,t),e._geometry.fire("handledragging")),!1}function sf(t){var e=this.target,n=this.paramOptions;return n.onUp&&(n.onUp.call(e,t),e._geometry.fire("handledragend")),e._updating=!1,!1}var af={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:tf("ellipse",1),vertexHandleSymbol:tf("square",1),newVertexHandleSymbol:tf("square",.4),collision:!1,collisionBufferSize:0,vertexZIndex:0,newVertexZIndex:0},hf=function(t){function e(e,n){var i;return(i=t.call(this,n)||this)._geometry=e,i._geometry?i:nt(i)}K(e,t);var n=e.prototype;return n.getMap=function(){return this._geometry.getMap()},n.prepare=function(){var t=this.getMap();t&&(t.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},n._prepareEditStageLayer=function(){var t=this._geometry.getLayer();if("canvas"===t.options.renderer){var e=this.getMap(),n=At(),i=$A+n+"_shadow";this._shadowLayer=e.getLayer(i),this._shadowLayer||(this._shadowLayer=new t.constructor(i),e.addLayer(this._shadowLayer))}},n.start=function(){if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){this.editing=!0,this.prepare();var t,e=this._geometry,n="canvas"===this._geometry.getLayer().options.renderer;this._geometryDraggble=e.options.draggable,n?(e.config("draggable",!1),(t=e.copy()).setSymbol(e._getInternalSymbol()),t.copyEventListeners(e),e._getParent()&&t.copyEventListeners(e._getParent()),t._setEventTarget(e),t.setId(null).config({draggable:!1}),this._shadow=t,e.hide()):e instanceof Bl&&e.config("draggable",!0),this._switchGeometryEvents("on"),(e instanceof Bl||e instanceof eu||e instanceof ru||e instanceof iu)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(t),e instanceof Bl?t&&(t.config("draggable",!0),t.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),e instanceof Bl&&!1!==this.options.resize?this.createMarkerEditor():e instanceof eu?this.createCircleEditor():e instanceof ru||e instanceof iu?this.createEllipseOrRectEditor():e instanceof ou||(e instanceof Fl||e instanceof jl)&&this.createPolygonEditor()}},n.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()?(this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")):this.fire("remove")},n.isEditing=function(){return!a(this.editing)&&this.editing},n._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},n._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var n in e)this._geometry[t](n,e[n],this)}},n._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},n._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},n._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;e||(this._editOutline=new KA(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var n=this._editOutline.points;if(t instanceof Bl)this._editOutline.setPoints(t.getContainerExtent().toArray(n));else{var i=t.getShell(),r=t._getEditCenter(),o=Ti();Ei(i,o);var s=new fs(o[0],o[1],o[2],o[3]),a=this.getMap(),h=s.toArray().map((function(t){return t.z=r.z,ef(a,t)}));this._editOutline.setPoints(h)}return e},n._createCenterHandle=function(){var t,e=this,n=this.getMap(),i=this.options.centerHandleSymbol,r=ef(n,this._geometry._getEditCenter()),o=this.createHandle(r,{ignoreCollision:!0,symbol:i,cursor:"move",onDown:function(){if(e._shadow){var n=$n((t=e._shadow.copy())._getInternalSymbol(),.5);t.setSymbol(n).addTo(e._geometry.getLayer())}},onMove:function(n){var i=n.coordOffset;t?t.translate(i):e._geometry.translate(i)},onUp:function(){if(t){var n=t.getFirstCoordinate(),i=e._geometry.getFirstCoordinate(),r=n.sub(i);e._update("translate",r),t.remove()}}});this._addRefreshHook((function(){var t=e._geometry._getEditCenter();o.setContainerPoint(ef(n,t))}))},n._createHandleInstance=function(t,e){e=e||{};var n=this.getMap(),i=wn(e.symbol,(function(){return[n.getZoom(),{"{bearing}":n.getBearing(),"{pitch}":n.getPitch(),"{zoom}":n.getZoom()}]})),r=new JA(this,n,{symbol:i,cursor:e.cursor,events:this.options.removeVertexOn,ignoreCollision:e.ignoreCollision});return r.setContainerPoint(t),r},n.createHandle=function(t,e){e||(e={});var n=this._createHandleInstance(t,e);return n.paramOptions=e,n.on("dragstart",rf),n.on("dragging",of),n.on("dragend",sf),e.onRefresh&&(n.refresh=e.onRefresh),n},n._createResizeHandles=function(t,e,n){var i=this,r=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],o=[null,"y",null,"x","x",null,"y",null],s=this._geometry,a=s instanceof Bl,h=[];t||(t=[]);var l=this,u=[],c={},A=this.getMap(),f=this.options.vertexHandleSymbol,d=function(){for(var d=function(){if(a){var t=s.getContainerExtent();return[new ht(t.xmin,t.ymin),new ht((t.xmax+t.xmin)/2,t.ymin),new ht(t.xmax,t.ymin),new ht(t.xmin,(t.ymin+t.ymax)/2),new ht(t.xmax,(t.ymin+t.ymax)/2),new ht(t.xmin,t.ymax),new ht((t.xmax+t.xmin)/2,t.ymax),new ht(t.xmax,t.ymax)]}var e=s.getShell(),n=s._getEditCenter(),i=Ti();Ei(e,i);var r=new fs(i[0],i[1],i[2],i[3]);return(h=[new $o(r.xmin,r.ymax),new $o((r.xmax+r.xmin)/2,r.ymax),new $o(r.xmax,r.ymax),new $o(r.xmin,(r.ymax+r.ymin)/2),new $o(r.xmax,(r.ymax+r.ymin)/2),new $o(r.xmin,r.ymin),new $o((r.xmax+r.xmin)/2,r.ymin),new $o(r.xmax,r.ymin)]).map((function(t){return t.z=n.z,ef(A,t)}))}(),p=function(a){if(Array.isArray(t)&&t.some((function(t){return t===a})))return 1;var A,p=d[a],g=h[a];if(u.length<d.length-t.length){var m=i.createHandle(p,{symbol:f,cursor:r[a],axis:o[a],onMove:(A=a,function(t){l._updating=!0,e(t.containerPoint,A),s.fire("resizing")}),onUp:function(){l._updating=!1,n()}});c[a]=u.length,u.push(m),m.coord=g}else u[c[a]].coord=g,u[c[a]].setContainerPoint(p)},g=0;g<d.length;g++)p(g)};return d(),this._addRefreshHook(d),u},n.createMarkerEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();if(e._canEdit()){this._history||this._recordHistory(d());var i=e._getInternalSymbol(),r=new ht(0,0);h(i.markerDx)&&(r.x=i.markerDx),h(i.markerDy)&&(r.y=i.markerDy);var o=null,s="middle",a="middle";if(_h.test(i)){var l=i.markerType;"pin"===l||"pie"===l||"bar"===l?(o=[5,6,7],s="bottom"):"rectangle"===l&&(o=[0,1,2,3,5],s="top",a="left")}else(sh.test(i)||xh.test(i))&&(s="bottom",o=[5,6,7]);var u,c=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var A=e.getSize();u=A.width/A.height}var f=this._createResizeHandles(o,(function(i,h){if(o&&o.indexOf(h)>=0){var l=n.containerPointToCoordinate(i.sub(r)),A=e.getCoordinates();l.x=A.x,e.setCoordinates(l),t._updateCoordFromShadow(!0),i=f[f.length-1-h].getContainerPoint()}var d=ef(n,e._getEditCenter()).add(r),p=e._getInternalSymbol(),g=i.sub(d);"bottom"===s&&i.y>d.y&&(g.y=0);var m="middle"===s?2:1,y="left"===a?1:2,v=Math.abs(g.x)*y,_=Math.abs(g.y)*m;u&&(_=(v=Math.max(v,_*u))/u);var x=c[h];e instanceof fu?((u||0===x||2===x)&&(e.setWidth(v),e!==t._geometry&&t._geometry.setWidth(v)),(u||1===x||2===x)&&(e.setHeight(_),e!==t._geometry&&t._geometry.setHeight(_))):((u||0===x||2===x)&&(p.markerWidth=Math.min(v,t._geometry.options.maxMarkerWidth||1/0)),(u||1===x||2===x)&&(p.markerHeight=Math.min(_,t._geometry.options.maxMarkerHeight||1/0)),e.setSymbol(p),e!==t._geometry&&t._geometry.setSymbol(p))}),(function(){t._update(d())}))}else console&&console.warn("A marker can't be resized with symbol:",e.getSymbol());function d(){var t=[["setCoordinates",e.getCoordinates().toArray()]];return e instanceof fu?(t.push(["setWidth",e.getWidth()]),t.push(["setHeight",e.getHeight()])):t.push(["setSymbol",e.getSymbol()]),t}},n.createCircleEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();this._history||this._recordHistory([["setCoordinates",e.getCoordinates().toArray()],["setRadius",e.getRadius()]]),this._createResizeHandles(null,(function(i){var r=e.getCenter(),o=nf(e,r,i),s=new jl([[r.x,r.y],[o.x,r.y]]),a=new jl([[r.x,r.y],[r.x,o.y]]),h=Math.max(n.computeGeometryLength(s),n.computeGeometryLength(a));e.setRadius(h),e!==t._geometry&&t._geometry.setRadius(h)}),(function(){t._update("setRadius",e.getRadius())}))},n.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],n=this._shadow||this._geometry;this._history||this._recordHistory(a());var i,r=this.getMap(),o=this._geometry instanceof ru;this.options.fixAspectRatio&&(i=n.getWidth()/n.getHeight());var s=this._createResizeHandles(null,(function(a,h){var l,u,c,A=o?1:2,f=s[h].getContainerPoint(),d=e[h];if(o){var p=s[7-h],g=p.getContainerPoint(),m=(l=f.sub(g)).abs();u=r.pixelToDistance(m.x,0),c=r.pixelToDistance(0,m.y);var y=n.getSize(),v=n.getCoordinates(),_=n.getWidth(),x=n.getHeight(),b=p.coord,w=nf(n,v,a),C=new jl([[b.x,b.y],[w.x,b.y]]),P=new jl([[b.x,b.y],[b.x,w.y]]);if(u=r.computeGeometryLength(C),c=r.computeGeometryLength(P),0===d)if(i&&(m.y=m.x/i,y.height=Math.abs(m.y),c=u/i),f.y=g.y-y.height/2,w.y=v.y,4===h)w.x=Math.min(w.x,v.x);else{var M=r.locate(v,_,0);w.x=r.locate(new $o(M.x,w.y),-u,0).x}else if(1===d)i&&(m.x=m.y*i,y.width=Math.abs(m.x),u=c*i),f.x=g.x-y.width/2,w.x=v.x,w.y=Math.max(w.y,b.y);else{if(i&&(u>c*i?(c=u/i,f.y=g.y+m.x*vt(l.y)/i):(u=c*i,f.x=g.x+m.y*vt(l.x)*i)),0===h||5===h){var T=r.locate(v,_,0===h?0:-x);w.x=r.locate(new $o(T.x,w.y),-u,0).x}else w.x=Math.min(w.x,b.x);w.y=Math.max(w.y,b.y)}w.z=v.z,n.setCoordinates(w),t._updateCoordFromShadow(!0)}else{var S=n.getCenter(),I=nf(n,S,a),E=new jl([[S.x,S.y],[I.x,S.y]]),O=new jl([[S.x,S.y],[S.x,I.y]]);u=r.computeGeometryLength(E),c=r.computeGeometryLength(O),i&&(c=(u=Math.max(u,c*i))/i)}(i||0===d||2===d)&&(n.setWidth(u*A),n!==t._geometry&&t._geometry.setWidth(u*A)),(i||1===d||2===d)&&(n.setHeight(c*A),n!==t._geometry&&t._geometry.setHeight(c*A))}),(function(){t._update(a())}));function a(){return[["setCoordinates",n.getCoordinates().toArray()],["setWidth",n.getWidth()],["setHeight",n.getHeight()]]}},n.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow||this._geometry,n=this;this._history||this._recordHistory("setCoordinates",$o.toNumberArrays(e.getCoordinates()));var i=e instanceof Fl?3:2,r="maptalks--editor-vertex-index",{vertexZIndex:o,newVertexZIndex:s}=this.options,a={0:[]},l={0:[]};function u(t,n){if(e instanceof Fl){var i=e.getCoordinates();i[n]=t,e.setCoordinates(i)}else e.setCoordinates(t)}function c(t=0){if(e instanceof Fl){var n=e.getCoordinates()[t]||[];return n.slice(0,n.length-1)}return e.getCoordinates()}function f(){for(var t in a){for(var e=a[t].length-1;e>=0;e--)a[t][e][r]=e;for(var i=l[t].length-1;i>=0;i--)l[t][i][r]=i}n._updateCoordFromShadow()}function d(o){n._updating=!0;var s=o.target,A=s[r],d=h(s._ringIndex)?s._ringIndex:0,p=c(d);if(p.length<=i)console.warn(" Geometry."+e.type+" Require at least "+i+" vertices,Geometry: ",e);else{if(p.splice(A,1),u(p,d),0===A)l[d][0].delete(),l[d].splice(0,1);else if(A===a[d].length-1){var g=l[d].length;l[d][g-1].delete(),l[d].splice(g-1,1)}else l[d][A-1].delete(),l[d].splice(A-1,1),l[d][A-1].delete(),l[d].splice(A-1,1),l[d].splice(A-1,0,_.call(n,A-1,d));if(a[d].splice(A,1)[0].delete(),d>0){var m=e.getCoordinates(),y=m[d];y&&Array.isArray(y)&&y.length>1&&e!==this._geometry&&e.setCoordinates(m)}f(),n._updating=!1,n._geometry.fire("handleremove",Object.assign({},o,{coordinate:t.containerPointToCoordinate(o.containerPoint),vertex:o.target}))}}function p(t,i,r=0){var o=n._geometry.snapTo;o&&A(o)&&(t=n._geometry.snapTo(t)||t);var s,a=c(r),h=t.sub(m()),u=nf(n._geometry,a[i],h),f=a[i];f.x=u.x,f.y=u.y,e.setCoordinates(e.getCoordinates()),n._updateCoordFromShadow(!0),s=0===i?l[r].length-1:i-1,l[r][i]&&l[r][i].refresh(),l[r][s]&&l[r][s].refresh()}var g=new ht(0,0);function m(){var t=e._getCompiledSymbol();return g.x=t.lineDx||0,g.y=t.lineDy||0,g}function y(e,i=0,s){var a=(s||c(i))[e],h=ef(t,a)._add(m()),l=n.createHandle(h,{symbol:n.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){p(l.getContainerPoint(),l[r],i)},onRefresh:function(e,n){if(a=(n||c(i))[l[r]]){var o=ef(t,a);l.setContainerPoint(o._add(m()))}},onUp:function(){n._updateCoordFromShadow()},onDown:function(t,e){}});return l[r]=e,l._ringIndex=i,l.on(n.options.removeVertexOn,d),l.setZIndex(o),l}var v=!1;function _(e,i=0,o){var h=o||c(i),A=h[e].add(e+1>=h.length?h[0]:h[e+1]).multi(.5),d=n.createHandle(A,{symbol:n.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(t,e){if(!e||!e.domEvent||2!==e.domEvent.button){var o=c(i),s=d[r],a=o[s].add(o[s+1]||o[0]).multi(.5);o.splice(s+1,0,a),u(o,i),d.opacity=1,l[i].splice(s,0,_.call(n,s,i),_.call(n,s+1,i)),v=!0}},onMove:function(){p(d.getContainerPoint(),d[r]+1,i)},onUp:function(t){if(t&&t.domEvent&&2===t.domEvent.button)v=!1;else{var e=d[r];gt(d,l[i]),d.delete(),a[i].splice(e,0,y.call(n,e,i)),f(),n._updateCoordFromShadow(),v=!1}},onRefresh:function(e,n){h=n||c(e);var i,o=d[r];if(i=o===h.length-1?0:o+1,h[o]&&h[i]){var s=h[o].add(h[i]).multi(.5),a=ef(t,s);d.setContainerPoint(a._add(m()))}}});return d[r]=e,d.setZIndex(s),d}if(e instanceof Fl)for(var x=e.getHoles().length+1,b=0;b<x;b++){a[b]=[],l[b]=[];for(var w=c(b),C=0,P=w.length;C<P;C++)a[b].push(y.call(this,C,b,w)),C<P-1&&l[b].push(_.call(this,C,b,w));l[b].push(_.call(this,w.length-1,b,w))}else{for(var M=c(0),T=0,S=M.length;T<S;T++)a[0].push(y.call(this,T,0,M)),T<S-1&&l[0].push(_.call(this,T,0,M));l[0].length&&2===e.getCoordinates().length&&(l[0][0].options.symbol.markerDx=12)}var I=t.getRenderer();I&&I.sortTopElements(),this._addRefreshHook((function(){if(!v){for(var t in l)for(var n=c(t),i=l[t].length-1;i>=0;i--)l[t][i].refresh(t,n);for(var r in l[0].length&&e instanceof jl&&(2===e.getCoordinates().length?l[0][0].options.symbol.markerDx=12:e.getCoordinates().length>2&&(l[0][0].options.symbol.markerDx=0)),a)for(var o=c(r),s=a[r].length-1;s>=0;s--)a[r][s].refresh(r,o)}}))},n._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},n._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},n._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},n._update=function(t,...e){this._exeHistory([t,e]),this._recordHistory(t,...e)},n._updateCoordFromShadow=function(t){var e=(this._shadow||this._geometry).getCoordinates(),n=this._geometry,i=this._updating;this._updating=!0,n.setCoordinates(e),t||this._recordHistory("setCoordinates",$o.toNumberArrays(n.getCoordinates())),this._updating=i},n._recordHistory=function(t,...e){if(this._history||(this._history=[],this._historyPointer=0),this._history.length){var n=this._history[this._history.length-1];if(n[0]===t&&JSON.stringify(n[1])===JSON.stringify(e))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([t,e]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},n.cancel=function(){return this._history&&0!==this._historyPointer?(this._historyPointer=0,this._exeAndReset(this._history[0]),this):this},n.undo=function(){if(!this._history||0===this._historyPointer)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},n.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},n._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,n=this._historyPointer;this.stop(),this._history=e,this._historyPointer=n,this.start()}},n._onDragStart=function(){this._updating=!0},n._onDragEnd=function(){this._updating=!1},n._exeHistory=function(t){if(Array.isArray(t)){var e=this._updating;this._updating=!0;var n=this._shadow||this._geometry,i=this._geometry;Array.isArray(t[0])?t[0].forEach((function(t){var e=t[0],r=t.slice(1);n[e].call(n,...r),n!==i&&i[e].call(i,...r)})):(n[t[0]].call(n,...t[1]),n!==i&&i[t[0]].call(i,...t[1])),this._updating=e}},e}(Do(Lo));hf.mergeOptions(af),Au.include({startEditText:function(){return this.getMap()?(this._recordVisible(),this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=t;var e=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(e),We(this._textEditor,"mousedown dblclick",Ee),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this._recoveryVisible(),this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),e=this._createEditor();this._textEditor=e,t.on("mousedown",this.endEditText,this);var n=this._getEditorOffset();this._editUIMarker=new fc(this.getCoordinates(),{animation:null,content:e,dx:n.dx,dy:n.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},e=0,n=0,i=t.textHorizontalAlignment;return"middle"===i||a(i)?(e=(t.textDx||0)-2,n=(t.textDy||0)-2):(e=(t.markerDx||0)-2,n=(t.markerDy||0)-2),{dx:e,dy:n}},_createEditor:function(){var t=this.getContent(),e=this.getSize(),n=this._getInternalSymbol()||{},i=e.width,r=n.textFill||"#000000",o=n.textSize||12,s=e.height,a=n.markerLineColor||"#000",h=n.markerFill||"#3398CC",l=n.textLineSpacing||0,u=we("div");return u.contentEditable=!0,u.style.cssText="background:"+h+"; border:1px solid "+a+";\n            color:"+r+";font-size:"+o+"px;width:"+(i-2)+"px;height:"+(s-2)+"px;margin: auto;\n            line-height:"+(o+l)+"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;",u.innerText=t,Ve(u,"mousedown dblclick",Ee),u.onkeyup=function(t){13===t.keyCode&&(u.style.height=parseInt(u.style.height||0)+o/2+"px")},u},_setCursorToLast:function(t){var e;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())}}),Kh.include({animate:function(t,e,n){var i=this;this._animPlayer&&this._animPlayer.finish(),A(e)&&(n=e),e||(e={});var r,o=this.getMap(),s=this._getProjection(),a=this._prepareAnimationStyles(t),h=e.focus;if(delete this._animationStarted,o){var l=o._getRenderer();e.framer=function(t){l.callInNextFrame(t)}}if(s||!h){var u=Sl.animate(a,e,(function(t){if(o&&o.isRemoved())u.finish();else{o&&!i._animationStarted&&h&&o.onMoveStart();var e=t.styles;for(var a in e)if("symbol"!==a&&"translate"!==a&&e.hasOwnProperty(a)){var l="set"+a[0].toUpperCase()+a.slice(1);i[l](e[a])}var c=e.translate;if(c){var A=c;r&&(A=c.sub(r)),r=c,i.translate(A)}var f=e.symbol;if(f){var d=i.getSymbol()||{};i.setSymbol(ti(d,f))}if(o&&h){var p=s.project(i.getCenter());o._setPrjCenter(p);var g=o._parseEventFromCoord(s.unproject(p));"running"!==u.playState?o.onMoveEnd(g):o.onMoving(g)}i._fireAnimateEvent(u.playState),n&&n(t)}}),this);return this._animPlayer=u,this._animPlayer.play()}console.error(Dl)},_prepareAnimationStyles:function(t){var e=this._getInternalSymbol(),n={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];if("translate"!==i&&"symbol"!==i){var o=this["get"+i[0].toUpperCase()+i.substring(1)]();n[i]=[o,r]}else if("symbol"===i){var s=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(e))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");s=[];for(var a=t.symbol,h=0;h<a.length;h++)if(a[h]){var l={};for(var u in a[h])a[h].hasOwnProperty(u)&&(l[u]=[e[h][u],a[h][u]]);s.push(l)}else s.push(null)}else{if(Array.isArray(e))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var c in s={},r)r.hasOwnProperty(c)&&(s[c]=[e[c],r[c]])}n.symbol=s}else"translate"===i&&(n.translate=new $o(r))}return n},_fireAnimateEvent:function(t){"finished"===t?(delete this._animationStarted,this._fireEvent("animateend")):"running"===t&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var lf=Gt+"_drag_stage",uf=Q.touch?"touchstart mousedown":"mousedown";function cf(t,e,n){var i=t._getEditCenter(),r=t.getMap();if(!i||0===i.z)return n||r.containerPointToCoord(e);var o=i.z,s=r.getGLRes(),a=r.coordToPointAtRes(i,s),h=r._pointAtResToContainerPoint(a,s,0),l=r._pointAtResToContainerPoint(a,s,o).sub(h),u=e.sub(l),c=r.containerPointToCoord(u);return c.z=0,!t.getGeometries&&t.isPoint&&(c.z=o),c}var Af=function(t){function e(e){return t.call(this,e)||this}K(e,t);var n=e.prototype;return n.addHooks=function(){this.target.on(uf,this._startDrag,this)},n.removeHooks=function(){this._endDrag(),this.target.off(uf,this._startDrag,this),delete this.container},n._prepareDragHandler=function(){this._dragHandler=new Ko(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},n._prepareShadow=function(){var t=this,e=this.target;if("canvas"===e.getLayer().options.renderer&&e.options.dragShadow){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var n=this._shadow=e.copy();if(n.getGeometries){var i=n.getGeometries(),r=e.getGeometries();i.forEach((function(e,n){t._updateShadowSymbol(e,r[n])}))}else this._updateShadowSymbol(n,e);n.setId(null),this._prepareShadowConnectors()}},n._updateShadowSymbol=function(t,e){if(t.setSymbol(e._getInternalSymbol()),e.options.dragShadow){var n=$n(t._getInternalSymbol(),.5);t.setSymbol(n)}},n._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,n=this._dragStageLayer._getRenderer().resources,i=[];if(mu._hasConnectors(t))for(var r=mu._getConnectors(t),o=0,s=r.length;o<s;o++){var a=r[o],h=a.config(),l=a._getInternalSymbol();h.symbol=$n(l,.5);var u=void 0;u=a.getConnectSource()===t?new a.constructor(e,a.getConnectTarget(),h):new a.constructor(a.getConnectSource(),e,h),i.push(u),a.getLayer()&&a.getLayer()._getRenderer()&&n.merge(a.getLayer()._getRenderer().resources)}this._shadowConnectors=i,i.push(e),this._dragStageLayer.bringToFront().addGeometry(i)},n._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},n._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer(lf),this._dragStageLayer||(this._dragStageLayer=new Cu(lf,{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var n=new fa;n.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=n},n._startDrag=function(t){var e=this.target.getMap();if(e&&!this.target._getParent()&&!this.isDragging()){var n=t.domEvent;if(!(n.touches&&n.touches.length>1||2===n.button)){this.container=e.getPanels().mapWrapper||e.getContainer(),this.target.on("click",this._endDrag,this);var i=this._correctCoord(t.coordinate);this._lastCoord=cf(this.target,t.containerPoint,i),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),Ve(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1}}},n._dragging=function(t){var e=this.target,n=e.getMap();if(!n._isEventOutMap(t.domEvent)){var i=n._parseEvent(t.domEvent),r=i.domEvent;if(!(r.touches&&r.touches.length>1||n._isContainerPointOutOfMap(i.containerPoint))){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",i)),this.target._fireEvent("dragstart",this._startParam||i),void delete this._startParam;var o=this._shadow||e,s=o.options.dragOnAxis,a=o.options.dragOnScreenAxis,h=i.containerPoint,l=i.coordinate;this._lastPoint=this._lastPoint||h,this._lastCoord=this._lastCoord||l,a?("x"===s?h.y=this._lastPoint.y:"y"===s&&(h.x=this._lastPoint.x),l=n.containerPointToCoord(h)):l=this._correctCoord(l),l=cf(e,i.containerPoint,l);var u=h.sub(this._lastPoint),c=l.sub(this._lastCoord);a||("x"===s?u.y=c.y=0:"y"===s&&(u.x=c.x=0)),this._lastPoint=h,this._lastCoord=l;var A=!o.getGeometries&&o.isPoint;A?o.setCoordinates(l):o.translate(c),o===e||e.options.dragShadow||(A?e.setCoordinates(l):e.translate(c)),i.coordOffset=c,i.pointOffset=u,o._fireEvent("dragging",i),o!==e&&e._fireEvent("dragging",i)}}},n._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&We(this.container,"mouseleave",this._endDrag),this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var n=e.getMap();if(this.enabled()&&n){var i=n._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(i),this._moved&&e._fireEvent("dragend",i)}}},n.isDragging=function(){return!!this._isDragging},n._updateTargetAndRemoveShadow=function(t){if(this._shadow){var e=this.target,n=e.getMap();e.options.dragShadow||e.show();var i=this._shadow;if(i){if(e.options.dragShadow){var r=i.getFirstCoordinate(),o=e.getFirstCoordinate(),s=r.sub(o);e.translate(s)}i._fireEvent("dragend",t),i.remove(),delete this._shadow}this._shadowConnectors&&(n.getLayer(lf).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new fa,this._dragStageLayer.remove())}},n._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var n=this.target;if(!n.getMinAltitude())return t;var i=(n.getMinAltitude()+n.getMaxAltitude())/2;return e.locateByPoint(t,0,-i)},e}(ko);Kh.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1}),Kh.addInitHook("addHandler","draggable",Af),Kh.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),Kh.include({startEdit:function(t){var e=this.getMap();return e&&this.options.editable?(this._editor&&this.endEdit(),this._recordVisible(),this._editor=new hf(this,t),this._editor.start(),this._getParent()||this.fire("editstart"),e.getRenderer().setToRedraw(),this):this},endEdit:function(){if(this._editor){this._editor.stop(),delete this._editor,this._recoveryVisible(),this._getParent()||this.fire("editend");var t=this.getMap();t&&t.getRenderer().setToRedraw()}return this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._recoveryVisible(),this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),Kh.include({_onEvent:function(t,e){var n=this.getMap();if(n){var i=e||this._getEventTypeToFire(t);"contextmenu"===i&&this.listens("contextmenu")&&(Ee(t),Ie(t));var r=n._getEventParams(t);h(this._pickGeometryIndex)&&(r.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(i,r)}},_getEventTypeToFire:function(t){return t.type}}),Kh.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof vc?(this._infoWindow=t,this._infoWinOptions=s({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=s({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()?(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(t)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var t=this._infoWinOptions;return t?(this._infoWindow=new vc(t),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}}),Kh.fromJSON=function(t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var r=Kh.fromJSON(t[n]);Array.isArray(t)?e=e.concat(r):e.push(r)}return e}return t&&!t.feature?tu.toGeometry(t):(t.subType?(o=Kh.getJSONClass(t.subType).fromJSON(t),a(t.feature.id)||o.setId(t.feature.id)):(o=tu.toGeometry(t.feature),t.options&&o.config(t.options)),t.symbol&&o.setSymbol(t.symbol),t.infoWindow&&o.setInfoWindow(t.infoWindow),o);var o};var ff=new ht(0,0),df=new ht(0,0),pf=new ht(0,0),gf=new ht(0,0),mf=[],yf=function(t){function e(){return t.call(this,or)||this}K(e,t);var n=e.prototype;return n.checkUrl=function(t){return t&&c(t)?Ht(t):t},n.fetchImage=function(t,e,n,i){t=this.checkUrl(t),this.send({url:t,fetchOptions:i},mf,n,e)},e}(aa),vf=function(t){function e(e){var n;(n=t.call(this,e)||this).tilesInView={},n.tilesLoading={},n._parentTiles=[],n._childTiles=[],n._tileQueue=[],n._tileQueueIds=new Set;var i=e.getTileSize().width;return n.tileCache=new zr(e.options.maxCacheSize*i/512*i/512,(function(t){n.deleteTile(t)})),Q.decodeImageInWorker&&n.layer.options.decodeImageInWorker&&("gl"===e.options.renderer||!Q.safari&&!Q.iosWeixin)&&(n._tileImageWorkerConn=new yf),n._compareTiles=xf.bind(n),n}K(e,t);var n=e.prototype;return n.getCurrentTileZoom=function(){return this._tileZoom},n.draw=function(t,e){var n=this.getMap();if(this.isDrawable()){var i=this.prepareCanvas();if(!i||i.intersects(this.canvasExtent2D)){var r;this._renderTimestamp!==t&&(this._consumeTileQueue(),this._computeAvgTileAltitude(),this._renderTimestamp=t);var o=!1,s=this._frameTiles;if(s&&t===s.timestamp){if(s.empty)return;r=s}else{if(!(r=this._getTilesInCurrentFrame()))return this._frameTiles={empty:!0,timestamp:t},void this.completeRender();o=!0,this._frameTiles=r,this._frameTiles.timestamp=t,r.loadingCount&&this.loadTileQueue(r.tileQueue)}var{tiles:a,childTiles:h,parentTiles:l,placeholders:u,loading:c,loadingCount:A,missedTiles:f,incompleteTiles:d}=r;this._drawTiles(a,l,h,u,e,f,d),A||c||(n.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),o&&this.retireTiles()}else this.completeRender()}},n.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},n.getCurrentTimestamp=function(){return this._renderTimestamp||0},n._getTilesInCurrentFrame=function(){var t=this.getMap(),e=this.layer,n=e._isPyramidMode()&&e.options.terrainTileMode,i=e.getTiles();if(this._frameTileGrids=i,!(i=i.tileGrids)||!i.length)return null;var r=i.reduce((function(t,e){return t+(e&&e.tiles&&e.tiles.length||0)}),0);r>=this.tileCache.max/2&&this.tileCache.setMaxSize(2*r+1);var o=0,s=!1,a={},h=[],l=[],u={},c=[],A={},f=[],d={},p={},g=this.markTiles(),m=this._getLoadLimit(),y=i.length,v=void 0===this._tileZoom&&e.options.currentTilesFirst&&!this._terrainHelper;this._tileZoom=i[0].zoom;var _=null,x=null;n&&(_=[],x=new Map);for(var b=0;b<y;b++){var w=i[b],C=w.tiles,P=w.parents||mf,M=P.length,T=v?C:P.concat(C),S=void 0;T.length&&(S=this._generatePlaceHolder(T[0].res));for(var I=0,E=T.length;I<E;I++){var O=T[I],R=O.id,D=!v&&I<M,k=!1,L=h.length;if(this._isLoadingTile(R))k=s=!0,this.markCurrent(this.tilesLoading[R],!0);else{var F=this.getCachedTile(O,D);if(F)D||(F.image&&this.isTileFadingIn(F.image)&&(k=s=!0,this.setToRedraw()),this.isTileComplete(F)?h.push(F):(k=!0,n&&x.set(R,F)));else{k=s=!0;var N=m&&o+g[0]>m;this._tileQueueIds.has(O.id)||N||t.isInteracting()&&!t.isMoving()&&!t.isRotating()||(o++,p[R]=O)}}if(n&&!D&&(h.length===L?_.push(O):a[O.id]=1),!n&&!D&&k&&!a[R]){a[R]=1,S&&!d[R]&&(O.cache=!1,f.push({image:S,info:O}),d[R]=1);var z=this._findChildTiles(O);if(z.length&&z.forEach((function(t){A[t.info.id]||(c.push(t),A[t.info.id]=1)})),!z.length||4!==z.length){var B=this._findParentTile(O);if(B){var H=B.info.id;void 0===u[H]&&(u[H]=l.length,l.push(B))}}}}}var j=[];if(n)for(var U=0;U<_.length;U++){var G=_[U].info?_[U].info:_[U];if(G.parent&&!a[G.id]){var{tiles:V,missedTiles:W}=this._findChildTiles(G);V.length?(pt(h,V),pt(j,W)):x.has(G.id)?(h.push(x.get(G.id)),x.delete(G.id)):(a[G.id]=1,j.push(G))}}return this.tileCache.shrink(),{childTiles:c,missedTiles:j,parentTiles:l,tiles:h,incompleteTiles:x&&Array.from(x.values()),placeholders:f,loading:s,loadingCount:o,tileQueue:p}},n.removeTileCache=function(t){delete this.tilesInView[t],this.tileCache.remove(t)},n.isTileCachedOrLoading=function(t){return this.tileCache.get(t)||this.tilesInView[t]||this.tilesLoading[t]},n.isTileCached=function(t){return!(!this.tileCache.get(t)&&!this.tilesInView[t])},n.isTileFadingIn=function(t){return this._getTileFadingOpacity(t)<1},n._drawTiles=function(t,e,n,i,r,o,s){var a=this;e.length&&(e.sort(this._compareTiles),this._parentTiles=e),n.length&&(this._childTiles=n,this._childTiles.sort(this._compareTiles));var h=!0;this.layer.constructor!==lA&&this.layer.constructor!==yA||(this._renderTimestamp===this.canvas._parentTileTimestamp?h=!1:this.canvas._parentTileTimestamp=this._renderTimestamp);var l="gl"===this.layer.options.renderer&&(!this.isGL||this.isGL()),u={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:r};if(this.onDrawTileStart(u,r),h&&1===this.layer.options.opacity){this.layer._silentConfig=!0;var c=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,l?(this._drawChildTiles(n,r),this._drawParentTiles(this._parentTiles,r)):(this._drawParentTiles(this._parentTiles,r),this._drawChildTiles(n,r)),this.layer.options.fadeAnimation=c,this.layer._silentConfig=!1}this.drawingCurrentTiles=!0,t.sort(this._compareTiles);for(var A=0,f=t.length;A<f;A++)this._drawTileAndCache(t[A],r);if(delete this.drawingCurrentTiles,h&&this.layer.options.opacity<1){this.layer._silentConfig=!0;var d=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,l?(this._drawChildTiles(n,r),this._drawParentTiles(this._parentTiles,r)):(this._drawParentTiles(this._parentTiles,r),this._drawChildTiles(n,r)),this.layer.options.fadeAnimation=d,this.layer._silentConfig=!1}i.forEach((function(t){return a._drawTile(t.info,t.image,r)})),this.onDrawTileEnd(u,r)},n._drawChildTiles=function(t,e){var n=this;this.drawingChildTiles=!0,t.forEach((function(t){return n._drawTile(t.info,t.image,e)})),delete this.drawingChildTiles},n._drawParentTiles=function(t,e){var n=this;this.drawingParentTiles=!0,this._parentTiles.forEach((function(t){return n._drawTile(t.info,t.image,e)})),delete this.drawingParentTiles},n.onDrawTileStart=function(t,e){},n.onDrawTileEnd=function(t,e){},n._drawTile=function(t,e,n){e&&this.drawTile(t,e,n)},n._drawTileAndCache=function(t,e){this.isValidCachedTile(t)&&(this.tilesInView[t.info.id]=t),this._drawTile(t.info,t.image,e)},n.drawOnInteracting=function(t,e,n){this.draw(e,n)},n.needToRedraw=function(){var e=this.getMap();return!!this._tileQueue.length||(e.getPitch()?t.prototype.needToRedraw.call(this):!(!e.isRotating()&&!e.isZooming())||(e.isMoving()?!!this.layer.options.forceRenderOnMoving:t.prototype.needToRedraw.call(this)))},n.hitDetect=function(){return!1},n._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit||0},n.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},n.clear=function(){this.retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._tileQueue=[],this._tileQueueIds.clear(),this._parentTiles=[],this._childTiles=[],t.prototype.clear.call(this)},n._isLoadingTile=function(t){return!!this.tilesLoading[t]},n.clipCanvas=function(e){return t.prototype.clipCanvas.call(this,e)},n._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var n=e.getContainerExtent(),i=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(n.ymin)*i,Math.ceil(n.getWidth())*i,Math.ceil(n.getHeight())*i),t.stroke(),t.clip(),!0},n.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e],i=this.loadTile(n);void 0===i.loadTime&&(this.tilesLoading[n.id]={image:i,current:!0,info:n})}},n.loadTile=function(t){var e=this,n={};if(this.loadTileBitmap)this.loadTileBitmap(t.url,t,(function(n){e.onTileLoad(n,t)}),(function(n,i){e.onTileError(i,t,n)}));else if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)this._fetchImage(n,t);else{var i=this.layer.getTileSize(t.layer);(n=new Image).width=i.width,n.height=i.height,n.onload=this.onTileLoad.bind(this,n,t),n.onerror=this.onTileError.bind(this,n,t),this.loadTileImage(n,t.url)}return n},n._fetchImage=function(t,e){var n=this;if(t instanceof Image)t.src=e.url;else{var{x:i,y:r}=e,o=Math.abs(i+r)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(e.url,o,(function(i,r){i?n.onTileError(t,e,i):Bt(r,(function(t){n.onTileLoad(t,e)}))}),this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},n.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;return a(n)||(t.crossOrigin=n),ut(t,[e])},n.abortTileLoading=function(t,e){e&&void 0!==e.id&&this.removeTileLoading(e),t&&t instanceof Image&&(t.onload=_f,t.onerror=_f,t.src=kt)},n.onTileLoad=function(t,e){this.removeTileLoading(e),this._tileQueue.push({tileInfo:e,tileData:t}),this._tileQueueIds.add(e.id),this.setToRedraw()},n.removeTileLoading=function(t){delete this.tilesLoading[t.id],this.setToRedraw()},n._consumeTileQueue=function(){for(var t=0,e=this.layer.options.tileLimitPerFrame,n=this._tileQueue;n.length&&(e<=0||t<e);){var{tileData:i,tileInfo:r}=n.shift();this._tileQueueIds.has(r.id)&&(this._tileQueueIds.delete(r.id),this.checkTileInQueue(i,r)&&(this.consumeTile(i,r),t++))}},n._computeAvgTileAltitude=function(){var t=0,e=0,n=0;for(var i in this.tilesInView){var r=this.tilesInView[i]&&this.tilesInView[i].info;r&&(t+=r.minAltitude||0,e+=r.maxAltitude||0,n++)}this.avgMinAltitude=t/n,this.avgMaxAltitude=e/n},n.checkTileInQueue=function(t,e){return!0},n.consumeTile=function(t,e){if(this.layer&&this.tilesInView){var n={tile:e,tileImage:t};this.resetTileLoadTime(t=n.tileImage),this.removeTileLoading(e),this._addTileToCache(e,t),this.layer.fire("tileload",n),this.setToRedraw()}},n.resetTileLoadTime=function(t){0!==t.loadTime&&(t.loadTime=o())},n.onTileError=function(t,e,n){if(this.layer){var i=this.layer.options.reloadErrorTileFunction;if(i)i.call(this,this.layer,this,e,t);else{var r=this.layer.options.errorUrl;if(r){if(t instanceof Image&&t.src!==r)return t.src=r,void this.removeTileLoading(e);(t=new Image).src=r}this.abortTileLoading(t,e),t.loadTime=0,this.removeTileLoading(e),this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}}},n.drawTile=function(t,e,n){if(e&&this.getMap()){var{extent2d:i,offset:r}=t,o=ff.set(i.xmin-r[0],i.ymax-r[1]),s=t.z,a=t.id,h=this.getMap(),l=h.getZoom(),u=this.context,c=h._pointAtResToContainerPoint(o,t.res,0,df),A=h.getBearing(),f=A||l!==s,d=this.getTileOpacity(e,t),p=u.globalAlpha;d<1&&(u.globalAlpha=d),f||c._round();var g=c.x,m=c.y,y=t.extent2d.xmax-t.extent2d.xmin,v=t.extent2d.ymax-t.extent2d.ymin,_=this.layer,x=_?_.options.bufferPixel:0;if(f){u.save(),u.translate(g,m),A&&u.rotate(-A*Math.PI/180),y+=x,v+=x;var b=h._getResolution();if(b!==t.res){var w=t.res/b;u.scale(w,w)}g=m=0}if(Mo.image(u,e,g,m,y,v),this.layer.options.debug){var C=this.layer.options.debugOutline;u.save(),u.strokeStyle=C,u.fillStyle=C,u.font="20px monospace";var P=new ht(g,m);Mo.rectangle(u,P,{width:y,height:v},1,0),Mo.fillText(u,this.getDebugInfo(a),P._add(32,v-14),C),Mo.drawCross(u,g+y/2,m+v/2,2,C),u.restore()}f&&u.restore(),u.globalAlpha!==p&&(u.globalAlpha=p),this.setCanvasUpdated()}},n.getDebugInfo=function(t){var e=t.split("_"),n=e.length;return e[n-3]+"/"+e[n-2]+"/"+e[n-1]},n.findChildTiles=function(t){return this._findChildTiles(t)},n._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer),n=e&&e.options.terrainTileMode&&e._isPyramidMode();if(!e||!e.options.background&&!n||t.z>this.layer.getMaxZoom())return mf;var i=this.getMap(),r=[];if(e._isPyramidMode()){if(!n){for(var o=this._getLayerOfTile(t.layer),s=2*t.x,a=2*t.y,h=t.z+1,l=[],u=0;u<2;u++)for(var c=0;c<2;c++)l.push(s+u,a+c,h);for(;l.length;){var A=l.pop(),f=l.pop(),d=l.pop(),p=o._getTileId(d,f,A,t.layer),g=A+1<=t.z+2,m=this.tileCache.getAndRemove(p);if(m){if(this.isValidCachedTile(m))r.push(m),this.tileCache.add(p,m);else if(g)for(var y=0;y<2;y++)for(var v=0;v<2;v++)l.push(2*d+y,2*f+v,A+1)}else if(g)for(var _=0;_<2;_++)for(var x=0;x<2;x++)l.push(2*d+_,2*f+x,A+1)}return r}var b;n&&(b=[]);for(var w=2*t.x,C=2*t.y,P=t.z+1,M=[],T=0;T<2;T++)for(var S=0;S<2;S++){var I=e._getTileId(w+T,C+S,P,t.layer),E=this.tileCache.getAndRemove(I);E&&this.isValidCachedTile(E)?(r.push(E),this.tileCache.add(I,E),M.push(null)):M.push(I)}if(r.length<4)for(var O=0,R=0;R<2;R++)for(var D=0;D<2;D++){var k=M[O++];if(k){for(var L=w+R,F=C+D,N=P,z=r.length,B=[],H=0;H<2;H++)for(var j=0;j<2;j++){var U=e._getTileId(2*L+H,2*F+j,N+1,t.layer),G=this.tileCache.getAndRemove(U);G&&this.isValidCachedTile(G)?(r.push(G),this.tileCache.add(U,G),B.push(null)):B.push(U)}if(n&&r.length-z<4){var V=e.tileInfoCache.get(k)||e._createChildNode(t,R,D,[0,0],k);if(r.length-z==0)b.push(V);else for(var W=0,q=0;q<2;q++)for(var Z=0;Z<2;Z++){var Q=B[W++];if(Q){var X=this.layer.tileInfoCache.get(Q)||e._createChildNode(V,q,Z,[0,0],Q);b.push(X)}}}}}return n?{tiles:r,missedTiles:b}:r}for(var Y=t.res,J=t.extent2d.getMin(),K=t.extent2d.getMax(),$=e._project(i._pointToPrjAtRes(J,Y,pf),pf),tt=e._project(i._pointToPrjAtRes(K,Y,gf),gf),et=1;et<1;et++)this._findChildTilesAt(r,$,tt,e,t.z+et);return r},n._findChildTilesAt=function(t,e,n,i,r){var o=i.getId(),s=i.getSpatialReference().getResolution(r);if(s)for(var a,h,l=i._getTileConfig().getTileIndex(e,s),u=i._getTileConfig().getTileIndex(n,s),c=Math.min(l.idx,u.idx),A=Math.max(l.idx,u.idx),f=Math.min(l.idy,u.idy),d=Math.max(l.idy,u.idy),p=c;p<A;p++)for(var g=f;g<d;g++)a=i._getTileId(p,g,r,o),(h=this.tileCache.getAndRemove(a))&&this.isValidCachedTile(h)&&(t.push(h),this.tileCache.add(a,h))},n.findParentTile=function(t,e){return this._findParentTile(t,e)},n._findParentTile=function(t,e){var n=this.getMap(),i=this._getLayerOfTile(t.layer);if(!i||!i.options.background&&!i.options.terrainTileMode)return null;var r=i.getMinZoom(),o=e||t.z-r;if(i._isPyramidMode()){for(var s=t.z-o,a=t.z-1;a>=s;a--){var h=Math.pow(2,t.z-a),l=Math.floor(t.x/h),u=Math.floor(t.y/h),c=void 0;c=a===t.z-1?t.parent:i._getTileId(l,u,a,t.layer);var A=this.tileCache.getAndRemove(c);if(A&&this.isValidCachedTile(A))return this.tileCache.add(c,A),A}return null}for(var f=i.getSpatialReference(),d=f.getZoomDirection(),p=t.res,g=t.extent2d.getCenter(),m=i._project(n._pointToPrjAtRes(g,p)),y=1;y<=o;y++){var v=t.z-d*y,_=f.getResolution(v);if(_){var x=i._getTileConfig().getTileIndex(m,_),b=i._getTileId(x.x,x.y,v,t.layer),w=this.tileCache.getAndRemove(b);if(w)return this.tileCache.add(b,w),w}}return null},n.isValidCachedTile=function(t){return!!t.image},n.isTileComplete=function(t){return!0},n._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},n.getCachedTile=function(t,e){var n=t.id,i=this.tilesInView,r=this.tileCache.getAndRemove(n);if(r){e||(i[n]=r);var o=this.tilesLoading;if(o&&o[n]){this.markCurrent(o[n],!1);var{image:s,info:a}=o[n];this.abortTileLoading(s,a),delete o[n]}}else r=i[n];return r&&(r.current=!0,this.isValidCachedTile(r)&&this.tileCache.add(n,r)),r},n._addTileToCache=function(t,e){this.isValidCachedTile({info:t,image:e})&&this.tileCache.add(t.id,{image:e,info:t})},n.getTileOpacity=function(t,e){var n=this._getTileFadingOpacity(t);if(this.layer.getChildLayer){var i=this.layer.getLayer(e.layer);i&&(n*=i.options.opacity)}return n},n._getTileFadingOpacity=function(t){return this.layer.options.fadeAnimation&&t.loadTime?Math.min(1,(o()-t.loadTime)/this.layer.options.fadeDuration):1},n.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,delete this._tileZoom,t.prototype.onRemove.call(this)},n.markCurrent=function(t,e){t.current=e},n.markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var n in this.tilesLoading)this.markCurrent(this.tilesLoading[n],!1),t++;if(this.tilesInView)for(var i in this.tilesInView)this.markCurrent(this.tilesInView[i],!1),e++;return[t,e]},n.retireTiles=function(t){for(var e in this.tilesLoading){var n=this.tilesLoading[e];!t&&n.current||(n.image&&this.abortTileLoading(n.image,n.info),this.deleteTile(n),this.removeTileLoading(n.info))}for(var i in this.tilesInView){var r=this.tilesInView[i];r.current||(delete this.tilesInView[i],this.tileCache.has(i)||this.deleteTile(r))}},n.deleteTile=function(t){if(t&&t.image){var e=t.info.id;this._tileQueueIds.has(e)&&this._tileQueueIds.delete(e),t.image.close&&t.image.close(),t.image instanceof Image&&(t.image.onload=null,t.image.onerror=null)}},n._generatePlaceHolder=function(t){var e=this.getMap(),n=this.layer.options.placeholder;if(!n||e.getPitch())return null;var i=this.layer.getTileSize(),r=t/e._getResolution(),o=this._tilePlaceHolder=this._tilePlaceHolder||Mo.createCanvas(1,1,e.CanvasClass);return o.width=i.width*r,o.height=i.height*r,A(n)?n(o):function(t){var e=t.getContext("2d"),n=t.width,i=t.height,r=n/16,o=i/16;e.beginPath();for(var s=0;s<16;s++)e.moveTo(0,s*o),e.lineTo(n,s*o),e.moveTo(s*r,0),e.lineTo(s*r,i);e.strokeStyle="rgba(180, 180, 180, 0.1)",e.lineWidth=1,e.stroke(),e.beginPath();for(var a=[[0,0],[n,0],[0,i],[n,i],[0,0],[0,i],[n,0],[n,i],[0,i/2],[n,i/2],[n/2,0],[n/2,i]],h=1;h<a.length;h+=2)e.moveTo(a[h-1][0],a[h-1][1]),e.lineTo(a[h][0],a[h][1]);e.lineWidth=4,e.stroke()}(o),o},n.setTerrainHelper=function(t){this._terrainHelper=t},e}(Aa);function _f(){return!1}function xf(t,e){return Math.abs(this._tileZoom-t.info.z)-Math.abs(this._tileZoom-e.info.z)}lA.registerRenderer("canvas",vf);var bf=new ht(0,0),wf={properties:{}},Cf=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.isDrawable=function(){return!0},n.needToRedraw=function(){var e=this.getMap();return!(!this.isGL()||e.getPitch()||!e.isZooming()||e.isMoving()||e.isRotating())||t.prototype.needToRedraw.call(this)},n.onDrawTileStart=function(t,e){var n=this.gl;if(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.enable(n.POLYGON_OFFSET_FILL),n.enable(n.STENCIL_TEST),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE),n.depthMask(!!this.layer.options.depthMask),e&&e.renderTarget){var i=e.renderTarget.fbo;if(i){var r=e.renderTarget.getFramebuffer(i);n.bindFramebuffer(n.FRAMEBUFFER,r)}}},n.onDrawTileEnd=function(t,e){var n=this.gl;e&&e.renderTarget&&e.renderTarget.fbo&&n.bindFramebuffer(n.FRAMEBUFFER,null)},n.drawTile=function(e,n,i){if(!i||!i.sceneFilter||i.sceneFilter(wf)){var r=this.getMap();if(e&&r&&n){var o=e._glScale=e._glScale||e.res/r.getGLRes(),s=e.extent2d.xmax-e.extent2d.xmin,a=e.extent2d.ymax-e.extent2d.ymin;if(!1!==e.cache&&this._bindGLBuffer(n,s,a),this.isGL()){var{extent2d:h,offset:l}=e,u=bf.set(h.xmin-l[0],e.extent2d.ymax-l[1]),c=u.x*o,A=u.y*o,f=this.getTileOpacity(n,e),d=null;this.layer.options.debug&&(d=this.getDebugInfo(e.id));var p=this.gl;p.stencilFunc(p.LEQUAL,Math.abs(this.getCurrentTileZoom()-e.z),255);var g=this.layer.getPolygonOffset(),m=this.drawingCurrentTiles?g:g+1;p.polygonOffset(m,m),this.drawGLImage(n,c,A,s,a,o,f,d),this._getTileFadingOpacity(n)<1?this.setToRedraw():this.setCanvasUpdated()}else t.prototype.drawTile.call(this,e,n)}}},n._bindGLBuffer=function(t,e,n){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,n))},n.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;t.crossOrigin=null!==n?n:"",t.src=e},n.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},n.createContext=function(){t.prototype.createContext.call(this),this.createGLContext()},n.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},n.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},n.getCanvasImage=function(){if(!this.isGL()||!this.canvas2)return t.prototype.getCanvasImage.call(this);var e=t.prototype.getCanvasImage.call(this);return e&&(e.image=this.canvas2),e},n.isGL=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},n.deleteTile=function(e){t.prototype.deleteTile.call(this,e),e&&e.image&&this.disposeImage(e.image),delete e.image},n.onRemove=function(){t.prototype.onRemove.call(this),this.removeGLCanvas()},e}(DA(vf));function Pf(t){var e=this,n=this.layer.getTileSize(),i=this.canvas.constructor,r=this.getMap(),o=r.getDevicePixelRatio(),s=Mo.createCanvas(n.width*o,n.height*o,i);s.layer=this.layer;var a=new ht(t.extent2d.xmin,t.extent2d.ymax),h=new fs(r.pointToCoordinate(a),r.pointToCoordinate(a.add(n.width,n.height)),r.getProjection());return this.layer.drawTile(s,{url:t.url,point:a,center:r.pointToCoordinate(a.add(n.width/2,n.height/2)),extent:h,z:t.z,x:t.x,y:t.y},(function(n){n?e.onTileError(s,t):e.onTileLoad(s,t)})),s}lA.registerRenderer("gl",Cf);var Mf=function(t){function e(){return t.apply(this,arguments)||this}return K(e,t),e.prototype.loadTile=function(...t){return Pf.apply(this,t)},e}(vf),Tf=function(t){function e(){return t.apply(this,arguments)||this}return K(e,t),e.prototype.loadTile=function(...t){return Pf.apply(this,t)},e}(Cf);vA.registerRenderer("canvas",Mf),vA.registerRenderer("gl",Tf);var Sf="undefined"!=typeof Int8Array?new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]):[],If=function(){function t(t,e,n){this.gl=t,this.quadVertices=e||Sf,this.attributes=["a_position",3,Ef(e)],this.debug=n}var e=t.prototype;return e.start=function(){var t=this.gl;t.enable(t.STENCIL_TEST),t.stencilMask(255),t.stencilOp(t.KEEP,t.REPLACE,t.REPLACE),t.depthMask(!1),this._save(),this.buffer||(this._createBuffer(),this._createProgram()),t.useProgram(this.program),t.bindBuffer(t.ARRAY_BUFFER,this.buffer),bA(t,this.program,this.attributes),this.transformLoc||(this.transformLoc=t.getUniformLocation(this.program,"transform")),this.colorLoc||(this.colorLoc=t.getUniformLocation(this.program,"color")),this.debug||t.colorMask(!1,!1,!1,!1)},e.end=function(){var t=this.gl;t.depthMask(!0),this._restore(),this.debug||t.colorMask(!0,!0,!0,!0)},e.draw=function(t){var e=this.gl;e.uniformMatrix4fv(this.transformLoc,!1,t),e.uniform3fv(this.colorLoc,[Math.random(),Math.random(),Math.random()]),e.drawArrays(e.TRIANGLE_STRIP,0,4)},e.remove=function(){var t=this.gl;return this.buffer&&t.deleteBuffer(this.buffer),this.program&&(t.deleteShader(this.program.fragmentShader),t.deleteShader(this.program.vertexShader),t.deleteProgram(this.program)),delete this.transformLoc,delete this.gl,this},e.stencilMask=function(t){return this.gl.stencilMask(t),this},e.stencilFunc=function(t,e,n){return this.ref=e,this.gl.stencilFunc(t,e,n),this},e.stencilOp=function(t,e,n){return this.gl.stencilOp(t,e,n),this},e.resetFunc=function(){return this.ref=1,this.gl.stencilFunc(this.gl.ALWAYS,1,255),this},e._save=function(){this._savedProgram=this.gl.program},e._restore=function(){var t=this.gl;t.program=this._savedProgram,t.program&&t.useProgram(t.program)},e._createBuffer=function(){var t=this.gl;if(this.buffer=t.createBuffer(),!this.buffer)throw new Error("Failed to create the buffer object");t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,this.quadVertices,t.STATIC_DRAW)},e._createProgram=function(){var{program:t,vertexShader:e,fragmentShader:n}=xA(this.gl,"\n    attribute vec3 a_position;\n    uniform mat4 transform;\n\n    void main()\n    {\n        gl_Position = transform * vec4(a_position, 1.0);\n    }\n","\n    precision mediump float;\n    uniform vec3 color;\n    void main()\n    {\n        gl_FragColor = vec4(color, 1.0);\n    }\n");t.vertexShader=e,t.fragmentShader=n,this.program=t},t}();function Ef(t){return t instanceof Float32Array?"FLOAT":t instanceof Int16Array?"SHORT":t instanceof Uint16Array?"UNSIGNED_SHORT":t instanceof Int8Array?"BYTE":t instanceof Uint8Array||t instanceof Uint8ClampedArray?"UNSIGNED_BYTE":"FLOAT"}var Of=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.checkResources=function(){var t=this._geosToCheck||[];if(!this._resourceChecked&&this.layer._geoList&&pt(t,this.layer._geoList),!wt(t))return[];for(var e=[],n={},i=t.length-1;i>=0;i--){var r=t[i]._getExternalResources();if(r.length)if(this.resources)for(var o=0;o<r.length;o++){var s=r[o][0];this.resources.isResourceLoaded(r[o])||n[s]||(e.push(r[o]),n[s]=1)}else e.push(...r)}return this._resourceChecked=!0,delete this._geosToCheck,e},n.render=function(...e){return this.layer._sortGeometries(),t.prototype.render.apply(this,e)},n._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),pt(this._geosToCheck,t))},n.onGeometryAdd=function(t){this._addGeoToCheckRes(t),Rf(this)},n.onGeometryRemove=function(t){Rf(this)},n.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),Rf(this)},n.onGeometryShapeChange=function(t){Rf(this)},n.onGeometryPositionChange=function(t){Rf(this)},n.onGeometryZIndexChange=function(t){Rf(this)},n.onGeometryShow=function(t){Rf(this)},n.onGeometryHide=function(t){Rf(this)},n.onGeometryPropertiesChange=function(t){Rf(this)},e}(Aa);function Rf(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}var Df=new ps,kf=[],Lf=new ps;function Ff(t){if(!t)return null;var e=t.getContext("2d");return e.clearRect(0,0,t.width,t.height),e}function Nf(t){return t&&t.options.progressiveRender&&t.options.progressiveRenderDebug}var zf=function(t){function e(){return t.apply(this,arguments)||this}K(e,t);var n=e.prototype;return n.setToRedraw=function(){return t.prototype.setToRedraw.call(this),this._resetProgressiveRender(),this},n._geoIsCollision=function(t,e){if(!t)return!1;if(!t.options.collision)return!1;if(t.isPoint&&t.getContainerExtent){t.bbox||(t.bbox=[0,0,0,0]);var n=this.layer.options.collisionBufferSize,i=t.getContainerExtent();if(!i)return!1;if(t.bbox[0]=i.xmin-n,t.bbox[1]=i.ymin-n,t.bbox[2]=i.xmax+n,t.bbox[3]=i.ymax+n,e.collides(t.bbox))return t._collided=!0,!0;e.insertBox(t.bbox)}return!1},n.getImageData=function(){if(!this._lastRenderTime||o()-this._lastRenderTime<32)return null;if(!this.context||!this.context.canvas)return null;if(!this._imageData){var{width:t,height:e}=this.context.canvas;try{this._imageData=this.context.getImageData(0,0,t,e)}catch(n){console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",n)}}return this._imageData},n.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=o()},n.checkResources=function(...e){var n=this,i=t.prototype.checkResources.apply(this,e),r=this.layer.getStyle();return r&&(Array.isArray(r)||(r=[r]),r.forEach((function(t){for(var e=qn(t.symbol,!0),r=0,o=e.length;r<o;r++)n.resources.isResourceLoaded(e[r])||i.push(e[r])}))),i},n.needToRedraw=function(){if(this.isProgressiveRender()&&!this.renderEnd)return!0;var e=this.getMap();return!(!e.isInteracting()||!this.layer.options.enableAltitude)||!(e.isZooming()&&!e.isRotating()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===Cu)&&t.prototype.needToRedraw.call(this)},n.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},n.isBlank=function(){return!!this.context&&!this.isProgressiveRender()&&!this.context.canvas._drawn},n.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount(),n=this.mapStateCache.resolution;(t.isZooming()&&t.options.seamlessZoom&&void 0!==this._drawnRes&&n>1.5*this._drawnRes&&this._geosToDraw.length<e||t.isMoving()||t.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._drawnRes=n),this._sortByDistanceToCamera(t.cameraPosition);var{collision:i,collisionDelay:r}=this.layer.options;if(i){var s=o();this._lastCollisionTime||(this._lastCollisionTime=s),s-this._lastCollisionTime<=r?this._geosToDraw=this._lastGeosToDraw||this._geosToDraw:(this._collidesGeos(),this._lastCollisionTime=s)}for(var a=0,h=this._geosToDraw.length;a<h;a++){var l=this._geosToDraw[a];l._isCheck||l.isVisible()?(l._paint(this._displayExtent),this._geosToDraw[a]._cPoint=void 0,this._geosToDraw[a]._inCurrentView=void 0):(delete l._cPoint,delete l._inCurrentView)}this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,Nf(this.layer)&&this.page}},n.show=function(...e){this.layer.forEach((function(t){t._repaint()})),t.prototype.show.apply(this,e)},n.forEachGeo=function(t,e){this.layer.forEach(t,e)},n._checkGeos=function(){for(var t=this._getCurrentNeedRenderGeos(),e=0,n=t.length;e<n;e++)this.checkGeo(t[e]);return this},n.drawGeos=function(){this._drawSnapshot(),this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._sortByDistanceToCamera(this.getMap().cameraPosition),this._collidesGeos();for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(),this._geosToDraw[t]._cPoint=void 0,this._geosToDraw[t]._inCurrentView=void 0;this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,Nf(this.layer)&&this.page,this._snapshot(),this._setDrawGeosDrawTime()},n.prepareToDraw=function(){return this.layer._drawTime=o(),this._hasPoint=!1,this._geosToDraw=[],this},n._setDrawGeosDrawTime=function(){o();for(var t=this.layer._drawTime,e=this.getGeoPainterList(),n=0,i=e.length;n<i;n++){var r=e[n];r&&r._setDrawTime&&r._setDrawTime(t)}return Nf(this.layer)&&o(),this},n.checkGeo=function(t){if(t.isPoint&&void 0!==this._onlyHasPoint)(t._inCurrentView||t.hasAltitude())&&(this._hasPoint=!0,t._isCheck=!0,this._geosToDraw.push(t));else if(t._isCheck=!1,t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),n=!0;if(t._inCurrentView||!a(t.options.arcDegree)||t.hasAltitude())n=!0;else if(!1===t._inCurrentView)n=!1;else{var i=e.get2DExtent(this.resources,Df);i&&i.intersects(this._displayExtent)||(n=!1)}n&&(e.hasPoint()&&(this._hasPoint=!0),t._isCheck=!0,this._geosToDraw.push(t))}},n._collidesGeos=function(){var t=this._geosToDraw;if(!this.layer.options.collision){for(var e=0,n=t.length;e<n;e++){var i=t[e];i.isPoint&&(i._collided=!1)}return this}var r=this.layer.options.collisionScope,o=this.layer.getCollisionIndex();"layer"===r&&o.clear(),this._geosToDraw=[];for(var s=0,a=t.length;s<a;s++){var h=t[s];h.isPoint&&(h._collided=!1,this._geoIsCollision(h,o))?h._collided=!0:this._geosToDraw.push(t[s])}return this},n.onZoomEnd=function(...e){delete this.canvasExtent2D,t.prototype.onZoomEnd.apply(this,e)},n.onRemove=function(){this.forEachGeo((function(t){t.onHide()})),delete this._geosToDraw,delete this.snapshotCanvas,delete this.pageGeos,delete this.geoPainterList},n.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),t.prototype.onGeometryPropertiesChange.call(this,e)},n._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},n.identifyAtPoint=function(t,e={}){var n=this.getGeosForIdentify();return n?this.layer._hitGeos(n,t,e):[]},n._updateMapStateCache=function(){var t=this.getMap(),e=t._pointToContainerPoint(this.middleWest)._add(0,-t.height/2),n=t.getResolution(),i=t.getPitch(),r=t.getBearing(),o=t.getGLScale(),s=t.getGLRes(),a=t.getContainerExtent(),h=t.get2DExtent(),l=t.get2DExtentAtRes(s);return this.mapStateCache={resolution:n,pitch:i,bearing:r,glScale:o,glRes:s,_2DExtent:h,glExtent:l,containerExtent:a,offset:e},this},n._batchConversionMarkers=function(t){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var e=[],n=[],i=[],r={},o=this.layer,s=o.options,a=o.getAltitude?o.getAltitude():0,h=o.isCanvasRender();this._onlyHasPoint=!0;for(var l=0,u=this._getCurrentNeedRenderGeos(),c=0,A=u.length;c<A;c++){var f=u[c];if(f.isPoint){var d=f._painter;d||(d=f._getPainter());var p=d.getRenderPoints("center")[0][0],g=s.enableAltitude?f._getAltitude():a;void 0===r[g]&&(r[g]=d.getAltitude()),e[l]=p,i[l]=r[g],n[l]=f,l++}else this._onlyHasPoint=!1}if(0===l)return[];var m=this.getMap(),y=zt(e,"_pt");y=m._pointsAtResToContainerPoints(e,t,i,y);for(var v=m.getContainerExtent(),{xmax:_,ymax:x,xmin:b,ymin:w}=v,C={},P=0,M=n.length;P<M;P++){var T=n[P];if(T._cPoint=y[P],T._cPoint){var{x:S,y:I}=y[P];if(T._inCurrentView=S>=b&&I>=w&&S<=_&&I<=x||T.hasAltitude(),!T._inCurrentView){var E=T.getSymbolHash(),O=void 0;O=E?C[E]=C[E]||T._painter.getFixedExtent():T._painter.getFixedExtent(),Lf.set(O.xmin,O.ymin,O.xmax,O.ymax),Lf._add(y[P]),T._inCurrentView=Lf.intersects(v)}T._inCurrentView&&(T.isVisible()&&h||(T._inCurrentView=!1),this._onlyHasPoint&&T._inCurrentView&&(this._hasPoint=!0,T._isCheck=!0,this._geosToDraw.push(T)))}else T._inCurrentView=!1}return y},n._sortByDistanceToCamera=function(t){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var e=this.getMap(),n=e.distanceToPoint(1e3,0,e.getGLScale()).x/1e3,i="center";this._geosToDraw.sort((function(e,r){if(!e.isPoint||!r.isPoint)return 0;var o=e._painter,s=r._painter;if(!o||!s)return 0;var a=o.getRenderPoints(i)[0][0],h=s.getRenderPoints(i)[0][0],l=o.getAltitude()*n,u=s.getAltitude()*n;zi(kf,a.x,a.y,l);var c=Zi(kf,t);return zi(kf,h.x,h.y,u),Zi(kf,t)-c}))}},n._constructorIsThis=function(){return this.constructor===e},n.isProgressiveRender=function(){var t=this.layer;if(!t)return!1;var{progressiveRender:e,collision:n}=t.options||{};return!n&&e},n.getGeosForIdentify=function(){return this.isProgressiveRender()?this.pageGeos||[]:this._geosToDraw||[]},n.getGeoPainterList=function(){if(!this.isProgressiveRender()){for(var t=[],e=this._geosToDraw||[],n=0,i=e.length;n<i;n++)t.push(e[n]._painter);return t}return this.geoPainterList||[]},n._checkSnapshotCanvas=function(){if(!this.isProgressiveRender())return delete this.snapshotCanvas,null;var t=this.canvas;if(!t)return delete this.snapshotCanvas,null;this.snapshotCanvas||(this.snapshotCanvas=Mo.createCanvas(1,1));var e=this.snapshotCanvas,{width:n,height:i,style:r}=t;return e.width===n&&e.height===i||(e.width=n,e.height=i),e.style.width===r.width&&e.style.height===r.height||(e.style.width=r.width,e.style.height=r.height),e},n._getCurrentNeedRenderGeos=function(){var t=this.layer._geoList||[];if(!this.isProgressiveRender())return t;var e=this.layer,{progressiveRenderCount:n}=e.options,i=this.page;return t.slice((i-1)*n,i*n)},n._resetProgressiveRender=function(){Nf(this.layer),this.renderEnd=!1,this.page=1,this.pageGeos=[],this.geoPainterList=[],this.maxTolerance=0,this._clearSnapshotCanvas()},n._clearSnapshotCanvas=function(){var t=this._checkSnapshotCanvas();t&&Ff(t)},n._snapshot=function(){for(var t=this.isProgressiveRender(),e=this._geosToDraw||[],n=0,i=e.length;n<i;n++){var r=e[n],s=r._hitTestTolerance()||0;this.maxTolerance=Math.max(this.maxTolerance,s),t&&(this.pageGeos.push(r),this.geoPainterList.push(r._painter))}if(!t)return this;o();var a=this._checkSnapshotCanvas();a&&this.canvas&&Ff(a).drawImage(this.canvas,0,0);var h=this.layer,{progressiveRenderCount:l}=h.options,u=Math.ceil((h._geoList||[]).length/l);return this.renderEnd=this.page>=u,this.renderEnd&&this._setDrawGeosDrawTime(),Nf(this.layer)&&o(),this.renderEnd||this.page++,this},n._drawSnapshot=function(){if(!this.isProgressiveRender())return this;var{snapshotCanvas:t,context:e}=this;if(!t||!e)return this;var n=this.getMap();if(!n)return this;var i=n.getDevicePixelRatio()||1;return this._canvasContextScale(e,1/i),e.drawImage(t,0,0),this._canvasContextScale(e,i),this},e}(Of);Cu.registerRenderer("canvas",zf);var Bf=function(t){function e(e){var n;return(n=t.call(this)||this).map=e,n._handlerQueue=[],n._thisDocVisibilitychange=n._onDocVisibilitychange.bind(n),n._thisDocDragStart=n._onDocDragStart.bind(n),n._thisDocDragEnd=n._onDocDragEnd.bind(n),n._thisDocDPRChange=n._onDocDPRChange.bind(n),n}K(e,t);var n=e.prototype;return n.callInNextFrame=function(t){this._handlerQueue.push(t)},n.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]()},n.offsetPlatform=function(t,e){if(!this.map.getPanels().front)return this;if(!e&&0===t.x&&0===t.y)return this;var n=this.map.getPanels(),i=this._frontCount=n.back.layerDOM.childElementCount,r=this._backCount=n.front.layerDOM.childElementCount,o=this._uiCount=n.front.uiDOM.childElementCount;if(i||r||o){var s=this.map.offsetPlatform();s=t?s.add(t)._round():s.round(),r&&Re(n.back,s),(i||o)&&Re(n.front,s)}return this},n.domChanged=function(){var t=this.map.getPanels();return!!t.front&&(void 0===this._frontCount||this._frontCount!==t.back.layerDOM.childElementCount||void 0===this._backCount||this._backCount!==t.front.layerDOM.childElementCount||void 0===this._uiCount||this._uiCount!==t.front.uiDOM.childElementCount)},n.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map.getPanels().front)){var t=new ht(0,0);Re(this.map.getPanels().back,t),Re(this.map.getPanels().front,t)}},n.onZoomEnd=function(){this.resetContainer()},n.onLoad=function(){this._frameLoop()},n._onDocVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},n._getWrapPanel=function(){if(!this.map)return null;var t=this.map.getPanels();return t&&t.mapWrapper},n._onDocDragStart=function(){var t=this._getWrapPanel();t&&(t.style.overflow="visible")},n._onDocDragEnd=function(){var t=this._getWrapPanel();t&&(t.style.overflow="hidden")},n._onDocDPRChange=function(){var t=this.map;t&&t.options&&!t.options.devicePixelRatio&&t.checkSize&&t.getRenderer&&t.getRenderer()&&t.checkSize(!0)},n._containerIsOffscreen=function(){var t=this.map.getContainer();return!t||!t.style||"none"===t.style.display||Math.min(t.clientWidth,t.clientHeight)<=0},e}(Lo),Hf=new so,jf=function(t){function e(e){var n;return(n=t.call(this,e)||this)._containerIsCanvas=!!e.getContainer().getContext,n._registerEvents(),n._loopTime=0,n._resizeEventList=[],n._resizeTime=-1/0,n._frameCycleRenderCount=0,n}K(e,t);var i=e.prototype;return i.load=function(){this.initContainer()},i.renderFrame=function(t){var e=this.map;if(!e||!e.options.renderable)return!1;if(this._handleResizeEventList(t),e.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(t),delete this._isViewChanged,e._fireEvent("framestart"),this.updateMapDOM(),e.clearCollisionIndex();var n=this._getAllLayerToRender();return this.drawLayers(n,t),this.drawLayerCanvas(n)&&(this.drawTops(),this._drawCenterCross(),e.options.debugSky&&this._debugSky()),this._needClear=!1,e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,e.uiCollides(),!0},i.getFrameTimestamp=function(){return this._frameTimestamp||0},i.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t.getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},i._needRedrawAllLayers=function(t){var e=this;if(this.isSpatialReferenceChanged())return!0;var n=[];t.forEach((function(t){if(t&&(t._toRedraw=e._checkLayerRedraw(t))){n.push(t);var i=t.getLayers&&t.getLayers();i&&Array.isArray(i)&&pt(n,i)}}));for(var i=0,r=n.length;i<r;i++){var o=n[i],s=o&&o.options;if(s&&s.collision&&"map"===s.collisionScope)return!0}return!1},i.drawLayers=function(t,e){for(var n=this._needRedrawAllLayers(t),i=this.map,r=i.isInteracting(),o=[],s=[],a=i.options.fpsOnInteracting||0,h=0===a?0:1e3/a,l=this.map.options.layerCanvasLimitOnInteracting,u=t.length,c=i.getBaseLayer(),A=0,f=0;f<u;f++){var d=t[f];if(d.isVisible()){var p=d.isCanvasRender();p&&o.push(d.getId());var g=d._getRenderer();if(g){var m=n||d._toRedraw;p&&g.isCanvasUpdated()&&(m||s.push(d.getId()),this.setLayerCanvasUpdated());var y=g.__zoomTransformMatrix;if(delete g.__zoomTransformMatrix,m){if(r&&p){if(l>0&&u-1-f>l&&d!==c){d._getRenderer().clearCanvas();continue}A+=this._drawCanvasLayerOnInteracting(d,A,h,e)}else r&&g.drawOnInteracting?(g.prepareRender&&g.prepareRender(),g.checkAndDraw?g.checkAndDraw(g.drawOnInteracting,this._eventParam,e):g.drawOnInteracting(this._eventParam,e)):(g.render(e),p&&y&&g.isLoadingResource()&&(g.__zoomTransformMatrix=y));p&&(s.push(d.getId()),this.setLayerCanvasUpdated())}else p&&r&&(i.isZooming()&&!i.getPitch()?(g.prepareRender(),g.__zoomTransformMatrix=this._zoomMatrix):(i.getPitch()||i.isRotating())&&g.clearCanvas())}}}var v=this._canvasIds||[],_=this._updatedIds||[];if(this._canvasIds=o,this._updatedIds=s,!this.isLayerCanvasUpdated()){var x="---";v.join(x)===o.join(x)&&_.join(x)===s.join(x)||this.setLayerCanvasUpdated()}},i._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,n=t._getRenderer();return!!n&&(t.isCanvasRender()?n.testIfNeedRedraw():!(!n.needToRedraw||!n.needToRedraw())||e.isInteracting()||this.isViewChanged())},i._drawCanvasLayerOnInteracting=function(t,e,n,i){var r=this.map,o=t._getRenderer(),s=o.getDrawTime(),a=0===n||n>0&&e+s<=n;if(o.mustRenderOnInteracting&&o.mustRenderOnInteracting())o.render(i);else{if(o.drawOnInteracting&&(t===r.getBaseLayer()||a||r.isZooming()&&t.options.forceRenderOnZooming||r.isMoving()&&t.options.forceRenderOnMoving||r.isRotating()&&t.options.forceRenderOnRotating))return o.prepareRender(),o.prepareCanvas(),o.checkAndDraw?o.checkAndDraw(o.drawOnInteracting,this._eventParam,i):o.drawOnInteracting(this._eventParam,i),s;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&o.clearCanvas():(o.prepareRender(),o.__zoomTransformMatrix=this._zoomMatrix)}return o.drawOnInteracting&&!a&&o.onSkipDrawOnInteracting(this._eventParam,i),0},i._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach((function(e){var n=t.getLayer(e);if(n){var i=n._getRenderer();i&&i.isRenderComplete()&&n.fire("layerload")}}))}},i.isLayerCanvasUpdated=function(){return this._canvasUpdated},i.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},i.drawLayerCanvas=function(t){var e=this.map;if(!e)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged()&&!1===this._needClear)return!1;this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var n,i=e.isInteracting(),r=e.options.layerCanvasLimitOnInteracting,o=t.length,s=[],a=0;a<o;a++)if(t[a].isVisible()&&t[a].isCanvasRender()&&t[a]._getRenderer()){var h=this._getLayerImage(t[a]);h&&h.image&&(t[a]===e.getBaseLayer()?n=[t[a],h]:s.push([t[a],h]))}var l=this.canvas.width,u=this.canvas.height;n&&(this._drawLayerCanvasImage(n[0],n[1],l,u),this._drawFog()),o=s.length;for(var c=i&&r>=0&&o>r?o-r:0;c<o;c++)this._drawLayerCanvasImage(s[c][0],s[c][1],l,u);return e._fireEvent("renderend",{context:this.context}),!0},i.setToRedraw=function(){var t=this._getAllLayerToRender();this._needClear=!0;for(var e=0,n=t.length;e<n;e++){var i=t[e].getRenderer();i&&i.canvas&&i.setToRedraw&&i.setToRedraw()}},i.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.width+"px",n=t.height+"px",i=this.map.getPanels();i.mapWrapper.style.width=e,i.mapWrapper.style.height=n,this._updateCanvasSize()}},i.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map.getContainer():this.map.getPanels()?this.map.getPanels().mapWrapper:null:null},i.toDataURL=function(t,e){return this.canvas?this.canvas.toDataURL(t,e):null},i.remove=function(){Q.webgl&&"undefined"!=typeof document&&(No.off(zo,this._thisDocDPRChange,this),No.off(Bo,this._thisDocVisibilitychange,this),No.off(Ho,this._thisDocDragStart,this),No.off(jo,this._thisDocDragEnd,this)),this._resizeInterval&&clearInterval(this._resizeInterval),this._resizeObserver&&this._resizeObserver.disconnect(),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},i.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){var n=e._getLayers(),i="default",r=e.options.hitDetectLimit||0,o=0;t&&t._round&&t._round();for(var s=n.length-1;s>=0;s--){var a=n[s];if(!(!a.options.hitDetect||a.isEmpty&&a.isEmpty())&&a.options.geometryEvents){var h=a._getRenderer();if(h&&h.hitDetect&&(!h.isBlank||!h.isBlank())){if("default"!==a.options.cursor&&h.hitDetect(t)){i=a.options.cursor||"pointer";break}if(o++,r>0&&o>r)break}}}e._trySetCursor(i)}},i._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},i.initContainer=function(){var t=this.map.getPanels();function e(e,n,i,r){var o=we("div",n);return i&&(o.style.cssText=i),t[e]=o,r||Oe(o),o}var n=this.map.getContainer();if(!this._containerIsCanvas){n.innerHTML="";var i="position:absolute;top:0px;left:0px;",r=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),o=e("allLayers","maptalks-all-layers",i+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),s=e("backStatic","maptalks-back-static",i+"z-index:0;",!0),a=e("back","maptalks-back",i+"z-index:1;"),h=e("backLayer","maptalks-back-layer",i),l=e("canvasContainer","maptalks-canvas-layer",i+"border:none;z-index:2;"),u=e("frontStatic","maptalks-front-static",i+"z-index:3;",!0),c=e("front","maptalks-front",i+"z-index:4;",!0),A=e("frontLayer","maptalks-front-layer",i+"z-index:0;"),f=e("ui","maptalks-ui",i+"border:none;z-index:1;",!0),d=e("control","maptalks-control","z-index:1",!0);n.appendChild(r),o.appendChild(s),a.appendChild(h),a.layerDOM=h,o.appendChild(a),o.appendChild(l),c.appendChild(A),c.layerDOM=A,c.uiDOM=f,o.appendChild(u),o.appendChild(c),c.appendChild(f),r.appendChild(o),r.appendChild(d),this.createCanvas(),this.resetContainer();var p=this.map._getContainerDomSize();this.updateMapSize(p)}},i.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var t=this._mapview,e=this._getMapView();return this._isViewChanged=!t||!Lt(t,e),this._isViewChanged},i._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||Lt(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},i.isSpatialReferenceChanged=function(){return this._spatialRefChanged},i._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},i._lockFrameRenderEnable=function(){var{maxFPS:t}=this.map.options||{};if(t<=0||r.maxFPS<=t)return!0;var e=Math.ceil(r.maxFPS/t);return this._frameCycleRenderCount>=e},i._frameLoop=function(t){var e=this;this.map?(this._frameCycleRenderCount++,this._lockFrameRenderEnable()?(this._frameTimestamp=t=t||0,this._resizeCount=0,this.renderFrame(t),this._frameCycleRenderCount=0):this.map.options.debug&&this._frameCycleRenderCount,this._animationFrame=ot((function(t){e._frameLoop(t)}))):this._cancelFrameLoop()},i._cancelFrameLoop=function(){this._animationFrame&&st(this._animationFrame)},i._drawLayerCanvasImage=function(t,e,n,i){var r=this.context,o=e.point.round(),s=this.map.getDevicePixelRatio();1!==s&&o._multi(s);var a=e.image,l=a.width,u=a.height;if(!(o.x+l<=0||o.y+u<=0)){var c=t.options.opacity;if(h(c)||(c=1),!(c<=0)){var A=e.opacity;if(h(A)||(A=1),!(A<=0)){var f=r.globalAlpha;c<1&&(r.globalAlpha*=c),A<1&&(r.globalAlpha*=A),t.options.cssFilter&&(r.filter=t.options.cssFilter);var d=t.getRenderer(),p=d.__zoomTransformMatrix,g=d.clipCanvas(this.context);p&&(r.save(),r.setTransform(...p)),r.drawImage(a,0,0,l,u,o.x,o.y,n,i),p&&r.restore(),g&&r.restore(),"none"!==r.filter&&(r.filter="none"),r.globalAlpha=f}}}},i._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,n=new ht(this.canvas.width/2,this.canvas.height/2);A(t)?t(e,n):Mo.drawCross(this.context,n.x,n.y,2,"#f00")}},i._drawContainerExtent=function(){var{cascadePitches:t}=this.map.options,e=this.map.height-this.map._getVisualHeight(t[0]),n=this.map.height-this.map._getVisualHeight(t[1]),i=this.map.getContainerExtent(),r=this.context;r.beginPath(),r.moveTo(0,i.ymin),r.lineTo(i.xmax,i.ymin),r.stroke(),r.beginPath(),r.moveTo(0,e),r.lineTo(i.xmax,e),r.stroke(),r.beginPath(),r.moveTo(0,n),r.lineTo(i.xmax,n),r.stroke()},i._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch)&&t.options.fog){var e=t.getDevicePixelRatio(),n=this.context,i=t.getContainerExtent(),r=(t.height-t._getVisualHeight(75))*e;r<0&&(r=0);var o=i.ymin*e,s=Math.ceil(o-r),a=t.options.fogColor.join(),h=n.createLinearGradient(0,r,0,o+30),l=1-30/(s+30);h.addColorStop(0,"rgba("+a+", 0)"),h.addColorStop(.3,"rgba("+a+", 0.3)"),h.addColorStop(l,"rgba("+a+", 1)"),h.addColorStop(1,"rgba("+a+", 0)"),n.beginPath(),n.fillStyle=h,n.fillRect(0,r,Math.ceil(i.getWidth())*e,Math.ceil(s+30))}},i._debugSky=function(){var t=this.map;if(!t)return this;var e=t.getContainerExtent().ymin;if(e<=0)return this;var n=this.context;return n.strokeStyle="red",n.strokeRect(0,0,t.width,e),this},i._getAllLayerToRender=function(){return this.map._getLayers()},i.clearCanvas=function(){this.canvas&&Mo.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},i._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),n=this.canvas,i=t.getDevicePixelRatio(),{width:r,height:o,cssWidth:s,cssHeight:a}=Ut(e,i);return!n.style||n.style.width===s&&n.style.height===a||(n.style.width=s,n.style.height=a),(r!==n.width||o!==n.height)&&(n.height=o,n.width=r,this.topLayer.width=n.width,this.topLayer.height=n.height,!0)},i.createCanvas=function(){this.topLayer=we("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map.getContainer():(this.canvas=we("canvas"),this._updateCanvasSize(),this.map.getPanels().canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},i._updateDomPosition=function(t){return void 0===this._checkPositionTime&&(this._checkPositionTime=-1/0),Math.abs(t-this._checkPositionTime)>=500&&(De(this.map.getContainer()),this._checkPositionTime=Math.min(t,this._checkPositionTime)),this},i._handleResizeEventList=function(t){if(!this._resizeEventList)return this;var e=this._resizeEventList.length;return 0===e||this._resizeTime&&t-this._resizeTime<60||(this.map.setContainerDomRect(this._resizeEventList[e-1].contentRect),this._resizeEventList=[],this._checkSize(),this._resizeCount=this._resizeCount||0,this.renderFrame((this._frameTimestamp||0)+ ++this._resizeCount/100),this._resizeTime=t),this},i._checkSize=function(){this.map&&this.map.checkSize()},i._setCheckSizeInterval=function(t){var e=this;Q.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver((function(t){!e.map||e.map.isRemoved()?e._resizeObserver.disconnect():t.length&&(e._resizeEventList=e._resizeEventList||[],e._resizeEventList.push(t[0]))})),this._resizeObserver.observe(this.map.getContainer()))):(clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval((function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()}),this._checkSizeInterval))},i._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!n&&"undefined"!=typeof window&&this._setCheckSizeInterval(e.options.checkSizeInterval),Q.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",(function(e){t._eventParam=e})),e.on("_zooming",(function(n){e.getPitch()||(t._zoomMatrix=n.matrix.container),t._eventParam=n})),e.on("_zoomend",(function(e){t._eventParam=e,delete t._zoomMatrix})),e.on("_spatialreferencechange",(function(){t._spatialRefChanged=!0})),Q.webgl&&"undefined"!=typeof document&&(No.on(zo,this._thisDocDPRChange,this),No.on(Bo,this._thisDocVisibilitychange,this),No.on(Ho,this._thisDocDragStart,this),No.on(jo,this._thisDocDragEnd,this))},i._onMapMouseMove=function(t){var e=this,n=this.map;!n.isInteracting()&&n.options.hitDetect&&(this._hitDetectFrame&&st(this._hitDetectFrame),this._hitDetectFrame=ot((function(){e.hitDetect(t.containerPoint)})))},i._getCanvasLayers=function(){return this.map._getLayers((function(t){return t.isCanvasRender()}))},i.addTopElement=function(t){this._tops||(this._tops=[]),this._tops.push(t)},i.removeTopElement=function(t){if(this._tops){var e=this._tops.indexOf(t);e>=0&&this._tops.splice(e,1)}},i.getTopElements=function(){return this._tops||[]},i.sortTopElements=function(){this._tops=this._tops.sort((function(t,e){return(e.options.zIndex||0)-(t.options.zIndex||0)}))},i.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height);var t=Hf;t.clear(),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var e=this.getTopElements(),n=!1,i=this.map.getDevicePixelRatio(),r=[],o=0;o<e.length;o++){var s=e[o];if(s.needCollision&&s.needCollision()){var a=s.getRenderBBOX(i);if(a){if(t.collides(a)){var h=s.target&&s.target._geometry;h&&-1===r.indexOf(h)&&(r.push(h),h.fire("handlecollision"));continue}t.insertBox(a)}}s.render(this.topCtx)&&(n=!0)}n&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},e}(Bf);Al.registerRenderer("canvas",jf),Al.mergeOptions({fog:!1,fogColor:[233,233,233]});var Uf=Object.freeze({__proto__:null,CanvasLayerRenderer:GA,CanvasRenderer:Aa,CanvasTileLayerCanvasRenderer:Mf,CanvasTileLayerGLRenderer:Tf,ImageGLRenderable:DA,ImageLayerCanvasRenderer:jA,ImageLayerGLRenderer:UA,MapCanvasRenderer:jf,MapRenderer:Bf,OverlayLayerCanvasRenderer:Of,QuadStencil:If,Renderable:na,ResourceCache:fa,TileLayerCanvasRenderer:vf,TileLayerGLRenderer:Cf,VectorLayerCanvasRenderer:zf}),Gf={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};Bl.include(Gf),iu.include(Gf),eu.include(Gf),ou.include(Gf),ru.include({_getRenderPoints:function(t){var e=this.getMap(),n=e.getGLRes();if("vertex"===t){for(var i=this._trimRing(this.getShell()),r=[],o=0,s=i.length;o<s;o++)r.push(e.coordToPointAtRes(i[o],n));return[r,null]}return[[e.coordToPointAtRes(this.getCenter(),n)],null]}});var Vf={_getRenderPoints:function(t){var e,n=this.getMap(),i=n.getGLRes(),r=null;if("point"===t)(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&e.length>0&&Array.isArray(e[0])&&(e=e[0].concat(e[1]));else if("vertex"===t)if(r=[],(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&e.length>0&&Array.isArray(e[0])){for(var o=0,s=e.length;o<s;o++)for(var a=0,h=e[o].length;a<h;a++)r.push(0===a?[e[o][a],e[o][a+1]]:[e[o][a-1],e[o][a]]);e=e[0].concat(e[1])}else for(var l=0,u=e.length;l<u;l++)r.push(0===l?[e[l],e[l+1]]:[e[l-1],e[l]]);else if("line"===t){e=[],r=[];var c=this._getPath2DPoints(this._getPrjCoordinates(),!1,i);if(c.length>0&&Array.isArray(c[0]))for(var A,f=1,d=c.length;f<d;f++){A=c[f],this instanceof Fl&&A.length>0&&!A[0].equals(A[A.length-1])&&A.push(A[0]);for(var p=1,g=A.length;p<g;p++)e.push(A[p].add(A[p-1])._multi(.5)),r.push([A[p-1],A[p]])}else{this instanceof Fl&&c.length>0&&!c[0].equals(c[c.length-1])&&c.push(c[0]);for(var m=1,y=c.length;m<y;m++)e.push(c[m].add(c[m-1])._multi(.5)),r.push([c[m-1],c[m]])}}else if("vertex-first"===t){var v=this._getPrjCoordinates(),_=v.length,x=_?n._prjToPointAtRes(v[0],i):null;e=_?[x]:[],r=_?[[x,v[1]?n._prjToPointAtRes(v[1],i):x]]:[]}else if("vertex-last"===t){var b=this._getPrjCoordinates(),w=b.length,C=w?n._prjToPointAtRes(b[w-1],i):null;e=w?[C]:[];var P=w>1?w-2:w-1;r=w?[[b[P]?n._prjToPointAtRes(b[P],i):C,C]]:[]}else{var M=this.getCenter();if(M){var T=this._getProjection().project(M);e=[n._prjToPointAtRes(T,i)]}else e=[]}return[e,r]}};jl.include(Vf),Fl.include(Vf);var Wf={within:!1,center:[0,0]};function qf(t){if(t&&t._containerBbox){Wf.within=!1;var{minx:e,miny:n,maxx:i,maxy:r}=t._containerBbox,o=Math.abs(i-e),s=Math.abs(r-n);o<=1&&s<=1&&(Wf.within=!0,Wf.center[0]=(e+i)/2,Wf.center[1]=(n+r)/2),delete t._containerBbox}else Wf.within=!1;return Wf}function Zf(){var t=this._getPrjShell(),e=Ti();Ei(t,e);var[n,i,r,o]=e;return new fs(n,i,r,o)}function Qf(){var t=this._getPrjShell();if(!t||!Array.isArray(t))return[];var e=this._getProjection(),n=this.getCoordinates()||{};return t.map((function(t){var i=e.unproject(t);return i.z=n.z||0,i}))}Kh.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1},_getRenderBBOX:function(t,e){return t.isHitTesting?null:(Ii(Si),Ei(e,Si),Si)}});var Xf={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof iu||this instanceof ou},_computeRotatedPrjExtent:Zf,getRotatedShell:Qf,_paintAsPath:function(){if(this.isRotated())return!0;var t=this.getMap();return this._getAltitude()>0||t.getPitch()||this instanceof iu&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return Fl.prototype._getPaintParams.call(this,!0);var e=this._getPrjCoordinates(),n=t._prjToPointAtRes(e,t.getGLRes());return[n,...this._getRenderSize(n)]},_paintOn:function(...t){return this._paintAsPath()?Mo.polygon(...t):Mo.ellipse(...t)},_getRenderSize:function(t){var e=this.getMap(),n=e.getGLRes(),i=this._getPrjExtent(),r=e._prjToPointAtRes(i.getMin(),n),o=e._prjToPointAtRes(i.getMax(),n);return[Math.abs(o.x-r.x)/2,Math.abs(o.y-t.y),Math.abs(t.y-r.y)]}};iu.include(Xf),eu.include(Xf),ru.include({_getPaintParams:function(){var t=this.getMap(),e=this._getPrjShell();return[this._getPath2DPoints(e,!1,t.getGLRes())]},_paintOn:Mo.polygon,_computeRotatedPrjExtent:Zf,getRotatedShell:Qf});var Yf={_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return Fl.prototype._getPaintParams.call(this,!0);var t=this.getMap(),e=t._prjToPointAtRes(this._getPrjCoordinates(),t.getGLRes()),n=this._getRenderSize(e),[i,r]=this._correctAngles();return[e,n[0],[i,r]]},_paintOn:function(...t){if(this._paintAsPath())return Mo.polygon(...t);var e=this.getMap().getBearing();return e&&(t[3]=t[3].slice(0),t[3][0]+=e,t[3][1]+=e),Mo.sector(...t)}};ou.include(Xf,Yf),kl.include({_paintAsPath:function(){return!0}});var Jf={arrowStyles:{classic:[3,4]},_getArrowShape:function(t,e,n,i,r){if(!t||!e||t.equals(e))return null;r||(r=0);var o,s=n*i[1]+r,a=n*i[0]/2+r;(o=e.sub(e.nextCtrlPoint||e.prevCtrlPoint?new ht(e.prevCtrlPoint?e.prevCtrlPoint:e.nextCtrlPoint):t))._unit();var h=e.sub(o.multi(s));o._perp();var l=h.add(o.multi(a));return o._multi(-1),[l,e,h.add(o.multi(a)),l]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getGLRes())]},_paintOn:function(t,e,n,i,r,o){var s=qf(this._painter);return s.within?Mo.pixelRect(t,s.center,n,i):this.options.smoothness?Mo.paintSmoothLine(t,e,n,this.options.smoothness,!1,this._animIdx,this._animTailRatio):(t.lineColorIn=o,Mo.path(t,e,n,null,r)),this._paintArrow(t,e,n),this._getRenderBBOX(t,e)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,n){var i=this,r=this._getArrowStyle();if(!r||t.length<2)return[];for(var o,s,a=t.length>0&&Array.isArray(t[0])?t:[t],h=this._getArrowPlacement(),l=[],u=function(){if(o&&s){var t=i._getArrowShape(o,s,e,r,n);t&&l.push(t)}},c=a.length-1;c>=0;c--){var A=a[c],f=A.length,d=A[0],p=A[f-1];"vertex-first"===h?(o=d.arrowNextPoint||A[1],s=d):"vertex-last"===h&&(o=p.arrowPrePoint||A[f-2],s=p),u(),"vertex-firstlast"===h&&(o=d.arrowNextPoint||A[1],s=d,u(),o=p.arrowPrePoint||A[f-2],s=p,u()),"point"===h&&this._getArrowPoints(l,A,e,r,n)}return l},_getArrowPoints:function(t,e,n,i,r){for(var o=0,s=e.length-1;o<s;o++){var a=e[o+1],h=this._getArrowShape(a.arrowPrePoint||e[o],a,n,i,r);h&&t.push(h)}},_paintArrow:function(t,e,n){var i=this._getInternalSymbol().lineWidth;(!h(i)||i<3)&&(i=3);var r=this._getArrows(e,i);if(r.length){t.setLineDash&&t.setLineDash([]);for(var o=r.length-1;o>=0;o--)t.fillStyle=t.strokeStyle,Mo.polygon(t,r[o],n,n)}}};jl.include(Jf);var Kf={_getPaintParams:function(t){var e=this.getMap().getGLRes(),n=this._getPrjShell(),i=this._getPath2DPoints(n,t,e),r=i.length>0&&Array.isArray(i[0]);r&&(i=[[i[0]],[i[1]]]);var o=this._getPrjHoles(),s=[];if(o&&o.length>0){for(var a=this._simplified,h=0;h<o.length;h++){var l=this._getPath2DPoints(o[h],t,e);Array.isArray(l)&&r?Array.isArray(l[0])?(i[0].push(l[0]),i[1].push(l[1])):i[0].push(l):s.push(l)}a&&(this._simplified=a)}return r||pt(i=[i],s),[i]},_paintOn:function(t,e,n,i,r,o){var s=qf(this._painter);return s.within?Mo.pixelRect(t,s.center,n,i):(t.lineColorIn=o,Mo.polygon(t,e,n,i,r,this.options.smoothness)),this._getRenderBBOX(t,e)}};Fl.include(Kf),Al.VERSION="1.0.0-rc.40";var $f={Actor:aa};function td(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ed={exports:{}};!function(t){t.exports=function(){function t(t,e){this.id=X++,this.type=t,this.data=e}function e(t){if(0===t.length)return[];var n=t.charAt(0),i=t.charAt(t.length-1);if(1<t.length&&n===i&&('"'===n||"'"===n))return['"'+t.substr(1,t.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(n=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t))return e(t.substr(0,n.index)).concat(e(n[1])).concat(e(t.substr(n.index+n[0].length)));if(1===(n=t.split(".")).length)return['"'+t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(t=[],i=0;i<n.length;++i)t=t.concat(e(n[i]));return t}function n(t){return"["+e(t).join("][")+"]"}function i(e,n){return"function"==typeof e?new t(0,e):"number"==typeof e||"boolean"==typeof e?new t(5,e):Array.isArray(e)?new t(6,e.map((function(t,e){return i(t)}))):e instanceof t?e:void 0}function r(){var t={"":0},e=[""];return{id:function(n){var i=t[n];return i||(i=t[n]=e.length,e.push(n),i)},str:function(t){return e[t]}}}function o(t,e,n){function i(){var e=window.innerWidth,i=window.innerHeight;t!==document.body&&(e=(i=t.getBoundingClientRect()).right-i.left,i=i.bottom-i.top),o.width=n*e,o.height=n*i,Q(o.style,{width:e+"px",height:i+"px"})}var r,o=document.createElement("canvas");return Q(o.style,{border:0,margin:0,padding:0,top:0,left:0}),t.appendChild(o),t===document.body&&(o.style.position="absolute",Q(t.style,{margin:0,padding:0})),t!==document.body&&"function"==typeof ResizeObserver?(r=new ResizeObserver((function(){setTimeout(i)}))).observe(t):window.addEventListener("resize",i,!1),i(),{canvas:o,onDestroy:function(){r?r.disconnect():window.removeEventListener("resize",i),t.removeChild(o)}}}function s(t,e){function n(n){try{return t.getContext(n,e)}catch(i){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function a(t){return"string"==typeof t?t.split():t}function h(t){return"string"==typeof t?document.querySelector(t):t}function l(t){var e,n,i,r,l=t||{};t={};var u=[],c=[],A="undefined"==typeof window?1:window.devicePixelRatio,f=!1,d=function(t){},p=function(){};if("string"==typeof l?e=document.querySelector(l):"object"==typeof l&&("string"==typeof l.nodeName&&"function"==typeof l.appendChild&&"function"==typeof l.getBoundingClientRect?e=l:"function"==typeof l.drawArrays||"function"==typeof l.drawElements?i=(r=l).canvas:("gl"in l?r=l.gl:"canvas"in l?i=h(l.canvas):"container"in l&&(n=h(l.container)),"attributes"in l&&(t=l.attributes),"extensions"in l&&(u=a(l.extensions)),"optionalExtensions"in l&&(c=a(l.optionalExtensions)),"onDone"in l&&(d=l.onDone),"profile"in l&&(f=!!l.profile),"pixelRatio"in l&&(A=+l.pixelRatio))),e&&("canvas"===e.nodeName.toLowerCase()?i=e:n=e),!r){if(!i){if(!(e=o(n||document.body,d,A)))return null;i=e.canvas,p=e.onDestroy}void 0===t.premultipliedAlpha&&(t.premultipliedAlpha=!0),r=s(i,t)}return r?{gl:r,canvas:i,container:n,extensions:u,optionalExtensions:c,pixelRatio:A,profile:f,onDone:d,onDestroy:p}:(p(),d("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function u(t,e){function n(e){var n;e=e.toLowerCase();try{n=i[e]=t.getExtension(e)}catch(r){}return!!n}for(var i={},r=0;r<e.extensions.length;++r){var o=e.extensions[r];if(!n(o))return e.onDestroy(),e.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(n),{extensions:i,restore:function(){Object.keys(i).forEach((function(t){if(i[t]&&!n(t))throw Error("(regl): error restoring extension "+t)}))}}}function c(t,e){for(var n=Array(t),i=0;i<t;++i)n[i]=e(i);return n}function A(t){var e,n;return e=(65535<t)<<4,e|=n=(255<(t>>>=e))<<3,(e|=n=(15<(t>>>=n))<<2)|(n=(3<(t>>>=n))<<1)|t>>>n>>1}function f(){function t(t){t:{for(var e=16;268435456>=e;e*=16)if(t<=e){t=e;break t}t=0}return 0<(e=n[A(t)>>2]).length?e.pop():new ArrayBuffer(t)}function e(t){n[A(t.byteLength)>>2].push(t)}var n=c(8,(function(){return[]}));return{alloc:t,free:e,allocType:function(e,n){var i=null;switch(e){case 5120:i=new Int8Array(t(n),0,n);break;case 5121:i=new Uint8Array(t(n),0,n);break;case 5122:i=new Int16Array(t(2*n),0,n);break;case 5123:i=new Uint16Array(t(2*n),0,n);break;case 5124:i=new Int32Array(t(4*n),0,n);break;case 5125:i=new Uint32Array(t(4*n),0,n);break;case 5126:i=new Float32Array(t(4*n),0,n);break;default:return null}return i.length!==n?i.subarray(0,n):i},freeType:function(t){e(t.buffer)}}}function d(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||et(t.data))}function p(t,e,n,i,r,o){for(var s=0;s<e;++s)for(var a=t[s],h=0;h<n;++h)for(var l=a[h],u=0;u<i;++u)r[o++]=l[u]}function g(t,e,n,i,r){for(var o=1,s=n+1;s<e.length;++s)o*=e[s];var a=e[n];if(4==e.length-n){var h=e[n+1],l=e[n+2];for(e=e[n+3],s=0;s<a;++s)p(t[s],h,l,e,i,r),r+=o}else for(s=0;s<a;++s)g(t[s],e,n+1,i,r),r+=o}function m(t){return 0|rt[Object.prototype.toString.call(t)]}function y(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function v(t,e,n,i,r,o,s){for(var a=0,h=0;h<n;++h)for(var l=0;l<i;++l)t[a++]=e[r*h+o*l+s]}function _(t,e,n,i){function r(e){this.id=h++,this.buffer=t.createBuffer(),this.type=e,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,n.profile&&(this.stats={size:0})}function o(e,n,i){e.byteLength=n.byteLength,t.bufferData(e.type,n,i)}function s(t,e,n,i,r,s){if(t.usage=n,Array.isArray(e)){if(t.dtype=i||5126,0<e.length)if(Array.isArray(e[0])){r=ht(e);for(var a=i=1;a<r.length;++a)i*=r[a];t.dimension=i,o(t,e=at(e,r,t.dtype),n),s?t.persistentData=e:$.freeType(e)}else"number"==typeof e[0]?(t.dimension=r,y(r=$.allocType(t.dtype,e.length),e),o(t,r,n),s?t.persistentData=r:$.freeType(r)):et(e[0])&&(t.dimension=e[0].length,t.dtype=i||m(e[0])||5126,o(t,e=at(e,[e.length,e[0].length],t.dtype),n),s?t.persistentData=e:$.freeType(e))}else if(et(e))t.dtype=i||m(e),t.dimension=r,o(t,e,n),s&&(t.persistentData=new Uint8Array(new Uint8Array(e.buffer)));else if(d(e)){var h=e.stride,l=(a=e.offset,0),u=0,c=0,A=0;1===(r=e.shape).length?(l=r[0],u=1,c=h[0],A=0):2===r.length&&(l=r[0],u=r[1],c=h[0],A=h[1]),t.dtype=i||m(e.data)||5126,t.dimension=u,v(r=$.allocType(t.dtype,l*u),e.data,l,u,c,A,a),o(t,r,n),s?t.persistentData=r:$.freeType(r)}else e instanceof ArrayBuffer&&(t.dtype=5121,t.dimension=r,o(t,e,n),s&&(t.persistentData=new Uint8Array(new Uint8Array(e))))}function a(n){e.bufferCount--,i(n),t.deleteBuffer(n.buffer),n.buffer=null,delete l[n.id]}var h=0,l={};r.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},r.prototype.destroy=function(){a(this)};var u=[];return n.profile&&(e.getTotalBufferSize=function(){var t=0;return Object.keys(l).forEach((function(e){t+=l[e].stats.size})),t}),{create:function(i,o,h,u){function c(e){var i=35044,r=null,o=0,a=0,h=A&&A.dimension||1;return Array.isArray(e)||et(e)||d(e)||e instanceof ArrayBuffer?r=e:"number"==typeof e?o=0|e:e&&("data"in e&&(r=e.data),"usage"in e&&(i=st[e.usage]),"type"in e&&(a=ot[e.type]),"dimension"in e&&(h=0|e.dimension),"length"in e&&(o=0|e.length)),A.bind(),r?s(A,r,i,a,h,u):(o&&t.bufferData(A.type,o,i),A.dtype=a||5121,A.usage=i,A.dimension=h,A.byteLength=o),n.profile&&(A.stats.size=A.byteLength*lt[A.dtype]),c}e.bufferCount++;var A=new r(o);return l[A.id]=A,h||c(i),c._reglType="buffer",c._buffer=A,c.subdata=function(e,n){var i,r=0|(n||0);if(A.bind(),et(e)||e instanceof ArrayBuffer)t.bufferSubData(A.type,r,e);else if(Array.isArray(e)){if(0<e.length)if("number"==typeof e[0]){var o=$.allocType(A.dtype,e.length);y(o,e),t.bufferSubData(A.type,r,o),$.freeType(o)}else(Array.isArray(e[0])||et(e[0]))&&(i=ht(e),o=at(e,i,A.dtype),t.bufferSubData(A.type,r,o),$.freeType(o))}else if(d(e)){var s=e.stride,a=o=0,h=0,l=0;1===(i=e.shape).length?(o=i[0],a=1,h=s[0],l=0):2===i.length&&(o=i[0],a=i[1],h=s[0],l=s[1]),i=Array.isArray(e.data)?A.dtype:m(e.data),v(i=$.allocType(i,o*a),e.data,o,a,h,l,e.offset),t.bufferSubData(A.type,r,i),$.freeType(i)}return c},n.profile&&(c.stats=A.stats),c.destroy=function(){a(A)},c},createStream:function(t,e){var n=u.pop();return n||(n=new r(t)),n.bind(),s(n,e,35040,0,1,!1),n},destroyStream:function(t){u.push(t)},clear:function(){nt(l).forEach(a),u.forEach(a)},getBuffer:function(t){return t&&t._buffer instanceof r?t._buffer:null},restore:function(){nt(l).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))},_initBuffer:s}}function x(t,e,n,i){function r(t){this.id=h++,a[this.id]=this,this.buffer=t,this.primType=4,this.type=this.vertCount=0}function o(i,r,o,s,a,h,l){var u;if(i.buffer.bind(),r?((u=l)||et(r)&&(!d(r)||et(r.data))||(u=e.oes_element_index_uint?5125:5123),n._initBuffer(i.buffer,r,o,u,3)):(t.bufferData(34963,h,o),i.buffer.dtype=u||5121,i.buffer.usage=o,i.buffer.dimension=3,i.buffer.byteLength=h),u=l,!l){switch(i.buffer.dtype){case 5121:case 5120:u=5121;break;case 5123:case 5122:u=5123;break;case 5125:case 5124:u=5125}i.buffer.dtype=u}i.type=u,0>(r=a)&&(r=i.buffer.byteLength,5123===u?r>>=1:5125===u&&(r>>=2)),i.vertCount=r,r=s,0>s&&(r=4,1===(s=i.buffer.dimension)&&(r=0),2===s&&(r=1),3===s&&(r=4)),i.primType=r}function s(t){i.elementsCount--,delete a[t.id],t.buffer.destroy(),t.buffer=null}var a={},h=0,l={uint8:5121,uint16:5123};e.oes_element_index_uint&&(l.uint32=5125),r.prototype.bind=function(){this.buffer.bind()};var u=[];return{create:function(t,e){function a(t){if(t)if("number"==typeof t)h(t),u.primType=4,u.vertCount=0|t,u.type=5121;else{var e=null,n=35044,i=-1,r=-1,s=0,c=0;Array.isArray(t)||et(t)||d(t)?e=t:("data"in t&&(e=t.data),"usage"in t&&(n=st[t.usage]),"primitive"in t&&(i=ut[t.primitive]),"count"in t&&(r=0|t.count),"type"in t&&(c=l[t.type]),"length"in t?s=0|t.length:(s=r,5123===c||5122===c?s*=2:5125!==c&&5124!==c||(s*=4))),o(u,e,n,i,r,s,c)}else h(),u.primType=4,u.vertCount=0,u.type=5121;return a}var h=n.create(null,34963,!0),u=new r(h._buffer);return i.elementsCount++,a(t),a._reglType="elements",a._elements=u,a.subdata=function(t,e){return h.subdata(t,e),a},a.destroy=function(){s(u)},a},createStream:function(t){var e=u.pop();return e||(e=new r(n.create(null,34963,!0,!1)._buffer)),o(e,t,35040,-1,-1,0,0),e},destroyStream:function(t){u.push(t)},getElements:function(t){return"function"==typeof t&&t._elements instanceof r?t._elements:null},clear:function(){nt(a).forEach(s)}}}function b(t){for(var e=$.allocType(5123,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(1/0===t[n])e[n]=31744;else if(-1/0===t[n])e[n]=64512;else{ct[0]=t[n];var i=(o=At[0])>>>31<<15,r=(o<<1>>>24)-127,o=o>>13&1023;e[n]=-24>r?i:-14>r?i+(o+1024>>-14-r):15<r?i+31744:i+(r+15<<10)+o}return e}function w(t){return Array.isArray(t)||et(t)}function C(t){return"[object "+t+"]"}function P(t){return Array.isArray(t)&&(0===t.length||"number"==typeof t[0])}function M(t){return!(!Array.isArray(t)||0===t.length||!w(t[0]))}function T(t){return Object.prototype.toString.call(t)}function S(t){if(!t)return!1;var e=T(t);return 0<=bt.indexOf(e)||P(t)||M(t)||d(t)}function I(t,e){36193===t.type?(t.data=b(e),$.freeType(e)):t.data=e}function E(t,e,n,i,r,o){if(t=void 0!==Ct[t]?Ct[t]:pt[t]*wt[e],o&&(t*=6),r){for(i=0;1<=n;)i+=t*n*n,n/=2;return i}return t*n*i}function O(t,e,n,i,r,o,s){function a(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function h(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function l(t,e){if("object"==typeof e&&e){"premultiplyAlpha"in e&&(t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(t.flipY=e.flipY),"alignment"in e&&(t.unpackAlignment=e.alignment),"colorSpace"in e&&(t.colorSpace=U[e.colorSpace]),"type"in e&&(t.type=G[e.type]);var n=t.width,i=t.height,r=t.channels,o=!1;"shape"in e?(n=e.shape[0],i=e.shape[1],3===e.shape.length&&(r=e.shape[2],o=!0)):("radius"in e&&(n=i=e.radius),"width"in e&&(n=e.width),"height"in e&&(i=e.height),"channels"in e&&(r=e.channels,o=!0)),t.width=0|n,t.height=0|i,t.channels=0|r,n=!1,"format"in e&&(i=t.internalformat=V[n=e.format],t.format=ot[i],n in G&&!("type"in e)&&(t.type=G[n]),n in W&&(t.compressed=!0),n=!0),!o&&n?t.channels=pt[t.format]:o&&!n&&t.channels!==dt[t.format]&&(t.format=t.internalformat=dt[t.channels])}}function u(e){t.pixelStorei(37440,e.flipY),t.pixelStorei(37441,e.premultiplyAlpha),t.pixelStorei(37443,e.colorSpace),t.pixelStorei(3317,e.unpackAlignment)}function c(){a.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function A(t,e){var n=null;if(S(e)?n=e:e&&(l(t,e),"x"in e&&(t.xOffset=0|e.x),"y"in e&&(t.yOffset=0|e.y),S(e.data)&&(n=e.data)),e.copy){var i=r.viewportWidth,o=r.viewportHeight;t.width=t.width||i-t.xOffset,t.height=t.height||o-t.yOffset,t.needsCopy=!0}else if(n){if(et(n))t.channels=t.channels||4,t.data=n,"type"in e||5121!==t.type||(t.type=0|rt[Object.prototype.toString.call(n)]);else if(P(n)){switch(t.channels=t.channels||4,o=(i=n).length,t.type){case 5121:case 5123:case 5125:case 5126:(o=$.allocType(t.type,o)).set(i),t.data=o;break;case 36193:t.data=b(i)}t.alignment=1,t.needsFree=!0}else if(d(n)){i=n.data,Array.isArray(i)||5121!==t.type||(t.type=0|rt[Object.prototype.toString.call(i)]);var s,a,h,u,c=n.stride;3===(o=n.shape).length?(h=o[2],u=c[2]):u=h=1,s=o[0],a=o[1],o=c[0],c=c[1],t.alignment=1,t.width=s,t.height=a,t.channels=h,t.format=t.internalformat=dt[h],t.needsFree=!0,s=u,n=n.offset;for(var A=$.allocType(36193===t.type?5126:t.type,(h=t.width)*(u=t.height)*(a=t.channels)),f=0,p=0;p<u;++p)for(var g=0;g<h;++g)for(var m=0;m<a;++m)A[f++]=i[o*g+c*p+s*m+n];I(t,A)}else if(T(n)===gt||T(n)===mt||T(n)===yt)t.element=T(n)===gt||T(n)===mt?n:n.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(T(n)===vt)t.element=n,t.width=n.width,t.height=n.height,t.channels=4;else if(T(n)===_t)t.element=n,t.width=n.naturalWidth,t.height=n.naturalHeight,t.channels=4;else if(T(n)===xt)t.element=n,t.width=n.videoWidth,t.height=n.videoHeight,t.channels=4;else if(M(n)){for(i=t.width||n[0].length,o=t.height||n.length,c=t.channels,c=w(n[0][0])?c||n[0][0].length:c||1,s=it.shape(n),h=1,u=0;u<s.length;++u)h*=s[u];h=$.allocType(36193===t.type?5126:t.type,h),it.flatten(n,s,"",h),I(t,h),t.alignment=1,t.width=i,t.height=o,t.channels=c,t.format=t.internalformat=dt[c],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4}function f(e,n,r,o,s){var a=e.element,h=e.data,l=e.internalformat,c=e.format,A=e.type,f=e.width,d=e.height;u(e),a?t.texSubImage2D(n,s,r,o,c,A,a):e.compressed?t.compressedTexSubImage2D(n,s,r,o,l,f,d,h):e.needsCopy?(i(),t.copyTexSubImage2D(n,s,r,o,e.xOffset,e.yOffset,f,d)):t.texSubImage2D(n,s,r,o,f,d,c,A,h)}function p(){return st.pop()||new c}function g(t){t.needsFree&&$.freeType(t.data),c.call(t),st.push(t)}function m(){a.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function y(t,e,n){var i=t.images[0]=p();t.mipmask=1,i.width=t.width=e,i.height=t.height=n,i.channels=t.channels=4}function v(t,e){var n=null;if(S(e))h(n=t.images[0]=p(),t),A(n,e),t.mipmask=1;else if(l(t,e),Array.isArray(e.mipmap))for(var i=e.mipmap,r=0;r<i.length;++r)h(n=t.images[r]=p(),t),n.width>>=r,n.height>>=r,A(n,i[r]),t.mipmask|=1<<r;else h(n=t.images[0]=p(),t),A(n,e),t.mipmask=1;h(t,t.images[0])}function _(e,n){for(var r=e.images,o=0;o<r.length&&r[o];++o){var s=r[o],a=n,h=o,l=s.element,c=s.data,A=s.internalformat,f=s.format,d=s.type,p=s.width,g=s.height;u(s),l?t.texImage2D(a,h,f,f,d,l):s.compressed?t.compressedTexImage2D(a,h,A,Math.max(1,p),Math.max(1,g),0,c):s.needsCopy?(i(),t.copyTexImage2D(a,h,f,s.xOffset,s.yOffset,p,g,0)):t.texImage2D(a,h,f,p,g,0,f,d,c||null)}}function x(){var t=at.pop()||new m;a.call(t);for(var e=t.mipmask=0;16>e;++e)t.images[e]=null;return t}function C(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&g(e[n]),e[n]=null;at.push(t)}function O(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function R(t,e){"min"in e&&(t.minFilter=j[e.min],0<=ft.indexOf(t.minFilter)&&!("faces"in e)&&(t.genMipmaps=!0)),"mag"in e&&(t.magFilter=H[e.mag]);var n=t.wrapS,i=t.wrapT;if("wrap"in e){var r=e.wrap;"string"==typeof r?n=i=B[r]:Array.isArray(r)&&(n=B[r[0]],i=B[r[1]])}else"wrapS"in e&&(n=B[e.wrapS]),"wrapT"in e&&(i=B[e.wrapT]);if(t.wrapS=n,t.wrapT=i,"anisotropic"in e&&(t.anisotropic=e.anisotropic),"mipmap"in e){switch(n=!1,typeof e.mipmap){case"string":t.mipmapHint=z[e.mipmap],n=t.genMipmaps=!0;break;case"boolean":n=t.genMipmaps=e.mipmap;break;case"object":t.genMipmaps=!1,n=!0}!n||"min"in e||(t.minFilter=9984)}}function D(n,i){t.texParameteri(i,10241,n.minFilter),t.texParameteri(i,10240,n.magFilter),t.texParameteri(i,10242,n.wrapS),t.texParameteri(i,10243,n.wrapT),e.ext_texture_filter_anisotropic&&t.texParameteri(i,34046,n.anisotropic),n.genMipmaps&&(t.hint(33170,n.mipmapHint),t.generateMipmap(i))}function k(e){a.call(this),this.mipmask=0,this.internalformat=6408,this.id=ht++,this.refCount=1,this.target=e,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new O,s.profile&&(this.stats={size:0})}function L(e){t.activeTexture(33984),t.bindTexture(e.target,e.texture)}function F(){var e=ct[0];e?t.bindTexture(e.target,e.texture):t.bindTexture(3553,null)}function N(e){var n=e.texture,i=e.unit,r=e.target;0<=i&&(t.activeTexture(33984+i),t.bindTexture(r,null),ct[i]=null),t.deleteTexture(n),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete lt[e.id],o.textureCount--}var z={"don't care":4352,"dont care":4352,nice:4354,fast:4353},B={repeat:10497,clamp:33071,mirror:33648},H={nearest:9728,linear:9729},j=Q({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},H),U={none:0,browser:37444},G={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},V={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},W={};e.ext_srgb&&(V.srgb=35904,V.srgba=35906),e.oes_texture_float&&(G.float32=G.float=5126),e.oes_texture_half_float&&(G.float16=G["half float"]=36193),e.webgl_depth_texture&&(Q(V,{depth:6402,"depth stencil":34041}),Q(G,{uint16:5123,uint32:5125,"depth stencil":34042})),e.webgl_compressed_texture_s3tc&&Q(W,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),e.webgl_compressed_texture_atc&&Q(W,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),e.webgl_compressed_texture_pvrtc&&Q(W,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),e.webgl_compressed_texture_etc1&&(W["rgb etc1"]=36196);var q=Array.prototype.slice.call(t.getParameter(34467));Object.keys(W).forEach((function(t){var e=W[t];0<=q.indexOf(e)&&(V[t]=e)}));var Z=Object.keys(V);n.textureFormats=Z;var X=[];Object.keys(V).forEach((function(t){X[V[t]]=t}));var Y=[];Object.keys(G).forEach((function(t){Y[G[t]]=t}));var J=[];Object.keys(H).forEach((function(t){J[H[t]]=t}));var K=[];Object.keys(j).forEach((function(t){K[j[t]]=t}));var tt=[];Object.keys(B).forEach((function(t){tt[B[t]]=t}));var ot=Z.reduce((function(t,n){var i=V[n];return t[i]=6409===i||6406===i||6409===i||6410===i||6402===i||34041===i||e.ext_srgb&&(35904===i||35906===i)?i:32855===i||0<=n.indexOf("rgba")?6408:6407,t}),{}),st=[],at=[],ht=0,lt={},ut=n.maxTextureUnits,ct=Array(ut).map((function(){return null}));return Q(k.prototype,{bind:function(){this.bindCount+=1;var e=this.unit;if(0>e){for(var n=0;n<ut;++n){var i=ct[n];if(i){if(0<i.bindCount)continue;i.unit=-1}ct[n]=this,e=n;break}s.profile&&o.maxTextureUnits<e+1&&(o.maxTextureUnits=e+1),this.unit=e,t.activeTexture(33984+e),t.bindTexture(this.target,this.texture)}return e},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&N(this)}}),s.profile&&(o.getTotalTextureSize=function(){var t=0;return Object.keys(lt).forEach((function(e){t+=lt[e].stats.size})),t}),{create2D:function(e,n){function i(e,n){var o=r.texInfo;O.call(o),o.version=t instanceof WebGL2RenderingContext?2:1;var a=x();return"number"==typeof e?y(a,0|e,"number"==typeof n?0|n:0|e):e?(R(o,e),v(a,e)):y(a,1,1),o.genMipmaps&&(a.mipmask=(Math.max(a.width,a.height)<<1)-1),r.mipmask=a.mipmask,h(r,a),r.internalformat=a.internalformat,i.width=a.width,i.height=a.height,L(r),_(a,3553),D(o,3553),F(),C(a),s.profile&&(r.stats.size=E(r.internalformat,r.type,a.width,a.height,o.genMipmaps,!1)),i.format=X[r.internalformat],i.type=Y[r.type],i.mag=J[o.magFilter],i.min=K[o.minFilter],i.wrapS=tt[o.wrapS],i.wrapT=tt[o.wrapT],i}var r=new k(3553);return lt[r.id]=r,o.textureCount++,i(e,n),i.subimage=function(t,e,n,o){e|=0,n|=0,o|=0;var s=p();return h(s,r),s.width=0,s.height=0,A(s,t),s.width=s.width||(r.width>>o)-e,s.height=s.height||(r.height>>o)-n,L(r),f(s,3553,e,n,o),F(),g(s),i},i.resize=function(e,n){var o=0|e,a=0|n||o;if(o===r.width&&a===r.height)return i;i.width=r.width=o,i.height=r.height=a,L(r);for(var h=0;r.mipmask>>h;++h){var l=o>>h,u=a>>h;if(!l||!u)break;t.texImage2D(3553,h,r.format,l,u,0,r.format,r.type,null)}return F(),s.profile&&(r.stats.size=E(r.internalformat,r.type,o,a,!1,!1)),i},i._reglType="texture2d",i._texture=r,s.profile&&(i.stats=r.stats),i.destroy=function(){r.decRef()},i},createCube:function(e,n,i,r,a,u){function c(t,e,n,i,r,o){var a,u=d.texInfo;for(O.call(u),a=0;6>a;++a)m[a]=x();if("number"!=typeof t&&t){if("object"==typeof t)if(e)v(m[0],t),v(m[1],e),v(m[2],n),v(m[3],i),v(m[4],r),v(m[5],o);else if(R(u,t),l(d,t),"faces"in t)for(t=t.faces,a=0;6>a;++a)h(m[a],d),v(m[a],t[a]);else for(a=0;6>a;++a)v(m[a],t)}else for(t=0|t||1,a=0;6>a;++a)y(m[a],t,t);for(h(d,m[0]),d.mipmask=u.genMipmaps?(Math.max(m[0].width,m[0].height)<<1)-1:m[0].mipmask,d.internalformat=m[0].internalformat,c.width=m[0].width,c.height=m[0].height,L(d),a=0;6>a;++a)_(m[a],34069+a);for(D(u,34067),F(),s.profile&&(d.stats.size=E(d.internalformat,d.type,c.width,c.height,u.genMipmaps,!0)),c.format=X[d.internalformat],c.type=Y[d.type],c.mag=J[u.magFilter],c.min=K[u.minFilter],c.wrapS=tt[u.wrapS],c.wrapT=tt[u.wrapT],a=0;6>a;++a)C(m[a]);return c}var d=new k(34067);lt[d.id]=d,o.cubeCount++;var m=Array(6);return c(e,n,i,r,a,u),c.subimage=function(t,e,n,i,r){n|=0,i|=0,r|=0;var o=p();return h(o,d),o.width=0,o.height=0,A(o,e),o.width=o.width||(d.width>>r)-n,o.height=o.height||(d.height>>r)-i,L(d),f(o,34069+t,n,i,r),F(),g(o),c},c.resize=function(e){if((e|=0)!==d.width){c.width=d.width=e,c.height=d.height=e,L(d);for(var n=0;6>n;++n)for(var i=0;d.mipmask>>i;++i)t.texImage2D(34069+n,i,d.format,e>>i,e>>i,0,d.format,d.type,null);return F(),s.profile&&(d.stats.size=E(d.internalformat,d.type,c.width,c.height,!1,!0)),c}},c._reglType="textureCube",c._texture=d,s.profile&&(c.stats=d.stats),c.destroy=function(){d.decRef()},c},clear:function(){for(var e=0;e<ut;++e)t.activeTexture(33984+e),t.bindTexture(3553,null),ct[e]=null;nt(lt).forEach(N),o.cubeCount=0,o.textureCount=0},getTexture:function(t){return null},restore:function(){for(var e=0;e<ut;++e){var n=ct[e];n&&(n.bindCount=0,n.unit=-1,ct[e]=null)}nt(lt).forEach((function(e){e.texture=t.createTexture(),t.bindTexture(e.target,e.texture);for(var n=0;32>n;++n)if(e.mipmask&1<<n)if(3553===e.target)t.texImage2D(3553,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);else for(var i=0;6>i;++i)t.texImage2D(34069+i,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);D(e.texInfo,e.target)}))},refresh:function(){for(var e=0;e<ut;++e){var n=ct[e];n&&(n.bindCount=0,n.unit=-1,ct[e]=null),t.activeTexture(33984+e),t.bindTexture(3553,null),t.bindTexture(34067,null)}}}}function R(t,e,n,i,r,o){function s(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var i=t=0;e?(t=e.width,i=e.height):n&&(t=n.width,i=n.height),this.width=t,this.height=i}function a(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function h(t,e,n){t&&(t.texture?t.texture._texture.refCount+=1:t.renderbuffer._renderbuffer.refCount+=1)}function l(e,n){n&&(n.texture?t.framebufferTexture2D(36160,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(36160,e,36161,n.renderbuffer._renderbuffer.renderbuffer))}function u(t){var e=3553,n=null,i=null,r=t;return"object"==typeof t&&(r=t.data,"target"in t&&(e=0|t.target)),"texture2d"===(t=r._reglType)||"textureCube"===t?n=r:"renderbuffer"===t&&(i=r,e=36161),new s(e,n,i)}function c(t,e,n,o,a){return n?((t=i.create2D({width:t,height:e,format:o,type:a}))._texture.refCount=0,new s(3553,t,null)):((t=r.create({width:t,height:e,format:o}))._renderbuffer.refCount=0,new s(36161,null,t))}function A(t){return t&&(t.texture||t.renderbuffer)}function f(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}function d(){this.id=w++,C[this.id]=this,this.framebuffer=t.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function p(t){t.colorAttachments.forEach(a),a(t.depthAttachment),a(t.stencilAttachment),a(t.depthStencilAttachment)}function g(e){t.deleteFramebuffer(e.framebuffer),e.framebuffer=null,o.framebufferCount--,delete C[e.id]}function m(e,i){var r;t.bindFramebuffer(36160,e.framebuffer);var o=e.colorAttachments;for(r=0;r<o.length;++r)l(36064+r,o[r]);for(r=o.length;r<n.maxColorAttachments;++r)t.framebufferTexture2D(36160,36064+r,3553,null,0);t.framebufferTexture2D(36160,33306,3553,null,0),t.framebufferTexture2D(36160,36096,3553,null,0),t.framebufferTexture2D(36160,36128,3553,null,0),l(36096,e.depthAttachment),l(36128,e.stencilAttachment),l(33306,e.depthStencilAttachment),i||(t.checkFramebufferStatus(36160),t.isContextLost()),t.bindFramebuffer(36160,v.next?v.next.framebuffer:null),v.cur=v.next,i||t.getError()}function y(e,n){function i(t,e){var n,o=0,s=0,a=!0,l=!0;n=null;var f=!0,d="rgba",g="uint8",y=1,v=null,b=null,w=null,C=!1;if("number"==typeof t)o=0|t,s=0|e||o;else if(t){var P=t;"shape"in P?(o=(s=P.shape)[0],s=s[1]):("radius"in P&&(o=s=P.radius),"width"in P&&(o=P.width),"height"in P&&(s=P.height)),("color"in P||"colors"in P)&&(n=P.color||P.colors),n||("colorCount"in P&&(y=0|P.colorCount),"colorTexture"in P&&(f=!!P.colorTexture,d="rgba4"),"colorType"in P&&(g=P.colorType,!f)&&("half float"===g||"float16"===g?d="rgba16f":"float"!==g&&"float32"!==g||(d="rgba32f")),"colorFormat"in P&&(0<=_.indexOf(d=P.colorFormat)?f=!0:0<=x.indexOf(d)&&(f=!1))),("depthTexture"in P||"depthStencilTexture"in P)&&(C=!(!P.depthTexture&&!P.depthStencilTexture)),"depth"in P&&("boolean"==typeof P.depth?a=P.depth:(v=P.depth,l=!1)),"stencil"in P&&("boolean"==typeof P.stencil?l=P.stencil:(b=P.stencil,a=!1)),"depthStencil"in P&&("boolean"==typeof P.depthStencil?a=l=P.depthStencil:(w=P.depthStencil,l=a=!1))}else o=s=1;var M=null,T=null,S=null,I=null;if(Array.isArray(n))M=n.map(u);else if(n)M=[u(n)];else for(M=Array(y),n=0;n<y;++n)M[n]=c(o,s,f,d,g);for(o=o||M[0].width,s=s||M[0].height,v?T=u(v):a&&!l&&(T=c(o,s,C,"depth","uint32")),b?S=u(b):l&&!a&&(S=c(o,s,!1,"stencil","uint8")),w?I=u(w):!v&&!b&&l&&a&&(I=c(o,s,C,"depth stencil","depth stencil")),a=null,n=0;n<M.length;++n)h(M[n]),M[n]&&M[n].texture&&(l=Tt[M[n].texture._texture.format]*St[M[n].texture._texture.type],null===a&&(a=l));return h(T),h(S),h(I),p(r),r.width=o,r.height=s,r.colorAttachments=M,r.depthAttachment=T,r.stencilAttachment=S,r.depthStencilAttachment=I,i.color=M.map(A),i.depth=A(T),i.stencil=A(S),i.depthStencil=A(I),i.width=r.width,i.height=r.height,m(r,P&&P.ignoreStatusCheck),i}var r=new d;return o.framebufferCount++,i(e,n),Q(i,{resize:function(t,e){var n=Math.max(0|t,1),o=Math.max(0|e||n,1);if(n===r.width&&o===r.height)return i;for(var s=r.colorAttachments,a=0;a<s.length;++a)f(s[a],n,o);return f(r.depthAttachment,n,o),f(r.stencilAttachment,n,o),f(r.depthStencilAttachment,n,o),r.width=i.width=n,r.height=i.height=o,m(r),i},blit:function(e,n,i){t.bindFramebuffer(36008,e._framebuffer.framebuffer),t.bindFramebuffer(36009,r.framebuffer),n||(n=16384),t.blitFramebuffer(0,0,e.width,e.height,0,0,r.width,r.height,n,"linear"===i?9729:9728),t.bindFramebuffer(36008,null),t.bindFramebuffer(36009,null)},_reglType:"framebuffer",_framebuffer:r,destroy:function(){g(r),p(r)},use:function(t){v.setFBO({framebuffer:i},t)}})}var v={cur:null,next:null,dirty:!1,setFBO:null},_=["rgba"],x=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&x.push("srgba"),e.ext_color_buffer_half_float&&x.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&x.push("rgba32f");var b=["uint8"];e.oes_texture_half_float&&b.push("half float","float16"),e.oes_texture_float&&b.push("float","float32");var w=0,C={};return Q(v,{getFramebuffer:function(t){return"function"==typeof t&&"framebuffer"===t._reglType&&(t=t._framebuffer)instanceof d?t:null},create:y,createCube:function(t){function e(t){var r,o={color:null},s=0,a=null;r="rgba";var h="uint8",l=1;if("number"==typeof t?s=0|t:t?("shape"in t?s=t.shape[0]:("radius"in t&&(s=0|t.radius),"width"in t?s=0|t.width:"height"in t&&(s=0|t.height)),("color"in t||"colors"in t)&&(a=t.color||t.colors),a||("colorCount"in t&&(l=0|t.colorCount),"colorType"in t&&(h=t.colorType),"colorFormat"in t&&(r=t.colorFormat)),"depth"in t&&(o.depth=t.depth),"stencil"in t&&(o.stencil=t.stencil),"depthStencil"in t&&(o.depthStencil=t.depthStencil)):s=1,a)if(Array.isArray(a))for(t=[],r=0;r<a.length;++r)t[r]=a[r];else t=[a];else for(t=Array(l),a={radius:s,format:r,type:h},r=0;r<l;++r)t[r]=i.createCube(a);for(o.color=Array(t.length),r=0;r<t.length;++r)l=t[r],s=s||l.width,o.color[r]={target:34069,data:t[r]};for(r=0;6>r;++r){for(l=0;l<t.length;++l)o.color[l].target=34069+r;0<r&&(o.depth=n[0].depth,o.stencil=n[0].stencil,o.depthStencil=n[0].depthStencil),n[r]?n[r](o):n[r]=y(o)}return Q(e,{width:s,height:s,color:t})}var n=Array(6);return e(t),Q(e,{faces:n,resize:function(t){var i=0|t;if(i===e.width)return e;var r=e.color;for(t=0;t<r.length;++t)r[t].resize(i);for(t=0;6>t;++t)n[t].resize(i);return e.width=e.height=i,e},_reglType:"framebufferCube",destroy:function(){n.forEach((function(t){t.destroy()}))}})},clear:function(){nt(C).forEach(g)},restore:function(){v.cur=null,v.next=null,v.dirty=!0,nt(C).forEach((function(e){e.framebuffer=t.createFramebuffer(),m(e)}))}})}function D(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function k(t,e,n,i,r,o,s){function a(t){t!==m.currentVAO&&(e.oes_vertex_array_object.bindVertexArrayOES(t?t.vao:null),m.currentVAO=t)}function h(n){if(n!==m.currentVAO){if(n)n.bindAttrs();else{for(var i=e.angle_instanced_arrays,r=0;r<f.length;++r){var o=f[r];o.buffer?(t.enableVertexAttribArray(r),o.buffer.bind(),t.vertexAttribPointer(r,o.size,o.type,o.normalized,o.stride,o.offfset),i&&o.divisor&&i.vertexAttribDivisorANGLE(r,o.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,o.x,o.y,o.z,o.w))}t.bindBuffer(34963,s.elements?s.elements.buffer.buffer:null)}m.currentVAO=n}}function l(){nt(g).forEach((function(t){t.destroy()}))}function u(){this.id=++p,this.attributes=[],this.elements=null,this.ownsElements=!1,this.offset=this.count=0,this.instances=-1,this.primitive=4;var t=e.oes_vertex_array_object;this.vao=t?t.createVertexArrayOES():null,g[this.id]=this,this.buffers=[]}function c(){e.oes_vertex_array_object&&nt(g).forEach((function(t){t.refresh()}))}var A=n.maxAttributes,f=Array(A);for(n=0;n<A;++n)f[n]=new D;var p=0,g={},m={Record:D,scope:{},state:f,currentVAO:null,targetVAO:null,restore:e.oes_vertex_array_object?c:function(){},createVAO:function(t){function e(t){var i;Array.isArray(t)?(i=t,n.elements&&n.ownsElements&&n.elements.destroy(),n.elements=null,n.ownsElements=!1,n.offset=0,n.count=0,n.instances=-1,n.primitive=4):(t.elements?(i=t.elements,n.ownsElements?("function"==typeof i&&"elements"===i._reglType?n.elements.destroy():n.elements(i),n.ownsElements=!1):o.getElements(t.elements)?(n.elements=t.elements,n.ownsElements=!1):(n.elements=o.create(t.elements),n.ownsElements=!0)):(n.elements=null,n.ownsElements=!1),i=t.attributes,n.offset=0,n.count=-1,n.instances=-1,n.primitive=4,n.elements&&(n.count=n.elements._elements.vertCount,n.primitive=n.elements._elements.primType),"offset"in t&&(n.offset=0|t.offset),"count"in t&&(n.count=0|t.count),"instances"in t&&(n.instances=0|t.instances),"primitive"in t&&(n.primitive=ut[t.primitive])),t={};var s=n.attributes;s.length=i.length;for(var a=0;a<i.length;++a){var h,l=i[a],u=s[a]=new D,c=l.data||l;Array.isArray(c)||et(c)||d(c)?(n.buffers[a]&&(h=n.buffers[a],et(c)&&h._buffer.byteLength>=c.byteLength?h.subdata(c):(h.destroy(),n.buffers[a]=null)),n.buffers[a]||(h=n.buffers[a]=r.create(l,34962,!1,!0)),u.buffer=r.getBuffer(h),u.size=0|u.buffer.dimension,u.normalized=!1,u.type=u.buffer.dtype,u.offset=0,u.stride=0,u.divisor=0,u.state=1,t[a]=1):r.getBuffer(l)?(u.buffer=r.getBuffer(l),u.size=0|u.buffer.dimension,u.normalized=!1,u.type=u.buffer.dtype,u.offset=0,u.stride=0,u.divisor=0,u.state=1):r.getBuffer(l.buffer)?(u.buffer=r.getBuffer(l.buffer),u.size=0|(+l.size||u.buffer.dimension),u.normalized=!!l.normalized||!1,u.type="type"in l?ot[l.type]:u.buffer.dtype,u.offset=0|(l.offset||0),u.stride=0|(l.stride||0),u.divisor=0|(l.divisor||0),u.state=1):"x"in l&&(u.x=+l.x||0,u.y=+l.y||0,u.z=+l.z||0,u.w=+l.w||0,u.state=2)}for(h=0;h<n.buffers.length;++h)!t[h]&&n.buffers[h]&&(n.buffers[h].destroy(),n.buffers[h]=null);return n.refresh(),e}var n=new u;return i.vaoCount+=1,e.destroy=function(){for(var t=0;t<n.buffers.length;++t)n.buffers[t]&&n.buffers[t].destroy();n.buffers.length=0,n.ownsElements&&(n.elements.destroy(),n.elements=null,n.ownsElements=!1),n.destroy()},e._vao=n,e._reglType="vao",e(t)},getVAO:function(t){return"function"==typeof t&&t._vao?t._vao:null},destroyBuffer:function(e){for(var n=0;n<f.length;++n){var i=f[n];i.buffer===e&&(t.disableVertexAttribArray(n),i.buffer=null)}},setVAO:e.oes_vertex_array_object?a:h,clear:e.oes_vertex_array_object?l:function(){}};return u.prototype.bindAttrs=function(){for(var n=e.angle_instanced_arrays,i=this.attributes,r=0;r<i.length;++r){var s=i[r];s.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(34962,s.buffer.buffer),t.vertexAttribPointer(r,s.size,s.type,s.normalized,s.stride,s.offset),n&&s.divisor&&n.vertexAttribDivisorANGLE(r,s.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,s.x,s.y,s.z,s.w))}for(n=i.length;n<A;++n)t.disableVertexAttribArray(n);(n=o.getElements(this.elements))?t.bindBuffer(34963,n.buffer.buffer):t.bindBuffer(34963,null)},u.prototype.refresh=function(){var t=e.oes_vertex_array_object;t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),m.currentVAO=null,t.bindVertexArrayOES(null))},u.prototype.destroy=function(){if(this.vao){var t=e.oes_vertex_array_object;this===m.currentVAO&&(m.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),g[this.id]&&(delete g[this.id],--i.vaoCount)},m}function L(t,e,n,i){function r(t,e,n,i){this.name=t,this.id=e,this.location=n,this.info=i}function o(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function s(n,i,r){if(!(s=(r=35632===n?l:u)[i])){var o=e.str(i),s=t.createShader(n);t.shaderSource(s,o),t.compileShader(s),r[i]=s}return s}function a(t,e){this.id=f++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function h(n,a,h){var l;l=s(35632,n.fragId);var u=s(35633,n.vertId);if(a=n.program=t.createProgram(),t.attachShader(a,l),t.attachShader(a,u),h)for(l=0;l<h.length;++l)t.bindAttribLocation(a,(u=h[l])[0],u[1]);t.linkProgram(a),u=t.getProgramParameter(a,35718),i.profile&&(n.stats.uniformsCount=u);var c=n.uniforms;for(l=0;l<u;++l)if(h=t.getActiveUniform(a,l)){if(1<h.size)for(var A=0;A<h.size;++A){var f=h.name.replace("[0]","["+A+"]");o(c,new r(f,e.id(f),t.getUniformLocation(a,f),h))}A=h.name,1<h.size&&(A=A.replace("[0]","")),o(c,new r(A,e.id(A),t.getUniformLocation(a,A),h))}for(u=t.getProgramParameter(a,35721),i.profile&&(n.stats.attributesCount=u),n=n.attributes,l=0;l<u;++l)(h=t.getActiveAttrib(a,l))&&o(n,new r(h.name,e.id(h.name),t.getAttribLocation(a,h.name),h))}var l={},u={},c={},A=[],f=0;return i.profile&&(n.getMaxUniformsCount=function(){var t=0;return A.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},n.getMaxAttributesCount=function(){var t=0;return A.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);nt(l).forEach(e),l={},nt(u).forEach(e),u={},A.forEach((function(e){t.deleteProgram(e.program)})),A.length=0,c={},n.shaderCount=0},program:function(e,i,r,o){var s=c[i];s||(s=c[i]={});var f=s[e];if(f&&(f.refCount++,!o))return f;var d=new a(i,e);return n.shaderCount++,h(d,r,o),f||(s[e]=d),A.push(d),Q(d,{destroy:function(){if(d.refCount--,0>=d.refCount){t.deleteProgram(d.program);var e=A.indexOf(d);A.splice(e,1),n.shaderCount--}0>=s[d.vertId].refCount&&(t.deleteShader(u[d.vertId]),delete u[d.vertId],delete c[d.fragId][d.vertId]),Object.keys(c[d.fragId]).length||(t.deleteShader(l[d.fragId]),delete l[d.fragId],delete c[d.fragId])}})},restore:function(){l={},u={};for(var t=0;t<A.length;++t)h(A[t],null,A[t].attributes.map((function(t){return[t.location,t.name]})))},shader:s,frag:-1,vert:-1}}function F(t,e,n,i,r,o,s){function a(r){var o;o=null===e.next?5121:e.next.colorAttachments[0].texture._texture.type;var s=0,a=0,h=i.framebufferWidth,l=i.framebufferHeight,u=null;return et(r)?u=r:r&&(s=0|r.x,a=0|r.y,h=0|(r.width||i.framebufferWidth-s),l=0|(r.height||i.framebufferHeight-a),u=r.data||null),n(),r=h*l*4,u||(5121===o?u=new Uint8Array(r):5126===o&&(u=u||new Float32Array(r))),t.pixelStorei(3333,4),t.readPixels(s,a,h,l,6408,o,u),u}function h(t){var n;return e.setFBO({framebuffer:t.framebuffer},(function(){n=a(t)})),n}return function(t){return t&&"framebuffer"in t?h(t):a(t)}}function N(t){return Array.prototype.slice.call(t)}function z(t){return N(t).join("")}function B(){function t(){var t=[],e=[];return Q((function(){t.push.apply(t,N(arguments))}),{def:function(){var i="v"+n++;return e.push(i),0<arguments.length&&(t.push(i,"="),t.push.apply(t,N(arguments)),t.push(";")),i},toString:function(){return z([0<e.length?"var "+e.join(",")+";":"",z(t)])}})}function e(){function e(t,e){i(t,e,"=",n.def(t,e),";")}var n=t(),i=t(),r=n.toString,o=i.toString;return Q((function(){n.apply(n,N(arguments))}),{def:n.def,entry:n,exit:i,save:e,set:function(t,i,r){e(t,i),n(t,i,"=",r,";")},toString:function(){return r()+o()}})}var n=0,i=[],r=[],o=t(),s={};return{global:o,link:function(t){for(var e=0;e<r.length;++e)if(r[e]===t)return i[e];return e="g"+n++,i.push(e),r.push(t),e},block:t,proc:function(t,n){function i(){var t="a"+r.length;return r.push(t),t}var r=[];n=n||0;for(var o=0;o<n;++o)i();var a=(o=e()).toString;return s[t]=Q(o,{arg:i,toString:function(){return z(["function(",r.join(),"){",a(),"}"])}})},scope:e,cond:function(){var t=z(arguments),n=e(),i=e(),r=n.toString,o=i.toString;return Q(n,{then:function(){return n.apply(n,N(arguments)),this},else:function(){return i.apply(i,N(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),z(["if(",t,"){",r(),"}",e])}})},compile:function(){var t=['"use strict";',o,"return {"];Object.keys(s).forEach((function(e){t.push('"',e,'":',s[e].toString(),",")})),t.push("}");var e=z(t).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,i.concat(e)).apply(null,r)}}}function H(t){return Array.isArray(t)||et(t)||d(t)}function j(t){return t.sort((function(t,e){return"viewport"===t?-1:"viewport"===e?1:t<e?-1:1}))}function U(t,e,n,i){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=i}function G(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function V(t){return new U(!1,!1,!1,t)}function W(t,e){var n=t.type;if(0===n)return new U(!0,1<=(n=t.data.length),2<=n,e);if(4===n)return new U((n=t.data).thisDep,n.contextDep,n.propDep,e);if(5===n)return new U(!1,!1,!1,e);if(6===n){for(var i=n=!1,r=!1,o=0;o<t.data.length;++o){var s=t.data[o];1===s.type?r=!0:2===s.type?i=!0:3===s.type?n=!0:0===s.type?(n=!0,1<=(s=s.data)&&(i=!0),2<=s&&(r=!0)):4===s.type&&(n=n||s.data.thisDep,i=i||s.data.contextDep,r=r||s.data.propDep)}return new U(n,i,r,e)}return new U(3===n,2===n,1===n,e)}function q(t,e,n,i,r,o,s,a,h,l,u,A,f,d,p){function g(t){return t.replace(".","_")}function m(t,e,n){var i=g(t);dt.push(t),ft[i]=At[i]=!!n,pt[i]=e}function y(t,e,n){var i=g(t);dt.push(t),Array.isArray(n)?(At[i]=n.slice(),ft[i]=n.slice()):At[i]=ft[i]=n,gt[i]=e}function v(){var t=B(),n=t.link,i=t.global;t.id=vt++,t.batchId="0";var r=n(mt),o=t.shared={props:"a0"};Object.keys(mt).forEach((function(t){o[t]=i.def(r,".",t)}));var s=t.next={},a=t.current={};Object.keys(gt).forEach((function(t){Array.isArray(At[t])&&(s[t]=i.def(o.next,".",t),a[t]=i.def(o.current,".",t))}));var h=t.constants={};Object.keys(yt).forEach((function(t){h[t]=i.def(JSON.stringify(yt[t]))})),t.invoke=function(e,i){switch(i.type){case 0:var r=["this",o.context,o.props,t.batchId];return e.def(n(i.data),".call(",r.slice(0,Math.max(i.data.length+1,4)),")");case 1:return e.def(o.props,i.data);case 2:return e.def(o.context,i.data);case 3:return e.def("this",i.data);case 4:return i.data.append(t,e),i.data.ref;case 5:return i.data.toString();case 6:return i.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var u={};return t.scopeAttrib=function(t){if((t=e.id(t))in u)return u[t];var i=l.scope[t];return i||(i=l.scope[t]=new st),u[t]=n(i)},t}function _(t){var e,n=t.static;if(t=t.dynamic,"profile"in n){var i=!!n.profile;(e=V((function(t,e){return i}))).enable=i}else if("profile"in t){var r=t.profile;e=W(r,(function(t,e){return t.invoke(e,r)}))}return e}function x(t,e){var n=t.static,i=t.dynamic;if("framebuffer"in n){var r=n.framebuffer;return r?(r=a.getFramebuffer(r),V((function(t,e){var n=t.link(r),i=t.shared;return e.set(i.framebuffer,".next",n),e.set(i=i.context,".framebufferWidth",n+".width"),e.set(i,".framebufferHeight",n+".height"),n}))):V((function(t,e){var n=t.shared;return e.set(n.framebuffer,".next","null"),e.set(n=n.context,".framebufferWidth",n+".drawingBufferWidth"),e.set(n,".framebufferHeight",n+".drawingBufferHeight"),"null"}))}if("framebuffer"in i){var o=i.framebuffer;return W(o,(function(t,e){var n=t.invoke(e,o),i=t.shared,r=i.framebuffer;return n=e.def(r,".getFramebuffer(",n,")"),e.set(r,".next",n),e.set(i=i.context,".framebufferWidth",n+"?"+n+".width:"+i+".drawingBufferWidth"),e.set(i,".framebufferHeight",n+"?"+n+".height:"+i+".drawingBufferHeight"),n}))}return null}function b(t,e,n){function i(t){if(t in r){var n=r[t];t=!0;var i,s,a=0|n.x,h=0|n.y;return"width"in n?i=0|n.width:t=!1,"height"in n?s=0|n.height:t=!1,new U(!t&&e&&e.thisDep,!t&&e&&e.contextDep,!t&&e&&e.propDep,(function(t,e){var r=t.shared.context,o=i;"width"in n||(o=e.def(r,".","framebufferWidth","-",a));var l=s;return"height"in n||(l=e.def(r,".","framebufferHeight","-",h)),[a,h,o,l]}))}if(t in o){var l=o[t];return t=W(l,(function(t,e){var n=t.invoke(e,l),i=t.shared.context,r=e.def(n,".x|0"),o=e.def(n,".y|0");return[r,o,e.def('"width" in ',n,"?",n,".width|0:","(",i,".","framebufferWidth","-",r,")"),n=e.def('"height" in ',n,"?",n,".height|0:","(",i,".","framebufferHeight","-",o,")")]})),e&&(t.thisDep=t.thisDep||e.thisDep,t.contextDep=t.contextDep||e.contextDep,t.propDep=t.propDep||e.propDep),t}return e?new U(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".","framebufferWidth"),e.def(n,".","framebufferHeight")]})):null}var r=t.static,o=t.dynamic;if(t=i("viewport")){var s=t;t=new U(t.thisDep,t.contextDep,t.propDep,(function(t,e){var n=s.append(t,e),i=t.shared.context;return e.set(i,".viewportWidth",n[2]),e.set(i,".viewportHeight",n[3]),n}))}return{viewport:t,scissor_box:i("scissor.box")}}function C(t,e){if("string"==typeof(n=t.static).frag&&"string"==typeof n.vert){if(0<Object.keys(e.dynamic).length)return null;var n=e.static,i=Object.keys(n);if(0<i.length&&"number"==typeof n[i[0]]){for(var r=[],o=0;o<i.length;++o)r.push([0|n[i[o]],i[o]]);return r}}return null}function P(t,n,i){function r(t){if(t in o){var n=e.id(o[t]);return(t=V((function(){return n}))).id=n,t}if(t in s){var i=s[t];return W(i,(function(t,e){var n=t.invoke(e,i);return e.def(t.shared.strings,".id(",n,")")}))}return null}var o=t.static,s=t.dynamic,a=r("frag"),h=r("vert"),l=null;return G(a)&&G(h)?(l=u.program(h.id,a.id,null,i),t=V((function(t,e){return t.link(l)}))):t=new U(a&&a.thisDep||h&&h.thisDep,a&&a.contextDep||h&&h.contextDep,a&&a.propDep||h&&h.propDep,(function(t,e){var n,i,r=t.shared.shader;return n=a?a.append(t,e):e.def(r,".","frag"),i=h?h.append(t,e):e.def(r,".","vert"),e.def(r+".program("+i+","+n+")")})),{frag:a,vert:h,progVar:t,program:l}}function M(t,e){function n(t,e){if(t in i){var n=0|i[t];return e?s.offset=n:s.instances=n,V((function(t,i){return e&&(t.OFFSET=n),n}))}if(t in r){var o=r[t];return W(o,(function(t,n){var i=t.invoke(n,o);return e&&(t.OFFSET=i),i}))}if(e){if(u)return V((function(t,e){return t.OFFSET=0}));if(a)return new U(h.thisDep,h.contextDep,h.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(a)return new U(h.thisDep,h.contextDep,h.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var i=t.static,r=t.dynamic,s={},a=!1,h=function(){if("vao"in i){var t=i.vao;return null!==t&&null===l.getVAO(t)&&(t=l.createVAO(t)),a=!0,s.vao=t,V((function(e){var n=l.getVAO(t);return n?e.link(n):"null"}))}if("vao"in r){a=!0;var e=r.vao;return W(e,(function(t,n){var i=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+i+")")}))}return null}(),u=!1,c=function(){if("elements"in i){if(s.elements=e=i.elements,H(e)){var t=s.elements=o.create(e,!0),e=o.getElements(t);u=!0}else e&&(e=o.getElements(e),u=!0);return(t=V((function(t,n){if(e){var i=t.link(e);return t.ELEMENTS=i}return t.ELEMENTS=null}))).value=e,t}if("elements"in r){u=!0;var n=r.elements;return W(n,(function(t,e){var i=(r=t.shared).isBufferArgs,r=r.elements,o=t.invoke(e,n),s=e.def("null");return i=e.def(i,"(",o,")"),o=t.cond(i).then(s,"=",r,".createStream(",o,");").else(s,"=",r,".getElements(",o,");"),e.entry(o),e.exit(t.cond(i).then(r,".destroyStream(",s,");")),t.ELEMENTS=s}))}return a?new U(h.thisDep,h.contextDep,h.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}(),A=n("offset",!0),f=function(){if("primitive"in i){var t=i.primitive;return s.primitive=t,V((function(e,n){return ut[t]}))}if("primitive"in r){var e=r.primitive;return W(e,(function(t,n){var i=t.constants.primTypes,r=t.invoke(n,e);return n.def(i,"[",r,"]")}))}return u?G(c)?V(c.value?function(t,e){return e.def(t.ELEMENTS,".primType")}:function(){return 4}):new U(c.thisDep,c.contextDep,c.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",4)})):a?new U(h.thisDep,h.contextDep,h.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:4")})):null}(),d=function(){if("count"in i){var t=0|i.count;return s.count=t,V((function(){return t}))}if("count"in r){var e=r.count;return W(e,(function(t,n){return t.invoke(n,e)}))}return u?G(c)?c?A?new U(A.thisDep,A.contextDep,A.propDep,(function(t,e){return e.def(t.ELEMENTS,".vertCount-",t.OFFSET)})):V((function(t,e){return e.def(t.ELEMENTS,".vertCount")})):V((function(){return-1})):new U(c.thisDep||A.thisDep,c.contextDep||A.contextDep,c.propDep||A.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")})):a?new U(h.thisDep,h.contextDep,h.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")})):null}(),p=n("instances",!1);return{elements:c,primitive:f,count:d,instances:p,offset:A,vao:h,vaoActive:a,elementsActive:u,static:s}}function T(t,e){var n=t.static,i=t.dynamic,r={};return dt.forEach((function(t){function e(e,s){if(t in n){var a=e(n[t]);r[o]=V((function(){return a}))}else if(t in i){var h=i[t];r[o]=W(h,(function(t,e){return s(t,e,t.invoke(e,h))}))}}var o=g(t);switch(t){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":case"lineWidth":return e((function(t){return t}),(function(t,e,n){return n}));case"depth.func":return e((function(t){return Rt[t]}),(function(t,e,n){return e.def(t.constants.compareFuncs,"[",n,"]")}));case"depth.range":return e((function(t){return t}),(function(t,e,n){return[e.def("+",n,"[0]"),e=e.def("+",n,"[1]")]}));case"blend.func":return e((function(t){return[Ot["srcRGB"in t?t.srcRGB:t.src],Ot["dstRGB"in t?t.dstRGB:t.dst],Ot["srcAlpha"in t?t.srcAlpha:t.src],Ot["dstAlpha"in t?t.dstAlpha:t.dst]]}),(function(t,e,n){function i(t,i){return e.def('"',t,i,'" in ',n,"?",n,".",t,i,":",n,".",t)}t=t.constants.blendFuncs;var r=i("src","RGB"),o=i("dst","RGB"),s=(r=e.def(t,"[",r,"]"),e.def(t,"[",i("src","Alpha"),"]"));return[r,o=e.def(t,"[",o,"]"),s,t=e.def(t,"[",i("dst","Alpha"),"]")]}));case"blend.equation":return e((function(t){return"string"==typeof t?[at[t],at[t]]:"object"==typeof t?[at[t.rgb],at[t.alpha]]:void 0}),(function(t,e,n){var i=t.constants.blendEquations,r=e.def(),o=e.def();return(t=t.cond("typeof ",n,'==="string"')).then(r,"=",o,"=",i,"[",n,"];"),t.else(r,"=",i,"[",n,".rgb];",o,"=",i,"[",n,".alpha];"),e(t),[r,o]}));case"blend.color":return e((function(t){return c(4,(function(e){return+t[e]}))}),(function(t,e,n){return c(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case"stencil.mask":return e((function(t){return 0|t}),(function(t,e,n){return e.def(n,"|0")}));case"stencil.func":return e((function(t){return[Rt[t.cmp||"keep"],t.ref||0,"mask"in t?t.mask:-1]}),(function(t,e,n){return[t=e.def('"cmp" in ',n,"?",t.constants.compareFuncs,"[",n,".cmp]",":",7680),e.def(n,".ref|0"),e=e.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return e((function(e){return["stencil.opBack"===t?1029:1028,Dt[e.fail||"keep"],Dt[e.zfail||"keep"],Dt[e.zpass||"keep"]]}),(function(e,n,i){function r(t){return n.def('"',t,'" in ',i,"?",o,"[",i,".",t,"]:",7680)}var o=e.constants.stencilOps;return["stencil.opBack"===t?1029:1028,r("fail"),r("zfail"),r("zpass")]}));case"polygonOffset.offset":return e((function(t){return[0|t.factor,0|t.units]}),(function(t,e,n){return[e.def(n,".factor|0"),e=e.def(n,".units|0")]}));case"cull.face":return e((function(t){var e=0;return"front"===t?e=1028:"back"===t&&(e=1029),e}),(function(t,e,n){return e.def(n,'==="front"?',1028,":",1029)}));case"frontFace":return e((function(t){return kt[t]}),(function(t,e,n){return e.def(n+'==="cw"?2304:2305')}));case"colorMask":return e((function(t){return t.map((function(t){return!!t}))}),(function(t,e,n){return c(4,(function(t){return"!!"+n+"["+t+"]"}))}));case"sample.coverage":return e((function(t){return["value"in t?t.value:1,!!t.invert]}),(function(t,e,n){return[e.def('"value" in ',n,"?+",n,".value:1"),e=e.def("!!",n,".invert")]}))}})),r}function S(t,e){var n=t.static,i=t.dynamic,r={};return Object.keys(n).forEach((function(t){var e,i=n[t];if("number"==typeof i||"boolean"==typeof i)e=V((function(){return i}));else if("function"==typeof i){var o=i._reglType;"texture2d"===o||"textureCube"===o?e=V((function(t){return t.link(i)})):"framebuffer"!==o&&"framebufferCube"!==o||(e=V((function(t){return t.link(i.color[0])})))}else w(i)&&(e=V((function(t){return t.global.def("[",c(i.length,(function(t){return i[t]})),"]")})));e.value=i,r[t]=e})),Object.keys(i).forEach((function(t){var e=i[t];r[t]=W(e,(function(t,n){return t.invoke(n,e)}))})),r}function I(t,n){var i=t.static,o=t.dynamic,s={};return Object.keys(i).forEach((function(t){var n=i[t],o=e.id(t),a=new st;if(H(n))a.state=1,a.buffer=r.getBuffer(r.create(n,34962,!1,!0)),a.type=0;else if(l=r.getBuffer(n))a.state=1,a.buffer=l,a.type=0;else if("constant"in n){var h=n.constant;a.buffer="null",a.state=2,"number"==typeof h?a.x=h:It.forEach((function(t,e){e<h.length&&(a[t]=h[e])}))}else{var l=H(n.buffer)?r.getBuffer(r.create(n.buffer,34962,!1,!0)):r.getBuffer(n.buffer),u=0|n.offset,c=0|n.stride,A=0|n.size,f=!!n.normalized,d=0;"type"in n&&(d=ot[n.type]),n=0|n.divisor,a.buffer=l,a.state=1,a.size=A,a.normalized=f,a.type=d||l.dtype,a.offset=u,a.stride=c,a.divisor=n}s[t]=V((function(t,e){var n=t.attribCache;if(o in n)return n[o];var i={isStream:!1};return Object.keys(a).forEach((function(t){i[t]=a[t]})),a.buffer&&(i.buffer=t.link(a.buffer),i.type=i.type||i.buffer+".dtype"),n[o]=i}))})),Object.keys(o).forEach((function(t){var e=o[t];s[t]=W(e,(function(t,n){function i(t){n(h[t],"=",r,".",t,"|0;")}var r=t.invoke(n,e),o=t.constants,s=(a=t.shared).isBufferArgs,a=a.buffer,h={isStream:n.def(!1)},l=new st;l.state=1,Object.keys(l).forEach((function(t){h[t]=n.def(""+l[t])}));var u=h.buffer,c=h.type;return n("if(",s,"(",r,")){",h.isStream,"=true;",u,"=",a,".createStream(",34962,",",r,");",c,"=",u,".dtype;","}else{",u,"=",a,".getBuffer(",r,");","if(",u,"){",c,"=",u,".dtype;",'}else if("constant" in ',r,"){",h.state,"=",2,";","if(typeof "+r+'.constant === "number"){',h[It[0]],"=",r,".constant;",It.slice(1).map((function(t){return h[t]})).join("="),"=0;","}else{",It.map((function(t,e){return h[t]+"="+r+".constant.length>"+e+"?"+r+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",r,".buffer)){",u,"=",a,".createStream(",34962,",",r,".buffer);","}else{",u,"=",a,".getBuffer(",r,".buffer);","}",c,'="type" in ',r,"?",o.glTypes,"[",r,".type]:",u,".dtype;",h.normalized,"=!!",r,".normalized;"),i("size"),i("offset"),i("stride"),i("divisor"),n("}}"),n.exit("if(",h.isStream,"){",a,".destroyStream(",u,");","}"),h}))})),s}function E(t){var e=t.static,n=t.dynamic,i={};return Object.keys(e).forEach((function(t){var n=e[t];i[t]=V((function(t,e){return"number"==typeof n||"boolean"==typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];i[t]=W(e,(function(t,n){return t.invoke(n,e)}))})),i}function O(t,e,i,r,o){function s(t){var e=h[t];e&&(c[t]=e)}var a=C(t,e),h=b(t,f=x(t)),u=M(t),c=T(t),A=P(t,o,a);s("viewport"),s(g("scissor.box"));var f,d=0<Object.keys(c).length;if((f={framebuffer:f,draw:u,shader:A,state:c,dirty:d,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=_(t),f.uniforms=S(i),f.drawVAO=f.scopeVAO=u.vao,!f.drawVAO&&A.program&&!a&&n.angle_instanced_arrays&&u.static.elements){var p=!0;if(t=A.program.attributes.map((function(t){return t=e.static[t],p=p&&!!t,t})),p&&0<t.length){var m=l.getVAO(l.createVAO({attributes:t,elements:u.static.elements}));f.drawVAO=new U(null,null,null,(function(t,e){return t.link(m)})),f.useVAO=!0}}return a?f.useVAO=!0:f.attributes=I(e),f.context=E(r),f}function R(t,e,n){var i=t.shared.context,r=t.scope();Object.keys(n).forEach((function(o){e.save(i,"."+o);var s=n[o].append(t,e);Array.isArray(s)?r(i,".",o,"=[",s.join(),"];"):r(i,".",o,"=",s,";")})),e(r)}function D(t,e,n,i){var r,o=(a=t.shared).gl,s=a.framebuffer;lt&&(r=e.def(a.extensions,".webgl_draw_buffers"));var a=(h=t.constants).drawBuffer,h=h.backBuffer;t=n?n.append(t,e):e.def(s,".next"),i||e("if(",t,"!==",s,".cur){"),e("if(",t,"){",o,".bindFramebuffer(",36160,",",t,".framebuffer);"),lt&&e(r,".drawBuffersWEBGL(",a,"[",t,".colorAttachments.length]);"),e("}else{",o,".bindFramebuffer(",36160,",null);"),lt&&e(r,".drawBuffersWEBGL(",h,");"),e("}",s,".cur=",t,";"),i||e("}")}function k(t,e,n){var i=t.shared,r=i.gl,o=t.current,s=t.next,a=i.current,h=i.next,l=t.cond(a,".dirty");dt.forEach((function(e){var i,u;if(!((e=g(e))in n.state))if(e in s){i=s[e],u=o[e];var A=c(At[e].length,(function(t){return l.def(i,"[",t,"]")}));l(t.cond(A.map((function(t,e){return t+"!=="+u+"["+e+"]"})).join("||")).then(r,".",gt[e],"(",A,");",A.map((function(t,e){return u+"["+e+"]="+t})).join(";"),";"))}else i=l.def(h,".",e),A=t.cond(i,"!==",a,".",e),l(A),e in pt?A(t.cond(i).then(r,".enable(",pt[e],");").else(r,".disable(",pt[e],");"),a,".",e,"=",i,";"):A(r,".",gt[e],"(",i,");",a,".",e,"=",i,";")})),0===Object.keys(n.state).length&&l(a,".dirty=false;"),e(l)}function L(t,e,n,i){var r=t.shared,o=t.current,s=r.current,a=r.gl;j(Object.keys(n)).forEach((function(r){var h=n[r];if(!i||i(h)){var l=h.append(t,e);if(pt[r]){var u=pt[r];G(h)?e(a,l?".enable(":".disable(",u,");"):e(t.cond(l).then(a,".enable(",u,");").else(a,".disable(",u,");")),e(s,".",r,"=",l,";")}else if(w(l)){var c=o[r];e(a,".",gt[r],"(",l,");",l.map((function(t,e){return c+"["+e+"]="+t})).join(";"),";")}else e(a,".",gt[r],"(",l,");",s,".",r,"=",l,";")}}))}function F(t,e){ht&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function N(t,e,n,i,r){function o(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function s(t){t(l=e.def(),"=",o(),";"),"string"==typeof r?t(A,".count+=",r,";"):t(A,".count++;"),d&&(i?t(u=e.def(),"=",p,".getNumPendingQueries();"):t(p,".beginQuery(",A,");"))}function a(t){t(A,".cpuTime+=",o(),"-",l,";"),d&&(i?t(p,".pushScopeStats(",u,",",p,".getNumPendingQueries(),",A,");"):t(p,".endQuery();"))}function h(t){var n=e.def(f,".profile");e(f,".profile=",t,";"),e.exit(f,".profile=",n,";")}var l,u,c=t.shared,A=t.stats,f=c.current,p=c.timer;if(n=n.profile){if(G(n))return void(n.enable?(s(e),a(e.exit),h("true")):h("false"));h(n=n.append(t,e))}else n=e.def(f,".profile");s(c=t.block()),e("if(",n,"){",c,"}"),a(t=t.block()),e.exit("if(",n,"){",t,"}")}function z(t,e,n,i,r){function o(t){switch(t){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function s(n,i,r){function o(){e(h,".enableVertexAttribArray(",l,");");var n,o=r.type;n=r.size?e.def(r.size,"||",i):i,e(h,".bindBuffer(",34962,",",c,".buffer);",h,".vertexAttribPointer(",[l,n,o,r.normalized,r.stride,r.offset],");",u,".type=",o,";",u,".size=",n,";",f.map((function(t){return u+"."+t+"="+r[t]+";"})).join("")),ht&&e("if(",u,".divisor!==",o=r.divisor,"){",t.instancing,".vertexAttribDivisorANGLE(",[l,o],");",u,".divisor=",o,";}")}function s(){e("if(",u,".buffer){",h,".disableVertexAttribArray(",l,");",u,".buffer=null;","}if(",It.map((function(t,e){return u+"."+t+"!=="+A[e]})).join("||"),"){",h,".vertexAttrib4f(",l,",",A,");",It.map((function(t,e){return u+"."+t+"="+A[e]+";"})).join(""),"}")}var h=a.gl,l=e.def(n,".location"),u=e.def(a.attributes,"[",l,"]"),c=r.buffer,A=[r.x,r.y,r.z,r.w],f=["buffer","normalized","offset","stride"];1===(n=r.state)?o():2===n?s():(e("if(",n,"===",1,"){"),o(),e("}else{"),s(),e("}"))}var a=t.shared;i.forEach((function(i){var a,h=i.name,l=n.attributes[h];if(l){if(!r(l))return;a=l.append(t,e)}else{if(!r(Lt))return;var u=t.scopeAttrib(h);a={},Object.keys(new st).forEach((function(t){a[t]=e.def(u,".",t)}))}s(t.link(i),o(i.info.type),a)}))}function q(t,n,i,r,o,s){for(var a,h=t.shared,l=h.gl,u={},A=0;A<r.length;++A){var f=(y=r[A]).name,d=y.info.type,p=i.uniforms[f];if(1<(x=y.info.size)){if(!p)continue;var g=f.replace("[0]","");if(u[g])continue;u[g]=1}var m,y=t.link(y)+".location";if(p){if(!o(p))continue;if(G(p)){if(f=p.value,35678===d||35680===d)n(l,".uniform1i(",y,",",(d=t.link(f._texture||f.color[0]._texture))+".bind());"),n.exit(d,".unbind();");else if(35674===d||35675===d||35676===d)x=t.global.def("new Float32Array(["+Array.prototype.slice.call(f)+"])"),f=2,35675===d?f=3:35676===d&&(f=4),n(l,".uniformMatrix",f,"fv(",y,",false,",x,");");else{switch(d){case 5126:a="1f";break;case 35664:a="2f";break;case 35665:a="3f";break;case 35666:a="4f";break;case 35670:case 5124:a="1i";break;case 35671:case 35667:a="2i";break;case 35672:case 35668:a="3i";break;case 35673:case 35669:a="4i"}1<x?(a+="v",f=t.global.def("["+Array.prototype.slice.call(f)+"]")):f=w(f)?Array.prototype.slice.call(f):f,n(l,".uniform",a,"(",y,",",f,");")}continue}m=p.append(t,n)}else{if(!o(Lt))continue;m=n.def(h.uniforms,"[",e.id(f),"]")}switch(35678===d?n("if(",m,"&&",m,'._reglType==="framebuffer"){',m,"=",m,".color[0];","}"):35680===d&&n("if(",m,"&&",m,'._reglType==="framebufferCube"){',m,"=",m,".color[0];","}"),f=1,d){case 35678:case 35680:d=n.def(m,"._texture"),n(l,".uniform1i(",y,",",d,".bind());"),n.exit(d,".unbind();");continue;case 5124:case 35670:a="1i";break;case 35667:case 35671:a="2i",f=2;break;case 35668:case 35672:a="3i",f=3;break;case 35669:case 35673:a="4i",f=4;break;case 5126:a="1f";break;case 35664:a="2f",f=2;break;case 35665:a="3f",f=3;break;case 35666:a="4f",f=4;break;case 35674:a="Matrix2fv";break;case 35675:a="Matrix3fv";break;case 35676:a="Matrix4fv"}if(-1===a.indexOf("Matrix")&&1<x&&(a+="v",f=1),"M"===a.charAt(0)){n(l,".uniform",a,"(",y,","),y=Math.pow(d-35674+2,2);var v=t.global.def("new Float32Array(",y,")");Array.isArray(m)?n("false,(",c(y,(function(t){return v+"["+t+"]="+m[t]})),",",v,")"):n("false,(Array.isArray(",m,")||",m," instanceof Float32Array)?",m,":(",c(y,(function(t){return v+"["+t+"]="+m+"["+t+"]"})),",",v,")"),n(");")}else{if(1<f){d=[];for(var _=[],x=0;x<f;++x)Array.isArray(m)?_.push(m[x]):_.push(n.def(m+"["+x+"]")),s&&d.push(n.def());s&&n("if(!",t.batchId,"||",d.map((function(t,e){return t+"!=="+_[e]})).join("||"),"){",d.map((function(t,e){return t+"="+_[e]+";"})).join("")),n(l,".uniform",a,"(",y,",",_.join(","),");")}else s&&(d=n.def(),n("if(!",t.batchId,"||",d,"!==",m,"){",d,"=",m,";")),n(l,".uniform",a,"(",y,",",m,");");s&&n("}")}}}function Z(t,e,n,i){function r(r){var o=d[r];return o?o.append(t,o.contextDep&&i.contextDynamic||o.propDep?n:e):e.def(f,".",r)}function o(){function t(){n(h,".drawElementsInstancedANGLE(",[g,y,v,m+"<<(("+v+"-5121)>>1)",a],");")}function e(){n(h,".drawArraysInstancedANGLE(",[g,m,y,a],");")}p&&"null"!==p?_?t():(n("if(",p,"){"),t(),n("}else{"),e(),n("}")):e()}function s(){function t(){n(A+".drawElements("+[g,y,v,m+"<<(("+v+"-5121)>>1)"]+");")}function e(){n(A+".drawArrays("+[g,m,y]+");")}p&&"null"!==p?_?t():(n("if(",p,"){"),t(),n("}else{"),e(),n("}")):e()}var a,h,l,u,c=t.shared,A=c.gl,f=c.draw,d=i.draw,p=(l=d.elements,u=e,l?((l.contextDep&&i.contextDynamic||l.propDep)&&(u=n),l=l.append(t,u),d.elementsActive&&u("if("+l+")"+A+".bindBuffer(34963,"+l+".buffer.buffer);")):(l=u.def(),u(l,"=",f,".","elements",";","if(",l,"){",A,".bindBuffer(",34963,",",l,".buffer.buffer);}","else if(",c.vao,".currentVAO){",l,"=",t.shared.elements+".getElements("+c.vao,".currentVAO.elements);",ct?"":"if("+l+")"+A+".bindBuffer(34963,"+l+".buffer.buffer);","}")),l),g=r("primitive"),m=r("offset"),y=function(){var r=d.count,o=e;return r?((r.contextDep&&i.contextDynamic||r.propDep)&&(o=n),r=r.append(t,o)):r=o.def(f,".","count"),r}();if("number"==typeof y){if(0===y)return}else n("if(",y,"){"),n.exit("}");ht&&(a=r("instances"),h=t.instancing);var v=p+".type",_=d.elements&&G(d.elements)&&!d.vaoActive;ht&&("number"!=typeof a||0<=a)?"string"==typeof a?(n("if(",a,">0){"),o(),n("}else if(",a,"<0){"),s(),n("}")):o():s()}function X(t,e,n,i,r){return r=(e=v()).proc("body",r),ht&&(e.instancing=r.def(e.shared.extensions,".angle_instanced_arrays")),t(e,r,n,i),e.compile().body}function J(t,e,n,i){F(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),z(t,e,n,i.attributes,(function(){return!0}))),q(t,e,n,i.uniforms,(function(){return!0}),!1),Z(t,e,e,n)}function K(t,e){var n=t.proc("draw",1);F(t,n),R(t,n,e.context),D(t,n,e.framebuffer),k(t,n,e),L(t,n,e.state),N(t,n,e,!1,!0);var i=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",i,".program);"),e.shader.program)J(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var r=t.global.def("{}"),o=n.def(i,".id"),s=n.def(r,"[",o,"]");n(t.cond(s).then(s,".call(this,a0);").else(s,"=",r,"[",o,"]=",t.link((function(n){return X(J,t,e,n,1)})),"(",i,");",s,".call(this,a0);"))}0<Object.keys(e.state).length&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function $(t,e,n,i){function r(){return!0}t.batchId="a1",F(t,e),z(t,e,n,i.attributes,r),q(t,e,n,i.uniforms,r,!1),Z(t,e,e,n)}function tt(t,e,n,i){function r(t){return t.contextDep&&s||t.propDep}function o(t){return!r(t)}F(t,e);var s=n.contextDep,a=e.def(),h=e.def();t.shared.props=h,t.batchId=a;var l=t.scope(),u=t.scope();e(l.entry,"for(",a,"=0;",a,"<","a1",";++",a,"){",h,"=","a0","[",a,"];",u,"}",l.exit),n.needsContext&&R(t,u,n.context),n.needsFramebuffer&&D(t,u,n.framebuffer),L(t,u,n.state,r),n.profile&&r(n.profile)&&N(t,u,n,!1,!0),i?(n.useVAO?n.drawVAO?r(n.drawVAO)?u(t.shared.vao,".setVAO(",n.drawVAO.append(t,u),");"):l(t.shared.vao,".setVAO(",n.drawVAO.append(t,l),");"):l(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(l(t.shared.vao,".setVAO(null);"),z(t,l,n,i.attributes,o),z(t,u,n,i.attributes,r)),q(t,l,n,i.uniforms,o,!1),q(t,u,n,i.uniforms,r,!0),Z(t,l,u,n)):(e=t.global.def("{}"),i=n.shader.progVar.append(t,u),h=u.def(i,".id"),l=u.def(e,"[",h,"]"),u(t.shared.gl,".useProgram(",i,".program);","if(!",l,"){",l,"=",e,"[",h,"]=",t.link((function(e){return X($,t,n,e,2)})),"(",i,");}",l,".call(this,a0[",a,"],",a,");"))}function et(t,e){function n(t){return t.contextDep&&r||t.propDep}var i=t.proc("batch",2);t.batchId="0",F(t,i);var r=!1,o=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(R(t,i,e.context),o=!1);var s=!1;if((a=e.framebuffer)?(a.propDep?r=s=!0:a.contextDep&&r&&(s=!0),s||D(t,i,a)):D(t,i,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),k(t,i,e),L(t,i,e.state,(function(t){return!n(t)})),e.profile&&n(e.profile)||N(t,i,e,!1,"a1"),e.contextDep=r,e.needsContext=o,e.needsFramebuffer=s,(o=e.shader.progVar).contextDep&&r||o.propDep)tt(t,i,e,null);else if(o=o.append(t,i),i(t.shared.gl,".useProgram(",o,".program);"),e.shader.program)tt(t,i,e,e.shader.program);else{i(t.shared.vao,".setVAO(null);");var a=t.global.def("{}"),h=(s=i.def(o,".id"),i.def(a,"[",s,"]"));i(t.cond(h).then(h,".call(this,a0,a1);").else(h,"=",a,"[",s,"]=",t.link((function(n){return X(tt,t,e,n,2)})),"(",o,");",h,".call(this,a0,a1);"))}0<Object.keys(e.state).length&&i(t.shared.current,".dirty=true;"),t.shared.vao&&i(t.shared.vao,".setVAO(null);")}function nt(t,n){function i(e){var i=n.shader[e];i&&r.set(o.shader,"."+e,i.append(t,r))}var r=t.proc("scope",3);t.batchId="a2";var o=t.shared,s=o.current;R(t,r,n.context),n.framebuffer&&n.framebuffer.append(t,r),j(Object.keys(n.state)).forEach((function(e){var i=n.state[e].append(t,r);w(i)?i.forEach((function(n,i){r.set(t.next[e],"["+i+"]",n)})):r.set(o.next,"."+e,i)})),N(t,r,n,!0,!0),["elements","offset","count","instances","primitive"].forEach((function(e){var i=n.draw[e];i&&r.set(o.draw,"."+e,""+i.append(t,r))})),Object.keys(n.uniforms).forEach((function(i){var s=n.uniforms[i].append(t,r);Array.isArray(s)&&(s="["+s.join()+"]"),r.set(o.uniforms,"["+e.id(i)+"]",s)})),Object.keys(n.attributes).forEach((function(e){var i=n.attributes[e].append(t,r),o=t.scopeAttrib(e);Object.keys(new st).forEach((function(t){r.set(o,"."+t,i[t])}))})),n.scopeVAO&&r.set(o.vao,".targetVAO",n.scopeVAO.append(t,r)),i("vert"),i("frag"),0<Object.keys(n.state).length&&(r(s,".dirty=true;"),r.exit(s,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function it(t){if("object"==typeof t&&!w(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(Y.isDynamic(t[e[n]]))return!0;return!1}}function rt(t,e,n){function i(t,e){s.forEach((function(n){var i=r[n];Y.isDynamic(i)&&(i=t.invoke(e,i),e(u,".",n,"=",i,";"))}))}var r=e.static[n];if(r&&it(r)){var o=t.global,s=Object.keys(r),a=!1,h=!1,l=!1,u=t.global.def("{}");s.forEach((function(e){var n=r[e];if(Y.isDynamic(n))"function"==typeof n&&(n=r[e]=Y.unbox(n)),e=W(n,null),a=a||e.thisDep,l=l||e.propDep,h=h||e.contextDep;else{switch(o(u,".",e,"="),typeof n){case"number":o(n);break;case"string":o('"',n,'"');break;case"object":Array.isArray(n)&&o("[",n.join(),"]");break;default:o(t.link(n))}o(";")}})),e.dynamic[n]=new Y.DynamicVariable(4,{thisDep:a,contextDep:h,propDep:l,ref:u,append:i}),delete e.static[n]}}var st=l.Record,at={add:32774,subtract:32778,"reverse subtract":32779};n.ext_blend_minmax&&(at.min=32775,at.max=32776);var ht=n.angle_instanced_arrays,lt=n.webgl_draw_buffers,ct=n.oes_vertex_array_object,At={dirty:!0,profile:p.profile},ft={},dt=[],pt={},gt={};m("dither",3024),m("blend.enable",3042),y("blend.color","blendColor",[0,0,0,0]),y("blend.equation","blendEquationSeparate",[32774,32774]),y("blend.func","blendFuncSeparate",[1,0,1,0]),m("depth.enable",2929,!0),y("depth.func","depthFunc",513),y("depth.range","depthRange",[0,1]),y("depth.mask","depthMask",!0),y("colorMask","colorMask",[!0,!0,!0,!0]),m("cull.enable",2884),y("cull.face","cullFace",1029),y("frontFace","frontFace",2305),y("lineWidth","lineWidth",1),m("polygonOffset.enable",32823),y("polygonOffset.offset","polygonOffset",[0,0]),m("sample.alpha",32926),m("sample.enable",32928),y("sample.coverage","sampleCoverage",[1,!1]),m("stencil.enable",2960),y("stencil.mask","stencilMask",-1),y("stencil.func","stencilFunc",[519,0,-1]),y("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),y("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),m("scissor.enable",3089),y("scissor.box","scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),y("viewport","viewport",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var mt={gl:t,context:f,strings:e,next:ft,current:At,draw:A,elements:o,buffer:r,shader:u,attributes:l.state,vao:l,uniforms:h,framebuffer:a,extensions:n,timer:d,isBufferArgs:H},yt={primTypes:ut,compareFuncs:Rt,blendFuncs:Ot,blendEquations:at,stencilOps:Dt,glTypes:ot,orientationType:kt};lt&&(yt.backBuffer=[1029],yt.drawBuffer=c(i.maxDrawbuffers,(function(t){return 0===t?[0]:c(t,(function(t){return 36064+t}))})));var vt=0;return{next:ft,current:At,procs:function(){var t=v(),e=t.proc("poll"),r=t.proc("refresh"),o=t.block();e(o),r(o);var s,a=t.shared,h=a.gl,l=a.next,u=a.current;o(u,".dirty=false;"),D(t,e),D(t,r,null,!0),ht&&(s=t.link(ht)),n.oes_vertex_array_object&&r(t.link(n.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var A=0;A<i.maxAttributes;++A){var f=r.def(a.attributes,"[",A,"]"),d=t.cond(f,".buffer");d.then(h,".enableVertexAttribArray(",A,");",h,".bindBuffer(",34962,",",f,".buffer.buffer);",h,".vertexAttribPointer(",A,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(h,".disableVertexAttribArray(",A,");",h,".vertexAttrib4f(",A,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),r(d),ht&&r(s,".vertexAttribDivisorANGLE(",A,",",f,".divisor);")}return r(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(pt).forEach((function(n){var i=pt[n],s=o.def(l,".",n),a=t.block();a("if(",s,"){",h,".enable(",i,")}else{",h,".disable(",i,")}",u,".",n,"=",s,";"),r(a),e("if(",s,"!==",u,".",n,"){",a,"}")})),Object.keys(gt).forEach((function(n){var i,s,a=gt[n],A=At[n],f=t.block();f(h,".",a,"("),w(A)?(a=A.length,i=t.global.def(l,".",n),s=t.global.def(u,".",n),f(c(a,(function(t){return i+"["+t+"]"})),");",c(a,(function(t){return s+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",c(a,(function(t){return i+"["+t+"]!=="+s+"["+t+"]"})).join("||"),"){",f,"}")):(i=o.def(l,".",n),s=o.def(u,".",n),f(i,");",u,".",n,"=",i,";"),e("if(",i,"!==",s,"){",f,"}")),r(f)})),t.compile()}(),compile:function(t,e,n,i,r){var o=v();o.stats=o.link(r),Object.keys(e.static).forEach((function(t){rt(o,e,t)})),Et.forEach((function(e){rt(o,t,e)}));var s=O(t,e,n,i,o);return K(o,s),nt(o,s),et(o,s),Q(o.compile(),{destroy:function(){s.shader.program.destroy()}})}}}function Z(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}var Q=function(t,e){for(var n=Object.keys(e),i=0;i<n.length;++i)t[n[i]]=e[n[i]];return t},X=0,Y={DynamicVariable:t,define:function(e,i){return new t(e,n(i+""))},isDynamic:function(e){return"function"==typeof e&&!e._reglType||e instanceof t},unbox:i,accessor:n},J={next:"function"==typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"==typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},K="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},$=f();$.zero=f();var tt=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(34047));var i=1,r=1;e.webgl_draw_buffers&&(i=t.getParameter(34852),r=t.getParameter(36063));var o=!!e.oes_texture_float;if(o){o=t.createTexture(),t.bindTexture(3553,o),t.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var s=t.createFramebuffer();if(t.bindFramebuffer(36160,s),t.framebufferTexture2D(36160,36064,3553,o,0),t.bindTexture(3553,null),36053!==t.checkFramebufferStatus(36160))o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(16384);var a=$.allocType(5126,4);t.readPixels(0,0,1,1,6408,5126,a),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(o),o=1===a[0]),$.freeType(a)}}return a=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(a=t.createTexture(),s=$.allocType(5121,36),t.activeTexture(33984),t.bindTexture(34067,a),t.texImage2D(34069,0,6408,3,3,0,6408,5121,s),$.freeType(s),t.bindTexture(34067,null),t.deleteTexture(a),a=!t.getError()),{colorBits:[t.getParameter(3410),t.getParameter(3411),t.getParameter(3412),t.getParameter(3413)],depthBits:t.getParameter(3414),stencilBits:t.getParameter(3415),subpixelBits:t.getParameter(3408),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:i,maxColorAttachments:r,pointSizeDims:t.getParameter(33901),lineWidthDims:t.getParameter(33902),maxViewportDims:t.getParameter(3386),maxCombinedTextureUnits:t.getParameter(35661),maxCubeMapSize:t.getParameter(34076),maxRenderbufferSize:t.getParameter(34024),maxTextureUnits:t.getParameter(34930),maxTextureSize:t.getParameter(3379),maxAttributes:t.getParameter(34921),maxVertexUniforms:t.getParameter(36347),maxVertexTextureUnits:t.getParameter(35660),maxVaryingVectors:t.getParameter(36348),maxFragmentUniforms:t.getParameter(36349),glsl:t.getParameter(35724),renderer:t.getParameter(7937),vendor:t.getParameter(7936),version:t.getParameter(7938),readFloat:o,npotTextureCube:a}},et=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},nt=function(t){return Object.keys(t).map((function(e){return t[e]}))},it={shape:function(t){for(var e=[];t.length;t=t[0])e.push(t.length);return e},flatten:function(t,e,n,i){var r=1;if(e.length)for(var o=0;o<e.length;++o)r*=e[o];else r=0;switch(n=i||$.allocType(n,r),e.length){case 0:break;case 1:for(i=e[0],e=0;e<i;++e)n[e]=t[e];break;case 2:for(i=e[0],e=e[1],o=r=0;o<i;++o)for(var s=t[o],a=0;a<e;++a)n[r++]=s[a];break;case 3:p(t,e[0],e[1],e[2],n,0);break;default:g(t,e,0,n,0)}return n}},rt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ot={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},st={dynamic:35048,stream:35040,static:35044},at=it.flatten,ht=it.shape,lt=[];lt[5120]=1,lt[5122]=2,lt[5124]=4,lt[5121]=1,lt[5123]=2,lt[5125]=4,lt[5126]=4;var ut={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ct=new Float32Array(1),At=new Uint32Array(ct.buffer),ft=[9984,9986,9985,9987],dt=[0,6409,6410,6407,6408],pt={};pt[6409]=pt[6406]=pt[6402]=1,pt[34041]=pt[6410]=2,pt[6407]=pt[35904]=3,pt[6408]=pt[35906]=4;var gt=C("HTMLCanvasElement"),mt=C("OffscreenCanvas"),yt=C("CanvasRenderingContext2D"),vt=C("ImageBitmap"),_t=C("HTMLImageElement"),xt=C("HTMLVideoElement"),bt=Object.keys(rt).concat([gt,mt,yt,vt,_t,xt]),wt=[];wt[5121]=1,wt[5126]=4,wt[36193]=2,wt[5123]=2,wt[5125]=4;var Ct=[];Ct[32854]=2,Ct[32855]=2,Ct[36194]=2,Ct[34041]=4,Ct[33776]=.5,Ct[33777]=.5,Ct[33778]=1,Ct[33779]=1,Ct[35986]=.5,Ct[35987]=1,Ct[34798]=1,Ct[35840]=.5,Ct[35841]=.25,Ct[35842]=.5,Ct[35843]=.25,Ct[36196]=.5;var Pt=[];Pt[32854]=2,Pt[32855]=2,Pt[36194]=2,Pt[33189]=2,Pt[36168]=1,Pt[34041]=4,Pt[35056]=4,Pt[35907]=4,Pt[34836]=16,Pt[34842]=8,Pt[34843]=6;var Mt=function(t,e,n,i,r){function o(t){this.id=l++,this.refCount=1,this.renderbuffer=t,this.format=32854,this.height=this.width=0,r.profile&&(this.stats={size:0})}function s(e){var n=e.renderbuffer;t.bindRenderbuffer(36161,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete u[e.id],i.renderbufferCount--}var a={rgba4:32854,rgba8:32856,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041,"depth24 stencil8":35056};e.ext_srgb&&(a.srgba=35907),e.ext_color_buffer_half_float&&(a.rgba16f=34842,a.rgb16f=34843),e.webgl_color_buffer_float&&(a.rgba32f=34836);var h=[];Object.keys(a).forEach((function(t){h[a[t]]=t}));var l=0,u={};return o.prototype.decRef=function(){0>=--this.refCount&&s(this)},r.profile&&(i.getTotalRenderbufferSize=function(){var t=0;return Object.keys(u).forEach((function(e){t+=u[e].stats.size})),t}),{create:function(e,n){function s(e,n){var i=0,o=0,u=32854,c=0;if("object"==typeof e&&e?("shape"in e?(i=0|(o=e.shape)[0],o=0|o[1]):("radius"in e&&(i=o=0|e.radius),"width"in e&&(i=0|e.width),"height"in e&&(o=0|e.height)),"format"in e&&(u=a[e.format]),"samples"in e&&(c=e.samples)):"number"==typeof e?(i=0|e,o="number"==typeof n?0|n:i):e||(i=o=1),i!==l.width||o!==l.height||u!==l.format)return s.width=l.width=i,s.height=l.height=o,s.samples=c,l.format=u,l.samples=c,t.bindRenderbuffer(36161,l.renderbuffer),c&&t.renderbufferStorageMultisample?t.renderbufferStorageMultisample(36161,c,u,i,o):t.renderbufferStorage(36161,u,i,o),r.profile&&(l.stats.size=Pt[l.format]*l.width*l.height),s.format=h[l.format],s}var l=new o(t.createRenderbuffer());return u[l.id]=l,i.renderbufferCount++,s(e,n),s.resize=function(e,n){var i=0|e,o=0|n||i;if(i===l.width&&o===l.height)return s;s.width=l.width=i,s.height=l.height=o;var a=s.samples;return t.bindRenderbuffer(36161,l.renderbuffer),a&&t.renderbufferStorageMultisample?t.renderbufferStorageMultisample(36161,a,l.format,i,o):t.renderbufferStorage(36161,l.format,i,o),r.profile&&(l.stats.size=Pt[l.format]*l.width*l.height),s},s._reglType="renderbuffer",s._renderbuffer=l,r.profile&&(s.stats=l.stats),s.destroy=function(){l.decRef()},s},clear:function(){nt(u).forEach(s)},restore:function(){nt(u).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(36161,e.renderbuffer),e.samples&&t.renderbufferStorageMultisample?t.renderbufferStorageMultisample(36161,e.samples,e.format,e.width,e.height):t.renderbufferStorage(36161,e.format,e.width,e.height)})),t.bindRenderbuffer(36161,null)}}},Tt=[];Tt[6408]=4,Tt[6407]=3;var St=[];St[5121]=1,St[5126]=4,St[36193]=2;var It=["x","y","z","w"],Et="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Ot={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Rt={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Dt={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},kt={cw:2304,ccw:2305},Lt=new U(!1,!1,!1,(function(){})),Ft=function(t,e){function n(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function i(t,e,i){var r=s.pop()||new n;r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=i,a.push(r)}if(!e.ext_disjoint_timer_query)return null;var r=[],o=[],s=[],a=[],h=[],l=[];return{beginQuery:function(t){var n=r.pop()||e.ext_disjoint_timer_query.createQueryEXT();e.ext_disjoint_timer_query.beginQueryEXT(35007,n),o.push(n),i(o.length-1,o.length,t)},endQuery:function(){e.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:i,update:function(){var t,n;if(0!==(t=o.length)){l.length=Math.max(l.length,t+1),h.length=Math.max(h.length,t+1),h[0]=0;var i=l[0]=0;for(n=t=0;n<o.length;++n)e.ext_disjoint_timer_query.getQueryObjectEXT(u=o[n],34919)?(i+=e.ext_disjoint_timer_query.getQueryObjectEXT(u,34918),r.push(u)):o[t++]=u,h[n+1]=i,l[n+1]=t;for(o.length=t,n=t=0;n<a.length;++n){var u,c=(i=a[n]).startQueryIndex;i.sum+=h[u=i.endQueryIndex]-h[c],(u=l[u])===(c=l[c])?(i.stats.gpuTime+=i.sum/1e6,s.push(i)):(i.startQueryIndex=c,i.endQueryIndex=u,a[t++]=i)}a.length=t}},getNumPendingQueries:function(){return o.length},clear:function(){r.push.apply(r,o);for(var t=0;t<r.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(r[t]);o.length=0,r.length=0},restore:function(){o.length=0,r.length=0}}};return function(t){function e(){if(0===W.length)C&&C.update(),nt=null;else{nt=J.next(e),f();for(var t=W.length-1;0<=t;--t){var n=W[t];n&&n(T,null,0)}g.flush(),C&&C.update()}}function n(){!nt&&0<W.length&&(nt=J.next(e))}function i(){nt&&(J.cancel(e),nt=null)}function o(t){t.preventDefault(),i(),X.forEach((function(t){t()}))}function s(t){g.getError(),y.restore(),z.restore(),E.restore(),B.restore(),H.restore(),j.restore(),N.restore(),C&&C.restore(),U.procs.refresh(),n(),$.forEach((function(t){t()}))}function a(t){function e(t,e){var n={},i={};return Object.keys(t).forEach((function(r){var o=t[r];if(Y.isDynamic(o))i[r]=Y.unbox(o,r);else{if(e&&Array.isArray(o))for(var s=0;s<o.length;++s)if(Y.isDynamic(o[s]))return void(i[r]=Y.unbox(o,r));n[r]=o}})),{dynamic:i,static:n}}function n(t){for(;c.length<t;)c.push(null);return c}var i=e(t.context||{},!0),r=e(t.uniforms||{},!0),o=e(t.attributes||{},!1);t=e(function(t){function e(t){if(t in n){var e=n[t];delete n[t],Object.keys(e).forEach((function(i){n[t+"."+i]=e[i]}))}}var n=Q({},t);return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),e("blend"),e("depth"),e("cull"),e("stencil"),e("polygonOffset"),e("scissor"),e("sample"),"vao"in t&&(n.vao=t.vao),n}(t),!1);var s={gpuTime:0,cpuTime:0,count:0},a=U.compile(t,o,r,i,s),h=a.draw,l=a.batch,u=a.scope,c=[];return Q((function(t,e){var i;if("function"==typeof t)return u.call(this,null,t,0);if("function"==typeof e)if("number"==typeof t)for(i=0;i<t;++i)u.call(this,null,e,i);else{if(!Array.isArray(t))return u.call(this,t,e,0);for(i=0;i<t.length;++i)u.call(this,t[i],e,i)}else if("number"==typeof t){if(0<t)return l.call(this,n(0|t),0|t)}else{if(!Array.isArray(t))return h.call(this,t);if(t.length)return l.call(this,t,t.length)}}),{stats:s,destroy:function(){a.destroy()}})}function h(t,e){var n=0;U.procs.poll();var i=e.color;i&&(g.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=16384),"depth"in e&&(g.clearDepth(+e.depth),n|=256),"stencil"in e&&(g.clearStencil(0|e.stencil),n|=1024),g.clear(n)}function c(t){return W.push(t),n(),{cancel:function(){function e(){var t=Z(W,e);W[t]=W[W.length-1],--W.length,0>=W.length&&i()}var n=Z(W,t);W[n]=e}}}function A(){var t=G.viewport,e=G.scissor_box;t[0]=t[1]=e[0]=e[1]=0,T.viewportWidth=T.framebufferWidth=T.drawingBufferWidth=t[2]=e[2]=g.drawingBufferWidth,T.viewportHeight=T.framebufferHeight=T.drawingBufferHeight=t[3]=e[3]=g.drawingBufferHeight}function f(){T.tick+=1,T.time=p(),A(),U.procs.poll()}function d(){B.refresh(),A(),U.procs.refresh(),C&&C.update()}function p(){return(K()-P)/1e3}if(!(t=l(t)))return null;var g=t.gl,m=g.getContextAttributes();g.isContextLost();var y=u(g,t);if(!y)return null;var v=r(),b={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},w=y.extensions,C=Ft(g,w),P=K(),M=g.drawingBufferHeight,T={tick:0,time:0,viewportWidth:S=g.drawingBufferWidth,viewportHeight:M,framebufferWidth:S,framebufferHeight:M,drawingBufferWidth:S,drawingBufferHeight:M,pixelRatio:t.pixelRatio},S={elements:null,primitive:4,count:-1,offset:0,instances:-1},I=tt(g,w),E=_(g,b,t,(function(t){return N.destroyBuffer(t)})),D=x(g,w,E,b),N=k(g,w,I,b,E,D,S),z=L(g,v,b,t),B=O(g,w,I,(function(){U.procs.poll()}),T,b,t),H=Mt(g,w,I,b,t),j=R(g,w,I,B,H,b),U=q(g,v,w,I,E,D,B,j,{},N,z,S,T,C,t),G=(v=F(g,j,U.procs.poll,T),U.next),V=g.canvas,W=[],X=[],$=[],et=[t.onDestroy],nt=null;V&&(V.addEventListener("webglcontextlost",o,!1),V.addEventListener("webglcontextrestored",s,!1));var it=j.setFBO=a({framebuffer:Y.define.call(null,1,"framebuffer")});return d(),m=Q(a,{clear:function(t){if("framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var e=0;6>e;++e)it(Q({framebuffer:t.framebuffer.faces[e]},t),h);else it(t,h);else h(null,t)},prop:Y.define.bind(null,1),context:Y.define.bind(null,2),this:Y.define.bind(null,3),draw:a({}),buffer:function(t){return E.create(t,34962,!1,!1)},elements:function(t){return D.create(t,!1)},texture:B.create2D,cube:B.createCube,renderbuffer:H.create,framebuffer:j.create,framebufferCube:j.createCube,vao:N.createVAO,attributes:m,frame:c,on:function(t,e){var n;switch(t){case"frame":return c(e);case"lost":n=X;break;case"restore":n=$;break;case"destroy":n=et}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e){n[t]=n[n.length-1],n.pop();break}}}},limits:I,hasExtension:function(t){return 0<=I.extensions.indexOf(t.toLowerCase())},read:v,destroy:function(){W.length=0,i(),V&&(V.removeEventListener("webglcontextlost",o),V.removeEventListener("webglcontextrestored",s)),z.clear(),j.clear(),H.clear(),N.clear(),B.clear(),D.clear(),E.clear(),C&&C.clear(),et.forEach((function(t){t()}))},_gl:g,_refresh:d,poll:function(){f(),C&&C.update()},now:p,stats:b,blit:j.blit}),t.onDone(null,m),m}}()}(ed);var nd=ed.exports,id=td(nd),rd="undefined"!=typeof Float32Array?Float32Array:Array;function od(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=e[9],f=e[10],d=e[11],p=e[12],g=e[13],m=e[14],y=e[15],v=n[0],_=n[1],x=n[2],b=n[3];return t[0]=v*i+_*a+x*c+b*p,t[1]=v*r+_*h+x*A+b*g,t[2]=v*o+_*l+x*f+b*m,t[3]=v*s+_*u+x*d+b*y,t[4]=(v=n[4])*i+(_=n[5])*a+(x=n[6])*c+(b=n[7])*p,t[5]=v*r+_*h+x*A+b*g,t[6]=v*o+_*l+x*f+b*m,t[7]=v*s+_*u+x*d+b*y,t[8]=(v=n[8])*i+(_=n[9])*a+(x=n[10])*c+(b=n[11])*p,t[9]=v*r+_*h+x*A+b*g,t[10]=v*o+_*l+x*f+b*m,t[11]=v*s+_*u+x*d+b*y,t[12]=(v=n[12])*i+(_=n[13])*a+(x=n[14])*c+(b=n[15])*p,t[13]=v*r+_*h+x*A+b*g,t[14]=v*o+_*l+x*f+b*m,t[15]=v*s+_*u+x*d+b*y,t}function sd(){var t=new rd(3);return rd!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ad(t,e,n){var i=new rd(3);return i[0]=t,i[1]=e,i[2]=n,i}function hd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ld(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function ud(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function cd(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Ad(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function fd(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,t}function dd(){var t=new rd(4);return rd!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),sd(),function(){var t;t=new rd(4),rd!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var pd,gd=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};sd(),ad(1,0,0),ad(0,1,0),dd(),dd(),pd=new rd(9),rd!=Float32Array&&(pd[1]=0,pd[2]=0,pd[3]=0,pd[5]=0,pd[6]=0,pd[7]=0),pd[0]=1,pd[4]=1,pd[8]=1;let md=0;function yd(t){return null==t}function vd(t){return!yd(t)}function _d(t){return!yd(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function xd(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function bd(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+t)}function wd(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function Cd(t){const e=(r=t.substring(t.indexOf(",")+1),"undefined"!=typeof self?self.atob(r):window.atob(r)),n=e.length,i=new Uint8Array(n);var r;for(let o=0;o<n;o++)i[o]=e.charCodeAt(o);return i.buffer}const Pd=[],Md=[],Td=[],Sd=[0,0,0],Id=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),Ed=[1,1,1];function Od(t,e,n,i,r,o,s){const a=bd(s),h=a.BYTES_PER_ELEMENT;if((0===r||r===i*h)&&o%h==0){const r=new a(e,o,n*i);return t.set(r),t}0===r&&(r=i*h);const l=new Uint8Array(i*h);for(let u=0;u<n;u++){let n=null;const s=new Uint8Array(e,r*u+o,i*h);l.set(s),n=new a(l.buffer,0,i);for(let e=0;e<i;e++)t[u*i+e]=n[e]}return t}const Rd="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function Dd(t,e,n){const i=new Uint8Array(t,e,n);return Rd.decode(i)}const kd={get:function(t,e={},n){e||(e={});const i=new AbortController,r=i.signal,o=xd({},e);o.signal=r,o.method||(o.method="GET"),o.referrerPolicy=o.referrerPolicy||"origin","undefined"==typeof window||o.referrer||(o.referrer=window.location.href),n&&(t=n(t));const s=fetch(t,o).then((t=>{const n=this._parseResponse(t,e.responseType);return n.message?n:n.then((n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return s.xhr=i,s},_parseResponse:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={},n)=>(e||(e={}),e.responseType="arraybuffer",kd.get(t,e,n)),getJSON:function(t,e={},n){return e&&e.jsonp?kd.jsonp(t):((e=e||{}).responseType="json",kd.get(t,e,n))},jsonp:function(t){const e="_maptalks_jsonp_"+md++;t.match(/\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise((t=>{window[e]=function(i){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(i)},document.getElementsByTagName("head")[0].appendChild(n)}))}};let Ld=class{constructor(t,e,n,i,r){this._requestImage=t,this.decoders=e,this._supportedFormats=n,this.images={},this._imgRequests={},this._fetchOptions=i||{},this._urlModifier=r}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const i=this._createDataView(e,this.buffers[t.id]);return this.getImageByBuffer(i,n)}if(this._imgRequests[t.id])return this._imgRequests[t.id].then((()=>{const i=this._createDataView(e,this.buffers[t.id]);return this.getImageByBuffer(i,n)}));if(wd(t.uri)){const i=this.buffers[t.id]=Cd(t.uri),r=this._createDataView(e,i);return this.getImageByBuffer(r,n)}let i;const r=t.uri.indexOf("blob:")>=0;return i=t.uri.indexOf("://")>0||r?t.uri:this.rootPath+"/"+t.uri,this._imgRequests[t.id]=kd.getArrayBuffer(i,this._fetchOptions,this._urlModifier).then((i=>{const r=this.buffers[t.id]=i.data,o=this._createDataView(e,r);return this.getImageByBuffer(o,n)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;return n[e.mimeType]?n[e.mimeType](t,{supportedFormats:this._supportedFormats}):"image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType?(console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this._getImageInfo(e.id,t)}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this._imgRequests[t.id]?this._imgRequests[t.id].then((()=>this.images[t.id])):this._imgRequests[t.id]=this._getImageInfo(t.id,e)}_getImageInfo(t,e){return new Promise(((n,i)=>{let r=e;this._urlModifier&&(r=this._urlModifier(e)),this._requestImage(r,this._fetchOptions,((r,o)=>{r?i(r):(URL.revokeObjectURL(e),this.images[t]=o,n(this.images[t]))}))}))}};const Fd=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],Nd=[];let zd=class{constructor(t,e,n,i,r){this.rootPath=t,this.gltf=e,this._enableInterleave=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this._compareAccessor(),this._fetchOptions=i,this._urlModifier=r}_requestData(t,e){const n=this.gltf,i=n.accessors[e];return void 0===i.bufferView?(this.accessors[i.id]=this._toBufferData(t,e,null,0),Promise.resolve(this.accessors[i.id])):i&&this.accessors[i.id]?Promise.resolve(this.accessors[i.id]):this._requestBufferOfBufferView(n.bufferViews[i.bufferView]).then((n=>{const{buffer:r,byteOffset:o}=n;return this.accessors[i.id]=this._toBufferData(t,e,r,o)}))}_requestBufferOfBufferView(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id])return Promise.resolve({buffer:this.buffers[e.id],byteOffset:0});if(this.requests[e.id])return this.requests[e.id].then((()=>Promise.resolve({buffer:this.buffers[e.id],byteOffset:0})));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(wd(e.uri)){const t=this.buffers[e.id]=Cd(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=kd.getArrayBuffer(t,this._fetchOptions,!n&&this._urlModifier).then((i=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=i.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_toBufferData(t,e,n,i=0){const r=this.gltf,o=r.accessors[e],s=void 0!==o.bufferView?r.bufferViews[o.bufferView]:{},a=(s.byteOffset||0)+i,h=this._getTypeItemSize(o.type),l=bd(o.componentType),u=s.byteStride||0,c={array:void 0,name:t,accessorName:e,byteLength:o.count*h*l.BYTES_PER_ELEMENT,componentType:o.componentType,count:o.count,type:o.type,itemSize:h,max:o.max,min:o.min,extensions:o.extensions};if(o.min&&(c.min=o.min),o.max&&(c.max=o.max),n)if(this._enableInterleave)c.byteStride=u,c.byteOffset=a+(o.byteOffset||0),!u||u===h*l.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(c.array=this._typedArray(n,o.count,h,a+(o.byteOffset||0),l),c.array.buffer.byteLength===c.byteLength&&(c.byteOffset=0)):c.array=new Uint8Array(n,a,s.byteLength);else if(o.interleaved){c.byteStride=0,c.byteOffset=0;const t=new l(o.count*h);if(c.array=Od(t,n,o.count,h,u,a+(o.byteOffset||0),o.componentType),c.extensions&&c.extensions.WEB3D_quantized_attributes&&h>2){const t=new Float32Array(c.array.length),{decodeMatrix:e}=c.extensions.WEB3D_quantized_attributes;for(let n=0;n<c.array.length;n+=h){Nd[0]=c.array[n],Nd[1]=c.array[n+1],Nd[2]=c.array[n+2],Nd[3]=1;const i=fd(Nd,Nd,e);t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2]}c.componentType=5126,c.array=t}}else c.byteStride=0,c.array=this._typedArray(n,o.count,h,a+(o.byteOffset||0),l),c.byteOffset=c.array.byteOffset;else{c.array=new l(o.count);const t=c.min||c.max;t&&(c.array[0]=t[0],c.array[1]=t[1],c.array[2]=t[2])}return c}_compareAccessor(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}_typedArray(t,e,n,i,r){return i%r.BYTES_PER_ELEMENT!=0&&(t=t.slice(i,i+e*n*r.BYTES_PER_ELEMENT),i=0),new r(t,i,n*e)}_getTypeItemSize(t){const e=Fd.indexOf(t);return Fd[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this._requestBufferOfBufferView(e).then((i=>{const{buffer:r,byteOffset:o}=i,s=Dd(r,o+(e.byteOffset||0),n);return t.content=s,t}))}if(t.uri){if(wd(t.uri)){const e=Cd(t.uri),n=Dd(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}return kd.get(this.rootPath+"/"+t.uri,this._fetchOptions,this._urlModifier).then((e=>(t.content=e,t)))}return Promise.resolve(t)}));return Promise.all(n).then((()=>t))}},Bd=class extends Ld{constructor(t,e,n,i,r,o,s,a){super(i,r,o,s,a),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new zd(t,e,n,s,a)}iterate(t,e){const n=this.gltf[e];if(!n)return;let i=0;for(const r in n)t(r,n[r],i++)}createNode(t){const e={};if(vd(t.name)&&(e.name=t.name),vd(t.children)&&(e.children=t.children),vd(t.jointName)&&(e.jointName=t.jointName),vd(t.matrix)&&(e.matrix=t.matrix),vd(t.rotation)&&(e.rotation=t.rotation),vd(t.scale)&&(e.scale=t.scale),vd(t.translation)&&(e.translation=t.translation),vd(t.extras)&&(e.extras=t.extras),vd(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=(n=Pd,i=e.translation||Sd,n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n),o=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,h=r+r,l=n*s,u=i*s,c=i*a,A=r*s,f=r*a,d=r*h,p=o*s,g=o*a,m=o*h;return t[0]=1-c-d,t[1]=u+m,t[2]=A-g,t[3]=0,t[4]=u-m,t[5]=1-l-d,t[6]=f+p,t[7]=0,t[8]=A+g,t[9]=f-p,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(Md,e.rotation||Id),s=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(Td,e.scale||Ed);return od(s,o,s),od(t,r,s)}var n,i;return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}_loadMaterials(t){const e={};for(const n in t){const i=t[n];let r,o;i.instanceTechnique&&i.instanceTechnique.values?(r=i.instanceTechnique,o=r.values.diffuse):(r=i,o=r.values.tex||r.values.diffuseTex||r.values.diffuse);const s={baseColorTexture:{index:o}};i.name&&(s.name=i.name),i.extensions&&(s.extensions=i.extensions),i.extras&&(s.extras=i.extras),e[n]=s}return e}_loadImage(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,(n.byteOffset||0)+this.glbBuffer.byteOffset,n.byteLength);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}_getTexture(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this._loadImage(n).then((t=>({image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:this.gltf.samplers[e.sampler]})))}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,i;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,i=n.values.diffuse):(n=e,i=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===i||void 0===this.gltf.textures)return null;const r=this.gltf.textures[i];return r?{format:r.format||6408,internalFormat:r.internalFormat||6408,type:r.type||5121,sampler:this.gltf.samplers[r.sampler],source:this.gltf.images[r.source]}:null}getMaterial(){return null}getAnimations(){return null}};const Hd=9729;let jd=class extends Ld{constructor(t,e,n,i,r,o,s,a){super(i,r,o,s,a),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new zd(t,e,n,s,a)}iterate(t,e){const n=this.gltf[e];if(n)for(let i=0;i<n.length;i++)t(i,n[i],i)}createNode(t){const e={};return xd(e,t),!vd(t.weights)&&this.gltf.meshes&&vd(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}_getTexture(t){const e=this.gltf.textures[t];if(!e)return null;let n=e.source;if(e.extensions&&e.extensions.EXT_texture_webp&&(n=e.extensions.EXT_texture_webp.source),!vd(n))return null;const i=this.gltf.images[n];return this._loadImage(i).then((t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:i.mimeType,name:i.name,extensions:i.extensions,extras:i.extras}};xd(n,e);const r=vd(e.sampler)?this.gltf.samplers[e.sampler]:void 0;if(r&&(n.sampler=r,n.sampler.magFilter=r.magFilter||Hd,n.sampler.minFilter=r.minFilter||9987,n.sampler.wrapS=r.wrapS||10497,n.sampler.wrapT=r.wrapT||10497),"image/ktx2"===n.image.mimeType&&!n.image.mipmap&&n.sampler&&n.sampler.minFilter!==Hd&&9728!==n.sampler.minFilter){const t=n.sampler.minFilter;n.sampler.minFilter=9984===t||9986===t?9728:Hd}return t.format&&(n.format=t.format),n}))}_loadImage(t){if(!vd(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this._requestFromGlbBuffer(e,t)}return null}_requestFromGlbBuffer(t,e){const n=this._createDataView(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}_createDataView(t,e,n){return n=n||0,new Uint8Array(e,(t.byteOffset||0)+n,t.byteLength)}_transformArrayBufferToBase64(t,e){const n=new Array(t.byteLength);for(let r=0;r<t.byteLength;r++)n[r]=String.fromCharCode(t[r]);var i;return n.join(""),"data:"+(e=e||"image/png")+";base64,"+(i=unescape(encodeURIComponent(n)),"undefined"!=typeof self?self.btoa(i):window.btoa(i))}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t}))}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(vd(t[n].input)||vd(t[n].output))&&(e.push(this.accessor._requestData("input",t[n].input)),e.push(this.accessor._requestData("output",t[n].output)));return Promise.all(e).then((e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t}))}};const Ud="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let Gd=class t{static read(e,n=0,i=0){i||(i=e.byteLength);const r=new DataView(e,n,i),o=r.getUint32(4,!0);if(1===o)return t.readV1(r,n);if(2===o)return t.readV2(e,n);throw new Error("Unsupported glb version : "+o)}static readV1(t,e){const n=t.getUint32(8,!0),i=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const r=Vd(t.buffer,20+e,i);return{json:JSON.parse(r),glbBuffer:{byteOffset:20+e+i,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,i,r;const o=new DataView(t,e+12);let s=0;for(;s+8<o.byteLength;){const a=o.getUint32(s,!0);s+=4;const h=o.getUint32(s,!0);if(s+=4,1313821514===h)n=Vd(t,e+12+s,a);else if(5130562===h){r=e+12+s,i=a;break}s+=a}return{json:JSON.parse(n),glbBuffer:{byteOffset:r,buffer:t,byteLength:i}}}};function Vd(t,e,n){if(Ud){const i=new Uint8Array(t,e,n);return Ud.decode(i)}return function(t){const e=t.length;let n="";for(let i=0;i<e;){let r=t[i++];if(128&r){let n=Wd[r>>3&7];if(!(64&r)||!n||i+n>e)return null;for(r&=63>>n;n>0;n-=1){const e=t[i++];if(128!=(192&e))return null;r=r<<6|63&e}}n+=String.fromCharCode(r)}return n}(new Uint8Array(t,e,n))}const Wd=[1,1,1,1,2,2,3,0],qd=[0,0,0],Zd=[0,0,0,1],Qd=[1,1,1],Xd={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},Yd={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},Jd={_getTRSW(t,e,n,i,r,o,s,a){const h=vd(t)?e.animations:[e.animations[0]],l={};for(let u=0;u<h.length;u++){const e=h[u],c=e.name||u;if(vd(t)&&c!==t)continue;const A=e.channelsMap[n];if(A)for(let t=0;t<A.length;t++){const n=A[t];"translation"===n.target.path?(this._getAnimateData(r,e.samplers[n.sampler],i,1),l.translation=hd(qd,r)):"rotation"===n.target.path?(this._getQuaternion(o,e.samplers[n.sampler],i,1),l.rotation=gd(Zd,o)):"scale"===n.target.path?(this._getAnimateData(s,e.samplers[n.sampler],i,1),l.scale=hd(Qd,s)):"weights"===n.target.path&&a&&(this._getAnimateData(a,e.samplers[n.sampler],i,a.length),l.weights=a)}}return l},_getAnimateData(t,e,n,i){switch(e.interpolation){case"LINEAR":{const r=this._getPreNext(Yd,e,n,1*i);r&&(t=function(t,e,n,i){for(let r=0;r<t.length;r++)t[r]=e[r]+i*(n[r]-e[r]);return t}(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION));break}case"STEP":{const r=this._getPreNext(Yd,e,n,1*i);r&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this._getPreNext(Yd,e,n,3*i);r&&(t=this._getCubicSpline(t,r,e.input.array,3*i));break}}return t},_getQuaternion(t,e,n){switch(e.interpolation){case"LINEAR":{const _=this._getPreNext(Yd,e,n,1);_&&(i=t,r=_.PREVIOUS,o=_.NEXT,s=_.INTERPOLATION,A=r[0],f=r[1],d=r[2],p=r[3],g=o[0],m=o[1],y=o[2],v=o[3],(h=A*g+f*m+d*y+p*v)<0&&(h=-h,g=-g,m=-m,y=-y,v=-v),1-h>1e-6?(a=Math.acos(h),l=Math.sin(a),u=Math.sin((1-s)*a)/l,c=Math.sin(s*a)/l):(u=1-s,c=s),i[0]=u*A+c*g,i[1]=u*f+c*m,i[2]=u*d+c*y,i[3]=u*p+c*v);break}case"STEP":{const i=this._getPreNext(Yd,e,n,1);i&&(t=Ad(t,...i.PREVIOUS));break}case"CUBICSPLINE":{const i=this._getPreNext(Yd,e,n,3);if(i){for(let t=0;t<i.PREVIOUS.length;t++)i.PREVIOUS[t]=Math.acos(i.PREVIOUS[t]),i.NEXT[t]=Math.acos(i.NEXT[t]);t=this._getCubicSpline(t,i,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}var i,r,o,s,a,h,l,u,c,A,f,d,p,g,m,y,v;return t},_search(t,e){const n=t.length;let i,r,o,s=0,a=n-1,h=Math.floor((s+a)/2);for(;s<=n-1&&a>=0;){if(s===a)return null;if(t[h]<=e&&e<=t[h+1]){const n=t[h];return i=h,r=h+1,o=(e-n)/(t[h+1]-n),{preIndx:i,nextIndex:r,interpolation:o}}e<t[h]?(a=h,h=Math.floor((s+a)/2)):t[h+1]<e&&(s=h,h=Math.floor((s+a)/2))}return null},_getPreNext(t,e,n,i){const r=e.input.array,o=e.output.array,s=e.output.itemSize;(n<r[0]||n>r[r.length-1])&&(n=Math.max(r[0],Math.min(r[r.length-1],n))),n===r[r.length-1]&&(n=r[0]);const a=this._search(r,n);if(!a||!a.nextIndex)return null;const{preIndx:h,nextIndex:l,interpolation:u}=a;t.PREINDEX=h,t.NEXTINDEX=l,t.INTERPOLATION=u;const c=s*i;return t.PREVIOUS=o.subarray(t.PREINDEX*c,(t.PREINDEX+1)*c),t.NEXT=o.subarray(t.NEXTINDEX*c,(t.NEXTINDEX+1)*c),t},_getCubicSpline(t,e,n,i){const r=e.INTERPOLATION,o=n[e.PREINDEX],s=n[e.NEXTINDEX];for(let a=0;a<3;a++){const n=e.PREVIOUS[i+a],h=(s-o)*e.PREVIOUS[2*i+a],l=e.NEXT[3+a],u=(s-o)*e.NEXT[a],c=(2*Math.pow(r,3)-3*Math.pow(r,2)+1)*n+(Math.pow(r,3)-2*Math.pow(r,2)+r)*h+(2*-Math.pow(r,3)+3*Math.pow(r,2))*l+(Math.pow(r,3)-Math.pow(r,2))*u;t[a]=c}return t},getAnimationClip(t,e,n,i){const r=t.nodes[e]&&t.nodes[e].weights;return ld(qd,...Xd.TRANSLATION),Ad(Zd,...Xd.ROTATION),ld(Qd,...Xd.SCALE),this._getTRSW(i,t,e,n,qd,Zd,Qd,r)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,n)=>{let i=-1/0,r=1/0;const o=e.channels;for(let t=0;t<o.length;t++){const n=e.samplers[o[t].sampler].input.array;n[n.length-1]>i&&(i=n[n.length-1]),n[0]<r&&(r=n[0])}t.timeSpan[e.name||n]={max:i,min:r}})),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?vd(e)?n[e]:n[Object.keys(n)[0]]:null}};let Kd=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(cft){}t&&"undefined"!=typeof createImageBitmap&&(Kd=!0)}const $d="undefined"==typeof document?null:document.createElement("canvas");let tp=class{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),this._fetchOptions=this.options.fetchOptions||{},e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:i}=Gd.read(e.buffer,e.byteOffset,e.byteLength);this._init(t,n,i)}else this._init(t,e);this._accessor=new zd(this.rootPath,this.gltf,this.glbBuffer,this._fetchOptions,this.options.urlModifier),this._checkExtensions()}_checkExtensions(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders["image/ktx2"])throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded");if(t.indexOf("EXT_meshopt_compression")>=0)throw new Error("EXT_meshopt_compression extension is not supported yet.")}}_loadExtensions(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this._accessor.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){const e=this._loadScene(t=t||{}),n=this._loadAnimations(),i=this._loadTextures(),r=this._loadExtensions();return Promise.all([e,n,i,r]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let n=0;n<e.length;n++){const t=e[n];t.channelsMap={};for(let e=0;e<t.channels.length;e++){const n=t.channels[e];t.channelsMap[n.target.node]||(t.channelsMap[n.target.node]=[]),t.channelsMap[n.target.node].push(n)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let i=0;i<e.length;i++)e[i].uri&&e[i].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[i].uri});for(let i=0;i<n.length;i++)n[i].uri&&n[i].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[i].uri})}return t}static getAnimationClip(t,e,n,i){return Jd.getAnimationClip(t,e,n,i)}static getAnimationTimeSpan(t,e){return Jd.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return bd(t)}static readInterleavedArray(t,e,n,i,r,o,s){return Od(t,e,n,i,r,o,s)}_init(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=Kd?ap.bind(this):this.options.requestImage||ep,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new jd(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="buffer_"+n}),"buffers"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors")):(this.adapter=new Bd(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"))}_parseNodes(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||_d(t.children[0])))return t;const i=t.children.map((t=>{const n=e[t];return n.nodeIndex=t,this._parseNodes(n,e)}));t.children=i}var n;return t}_loadScene(t){return this._loadNodes(t).then((t=>{const e=this.scenes=[];let n;for(const r in t)t[r]=this._parseNodes(t[r],t),t[r].nodeIndex=Number(r)?Number(r):r;this.adapter.iterate(((i,r,o)=>{const s={};r.name&&(s.name=r.name),r.nodes&&(s.nodes=r.nodes.map((e=>t[e]))),this.gltf.scene===i&&(n=o),e.push(s)}),"scenes");const i={textures:this.gltf.textures,asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(i.extensions=this.gltf.extensions),1===this.version){const t=this.adapter._loadMaterials(this.gltf.materials);i.materials=t}return delete this.gltf.buffers,i.json=this.gltf,i}))}_loadNodes(t){return this._loadMeshes(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,n)=>{const i=this.adapter.createNode(n,this.meshes,this.skins);t[e]=i}),"nodes"),t}))}_loadSkins(){this.skins=[];const t=[];return this.adapter.iterate(((e,n,i)=>{t.push(this._loadSkin(n).then((t=>{t.index=i,this.skins.push(t)})))}),"skins"),t}_loadSkin(t){return this.adapter.accessor._requestData("inverseBindMatrices",t.inverseBindMatrices).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}_loadAnimations(){const t=this.gltf.animations;return vd(t)?this.adapter.getAnimations(t):null}_loadMeshes(t){this.meshes={};let e=[];return this.adapter.iterate(((n,i,r)=>{e.push(this._loadMesh(i,t).then((t=>{t.index=r,this.meshes[n]=t})))}),"meshes"),e=e.concat(this._loadSkins()),Promise.all(e)}_loadMesh(t,e){const n=t.primitives.map((t=>this._loadPrimitive(t,e))).filter((t=>!!t));return Promise.all(n).then((e=>{const n={};return xd(n,t),n.primitives=e,n}))}_loadTextures(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter._getTexture(n));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t]&&e[t].image.array;if(n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},i=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[i[t]]=e[t]);return n}return e}))}_loadPrimitive(t,e){let n;const i=[],r=t.extensions;if(vd(t.targets))for(let o=0;o<t.targets.length;o++){const e=t.targets[o];for(const t in e){const n=this.adapter.accessor._requestData(`morphTargets_${t}_${o}`,e[t]);n&&i.push(n)}}if(r&&r.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:o,attributes:s}=r.KHR_draco_mesh_compression,a=this.gltf.bufferViews[o],h=this._accessor._requestBufferOfBufferView(a).then((n=>{const{buffer:i,byteOffset:r}=n;let{byteOffset:o}=a;o||(o=0);const h=new DataView(i,r+o,a.byteLength);return t(h,{attributes:s,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform}).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));i.push(h),n=Promise.all(i)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor._requestData(t,e[t]);n&&i.push(n)}if(vd(t.indices)){const e=this.adapter.accessor._requestData("indices",t.indices);e&&i.push(e)}n=Promise.all(i)}return n.then((e=>{if(r&&r.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,i;const o={attributes:e.reduce(((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)i=i||{},i[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:i,array:r}=e,o=r.length/i;for(let e=0;e<o;e++)for(let o=0;o<i;o++){const s=e*i+o;r[s]<t[o]&&(t[o]=r[s]),r[s]>n[o]&&(n[o]=r[s])}if(e.quantization){const i=e.quantization,r=i.range/(1<<i.quantizationBits),o=i.minValues;cd(t,t,r),ud(t,t,o),cd(n,n,r),ud(n,n,o)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return n&&(o.indices=n),i&&(o.morphTargets=i),o.mode=vd(t.mode)?t.mode:4,vd(t.extras)&&(o.extras=t.extras),o}))}};function ep(t,e,n){const i=new Image;i.crossOrigin="",i.onload=()=>{if(!$d)return void n(new Error("There is no canvas to draw image!"));$d.width=i.width,$d.height=i.height;const t=$d.getContext("2d",{willReadFrequently:!0});t.drawImage(i,0,0,i.width,i.height);const e=t.getImageData(0,0,i.width,i.height),r={width:i.width,height:i.height,data:new Uint8Array(e.data)};n(null,r)},i.onerror=function(t){n(t)},i.src=t}const np=[],ip=[],rp=30;let op,sp;function ap(t,e,n){op||(op=new OffscreenCanvas(2,2),sp=op.getContext("2d",{willReadFrequently:!0}));let i=null;if(_d(t))this.options.urlModifier&&(t=this.options.urlModifier(t)),np.push([t,e,n,this]),hp();else{const e=new Blob([t]);i=createImageBitmap(e),i.then(lp.bind(this)).then((t=>{n(null,t)})).catch((t=>{console.warn(t),n(t)}))}}function hp(){if(!np.length||ip.length>rp)return;const t=np.shift(),[e,n,i,r]=t;ip.push(t),fetch(e,n).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then(lp.bind(r)).then((e=>{i.call(r,null,e);const n=ip.indexOf(t);ip.splice(n,1),hp()})).catch((e=>{console.warn(e),i.call(r,e);const n=ip.indexOf(t);ip.splice(n,1),hp()}))}function lp(t){let{width:e,height:n}=t;up(e)||(e=cp(e)),up(n)||(n=cp(n));const i=this.options.maxTextureSize;i&&(e=Math.min(i,e),n=Math.min(i,n)),op.width=e,op.height=n,sp.drawImage(t,0,0,e,n),t.close();const r=sp.getImageData(0,0,e,n);return{width:e,height:n,data:new Uint8Array(r.data)}}function up(t){return!(t&t-1)&&0!==t}function cp(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Ap=1e-6,fp="undefined"!=typeof Float32Array?Float32Array:Array,dp=Math.random,pp=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var gp=Object.freeze({__proto__:null,get ARRAY_TYPE(){return fp},EPSILON:Ap,RANDOM:dp,equals:function(t,e){return Math.abs(t-e)<=Ap*Math.max(1,Math.abs(t),Math.abs(e))},setMatrixArrayType:function(t){fp=t},toRadian:function(t){return t*pp}});function mp(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function yp(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=n[0],h=n[1],l=n[2],u=n[3];return t[0]=i*a+o*h,t[1]=r*a+s*h,t[2]=i*l+o*u,t[3]=r*l+s*u,t}function vp(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t}function _p(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}var xp=Object.freeze({__proto__:null,LDU:function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},adjoint:function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},clone:function(t){var e=new fp(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},create:function(){var t=new fp(4);return fp!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},determinant:function(t){return t[0]*t[3]-t[2]*t[1]},equals:function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=e[0],a=e[1],h=e[2],l=e[3];return Math.abs(n-s)<=Ap*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=Ap*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-h)<=Ap*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-l)<=Ap*Math.max(1,Math.abs(o),Math.abs(l))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3])},fromRotation:vp,fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},fromValues:function(t,e,n,i){var r=new fp(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},invert:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n*o-r*i;return s?(t[0]=o*(s=1/s),t[1]=-i*s,t[2]=-r*s,t[3]=n*s,t):null},mul:yp,multiply:yp,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},multiplyScalarAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},rotate:function(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),h=Math.cos(n);return t[0]=i*h+o*a,t[1]=r*h+s*a,t[2]=i*-a+o*h,t[3]=r*-a+s*h,t},scale:function(t,e,n){var i=e[1],r=e[2],o=e[3],s=n[0],a=n[1];return t[0]=e[0]*s,t[1]=i*s,t[2]=r*a,t[3]=o*a,t},set:mp,str:function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},sub:_p,subtract:_p,transpose:function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t}});function bp(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=n[0],u=n[1],c=n[2],A=n[3],f=n[4],d=n[5];return t[0]=i*l+o*u,t[1]=r*l+s*u,t[2]=i*c+o*A,t[3]=r*c+s*A,t[4]=i*f+o*d+a,t[5]=r*f+s*d+h,t}function wp(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}var Cp=Object.freeze({__proto__:null,add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},clone:function(t){var e=new fp(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},create:function(){var t=new fp(6);return fp!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},determinant:function(t){return t[0]*t[3]-t[1]*t[2]},equals:function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],h=e[0],l=e[1],u=e[2],c=e[3],A=e[4],f=e[5];return Math.abs(n-h)<=Ap*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-l)<=Ap*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-u)<=Ap*Math.max(1,Math.abs(r),Math.abs(u))&&Math.abs(o-c)<=Ap*Math.max(1,Math.abs(o),Math.abs(c))&&Math.abs(s-A)<=Ap*Math.max(1,Math.abs(s),Math.abs(A))&&Math.abs(a-f)<=Ap*Math.max(1,Math.abs(a),Math.abs(f))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},fromRotation:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},fromValues:function(t,e,n,i,r,o){var s=new fp(6);return s[0]=t,s[1]=e,s[2]=n,s[3]=i,s[4]=r,s[5]=o,s},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},invert:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=n*o-i*r;return h?(t[0]=o*(h=1/h),t[1]=-i*h,t[2]=-r*h,t[3]=n*h,t[4]=(r*a-o*s)*h,t[5]=(i*s-n*a)*h,t):null},mul:bp,multiply:bp,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},multiplyScalarAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},rotate:function(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=Math.sin(n),u=Math.cos(n);return t[0]=i*u+o*l,t[1]=r*u+s*l,t[2]=i*-l+o*u,t[3]=r*-l+s*u,t[4]=a,t[5]=h,t},scale:function(t,e,n){var i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=n[0],l=n[1];return t[0]=e[0]*h,t[1]=i*h,t[2]=r*l,t[3]=o*l,t[4]=s,t[5]=a,t},set:function(t,e,n,i,r,o,s){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t},str:function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},sub:wp,subtract:wp,translate:function(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=n[0],u=n[1];return t[0]=i,t[1]=r,t[2]=o,t[3]=s,t[4]=i*l+o*u+a,t[5]=r*l+s*u+h,t}});function Pp(){var t=new fp(9);return fp!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Mp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function Tp(t,e,n,i,r,o,s,a,h,l){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=l,t}function Sp(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t}function Ip(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=u*s-a*l,A=-u*o+a*h,f=l*o-s*h,d=n*c+i*A+r*f;return d?(t[0]=c*(d=1/d),t[1]=(-u*i+r*l)*d,t[2]=(a*i-r*s)*d,t[3]=A*d,t[4]=(u*n-r*h)*d,t[5]=(-a*n+r*o)*d,t[6]=f*d,t[7]=(-l*n+i*h)*d,t[8]=(s*n-i*o)*d,t):null}function Ep(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=n[0],f=n[1],d=n[2],p=n[3],g=n[4],m=n[5],y=n[6],v=n[7],_=n[8];return t[0]=A*i+f*s+d*l,t[1]=A*r+f*a+d*u,t[2]=A*o+f*h+d*c,t[3]=p*i+g*s+m*l,t[4]=p*r+g*a+m*u,t[5]=p*o+g*h+m*c,t[6]=y*i+v*s+_*l,t[7]=y*r+v*a+_*u,t[8]=y*o+v*h+_*c,t}function Op(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t}function Rp(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,h=r+r,l=n*s,u=i*s,c=i*a,A=r*s,f=r*a,d=r*h,p=o*s,g=o*a,m=o*h;return t[0]=1-c-d,t[3]=u-m,t[6]=A+g,t[1]=u+m,t[4]=1-l-d,t[7]=f-p,t[2]=A-g,t[5]=f+p,t[8]=1-l-c,t}function Dp(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}var kp=Object.freeze({__proto__:null,add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},adjoint:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8];return t[0]=s*u-a*l,t[1]=r*l-i*u,t[2]=i*a-r*s,t[3]=a*h-o*u,t[4]=n*u-r*h,t[5]=r*o-n*a,t[6]=o*l-s*h,t[7]=i*h-n*l,t[8]=n*s-i*o,t},clone:function(t){var e=new fp(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},copy:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},create:Pp,determinant:function(t){var e=t[3],n=t[4],i=t[5],r=t[6],o=t[7],s=t[8];return t[0]*(s*n-i*o)+t[1]*(-s*e+i*r)+t[2]*(o*e-n*r)},equals:function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],h=t[6],l=t[7],u=t[8],c=e[0],A=e[1],f=e[2],d=e[3],p=e[4],g=e[5],m=e[6],y=e[7],v=e[8];return Math.abs(n-c)<=Ap*Math.max(1,Math.abs(n),Math.abs(c))&&Math.abs(i-A)<=Ap*Math.max(1,Math.abs(i),Math.abs(A))&&Math.abs(r-f)<=Ap*Math.max(1,Math.abs(r),Math.abs(f))&&Math.abs(o-d)<=Ap*Math.max(1,Math.abs(o),Math.abs(d))&&Math.abs(s-p)<=Ap*Math.max(1,Math.abs(s),Math.abs(p))&&Math.abs(a-g)<=Ap*Math.max(1,Math.abs(a),Math.abs(g))&&Math.abs(h-m)<=Ap*Math.max(1,Math.abs(h),Math.abs(m))&&Math.abs(l-y)<=Ap*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-v)<=Ap*Math.max(1,Math.abs(u),Math.abs(v))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},fromMat2d:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},fromMat4:Mp,fromQuat:Rp,fromRotation:Op,fromScaling:function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},fromTranslation:function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},fromValues:function(t,e,n,i,r,o,s,a,h){var l=new fp(9);return l[0]=t,l[1]=e,l[2]=n,l[3]=i,l[4]=r,l[5]=o,l[6]=s,l[7]=a,l[8]=h,l},identity:function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},invert:Ip,mul:Ep,multiply:Ep,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},multiplyScalarAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},normalFromMat4:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],A=e[10],f=e[11],d=e[12],p=e[13],g=e[14],m=e[15],y=n*a-i*s,v=n*h-r*s,_=n*l-o*s,x=i*h-r*a,b=i*l-o*a,w=r*l-o*h,C=u*p-c*d,P=u*g-A*d,M=u*m-f*d,T=c*g-A*p,S=c*m-f*p,I=A*m-f*g,E=y*I-v*S+_*T+x*M-b*P+w*C;return E?(t[0]=(a*I-h*S+l*T)*(E=1/E),t[1]=(h*M-s*I-l*P)*E,t[2]=(s*S-a*M+l*C)*E,t[3]=(r*S-i*I-o*T)*E,t[4]=(n*I-r*M+o*P)*E,t[5]=(i*M-n*S-o*C)*E,t[6]=(p*w-g*b+m*x)*E,t[7]=(g*_-d*w-m*v)*E,t[8]=(d*b-p*_+m*y)*E,t):null},projection:function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},rotate:function(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=Math.sin(n),f=Math.cos(n);return t[0]=f*i+A*s,t[1]=f*r+A*a,t[2]=f*o+A*h,t[3]=f*s-A*i,t[4]=f*a-A*r,t[5]=f*h-A*o,t[6]=l,t[7]=u,t[8]=c,t},scale:function(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},set:Tp,str:function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},sub:Dp,subtract:Dp,translate:function(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=n[0],f=n[1];return t[0]=i,t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=A*i+f*s+l,t[7]=A*r+f*a+u,t[8]=A*o+f*h+c,t},transpose:Sp});function Lp(){var t=new fp(16);return fp!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function Fp(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Np(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function zp(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],o=e[6],s=e[7],a=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=r,t[13]=s,t[14]=a}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function Bp(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],A=e[10],f=e[11],d=e[12],p=e[13],g=e[14],m=e[15],y=n*a-i*s,v=n*h-r*s,_=n*l-o*s,x=i*h-r*a,b=i*l-o*a,w=r*l-o*h,C=u*p-c*d,P=u*g-A*d,M=u*m-f*d,T=c*g-A*p,S=c*m-f*p,I=A*m-f*g,E=y*I-v*S+_*T+x*M-b*P+w*C;return E?(t[0]=(a*I-h*S+l*T)*(E=1/E),t[1]=(r*S-i*I-o*T)*E,t[2]=(p*w-g*b+m*x)*E,t[3]=(A*b-c*w-f*x)*E,t[4]=(h*M-s*I-l*P)*E,t[5]=(n*I-r*M+o*P)*E,t[6]=(g*_-d*w-m*v)*E,t[7]=(u*w-A*_+f*v)*E,t[8]=(s*S-a*M+l*C)*E,t[9]=(i*M-n*S-o*C)*E,t[10]=(d*b-p*_+m*y)*E,t[11]=(c*_-u*b-f*y)*E,t[12]=(a*P-s*T-h*C)*E,t[13]=(n*T-i*P+r*C)*E,t[14]=(p*v-d*x-g*y)*E,t[15]=(u*x-c*v+A*y)*E,t):null}function Hp(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=e[9],f=e[10],d=e[11],p=e[12],g=e[13],m=e[14],y=e[15],v=n[0],_=n[1],x=n[2],b=n[3];return t[0]=v*i+_*a+x*c+b*p,t[1]=v*r+_*h+x*A+b*g,t[2]=v*o+_*l+x*f+b*m,t[3]=v*s+_*u+x*d+b*y,t[4]=(v=n[4])*i+(_=n[5])*a+(x=n[6])*c+(b=n[7])*p,t[5]=v*r+_*h+x*A+b*g,t[6]=v*o+_*l+x*f+b*m,t[7]=v*s+_*u+x*d+b*y,t[8]=(v=n[8])*i+(_=n[9])*a+(x=n[10])*c+(b=n[11])*p,t[9]=v*r+_*h+x*A+b*g,t[10]=v*o+_*l+x*f+b*m,t[11]=v*s+_*u+x*d+b*y,t[12]=(v=n[12])*i+(_=n[13])*a+(x=n[14])*c+(b=n[15])*p,t[13]=v*r+_*h+x*A+b*g,t[14]=v*o+_*l+x*f+b*m,t[15]=v*s+_*u+x*d+b*y,t}function jp(t,e,n){var i,r,o,s,a,h,l,u,c,A,f,d,p=n[0],g=n[1],m=n[2];return e===t?(t[12]=e[0]*p+e[4]*g+e[8]*m+e[12],t[13]=e[1]*p+e[5]*g+e[9]*m+e[13],t[14]=e[2]*p+e[6]*g+e[10]*m+e[14],t[15]=e[3]*p+e[7]*g+e[11]*m+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=e[9],f=e[10],d=e[11],t[0]=i=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=l,t[7]=u,t[8]=c,t[9]=A,t[10]=f,t[11]=d,t[12]=i*p+a*g+c*m+e[12],t[13]=r*p+h*g+A*m+e[13],t[14]=o*p+l*g+f*m+e[14],t[15]=s*p+u*g+d*m+e[15]),t}function Up(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Gp(t,e,n,i){var r,o,s,a,h,l,u,c,A,f,d,p,g,m,y,v,_,x,b,w,C,P,M,T,S=i[0],I=i[1],E=i[2],O=Math.hypot(S,I,E);return O<Ap?null:(S*=O=1/O,I*=O,E*=O,r=Math.sin(n),o=Math.cos(n),h=e[1],l=e[2],u=e[3],A=e[5],f=e[6],d=e[7],g=e[9],m=e[10],y=e[11],b=S*I*(s=1-o)-E*r,w=I*I*s+o,C=E*I*s+S*r,P=S*E*s+I*r,M=I*E*s-S*r,T=E*E*s+o,t[0]=(a=e[0])*(v=S*S*s+o)+(c=e[4])*(_=I*S*s+E*r)+(p=e[8])*(x=E*S*s-I*r),t[1]=h*v+A*_+g*x,t[2]=l*v+f*_+m*x,t[3]=u*v+d*_+y*x,t[4]=a*b+c*w+p*C,t[5]=h*b+A*w+g*C,t[6]=l*b+f*w+m*C,t[7]=u*b+d*w+y*C,t[8]=a*P+c*M+p*T,t[9]=h*P+A*M+g*T,t[10]=l*P+f*M+m*T,t[11]=u*P+d*M+y*T,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function Vp(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],s=e[5],a=e[6],h=e[7],l=e[8],u=e[9],c=e[10],A=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+l*i,t[5]=s*r+u*i,t[6]=a*r+c*i,t[7]=h*r+A*i,t[8]=l*r-o*i,t[9]=u*r-s*i,t[10]=c*r-a*i,t[11]=A*r-h*i,t}function Wp(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],s=e[1],a=e[2],h=e[3],l=e[8],u=e[9],c=e[10],A=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-l*i,t[1]=s*r-u*i,t[2]=a*r-c*i,t[3]=h*r-A*i,t[8]=o*i+l*r,t[9]=s*i+u*r,t[10]=a*i+c*r,t[11]=h*i+A*r,t}function qp(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],s=e[1],a=e[2],h=e[3],l=e[4],u=e[5],c=e[6],A=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+l*i,t[1]=s*r+u*i,t[2]=a*r+c*i,t[3]=h*r+A*i,t[4]=l*r-o*i,t[5]=u*r-s*i,t[6]=c*r-a*i,t[7]=A*r-h*i,t}function Zp(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Qp(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Xp(t,e,n){var i,r,o,s=n[0],a=n[1],h=n[2],l=Math.hypot(s,a,h);return l<Ap?null:(s*=l=1/l,a*=l,h*=l,i=Math.sin(e),r=Math.cos(e),t[0]=s*s*(o=1-r)+r,t[1]=a*s*o+h*i,t[2]=h*s*o-a*i,t[3]=0,t[4]=s*a*o-h*i,t[5]=a*a*o+r,t[6]=h*a*o+s*i,t[7]=0,t[8]=s*h*o+a*i,t[9]=a*h*o-s*i,t[10]=h*h*o+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Yp(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=i+i,h=r+r,l=o+o,u=i*a,c=i*h,A=i*l,f=r*h,d=r*l,p=o*l,g=s*a,m=s*h,y=s*l;return t[0]=1-(f+p),t[1]=c+y,t[2]=A-m,t[3]=0,t[4]=c-y,t[5]=1-(u+p),t[6]=d+g,t[7]=0,t[8]=A+m,t[9]=d-g,t[10]=1-(u+f),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Jp(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Kp(t,e){var n=e[4],i=e[5],r=e[6],o=e[8],s=e[9],a=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,i,r),t[2]=Math.hypot(o,s,a),t}function $p(t,e){var n=new fp(3);Kp(n,e);var i=1/n[0],r=1/n[1],o=1/n[2],s=e[0]*i,a=e[1]*r,h=e[2]*o,l=e[4]*i,u=e[5]*r,c=e[6]*o,A=e[8]*i,f=e[9]*r,d=e[10]*o,p=s+u+d,g=0;return p>0?(g=2*Math.sqrt(p+1),t[3]=.25*g,t[0]=(c-f)/g,t[1]=(A-h)/g,t[2]=(a-l)/g):s>u&&s>d?(g=2*Math.sqrt(1+s-u-d),t[3]=(c-f)/g,t[0]=.25*g,t[1]=(a+l)/g,t[2]=(A+h)/g):u>d?(g=2*Math.sqrt(1+u-s-d),t[3]=(A-h)/g,t[0]=(a+l)/g,t[1]=.25*g,t[2]=(c+f)/g):(g=2*Math.sqrt(1+d-s-u),t[3]=(a-l)/g,t[0]=(A+h)/g,t[1]=(c+f)/g,t[2]=.25*g),t}function tg(t,e,n,i){var r=e[0],o=e[1],s=e[2],a=e[3],h=r+r,l=o+o,u=s+s,c=r*h,A=r*l,f=r*u,d=o*l,p=o*u,g=s*u,m=a*h,y=a*l,v=a*u,_=i[0],x=i[1],b=i[2];return t[0]=(1-(d+g))*_,t[1]=(A+v)*_,t[2]=(f-y)*_,t[3]=0,t[4]=(A-v)*x,t[5]=(1-(c+g))*x,t[6]=(p+m)*x,t[7]=0,t[8]=(f+y)*b,t[9]=(p-m)*b,t[10]=(1-(c+d))*b,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function eg(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,h=r+r,l=n*s,u=i*s,c=i*a,A=r*s,f=r*a,d=r*h,p=o*s,g=o*a,m=o*h;return t[0]=1-c-d,t[1]=u+m,t[2]=A-g,t[3]=0,t[4]=u-m,t[5]=1-l-d,t[6]=f+p,t[7]=0,t[8]=A+g,t[9]=f-p,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ng(t,e,n,i,r){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=(r+i)*(o=1/(i-r)),t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}var ig=ng;function rg(t,e,n,i,r,o,s){var a=1/(e-n),h=1/(i-r),l=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*h,t[14]=(s+o)*l,t[15]=1,t}var og=rg;function sg(t,e,n,i){var r,o,s,a,h,l,u,c,A,f,d=e[0],p=e[1],g=e[2],m=i[0],y=i[1],v=i[2],_=n[0],x=n[1],b=n[2];return Math.abs(d-_)<Ap&&Math.abs(p-x)<Ap&&Math.abs(g-b)<Ap?Np(t):(u=d-_,c=p-x,A=g-b,r=y*(A*=f=1/Math.hypot(u,c,A))-v*(c*=f),o=v*(u*=f)-m*A,s=m*c-y*u,(f=Math.hypot(r,o,s))?(r*=f=1/f,o*=f,s*=f):(r=0,o=0,s=0),a=c*s-A*o,h=A*r-u*s,l=u*o-c*r,(f=Math.hypot(a,h,l))?(a*=f=1/f,h*=f,l*=f):(a=0,h=0,l=0),t[0]=r,t[1]=a,t[2]=u,t[3]=0,t[4]=o,t[5]=h,t[6]=c,t[7]=0,t[8]=s,t[9]=l,t[10]=A,t[11]=0,t[12]=-(r*d+o*p+s*g),t[13]=-(a*d+h*p+l*g),t[14]=-(u*d+c*p+A*g),t[15]=1,t)}function ag(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function hg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}var lg=Hp,ug=Object.freeze({__proto__:null,add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},adjoint:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],A=e[10],f=e[11],d=e[12],p=e[13],g=e[14],m=e[15];return t[0]=a*(A*m-f*g)-c*(h*m-l*g)+p*(h*f-l*A),t[1]=-(i*(A*m-f*g)-c*(r*m-o*g)+p*(r*f-o*A)),t[2]=i*(h*m-l*g)-a*(r*m-o*g)+p*(r*l-o*h),t[3]=-(i*(h*f-l*A)-a*(r*f-o*A)+c*(r*l-o*h)),t[4]=-(s*(A*m-f*g)-u*(h*m-l*g)+d*(h*f-l*A)),t[5]=n*(A*m-f*g)-u*(r*m-o*g)+d*(r*f-o*A),t[6]=-(n*(h*m-l*g)-s*(r*m-o*g)+d*(r*l-o*h)),t[7]=n*(h*f-l*A)-s*(r*f-o*A)+u*(r*l-o*h),t[8]=s*(c*m-f*p)-u*(a*m-l*p)+d*(a*f-l*c),t[9]=-(n*(c*m-f*p)-u*(i*m-o*p)+d*(i*f-o*c)),t[10]=n*(a*m-l*p)-s*(i*m-o*p)+d*(i*l-o*a),t[11]=-(n*(a*f-l*c)-s*(i*f-o*c)+u*(i*l-o*a)),t[12]=-(s*(c*g-A*p)-u*(a*g-h*p)+d*(a*A-h*c)),t[13]=n*(c*g-A*p)-u*(i*g-r*p)+d*(i*A-r*c),t[14]=-(n*(a*g-h*p)-s*(i*g-r*p)+d*(i*h-r*a)),t[15]=n*(a*A-h*c)-s*(i*A-r*c)+u*(i*h-r*a),t},clone:function(t){var e=new fp(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},copy:Fp,create:Lp,determinant:function(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],h=t[7],l=t[8],u=t[9],c=t[10],A=t[11],f=t[12],d=t[13],p=t[14],g=t[15];return(e*s-n*o)*(c*g-A*p)-(e*a-i*o)*(u*g-A*d)+(e*h-r*o)*(u*p-c*d)+(n*a-i*s)*(l*g-A*f)-(n*h-r*s)*(l*p-c*f)+(i*h-r*a)*(l*d-u*f)},equals:function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],h=t[6],l=t[7],u=t[8],c=t[9],A=t[10],f=t[11],d=t[12],p=t[13],g=t[14],m=t[15],y=e[0],v=e[1],_=e[2],x=e[3],b=e[4],w=e[5],C=e[6],P=e[7],M=e[8],T=e[9],S=e[10],I=e[11],E=e[12],O=e[13],R=e[14],D=e[15];return Math.abs(n-y)<=Ap*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(i-v)<=Ap*Math.max(1,Math.abs(i),Math.abs(v))&&Math.abs(r-_)<=Ap*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(o-x)<=Ap*Math.max(1,Math.abs(o),Math.abs(x))&&Math.abs(s-b)<=Ap*Math.max(1,Math.abs(s),Math.abs(b))&&Math.abs(a-w)<=Ap*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(h-C)<=Ap*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(l-P)<=Ap*Math.max(1,Math.abs(l),Math.abs(P))&&Math.abs(u-M)<=Ap*Math.max(1,Math.abs(u),Math.abs(M))&&Math.abs(c-T)<=Ap*Math.max(1,Math.abs(c),Math.abs(T))&&Math.abs(A-S)<=Ap*Math.max(1,Math.abs(A),Math.abs(S))&&Math.abs(f-I)<=Ap*Math.max(1,Math.abs(f),Math.abs(I))&&Math.abs(d-E)<=Ap*Math.max(1,Math.abs(d),Math.abs(E))&&Math.abs(p-O)<=Ap*Math.max(1,Math.abs(p),Math.abs(O))&&Math.abs(g-R)<=Ap*Math.max(1,Math.abs(g),Math.abs(R))&&Math.abs(m-D)<=Ap*Math.max(1,Math.abs(m),Math.abs(D))},exactEquals:hg,frob:function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},fromQuat:eg,fromQuat2:function(t,e){var n=new fp(3),i=-e[0],r=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=i*i+r*r+o*o+s*s;return c>0?(n[0]=2*(a*s+u*i+h*o-l*r)/c,n[1]=2*(h*s+u*r+l*i-a*o)/c,n[2]=2*(l*s+u*o+a*r-h*i)/c):(n[0]=2*(a*s+u*i+h*o-l*r),n[1]=2*(h*s+u*r+l*i-a*o),n[2]=2*(l*s+u*o+a*r-h*i)),Yp(t,e,n),t},fromRotation:Xp,fromRotationTranslation:Yp,fromRotationTranslationScale:tg,fromRotationTranslationScaleOrigin:function(t,e,n,i,r){var o=e[0],s=e[1],a=e[2],h=e[3],l=o+o,u=s+s,c=a+a,A=o*l,f=o*u,d=o*c,p=s*u,g=s*c,m=a*c,y=h*l,v=h*u,_=h*c,x=i[0],b=i[1],w=i[2],C=r[0],P=r[1],M=r[2],T=(1-(p+m))*x,S=(f+_)*x,I=(d-v)*x,E=(f-_)*b,O=(1-(A+m))*b,R=(g+y)*b,D=(d+v)*w,k=(g-y)*w,L=(1-(A+p))*w;return t[0]=T,t[1]=S,t[2]=I,t[3]=0,t[4]=E,t[5]=O,t[6]=R,t[7]=0,t[8]=D,t[9]=k,t[10]=L,t[11]=0,t[12]=n[0]+C-(T*C+E*P+D*M),t[13]=n[1]+P-(S*C+O*P+k*M),t[14]=n[2]+M-(I*C+R*P+L*M),t[15]=1,t},fromScaling:Qp,fromTranslation:Zp,fromValues:function(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d,p){var g=new fp(16);return g[0]=t,g[1]=e,g[2]=n,g[3]=i,g[4]=r,g[5]=o,g[6]=s,g[7]=a,g[8]=h,g[9]=l,g[10]=u,g[11]=c,g[12]=A,g[13]=f,g[14]=d,g[15]=p,g},fromXRotation:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromYRotation:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},fromZRotation:function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},frustum:function(t,e,n,i,r,o,s){var a=1/(n-e),h=1/(r-i),l=1/(o-s);return t[0]=2*o*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(n+e)*a,t[9]=(r+i)*h,t[10]=(s+o)*l,t[11]=-1,t[12]=0,t[13]=0,t[14]=s*o*2*l,t[15]=0,t},getRotation:$p,getScaling:Kp,getTranslation:Jp,identity:Np,invert:Bp,lookAt:sg,mul:lg,multiply:Hp,multiplyScalar:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},multiplyScalarAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},ortho:og,orthoNO:rg,orthoZO:function(t,e,n,i,r,o,s){var a=1/(e-n),h=1/(i-r),l=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=l,t[11]=0,t[12]=(e+n)*a,t[13]=(r+i)*h,t[14]=o*l,t[15]=1,t},perspective:ig,perspectiveFromFieldOfView:function(t,e,n,i){var r=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),s=Math.tan(e.leftDegrees*Math.PI/180),a=Math.tan(e.rightDegrees*Math.PI/180),h=2/(s+a),l=2/(r+o);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=-(s-a)*h*.5,t[9]=(r-o)*l*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},perspectiveNO:ng,perspectiveZO:function(t,e,n,i,r){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=r&&r!==1/0?(t[10]=r*(o=1/(i-r)),t[14]=r*i*o):(t[10]=-1,t[14]=-i),t},rotate:Gp,rotateX:Vp,rotateY:Wp,rotateZ:qp,scale:Up,set:function(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d,p,g){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=l,t[9]=u,t[10]=c,t[11]=A,t[12]=f,t[13]=d,t[14]=p,t[15]=g,t},str:function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},sub:ag,subtract:ag,targetTo:function(t,e,n,i){var r=e[0],o=e[1],s=e[2],a=i[0],h=i[1],l=i[2],u=r-n[0],c=o-n[1],A=s-n[2],f=u*u+c*c+A*A;f>0&&(u*=f=1/Math.sqrt(f),c*=f,A*=f);var d=h*A-l*c,p=l*u-a*A,g=a*c-h*u;return(f=d*d+p*p+g*g)>0&&(d*=f=1/Math.sqrt(f),p*=f,g*=f),t[0]=d,t[1]=p,t[2]=g,t[3]=0,t[4]=c*g-A*p,t[5]=A*d-u*g,t[6]=u*p-c*d,t[7]=0,t[8]=u,t[9]=c,t[10]=A,t[11]=0,t[12]=r,t[13]=o,t[14]=s,t[15]=1,t},translate:jp,transpose:zp});function cg(){var t=new fp(3);return fp!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ag(t){return Math.hypot(t[0],t[1],t[2])}function fg(t,e,n){var i=new fp(3);return i[0]=t,i[1]=e,i[2]=n,i}function dg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function pg(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function gg(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function mg(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function yg(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function vg(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function _g(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function xg(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t}function bg(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function wg(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}function Cg(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function Pg(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function Mg(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Tg(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2];return t[0]=r*h-o*a,t[1]=o*s-i*h,t[2]=i*a-r*s,t}function Sg(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[3]*i+n[7]*r+n[11]*o+n[15];return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(s=s||1),t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/s,t}function Ig(t,e){var n=t[0],i=t[1],r=t[2],o=e[0],s=e[1],a=e[2],h=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(o*o+s*s+a*a),l=h&&Mg(t,e)/h;return Math.acos(Math.min(Math.max(l,-1),1))}function Eg(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Og(t,e){var n=t[0],i=t[1],r=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(n-o)<=Ap*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-s)<=Ap*Math.max(1,Math.abs(i),Math.abs(s))&&Math.abs(r-a)<=Ap*Math.max(1,Math.abs(r),Math.abs(a))}var Rg,Dg=mg,kg=yg,Lg=vg,Fg=bg,Ng=wg,zg=Ag,Bg=Cg,Hg=(Rg=cg(),function(t,e,n,i,r,o){var s,a;for(e||(e=3),n||(n=0),a=i?Math.min(i*e+n,t.length):t.length,s=n;s<a;s+=e)Rg[0]=t[s],Rg[1]=t[s+1],Rg[2]=t[s+2],r(Rg,Rg,o),t[s]=Rg[0],t[s+1]=Rg[1],t[s+2]=Rg[2];return t}),jg=Object.freeze({__proto__:null,add:gg,angle:Ig,bezier:function(t,e,n,i,r,o){var s=1-o,a=s*s,h=o*o,l=a*s,u=3*o*a,c=3*h*s,A=h*o;return t[0]=e[0]*l+n[0]*u+i[0]*c+r[0]*A,t[1]=e[1]*l+n[1]*u+i[1]*c+r[1]*A,t[2]=e[2]*l+n[2]*u+i[2]*c+r[2]*A,t},ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},clone:function(t){var e=new fp(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},copy:dg,create:cg,cross:Tg,dist:Fg,distance:bg,div:Lg,divide:vg,dot:Mg,equals:Og,exactEquals:Eg,floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},forEach:Hg,fromValues:fg,hermite:function(t,e,n,i,r,o){var s=o*o,a=s*(2*o-3)+1,h=s*(o-2)+o,l=s*(o-1),u=s*(3-2*o);return t[0]=e[0]*a+n[0]*h+i[0]*l+r[0]*u,t[1]=e[1]*a+n[1]*h+i[1]*l+r[1]*u,t[2]=e[2]*a+n[2]*h+i[2]*l+r[2]*u,t},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},len:zg,length:Ag,lerp:function(t,e,n,i){var r=e[0],o=e[1],s=e[2];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=s+i*(n[2]-s),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},mul:kg,multiply:yg,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},normalize:Pg,random:function(t,e){e=e||1;var n=2*dp()*Math.PI,i=2*dp()-1,r=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=i*e,t},rotateX:function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},rotateY:function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},rotateZ:function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},scale:_g,scaleAndAdd:xg,set:pg,sqrDist:Ng,sqrLen:Bg,squaredDistance:wg,squaredLength:Cg,str:function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},sub:Dg,subtract:mg,transformMat3:function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t},transformMat4:Sg,transformQuat:function(t,e,n){var i=n[0],r=n[1],o=n[2],s=e[0],a=e[1],h=e[2],l=r*h-o*a,u=o*s-i*h,c=i*a-r*s,A=r*c-o*u,f=o*l-i*c,d=i*u-r*l,p=2*n[3];return u*=p,c*=p,f*=2,d*=2,t[0]=s+(l*=p)+(A*=2),t[1]=a+u+f,t[2]=h+c+d,t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t}});function Ug(){var t=new fp(4);return fp!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function Gg(t){var e=new fp(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function Vg(t,e,n,i){var r=new fp(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r}function Wg(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function qg(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function Zg(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t}function Qg(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function Xg(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function Yg(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function Jg(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Kg(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function $g(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return n*n+i*i+r*r+o*o}function tm(t){return Math.hypot(t[0],t[1],t[2],t[3])}function em(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}function nm(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=i*s,t[2]=r*s,t[3]=o*s,t}function im(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]}function rm(t,e,n,i){var r=e[0],o=e[1],s=e[2],a=e[3];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=s+i*(n[2]-s),t[3]=a+i*(n[3]-a),t}function om(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,t}function sm(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]}function am(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=e[0],a=e[1],h=e[2],l=e[3];return Math.abs(n-s)<=Ap*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(i-a)<=Ap*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(r-h)<=Ap*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-l)<=Ap*Math.max(1,Math.abs(o),Math.abs(l))}var hm=Qg,lm=Xg,um=Yg,cm=Kg,Am=$g,fm=tm,dm=em,pm=function(){var t=Ug();return function(e,n,i,r,o,s){var a,h;for(n||(n=4),i||(i=0),h=r?Math.min(r*n+i,e.length):e.length,a=i;a<h;a+=n)t[0]=e[a],t[1]=e[a+1],t[2]=e[a+2],t[3]=e[a+3],o(t,t,s),e[a]=t[0],e[a+1]=t[1],e[a+2]=t[2],e[a+3]=t[3];return e}}(),gm=Object.freeze({__proto__:null,add:Zg,ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},clone:Gg,copy:Wg,create:Ug,cross:function(t,e,n,i){var r=n[0]*i[1]-n[1]*i[0],o=n[0]*i[2]-n[2]*i[0],s=n[0]*i[3]-n[3]*i[0],a=n[1]*i[2]-n[2]*i[1],h=n[1]*i[3]-n[3]*i[1],l=n[2]*i[3]-n[3]*i[2],u=e[0],c=e[1],A=e[2],f=e[3];return t[0]=c*l-A*h+f*a,t[1]=-u*l+A*s-f*o,t[2]=u*h-c*s+f*r,t[3]=-u*a+c*o-A*r,t},dist:cm,distance:Kg,div:um,divide:Yg,dot:im,equals:am,exactEquals:sm,floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},forEach:pm,fromValues:Vg,inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},len:fm,length:tm,lerp:rm,max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},mul:lm,multiply:Xg,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},normalize:nm,random:function(t,e){var n,i,r,o,s,a;e=e||1;do{s=(n=2*dp()-1)*n+(i=2*dp()-1)*i}while(s>=1);do{a=(r=2*dp()-1)*r+(o=2*dp()-1)*o}while(a>=1);var h=Math.sqrt((1-s)/a);return t[0]=e*n,t[1]=e*i,t[2]=e*r*h,t[3]=e*o*h,t},round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},scale:Jg,scaleAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},set:qg,sqrDist:Am,sqrLen:dm,squaredDistance:$g,squaredLength:em,str:function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},sub:hm,subtract:Qg,transformMat4:om,transformQuat:function(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2],l=n[3],u=l*i+a*o-h*r,c=l*r+h*i-s*o,A=l*o+s*r-a*i,f=-s*i-a*r-h*o;return t[0]=u*l+f*-s+c*-h-A*-a,t[1]=c*l+f*-a+A*-s-u*-h,t[2]=A*l+f*-h+u*-a-c*-s,t[3]=e[3],t},zero:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t}});function mm(){var t=new fp(4);return fp!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function ym(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function vm(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function _m(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=n[0],h=n[1],l=n[2],u=n[3];return t[0]=i*u+s*a+r*l-o*h,t[1]=r*u+s*h+o*a-i*l,t[2]=o*u+s*l+i*h-r*a,t[3]=s*u-i*a-r*h-o*l,t}function xm(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),h=Math.cos(n);return t[0]=i*h+s*a,t[1]=r*h+o*a,t[2]=o*h-r*a,t[3]=s*h-i*a,t}function bm(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),h=Math.cos(n);return t[0]=i*h-o*a,t[1]=r*h+s*a,t[2]=o*h+i*a,t[3]=s*h-r*a,t}function wm(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],s=e[3],a=Math.sin(n),h=Math.cos(n);return t[0]=i*h+r*a,t[1]=r*h-i*a,t[2]=o*h+s*a,t[3]=s*h-o*a,t}function Cm(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=Math.sqrt(n*n+i*i+r*r),a=Math.exp(o),h=s>0?a*Math.sin(s)/s:0;return t[0]=n*h,t[1]=i*h,t[2]=r*h,t[3]=a*Math.cos(s),t}function Pm(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=Math.sqrt(n*n+i*i+r*r),a=s>0?Math.atan2(s,o)/s:0;return t[0]=n*a,t[1]=i*a,t[2]=r*a,t[3]=.5*Math.log(n*n+i*i+r*r+o*o),t}function Mm(t,e,n,i){var r,o,s,a,h,l=e[0],u=e[1],c=e[2],A=e[3],f=n[0],d=n[1],p=n[2],g=n[3];return(o=l*f+u*d+c*p+A*g)<0&&(o=-o,f=-f,d=-d,p=-p,g=-g),1-o>Ap?(r=Math.acos(o),s=Math.sin(r),a=Math.sin((1-i)*r)/s,h=Math.sin(i*r)/s):(a=1-i,h=i),t[0]=a*l+h*f,t[1]=a*u+h*d,t[2]=a*c+h*p,t[3]=a*A+h*g,t}function Tm(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*s+s]+1),t[r]=.5*n,t[3]=(e[3*o+s]-e[3*s+o])*(n=.5/n),t[o]=(e[3*o+r]+e[3*r+o])*n,t[s]=(e[3*s+r]+e[3*r+s])*n}return t}function Sm(t,e,n,i){var r=.5*Math.PI/180;e*=r,n*=r,i*=r;var o=Math.sin(e),s=Math.cos(e),a=Math.sin(n),h=Math.cos(n),l=Math.sin(i),u=Math.cos(i);return t[0]=o*h*u-s*a*l,t[1]=s*a*u+o*h*l,t[2]=s*h*l-o*a*u,t[3]=s*h*u+o*a*l,t}var Im,Em,Om,Rm,Dm,km,Lm=Gg,Fm=Vg,Nm=Wg,zm=qg,Bm=Zg,Hm=_m,jm=Jg,Um=im,Gm=rm,Vm=tm,Wm=Vm,qm=em,Zm=qm,Qm=nm,Xm=sm,Ym=am,Jm=(Im=cg(),Em=fg(1,0,0),Om=fg(0,1,0),function(t,e,n){var i=Mg(e,n);return i<-.999999?(Tg(Im,Em,e),zg(Im)<1e-6&&Tg(Im,Om,e),Pg(Im,Im),vm(t,Im,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Tg(Im,e,n),t[0]=Im[0],t[1]=Im[1],t[2]=Im[2],t[3]=1+i,Qm(t,t))}),Km=(Rm=mm(),Dm=mm(),function(t,e,n,i,r,o){return Mm(Rm,e,r,o),Mm(Dm,n,i,o),Mm(t,Rm,Dm,2*o*(1-o)),t}),$m=(km=Pp(),function(t,e,n,i){return km[0]=n[0],km[3]=n[1],km[6]=n[2],km[1]=i[0],km[4]=i[1],km[7]=i[2],km[2]=-e[0],km[5]=-e[1],km[8]=-e[2],Qm(t,Tm(t,km))}),ty=Object.freeze({__proto__:null,add:Bm,calculateW:function(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t},clone:Lm,conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},copy:Nm,create:mm,dot:Um,equals:Ym,exactEquals:Xm,exp:Cm,fromEuler:Sm,fromMat3:Tm,fromValues:Fm,getAngle:function(t,e){var n=Um(t,e);return Math.acos(2*n*n-1)},getAxisAngle:function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>Ap?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},identity:ym,invert:function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o,a=s?1/s:0;return t[0]=-n*a,t[1]=-i*a,t[2]=-r*a,t[3]=o*a,t},len:Wm,length:Vm,lerp:Gm,ln:Pm,mul:Hm,multiply:_m,normalize:Qm,pow:function(t,e,n){return Pm(t,e),jm(t,t,n),Cm(t,t),t},random:function(t){var e=dp(),n=dp(),i=dp(),r=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=r*Math.sin(2*Math.PI*n),t[1]=r*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t},rotateX:xm,rotateY:bm,rotateZ:wm,rotationTo:Jm,scale:jm,set:zm,setAxes:$m,setAxisAngle:vm,slerp:Mm,sqlerp:Km,sqrLen:Zm,squaredLength:qm,str:function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"}});function ey(t,e,n){var i=.5*n[0],r=.5*n[1],o=.5*n[2],s=e[0],a=e[1],h=e[2],l=e[3];return t[0]=s,t[1]=a,t[2]=h,t[3]=l,t[4]=i*l+r*h-o*a,t[5]=r*l+o*s-i*h,t[6]=o*l+i*a-r*s,t[7]=-i*s-r*a-o*h,t}function ny(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function iy(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=n[4],h=n[5],l=n[6],u=n[7],c=e[4],A=e[5],f=e[6],d=e[7],p=n[0],g=n[1],m=n[2],y=n[3];return t[0]=i*y+s*p+r*m-o*g,t[1]=r*y+s*g+o*p-i*m,t[2]=o*y+s*m+i*g-r*p,t[3]=s*y-i*p-r*g-o*m,t[4]=i*u+s*a+r*l-o*h+c*y+d*p+A*m-f*g,t[5]=r*u+s*h+o*a-i*l+A*y+d*g+f*p-c*m,t[6]=o*u+s*l+i*h-r*a+f*y+d*m+c*g-A*p,t[7]=s*u-i*a-r*h-o*l+d*y-c*p-A*g-f*m,t}var ry=Um,oy=qm,sy=Object.freeze({__proto__:null,add:function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},clone:function(t){var e=new fp(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},conjugate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},copy:ny,create:function(){var t=new fp(8);return fp!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},dot:ry,equals:function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],s=t[4],a=t[5],h=t[6],l=t[7],u=e[0],c=e[1],A=e[2],f=e[3],d=e[4],p=e[5],g=e[6],m=e[7];return Math.abs(n-u)<=Ap*Math.max(1,Math.abs(n),Math.abs(u))&&Math.abs(i-c)<=Ap*Math.max(1,Math.abs(i),Math.abs(c))&&Math.abs(r-A)<=Ap*Math.max(1,Math.abs(r),Math.abs(A))&&Math.abs(o-f)<=Ap*Math.max(1,Math.abs(o),Math.abs(f))&&Math.abs(s-d)<=Ap*Math.max(1,Math.abs(s),Math.abs(d))&&Math.abs(a-p)<=Ap*Math.max(1,Math.abs(a),Math.abs(p))&&Math.abs(h-g)<=Ap*Math.max(1,Math.abs(h),Math.abs(g))&&Math.abs(l-m)<=Ap*Math.max(1,Math.abs(l),Math.abs(m))},exactEquals:function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},fromMat4:function(t,e){var n=mm();$p(n,e);var i=new fp(3);return Jp(i,e),ey(t,n,i),t},fromRotation:function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},fromRotationTranslation:ey,fromRotationTranslationValues:function(t,e,n,i,r,o,s){var a=new fp(8);a[0]=t,a[1]=e,a[2]=n,a[3]=i;var h=.5*r,l=.5*o,u=.5*s;return a[4]=h*i+l*n-u*e,a[5]=l*i+u*t-h*n,a[6]=u*i+h*e-l*t,a[7]=-h*t-l*e-u*n,a},fromTranslation:function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},fromValues:function(t,e,n,i,r,o,s,a){var h=new fp(8);return h[0]=t,h[1]=e,h[2]=n,h[3]=i,h[4]=r,h[5]=o,h[6]=s,h[7]=a,h},getDual:function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},getReal:Nm,getTranslation:function(t,e){var n=e[4],i=e[5],r=e[6],o=e[7],s=-e[0],a=-e[1],h=-e[2],l=e[3];return t[0]=2*(n*l+o*s+i*h-r*a),t[1]=2*(i*l+o*a+r*s-n*h),t[2]=2*(r*l+o*h+n*a-i*s),t},identity:function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},invert:function(t,e){var n=oy(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},len:Vm,length:Vm,lerp:function(t,e,n,i){var r=1-i;return ry(e,n)<0&&(i=-i),t[0]=e[0]*r+n[0]*i,t[1]=e[1]*r+n[1]*i,t[2]=e[2]*r+n[2]*i,t[3]=e[3]*r+n[3]*i,t[4]=e[4]*r+n[4]*i,t[5]=e[5]*r+n[5]*i,t[6]=e[6]*r+n[6]*i,t[7]=e[7]*r+n[7]*i,t},mul:iy,multiply:iy,normalize:function(t,e){var n=oy(e);if(n>0){n=Math.sqrt(n);var i=e[0]/n,r=e[1]/n,o=e[2]/n,s=e[3]/n,a=e[4],h=e[5],l=e[6],u=e[7],c=i*a+r*h+o*l+s*u;t[0]=i,t[1]=r,t[2]=o,t[3]=s,t[4]=(a-i*c)/n,t[5]=(h-r*c)/n,t[6]=(l-o*c)/n,t[7]=(u-s*c)/n}return t},rotateAroundAxis:function(t,e,n,i){if(Math.abs(i)<Ap)return ny(t,e);var r=Math.hypot(n[0],n[1],n[2]);i*=.5;var o=Math.sin(i),s=o*n[0]/r,a=o*n[1]/r,h=o*n[2]/r,l=Math.cos(i),u=e[0],c=e[1],A=e[2],f=e[3];t[0]=u*l+f*s+c*h-A*a,t[1]=c*l+f*a+A*s-u*h,t[2]=A*l+f*h+u*a-c*s,t[3]=f*l-u*s-c*a-A*h;var d=e[4],p=e[5],g=e[6],m=e[7];return t[4]=d*l+m*s+p*h-g*a,t[5]=p*l+m*a+g*s-d*h,t[6]=g*l+m*h+d*a-p*s,t[7]=m*l-d*s-p*a-g*h,t},rotateByQuatAppend:function(t,e,n){var i=n[0],r=n[1],o=n[2],s=n[3],a=e[0],h=e[1],l=e[2],u=e[3];return t[0]=a*s+u*i+h*o-l*r,t[1]=h*s+u*r+l*i-a*o,t[2]=l*s+u*o+a*r-h*i,t[3]=u*s-a*i-h*r-l*o,t[4]=(a=e[4])*s+(u=e[7])*i+(h=e[5])*o-(l=e[6])*r,t[5]=h*s+u*r+l*i-a*o,t[6]=l*s+u*o+a*r-h*i,t[7]=u*s-a*i-h*r-l*o,t},rotateByQuatPrepend:function(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=n[0],h=n[1],l=n[2],u=n[3];return t[0]=i*u+s*a+r*l-o*h,t[1]=r*u+s*h+o*a-i*l,t[2]=o*u+s*l+i*h-r*a,t[3]=s*u-i*a-r*h-o*l,t[4]=i*(u=n[7])+s*(a=n[4])+r*(l=n[6])-o*(h=n[5]),t[5]=r*u+s*h+o*a-i*l,t[6]=o*u+s*l+i*h-r*a,t[7]=s*u-i*a-r*h-o*l,t},rotateX:function(t,e,n){var i=-e[0],r=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=a*s+u*i+h*o-l*r,A=h*s+u*r+l*i-a*o,f=l*s+u*o+a*r-h*i,d=u*s-a*i-h*r-l*o;return xm(t,e,n),t[4]=c*(s=t[3])+d*(i=t[0])+A*(o=t[2])-f*(r=t[1]),t[5]=A*s+d*r+f*i-c*o,t[6]=f*s+d*o+c*r-A*i,t[7]=d*s-c*i-A*r-f*o,t},rotateY:function(t,e,n){var i=-e[0],r=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=a*s+u*i+h*o-l*r,A=h*s+u*r+l*i-a*o,f=l*s+u*o+a*r-h*i,d=u*s-a*i-h*r-l*o;return bm(t,e,n),t[4]=c*(s=t[3])+d*(i=t[0])+A*(o=t[2])-f*(r=t[1]),t[5]=A*s+d*r+f*i-c*o,t[6]=f*s+d*o+c*r-A*i,t[7]=d*s-c*i-A*r-f*o,t},rotateZ:function(t,e,n){var i=-e[0],r=-e[1],o=-e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=a*s+u*i+h*o-l*r,A=h*s+u*r+l*i-a*o,f=l*s+u*o+a*r-h*i,d=u*s-a*i-h*r-l*o;return wm(t,e,n),t[4]=c*(s=t[3])+d*(i=t[0])+A*(o=t[2])-f*(r=t[1]),t[5]=A*s+d*r+f*i-c*o,t[6]=f*s+d*o+c*r-A*i,t[7]=d*s-c*i-A*r-f*o,t},scale:function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},set:function(t,e,n,i,r,o,s,a,h){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t},setDual:function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},setReal:Nm,sqrLen:oy,squaredLength:oy,str:function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},translate:function(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=.5*n[0],h=.5*n[1],l=.5*n[2],u=e[4],c=e[5],A=e[6],f=e[7];return t[0]=i,t[1]=r,t[2]=o,t[3]=s,t[4]=s*a+r*l-o*h+u,t[5]=s*h+o*a-i*l+c,t[6]=s*l+i*h-r*a+A,t[7]=-i*a-r*h-o*l+f,t}});function ay(){var t=new fp(2);return fp!=Float32Array&&(t[0]=0,t[1]=0),t}function hy(t,e){return t[0]=e[0],t[1]=e[1],t}function ly(t,e,n){return t[0]=e,t[1]=n,t}function uy(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function cy(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function Ay(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function fy(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function dy(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function py(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function gy(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function my(t){return Math.hypot(t[0],t[1])}function yy(t){var e=t[0],n=t[1];return e*e+n*n}function vy(t,e){return t[0]*e[0]+t[1]*e[1]}function _y(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t}function xy(t,e,n,i){var r=e[0]-n[0],o=e[1]-n[1],s=Math.sin(i),a=Math.cos(i);return t[0]=r*a-o*s+n[0],t[1]=r*s+o*a+n[1],t}function by(t,e){return t[0]===e[0]&&t[1]===e[1]}var wy=my,Cy=cy,Py=Ay,My=fy,Ty=py,Sy=gy,Iy=yy,Ey=function(){var t=ay();return function(e,n,i,r,o,s){var a,h;for(n||(n=2),i||(i=0),h=r?Math.min(r*n+i,e.length):e.length,a=i;a<h;a+=n)t[0]=e[a],t[1]=e[a+1],o(t,t,s),e[a]=t[0],e[a+1]=t[1];return e}}(),Oy=Object.freeze({__proto__:null,add:uy,angle:function(t,e){var n=t[0],i=t[1],r=e[0],o=e[1],s=Math.sqrt(n*n+i*i)*Math.sqrt(r*r+o*o);return Math.acos(Math.min(Math.max(s&&(n*r+i*o)/s,-1),1))},ceil:function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},clone:function(t){var e=new fp(2);return e[0]=t[0],e[1]=t[1],e},copy:hy,create:ay,cross:function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},dist:Ty,distance:py,div:My,divide:fy,dot:vy,equals:function(t,e){var n=t[0],i=t[1],r=e[0],o=e[1];return Math.abs(n-r)<=Ap*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-o)<=Ap*Math.max(1,Math.abs(i),Math.abs(o))},exactEquals:by,floor:function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},forEach:Ey,fromValues:function(t,e){var n=new fp(2);return n[0]=t,n[1]=e,n},inverse:function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},len:wy,length:my,lerp:function(t,e,n,i){var r=e[0],o=e[1];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t},max:function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},min:function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},mul:Py,multiply:Ay,negate:function(t,e){return t[0]=-e[0],t[1]=-e[1],t},normalize:function(t,e){var n=e[0],i=e[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t},random:function(t,e){e=e||1;var n=2*dp()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},rotate:xy,round:function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},scale:dy,scaleAndAdd:function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},set:ly,sqrDist:Sy,sqrLen:Iy,squaredDistance:gy,squaredLength:yy,str:function(t){return"vec2("+t[0]+", "+t[1]+")"},sub:Cy,subtract:cy,transformMat2:_y,transformMat2d:function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t},transformMat3:function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t},transformMat4:function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t},zero:function(t){return t[0]=0,t[1]=0,t}}),Ry="undefined"!=typeof Float32Array?Float32Array:Array;function Dy(){var t=new Ry(3);return Ry!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function ky(t,e,n){var i=new Ry(3);return i[0]=t,i[1]=e,i[2]=n,i}function Ly(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function Fy(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function Ny(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function zy(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function By(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Hy(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2];return t[0]=r*h-o*a,t[1]=o*s-i*h,t[2]=i*a-r*s,t}var jy=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t};function Uy(){var t=new Ry(4);return Ry!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Gy(t,e){var n=e[0]+e[4]+e[8],i=void 0;if(n>0)i=Math.sqrt(n+1),t[3]=.5*i,t[0]=(e[5]-e[7])*(i=.5/i),t[1]=(e[6]-e[2])*i,t[2]=(e[1]-e[3])*i;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,s=(r+2)%3;i=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*s+s]+1),t[r]=.5*i,t[3]=(e[3*o+s]-e[3*s+o])*(i=.5/i),t[o]=(e[3*o+r]+e[3*r+o])*i,t[s]=(e[3*s+r]+e[3*r+s])*i}return t}Dy(),function(){var t;t=new Ry(4),Ry!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var Vy=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Wy=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n*n+i*i+r*r+o*o;return s>0&&(s=1/Math.sqrt(s),t[0]=n*s,t[1]=i*s,t[2]=r*s,t[3]=o*s),t};Dy(),ky(1,0,0),ky(0,1,0),Uy(),Uy(),function(){var t;t=new Ry(9),Ry!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1}();const qy=8,Zy=[],Qy=[],Xy=[],Yy=[];function Jy(t,e,n){const i=Hy(Qy,e,n);var r;t=Gy(t,function(t,e,n,i,r,o,s,a,h,l){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=s,t[6]=a,t[7]=h,t[8]=l,t}(Zy,n[0],n[1],n[2],...i,...e)),r=t=Wy(t,t),t=r[3]<0?Vy(r,r,-1):r;const o=1/((1<<2*qy-1)-1);if(t[3]<o){t[3]=o;const e=Math.sqrt(1-o*o);t[0]*=e,t[1]*=e,t[2]*=e}const s=n[3]>0?Hy(Xy,n,e):Hy(Xy,e,n);return By(Hy(Yy,n,e),s)<0&&Vy(t,t,-1),t}const Ky=[];function $y(t,e,n){const i=n||[];i.setLength&&i.setLength(t.length);const r=Ky;r.length<t.length/3&&(r.length=t.length/3),r.fill(0,0,t.length/3);const o=void 0===e.length?e:e.length;for(let a=0;a<o/3;a++)void 0===e.length?av(t,3*a,3*a+1,3*a+2,i,r):av(t,e[3*a],e[3*a+1],e[3*a+2],i,r);const s=i.getLength?i.getLength():i.length;for(let a=0;a<s;a+=3){const t=r[a/3];0!==t?(i[a]/=t,i[a+1]/=t,i[a+2]/=t):(i[a]=0,i[a+1]=0,i[a+2]=0)}return i}const tv=[],ev=[],nv=[],iv=[],rv=[],ov=[],sv=[];function av(t,e,n,i,r,o){Fy(iv,t[3*e],t[3*e+1],t[3*e+2]),Fy(rv,t[3*n],t[3*n+1],t[3*n+2]),Fy(ov,t[3*i],t[3*i+1],t[3*i+2]);const s=jy(tv,ov,rv),a=jy(ev,iv,rv),h=Hy(nv,s,a);zy(sv,h),r[3*e]=r[3*e]||0,r[3*n]=r[3*n]||0,r[3*i]=r[3*i]||0,r[3*e+1]=r[3*e+1]||0,r[3*n+1]=r[3*n+1]||0,r[3*i+1]=r[3*i+1]||0,r[3*e+2]=r[3*e+2]||0,r[3*n+2]=r[3*n+2]||0,r[3*i+2]=r[3*i+2]||0,r[3*e]+=sv[0],r[3*n]+=sv[0],r[3*i]+=sv[0],r[3*e+1]+=sv[1],r[3*n+1]+=sv[1],r[3*i+1]+=sv[1],r[3*e+2]+=sv[2],r[3*n+2]+=sv[2],r[3*i+2]+=sv[2],o[e]+=1,o[n]+=1,o[i]+=1}function hv(t,e,n,i,r){const o=(t.getLength?t.getLength():t.length)/3,s=r||new Array(4*o),a=[],h=[];for(let M=0;M<o;M++)a[M]=[0,0,0],h[M]=[0,0,0];const l=[0,0,0],u=[0,0,0],c=[0,0,0],A=[0,0],f=[0,0],d=[0,0],p=[0,0,0],g=[0,0,0];function m(e,i,r){lv(l,t,3*e),lv(u,t,3*i),lv(c,t,3*r),uv(A,n,2*e),uv(f,n,2*i),uv(d,n,2*r);const o=u[0]-l[0],s=c[0]-l[0],m=u[1]-l[1],y=c[1]-l[1],v=u[2]-l[2],_=c[2]-l[2],x=f[0]-A[0],b=d[0]-A[0],w=f[1]-A[1],C=d[1]-A[1],P=1/(x*C-b*w);Fy(p,(C*o-w*s)*P,(C*m-w*y)*P,(C*v-w*_)*P),Fy(g,(x*s-b*o)*P,(x*y-b*m)*P,(x*_-b*v)*P),Ny(a[e],a[e],p),Ny(a[i],a[i],p),Ny(a[r],a[r],p),Ny(h[e],h[e],g),Ny(h[i],h[i],g),Ny(h[r],h[r],g)}for(let M=0,T=i.length;M<T;M+=3)m(i[M+0],i[M+1],i[M+2]);const y=[],v=[],_=[],x=[];let b,w,C;function P(t){var n,i,r;lv(_,e,3*t),Ly(x,_),w=a[t],Ly(y,w),jy(y,y,(n=_,i=_,r=By(_,w),n[0]=i[0]*r,n[1]=i[1]*r,n[2]=i[2]*r,n)),zy(y,y),Hy(v,x,w),C=By(v,h[t]),b=C<0?-1:1,s[4*t]=y[0],s[4*t+1]=y[1],s[4*t+2]=y[2],s[4*t+3]=b}for(let M=0,T=i.length;M<T;M+=3)P(i[M+0]),P(i[M+1]),P(i[M+2]);return s}function lv(t,e,n){return t[0]=e[n],t[1]=e[n+1],t[2]=e[n+2],t}function uv(t,e,n){return t[0]=e[n],t[1]=e[n+1],t}function cv(t){return!Av(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function Av(t){return null==t}function fv(t){return!Av(t)}function dv(t){return!Av(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function pv(t,...e){return Object.assign(t,...e),t}function gv(t,...e){for(let n=0;n<e.length;n++){const i=e[n];for(const e in i)null!=i[e]&&(t[e]=i[e])}return t}function mv(t){return"number"==typeof t&&!isNaN(t)}function yv(t,e,n){return t*(1-n)+e*n}function vv(t){return Array.isArray(t)||t instanceof Uint8Array||t instanceof Int8Array||t instanceof Uint16Array||t instanceof Int16Array||t instanceof Uint32Array||t instanceof Int32Array||t instanceof Uint8ClampedArray||t instanceof Float32Array||t instanceof Float64Array}function _v(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:Float32Array}function xv(t,e,n){return Math.min(n,Math.max(e,t))}function bv(t){return t&&t.hasExtension("oes_vertex_array_object")}function wv(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Cv(t){if(t.data){if(t.data.BYTES_PER_ELEMENT)return t.data.length*t.data.BYTES_PER_ELEMENT;if(t.data.length)return 4*t.data.length}else{if(t.BYTES_PER_ELEMENT)return t.length*t.BYTES_PER_ELEMENT;if(t.length)return 4*t.length;if(t.buffer&&t.buffer.destroy)return t.buffer._buffer.byteLength}return 0}function Pv(t){return t.width*t.height*Tv(t.format)*Mv(t.type)*("textureCube"===t._reglType?6:1)}function Mv(t){return"uint8"===t?1:"uint16"===t||"float16"===t||"half float"===t?2:"uint32"===t||"float"===t||"float32"===t?4:0}function Tv(t){return"depth"===t||"alpha"===t||"luminance"===t?1:"luminance alpha"===t||"depth stencil"===t?2:"srgba"===t||"rgb5 a1"===t||"rgba"===t.substring(0,4)?4:"srgb"===t||"rgb"===t.substring(0,3)?3:1}function Sv(t){if(!t.componentType)return!1;const e=tp.getTypedArrayCtor(t.componentType);return t.byteStride>0&&t.byteStride!==t.itemSize*e.BYTES_PER_ELEMENT}function Iv(t){return t&&(t.stride>0||Sv(t))}function Ev(t){let e=0;const n=t&&t.length||0;if(!n)return e;let i;for(let r=0;r<n;r++)i=t.charCodeAt(r),e=(e<<5)-e+i,e|=0;return e}function Ov(t){return!(t&t-1)&&0!==t}function Rv(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Dv(t,e,n){if(vv(t))return Ov(e)&&Ov(n)?t:function(t,e,n){let i=e,r=n;Ov(e)||(i=Rv(e)),Ov(n)||(r=Rv(n));const o=new ImageData(new Uint8ClampedArray(t),e,n),s=document.createElement("canvas");s.width=e,s.height=n,s.getContext("2d").putImageData(o,0,0);const a=document.createElement("canvas");a.width=i,a.height=r,a.getContext("2d").drawImage(s,0,0,e,n,0,0,r,r),console.warn(`Texture's size is not power of two, resize from (${e}, ${n}) to (${i}, ${r})`);let h=document.getElementById("_debug_resize_canvas");return h||(h=document.createElement("canvas"),h.id="_debug_resize_canvas",document.body.appendChild(h)),h.width=i,h.height=r,h.getContext("2d").drawImage(a,0,0),a}(t,e,n);if(Ov(t.width)&&Ov(t.height))return t;n=t.height,Ov(e=t.width)||(e=Rv(e)),Ov(n)||(n=Rv(n));const i=document.createElement("canvas");i.width=e,i.height=n,i.getContext("2d").drawImage(t,0,0,e,n);const r=t.src,o=r.lastIndexOf("/")+1,s=r.substring(o);return console.warn(`Texture(${s})'s size is not power of two, resize from (${t.width}, ${t.height}) to (${e}, ${n})`),i}function kv(t){return t._gl instanceof WebGL2RenderingContext}var Lv=Object.freeze({__proto__:null,clamp:xv,defined:fv,extend:pv,extendWithoutNil:gv,getBufferSize:Cv,getPosArrayType:_v,getSupportedFormats:function(t){return{etc:!!t.getExtension("WEBGL_compressed_texture_etc"),etc1:!!t.getExtension("WEBGL_compressed_texture_etc1"),s3tc:!!t.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:!!t.getExtension("WEBGL_compressed_texture_pvrtc"),astc:!!t.getExtension("WEBGL_compressed_texture_astc"),bc7:!!t.getExtension("EXT_texture_compression_bptc")}},getTexMemorySize:Pv,getTextureByteWidth:Mv,getTextureChannels:Tv,hasOwn:wv,hashCode:Ev,interpolate:yv,isArray:vv,isFunction:dv,isInStride:Sv,isInterleaved:Iv,isNil:Av,isNumber:mv,isPowerOfTwo:Ov,isString:cv,isSupportVAO:bv,lerp:function(t,e,n,i){for(let r=0;r<t.length;r++)t[r]=e[r]+i*(n[r]-e[r]);return t},log2:function(t){return Math.log2(t)},normalize:function(t,e){let n=0;for(let i=0,r=e.length;i<r;i++)n+=e[i];for(let i=0,r=e.length;i<r;i++)t[i]=e[i]/n;return t},resizeToPowerOfTwo:Dv,set:function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t},supportNPOT:kv});function Fv(t){return class extends t{on(t,e){return this._events||(this._events={type:[e]}),this._events[t]=this._events[t]||[],this._events[t].push(e),this}once(t,e){return this.on(t,this._wrapOnce(t,e))}off(t,e){return this._events&&this._events[t]?(this._events[t].splice(this._events[t].indexOf(e),1),this):this}fire(t,e={}){if(!this._events||!this._events[t])return this;e.target||(e.target=this);const n=this._events[t].slice(0);for(const i of n)i(e);return this}_wrapOnce(t,e){const n=this;let i=!1;return function r(o){i||(i=!0,e(o),n.off(t,r))}}}}const Nv="__reshader_disposed";var zv=Object.freeze({__proto__:null,KEY_DISPOSED:Nv,WEBGL_EXTENSIONS:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],WEBGL_OPTIONAL_EXTENSIONS:["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_texture_filter_anisotropic"]});const Bv="_reshader_refCount";let Hv=class{},jv=class extends(Fv(Hv)){constructor(t,e){if(super(),dv(t)){this._texture=t,t=this.config={};for(const e in this._texture)wv(this._texture,e)&&(dv(this._texture[e])||(t[e]=this._texture[e]))}else if(this.config=t||{},this.resLoader=e,(t.url||t.promise)&&!t.data){this._loading=!0;const n=this;let i;if(t.promise)i=t.promise;else{let n;n=t.arrayBuffer?e.getArrayBuffer:e.get,i=n.call(e,t.url)}t.data=e.getDefaultTexture(t.url),this.promise=i,i.then((t=>(delete this.promise,n._loading=!1,n.config?(n.onLoad(t),Array.isArray(t)||(t=[t]),n.fire("complete",{target:this,resources:t}),t):t))).catch((t=>{console.error("error when loading texture image.",t),n.fire("error",{target:this,error:t})}))}}onLoad(t){}isReady(){return!this._loading}set(t,e){return this.config[t]=e,this.dirty=!0,this}get(t){return this.config[t]}createREGLTexture(t){return null}getREGLTexture(t){return this._texture||(this._texture=this.createREGLTexture(t),this.config.persistent||(this.config.data&&(this.config.data instanceof ImageBitmap||(this.config.data=[])),this.config.image&&(this.config.image.array=[]),this.config.mipmap&&delete this.config.mipmap)),this.dirty&&this._updateREGL(),this._texture}getMemorySize(){if(!this.config)return 0;const{width:t,height:e,type:n,format:i}=this.config;return t*e*Mv(n||"uint8")*Tv(i||"rgba")}_updateREGL(){this._texture&&!this._texture[Nv]&&this._texture(this.config),this.dirty=!1}dispose(){this.config&&this.config.url&&(URL.revokeObjectURL(this.config.url),this.resLoader.disposeRes(this.config.url)),this.config&&this.config.data instanceof ImageBitmap&&(this.config.data.close(),this.config.data=[]),this._texture&&!this._texture[Nv]&&(this._texture[Bv]&&this._texture[Bv]--,this._texture[Bv]||(this._texture.destroy(),this._texture[Nv]=!0,delete this._texture)),delete this.resLoader,delete this._regl;const t=this.config&&this.config.url;delete this.config,t&&this.fire("disposed",{target:this,url:t})}_needPowerOf2(t){if(kv(t))return!1;const e=this.config;return e.wrap&&"clamp"!==e.wrap||e.wrapS&&"clamp"!==e.wrapS||e.wrapT&&"clamp"!==e.wrapT||e.min&&"nearest"!==e.min&&"linear"!==e.min}};const Uv=Np([]),Gv=Np([]);let Vv=class t{constructor(t,e){this.min=t||[1/0,1/0,1/0],this.max=e||[-1/0,-1/0,-1/0],this.updateVertex()}static copy(t,e){dg(t.min,e.min),dg(t.max,e.max);for(let n=0;n<e.vertex.length;n++)dg(t.vertex[n],e.vertex[n]);return t}combine(t){if(!t)return this;let e,n;return Array.isArray(t)?(e=t[0],n=t[1]):(e=t.min,n=t.max),e[0]<this.min[0]&&(this.min[0]=e[0],this._dirty=!0),e[1]<this.min[1]&&(this.min[1]=e[1],this._dirty=!0),e[2]<this.min[2]&&(this.min[2]=e[2],this._dirty=!0),n[0]>this.max[0]&&(this.max[0]=n[0],this._dirty=!0),n[1]>this.max[1]&&(this.max[1]=n[1],this._dirty=!0),n[2]>this.max[2]&&(this.max[2]=n[2],this._dirty=!0),this}dirty(){return this._dirty=!0,this}getCenter(){return this.center||(this.center=[0,0,0],this._dirty=!0),this._dirty&&(gg(this.center,this.min,this.max),_g(this.center,this.center,.5)),this._dirty=!1,this.center}containPoint(t){const e=this.min,n=this.max;return e[0]<=t[0]&&e[1]<=t[1]&&e[2]<=t[2]&&n[0]>=t[0]&&n[1]>=t[1]&&n[2]>=t[2]}isFinite(){const t=this.min,e=this.max;return isFinite(t[0])&&isFinite(t[1])&&isFinite(t[2])&&isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])}updateVertex(){if(!this.vertex){this.vertex=[];for(let t=0;t<8;t++)this.vertex.push([0,0,0])}return this.vertex[0][0]=this.min[0],this.vertex[0][1]=this.min[1],this.vertex[0][2]=this.min[2],this.vertex[1][0]=this.min[0],this.vertex[1][1]=this.min[1],this.vertex[1][2]=this.max[2],this.vertex[2][0]=this.min[0],this.vertex[2][1]=this.max[1],this.vertex[2][2]=this.max[2],this.vertex[3][0]=this.min[0],this.vertex[3][1]=this.max[1],this.vertex[3][2]=this.min[2],this.vertex[4][0]=this.max[0],this.vertex[4][1]=this.min[1],this.vertex[4][2]=this.min[2],this.vertex[5][0]=this.max[0],this.vertex[5][1]=this.min[1],this.vertex[5][2]=this.max[2],this.vertex[6][0]=this.max[0],this.vertex[6][1]=this.max[1],this.vertex[6][2]=this.max[2],this.vertex[7][0]=this.max[0],this.vertex[7][1]=this.max[1],this.vertex[7][2]=this.min[2],this.vertex}copy(e){return e?t.copy(e,this):new t(this.min.slice(),this.max.slice())}equals(t){if(!Og(this.min,t.min)||!Og(this.max,t.max))return!1;const e=t.vertex;for(let n=0;n<this.vertex.length;n++)if(!Og(e[n],this.vertex[n]))return!1;return!0}transform(t,e){if(t=t||Gv,(e=e||Gv)[1]||e[2]||e[4]||e[6]||e[8]||e[9]){const n=this.vertex,i=Hp(Uv,e,t);for(let t=0;t<n.length;t++)Sg(this.vertex[t],this.vertex[t],i);const r=this.vertex.map((t=>t[0])),o=this.vertex.map((t=>t[1])),s=this.vertex.map((t=>t[2])),a=Math.min(...r),h=Math.max(...r),l=Math.min(...o),u=Math.max(...o),c=Math.min(...s),A=Math.max(...s);pg(this.min,a,l,c),pg(this.max,h,u,A)}else{const n=Hp(Uv,e,t);Sg(this.min,this.min,n),Sg(this.max,this.max,n)}return this}};const Wv=[],qv={5120:"int8",5122:"int16",5124:"int32",5121:"uint8",5123:"uint16",5125:"uint32",5126:"float"},Zv={5120:1,5122:2,5124:4,5121:1,5123:2,5125:4,5126:4},Qv={positionSize:3,primitive:"triangles",positionAttribute:"aPosition",normalAttribute:"aNormal",uv0Attribute:"aTexCoord",uv1Attribute:"aTexCoord1",color0Attribute:"aColor0",tangentAttribute:"aTangent",pickingIdAttribute:"aPickingId",textureCoordMatrixAttribute:"aTextureCoordMatrix"};let Xv=1;const Yv="_reshader_refCount";let Jv=class{constructor(t,e,n,i){this._version=0,this.data=t,this.elements=e,this.desc=pv({},Qv,i);const r=this._getPosAttritute();this.data[this.desc.positionAttribute]=r,n||(this.elements?n=Kv(this.elements):r&&r.length?n=r.length/this.desc.positionSize:r&&r.interleavedArray?n=r.interleavedArray.length/this.desc.positionSize:r&&r.array&&(n=r.array.length/this.desc.positionSize)),this.count=n,this.elements||(this.elements=n),this.properties={},this._buffers={},this._vao={},this.getVertexCount(),this._prepareData(!0),this.updateBoundingBox()}set version(t){throw new Error("Geometry.version is read only.")}get version(){return this._version}_getPosAttritute(){return this.data[this.desc.positionAttribute]}_prepareData(t){if(!this.data)return;const e=this._buffers||{};for(const i in this.data){const n=this.data[i];if(n)if(n.buffer&&n.buffer.destroy){const e=n.buffer;e[Yv]||(e[Yv]=0),t&&e[Yv]++}else if(n&&n.array)if(Sv(n)){let t=n.array.buffer.__id;t||(t=n.array.buffer.__id=Xv++),this.data[i]={buffer:t,offset:n.byteOffset,stride:n.byteStride,type:qv[n.componentType],size:n.itemSize,count:n.count,componentType:n.componentType},e[t]||(e[t]={data:n.array.buffer})}else this.data[i]=n.array}this._buffers=e;const n=this.elements;n&&n.array&&(this.elements=n.array)}getAttrData(t){const e=t.key,n=!this._reglData||!this._reglData[e];if(this._reglData||(this._reglData={}),n){const t=this._reglData[e]={},n=this.data,{positionAttribute:i,normalAttribute:r,uv0Attribute:o,uv1Attribute:s,tangentAttribute:a,color0Attribute:h,pickingIdAttribute:l,textureCoordMatrixAttribute:u}=this.desc;pv(t,this.data),t.aPosition=n[i],n[r]&&(t.aNormal=n[r]),n[o]&&(t.aTexCoord=n[o]),n[s]&&(t.aTexCoord1=n[s]),n[a]&&(t.aTangent=n[a]),n[h]&&(t.aColor0=n[h]),n[l]&&(t.aPickingId=n[l]),n[u]&&(t.aTextureCoordMatrix=n[u])}return this._reglData[e]}getREGLData(t,e,n){this.getAttrData(e);const i=!this._reglData||!this._reglData[e.key];if(bv(t)&&!n){const n=e&&e.key||"default";if(!this._vao[n]||i||this._vao[n].dirty){const i=this._reglData[e.key],r=this._vertexCount,o=[];for(let t=0;t<e.length;t++){const n=e[t].name,s=i[n]&&i[n].buffer;if(s&&s.destroy)o.push(void 0!==i[n].stride?i[n]:s);else{const t=i[n];if(!t){o.push(this.desc.fillEmptyDataInMissingAttribute?new Uint8Array(4*r):Wv);continue}const e=(t.data&&vv(t.data)?t.data.length:t.length)/r;t.data?(t.dimension=e,o.push(t)):o.push({data:t,dimension:e})}}const s={attributes:o,primitive:this.getPrimitive()};if(this.elements&&!mv(this.elements))if(this.elements.destroy)s.elements=this.elements;else{s.elements={primitive:this.getPrimitive(),data:this.elements};const t=this.getElementsType(this.elements);t&&(s.elements.type=t)}this._vao[n]?this._vao[n].vao(s):this._vao[n]={vao:t.vao(s)}}return delete this._vao[n].dirty,this._vao[n]}return this._reglData[e.key]}_isAttrChanged(t){if(t===this._activeAttributes)return!1;if(t.length!==this._activeAttributes.length)return!0;for(let e=0;e<t.length;e++)if(t[e]!==this._activeAttributes[e])return!0;return!1}generateBuffers(t){const e=this._buffers;for(const a in e)e[a].buffer||(e[a].buffer=t.buffer(e[a].data)),delete e[a].data;const n=this.desc.positionAttribute,i=this.desc.altitudeAttribute,r=this.data,o=this._vertexCount,s={};for(const a in r)if(r[a]){if(void 0===r[a].buffer||r[a].buffer instanceof ArrayBuffer){const e=r[a].data?r[a]:{data:r[a]};e.dimension=(r[a].data?r[a].data:r[a]).length/o;const h=t.buffer(e);h[Yv]=1,s[a]={buffer:h},a!==n&&a!==i||(s[a].array=r[a])}else r[a].buffer.destroy?s[a]=r[a]:e[r[a].buffer]&&(s[a]=pv({},r[a]),s[a].buffer=e[r[a].buffer].buffer);(this.desc.static||a!==n)&&delete r[a].array}if(this.data=s,delete this._reglData,this.elements&&!mv(this.elements)){const e={primitive:this.getPrimitive(),data:this.elements},n=this.getElementsType(this.elements);if(n&&(e.type=n),!this.desc.static&&!this.elements.destroy){const t=this.elements;this.indices=new Uint16Array(t.length);for(let e=0;e<t.length;e++)this.indices[e]=t[e]}this.elements=this.elements.destroy?this.elements:t.elements(e);const i=this.elements;i[Yv]||(i[Yv]=0),i[Yv]++}}getVertexCount(){const{positionAttribute:t,positionSize:e,color0Attribute:n}=this.desc;let i=this.data[t];i.data&&(i=i.data),i.array&&(i=i.array),vv(i)?this._vertexCount=Math.ceil(i.length/e):i&&void 0!==i.count&&(this._vertexCount=i.count);const r=n;if(this.data[r]){const t=this.data[r].data||this.data[r].array||this.data[r];Array.isArray(t)?this._color0Size=t.length/this._vertexCount:t&&t.count?this._color0Size=t.count/this._vertexCount:this.data[r].buffer&&this.data[r].buffer.destroy&&(this._color0Size=this.data[r].buffer._buffer.dimension)}return this._vertexCount}getColor0Size(){return this._color0Size||0}addBuffer(t,e){return this._buffers[t]={data:e},delete this._reglData,this._deleteVAO(),this}updateBuffer(t,e){if(!this._buffers[t])throw new Error(`invalid buffer ${t} in geometry`);return this._buffers[t].buffer?this._buffers[t].buffer.subdata(e):this._buffers[t].data=e,delete this._reglData,this._deleteVAO(),this}deleteData(t){const e=this.data[t];return e?(this._incrVersion(),e.buffer&&e.buffer.destroy&&e.buffer.destroy(),delete this.data[t],delete this._reglData,this._markVAODirty(!1),this):this}updateData(t,e){const n=this.data[t];if(!n)return this;let i;return this._incrVersion(),this.data[t]=e,n.buffer&&n.buffer.destroy&&(i=n),t===this.desc.positionAttribute&&this.updateBoundingBox(),this.getVertexCount(),i&&(i.buffer(e),this.data[t]=i),this._prepareData(!1),this.desc.positionAttribute===t&&(this._posDirty=!0),delete this._reglData,this}updateSubData(t,e,n){const i=this.data[t];if(!i)return this;let r;if(this._incrVersion(),i.buffer&&i.buffer.destroy&&(r=i),t===this.desc.positionAttribute&&this._updateSubBoundingBox(e),r){const t=Zv[r.buffer._buffer.dtype];e.BYTES_PER_ELEMENT!==t&&(e=new(s=t,(o=e)instanceof Uint8Array||o instanceof Uint16Array||o instanceof Uint32Array||o instanceof Uint8ClampedArray?1===s?Uint8Array:2===s?Uint16Array:Uint32Array:o instanceof Int8Array||o instanceof Int16Array||o instanceof Int32Array?1===s?Int8Array:2===s?Int16Array:Int32Array:o instanceof Float32Array||o instanceof Float64Array?4===s?Float32Array:Float64Array:null)(e)),r.buffer.subdata(e,n*t)}else{const i=this.data[t].data?this.data[t].data:this.data[t];for(let t=0;t<e.length;t++)i[n+t]=e[t]}var o,s;return this._prepareData(!1),this.desc.positionAttribute===t&&(this._posDirty=!0),delete this._reglData,this}getPrimitive(){return this.desc.primitive}getElements(){return this.elements}setElements(t,e){if(!t)throw new Error("elements data is invalid");this._incrVersion();const n=this.elements;return this.count=void 0===e?Kv(t):e,this.elements=t&&t.destroy?t:n.destroy?n(t):t,this._markVAODirty(!0),this}deleteElements(){return this.elements&&0!==this.elements.length?(this._incrVersion(),this.elements&&this.elements.destroy&&!this.elements[Nv]&&(this.elements.destroy(),this.elements[Nv]=1),this.elements=[],this._markVAODirty(!0),this):this}_markVAODirty(t){if(this._vao){for(const e in this._vao)t?this._vao[e].vao.destroy():this._vao[e].dirty=!0;t&&(this._vao={})}}setDrawCount(t){return this._incrVersion(),this.count1=t,this}getDrawCount(){return this.count1>=0?this.count1:this.count}setDrawOffset(t){return this._incrVersion(),this.offset=t,this}getDrawOffset(){return this.offset||0}dispose(){if(this._deleteVAO(),this._forEachBuffer((t=>{if(!t[Nv]){let e=t[Yv];e&&e--,e<=0?(t[Nv]=!0,t.destroy()):t[Yv]=e}})),this.properties){const t=this.properties.oldElementsBeforeHighlight;t&&!t[Nv]&&t.destroy&&(t.destroy(),t[Nv]=!0),delete this.properties.oldElementsBeforeHighlight,delete this.properties.hasInvisible}this.data={},this._buffers={},delete this._reglData,this.count=0,this.elements=[],delete this._tempPosArray,this._disposed=!0}isDisposed(){return!!this._disposed}updateBoundingBox(){let t=this.boundingBox;t||(t=this.boundingBox=new Vv);let e,n,i=this.data[this.desc.positionAttribute];if(vv(i)||(i.data?i=i.data:Iv(i)?i=this._getAttributeData(this.desc.positionAttribute):i.array&&(e=i.min,n=i.max,i=i.array)),i&&i.length){const r=t.min,o=t.max;if(e&&n)pg(r,...e),pg(o,...n);else{pg(r,i[0],i[1],i[2]),pg(o,i[0],i[1],i[2]);for(let t=3;t<i.length;){const e=i[t++],n=i[t++],s=i[t++];e<r[0]&&(r[0]=e),n<r[1]&&(r[1]=n),s<r[2]&&(r[2]=s),e>o[0]&&(o[0]=e),n>o[1]&&(o[1]=n),s>o[2]&&(o[2]=s)}}t.updateVertex(),t.dirty()}}_updateSubBoundingBox(t){const e=this.boundingBox,n=e.min,i=e.max,r=this.desc.positionSize;for(let o=0;o<t.length;){const e=t[o++],s=t[o++];let a=0;3===r&&(a=t[o++]),e<n[0]&&(n[0]=e),s<n[1]&&(n[1]=s),a<n[2]&&(n[2]=a),e>i[0]&&(i[0]=e),s>i[1]&&(i[1]=s),a>i[2]&&(i[2]=a)}e.updateVertex(),e.dirty()}_getAttributeData(t){const e=this.data[t]&&this.data[t].array?this.data[t].array:this.data[t],n=e.buffer;if(Iv(e)){const i=this._buffers[n]?this._buffers[n].data:e.array,{count:r,size:o,stride:s,offset:a,componentType:h}=e,l=tp.getTypedArrayCtor(h);if((0===s||s===o*l.BYTES_PER_ELEMENT)&&a%l.BYTES_PER_ELEMENT==0)return new l(i,a,r*o);if(t===this.desc.positionAttribute)return!this._tempPosArray||this._tempPosArray&&this._tempPosArray.length<o*r?(this._tempPosArray=new l(o*r),tp.readInterleavedArray(this._tempPosArray,i,r,o,s,a,h)):this._posDirty?(this._posDirty=!1,tp.readInterleavedArray(this._tempPosArray,i,r,o,s,a,h)):this._tempPosArray;{const t=new l(o*r);return tp.readInterleavedArray(t,i,r,o,s,a,h)}}return e}createTangent(t="aTangent"){this._incrVersion();const{normalAttribute:e,positionAttribute:n,uv0Attribute:i}=this.desc,r=this._getAttributeData(e),o=hv(this._getAttributeData(n),r,this.data[i],this.elements),s=this.data[t]=new Float32Array(o.length),a=[0,0,0,0],h=[0,0,0],l=[0,0,0,0];for(let u=0;u<o.length;u+=4){const t=u/4*3;pg(h,r[t],r[t+1],r[t+2]),qg(a,o[u],o[u+1],o[u+2],o[u+3]),Jy(l,h,a),Wg(s.subarray(u,u+4),l)}delete this._reglData}createNormal(t="aNormal"){this._incrVersion();const e=this._getAttributeData(this.desc.positionAttribute);this.data[t]=$y(e.array||e,this.elements),delete this._reglData}createBarycentric(t="aBarycentric"){if("triangles"!==this.desc.primitive)throw new Error("Primitive must be triangles to create bary centric data");this._incrVersion();const e=new Uint8Array(3*this._vertexCount);for(let n=0,i=this.elements.length;n<i;)for(let t=0;t<3;t++)e[3*this.elements[n++]+t]=1;this.data[t]=e,delete this._reglData}buildUniqueVertex(){this._incrVersion();const t=this.data,e=this.elements;if(!vv(e))throw new Error("elements must be array to build unique vertex.");const n=Object.keys(t),i={};let r=t[this.desc.positionAttribute];if(r=r.length?r:r.array,!vv(r))throw new Error(this.desc.positionAttribute+" must be array to build unique vertex.");const o=this._vertexCount,s=e.length;for(let h=0;h<n.length;h++){const e=n[h],r=vv(t[e])?t[e]:t[e].array,a=r.length/o;if(!vv(r))throw new Error(e+" must be array to build unique vertex.");i[e]=r,t[e]=new r.constructor(s*a)}let a=0;for(let h=0;h<s;h++){const r=e[h];for(let e=0;e<n.length;e++){const s=n[e],h=t[s],l=i[s].length/o;for(let t=0;t<l;t++)h[a*l+t]=i[s][r*l+t]}e[h]=a++}r=this.data[this.desc.positionAttribute],this._vertexCount=Math.ceil(r.length/this.desc.positionSize),delete this._reglData}getMemorySize(){let t=0;for(const e in this.data)wv(this.data,e)&&(t+=Cv(this.data[e]));if(this.elements){const e=this.elements;e.destroy?t+=e._elements.buffer.byteLength:e.BYTES_PER_ELEMENT?t+=e.length*e.BYTES_PER_ELEMENT:e.length&&(t+=4*e.length)}return t}_deleteVAO(){for(const t in this._vao)this._vao[t].vao.destroy();this._vao={}}_forEachBuffer(t){this.elements&&this.elements.destroy&&t(this.elements);for(const e in this.data)wv(this.data,e)&&this.data[e]&&this.data[e].buffer&&this.data[e].buffer.destroy&&t(this.data[e].buffer);for(const e in this._buffers)wv(this._buffers,e)&&this._buffers[e]&&this._buffers[e].buffer&&this._buffers[e].buffer.destroy&&t(this._buffers[e].buffer)}getElementsType(t){return t instanceof Uint8Array?"uint8":t instanceof Uint16Array?"uint16":t instanceof Uint32Array?"uint32":void 0}_incrVersion(){this._version++}};function Kv(t){if(mv(t))return t;if(void 0!==t.count)return t.count;if(t.destroy)return t._elements.vertCount;if(void 0!==t.length)return t.length;if(t.data)return t.data.length;throw new Error("invalid elements length")}const $v=["points","lines","line strip","line loop","triangles","triangle strip","triangle fan"];function t_(t){return $v[t]}const e_={5121:"uint8",5123:"uint16",5125:"uint32",5126:"float",36193:"half float"};function n_(t){return e_[t]}const i_={6406:"alpha",6407:"rgb",6408:"rgba",6409:"luminance",6410:"luminance alpha",33776:"rgb s3tc dxt1",33777:"rgba s3tc dxt1",33778:"rgba s3tc dxt3",33779:"rgba s3tc dxt5",35840:"rgb pvrtc 4bppv1",35841:"rgb pvrtc 2bppv1",35842:"rgba pvrtc 4bppv1",35843:"rgba pvrtc 2bppv1",35986:"rgb atc",35987:"rgba atc explicit alpha",34798:"rgba atc interpolated alpha",36196:"rgb etc1"};function r_(t){return i_[t]}const o_={9729:"linear",9728:"nearest"};function s_(t){return o_[t]}const a_={9729:"linear",9728:"nearest",9984:"nearest mipmap nearest",9985:"linear mipmap nearest",9986:"nearest mipmap linear",9987:"linear mipmap linear"};function h_(t){return a_[t]}const l_={10497:"repeat",33071:"clamp",33648:"mirror"};function u_(t){return l_[t]}const c_="__reshader_webgl_buffer",A_="__reshader_webgl_tex";function f_(t,e,n){let i;if(vv(e)?e.buffer&&void 0!==e.byteOffset&&(i=e):e.array&&e.array.buffer&&void 0!==e.array.byteOffset&&(i=e.array),!i)return null;const r=i.buffer,o=i.byteOffset;r[c_]||(r[c_]={});let s=r[c_][o];if(!s){const e={};n&&pv(e,n),e.data=i,s=t.buffer(e),r[c_][o]=s}return s}function d_(t,e){const n=e.data;if(!n||!n.buffer)return t.texture(e);const i=n.buffer,r=n.byteOffset;i[A_]||(i[A_]={});let o=i[A_][r];return o||(o=t.texture(e),i[A_][r]=o),o}var p_=Object.freeze({__proto__:null,getMaterialFormat:r_,getMaterialType:n_,getPrimitive:t_,getTextureMagFilter:s_,getTextureMinFilter:h_,getTextureWrap:u_,getUniqueREGLBuffer:f_,getUniqueTexture:d_});const g_=[0,0,0],m_=[0,0,0],y_=[0,0,0],v_=[],__=[],x_=[],b_=["a","b","c"];let w_=class extends Jv{constructor(t,e,n,i){super(t,e,n,{primitive:t_(1),positionAttribute:i.positionAttribute})}_getPosAttritute(){const t=this.data[this.desc.positionAttribute];if(!t.length)return[];const e=Math.pow(10,4),n=Math.cos(Math.PI/180*.8),i=this.elements,r=t.length?t:t.array,o=i.length?i?i.length:r.length/3:i,s=[0,0,0],a=new Array(3),h={},l=[],u=new C_;for(let c=0;c<o;c+=3){i.length?(s[0]=i[c],s[1]=i[c+1],s[2]=i[c+2]):(s[0]=c,s[1]=c+1,s[2]=c+2),u.a=P_(v_,r,s[0]),u.b=P_(__,r,s[1]),u.c=P_(x_,r,s[2]);const t=u.getNormal(),o=u.a,A=u.b,f=u.c;if(a[0]=`${Math.round(o[0]*e)},${Math.round(o[1]*e)},${Math.round(o[2]*e)}`,a[1]=`${Math.round(A[0]*e)},${Math.round(A[1]*e)},${Math.round(A[2]*e)}`,a[2]=`${Math.round(f[0]*e)},${Math.round(f[1]*e)},${Math.round(f[2]*e)}`,a[0]!==a[1]&&a[1]!==a[2]&&a[2]!==a[0])for(let e=0;e<3;e++)this._calEdgeData(e,s,u,h,a,n,t,l)}for(const c in h)if(h[c]){const{index0:t,index1:e}=h[c];l.push(r[3*t],r[3*t+1],r[3*t+2]),l.push(r[3*e],r[3*e+1],r[3*e+2])}return this.elements=this._createElements(l),l}_calEdgeData(t,e,n,i,r,o,s,a){const h=(t+1)%3,l=r[t],u=r[h],c=n[b_[t]],A=n[b_[h]],f=`${l}_${u}`,d=`${u}_${l}`;d in i&&i[d]?(Mg(s,i[d].normal)<=o&&(a.push(c[0],c[1],c[2]),a.push(A[0],A[1],A[2])),i[d]=null):f in i||(i[f]={index0:e[t],index1:e[h],normal:dg([0,0,0],s)})}_createElements(t){const e=[],n=t.length/3;for(let i=0;i<n;i++)e.push(i);return e}},C_=class{constructor(t=[0,0,0],e=[0,0,0],n=[0,0,0]){this.a=t,this.b=e,this.c=n}getNormal(){const t=Dg(g_,this.a,this.b),e=Dg(m_,this.a,this.c);Tg(y_,t,e);const n=Ag(y_);return pg(y_,y_[0]/n,y_[1]/n,y_[2]/n)}};function P_(t,e,n){return pg(t,e[3*n],e[3*n+1],e[3*n+2])}let M_=class{},T_=class extends(Fv(M_)){constructor(t={},e){super(),this._version=0,this._propVerion=0,this.uniforms=gv({},e||{},t);for(const n in t){const e=Object.getOwnPropertyDescriptor(t,n).get;e&&Object.defineProperty(this.uniforms,n,{get:e})}this.unlit=!1,this._reglUniforms={},this.refCount=0,this._bindedOnTextureComplete=(...t)=>this._onTextureComplete.call(this,...t),this._genUniformKeys(),this._checkTextures()}set version(t){throw new Error("Material.version is read only.")}get version(){return this._version}get propVersion(){return this._propVerion}set doubleSided(t){this.uniforms.doubleSided=t}get doubleSided(){return!!this.uniforms.doubleSided}isReady(){return this._loadingCount<=0}set(t,e){const n=Av(this.uniforms[t])&&!Av(e)||!Av(this.uniforms[t])&&Av(e);if(this.uniforms[t]&&this.isTexture(t)&&this.uniforms[t].dispose(),Av(e))Av(this.uniforms[t])||delete this.uniforms[t];else if(this.uniforms[t]=e,this._reglUniforms){const n=Object.getOwnPropertyDescriptor(this._reglUniforms,t);n&&!n.get&&(this._propVerion++,this._reglUniforms[t]=e)}return this.isTexture(t)&&this._checkTextures(),n&&(this._genUniformKeys(),this._incrVersion()),this}setFunctionUniform(t,e){return this._genUniformKeys(),this._incrVersion(),Object.defineProperty(this.uniforms,t,{enumerable:!0,get:e}),this}hasFunctionUniform(t){return!!this.uniforms&&Object.prototype.hasOwnProperty.call(this.uniforms,t)}get(t){return this.uniforms[t]}isDirty(){return this._uniformVer!==this.version}appendDefines(t,e){const n=this.uniforms;return n?(n.jointTexture&&(t.HAS_SKIN=1),n.morphWeights1&&(t.HAS_MORPH=1),(n.khr_offset||n.khr_rotation||n.khr_scale)&&(t.HAS_KHR_TEXTURE_TRANSFORM=1),t):t}hasSkinAnimation(){return!!(this.uniforms&&this.uniforms.jointTexture&&this.uniforms.skinAnimation)}getUniforms(t){if(this._reglUniforms&&!this.isDirty())return this._reglUniforms;const e=this.uniforms,n={};for(const i in e)this.isTexture(i)?Object.defineProperty(n,i,{enumerable:!0,configurable:!0,get:function(){return e[i].getREGLTexture(t)}}):Object.getOwnPropertyDescriptor(e,i).get?Object.defineProperty(n,i,{enumerable:!0,configurable:!0,get:function(){return e[i]}}):n[i]=e[i];return this._reglUniforms=n,this._uniformVer=this.version,n}isTexture(t){return this.uniforms[t]instanceof jv}dispose(){for(const t in this.uniforms){const e=this.uniforms[t];e&&(e.dispose?e.dispose():e.destroy&&!e[Nv]&&(e.destroy(),e[Nv]=!0))}delete this.uniforms,delete this._reglUniforms,delete this._bindedOnTextureComplete,this._disposed=!0}isDisposed(){return!!this._disposed}_checkTextures(){this._loadingCount=0;for(const t in this.uniforms)if(this.isTexture(t)){const e=this.uniforms[t];e.isReady()||(this._loadingCount++,e.on("complete",this._bindedOnTextureComplete))}}_onTextureComplete(){this._loadingCount--,this._incrVersion(),this._loadingCount<=0&&(this._disposed||this.fire("complete"))}getUniformKeys(){return this._uniformKeys}_genUniformKeys(){const t=[];for(const e in this.uniforms)wv(this.uniforms,e)&&!Av(this.uniforms[e])&&t.push(e);this._uniformKeys=t.join()}_incrVersion(){this._version++}getMemorySize(){const t=this.uniforms;let e=0;for(const n in t)this.isTexture(n)?e+=t[n].getMemorySize():this.uniforms[n]&&this.uniforms[n].destroy&&(e+=Pv(this.uniforms[n]));return e}};const S_={time:0,seeThrough:!0,thickness:.03,fill:[1,.5137254902,.98,1],stroke:[.7019607843,.9333333333,.2274509804,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,insideAltColor:!1,squeeze:!1,squeezeMin:.5,squeezeMax:1,dualStroke:!1,secondThickness:.05,opacity:1,noiseEnable:!1},I_={baseColorFactor:[1,1,1,1],materialShininess:32,environmentExposure:1,specularStrength:32,opacity:1,extrusionOpacity:0,extrusionOpacityRange:[0,1.8],baseColorTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null,uvScale:[1,1],uvOffset:[0,0],alphaTest:0};let E_=class t extends T_{constructor(t){super(t,I_)}static convertFrom(e){const n={};for(const t in I_)n[t]=e.get(t);return new t(n)}appendDefines(t,e){super.appendDefines(t,e);const n=this.uniforms;return n.extrusionOpacity&&(t.HAS_EXTRUSION_OPACITY=1),e.data[e.desc.colorAttribute]&&(t.HAS_COLOR=1),e.data[e.desc.color0Attribute]&&(t.HAS_COLOR0=1,t.COLOR0_SIZE=e.getColor0Size()),e.data[e.desc.tangentAttribute]?t.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(t.HAS_NORMAL=1),e.data[e.desc.uv0Attribute]?(n.baseColorTexture&&(t.HAS_BASECOLOR_MAP=1),n.occlusionTexture&&e.data[e.desc.uv1Attribute]&&(t.HAS_AO_MAP=1),n.emissiveTexture&&(t.HAS_EMISSIVE_MAP=1),n.normalTexture&&(t.HAS_NORMAL_MAP=1),(t.HAS_BASECOLOR_MAP||t.HAS_AO_MAP||t.HAS_EMISSIVE_MAP||t.HAS_NORMAL_MAP)&&(t.HAS_MAP=1),t):t}};const O_={baseColorFactor:[1,1,1,1],uvScale:[1,1],uvOffset:[0,0],opacity:1,envMapExposure:128,emissiveFactor:[.1,.1,.1],specularFactor:[0,0,0],envRotationSin:0,envRotationCos:1,reflectivity:.01,themingColor:[0,0,0,0],exposureBias:.6};let R_=class extends T_{constructor(t){super(t,O_)}appendDefines(t,e){super.appendDefines(t,e);const n=this.uniforms;return n.extrusionOpacity&&(t.HAS_EXTRUSION_OPACITY=1),e.data[e.desc.colorAttribute]&&(t.HAS_COLOR=1),e.data[e.desc.color0Attribute]&&(t.HAS_COLOR0=1,t.COLOR0_SIZE=e.getColor0Size()),e.data[e.desc.uv0Attribute]?(n.baseColorTexture&&(t.HAS_BASECOLOR_MAP=1),n.occlusionTexture&&e.data[e.desc.uv1Attribute]&&(t.HAS_AO_MAP=1),n.emissiveTexture&&(t.HAS_EMISSIVE_MAP=1),n.normalTexture&&(t.HAS_NORMAL_MAP=1),(t.HAS_BASECOLOR_MAP||t.HAS_AO_MAP||t.HAS_EMISSIVE_MAP||t.HAS_NORMAL_MAP)&&(t.HAS_MAP=1),t.ALPHATEST=.01,t.GAMMA_INPUT=1,t.GAMMA_FACTOR=1,t.TONEMAP_OUTPUT=1,t.ENVMAP_MODE_REFLECTION=1,t.ENV_RGBM=1,t.IRR_RGBM=1,t):t}};const D_={diffuseFactor:[1,1,1,1],specularFactor:[1,1,1],glossinessFactor:1,diffuseTexture:null,specularGlossinessTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null};function k_(t){return class extends t{constructor(...t){let e=t[0];e=pv({},D_,e||{}),super(e,t)}appendDefines(t,e){if(super.appendDefines(t,e),t.SHADING_MODEL_SPECULAR_GLOSSINESS=1,!e.data[e.desc.uv0Attribute])return t;const n=this.uniforms;return n.diffuseTexture&&(t.HAS_DIFFUSE_MAP=1),n.specularGlossinessTexture&&(t.HAS_SPECULARGLOSSINESS_MAP=1),(t.HAS_SPECULARGLOSSINESS_MAP||t.HAS_DIFFUSE_MAP)&&(t.HAS_MAP=1),t}}}let L_=class extends(k_(E_)){};const F_=new Array(16);let N_=0,z_=class{constructor(t,e,n={}){this._version=0,this._geometry=t,this._material=e,this.transparent=!!n.transparent,this.bloom=!!n.bloom,this.ssr=!!n.ssr,this._castShadow=Av(n.castShadow)||n.castShadow,this.needUpdateShadow=!1,this.picking=!!n.picking,this.disableVAO=!!n.disableVAO,this.uniforms={},this._localTransform=Np(new Array(16)),this._positionMatrix=Np(new Array(16)),this.properties={},this._dirtyUniforms=!0,this._dirtyGeometry=!0,Object.defineProperty(this,"uuid",{value:N_++}),N_>Number.MAX_VALUE-10&&(N_=0)}set material(t){this._material!==t&&this.setMaterial(t)}get material(){return this._material}set version(t){throw new Error("Mesh.version is read only.")}get version(){return this._version}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._incrVersion(),this._dirtyGeometry=!0),this._geometry=t}set localTransform(t){this._prevTMat||(this._prevTMat=new Array(16)),Array.isArray(t)&&!hg(this._prevTMat,t)&&(this._incrVersion(),this._prevTMat=Fp(this._prevTMat,t)),this._localTransform=t}get localTransform(){return dv(this._localTransform)?this._localTransform():this._localTransform}set positionMatrix(t){this._prevPMat||(this._prevPMat=new Array(16)),Array.isArray(t)&&!hg(this._prevPMat,t)&&(this._incrVersion(),this._prevPMat=Fp(this._prevPMat,t)),this._positionMatrix=t}get positionMatrix(){return dv(this._positionMatrix)?this._positionMatrix():this._positionMatrix}get config(){return this._options||(this._options={}),this._options.transparent=this.transparent,this._options.castShadow=this.castShadow,this._options.bloom=this.bloom,this._options.ssr=this.ssr,this._options.picking=this.picking,this._options}get defines(){return this._getDefines()}set defines(t){this.setDefines(t)}get castShadow(){return this._castShadow&&(!this.material||!this.material.unlit)}set castShadow(t){this._castShadow=t}setMaterial(t){return this._material=t,this._dirtyUniforms=!0,delete this._materialVer,this.dirtyDefines=!0,this}setParent(t){return this.parent=t,this}setLocalTransform(t){return this.localTransform=t,this}setPositionMatrix(t){this.positionMatrix=t}setUniform(t,e){return this._updateUniformState(t),this.uniforms[t]=e,this}setFunctionUniform(t,e){return this._updateUniformState(t),Object.defineProperty(this.uniforms,t,{enumerable:!0,get:e}),this}hasFunctionUniform(t){return!!this.uniforms&&Object.prototype.hasOwnProperty.call(this.uniforms,t)}_updateUniformState(t){void 0===this.uniforms[t]?this._dirtyUniforms=!0:(this._dirtyProps=this._dirtyProps||[],this._dirtyProps.push(t))}getUniform(t){return this.uniforms[t]}getDefines(){const t={};return pv(t,this._getDefines()),this._material&&this._geometry&&this._material.appendDefines(t,this._geometry),t}_getDefines(){this._defines||(this._defines={});const t=this._geometry,e=t.data[t.desc.positionAttribute],n=t.data[t.desc.uv0Attribute],i=t.data[t.desc.normalAttribute];return e&&e.quantization&&(this._defines.HAS_DRACO_POSITION=1),n&&n.quantization&&(this._defines.HAS_DRACO_TEXCOORD=1),i&&i.quantization&&(this._defines.HAS_DRACO_NORMAL=1),this._defines}setDefines(t){const e=this._bakDefines;return this._defines=t,this.dirtyDefines=this.dirtyDefines||!!e!=!!t||!function(t,e){if(!t&&!e)return!0;const n=Object.getOwnPropertyNames(t),i=Object.getOwnPropertyNames(e);if(n.length!==i.length)return!1;for(let r=0;r<n.length;r++)if(t[n[r]]!==e[n[r]])return!1;return!0}(e,t),this.dirtyDefines&&(this._bakDefines=pv({},t)),this}hasSkinAnimation(){return this._material&&this._material.hasSkinAnimation()}_getDefinesKey(){return this.dirtyDefines=!1,this._createDefinesKey(this.getDefines())}getCommandKey(t){if(!this._commandKey||this.dirtyDefines||this._material&&this._materialKeys!==this._material.getUniformKeys()){let t=this._getDefinesKey();t+="_"+(mv(this.getElements())?"count":"elements"),t+="_"+ +!!this.disableVAO,this._material&&(t+="_"+ +!!this._material.doubleSided),this._commandKey=t,this._material&&(this._materialKeys=this._material.getUniformKeys())}return this._commandKey}getUniforms(t){if(this._dirtyUniforms||this._dirtyGeometry||this._material&&this._materialVer!==this._material.version){this._uniformDescriptors=new Set,this._realUniforms={},this._prepareUniformsForDraco();const e=this.uniforms;for(const t in this.uniforms)wv(this.uniforms,t)&&(Object.getOwnPropertyDescriptor(e,t).get?(this._uniformDescriptors.add(t),Object.defineProperty(this._realUniforms,t,{enumerable:!0,configurable:!0,get:function(){return e[t]}})):this._realUniforms[t]=e[t]);if(this._material){const e=this._material.getUniforms(t);for(const t in e)wv(e,t)&&!wv(this._realUniforms,t)&&(Object.getOwnPropertyDescriptor(e,t).get?(this._uniformDescriptors.add(t),Object.defineProperty(this._realUniforms,t,{enumerable:!0,configurable:!0,get:function(){return e[t]}})):void 0===this._realUniforms[t]&&(this._realUniforms[t]=e[t]))}this._dirtyUniforms=!1,this._dirtyGeometry=!1,this._materialVer=this._material&&this._material.version,this._materialPropVer=this._material&&this._material.propVersion,this._dirtyProps=null}else if(this._dirtyProps||this._material&&this._material.propVersion!==this._materialPropVer){if(this._dirtyProps)for(const t of this._dirtyProps)this._realUniforms[t]=this.uniforms[t];if(this._material&&this._material.propVersion!==this._materialPropVer){const e=this._material.getUniforms(t);for(const t in e)wv(e,t)&&!this._uniformDescriptors.has(t)&&(Object.getOwnPropertyDescriptor(e,t).get||this._realUniforms[t]===e[t]||(this._realUniforms[t]=e[t]));this._materialPropVer=this._material.propVersion}this._dirtyProps=null}return this._realUniforms.modelMatrix=this.localTransform,this._realUniforms.positionMatrix=this.positionMatrix,this._realUniforms}_prepareUniformsForDraco(){const t=this._geometry,e=t.data[t.desc.positionAttribute],n=t.data[t.desc.uv0Attribute],i=t.data[t.desc.normalAttribute];if(e&&e.quantization){const t=e.quantization,n=t.range/(1<<t.quantizationBits);this._realUniforms.minValues_pos=t.minValues,this._realUniforms.gltf_u_dec_position_normConstant=n}if(n&&n.quantization){const t=n.quantization;this._realUniforms.minValues_tex=t.minValues,this._realUniforms.gltf_u_dec_texcoord_0_normConstant=t.range/(1<<t.quantizationBits)}i&&i.quantization&&(this._realUniforms.gltf_u_dec_normal_rangeConstant=(1<<i.quantization.quantizationBits)-1)}getMaterial(){return this._material}getElements(){return this._geometry.getElements()}_getREGLAttrData(t,e){return this._geometry.getREGLData(t,e,this.disableVAO)}getREGLProps(t,e){const n=this.getUniforms(t);return pv(n,this._getREGLAttrData(t,e)),bv(t)&&!this.disableVAO||(n.elements=this._geometry.getElements()),n.meshProperties=this.properties,n.geometryProperties=this._geometry.properties,n.meshConfig=this.config,n.count=this._geometry.getDrawCount(),n.offset=this._geometry.getDrawOffset(),n.primitive=this._geometry.getPrimitive(),n}dispose(){return delete this._geometry,delete this._material,this.uniforms=null,this}isValid(){return this._geometry&&!this._geometry.isDisposed()&&(!this._material||!this._material.isDisposed())}getBoundingBox(){return this._geometry?(this._bbox||this.updateBoundingBox(),Hp(F_,this.localTransform,this.positionMatrix),hg(F_,this._currentTransform)&&this._geometry.boundingBox.equals(this._geoBox)||this.updateBoundingBox(),this._bboxArr):null}updateBoundingBox(){const t=this._geometry.boundingBox;this._bbox||(this._bbox=new Vv),this._bboxArr||(this._bboxArr=[[0,0,0],[0,0,0]]),this._geoBox||(this._geoBox=new Vv),Vv.copy(this._bbox,t),this._bbox.updateVertex(),"InstancedMesh"===this.constructor.name?(this._bbox.transform(this.localTransform,this.positionMatrix),this._currentTransform=Hp(this._currentTransform||new Array(16),this.positionMatrix,this.localTransform)):(this._bbox.transform(this.positionMatrix,this.localTransform),this._currentTransform=Hp(this._currentTransform||new Array(16),this.localTransform,this.positionMatrix)),Vv.copy(this._geoBox,t),dg(this._bboxArr[0],this._bbox.min),dg(this._bboxArr[1],this._bbox.max)}_createDefinesKey(t){const e=[];for(const n in t)e.push(n,t[n]);return e.join(",")}_incrVersion(){this._version++}getMemorySize(){return(this.geometry&&this.geometry.getMemorySize()||0)+(this.material&&this.material.getMemorySize()||0)}getWorldTransform(){const t=this.parent;return t?Hp(new Array(16),t.getWorldTransform(),this.localTransform):this.localTransform}},B_=class extends z_{constructor(t,e,n,i,r={}){super(n,i,r),this._instanceCount=e,this.instancedData=t||{},this._checkInstancedProp(),this._vao={}}get instanceCount(){return this._instanceCount}set instanceCount(t){this._incrVersion(),this._instanceCount=t}getMemorySize(){return super.getMemorySize()+this._getInstanceMemorySize()}_getInstanceMemorySize(){let t=0;for(const e in this.instancedData)wv(this.instancedData,e)&&(t+=Cv(this.instancedData[e]));return t}_checkInstancedProp(){for(const t in this.instancedData)if(this.geometry.data[t])throw new Error(`Duplicate attribute ${t} defined in geometry and instanced data`)}_getREGLAttrData(t,e){const n=this.geometry.getAttrData(e);if(bv(t)){const i=e.key;if(!this._vao[i]||this._vao[i].dirty){const r=e.map((t=>t.name)),o=[];for(let t=0;t<r.length;t++){const e=n[r[t]];o.push(e&&e.buffer||this.instancedData[r[t]])}const s={attributes:o,primitive:this.geometry.getPrimitive()};this._vao[i]?this._vao[i].vao(s):this._vao[i]={vao:t.vao(s)},delete this._vao[i].dirty}return this._vao[i]}return n}getDefines(){const t=super.getDefines();return t.HAS_INSTANCE=1,t}getCommandKey(t){return"i_"+super.getCommandKey(t)}updateInstancedData(t,e){const n=this.instancedData[t];if(!n)return this;if(this._incrVersion(),this.instancedData[t]=e,n.buffer&&n.buffer.destroy&&n.buffer.destroy(),this._vao)for(const i in this._vao)this._vao[i].dirty=!0;return this}generateInstancedBuffers(t){const e=this.instancedData,n={};for(const i in e){if(!e[i])continue;const r=e[i];void 0!==r.buffer&&r.buffer.destroy?(n[i]=r,n[i].divisor&&(n[i].divisor=1)):n[i]=e[i].destroy?{buffer:e[i],divisor:1}:{buffer:t.buffer({data:e[i],dimension:e[i].length/this._instanceCount}),divisor:1}}return this.instancedData=n,this}getREGLProps(t,e){const n=super.getREGLProps(t,e);return bv(t)||pv(n,this.instancedData),n.elements=this.geometry.getElements(),n.instances=this._instanceCount,n}disposeInstancedData(){const t=this.instancedData;if(t)for(const e in t){if(!t[e])continue;const n=t[e].destroy?t[e]:t[e].buffer;n.destroy&&!n[Nv]&&(n[Nv]=1,n.destroy())}this.instancedData={};for(const e in this._vao)this._vao[e].vao.destroy();this._vao={}}};const H_={};let j_=class{constructor(t){this.regl=t}render(t,e,n,i){t.setUniforms(e||H_),t.setFramebuffer(i);let r=0;if(n){const{opaques:e,transparents:i}=n.getSortedMeshes();r+=t.draw(this.regl,e),r+=t.draw(this.regl,i)}else r+=t.draw(this.regl);return r}clear(t){this.regl.clear(t)}};const U_={getArrayBuffer:(t,e)=>U_.get(t,{responseType:"arraybuffer"},e),get:function(t,e,n){const i=U_._getClient(n);if(i.open("GET",t,!0),e){for(const t in e.headers)i.setRequestHeader(t,e.headers[t]);i.withCredentials="include"===e.credentials,e.responseType&&(i.responseType=e.responseType)}return i.send(null),i},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){let e;try{e=new XMLHttpRequest}catch(n){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}}}return e.onreadystatechange=U_._wrapCallback(e,t),e}};let G_=class{constructor(t,e){this.defaultTexture=t,this.defaultCubeTexture=new Array(6),this.urlModifier=e,this.resources={}}setURLModifier(t){this.urlModifier=t}get(t){return Array.isArray(t)?this._loadImages(t):this._loadImage(t)}getArrayBuffer(t){if(Array.isArray(t)){const e=t.map((t=>this.getArrayBuffer(t)));return Promise.all(e)}return new Promise(((e,n)=>{let i=t;this.urlModifier&&(i=this.urlModifier(t)),U_.getArrayBuffer(i,((i,r)=>{i?n(i):e({url:t,data:r})}))}))}disposeRes(t){return Array.isArray(t)?t.forEach((t=>this._disposeOne(t))):this._disposeOne(t),this}isLoading(){return this._count&&this._count>0}getDefaultTexture(t){return Array.isArray(t)?this._getBlankTextures(t.length):this.defaultTexture}_disposeOne(t){const e=this.resources;e[t]&&(e[t].count--,e[t].count<=0&&delete e[t])}_loadImage(t){const e=this.resources;return e[t]?Promise.resolve({url:t,data:e[t].image}):new Promise(((n,i)=>{const r=new Image;r.crossOrigin="anonymous",r.onload=function(){e[t]={image:r,count:1},n({url:t,data:r})},r.onerror=function(t){i(t)},r.onabort=function(){i(`image(${t}) loading aborted.`)},r.src=this.urlModifier?this.urlModifier(t):t}))}_loadImages(t){const e=t.map((t=>this._loadImage(t)));return Promise.all(e)}_getBlankTextures(t){const e=new Array(t);for(let n=0;n<6;n++)e.push(this.defaultTexture);return e}},V_=class extends(Fv(G_)){};const W_=[0,0,0],q_=[0,0,0];let Z_,Q_=0;function X_(t,e){return Sg(W_,t.geometry.boundingBox.getCenter(),t.localTransform),Sg(q_,e.geometry.boundingBox.getCenter(),e.localTransform),Fg(q_,Z_)-Fg(W_,Z_)}let Y_=class{constructor(t){this._id=Q_++,this.sortedMeshes={},this.setMeshes(t),this.dirty()}setMeshes(t){if(this.clear(),!t||Array.isArray(t)&&!t.length||t===this.meshes)return this;t=Array.isArray(t)?t:[t],this.meshes=[];for(let e=0;e<t.length;e++){const n=t[e];n&&(n._scenes=n._scenes||{},n._scenes[this._id]=1,this.meshes.push(n))}return this.dirty(),this}addMesh(t){if(!t||Array.isArray(t)&&!t.length)return this;if(Array.isArray(t))t.forEach((t=>{const e=t._scenes=t._scenes||{};e[this._id]||(e[this._id]=1,this.meshes.push(t),this.dirty())}));else{const e=t._scenes=t._scenes||{};e[this._id]||(e[this._id]=1,this.meshes.push(t),this.dirty())}return this}removeMesh(t){if(!t||Array.isArray(t)&&!t.length)return this;if(Array.isArray(t)){let e=!1;for(let n=0;n<t.length;n++){const i=t[n]._scenes;i&&i[this._id]&&(e=!0,this.dirty(),delete i[this._id])}e&&(this.meshes=this.meshes.filter((e=>t.indexOf(e)<0)))}else{const e=t._scenes;if(!e||!e[this._id])return this;const n=this.meshes.indexOf(t);n>=0&&this.meshes.splice(n,1),delete e[this._id],this.dirty()}return this}getMeshes(){return this.meshes||[]}clear(){if(this.meshes)for(let t=0;t<this.meshes.length;t++)delete this.meshes[t]._scenes[this._id];return this.meshes=[],this.sortedMeshes.opaques=[],this.sortedMeshes.transparents=[],this}dirty(){return this._dirty=!0,this}sortMeshes(t){const e=this.meshes;this.sortFunction&&e.sort(this.sortFunction);let n=this.sortedMeshes.transparents;if(this._dirty){const t=this.sortedMeshes.opaques=[];n=this.sortedMeshes.transparents=[];for(let i=0,r=e.length;i<r;i++)e[i].transparent?n.push(e[i]):t.push(e[i])}t&&n.length>1&&(Z_=t,n.sort(X_)),this._dirty=!1}getSortedMeshes(){return this._dirty&&this.sortMeshes(),this.sortedMeshes||{}}};const J_=String.fromCharCode,K_=8,$_=32767;function tx(t,e,n,i){if(t[3]>0){const r=Math.pow(2,t[3]-128-8+i);e[n+0]=t[0]*r,e[n+1]=t[1]*r,e[n+2]=t[2]*r}else e[n+0]=0,e[n+1]=0,e[n+2]=0;return e[n+3]=1,e}function ex(t,e,n,i){let r=0,o=0,s=i;for(;s>0;)if(t[o][0]=e[n++],t[o][1]=e[n++],t[o][2]=e[n++],t[o][3]=e[n++],1===t[o][0]&&1===t[o][1]&&1===t[o][2]){for(let e=t[o][3]<<r>>>0;e>0;e--)(h=t[o])[0]=(a=t[o-1])[0],h[1]=a[1],h[2]=a[2],h[3]=a[3],o++,s--;r+=8}else o++,s--,r=0;var a,h;return n}function nx(t,e,n,i){if(i<K_|i>$_)return ex(t,e,n,i);let r=e[n++];if(2!==r)return ex(t,e,n-1,i);if(t[0][1]=e[n++],t[0][2]=e[n++],r=e[n++],(t[0][2]<<8>>>0|r)>>>0!==i)return null;for(let o=0;o<4;o++)for(let r=0;r<i;){let i=e[n++];if(i>128){i=(127&i)>>>0;const s=e[n++];for(;i--;)t[r++][o]=s}else for(;i--;)t[r++][o]=e[n++]}return n}function ix(t,e=0){const n=new Uint8Array(t),i=n.length;if("#?"!==function(t){let e="";for(let n=0;n<2;n++)e+=J_(t[n]);return e}(n))return null;for(var r=2;r<i&&("\n"!==J_(n[r])||"\n"!==J_(n[r+1]));r++);if(r>=i)return null;r+=2;let o="";for(;r<i;r++){const t=J_(n[r]);if("\n"===t)break;o+=t}const s=o.split(" "),a=parseInt(s[1]),h=parseInt(s[3]);if(!h||!a)return null;let l=r+1;const u=[];for(let f=0;f<h;f++){u[f]=[];for(let t=0;t<4;t++)u[f][t]=0}const c=new Float32Array(h*a*4);let A=0;for(let f=0;f<a;f++){if(l=nx(u,n,l,h),!l)return null;for(let t=0;t<h;t++)tx(u[t],c,A,e),A+=4}return{width:h,height:a,pixels:c}}const rx=function(){const t=new ArrayBuffer(4),e=new Float32Array(t),n=new Uint32Array(t),i=new Uint32Array(512),r=new Uint32Array(512);for(let h=0;h<256;++h){const t=h-127;t<-27?(i[h]=0,i[256|h]=32768,r[h]=24,r[256|h]=24):t<-14?(i[h]=1024>>-t-14,i[256|h]=1024>>-t-14|32768,r[h]=-t-1,r[256|h]=-t-1):t<=15?(i[h]=t+15<<10,i[256|h]=t+15<<10|32768,r[h]=13,r[256|h]=13):t<128?(i[h]=31744,i[256|h]=64512,r[h]=24,r[256|h]=24):(i[h]=31744,i[256|h]=64512,r[h]=13,r[256|h]=13)}const o=new Uint32Array(2048),s=new Uint32Array(64),a=new Uint32Array(64);for(let h=1;h<1024;++h){let t=h<<13,e=0;for(;!(8388608&t);)t<<=1,e-=8388608;t&=-8388609,e+=947912704,o[h]=t|e}for(let h=1024;h<2048;++h)o[h]=939524096+(h-1024<<13);for(let h=1;h<31;++h)s[h]=h<<23;s[31]=1199570944,s[32]=2147483648;for(let h=33;h<63;++h)s[h]=2147483648+(h-32<<23);s[63]=3347054592;for(let h=1;h<64;++h)32!==h&&(a[h]=1024);return{floatView:e,uint32View:n,baseTable:i,shiftTable:r,mantissaTable:o,exponentTable:s,offsetTable:a}}(),ox=function(t){Math.abs(t)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),t=xv(t,-65504,65504),rx.floatView[0]=t;const e=rx.uint32View[0],n=e>>23&511;return rx.baseTable[n]+((8388607&e)>>rx.shiftTable[n])};let sx=class extends jv{onLoad({data:t}){const e=this.config;if(e){if(e.hdr){if(!(t=ix(t.data,0)))throw new Error("Invalid hdr data"+(e.url?":"+e.url:""));{const n=new Uint16Array(t.pixels.length);for(let e=0;e<t.pixels.length;e++)n[e]=Math.min(ox(t.pixels[e]),65504);e.data=n,e.type="float16",e.colorSpace="browser",e.min="linear",e.mag="linear"}}else e.data=t;e.width=e.width||t.width,e.height=e.height||t.height,this._regl&&this._checkNPOT(this._regl),this._updateREGL()}}createREGLTexture(t){return this._regl=t,this._checkNPOT(t),t.texture(this.config)}_checkNPOT(t){const e=this.config;if(e.data&&this._needPowerOf2(t)&&(e.data instanceof Image?(e.data=Dv(e.data),e.width=e.data.width,e.height=e.data.height):e.hdr||!vv(e.data)||Ov(e.width)&&Ov(e.height)||(e.data=Dv(e.data,e.width,e.height),e.width=e.data.width,e.height=e.data.height)),vv(this.config.data)||vv(this.config.mipmap)){const e=d_(t,this.config);return e[Bv]||(e[Bv]=0),e[Bv]++,e}}},ax=class extends Jv{constructor(t){super({aPosition:new(_v(t=t||0))([-1,-1,t,1,-1,t,-1,1,t,1,1,t]),aNormal:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1])},new Uint16Array([0,1,3,3,2,0]))}};const hx={vsm_shadow_vert:"\nuniform mat4 shadow_lightProjViewModelMatrix;\nvarying vec4 shadow_vLightSpacePos;\nvoid shadow_computeShadowPars(vec4 position) {\n    shadow_vLightSpacePos = shadow_lightProjViewModelMatrix * position;\n}",vsm_shadow_frag:"\nuniform sampler2D shadow_shadowMap;\nuniform float shadow_opacity;\nuniform vec3 shadow_color;\n#if defined(USE_ESM)\n    uniform float esm_shadow_threshold;\n#endif\nvarying vec4 shadow_vLightSpacePos;\n#ifdef PACK_FLOAT\n    #include <common_pack_float>\n#endif\n#if defined(USE_ESM)\nfloat esm(vec3 projCoords, vec4 shadowTexel) {\n    float compare = projCoords.z;\n    float c = 120.0;\n    #ifdef PACK_FLOAT\n        float depth = common_decodeDepth(shadowTexel);\n        if (depth >= 1.0 - 1E-6 || compare <= depth) {\n            return 1.0;\n        }\n    #else\n        float depth = shadowTexel.r;\n    #endif\n    depth = exp(-c * min(compare - depth, 0.05));\n    return clamp(depth, esm_shadow_threshold, 1.0);\n}\n#endif\n#if defined(USE_VSM)\nfloat vsm_shadow_chebyshevUpperBound(vec3 projCoords, vec4 shadowTexel){\n    vec2 moments = shadowTexel.rg;\n    float distance = projCoords.z;\n    if (distance >= 1.0 || distance <= moments.x)\n        return 1.0 ;\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.00002);\n    float d = distance - moments.x;\n    float p_max = variance / (variance + d * d);\n    return p_max;\n}\n#endif\nfloat shadow_computeShadow_coeff(sampler2D shadowMap, vec3 projCoords) {\n    vec2 uv = projCoords.xy;\n    vec4 shadowTexel = texture2D(shadowMap, uv);\n    #if defined(USE_ESM)\n        float esm_coeff = esm(projCoords, shadowTexel);\n        float coeff = esm_coeff * esm_coeff;\n    #endif\n    #if defined(USE_VSM)\n        float vsm_coeff = vsm_shadow_chebyshevUpperBound(projCoords, shadowTexel);\n        float coeff = vsm_coeff;\n    #endif\n    return 1.0 - (1.0 - coeff) * shadow_opacity;\n}\nfloat shadow_computeShadow() {\n    vec3 projCoords = shadow_vLightSpacePos.xyz / shadow_vLightSpacePos.w;\n    projCoords = projCoords * 0.5 + 0.5;\n    if(projCoords.z >= 1.0 || projCoords.x < 0.0 || projCoords.x > 1.0 || projCoords.y < 0.0 || projCoords.y > 1.0) return 1.0;\n    return shadow_computeShadow_coeff(shadow_shadowMap, projCoords);\n}\nvec3 shadow_blend(vec3 color, float coeff) {\n    color = color * coeff + shadow_color * shadow_opacity * (1.0 - coeff);\n    return color;\n}",fbo_picking_vert:"\n#ifdef ENABLE_PICKING\n#if HAS_PICKING_ID == 1\nattribute float aPickingId;\n#elif HAS_PICKING_ID == 2\nuniform float uPickingId;\n#endif\nvarying float vPickingId;\nvarying float vFbo_picking_viewZ;\nvarying float vFbo_picking_visible;\n#endif\nvarying float vFbo_picking_fragDepth;\nvoid fbo_picking_setData(float viewPosZ, bool visible) {\n    #ifdef ENABLE_PICKING\n    #if HAS_PICKING_ID == 1\n       vPickingId = aPickingId;\n    #elif HAS_PICKING_ID == 2\n        vPickingId = uPickingId;\n    #endif\n        vFbo_picking_viewZ = viewPosZ;\n    #endif\n    vFbo_picking_visible = visible ? 1.0 : 0.0;\n    vFbo_picking_fragDepth = viewPosZ + 1.0;\n}",common_pack_float:"const float COMMON_FLOAT_MAX =  1.70141184e38;\nconst float COMMON_FLOAT_MIN = 1.17549435e-38;\nfloat common_packFloat(vec4 val){\n    vec4 scl = floor(255.0 * val + 0.5);\n    float sgn = (scl.a < 128.0) ? 1.0 : -1.0;\n    float exn = mod(scl.a * 2.0, 256.0) + floor(scl.b / 128.0) - 127.0;\n    float man = 1.0 +\n        (scl.r / 8388608.0) +\n        (scl.g / 32768.0) +\n        mod(scl.b, 128.0) / 128.0;\n    return sgn * man * pow(2.0, exn);\n}\nvec4 common_unpackFloat(highp float v) {\n    highp float av = abs(v);\n    if(av < COMMON_FLOAT_MIN) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > COMMON_FLOAT_MAX) {\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n    } else if(v < -COMMON_FLOAT_MAX) {\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n    }\n    highp vec4 c = vec4(0,0,0,0);\n    highp float e = floor(log2(av));\n    highp float m = av * pow(2.0, -e) - 1.0;\n    c[1] = floor(128.0 * m);\n    m -= c[1] / 128.0;\n    c[2] = floor(32768.0 * m);\n    m -= c[2] / 32768.0;\n    c[3] = floor(8388608.0 * m);\n    highp float ebias = e + 127.0;\n    c[0] = floor(ebias / 2.0);\n    ebias -= c[0] * 2.0;\n    c[1] += floor(ebias) * 128.0;\n    c[0] += 128.0 * step(0.0, -v);\n    return c / 255.0;\n}\nvec4 common_encodeDepth(const in float depth) {\n    float alpha = 1.0;\n    vec4 pack = vec4(0.0);\n    pack.a = alpha;\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n    pack.rgb = vec3(code * depth);\n    pack.gb = fract(pack.gb);\n    pack.rg -= pack.gb * (1.0 / 256.0);\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n    return pack;\n}\nfloat common_decodeDepth(const in vec4 pack) {\n    return pack.r + pack.g / 255.0;\n}",invert_matrix:"mat4 invert_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return inverse(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a00 = vector1.x, a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a10 = vector2.x, a11 = vector2.y, a12 = vector2.z, a13 = vector2.w;\n        float a20 = vector3.x, a21 = vector3.y, a22 = vector3.z, a23 = vector3.w;\n        float a30 = vector4.x, a31 = vector4.y, a32 = vector4.z, a33 = vector4.w;\n        float b00 = a00 * a11 - a01 * a10;\n        float b01 = a00 * a12 - a02 * a10;\n        float b02 = a00 * a13 - a03 * a10;\n        float b03 = a01 * a12 - a02 * a11;\n        float b04 = a01 * a13 - a03 * a11;\n        float b05 = a02 * a13 - a03 * a12;\n        float b06 = a20 * a31 - a21 * a30;\n        float b07 = a20 * a32 - a22 * a30;\n        float b08 = a20 * a33 - a23 * a30;\n        float b09 = a21 * a32 - a22 * a31;\n        float b10 = a21 * a33 - a23 * a31;\n        float b11 = a22 * a33 - a23 * a32;\n        float det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        det = 1.0 / det;\n        mat4 m = mat4(\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\n            (a20 * b03 - a21 * b01 + a22 * b00) * det\n        );\n        return m;\n    #endif\n}\nmat4 transpose_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return transpose(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a12 = vector2.z, a13 = vector2.w;\n        float a23 = vector3.w;\n        mat4 m = mat4(\n            vector1.x,\n            vector2.x,\n            vector3.x,\n            vector4.x,\n            a01,\n            vector2.y,\n            vector3.y,\n            vector4.y,\n            a02,\n            a12,\n            vector3.z,\n            vector4.z,\n            a03,\n            a13,\n            a23,\n            vector4.w\n        );\n        return m;\n    #endif\n}",get_output:"#include <invert_matrix>\n#include <draco_decode_vert>\n#ifdef HAS_INSTANCE\n    #include <instance_vert>\n    #ifdef HAS_INSTANCE_COLOR\n        varying vec4 vInstanceColor;\n    #endif\n#endif\n#ifdef HAS_SKIN\n    uniform int skinAnimation;\n    #include <skin_vert>\n#endif\n#include <mask_vert>\n#ifdef HAS_MORPH\n    attribute vec3 POSITION0;\n    attribute vec3 POSITION1;\n    attribute vec3 POSITION2;\n    attribute vec3 POSITION3;\n    attribute vec3 POSITION4;\n    attribute vec3 POSITION5;\n    attribute vec3 POSITION6;\n    attribute vec3 POSITION7;\n    #ifdef HAS_MORPHNORMALS\n        attribute vec3 NORMAL0;\n        attribute vec3 NORMAL1;\n        attribute vec3 NORMAL2;\n        attribute vec3 NORMAL3;\n    #endif\n    uniform vec4 morphWeights1;\n    uniform vec4 morphWeights2;\n#endif\n#ifdef HAS_TERRAIN_ALTITUDE\nattribute float aTerrainAltitude;\n#endif\nmat4 getPositionMatrix() {\n    mat4 worldMatrix;\n    #ifdef HAS_INSTANCE\n        #ifdef HAS_INSTANCE_COLOR\n            vInstanceColor = instance_getInstanceColor();\n        #endif\n        mat4 attributeMatrix = instance_getAttributeMatrix();\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = attributeMatrix * positionMatrix * skin_getSkinMatrix();\n            } else {\n                worldMatrix = attributeMatrix * positionMatrix;\n            }\n        #else\n            worldMatrix = attributeMatrix * positionMatrix;\n        #endif\n    #else\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = skin_getSkinMatrix() * positionMatrix;\n            } else {\n                worldMatrix = positionMatrix;\n            }\n        #else\n            worldMatrix = positionMatrix;\n        #endif\n    #endif\n    return worldMatrix;\n}\n#ifdef HAS_MIN_ALTITUDE\nuniform float minAltitude;\n#endif\nvec4 getPosition(vec3 aPosition) {\n    vec3 position = decode_getPosition(aPosition);\n    #ifdef HAS_MORPH\n        vec4 POSITION = vec4(position + morphWeights1[0] * POSITION0 + morphWeights1[1] * POSITION1 + morphWeights1[2] * POSITION2 + morphWeights1[3] * POSITION3\n        + morphWeights2[0] * POSITION4 + morphWeights2[1] * POSITION5 + morphWeights2[2] * POSITION6 + morphWeights2[3] * POSITION7\n        , 1.0);\n    #else\n        vec4 POSITION = vec4(position, 1.0);\n    #endif\n    #ifdef HAS_TERRAIN_ALTITUDE\n        POSITION.z += aTerrainAltitude * 100.0;\n    #endif\n    #ifdef HAS_MIN_ALTITUDE\n        POSITION.z += minAltitude * 100.0;\n    #endif\n    return POSITION;\n}\nvec3 appendMorphNormal(vec3 NORMAL) {\n    #ifdef HAS_MORPHNORMALS\n        vec3 normal = NORMAL + morphWeights1[0] * NORMAL0 + morphWeights1[1] * NORMAL1 + morphWeights1[2] * NORMAL2 + morphWeights1[3] * NORMAL3;\n    #else\n        vec3 normal = NORMAL;\n    #endif\n    return normal;\n}",instance_vert:"attribute vec4 instance_vectorA;\nattribute vec4 instance_vectorB;\nattribute vec4 instance_vectorC;\n#ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\nattribute float aTerrainAltitude;\nuniform float terrainAltitudeScale;\n#endif\nmat4 instance_getAttributeMatrix() {\n    mat4 mat =  mat4(\n        instance_vectorA.x, instance_vectorB.x, instance_vectorC.x, 0.0,\n        instance_vectorA.y, instance_vectorB.y, instance_vectorC.y, 0.0,\n        instance_vectorA.z, instance_vectorB.z, instance_vectorC.z, 0.0,\n        instance_vectorA.w, instance_vectorB.w, instance_vectorC.w, 1.0\n    );\n    #ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\n        mat4 terrainMat = mat4(\n            1., 0., 0., 0.,\n            0., 1., 0., 0.,\n            0., 0., 1., 0.,\n            0., 0., aTerrainAltitude * terrainAltitudeScale, 1.\n        );\n        mat = terrainMat * mat;\n    #endif\n    return mat;\n}\n#ifdef HAS_INSTANCE_HIGHLIGHT\n    attribute vec4 highlight_color;\n#endif\n#ifdef HAS_INSTANCE_COLOR\n   \n    attribute vec4 instance_color;\n    vec4 instance_getInstanceColor() {\n        vec4 color = instance_color;\n        #ifdef HAS_INSTANCE_HIGHLIGHT\n            color = instance_color * highlight_color;\n        #endif\n        return color;\n    }\n#endif",skin_vert:"attribute vec4 WEIGHTS_0;\nattribute vec4 JOINTS_0;\nuniform sampler2D jointTexture;\nuniform vec2 jointTextureSize;\nuniform float numJoints;\n#define ROW0_U ((0.5 + 0.0) / 4.)\n#define ROW1_U ((0.5 + 1.0) / 4.)\n#define ROW2_U ((0.5 + 2.0) / 4.)\n#define ROW3_U ((0.5 + 3.0) / 4.)\nmat4 skin_getBoneMatrix(float jointNdx) {\n    float v = (jointNdx + 0.5) / numJoints;\n    return mat4(\n        texture2D(jointTexture, vec2(ROW0_U, v)),\n        texture2D(jointTexture, vec2(ROW1_U, v)),\n        texture2D(jointTexture, vec2(ROW2_U, v)),\n        texture2D(jointTexture, vec2(ROW3_U, v)));\n}\nmat4 skin_getSkinMatrix() {\n        mat4 skinMatrix = skin_getBoneMatrix(JOINTS_0[0]) * WEIGHTS_0[0] +\n                        skin_getBoneMatrix(JOINTS_0[1]) * WEIGHTS_0[1] +\n                        skin_getBoneMatrix(JOINTS_0[2]) * WEIGHTS_0[2] +\n                        skin_getBoneMatrix(JOINTS_0[3]) * WEIGHTS_0[3];\n        return skinMatrix;\n}",heatmap_render_vert:"#ifdef HAS_HEATMAP\nvarying vec2 heatmap_vTexCoord;\nvoid heatmap_compute(mat4 matrix, vec3 position) {\n    vec4 pos = matrix * vec4(position.xy, 0., 1.);\n    heatmap_vTexCoord = (1. + pos.xy / pos.w) / 2.;\n}\n#endif",heatmap_render_frag:"#ifdef HAS_HEATMAP\nuniform sampler2D heatmap_inputTexture;\nuniform sampler2D heatmap_colorRamp;\nuniform float heatmap_heatmapOpacity;\nvarying vec2 heatmap_vTexCoord;\nvec4 heatmap_getColor(vec4 color) {\n    float t = texture2D(heatmap_inputTexture, heatmap_vTexCoord).r;\n    vec4 heatmapColor = texture2D(heatmap_colorRamp, vec2(t, 0.5)) * heatmap_heatmapOpacity;\n    return color * (1.0 - heatmapColor.a) + heatmapColor * heatmapColor.a;\n}\n#endif",line_extrusion_vert:"#ifdef IS_LINE_EXTRUSION\n    #define ALTITUDE_SCALE 32767.0;\n    #define EXTRUDE_SCALE 63.0;\n    attribute vec2 aExtrude;\n    #ifdef HAS_LINE_WIDTH\n        attribute float aLineWidth;\n    #else\n        uniform float lineWidth;\n    #endif\n    #ifdef HAS_LINE_HEIGHT\n        attribute float aLineHeight;\n    #else\n        uniform float lineHeight;\n    #endif\n    uniform float linePixelScale;\n    vec3 getLineExtrudePosition(vec3 position) {\n        #ifdef HAS_LINE_WIDTH\n            float lineWidth = aLineWidth / 2.0;\n        #endif\n        #ifdef HAS_LINE_HEIGHT\n            float lineHeight = aLineHeight / 10.0;\n        #endif\n        float halfwidth = lineWidth / 2.0;\n        float outset = halfwidth;\n        vec2 dist = outset * aExtrude / EXTRUDE_SCALE;\n        position.z *= lineHeight / ALTITUDE_SCALE;\n        return position + vec3(dist, 0.0) * linePixelScale;\n    }\n#endif",gl2_vert:"#if __VERSION__ == 300\n    #define texture2D texture\n    #define varying out\n    #define attribute in\n#endif",gl2_frag:"#if __VERSION__ == 300\n    #define varying in\n    #define gl_FragDepthEXT gl_FragDepth\n    #define texture2D texture\n    #define textureCube texture\n    #define texture2DProj textureProj\n    #define texture2DLodEXT textureLod\n    #define texture2DProjLodEXT textureProjLod\n    #define textureCubeLodEXT textureLod\n    #define texture2DGradEXT textureGrad\n    #define texture2DProjGradEXT textureProjGrad\n    #define textureCubeGradEXT textureGrad\n    #define texture2D texture\n    out vec4 glFragColor;\n#else\n    vec4 glFragColor;\n#endif",hsv_frag:"\nconst mediump vec4 HSV_K0 = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nconst mediump vec4 HSV_K1 = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nconst mediump float HSV_E = 1.0e-10;\nvec3 hsv_rgb2hsv(vec3 c) {\n    vec4 K = HSV_K0;\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n    float d = q.x - min(q.w, q.y);\n    float e = HSV_E;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv_hsv2rgb(vec3 c) {\n    vec4 K = HSV_K1;\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 hsv_apply(vec4 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return vec4(hsv_hsv2rgb(hsv), c.a);\n}\nvec3 hsv_apply(vec3 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return hsv_hsv2rgb(hsv);\n}\nmat4 contrastMatrix(float contrast)\n{\n    float t = (1.0 - contrast) / 2.0;\n    return mat4(\n        contrast, 0., 0., 0.,\n        0., contrast, 0., 0.,\n        0., 0., contrast, 0.,\n        t, t, t, 1\n    );\n}",snow_frag:"#ifdef HAS_SNOW\n    float lerp(float a, float b, float w) {\n        return a + w * (b - a);\n    }\n    vec3 snow(vec4 sceneColor, vec3 normalColor, float height) {\n        float snowIntense = normalColor.b;\n        vec3 fixedC = vec3(1.0, 1.0, 1.0);\n        if (height < 1.0) {\n            float r = lerp(0.5, fixedC.x, snowIntense);\n            float g = lerp(0.5, fixedC.y, snowIntense);\n            float b = lerp(0.5, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        } else {\n            float r = lerp(sceneColor.r, fixedC.x, snowIntense);\n            float g = lerp(sceneColor.g, fixedC.y, snowIntense);\n            float b = lerp(sceneColor.b, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        }\n    }\n#endif",draco_decode_vert:"#if defined(HAS_TANGENT)\n    attribute vec4 aTangent;\n#elif defined(HAS_NORMAL)\n    #ifdef HAS_DRACO_NORMAL\n        attribute vec2 aNormal;\n        uniform float gltf_u_dec_normal_rangeConstant;\n    #else\n        attribute vec3 aNormal;\n    #endif\n#endif\n#ifdef HAS_DRACO_POSITION\n    uniform float gltf_u_dec_position_normConstant;\n    uniform vec3 minValues_pos;\n    vec3 decodeDracoPosition(vec3 aPosition) {\n        return minValues_pos + aPosition * gltf_u_dec_position_normConstant;\n    }\n#endif\n#ifdef HAS_DRACO_TEXCOORD\n    uniform vec2 minValues_tex;\n    uniform float gltf_u_dec_texcoord_0_normConstant;\n    vec2 decodeDracoTexcoord(vec2 aTexCoord) {\n        return minValues_tex + aTexCoord * gltf_u_dec_texcoord_0_normConstant;\n    }\n#endif\n#ifdef HAS_WEB3D_quantized_attributes_TEXCOORD\n    uniform mat3 decodeMatrix;\n#endif\n#ifdef HAS_DRACO_NORMAL\n    float czm_signNotZero(float value) {\n        return value >= 0.0 ? 1.0 : -1.0;\n    }\n    vec2 czm_signNotZero(vec2 value) {\n        return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n    }\n    vec3 decodeDracoNormal(vec2 encoded, float range)\n    {\n        if (encoded.x == 0.0 && encoded.y == 0.0) {\n            return vec3(0.0, 0.0, 0.0);\n        }\n        encoded = encoded / range * 2.0 - 1.0;\n        vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n        if (v.z < 0.0) {\n            v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n        }\n        return normalize(v);\n    }\n    vec3 decode_getNormal(vec2 aNormal) {\n        return decodeDracoNormal(aNormal, gltf_u_dec_normal_rangeConstant).zxy;\n    }\n#endif\n#ifdef HAS_COMPRESSED_INT16\n    #ifdef HAS_COMPRESSED_INT16_POSITION\n      uniform vec2 compressedPositionRange;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_0\n      uniform vec2 compressedTexcoordRange_0;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_1\n      uniform vec2 compressedTexcoordRange_1;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\n      uniform vec2 compressedNormalRange;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_RATIO\n      uniform float compressed_ratio;\n    #endif\n    float int16ToFloat32(float value, vec2 range) {\n        float v = (value >= 32768.0) ? -(65536.0 - value) / 32768.0 : value / 32767.0;\n        return (v + 1.0) * (range.y - range.x) / 2.0 + range.x;\n    }\n#endif\nvec3 decode_getPosition(vec3 aPosition) {\n    vec3 position = aPosition;\n    #if defined(HAS_COMPRESSED_INT16) && defined(HAS_COMPRESSED_INT16_POSITION)\n        float x = int16ToFloat32(aPosition.x, compressedPositionRange);\n        float y = int16ToFloat32(aPosition.y, compressedPositionRange);\n        float z = int16ToFloat32(aPosition.z, compressedPositionRange);\n        #ifdef HAS_COMPRESSED_INT16_RATIO\n          position = vec3(x / compressed_ratio, y / compressed_ratio, z);\n        #else\n          position = vec3(x, y, z);\n        #endif\n    #endif\n    #ifdef HAS_DRACO_POSITION\n        return decodeDracoPosition(position);\n    #else\n        return position;\n    #endif\n}\nvec2 decode_getTexcoord(vec2 aTexCoord) {\n    vec2 texcoord = aTexCoord;\n    #if defined(HAS_COMPRESSED_INT16) && (defined(HAS_COMPRESSED_INT16_TEXCOORD_0) || defined(HAS_COMPRESSED_INT16_TEXCOORD_1))\n        float x = int16ToFloat32(aTexCoord.x, compressedTexcoordRange_0);\n        float y = int16ToFloat32(aTexCoord.y, compressedTexcoordRange_0);\n        texcoord = vec2(x, y);\n    #endif\n    #ifdef HAS_DRACO_TEXCOORD\n        return decodeDracoTexcoord(texcoord);\n    #elif defined(HAS_WEB3D_quantized_attributes_TEXCOORD)\n        vec3 web3dTexcoord = decodeMatrix * vec3(texcoord, 1.0);\n        return vec2(web3dTexcoord.x, web3dTexcoord.y);\n    #else\n        return texcoord;\n    #endif\n}\nvec3 decode_getNormal(vec3 aNormal) {\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\n        aNormal.x = int16ToFloat32(aNormal.x, compressedNormalRange);\n        aNormal.y = int16ToFloat32(aNormal.y, compressedNormalRange);\n        aNormal.z = int16ToFloat32(aNormal.z, compressedNormalRange);\n    #endif\n    return aNormal;\n}",highlight_vert:"#if defined(HAS_HIGHLIGHT_COLOR)\n    attribute vec4 aHighlightColor;\n    varying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    attribute float aHighlightOpacity;\n    varying float vHighlightOpacity;\n#endif\nvoid highlight_setVarying() {\n    #if defined(HAS_HIGHLIGHT_COLOR)\n        vHighlightColor = aHighlightColor / 255.0;\n    #endif\n    #if defined(HAS_HIGHLIGHT_OPACITY)\n        vHighlightOpacity = aHighlightOpacity / 255.0;\n    #endif\n}",highlight_frag:"#if defined(HAS_HIGHLIGHT_COLOR)\n\tvarying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    varying float vHighlightOpacity;\n#endif\nvec4 highlight_blendColor(vec4 color) {\n\tvec4 outColor;\n\t#if defined(HAS_HIGHLIGHT_COLOR)\n\t\tcolor.rgb = color.rgb * (1.0 - vHighlightColor.a) + vHighlightColor.rgb * vHighlightColor.a;\n\t\t#ifndef HAS_HIGHLIGHT_COLOR_POINT\n        \tcolor.a = color.a * (1.0 - vHighlightColor.a) + vHighlightColor.a;\n        #endif\n        outColor = color;\n\t#else\n\t\toutColor = color;\n\t#endif\n\t#if defined(HAS_HIGHLIGHT_OPACITY)\n\t\toutColor *= vHighlightOpacity;\n\t#endif\n\treturn outColor;\n}",mask_vert:"#ifdef HAS_MASK_EXTENT\n    uniform vec4 mask_extent;\n    uniform sampler2D mask_colorExtent;\n    uniform sampler2D mask_modeExtent;\n    uniform float mask_maskMode;\n    uniform float mask_hasFlatOut;\n    uniform mat4 viewMatrix;\n    uniform float mask_heightRatio;\n    uniform float mask_heightOffset;\n    varying vec4 vWorldPosition;\n    varying vec2 vUVInExtent;\n    varying float vHeightRatio;\n    varying float vHeightOffset;\n    const float CLIPINSIDE_MODE = 0.2;\n    const float FLATINSIDE_MODE = 0.3;\n    const float FLATOUTSIDE_MODE = 0.4;\n    const float ELEVATE_MODE = 0.7;\n    float random (vec2 st) {\n        return fract(sin(dot(st.xy,vec2(12.9898,78.233)))*43758.5453123) * 0.1;\n    }\n    bool isInExtent(vec4 color) {\n        return length(color.rgb) > 0.0;\n    }\n    float getFlatHeight(float maskMode, float flatHeight, float height) {\n      if (maskMode <= ELEVATE_MODE && maskMode > 0.6) {\n          return flatHeight + height;\n      } else {\n        return flatHeight;\n      }\n    }\n    vec4 getNoErrorPosition(vec4 position, vec4 wPosition) {\n      vec4 realPos = modelViewMatrix * position;      vec4 pos = viewMatrix * wPosition;      vec4 tempPos = viewMatrix * modelMatrix * position;      float deltaX = realPos.x - tempPos.x;\n      float deltaY = realPos.y - tempPos.y;\n      float deltaZ = realPos.z - tempPos.z;\n      pos.x = pos.x + deltaX;\n      pos.y = pos.y + deltaY;\n      pos.z = pos.z + deltaZ;\n      return pos;\n    }\n    vec4 getMaskPosition(vec4 position, mat4 modelMatrix) {\n        vWorldPosition = modelMatrix * position;\n        float w = mask_extent.z - mask_extent.x;\n        float h = mask_extent.y - mask_extent.w;\n        vec2 uvInExtent = vec2((vWorldPosition.x - mask_extent.x) / abs(w), 1.0 - (vWorldPosition.y - mask_extent.w) / h);\n        vec4 extentColor = texture2D(mask_colorExtent, uvInExtent);\n        vec3 maskOptionColor = texture2D(mask_modeExtent, uvInExtent).rgb;\n        float maskMode = maskOptionColor.r;\n        float flatHeight = maskOptionColor.g / mask_heightRatio + mask_heightOffset;\n        float height = getFlatHeight(maskMode, flatHeight, vWorldPosition.z);\n        vec4 wPosition = vec4(vWorldPosition.x, vWorldPosition.y, height, vWorldPosition.w);\n        vUVInExtent = uvInExtent;\n        vHeightRatio = mask_heightRatio;\n        vHeightOffset = mask_heightOffset;\n        if (maskMode <= FLATOUTSIDE_MODE && maskMode > FLATINSIDE_MODE) {\n            return modelViewMatrix * position;;\n        } else if (mask_hasFlatOut == 1.0) {\n            return getNoErrorPosition(position, wPosition);\n        }\n        if (isInExtent(extentColor) == true && maskMode <= FLATINSIDE_MODE && maskMode > CLIPINSIDE_MODE) {\n            return getNoErrorPosition(position, wPosition);\n        } if (isInExtent(extentColor) == true && maskMode <= ELEVATE_MODE && maskMode > 0.6) {\n            return getNoErrorPosition(position, wPosition);\n        } else {\n            return modelViewMatrix * position;\n        }\n    }\n#endif",mask_frag:"#ifdef HAS_MASK_EXTENT\n    uniform sampler2D mask_colorExtent;\n    uniform sampler2D mask_modeExtent;\n    uniform float mask_hasClipOut;\n    varying float vHeightRatio;\n    varying float vHeightOffset;\n    varying vec2 vUVInExtent;\n    varying vec4 vWorldPosition;\n    const float CLIPINSIDE_MODE = 0.1;\n    const float CLIPOUTSIDE_MODE = 0.2;\n    const float FLATINSIDE_MODE = 0.3;\n    const float FLATOUTSIDE_MODE = 0.4;\n    const float COLOR_MODE = 0.5;\n    const float VIDEO_MODE = 0.6;\n    bool isInExtent(vec4 color) {\n        return length(color.rgb) > 0.0;\n    }\n    vec4 setMask(vec4 glFragColor) {\n        vec4 extentColor = texture2D(mask_colorExtent, vUVInExtent);\n        vec4 modeColor = texture2D(mask_modeExtent, vUVInExtent);\n        float maskMode = modeColor.r;\n        float minHeight = modeColor.b / vHeightRatio + vHeightOffset;\n        float maxHeight = modeColor.a / vHeightRatio + vHeightOffset;\n        if (maskMode > CLIPINSIDE_MODE && maskMode <= CLIPOUTSIDE_MODE) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                return glFragColor;\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                return glFragColor;\n            } else {\n              discard;\n            }\n        } else if (mask_hasClipOut == 1.0) {\n            discard;\n        }\n        if (isInExtent(extentColor) == true && maskMode <= CLIPINSIDE_MODE && maskMode > 0.0) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                discard;\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                discard;\n            } else {\n              return glFragColor;\n            }\n        } else if (isInExtent(extentColor) == true && maskMode <= VIDEO_MODE && maskMode > FLATOUTSIDE_MODE) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\n            }\n        }\n        return glFragColor;\n    }\n#endif",computeTexcoord_frag:"#ifdef HAS_KHR_TEXTURE_TRANSFORM\n    uniform vec2 khr_offset;\n    uniform float khr_rotation;\n    uniform vec2 khr_scale;\n    vec2 khr_tex_transformTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) {\n        rotation = -rotation;\n        mat3 transform = mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, offset.x, offset.y, 1.0);\n        vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy;\n        return transformedTexCoords;\n    }\n#endif\nvarying highp vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\n    varying vec4 vUvRegion;\n#endif\nvec2 computeTexCoord(vec2 texCoord) {\n    #ifdef HAS_I3S_UVREGION\n        vec2 atlasScale = vUvRegion.zw - vUvRegion.xy;\n        vec2 uvAtlas = fract(texCoord) * atlasScale + vUvRegion.xy;\n        return uvAtlas;\n    #elif defined(HAS_KHR_TEXTURE_TRANSFORM)\n        return khr_tex_transformTexCoord(texCoord, khr_offset, khr_rotation, khr_scale);\n    #else\n        return texCoord;\n    #endif\n}",terrain_normal_frag:"#ifdef HAS_TERRAIN_NORMAL\n    uniform sampler2D terrainHeightTexture;\n    uniform vec2 terrainHeightMapResolution;\n    uniform vec2 terrainResolution;\n    uniform float terrainHeightScale;\n    uniform float terrainTileResolution;\n    uniform vec4 terrainUnpackFactors;\n    float getHeight(vec2 uv) {\n        vec4 color = texture2D(terrainHeightTexture, uv) * 255.0;\n        color.a = -1.0;\n        return dot(color, terrainUnpackFactors) / 4.0;\n    }\n    vec3 convertTerrainHeightToNormalMap(vec2 uv) {\n        uv.y = 1.0 - uv.y;\n        vec2 epsilon = 1.0 / terrainHeightMapResolution;\n        float a = getHeight(uv + vec2(-epsilon.x, -epsilon.y));\n        float b = getHeight(uv + vec2(0, -epsilon.y));\n        float c = getHeight(uv + vec2(epsilon.x, -epsilon.y));\n        float d = getHeight(uv + vec2(-epsilon.x, 0));\n        float e = getHeight(uv + vec2(epsilon.x, 0));\n        float f = getHeight(uv + vec2(-epsilon.x, epsilon.y));\n        float g = getHeight(uv + vec2(0, epsilon.y));\n        float h = getHeight(uv + vec2(epsilon.x, epsilon.y));\n        vec2 dxy = vec2(\n            (c + e + e + h) - (a + d + d + f),\n            (f + g + g + h) - (a + b + b + c)\n        );\n        return normalize(vec3(dxy / epsilon, terrainResolution ));\n    }\n#endif",vertex_color_vert:"#ifdef HAS_VERTEX_COLOR\nattribute float aVertexColorType;\nuniform vec4 vertexColorsOfType[VERTEX_TYPES_COUNT];\nvarying vec4 vertexColor_color;\nvoid vertexColor_update() {\n    vertexColor_color = vertexColorsOfType[int(aVertexColorType)];\n}\n#endif",vertex_color_frag:"#ifdef HAS_VERTEX_COLOR\nvarying vec4 vertexColor_color;\nvec4 vertexColor_get() {\n\treturn vertexColor_color;\n}\n#endif",excavate_vert:"#ifdef HAS_EXCAVATE_ANALYSIS\n  uniform vec4 excavateExtent;\n  varying vec2 vCoordinateTexcoord;\n  varying float vHeight;\n  float getWorldHeight() {\n    vec4 wPosition = modelMatrix * getPosition(aPosition);\n    return wPosition.z;\n  }\n  vec2 getCoordinateTexcoord() {\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec4 wPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n    float x = (wPosition.x - excavateExtent.x) / (excavateExtent.z - excavateExtent.x);\n    float y = (wPosition.y - excavateExtent.y) / (excavateExtent.w - excavateExtent.y);\n    return vec2(x, y);\n  }\n#endif",excavate_frag:"#ifdef HAS_EXCAVATE_ANALYSIS\n  uniform sampler2D heightmap;\n  uniform float excavateHeight;\n  varying vec2 vCoordinateTexcoord;\n  varying float vHeight;\n  const vec2 range = vec2(-100.0, 1000.0);\n  float decodeHeight(const in vec4 pack) {\n      return pack.r + pack.g / 255.0;\n  }\n  vec4 excavateColor(vec4 fragColor) {\n      float samplerHeight = decodeHeight(texture2D(heightmap, vCoordinateTexcoord));\n      float realHeight = samplerHeight * (range.y - range.x) + range.x;\n      if(realHeight < range.x || realHeight > range.y) {\n          realHeight = 0.0;\n      }\n      if(vHeight > realHeight) {\n          discard;\n      }\n      return fragColor;\n  }\n#endif",srgb_frag:"vec3 linearTosRGB(const in vec3 color) {\n    return vec3( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055);\n}\nvec3 sRGBToLinear(const in vec3 color) {\n    return vec3( color.r < 0.04045 ? color.r * (1.0 / 12.92) : pow((color.r + 0.055) * (1.0 / 1.055), 2.4), color.g < 0.04045 ? color.g * (1.0 / 12.92) : pow((color.g + 0.055) * (1.0 / 1.055), 2.4), color.b < 0.04045 ? color.b * (1.0 / 12.92) : pow((color.b + 0.055) * (1.0 / 1.055), 2.4));\n}"};var lx={register(t,e){if(hx[t])throw new Error(`Key of ${t} is already registered in ShaderLib.`);hx[t]=e},compile:t=>cx(t)};const ux=/^[ \t]*#include +<([\w\d.]+)>/gm;function cx(t){return t.replace(ux,Ax)}function Ax(t,e){const n=hx[e];if(!n)throw new Error("Can not resolve #include <"+e+">");return cx(n)}let fx=0;const dx={};let px=class{constructor({vert:t,frag:e,uniforms:n,defines:i,extraCommandProps:r}){this.vert=t,this.frag=e;const o=fx++;Object.defineProperty(this,"uid",{enumerable:!0,configurable:!1,get:()=>o}),this.shaderDefines=i&&pv({},i)||{},n=this.uniforms=(n||[]).slice(),this.contextDesc={};for(let s=0,a=n.length;s<a;s++){const t=n[s];if(cv(t))if(t.indexOf("[")>0){const{name:e,len:n}=gx(t);this.contextDesc[e]={name:e,type:"array",length:n}}else this.contextDesc[t]=null;else if(t.name.indexOf("[")>0){const{name:e,len:n}=gx(t.name);this.contextDesc[e]={name:e,type:"array",length:n,fn:t.fn}}else this.contextDesc[t.name]=t}this.extraCommandProps=r&&pv({},r)||{},this.commands={},this._compileSource()}set shaderDefines(t){this._shaderDefines=t,this.dkey=Object.keys(this._shaderDefines).join()}get shaderDefines(){return this._shaderDefines||{}}setDefines(t){this.shaderDefines=t}setFramebuffer(t){return this.context.framebuffer=t,this}appendDescUniforms(t,e){const n=e,i=this.contextDesc;for(const r in i)if(i[r])if("array"===i[r].type){const o=r,s=i[r].length;let a=e[r];if(i[r].fn&&(a=i[r].fn(null,e)),!a)continue;if(a.length!==s)throw new Error(`${o} uniform's length is not ${s}`);n[o]=n[o]||{};for(let e=0;e<s;e++)n[o][`${e}`]=a[e].getREGLTexture?a[e].getREGLTexture(t):a[e]}else"function"===i[r].type&&(Object.getOwnPropertyDescriptor(n,r)||Object.defineProperty(n,r,{configurable:!1,enumerable:!0,get:function(){return i[r].fn(null,e)}}));return n}setUniforms(t){if(t.modelMatrix||t.positionMatrix)throw new Error("modelMatrix or positionMatrix is reserved uniform name for Mesh, please change to another name");return this.contextKeys=t?Object.keys(t).join():null,this.context=t,this}getVersion(t,e){return"#version"===e.substring(0,8)?"":0===t.limits.version.indexOf("WebGL 2.0")&&300===this.version?"#version 300 es\n":"#version 100\n"}getActiveVars(t,e,n,i){const r=i;if(dx[r])return dx[r];const o=t._gl,s=o.createProgram(),a=o.createShader(35633);o.shaderSource(a,e),o.compileShader(a);const h=o.createShader(35632);o.shaderSource(h,n),o.compileShader(h),o.attachShader(s,h),o.attachShader(s,a),o.linkProgram(s);const l=o.getProgramParameter(s,35721),u=[];for(let f=0;f<l;++f){const t=o.getActiveAttrib(s,f);t&&u.push({name:t.name,type:t.type})}const c=o.getProgramParameter(s,35718),A=[];for(let f=0;f<c;++f){const t=o.getActiveUniform(s,f);let e=t.name;t.name.indexOf("[")>0&&(e=e.replace("[0]","")),A.push(e)}return o.deleteProgram(s),o.deleteShader(a),o.deleteShader(h),dx[r]={activeUniforms:A,activeAttributes:u},dx[r]}createREGLCommand(t,e,n,i,r,o={}){const s=bv(t)&&!r,a=pv({},this.shaderDefines||{},e||{}),h=this._insertDefines(this.vert,a),l=this.getVersion(t,h)+h,u=this._insertDefines(this.frag,a),c=this.getVersion(t,u)+u,A=Ev(l)+"_"+Ev(c),{activeAttributes:f,activeUniforms:d}=this.getActiveVars(t,l,c,A),p={};f.forEach(((e,n)=>{const i=e.name;p[i]=s?n:t.prop(i)}));const g={};d.forEach((e=>{g[e]=t.prop(e)}));const m=this.contextDesc;for(const _ in m)if(m[_]&&"function"===m[_].type)g[_]=m[_].fn;else if(m[_]&&"array"===m[_].type){const e=m[_].name,n=m[_].length;for(let i=0;i<n;i++){const n=`${e}[${i}]`;g[n]=t.prop(n)}}else g[_]=t.prop(_);const y={vert:l,frag:c,uniforms:g,attributes:p};s&&(y.vao=t.prop("vao")),s&&!i||!n||mv(n)||(y.elements=t.prop("elements")),y.count=t.prop("count"),y.offset=t.prop("offset"),y.primitive=t.prop("primitive"),y.framebuffer=t.prop("framebuffer"),i&&(y.instances=t.prop("instances")),pv(y,this.extraCommandProps,o);const v=t(y);return f.key=f.map((t=>t.name)).join(),v.activeAttributes=f,v}dispose(){for(const t in this.commands){const e=this.commands[t];e&&e.destroy&&!e[Nv]&&(e[Nv]=!0,e.destroy())}this.commands={},delete this.vert,delete this.frag}_insertDefines(t,e){const n=[];for(const i in e)wv(e,i)&&!dv(e[i])&&n.push(`#define ${i} ${e[i]}\n`);return n.join("")+t}_compileSource(){this.vert=lx.compile(this.vert),this.frag=lx.compile(this.frag)}};function gx(t){const e=t.indexOf("["),n=t.indexOf("]");return{name:t.substring(0,e),len:+t.substring(e+1,n)}}let mx=class extends px{draw(t,e){if(!e||!e.length)return 0;const n=[];let i,r=0;for(let o=0,s=e.length;o<s;o++){if(!e[o].isValid()){o===s-1&&i&&n.length&&i(n);continue}if(!e[o].geometry.getDrawCount()||!this._runFilter(e[o])){o===s-1&&i&&n.length&&i(n);continue}const a=this.getMeshCommand(t,e[o]);n.length&&i!==a&&(i(n),n.length=0);const h=e[o].getREGLProps(t,a.activeAttributes);this._ensureContextDefines(h),h.shaderContext=this.context,this.appendDescUniforms(t,h),n.push(h),r++,o<s-1?i=a:o===s-1&&a(n)}return r}_ensureContextDefines(t){if(this.context&&(t.contextKeys||(t.contextKeys={}),t.contextKeys[this.uid]!==this.contextKeys)){for(const e in this.context)"framebuffer"===e||Object.getOwnPropertyDescriptor(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:function(){return this.shaderContext[e]}});Object.getOwnPropertyDescriptor(t,"framebuffer")||Object.defineProperty(t,"framebuffer",{configurable:!1,enumerable:!0,get:function(){return this.targetFramebuffer||this.shaderContext&&this.shaderContext.framebuffer}}),t.contextKeys[this.uid]=this.contextKeys}}_runFilter(t){const e=this.filter;if(!e)return!0;if(Array.isArray(e)){for(let n=0;n<e.length;n++)if(!e[n](t))return!1;return!0}return e(t)}getMeshCommand(t,e){this._cmdKeys||(this._cmdKeys={});const n=this.dkey||"default";let i=this._cmdKeys[n];i||(i=this._cmdKeys[n]={});const r=e.getCommandKey(t);i[r]||(i[r]=n+"_"+e.getCommandKey(t));const o=i[r];let s=this.commands[o];if(!s){const n=e.getDefines(),i=e.getMaterial(),r={};i&&i.doubleSided&&this.extraCommandProps&&(r.cull={enable:!1}),s=this.commands[o]=this.createREGLCommand(t,n,e.getElements(),e instanceof B_,e.disableVAO,r)}return s}},yx=class extends mx{constructor(t={}){const e=[],n=[],i=t.uniforms,r=[{name:"modelNormalMatrix",type:"function",fn:function(t,n){return Mp(e,n.modelMatrix)}},{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp(n,e.viewMatrix,e.modelMatrix)}}];i&&r.push(...i),super({vert:t.vert||"#include <gl2_vert>\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\n#ifdef HAS_MAP\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#if defined(HAS_AO_MAP)\nattribute vec2 aTexCoord1;\nvarying vec2 vTexCoord1;\n#endif\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\n#else\nattribute vec4 aColor0;\n#endif\nvarying vec4 vColor;\n#endif\nvarying vec3 vFragPos;\nvarying vec3 vNormal;\nuniform mat4 projMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\nuniform mat4 projViewMatrix;\n#include <highlight_vert>\n#include <get_output>\n#include <heatmap_render_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nattribute float aExtrusionOpacity;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_TANGENT)\nvarying vec4 vTangent;\n#endif\nvoid c(const highp vec4 q, out highp vec3 d) {\n  d = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid c(const highp vec4 q, out highp vec3 d, out highp vec3 t) {\n  c(q, d);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nvoid main() {\n  \n#ifdef IS_LINE_EXTRUSION\nvec4 e = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 e = getPosition(aPosition);\n#endif\nmat4 f = getPositionMatrix();\n  vFragPos = vec3(modelMatrix * f * e);\n#if defined(HAS_NORMAL) || defined(HAS_TANGENT)\nmat3 h = modelNormalMatrix * mat3(f);\n  vec3 i;\n#if defined(HAS_TANGENT)\nvec3 t;\n  c(aTangent, i, t);\n  vTangent = vec4(h * t, aTangent.w);\n#else\ni = decode_getNormal(aNormal);\n#endif\nvec3 j = appendMorphNormal(i);\n  vNormal = normalize(h * j);\n#else\nvNormal = vec3(.0);\n#endif\nmat4 k = projMatrix;\n  k[2].xy += halton.xy / outSize.xy;\n#ifdef HAS_MASK_EXTENT\ngl_Position = k * getMaskPosition(f * e, modelMatrix);\n#else\ngl_Position = k * modelViewMatrix * f * e;\n#endif\n#ifdef HAS_MAP\nvec2 l = decode_getTexcoord(aTexCoord);\n  vTexCoord = l * uvScale + uvOffset;\n#endif\n#ifdef HAS_AO_MAP\nvec2 m = decode_getTexcoord(aTexCoord1);\n  vTexCoord1 = m * uvScale + uvOffset;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nvExtrusionOpacity = aExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvColor = vec4(aColor0 / 255., 1.);\n#else\nvColor = aColor0 / 255.;\n#endif\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(f * e);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * f, e);\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\nhighlight_setVarying();\n}",frag:t.frag||"precision mediump float;\n#include <gl2_frag>\nuniform vec4 baseColorFactor;\nuniform float materialShininess;\nuniform float environmentExposure;\nuniform float specularStrength;\nuniform vec3 light0_viewDirection;\nuniform vec3 ambientColor;\nuniform vec4 light0_diffuse;\nuniform vec3 lightSpecular;\nuniform vec3 cameraPosition;\nuniform float alphaTest;\n#ifdef HAS_TOON\nuniform float toons;\nuniform float specularToons;\n#endif\n#ifdef HAS_TANGENT\nvarying vec4 vTangent;\n#endif\n#ifdef HAS_MAP\n#include <computeTexcoord_frag>\n#endif\nvarying vec3 vNormal;\nvarying vec3 vFragPos;\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef HAS_BASECOLOR_MAP\nuniform sampler2D baseColorTexture;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nuniform vec2 extrusionOpacityRange;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef HAS_LAYER_OPACITY\nuniform float layerOpacity;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_AO_MAP\nuniform sampler2D occlusionTexture;\nvarying vec2 vTexCoord1;\n#endif\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D normalTexture;\n#endif\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D emissiveTexture;\n#endif\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D diffuseTexture;\n#endif\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\n#include <heatmap_render_frag>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#include <mask_frag>\nvec3 c() {\n  \n#if defined(HAS_NORMAL_MAP)\nvec3 d = normalize(vNormal);\n  vec3 e = texture2D(normalTexture, computeTexCoord(vTexCoord)).xyz * 2. - 1.;\n#if defined(HAS_TANGENT)\nvec3 t = normalize(vTangent.xyz);\n  vec3 b = normalize(cross(d, t) * sign(vTangent.w));\n  mat3 f = mat3(t, b, d);\n  return normalize(f * e);\n#else\nreturn normalize(e);\n#endif\n#else\nreturn normalize(vNormal);\n#endif\n}\nvec4 h(const in vec4 i) {\n  return vec4(i.r < .0031308 ? i.r * 12.92 : 1.055 * pow(i.r, 1. / 2.4) - .055, i.g < .0031308 ? i.g * 12.92 : 1.055 * pow(i.g, 1. / 2.4) - .055, i.b < .0031308 ? i.b * 12.92 : 1.055 * pow(i.b, 1. / 2.4) - .055, i.a);\n}\nvec4 j() {\n  \n#if defined(HAS_BASECOLOR_MAP)\nreturn texture2D(baseColorTexture, computeTexCoord(vTexCoord));\n#elif defined(HAS_DIFFUSE_MAP)\nreturn texture2D(diffuseTexture, computeTexCoord(vTexCoord));\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn diffuseFactor;\n#else\nreturn baseColorFactor;\n#endif\n}\nvec3 k() {\n  \n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nreturn texture2D(specularGlossinessTexture, computeTexCoord(vTexCoord)).rgb;\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn specularFactor;\n#else\nreturn vec3(1.);\n#endif\n}\nvoid main() {\n  vec4 l = j();\n  vec3 m = environmentExposure * ambientColor * l.rgb;\n#ifdef HAS_INSTANCE_COLOR\nm *= vInstanceColor.rgb;\n#endif\nvec3 o = c();\n  vec3 u = normalize(-light0_viewDirection);\n  float v = max(dot(o, u), .0);\n#ifdef HAS_TOON\nfloat A = floor(v * toons);\n  v = A / toons;\n#endif\nvec3 B = light0_diffuse.rgb * v * l.rgb;\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvec3 i = vColor.rgb;\n#elif defined(IS_LINE_EXTRUSION)\nvec3 i = lineColor.rgb;\n#else\nvec3 i = polygonFill.rgb;\n#endif\n#ifdef HAS_INSTANCE_COLOR\ni *= vInstanceColor.rgb;\n#endif\nm *= i.rgb;\n  B *= i.rgb;\n  vec3 C = normalize(cameraPosition - vFragPos);\n  vec3 D = normalize(u + C);\n  float E = pow(max(dot(o, D), .0), materialShininess);\n#ifdef HAS_TOON\nfloat F = floor(E * specularToons);\n  E = F / specularToons;\n#endif\nvec3 G = specularStrength * lightSpecular * E * k();\n#ifdef HAS_OCCLUSION_MAP\nfloat H = texture2D(occlusionTexture, computeTexCoord(vTexCoord1)).r;\n  m *= H;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat I = shadow_computeShadow();\n  B = shadow_blend(B, I).rgb;\n  G = shadow_blend(G, I).rgb;\n  m = shadow_blend(m, I).rgb;\n#endif\nvec3 J = m + B + G;\n#ifdef HAS_EMISSIVE_MAP\nvec3 K = texture2D(emissiveTexture, computeTexCoord(vTexCoord)).rgb;\n  J += K;\n#endif\n#ifdef IS_LINE_EXTRUSION\nglFragColor = vec4(J, lineOpacity * l.a);\n#else\nglFragColor = vec4(J, polygonOpacity * l.a);\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nfloat L = vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nfloat L = lineColor.a;\n#else\nfloat L = polygonFill.a;\n#endif\nglFragColor *= L;\n#ifdef HAS_EXTRUSION_OPACITY\nfloat M = extrusionOpacityRange.x;\n  float N = extrusionOpacityRange.y;\n  float O = M + vExtrusionOpacity * (N - M);\n  O = clamp(O, .0, 1.);\n  glFragColor *= O;\n#endif\nif(glFragColor.a < alphaTest) {\n    discard;\n  }\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#ifdef HAS_LAYER_OPACITY\nglFragColor *= layerOpacity;\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:r,defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}}),this.version=300}getGeometryDefines(t){const e={};return t.data[t.desc.tangentAttribute]?e.HAS_TANGENT=1:t.data[t.desc.normalAttribute]&&(e.HAS_NORMAL=1),e}};var vx="#if __VERSION__ == 300\n#define attribute in\n#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}";const _x=new Int8Array([-1,1,-1,-1,1,1,1,1,-1,-1,1,-1]),xx=new Uint8Array([0,1,0,0,1,1,1,1,0,0,1,0]);let bx=class extends mx{constructor(t){t.vert=t.vert||vx,t.extraCommandProps=t.extraCommandProps||{},t.extraCommandProps.depth||(t.extraCommandProps.depth={enable:!1,mask:!1}),t.extraCommandProps.stencil||(t.extraCommandProps.stencil={enable:!1}),super(t)}draw(t){return this._quadMesh||this._createQuadMesh(t),super.draw(t,this._quadMesh)}getMeshCommand(t){const e=this.dkey||"";return this.commands[e+"_quad"]||(this.commands[e+"_quad"]=this.createREGLCommand(t,null,this._quadMesh[0].getElements())),this.commands[e+"_quad"]}_createQuadMesh(t){const e=new Jv({aPosition:_x,aTexCoord:xx},null,_x.length/2,{positionSize:2,primitive:"triangles"});e.generateBuffers(t),this._quadMesh=[new z_(e)]}dispose(){if(this._quadMesh){const t=this._quadMesh[0];t.geometry.dispose(),t.dispose()}return delete this._quadMesh,super.dispose()}},wx=class extends bx{constructor(){super({vert:vx,frag:"#define SHADER_NAME FXAA\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision mediump float;\nvarying vec2 vTexCoord;\nuniform float enableFXAA;\nuniform float enableToneMapping;\nuniform float enableSharpen;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\n#ifdef HAS_TAA_TEX\nuniform sampler2D taaTextureSource;\n#ifdef HAS_FXAA_TEX\nuniform sampler2D fxaaTextureSource;\n#endif\n#endif\nuniform float pixelRatio;\nuniform float sharpFactor;\n#ifdef HAS_OUTLINE_TEX\nuniform sampler2D textureOutline;\nuniform float enableOutline;\nuniform float highlightFactor;\nuniform float outlineFactor;\nuniform float outlineWidth;\nuniform vec3 outlineColor;\n#endif\nvec2 c;\nvec4 d(vec2 e) {\n  \n#ifdef HAS_TAA_TEX\nvec4 f = texture2D(textureSource, e);\n  vec4 taa = texture2D(taaTextureSource, e);\n#ifdef HAS_FXAA_TEX\nvec4 h = texture2D(fxaaTextureSource, e);\n#else\nvec4 h = vec4(.0);\n#endif\nvec4 i = taa + f * (1. - taa.a);\n  return h + i * (1. - h.a);\n#else\nreturn texture2D(textureSource, e);\n#endif\n}\nvec4 j(vec2 k) {\n  vec4 l;\n  mediump vec2 m = vec2(1. / resolution.x, 1. / resolution.y);\n  vec3 n = d((k + vec2(-1., -1.)) * m).xyz;\n  vec3 o = d((k + vec2(1., -1.)) * m).xyz;\n  vec3 u = d((k + vec2(-1., 1.)) * m).xyz;\n  vec3 v = d((k + vec2(1.)) * m).xyz;\n  vec4 A = d(k * m);\n  vec3 B = A.xyz;\n  vec3 C = vec3(.299, .587, .114);\n  float D = dot(n, C);\n  float E = dot(o, C);\n  float F = dot(u, C);\n  float G = dot(v, C);\n  float H = dot(B, C);\n  float I = min(H, min(min(D, E), min(F, G)));\n  float J = max(H, max(max(D, E), max(F, G)));\n  mediump vec2 K;\n  K.x = -((D + E) - (F + G));\n  K.y = (D + F) - (E + G);\n  float L = max((D + E + F + G) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float M = 1. / (min(abs(K.x), abs(K.y)) + L);\n  K = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), K * M)) * m;\n  vec4 N = .5 * (d(k * m + K * (1. / 3. - .5)) + d(k * m + K * (2. / 3. - .5)));\n  vec4 O = N * .5 + .25 * (d(k * m + K * -.5) + d(k * m + K * .5));\n  float P = dot(O.xyz, C);\n  if(P < I || P > J)\n    l = N;\n  else\n    l = O;\n  return l;\n}\nvec3 Q(const in vec3 l, const float R) {\n  vec2 S = pixelRatio / resolution.xy;\n  float T = .0;\n  vec4 n = texture2D(textureSource, c + S * vec2(-1., -1.));\n  n.rgb = mix(vec3(.0), n.rgb, sign(n.a));\n  T += mix(.0, 1., sign(n.a));\n  vec4 v = texture2D(textureSource, c + S * vec2(1.));\n  v.rgb = mix(vec3(.0), v.rgb, sign(v.a));\n  T += mix(.0, 1., sign(v.a));\n  vec4 o = texture2D(textureSource, c + S * vec2(1., -1.));\n  o.rgb = mix(vec3(.0), o.rgb, sign(o.a));\n  T += mix(.0, 1., sign(o.a));\n  vec4 u = texture2D(textureSource, c + S * vec2(-1., 1.));\n  u.rgb = mix(vec3(.0), u.rgb, sign(u.a));\n  T += mix(.0, 1., sign(u.a));\n  return l + R * (T * l - n.rgb - o.rgb - u.rgb - v.rgb);\n}\nvec4 U(const in vec4 l) {\n  return vec4(Q(l.rgb, sharpFactor), l.a);\n}\nvec3 V(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float W = 2.43;\n  const float X = .59;\n  const float Y = .14;\n  return (x * (a * x + b)) / (x * (W * x + X) + Y);\n}\nvec3 Z(vec3 l) {\n  l = l / (l + vec3(1.));\n  return l = pow(l, vec3(1. / 2.2));\n}\n#ifdef HAS_OUTLINE_TEX\nvec4 ba() {\n  float bb = 2.;\n  float bc = 1.;\n  float bd = pixelRatio / resolution[0] * outlineWidth;\n  float be = pixelRatio / resolution[1] * outlineWidth;\n  vec4 bf = (texture2D(textureOutline, c + vec2(bd, be)));\n  vec4 bg = (texture2D(textureOutline, c + vec2(bd, .0)));\n  vec4 bh = (texture2D(textureOutline, c + vec2(bd, -be)));\n  vec4 bi = (texture2D(textureOutline, c + vec2(.0, -be)));\n  vec4 bj = (texture2D(textureOutline, c + vec2(-bd, -be)));\n  vec4 bk = (texture2D(textureOutline, c + vec2(-bd, .0)));\n  vec4 bl = (texture2D(textureOutline, c + vec2(-bd, be)));\n  vec4 bm = (texture2D(textureOutline, c + vec2(.0, be)));\n  vec4 bn = -bb * bk + bb * bg + -bc * bl + bc * bf + -bc * bj + bc * bh;\n  vec4 bo = -bb * bi + bb * bm + -bc * bj + bc * bl + -bc * bh + bc * bf;\n  float bp = sqrt(dot(bo, bo) + dot(bn, bn));\n  bool bq = bp < 1. / 65025.;\n  vec3 br = (texture2D(textureOutline, c)).r * outlineColor;\n  if(br == vec3(.0) || (highlightFactor == .0 && bq)) {\n    return vec4(.0);\n  }\n  float bs = bq ? highlightFactor : min(1., sqrt(bp) * outlineFactor);\n  return bs * vec4(br, 1.);\n}\nvec4 bt(const in vec4 l) {\n  vec4 ba = ba();\n  return ba + vec4(l) * (1. - ba.a);\n}\n#endif\nvoid main() {\n  c = vTexCoord;\n  vec4 l;\n  if(enableFXAA == 1.) {\n    l = j(c * resolution);\n  } else {\n    l = d(vTexCoord);\n  }\n  if(enableSharpen == 1.) {\n    l = U(l);\n  }\n#if defined(HAS_NOAA_TEX) || defined(HAS_POINT_TEX)\nvec4 bu = vec4(.0);\n  vec4 bv = vec4(.0);\n#ifdef HAS_POINT_TEX\nbu = texture2D(pointTextureSource, vTexCoord);\n#endif\n#ifdef HAS_NOAA_TEX\nbv = texture2D(noAaTextureSource, vTexCoord);\n#endif\nvec4 bw = bu + bv * (1. - bu.a);\n  l = bw + l * (1. - bw.a);\n#endif\nif(enableToneMapping == 1.) {\n    l.rgb = Z(l.rgb);\n  }\n#ifdef HAS_OUTLINE_TEX\nl = bt(l);\n#endif\ngl_FragColor = l;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}})}getMeshCommand(t,e){const n=this.dkey||"";return this.commands[n+"_fxaa"]||(this.commands[n+"_fxaa"]=this.createREGLCommand(t,null,e.getElements())),this.commands[n+"_fxaa"]}},Cx=class extends bx{constructor(){super({vert:vx,frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\nuniform float enableVignette;\nuniform float enableGrain;\nuniform float enableLut;\nuniform float timeGrain;\nuniform float grainFactor;\nuniform vec2 lensRadius;\nuniform float frameMod;\nuniform sampler2D lookupTable;\nfloat c(const in vec2 d) {\n  vec3 e = fract(vec3(d.xyx) * .1031);\n  e += dot(e, e.yzx + 19.19);\n  return fract((e.x + e.y) * e.z);\n}\nfloat f() {\n  float h = c(gl_FragCoord.xy + 1000.0 * fract(timeGrain));\n  float i = h * 2. - 1.;\n  h = i * inversesqrt(abs(i));\n  h = max(-1., h);\n  h = h - sign(i) + .5;\n  return (h + .5) * .5;\n}\nvec4 j(const in vec4 k) {\n  float l = f();\n  return vec4(mix(k.rgb, k.rgb * (k.rgb + (1. - k.rgb) * 2. * l), grainFactor), k.a);\n}\nfloat m(const in float k) {\n  return k < .0031308 ? k * 12.92 : 1.055 * pow(k, 1. / 2.4) - .055;\n}\nvec3 m(const in vec3 k) {\n  return vec3(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055);\n}\nvec4 m(const in vec4 k) {\n  return vec4(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055, k.a);\n}\nfloat n(const in float k) {\n  return k < .04045 ? k * (1. / 12.92) : pow((k + .055) * (1. / 1.055), 2.4);\n}\nvec3 n(const in vec3 k) {\n  return vec3(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4));\n}\nvec4 n(const in vec4 k) {\n  return vec4(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4), k.a);\n}\nfloat o(const in vec2 d, const in float u) {\n  vec3 v = vec3(.06711056, .00583715, 52.9829189);\n  return fract(v.z * fract(dot(d.xy + u * vec2(47., 17.) * .695, v.xy)));\n}\nfloat A() {\n  vec2 B = lensRadius;\n  B.y = min(B.y, B.x - 1e-4);\n  float C = o(gl_FragCoord.xy, frameMod);\n  C = (B.x - B.y) * (B.x + B.y) * .07 * (C - .5);\n  return smoothstep(B.x, B.y, C + distance(vTexCoord, vec2(.5)));\n}\nvec4 D(const in vec4 k) {\n  float l = A();\n  return vec4(m(n(k.rgb) * l), clamp(k.a + (1. - l), .0, 1.));\n}\nvec4 E(in vec4 F, in sampler2D G) {\n  mediump float H = F.b * 63.;\n  mediump vec2 I;\n  I.y = floor(floor(H) / 8.);\n  I.x = floor(H) - I.y * 8.;\n  mediump vec2 J;\n  J.y = floor(ceil(H) / 8.);\n  J.x = ceil(H) - J.y * 8.;\n  highp vec2 K;\n  K.x = I.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  K.y = I.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nK.y = 1. - K.y;\n#endif\nhighp vec2 L;\n  L.x = J.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  L.y = J.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nL.y = 1. - L.y;\n#endif\nlowp vec4 M = texture2D(G, K);\n  lowp vec4 N = texture2D(G, L);\n  lowp vec4 O = mix(M, N, fract(H));\n  return O;\n}\nvoid main() {\n  vec4 k = texture2D(textureSource, vTexCoord);\n  if(enableLut == 1.) {\n    k = E(k, lookupTable);\n  }\n  if(enableVignette == 1.) {\n    k = D(k);\n  }\n  if(enableGrain == 1.) {\n    k = j(k);\n  }\n  gl_FragColor = k;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}})}getMeshCommand(t,e){return this.commands.postprocess||(this.commands.postprocess=this.createREGLCommand(t,null,e.getElements())),this.commands.postprocess}};const Px=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],Mx=Px.length,Tx=[0,0];for(let t=0;t<Px.length;t++)Tx[0]+=Px[t][0],Tx[1]+=Px[t][1];Tx[0]/=Mx,Tx[1]/=Mx;let Sx=class{constructor(t){this._frameNum=0,this._ratio=t||.05,this._avg=[Tx[0]*this._ratio,Tx[1]*this._ratio]}getRatio(){return this._ratio}setRatio(t){this._ratio!==t&&(this._ratio=t,this.reset()),this._avg=[Tx[0]*this._ratio,Tx[1]*this._ratio]}getAverage(){return this._avg}reset(){this._frameNum=0}getJitter(t){const e=this._frameNum%Mx,n=this._ratio;return ly(t,Px[e][0]*n,Px[e][1]*n),t}frame(){this._frameNum++,this._frameNum%Mx==0&&(this._frameNum=0)}getSampleCount(){return Mx}},Ix=class{constructor(t,e,n=5){this._regl=t,this._renderer=new j_(t),this._inputRGBM=e,this._level=n}render(t,e){this._initShaders(),this._createTextures(t),this._blur(t,e||0);const n={blurTex0:this._blur01Tex,blurTex1:this._blur11Tex,blurTex2:this._blur21Tex,blurTex3:this._blur31Tex,blurTex4:this._blur41Tex};return this._level>5&&(n.blurTex5=this._blur51Tex,n.blurTex6=this._blur61Tex),n}_blur(t,e){let n=this._blurUniforms;n||(n=this._blurUniforms={rgbmRange:7,blurDir:[0,0],outSize:[0,0],pixelRatio:[1,1],outputSize:[0,0]}),ly(n.outSize,t.width,t.height),this._blurOnce(this._blur0Shader,t,this._blur00FBO,this._blur01FBO,.5,e),this._blurOnce(this._blur1Shader,this._blur01FBO.color[0],this._blur10FBO,this._blur11FBO,.5),this._blurOnce(this._blur2Shader,this._blur11FBO.color[0],this._blur20FBO,this._blur21FBO,.5),this._blurOnce(this._blur3Shader,this._blur21FBO.color[0],this._blur30FBO,this._blur31FBO,.5),this._blurOnce(this._blur4Shader,this._blur31FBO.color[0],this._blur40FBO,this._blur41FBO,.5),this._level>5&&(this._blurOnce(this._blur5Shader,this._blur41FBO.color[0],this._blur50FBO,this._blur51FBO,.5),this._blurOnce(this._blur6Shader,this._blur51FBO.color[0],this._blur60FBO,this._blur51FBO,.5))}_blurOnce(t,e,n,i,r,o){const s=Math.ceil(r*e.width),a=Math.ceil(r*e.height);n.width===s&&n.height===a||n.resize(s,a),i.width===s&&i.height===a||i.resize(s,a);const h=this._blurUniforms;h.luminThreshold=o,h.TextureBlurInput=e,h.inputRGBM=+this._inputRGBM,ly(h.blurDir,0,1),ly(h.outputSize,n.width,n.height),this._renderer.render(t,h,null,n),h.luminThreshold=0,h.inputRGBM=1,ly(h.blurDir,1,0),h.TextureBlurInput=n.color[0],this._renderer.render(t,h,null,i)}dispose(){this._blur0Shader&&(this._blur0Shader.dispose(),delete this._blur0Shader,this._blur1Shader.dispose(),this._blur2Shader.dispose(),this._blur3Shader.dispose(),this._blur4Shader.dispose(),this._blur5Shader&&(this._blur5Shader.dispose(),this._blur6Shader.dispose(),delete this._blur5Shader)),this._blur00Tex&&(delete this._blur00Tex,this._blur00FBO.destroy(),this._blur01FBO.destroy(),this._blur10FBO.destroy(),this._blur11FBO.destroy(),this._blur20FBO.destroy(),this._blur21FBO.destroy(),this._blur30FBO.destroy(),this._blur31FBO.destroy(),this._blur40FBO.destroy(),this._blur41FBO.destroy(),this._blur50FBO&&(this._blur50FBO.destroy(),this._blur51FBO.destroy(),this._blur60FBO.destroy(),this._blur61FBO.destroy()))}_createTextures(t){if(this._blur00Tex)return;let e=t.width,n=t.height;this._blur00Tex=this._createColorTex(t,e,n),this._blur00FBO=this._createBlurFBO(this._blur00Tex),this._blur01Tex=this._createColorTex(t),this._blur01FBO=this._createBlurFBO(this._blur01Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur10Tex=this._createColorTex(t,e,n),this._blur10FBO=this._createBlurFBO(this._blur10Tex),this._blur11Tex=this._createColorTex(t,e,n),this._blur11FBO=this._createBlurFBO(this._blur11Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur20Tex=this._createColorTex(t,e,n),this._blur20FBO=this._createBlurFBO(this._blur20Tex),this._blur21Tex=this._createColorTex(t,e,n),this._blur21FBO=this._createBlurFBO(this._blur21Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur30Tex=this._createColorTex(t,e,n),this._blur30FBO=this._createBlurFBO(this._blur30Tex),this._blur31Tex=this._createColorTex(t,e,n),this._blur31FBO=this._createBlurFBO(this._blur31Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur40Tex=this._createColorTex(t,e,n),this._blur40FBO=this._createBlurFBO(this._blur40Tex),this._blur41Tex=this._createColorTex(t,e,n),this._blur41FBO=this._createBlurFBO(this._blur41Tex),this._level>5&&(e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur50Tex=this._createColorTex(t,e,n),this._blur50FBO=this._createBlurFBO(this._blur50Tex),this._blur51Tex=this._createColorTex(t,e,n),this._blur51FBO=this._createBlurFBO(this._blur51Tex),e=Math.ceil(e/2),n=Math.ceil(n/2),this._blur60Tex=this._createColorTex(t,e,n),this._blur60FBO=this._createBlurFBO(this._blur60Tex),this._blur61Tex=this._createColorTex(t,e,n),this._blur61FBO=this._createBlurFBO(this._blur61Tex))}_createColorTex(t,e,n){return this._regl.texture({min:"linear",mag:"linear",type:"uint8",width:e||t.width,height:n||t.height})}_createBlurFBO(t){return this._regl.framebuffer({width:t.width,height:t.height,colors:[t],depth:!1,stencil:!1})}_initShaders(){if(!this._blur0Shader){const t={vert:vx,extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.outputSize[0],height:(t,e)=>e.outputSize[1]}},frag:"#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\nuniform float inputRGBM;\nuniform float luminThreshold;\n#define SHADER_NAME GAUSSIAN_BLUR0\nconst vec3 c = vec3(.2126, .7152, .0722);\nfloat d(const in vec3 e) {\n  return dot(e, c);\n}\nvec4 f(vec4 e) {\n  float h = max(sign(d(e.rgb) - luminThreshold), .0);\n  return e * h;\n}\nvec2 i;\nvec4 j(const in vec3 e, const in float k) {\n  vec4 l;\n  vec3 m = e / k;\n  l.a = clamp(max(max(m.r, m.g), max(m.b, 1e-6)), .0, 1.);\n  l.a = ceil(l.a * 255.) / 255.;\n  l.rgb = m / l.a;\n  return l;\n}\nvec3 n(const in vec4 e, const in float k) {\n  if(inputRGBM == .0)\n    return e.rgb;\n  return k * e.rgb * e.a;\n}\nvec4 o() {\n  vec3 u = .375 * (f(vec4(n(texture2D(TextureBlurInput, i.xy), rgbmRange), 1.))).rgb;\n  vec2 v;\n  vec2 A = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  v = A * 1.2;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy + v.xy), rgbmRange), 1.))).rgb;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy - v.xy), rgbmRange), 1.))).rgb;\n  return vec4(u, 1.);\n}\nvoid main(void) {\n  i = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = o();\n  e = j(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}"};this._blur0Shader=new bx(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR1\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .3125 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.2857142857142858;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur1Shader=new bx(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR2\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2734375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3333333333333333;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.111111111111111;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur2Shader=new bx(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR3\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .24609375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3636363636363635;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.1818181818181817;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur3Shader=new bx(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR4\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2255859375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3846153846153846;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.230769230769231;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.076923076923077;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur4Shader=new bx(t),this._level>5&&(t.frag="precision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR5\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .20947265625 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.4;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2666666666666666;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.133333333333334;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur5Shader=new bx(t),t.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR6\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .196380615234375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.411764705882353;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2941176470588234;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.176470588235294;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur6Shader=new bx(t))}}},Ex=class{constructor(t){this._regl=t,this._renderer=new j_(t)}render(t,e,n,i,r,o,s,a,h){this._initShaders(),this._createTextures(t);const l=this._blurPass.render(e,n);return this._combine(t,l,e,i,r,o,s,a,h)}_combine(t,e,n,i,r,o,s,a,h){h||this._combineTex.width===t.width&&this._combineTex.height===t.height||this._combineFBO.resize(t.width,t.height);let l=this._combineUniforms;const{blurTex0:u,blurTex1:c,blurTex2:A,blurTex3:f,blurTex4:d}=e;l||(l=this._combineUniforms={bloomFactor:0,bloomRadius:0,rgbmRange:7,TextureBloomBlur1:u,TextureBloomBlur2:c,TextureBloomBlur3:A,TextureBloomBlur4:f,TextureBloomBlur5:d,TextureInput:null,TextureSource:null,outputSize:[0,0]}),l.noAaTextureSource=o,l.pointTextureSource=s,l.enableAA=a,l.bloomFactor=i,l.bloomRadius=r,l.TextureInput=n,l.TextureSource=t,ly(l.outputSize,t.width,t.height);const p={};return o?p.HAS_NOAA_TEX=1:delete p.HAS_NOAA_TEX,s?p.HAS_POINT_TEX=1:delete p.HAS_POINT_TEX,this._combineShader.setDefines(p),this._renderer.render(this._combineShader,l,null,h?null:this._combineFBO),h?null:this._combineTex}dispose(){this._combineFBO&&(this._combineFBO.destroy(),delete this._combineFBO),this._blurPass&&(this._blurPass.dispose(),delete this._blurPass),delete this._uniforms}_createTextures(t){this._combineTex||(this._combineTex=this._createColorTex(t,t.width,t.height,"uint8"),this._combineFBO=this._createBlurFBO(this._combineTex))}_createColorTex(t,e,n,i){return this._renderer.regl.texture({min:"linear",mag:"linear",type:i,width:e||t.width,height:n||t.height})}_createBlurFBO(t){return this._renderer.regl.framebuffer({width:t.width,height:t.height,colors:[t],depth:!1,stencil:!1})}_initShaders(){if(!this._combineShader){const t={x:0,y:0,width:(t,e)=>e.outputSize[0],height:(t,e)=>e.outputSize[1]};this._blurPass=new Ix(this._regl,!1),this._combineShader=new bx({vert:vx,frag:"#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision highp float;\nuniform float bloomFactor;\nuniform float bloomRadius;\nuniform float rgbmRange;\nuniform sampler2D TextureBloomBlur1;\nuniform sampler2D TextureBloomBlur2;\nuniform sampler2D TextureBloomBlur3;\nuniform sampler2D TextureBloomBlur4;\nuniform sampler2D TextureBloomBlur5;\nuniform sampler2D TextureInput;\nuniform sampler2D TextureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\nuniform float enableAA;\nuniform vec2 outputSize;\n#define SHADER_NAME bloomCombine\nvec2 c;\nvec3 d(const in vec3 e) {\n  return vec3(e.r < .0031308 ? e.r * 12.92 : 1.055 * pow(e.r, 1. / 2.4) - .055, e.g < .0031308 ? e.g * 12.92 : 1.055 * pow(e.g, 1. / 2.4) - .055, e.b < .0031308 ? e.b * 12.92 : 1.055 * pow(e.b, 1. / 2.4) - .055);\n}\nvec3 f(const in vec4 e, const in float h) {\n  if(h <= .0)\n    return e.rgb;\n  return h * e.rgb * e.a;\n}\nfloat i(const float j, const float k) {\n  return mix(j, k * 2. - j, bloomRadius);\n}\nvec4 l(sampler2D m, vec2 n) {\n  vec4 e;\n  mediump vec2 o = vec2(1. / outputSize.x, 1. / outputSize.y);\n  vec3 u = texture2D(m, (n + vec2(-1., -1.)) * o).xyz;\n  vec3 v = texture2D(m, (n + vec2(1., -1.)) * o).xyz;\n  vec3 A = texture2D(m, (n + vec2(-1., 1.)) * o).xyz;\n  vec3 B = texture2D(m, (n + vec2(1.)) * o).xyz;\n  vec4 C = texture2D(m, n * o);\n  vec3 D = C.xyz;\n  vec3 E = vec3(.299, .587, .114);\n  float F = dot(u, E);\n  float G = dot(v, E);\n  float H = dot(A, E);\n  float I = dot(B, E);\n  float J = dot(D, E);\n  float K = min(J, min(min(F, G), min(H, I)));\n  float L = max(J, max(max(F, G), max(H, I)));\n  mediump vec2 M;\n  M.x = -((F + G) - (H + I));\n  M.y = (F + H) - (G + I);\n  float N = max((F + G + H + I) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float O = 1. / (min(abs(M.x), abs(M.y)) + N);\n  M = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), M * O)) * o;\n  vec4 P = .5 * (texture2D(m, n * o + M * (1. / 3. - .5)) + texture2D(m, n * o + M * (2. / 3. - .5)));\n  vec4 Q = P * .5 + .25 * (texture2D(m, n * o + M * -.5) + texture2D(m, n * o + M * .5));\n  float R = dot(Q.xyz, E);\n  if(R < K || R > L)\n    e = P;\n  else\n    e = Q;\n  return e;\n}\nvec4 S() {\n  vec3 T = vec3(.0);\n  const float U = .6;\n  const float V = 1.1;\n  const float W = .9;\n  const float X = .6;\n  const float Y = .3;\n  const float Z = .1;\n  T += (vec4(f(texture2D(TextureBloomBlur1, c), rgbmRange), 1.)).rgb * i(V, U);\n  T += (vec4(f(texture2D(TextureBloomBlur2, c), rgbmRange), 1.)).rgb * i(W, U);\n  T += (vec4(f(texture2D(TextureBloomBlur3, c), rgbmRange), 1.)).rgb * i(X, U);\n  T += (vec4(f(texture2D(TextureBloomBlur4, c), rgbmRange), 1.)).rgb * i(Y, U);\n  T += (vec4(f(texture2D(TextureBloomBlur5, c), rgbmRange), 1.)).rgb * i(Z, U);\n  vec4 ba;\n  if(enableAA == 1.) {\n    ba = l(TextureInput, gl_FragCoord.xy);\n  } else {\n    ba = texture2D(TextureInput, c);\n  }\n  ba.rgb = mix(vec3(.0), ba.rgb, sign(ba.a));\n  vec4 bb = texture2D(TextureSource, c);\n#ifdef HAS_NOAA_TEX\nvec4 bc = texture2D(noAaTextureSource, c);\n  bb = bc + bb * (1. - bc.a);\n#endif\nvec4 bd = vec4(.0);\n#ifdef HAS_POINT_TEX\nbd = texture2D(pointTextureSource, c);\n#endif\nfloat be = sqrt((T.r + T.g + T.b) / 3.);\n  vec4 bf = vec4(d(T * bloomFactor), be);\n  return bd + (ba + bb * (1. - ba.a)) * (1. - bd.a) + bf;\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = S();\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:t}})}}},Ox=class extends bx{constructor(){const t=[];super({vert:vx,frag:"precision highp float;\n#include <gl2_frag>\n#define SHADER_NAME COPY_DEPTH\nuniform sampler2D TextureDepth;\nuniform vec2 textureSize;\n#include <common_pack_float>\nvoid main(void) {\n  vec2 c = gl_FragCoord.xy / textureSize.xy;\n  float d = texture2D(TextureDepth, c).r;\n  glFragColor = common_encodeDepth(d);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"textureSize",type:"function",fn:(e,n)=>(t[0]=n.TextureDepth.width,t[1]=n.TextureDepth.height,t)}],extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.TextureDepth.width,height:(t,e)=>e.TextureDepth.height}}}),this.version=300}getMeshCommand(t,e){return this.commands.copy_depth||(this.commands.copy_depth=this.createREGLCommand(t,null,e.getElements())),this.commands.copy_depth}},Rx=class{static getUniformDeclares(){const t=[[0,0,0,0],[0,0,0,0]],e=new Array(16);return[{name:"invProjMatrix",type:"function",fn:(t,n)=>Bp(e,n.projMatrix)},{name:"outputFovInfo",type:"array",length:2,fn:function(e,n){const i=Math.tan(.5*n.fov),r=n.outSize[0]/n.outSize[1]*i;return qg(t[0],r,i,r,-i),qg(t[1],-r,i,-r,-i),t}},{name:"reprojViewProjMatrix",type:"function",fn:(t,e)=>Hp([],e.prevProjViewMatrix,e.cameraWorldMatrix)}]}static getDefines(){return{HAS_SSR:1}}constructor(t){this._regl=t,this._renderer=new j_(t),this._inputRGBM=0}setup(t){this._initShaders(),this._createTextures(t)}getSSRUniforms(t,e,n){if(!this._depthCopy)return null;const i=this._depthCopy;return{TextureDepth:i,TextureReflected:this.getMipmapTexture(),ssrFactor:e||1,ssrQuality:n||2,outSize:[i.width,i.height],fov:t.getFov()*Math.PI/180,prevProjViewMatrix:this._projViewMatrix||t.projViewMatrix,cameraWorldMatrix:t.cameraWorldMatrix}}genMipMap(t,e,n){return this.setup(t),this._mipmap(t),this.copyDepthTex(e),this._projViewMatrix||(this._projViewMatrix=[]),Fp(this._projViewMatrix,n),delete this._depthCopied,this._outputTex}getPrevProjViewMatrix(){return this._projViewMatrix}copyDepthTex(t){return this._depthCopied?null:(this.setup(t),this._depthCopy?t.width===this._depthCopy.width&&t.height===this._depthCopy.height||this._depthCopyFBO.resize(t.width,t.height):(this._depthCopy=this._regl.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"uint8",width:t.width,height:t.height}),this._depthCopyFBO=this._regl.framebuffer({width:t.width,height:t.height,colors:[this._depthCopy],colorFormat:"rgba"})),this._renderer.render(this._copyDepthShader,{TextureDepth:t},null,this._depthCopyFBO),this._depthCopied=!0,this._depthCopy)}_mipmap(t){const e=this._targetFBO,n=Math.ceil(.5*t.width),i=Math.ceil(.5*t.height);e.width===n&&e.height===i||e.resize(n,i);let r=this._blurUniforms;r||(r=this._blurUniforms={rgbmRange:7,outputSize:[0,0]}),r.TextureInput=t,r.inputRGBM=+this._inputRGBM,ly(r.outputSize,e.width,e.height),this._renderer.render(this._ssrQuadShader,r,null,e)}getMipmapTexture(){return this._outputTex||(this._outputTex=this._renderer.regl.texture({type:"uint8",width:2,height:2})),this._outputTex}dispose(){this._copyDepthShader&&(this._ssrQuadShader.dispose(),this._copyDepthShader.dispose(),this._targetFBO.destroy(),delete this._copyDepthShader),this._depthCopy&&(this._depthCopyFBO.destroy(),delete this._depthCopy,delete this._depthCopyFBO)}_initShaders(){this._copyDepthShader||(this._copyDepthShader=new Ox,this._ssrQuadShader=new bx({vert:vx,frag:"#version 100\nprecision mediump float;\nuniform sampler2D TextureInput;\nuniform vec2 outputSize;\n#define SHADER_NAME QUAD\nvec2 c;\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 d = texture2D(TextureInput, c.xy);\n  gl_FragColor = d;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.outputSize[0],height:(t,e)=>e.outputSize[1]}}}))}_createTextures(t){if(!this._targetFBO){const e=this._regl;this._outputTex&&this._outputTex.destroy(),this._outputTex=e.texture({min:"linear",mag:"linear",type:"uint8",width:t.width,height:t.height}),this._targetFBO=e.framebuffer({width:t.width,height:t.height,colors:[this._outputTex],depth:!1,stencil:!1})}}},Dx=class extends mx{constructor(t){const e=[];super({vert:"#define SHADER_NAME HEATMAP\nuniform mat4 projViewModelMatrix;\nuniform float extrudeScale;\nuniform float heatmapIntensity;\nattribute vec3 aPosition;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nattribute highp float aWeight;\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\nuniform mediump float heatmapRadius;\nconst highp float c = 1. / 255. / 16.;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n  \n#ifdef HAS_HEAT_WEIGHT\nhighp float d = aWeight / 255.;\n  weight = d;\n#else\nhighp float d = heatmapWeight;\n#endif\nmediump float e = heatmapRadius;\n  vec2 f = vec2(mod(aPosition.xy, 2.) * 2. - 1.);\n  float h = sqrt(-2. * log(c / d / heatmapIntensity / GAUSS_COEF)) / 3.;\n  vExtrude = h * f;\n  vec2 i = vExtrude * e * extrudeScale;\n  vec4 j = vec4(floor(aPosition.xy * .5) + i, aPosition.z, 1);\n  gl_Position = projViewModelMatrix * j;\n}",frag:"#define SHADER_NAME HEATMAP\nprecision mediump float;\nuniform highp float heatmapIntensity;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n  \n#ifdef HAS_HEAT_WEIGHT\nhighp float c = weight;\n#else\nhighp float c = heatmapWeight;\n#endif\nfloat d = -.5 * 3. * 3. * dot(vExtrude, vExtrude);\n  float e = c * heatmapIntensity * GAUSS_COEF * exp(d);\n  gl_FragColor = vec4(e, 1., 1., 1.);\n}",uniforms:[{name:"extrudeScale",type:"function",fn:function(t,e){return e.resolution/e.dataResolution*e.tileRatio}},{name:"projViewModelMatrix",type:"function",fn:function(t,n){return Hp(e,n.projViewMatrix,n.modelMatrix)}}],extraCommandProps:pv({},t&&t.extraCommandProps||{},{blend:{enable:!0,func:{src:"one",dst:"one"},equation:"add"}})})}};var kx=[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],Lx="#define SHADER_NAME SKYBOX\n#if __VERSION__ == 100\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\nprecision highp float;\n#define saturate(x)        clamp(x, 0.0, 1.0)\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\nvarying vec3 vWorldPos;\n#ifdef USE_AMBIENT\nuniform vec3 diffuseSPH[9];\n#else\nuniform samplerCube cubeMap;\nuniform float bias;\nuniform float size;\n#endif\nuniform float environmentExposure;\nuniform float backgroundIntensity;\nvec4 c(const in samplerCube d, const in vec3 e, const in float f, const in float h) {\n  vec3 i = e;\n  return textureCubeLod(d, i, h);\n}\nvec3 j(const in vec3 k, const in vec3 l[9]) {\n  float x = k.x;\n  float y = k.y;\n  float z = k.z;\n  vec3 m = (l[0] + l[1] * x + l[2] * y + l[3] * z + l[4] * z * x + l[5] * y * z + l[6] * y * x + l[7] * (3. * z * z - 1.) + l[8] * (x * x - y * y));\n  return max(m, vec3(.0));\n}\nfloat n(const in vec2 o) {\n  vec3 u = fract(vec3(o.xyx) * .1031);\n  u += dot(u, u.yzx + 19.19);\n  return fract((u.x + u.y) * u.z);\n}\n#if defined(TONE_MAPPING)\nconst float v = 1.;\nvec3 A(vec3 B) {\n  vec3 a = B * (B + .0245786) - .000090537;\n  vec3 b = B * (.983729 * B + .4329510) + .238081;\n  return a / b;\n}\nvec3 C(vec3 D) {\n  const mat3 E = mat3(vec3(.59719, .07600, .02840), vec3(.35458, .90834, .13383), vec3(.04823, .01566, .83777));\n  const mat3 F = mat3(vec3(1.60475, -.10208, -.00327), vec3(-.53108, 1.10813, -.07276), vec3(-.07367, -.00605, 1.07602));\n  D *= v / .6;\n  D = E * D;\n  D = A(D);\n  D = F * D;\n  return saturate(D);\n}\nvec3 G(vec3 D) {\n  return C(D);\n}\nvec4 H(in vec4 I) {\n  return vec4(mix(pow(I.rgb, vec3(.41666)) * 1.055 - vec3(.055), I.rgb * 12.92, vec3(lessThanEqual(I.rgb, vec3(.0031308)))), I.a);\n}\nvec4 J(vec4 I) {\n  return (H(I));\n}\n#endif\nvoid main() {\n  vec4 K;\n#ifdef USE_AMBIENT\nvec3 k = normalize(vWorldPos + mix(-.5 / 255., .5 / 255., n(gl_FragCoord.xy)) * 2.);\n  K = vec4(j(k, diffuseSPH), 1.);\n#else\nK = c(cubeMap, vWorldPos, size, bias);\n#endif\nK.rgb *= environmentExposure;\n  K.rgb *= backgroundIntensity;\n  glFragColor = K;\n  if(length(hsv) > .0) {\n    glFragColor.rgb = hsv_apply(clamp(glFragColor.rgb, .0, 1.), hsv);\n  }\n#if defined(TONE_MAPPING)\nglFragColor.rgb = G(glFragColor.rgb);\n  glFragColor = J(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}";let Fx=class extends mx{constructor(){super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 transformMatrix;\nvarying vec3 vWorldPos;\nvoid main() {\n  vWorldPos = aPosition;\n  mat4 c = mat4(mat3(viewMatrix) * transformMatrix);\n  vec4 d = projMatrix * c * vec4(vWorldPos, 1.);\n  gl_Position = d.xyww;\n}",frag:Lx,extraCommandProps:{depth:{enable:!0,range:[1,1],func:"lequal"},viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}}),this.version=300}setMode(t,e){const n={};return t&&(n.TONE_MAPPING=1),0===e&&(n.USE_AMBIENT=1),this._skyboxMesh?this._skyboxMesh[0].setDefines(n):this._meshDefines=n,this}draw(t){return this._skyboxMesh||this._createSkyboxMesh(t),super.draw(t,this._skyboxMesh)}_createSkyboxMesh(t){const e=new Jv({aPosition:new Int8Array(kx)},null,kx.length/3);e.generateBuffers(t),this._skyboxMesh=[new z_(e)],this._meshDefines&&(this._skyboxMesh[0].setDefines(this._meshDefines),delete this._meshDefines)}dispose(){if(this._skyboxMesh){const t=this._skyboxMesh[0];t.geometry.dispose(),t.dispose()}return delete this._skyboxMesh,super.dispose()}},Nx=class extends mx{constructor(t,e){const n={blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},viewport:t};e&&e.extraCommandProps&&pv(n,e.extraCommandProps);const i=[];super({vert:"#define SHADER_NAME HEATMAP_DISPLAY\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nvoid main() {\n  gl_Position = projViewModelMatrix * vec4(aPosition, 1.);\n}",frag:"#define SHADER_NAME HEATMAP_DISPLAY\nprecision mediump float;\nuniform sampler2D inputTexture;\nuniform sampler2D colorRamp;\nuniform vec2 textureOutputSize;\nuniform float heatmapOpacity;\nvoid main() {\n  vec2 c = gl_FragCoord.xy / textureOutputSize.xy;\n  float t = texture2D(inputTexture, c).r;\n  vec4 d = texture2D(colorRamp, vec2(t, .5));\n  gl_FragColor = d * heatmapOpacity;\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp(i,e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:n})}},zx=class extends bx{constructor(){super({vert:vx,frag:"precision highp float;\nuniform sampler2D texture;\nuniform vec2 size;\nuniform float enableSharpen;\nuniform float sharpFactor;\nuniform float pixelRatio;\nvec2 c;\nvec3 d(const in vec3 e, const float f) {\n  vec2 h = pixelRatio / size.xy;\n  float i = .0;\n  vec4 j = texture2D(texture, c + h * vec2(-1., -1.));\n  j.rgb = mix(vec3(.0), j.rgb, sign(j.a));\n  i += mix(.0, 1., sign(j.a));\n  vec4 k = texture2D(texture, c + h * vec2(1.));\n  k.rgb = mix(vec3(.0), k.rgb, sign(k.a));\n  i += mix(.0, 1., sign(k.a));\n  vec4 l = texture2D(texture, c + h * vec2(1., -1.));\n  l.rgb = mix(vec3(.0), l.rgb, sign(l.a));\n  i += mix(.0, 1., sign(l.a));\n  vec4 m = texture2D(texture, c + h * vec2(-1., 1.));\n  m.rgb = mix(vec3(.0), m.rgb, sign(m.a));\n  i += mix(.0, 1., sign(m.a));\n  return e + f * (i * e - j.rgb - l.rgb - m.rgb - k.rgb);\n}\nvoid main() {\n  c = gl_FragCoord.xy / size;\n  vec4 e = texture2D(texture, c);\n  if(enableSharpen == 1.) {\n    e.rgb = d(e.rgb, sharpFactor);\n  }\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.size[0],height:(t,e)=>e.size[1]}}})}getMeshCommand(t,e){return this.commands.copy||(this.commands.copy=this.createREGLCommand(t,null,e.getElements())),this.commands.copy}},Bx=class extends mx{constructor(t={}){const e=[],n=t.uniforms,i=[{name:"modelViewMatrix",type:"function",fn:function(t,n){return Hp(e,n.viewMatrix,n.modelMatrix)}}];n&&i.push(...n),super({vert:"attribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 modelViewMatrix;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n}",frag:"precision mediump float;\nuniform vec4 lineColor;\nuniform float lineOpacity;\nvoid main() {\n  gl_FragColor = lineColor;\n  gl_FragColor.a *= lineOpacity;\n}",uniforms:i,defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}})}};const Hx=[],jx=[],Ux=[];let Gx=class{constructor(t,e,n){this._regl=t,this._layer=n,this._viewport=e,this._init()}_init(){this._shader=new mx({vert:"attribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nvarying vec4 vWorldPosition;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  vec4 e = modelMatrix * d * c;\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n  vWorldPosition = e;\n}",frag:"precision mediump float;\nvarying vec4 vWorldPosition;\nuniform vec2 fogDist;\nuniform vec3 cameraPosition;\nuniform float rainDepth;\nvoid main() {\n  vec3 c = vec3(vWorldPosition[0] - cameraPosition[0], vWorldPosition[1] - cameraPosition[1], vWorldPosition[2] - cameraPosition[2]);\n  float d = length(c);\n  float e = clamp(1. - (d - fogDist.x) / (fogDist.y - fogDist.x), .0, 1.);\n  if(vWorldPosition[2] < rainDepth) {\n    gl_FragColor = vec4(e, .0, .0, 1.);\n  } else {\n    gl_FragColor = vec4(e, 1., .0, 1.);\n  }\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp(Ux,e.viewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}});const t=this._layer.getRenderer().createFBOInfo();this._fbo=this._regl.framebuffer(t),this._scene=new Y_,this.renderer=new j_(this._regl)}render(t,e){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._scene.setMeshes(t),this.renderer.render(this._shader,{projMatrix:e.projMatrix,viewMatrix:e.viewMatrix,cameraPosition:e.cameraPosition,fogDist:e.fogDist,rainDepth:e.rainDepth},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const t=dv(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,e=dv(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===t&&this._fbo.height===e||this._fbo.resize(t,e)}},Vx=class extends bx{constructor(){super({vert:vx,frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_RAIN\nuniform sampler2D ripplesMap;\n#endif\n#ifdef HAS_SNOW\nuniform sampler2D normalMap;\n#endif\n#ifdef HAS_FOG\nuniform vec3 fogColor;\n#endif\nuniform sampler2D sceneMap;\nuniform sampler2D mixFactorMap;\nuniform float time;\nuniform vec2 resolution;\nuniform float snowIntensity;\nfloat c(float a, float b, float w) {\n  return a + w * (b - a);\n}\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\n#define HASHSCALE4 vec3(.1031, .1030, .0973, .1099)\nfloat d = .5;\nfloat e = .2;\nfloat f = .5;\nfloat h = 20.;\nfloat i(float p) {\n  vec3 j = fract(vec3(p) * HASHSCALE1);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.x + j.y) * j.z);\n}\nvec2 k(vec2 p) {\n  vec3 j = fract(vec3(p.xyx) * HASHSCALE3);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.xx + j.yz) * j.zy);\n}\nvec2 l(vec2 m) {\n  float x = fract(sin(dot(m.xy, vec2(122.9898, 783.233))) * 43758.5453);\n  float y = fract(sin(dot(m.xy, vec2(457.6537, 537.2793))) * 37573.5913);\n  return vec2(x, y);\n}\nvec3 n(vec2 o, float u) {\n  vec3 v = vec3(.0);\n  o = o * (2. + u);\n  float A = e * snowIntensity;\n  float B = o.y * (((i(u) * 2. - 1.) * .5 + 1.) * A);\n  float C = (f * time);\n  o += vec2(B, C);\n  vec2 D = k(floor(o) + 31.1759 * u);\n  o = fract(o);\n  o -= (D * 2. - 1.) * .35;\n  o -= .5;\n  float r = length(o);\n  float E = .05 * (1. + .3 * sin(time * d));\n  float F = smoothstep(E, -E, r);\n  vec3 G = vec3(F) * D.x;\n  return G;\n}\nvec3 H() {\n  vec3 v = vec3(0);\n  vec2 o = gl_FragCoord.xy / resolution.xy;\n  o *= vec2(resolution.x / resolution.y, 1.);\n  float I = h * snowIntensity;\n  for(float J = 0.; J < I; J++) {\n    v += n(o, J);\n  }\n  return v;\n}\nvec3 K(vec4 L, vec4 M, float N) {\n  float O = M.b;\n  vec3 P = vec3(1.);\n  if(N < 1.) {\n    float r = c(.5, P.x, O);\n    float g = c(.5, P.y, O);\n    float b = c(.5, P.z, O);\n    return vec3(r, g, b);\n  } else {\n    float r = c(L.r, P.x, O);\n    float g = c(L.g, P.y, O);\n    float b = c(L.b, P.z, O);\n    return vec3(r, g, b);\n  }\n}\nvoid main() {\n  vec4 L = texture2D(sceneMap, vTexCoord);\n  glFragColor = L;\n  vec4 Q = texture2D(mixFactorMap, vTexCoord);\n#ifdef HAS_RAIN\nvec4 R = texture2D(ripplesMap, vTexCoord);\n  if(Q.g < 1.) {\n    L = mix(L, R, .4);\n  }\n  glFragColor = L;\n#endif\n#ifdef HAS_SNOW\nvec3 S = H();\n  glFragColor = vec4(L.rgb + S, L.a);\n#endif\n#ifdef HAS_FOG\nfloat T = Q.r;\n  vec3 U = mix(fogColor, glFragColor.rgb, T);\n  glFragColor = vec4(U, L.a);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}})}};const Wx=[],qx=[.03,.03,.03],Zx=[],Qx=[],Xx=[],Yx=Yp([],Sm([],90,0,0),[0,0,0]);let Jx=class{constructor(t,e){this._regl=t,this._viewport=e,this._init()}_init(){this._shader=new mx({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nvarying vec2 vTexCoord;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\nuniform float rippleRadius;\nuniform float density;\nuniform float time;\nvec3 c(vec2 p) {\n  vec3 q = vec3(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)), dot(p, vec2(419.2, 371.9)));\n  return fract(sin(q) * 43758.5453);\n}\nfloat d(in vec2 x) {\n  vec2 e = x * density / 4000.0;\n  vec2 p = floor(e);\n  vec2 f = fract(e);\n  float h = .0;\n  for(int i = -4; i <= 4; i++)\n    for(int k = -4; k <= 4; k++) {\n      vec2 g = vec2(float(k), float(i));\n      vec3 l = c(p + g);\n      vec2 r = g - f + l.xy;\n      float m = sqrt(dot(r, r));\n      float n = max(mix(smoothstep(.99, .999, max(cos(m - time * 2. + (l.x + l.y) * 5.), 0.)), 0., m), 0.);\n      h += n;\n    }\n  return h;\n}\nvoid main() {\n  vec2 u = vTexCoord;\n  float A = 24. / (rippleRadius * .01);\n  float f = d(A * u) * smoothstep(.0, .4, sin(u.x * 3.151592) * sin(u.y * 3.141592));\n  vec3 B = vec3(-dFdx(f), -dFdy(f), -dFdy(f));\n  glFragColor = vec4(B, 1.);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp(Wx,e.viewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}}),this._shader.version=300,this._fbo=this._regl.framebuffer({color:this._regl.texture({width:this._viewport.width(),height:this._viewport.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._scene=new Y_,this.renderer=new j_(this._regl)}_transformRipples(t){const e=t.coordinateToPointAtRes(t.getCenter(),t.getGLRes()),n=t.getGLScale()/t.getGLScale(this._fixZoom),i=pg(Qx,n,n,n),r=yg(i,qx,i),o=Np(Xx);tg(o,Sm(Zx,0,0,0),[e.x,e.y,0],r),Hp(o,o,Yx),this._mesh.setLocalTransform(o)}_createRipplesMask(t){this._fixZoom=t.getZoom();const e=800*Math.pow(2,16.685648411389433-this._fixZoom),n={};n.POSITION=[-e,0,-e,e,0,-e,-e,0,e,e,0,e],n.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],n.TEXCOORD_0=[0,0,1,0,0,1,1,1];const i=new Jv(n,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});i.generateBuffers(this._regl);const r=new T_;return new z_(i,r)}render(t,e){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._mesh=this._mesh||this._createRipplesMask(t),this._scene.setMeshes(this._mesh),this._transformRipples(t),this.renderer.render(this._shader,{projMatrix:e.projMatrix,viewMatrix:e.viewMatrix,time:e.time,rippleRadius:e.rippleRadius,density:e.density},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const t=dv(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,e=dv(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===t&&this._fbo.height===e||this._fbo.resize(t,e)}};var Kx="attribute vec3 aPosition;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\n#ifdef HAS_VIDEO\nattribute vec2 aTexCoord;\nvarying vec2 uv;\n#endif\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = c * getPosition(aPosition);\n  gl_Position = projViewModelMatrix * d;\n#ifdef HAS_VIDEO\nuv = aTexCoord;\n#endif\n}";const $x=[0,0,0,1];let tb=class{constructor(t,e){this.regl=t,this._viewport=e,this.renderer=new j_(t),this._init()}_init(){this._maskColorFbo=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._maskModeFbo=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"nearest",min:"nearest"}),depth:!0});const t=[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp([],e.projViewMatrix,e.modelMatrix)}];this._maskColorShader=new mx({vert:Kx,frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec4 maskColor;\n#ifdef HAS_VIDEO\nuniform sampler2D maskTexture;\nvarying vec2 uv;\n#endif\nvoid main() {\n  \n#ifdef HAS_VIDEO\ngl_FragColor = texture2D(maskTexture, uv);\n  gl_FragColor.a = maskColor.a;\n#else\ngl_FragColor = maskColor;\n#endif\n}",uniforms:t,extraCommandProps:{viewport:this._viewport}}),this._maskModeShader=new mx({vert:Kx,frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float maskMode;\n#ifdef HAS_MASK_FLAT\nuniform float flatHeight;\n#endif\n#ifdef HAS_MASK_COLOR\nuniform vec2 heightRange;\n#endif\nvoid main() {\n  \n#if defined(HAS_MASK_FLAT)\ngl_FragColor = vec4(maskMode, flatHeight, .0, 1.);\n#elif defined(HAS_MASK_COLOR)\ngl_FragColor = vec4(maskMode, .0, heightRange.x, heightRange.y);\n#else\ngl_FragColor = vec4(maskMode, .0, .0, .0);\n#endif\n}",uniforms:t,extraCommandProps:{viewport:this._viewport}}),this._scene=new Y_}render(t,e){this._resize(),this.renderer.clear({color:$x,depth:1,framebuffer:this._maskColorFbo}),this.renderer.clear({color:$x,depth:1,framebuffer:this._maskModeFbo}),this._scene.setMeshes(t);const n={projViewMatrix:e};return this.renderer.render(this._maskColorShader,n,this._scene,this._maskColorFbo),this.renderer.render(this._maskModeShader,n,this._scene,this._maskModeFbo),{colorExtent:this._maskColorFbo,modeExtent:this._maskModeFbo}}_resize(){const t=dv(this._viewport.width)?this._viewport.width():this._viewport.width.data(),e=dv(this._viewport.height)?this._viewport.height():this._viewport.height.data();!this._maskColorFbo||this._maskColorFbo.width===t&&this._maskColorFbo.height===e||(this._maskColorFbo.resize(t,e),this._maskModeFbo.resize(t,e))}dispose(){this._maskColorFbo&&(this._maskColorFbo.destroy(),delete this._maskColorFbo),this._maskModeFbo&&(this._maskModeFbo.destroy(),delete this._maskModeFbo),this._maskColorShader&&(this._maskColorShader.dispose(),delete this._maskColorShader),this._maskModeShader&&(this._maskModeShader.dispose(),delete this._maskModeShader)}};const eb=[],nb={width:4,type:"float"};let ib=class{constructor(t,e,n){this._regl=t,this.joints=e,this.inverseBindMatrices=[],this.jointMatrices=[],this.jointData=new Float32Array(16*e.length);for(let i=0;i<e.length;++i)this.inverseBindMatrices.push(new Float32Array(n.buffer,n.byteOffset+16*Float32Array.BYTES_PER_ELEMENT*i,16)),this.jointMatrices.push(new Float32Array(this.jointData.buffer,16*Float32Array.BYTES_PER_ELEMENT*i,16));this.jointTextureSize=[4,6]}update(t,e,n){Bp(eb,t);for(let r=0;r<this.joints.length;++r){const t=this.jointMatrices[r];Hp(t,eb,e[this.joints[r].nodeIndex]),Hp(t,t,this.inverseBindMatrices[r])}nb.height=this.joints.length,nb.data=this.jointData;const i=nb;return n?n(i):n=this._regl.texture(i),n}};const rb=[0,0,0],ob=[0,0,0,1],sb=[1,1,1],ab=[];let hb=class{constructor(t=[0,0,0],e=[0,0,0,1],n=[1,1,1]){this.translation=t,this.rotation=e,this.scale=n}getMatrix(){return tg(ab,this.rotation,this.translation,this.scale)}decompose(t){Jp(this.translation,t),$p(this.rotation,t),Kp(this.scale,t)}update(t){t&&(t.translation&&!Og(t.translation,rb)&&dg(this.translation,t.translation),t.rotation&&!Ym(t.rotation,ob)&&Nm(this.rotation,t.rotation),t.scale&&!Og(t.scale,sb)&&dg(this.scale,t.scale))}},lb=class{constructor(t){this._init(t)}_init(t){this.bbox=t.bbox,this.geometry=t.geometry,this.nodeMatrix=t.nodeMatrix,this.materialInfo=t.materialInfo,this.extraInfo=t.extraInfo,this.animationMatrix=t.animationMatrix,this.morphWeights=t.morphWeights,this.skin=t.skin,this.nodeIndex=t.nodeIndex}copyEdgeGeometry(){this.copyGeometry||(this.copyGeometry=this._copyEdgeGeometry(this.geometry))}createCopyBarycentric(){this.copyGeometry&&!this.copyGeometry.data.aBarycentric&&(this.copyGeometry.buildUniqueVertex(),this.copyGeometry.createBarycentric("aBarycentric"))}_copyEdgeGeometry(t){const e=t.data,n=t.indices||t.elements,i={};for(const a in e)if(a===t.desc.positionAttribute)if(vv(e[a]))i[a]=e[a].slice();else if(e[a].buffer&&e[a].buffer.destroy)i[a]={buffer:e[a].buffer},vv(e[a].array)&&(i[a].array=e[a].array.slice());else{const e=t._getAttributeData(a);i[a]=a!==t.desc.positionAttribute?e:e.slice()}const r=void 0!==n.length?n.slice():n,o=JSON.parse(JSON.stringify(t.desc)),s=new w_(i,r,0,o);return s.properties=t.properties,s}},ub=0;const cb=[];let Ab=class{constructor(t,e){this.gltf=t,this.regl=e,this.geometries=[],e&&(this._emptyTexture=e.texture({width:2,height:2}))}getMeshesInfo(){return this.gltf?(this.geometries.length||(this._createTextures(this.gltf.textures),this._createSkins(this.gltf.skins),this.gltf.scenes[0].nodes.forEach((t=>{this._parserNode(t,this.geometries)})),this._checkBaseColorFactor()),this.geometries):null}getGLTFBBox(){if(!this.gltf)return null;const t=this.geometries;if(!t||!t.length)return null;const e=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0];for(let i=0;i<t.length;i++){const r=t[i].bbox,o=r.min,s=r.max;o[0]<e[0]&&(e[0]=o[0]),o[1]<e[1]&&(e[1]=o[1]),o[2]<e[2]&&(e[2]=o[2]),s[0]>n[0]&&(n[0]=s[0]),s[1]>n[1]&&(n[1]=s[1]),s[2]>n[2]&&(n[2]=s[2])}return{min:e,max:n}}_createSkins(t){if(t){this._skinMap={};for(let e=0;e<t.length;e++){const n=t[e];n.joints=n.joints.map((t=>this.gltf.nodes[t])),this._skinMap[e]=new ib(this.regl,n.joints,n.inverseBindMatrices.array),delete n.inverseBindMatrices}}}_createTextures(t){if(t){this._textureMap={};for(let e=0;e<t.length;e++){const n=t[e];this._textureMap[e]||(this._textureMap[e]=this._toTexture(n),delete n.image)}}}_checkBaseColorFactor(){if(!this._checkBaseColorFactorAlpha())for(let t=0;t<this.geometries.length;t++){const e=this.geometries[t].materialInfo.baseColorFactor;e&&0===e[3]&&(e[3]=1)}}_checkBaseColorFactorAlpha(){for(let t=0;t<this.geometries.length;t++){const e=this.geometries[t].materialInfo.baseColorFactor;if(e&&e[3]>0)return!0}return!1}dispose(){this._emptyTexture&&this._emptyTexture.destroy();const t=this.getMeshesInfo();if(t){t.forEach((t=>{t.geometry.dispose();for(const e in t.materialInfo){const n=t.materialInfo[e];n&&n.destroy&&!n[Nv]&&n.destroy()}}));for(const t in this._textureMap){const e=this._textureMap[t];e&&e.destroy&&!e[Nv]&&e.destroy()}delete this.gltf}}updateAnimation(t,e,n,i,r,o,s,a){const h=this.gltf;if(!h)return;if(ub=h.animations?tp.getAnimationTimeSpan(h,i):null,!ub)return;t-=r;let l=0;l=e||!e&&this._isFirstLoop(t,n,i,r)?t*n*.001%(ub.max-ub.min)+ub.min:t*n*.001+ub.min,h.scenes[0].nodes.forEach((t=>{this._updateNodeMatrix(i,l,t,null,o,a)}));for(const u in this.gltf.nodes){const t=this.gltf.nodes[u],e=o[t.nodeIndex];if(t.skin&&e){const n=t.skin.update(e,o,s[t.nodeIndex]&&s[t.nodeIndex].jointTexture);s[t.nodeIndex]||(s[t.nodeIndex]={jointTextureSize:t.skin.jointTextureSize,numJoints:t.skin.joints.length}),s[t.nodeIndex].jointTexture=n}}}_isFirstLoop(t,e,n,i){const r=this.gltf;return!i||!r||(ub=r.animations?tp.getAnimationTimeSpan(r,n):null,t*e*.001/(ub.max-ub.min)<1)}hasSkinAnimation(){return!!this._isAnimation}_updateNodeMatrix(t,e,n,i,r,o){n.trs&&(o?o.indexOf(Number(n.nodeIndex))>-1&&this._updateNodeTRS(n,e,t):this._updateNodeTRS(n,e,t)),r[n.nodeIndex]=i?Hp(r[n.nodeIndex]||[],i,n.matrix||n.trs.getMatrix()):Fp(r[n.nodeIndex]||[],n.matrix||n.trs.getMatrix()),n.children&&n.children.forEach((i=>{this._updateNodeMatrix(t,e,i,r[n.nodeIndex],r,o)}))}_updateNodeTRS(t,e,n){const i=tp.getAnimationClip(this.gltf,Number(t.nodeIndex),e,n);i.weights&&this._updateMorph(t,i.weights),t.trs.update(i)}_updateMorph(t,e){const n=e.length;if(!t.influencesList){t.influencesList=[];for(let e=0;e<n;e++)t.influencesList[e]=[e,0]}const i=t.influencesList;for(let o=0;o<i.length;o++){const t=i[o];t[0]=o,t[1]=e[o]}i.sort(db);const r=[];for(let o=0;o<8;o++)r[o]=[o,0];for(let o=0;o<8;o++)o<n&&i[o][1]?(r[o][0]=i[o][0],r[o][1]=i[o][1]):(r[o][0]=Number.MAX_SAFE_INTEGER,r[o][1]=0);r.sort(fb),t.geometries.forEach((t=>{const e=t.properties.morphTargets;for(let n=0;n<8;n++){const i=r[n],o=i[0],s=i[1];o!==Number.MAX_SAFE_INTEGER&&s?(t.updateData("POSITION"+n,e["POSITION_"+o].array),t.properties.morphWeights[n]=s):t.properties.morphWeights[n]=0}}))}_parserNode(t,e,n){if(t.isParsed)return;t.nodeMatrix=t.nodeMatrix||Np([]),t.localMatrix=t.localMatrix||Np([]),t.matrix?(t.trs=new hb,t.trs.decompose(t.matrix)):t.trs=new hb(t.translation,t.rotation,t.scale),t.localMatrix=t.trs.getMatrix(),n?Hp(t.nodeMatrix,n,t.matrix||t.localMatrix):Fp(t.nodeMatrix,t.matrix||t.localMatrix);const i=t.nodeMatrix;if(t.children)for(let r=0;r<t.children.length;r++)this._parserNode(t.children[r],e,i);if(fv(t.skin)){this._isAnimation=!0;const e=t.skin;t.trs=new hb,t.skin=this._skinMap[e]}fv(t.mesh)&&(t.mesh=this.gltf.meshes[t.mesh],t.mesh.node=t,t.geometries=t.geometries||[],t.mesh.primitives.forEach((n=>{const r=this._createMaterialInfo(n.material),o=function(t,e,n){const i=t.attributes,r=i.COLOR_0;if(r&&r.array instanceof Float32Array){const t=new Uint8Array(r.array.length);for(let e=0;e<t.length;e++)t[e]=Math.round(255*r.array[e]);r.array=t}else if(r&&(r.array instanceof Uint16Array||r.array instanceof Int16Array||r.array instanceof Uint32Array||r.array instanceof Int32Array)){const t=new Uint8Array(r.array);r.array=t}n&&i.TEXCOORD_0&&!i.TEXCOORD_0&&(i.TEXCOORD_1=i.TEXCOORD_0);const o={};for(const h in i)o[h]=pv({},i[h]),e&&(o[h].buffer=f_(e,i[h],{dimension:i[h].itemSize}));if(t.morphTargets){const t=Iv(o.POSITION)?o.POSITION.itemSize*o.POSITION.count:o.POSITION.array.length;for(let e=0;e<8;e++)o[`POSITION${e}`]||(o[`POSITION${e}`]=new Float32Array(t).fill(0));for(let e=0;e<4;e++)o[`NORMAL${e}`]||(o[`NORMAL${e}`]=new Float32Array(o.NORMAL.array?o.NORMAL.array.length:o.NORMAL.length).fill(0))}let s=t.indices;s&&void 0===s.bufferView&&s.array&&(s=s.array);const a=new Jv(o,s,0,{primitive:mv(t.mode)?t_(t.mode):t.mode,positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",color0Attribute:"COLOR_0"});return t.morphTargets&&(a.properties.morphWeights=[]),t.mode>3&&!a.data.NORMAL&&a.createNormal("NORMAL"),a}(n,this.regl,r.occlusionTexture);o.properties.morphTargets=n.morphTargets,t.geometries.push(o);let s=o.boundingBox.copy();s=s.transform(Np(cb),i);const a={geometry:o,bbox:s,nodeMatrix:i,materialInfo:r,extraInfo:this._createExtralInfo(n.material),animationMatrix:t.trs.getMatrix(),morphWeights:t.weights,nodeIndex:t.nodeIndex};t.skin&&(a.skin={jointTextureSize:[4,6],numJoints:t.skin.joints.length,jointTexture:t.skin.jointTexture});const h=new lb(a);e.push(h)}))),t.isParsed=!0}_createMaterialInfo(t){const e={};if(this.gltf.materials&&this.gltf.materials[t]){const n=this.gltf.materials[t],i=n.pbrMetallicRoughness;if(i){const t=i.metallicRoughnessTexture,n=i.baseColorTexture;n&&(e.baseColorTexture=this._getTexture(n),n.KHR_texture_transform&&(e.khr_offset=n.KHR_texture_transform.offset||[0,0],e.khr_rotation=n.KHR_texture_transform.rotation||0,e.khr_scale=n.KHR_texture_transform.scale||[1,1])),i.baseColorFactor&&(e.baseColorFactor=i.baseColorFactor),t?e.metallicRoughnessTexture=this._getTexture(t):(e.metallicFactor=fv(i.metallicFactor)?i.metallicFactor:1,e.roughnessFactor=fv(i.roughnessFactor)?i.roughnessFactor:1)}const r=n.extensions;if(r&&r.KHR_materials_pbrSpecularGlossiness){const t=r.KHR_materials_pbrSpecularGlossiness;e.name="pbrSpecularGlossiness";for(const n in t)e[n]=fv(t[n].index)?this._getTexture(t[n]):t[n]}n.normalTexture&&(e.normalTexture=this._getTexture(n.normalTexture)),n.occlusionTexture&&(e.occlusionTexture=this._getTexture(n.occlusionTexture)),n.emissiveTexture&&(e.emissiveTexture=this._getTexture(n.emissiveTexture)),n.emissiveFactor&&(e.emissiveFactor=n.emissiveFactor),e.alphaCutoff=n.alphaCutoff||.5,e.doubleSided=n.doubleSided,e.alphaMode=n.alphaMode||"OPAQUE"}return e}_createExtralInfo(t){const e={};if(this.gltf.materials&&this.gltf.materials[t]){const n=this.gltf.materials[t];e.doubleSided=n.doubleSided,e.alphaMode=n.alphaMode||"OPAQUE"}return e}_getTexture(t){const e=t.extensions,n=t.index;if(!fv(n))return null;e&&e.KHR_texture_transform&&(t.KHR_texture_transform=e.KHR_texture_transform);const i=this._textureMap[n];return i.texInfo=t,i}_toTexture(t){if(!t)return this._emptyTexture;const e=t.sampler||{};return new sx({width:t.image.width,height:t.image.height,data:t.image.array,mag:s_(e.magFilter)||"linear",min:h_(e.minFilter)||"linear mipmap linear",wrapS:u_(e.wrapS)||"repeat",wrapT:u_(e.wrapT)||"repeat"})}};function fb(t,e){return t[0]-e[0]}function db(t,e){return Math.abs(e[1])-Math.abs(t[1])}function pb(t,e){const{fetchOptions:n,gltfLoaderOptions:i,urlModifier:r}=e,o=i||{};o.urlModifier=r;const s=t.lastIndexOf("/"),a=t.slice(0,s),h=t.slice(t.lastIndexOf(".")).toLowerCase();return".gltf"===h?kd.getJSON(t,n,r).then((t=>mb(a,t,o))):".glb"===h?kd.getArrayBuffer(t,n,r).then((t=>mb(a,{buffer:t.data,byteOffset:0},o))):null}function gb(t,e){return new Ab(t,e)}function mb(t,e,n){return new tp(t,e,n).load()}var yb=Object.freeze({__proto__:null,exportGLTFPack:gb,load:pb,loadGLTF:mb});const vb=[-1,0,-1,1,0,-1,-1,0,1,1,0,1],_b=[3,1,0,0,2,3],xb=[0,0,1,0,0,1,1,1],bb={vertices:[-.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0],normals:[-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012],indices:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},wb=["cube","plane","pyramid"],Cb={cube:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1])},NORMAL:{array:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1])},TEXCOORD_0:{array:new Int8Array([0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1])}},indices:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]},"plane-cube":{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array(vb)},TEXCOORD_0:{array:new Int8Array(xb)}},indices:new Uint16Array(_b),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60],translation:[0,-60,0]},{mesh:0,scale:[60,60,60],translation:[0,60,0]},{mesh:0,scale:[60,60,60],translation:[60,0,0],rotation:[0,0,.7071067811865475,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[-60,0,0],rotation:[0,0,.7071067811865475,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[0,0,60],rotation:[.7071067811865475,0,0,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[0,0,-60],rotation:[.7071067811865475,0,0,.7071067811865476]}]}]},plane:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array(vb)},NORMAL:{array:new Int8Array([0,1,0,0,1,0,0,1,0,0,1,0])},TEXCOORD_0:{array:new Int8Array(xb)}},indices:new Uint16Array(_b),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]},pyramid:{meshes:[{primitives:[{attributes:{POSITION:{array:new Float32Array(bb.vertices)},NORMAL:{array:new Float32Array(bb.normals)},TEXCOORD_0:{array:new Float32Array(bb.uv)}},indices:new Uint16Array(bb.indices),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]}};let Pb=class{constructor(t,e){this.regl=t,this.resourceMap={},this.options=e||{}}getGLTF(t){return this.resourceMap[t]}loginGLTF(t,e){if(this.resourceMap[t])this.resourceMap[t].refCount+=1;else{if(Cb[t]){const e=function(t){let e=null;return Cb[t]&&(e={meshes:Cb[t].meshes},e.scenes=JSON.parse(JSON.stringify(Cb[t].scenes))),e}(t);this.resourceMap[t]=this._exportGLTFResource(e,t,!1)}else this.resourceMap[t]=e?e(t).then((e=>(this.resourceMap[t]=this._exportGLTFResource(e,t),this.resourceMap[t]))):this._loadGLTFModel(t);this.resourceMap[t].refCount=1}}logoutGLTF(t){if(this.resourceMap[t]&&(this.resourceMap[t].refCount-=1,this.resourceMap[t].refCount<1)){const e=this.resourceMap[t].resources;if(e)for(let t=0;t<e.length;t++)e[t].geometry.dispose(),e[t].copyGeometry&&e[t].copyGeometry.dispose(),e[t].material&&e[t].material.dispose();this.resourceMap[t].gltfPack&&this.resourceMap[t].gltfPack.dispose(),delete this.resourceMap[t]}}isSimpleModel(t){return Cb[t]}addSimpleModel(t,e){var n,i;i=e,"string"==typeof(n=t)&&wb.indexOf(n)<0&&(Cb[n]=i)}removeSimpleModel(t){delete Cb[t]}_exportGLTFResource(t,e,n=!0){if(!t)return null;const i=gb(t,n?this.regl:null),r=i.getMeshesInfo();return{bbox:i.getGLTFBBox(),gltfPack:i,resources:r,json:t.json,refCount:this.resourceMap[e]?this.resourceMap[e].refCount:0}}fetchGLTF(t){return pb(t,this.options).then((t=>t))}_loadGLTFModel(t){return this.fetchGLTF(t).then((e=>(this.resourceMap[t]=this._exportGLTFResource(e,t),this.resourceMap[t])))}};const Mb=function(){const t=[0,0,0],e=90*Math.PI/180,n=[0,0,0,0],i=new Array(16);return function(r,o,s,a,h,l){const u=[sg([],t,[1,0,0],l&&l[0]||[0,-1,0]),sg([],t,[-1,0,0],l&&l[1]||[0,-1,0]),sg([],t,[0,1,0],l&&l[2]||[0,0,1]),sg([],t,[0,-1,0],l&&l[3]||[0,0,-1]),sg([],t,[0,0,1],l&&l[4]||[0,-1,0]),sg([],t,[0,0,-1],l&&l[5]||[0,-1,0])],c={context:{viewMatrix:function(t,e,n){return u[n]},projMatrix:ig(i,e,1,.5,1.1)}};return o&&(c.framebuffer=o.faces?function(t,e,n){return o.faces[n]}:o),r(c)(6,((t,e,i)=>{const l={color:n,depth:1};o&&(l.framebuffer=o.faces?o.faces[i]:o),r.clear(l),s(a),h&&h()})),o}}();var Tb={vertices:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],textures:[1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},Sb="#define SHADER_NAME CUBE_MAP\nattribute vec3 aPosition;\nvarying vec3 vWorldPos;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nvoid main() {\n  vWorldPos = aPosition;\n  gl_Position = projMatrix * viewMatrix * vec4(vWorldPos, 1.);\n}";function Ib(t,e){const n=t[0],i=t[1],r=t[2];return 0===e?1:1===e?n:2===e?i:3===e?r:4===e?n*r:5===e?i*r:6===e?n*i:7===e?3*r*r-1:n*n-i*i}const Eb={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]},Ob=["px","nx","py","ny","pz","nz"],Rb=lx.compile(Lx);function Db(t,e,n,i,r=1,o=!1){const s=t({frag:(o?"#define ENCODE_RGBM\n":"")+"#define SHADER_NAME CUBEMAP\nprecision highp float;\nuniform samplerCube cubeMap;\nuniform float exposure;\nvarying vec3 vWorldPos;\n#ifdef ENCODE_RGBM\nvec4 c(const in vec3 d, const in float e) {\n  if(e <= .0)\n    return vec4(d, 1.);\n  vec4 f;\n  vec3 h = d / e;\n  f.a = clamp(max(max(h.r, h.g), max(h.b, 1e-6)), .0, 1.);\n  f.a = ceil(f.a * 255.) / 255.;\n  f.rgb = h / f.a;\n  return f;\n}\n#endif\nvoid main() {\n  vec4 i = textureCube(cubeMap, vWorldPos);\n  i.rgb *= exposure;\n#ifdef ENCODE_RGBM\ni = c(i.rgb, 7.);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = i;\n#endif\n}",vert:Sb,attributes:{aPosition:Tb.vertices},uniforms:{projMatrix:t.context("projMatrix"),viewMatrix:t.context("viewMatrix"),cubeMap:e,exposure:r},elements:Tb.indices}),a=[],h=t.texture({radius:n,min:"linear",mag:"linear",type:i?"float":"uint8",format:"rgba"}),l=t.framebuffer({radius:n,color:h});return Mb(t,l,s,{size:n},(function(){const e=t.read();if(i){const t=new Uint16Array(e.length);for(let n=0;n<e.length;n++)t[n]=Math.min(ox(e[n]),65504);a.push(t)}else a.push(e)})),s.destroy(),l.destroy(),a}const kb=new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]),Lb=new Int8Array([0,1,0,0,1,1,1,0]);function Fb(t,e,n,i){e=e||256;const r=Nb(n=n||1024,i=i||256),o=t.texture({data:r,width:i,height:n,min:"nearest",mag:"nearest"}),s=t.buffer(kb),a=t.buffer(Lb),h=t.framebuffer({radius:e,colorType:"uint8",colorFormat:"rgba",min:"linear",mag:"linear"}),l=t({frag:"precision highp float;\nvarying vec2 vTexCoords;\nuniform sampler2D distributionMap;\nconst float c = 3.14159265359;\nvec4 d(float a, float b) {\n  a *= 65535.;\n  b *= 65535.;\n  vec4 rgba;\n  rgba[0] = mod(a, 255.);\n  rgba[1] = (a - rgba[0]) / 65280.0;\n  rgba[2] = mod(b, 255.);\n  rgba[3] = (b - rgba[2]) / 65280.0;\n  return rgba;\n}\nvec3 e(float f, vec3 h, float i) {\n  vec4 j = texture2D(distributionMap, vec2(i, f));\n  vec3 k = j.xyz;\n  float l = sign(j.w - .5);\n  float m = sign(j.w - clamp(l, .0, 1.) * 200.0 / 255. - .15);\n  k.x *= l;\n  k.y *= m;\n  vec3 n = abs(h.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 o = normalize(cross(n, h));\n  vec3 u = cross(h, o);\n  vec3 v = o * k.x + u * k.y + h * k.z;\n  return normalize(v);\n}\nfloat A(float B, float i) {\n  float a = i;\n  float C = (a * a) / 2.;\n  float D = B;\n  float E = B * (1. - C) + C;\n  return D / E;\n}\nfloat F(float B, float G, float i) {\n  float I = A(B, i);\n  float J = A(G, i);\n  return J * I;\n}\nvec2 K(float B, float i) {\n  vec3 L;\n  L.x = sqrt(1. - B * B);\n  L.y = .0;\n  L.z = B;\n  float M = .0;\n  float O = .0;\n  vec3 h = vec3(.0, .0, 1.);\n  const int P = 1024;\n  for(int Q = 0; Q < P; ++Q) {\n    vec3 k = e(float(Q) / float(P), h, i);\n    vec3 R = normalize(2. * dot(L, k) * k - L);\n    float G = max(R.z, .0);\n    float S = max(k.z, .0);\n    float T = max(dot(L, k), .0);\n    float B = max(dot(h, L), .0);\n    if(G > .0) {\n      float U = F(B, G, i);\n      float W = (U * T) / (S * B);\n      float X = pow(1. - T, 5.);\n      M += (1. - X) * W;\n      O += X * W;\n    }\n  }\n  M /= float(P);\n  O /= float(P);\n  return vec2(M, O);\n}\nvoid main() {\n  vec2 Y = K(vTexCoords.x, vTexCoords.y);\n  gl_FragColor = d(Y.x, Y.y);\n}",vert:"attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoords;\nvoid main() {\n  vTexCoords = aTexCoord;\n  gl_Position = vec4(aPosition, 1.);\n}",attributes:{aPosition:{buffer:s},aTexCoord:{buffer:a}},uniforms:{distributionMap:o},framebuffer:h,viewport:{x:0,y:0,width:e,height:e},count:kb.length/3,primitive:"triangle strip"});return l(),l.destroy(),s.destroy(),a.destroy(),o.destroy(),h}function Nb(t,e){const n=new Float32Array(t*e*4);for(let i=0;i<t;i++){const{x:r,y:o}=zb(i,t);for(let t=0;t<e;t++){const s=t/e,a=s*s,h=2*Math.PI*r,l=Math.sqrt((1-o)/(1+(a*a-1)*o)),u=Math.sqrt(1-l*l),c=4*(i*e+t),A=u*Math.cos(h),f=u*Math.sin(h);n[c]=Math.abs(255*A),n[c+1]=Math.abs(255*f),n[c+2]=255*l,n[c+3]=(A>0?200:0)+(f>0?55:0)}}return n}function zb(t,e){let n=(t<<16|t>>>16)>>>0;return n=((1431655765&n)<<1|(2863311530&n)>>>1)>>>0,n=((858993459&n)<<2|(3435973836&n)>>>2)>>>0,n=((252645135&n)<<4|(4042322160&n)>>>4)>>>0,n=(((16711935&n)<<8|(4278255360&n)>>>8)>>>0)/4294967296,{x:t/e,y:n}}function Bb(t){return t._gl instanceof WebGL2RenderingContext||t.hasExtension("OES_texture_half_float")}var Hb=Object.freeze({__proto__:null,createIBLMaps:function(t,e={}){const n=e.envTexture,i=e.envCubeSize||512,r=e.sampleSize||1024,o=e.roughnessLevels||256,s=e.prefilterCubeSize||256;let a,h=!1;if(Array.isArray(n)){const e=t.cube({flipY:!0,faces:n});a=function(t,e,n){const i=t({frag:Rb,vert:Sb,attributes:{aPosition:Tb.vertices},uniforms:{hsv:[0,0,0],projMatrix:t.context("projMatrix"),viewMatrix:t.context("viewMatrix"),cubeMap:e,bias:0,size:e.width,environmentExposure:1,backgroundIntensity:1},elements:Tb.indices}),r=t.cube({width:n,height:n,min:"linear",mag:"linear",format:"rgba"}),o=t.framebufferCube({radius:n,color:r});return Mb(t,o,i,{size:n},null,[[0,0,-1],[0,0,-1],[0,0,1],[0,0,1],[0,-1,0],[0,-1,0]]),i.destroy(),o}(t,e,i),e.destroy()}else a=function(t,e,n){if(!Bb(t))throw new Error("HDR is not supported for lack of support for float 16 texture");n=n||512;const i=t({frag:"precision highp float;\n#define PI 3.1415926\nvarying vec3 vWorldPos;\nuniform sampler2D equirectangularMap;\nconst vec2 c = vec2(.1591, .3183);\nvec2 d(vec3 e) {\n  vec2 f = vec2(atan(e.y, e.x), asin(e.z));\n  f *= c;\n  f += .5;\n  return f;\n}\nvoid main() {\n  vec2 f = d(normalize(vWorldPos));\n  vec4 h = texture2D(equirectangularMap, f);\n  gl_FragColor = vec4(h.rgb, 1.);\n}",vert:Sb,attributes:{aPosition:Tb.vertices},uniforms:{projMatrix:t.context("projMatrix"),viewMatrix:t.context("viewMatrix"),equirectangularMap:e},elements:Tb.indices}),r=t.cube({width:n,height:n,min:"linear mipmap linear",mag:"linear",type:"float16",format:"rgba"}),o=t.framebufferCube({radius:n,color:r});return Mb(t,o,i),i.destroy(),o}(t,n,i),h=!0;const{prefilterMap:l,prefilterMipmap:u}=function(t,e,n,i,r,o){const s=function(t,e,n,i,r,o){const s=Nb(i=i||1024,r=r||256),a=t.texture({data:s,width:r,height:i,min:"nearest",mag:"nearest"}),h=t({frag:"#define SHADER_NAME PBR_prefilter\nprecision highp float;\nvarying vec3 vWorldPos;\nuniform samplerCube environmentMap;\nuniform sampler2D distributionMap;\nuniform float roughness;\nuniform float resolution;\nconst float c = 3.14159265359;\nfloat d(vec3 e, vec3 f, float h) {\n  float a = h * h;\n  float i = a * a;\n  float j = max(dot(e, f), .0);\n  float k = j * j;\n  float l = i;\n  float m = (k * (i - 1.) + 1.);\n  m = c * m * m;\n  return l / m;\n}\nvec3 n(float o, vec3 e, float h) {\n  vec4 u = texture2D(distributionMap, vec2(h, o));\n  vec3 f = u.xyz;\n  float v = sign(u.w - .5);\n  float A = sign(u.w - 200.0 / 255. * clamp(v, .0, 1.) - .15);\n  f.x *= v;\n  f.y *= A;\n  vec3 B = abs(e.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 C = normalize(cross(B, e));\n  vec3 D = cross(e, C);\n  vec3 E = C * f.x + D * f.y + e * f.z;\n  return normalize(E);\n}\nvoid main() {\n  vec3 e = normalize(vWorldPos);\n  vec3 F = e;\n  vec3 G = F;\n  const int I = 1024;\n  vec3 J = vec3(.0);\n  float K = .0;\n  for(int L = 0; L < I; ++L) {\n    vec3 f = n(float(L) / float(I), e, roughness);\n    vec3 M = normalize(2. * dot(G, f) * f - G);\n    float O = max(dot(e, M), .0);\n    if(O > .0) {\n      J += textureCube(environmentMap, M).rgb * O;\n      K += O;\n    }\n  }\n  J = J / K;\n  gl_FragColor = vec4(J, 1.);\n}",vert:Sb,attributes:{aPosition:Tb.vertices},uniforms:{projMatrix:t.context("projMatrix"),viewMatrix:t.context("viewMatrix"),environmentMap:e,distributionMap:a,roughness:t.prop("roughness"),resolution:n},elements:Tb.indices,viewport:{x:0,y:0,width:t.prop("size"),height:t.prop("size")}});let l=n;const u=t.texture({radius:n,min:"linear",mag:"linear",type:o?"float":"uint8"}),c=t.framebuffer({radius:n,color:u}),A=Math.log(l)/Math.log(2),f=[];for(let d=0;d<=A;d++){let e=0;Mb(t,c,h,{roughness:d/(A-1),size:l},(function(){const n=t.read({framebuffer:c});let i=n;if(o){i=new Uint16Array(n.length);for(let t=0;t<n.length;t++)i[t]=Math.min(ox(n[t]),65504)}f[e]||(f[e]={mipmap:[]}),f[e].mipmap.push(i),e++})),l/=2,c.resize(l)}return a.destroy(),c.destroy(),h.destroy(),f}(t,e,n,i,r,o);return{prefilterMap:t.cube({radius:n,min:"linear",mag:"linear",type:o?"float16":"uint8",faces:s,format:"rgba"}),prefilterMipmap:s}}(t,a,s,r,o,h);let c;if(!e.ignoreSH){const n=s;c=function(t,e,n){const i=new Array(9),r=[],o=[],s=[];for(let a=0;a<9;a++){const h=[0,0,0];for(let i=0;i<Ob.length;i++){const l=t[i],u=[0,0,0];let c=0,A=0;const f=Eb[Ob[i]];for(let t=0;t<n;t++)for(let i=0;i<e;i++){r[0]=i/(e-1)*2-1,r[1]=t/(n-1)*2-1,r[2]=-1,Pg(r,r),s[0]=r[f[0]]*f[3],s[1]=r[f[1]]*f[4],s[2]=r[f[2]]*f[5],o[0]=l[A++]/255,o[1]=l[A++]/255,o[2]=l[A++]/255;const h=l[A++]/255*7;o[0]*=h,o[1]*=h,o[2]*=h,xg(u,u,o,Ib(s,a)*-r[2]),c+=-r[2]}xg(h,h,u,1/c)}i[a]=_g(h,h,1/6)}return i}(Db(t,l,n,!1,e.environmentExposure,!0),n,n);const i=[];for(let t=0;t<c.length;t++)i.push(...c[t]);c=i}const A={envMap:a,isHDR:h,prefilterMap:l};return c&&(A.sh=c),"array"===e.format&&(A.envMap={width:a.width,height:a.height,faces:Db(t,a,i,h)},A.prefilterMap={width:l.width,height:l.height,faces:u},a.destroy(),l.destroy()),A},generateDFGLUT:Fb,supportFloat16:Bb});const jb={uvScale:[1,1],uvOffset:[0,0],uvRotation:0,textureOrigin:null,textureWidth:null,baseColorFactor:[1,1,1,1],emissiveFactor:[0,0,0],baseColorIntensity:1,emitColorFactor:1,occlusionFactor:1,roughnessFactor:.4,metallicFactor:0,normalMapFactor:1,specularF0:.5,emitMultiplicative:1,normalMapFlipY:0,outputSRGB:1,baseColorTexture:null,normalTexture:null,occlusionTexture:null,metallicRoughnessTexture:null,emissiveTexture:null,uvOrigin:[0,0],noiseTexture:null,specularAAVariance:20,specularAAThreshold:20,hsv:[0,0,0],contrast:1,bumpTexture:null,bumpScale:.05,bumpMinLayers:5,bumpMaxLayers:20,alphaTest:0};let Ub=class extends T_{constructor(t){const e=pv({},jb);(t.metallicRoughnessTexture||t.metallicRoughnessTexture)&&(e.roughnessFactor=1,e.metallicFactor=1),super(t,e)}appendDefines(t,e){super.appendDefines(t,e);const n=this.uniforms;if(n.GAMMA_CORRECT_INPUT&&(t.GAMMA_CORRECT_INPUT=1),e.data[e.desc.colorAttribute]&&(t.HAS_COLOR=1),e.data[e.desc.color0Attribute]&&(t.HAS_COLOR0=1,t.COLOR0_SIZE=e.getColor0Size()),e.data[e.desc.tangentAttribute]?t.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(t.HAS_NORMAL=1),e.data.aVertexColorType&&(t.HAS_VERTEX_COLOR=1),!e.data[e.desc.uv0Attribute])return t;n.baseColorTexture&&(t.HAS_ALBEDO_MAP=1),n.metallicRoughnessTexture&&(t.HAS_METALLICROUGHNESS_MAP=1),n.occlusionTexture&&e.data[e.desc.uv1Attribute]&&(t.HAS_AO_MAP=1),n.emissiveTexture&&(t.HAS_EMISSIVE_MAP=1),n.normalTexture&&(t.HAS_NORMAL_MAP=1),n.bumpTexture&&(t.HAS_BUMP_MAP=1),n.skinTexture&&(t.HAS_SKIN_MAP=1),(t.HAS_ALBEDO_MAP||t.HAS_METALLICROUGHNESS_MAP||t.HAS_AO_MAP||t.HAS_EMISSIVE_MAP||t.HAS_NORMAL_MAP||t.HAS_BUMP_MAP||t.HAS_SKIN_MAP)&&(t.HAS_MAP=1),n.noiseTexture&&(t.HAS_RANDOM_TEX=1),e.data[e.desc.tangentAttribute]?t.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(t.HAS_NORMAL=1);const i=n.alphaMode&&n.alphaMode.toUpperCase();return"MASK"===i?t.ALPHA_MODE=1:"OPAQUE"===i&&(t.ALPHA_MODE=2),t}},Gb=class extends(k_(Ub)){};function Vb(t,e,n){if(n.ambientUpdate){const{iblTexes:i}=t,r=n.target;i?(Zb(i),t.iblTexes=qb(e,r)):t.iblTexes=qb(e,r),r.getRenderer().setToRedraw()}}const Wb=[0,0];function qb(t,e){const n=e.getLightManager(),i=n&&n.getAmbientResource();if(!i)return null;const r=i.isHDR;return{prefilterMap:t.cube({width:i.prefilterMap.width,height:i.prefilterMap.height,faces:i.prefilterMap.faces,min:"linear",mag:"linear",format:"rgba",type:r?"float16":"uint8"}),envMap:t.cube({width:i.envMap.width,height:i.envMap.height,faces:i.envMap.faces,min:"linear",mag:"linear",format:"rgba",type:r?"float16":"uint8"}),sh:i.sh}}function Zb(t){for(const e in t)t[e]&&t[e].destroy&&t[e].destroy(),delete t[e]}var Qb=Object.freeze({__proto__:null,createIBLTextures:qb,disposeIBLTextures:Zb,getIBLResOnCanvas:function(t){const{dfgLUT:e,iblTexes:n}=t;return{dfgLUT:e,iblTexes:n}},getPBRUniforms:function(t,e,n,i,r){const o=t.viewMatrix,s=t.projMatrix,a=t.cameraPosition,h=t.getRenderer().canvas,l=function(t,e){const n=t.getLightManager(),i=n&&n.getAmbientResource(),r=n&&n.getAmbientLight()||{},o=n&&n.getDirectionalLight()||{};let s;if(i){const t=e.prefilterMap.width,n=Math.log(t)/Math.log(2);s={prefilterMap:e.prefilterMap,diffuseSPH:e.sh,prefilterMiplevel:[n,n],prefilterSize:[t,t],hdrHSV:r.hsv||[0,0,0]}}else s={ambientColor:r.color||[.2,.2,.2]};return s.environmentExposure=mv(r.exposure)?r.exposure:1,s.environmentOrientation=r.orientation||0,s.light0_diffuse=[...o.color||[1,1,1],1],s.light0_viewDirection=o.direction||[1,1,-1],s}(t,e),u=pv({viewMatrix:o,projMatrix:s,projViewMatrix:t.projViewMatrix,cameraPosition:a,outSize:[h.width,h.height],cameraNearFar:[t.cameraNear,t.cameraFar]},l);return u.brdfLUT=n,i&&i.renderUniforms&&pv(u,i.renderUniforms),u.halton=r||Wb,u},isSupported:function(t){return t.hasExtension("EXT_shader_texture_lod")},loginIBLResOnCanvas:function(t,e,n){if(!t.dfgLUT&&(t.dfgLUT=Fb(e),t.dfgLUT.mtkRefCount=0,n)){const i=(...n)=>Vb.call(this,t,e,...n);n.on("updatelights",i),t._iblResListener=i}t.dfgLUT.mtkRefCount++;const i=n.getLightManager();return i&&i.getAmbientResource()?(t.iblTexes||(t.iblTexes=qb(e,n)),{dfgLUT:t.dfgLUT,iblTexes:t.iblTexes}):{dfgLUT:t.dfgLUT,iblTexes:null}},logoutIBLResOnCanvas:function(t,e){let n=!1;t.dfgLUT&&(t.dfgLUT.mtkRefCount--,t.dfgLUT.mtkRefCount<=0)&&(n=!0,e&&e.off("updatelights",t._iblResListener),t.dfgLUT.destroy(),delete t.dfgLUT),t.iblTexes&&n&&(Zb(t.iblTexes),delete t.iblTexes)}});let Xb=class extends mx{constructor(t){super({vert:"attribute vec3 aPosition;\nuniform mat4 lightProjViewModelMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\n#include <line_extrusion_vert>\n#include <get_output>\nvarying vec4 vPosition;\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 d = getLineExtrudePosition(aPosition);\n  vec4 e = getPosition(d);\n#else\nvec4 e = getPosition(aPosition);\n#endif\ngl_Position = lightProjViewModelMatrix * c * e;\n  vPosition = gl_Position;\n}",frag:"#define SHADER_NAME vsm_mapping\n#ifdef USE_VSM\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\nvarying vec4 vPosition;\n#ifdef PACK_FLOAT\n#include <common_pack_float>\n#endif\nvoid main() {\n  \n#if defined(USE_VSM)\nfloat c = vPosition.z / vPosition.w;\n  c = c * .5 + .5;\n  float d = c;\n  float e = c * c;\n  float f = dFdx(c);\n  float h = dFdy(c);\n  e += .25 * (f * f + h * h);\n  gl_FragColor = vec4(d, e, c, .0);\n#endif\n#if defined(USE_ESM)\n#ifdef PACK_FLOAT\ngl_FragColor = common_encodeDepth(gl_FragCoord.z);\n#else\ngl_FragColor = vec4(gl_FragCoord.z, .0, .0, 1.);\n#endif\n#endif\n}",uniforms:[{name:"lightProjViewModelMatrix",type:"function",fn:function(t,e){return Hp([],e.lightProjViewMatrix,e.modelMatrix)}}],extraCommandProps:{},defines:t})}filter(t){return t.castShadow}},Yb=class extends bx{constructor({blurOffset:t}){super({vert:vx,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\n#include <common_pack_float>\nvoid main() {\n  float c = .0;\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      float f = common_decodeDepth(texture2D(textureSource, e));\n      float s = max(.0, sign(1. - f));\n      d += sign(f) * s;\n      c += f;\n    }\n  float h = c / max(1., d);\n  gl_FragColor = common_encodeDepth(h);\n}",defines:{BOXBLUR_OFFSET:t||2}}),this._blurOffset=t||2}getMeshCommand(t,e){const n="box_shadow_blur_"+this._blurOffset;return this.commands[n]||(this.commands[n]=this.createREGLCommand(t,null,e.getElements())),this.commands[n]}},Jb=null,Kb=null,$b=class{constructor(t,{width:e,height:n,blurOffset:i,defines:r}){this.renderer=t,this.width=e||512,this.height=n||512,this.blurOffset=Av(i)?2:i,this._init(r)}render(t,{cameraProjViewMatrix:e,lightDir:n,farPlane:i,cameraLookAt:r}){return{lightProjViewMatrix:this._renderShadow(t,e,n,i,r),shadowMap:this.blurTex||this.depthTex,depthFBO:this.depthFBO,blurFBO:this.blurFBO}}resize(t,e){return this.depthTex&&(this.depthTex.resize(t,e),this.depthFBO.resize(t,e)),this.width=t,this.blurFBO&&(this.blurTex.resize(t,e),this.blurFBO.resize(t,e)),this.height=e,this}_renderShadow(t,e,n,i,r){const o=this.renderer,s=Jb(e);if(i)for(let h=4;h<8;h++)s[h]=i[h-4];const a=Kb(r,s,n);return o.clear({color:[1,0,0,1],depth:1,framebuffer:this.depthFBO}),o.render(this.shadowMapShader,{lightProjViewMatrix:a},t,this.depthFBO),this.blurFBO&&(this.boxBlurShader||(this.boxBlurShader=new Yb({blurOffset:this.blurOffset})),o.clear({color:[1,0,0,1],depth:1,framebuffer:this.blurFBO}),o.render(this.boxBlurShader,{resolution:[this.depthTex.width,this.depthTex.height],textureSource:this.depthTex},null,this.blurFBO)),a}_init(t){const e=this.renderer.regl,n="uint8",i=this.width,r=this.height;this.depthTex=e.texture({width:i,height:r,format:"rgb",type:n,min:"nearest",mag:"nearest"}),this.shadowMapShader=new Xb(t),this.shadowMapShader.filter=t=>t.castShadow,this.depthFBO=e.framebuffer({color:this.depthTex}),this.blurOffset<=0||(this.blurTex=e.texture({width:i,height:r,format:"rgb",type:n,min:"linear",mag:"linear"}),this.blurFBO=e.framebuffer({color:this.blurTex}))}dispose(){this.depthTex&&(this.depthTex.destroy(),this.depthFBO.destroy(),delete this.depthTex,delete this.depthFBO),this.blurTex&&(this.blurTex.destroy(),this.blurFBO.destroy(),delete this.blurTex,delete this.blurFBO),this.shadowMapShader&&(this.shadowMapShader.dispose(),delete this.shadowMapShader),this.boxBlurShader&&(this.boxBlurShader.dispose(),delete this.boxBlurShader)}};Jb=function(){const t=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1]],e=new Array(16);return function(n){Bp(e,n);const i=[];for(let r=0;r<t.length;r++){const n=om([],t[r],e);Jg(n,n,1/n[3]),i.push(n)}return i}}(),Kb=function(){let t=new Array(4);const e=new Array(3),n=[0,0,0,0],i=[0,1,0],r=new Array(3);let o=new Array(16),s=new Array(16);const a=new Array(16),h=[1,1,1],l=[0,0,0];return function(u,c,A){qg(n,...u,1),_g(e,A,-1),o=sg(o,gg(r,n,Pg(r,e)),n,i),om(t,c[0],o);let f=t[2],d=t[2],p=t[0],g=t[0],m=t[1],y=t[1];for(let e=1;e<8;e++)t=om(t,c[e],o),t[2]>d&&(d=t[2]),t[2]<f&&(f=t[2]),t[0]>g&&(g=t[0]),t[0]<p&&(p=t[0]),t[1]>y&&(y=t[1]),t[1]<m&&(m=t[1]);s=og(s,-1,1,-1,1,-d,-f);const v=h[0]=2/(g-p),_=h[1]=-2/(y-m);l[0]=-.5*(p+g)*v,l[1]=-.5*(m+y)*_,Np(a),jp(a,a,l),Up(a,a,h);const x=Hp(s,a,s);return Hp(new Array(16),x,o)}}();let tw=class extends mx{constructor(t){super({vert:"#define SHADER_NAME SHADOW_DISPLAY\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 halton;\nuniform vec2 globalTexSize;\nvarying vec4 vPosition;\n#include <vsm_shadow_vert>\nvoid main() {\n  vec4 c = vec4(aPosition, 1.);\n  vec4 d = modelViewMatrix * c;\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / globalTexSize.xy;\n  gl_Position = e * d;\n  vPosition = gl_Position;\n  shadow_computeShadowPars(c);\n}",frag:"#define SHADER_NAME SHADOW_DISPLAY\nprecision mediump float;\nuniform vec3 color;\n#include <vsm_shadow_frag>\nvoid main() {\n  float c = shadow_computeShadow();\n  float d = 1. - c;\n  gl_FragColor = vec4(color * d, d);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.viewMatrix,e.modelMatrix),n}}],defines:t||{USE_ESM:1},extraCommandProps:{depth:{enable:!0,mask:!1},viewport:{x:0,y:0,width:(t,e)=>e.globalTexSize[0],height:(t,e)=>e.globalTexSize[1]}}})}getMeshCommand(t,e){return this.commands.shadow_display||(this.commands.shadow_display=this.createREGLCommand(t,null,e.getElements())),this.commands.shadow_display}};function ew(t){return 256*t[2]*256+256*t[1]+t[0]}const nw=new Uint8Array(4),iw=new Float32Array(nw.buffer);let rw,ow;const sw=[1,1],aw="\n    vec3 unpack(highp float f) {\n        highp vec3 color;\n        color.b = floor(f / 65536.0);\n        color.g = floor((f - color.b * 65536.0) / 256.0);\n        color.r = f - floor(color.b * 65536.0) - floor(color.g * 256.0);\n        // now we have a vec3 with the 3 components in range [0..255]. Let's normalize it!\n        return color / 255.0;\n    }\n",hw=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    uniform float fbo_picking_meshId;\n\n    ${aw}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), fbo_picking_meshId / 255.0);\n    }\n`,lw=`\n    precision highp float;\n\n    uniform int fbo_picking_meshId;\n    varying float vFbo_picking_visible;\n\n    ${aw}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(float(fbo_picking_meshId)), 1.0);\n        // gl_FragColor = vec4(unpack(float(35)), 1.0);\n    }\n`,uw=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    ${aw}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), 1.0);\n    }\n`;let cw=class{constructor(t,{vert:e,uniforms:n,defines:i,extraCommandProps:r},o,s){this._renderer=t,this._fbo=o,this._map=s,this._clearFbo(o),this._vert=e,this._uniforms=n,this._defines=i,this._extraCommandProps=pv({},r),delete this._extraCommandProps.blend,delete this._extraCommandProps.stencil,this._currentMeshes=[],this._init()}_init(){const t=[];this._uniforms&&t.push(...this._uniforms);const e={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const o in this._defines)e[o]=this._defines[o];const n=this._vert,i=this._extraCommandProps;this._shader0=new mx({vert:n,frag:hw,uniforms:t,defines:e,extraCommandProps:i}),this._shader2=new mx({vert:n,frag:uw,uniforms:t,defines:e,extraCommandProps:i});const r={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const o in this._defines)r[o]=this._defines[o];this._shader1=new mx({vert:n,frag:lw,uniforms:t,defines:r,extraCommandProps:i}),this._depthShader=new mx({vert:n,frag:"\n    #ifdef GL_ES\n        precision highp float;\n    #endif\n    #if __VERSION__ == 100 && defined(GL_EXT_frag_depth)\n        #extension GL_EXT_frag_depth : enable\n    #endif\n    #include <gl2_frag>\n    #include <common_pack_float>\n    varying float vFbo_picking_viewZ;\n    uniform float logDepthBufFC;\n    varying float vFbo_picking_fragDepth;\n\n    const float PackUpscale = 256. / 255.;\n    const float UnpackDownscale = 255. / 256.;\n    const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n    const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n    const float ShiftRight8 = 1. / 256.;\n    vec4 packDepthToRGBA(const in float v ) {\n        vec4 r = vec4(fract(v * PackFactors), v);\n        r.yzw -= r.xyz * ShiftRight8;\n        return r * PackUpscale;\n    }\n\n    void main() {\n        float fragDepth = vFbo_picking_fragDepth > 1.0 ? vFbo_picking_fragDepth : vFbo_picking_viewZ + 1.0;\n        #if __VERSION__ == 300 || __VERSION__ == 100 && defined(GL_EXT_frag_depth)\n            gl_FragDepthEXT = log2(fragDepth) * logDepthBufFC * 0.5;\n        #endif\n        vec4 depthColor = packDepthToRGBA(fragDepth - 1.0);\n        glFragColor = common_unpackFloat(dot(depthColor, UnpackFactors));\n        #if __VERSION__ == 100\n            gl_FragColor = glFragColor;\n        #endif\n    }\n",uniforms:t,defines:r,extraCommandProps:i}),this._scene=new Y_,this._scene1=new Y_}filter(){return!0}render(t,e,n=!1){if(!t||!t.length)return this;const i=this._fbo;n&&this.clear(),t=t.filter((t=>t&&t.isValid&&t.isValid())),this._scene.setMeshes(t);const r=this._getShader(t,n);r.filter=this.filter,this._currentShader&&r!==this._currentShader&&this.clear(),this._currentShader=r,t.forEach(((t,e)=>{t.setUniform("fbo_picking_meshId",e+this._currentMeshes.length)}));for(let o=0;o<t.length;o++)this._currentMeshes.push(t[o]);return this._renderer.render(r,e,this._scene,i),this}pickAll(t,e,n,i,r){n=fw(n);const{meshIds:o,pickingIds:s,coords:a,points:h}=this._pick(t,e,n,i,r),l=[];if(s&&o){const t={};for(let e=0;e<o.length;e++){const n=`${s[e]}_${o[e]}`;null==o[e]||null==s[e]||t[n]||(t[n]=!0,l.push({meshId:o[e],pickingId:s[e],point:h[e]||null,coordinate:a[e]||null}))}}return l}pick(t,e,n,i,r={}){n=fw(n);const{meshIds:o,pickingIds:s,width:a,coords:h,points:l}=this._pick(t,e,n,i,r);if(s&&o){const t=[];for(let e=0;e<=n[0];e++)t.push(e),e>0&&t.push(-e);for(let e=0;e<t.length;e++)for(let i=0;i<t.length;i++){const r=(t[i]+n[1])*a+(t[e]+n[0]);if(null!=o[r])return{meshId:o[r],pickingId:s[r],point:l[r]||null,coordinate:h[r]||null}}}return{pickingId:null,meshId:null,point:null}}_pick(t,e,n,i,r={}){const o=this._currentShader,s=this._currentMeshes;if(!o||!s||!s.length)return{pickingId:null,meshId:null,point:null};t=Math.round(t),e=Math.round(e);const a=this._fbo;if(t<=2||t>=a.width-2||e<=2||e>=a.height-2)return{pickingId:null,meshId:null,point:null};const{px:h,py:l,width:u,height:c}=this._getParams(t,e,n,a),A=new Uint8Array(4*u*c),f=this._renderer.regl.read({data:A,x:h,y:l,framebuffer:a,width:u,height:c}),d=[];let p=[];for(let b=0;b<f.length;b+=4){const{pickingId:t,meshId:e}=this._packData(f.subarray(b,b+4),o);d.push(e),p.push(t)}const g={},m=d.filter((t=>null!=t&&!g[t]&&(g[t]=1,!0))).map((t=>s[t]));let y;for(let b=0;b<m.length;b++)if(m[b]&&m[b].geometry){y=m[b];break}if(!y)return{pickingId:null,meshId:null,point:null};const v=y.geometry.desc.pickingIdAttribute;d.length&&o===this._shader1&&(void 0!==y.getUniform("uPickingId")||y.geometry.data[v])&&(p=this._getPickingId(h,l,u,c,A,m,i));const _=[],x=[];if(d.length&&r.returnPoint){const{viewMatrix:n,projMatrix:o}=r,s=this._pickDepth(h,l,u,c,A,m,i);for(let i=0;i<s.length;i++)if(s[i]&&null!=d[i]){const r=this._getWorldPos(t,e,s[i],n,o),a=this._convertPickPoint(r);_.push(r),x.push(a)}else _.push(null),x.push(null)}return{meshIds:d,pickingIds:p,coords:x,points:_,width:u,height:c}}_convertPickPoint(t){const e=this._map;if(!e)return null;const n=e.getGLRes();if(!rw){const t=e.getCenter();ow=new t.constructor(0,0,0);const n=e.coordToPoint(t);rw=new n.constructor(0,0)}rw.set(t[0],t[1]);const i=e.pointAtResToCoord(rw,n,ow),r=e.pointAtResToAltitude(t[2],n);return[i.x,i.y,r]}clear(){return this._fbo&&this._clearFbo(this._fbo),this._currentMeshes=[],delete this._currentShader,this}getMeshAt(t){return this._currentMeshes?this._currentMeshes[t]:null}getRenderedMeshes(){return this._currentMeshes}dispose(){this.clear(),this._shader0&&this._shader0.dispose(),this._shader1&&this._shader1.dispose(),this._shader2&&this._shader2.dispose(),this._scene&&this._scene.clear(),this._scene1&&this._scene1.clear()}_getWorldPos(t,e,n,i,r){const o=this._fbo,s=[],a=o.width/2||1,h=o.height/2||1,l=[(t-a)/a,(h-e)/h,0,1],u=[(t-a)/a,(h-e)/h,1,1],c=Bp(s,r),A=[],f=[];Aw(A,l,c),Aw(f,u,c);const d=-A[2],p=(n-d)/(-f[2]-d),g=Bp(s,Hp(s,r,i)),m=Aw(l,l,g),y=Aw(u,u,g);return[yv(m[0],y[0],p),yv(m[1],y[1],p),yv(m[2],y[2],p)]}_getPickingId(t,e,n,i,r,o,s){const a=this._renderer.regl,h=this._getFBO1();this._clearFbo(h),this._scene1.setMeshes(o),this._renderer.render(this._shader2,s,this._scene1,h);const l=a.read({data:r,x:t,y:e,framebuffer:h,width:n,height:i}),u=[];for(let c=0;c<l.length;c+=4)u.push(ew(l.subarray(c,c+4)));return u}_pickDepth(t,e,n,i,r,o,s){const a=this._renderer.regl,h=this._getFBO1();this._scene1.setMeshes(o),this._clearFbo(h),s.logDepthBufFC=2/(Math.log(this._map.cameraFar+1)/Math.LN2),this._renderer.render(this._depthShader,s,this._scene1,h);const l=a.read({data:r,x:t,y:e,framebuffer:h,width:n,height:i}),u=[];for(let A=0;A<l.length;A+=4)u.push((c=l.subarray(A,A+4),nw[0]=c[3],nw[1]=c[2],nw[2]=c[1],nw[3]=c[0],iw[0]));var c;return u}_packData(t,e){if(255===t[0]&&255===t[1]&&255===t[2]&&255===t[3])return{meshId:null,pickingId:null};let n=null,i=null;return e===this._shader1?i=ew(t):e===this._shader0?(i=t[3],n=ew(t)):(i=null,n=ew(t)),{meshId:i,pickingId:n}}_clearFbo(t){this._renderer.regl.clear({color:[1,1,1,1],depth:1,stencil:0,framebuffer:t})}_getShader(t,e){return e&&t.length<256?this._shader0:this._shader1}_getFBO1(){const t=this._renderer.regl,e=this._fbo;return this._fbo1?this._fbo1.width===e.width&&this._fbo1.height===e.height||this._fbo1.resize(e.width,e.height):this._fbo1=t.framebuffer(e.width,e.height),this._fbo1}_getParams(t,e,n,i){const r=n[0],o=n[1];e=i.height-e;let s=2*r+1,a=2*o+1;const h=(t-=r)+s,l=(e-=o)+a;return h>i.width&&(s-=h-i.width),l>i.height&&(a-=l-i.height),{px:t=t<0?0:t,py:e=e<0?0:e,width:s,height:a}}getPickingVert(){return this._vert}getUniformDeclares(){return this._uniforms}};function Aw(t,e,n){const i=e[0],r=e[1],o=e[2],s=1/(n[3]*i+n[7]*r+n[11]*o+n[15]);return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])*s,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])*s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])*s,t}function fw(t){return mv(t)&&(sw[0]=sw[1]=t,t=sw),t}const dw=t=>t&&t.geometry&&void 0===t.geometry.properties.shaderHash,pw=[],gw=[],mw=[{name:"modelViewMatrix",type:"function",fn:(t,e)=>Hp(pw,e.viewMatrix,e.modelMatrix)},{name:"modelViewProjMatrix",type:"function",fn:(t,e)=>{const n=Hp(pw,e.viewMatrix,e.modelMatrix);return Hp(pw,e.projMatrix,n)}},{name:"modelMatrixInverse",type:"function",fn:(t,e)=>Bp(pw,e.modelMatrix)},{name:"projMatrixInverse",type:"function",fn:(t,e)=>Bp(pw,e.projMatrix)},{name:"modelViewMatrixInverse",type:"function",fn:(t,e)=>(Hp(pw,e.viewMatrix,e.modelMatrix),Bp(pw,pw))},{name:"modelViewProjMatrixInverse",type:"function",fn:(t,e)=>{const n=Hp(pw,e.viewMatrix,e.modelMatrix);return Hp(pw,e.projMatrix,n),Bp(pw,pw)}},{name:"modelInverseTransposeMatrix",type:"function",fn:(t,e)=>{const n=Mp(gw,e.modelMatrix),i=Sp(n,n);return Ip(i,i)}},{name:"modelViewInverseTransposeMatrix",type:"function",fn:(t,e)=>{const n=Hp(pw,e.viewMatrix,e.modelMatrix),i=Mp(gw,n),r=Sp(i,i);return Ip(r,r)}}],yw={LOCAL:"positionMatrix",MODEL:"modelMatrix",VIEW:"viewMatrix",PROJECTION:"projMatrix",MODELVIEW:"modelViewMatrix",MODELVIEWPROJECTION:"modelViewProjMatrix",MODELINVERSE:"modelMatrixInverse",VIEWINVERSE:"viewMatrixInverse",PROJECTIONINVERSE:"projMatrixInverse",MODELVIEWINVERSE:"modelViewMatrixInverse",MODELVIEWPROJECTIONINVERSE:"modelViewProjMatrixInverse",MODELINVERSETRANSPOSE:"modelInverseTransposeMatrix",MODELVIEWINVERSETRANSPOSE:"modelViewInverseTransposeMatrix",VIEWPORT:"viewport",JOINTMATRIX:"jointMatrix",ALPHACUTOFF:"alphaCutoff"};let vw=class{constructor(t,e,n){this._regl=t,this._khrShaders={},this._commandProps=e,this._resLoader=n}getExcludeFilter(){return dw}forEachShader(t){for(const e in this._khrShaders){const n=this._khrShaders[e];t(n.shader,n.filter,n.uniformSemantics)}}createMesh(t,e,n,i){const r=e.extensions.KHR_techniques_webgl,o=e.materials[t.material].extensions.KHR_techniques_webgl,{technique:s,values:a}=o,h=r.techniques[s],l=r.programs[h.program],u=r.shaders[l.vertexShader],c=r.shaders[l.fragmentShader];var A;c.content=(A=c.content)&&A.indexOf("precision")<0?"precision mediump float;\n"+A:A;const f=Ev(u.content)+"-"+Ev(c.content);this._khrShaders[f]||(this._khrShaders[f]=this._createTechniqueShader(f,r,s,this._commandProps,i));const{attributeSemantics:d}=this._khrShaders[f],p=this._createGeometry(t,d,n,f),g=pv({},a);for(const m in a)h.uniforms[m]&&35678===h.uniforms[m].type&&(g[m]=this._getTexture(e.textures[a[m].index]));return{geometry:p,material:new T_(g)}}_createGeometry(t,e,n,i){const r=t.attributes,o="COLOR_0";if(r[o]){const t=r[o].array||r[o];if(t instanceof Float32Array){const e=new Uint8Array(t.length);for(let n=0;n<e.length;n++)e[n]=Math.round(255*t[n]);r[o].array?(r[o].array=e,r[o].componentType=5121):r[o]=e}}const s={};for(const l in r){const t=f_(this._regl,r[l],{dimension:r[l].itemSize}),n=e[l]||l;s[n]={buffer:t},r[l].quantization&&(s[n].quantization=r[l].quantization),n===e.POSITION&&(s[n].array=r[l].array)}const a=new Jv(s,t.indices.array?t.indices.array:t.indices,0,{positionAttribute:e.POSITION,normalAttribute:e.NORMAL,uv0Attribute:e.TEXCOORD_0,uv1Attribute:e.TEXCOORD_1,color0Attribute:e.COLOR_0,tangentAttribute:e.TANGENT,textureCoordMatrixAttribute:e.TextureCoordMatrix,primitive:void 0===t.mode?"triangles":t_(t.mode)});a.generateBuffers(this._regl,{excludeElementsInVAO:n}),a.properties.shaderHash=i;const h=a.data[a.desc.positionAttribute];return h&&h.array&&delete h.array,a}_getTexture(t){const e={type:t.type?n_(t.type):"uint8",format:t.format?r_(t.format):"rgba",flipY:!!t.flipY},n=t.image;n.array?e.data=n.array:n.mipmap&&(e.mipmap=n.mipmap),e.width=n.width,e.height=n.height;const i=t.sampler||t.texture.sampler;return i&&(i.magFilter&&(e.mag=s_(i.magFilter)),i.minFilter&&(e.min=h_(i.minFilter)),i.wrapS&&(e.wrapS=u_(i.wrapS)),i.wrapT&&(e.wrapT=u_(i.wrapT))),new sx(e,this._resLoader)}_createTechniqueShader(t,e,n,i,r){const{techniques:o,programs:s,shaders:a}=e,h=o[n],l=s[h.program],u=a[l.vertexShader].content,c=a[l.fragmentShader].content,A={};for(const g in h.uniforms){const t=h.uniforms[g];t.semantic&&(A[t.semantic]=g)}const f=mw.slice();for(const g in A)f.push({name:A[g],type:"function",fn:(t,e)=>e[yw[g]]});const d=new mx({vert:u,frag:c,uniforms:f,extraCommandProps:i});r&&(d.version=300);const p={};for(const g in h.attributes)p[h.attributes[g].semantic]=g;return{shader:d,filter:e=>e&&e.geometry&&e.geometry.properties.shaderHash===t,uniformSemantics:A,attributeSemantics:p}}dispose(){for(const t in this._khrShaders){const{shader:e}=this._khrShaders[t];e.dispose()}this._khrShaders={}}};var _w={exports:{}};function xw(t,e,n){n=n||2;var i,r,o,s,a,h,l,u=e&&e.length,c=u?e[0]*n:t.length,A=bw(t,0,c,n,!0),f=[];if(!A||A.next===A.prev)return f;if(u&&(A=function(t,e,n,i){var r,o,s,a=[];for(r=0,o=e.length;r<o;r++)(s=bw(t,e[r]*i,r<o-1?e[r+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),a.push(Dw(s));for(a.sort(Iw),r=0;r<a.length;r++)n=Ew(a[r],n);return n}(t,e,A,n)),t.length>80*n){i=o=t[0],r=s=t[1];for(var d=n;d<c;d+=n)(a=t[d])<i&&(i=a),(h=t[d+1])<r&&(r=h),a>o&&(o=a),h>s&&(s=h);l=0!==(l=Math.max(o-i,s-r))?32767/l:0}return Cw(A,f,n,i,r,l,0),f}function bw(t,e,n,i,r){var o,s;if(r===qw(t,e,n,i)>0)for(o=e;o<n;o+=i)s=Gw(o,t[o],t[o+1],s);else for(o=n-i;o>=e;o-=i)s=Gw(o,t[o],t[o+1],s);return s&&Nw(s,s.next)&&(Vw(s),s=s.next),s}function ww(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!Nw(i,i.next)&&0!==Fw(i.prev,i,i.next))i=i.next;else{if(Vw(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function Cw(t,e,n,i,r,o,s){if(t){!s&&o&&function(t,e,n,i){var r=t;do{0===r.z&&(r.z=Rw(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,s,a,h,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,i=n,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,h--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(s>1)}(r)}(t,i,r,o);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,o?Mw(t,i,r,o):Pw(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(h.i/n|0),Vw(t),t=h.next,l=h.next;else if((t=h)===l){s?1===s?Cw(t=Tw(ww(t),e,n),e,n,i,r,o,2):2===s&&Sw(t,e,n,i,r,o):Cw(ww(t),e,n,i,r,o,1);break}}}function Pw(t){var e=t.prev,n=t,i=t.next;if(Fw(e,n,i)>=0)return!1;for(var r=e.x,o=n.x,s=i.x,a=e.y,h=n.y,l=i.y,u=r<o?r<s?r:s:o<s?o:s,c=a<h?a<l?a:l:h<l?h:l,A=r>o?r>s?r:s:o>s?o:s,f=a>h?a>l?a:l:h>l?h:l,d=i.next;d!==e;){if(d.x>=u&&d.x<=A&&d.y>=c&&d.y<=f&&kw(r,a,o,h,s,l,d.x,d.y)&&Fw(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function Mw(t,e,n,i){var r=t.prev,o=t,s=t.next;if(Fw(r,o,s)>=0)return!1;for(var a=r.x,h=o.x,l=s.x,u=r.y,c=o.y,A=s.y,f=a<h?a<l?a:l:h<l?h:l,d=u<c?u<A?u:A:c<A?c:A,p=a>h?a>l?a:l:h>l?h:l,g=u>c?u>A?u:A:c>A?c:A,m=Rw(f,d,e,n,i),y=Rw(p,g,e,n,i),v=t.prevZ,_=t.nextZ;v&&v.z>=m&&_&&_.z<=y;){if(v.x>=f&&v.x<=p&&v.y>=d&&v.y<=g&&v!==r&&v!==s&&kw(a,u,h,c,l,A,v.x,v.y)&&Fw(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,_.x>=f&&_.x<=p&&_.y>=d&&_.y<=g&&_!==r&&_!==s&&kw(a,u,h,c,l,A,_.x,_.y)&&Fw(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;v&&v.z>=m;){if(v.x>=f&&v.x<=p&&v.y>=d&&v.y<=g&&v!==r&&v!==s&&kw(a,u,h,c,l,A,v.x,v.y)&&Fw(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=y;){if(_.x>=f&&_.x<=p&&_.y>=d&&_.y<=g&&_!==r&&_!==s&&kw(a,u,h,c,l,A,_.x,_.y)&&Fw(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function Tw(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!Nw(r,o)&&zw(r,i,i.next,o)&&jw(r,o)&&jw(o,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(o.i/n|0),Vw(i),Vw(i.next),i=t=o),i=i.next}while(i!==t);return ww(i)}function Sw(t,e,n,i,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Lw(s,a)){var h=Uw(s,a);return s=ww(s,s.next),h=ww(h,h.next),Cw(s,e,n,i,r,o,0),void Cw(h,e,n,i,r,o,0)}a=a.next}s=s.next}while(s!==t)}function Iw(t,e){return t.x-e.x}function Ew(t,e){var n=function(t,e){var n,i=e,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==e);if(!n)return null;var h,l=n,u=n.x,c=n.y,A=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&kw(o<c?r:s,o,u,c,o<c?s:r,o,i.x,i.y)&&(h=Math.abs(o-i.y)/(r-i.x),jw(i,t)&&(h<A||h===A&&(i.x>n.x||i.x===n.x&&Ow(n,i)))&&(n=i,A=h)),i=i.next}while(i!==l);return n}(t,e);if(!n)return e;var i=Uw(n,t);return ww(i,i.next),ww(n,n.next)}function Ow(t,e){return Fw(t.prev,t,e.prev)<0&&Fw(e.next,t,t.next)<0}function Rw(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Dw(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function kw(t,e,n,i,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(i-a)>=(n-s)*(e-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function Lw(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&zw(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(jw(t,e)&&jw(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(Fw(t.prev,t,e.prev)||Fw(t,e.prev,e))||Nw(t,e)&&Fw(t.prev,t,t.next)>0&&Fw(e.prev,e,e.next)>0)}function Fw(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Nw(t,e){return t.x===e.x&&t.y===e.y}function zw(t,e,n,i){var r=Hw(Fw(t,e,n)),o=Hw(Fw(t,e,i)),s=Hw(Fw(n,i,t)),a=Hw(Fw(n,i,e));return r!==o&&s!==a||!(0!==r||!Bw(t,n,e))||!(0!==o||!Bw(t,i,e))||!(0!==s||!Bw(n,t,i))||!(0!==a||!Bw(n,e,i))}function Bw(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Hw(t){return t>0?1:t<0?-1:0}function jw(t,e){return Fw(t.prev,t,t.next)<0?Fw(t,e,t.next)>=0&&Fw(t,t.prev,e)>=0:Fw(t,e,t.prev)<0||Fw(t,t.next,e)<0}function Uw(t,e){var n=new Ww(t.i,t.x,t.y),i=new Ww(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function Gw(t,e,n,i){var r=new Ww(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function Vw(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Ww(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qw(t,e,n,i){for(var r=0,o=e,s=n-i;o<n;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}_w.exports=xw,_w.exports.default=xw,xw.deviation=function(t,e,n,i){var r=e&&e.length,o=Math.abs(qw(t,0,r?e[0]*n:t.length,n));if(r)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(qw(t,e[s]*n,s<a-1?e[s+1]*n:t.length,n));var h=0;for(s=0;s<i.length;s+=3){var l=i[s]*n,u=i[s+1]*n,c=i[s+2]*n;h+=Math.abs((t[l]-t[c])*(t[u+1]-t[l+1])-(t[l]-t[u])*(t[c+1]-t[l+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},xw.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[r][o][s]);r>0&&n.holes.push(i+=t[r-1].length)}return n};var Zw=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(_w.exports);const Qw={parseHDR:ix},Xw={PBRHelper:Hb,StandardMaterial:Ub,StandardSpecularGlossinessMaterial:Gb,StandardShader:class extends mx{constructor(t={}){let e=t.extraCommandProps||{};const n=t.uniforms;e=pv({},e);const i=t.defines||{},r=[],o=[],s=[],a=[],h=[],l=[{name:"modelNormalMatrix",type:"function",fn:(t,e)=>Mp(r,e.modelMatrix)},{name:"modelViewNormalMatrix",type:"function",fn:(t,e)=>{const n=Hp(o,e.viewMatrix,e.modelMatrix),i=Bp(n,n),r=zp(i,i);return Mp(s,r)}},{name:"modelViewMatrix",type:"function",fn:(t,e)=>Hp(a,e.viewMatrix,e.modelMatrix)},{name:"environmentTransform",type:"function",fn:(t,e)=>Op(h,Math.PI*(e.environmentOrientation||0)/180)}];n&&l.push(...n),super({vert:t.vert||"#include <gl2_vert>\n#define SHADER_NAME PBR\nprecision highp float;\nattribute vec3 aPosition;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nuniform vec2 uvOrigin;\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nuniform float uvRotation;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#if defined(HAS_AO_MAP)\nattribute vec2 aTexCoord1;\nvarying vec2 vTexCoord1;\n#endif\n#endif\nvec3 c;\nvec3 d;\nvec4 e;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform mediump vec3 cameraPosition;\nuniform mat3 modelNormalMatrix;\n#ifdef HAS_SSR\nuniform mat3 modelViewNormalMatrix;\nvarying vec3 vViewNormal;\n#ifdef HAS_TANGENT\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\nvarying vec3 vModelVertex;\n#if defined(HAS_MAP)\nvarying vec2 vTexCoord;\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\n#endif\nvarying float vOpacity;\n#include <highlight_vert>\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\nvarying vec3 vColor0;\n#else\nattribute vec4 aColor0;\nvarying vec4 vColor0;\n#endif\n#endif\n#include <line_extrusion_vert>\n#include <get_output>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <heatmap_render_vert>\n#include <vertex_color_vert>\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#if __VERSION__ == 100\nmat3 f(in mat3 h) {\n  vec3 i = h[0];\n  vec3 j = h[1];\n  vec3 k = h[2];\n  return mat3(vec3(i.x, j.x, k.x), vec3(i.y, j.y, k.y), vec3(i.z, j.z, k.z));\n}\n#else\nmat3 f(in mat3 h) {\n  return transpose(h);\n}\n#endif\n#endif\nvoid l(const highp vec4 q, out highp vec3 m) {\n  m = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid l(const highp vec4 q, out highp vec3 m, out highp vec3 t) {\n  l(q, m);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nconst float o = .5;\nvec2 u(vec2 v, float A) {\n  return vec2(cos(A) * (v.x - o) + sin(A) * (v.y - o) + o, cos(A) * (v.y - o) - sin(A) * (v.x - o) + o);\n}\n#if defined(HAS_MAP)\nvec2 B(vec2 v) {\n  vec2 C = decode_getTexcoord(v);\n#ifdef HAS_RANDOM_TEX\nvec2 D = uvOrigin;\n  vec2 E = C * uvScale + uvOffset;\n  return mod(D, 1.) + E;\n#else\nvec2 D = uvOrigin;\n  vec2 E = C * uvScale;\n  if(uvRotation != .0) {\n    D = u(D, uvRotation);\n    E = u(E, uvRotation);\n  }\n  return mod(D, 1.) + E + uvOffset;\n#endif\n}\n#endif\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\n#include <excavate_vert>\nvoid main() {\n  mat4 F = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 G = getLineExtrudePosition(aPosition);\n  vec4 H = getPosition(G);\n#else\nvec4 H = getPosition(aPosition);\n#endif\nvModelVertex = (modelMatrix * H).xyz;\n  vec4 I = F * H;\n  vec4 J = modelViewMatrix * I;\n  vViewVertex = J;\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(I, modelMatrix);\n#else\ngl_Position = projMatrix * J;\n#endif\n#ifdef PICKING_MODE\nfloat K = 1.;\n#if defined(HAS_COLOR)\nK *= aColor.a;\n#endif\n#if defined(HAS_COLOR0) && COLOR0_SIZE == 4\nK *= aColor0.a;\n#endif\nfbo_picking_setData(gl_Position.w, K != .0);\n#else\n#if defined(HAS_MAP)\nvTexCoord = B(aTexCoord);\n#ifdef HAS_AO_MAP\nvTexCoord1 = B(aTexCoord1);\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\n#endif\n#if defined(HAS_TANGENT) || defined(HAS_NORMAL)\nmat3 L = mat3(F);\n  mat3 M = modelNormalMatrix * L;\n#if defined(HAS_TANGENT)\nvec3 t;\n  l(aTangent, d, t);\n  vModelTangent = vec4(M * t, aTangent.w);\n#else\nd = decode_getNormal(aNormal);\n#endif\nvec3 N = d;\n  vModelNormal = M * N;\n#else\nd = vec3(.0);\n  vModelNormal = vec3(.0);\n#endif\n#if defined(HAS_TANGENT)\nvModelBiTangent = cross(vModelNormal, vModelTangent.xyz) * sign(aTangent.w);\n#endif\n#ifdef HAS_SSR\nmat3 O = modelViewNormalMatrix * L;\n  vViewNormal = O * d;\n#if defined(HAS_TANGENT)\nvec4 P = vec4(t, aTangent.w);\n  vViewTangent = vec4(O * P.xyz, P.w);\n#endif\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\nhighlight_setVarying();\n#if defined(HAS_COLOR0)\nvColor0 = aColor0 / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(I);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * F, H);\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nmat3 Q = f(mat3(vModelTangent.xyz, vModelBiTangent, vModelNormal));\n  vTangentViewPos = Q * cameraPosition;\n  vTangentFragPos = Q * vModelVertex;\n#endif\n#ifdef HAS_VERTEX_COLOR\nvertexColor_update();\n#endif\n#ifdef HAS_EXCAVATE_ANALYSIS\nvCoordinateTexcoord = getCoordinateTexcoord();\n  vHeight = getWorldHeight();\n#endif\n#endif\n}",frag:t.frag||"#define PI 3.141593\n#define RECIPROCAL_PI 1.0\n#if __VERSION__ == 100\n#if defined(GL_EXT_shader_texture_lod)\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\n#define saturate(x)        clamp(x, 0.0, 1.0)\nprecision mediump float;\n#include <gl2_frag>\n#include <hsv_frag>\n#include <srgb_frag>\nuniform vec3 hsv;\nuniform float contrast;\nstruct MaterialUniforms {\n  vec2 roughnessMetalness;\n  vec3 albedo;\n  float alpha;\n  vec3 normal;\n  vec3 emit;\n  float ao;\n  vec3 specularColor;\n  float glossiness;\n  vec4 skinColor;\n} c;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform vec3 cameraPosition;\nuniform float alphaTest;\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\nuniform float glossinessFactor;\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\nuniform vec3 emissiveFactor;\nuniform vec4 baseColorFactor;\nuniform float baseColorIntensity;\nuniform float emitColorFactor;\nuniform float occlusionFactor;\nuniform float environmentExposure;\nuniform float roughnessFactor;\nuniform float metallicFactor;\nuniform float normalMapFactor;\nuniform float specularF0;\nuniform int emitMultiplicative;\nuniform int normalMapFlipY;\nuniform int outputSRGB;\nuniform mat3 environmentTransform;\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nuniform sampler2D metallicRoughnessTexture;\n#endif\n#if defined(HAS_EMISSIVE_MAP)\nuniform sampler2D emissiveTexture;\n#endif\n#if defined(HAS_AO_MAP)\nuniform sampler2D occlusionTexture;\nvarying vec2 vTexCoord1;\n#endif\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nuniform sampler2D normalTexture;\n#endif\n#if defined(HAS_SKIN_MAP)\nuniform sampler2D skinTexture;\n#endif\n#if defined(ALPHA_MODE) && ALPHA_MODE == 1\nuniform float alphaCutoff;\n#endif\n#ifdef HAS_RANDOM_TEX\nuniform highp vec2 uvOrigin;\nuniform sampler2D noiseTexture;\n#endif\nuniform sampler2D brdfLUT;\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform vec3 diffuseSPH[9];\nuniform vec2 prefilterMiplevel;\nuniform vec2 prefilterSize;\n#else\nuniform vec3 ambientColor;\n#endif\nuniform vec2 cameraNearFar;\nuniform vec3 light0_viewDirection;\nuniform vec4 light0_diffuse;\n#ifdef HAS_SSR\nvarying vec3 vViewNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelVertex;\nvarying vec4 vViewVertex;\n#if defined(HAS_MAP)\n#include <computeTexcoord_frag>\n#endif\nvarying vec3 vModelNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvarying vec3 vColor0;\n#else\nvarying vec4 vColor0;\n#endif\n#endif\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef HAS_LAYER_OPACITY\nuniform float layerOpacity;\n#endif\nvarying float vOpacity;\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\nuniform float currentTime;\nuniform float animSpeedScale;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatternGapColor;\nuniform vec2 uvScale;\nvarying float vPatternHeight;\nvarying float vLinesofar;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvec2 d(vec2 e) {\n  vec2 f = mod(e, 1.);\n  vec2 h = vTexInfo.xy;\n  vec2 i = vTexInfo.zw;\n  return (h + f * i) / atlasSize;\n}\n#endif\n#include <heatmap_render_frag>\n#include <snow_frag>\n#include <mask_frag>\n#include <terrain_normal_frag>\n#include <vertex_color_frag>\n#include <excavate_frag>\n#ifdef HAS_RANDOM_TEX\nconst float j = .5;\nvec2 k(vec2 f, float l) {\n  return vec2(cos(l) * (f.x - j) + sin(l) * (f.y - j) + j, cos(l) * (f.y - j) - sin(l) * (f.x - j) + j);\n}\nfloat m(vec3 n) {\n  return n.x + n.y + n.z;\n}\n#endif\nvec4 o(sampler2D u, in vec2 f) {\n  \n#ifdef HAS_RANDOM_TEX\nhighp vec2 A = uvOrigin;\n  highp vec2 B = f + A - mod(A, 1.);\n  float C = texture2D(noiseTexture, .005 * B).x;\n  vec2 D = dFdx(B);\n  vec2 E = dFdx(B);\n  float F = C * 8.;\n  float G = fract(F);\n#if 1\nfloat H = floor(F);\n  float I = H + 1.;\n#else\nfloat H = floor(F + .5);\n  float I = floor(F);\n  G = min(G, 1. - G) * 2.;\n#endif\nvec2 J = sin(vec2(3., 7.) * H);\n  vec2 K = sin(vec2(3., 7.) * I);\n  float L = .5;\n  vec4 M = texture2DGradEXT(u, f + L * J, D, E);\n  vec4 N = texture2DGradEXT(u, f + L * K, D, E);\n  return mix(M, N, smoothstep(.2, .8, G - .1 * m(M.xyz - N.xyz)));\n#else\nreturn texture2D(u, f);\n#endif\n}\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nuniform sampler2D bumpTexture;\nuniform float bumpScale;\nuniform float bumpMaxLayers;\nuniform float bumpMinLayers;\nvec2 O(vec2 f, vec3 P) {\n  float Q = mix(bumpMaxLayers, bumpMinLayers, abs(dot(vec3(.0, .0, 1.), P)));\n  float R = 1. / Q;\n  float S = .0;\n  vec2 T = P.xy * bumpScale / (P.z * Q);\n  vec2 U = f;\n  float V = o(bumpTexture, U).r;\n  for(int W = 0; W < 30; W++) {\n    S += R;\n    U -= T;\n    V = o(bumpTexture, U).r;\n    if(V < S) {\n      break;\n    }\n  }\n  vec2 X = U + T;\n  float Y = V - S;\n  float Z = o(bumpTexture, X).r - S + R;\n  return mix(U, X, Y / (Y - Z));\n}\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#endif\n#define SHADER_NAME PBR\nvec3 ba() {\n  return c.albedo;\n}\nfloat bb() {\n  return c.alpha;\n}\nfloat bc() {\n  return c.roughnessMetalness.y;\n}\nfloat bd() {\n  \n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn 1. - c.glossiness;\n#else\nreturn c.roughnessMetalness.x;\n#endif\n}\nvec3 be() {\n  return c.emit;\n}\nvec4 bf() {\n  return c.skinColor;\n}\nvec3 bg() {\n  return c.normal;\n}\nfloat bh() {\n  return c.ao;\n}\nfloat bi(const in vec4 bj) {\n  return bj.r + bj.g / 255.;\n}\nvec3 bk(const in float bl, in vec3 bm, const in vec3 t, const in vec3 b, in vec3 bn) {\n  bm.xy = bl * bm.xy;\n  mat3 bo = mat3(t, b, bn);\n  return normalize(bo * bm);\n}\nfloat bp(const float bq, const vec3 bm, const vec3 br) {\n  float bs = clamp(dot(bm, br), 0., 1.);\n  float a = bq * bq;\n  float bt = a * a;\n  float bu = (bs * bt - bs) * bs + 1.;\n  return bt / (PI * bu * bu);\n}\nvec3 bv(const vec3 bw, const float bx, const in vec3 by, const in vec3 br) {\n  float bz = clamp(dot(by, br), 0., 1.);\n  bz = pow(1. - bz, 5.);\n  return bx * bz + (1. - bz) * bw;\n}\nfloat bA(const in vec3 bm, const in vec3 bB, const in float bq, const float bC) {\n  float bD = clamp(dot(bm, bB), 0., 1.);\n  float a = bq * bq;\n  float bE = bD * (bC * (1. - a) + a);\n  float bF = bC * (bD * (1. - a) + a);\n  return .5 / (bF + bE);\n}\nvec3 bG(const float bq, const vec3 bm, const vec3 bB, const vec3 by, const vec3 bH, const float bC, const float bx) {\n  vec3 br = normalize(bB + by);\n  float bI = bp(bq, bm, br);\n  float bJ = bA(bm, bB, bq, bC);\n  vec3 bK = bv(bH, bx, by, br);\n  return (bI * bJ * PI) * bK;\n}\nvec3 bL(const in vec3 bM) {\n  return RECIPROCAL_PI * bM;\n}\nvoid bN(const in vec3 bm, const in vec3 bB, const in float bC, const in float bq, const in vec3 bO, const in vec3 bH, const in vec3 bP, const in vec3 by, const in float bx, out vec3 bQ, out vec3 bR) {\n  if(bC <= .0) {\n    bR = bQ = vec3(.0);\n    return;\n  }\n  vec3 a = bC * bP;\n  vec3 bS = bG(bq, bm, bB, by, bH, bC, bx);\n  bR = a * bS;\n  bQ = a * bL(bO);\n}\n#if defined(HAS_IBL_LIGHTING)\nvec3 bT(const in vec3 bm) {\n  vec3 bn = environmentTransform * bm;\n  float x = bn.x;\n  float y = bn.y;\n  float z = bn.z;\n  vec3 bU = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    bU = hsv_apply(bU, hdrHSV);\n  }\n  return max(bU, vec3(.0));\n}\nvec3 bV(const in float bq, const in vec3 bW) {\n  vec3 bX = bW;\n  float bY = prefilterMiplevel.x;\n  float bZ = min(bY, bq * prefilterMiplevel.y);\n  vec3 ca = textureCubeLod(prefilterMap, bX, bZ).rgb;\n  if(length(hdrHSV) > .0) {\n    return hsv_apply(ca, hdrHSV);\n  } else {\n    return ca;\n  }\n}\nvec3 cb(const in vec3 cc, const in vec3 bB, const in float bq, const in vec3 cd, const in vec3 bO) {\n  float ce = 1. - bq;\n  vec3 bW = mix(cc, reflect(-bB, cc), ce * (sqrt(ce) + bq));\n  float bl = clamp(1. + dot(bW, cd), .0, 1.);\n  vec3 cf = bV(bq, environmentTransform * bW) * bl * bl;\n  return cf;\n}\n#else\nvec3 cb(const in vec3 bm, const in vec3 cg, const in float bq, const in vec3 cd, const in vec3 bO) {\n  return ambientColor * bL(bO);\n}\n#endif\nvec3 ch(const in vec3 ci, const in float bq, const in float bD, const in float bx) {\n  vec4 rgba = texture2D(brdfLUT, vec2(bD, bq)) * vec4(255., 65280.0, 255., 65280.0);\n  float b = (rgba[3] + rgba[2]);\n  float a = (rgba[1] + rgba[0]);\n  return (ci * a + b * bx) / 65535.;\n}\nvec3 cj(const in vec3 bm, const in vec3 cg, const in float bD, const in float bq, const in vec3 bH, const in vec3 cd, const in float bx, const in vec3 bO) {\n  return cb(bm, cg, bq, cd, bO) * ch(bH, bq, bD, bx);\n}\nfloat ck(const in float cl, const in float bD) {\n  float bu = bD + cl;\n  return clamp(bu * bu - 1. + cl, .0, 1.);\n}\nvoid cm() {\n  \n#ifdef HAS_MAP\nvec2 f = computeTexCoord(vTexCoord);\n#endif\n#ifdef HAS_UV_FLIP\nf.y = 1. - f.y;\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nf = O(f, normalize(vTangentViewPos - vTangentFragPos));\n#endif\nc.albedo = baseColorIntensity * baseColorFactor.rgb;\n  c.alpha = baseColorFactor.a * vOpacity;\n#if defined(HAS_PATTERN)\nfloat cn = vLinesofar;\n  vec2 i = vTexInfo.zw;\n#ifdef HAS_PATTERN_GAP\nfloat co = vLinePatternGap;\n#else\nfloat co = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat cp = vLinePatternAnimSpeed;\n#else\nfloat cp = linePatternAnimSpeed;\n#endif\nfloat cq = ceil(i.x * vPatternHeight / i.y);\n  float cr = cq * (1. + co);\n  cp /= animSpeedScale;\n  cn += mod(currentTime * -cp * .2, cr);\n  float cs = mod(cn / cr, 1.);\n  float ct = mod(flipY * vNormalY, 1.);\n  vec2 f = d(vec2(cs * (1. + co) * uvScale[0], ct * uvScale[1]));\n  vec4 cu = texture2D(linePatternFile, f);\n  float cv = clamp(sign(1. / (1. + co) - cs) + .000001, .0, 1.);\n  cu = mix(linePatternGapColor, cu, cv);\n#ifdef IS_SQUARE_TUBE\nfloat n = clamp(sign(abs(vNormalY) - .999999), .0, 1.);\n  cu = mix(cu, vec4(1.), n);\n#endif\nc.albedo *= cu.rgb;\n  c.alpha *= cu.a;\n#endif\n#if defined(HAS_ALBEDO_MAP)\nvec4 cw = o(baseColorTexture, f);\n  c.albedo *= sRGBToLinear(cw.rgb);\n  c.alpha *= cw.a;\n#endif\n#if defined(HAS_SKIN_MAP)\nvec4 cx = o(skinTexture, f);\n  c.skinColor = cx;\n#endif\n#if defined(HAS_COLOR0)\nc.albedo *= vColor0.rgb;\n#if COLOR0_SIZE == 4\nc.alpha *= vColor0.a;\n#endif\n#endif\n#if defined(HAS_COLOR)\nc.albedo *= vColor.rgb;\n  c.alpha *= vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nc.albedo *= lineColor.rgb;\n  c.alpha *= lineColor.a;\n#else\nc.albedo *= polygonFill.rgb;\n  c.alpha *= polygonFill.a;\n#endif\n#if defined(HAS_INSTANCE_COLOR)\nc.albedo *= vInstanceColor.rgb;\n  c.alpha *= vInstanceColor.a;\n#endif\n#if defined(IS_LINE_EXTRUSION)\nc.alpha *= lineOpacity;\n#else\nc.alpha *= polygonOpacity;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nc.roughnessMetalness = o(metallicRoughnessTexture, f).gb * vec2(roughnessFactor, metallicFactor);\n#else\nc.roughnessMetalness = vec2(roughnessFactor, metallicFactor);\n#endif\nc.emit = emissiveFactor;\n#if defined(HAS_EMISSIVE_MAP)\nif(emitMultiplicative == 1) {\n    c.emit *= sRGBToLinear(o(emissiveTexture, f).rgb);\n  } else {\n    c.emit += sRGBToLinear(o(emissiveTexture, f).rgb);\n  }\n#endif\nc.emit *= emitColorFactor;\n#if defined(HAS_AO_MAP)\nvec2 cy = computeTexCoord(vTexCoord1);\n  c.ao = o(occlusionTexture, cy).r;\n#else\nc.ao = 1.;\n#endif\nc.ao *= occlusionFactor;\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nvec3 cz = o(normalTexture, f).xyz * 2. - 1.;\n  cz.y = normalMapFlipY == 1 ? -cz.y : cz.y;\n  c.normal = cz;\n#else\nc.normal = normalize(vModelNormal);\n#endif\n#if defined(HAS_TERRAIN_NORMAL) && defined(HAS_TANGENT)\nvec3 cz = convertTerrainHeightToNormalMap(f);\n  cz.y = normalMapFlipY == 1 ? -cz.y : cz.y;\n  c.normal = cz;\n#endif\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nc.albedo *= diffuseFactor.rgb;\n  c.alpha *= diffuseFactor.a;\n#if defined(HAS_DIFFUSE_MAP)\nvec4 cA = o(diffuseTexture, f);\n  c.albedo *= sRGBToLinear(cA.rgb);\n  c.alpha *= cA.a;\n#endif\nc.specularColor = specularFactor;\n  c.glossiness = glossinessFactor;\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nvec4 cB = o(specularGlossinessTexture, f);\n  c.specularColor *= sRGBToLinear(cB.rgb);\n  c.glossiness *= cB.a;\n#endif\n#endif\n}\nvec3 cC(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float cD = 2.43;\n  const float bu = .59;\n  const float cE = .14;\n  return (x * (a * x + b)) / (x * (cD * x + bu) + cE);\n}\nvec3 cF(vec3 cG) {\n  cG = cC(cG);\n  return cG = pow(cG, vec3(1. / 2.2));\n}\nuniform float specularAAVariance;\nuniform float specularAAThreshold;\nfloat cH(float bq, const vec3 cI) {\n  \n#if defined(GL_OES_standard_derivatives) || __VERSION__ == 300\nvec3 cJ = dFdx(cI);\n  vec3 cK = dFdy(cI);\n  float cL = specularAAVariance * (dot(cJ, cJ) + dot(cK, cK));\n  float cM = min(2. * cL, specularAAThreshold);\n  float cN = saturate(bq * bq + cM);\n  return sqrt(cN);\n#else\nreturn bq;\n#endif\n}\n#ifdef HAS_SSR\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nvec3 cO(const in mat4 cP, const in vec3 cQ) {\n  vec4 cR = cP * vec4(cQ, 1.);\n  return vec3(.5 + .5 * cR.xy / cR.w, cR.w);\n}\nvec3 cS(const in float cT, const in vec2 f) {\n  return texture2D(TextureReflected, f).rgb;\n}\nfloat cU(float cV) {\n  highp mat4 cP = projMatrix;\n  highp float z = cV * 2. - 1.;\n  return -cP[3].z / (z + cP[2].z);\n}\nfloat cW(const vec2 f) {\n  float cV = bi(texture2D(TextureDepth, f));\n  return cV;\n}\nfloat cX(const in vec2 cY, const in float cZ) {\n  vec3 da = vec3(.06711056, .00583715, 52.9829189);\n  return fract(da.z * fract(dot(cY.xy + cZ * vec2(47., 17.) * .695, da.xy))) * .5;\n}\nvec3 db(const in float cZ, const in vec3 dc, const in vec3 dd, const in vec3 de, const in vec3 cg, const in float df) {\n  vec2 dg;\n  dg.x = cX(gl_FragCoord.yx, cZ);\n  dg.y = fract(dg.x * 52.9829189);\n  dg.y = mix(dg.y, 1., .7);\n  float dh = 2. * 3.14159 * dg.x;\n  float di = pow(max(dg.y, .000001), df / (2. - df));\n  float dj = sqrt(1. - di * di);\n  vec3 dk = vec3(dj * cos(dh), dj * sin(dh), di);\n  dk = dk.x * dc + dk.y * dd + dk.z * de;\n  return normalize((2. * dot(cg, dk)) * dk - cg);\n}\nfloat dl(const in float cZ) {\n  return (cX(gl_FragCoord.xy, cZ) - .5);\n}\nvec3 dm(const in vec3 dn, const in float dp, const in vec3 dq) {\n  vec3 dr = cO(projMatrix, vViewVertex.xyz + dq * dp);\n  dr.z = 1. / dr.z;\n  dr -= dn;\n  float ds = min(1., .99 * (1. - dn.x) / max(1e-5, dr.x));\n  float dt = min(1., .99 * (1. - dn.y) / max(1e-5, dr.y));\n  float dw = min(1., .99 * dn.x / max(1e-5, -dr.x));\n  float dx = min(1., .99 * dn.y / max(1e-5, -dr.y));\n  return dr * min(ds, dt) * min(dw, dx);\n}\nfloat dy(const in vec3 dn, const in vec3 dr, inout float dz, inout float dA) {\n  float dB = (dA + dz) * .5;\n  vec3 dC = dn + dr * dB;\n  float z = cW(dC.xy);\n  float cV = cU(z);\n  float dD = -1. / dC.z;\n  dz = cV > dD ? dz : dB;\n  dA = cV > dD ? dB : dA;\n  return dB;\n}\nvec4 dE(const in vec3 dn, const in float dp, in float dF, const in vec3 dq, const in float bq, const in float cZ) {\n  int dG = 20;\n  float dH = 1. / float(dG);\n  dF *= dH;\n  vec3 dr = dm(dn, dp, dq);\n  float dI = dH;\n  vec3 dJ = vec3(.0, dI, 1.);\n  vec3 dC;\n  float z, cV, dD, dK, dL, dM;\n  bool dN;\n  float dO = 1.;\n  float dB;\n  for(int W = 0; W < dG; W++) {\n    dC = dn + dr * dJ.y;\n    z = cW(dC.xy);\n    cV = cU(z);\n    dD = -1. / dC.z;\n    float dP = clamp(sign(.999 - z), .0, 1.);\n    dK = dP * (dD - cV);\n    dK *= clamp(sign(abs(dK) - dp * dH * dH), .0, 1.);\n    dN = abs(dK + dF) < dF;\n    dL = clamp(dJ.x / (dJ.x - dK), .0, 1.);\n    dM = dN ? dJ.y + dL * dH - dH : 1.;\n    dJ.z = min(dJ.z, dM);\n    dJ.x = dK;\n    if(dN) {\n      float dz = dJ.y - dH;\n      float dA = dJ.y;\n      dB = dy(dn, dr, dz, dA);\n      dB = dy(dn, dr, dz, dA);\n      dB = dy(dn, dr, dz, dA);\n      dO = dB;\n      break;\n    }\n    dJ.y += dH;\n  }\n  return vec4(dn + dr * dO, 1. - dO);\n}\nvec4 dQ(in vec4 dR, const in float dS, const in vec3 dT, const in vec3 dU, const in float bq) {\n  vec4 dV = mix(outputFovInfo[0], outputFovInfo[1], dR.x);\n  dR.xyz = vec3(mix(dV.xy, dV.zw, dR.y), 1.) * -1. / dR.z;\n  dR.xyz = (reprojViewProjMatrix * vec4(dR.xyz, 1.)).xyw;\n  dR.xy /= dR.z;\n  float dW = clamp(6. - 6. * max(abs(dR.x), abs(dR.y)), .0, 1.);\n  dR.xy = .5 + .5 * dR.xy;\n  vec3 dX = dU * cS(bq * (1. - dR.w), dR.xy);\n  return vec4(mix(dT, dX, dS * dW), 1.);\n}\nvec3 ssr(const in vec3 dT, const in vec3 dU, const in float bq, const in vec3 bm, const in vec3 cg) {\n  float dY = .0;\n  vec4 bU = vec4(.0);\n  float df = bq * bq;\n  df = df * df;\n  vec3 dZ = abs(bm.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 dc = normalize(cross(dZ, bm));\n  vec3 dd = cross(bm, dc);\n  float dS = ssrFactor * clamp(-4. * dot(cg, bm) + 3.8, .0, 1.);\n  dS *= clamp(4.7 - bq * 5., .0, 1.);\n  vec3 dn = cO(projMatrix, vViewVertex.xyz);\n  dn.z = 1. / dn.z;\n  vec3 dq = db(dY, dc, dd, bm, cg, df);\n  float dp = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, dq.z * .5 + .5);\n  float dF = .5 * dp;\n  vec4 dR;\n  if(dot(dq, bm) > .001 && dS > .0) {\n    dR = dE(dn, dp, dF, dq, bq, dY);\n    if(dR.w > .0)\n      bU += dQ(dR, dS, dT, dU, bq);\n    \n  }\n  return bU.w > .0 ? bU.rgb / bU.w : dT;\n}\n#endif\n#include <highlight_frag>\nvec4 ea(in vec4 eb) {\n  return vec4(mix(pow(eb.rgb, vec3(.41666)) * 1.055 - vec3(.055), eb.rgb * 12.92, vec3(lessThanEqual(eb.rgb, vec3(.0031308)))), eb.a);\n}\nvec4 ec(vec4 eb) {\n  return (ea(eb));\n}\nvoid main() {\n  cm();\n  vec3 cg = normalize(cameraPosition - vModelVertex.xyz);\n#if defined(HAS_DOUBLE_SIDE)\nvec3 cd = gl_FrontFacing ? normalize(vModelNormal) : -normalize(vModelNormal);\n#else\nvec3 cd = normalize(vModelNormal);\n#endif\n#if defined(HAS_TANGENT)\nvec4 ed;\n  ed = vModelTangent;\n#if defined(HAS_DOUBLE_SIDE)\ned.xyz = gl_FrontFacing ? normalize(ed.xyz) : -normalize(ed.xyz);\n#else\ned.xyz = normalize(ed.xyz);\n#endif\nvec3 ee = normalize(vModelBiTangent);\n#endif\nfloat bw = .08 * specularF0;\n  float ef = bc();\n  vec3 bO = ba();\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nvec3 eg = c.specularColor;\n#else\nvec3 eg = mix(vec3(bw), bO, ef);\n#endif\nbO *= 1. - ef;\n  float eh = clamp(50.0 * eg.g, .0, 1.);\n  float ei = bd();\n  if(specularAAVariance > .0) {\n    ei = cH(ei, cd);\n  }\n  vec3 ej = be();\n  vec3 ek = bg();\n  vec3 el = vec3(ek);\n#if defined(HAS_TANGENT) && (defined(HAS_NORMAL_MAP) || defined(HAS_TERRAIN_NORMAL))\nel = bk(normalMapFactor, el, ed.xyz, ee, cd);\n#endif\nvec3 cA = vec3(.0);\n  vec3 bH = vec3(.0);\n#if defined(HAS_IBL_LIGHTING)\ncA = bO * bT(el) * .5;\n#else\ncA = bO * ambientColor;\n#endif\nfloat bD = dot(el, cg);\n  bH = cj(el, cg, bD, ei, eg, cd, eh, bO);\n  float em;\n  float en = 1.;\n  float eo = bh();\n  cA *= environmentExposure * eo;\n#ifdef HAS_IBL_LIGHTING\nen = ck(eo, bD);\n#endif\n#ifdef HAS_SSR\nvec3 ep = normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n  vec3 eq = ep;\n#if defined(HAS_TANGENT) && (defined(HAS_NORMAL_MAP) || defined(HAS_TERRAIN_NORMAL))\nvec4 er;\n  er = vViewTangent;\n  er = gl_FrontFacing ? er : -er;\n  er.xyz = normalize(er.xyz);\n  vec3 es = normalize(cross(ep, er.xyz)) * er.w;\n  eq = bk(normalMapFactor, ek, er.xyz, es, ep);\n#endif\nbH = ssr(bH, eg * en, ei, eq, -normalize(vViewVertex.xyz));\n#endif\nbH *= environmentExposure * en;\n  vec3 et, eu;\n  vec3 ev = vModelNormal;\n  vec3 ew = -light0_viewDirection;\n  float ex = saturate(dot(ew, el));\n  bN(el, cg, ex, max(.045, ei), bO, eg, light0_diffuse.rgb, ew, eh, eu, et);\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat ey = shadow_computeShadow();\n  eu = shadow_blend(eu, ey).rgb;\n  et = shadow_blend(et, ey).rgb;\n#endif\ncA += eu;\n  bH += et;\n  cA += ej;\n  vec3 ez = bH + cA;\n  if(outputSRGB == 1)\n    ez = linearTosRGB(ez);\n  \n#ifdef HAS_SKIN_MAP\nvec4 eA = bf();\n  ez.rgb = ez.rgb * (1. - eA.a) + eA.rgb * eA.a;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nez.rgb = shadow_blend(ez.rgb, ey).rgb;\n#endif\n#endif\nfloat eB = bb();\n#if defined(ALPHA_MODE)\n#if ALPHA_MODE == 1\nif(eB < alphaCutoff) {\n    discard;\n  } else {\n    eB = 1.;\n  }\n#else\neB = 1.;\n#endif\n#endif\nglFragColor = vec4(ez * eB, eB);\n  if(glFragColor.a < alphaTest) {\n    discard;\n  }\n#ifdef HAS_VERTEX_COLOR\nglFragColor *= vertexColor_get();\n#endif\n#ifdef HAS_EXCAVATE_ANALYSIS\nglFragColor = excavateColor(glFragColor);\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_SNOW\nglFragColor.rgb = snow(glFragColor, bg(), 1.);\n#endif\nif(contrast != 1.) {\n    glFragColor = contrastMatrix(contrast) * glFragColor;\n  }\n  if(length(hsv) > .0) {\n    glFragColor = hsv_apply(glFragColor, hsv);\n  }\n#ifdef OUTPUT_NORMAL\nglFragColor = vec4(cd, 1.);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#ifdef HAS_LAYER_OPACITY\nglFragColor *= layerOpacity;\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:l,extraCommandProps:e,defines:i}),this.version=300}getGeometryDefines(t){const e={};return t.data[t.desc.tangentAttribute]?e.HAS_TANGENT=1:t.data[t.desc.normalAttribute]&&(e.HAS_NORMAL=1),t.data[t.desc.colorAttribute]&&(e.HAS_COLOR=1),t.data[t.desc.color0Attribute]&&(e.HAS_COLOR0=1,e.COLOR0_SIZE=t.getColor0Size()),e}},StandardDepthShader:class extends mx{constructor(t={}){const e=[];super({vert:"#define SHADER_NAME depth_vert\nprecision highp float;\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform vec2 outSize;\nuniform vec2 halton;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec4 d = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 d = getPosition(aPosition);\n#endif\nvec4 e = modelViewMatrix * c * d;\n  mat4 f = projMatrix;\n  f[2].xy += halton.xy / outSize.xy;\n  gl_Position = f * e;\n}",frag:"#define SHADER_NAME depth_frag\nprecision highp float;\nvoid main() {\n  gl_FragColor = vec4(1., .0, .0, 1.);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(t,n)=>Hp(e,n.viewMatrix,n.modelMatrix)}],extraCommandProps:t.extraCommandProps,defines:t.defines})}},PBRUtils:Qb};var Yw=Object.freeze({__proto__:null,AbstractTexture:jv,BloomPass:Ex,BoundingBox:Vv,BoxBlurShader:class extends bx{constructor({blurOffset:t}){super({vert:vx,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\nuniform float ignoreTransparent;\nvoid main() {\n  vec4 c = vec4(.0);\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      vec4 f = texture2D(textureSource, e);\n      float h;\n      if(ignoreTransparent == 1.) {\n        h = sign(f.a);\n      } else {\n        h = 1.;\n      }\n      d += h;\n      c += h * f;\n    }\n  gl_FragColor = c / max(d, 1.) * clamp(sign(d - 1.), .0, 1.);\n}",defines:{BOXBLUR_OFFSET:t||2},extraCommandProps:{viewport:{x:0,y:0,width:(t,e)=>e.resolution[0],height:(t,e)=>e.resolution[1]}}}),this._blurOffset=t||2}getMeshCommand(t,e){const n="box_blur_"+this._blurOffset;return this.commands[n]||(this.commands[n]=this.createREGLCommand(t,null,e.getElements())),this.commands[n]}},Constants:zv,CopyShader:zx,EdgeGeometry:w_,EdgeShader:Bx,ExtentPass:tb,FBORayPicking:cw,FogPass:Gx,FogShader:Vx,FxaaShader:wx,GLTFHelper:yb,GLTFManager:Pb,Geometry:Jv,HDR:Qw,HeatmapDisplayShader:Nx,HeatmapShader:Dx,InstancedMesh:B_,Jitter:Sx,KHRTechniquesWebglManager:vw,Material:T_,Mesh:z_,MeshShader:mx,PhongMaterial:E_,PhongShader:yx,PhongSpecularGlossinessMaterial:L_,Plane:ax,PointLineShader:class extends mx{constructor(t={}){const e=[];super({vert:"attribute vec3 aPosition;\n#ifdef HAS_COLOR0\nattribute vec4 aColor0;\nvarying vec4 vColor;\n#endif\nuniform mat4 modelMatrix;\nuniform mat4 projMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float pointSize;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#endif\n#include <get_output>\n#include <heatmap_render_vert>\n#ifdef HAS_FLOODANALYSE\nvarying float vHeight;\n#endif\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_PointSize = pointSize;\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(d * c, modelMatrix);\n#else\ngl_Position = projViewModelMatrix * d * c;\n#endif\n#ifdef HAS_COLOR0\nvColor = aColor0 / 255.;\n#endif\n#ifdef HAS_MAP\nvTexCoord = aTexCoord;\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * d, c);\n#endif\n}",frag:"precision mediump float;\n#include <gl2_frag>\n#if defined(HAS_COLOR0)\nvarying vec4 vColor;\n#endif\n#include <heatmap_render_frag>\nuniform vec4 baseColorFactor;\n#if defined(HAS_MAP)\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec2 vTexCoord;\n#endif\n#include <mask_frag>\nvoid main() {\n  \n#ifdef HAS_COLOR0\nglFragColor = vColor * baseColorFactor;\n#else\nglFragColor = vec4(1.) * baseColorFactor;\n#endif\n#ifdef HAS_MAP\n#ifdef HAS_ALBEDO_MAP\nglFragColor *= texture2D(baseColorTexture, vTexCoord);\n#endif\n#ifdef HAS_DIFFUSE_MAP\nglFragColor *= texture2D(diffuseTexture, vTexCoord);\n#endif\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,n)=>Hp(e,n.projViewMatrix,n.modelMatrix)}],defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}})}},PostProcessShader:Cx,QuadShader:bx,REGLHelper:p_,RainRipplesPass:Jx,Renderer:j_,ResourceLoader:V_,Scene:Y_,Shader:px,ShaderLib:lx,ShadowDisplayShader:tw,ShadowMapShader:Xb,ShadowPass:$b,SkyboxShader:Fx,SsrPass:Rx,StandardLiteMaterial:R_,StandardLiteShader:class extends mx{constructor(t={}){const e=[],n=t.uniforms,i=[{name:"viewMatrixInverse",type:"function",fn:(t,e)=>Bp(Hx,e.viewMatrix)},{name:"modelViewMatrix",type:"function",fn:function(t,n){return Hp(e,n.viewMatrix,n.modelMatrix)}},{name:"environmentTransform",type:"function",fn:(t,e)=>Op(jx,Math.PI*(e.environmentOrientation||0)/180)}];n&&i.push(...n),super({vert:"precision mediump float;\n#include <gl2_vert>\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\n#ifdef HAS_MAP\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\n#else\nattribute vec4 aColor0;\n#endif\nvarying vec4 vColor;\n#endif\nuniform mat4 projMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\nuniform mat4 projViewMatrix;\n#include <get_output>\n#include <heatmap_render_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\nvarying vec3 vViewPosition;\nvoid main() {\n  \n#ifdef IS_LINE_EXTRUSION\nvec4 c = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 c = getPosition(aPosition);\n#endif\nmat4 d = getPositionMatrix();\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / outSize.xy;\n#ifdef HAS_MASK_EXTENT\ngl_Position = e * getMaskPosition(d * c, modelMatrix);\n#else\ngl_Position = e * modelViewMatrix * d * c;\n#endif\nvec4 f = modelViewMatrix * d * c;\n  vViewPosition = -f.xyz;\n#ifdef HAS_MAP\nvec2 h = decode_getTexcoord(aTexCoord);\n  vTexCoord = h * uvScale + uvOffset;\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvColor = vec4(aColor0 / 255., 1.);\n#else\nvColor = aColor0 / 255.;\n#endif\n#endif\n}",frag:"#if __VERSION__ == 100\n#if defined(GL_EXT_shader_texture_lod)\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\n#define saturate(x)        clamp(x, 0.0, 1.0)\nprecision mediump float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\n#define GET_BASEMAP(UV) (texture2D(baseColorTexture, (UV)))\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform vec3 cameraPosition;\n#if defined(HAS_IBL_LIGHTING)\nuniform mat4 viewMatrixInverse;\n#endif\nuniform vec4 baseColorFactor;\nuniform vec3 emissiveFactor;\nuniform vec3 specularFactor;\nuniform float opacity;\nuniform float envRotationSin;\nuniform float envRotationCos;\nuniform float rgbmRange;\n#if defined(HAS_MAP)\n#include <computeTexcoord_frag>\n#endif\n#ifdef HAS_BASECOLOR_MAP\nuniform sampler2D baseColorTexture;\n#endif\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D normalTexture;\nvec3 c(vec3 d, vec3 e) {\n  vec3 f = dFdx(d.xyz);\n  vec3 h = dFdy(d.xyz);\n  vec3 i = normalize(f - h);\n  vec3 j = normalize(-f + h);\n  vec3 k = normalize(e);\n  vec3 l = texture2D(normalTexture, computeTexCoord(vTexCoord)).rgb * 2. - 1.;\n  mat3 m = mat3(i, j, k);\n  return normalize(m * l);\n}\n#endif\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D emissiveTexture;\n#endif\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\nuniform vec4 diffuseFactor;\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D diffuseTexture;\n#endif\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvarying vec4 vColor;\n#endif\n#ifdef GAMMA_INPUT\nvec3 n(vec3 o) {\n  return o * o;\n}\nfloat n(float o) {\n  return o * o;\n}\n#else\nvec3 n(vec3 o) {\n  return o;\n}\nfloat n(float o) {\n  return o;\n}\n#endif\nvec3 u() {\n  \n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nreturn texture2D(specularGlossinessTexture, computeTexCoord(vTexCoord)).rgb;\n#else\nreturn specularFactor;\n#endif\n#else\nreturn specularFactor;\n#endif\n}\nvec3 v() {\n  \n#ifdef HAS_EMISSIVE_MAP\nreturn texture2D(emissiveTexture, computeTexCoord(vTexCoord)).rgb;\n#else\nreturn emissiveFactor;\n#endif\n}\n#if defined(TONEMAP_OUTPUT)\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\nfloat A(vec3 rgb) {\n  return dot(rgb, vec3(.299, .587, .114));\n}\nfloat B(vec3 rgb) {\n  return dot(rgb, vec3(.212671, .715160, .072169));\n}\nvec3 C(vec3 xyz) {\n  vec3 D = vec3(3.240479, -1.53715, -.498535);\n  vec3 E = vec3(-.969256, 1.875992, .041556);\n  vec3 F = vec3(.055648, -.204043, 1.057311);\n  vec3 rgb;\n  rgb.b = dot(xyz, F);\n  rgb.g = dot(xyz, E);\n  rgb.r = dot(xyz, D);\n  return rgb;\n}\nvec3 H(vec3 rgb) {\n  vec3 I = vec3(.412453, .35758, .180423);\n  vec3 J = vec3(.212671, .71516, .0721688);\n  vec3 K = vec3(.0193338, .119194, .950227);\n  vec3 xyz;\n  xyz.x = dot(rgb, I);\n  xyz.y = dot(rgb, J);\n  xyz.z = dot(rgb, K);\n  return xyz;\n}\nvec3 L(vec3 xyz) {\n  float M = xyz.x + xyz.y + xyz.z;\n  M = 1. / M;\n  vec3 O;\n  O.z = xyz.y;\n  O.x = xyz.x * M;\n  O.y = xyz.y * M;\n  return O;\n}\nvec3 P(vec3 O) {\n  float x = O.x;\n  float y = O.y;\n  float J = O.z;\n  vec3 xyz;\n  xyz.y = J;\n  xyz.x = x * (J / y);\n  xyz.z = (1. - x - y) * (J / y);\n  return xyz;\n}\nfloat Q(float x) {\n  float U = pow(x, 1.60525727);\n  float V = ((1.05542877 * 4.68037409) * U) / (4.68037409 * U + 1.);\n  return clamp(V, .0, 1.);\n}\nconst float W = 1. / .18;\nfloat ba(float x) {\n  x *= W;\n  const float bb = .2;\n  const float F = .34;\n  const float bc = .002;\n  const float bd = 1.68;\n  const float be = .0005;\n  const float bf = .252;\n  const float bg = 1. / .833837;\n  return ((x * (bb * x + bc * F) + bd * be) / (x * (bb * x + F) + bd * bf) - be / bf) * bg;\n}\nvec3 bh(vec3 x) {\n  x *= W;\n  const float bb = .27;\n  const float F = .29;\n  const float bc = .052;\n  const float bd = .2;\n  const float bf = .18;\n  const float bg = 1. / .897105;\n  return ((x * (bb * x + bc * F)) / (x * (bb * x + F) + bd * bf)) * bg;\n}\nvec3 bi(vec3 x) {\n  vec3 bj = x.rgb;\n  bj = min(bj, vec3(3.));\n  float bk = B(bj);\n  if(bk > .0) {\n    float bl = Q(bk);\n    bj = bj * (bl / bk);\n    bj = clamp(bj, vec3(.0), vec3(1.));\n  }\n  float bm = 1. / 2.2;\n  bj = pow(bj, vec3(bm));\n  return bj;\n}\n#endif\n#endif\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\nuniform float envMapExposure;\n#endif\nuniform vec4 themingColor;\nuniform mat3 environmentTransform;\nvec3 bn(vec3 bo, vec3 bp) {\n  \n#if defined(HAS_SHADOWMAP)\nfloat bq = dot(shadowLightDir, bp);\n  float br = (bq + 1.) / 2.;\n  br = min(1., br * 1.5);\n  float bs = 1.;\n  vec3 bt = bo * min(bs, br);\n  return bt;\n#else\nreturn bo;\n#endif\n}\n#ifdef HAS_IBL_LIGHTING\nuniform float reflectivity;\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform vec3 diffuseSPH[9];\nuniform vec2 prefilterMiplevel;\nuniform vec2 prefilterSize;\n#else\nuniform vec3 ambientColor;\n#endif\n#if defined(HAS_IBL_LIGHTING)\nvec3 bu(const in vec3 bv) {\n  vec3 bw = environmentTransform * bv;\n  float x = bw.x;\n  float y = bw.y;\n  float z = bw.z;\n  vec3 bt = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    bt = hsv_apply(bt, hdrHSV);\n  }\n  return max(bt, vec3(.0));\n}\nvec3 bx(const in vec4 by, const in float bz) {\n  if(bz <= .0)\n    return by.rgb;\n  return bz * by.rgb * by.a;\n}\nfloat bA(const in float bB) {\n  return bB;\n}\nvec3 bC(const in float bD, const in vec3 D) {\n  vec3 bE = D;\n  float bF = prefilterMiplevel.x;\n  float bG = min(bF, bA(bD) * prefilterMiplevel.y);\n  vec3 bH = bx(textureCubeLod(prefilterMap, bE, bG), rgbmRange);\n  if(length(hdrHSV) > .0) {\n    return hsv_apply(bH, hdrHSV);\n  } else {\n    return bH;\n  }\n}\nvec3 bI(const in vec3 k, const in vec3 D, const in float bJ) {\n  float bK = 1. - bJ;\n  float bL = bK * (sqrt(bK) + bJ);\n  return mix(k, D, bL);\n}\nvec3 bM(const in vec3 bv, const in vec3 bN, const in float bO, const in vec3 bP) {\n  vec3 D = reflect(-bN, bv);\n  D = bI(bv, D, bO);\n  vec3 bQ = bC(bO, environmentTransform * D);\n  float bR = clamp(1. + dot(D, bP), .0, 1.);\n  bQ *= bR * bR;\n  return bQ;\n}\n#else\nvec3 bM(const in vec3 bv, const in vec3 bN, const in float bO, const in vec3 bP) {\n  return ambientColor;\n}\n#endif\nvarying highp vec3 vViewPosition;\nvec3 bS(vec3 bT, float bU) {\n  float bV = max(1. - bU, .0);\n  return bT + (1. - bT) * pow(bV, 5.);\n}\nfloat bW(float bT, float bU) {\n  float bV = max(1. - bU, .0);\n  return bT + (1. - bT) * pow(bV, 5.);\n}\nvec3 bX(const in vec3 by) {\n  return vec3(by.r < .0031308 ? by.r * 12.92 : 1.055 * pow(by.r, 1. / 2.4) - .055, by.g < .0031308 ? by.g * 12.92 : 1.055 * pow(by.g, 1. / 2.4) - .055, by.b < .0031308 ? by.b * 12.92 : 1.055 * pow(by.b, 1. / 2.4) - .055);\n}\nvoid main() {\n  glFragColor = vec4(vec3(1.), opacity);\n#ifdef HAS_BASECOLOR_MAP\nvec4 bY = GET_BASEMAP(computeTexCoord(vTexCoord));\n#ifdef GAMMA_INPUT\nbY.xyz *= bY.xyz;\n#endif\nglFragColor = glFragColor * bY;\n#endif\n#ifdef ALPHATEST\nif(glFragColor.a < ALPHATEST)\n    discard;\n  \n#endif\nfloat bZ = 1.;\n  vec3 ca = dFdx(vViewPosition);\n  vec3 cb = dFdy(vViewPosition);\n  vec3 bv = normalize(cross(ca, cb));\n  vec3 cc;\n  if(projMatrix[3][3] == .0) {\n    cc = normalize(vViewPosition);\n  } else {\n    cc = vec3(.0, .0, 1.);\n  }\n  bv = faceforward(bv, -cc, bv);\n  vec3 cd = bv;\n#ifdef HAS_NORMAL_MAP\nbv = c(-vViewPosition, bv);\n#endif\nvec3 ce = vec3(.0);\n  vec3 cf = vec3(.0);\n#ifdef HAS_IBL_LIGHTING\nvec3 bp = mat3(viewMatrixInverse) * bv;\n  vec3 cg = glFragColor.rgb * bu(bp) * .5;\n  cg = bn(cg, bp);\n  ce += n(baseColorFactor.rgb) * cg;\n#endif\nvec3 ch = v();\n#ifdef METAL\nglFragColor.xyz = glFragColor.xyz * (n(ch) + ce + n(baseColorFactor.rgb) + cf);\n#else\nglFragColor.xyz = glFragColor.xyz * (n(ch) + ce + n(baseColorFactor.rgb)) + cf;\n#endif\nvec3 ci;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat cj = shadow_computeShadow();\n  ci = shadow_blend(ci, cj).rgb;\n#endif\n#ifdef HAS_COLOR\nglFragColor = glFragColor * vColor;\n#endif\nglFragColor.rgb += ci;\n  glFragColor.rgb = bX(glFragColor.rgb);\n#if defined(HAS_IBL_LIGHTING)\nvec3 ck;\n#if defined(HAS_NORMAL_MAP)\n#ifdef ENVMAP_MODE_REFLECTION\nck = reflect(-cc, bv);\n#else\nck = refract(-cc, bv, 1.);\n#endif\n#else\nck = reflect(-cc, bv);\n#endif\nck = mat3(viewMatrixInverse) * ck;\n  float cl = 1.;\n  vec3 cm;\n#ifdef HAS_IBL_LIGHTING\ncm = vec3(.0);\n#elif\ncm = ambientColor;\n#endif\ncm *= cl;\n  float bV = dot(cc, bv);\n  if(bV < -1e-2 || reflectivity == .0)\n    bV = 1.;\n  else\n    bV = max(1e-6, bV);\n  vec3 cn;\n  vec3 co = u();\n#ifdef METAL\ncn = n(co);\n#else\ncn = bS(n(co), bV) * (1. - envRotationSin);\n  glFragColor.a = mix(glFragColor.a, bW(glFragColor.a, bV), reflectivity) * envRotationCos;\n  float cp = pow(1. - bV * .5, 5.);\n  float cq = (28. / 23.) * (1. - cp) * (1. - cp);\n  glFragColor.rgb *= cq * (1. - n(co));\n#endif\nglFragColor.rgb += cm.rgb * bZ * cn.rgb;\n#endif\n#if defined(TONEMAP_OUTPUT)\n#if TONEMAP_OUTPUT == 1\nglFragColor.rgb = bi(exposureBias * glFragColor.rgb);\n#elif TONEMAP_OUTPUT == 2\nglFragColor.rgb = bh(exposureBias * glFragColor.rgb);\n#endif\n#endif\nglFragColor.rgb = mix(glFragColor.rgb, themingColor.rgb, themingColor.a);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:i,defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}}),this.version=300}},Texture2D:sx,Util:Lv,WaterShader:class extends mx{constructor(t={}){super({vert:"precision highp float;\nprecision highp sampler2D;\nconst float c = 3.141592653589793;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nvec4 d(mat4 e, mat4 f, vec3 h) {\n  return e * modelMatrix * f * vec4(h, 1.);\n}\nvec3 i(in vec3 h, in vec3 j) {\n  return normalize(h + j);\n}\nmat3 k(in vec3 l) {\n  vec3 t = normalize(cross(vec3(.0, .0, 1.), l));\n  vec3 b = normalize(cross(l, t));\n  return mat3(t, b, l);\n}\nvoid m() {\n  \n}\nvoid main(void) {\n  vuv = aTexCoord;\n  vpos = (modelMatrix * vec4(aPosition, 1.)).xyz;\n  vnormal = aNormal;\n  vtbnMatrix = k(vnormal);\n  gl_Position = d(projMatrix, viewMatrix, vpos);\n  m();\n}",frag:"precision highp float;\nprecision highp sampler2D;\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\nuniform vec3 octaveTextureRepeat;\nuniform vec4 waveParams;\nuniform vec2 waveDirection;\nuniform vec4 waterColor;\nuniform vec3 lightingDirection;\nuniform vec3 lightingIntensity;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nconst vec2 c = vec2(6. / 25., 5. / 24.);\nvec2 d(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rg - 1.;\n}\nfloat h(vec2 f) {\n  return texture2D(texWavePerturbation, f).b;\n}\nvec3 i(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rgb - 1.;\n}\nfloat j(vec2 f, float k) {\n  return fract(k);\n}\nfloat l(vec2 f, float k) {\n  float m = j(f, k);\n  return 1. - abs(1. - 2. * m);\n}\nvec3 n(sampler2D o, vec2 f, float k, float u) {\n  float v = waveParams[2];\n  float A = waveParams[3];\n  vec2 B = d(o, f) * v;\n  float m = j(f, k + u);\n  float C = l(f, k + u);\n  vec2 D = f;\n  D -= B * (m + A);\n  D += u;\n  D += (k - m) * c;\n  return vec3(D, C);\n}\nconst float E = .3737;\nconst float F = 7.77;\nvec3 G(sampler2D H, sampler2D I, vec2 f, vec2 J, float k) {\n  float K = waveParams[0];\n  vec2 L = k * -J;\n  float M = h(f * E) * F;\n  vec3 N = n(I, f + L, k + M, .0);\n  vec3 O = n(I, f + L, k + M, .5);\n  vec3 P = i(H, N.xy) * N.z;\n  vec3 Q = i(H, O.xy) * O.z;\n  vec3 R = normalize(P + Q);\n  R.xy *= K;\n  R.z = sqrt(1. - dot(R.xy, R.xy));\n  return R;\n}\nvec3 S(vec2 f, float k) {\n  float T = waveParams[1];\n  return G(texWaveNormal, texWavePerturbation, f * T, waveDirection, k);\n}\nconst float U = 3.141592653589793;\nconst float V = 1. / U;\nconst float W = .3183098861837907;\nconst float X = 1.570796326794897;\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nfloat Y = 2.2;\nvec3 Z(float ba, vec3 bb, float bc) {\n  return bb + (bc - bb) * pow(1. - ba, 5.);\n}\nfloat bd(float be, float bf) {\n  float bg = bf * bf;\n  float bh = be * be;\n  float bi = pow((bh * (bg - 1.) + 1.), Y) * U;\n  return bg / bi;\n}\nfloat bj(float bk) {\n  return .25 / (bk * bk);\n}\nvec3 bl(in PBRShadingWater bm, float bf, vec3 bn, float bo) {\n  vec3 bp = Z(bm.VdotH, bn, bo);\n  float bq = bd(bm.NdotH, bf);\n  float br = bj(bm.LdotH);\n  return (bq * br) * bp;\n}\nvec3 bs(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float bt = 2.2;\nconst float bu = .4545454545;\nvec4 bv(vec4 bw) {\n  return vec4(pow(bw.rgb, vec3(bu)), bw.w);\n}\nvec3 bx(vec3 bw) {\n  return pow(bw, vec3(bt));\n}\nconst vec3 by = vec3(.02, 1., 5.);\nconst vec2 bz = vec2(.02, .1);\nconst float bf = .06;\nconst vec3 bA = vec3(0, .6, .9);\nconst vec3 bB = vec3(.72, .92, 1.);\nPBRShadingWater bC;\nvec3 bD(in float bE, in vec3 bF, in vec3 bG) {\n  float bH = pow((1. - bE), by[2]);\n  return mix(bG, bF, bH);\n}\nvec3 bI(in vec3 bJ, in vec3 bK, in vec3 bL, vec3 bw, in vec3 bM, in vec3 bN, in float bO) {\n  vec3 bP = bx(bw);\n  vec3 bQ = normalize(bL + bK);\n  bC.NdotL = clamp(dot(bJ, bL), .0, 1.);\n  bC.NdotV = clamp(dot(bJ, bK), .001, 1.);\n  bC.VdotN = clamp(dot(bK, bJ), .001, 1.);\n  bC.NdotH = clamp(dot(bJ, bQ), .0, 1.);\n  bC.VdotH = clamp(dot(bK, bQ), .0, 1.);\n  bC.LdotH = clamp(dot(bL, bQ), .0, 1.);\n  float bR = max(dot(bN, bK), .0);\n  vec3 bS = bx(bB);\n  vec3 bT = bx(bA);\n  vec3 bB = bD(bR, bS, bT);\n  float bU = max(dot(bN, bL), .0);\n  bB *= .1 + bU * .9;\n  float bV = clamp(bO, .8, 1.);\n  vec3 bW = Z(bC.VdotN, vec3(by[0]), by[1]) * bB * bV;\n  vec3 bX = bP * mix(bB, bU * bM * V, 2. / 3.) * bV;\n  vec3 bY = vec3(.0);\n  if(bR > .0 && bU > .0) {\n    vec3 bZ = bl(bC, bf, vec3(bz[0]), bz[1]);\n    vec3 ca = bM * V * bO;\n    bY = bC.NdotL * ca * bZ;\n  }\n  return bs(bW + bX + bY);\n}\nvoid main() {\n  vec3 bN = vnormal;\n  vec3 cb = S(vuv, timeElapsed);\n  vec3 bJ = normalize(vtbnMatrix * cb);\n  vec3 bK = -normalize(vpos - camPos);\n  vec3 bL = normalize(-lightingDirection);\n  float bO = 1.;\n  vec4 cc = vec4(bI(bJ, bK, bL, waterColor.rgb, lightingIntensity, bN, bO), waterColor.w);\n  gl_FragColor = bv(cc);\n}",defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}})}},WireFrameMaterial:class extends T_{constructor(t){super(t,S_)}},WireframeShader:class extends mx{constructor(t={}){let e=t.extraCommandProps||{};const n=[];e=pv({},e,{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},sample:{alpha:!0}}),super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aBarycentric;\nvarying vec3 vBarycentric;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projMatrix;\nuniform mat4 positionMatrix;\nvarying vec3 vPosition;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = getPosition(aPosition);\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(c * d, modelMatrix);\n#else\ngl_Position = projMatrix * modelViewMatrix * c * d;\n#endif\nvBarycentric = aBarycentric;\n  vPosition = aPosition;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec3 vBarycentric;\nuniform float time;\nuniform float thickness;\nuniform float secondThickness;\nuniform float dashRepeats;\nuniform float dashLength;\nuniform bool dashOverlap;\nuniform bool dashEnabled;\nuniform bool dashAnimate;\nuniform bool seeThrough;\nuniform bool insideAltColor;\nuniform bool dualStroke;\nuniform bool squeeze;\nuniform float squeezeMin;\nuniform float squeezeMax;\nuniform vec4 stroke;\nuniform vec4 fill;\nuniform float opacity;\nuniform bool noiseEnable;\nvarying vec3 vPosition;\n#ifdef HAS_INSTANCE\nvarying vec4 vInstanceColor;\n#endif\n#include <mask_frag>\n#define F4 0.309016994374947451\n#define halfDist 0.5\nvec4 c(vec4 x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nfloat c(float x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nvec4 d(vec4 x) {\n  return c((x * 34. + 1.) * x);\n}\nfloat d(float x) {\n  return c((x * 34. + 1.) * x);\n}\nvec4 e(vec4 r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nfloat e(float r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nvec4 f(float h, vec4 i) {\n  const vec4 k = vec4(1., 1., 1., -1.);\n  vec4 p, s;\n  p.xyz = floor(fract(vec3(h) * i.xyz) * 7.) * i.z - 1.;\n  p.w = 1.5 - dot(abs(p.xyz), k.xyz);\n  s = vec4(lessThan(p, vec4(.0)));\n  p.xyz = p.xyz + (s.xyz * 2. - 1.) * s.www;\n  return p;\n}\nfloat l(vec4 m) {\n  const vec4 n = vec4(.138196601125011, .276393202250021, .414589803375032, -.447213595499958);\n  vec4 o = floor(m + dot(m, vec4(F4)));\n  vec4 u = m - o + dot(o, n.xxxx);\n  vec4 A;\n  vec3 B = step(u.yzw, u.xxx);\n  vec3 D = step(u.zww, u.yyz);\n  A.x = B.x + B.y + B.z;\n  A.yzw = 1. - B;\n  A.y += D.x + D.y;\n  A.zw += 1. - D.xy;\n  A.z += D.z;\n  A.w += 1. - D.z;\n  vec4 E = clamp(A, .0, 1.);\n  vec4 F = clamp(A - 1., .0, 1.);\n  vec4 G = clamp(A - 2., .0, 1.);\n  vec4 H = u - G + n.xxxx;\n  vec4 I = u - F + n.yyyy;\n  vec4 J = u - E + n.zzzz;\n  vec4 K = u + n.wwww;\n  o = c(o);\n  float L = d(d(d(d(o.w) + o.z) + o.y) + o.x);\n  vec4 M = d(d(d(d(o.w + vec4(G.w, F.w, E.w, 1.)) + o.z + vec4(G.z, F.z, E.z, 1.)) + o.y + vec4(G.y, F.y, E.y, 1.)) + o.x + vec4(G.x, F.x, E.x, 1.));\n  vec4 i = vec4(1. / 294., 1. / 49., 1. / 7., .0);\n  vec4 N = f(L, i);\n  vec4 O = f(M.x, i);\n  vec4 P = f(M.y, i);\n  vec4 Q = f(M.z, i);\n  vec4 R = f(M.w, i);\n  vec4 S = e(vec4(dot(N, N), dot(O, O), dot(P, P), dot(Q, Q)));\n  N *= S.x;\n  O *= S.y;\n  P *= S.z;\n  Q *= S.w;\n  R *= e(dot(R, R));\n  vec3 T = max(.6 - vec3(dot(u, u), dot(H, H), dot(I, I)), .0);\n  vec2 U = max(.6 - vec2(dot(J, J), dot(K, K)), .0);\n  T = T * T;\n  U = U * U;\n  return 49. * (dot(T * T, vec3(dot(N, u), dot(O, H), dot(P, I))) + dot(U * U, vec2(dot(Q, J), dot(R, K))));\n}\nconst float V = 3.14159265359;\nfloat W(float X, float Y) {\n  float Z = fwidth(Y) * halfDist;\n  return smoothstep(X - Z, X + Z, Y);\n}\nvec4 ba(vec3 bb) {\n  float bc = min(min(bb.x, bb.y), bb.z);\n  float bd = .0;\n  if(noiseEnable)\n    bd += l(vec4(vPosition.xyz * 80.0, time * halfDist)) * .12;\n  bc += bd;\n  float be = max(bb.x, bb.y);\n  if(bb.y < bb.x && bb.y < bb.z) {\n    be = 1. - be;\n  }\n  float bf = thickness;\n  if(squeeze) {\n    bf *= mix(squeezeMin, squeezeMax, (1. - sin(be * V)));\n  }\n  if(dashEnabled) {\n    float bg = 1. / dashRepeats * dashLength / 2.;\n    if(!dashOverlap) {\n      bg += 1. / dashRepeats / 2.;\n    }\n    if(dashAnimate) {\n      bg += time * .22;\n    }\n    float bh = fract((be + bg) * dashRepeats);\n    bf *= 1. - W(dashLength, bh);\n  }\n  float bi = 1. - W(bf, bc);\n#ifdef HAS_INSTANCE\nvec4 bj = vInstanceColor;\n#else\nvec4 bj = stroke;\n#endif\nvec4 bk = vec4(.0);\n  if(seeThrough) {\n    bk = vec4(bj.xyz, bi);\n    if(insideAltColor && !gl_FrontFacing) {\n      bk.rgb = fill.xyz;\n    }\n  } else {\n    vec3 bl = mix(fill.xyz, bj.xyz, bi);\n    bk.a = fill.a;\n    if(dualStroke) {\n      float bm = 1. - W(secondThickness, bc);\n      vec3 bn = mix(fill.xyz, stroke.xyz, abs(bm - bi));\n      bk.rgb = bn;\n    } else {\n      bk.rgb = bl;\n    }\n  }\n  return bk;\n}\nvoid main() {\n  glFragColor = ba(vBarycentric);\n  glFragColor *= halfDist + opacity;\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(t,e)=>Hp(n,e.viewMatrix,e.modelMatrix)}],extraCommandProps:e}),this.version=300}},earcut:Zw,glMatrix:gp,mat2:xp,mat2d:Cp,mat3:kp,mat4:ug,pbr:Xw,quat:ty,quat2:sy,vec2:Oy,vec3:jg,vec4:gm}),Jw=Array.isArray,Kw=Object.keys,$w=Object.prototype.hasOwnProperty,tC=td((function t(e,n){if(e===n)return!0;if(e&&n&&"object"==typeof e&&"object"==typeof n){var i,r,o,s=Jw(e),a=Jw(n);if(s&&a){if((r=e.length)!=n.length)return!1;for(i=r;0!=i--;)if(!t(e[i],n[i]))return!1;return!0}if(s!=a)return!1;var h=e instanceof Date,l=n instanceof Date;if(h!=l)return!1;if(h&&l)return e.getTime()==n.getTime();var u=e instanceof RegExp,c=n instanceof RegExp;if(u!=c)return!1;if(u&&c)return e.toString()==n.toString();var A=Kw(e);if((r=A.length)!==Kw(n).length)return!1;for(i=r;0!=i--;)if(!$w.call(n,A[i]))return!1;for(i=r;0!=i--;)if(!t(e[o=A[i]],n[o]))return!1;return!0}return e!=e&&n!=n}));function eC(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function nC(t,...e){for(let n=0;n<e.length;n++)eC(t,e[n])}class iC{constructor(t){this.context=t,this.COLOR_ATTACHMENT0_WEBGL=36064,this.COLOR_ATTACHMENT1_WEBGL=36065,this.COLOR_ATTACHMENT2_WEBGL=36066,this.COLOR_ATTACHMENT3_WEBGL=36067,this.COLOR_ATTACHMENT4_WEBGL=36068,this.COLOR_ATTACHMENT5_WEBGL=36069,this.COLOR_ATTACHMENT6_WEBGL=36070,this.COLOR_ATTACHMENT7_WEBGL=36071,this.COLOR_ATTACHMENT8_WEBGL=36072,this.COLOR_ATTACHMENT9_WEBGL=36073,this.COLOR_ATTACHMENT10_WEBGL=577040,this.COLOR_ATTACHMENT11_WEBGL=577041,this.COLOR_ATTACHMENT12_WEBGL=577042,this.COLOR_ATTACHMENT13_WEBGL=577043,this.COLOR_ATTACHMENT14_WEBGL=577044,this.COLOR_ATTACHMENT15_WEBGL=577045,this.DRAW_BUFFER0_WEBGL=34853,this.DRAW_BUFFER1_WEBGL=34854,this.DRAW_BUFFER2_WEBGL=34855,this.DRAW_BUFFER3_WEBGL=34856,this.DRAW_BUFFER4_WEBGL=34857,this.DRAW_BUFFER5_WEBGL=34858,this.DRAW_BUFFER6_WEBGL=34859,this.DRAW_BUFFER7_WEBGL=34860,this.DRAW_BUFFER8_WEBGL=34861,this.DRAW_BUFFER9_WEBGL=34862,this.DRAW_BUFFER10_WEBGL=34863,this.DRAW_BUFFER11_WEBGL=34864,this.DRAW_BUFFER12_WEBGL=34865,this.DRAW_BUFFER13_WEBGL=34866,this.DRAW_BUFFER14_WEBGL=34867,this.DRAW_BUFFER15_WEBGL=34868,this.MAX_COLOR_ATTACHMENTS_WEBGL=36063,this.MAX_DRAW_BUFFERS_WEBGL=2178}drawBuffersWEBGL(){return this.context.drawBuffers.apply(this.context,arguments)}}class rC{constructor(t){this.context=t,this.VERTEX_ARRAY_BINDING_OES=34229}createVertexArrayOES(){return this.context.createVertexArray()}deleteVertexArrayOES(){return this.context.deleteVertexArray.apply(this.context,arguments)}isVertexArrayOES(){return this.context.isVertexArray.apply(this.context,arguments)}bindVertexArrayOES(){return this.context.bindVertexArray.apply(this.context,arguments)}}class oC{constructor(t){this.context=t,this.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070}drawArraysInstancedANGLE(){return this.context.drawArraysInstanced.apply(this.context,arguments)}drawElementsInstancedANGLE(){return this.context.drawElementsInstanced.apply(this.context,arguments)}vertexAttribDivisorANGLE(){return this.context.vertexAttribDivisor.apply(this.context,arguments)}}const sC={webgl_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},oes_element_index_uint:{},oes_texture_float:{},oes_texture_half_float:{HALF_FLOAT_OES:36193},ext_color_buffer_float:{},oes_standard_derivatives:{},ext_frag_depth:{},ext_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},ext_shader_texture_lod:{}},aC={has(t,e){const n=t.t;return!(!n&&!t.i.getExtension(e))&&(e=e.toLowerCase(),n&&sC[e]||"webgl_draw_buffers"===e||"oes_vertex_array_object"===e||"angle_instanced_arrays"===e)},mock:(t,e)=>(e=e.toLowerCase(),sC[e]?t.t?("oes_texture_float"!==e&&"oes_texture_half_float"!==e||t.i.getExtension("EXT_color_buffer_float"),sC[e]):t.i.getExtension(e):"webgl_draw_buffers"===e?new iC(t):"oes_vertex_array_object"===e?new rC(t):"angle_instanced_arrays"===e?new oC(t):null),getInternalFormat:(t,e,n)=>6402===e?33190:34041===e?35056:36193===n&&e===t.RGBA?34842:36193===n&&e===t.RGB?34843:n===t.FLOAT&&e===t.RGBA?34836:n===t.FLOAT&&e===t.RGB?34837:e,getTextureType:(t,e)=>36193===e?t.HALF_FLOAT:e};let hC=1,lC=class{constructor(t){var e;this.uid=hC++,this.states={scissor:[0,0,(e=t).canvas.width,e.canvas.height],viewport:[0,0,e.canvas.width,e.canvas.height],blendColor:[0,0,0,0],blendEquationSeparate:[e.FUNC_ADD,e.FUNC_ADD],blendFuncSeparate:[e.ONE,e.ZERO,e.ONE,e.ZERO],clearColor:[0,0,0,0],clearDepth:[1],clearStencil:[0],colorMask:[!0,!0,!0,!0],cullFace:[e.BACK],depthFunc:[e.LESS],depthMask:[!0],depthRange:[0,1],capabilities:{3042:!1,2884:!1,2929:!1,3024:!1,32823:!1,32926:!1,32928:!1,3089:!1,2960:!1},frontFace:[e.CCW],hint:{33170:[e.DONT_CARE],35723:[e.DONT_CARE]},lineWidth:[1],pixelStorei:{3333:[4],3317:[4],37440:[!1],37441:[!1],37443:[e.BROWSER_DEFAULT_WEBGL]},polygonOffset:[0,0],sampleCoverage:[1,!1],stencilFuncSeparate:{1028:[e.ALWAYS,0,4294967295],1029:[e.ALWAYS,0,4294967295]},stencilMaskSeparate:{1028:[4294967295],1029:[4294967295]},stencilOpSeparate:{1028:[e.KEEP,e.KEEP,e.KEEP],1029:[e.KEEP,e.KEEP,e.KEEP]},program:null,framebuffer:{36160:null,36008:null,36009:null},renderbuffer:{36161:null},textures:{active:-1,units:function(){const t=[],n=e.getParameter(e.MAX_COMBINED_TEXTURE_IMAGE_UNITS);for(let e=0;e<n;e++)t.push({3553:null,34067:null});return t[-1]={3553:null,34067:null},t}()},attributes:{},arrayBuffer:null,elementArrayBuffer:null},this.i=t,this.i._fusiongl_drawCalls=0,this.t=void 0!==window.WebGL2RenderingContext&&this.i instanceof window.WebGL2RenderingContext;const n=Object.getPrototypeOf(this);Object.setPrototypeOf(n,this.t?window.WebGL2RenderingContext.prototype:WebGLRenderingContext.prototype),this.s=t.getParameter(t.MAX_VERTEX_ATTRIBS)}get canvas(){return this.i.canvas}get drawingBufferWidth(){return this.i.drawingBufferWidth}get drawingBufferHeight(){return this.i.drawingBufferHeight}get drawingBufferColorSpace(){return this.i.drawingBufferColorSpace}set drawingBufferColorSpace(t){this.i.drawingBufferColorSpace=t}get gl(){return this.i}get buffersOES(){return this.h||(this.h=this.i.getExtension("WEBGL_draw_buffers")),this.h}get vaoOES(){return this.u||(this.u=this.i.getExtension("OES_vertex_array_object")),this.u}get angleOES(){return this.o||(this.o=this.i.getExtension("ANGLE_instanced_arrays")),this.o}get standOES(){return this.l||(this.l=this.i.getExtension("OES_standard_derivatives")),this.l}attachShader(t,e){return this.i.attachShader(t,e)}shaderSource(t,e){return this.i.shaderSource(t,e)}compileShader(t){return this.i.compileShader(t)}createShader(t){return this.i.createShader(t)}createProgram(){return this.i.createProgram()}deleteProgram(t){return this.states.program===t&&(this.states.program=null),this.i.deleteProgram(t)}deleteShader(t){return this.i.deleteShader(t)}detachShader(t,e){return this.i.detachShader(t,e)}getAttachedShaders(t){return this.i.getAttachedShaders(t)}linkProgram(t){return this.i.linkProgram(t)}makeXRCompatible(){return this.i.makeXRCompatible()}getShaderParameter(t,e){return this.i.getShaderParameter(t,e)}getShaderPrecisionFormat(t,e){return this.i.getShaderPrecisionFormat(t,e)}getShaderInfoLog(t){return this.i.getShaderInfoLog(t)}getShaderSource(t){return this.i.getShaderSource(t)}getProgramInfoLog(t){return this.i.getProgramInfoLog(t)}getProgramParameter(t,e){return this.i.getProgramParameter(t,e)}getError(){return this.i.getError()}getContextAttributes(){return this.i.getContextAttributes()}getExtension(t){return aC.has(this,t)?aC.mock(this,t):this.i.getExtension(t)}getSupportedExtensions(){return this.i.getSupportedExtensions()}getParameter(t){return this.i.getParameter(t)}isEnabled(t){return this.i.isEnabled(t)}isProgram(t){return this.i.isProgram(t)}isShader(t){return this.i.isShader(t)}validateProgram(t){return this.i.validateProgram(t)}clear(t){return this.m(),this.i.clear(t)}drawArrays(t,e,n){return this.m(),this.g(),this.i.drawArrays(t,e,n)}drawElements(t,e,n,i){return this.m(),this.g(),this.i.drawElements(t,e,n,i)}drawBuffers(t){return this.m(),this.g(),this.t?this.i.drawBuffers(t):this.buffersOES.drawBuffersWEBGL(t)}g(){this.i._fusiongl_drawCalls++}resetDrawCalls(){this.i._fusiongl_drawCalls=0}getDrawCalls(){return this.i._fusiongl_drawCalls}v(){const t=this.i,e=t.getParameter(t.CURRENT_PROGRAM),n=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES),i=[];for(let r=0;r<n;r++)i.push(t.getVertexAttrib(r,t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING));this._={buffers:i,elements:t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),framebuffer:t.getParameter(t.FRAMEBUFFER_BINDING)},window.DEBUGGING&&(this.uid,this._,this.uid,this.states.attributes,this.states.attributes[0].buffer,this._.buffers[0],this.states.attributes[1].buffer,this._.buffers[1],this.states.attributes[2].buffer,this._.buffers[2])}finish(){return this.i.finish()}flush(){return this.m(),this.i.flush()}commit(){return this.m(),this.i.commit()}isContextLost(){return this.i.isContextLost()}getFragDataLocation(t,e){return this.i.getFragDataLocation(t,e)}createSampler(){return this.i.createSampler()}deleteSampler(){return this.i.deleteSampler()}bindSampler(){return this.i.bindSampler()}isSampler(){return this.i.isSampler()}getSamplerParameter(){return this.i.getSamplerParameter()}isQuery(t){return this.i.beginQuery(t)}beginQuery(t,e){return this.i.beginQuery(t,e)}deleteQuery(t){return this.i.query(t)}isTransformFeedback(t){return this.i.isTransformFeedback(t)}beginTransformFeedback(t){return this.i.beginTransformFeedback(t)}deleteTransformFeedback(t){return this.i.deleteTransformFeedback(t)}pauseTransformFeedback(){return this.i.pauseTransformFeedback()}resumeTransformFeedback(){return this.i.resumeTransformFeedback()}transformFeedbackVaryings(t,e,n){return this.i.transformFeedbackVaryings(t,e,n)}bindBufferBase(t,e,n){return this.i.bbindBufferBase(t,e,n)}bindBufferRange(t,e,n,i,r){return this.i.bindBufferRange(t,e,n,i,r)}bindTransformFeedback(t,e){return this.i.bindTransformFeedback(t,e)}fenceSync(t,e){return this.i.fenceSync(t,e)}isSync(t){return this.i.isSync(t)}deleteSync(t){return this.i.deleteSync(t)}clientWaitSync(t,e,n){return this.i.clientWaitSync(t,e,n)}waitSync(t,e,n){return this.i.waitSync(t,e,n)}getSyncParameter(t,e){return this.i.getSyncParameter(t,e)}getIndexedParameter(t,e){return this.i.getIndexedParameter(t,e)}};nC(lC.prototype,{bufferData(...t){return this.m(),this.i.bufferData(...t)},bufferSubData(...t){return this.m(),this.i.bufferSubData(...t)},createBuffer(){return this.i.createBuffer()},deleteBuffer(t){const e=this.states;e.arrayBuffer===t?e.arrayBuffer=null:e.elementArrayBuffer===t&&(e.elementArrayBuffer=null);const n=e.attributes;for(const i in n)n[i].buffer===t&&(n[i].buffer=null);return this.i.deleteBuffer(t)},getBufferParameter(t,e){return this.m(),this.i.getBufferParameter(t,e)},isBuffer(t){return this.i.isBuffer(t)},copyBufferSubData(t,e,n,i,r){return this.i.isBuffer(t,e,n,i,r)},readBuffer(t){return this.i.readBuffer(t)}}),nC(lC.prototype,{checkFramebufferStatus(t){return this.i.checkFramebufferStatus(t)},createFramebuffer(){return this.i.createFramebuffer()},deleteFramebuffer(t){const e=this.states.framebuffer;for(const n in e)e[n]===t&&(e[n]=null);return this.i.deleteFramebuffer(t)},framebufferRenderbuffer(t,e,n,i){return this.m(),this.i.framebufferRenderbuffer(t,e,n,i)},framebufferTexture2D(t,e,n,i,r){return this.m(),this.i.framebufferTexture2D(t,e,n,i,r)},getFramebufferAttachmentParameter(t,e,n){return this.m(),this.i.getFramebufferAttachmentParameter(t,e,n)},isFramebuffer(t){return this.i.isFramebuffer(t)},readPixels(t,e,n,i,r,o,s){return this.m(),this.i.readPixels(t,e,n,i,r,o,s)},blitFramebuffer(t,e,n,i,r,o,s,a,h,l){return this.m(),this.i.blitFramebuffer(t,e,n,i,r,o,s,a,h,l)}}),nC(lC.prototype,{createRenderbuffer(){return this.i.createRenderbuffer()},deleteRenderbuffer(t){const e=this.states.renderbuffer;for(const n in e)e[n]===t&&(e[n]=null);return this.i.deleteRenderbuffer(t)},getRenderbufferParameter(t,e){return this.m(),this.i.getRenderbufferParameter(t,e)},isRenderbuffer(t){return this.i.isRenderbuffer(t)},renderbufferStorage(t,e,n,i){return this.m(),this.i.renderbufferStorage(t,e,n,i)},renderbufferStorageMultisample(t,e,n,i,r){return this.m(),this.i.renderbufferStorageMultisample(t,e,n,i,r)}}),nC(lC.prototype,{scissor(t,e,n,i){this.m();const r=this.states.scissor;r[0]===t&&r[1]===e&&r[2]===n&&r[3]===i||(r[0]=t,r[1]=e,r[2]=n,r[3]=i,this.i.scissor(t,e,n,i))},viewport(t,e,n,i){this.m();const r=this.states.viewport;r[0]===t&&r[1]===e&&r[2]===n&&r[3]===i||(r[0]=t,r[1]=e,r[2]=n,r[3]=i,this.i.viewport(t,e,n,i))},blendColor(t,e,n,i){this.m();const r=this.states.blendColor;r[0]===t&&r[1]===e&&r[2]===n&&r[3]===i||(r[0]=t,r[1]=e,r[2]=n,r[3]=i,this.i.blendColor(t,e,n,i))},blendEquation(t){this.m();const e=this.states.blendEquationSeparate;e[0]===t&&e[1]===t||(e[0]=t,e[1]=t,this.i.blendEquation(t))},blendEquationSeparate(t,e){this.m();const n=this.states.blendEquationSeparate;n[0]===t&&n[1]===e||(n[0]=t,n[1]=e,this.i.blendEquationSeparate(t,e))},blendFunc(t,e){this.m();const n=this.states.blendFuncSeparate;n[0]===t&&n[2]===t&&n[1]===e&&n[3]===e||(n[0]=t,n[1]=e,n[2]=t,n[3]=e,this.i.blendFunc(t,e))},blendFuncSeparate(t,e,n,i){this.m();const r=this.states.blendFuncSeparate;r[0]===t&&r[1]===e&&r[2]===n&&r[3]===i||(r[0]=t,r[1]=e,r[2]=n,r[3]=i,this.i.blendFuncSeparate(t,e,n,i))},clearColor(t,e,n,i){this.m();const r=this.states.clearColor;r[0]===t&&r[1]===e&&r[2]===n&&r[3]===i||(r[0]=t,r[1]=e,r[2]=n,r[3]=i,this.i.clearColor(t,e,n,i))},clearDepth(t){this.m();const e=this.states.clearDepth;e[0]!==t&&(e[0]=t,this.i.clearDepth(t))},clearStencil(t){this.m();const e=this.states.clearStencil;e[0]!==t&&(e[0]=t,this.i.clearStencil(t))},colorMask(t,e,n,i){this.m();const r=this.states.colorMask;r[0]===t&&r[1]===e&&r[2]===n&&r[3]===i||(r[0]=t,r[1]=e,r[2]=n,r[3]=i,this.i.colorMask(t,e,n,i))},cullFace(t){this.m();const e=this.states.cullFace;e[0]!==t&&(e[0]=t,this.i.cullFace(t))},depthFunc(t){this.m();const e=this.states.depthFunc;e[0]!==t&&(e[0]=t,this.i.depthFunc(t))},depthMask(t){this.m();const e=this.states.depthMask;e[0]!==t&&(e[0]=t,this.i.depthMask(t))},depthRange(t,e){this.m();const n=this.states.depthRange;n[0]===t&&n[1]===e||(n[0]=t,n[1]=e,this.i.depthRange(t,e))},disable(t){this.m();const e=this.states.capabilities;e[t]&&(e[t]=!1,this.i.disable(t))},enable(t){this.m();const e=this.states.capabilities;e[t]||(e[t]=!0,this.i.enable(t))},frontFace(t){this.m();const e=this.states.frontFace;e[0]!==t&&(e[0]=t,this.i.frontFace(t))},hint(t,e){this.m();const n=this.states.hint;n[t][0]!==e&&(n[t][0]=e,this.i.hint(t,e))},lineWidth(t){this.m();const e=this.states.lineWidth;e[0]!==t&&(e[0]=t,this.i.lineWidth(t))},pixelStorei(t,e){this.m();const n=this.states.pixelStorei;n[t]!==e&&(n[t]&&(n[t][0]=e),this.i.pixelStorei(t,e))},polygonOffset(t,e){this.m();const n=this.states.polygonOffset;n[0]===t&&n[1]===e||(n[0]=t,n[1]=e,this.i.polygonOffset(t,e))},sampleCoverage(t,e){this.m();const n=this.states.sampleCoverage;n[0]===t&&n[1]===e||(n[0]=t,n[1]=e,this.i.sampleCoverage(t,e))},stencilFunc(t,e,n){this.m();const i=this.states.stencilFuncSeparate,r=this.i;i[r.FRONT][0]===t&&i[r.FRONT][1]===e&&i[r.FRONT][2]===n&&i[r.BACK][0]===t&&i[r.BACK][1]===e&&i[r.BACK][2]===n||(i[r.FRONT][0]=i[r.BACK][0]=t,i[r.FRONT][1]=i[r.BACK][1]=e,i[r.FRONT][2]=i[r.BACK][2]=n,this.i.stencilFunc(t,e,n))},stencilFuncSeparate(t,e,n,i){if(this.m(),t===this.i.FRONT_AND_BACK)return void this.stencilFunc(e,n,i);const r=this.states.stencilFuncSeparate;r[t][0]===e&&r[t][1]===n&&r[t][2]===i||(r[t][0]=e,r[t][1]=n,r[t][2]=i,this.i.stencilFuncSeparate(t,e,n,i))},stencilMask(t){this.m();const e=this.i,n=this.states.stencilMaskSeparate;n[e.FRONT][0]===t&&n[e.BACK][0]===t||(n[e.FRONT][0]=t,n[e.BACK][0]=t,this.i.stencilMask(t))},stencilMaskSeparate(t,e){if(this.m(),t===this.i.FRONT_AND_BACK)return void this.stencilMask(e);const n=this.states.stencilMaskSeparate;n[t][0]!==e&&(n[t][0]=e,this.i.stencilMaskSeparate(t,e))},stencilOp(t,e,n){this.m();const i=this.states.stencilOpSeparate,r=this.i;i[r.FRONT][0]===t&&i[r.FRONT][1]===e&&i[r.FRONT][2]===n&&i[r.BACK][0]===t&&i[r.BACK][1]===e&&i[r.BACK][2]===n||(i[r.FRONT][0]=i[r.BACK][0]=t,i[r.FRONT][1]=i[r.BACK][1]=e,i[r.FRONT][2]=i[r.BACK][2]=n,this.i.stencilOp(t,e,n))},stencilOpSeparate(t,e,n,i){if(this.m(),t===this.i.FRONT_AND_BACK)return void this.stencilOp(e,n,i);const r=this.states.stencilOpSeparate;r[t][0]===e&&r[t][1]===n&&r[t][2]===i||(r[t][0]=e,r[t][1]=n,r[t][2]=i,this.i.stencilOpSeparate(t,e,n,i))},bindFramebuffer(t,e){this.m();const n=this.states.framebuffer;n[t]!==e&&(n[t]=e,this.i.bindFramebuffer(t,e))},bindRenderbuffer(t,e){this.m();const n=this.states.renderbuffer;n[t]!==e&&(n[t]=e,this.i.bindRenderbuffer(t,e))},bindTexture(t,e){this.m();const n=this.states.textures;n.units[-1!==n.active?n.active-33984:-1][t]=e,this.i.bindTexture(t,e)},activeTexture(t){this.m();const e=this.i,n=this.states.textures,i=n.active;n.active=t,this.activeUnit!==t&&(e.activeTexture(t),this.activeUnit=t),-1===i&&(n.units[t-33984][e.TEXTURE_2D]=n.units[-1][e.TEXTURE_2D],n.units[t-33984][e.TEXTURE_CUBE_MAP]=n.units[-1][e.TEXTURE_CUBE_MAP],n.units[-1][e.TEXTURE_2D]=null,n.units[-1][e.TEXTURE_CUBE_MAP]=null)},useProgram(t){this.m();const e=this.states;e.program!==t&&(this.states.activeAttribType=0,e.program=t,void 0===t.fid&&(t.fid=0),this.S(),this.i.useProgram(t))},S(){const t=this.states.program;if(!t)return;const e=t.cachedUniforms=t.cachedUniforms||{};for(const n in e)Array.isArray(e[n])?e[n].fill(null):e[n]=null},bindBuffer(t,e){this.m();const n=this.i,i=this.states;t===n.ELEMENT_ARRAY_BUFFER?i.elementArrayBuffer=e:i.arrayBuffer=e,n.bindBuffer(t,e)},bindVertexArray(t){this.m(),this.states.activeAttribType=1;const e=this.i,n=this.states;n.vao!==t&&(n.vao=t,this.t?e.bindVertexArray(t):this.vaoOES.bindVertexArrayOES(t))},vertexAttribPointer(t,e,n,i,r,o){this.m(),this.states.attributes[t]||(this.states.attributes[t]={enable:!0});const s=this.states.attributes[t];return s.buffer=this.states.arrayBuffer,s.args?(s.args[0]=t,s.args[1]=e,s.args[2]=n,s.args[3]=i,s.args[4]=r,s.args[5]=o):s.args=[t,e,n,i,r,o],this.i.vertexAttribPointer(t,e,n,i,r,o)},vertexAttribDivisor(t,e){return this.m(),this.states.attributes[t].divisor=e,this.t?this.i.vertexAttribDivisor(t,e):this.angleOES.vertexAttribDivisorANGLE(t,e)}},{m(){const t=this.i;t.A!==this&&(t.A?(this.p(t.A.states),t.A=this):t.A=this)},p(t){if(!t)return;delete this.activeUnit;const e=this.states,n=this.i;let i=0;for(const l in e)if("capabilities"!==l&&"textures"!==l&&"attributes"!==l&&"arrayBuffer"!==l&&"elementArrayBuffer"!==l&&"vao"!==l)if("program"===l)e.program!==t.program&&(n.useProgram(e.program),e.program&&(i=n.getProgramParameter(e.program,n.ACTIVE_ATTRIBUTES)));else if("framebuffer"===l)for(const i in e[l])e[l][i]!==t[l][i]&&n.bindFramebuffer(+i,e[l][i]);else if("renderbuffer"===l)for(const i in e[l])e[l][i]!==t[l][i]&&n.bindRenderbuffer(+i,e[l][i]);else if(!tC(e[l],t[l]))if(Array.isArray(t[l]))n[l](...e[l]);else if(t[l])for(const i in e[l])tC(e[l][i],t[l][i])||n[l](+i,...e[l][i]);this.S();for(const l in e.capabilities)e.capabilities[l]!==t.capabilities[l]&&n[e.capabilities[l]?"enable":"disable"](+l);const r=e.textures,o=r.units,s=t.textures.units,a=r.active-n.TEXTURE0;for(let l=0;l<o.length;l++)l===a||o[l][n.TEXTURE_2D]===s[l][n.TEXTURE_2D]&&o[l][n.TEXTURE_CUBE_MAP]===s[l][n.TEXTURE_CUBE_MAP]||(n.activeTexture(n.TEXTURE0+l),n.bindTexture(n.TEXTURE_2D,o[l][n.TEXTURE_2D]),n.bindTexture(n.TEXTURE_CUBE_MAP,o[l][n.TEXTURE_CUBE_MAP]));if(r.active>-1){const t=o[a];t[n.TEXTURE_2D]===s[a][n.TEXTURE_2D]&&t[n.TEXTURE_CUBE_MAP]===s[a][n.TEXTURE_CUBE_MAP]||(n.activeTexture(r.active),n.bindTexture(n.TEXTURE_2D,t[n.TEXTURE_2D]),n.bindTexture(n.TEXTURE_CUBE_MAP,t[n.TEXTURE_CUBE_MAP]))}this.t?n.bindVertexArray(null):this.u&&this.u.bindVertexArrayOES(null);const h=this.s;if(this.t||this.angleOES)for(let l=0;l<h;l++)this.t?n.vertexAttribDivisor(l,0):this.angleOES.vertexAttribDivisorANGLE(l,0);n.bindBuffer(n.ARRAY_BUFFER,e.arrayBuffer),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.elementArrayBuffer),1===e.activeAttribType?this.N(e,n):this.F(e,n,i)},N(t,e){const n=t.vao;n&&(this.t?e.bindVertexArray(n||null):this.u&&this.u.bindVertexArrayOES(n||null))},F(t,e,n){const i=this.s,r=t.attributes;let o=0;for(let s=0;s<i;s++){const t=r[s];if(o<n&&t){if(t.buffer){if(e.bindBuffer(e.ARRAY_BUFFER,t.buffer),e.vertexAttribPointer(...t.args),t.divisor&&(this.t?e.vertexAttribDivisor(s,t.divisor):this.angleOES.vertexAttribDivisorANGLE(s,t.divisor)),t.enable){e.enableVertexAttribArray(s),o++;continue}e.disableVertexAttribArray(s)}e.disableVertexAttribArray(s)}else e.disableVertexAttribArray(s)}}}),nC(lC.prototype,{compressedTexImage2D(t,e,n,i,r,o,s){return this.m(),this.i.compressedTexImage2D(t,e,n,i,r,o,s)},copyTexImage2D(t,e,n,i,r,o,s,a){return this.m(),this.i.copyTexImage2D(t,e,n,i,r,o,s,a)},copyTexSubImage2D(t,e,n,i,r,o,s,a){return this.m(),this.i.copyTexSubImage2D(t,e,n,i,r,o,s,a)},createTexture(){return this.i.createTexture()},deleteTexture(t){const e=this.states.textures.units;for(let n=0;n<e.length;n++)for(const i in e[n])e[n][i]===t&&(e[n][i]=null);return this.i.deleteTexture(t)},generateMipmap(t){return this.m(),this.i.generateMipmap(t)},getTexParameter(t,e){return this.m(),this.i.getTexParameter(t,e)},isTexture(t){return this.i.isTexture(t)},texImage2D(...t){if(this.m(),this.t){const e=t[t.length-2],n=aC.getInternalFormat(this.i,t[2],e);n!==t[2]&&(t[2]=n);const i=aC.getTextureType(this.i,e);i!==e&&(t[t.length-2]=i)}return this.i.texImage2D(...t)},texSubImage2D(...t){if(this.m(),this.t){const e=t[t.length-2],n=aC.getTextureType(this.i,e);n!==e&&(t[t.length-2]=n)}return this.i.texSubImage2D(...t)},texParameterf(t,e,n){return this.m(),this.i.texParameterf(t,e,n)},texParameteri(t,e,n){return this.m(),this.i.texParameteri(t,e,n)},texStorage2D(t,e,n,i,r){return this.m(),this.i.texStorage2D(t,e,n,i,r)},texImage3D(t,e,n,i,r,o,s,a,h,l){return this.m(),this.i.texImage3D(t,e,n,i,r,o,s,a,h,l)},texStorage3D(t,e,n,i,r,o){return this.m(),this.i.texStorage3D(t,e,n,i,r,o)},texSubImage3D(t,e,n,i,r,o,s,a,h,l,u){return this.m(),this.i.texSubImage3D(t,e,n,i,r,o,s,a,h,l,u)},copyTexSubImage3D(t,e,n,i,r,o,s,a,h){return this.m(),this.i.copyTexSubImage3D(t,e,n,i,r,o,s,a,h)},compressedTexSubImage3D(t,e,n,i,r,o,s,a,h,l,u){return this.m(),this.i.compressedTexSubImage3D(t,e,n,i,r,o,s,a,h,l,u)}});const uC=[];function cC(t,e){const n=e.length;for(let i=0;i<n;i++)t[i]=e[i];return t}nC(lC.prototype,{bindAttribLocation(t,e,n){return this.i.bindAttribLocation(t,e,n)},enableVertexAttribArray(t){return this.m(),this.states.attributes[t]||(this.states.attributes[t]={}),this.states.attributes[t].enable=!0,this.i.enableVertexAttribArray(t)},disableVertexAttribArray(t){return this.m(),this.states.attributes[t]||(this.states.attributes[t]={}),this.states.attributes[t].enable=!1,this.i.disableVertexAttribArray(t)},getActiveAttrib(t,e){return this.i.getActiveAttrib(t,e)},getActiveUniform(t,e){return this.i.getActiveUniform(t,e)},getAttribLocation(t,e){return this.i.getAttribLocation(t,e)},getUniformLocation(t,e){return this.i.getUniformLocation(t,e)},getVertexAttrib(t,e){return this.m(),this.i.getVertexAttrib(t,e)},getVertexAttribOffset(t,e){return this.m(),this.i.getVertexAttribOffset(t,e)},uniformBlockBinding(t,e,n){return this.m(),this.i.uniformBlockBinding(t,e,n)},L(t,...e){const n=this.states.program;if(!n)return!1;let i=t.fid;void 0===i&&(i=t.fid=n.fid++);const r=n.cachedUniforms[i];return!!function(t,e){if(!t)return!1;const n=e.length;for(let i=0;i<n;i++)if(t[i]&&void 0!==t[i].length){const n=t[i].length;for(let r=0;r<n;r++)if(t[i][r]!==e[i][r])return!1}else if(t[i]!==e[i])return!1;return!0}(r,e)||(n.cachedUniforms[i]=function(t,e){t=t||new Array(e.length);const n=e.length;for(let i=0;i<n;i++)t[i]=void 0!==e[i].length?cC(t[i]||[],e[i]):e[i];return t}(r,e),!1)},uniformMatrix2fv(t,e,n){this.L(t,e,n)||(this.m(),this.i.uniformMatrix2fv(t,e,n))},uniformMatrix3fv(t,e,n){this.L(t,e,n)||(this.m(),this.i.uniformMatrix3fv(t,e,n))},uniformMatrix4fv(t,e,n){n=this.B(n),this.L(t,e,n)||this.i.uniformMatrix4fv(t,e,n)},B:t=>t?(uC[0]=isNaN(t[0])?-1e30:t[0],uC[1]=isNaN(t[1])?-1e30:t[1],uC[2]=isNaN(t[2])?-1e30:t[2],uC[3]=isNaN(t[3])?-1e30:t[3],uC[4]=isNaN(t[4])?-1e30:t[4],uC[5]=isNaN(t[5])?-1e30:t[5],uC[6]=isNaN(t[6])?-1e30:t[6],uC[7]=isNaN(t[7])?-1e30:t[7],uC[8]=isNaN(t[8])?-1e30:t[8],uC[9]=isNaN(t[9])?-1e30:t[9],uC[10]=isNaN(t[10])?-1e30:t[10],uC[11]=isNaN(t[11])?-1e30:t[11],uC[12]=isNaN(t[12])?-1e30:t[12],uC[13]=isNaN(t[13])?-1e30:t[13],uC[14]=isNaN(t[14])?-1e30:t[14],uC[15]=isNaN(t[15])?-1e30:t[15],uC):t,uniform1f(t,e){return this.m(),this.i.uniform1f(t,e)},uniform1i(t,e){return this.m(),this.i.uniform1i(t,e)},uniform2f(t,e,n){return this.m(),this.i.uniform2f(t,e,n)},uniform2i(t,e,n){return this.m(),this.i.uniform2i(t,e,n)},uniform3f(t,e,n,i){return this.m(),this.i.uniform3f(t,e,n,i)},uniform3i(t,e,n,i){return this.m(),this.i.uniform3i(t,e,n,i)},uniform4f(t,e,n,i,r){return this.m(),this.i.uniform4f(t,e,n,i,r)},uniform4i(t,e,n,i,r){return this.m(),this.i.uniform4i(t,e,n,i,r)},uniform1ui(t,e){return this.m(),this.i.uniform1ui(t,e)},uniform2ui(t,e,n){return this.m(),this.i.uniform2ui(t,e,n)},uniform3ui(t,e,n,i){return this.m(),this.i.uniform3ui(t,e,n,i)},uniform4ui(t,e,n,i,r){return this.m(),this.i.uniform4ui(t,e,n,i,r)},uniform1fv(t,e,n,i){this.m(),void 0!==i?this.i.uniform1fv(t,e,n,i):void 0!==n?this.i.uniform1fv(t,e,n):this.i.uniform1fv(t,e)},uniform2fv(t,e,n,i){this.m(),void 0!==i?this.i.uniform2fv(t,e,n,i):void 0!==n?this.i.uniform2fv(t,e,n):this.i.uniform2fv(t,e)},uniform3fv(t,e,n,i){this.m(),void 0!==i?this.i.uniform3fv(t,e,n,i):void 0!==n?this.i.uniform3fv(t,e,n):this.i.uniform3fv(t,e)},uniform4fv(t,e,n,i){this.m(),void 0!==i?this.i.uniform4fv(t,e,n,i):void 0!==n?this.i.uniform4fv(t,e,n):this.i.uniform4fv(t,e)},uniform1iv(t,e,n,i){this.m(),void 0!==i?this.i.uniform1iv(t,e,n,i):void 0!==n?this.i.uniform1iv(t,e,n):this.i.uniform1iv(t,e)},uniform2iv(t,e,n,i){this.m(),void 0!==i?this.i.uniform2iv(t,e,n,i):void 0!==n?this.i.uniform2iv(t,e,n):this.i.uniform2iv(t,e)},uniform3iv(t,e,n,i){this.m(),void 0!==i?this.i.uniform3iv(t,e,n,i):void 0!==n?this.i.uniform3iv(t,e,n):this.i.uniform3iv(t,e)},uniform4iv(t,e,n,i){this.m(),void 0!==i?this.i.uniform4iv(t,e,n,i):void 0!==n?this.i.uniform4iv(t,e,n):this.i.uniform4iv(t,e)},uniform1uiv(t,e,n,i){this.m(),void 0!==i?this.i.uniform1uiv(t,e,n,i):void 0!==n?this.i.uniform1uiv(t,e,n):this.i.uniform1uiv(t,e)},uniform2uiv(t,e,n,i){this.m(),void 0!==i?this.i.uniform2uiv(t,e,n,i):void 0!==n?this.i.uniform2uiv(t,e,n):this.i.uniform2uiv(t,e)},uniform3uiv(t,e,n,i){this.m(),void 0!==i?this.i.uniform3uiv(t,e,n,i):void 0!==n?this.i.uniform3uiv(t,e,n):this.i.uniform3uiv(t,e)},uniform4uiv(t,e,n,i){this.m(),void 0!==i?this.i.uniform4uiv(t,e,n,i):void 0!==n?this.i.uniform4uiv(t,e,n):this.i.uniform4uiv(t,e)},vertexAttrib1f(t,e){return this.m(),this.i.vertexAttrib1f(t,e)},vertexAttrib2f(t,e,n){return this.m(),this.i.vertexAttrib2f(t,e,n)},vertexAttrib3f(t,e,n,i){return this.m(),this.i.vertexAttrib3f(t,e,n,i)},vertexAttrib4f(t,e,n,i,r){return this.m(),this.i.vertexAttrib4f(t,e,n,i,r)},vertexAttrib1fv(t,e){return this.m(),this.i.vertexAttrib1fv(t,e)},vertexAttrib2fv(t,e){return this.m(),this.i.vertexAttrib2fv(t,e)},vertexAttrib3fv(t,e){return this.m(),this.i.vertexAttrib3fv(t,e)},vertexAttrib4fv(t,e){return this.m(),this.i.vertexAttrib4fv(t,e)},vertexAttribI4i(t,e,n,i,r){return this.m(),this.i.vertexAttribI4i(t,e,n,i,r)},vertexAttribI4ui(t,e,n,i,r){return this.m(),this.i.vertexAttribI4ui(t,e,n,i,r)},vertexAttribI4iv(t,e){return this.m(),this.i.vertexAttribI4iv(t,e)},vertexAttribI4uiv(t,e){return this.m(),this.i.vertexAttribI4uiv(t,e)}}),nC(lC.prototype,{createVertexArray(){return this.t?this.i.createVertexArray():this.vaoOES.createVertexArrayOES()},deleteVertexArray(t){const e=this.states;return e.vao===t&&(e.vao=null),this.t?this.i.deleteVertexArray(t):this.vaoOES.deleteVertexArrayOES(t)},isVertexArray(t){return this.t?this.i.isVertexArray(t):this.vaoOES.isVertexArrayOES(t)}}),nC(lC.prototype,{drawArraysInstanced(t,e,n,i){return this.m(),this.g(),this.t?this.i.drawArraysInstanced(t,e,n,i):this.angleOES.drawArraysInstancedANGLE(t,e,n,i)},drawElementsInstanced(t,e,n,i,r){return this.m(),this.g(),this.t?this.i.drawElementsInstanced(t,e,n,i,r):this.angleOES.drawElementsInstancedANGLE(t,e,n,i,r)}});var AC="undefined"!=typeof Float32Array?Float32Array:Array;function fC(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=e[9],f=e[10],d=e[11],p=e[12],g=e[13],m=e[14],y=e[15],v=n[0],_=n[1],x=n[2],b=n[3];return t[0]=v*i+_*a+x*c+b*p,t[1]=v*r+_*h+x*A+b*g,t[2]=v*o+_*l+x*f+b*m,t[3]=v*s+_*u+x*d+b*y,t[4]=(v=n[4])*i+(_=n[5])*a+(x=n[6])*c+(b=n[7])*p,t[5]=v*r+_*h+x*A+b*g,t[6]=v*o+_*l+x*f+b*m,t[7]=v*s+_*u+x*d+b*y,t[8]=(v=n[8])*i+(_=n[9])*a+(x=n[10])*c+(b=n[11])*p,t[9]=v*r+_*h+x*A+b*g,t[10]=v*o+_*l+x*f+b*m,t[11]=v*s+_*u+x*d+b*y,t[12]=(v=n[12])*i+(_=n[13])*a+(x=n[14])*c+(b=n[15])*p,t[13]=v*r+_*h+x*A+b*g,t[14]=v*o+_*l+x*f+b*m,t[15]=v*s+_*u+x*d+b*y,t}function dC(){var t=new AC(3);return AC!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function pC(t,e,n){var i=new AC(3);return i[0]=t,i[1]=e,i[2]=n,i}function gC(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function mC(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function yC(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function vC(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function _C(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t}function xC(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*s,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*s,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*s,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*s,t}function bC(){var t=new AC(4);return AC!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),dC(),function(){var t;t=new AC(4),AC!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var wC,CC=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};dC(),pC(1,0,0),pC(0,1,0),bC(),bC(),wC=new AC(9),AC!=Float32Array&&(wC[1]=0,wC[2]=0,wC[3]=0,wC[5]=0,wC[6]=0,wC[7]=0),wC[0]=1,wC[4]=1,wC[8]=1;let PC=0;function MC(t){return null==t}function TC(t){return!MC(t)}function SC(t){return!MC(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function IC(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function EC(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+t)}function OC(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function RC(t){const e=(r=t.substring(t.indexOf(",")+1),"undefined"!=typeof self?self.atob(r):window.atob(r)),n=e.length,i=new Uint8Array(n);var r;for(let o=0;o<n;o++)i[o]=e.charCodeAt(o);return i.buffer}const DC=[],kC=[],LC=[],FC=[0,0,0],NC=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),zC=[1,1,1];function BC(t,e,n,i,r,o,s){const a=EC(s),h=a.BYTES_PER_ELEMENT;if((0===r||r===i*h)&&o%h==0){const r=new a(e,o,n*i);return t.set(r),t}0===r&&(r=i*h);const l=new Uint8Array(i*h);for(let u=0;u<n;u++){let n=null;const s=new Uint8Array(e,r*u+o,i*h);l.set(s),n=new a(l.buffer,0,i);for(let e=0;e<i;e++)t[u*i+e]=n[e]}return t}const HC="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function jC(t,e,n){const i=new Uint8Array(t,e,n);return HC.decode(i)}const UC={get:function(t,e={},n){e||(e={});const i=new AbortController,r=i.signal,o=IC({},e);o.signal=r,o.method||(o.method="GET"),o.referrerPolicy=o.referrerPolicy||"origin","undefined"==typeof window||o.referrer||(o.referrer=window.location.href),n&&(t=n(t));const s=fetch(t,o).then((t=>{const n=this._parseResponse(t,e.responseType);return n.message?n:n.then((n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return s.xhr=i,s},_parseResponse:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={},n)=>(e||(e={}),e.responseType="arraybuffer",UC.get(t,e,n)),getJSON:function(t,e={},n){return e&&e.jsonp?UC.jsonp(t):((e=e||{}).responseType="json",UC.get(t,e,n))},jsonp:function(t){const e="_maptalks_jsonp_"+PC++;t.match(/\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise((t=>{window[e]=function(i){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(i)},document.getElementsByTagName("head")[0].appendChild(n)}))}};let GC=class{constructor(t,e,n,i,r){this._requestImage=t,this.decoders=e,this._supportedFormats=n,this.images={},this._imgRequests={},this._fetchOptions=i||{},this._urlModifier=r}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const i=this._createDataView(e,this.buffers[t.id]);return this.getImageByBuffer(i,n)}if(this._imgRequests[t.id])return this._imgRequests[t.id].then((()=>{const i=this._createDataView(e,this.buffers[t.id]);return this.getImageByBuffer(i,n)}));if(OC(t.uri)){const i=this.buffers[t.id]=RC(t.uri),r=this._createDataView(e,i);return this.getImageByBuffer(r,n)}let i;const r=t.uri.indexOf("blob:")>=0;return i=t.uri.indexOf("://")>0||r?t.uri:this.rootPath+"/"+t.uri,this._imgRequests[t.id]=UC.getArrayBuffer(i,this._fetchOptions,this._urlModifier).then((i=>{const r=this.buffers[t.id]=i.data,o=this._createDataView(e,r);return this.getImageByBuffer(o,n)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;return n[e.mimeType]?n[e.mimeType](t,{supportedFormats:this._supportedFormats}):"image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType?(console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this._getImageInfo(e.id,t)}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this._imgRequests[t.id]?this._imgRequests[t.id].then((()=>this.images[t.id])):this._imgRequests[t.id]=this._getImageInfo(t.id,e)}_getImageInfo(t,e){return new Promise(((n,i)=>{let r=e;this._urlModifier&&(r=this._urlModifier(e)),this._requestImage(r,this._fetchOptions,((r,o)=>{r?i(r):(URL.revokeObjectURL(e),this.images[t]=o,n(this.images[t]))}))}))}};const VC=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],WC=[];let qC=class{constructor(t,e,n,i,r){this.rootPath=t,this.gltf=e,this._enableInterleave=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this._compareAccessor(),this._fetchOptions=i,this._urlModifier=r}_requestData(t,e){const n=this.gltf,i=n.accessors[e];return void 0===i.bufferView?(this.accessors[i.id]=this._toBufferData(t,e,null,0),Promise.resolve(this.accessors[i.id])):i&&this.accessors[i.id]?Promise.resolve(this.accessors[i.id]):this._requestBufferOfBufferView(n.bufferViews[i.bufferView]).then((n=>{const{buffer:r,byteOffset:o}=n;return this.accessors[i.id]=this._toBufferData(t,e,r,o)}))}_requestBufferOfBufferView(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id])return Promise.resolve({buffer:this.buffers[e.id],byteOffset:0});if(this.requests[e.id])return this.requests[e.id].then((()=>Promise.resolve({buffer:this.buffers[e.id],byteOffset:0})));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(OC(e.uri)){const t=this.buffers[e.id]=RC(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=UC.getArrayBuffer(t,this._fetchOptions,!n&&this._urlModifier).then((i=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=i.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_toBufferData(t,e,n,i=0){const r=this.gltf,o=r.accessors[e],s=void 0!==o.bufferView?r.bufferViews[o.bufferView]:{},a=(s.byteOffset||0)+i,h=this._getTypeItemSize(o.type),l=EC(o.componentType),u=s.byteStride||0,c={array:void 0,name:t,accessorName:e,byteLength:o.count*h*l.BYTES_PER_ELEMENT,componentType:o.componentType,count:o.count,type:o.type,itemSize:h,max:o.max,min:o.min,extensions:o.extensions};if(o.min&&(c.min=o.min),o.max&&(c.max=o.max),n)if(this._enableInterleave)c.byteStride=u,c.byteOffset=a+(o.byteOffset||0),!u||u===h*l.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(c.array=this._typedArray(n,o.count,h,a+(o.byteOffset||0),l),c.array.buffer.byteLength===c.byteLength&&(c.byteOffset=0)):c.array=new Uint8Array(n,a,s.byteLength);else if(o.interleaved){c.byteStride=0,c.byteOffset=0;const t=new l(o.count*h);if(c.array=BC(t,n,o.count,h,u,a+(o.byteOffset||0),o.componentType),c.extensions&&c.extensions.WEB3D_quantized_attributes&&h>2){const t=new Float32Array(c.array.length),{decodeMatrix:e}=c.extensions.WEB3D_quantized_attributes;for(let n=0;n<c.array.length;n+=h){WC[0]=c.array[n],WC[1]=c.array[n+1],WC[2]=c.array[n+2],WC[3]=1;const i=xC(WC,WC,e);t[n]=i[0],t[n+1]=i[1],t[n+2]=i[2]}c.componentType=5126,c.array=t}}else c.byteStride=0,c.array=this._typedArray(n,o.count,h,a+(o.byteOffset||0),l),c.byteOffset=c.array.byteOffset;else{c.array=new l(o.count);const t=c.min||c.max;t&&(c.array[0]=t[0],c.array[1]=t[1],c.array[2]=t[2])}return c}_compareAccessor(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}_typedArray(t,e,n,i,r){return i%r.BYTES_PER_ELEMENT!=0&&(t=t.slice(i,i+e*n*r.BYTES_PER_ELEMENT),i=0),new r(t,i,n*e)}_getTypeItemSize(t){const e=VC.indexOf(t);return VC[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this._requestBufferOfBufferView(e).then((i=>{const{buffer:r,byteOffset:o}=i,s=jC(r,o+(e.byteOffset||0),n);return t.content=s,t}))}if(t.uri){if(OC(t.uri)){const e=RC(t.uri),n=jC(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}return UC.get(this.rootPath+"/"+t.uri,this._fetchOptions,this._urlModifier).then((e=>(t.content=e,t)))}return Promise.resolve(t)}));return Promise.all(n).then((()=>t))}},ZC=class extends GC{constructor(t,e,n,i,r,o,s,a){super(i,r,o,s,a),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new qC(t,e,n,s,a)}iterate(t,e){const n=this.gltf[e];if(!n)return;let i=0;for(const r in n)t(r,n[r],i++)}createNode(t){const e={};if(TC(t.name)&&(e.name=t.name),TC(t.children)&&(e.children=t.children),TC(t.jointName)&&(e.jointName=t.jointName),TC(t.matrix)&&(e.matrix=t.matrix),TC(t.rotation)&&(e.rotation=t.rotation),TC(t.scale)&&(e.scale=t.scale),TC(t.translation)&&(e.translation=t.translation),TC(t.extras)&&(e.extras=t.extras),TC(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=(n=DC,i=e.translation||FC,n[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=i[0],n[13]=i[1],n[14]=i[2],n[15]=1,n),o=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=n+n,a=i+i,h=r+r,l=n*s,u=i*s,c=i*a,A=r*s,f=r*a,d=r*h,p=o*s,g=o*a,m=o*h;return t[0]=1-c-d,t[1]=u+m,t[2]=A-g,t[3]=0,t[4]=u-m,t[5]=1-l-d,t[6]=f+p,t[7]=0,t[8]=A+g,t[9]=f-p,t[10]=1-l-c,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(kC,e.rotation||NC),s=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(LC,e.scale||zC);return fC(s,o,s),fC(t,r,s)}var n,i;return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}_loadMaterials(t){const e={};for(const n in t){const i=t[n];let r,o;i.instanceTechnique&&i.instanceTechnique.values?(r=i.instanceTechnique,o=r.values.diffuse):(r=i,o=r.values.tex||r.values.diffuseTex||r.values.diffuse);const s={baseColorTexture:{index:o}};i.name&&(s.name=i.name),i.extensions&&(s.extensions=i.extensions),i.extras&&(s.extras=i.extras),e[n]=s}return e}_loadImage(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,(n.byteOffset||0)+this.glbBuffer.byteOffset,n.byteLength);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}_getTexture(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this._loadImage(n).then((t=>({image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:this.gltf.samplers[e.sampler]})))}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,i;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,i=n.values.diffuse):(n=e,i=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===i||void 0===this.gltf.textures)return null;const r=this.gltf.textures[i];return r?{format:r.format||6408,internalFormat:r.internalFormat||6408,type:r.type||5121,sampler:this.gltf.samplers[r.sampler],source:this.gltf.images[r.source]}:null}getMaterial(){return null}getAnimations(){return null}};const QC=9729;let XC=class extends GC{constructor(t,e,n,i,r,o,s,a){super(i,r,o,s,a),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new qC(t,e,n,s,a)}iterate(t,e){const n=this.gltf[e];if(n)for(let i=0;i<n.length;i++)t(i,n[i],i)}createNode(t){const e={};return IC(e,t),!TC(t.weights)&&this.gltf.meshes&&TC(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}_getTexture(t){const e=this.gltf.textures[t];if(!e)return null;let n=e.source;if(e.extensions&&e.extensions.EXT_texture_webp&&(n=e.extensions.EXT_texture_webp.source),!TC(n))return null;const i=this.gltf.images[n];return this._loadImage(i).then((t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:i.mimeType,name:i.name,extensions:i.extensions,extras:i.extras}};IC(n,e);const r=TC(e.sampler)?this.gltf.samplers[e.sampler]:void 0;if(r&&(n.sampler=r,n.sampler.magFilter=r.magFilter||QC,n.sampler.minFilter=r.minFilter||9987,n.sampler.wrapS=r.wrapS||10497,n.sampler.wrapT=r.wrapT||10497),"image/ktx2"===n.image.mimeType&&!n.image.mipmap&&n.sampler&&n.sampler.minFilter!==QC&&9728!==n.sampler.minFilter){const t=n.sampler.minFilter;n.sampler.minFilter=9984===t||9986===t?9728:QC}return t.format&&(n.format=t.format),n}))}_loadImage(t){if(!TC(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this._requestFromGlbBuffer(e,t)}return null}_requestFromGlbBuffer(t,e){const n=this._createDataView(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}_createDataView(t,e,n){return n=n||0,new Uint8Array(e,(t.byteOffset||0)+n,t.byteLength)}_transformArrayBufferToBase64(t,e){const n=new Array(t.byteLength);for(let r=0;r<t.byteLength;r++)n[r]=String.fromCharCode(t[r]);var i;return n.join(""),"data:"+(e=e||"image/png")+";base64,"+(i=unescape(encodeURIComponent(n)),"undefined"!=typeof self?self.btoa(i):window.btoa(i))}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t}))}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(TC(t[n].input)||TC(t[n].output))&&(e.push(this.accessor._requestData("input",t[n].input)),e.push(this.accessor._requestData("output",t[n].output)));return Promise.all(e).then((e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t}))}};const YC="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let JC=class t{static read(e,n=0,i=0){i||(i=e.byteLength);const r=new DataView(e,n,i),o=r.getUint32(4,!0);if(1===o)return t.readV1(r,n);if(2===o)return t.readV2(e,n);throw new Error("Unsupported glb version : "+o)}static readV1(t,e){const n=t.getUint32(8,!0),i=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const r=KC(t.buffer,20+e,i);return{json:JSON.parse(r),glbBuffer:{byteOffset:20+e+i,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,i,r;const o=new DataView(t,e+12);let s=0;for(;s+8<o.byteLength;){const a=o.getUint32(s,!0);s+=4;const h=o.getUint32(s,!0);if(s+=4,1313821514===h)n=KC(t,e+12+s,a);else if(5130562===h){r=e+12+s,i=a;break}s+=a}return{json:JSON.parse(n),glbBuffer:{byteOffset:r,buffer:t,byteLength:i}}}};function KC(t,e,n){if(YC){const i=new Uint8Array(t,e,n);return YC.decode(i)}return function(t){const e=t.length;let n="";for(let i=0;i<e;){let r=t[i++];if(128&r){let n=$C[r>>3&7];if(!(64&r)||!n||i+n>e)return null;for(r&=63>>n;n>0;n-=1){const e=t[i++];if(128!=(192&e))return null;r=r<<6|63&e}}n+=String.fromCharCode(r)}return n}(new Uint8Array(t,e,n))}const $C=[1,1,1,1,2,2,3,0],tP=[0,0,0],eP=[0,0,0,1],nP=[1,1,1],iP={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},rP={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},oP={_getTRSW(t,e,n,i,r,o,s,a){const h=TC(t)?e.animations:[e.animations[0]],l={};for(let u=0;u<h.length;u++){const e=h[u],c=e.name||u;if(TC(t)&&c!==t)continue;const A=e.channelsMap[n];if(A)for(let t=0;t<A.length;t++){const n=A[t];"translation"===n.target.path?(this._getAnimateData(r,e.samplers[n.sampler],i,1),l.translation=gC(tP,r)):"rotation"===n.target.path?(this._getQuaternion(o,e.samplers[n.sampler],i,1),l.rotation=CC(eP,o)):"scale"===n.target.path?(this._getAnimateData(s,e.samplers[n.sampler],i,1),l.scale=gC(nP,s)):"weights"===n.target.path&&a&&(this._getAnimateData(a,e.samplers[n.sampler],i,a.length),l.weights=a)}}return l},_getAnimateData(t,e,n,i){switch(e.interpolation){case"LINEAR":{const r=this._getPreNext(rP,e,n,1*i);r&&(t=function(t,e,n,i){for(let r=0;r<t.length;r++)t[r]=e[r]+i*(n[r]-e[r]);return t}(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION));break}case"STEP":{const r=this._getPreNext(rP,e,n,1*i);r&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this._getPreNext(rP,e,n,3*i);r&&(t=this._getCubicSpline(t,r,e.input.array,3*i));break}}return t},_getQuaternion(t,e,n){switch(e.interpolation){case"LINEAR":{const _=this._getPreNext(rP,e,n,1);_&&(i=t,r=_.PREVIOUS,o=_.NEXT,s=_.INTERPOLATION,A=r[0],f=r[1],d=r[2],p=r[3],g=o[0],m=o[1],y=o[2],v=o[3],(h=A*g+f*m+d*y+p*v)<0&&(h=-h,g=-g,m=-m,y=-y,v=-v),1-h>1e-6?(a=Math.acos(h),l=Math.sin(a),u=Math.sin((1-s)*a)/l,c=Math.sin(s*a)/l):(u=1-s,c=s),i[0]=u*A+c*g,i[1]=u*f+c*m,i[2]=u*d+c*y,i[3]=u*p+c*v);break}case"STEP":{const i=this._getPreNext(rP,e,n,1);i&&(t=_C(t,...i.PREVIOUS));break}case"CUBICSPLINE":{const i=this._getPreNext(rP,e,n,3);if(i){for(let t=0;t<i.PREVIOUS.length;t++)i.PREVIOUS[t]=Math.acos(i.PREVIOUS[t]),i.NEXT[t]=Math.acos(i.NEXT[t]);t=this._getCubicSpline(t,i,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}var i,r,o,s,a,h,l,u,c,A,f,d,p,g,m,y,v;return t},_search(t,e){const n=t.length;let i,r,o,s=0,a=n-1,h=Math.floor((s+a)/2);for(;s<=n-1&&a>=0;){if(s===a)return null;if(t[h]<=e&&e<=t[h+1]){const n=t[h];return i=h,r=h+1,o=(e-n)/(t[h+1]-n),{preIndx:i,nextIndex:r,interpolation:o}}e<t[h]?(a=h,h=Math.floor((s+a)/2)):t[h+1]<e&&(s=h,h=Math.floor((s+a)/2))}return null},_getPreNext(t,e,n,i){const r=e.input.array,o=e.output.array,s=e.output.itemSize;(n<r[0]||n>r[r.length-1])&&(n=Math.max(r[0],Math.min(r[r.length-1],n))),n===r[r.length-1]&&(n=r[0]);const a=this._search(r,n);if(!a||!a.nextIndex)return null;const{preIndx:h,nextIndex:l,interpolation:u}=a;t.PREINDEX=h,t.NEXTINDEX=l,t.INTERPOLATION=u;const c=s*i;return t.PREVIOUS=o.subarray(t.PREINDEX*c,(t.PREINDEX+1)*c),t.NEXT=o.subarray(t.NEXTINDEX*c,(t.NEXTINDEX+1)*c),t},_getCubicSpline(t,e,n,i){const r=e.INTERPOLATION,o=n[e.PREINDEX],s=n[e.NEXTINDEX];for(let a=0;a<3;a++){const n=e.PREVIOUS[i+a],h=(s-o)*e.PREVIOUS[2*i+a],l=e.NEXT[3+a],u=(s-o)*e.NEXT[a],c=(2*Math.pow(r,3)-3*Math.pow(r,2)+1)*n+(Math.pow(r,3)-2*Math.pow(r,2)+r)*h+(2*-Math.pow(r,3)+3*Math.pow(r,2))*l+(Math.pow(r,3)-Math.pow(r,2))*u;t[a]=c}return t},getAnimationClip(t,e,n,i){const r=t.nodes[e]&&t.nodes[e].weights;return mC(tP,...iP.TRANSLATION),_C(eP,...iP.ROTATION),mC(nP,...iP.SCALE),this._getTRSW(i,t,e,n,tP,eP,nP,r)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,n)=>{let i=-1/0,r=1/0;const o=e.channels;for(let t=0;t<o.length;t++){const n=e.samplers[o[t].sampler].input.array;n[n.length-1]>i&&(i=n[n.length-1]),n[0]<r&&(r=n[0])}t.timeSpan[e.name||n]={max:i,min:r}})),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?TC(e)?n[e]:n[Object.keys(n)[0]]:null}};let sP=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(cft){}t&&"undefined"!=typeof createImageBitmap&&(sP=!0)}const aP="undefined"==typeof document?null:document.createElement("canvas");function hP(t,e,n){const i=new Image;i.crossOrigin="",i.onload=()=>{if(!aP)return void n(new Error("There is no canvas to draw image!"));aP.width=i.width,aP.height=i.height;const t=aP.getContext("2d",{willReadFrequently:!0});t.drawImage(i,0,0,i.width,i.height);const e=t.getImageData(0,0,i.width,i.height),r={width:i.width,height:i.height,data:new Uint8Array(e.data)};n(null,r)},i.onerror=function(t){n(t)},i.src=t}const lP=[],uP=[],cP=30;let AP,fP;function dP(t,e,n){AP||(AP=new OffscreenCanvas(2,2),fP=AP.getContext("2d",{willReadFrequently:!0}));let i=null;if(SC(t))this.options.urlModifier&&(t=this.options.urlModifier(t)),lP.push([t,e,n,this]),pP();else{const e=new Blob([t]);i=createImageBitmap(e),i.then(gP.bind(this)).then((t=>{n(null,t)})).catch((t=>{console.warn(t),n(t)}))}}function pP(){if(!lP.length||uP.length>cP)return;const t=lP.shift(),[e,n,i,r]=t;uP.push(t),fetch(e,n).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then(gP.bind(r)).then((e=>{i.call(r,null,e);const n=uP.indexOf(t);uP.splice(n,1),pP()})).catch((e=>{console.warn(e),i.call(r,e);const n=uP.indexOf(t);uP.splice(n,1),pP()}))}function gP(t){let{width:e,height:n}=t;mP(e)||(e=yP(e)),mP(n)||(n=yP(n));const i=this.options.maxTextureSize;i&&(e=Math.min(i,e),n=Math.min(i,n)),AP.width=e,AP.height=n,fP.drawImage(t,0,0,e,n),t.close();const r=fP.getImageData(0,0,e,n);return{width:e,height:n,data:new Uint8Array(r.data)}}function mP(t){return!(t&t-1)&&0!==t}function yP(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var vP=Object.freeze({__proto__:null,Ajax:UC,GLTFLoader:class{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),this._fetchOptions=this.options.fetchOptions||{},e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:i}=JC.read(e.buffer,e.byteOffset,e.byteLength);this._init(t,n,i)}else this._init(t,e);this._accessor=new qC(this.rootPath,this.gltf,this.glbBuffer,this._fetchOptions,this.options.urlModifier),this._checkExtensions()}_checkExtensions(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders["image/ktx2"])throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded");if(t.indexOf("EXT_meshopt_compression")>=0)throw new Error("EXT_meshopt_compression extension is not supported yet.")}}_loadExtensions(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this._accessor.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){const e=this._loadScene(t=t||{}),n=this._loadAnimations(),i=this._loadTextures(),r=this._loadExtensions();return Promise.all([e,n,i,r]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let n=0;n<e.length;n++){const t=e[n];t.channelsMap={};for(let e=0;e<t.channels.length;e++){const n=t.channels[e];t.channelsMap[n.target.node]||(t.channelsMap[n.target.node]=[]),t.channelsMap[n.target.node].push(n)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let i=0;i<e.length;i++)e[i].uri&&e[i].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[i].uri});for(let i=0;i<n.length;i++)n[i].uri&&n[i].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[i].uri})}return t}static getAnimationClip(t,e,n,i){return oP.getAnimationClip(t,e,n,i)}static getAnimationTimeSpan(t,e){return oP.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return EC(t)}static readInterleavedArray(t,e,n,i,r,o,s){return BC(t,e,n,i,r,o,s)}_init(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=sP?dP.bind(this):this.options.requestImage||hP,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new XC(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="buffer_"+n}),"buffers"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors")):(this.adapter=new ZC(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"))}_parseNodes(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||SC(t.children[0])))return t;const i=t.children.map((t=>{const n=e[t];return n.nodeIndex=t,this._parseNodes(n,e)}));t.children=i}var n;return t}_loadScene(t){return this._loadNodes(t).then((t=>{const e=this.scenes=[];let n;for(const r in t)t[r]=this._parseNodes(t[r],t),t[r].nodeIndex=Number(r)?Number(r):r;this.adapter.iterate(((i,r,o)=>{const s={};r.name&&(s.name=r.name),r.nodes&&(s.nodes=r.nodes.map((e=>t[e]))),this.gltf.scene===i&&(n=o),e.push(s)}),"scenes");const i={textures:this.gltf.textures,asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(i.extensions=this.gltf.extensions),1===this.version){const t=this.adapter._loadMaterials(this.gltf.materials);i.materials=t}return delete this.gltf.buffers,i.json=this.gltf,i}))}_loadNodes(t){return this._loadMeshes(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,n)=>{const i=this.adapter.createNode(n,this.meshes,this.skins);t[e]=i}),"nodes"),t}))}_loadSkins(){this.skins=[];const t=[];return this.adapter.iterate(((e,n,i)=>{t.push(this._loadSkin(n).then((t=>{t.index=i,this.skins.push(t)})))}),"skins"),t}_loadSkin(t){return this.adapter.accessor._requestData("inverseBindMatrices",t.inverseBindMatrices).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}_loadAnimations(){const t=this.gltf.animations;return TC(t)?this.adapter.getAnimations(t):null}_loadMeshes(t){this.meshes={};let e=[];return this.adapter.iterate(((n,i,r)=>{e.push(this._loadMesh(i,t).then((t=>{t.index=r,this.meshes[n]=t})))}),"meshes"),e=e.concat(this._loadSkins()),Promise.all(e)}_loadMesh(t,e){const n=t.primitives.map((t=>this._loadPrimitive(t,e))).filter((t=>!!t));return Promise.all(n).then((e=>{const n={};return IC(n,t),n.primitives=e,n}))}_loadTextures(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter._getTexture(n));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t]&&e[t].image.array;if(n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},i=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[i[t]]=e[t]);return n}return e}))}_loadPrimitive(t,e){let n;const i=[],r=t.extensions;if(TC(t.targets))for(let o=0;o<t.targets.length;o++){const e=t.targets[o];for(const t in e){const n=this.adapter.accessor._requestData(`morphTargets_${t}_${o}`,e[t]);n&&i.push(n)}}if(r&&r.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:o,attributes:s}=r.KHR_draco_mesh_compression,a=this.gltf.bufferViews[o],h=this._accessor._requestBufferOfBufferView(a).then((n=>{const{buffer:i,byteOffset:r}=n;let{byteOffset:o}=a;o||(o=0);const h=new DataView(i,r+o,a.byteLength);return t(h,{attributes:s,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform}).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));i.push(h),n=Promise.all(i)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor._requestData(t,e[t]);n&&i.push(n)}if(TC(t.indices)){const e=this.adapter.accessor._requestData("indices",t.indices);e&&i.push(e)}n=Promise.all(i)}return n.then((e=>{if(r&&r.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,i;const o={attributes:e.reduce(((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)i=i||{},i[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:i,array:r}=e,o=r.length/i;for(let e=0;e<o;e++)for(let o=0;o<i;o++){const s=e*i+o;r[s]<t[o]&&(t[o]=r[s]),r[s]>n[o]&&(n[o]=r[s])}if(e.quantization){const i=e.quantization,r=i.range/(1<<i.quantizationBits),o=i.minValues;vC(t,t,r),yC(t,t,o),vC(n,n,r),yC(n,n,o)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return n&&(o.indices=n),i&&(o.morphTargets=i),o.mode=TC(t.mode)?t.mode:4,TC(t.extras)&&(o.extras=t.extras),o}))}}});function _P(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var xP={exports:{}},bP={exports:{}},wP=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},CP=Array.prototype.concat,PP=Array.prototype.slice,MP=bP.exports=function(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];wP(r)?e=CP.call(e,PP.call(r)):e.push(r)}return e};MP.wrap=function(t){return function(){return t(MP(arguments))}};var TP={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},SP=bP.exports,IP=Object.hasOwnProperty,EP=Object.create(null);for(var OP in TP)IP.call(TP,OP)&&(EP[TP[OP]]=OP);var RP=xP.exports={to:{},get:{}};function DP(t,e,n){return Math.min(Math.max(e,t),n)}function kP(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}RP.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=RP.get.hsl(t),n="hsl";break;case"hwb":e=RP.get.hwb(t),n="hwb";break;default:e=RP.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},RP.get.rgb=function(t){if(!t)return null;var e,n,i,r=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=e[2],e=e[1],n=0;n<3;n++){var o=2*n;r[n]=parseInt(e.slice(o,o+2),16)}i&&(r[3]=parseInt(i,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(i=(e=e[1])[3],n=0;n<3;n++)r[n]=parseInt(e[n]+e[n],16);i&&(r[3]=parseInt(i+i,16)/255)}else if(e=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)r[n]=parseInt(e[n+1],0);e[4]&&(r[3]=e[5]?.01*parseFloat(e[4]):parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(e=t.match(/^(\w+)$/))?"transparent"===e[1]?[0,0,0,0]:IP.call(TP,e[1])?((r=TP[e[1]])[3]=1,r):null:null;for(n=0;n<3;n++)r[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(r[3]=e[5]?.01*parseFloat(e[4]):parseFloat(e[4]))}for(n=0;n<3;n++)r[n]=DP(r[n],0,255);return r[3]=DP(r[3],0,1),r},RP.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,DP(parseFloat(e[2]),0,100),DP(parseFloat(e[3]),0,100),DP(isNaN(n)?1:n,0,1)]}return null},RP.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,DP(parseFloat(e[2]),0,100),DP(parseFloat(e[3]),0,100),DP(isNaN(n)?1:n,0,1)]}return null},RP.to.hex=function(){var t=SP(arguments);return"#"+kP(t[0])+kP(t[1])+kP(t[2])+(t[3]<1?kP(Math.round(255*t[3])):"")},RP.to.rgb=function(){var t=SP(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},RP.to.rgb.percent=function(){var t=SP(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),i=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+i+"%)":"rgba("+e+"%, "+n+"%, "+i+"%, "+t[3]+")"},RP.to.hsl=function(){var t=SP(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},RP.to.hwb=function(){var t=SP(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},RP.to.keyword=function(t){return EP[t.slice(0,3)]};var LP=xP.exports,FP={exports:{}},NP={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},zP={};for(var BP in NP)NP.hasOwnProperty(BP)&&(zP[NP[BP]]=BP);var HP=FP.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var jP in HP)if(HP.hasOwnProperty(jP)){if(!("channels"in HP[jP]))throw new Error("missing channels property: "+jP);if(!("labels"in HP[jP]))throw new Error("missing channel labels property: "+jP);if(HP[jP].labels.length!==HP[jP].channels)throw new Error("channel and label counts mismatch: "+jP);var UP=HP[jP].channels,GP=HP[jP].labels;delete HP[jP].channels,delete HP[jP].labels,Object.defineProperty(HP[jP],"channels",{value:UP}),Object.defineProperty(HP[jP],"labels",{value:GP})}function VP(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}HP.rgb.hsl=function(t){var e,n,i=t[0]/255,r=t[1]/255,o=t[2]/255,s=Math.min(i,r,o),a=Math.max(i,r,o),h=a-s;return a===s?e=0:i===a?e=(r-o)/h:r===a?e=2+(o-i)/h:o===a&&(e=4+(i-r)/h),(e=Math.min(60*e,360))<0&&(e+=360),n=(s+a)/2,[e,100*(a===s?0:n<=.5?h/(a+s):h/(2-a-s)),100*n]},HP.rgb.hsv=function(t){var e,n,i,r,o,s=t[0]/255,a=t[1]/255,h=t[2]/255,l=Math.max(s,a,h),u=l-Math.min(s,a,h),c=function(t){return(l-t)/6/u+.5};return 0===u?r=o=0:(o=u/l,e=c(s),n=c(a),i=c(h),s===l?r=i-n:a===l?r=1/3+e-i:h===l&&(r=2/3+n-e),r<0?r+=1:r>1&&(r-=1)),[360*r,100*o,100*l]},HP.rgb.hwb=function(t){var e=t[0],n=t[1],i=t[2];return[HP.rgb.hsl(t)[0],1/255*Math.min(e,Math.min(n,i))*100,100*(i=1-1/255*Math.max(e,Math.max(n,i)))]},HP.rgb.cmyk=function(t){var e,n=t[0]/255,i=t[1]/255,r=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-i,1-r)))/(1-e)||0),100*((1-i-e)/(1-e)||0),100*((1-r-e)/(1-e)||0),100*e]},HP.rgb.keyword=function(t){var e=zP[t];if(e)return e;var n,i=1/0;for(var r in NP)if(NP.hasOwnProperty(r)){var o=VP(t,NP[r]);o<i&&(i=o,n=r)}return n},HP.keyword.rgb=function(t){return NP[t]},HP.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,i=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*e+.7152*n+.0722*i),100*(.0193*e+.1192*n+.9505*i)]},HP.rgb.lab=function(t){var e=HP.rgb.xyz(t),n=e[0],i=e[1],r=e[2];return i/=100,r/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},HP.hsl.rgb=function(t){var e,n,i,r,o,s=t[0]/360,a=t[1]/100,h=t[2]/100;if(0===a)return[o=255*h,o,o];e=2*h-(n=h<.5?h*(1+a):h+a-h*a),r=[0,0,0];for(var l=0;l<3;l++)(i=s+1/3*-(l-1))<0&&i++,i>1&&i--,r[l]=255*(o=6*i<1?e+6*(n-e)*i:2*i<1?n:3*i<2?e+(n-e)*(2/3-i)*6:e);return r},HP.hsl.hsv=function(t){var e=t[0],n=t[1]/100,i=t[2]/100,r=n,o=Math.max(i,.01);return n*=(i*=2)<=1?i:2-i,r*=o<=1?o:2-o,[e,100*(0===i?2*r/(o+r):2*n/(i+n)),(i+n)/2*100]},HP.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,i=t[2]/100,r=Math.floor(e)%6,o=e-Math.floor(e),s=255*i*(1-n),a=255*i*(1-n*o),h=255*i*(1-n*(1-o));switch(i*=255,r){case 0:return[i,h,s];case 1:return[a,i,s];case 2:return[s,i,h];case 3:return[s,a,i];case 4:return[h,s,i];case 5:return[i,s,a]}},HP.hsv.hsl=function(t){var e,n,i,r=t[0],o=t[1]/100,s=t[2]/100,a=Math.max(s,.01);return i=(2-o)*s,n=o*a,[r,100*(n=(n/=(e=(2-o)*a)<=1?e:2-e)||0),100*(i/=2)]},HP.hwb.rgb=function(t){var e,n,i,r,o,s,a,h=t[0]/360,l=t[1]/100,u=t[2]/100,c=l+u;switch(c>1&&(l/=c,u/=c),i=6*h-(e=Math.floor(6*h)),1&e&&(i=1-i),r=l+i*((n=1-u)-l),e){default:case 6:case 0:o=n,s=r,a=l;break;case 1:o=r,s=n,a=l;break;case 2:o=l,s=n,a=r;break;case 3:o=l,s=r,a=n;break;case 4:o=r,s=l,a=n;break;case 5:o=n,s=l,a=r}return[255*o,255*s,255*a]},HP.cmyk.rgb=function(t){var e=t[1]/100,n=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-i)+i)),255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i))]},HP.xyz.rgb=function(t){var e,n,i,r=t[0]/100,o=t[1]/100,s=t[2]/100;return n=-.9689*r+1.8758*o+.0415*s,i=.0557*r+-.204*o+1.057*s,e=(e=3.2406*r+-1.5372*o+-.4986*s)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(i=Math.min(Math.max(0,i),1))]},HP.xyz.lab=function(t){var e=t[0],n=t[1],i=t[2];return n/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},HP.lab.xyz=function(t){var e,n,i;e=t[1]/500+(n=(t[0]+16)/116),i=n-t[2]/200;var r=Math.pow(n,3),o=Math.pow(e,3),s=Math.pow(i,3);return n=r>.008856?r:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,i=s>.008856?s:(i-16/116)/7.787,[e*=95.047,n*=100,i*=108.883]},HP.lab.lch=function(t){var e,n=t[0],i=t[1],r=t[2];return(e=360*Math.atan2(r,i)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(i*i+r*r),e]},HP.lch.lab=function(t){var e,n=t[1];return e=t[2]/360*2*Math.PI,[t[0],n*Math.cos(e),n*Math.sin(e)]},HP.rgb.ansi16=function(t){var e=t[0],n=t[1],i=t[2],r=1 in arguments?arguments[1]:HP.rgb.hsv(t)[2];if(0===(r=Math.round(r/50)))return 30;var o=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===r&&(o+=60),o},HP.hsv.ansi16=function(t){return HP.rgb.ansi16(HP.hsv.rgb(t),t[2])},HP.rgb.ansi256=function(t){var e=t[0],n=t[1],i=t[2];return e===n&&n===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)},HP.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},HP.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},HP.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},HP.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var i=parseInt(n,16);return[i>>16&255,i>>8&255,255&i]},HP.rgb.hcg=function(t){var e,n=t[0]/255,i=t[1]/255,r=t[2]/255,o=Math.max(Math.max(n,i),r),s=Math.min(Math.min(n,i),r),a=o-s;return e=a<=0?0:o===n?(i-r)/a%6:o===i?2+(r-n)/a:4+(n-i)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?s/(1-a):0)]},HP.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,i=1,r=0;return(i=n<.5?2*e*n:2*e*(1-n))<1&&(r=(n-.5*i)/(1-i)),[t[0],100*i,100*r]},HP.hsv.hcg=function(t){var e=t[2]/100,n=t[1]/100*e,i=0;return n<1&&(i=(e-n)/(1-n)),[t[0],100*n,100*i]},HP.hcg.rgb=function(t){var e=t[1]/100,n=t[2]/100;if(0===e)return[255*n,255*n,255*n];var i,r=[0,0,0],o=t[0]/360%1*6,s=o%1,a=1-s;switch(Math.floor(o)){case 0:r[0]=1,r[1]=s,r[2]=0;break;case 1:r[0]=a,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=s;break;case 3:r[0]=0,r[1]=a,r[2]=1;break;case 4:r[0]=s,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=a}return[255*(e*r[0]+(i=(1-e)*n)),255*(e*r[1]+i),255*(e*r[2]+i)]},HP.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),i=0;return n>0&&(i=e/n),[t[0],100*i,100*n]},HP.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,i=0;return n>0&&n<.5?i=e/(2*n):n>=.5&&n<1&&(i=e/(2*(1-n))),[t[0],100*i,100*n]},HP.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},HP.hwb.hcg=function(t){var e=1-t[2]/100,n=e-t[1]/100,i=0;return n<1&&(i=(e-n)/(1-n)),[t[0],100*n,100*i]},HP.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},HP.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},HP.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},HP.gray.hsl=HP.gray.hsv=function(t){return[0,0,t[0]]},HP.gray.hwb=function(t){return[0,100,t[0]]},HP.gray.cmyk=function(t){return[0,0,0,t[0]]},HP.gray.lab=function(t){return[t[0],0,0]},HP.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},HP.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var WP=FP.exports,qP=WP;function ZP(t){var e=function(){for(var t={},e=Object.keys(qP),n=e.length,i=0;i<n;i++)t[e[i]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var i=n.pop(),r=Object.keys(qP[i]),o=r.length,s=0;s<o;s++){var a=r[s],h=e[a];-1===h.distance&&(h.distance=e[i].distance+1,h.parent=i,n.unshift(a))}return e}function QP(t,e){return function(n){return e(t(n))}}function XP(t,e){for(var n=[e[t].parent,t],i=qP[e[t].parent][t],r=e[t].parent;e[r].parent;)n.unshift(e[r].parent),i=QP(qP[e[r].parent][r],i),r=e[r].parent;return i.conversion=n,i}var YP=WP,JP=function(t){for(var e=ZP(t),n={},i=Object.keys(e),r=i.length,o=0;o<r;o++){var s=i[o];null!==e[s].parent&&(n[s]=XP(s,e))}return n},KP={};Object.keys(YP).forEach((function(t){KP[t]={},Object.defineProperty(KP[t],"channels",{value:YP[t].channels}),Object.defineProperty(KP[t],"labels",{value:YP[t].labels});var e=JP(t);Object.keys(e).forEach((function(n){var i,r,o=e[n];KP[t][n]=(r=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var e=i(t);if("object"==typeof e)for(var n=e.length,r=0;r<n;r++)e[r]=Math.round(e[r]);return e},"conversion"in(i=o)&&(r.conversion=i.conversion),r),KP[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(o)}))}));var $P=LP,tM=KP,eM=[].slice,nM=["keyword","gray","hex"],iM={};Object.keys(tM).forEach((function(t){iM[eM.call(tM[t].labels).sort().join("")]=t}));var rM={};function oM(t,e){if(!(this instanceof oM))return new oM(t,e);if(e&&e in nM&&(e=null),e&&!(e in tM))throw new Error("Unknown model: "+e);var n,i;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof oM)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var r=$P.get(t);if(null===r)throw new Error("Unable to parse color from string: "+t);this.model=r.model,this.color=r.value.slice(0,i=tM[this.model].channels),this.valpha="number"==typeof r.value[i]?r.value[i]:1}else if(t.length){this.model=e||"rgb";var o=eM.call(t,0,i=tM[this.model].channels);this.color=hM(o,i),this.valpha="number"==typeof t[i]?t[i]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var s=Object.keys(t);"alpha"in t&&(s.splice(s.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=s.sort().join("");if(!(a in iM))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=iM[a];var h=tM[this.model].labels,l=[];for(n=0;n<h.length;n++)l.push(t[h[n]]);this.color=hM(l)}if(rM[this.model])for(i=tM[this.model].channels,n=0;n<i;n++){var u=rM[this.model][n];u&&(this.color[n]=u(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function sM(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(rM[t]||(rM[t]=[]))[e]=n})),t=t[0],function(i){var r;return arguments.length?(n&&(i=n(i)),(r=this[t]()).color[e]=i,r):(r=this[t]().color[e],n&&(r=n(r)),r)}}function aM(t){return function(e){return Math.max(0,Math.min(t,e))}}function hM(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}oM.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in $P.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return $P.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return $P.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=tM[this.model].channels,n=tM[this.model].labels,i=0;i<e;i++)t[n[i]]=this.color[i];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new oM(this.color.map(function(t){return function(e){return n=t,Number(e.toFixed(n));var n}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new oM(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:sM("rgb",0,aM(255)),green:sM("rgb",1,aM(255)),blue:sM("rgb",2,aM(255)),hue:sM(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:sM("hsl",1,aM(100)),lightness:sM("hsl",2,aM(100)),saturationv:sM("hsv",1,aM(100)),value:sM("hsv",2,aM(100)),chroma:sM("hcg",1,aM(100)),gray:sM("hcg",2,aM(100)),white:sM("hwb",1,aM(100)),wblack:sM("hwb",2,aM(100)),cyan:sM("cmyk",0,aM(100)),magenta:sM("cmyk",1,aM(100)),yellow:sM("cmyk",2,aM(100)),black:sM("cmyk",3,aM(100)),x:sM("xyz",0,aM(100)),y:sM("xyz",1,aM(100)),z:sM("xyz",2,aM(100)),l:sM("lab",0,aM(100)),a:sM("lab",1),b:sM("lab",2),keyword:function(t){return arguments.length?new oM(t):tM[this.model].keyword(this.color)},hex:function(t){return arguments.length?new oM(t):$P.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var i=t[n]/255;e[n]=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return oM.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return e.color[0]=n=(n=(n+t)%360)<0?360+n:n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var n=t.rgb(),i=this.rgb(),r=void 0===e?.5:e,o=2*r-1,s=n.alpha()-i.alpha(),a=((o*s==-1?o:(o+s)/(1+o*s))+1)/2,h=1-a;return oM.rgb(a*n.red()+h*i.red(),a*n.green()+h*i.green(),a*n.blue()+h*i.blue(),n.alpha()*r+i.alpha()*(1-r))}},Object.keys(tM).forEach((function(t){if(-1===nM.indexOf(t)){var e=tM[t].channels;oM.prototype[t]=function(){if(this.model===t)return new oM(this);if(arguments.length)return new oM(arguments,t);var n,i="number"==typeof arguments[e]?e:this.valpha;return new oM((n=tM[this.model][t].raw(this.color),Array.isArray(n)?n:[n]).concat(i),t)},oM[t]=function(n){return"number"==typeof n&&(n=hM(eM.call(arguments),e)),new oM(n,t)}}}));var lM=_P(oM);const uM="function"==typeof Object.assign,cM=[];function AM(t){if(uM)Object.assign.apply(Object,arguments);else for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function fM(t){return null==t}function dM(t){return"number"==typeof t&&!isNaN(t)}const pM=[];function gM(t,e){const n=e._get2DExtentAtRes(e.getGLRes()),i=n.getWidth(),r=n.getHeight(),o=t;Np(o);const s=dg(cM,e.cameraLookAt);return s[2]=0,jp(o,o,s),Up(o,o,pg(pM,i,r,1)),o}function mM(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function yM(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)for(let e=0,i=n.length;e<i;e++)t.push(n[e])}return t.length}const vM={};function _M(t,e){Array.isArray(e)||(e=vM[e]=vM[e]||lM(e).array());for(let n=0;n<e.length;n++)t[n]=e[n];return 3===e.length&&(t[3]=1),t}function xM(t,e){if(Array.isArray(e))for(let n=0;n<e.length;n++)t[n]=255*e[n];else{e=vM[e]=vM[e]||lM(e).array();for(let n=0;n<e.length;n++)t[n]=e[n]}return 3===t.length&&t.push(255),t}function bM(t,e,n=0){if(!(t&&e instanceof $o))return null;const i=t.coordinateToPointAtRes(e,t.getGLRes());return[i.x,i.y,n]}const wM=[0,0],CM=[0,0,0];let PM;class MM{static getUniformDeclares(){const t=[],e=[];return e.push({name:"shadow_lightProjViewModelMatrix",type:"function",fn:function(e,n){return Hp(t,n.shadow_lightProjViewMatrix,n.modelMatrix)}}),e}constructor(t,e){this.renderer=new j_(t),this._esmShadowThreshold=.3,this._layer=e,this._init()}resize(){const t=this.canvas;t.width=this._layer.getRenderer().canvas.width,t.height=this._layer.getRenderer().canvas.height}_init(){const t=(this._layer._getSceneConfig()||{}).shadow||{},e=this._getShadowRes(),n=this.getDefines();this._shadowPass=new $b(this.renderer,{width:e,height:e,blurOffset:t.blurOffset,defines:n}),this._shadowDisplayShader=new tw(n),this._createGround()}_getShadowRes(){let t=2048;const e=((this._layer._getSceneConfig()||{}).shadow||{}).quality;return"medium"===e?t=1024:"low"===e&&(t=512),t}getDefines(){return{HAS_SHADOWING:1,PACK_FLOAT:1,USE_ESM:1}}render(t,e,n,i,r,o,s,a,h,l){this._transformGround();const u=this._layer.getMap(),c=this._getShadowRes();let A,f;if(l||c!==this._shadowPass.width||this._shadowChanged(u,s,!!t)){c!==this._shadowPass.width&&this._shadowPass.resize(c,c),this._tempMat0=this._tempMat0||[],this._tempMat1=this._tempMat1||[];const i=Hp(this._tempMat0,e,n),r=Pg(this._tempMat1,o);PM||(PM=u.getContainerExtent());let a=u.height;u.getPitch()>62&&(a=u._getVisualHeight(62));const h=PM.set(0,u.height-a,u.width,u.height).convertTo((t=>u._containerPointToPointAtRes(t,u.getGLRes()))).toArray();t&&s.addMesh(this._ground);const l=h.map((t=>[t.x,t.y,0,1])),{lightProjViewMatrix:d,shadowMap:p,blurFBO:g}=this._shadowPass.render(s,{cameraProjViewMatrix:i,lightDir:r,farPlane:l,cameraLookAt:u.cameraLookAt});A=this._lightProjViewMatrix=d,f=this._shadowMap=p,this._blurFBO=g,this._renderedShadows=s.getMeshes().reduce(((t,e)=>(e.castShadow&&e.geometry&&(t[e.uuid]={v0:e.version,v1:e.geometry.version}),t)),{}),this._renderedView={count:s.getMeshes().length-+!!t,displayShadow:!!t},this._updated=!0}else A=this._lightProjViewMatrix,f=this._shadowMap,this._updated=!1;return this._projMatrix=e,this._viewMatrix=n,fM(r)&&(r=1),t&&s.getMeshes().length&&this.displayShadow(i,r,a,h),{shadow_lightProjViewMatrix:A,shadow_shadowMap:f,shadow_opacity:r,shadow_color:i||CM,esm_shadow_threshold:this._esmShadowThreshold}}displayShadow(t,e,n,i){const r=this._lightProjViewMatrix,o=this._ground,s=this._groundLightProjViewModelMatrix||[],a=this._layer.getRenderer().canvas,h=this._texSize=this._texSize||[];h[0]=a.width,h[1]=a.height,this.renderer.render(this._shadowDisplayShader,{halton:n||wM,globalTexSize:h,projMatrix:this._projMatrix,viewMatrix:this._viewMatrix,shadow_lightProjViewModelMatrix:Hp(s,r,o.localTransform),shadow_shadowMap:this._shadowMap,esm_shadow_threshold:this._esmShadowThreshold,shadow_opacity:e,color:t||CM},this._groundScene,i)}dispose(){this._shadowPass.dispose(),this._shadowDisplayShader.dispose(),this._ground&&(this._ground.geometry.dispose(),this._ground.dispose()),delete this.renderer}isUpdated(){return!1!==this._updated}_shadowChanged(t,e,n){if(!this._renderedShadows)return!0;const i=this._renderedView;if(e.getMeshes().length!==i.count||n!==i.displayShadow)return!0;const r=e.getMeshes();for(let o=0;o<r.length;o++){const t=this._renderedShadows[r[o].uuid];if(r[o].castShadow&&(r[o].hasSkinAnimation()||!t||t.v0!==r[o].version||t.v1!==r[o].geometry.version))return!0}return!1}_createGround(){const t=new ax;t.generateBuffers(this.renderer.regl),this._ground=new z_(t),this._groundScene=new Y_([this._ground])}_transformGround(){const t=this._layer.getMap(),e=gM(this._ground.localTransform,t);this._ground.setLocalTransform(e)}}const TM=[0,0],SM=new $o(0,0),IM=new $o(0,0),EM=[],OM=[],RM=[];function DM(t,e,n,i){const r=t.getGLRes(),o=t.distanceToPointAtRes(e,e,r,n?SM:null,IM);return i?o.y:o.x}const{getIBLResOnCanvas:kM,logoutIBLResOnCanvas:LM,getPBRUniforms:FM,loginIBLResOnCanvas:NM}=Xw.PBRUtils,zM=[0,0],BM=[1,1],HM=[],jM=[],UM=[],GM=[],VM=[];class WM{static getGroundTransform(t,e){return gM(t,e)}constructor(t,e){this._regl=t,this.renderer=new j_(t),this._layer=e,this._loader=new V_,this._bindOnMaterialComplete=(...t)=>this._onMaterialComplete.call(this,...t),this._init();const n=this.getMap().getRenderer().canvas;NM(n,t,this.getMap())}needToRedraw(){const t=this._getUVOffsetAnim();return t&&(t[0]||t[1])}getMap(){return this._layer&&this._layer.getMap()}getSymbol(){const t=this._layer.getGroundConfig();return t&&t.symbol}isEnable(){const t=this._layer.getGroundConfig();return t&&t.enable}paint(t){if(!this.isEnable())return!1;const e=this._getShader();if(this._isInSSRPhase(t)&&e===this._fillShader)return!1;const n=this._getGroundDefines(t);n&&this._ground.setDefines(n),this._ground.material!==this.material&&this._ground.setMaterial(this.material);const i=this._layer.getGroundConfig();this._ground.ssr=(i&&i.symbol).ssr?1:0,this._transformGround();const r=this._getUniformValues(t);r.offsetFactor=t.offsetFactor,r.offsetUnits=t.offsetUnits;const o=t&&t.renderTarget&&t.renderTarget.fbo;return e===this._fillShader?(this.renderer.render(e,r,this._groundScene,o),this._layer.getRenderer().setCanvasUpdated(),!0):(e.filter=t.sceneFilter,this.renderer.render(e,r,this._groundScene,o),this._layer.getRenderer().setCanvasUpdated(),!0)}_isInSSRPhase(t){return!!(this._layer.getRenderer().isEnableSSR&&this._layer.getRenderer().isEnableSSR()&&t&&t.ssr)}update(){const t=this._layer.getGroundConfig();if(!t)return;const e=t&&t.symbol,n=t.urlModifier;if(e){this._polygonFill=this._parseColor(e.polygonFill||[1,1,1,1]),this._polygonOpacity=void 0===e.polygonOpacity?1:e.polygonOpacity;const t=e.polygonPatternFile;if(t){if(!this._polygonPatternFile||this._polygonPatternFile._pattern_src!==t){const e=new Image;e.onload=()=>{this._polygonPatternFile&&this._polygonPatternFile.destroy(),this._polygonPatternFile=this._createPatternTexture(e),this._polygonPatternFile._pattern_src=t,this.setToRedraw()},e.src=n&&n(t)||t}}else this._polygonPatternFile&&(this._polygonPatternFile.destroy(),delete this._polygonPatternFile)}else this._polygonFill=[1,1,1,1],this._polygonOpacity=1,this._polygonPatternFile&&(this._polygonPatternFile.destroy(),delete this._polygonPatternFile);this._updateMaterial()}setToRedraw(){const t=this._layer.getRenderer();t&&t.setToRedraw()}dispose(){this.material&&(this.material.dispose(),delete this.material),this._ground&&(this._ground.geometry.dispose(),this._ground.material&&this._ground.material.dispose(),this._ground.dispose(),delete this._ground),this._polygonPatternFile&&(this._polygonPatternFile.destroy(),delete this._polygonPatternFile),this._fillShader&&(this._fillShader.dispose(),delete this._fillShader),this._standardShader&&(this._standardShader.dispose(),delete this._standardShader),this._disposeIblTextures()}_getShader(){const t=this._layer.getGroundConfig();if(!t||!t.renderPlugin)return this._fillShader;const e=t.renderPlugin.type;if("lit"===e)return this._standardShader;if("fill"===e)return this._fillShader;throw new Error("unsupported render plugin of "+e+" for layer ground")}_getUniformValues(t){const e=this._getCommonUniforms(t);return e.polygonFill=this._polygonFill,e.polygonOpacity=this._polygonOpacity,this._getShader()===this._fillShader&&this._polygonPatternFile&&(e.polygonPatternFile=this._polygonPatternFile),e}_getCommonUniforms(t){let e;if("lit"===this._layer.getGroundConfig().renderPlugin.type){const n=this.getMap().getRenderer().canvas,{iblTexes:i,dfgLUT:r}=kM(n);e=FM(this.getMap(),i,r,t&&t.ssr,t&&t.jitter)}else e={projViewMatrix:this.getMap().projViewMatrix};return this._setIncludeUniformValues(e,t),e}_setIncludeUniformValues(t,e){const n=e&&e.includes;if(n)for(const i in n)n[i]&&e[i].renderUniforms&&AM(t,e[i].renderUniforms)}_disposeIblTextures(){const t=this.getMap().getRenderer().canvas;LM(t,this.getMap())}_init(){const t=this._getExtraCommandProps(),e=MM.getUniformDeclares(),n=[];e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp(n,e.projViewMatrix,e.modelMatrix)}}),this._fillShader=new mx({vert:"attribute vec3 aPosition;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\n#ifdef HAS_PATTERN\n    attribute vec2 aTexCoord;\n    uniform vec2 uvScale;\n    uniform vec2 uvOffset;\n    varying vec2 vTexCoord;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_vert>\n#endif\nvoid main () {\n    #ifdef HAS_PATTERN\n        vTexCoord = aTexCoord * uvScale + uvOffset;\n    #endif\n    vec3 position = vec3(aPosition);\n    gl_Position = projViewModelMatrix * vec4(position, 1.0);\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        shadow_computeShadowPars(vec4(position, 1.0));\n    #endif\n}",frag:"precision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n    uniform sampler2D polygonPatternFile;\n    varying vec2 vTexCoord;\n#endif\nuniform vec4 polygonFill;\nuniform float polygonOpacity;\nvoid main() {\n    #ifdef HAS_PATTERN\n        vec4 color = texture2D(polygonPatternFile, vTexCoord);\n    #else\n        vec4 color = polygonFill;\n    #endif\n    gl_FragColor = color * polygonOpacity;\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        float shadowCoeff = shadow_computeShadow();\n        gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, shadowCoeff);\n    #endif\n}",uniforms:e,extraCommandProps:t});const i=MM.getUniformDeclares();i.push(...Rx.getUniformDeclares()),this._standardShader=new Xw.StandardShader({uniforms:i,extraCommandProps:t}),this._createGround(),this.update()}_getExtraCommandProps(){const t=[0,1],e=this._layer.getRenderer().canvas;return{viewport:{x:0,y:0,width:()=>e.width,height:()=>e.height},cull:{enable:!0},depth:{enable:!0,mask:()=>{const t=this._layer.getGroundConfig();return t.depth||void 0===t.depth},range:()=>{const e=this._layer.getGroundConfig(),n=e&&e.renderPlugin.sceneConfig;return n&&n.depthRange||t},func:"<="},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:{factor:(t,e)=>e.offsetFactor,units:(t,e)=>e.offsetUnits}}}}_hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}_createGround(){const t=new ax;t.data.aTexCoord=new Uint8Array([0,0,1,0,0,1,1,1]),t.createTangent(),t.generateBuffers(this.renderer.regl),this._ground=new z_(t,null,{castShadow:!1});const e=this._standardShader.getGeometryDefines(t);this._ground.setDefines(e),this._groundScene=new Y_([this._ground])}_transformGround(){const t=this.getMap(),e=WM.getGroundTransform(this._ground.localTransform,t);this._ground.setLocalTransform(e);const n=t.getGLRes(),i=t._get2DExtentAtRes(n),r=i.getWidth(),o=i.getHeight(),s=t.cameraLookAt,a=s[0]-r,h=s[1]-o,l=this._polygonPatternFile?this._polygonPatternFile.width/this._polygonPatternFile.height:1,u=this.getSymbol(),c=this.material?this.material.get("textureOrigin"):u.polygonPatternFileOrigin,A=!!(this.material?this.material.get("uvOffsetInMeter"):u.uvOffsetInMeter),f=(this.material?this.material.get("uvOffset"):u.uvOffset)||zM,d=this.material&&this.material.get("uvScale")||BM,p=this.material?this.material.get("textureWidth"):u.polygonPatternFileWidth,g=this.material?p*(d[1]/d[0]):u.polygonPatternFileHeight,m=this._getUVOffsetAnim(),[y,v,_,x,b]=function(t,e,n,i,r,o,s,a,h,l,u){const c=t.getGLRes();i&&(SM.set(i[0],i[1]),t.coordToPointAtRes(SM,c,IM),e-=IM.x,n-=IM.y);const A=i?SM:null;l=hy(OM,l);const f=!h&&l||TM;let d=h&&l||TM;d=hy(EM,d),d[0]&&(d[0]=DM(t,d[0],A)),d[1]&&(d[1]=DM(t,d[1],A,1));let p=.5;r&&(p=DM(t,r,A));let g=p/s;if(o&&(g=DM(t,o,A,1)),u&&(u[0]||u[1])){const e=performance.now()/1e3;let n=u[0],i=u[1];h&&(n=-DM(t,u[0],A),i=-DM(t,u[1],A,1)),u[0]&&(h?d[0]=e*n:f[0]=e*n),u[1]&&(h?d[1]=e*i:f[1]=e*i)}const m=(e+d[0])/(p/a[0]),y=(n-d[1])/(g/a[1]);return RM[0]=p/a[0],RM[1]=g/a[1],RM[2]=m,RM[3]=y,RM[4]=f,RM}(t,a,h,c,p,g,l,d,A,f,m),w=2*i.getWidth()/y,C=2*i.getHeight()/v;if(!this.material)return this._ground.setUniform("uvScale",ly(HM,w,C)),void this._ground.setUniform("uvOffset",ly(jM,_%1+b[0],x%1+b[1]));this._ground.setUniform("uvScale",ly(VM,w,C)),this._ground.setUniform("uvOffset",ly(UM,_%1+b[0],x%1+b[1])),this._ground.setUniform("uvOrigin",ly(GM,_-_%1,x-x%1)),this._ground.setUniform("uvRotation",0)}_getGroundDefines(t){let e=!1;const n=this._ground.defines,i=this._layer._getSceneConfig&&this._layer._getSceneConfig(),r=this._layer.getGroundConfig();function o(t,i){t?n[i]||(n[i]=1,e=!0):n[i]&&(delete n[i],e=!0)}o(this._hasIBL(),"HAS_IBL_LIGHTING"),o(t&&t.ssr&&r&&r.symbol&&r.symbol.ssr,"HAS_SSR");const s=t&&i&&i.shadow&&i.shadow.enable;return o(s,"HAS_SHADOWING"),o(s,"USE_ESM"),o(!!this._polygonPatternFile,"HAS_PATTERN"),e?n:null}_updateMaterial(){const t=this.getSymbol()&&this.getSymbol().material;if(!t)return;const e={};let n=!1;const i=this._layer.getGroundConfig();this._loader.setURLModifier(i.urlModifier);for(const r in t)if(mM(t,r))if(r.indexOf("Texture")>0){let i=t[r];if(!i)continue;i="string"==typeof i?{url:i,wrap:"repeat"}:i,i.flipY=!0,i.min="linear mipmap linear",i.mag="linear",i.flipY=!0,e[r]=new sx(i,this._loader),n=!0}else e[r]=t[r];this.material?(this._loadingMaterial=new Xw.StandardMaterial(e),this._loadingMaterial.isReady()?this._onMaterialComplete():this._loadingMaterial.once("complete",this._bindOnMaterialComplete)):(this.material=new Xw.StandardMaterial(e),this.material.once("complete",this._bindOnMaterialComplete,this)),n||this._onMaterialComplete()}_onMaterialComplete(){this._loadingMaterial&&(this.material.dispose(),this.material=this._loadingMaterial,delete this._loadingMaterial),this.setToRedraw(!0)}_createPatternTexture(t){return t=Lv.resizeToPowerOfTwo(t),this._regl.texture({width:t.width,height:t.height,data:t,mag:"linear",min:"linear mipmap linear",flipY:!0,wrap:"repeat"})}_parseColor(t){return _M([],t)}_getUVOffsetAnim(){return this.material&&this.material.get("uvOffsetAnim")}getRenderMeshes(){return this._groundScene.getMeshes()}}const{createIBLTextures:qM,disposeIBLTextures:ZM}=Xw.PBRUtils,QM=[0,0,0],XM=[],YM=[];class JM{constructor(t,e){this._maxLevel=4,this._regl=t,this.renderer=new j_(t),this._layer=e,this._init(),this._updateMode()}paint(t){if(!this.isEnable()||!this._resource)return;const e=this._getUniformValues(t);this.renderer.render(this._shader,e,null,t&&t.renderTarget&&t.renderTarget.fbo)}update(){const t=this.getMap();if(!t||!this.isEnable())return;const e=t.getLightManager(),n=e&&e.getAmbientResource();n!==this._resource&&this._iblTexes&&(ZM(this._iblTexes),delete this._iblTexes),this._resource=n,this._updateMode()}dispose(){this._shader.dispose(),ZM(this._iblTexes),delete this._shader,delete this._iblTexes,delete this._resource}getMap(){return this._layer.getMap()}_updateMode(){if(!this._resource)return;const t=this._layer._getSceneConfig().environment||{};this._shader.setMode(t.toneMapping,t.mode?1:0)}isEnable(){const t=this._layer._getSceneConfig();return this._hasIBL()&&t&&t.environment&&t.environment.enable}_hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}_getUniformValues(){const t=this.getMap(),e=this.getMap().getLightManager(),n=e&&e.getAmbientLight();let i=this._iblTexes;i||(i=this._iblTexes=qM(this._regl,t));const r=this._layer.getRenderer().canvas,o=this._layer._getSceneConfig().environment||{},s=o.level||0,a=i.prefilterMap.width,h=this._transform=this._transform||[],l=o.brightness||0,u=o.intensity||1;return dg(XM,n&&n.hsv||QM),l&&(XM[2]+=l),YM[0]=r.width,YM[1]=r.height,{cubeMap:i.prefilterMap,bias:s,size:a/Math.pow(2,Math.max(0,s-1)),environmentExposure:dM(n&&n.exposure)?n.exposure:1,backgroundIntensity:u,diffuseSPH:i.sh,viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,resolution:YM,hsv:XM,transformMatrix:Op(h,n&&Math.PI/180*-n.orientation||0)}}_init(){const t=this.getMap();if(t.on("updatelights",this.update,this),this._shader=new Fx,t.options.lights){const t=this.getMap().getLightManager().getAmbientResource();this._resource=t}}}const KM=[],$M=[.03,.03,.03],tT=[],eT=[],nT=[],iT=[1,1,1],rT=[-1200,-1200,0],oT=[1200,1200,1e3],sT={min:[],max:[]},aT=Yp([],Sm([],90,0,0),[0,0,0]);class hT{constructor(t,e){this._regl=t,this.renderer=new j_(t),this._layer=e,this._timer=new lT,this._init()}getMap(){return this._layer&&this._layer.getMap()}_init(){const t=this._layer.getRenderer().canvas;this._shader=new mx({vert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform vec3 cameraPosition;\nuniform float top;\nuniform float bottom;\nuniform float time;\nvarying vec2 vTexCoord;\n#include <get_output>\nfloat angle(float x, float y){\n    return atan(y, x);\n}\nvec2 getFoot(vec2 camera, vec2 normal, vec2 pos) {\n    vec2 position = vec2(0.0, 0.0);\n    float distanceLen = distance(pos, normal);\n    float a = angle(camera.x - normal.x, camera.y - normal.y);\n    pos.x > normal.x ? a -= 0.785 : a += 0.785;\n    position.x = cos(a) * distanceLen;\n    position.y = sin(a) * distanceLen;\n    return position + normal;\n    return position;\n}\nvoid main()\n{\n    vec4 localPosition = getPosition(aPosition);\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec2 foot = getFoot(vec2(cameraPosition.x, cameraPosition.z), vec2(aNormal.x, aNormal.z), vec2(localPosition.x, localPosition.z));\n    float height = top - bottom;\n    float y = aNormal.y - bottom - height * time;\n    y = y + (y < 0.0 ? height : 0.0);\n    float ratio = (1.0 - y / height) * (1.0 - y / height);\n    y = height * (1.0 - ratio);\n    y += bottom;\n    y += aPosition.y - aNormal.y;\n    localPosition = vec4( foot.x, y, foot.y , 1.0);\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D rainMap;\nvoid main() {\n    vec4 rainColor = texture2D(rainMap, vTexCoord);\n    vec4 diffuseColor = vec4(diffuse, opacity);\n    diffuseColor *= rainColor;\n    gl_FragColor = diffuseColor;\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp(KM,e.viewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height},depth:{enable:!0,mask:!1,func:"less",range:[0,1]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this._createScene()}_createScene(){const t=this._regl.texture({width:2,height:2});if(this._mesh=this._createRain(),!this._mesh)return;this._scene=new Y_(this._mesh);const e=this._getRainConfig();e.rainTexture?this._creatRainTexture(e.rainTexture).then((t=>{this._mesh.material.set("rainMap",t)})):(this._mesh.material.set("rainMap",t),console.warn("should set rain texture."))}_createRain(){const t=this.getMap(),e=this._getRainConfig();if(!e)return null;this._fixZoom=t.getZoom();const n=this._getFixExtent(),i=this._rainDensity=e.density,r=this._rainWidth=e.rainWidth||1,o=this._rainHeight=e.rainHeight||1,s=[],a=[],h=[],l=[];for(let d=0;d<i;d++){const t={};t.x=Math.random()*(n.max[0]-n.min[0])+n.min[0],t.y=Math.random()*(n.max[2]-n.min[2])+n.min[2],t.z=Math.random()*(n.max[1]-n.min[1])+n.min[1];const e=(n.max[2]-n.min[2])/37.5*o,i=e/3*r;s.push(t.x+i,t.y+e,t.z,t.x-i,t.y+e,t.z,t.x-i,t.y,t.z,t.x+i,t.y,t.z),a.push(t.x,t.y-e/2,t.z,t.x,t.y-e/2,t.z,t.x,t.y-e/2,t.z,t.x,t.y-e/2,t.z),h.push(1,1,0,1,0,0,1,0),l.push(4*d+0,4*d+1,4*d+2,4*d+0,4*d+2,4*d+3)}const u={};u.POSITION=s,u.NORMAL=a,u.TEXCOORD_0=h;const c=new Jv(u,l,0,{primitive:"triangles",positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});c.generateBuffers(this.renderer.regl);const A=new T_({rainMap:this._regl.texture({width:2,height:2}),diffuse:e.color||[1,1,1],opacity:e.opacity||1}),f=new z_(c,A);return f.setUniform("top",n.max[2]),f.setUniform("bottom",n.min[2]),this._transformRain(f),f.transparent=!0,f}_creatRainTexture(t){const e=new Image;return e.src=this._rainTexture=t,new Promise(((t,n)=>{e.onload=()=>{const n=this._regl.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"clamp",wrapT:"clamp",data:e});t(n)},e.onerror=t=>{n(t)}}))}paint(t){if(!this._scene)return;const e=this._getRainConfig(),n={},i=this.getMap();n.projMatrix=i.projMatrix,n.viewMatrix=i.viewMatrix,n.cameraPosition=i.cameraPosition;const r=e.speed||1,o=this._timer.getElapsedTime()/(2/r)%1;n.time=o,this._mesh.material.set("diffuse",e.color||iT),this._mesh.material.set("opacity",e.opacity||1),this._transformRain(this._mesh),this.renderer.render(this._shader,n,this._scene,t&&t.renderTarget&&t.renderTarget.fbo),this._layer.getRenderer().setCanvasUpdated()}_transformRain(t){const e=this.getMap(),n=e.coordinateToPointAtRes(e.getCenter(),e.getGLRes()),i=e.getGLScale()/e.getGLScale(this._fixZoom),r=pg(eT,i,i,i),o=yg(r,$M,r),s=Np(nT),a=this._getRainConfig(),h=e.getBearing();tg(s,Sm(tT,a.windDirectionX||0,a.windDirectionY||0,90-h),[n.x,n.y,0],o),Hp(s,s,aT),t.setLocalTransform(s)}setToRedraw(){const t=this._layer.getRenderer();t&&t.setToRedraw()}update(){const t=this._getRainConfig();if(t){if(this._mesh||this._createScene(),t.density!==this._rainDensity||t.rainWidth!==this._rainWidth||t.rainHeight!==this._rainHeight){const t=this._mesh.material.get("rainMap");this._mesh.geometry.dispose(),this._mesh.dispose(),this._scene.clear(),this._mesh=this._createRain(),this._mesh.material.set("rainMap",t),this._scene.setMeshes(this._mesh)}t.rainTexture!==this._rainTexture&&this._creatRainTexture(t.rainTexture).then((t=>{this._mesh.material.set("rainMap",t)}))}}dispose(){this._mesh&&(this._mesh.geometry.dispose(),this._mesh.material&&this._mesh.material.dispose(),this._mesh.dispose(),delete this._mesh),this._shader&&(this._shader.dispose(),delete this._shader)}isEnable(){const t=this._getRainConfig();return t&&t.enable}_getRainConfig(){const t=this._layer.getWeatherConfig();return t&&t.rain}_getFixExtent(){const t=16.685648411389433-this.getMap().getZoom();return _g(sT.min,rT,Math.pow(2,t)),_g(sT.max,oT,Math.pow(2,t)),sT}}class lT{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const e=("undefined"==typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return 0}}const uT=[],cT=[.03,.03,.03],AT=[],fT=[],dT=[],pT=Yp([],Sm([],90,0,0),[0,0,0]);class gT{constructor(t,e){this._regl=t,this._layer=e,this._init()}_init(){const t=this._layer.getRenderer().canvas;this._shader=new mx({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\n#include <get_output>\nvoid main()\n{\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec4 localPosition = getPosition(aPosition);\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nprecision mediump float;\nuniform sampler2D perlinTexture;\nvarying vec2 vTexCoord;\nfloat lerp(float a, float b, float w) {\n    return a + w * (b - a);\n}\nvoid main() {\n    float snowIntense = texture2D(perlinTexture, vTexCoord).r;\n    vec3 fixedC = vec3(1.0, 1.0, 1.0);\n    float r = lerp(0.5, fixedC.x, snowIntense);\n    float g = lerp(0.5, fixedC.y, snowIntense);\n    float b = lerp(0.5, fixedC.z, snowIntense);\n    glFragColor = vec4(r, g, b, 1.0);\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp(uT,e.viewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height}}}),this._shader.version=300,this._scene=new Y_,this._groundMask=this._createGroundMask(),this._scene.setMeshes(this._groundMask),this.renderer=new j_(this._regl);const e=this._getSnowConfig();e&&(e.snowGroundTexture?this._createSnowTexture(e.snowGroundTexture):(this._groundNormal=this._regl.texture({width:2,height:2}),console.warn("should set snow ground texture.")))}render(t){this._groundNormal&&this._groundMask.material.set("perlinTexture",this._groundNormal);const e=this._layer.getMap();this._transformMask(e),this.renderer.render(this._shader,{projMatrix:e.projMatrix,viewMatrix:e.viewMatrix,cameraPosition:e.cameraPosition},this._scene,t&&t.renderTarget&&t.renderTarget.fbo),this._layer.getRenderer().setCanvasUpdated()}_transformMask(t){const e=t.coordinateToPointAtRes(t.getCenter(),t.getGLRes()),n=t.getGLScale()/t.getGLScale(this._fixZoom),i=pg(fT,n,n,n),r=yg(i,cT,i),o=Np(dT);tg(o,Sm(AT,0,0,0),[e.x,e.y,.005],r),Hp(o,o,pT),this._groundMask.setLocalTransform(o)}_createSnowTexture(t){const e=new Image;e.onload=()=>{this._groundNormal=this._regl.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"repeat",wrapT:"repeat",data:e})},e.onerror=t=>{},e.src=this._snowGroundTexture=t}_createGroundMask(){const t=this._layer.getMap();this._fixZoom=t.getZoom();const e=16e3*Math.pow(2,16.685648411389433-this._fixZoom),n={};n.POSITION=[-e,0,-e,e,0,-e,-e,0,e,e,0,e],n.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],n.TEXCOORD_0=[0,0,1,0,0,1,1,1];const i=new Jv(n,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});i.generateBuffers(this._regl);const r=new T_({perlinTexture:this._regl.texture({with:2,height:2})});return new z_(i,r)}getMeshes(){return this._groundMask}dispose(){this._groundMask&&(this._groundMask.geometry.dispose(),this._groundMask.material&&this._groundMask.material.dispose(),this._groundMask.dispose(),delete this._groundMask),this._shader&&(this._shader.dispose(),delete this._shader)}update(){const t=this._getSnowConfig();t&&t.snowGroundTexture===!this._snowGroundTexture&&this._createSnowTexture(t.snowGroundTexture)}isEnable(){const t=this._getSnowConfig();return t&&t.enable}_getSnowConfig(){const t=this._layer.getWeatherConfig();return t&&t.snow}}const mT=[];class yT{constructor(t,e,n){this._regl=t,this._layer=e,this._config=n,this._init()}_init(){this.renderer=new j_(this._regl);const t=this._layer.getRenderer(),e=this._viewport={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this._width=e.width,this._height=e.height,this._fbo=this._regl.framebuffer({color:this._regl.texture({width:t.canvas?t.canvas.width:1,height:t.canvas?t.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.EMPTY_TEXTURE=this._regl.texture({with:2,height:2}),this._rainPainter=new hT(this._regl,this._layer),this._rainRipplesPass=new Jx(this._regl,e),this._snowPainter=new gT(this._regl,this._layer),this._fogPass=new Gx(this._regl,e,this._layer),this._weatherShader=new Vx,this._weatherShader.version=300}getMap(){return this._layer&&this._layer.getMap()}renderScene(t){this.renderSnowMask(t),this.renderRain(t)}renderRain(t){this.isEnableRain()&&this._rainPainter.paint(t)}renderSnowMask(t){if(!this.isEnableSnow()||!this._showSnowGround())return;const e=this.getMap();this._snowPainter.render(t,e)}paint(t,e){if(!e||!e.length)return t;this._resize();const n=this._layer.getWeatherConfig(),i={};return this.isEnableRain()?(i.ripplesMap=this._renderRainRipples(),this._weatherShader.shaderDefines.HAS_RAIN=1):delete this._weatherShader.shaderDefines.HAS_RAIN,this.isEnableSnow()?(this._weatherShader.shaderDefines.HAS_SNOW=1,i.snowIntensity=Lv.isNumber(n.snow.snowIntensity)?n.snow.snowIntensity:.5,e.forEach((t=>{t.defines.HAS_SNOW=1}))):(delete this._weatherShader.shaderDefines.HAS_SNOW,e.forEach((t=>{delete t.defines.HAS_SNOW}))),this.isEnableFog()?(i.fogColor=n.fog.color||[.9,.9,.9],this._weatherShader.shaderDefines.HAS_FOG=1):delete this._weatherShader.shaderDefines.HAS_FOG,this._weatherShader.setDefines(this._weatherShader.shaderDefines),i.mixFactorMap=this._renderMixFactor(e)||this.EMPTY_TEXTURE,i.sceneMap=t,i.time=this._getTimeSpan()/1e3,i.resolution=ly(mT,this._fbo.width,this._fbo.height),this.renderer.render(this._weatherShader,i,null,this._fbo),this._renderMeshes=e,this._fbo}_renderMixFactor(t){const e={},n=this.getMap(),i=n.getZoom(),r=Math.pow(2,16.685648411389433-i),o=this._layer.getWeatherConfig(),s=o.fog;if(!s||!s.enable)return null;const a=s.start||.1,h=s.end||100;e.projMatrix=n.projMatrix,e.viewMatrix=n.viewMatrix,e.cameraPosition=n.cameraPosition,e.fogDist=[a*r,h*r],e.rainDepth=n.altitudeToPoint(o.rain&&o.rain.rainDepth||.1,n.getGLRes());const l=this._fogPass.render(t,e);return this._layer.getRenderer()._getFBOColor(l)}_renderRainRipples(){const t=this.getMap(),e=this._layer.getWeatherConfig(),n=e.rain.rippleRadius||24,i={};return i.projMatrix=t.projMatrix,i.viewMatrix=t.viewMatrix,i.time=this._getTimeSpan()/1e3,i.rippleRadius=n,i.density=e.rain.density||2e3,this._rainRipplesPass.render(t,i)}_getTimeSpan(){if(!this._layer)return 0;if(void 0===this._currentFrameTime&&(this._currentFrameTime=0),this.isPlaying()){const t=this._layer.getRenderer();this._currentFrameTime=t.getFrameTime()}return this._currentFrameTime}isEnable(){const t=this._layer.getWeatherConfig();return t&&t.enable}isEnableRain(){const t=this._layer.getWeatherConfig();return t&&t.enable&&t.rain&&t.rain.enable}isEnableFog(){const t=this._layer.getWeatherConfig();return t&&t.enable&&t.fog&&t.fog.enable}isEnableSnow(){const t=this._layer.getWeatherConfig();return t&&t.enable&&t.snow&&t.snow.enable}_showSnowGround(){const t=this._layer.getWeatherConfig();return this.isEnableSnow()&&!1===t.snow.showGround}isPlaying(){const t=this._layer.getWeatherConfig();return!!t&&!1!==t.playing}_hasWeather(){return this.isEnableRain()||this.isEnableFog()||this.isEnableSnow()}update(){!this.isEnable()&&this._renderMeshes&&this._renderMeshes.forEach((t=>{delete t.defines.HAS_SNOW,delete t.defines.HAS_RAIN,delete t.defines.HAS_FOG})),this.isEnableRain()&&(this._rainPainter=this._rainPainter||new hT(this._regl,this._layer),this._rainPainter.update()),this.isEnableSnow()&&(this._snowPainter=this._snowPainter||new gT(this._regl,this._layer),this._snowPainter.update())}getShadowMeshes(){return this._snowPainter.getMeshes()}_resize(){const t=this._width(),e=this._height();!this._fbo||this._fbo.width===t&&this._fbo.height===e||this._fbo.resize(t,e)}dispose(){this._fbo&&this._fbo.destroy(),this._weatherShader&&(this._weatherShader.dispose(),delete this._weatherShader),this._rainPainter&&(this._rainPainter.dispose(),delete this._rainPainter),this._snowPainter&&(this._snowPainter.dispose(),delete this._snowPainter)}}const vT=[],_T=t=>!!t.bloom,xT=t=>!!t.ssr;class bT{constructor(t,e){this._regl=t,this._layer=e,this._renderer=new j_(t),this._fxaaShader=new wx,this._copyShader=new zx,this._ssrPass=new Rx(this._regl)}setContextIncludes(){}bloom(t,e,n,i,r,o,s){this._bloomPass||(this._bloomPass=new Ex(this._regl));const a=this._layer.getRenderer()._getFBOColor(this._bloomFBO);return this._bloomPass.render(t,a,i,r,o,e,n,s)}drawBloom(t){const e=this._layer.getRenderer(),n=this._regl,i=this._bloomFBO;if(i){const{width:e,height:r}=t;i.width===e&&i.height===r||i.resize(e,r),n.clear({color:[0,0,0,0],framebuffer:i})}else{const e=this._createFBOInfo(t);this._bloomFBO=n.framebuffer(e)}const r=e.getFrameTime(),o=e.getFrameEvent(),s=e.getFrameContext(),a=s.renderMode,h=s.sceneFilter,l=s.renderTarget;s.isPostProcess=!0,s.renderMode="default",s.sceneFilter=_T,s.renderTarget={fbo:this._bloomFBO,getFramebuffer:wT,getDepthTexture:CT};const u=e.glCtx;return u.resetDrawCalls(),e.forEachRenderer(o?t=>{e.clearStencil(t,i),t.drawOnInteracting(o,r,s)}:t=>{e.clearStencil(t,i),t.draw(r,s)}),delete s.isPostProcess,s.renderMode=a,s.sceneFilter=h,s.renderTarget=l,u.getDrawCalls()}genSsrMipmap(t,e){const n=this._layer.getMap().projViewMatrix;this._ssrPass.genMipMap(t,e,n)}getPrevSsrProjViewMatrix(){return this._ssrPass&&this._ssrPass.getPrevProjViewMatrix()}drawSSR(t,e,n){n&&this._ssrPass.copyDepthTex(t);const i=this._layer.getRenderer(),r=i.getFrameTime(),o=i.getFrameEvent(),s=i.getFrameContext();s.isPostProcess=!0,s.ssr=this.getSSRContext();const a=s.renderMode,h=s.sceneFilter;s.renderMode="default",s.sceneFilter=xT,s.renderTarget.fbo=e;const l=i.glCtx;let u=!1;i.forEachRenderer(o?t=>{i.clearStencil(t,e),u||(l.resetDrawCalls(),u=!0),t.drawOnInteracting(o,r,s)}:t=>{i.clearStencil(t,e),u||(l.resetDrawCalls(),u=!0),t.draw(r,s)});const c=i.drawGround();return delete s.ssr,delete s.isPostProcess,s.renderMode=a,s.sceneFilter=h,this._ssrPainted=l.getDrawCalls()>0,c}getSSRUniforms(){const t=this._layer._getSceneConfig(),e=t&&t.postProcess,n=this._layer.getMap();return this._ssrPass.getSSRUniforms(n,e.ssr.factor,e.ssr.quality)}getSSRContext(){const t=this._layer._getSceneConfig(),e=t&&t.postProcess,n=this._layer.getMap(),i=this._ssrPass.getSSRUniforms(n,e.ssr.factor,e.ssr.quality);return i?{renderUniforms:i,defines:{HAS_SSR:1}}:null}fxaa(t,e,n,i,r,o,s,a,h,l,u,c){!t||t.width===e.fbo&&t.height===e.height||t.resize(e.width,e.height);const A={};a?A.HAS_OUTLINE_TEX=1:delete A.HAS_OUTLINE_TEX,this._fxaaShader.setDefines(A),this._renderer.render(this._fxaaShader,{textureSource:e,resolution:ly(vT,e.width,e.height),enableFXAA:n,enableToneMapping:i,enableSharpen:r,pixelRatio:o,sharpFactor:s,textureOutline:a,highlightFactor:h,outlineFactor:l,outlineWidth:u,outlineColor:c},null,t)}renderFBOToScreen(t,e,n,i){this._copyFBOSize||(this._copyFBOSize=[]),this._copyFBOSize[0]=t.width,this._copyFBOSize[1]=t.height;const r=this._layer.getRenderer();this._renderer.render(this._copyShader,{texture:t.color&&r._getFBOColor(t)||t,size:this._copyFBOSize,enableSharpen:+!!e,sharpFactor:n,pixelRatio:i})}postprocess(t,e,n){this._postProcessShader||(this._postProcessShader=new Cx);const i=this._layer&&this._layer.getRenderer(),r=n||i._getFBOColor(t);return e.resolution=ly(vT,r.width,r.height),e.textureSource=r,e.timeGrain=performance.now(),this._renderer.render(this._postProcessShader,e),this._target}dispose(){this._bloomFBO&&(this._bloomFBO.destroy(),delete this._bloomFBO),this._bloomPass&&(this._bloomPass.dispose(),delete this._bloomPass),this._postProcessShader&&(this._postProcessShader.dispose(),delete this._postProcessShader),this._fxaaShader&&(this._fxaaShader.dispose(),delete this._fxaaShader),this._copyShader&&(this._copyShader.dispose(),delete this._copyShader)}_createFBOInfo(t,e){const{width:n,height:i}=this._layer.getRenderer().canvas,r=this._regl;let o;o=this._layer.getRenderer()._isUseMultiSample()?r.renderbuffer({width:n,height:i,samples:this._layer.options.multiSamples,format:"rgba8"}):r.texture({min:"nearest",mag:"nearest",format:e||"rgba",width:n,height:i});const s={width:n,height:i,colors:[o]};return t&&(s.depthStencil=t),s}}function wT(t){return t._framebuffer.framebuffer}function CT(t){return t.depthStencil._texture.texture}class PT extends bx{constructor(t){super({vert:"#if __VERSION__ == 300\n\t#define attribute in\n\t#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main()\n{\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_FLOODANALYSE\n    uniform vec3 flood_waterColor;\n    uniform float flood_waterOpacity;\n    uniform sampler2D floodMap;\n#endif\n#ifdef HAS_SKYLINE\n    uniform sampler2D skylineMap;\n#endif\n#ifdef HAS_VIEWSHED\n    uniform vec4 viewshed_visibleColor;\n    uniform vec4 viewshed_invisibleColor;\n    uniform sampler2D viewshedMap;\n#endif\n#ifdef HAS_INSIGHT\n    uniform vec4 insight_visibleColor;\n    uniform vec4 insight_invisibleColor;\n    uniform sampler2D insightMap;\n#endif\n#ifdef HAS_CUT\n    uniform sampler2D meshesMap;\n    uniform sampler2D invisibleMap;\n#endif\n#ifdef HAS_EXCAVATE\n    uniform sampler2D excavateMap;\n#endif\n#ifdef HAS_CROSSCUT\n    uniform sampler2D crosscutMap;\n    uniform vec4 cutLineColor;\n#endif\n#ifdef HAS_HEIGHTLIMIT\n    uniform vec3 limitColor;\n    uniform sampler2D heightLimitMap;\n#endif\nuniform sampler2D sceneMap;\nvoid main() {\n    vec4 sceneColor = texture2D(sceneMap, vTexCoord);\n    glFragColor = sceneColor;\n    #ifdef HAS_VIEWSHED\n        vec4 viewshedColor = texture2D(viewshedMap, vTexCoord);\n        if (viewshedColor.r > 0.99) {\n            glFragColor = vec4(mix(viewshed_invisibleColor.rgb, sceneColor.rgb, viewshed_invisibleColor.a), sceneColor.a);\n        } else if (viewshedColor.g > 0.99) {\n            glFragColor = vec4(mix(viewshed_visibleColor.rgb, sceneColor.rgb, viewshed_visibleColor.a), sceneColor.a);\n        } else if (viewshedColor.a < 0.01) {\n            glFragColor = vec4(viewshedColor.rgb, 1.0);\n        }\n    #endif\n    #ifdef HAS_FLOODANALYSE\n        vec4 floodColor = texture2D(floodMap, vTexCoord);\n        if (floodColor.r > 0.0) {\n            glFragColor = vec4(mix(glFragColor.rgb, flood_waterColor, flood_waterOpacity), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_SKYLINE\n        vec4 skylineColor = texture2D(skylineMap, vTexCoord);\n        if (skylineColor.r > 0.0 || skylineColor.g > 0.0 || skylineColor.b > 0.0) {\n            glFragColor = skylineColor;\n        }\n    #endif\n    #ifdef HAS_INSIGHT\n        vec4 insightColor = texture2D(insightMap, vTexCoord);\n        if (insightColor.g > 0.0) {\n            glFragColor = insight_visibleColor;\n        } else if (insightColor.r > 0.0) {\n            glFragColor = insight_invisibleColor;\n        }\n    #endif\n    #ifdef HAS_CUT\n        vec4 cutColor = texture2D(invisibleMap, vTexCoord);\n        vec4 meshesMapColor = texture2D(meshesMap, vTexCoord);\n        if (cutColor.r == 1.0 && cutColor.g == 0.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 1.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 0.0 && cutColor.b == 1.0) {\n          glFragColor = sceneColor;\n        }\n    #endif\n    #ifdef HAS_EXCAVATE\n        vec4 excavateColor = texture2D(excavateMap, vTexCoord);\n        if (excavateColor.r == 1.0 && excavateColor.g == 0.0 && excavateColor.b == 0.0) {\n          glFragColor = sceneColor;\n        }  else {\n          glFragColor = excavateColor;\n        }\n    #endif\n    #ifdef HAS_CROSSCUT\n        vec4 crosscutColor = texture2D(crosscutMap, vTexCoord);\n        if (crosscutColor.r > 0.0) {\n            glFragColor = vec4(mix(cutLineColor.rgb, glFragColor.rgb, 0.99), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_HEIGHTLIMIT\n        vec4 heightLimitColor = texture2D(heightLimitMap, vTexCoord);\n        if (heightLimitColor.r > 0.0) {\n            glFragColor = vec4(mix(limitColor, glFragColor.rgb, 0.6), glFragColor.a);\n        }\n    #endif\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",extraCommandProps:{viewport:t,cull:{enable:!0},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}})}}class MT{constructor(t,e,n){this._regl=t,this._layer=e,this._config=n,this._init()}_init(){this.renderer=new j_(this._regl);const t=this._layer.getRenderer(),e=this._viewport={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this._fbo=this._regl.framebuffer({color:this._regl.texture({width:t.canvas?t.canvas.width:1,height:t.canvas?t.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._shader=new PT(e)}getMap(){return this._layer&&this._layer.getMap()}paint(t,e){if(!e&&e.length)return t;this._resize();const n={},i=this._layer._analysisTaskList;if(!this._hasAnalysis())return t;this._regl.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this._fbo}),delete this._shader.shaderDefines.HAS_FLOODANALYSE,delete this._shader.shaderDefines.HAS_VIEWSHED,delete this._shader.shaderDefines.HAS_SKYLINE,delete this._shader.shaderDefines.HAS_INSIGHT,delete this._shader.shaderDefines.HAS_CUT,delete this._shader.shaderDefines.HAS_CROSSCUT,delete this._shader.shaderDefines.HAS_HEIGHTLIMIT;for(let r=0;r<i.length;r++){const t=i[r];if(!t.isEnable())continue;const o=t.getDefines();AM(this._shader.shaderDefines,o);const s=this.getMap(),a=s.width,h=s.height,l=this._getToAnalysisMeshes(e,t.getExcludeLayers()),u=t.renderAnalysis(l,a,h);u&&AM(n,u)}return n.sceneMap=t,this._shader.setDefines(this._shader.shaderDefines),this.renderer.render(this._shader,n,null,this._fbo),this._fbo}_getToAnalysisMeshes(t,e){let n=[];for(let i=0;i<t.length;i++){if(e.indexOf(t[i].getId())>-1)continue;const r=t[i].getRenderer();if(r&&r.getAnalysisMeshes){const t=r.getAnalysisMeshes();t.forEach((t=>{t.setUniform("useAnalysis",1)})),n=n.concat(t)}}return n}_resize(){const t=gi.isFunction(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,e=gi.isFunction(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===t&&this._fbo.height===e||this._fbo.resize(t,e)}_hasAnalysis(){const t=this._layer&&this._layer._analysisTaskList;if(!t)return!1;for(let e=0;e<t.length;e++)if(t[e].isEnable())return!0;return!1}}const TT=[0,0,0,0],ST=[1,1,-1],IT=[0,0],ET=t=>!t.bloom&&!t.ssr,OT=t=>!t.bloom,RT=t=>!t.ssr;function DT(t){return"number"==typeof t&&!isNaN(t)}function kT(t){return t._framebuffer.framebuffer}function LT(t){return t.depthStencil._texture.texture}function FT(t,e,n){return null==t[e]?n:t[e]}class NT extends $f.Actor{constructor(t){super("@maptalks/terrain"),this.mapId=t}checkUrl(t){return t&&gi.isString(t)?gi.getAbsoluteURL(t):t}fetchTerrain(t,e,n){t=this.checkUrl(t);const i={actorId:this.actorId,mapId:this.mapId,command:"fetchTerrain",params:{url:t,origin:location.origin,terrainWidth:e.terrainWidth,type:e.type,accessToken:e.accessToken,cesiumIonTokenURL:e.cesiumIonTokenURL,error:e.error,colors:e.colors,tileSize:e.tileSize}};this.send(i,null,((t,e)=>{t?n(t):n(t,e)}))}abortTerrain(t,e){this.broadcast({actorId:this.actorId,mapId:this.mapId,command:"abortTerrain",params:{url:t}},null,e)}addLayer(t,e,n){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{}},null,n)}createTerrainMesh(t,e){this.send({actorId:this.actorId,command:"createTerrainMesh",params:t},[t.terrainHeights.data.buffer],((t,n)=>{t?e(t):e(t,n)}))}removeLayer(t,e,n){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,n)}}class zT{constructor(t=257){this.gridSize=t;const e=t-1;if(e&e-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=e*e*2-2,this.numParentTriangles=this.numTriangles-e*e,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let n=0;n<this.numTriangles;n++){let t=n+2,i=0,r=0,o=0,s=0,a=0,h=0;for(1&t?o=s=a=e:i=r=h=e;(t>>=1)>1;){const e=i+o>>1,n=r+s>>1;1&t?(o=i,s=r,i=a,r=h):(i=o,r=s,o=a,s=h),a=e,h=n}const l=4*n;this.coords[l+0]=i,this.coords[l+1]=r,this.coords[l+2]=o,this.coords[l+3]=s}}createTile(t){return new BT(t,this)}}class BT{constructor(t,e){const n=e.gridSize;if(t.length!==n*n)throw new Error(`Expected terrain data of length ${n*n} (${n} x ${n}), got ${t.length}.`);this.terrain=t,this.martini=e,this.errors=new Float32Array(t.length),this.update()}update(){const{numTriangles:t,numParentTriangles:e,coords:n,gridSize:i}=this.martini,{terrain:r,errors:o}=this;for(let s=t-1;s>=0;s--){const t=4*s,a=n[t+0],h=n[t+1],l=n[t+2],u=n[t+3],c=a+l>>1,A=h+u>>1,f=c+A-h,d=A+a-c,p=A*i+c,g=Math.abs((r[h*i+a]+r[u*i+l])/2-r[p]);o[p]=Math.max(o[p],g),s<e&&(o[p]=Math.max(o[p],o[(h+d>>1)*i+(a+f>>1)],o[(u+d>>1)*i+(l+f>>1)]))}}getMesh(t=0){const{gridSize:e,indices:n}=this.martini,{errors:i}=this;let r=0,o=0;const s=e-1;function a(s,h,l,u,c,A){const f=s+l>>1,d=h+u>>1;Math.abs(s-c)+Math.abs(h-A)>1&&i[d*e+f]>t?(a(c,A,s,h,f,d),a(l,u,c,A,f,d)):(n[h*e+s]=n[h*e+s]||++r,n[u*e+l]=n[u*e+l]||++r,n[A*e+c]=n[A*e+c]||++r,o++)}n.fill(0),a(0,0,s,s,s,0),a(s,s,0,0,0,s);const h=new Uint16Array(2*r),l=new Uint32Array(3*o);let u=0;function c(r,o,s,a,A,f){const d=r+s>>1,p=o+a>>1;if(Math.abs(r-A)+Math.abs(o-f)>1&&i[p*e+d]>t)c(A,f,r,o,d,p),c(s,a,A,f,d,p);else{const t=n[o*e+r]-1,i=n[a*e+s]-1,c=n[f*e+A]-1;h[2*t]=r,h[2*t+1]=o,h[2*i]=s,h[2*i+1]=a,h[2*c]=A,h[2*c+1]=f,l[u++]=t,l[u++]=i,l[u++]=c}}return c(0,0,s,s,s,0),c(s,s,0,0,0,s),{vertices:h,triangles:l}}getMeshWithSkirts(t=0,e){const{gridSize:n,indices:i}=this.martini,{errors:r}=this;let o=0,s=0;const a=n-1;let h,l,u=0;const c=[],A=[],f=[],d=[];function p(e,g,m,y,v,_){const x=e+m>>1,b=g+y>>1;Math.abs(e-v)+Math.abs(g-_)>1&&r[b*n+x]>t?(p(v,_,e,g,x,b),p(m,y,v,_,x,b)):(h=g*n+e,l=y*n+m,u=_*n+v,0===i[h]&&(0===e?c.push(o):e===a&&A.push(o),0===g?f.push(o):g===a&&d.push(o),i[h]=++o),0===i[l]&&(0===m?c.push(o):m===a&&A.push(o),0===y?f.push(o):y===a&&d.push(o),i[l]=++o),0===i[u]&&(0===v?c.push(o):v===a&&A.push(o),0===_?f.push(o):_===a&&d.push(o),i[u]=++o),s++)}let g;i.fill(0),p(0,0,a,a,a,0),p(a,a,0,0,0,a),g=e?2*(o+3*c.length-2+3*A.length-2+3*f.length-2+3*d.length-2):2*(o+c.length+A.length+f.length+d.length);const m=3*(s+2*(c.length-1)+2*(A.length-1)+2*(f.length-1)+2*(d.length-1)),y=new Uint16Array(g),v=new Uint32Array(m);let _=0;function x(e,o,s,a,h,l){const u=e+s>>1,c=o+a>>1;if(Math.abs(e-h)+Math.abs(o-l)>1&&r[c*n+u]>t)x(h,l,e,o,u,c),x(s,a,h,l,u,c);else{const t=i[o*n+e]-1,r=i[a*n+s]-1,u=i[l*n+h]-1;y[2*t]=e,y[2*t+1]=o,y[2*r]=s,y[2*r+1]=a,y[2*u]=h,y[2*u+1]=l,v[_++]=t,v[_++]=r,v[_++]=u}}x(0,0,a,a,a,0),x(a,a,0,0,0,a),c.sort(((t,e)=>y[2*t+1]-y[2*e+1])),A.sort(((t,e)=>y[2*e+1]-y[2*t+1])),f.sort(((t,e)=>y[2*e]-y[2*t])),d.sort(((t,e)=>y[2*t]-y[2*e]));let b,w,C,P,M=2*o,T=0;function S(t){T=t.length;for(let n=0;n<T-1;n++)b=t[n],w=t[n+1],C=M/2,P=(M+(e?6:2))/2,y[M++]=2*b,y[M++]=2*b+1,e&&(y[M++]=2*b,y[M++]=2*b+1,y[M++]=2*w,y[M++]=2*w+1),e?(v[_++]=C+1,v[_++]=C,v[_++]=C+2,v[_++]=C,v[_++]=P,v[_++]=C+2):(v[_++]=b,v[_++]=C,v[_++]=w,v[_++]=C,v[_++]=P,v[_++]=w);y[M++]=2*t[T-1],y[M++]=2*t[T-1]+1}S(c);const I=M;S(A);const E=M;S(f);const O=M;return S(d),{vertices:y,triangles:v,numVerticesWithoutSkirts:o,numTrianglesWithoutSkirts:s,leftSkirtIndex:I,rightSkirtIndex:E,bottomSkirtIndex:O,topSkirtIndex:M}}}const HT={};function jT(t,e,n,i){let r=HT[n];r||(r=HT[n]=new zT(n));const o=r.createTile(e).getMeshWithSkirts(t,!0),{triangles:s,vertices:a,leftSkirtIndex:h,rightSkirtIndex:l,bottomSkirtIndex:u,topSkirtIndex:c}=o;let{numVerticesWithoutSkirts:A,numTrianglesWithoutSkirts:f}=o;A||(A=a.legnth/3,f=s.length/3);const d=a.length/2,p=new Float32Array(3*d),g=new Float32Array(2*d);let m=1/0,y=-1/0;const v=n-1;for(let _=0;_<d;_++){const t=a[2*_],i=a[2*_+1];if(_>=A){const e=t/2*3;let n,i=.001;(_-(_<h/2?A:_<l/2?h/2:_<u/2?l/2:u/2))%3==0?(n=0,i=0):n=p[e+2],p[3*_]=p[e],p[3*_+1]=p[e+1],p[3*_+2]=n,g[2*_]=p[e]/v+i,g[2*_+1]=-p[e+1]/v+i}else p[3*_]=1*t,p[3*_+1]=1*-i,p[3*_+2]=e[i*n+t],g[2*_]=t/v,g[2*_+1]=i/v;const r=p[p.length-1];r<m&&(m=r),r>y&&(y=r)}return{positions:p,texcoords:g,triangles:s,leftSkirtIndex:h,rightSkirtIndex:l,bottomSkirtIndex:u,topSkirtIndex:c,numTrianglesWithoutSkirts:f,numVerticesWithoutSkirts:A,minHeight:m,maxHeight:y,terrainWidth:n}}function UT(t,e,n,i,r,o,s,a,h){const l={};for(let u=0;u<h;u++)l[u+""]=VT(t,e,n,i,r,o,s,a,u);return l}const GT=[];function VT(t,e,n,i,r,o,s,a,h){if((i-=h)<=0)return GT;const l=t.getTileSize().width,u=t._getTileOffset(i,r),c=o[0]-u[0],A=u[1]-o[1],f=t._getTileConfig(),d=t.getSpatialReference().getResolution(i),p=f.tileSystem.scale.y,g=1e-7;let m=0,y=0,v=a/=Math.pow(2,h),_=a;if(c<0?v+=Math.ceil(-c/l-g):c>0&&(m-=Math.ceil(c/l-g)),A>0?y-=Math.ceil(A/l-g):A<0&&(_+=Math.ceil(-A/l-g)),0===m&&0===y&&v<=1&&_<=1){const r=Math.floor(e*a);let o=Math.floor(n*a);const h=o;return p!==s&&(o=ZT(f,o,d)),[{x:r,y:o,skinY:h,z:i,offset:u,tileSize:l,id:t._getTileId(r,o,i)}]}const x=[];for(let b=m;b<v;b++)for(let r=y;r<_;r++){const o=e*a+b;let h=n*a+r;const c=h;p!==s&&(h=ZT(f,h,d)),x.push({x:o,y:h,skinY:c,z:i,offset:u,tileSize:l,id:t._getTileId(o,h,i)})}return x}function WT(t,e,n,i){let r=t/n*i/e;return r<1?(r=1/r,r=1/Math.round(r)):r=Math.round(r),r}function qT(t,e,n){const i=t.getResolution(e),r=e-Math.log(n/i)*Math.LOG2E;return{zoom:r,res:t.getResolution(r)}}function ZT(t,e,n){const i=t.fullExtent,r=t.tileSize.width,o=Math.max(i.top,i.bottom),s=Math.min(i.top,i.bottom);return Math.ceil(o/r/n)-1-Math.floor(s/r/n)-e}function QT(t,e){const n=e*e,i=0!==t?new Float32Array(n):new Uint8Array(n);return i.fill(t),{data:i,width:e,height:e,max:t,min:t}}new ht(0,0);const XT=QT(0,5),YT=jT(1,XT.data,XT.width);function JT(t,e,n){const i=n&&n.includes;if(i)for(const r in i)i[r]&&(n[r].uniformDeclares&&e.push(...n[r].uniformDeclares),n[r].defines&&AM(t,n[r].defines))}function KT(t,e){const n=e&&e.includes;if(n)for(const i in n)n[i]&&e[i].renderUniforms&&AM(t,e[i].renderUniforms)}YT.empty=!0;var $T=Object.freeze({__proto__:null,fillIncludes:JT,setIncludeUniformValues:KT});const tS=[],eS=[];class nS{constructor(t){this.layer=t,this.regl=t.getRenderer().regl,this.renderer=new j_(this.regl),this._leafScene=new Y_;const e=new Uint8Array(16);e.fill(255),this._emptyTileTexture=this.regl.texture({width:2,height:2,data:e}),this._resLoader=new V_(this._emptyTileTexture),this._createEmptyTerrainGeo()}setToRedraw(){this.layer.getRenderer().setToRedraw()}getMap(){return this.layer.getMap()}startFrame(t){t&&t.states&&t.states.includesChanged&&(this.shader.dispose(),delete this.shader),this.shader||this.initShader(t),this._leafScene.clear()}createTerrainMesh(t,e){const{mesh:n,image:i}=e;let r=e.terrainMesh;const{positions:o,texcoords:s,triangles:a,empty:h}=n;if(r&&r.geometry!==this._emptyTerrainGeometry)r.geometry.updateData("aPosition",o),r.geometry.updateData("aTexCoord",s),r.geometry.setElements(a);else{const t=h?this._emptyTerrainGeometry:new Jv({aPosition:o,aTexCoord:s},a,0);r?r.geometry=t:(r=new z_(t,null,{disableVAO:!0}),t.generateBuffers(this.regl))}if(!r.uniforms.skin){const t=this.getEmptyTexture();r.setUniform("skin",t)}return r.setUniform("heightTexture",i),this.prepareMesh(r,t,e),r}_updateMaskDefines(t){const e=this.layer.getRenderer();e&&e.updateMaskDefines(t)}_getPositionMatrix(t){const e=this._getPointZ(100)/100,n=Np(t);return Up(n,n,[1,1,e]),n}_getLocalTransform(t,e,n){const i=this.getMap(),r=this.layer.getTileSize().width,o=e.res/i.getGLRes(),s=r/(n-1),{extent2d:a,offset:h}=e;pg(tS,(a.xmin-h[0])*o,(e.extent2d.ymax-h[1])*o,0);const l=Np(t);return jp(l,l,tS),pg(eS,o*s,o*s,1),Up(l,l,eS),l}prepareMesh(t,e,n){if(!t.isValid())return;const{mesh:i}=n;this._updateMaskDefines(t);const{triangles:r,numTrianglesWithoutSkirts:o,terrainWidth:s}=i;t.localTransform=this._getLocalTransform(t.localTransform||[],e,s),t.positionMatrix=this._getPositionMatrix(t.positionMatrix||[]),t.properties.skirtOffset=3*o,t.properties.skirtCount=r.length-3*o,t.properties.z=e.z,t.properties.minHeight=i.minHeight,t.properties.maxHeight=i.maxHeight,t.properties.terrainWidth=s,t.castShadow=!1,mM(t.uniforms,"minAltitude")||Object.defineProperty(t.uniforms,"minAltitude",{enumerable:!0,get:()=>n.minAltitude||0})}addTerrainImage(t,e){const n=e.terrainMesh;n&&n.geometry&&e.skin&&(n.setUniform("skin",e.skin.color[0]),n.setUniform("polygonOpacity",1),this._leafScene.addMesh(n))}endFrame(t){this.updateIBLDefines(this.shader);let e=0;const n=this.getUniformValues(),i=this._getRenderFBO(t);return this.shader.filter=t&&t.sceneFilter,KT(n,t),e+=this.renderer.render(this.shader,n,this._leafScene,i),e}delete(){this.shader&&(this.shader.dispose(),delete this.shader),this._emptyTileTexture&&(this._emptyTileTexture.destroy(),delete this._emptyTileTexture),this._emptyTerrainGeometry&&(this._emptyTerrainGeometry.dispose(),delete this._emptyTerrainGeometry)}deleteMesh(t){if(!t)return;const e=t.geometry;t.dispose(),e!==this._emptyTerrainGeometry&&e.dispose()}initShader(t){const e=[],n=[],i={},r=[];JT(i,r,t),this.shader=new mx({vert:"#define SHADER_NAME TERRAIN_MESH\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform float minAltitude;\nuniform mat4 projViewModelMatrix;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform float heightScale;\nvarying vec2 vUv;\n#include <mask_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_vert>\n#endif\nvoid main() {\n    vec4 position = vec4(aPosition.xy, (aPosition.z + minAltitude) * heightScale, 1.0);\n    position = positionMatrix * position;\n    #ifdef HAS_MASK_EXTENT\n        gl_Position = projMatrix * getMaskPosition(position, modelMatrix);\n    #else\n        gl_Position = projViewModelMatrix * position;\n    #endif\n    vUv = aTexCoord;\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        shadow_computeShadowPars(position);\n    #endif\n}",frag:"#define SHADER_NAME TERRAIN_MESH\nprecision mediump float;\nuniform sampler2D skin;\nuniform float polygonOpacity;\nvarying vec2 vUv;\n#include <mask_frag>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_frag>\n#endif\nvoid main() {\n    vec2 uv = vec2(vUv);\n    uv.y = 1.0 - uv.y;\n    vec4 color = texture2D(skin, uv);\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        float shadowCoeff = shadow_computeShadow();\n        color.rgb = shadow_blend(color.rgb, shadowCoeff).rgb;\n    #endif\n    gl_FragColor = color * polygonOpacity;\n    #ifdef HAS_MASK_EXTENT\n      gl_FragColor = setMask(gl_FragColor);\n    #endif\n}",uniforms:r.concat([{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp(n,e.viewMatrix,e.modelMatrix)}},{name:"projViewModelMatrix",type:"function",fn:function(t,n){return Hp(e,n.projViewMatrix,n.modelMatrix)}}]),defines:i,extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.layer.getRenderer().canvas;return{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!1},cull:{enable:!0,face:"back"},depth:{enable:!0,mask:()=>!!this.layer.options.depthMask,func:this.layer.options.depthFunc||"<="},blend:{enable:!0,func:{src:this.layer.options.blendSrc,dst:this.layer.options.blendDst},equation:"add"}}}_getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}getUniformValues(){const t=this.getMap(),e=t.projViewMatrix,n=this.layer.getRenderer().getMaskUniforms(),i={viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,projViewMatrix:e,heightScale:1};return AM(i,n),i}_getPointZ(t){const e=this.layer.getMap();return e?e.altitudeToPoint(t,e.getGLRes()):null}getEmptyTexture(){return this._emptyTileTexture}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}updateIBLDefines(t){const e=t.shaderDefines;let n=!1;this.hasIBL()?e[["HAS_IBL_LIGHTING"]]||(e.HAS_IBL_LIGHTING=1,n=!0):e[["HAS_IBL_LIGHTING"]]&&(delete e.HAS_IBL_LIGHTING,n=!0),n&&(t.shaderDefines=e)}_createEmptyTerrainGeo(){const t=YT,{positions:e,texcoords:n,triangles:i}=t;this._emptyTerrainGeometry=new Jv({aPosition:e,aTexCoord:n},i,0),this._emptyTerrainGeometry.generateBuffers(this.regl)}}const{getIBLResOnCanvas:iS,getPBRUniforms:rS,loginIBLResOnCanvas:oS,logoutIBLResOnCanvas:sS}=Xw.PBRUtils,aS={baseColorFactor:[1,1,1,1],emissiveFactor:[0,0,0],baseColorIntensity:1,emitColorFactor:1,roughnessFactor:1,metallicFactor:0,emitMultiplicative:1,outputSRGB:1,hsv:[0,0,0],contrast:1,alphaTest:0};class hS extends nS{constructor(...t){super(...t),this.createIBLTextures(),this._matVer=0}updateMaterial(t,e){this._matVer=e,this._material=this._material||{},AM(this._material,t),this.setToRedraw()}setMaterial(t,e){this._matVer=e,this._material=AM({},aS,t),this.setToRedraw()}createIBLTextures(){const t=this.getMap().getRenderer().canvas;oS(t,this.regl,this.getMap()),this.layer.fire("iblupdated")}disposeIBLTextures(){const t=this.getMap().getRenderer().canvas;sS(t,this.getMap())}createTerrainMesh(t,e){const{mesh:n,image:i}=e,{positions:r,texcoords:o,triangles:s,leftSkirtIndex:a,rightSkirtIndex:h,bottomSkirtIndex:l,numVerticesWithoutSkirts:u}=n,c=new Int8Array(r.length);for(let v=2;v<c.length;v+=3)v<3*u?c[v]=1:v<a/2*3?c[v-2]=-1:v<h/2*3?c[v-2]=1:c[v-1]=v<l/2*3?-1:1;const A=new Jv({aPosition:r,aTexCoord:o,aNormal:c},s,0);let f;A.createTangent(),delete A.data.aNormal,A.generateBuffers(this.regl),f=i?this.regl.texture({width:i.width,height:i.height,data:i,min:"linear",mag:"linear"}):this.getEmptyTexture();const d=this.getEmptyTexture(),p=AM({},aS,this.layer.options.material||{});p.skinTexture=d,p.terrainHeightTexture=f;const g=new Xw.StandardMaterial(p),m=new z_(A,g);m.properties.matVer=this._matVer;const y=m.defines;return y.HAS_UV_FLIP=1,y.HAS_TERRAIN_NORMAL=1,y.HAS_MAP=1,m.defines=y,m.setUniform("terrainTileResolution",t.res),this.prepareMesh(m,t,e),m}addTerrainImage(t,e){const n=e.terrainMesh;if(n){if(this._material&&n.properties.matVer!==this._matVer){for(const t in this._material)n.material.set(t,this._material[t]);n.properties.matVer=this._matVer}e.skin&&n.material.set("skinTexture",e.skin),n.setUniform("polygonOpacity",1),this._leafScene.addMesh(n)}}getUniformValues(){const t=this.getMap(),e=t.getRenderer().canvas,{iblTexes:n,dfgLUT:i}=iS(e),r=rS(t,n,i),o=this.layer.getTileSize().width,s=this.layer.getRenderer().getMaskUniforms(),a=this._getPointZ(100)/100;return AM(r,{viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,outSize:[e.width,e.height],polygonFill:[1,1,1,1],terrainHeightMapResolution:[o,o],terrainResolution:[e.width,e.height],terrainHeightScale:a,terrainUnpackFactors:[6553.6,25.6,.1,1e4]}),AM(r,s),r}initShader(t){const e={},n=[];JT(e,n,t),this.shader=new Xw.StandardShader({uniforms:n,defines:e,extraCommandProps:this.getExtraCommandProps()})}delete(){return this.disposeIBLTextures(),super.delete()}}function lS(t,e,n,i){const r=uS.call(this,n,i);this._projViewMatrix=e;const{colorExtent:o,modeExtent:s}=this._extentPass.render(r,e);this._maskUniforms=this._maskUniforms||{},this._maskUniforms.mask_colorExtent=o,this._maskUniforms.mask_extent=t,this._maskUniforms.mask_modeExtent=s,this._maskUniforms.mask_hasFlatOut=AS.call(this,"flat-outside"),this._maskUniforms.mask_hasClipOut=AS.call(this,"clip-outside"),this._maskUniforms.mask_hasVideo=AS.call(this,"video"),this._maskUniforms.mask_heightRatio=n,this._maskUniforms.mask_heightOffset=i,this.setToRedraw()}function uS(t,e){const n=[],i=this.layer.getMasks();for(let r=0;r<i.length;r++){const o=i[r].getMesh(this.regl,t,e);o&&n.push(o)}return n}function cS(){if(!this._extentPass||!this._maskUniforms)return;const t=uS.call(this,this._maskUniforms.mask_heightRatio,this._maskUniforms.mask_heightOffset);this._extentPass.render(t,this._projViewMatrix);const e=this.layer.getMasks();for(let n=0;n<e.length;n++)"video"===e[n].getMode()&&e[n]._update()}function AS(t){const e=this.layer.getMasks();for(let n=0;n<e.length;n++)if(e[n].getMode()===t)return 1;return 0}function fS(){const t=this.layer.getMasks();if(!t)return!1;for(let e=0;e<t.length;e++)if("video"===t[e].getMode()&&t[e]._needUpdate())return!0;return!1}function dS(t){return class extends t{setMask(t,e,n,i){this.viewport||(this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1}),this._extentPass?lS.call(this,t,e,n,i):this.regl?(this._extentPass=new tb(this.regl,this.viewport),lS.call(this,t,e,n,i)):this.layer.once("contextcreate",(()=>{this._extentPass=new tb(this.regl,this.viewport),lS.call(this,t,e,n,i)}),this)}needToRedraw(){return!!super.needToRedraw()||!!fS.call(this)}getMaskUniforms(){return fS.call(this)&&cS.call(this),this.layer.updateMaskExtent(),this._maskUniforms}getMaskDefines(){return this._maskDefines||(this._maskDefines={}),this._maskUniforms&&this._maskUniforms.mask_colorExtent?this._maskDefines.HAS_MASK_EXTENT=1:delete this._maskDefines.HAS_MASK_EXTENT,this._maskDefines}updateMaskDefines(t){const e=t.getDefines();delete e.HAS_MASK_EXTENT,AM(e,this.getMaskDefines()),t.setDefines(e)}_clearMask(){this._deleteMaskUniforms(),this._extentPass&&(this._extentPass.dispose(),delete this._extentPass),this.setToRedraw()}_deleteMaskUniforms(){delete this._maskUniforms}}}class pS{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){if(this.data){const t=this.data.values();for(const e of t)this.onRemove(e)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e)):this.data.set(t,e),this):this}keys(){const t=new Array(this.data.size);let e=0;const n=this.data.keys();for(const i of n)t[e++]=i;return t}has(t){return this.data.has(t)}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),e}get(t){return this.has(t)?this.data.get(t):null}pop(){if(this.data.size<this.max)return null;const t=this.data.keys().next();return this.data.get(t.value).current?(this.max+=Math.ceil(this.max/2),null):this.getAndRemove(t.value)}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this}resetCurrent(t){this.data&&this.data.forEach((e=>{e.current=t}))}}const gS=new ht(0,0),mS=new ht(0,0),yS=new ps(0,0,0,0),vS=new ht(0,0),_S=new ht(20,20),xS={color:[0,0,0,0],depth:1,stencil:0};class bS extends(dS(Uf.TileLayerCanvasRenderer)){isDrawable(){return!0}getTempTileOnLoading(t,e){if(e.image&&!e.image.reset)return e;const n=this._createTerrainFromParent(t);return n.temp=!0,e.image||(e.image=n),delete e.image.reset,e.current=!0,e.info=t,AM(e.image,n),this._createMesh(e.image,t),e}_resetTerrainImage(t,e,n){e.reset=!0,delete e.data,delete e.loadTime,delete e.rendered,delete e.minAltitude;const i=t.id+"-temp",r=e.skinImages;if(r)for(let o=0;o<r.length;o++){const t=r[o];if(t){for(let e=0;e<t.length;e++){const r=t[e];r&&(r.refs.delete(i),r.refs.size||n.push(r))}delete t.currentSkins,delete t.tileIds}}delete e.sourceZoom,delete e.skinImages,delete e.skinStatus,delete e.skinTileIds,e.debugTexture&&(e.debugTexture.destroy(),delete e.debugTexture)}_createTerrainFromParent(t,e){for(e=e||this.findParentTile(t);e&&e.image&&(-1===e.image.sourceZoom||e.image.originalError);)e=this.findParentTile(e.info);const n=(e&&e.info||t).res,i=this.getMap().pointAtResToDistance(1,1,n),r=e&&e.image&&e.image.data&&this._clipParentTerrain(e,t),o=r&&-1!==e.image.sourceZoom?e.info.z:-1;if(!r||r.width<=1){const n=this._findTileMinAltitude(t,e);return{data:QT(n||0,5),minAltitude:n,mesh:YT,sourceZoom:o}}return{data:r,mesh:jT(i,r.data,r.width),sourceZoom:o}}_findTileMinAltitude(t,e){if(e&&e.minAltitude)return e.minAltitude;const{idx:n,idy:i,z:r}=t;for(let o=-1;o<=1;o++)for(let t=-1;t<=1;t++){if(0===o&&0===t)continue;const e=this.layer.getTileId(n+o,i+t,r),s=this.layer.tileInfoCache.get(e);if(s&&s.minAltitude)return s.minAltitude}return 0}consumeTile(t,e){if(t.empty&&!t.mesh){const n=this.findParentTile(e);if(!n||n.image&&n.image.empty){t.mesh=YT;const n=this._findTileMinAltitude(e);t.data=QT(n||0,5),t.minAltitude=n,t.sourceZoom=-1}else t=this._createTerrainFromParent(e,n)}this._createMesh(t,e),super.consumeTile(t,e),this._recenterMapOnTerrain(e)}_createMesh(t,e){if(t&&t.mesh){t.terrainMesh=this._painter.createTerrainMesh(e,t),e.minAltitude=t.data.min,e.maxAltitude=t.data.max,delete t.mesh;const n=this.layer.tileInfoCache;if(n&&e.parent&&!t.empty&&!t.temp){const t=n.get(e.parent);if(t){const{minAltitude:n,maxAltitude:i}=e;(void 0===t.minAltitude||t.minAltitude>n)&&(t.minAltitude=n),(void 0===t.maxAltitude||t.maxAltitude<i)&&(t.maxAltitude=i)}}}}_recenterMapOnTerrain(t){const e=this.getMap();if(e.updateCenterAltitude&&void 0===e.centerAltitude&&t.z===this.getCurrentTileZoom()){const n=e._getPrjCenter(),i=e._prjToPointAtRes(n,t.res,vS);t.extent2d.contains(i)&&e.updateCenterAltitude()}}draw(t,e){this._createPainter(),this._painter.startFrame(e),super.draw(t,e),this._endFrame(e)}drawTile(t,e){const n=this.getMap();if(!t||!n||!e)return;if(!this.drawingCurrentTiles&&!this.drawingChildTiles)return;let i=this.drawingCurrentTiles?this.getTileOpacity(e):1;i*=this.layer.options.opacity||1,this._painter.addTerrainImage(t,e,i)}_drawTiles(t,e,n,i,r,o){const s=[];yM(t,this._getTempTilesForMissed(o,s)),this._newTerrainTileCounter=0;const a=this.layer.getSkinCount(),h=new Set;for(let l=0;l<a;l++)this._renderChildTerrainSkin(l,t,h,s);for(let l=0;l<t.length;l++)this._renderTerrainMeshSkin(t[l].info,t[l].image);for(let l=0;l<s.length;l++)s[l]&&s[l].texture&&!s[l].refs.size&&(this._skinImageCache.delete(s[l].tile.id),this._deleteSkinImage(s[l]));return this._clearCachdeSkinImages(),super._drawTiles(...arguments)}_getTempTilesForMissed(t,e){const n=[];let i=this._tempTilesPool;i||(i=this._tempTilesPool=new pS(this.layer.options.tempTileCacheSize,(t=>{const{info:e,image:n}=t;this._deleteTerrainImage(e,n)}))),i.resetCurrent(!1);for(let r=0;r<t.length;r++){const o=t[r];let s;i.has(o.id)?s=i.getAndRemove(o.id):(s=i.pop(),s?s.image&&(this._resetTerrainImage(s.info,s.image,e),s.image.temp=!0):s={info:o}),s.current=!0,i.add(o.id,s),n.push(s)}for(let r=0;r<t.length;r++)this.getTempTileOnLoading(t[r],n[r]);return n}_clearCachdeSkinImages(){if(!this._skinImageCache)return;const t=this.getCurrentTimestamp();if(this._clearSkinImageTimestamp&&t-this._clearSkinImageTimestamp<1e3)return;const e=new Set;for(const n of this.tileCache.data.values())this._collectSkinImages(n,e);for(const n in this.tilesInView)this._collectSkinImages(this.tilesInView[n],e);if(this._tempTilesPool)for(const n of this._tempTilesPool.data.values())this._collectSkinImages(n,e);e.size&&(this._skinImageCache.forEach(((t,n)=>{e.has(n)||(this._deleteSkinImage(this._skinImageCache.get(n)),this._skinImageCache.delete(n))})),this._clearSkinImageTimestamp=t)}_collectSkinImages(t,e){const n=t.image&&t.image.skinImages;if(n&&n.length)for(let i=0;i<n.length;i++){const t=n[i]&&n.currentSkins;if(t)for(const n of t)e.add(n)}}_renderChildTerrainSkin(t,e,n,i){const r=this.layer.getSkinLayer(t).getRenderer();if(!r)return;const o=[];for(let s=0;s<e.length;s++){const{info:r,image:a}=e[s];if(this._prepareChildTerrainSkin(t,r,a,i)){const i=e[s].image.skinImages[t];for(let t=0;t<i.length;t++){const e=i[t].tile.info.id;n.has(e)||(o.push(i[t]),n.add(e))}}}r.renderTerrainSkin(this.regl,this.layer,o)}_prepareChildTerrainSkin(t,e,n,i){const r=this.getMap();if(delete n.path,!e||!r||!n)return!1;if(!n.terrainMesh)return!1;const o=this.layer.getSkinLayer(t),s=o.getRenderer();if(!s)return!1;n.skinImages||(n.skinImages=[]),n.skinStatus||(n.skinStatus=[]),n.skinTileIds||(n.skinTileIds=[]);const a=s.isAnimating&&s.isAnimating(),h=n.skinStatus[t],l=s.needToRefreshTerrainTileOnZooming&&s.needToRefreshTerrainTileOnZooming(),u=a||l&&n.renderedZoom!==r.getZoom();if(h&&!u)return!1;const c=o.getSpatialReference(),{x:A,y:f,z:d,res:p,offset:g}=e;let m=e.nw;m||(m=e.nw=this.getMap().pointAtResToCoord(e.extent2d.getMin(gS),e.res));const y=this.layer.getTileSize().width,{res:v,zoom:_}=qT(c,d,p),x=WT(v,o.getTileSize().width,p,y);let b=n.skinTileIds[t];if(!b){const e=this.layer._getTileConfig().tileSystem.scale.y;b=n.skinTileIds[t]=UT(o,A,f,_,m,g,e,x,wS)}const w=b[0];let C=!0;const P=[];for(let k=0;k<w.length;k++){const t=s.getCachedTile(w[k],!1);if(t)P.push(t);else{C=!1;const t=s.findParentTile(w[k]);t&&P.push(t)}}const M=n.skinImages[t]||[];M.currentSkins=M.currentSkins||new Set;const T=new Set;let S=!1;for(let k=0;k<M.length;k++)M[k].tile?T.add(M[k].tile.info.id):S=!0;if(!P.length)return M.currentSkins.clear(),n.skinImages[t]=[],!1;const I=P.length?P.map((t=>t.info.id)).join():P[0].info.id;if(!u&&!S&&M.tileIds===I)return!1;M.tileIds=I;let E=!1;M.currentSkins.clear(),M.length=0;const O=M.currentSkins;let R=e.id;n.temp&&(R+="-temp");for(let k=0;k<P.length;k++){const t=P[k].info.id;O.add(t);let e=this._getCachedSkinImage(t);e&&(D=e)&&D.texture||(e={tile:AM({},P[k]),layer:o,refs:new Set,texture:s.createTerrainTexture(this.regl)},this._saveCachedSkinImage(t,e)),e.refs.add(R),M.push(e),E=!0}var D;return this._clearPrevSkinImages(e,n,T,O,i),E&&this._newTerrainTileCounter++,n.skinImages[t]=M,o.fire("renderterrainskin",{tile:e,skinTiles:P}),C&&(n.skinStatus[t]=1),!0}_clearPrevSkinImages(t,e,n,i,r){if(!n.size)return;let o=t.id;e.temp&&(o+="-temp");for(const s of n)if(!i||!i.has(s)){const t=this._getCachedSkinImage(s);this._deleteCachedSkinImage(t,o,r)}}_getCachedSkinImage(t){return this._skinImageCache||(this._skinImageCache=new Map),this._skinImageCache.get(t)}_saveCachedSkinImage(t,e){this._skinImageCache.set(t,e)}_renderTerrainMeshSkin(t,e){const n=this.getMap();if(!t||!n||!e)return;const i=e.skinImages,r=this._needRefreshTerrainSkins(e.renderedZoom);if(e.rendered&&!r)return;e.skin?(xS.framebuffer=e.skin,this.regl.clear(xS)):e.skin=this._createTerrainTexture(t,e),this._initSkinShader();const o=this.layer.options.debug,s=[],a=o&&[],h=this.layer.getTileSize().width;if(i)for(let u=0;u<i.length;u++){const e=i[u];for(let n=0;n<e.length;n++){const{tile:i,texture:r,layer:o}=e[n];if((i.info.offset[0]||i.info.offset[1])&&t.skinTileIds){const e=t.skinTileIds[o.getId()];for(let t=0;t<e.length;t++)if(i.info.x===e[t].x&&i.info.y===e[t].y){i.info.offset=e[t].offset;break}}const a=PS(t,i,h),l=e[n].skinMesh||new z_(this._skinGeometry);l.setUniform("skinTexture",r);const u=o.getOpacity();l.setUniform("opacity",fM(u)?1:u),l.setUniform("skinDim",a),l.setUniform("tileSize",h),l.setUniform("x",t.x),l.setUniform("y",t.y),e[n].skinMesh=l,s.push(l)}}if(o){const n=e.skinDebugMesh||new z_(this._skinGeometry);n.setUniform("tileSize",h);const i=e.debugTexture||this._createDebugTexture(t,h);e.debugTexture=i,e.skinDebugMesh=n,n.setUniform("opacity",1),n.setUniform("skinTexture",i),n.setUniform("skinDim",[0,0,1]),n.setUniform("tileSize",h),a.push(n)}if(s.length){this._skinScene.setMeshes(s);try{this.renderer.render(this._skinShader,null,this._skinScene,e.skin)}catch(l){throw console.error(e),l}}a&&a.length&&this.layer.options.debug&&(this._skinScene.setMeshes(a),this.renderer.render(this._skinShader,null,this._skinScene,e.skin)),e.rendered=this._isSkinReady(e),e.renderedZoom=n.getZoom()}_createDebugTexture(t,e){e*=2;const{x:n,y:i,z:r}=t,o=`terrain:${n}/${i}/${r}`,s=document.createElement("canvas");s.width=e,s.height=e;const a=s.getContext("2d");a.font="20px monospace";const h=this.layer.options.debugOutline;return a.fillStyle=h,a.strokeStyle=h,a.fillText(o,20,e-40),a.beginPath(),a.lineWidth=4,a.moveTo(0,0),a.lineTo(e,0),a.lineTo(e,e),a.lineTo(0,e),a.lineTo(0,0),a.stroke(),this.regl.texture({data:s,flipY:!0,mag:"linear",min:"linear"})}_createTerrainTexture(t){const e=this.layer.getTileSize().width,n=2*e,i=2*e,r=this.regl,o=t.colorsTexture;let s;s=o&&o instanceof Uint8Array?r.texture({data:o,min:"linear",mag:"linear",type:"uint8",width:n,height:i,flipY:!0}):r.texture({min:"linear",mag:"linear",type:"uint8",width:n,height:i,flipY:!0});const a=r.framebuffer({width:n,height:i,colors:[s],colorFormat:"rgba",ignoreStatusCheck:!0,depthStencil:!1,depth:!1,stencil:!1});return a.colorTex=s,a}_endFrame(t){this._painter.endFrame(t)&&!Object.keys(this.tilesLoading).length&&this.layer.fire("terrainreadyandrender")}_clipParentTerrain(t,e){const{image:n,info:i}=t,r=n.data,o=r.width,{extent2d:s,res:a}=i,{extent2d:h,res:l}=e,u=s.getWidth(),c=s.getHeight();let A=(h.xmin*l/a-s.xmin)/u*(o-1),f=(s.ymax-h.ymax*l/a)/c*(o-1),d=Math.round((h.xmax*l/a-s.xmin)/u*(o-1)-A);const p=Math.log2(d);d=Math.pow(2,Math.round(p))+1,A=Math.floor(A),f=Math.floor(f);const g=new Float32Array(d*d);let m=1/0,y=-1/0;for(let v=0;v<d;v++)for(let t=0;t<d;t++){let e=v+A,n=t+f;e>o-1?e=o-1:e<0&&(e=0),n>o-1?n=o-1:n<0&&(n=0);const i=r.data[e+n*o];g[v+t*d]=i,i<m&&(m=i),i>y&&(y=i)}return{width:d,height:d,data:g,min:m,max:y}}getTileOpacity(t){return this._isSkinReady(t)?super.getTileOpacity(t):(this.resetTileLoadTime(t),0)}_isSkinReady(t){const e=this.layer.getSkinCount();if(!e)return!0;if(!t.skinStatus)return!1;for(let n=0;n<e;n++)if(!t.skinStatus[n])return!1;return!0}_needRefreshTerrainSkins(t){const e=this.getMap().getZoom(),n=this.layer.getSkinLayers();for(let i=0;i<n.length;i++){const r=n[i]&&n[i].getRenderer();if(r){if(r.isAnimating&&r.isAnimating())return!0;if(r.needToRefreshTerrainTileOnZooming&&r.needToRefreshTerrainTileOnZooming()&&t!==e)return!0}}return!1}isValidCachedTile(t){return t.image&&!t.image.temp&&(!t.image.skinStatus||this._isSkinReady(t.image))}isTileComplete(t){return t.image&&!t.image.temp&&this._isSkinReady(t.image)}_getTerrainWidth(){const t=this.layer.options;return fM(t.terrainWidth)?t.tileSize+1:t.terrainWidth}_getParentTileRequest(t,e){const n=this.layer.options.maxAvailableZoom-this.layer.options.zoomOffset,i=Math.pow(2,t.z-n),r=Math.floor(t.x/i),o=Math.floor(t.y/i),s=Math.floor(t.idx/i),a=Math.floor(t.idy/i),h=MS(r,o);this._parentRequests||(this._parentRequests={});const l=!this._parentRequests[h];return l&&e&&(this._parentRequests[h]=new Set,this._parentRequests[h].url=this.layer.getTileUrl(r,o,n+this.layer.options.zoomOffset)),{x:r,y:o,idx:s,idy:a,requests:this._parentRequests[h],isFirst:l,key:h}}loadTile(t){const e=this.layer,n=this._getTerrainWidth(),i=e.getSpatialReference().getResolution(t.z);let r=this.getMap().pointAtResToDistance(1,1,i);const o=e.options.maxAvailableZoom&&e.options.maxAvailableZoom-(e.options.zoomOffset||0);if(o&&t.z>o){const n=this._createTerrainFromParent(t);if(-1!==n.sourceZoom)return this.onTileLoad(n,t),n;{const{requests:i,isFirst:s,x:a,y:h,idx:l,idy:u}=this._getParentTileRequest(t,!0);if(i.add(t),!s)return n;const c=t.z-o;r*=Math.pow(2,c);const A=[a,h,o,l,u,t.res*Math.pow(2,c),t.error*Math.pow(2,c)];t=e.createTileNode?e.createTileNode(...A):e._createTileNode(...A)}}const s=t.url,a={},h=e.options,l=e.getTileSize();return this.workerConn.fetchTerrain(s,{terrainWidth:n,type:h.type,accessToken:h.accessToken,cesiumIonTokenURL:h.cesiumIonTokenURL,error:r,colors:h.colors,tileSize:l?[l.width,l.height]:[256,256]},((e,n)=>{if(this._parentRequests){const e=MS(t.x,t.y),n=this._parentRequests[e];if(n&&n.size){this.tileCache.add(t.id,{info:t,image:a});for(const t of n)this.removeTileLoading(t)}delete this._parentRequests[e]}if(e){if(e.canceled)return;return console.warn(e),void this.onTileError(a,t)}gi.extend(a,n),function(t,e=1){if(fM(e)||!t||!t.mesh||1===e)return;const n=t.mesh.positions;if(n)for(let i=0,r=n.length;i<r;i+=3)n[i+2]*=e}(a,this.layer.options.exaggeration),t.colorsTexture=a.colorsTexture,this.onTileLoad(a,t)})),a}deleteTile(t){if(!t||!t.image)return;super.deleteTile(t);const{info:e,image:n}=t;n.temp||(delete e.skinTileIds,this._deleteTerrainImage(t.info,n))}_deleteTerrainImage(t,e){const n=e.skin;n&&(n.destroy(),n.colorTex.destroy(),delete n.colorTex),e.debugTexture&&(e.debugTexture.destroy(),delete e.debugTexture,e.skinDebugMesh.dispose(),delete e.skinDebugMesh);const i=e.skinImages;if(i&&i.length){let n=t.id;e.temp&&(n+="-temp");for(let t=0;t<i.length;t++){const e=i[t];if(e){for(let t=0;t<e.length;t++){if(!e[t]||!e[t].tile)continue;const i=this._skinImageCache&&this._skinImageCache.get(e[t].tile.info.id);i&&this._deleteCachedSkinImage(i,n)}e.length=0}}}e.terrainMesh&&this._painter.deleteMesh(e.terrainMesh),e.image&&e.image.close&&e.image.close(),delete e.skinImages,delete e.skin,delete e.skinStatus,delete e.skinTileIds,delete e.terrainMesh,delete e.image,delete e.data,delete e.mesh,delete e.rendered}_deleteCachedSkinImage(t,e,n){t&&(t.refs.delete(e),t.refs.size||(n?n.push(t):this._deleteSkinImage(t)))}_deleteSkinImage(t){if(!t||!t.tile)return;const e=t.tile.info.id,n=t.layer.getRenderer();delete t.canvas,delete t.layer,t.refs.clear(),t.texture&&(n?n.deleteTerrainTexture(t.texture):t.texture.destroy&&t.texture.destroy(),delete t.texture),t.skinMesh&&(t.skinMesh.dispose(),delete t.skinMesh),n&&(n.removeTileCache&&n.removeTileCache(e),n.deleteTile&&n.constructor.prototype.deleteTile.call(n,t.tile)),delete t.tile,this._skinImageCache.delete(e)}_clearSkinImageCache(){if(!this._skinImageCache)return;const t=this._skinImageCache.keys();for(const e of t){const t=this._getCachedSkinImage(e);this._deleteSkinImage(t)}this._skinImageCache.clear()}abortTileLoading(t,e){const n=this.layer,i=n.options.maxAvailableZoom&&n.options.maxAvailableZoom-n.options.zoomOffset;if(e)if(i&&e.z>i){const{requests:t,key:n}=this._getParentTileRequest(e);t&&t.size&&(t.delete(e),t.size||(delete this._parentRequests[n],this.workerConn&&this.workerConn.abortTerrain(t.url)))}else e&&e.url&&this.workerConn&&this.workerConn.abortTerrain(e.url);super.abortTileLoading(t,e)}onTileError(t,e){super.onTileError(t,e)}_getTerrainTileAtPrjCoord(t){const e=this.getCurrentTileZoom(),n=this.layer.getSpatialReference().getResolution(e),i=this.layer._getTileConfig().getTileIndex(t,n,this.layer.options.repeatWorld);return i.z=e,i}_queryTerrain(t,e,n,i,r){const o=this.layer.getMinZoom(),s=this._findTerrainData(e,n.x,n.y,n.z,o);if(s&&s.image&&s.image.data){const e=s.info.extent2d,o=s.info.res/r,a=e.ymax*o-i.y,h=this._queryAltitudeInHeights(s.image.data,(i.x-e.xmin*o)/(e.getWidth()*o),a/(e.getHeight()*o));t[0]=h,t[1]=null===h?0:+(s.info.z===n.z)}else t[0]=null,t[1]=0;return t}_findTerrainData(t,e,n,i,r){t||(t=this.layer._getTileId(e,n,i));const o=this.tilesInView[t]||this.tileCache.get(t);return!o&&i-1>=r?this._findTerrainData(null,Math.floor(e/2),Math.floor(n/2),i-1,r):o}_queryAltitudeInHeights(t,e,n){const{width:i,height:r,data:o}=t,s=Math.floor((i-1)*e),a=Math.floor((r-1)*n)*i+s;return void 0===o[a]?null:o[a]}_queryTileAltitude(t,e,n){t||(t={tiles:{},dirty:!0,complete:!1});const i=this.layer,r=this.getCurrentTileZoom(),o=i.getSpatialReference().getResolution(r),{xmin:s,ymin:a,xmax:h,ymax:l}=e,u=i._getTileConfig();gS.set(s,a)._multi(n);const c=u._getTileNum(gS,n,!0);mS.set(h,l)._multi(n);const A=u._getTileNum(mS,n,!0),f=Math.min(c.x,A.x),d=Math.max(c.x,A.x),p=Math.min(c.y,A.y),g=Math.max(c.y,A.y),m=n/o;gS.set(s,a)._multi(m),mS.set(h,l)._multi(m);const y=yS.set(gS.x,gS.y,mS.x,mS.y),v=i.getTileSize().width+1;y._expand(y.getWidth()/v),t.array=t.array||new Float32Array(v*v);const _=t.tiles;t.complete=!0,t.array.fill(0);for(let x=f;x<=d;x++)for(let e=p;e<=g;e++){const n=this.layer._getTileId(x,e,r);if(_[n])continue;const i=this.tileCache.get(n);i?(this._fillAltitudeData(t.array,i,y,v),t.dirty=!0,_[n]=1):(t.dirty=t.dirty||void 0!==t.tiles[n],t.tiles[n]&&delete t.tiles[n],t.complete=!1)}return t}_fillAltitudeData(t,e,n,i){const r=e.info.extent2d,o=r.intersection(n),{xmin:s,ymin:a,xmax:h,ymax:l}=o,{data:u}=e.image,c=u.width,A=n.getWidth()/i,f=Math.floor((s-n.xmin)/A),d=Math.floor((a-n.ymin)/A),p=Math.floor((h-n.xmin)/A)-f,g=Math.floor((l-n.ymin)/A)-d,m=r.getWidth()/c,y=Math.floor((s-r.xmin)/m),v=Math.floor((a-r.ymin)/m),_=Math.floor(A/m);for(let x=0;x<=p;x++)for(let e=0;e<=g;e++){const n=x+f+(d+e)*i;let r=0;for(let t=0;t<_;t++)for(let n=0;n<_;n++){const i=(y+Math.floor(x*_))*c+t+v+Math.floor(e*_)+n;r+=u.data[i]}t[n]=r/Math.max(_,1)}return t}clear(){return this.clearTempResources(),super.clear()}clearTempResources(){this._tempTilesPool&&(this._tempTilesPool.reset(),delete this._tempTilesPool),this._skinImageCache&&this._clearSkinImageCache()}onAdd(){super.onAdd(),this.prepareWorker()}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),this.clearTempResources(),this._skinShader&&(this._skinShader.dispose(),delete this._skinShader),this._skinGeometry&&(this._skinGeometry.dispose(),delete this._skinGeometry),delete this._parentRequests,super.onRemove(),this._painter&&(this._painter.delete(),delete this._painter)}prepareWorker(){const t=this.layer.getMap();this.workerConn||(this.workerConn=new NT(t.id));const e=this.workerConn;if(!e.isActive())return;const n=this.layer.options||{},i=this.layer.getId();e.addLayer(i,n,(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.setToRedraw(),this.layer.fire("workerready"))}))}createContext(){this.canvas.gl&&this.canvas.gl.wrap?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this._createREGLContext(),this.renderer=new j_(this.regl),this.layer.fire("contextcreate",{regl:this.regl})}_createPainter(){const t=this._painter;"lit"===this.layer.options.shader||"pbr"===this.layer.options.shader?(t&&t.constructor===nS||!t)&&(t&&(t.delete(),this.clear(),this.setToRedraw()),this._painter=new hS(this.layer),this.layer.fire("paintercreated")):(t&&t.constructor===hS||!t)&&(t&&(t.delete(),this.clear(),this.setToRedraw()),this._painter=new nS(this.layer),this.layer.fire("paintercreated"))}_createREGLContext(){const t=this.layer,e=t.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};e.preserveDrawingBuffer=!0,e.stencil=!0,this.glOptions=e,this.gl=this.gl||this._createGLContext(this.canvas,e),this.regl=nd.createREGL({gl:this.gl,attributes:e,extensions:["OES_element_index_uint"],optionalExtensions:t.options.glExtensions})}_createGLContext(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let o=0;o<n.length;++o){try{i=t.getContext(n[o],e)}catch(r){}if(i)break}return i}resizeCanvas(t){this.canvas&&super.resizeCanvas(t)}clearCanvas(){this.canvas&&super.clearCanvas()}_initSkinShader(){if(this._skinShader)return;const t=this.layer.getTileSize().width;this._skinShader=new mx({vert:"#define SHADER_NAME TERRAIN_SKIN\nattribute vec2 aPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}",frag:"#define SHADER_NAME TERRAIN_SKIN\nprecision mediump float;\nuniform float tileSize;\nuniform sampler2D skinTexture;\nuniform vec3 skinDim;\nuniform float opacity;\nvoid main() {\n    vec2 fragCoord = gl_FragCoord.xy / 2.0;\n    vec2 resolution = vec2(tileSize);\n    vec2 uv = (fragCoord - skinDim.xy) /  (resolution * skinDim.z);\n    if (uv.x >= 0.0 && uv.x <= 1.0 && uv.y >= 0.0 && uv.y <= 1.0) {\n        gl_FragColor = texture2D(skinTexture, uv) * opacity;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}",extraCommandProps:{cull:{enable:!1},viewport:{x:0,y:0,width:2*t,height:2*t},depth:{enable:!1},stencil:{enable:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}});const e=new Int8Array([-1,-1,1,1,-1,1,1,1,-1,-1,1,-1]);this._skinGeometry=this._skinGeometry||new Jv({aPosition:e},0,6,{positionSize:2}),this._skinGeometry.generateBuffers(this.regl),this._skinScene=this._skinScene||new Y_}updateMaterial(t){this._painter&&t&&this._painter.updateMaterial&&(void 0===this._matVer&&(this._matVer=1),this._painter.updateMaterial(t,this._matVer++))}setMaterial(t){this._painter&&t&&this._painter.setMaterial&&(void 0===this._matVer&&(this._matVer=1),this._painter.setMaterial(t,this._matVer++))}getAnalysisMeshes(){return this._painter&&this._painter._leafScene?this._painter._leafScene.getMeshes():[]}}const wS=1;function CS(t,e,n,i,r,o,s,a,h=0){t.font="20px monospace",t.fillStyle=n,_S.y=a-30,t.globalAlpha=1,t.fillText(e,_S.x+r,_S.y+o+h),t.globalAlpha=.6,t.strokeStyle=n,t.lineWidth=i,t.beginPath(),t.moveTo(r,o),t.lineTo(r+s,o),t.lineTo(r+s,o+a),t.lineTo(r,o+a),t.lineTo(r,o),t.stroke(),t.globalAlpha=1}function PS(t,e,n){const{res:i,extent2d:r,offset:o}=t,{info:s}=e,a=s.res/i,h=s.offset;return[s.extent2d.xmin*a-r.xmin+(o[0]-h[0]),-(r.ymin-s.extent2d.ymin*a+(h[1]-o[1])),a*s.tileSize/n]}function MS(t,e){return t+"-"+e}Uf.TileLayerCanvasRenderer.include({renderTerrainSkin(t,e,n){const i=this.layer.getTileSize().width,r=e.options.debug;for(let o=0;o<n.length;o++){const{tile:t,texture:e}=n[o];if(!t.image)continue;const s=document.createElement("canvas");n[o].canvas=s,s.width=i,s.height=i;const a=s.getContext("2d");if(a.drawImage(t.image,0,0),r){const{x:e,y:n,z:r}=t.info;CS(a,`${e}/${n}/${r}`,"yellow",1,0,0,i,i,-18)}e({data:s,width:i,height:i,flipY:!0,min:"linear mipmap linear",mag:"linear"})}},createTerrainTexture(t){const e=this.layer.getTileSize().width;return t.texture({width:e,height:e,flipY:!0,min:"linear mipmap linear",mag:"linear",depthStencil:!1,depth:!1,stencil:!1})},deleteTerrainTexture(t){t.destroy()}});const TS={"clip-inside":.1,"clip-outside":.2,"flat-inside":.3,"flat-outside":.4,color:.5,video:.6,elevate:.7},SS=[],IS=[1,1,1],ES={polygonFill:[255,0,0],polygonOpacity:.8},OS=new $o(0,0),RS=new $o(0,0),DS=[],kS=new $o(0,0),LS=new ht(0,0),FS=new ht(0,0),NS=new ht(0,0);class zS extends Fl{getMode(){return this._mode}remove(){const t=this.getLayer();return t?(t.removeMask(this),this._dispose(),super.remove(),this):this}getMesh(t,e,n){return this.isVisible()?(this._mesh||(this._mesh=this._createMesh(t,e,n)),this._updateUniforms(this._mesh,e,n),this._mesh):null}_createGeometry(t){const e=this.getMap(),n=this.toGeoJSON(),i=Zw.flatten(n.geometry.coordinates),r=i.dimensions;for(let u=0;u<i.vertices.length;u+=r){kS.x=i.vertices[u],kS.y=i.vertices[u+1];const t=bM(e,kS);i.vertices[u]=t[0],i.vertices[u+1]=t[1]}const o=bM(e,this.getCenter()),s=[],a="video"===this.getMode()?4:i.vertices.length/r;for(let u=0;u<a;u++)s.push(i.vertices[u*r]-o[0]),s.push(i.vertices[u*r+1]-o[1]),s.push(0);const h=Zw(s,i.holes,3),l=new Jv({POSITION:s,TEXCOORD:this._createTexcoords(i.vertices,r)},h,0,{positionAttribute:"POSITION",uv0Attribute:"TEXCOORD"});return l.generateBuffers(t),l}_createTexcoords(t,e){const n=[0,0,1,0,1,1,0,1];if(this.hasHoles()){const i=t.length/e*2;for(let t=n.length/2-1;t<i;t+=2)n[t]=n[t+1]=0}return n}clearMesh(){this._dispose(),delete this._mesh,this.maskGeoJSON&&(this.maskGeoJSON=null)}_getMaskMode(){return TS[this._mode]}_getMaskColor(){const t=this.getSymbol(),{polygonFill:e,polygonOpacity:n}=t||ES,i=_M([],e);return i[0]/=255,i[1]/=255,i[2]/=255,i[3]=dM(n)?n:ES.polygonOpacity,i}_altitudeToPoint(t=0){const e=this.getMap(),n=e.getGLRes();return e.altitudeToPoint(t,n)}_setLocalTransform(t){const e=bM(this.getMap(),this.getCenter()),n=tg(t.localTransform,ym(SS),e,IS);t.localTransform=n}_dispose(){this._mesh&&(this._mesh.material&&this._mesh.material.dispose(),this._mesh.geometry&&this._mesh.geometry.dispose(),this._mesh.dispose(),delete this._mesh)}containsPoint(t){const e=this.getExtent();if(kS.set(t[0],t[1]),!e||!e.contains(kS))return!1;const n=this.getHoles();for(let r=0;r<n.length;r++)if(this._contains(n[r],t))return!1;const i=this.getShell();return this._contains(i,t)}_contains(t,e){const n=this._calArea(t);let i=0;for(let r=0;r<t.length;r++){OS.x=t[r].x,OS.y=t[r].y;const n=r+1>=t.length?0:r+1;RS.x=t[n].x,RS.y=t[n].y,kS.x=e[0],kS.y=e[1],DS[0]=kS,DS[1]=OS,DS[2]=RS,i+=this._calArea(DS)}return!(Math.abs(i-n)>1e-8)}_calArea(t){const e=this.getMap();let n=0;const i=e.getGLRes(),r=e.coordToPointAtRes(t[0],i,LS);for(let h=1;h<t.length-1;h++){const l=e.coordToPointAtRes(t[h],i,FS),u=e.coordToPointAtRes(t[h+1],i,NS);n+=Math.abs(((s=l).x-(o=r).x)*((a=u).y-o.y)-(s.y-o.y)*(a.x-o.x))/2}var o,s,a;return n}}const BS=["shapechange","heightrangechange","flatheightchange"],HS=new $o(0,0),jS=[0,0,0],US=[0,0,0];function GS(){return this._maskList?(this._maskList.forEach((t=>{t.remove()})),this._maskList=[],this.updateMaskExtent("shapechange"),this):this}function VS(t){const e=this.getMap(),n=e.getView(),i=e.getFitZoom(t),r=t.getCenter();e.setView({center:r,zoom:i,pitch:0,bearing:0});const o=e.getExtent(),s=Fp([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.projViewMatrix);return e.setView(n),{mapExtent:o,projViewMatrix:s}}function WS(){for(let t=0;t<this._maskList.length;t++)if(this._maskList[t].isVisible())return!0;return!1}function qS(t){return class extends t{removeMask(t){if(!this._maskList)return this;if(!t)return GS.call(this),this;const e=Array.isArray(t)?t:[t];for(let n=0;n<e.length;n++){const t=this._maskList.indexOf(e[n]);t>-1&&this._maskList.splice(t,1)}return this.updateMaskExtent("shapechange"),this.fire("removemask",{masks:t}),this}setMask(t){return this.removeMask(null),this._maskList||(this._maskList=[]),Array.isArray(t)?t.forEach((t=>{this._maskList.push(t)})):this._maskList.push(t),this._maskList.forEach((t=>{t._bindLayer(this),t._updateCoordinates&&t._updateCoordinates()})),this.updateMaskExtent("shapechange"),this.fire("setmask",{masks:t}),this}onAdd(){super.onAdd(),this.updateMaskExtent("shapechange")}getMasks(){return this._maskList||[]}onGeometryEvent(t){if(!t||!t.target)return;const e=t.type;"shapechange"===e&&t.target instanceof zS&&t.target.clearMesh(),t.target instanceof zS&&BS.indexOf(e)>-1&&this.updateMaskExtent(e),super.onGeometryEvent&&super.onGeometryEvent(t)}identifyMask(t,e){if(!this.getMap())return[];if(!this._maskList||!this._maskList.length)return[];const n=AM({},e);n.excludeMasks=!0;const i=this.identifyAtPoint(t,n),r=i.length&&i[0].coordinate;if(r){const t=this._maskList;if(!t)return[];const e=[];for(let n=0;n<t.length;n++){const i=t[n].getMode();!t[n].containsPoint(r)||"color"!==i&&"video"!==i||e.push(t[n])}return e}return[]}remove(){this._maskList&&this._maskList.length&&this._maskList.forEach((t=>{t.remove()})),super.remove()}updateMask(t){const e=this.getMap(),{projViewMatrix:n,mapExtent:i}=VS.call(this,t);HS.x=i.xmin,HS.y=i.ymin;const r=ZS(jS,HS,e);HS.x=i.xmax,HS.y=i.ymax;const o=ZS(US,HS,e);return{projViewMatrix:n,extentInWorld:[r[0],r[1],o[0],o[1]]}}updateMaskExtent(t){if(!this._maskList)return;if(!this.getMap())return;const e=this.getRenderer();if(e&&!this._maskList.length)return void e._clearMask();if(e&&!WS.call(this))return e._deleteMaskUniforms(),void e.setToRedraw();const n=this.getMaskExtent();if(!n)return;const{extent:i,ratio:r,minHeight:o}=n;if(t||!this._maskProjViewMatrix||!this._maskExtentInWorld){const{projViewMatrix:t,extentInWorld:e}=this.updateMask(i);this._maskProjViewMatrix=t,this._maskExtentInWorld=e}e?e.setMask(this._maskExtentInWorld,this._maskProjViewMatrix,r,o):this.once("renderercreate",(t=>{t.renderer.setMask(this._maskExtentInWorld,this._maskProjViewMatrix,r,o)}))}getMaskExtent(){let t=1/0,e=1/0,n=-1/0,i=-1/0,r=-1/0,o=1/0,s=!1;const a=this.getMap().getExtent();for(let u=0;u<this._maskList.length;u++){const h=this._maskList[u];if(!h.isVisible())continue;const l=h.getExtent();if(l&&a.intersects(l)&&(s=!0,l.xmin<t&&(t=l.xmin),l.ymin<e&&(e=l.ymin),l.xmax>n&&(n=l.xmax),l.ymax>i&&(i=l.ymax),h._getHeightRange)){const t=h._getHeightRange();t[0]<o&&(o=t[0]),t[1]>r&&(r=t[1])}}if(!s)return null;const{ratio:h,minHeight:l}=function(t,e){const n=t===1/0?0:t,i=Math.abs((e===-1/0?0:e)-n);return 0===i?{ratio:1,minHeight:0}:{ratio:Math.pow(i,-1),minHeight:n}}(o,r);return{extent:new fs(t,e,n,i),ratio:h,minHeight:l}}}}function ZS(t,e,n,i=0){if(!(n&&e instanceof $o))return null;const r=n.coordinateToPointAtRes(e,n.getGLRes());return t[0]=r.x,t[1]=r.y,t[2]=i,t}const QS=new $o(0,0),XS=new $o(0,0),YS=new ht(0,0),JS=[],KS={tileGrids:[],count:0},$S="01",tI="1";class eI extends(qS(lA)){constructor(t,e){e&&!e.tileSystem&&("cesium"===e.type||"cesium-ion"===e.type?e.tileSystem=[1,1,-180,-90]:"tianditu"===e.type&&(e.tileSystem=[1,-1,-180,90])),super(t,e)}getTileUrl(t,e,n){let i=super.getTileUrl(t,e,n);return"mapbox"===this.options.type&&this.options.requireSkuToken&&(this._skuToken||(this._skuToken=this._createSkuToken()),i.indexOf("?")>-1?i+="&sku="+this._skuToken:i+="?sku="+this._skuToken),i}getMaxAvailableZoom(){return this.getSpatialReference().getMaxZoom()}_createSkuToken(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return[tI,$S,t].join("")}setSkinLayers(t){this._skinLayers=t;const e=this.getRenderer();e&&(e.clear(),e.setToRedraw())}getSkinTiles(t){const e=this.getRenderer();if(!e)return KS;const n=e.getTileGridsInCurrentFrame().tileGrids[0];if(!n)return KS;const i=t.getId(),r=this._getTileConfig().tileSystem.scale,o=t.getTileSize().width,s=n.tiles;if(!s.length)return KS;const a=this.getMap(),h=n.parents||JS,l=h.length,u=h.concat(s),c=t.getSpatialReference(),A=s[0].extent2d.getWidth(),f=r.x,d=r.y,p=[],g=[],m=new Set,y=this._getTileConfig().tileSystem.scale.y;for(let v=0;v<u.length;v++){const e=u[v],{res:n}=e;let r=e.nw;r||(r=e.nw=a.pointAtResToCoord(e.extent2d.getMin(YS),e.res));const{res:s,zoom:h}=qT(c,e.z,n),_=s/n,x=WT(s,o,n,A),{extent2d:b,offset:w}=e,C=x*e.x,P=x*e.y;if(e.skinTileIds||(e.skinTileIds={}),!e.skinTileIds[i]){const n=new Set,a=[],l=VT(t,e.x,e.y,h,r,w,d,x,0);for(let e=0;e<l.length;e++){const i=l[e];if(n.has(i.id))continue;i.idx=i.x,i.idy=i.y,i.res=s,i.url=t.getTileUrl(i.x,i.y,i.z+t.options.zoomOffset);const r=d*(i.skinY-P)*o,h=b.xmin*_+f*(i.x-C)*o,u=b.ymax*_+r,c=b.ymin*_+r;i.extent2d=y>0?new ps(h,c,h+o,c+o):new ps(h,u-o,h+o,u),n.add(i.id),a.push(i)}e.skinTileIds[i]=a}const M=e.skinTileIds[i];for(let t=0;t<M.length;t++)m.has(M[t].id)||(v<l?p.push(M[t]):g.push(M[t]),m.add(M[t].id))}return{tileGrids:[{extent:n.extent,tiles:g,parents:p,count:g.length}],count:g.length}}getSkinLayer(t){return this.getSkinLayers()[t]}getSkinLayers(){return this._skinLayers||JS}getSkinCount(){return this._skinLayers&&this._skinLayers.length||0}queryTerrainByProjCoord(t,e){e=e||[];const n=this.getRenderer();if(!n)return e[0]=null,e[1]=0,e;const i=this.getMap(),r=n._getTerrainTileAtPrjCoord(t);if(!r)return e[0]=null,e[1]=0,e;const o=i._prjToPointAtRes(t,1,YS);return n._queryTerrain(e,r.id,r,o,1)}queryTileTerrainByProjCoord(t,e,n,i){i=i||[];const r=this.getRenderer();if(!r)return i[0]=null,i[1]=0,i;const o=this.getMap()._prjToPointAtRes(t,1,YS);return r._queryTerrain(i,e,n,o,1)}queryTileTerrainByPointAtRes(t,e,n,i,r){r=r||[];const o=this.getRenderer();return o?o._queryTerrain(r,n,i,t,e):(r[0]=null,r[1]=0,r)}queryTerrain(t,e){if(e=e||[],!this.getRenderer())return e[0]=null,e[1]=0,e;const n=this.getMap().getProjection().project(t,QS);return this.queryTerrainByProjCoord(n,e)}queryTileMesh(t,e){const n=this.getRenderer();n&&n._queryTileMesh(t,e)}getTerrainTiles(t){const{x:e,y:n,z:i,res:r,offset:o}=t,s=t.extent2d.getWidth(),a=this._getTileConfig(),h=this.getSpatialReference(),{res:l,zoom:u}=qT(h,i,r),c=this.getTileSize().width,A=WT(l,c,r,s);let f=t.nw;f||(f=t.nw=this.getMap().pointAtResToCoord(t.extent2d.getMin(YS),t.res));const d=UT(this,e,n,u,f,o,a.tileSystem.scale.y,A,1)[0];for(let p=0;p<d.length;p++){const{x:t,y:e}=d[p],n=a.getTilePointNW(t,e,l,YS);d[p].res=l,d[p].extent2d=new ps(n.x,n.y,n.x+c,n.y-c)}return d}isTerrainTileLoaded(t){const e=this.getRenderer();return!!e&&e.isTileCached(t)}updateMaterial(t){if(!t)return;this.options.material||(this.options.material={}),AM(this.options.material,t);const e=this.getRenderer();e&&e.updateMaterial(t)}setMaterial(t){if(!t)return;this.options.material=t;const e=this.getRenderer();e&&e.setMaterial(t)}_createTileNode(t,e,n,i,r,o,s,a,h,l){const u=this.getMap(),c=this.options.zoomOffset;h||(h=this._getTileConfig().getTilePrjExtent(t,e,o).convertTo((t=>u._prjToPointAtRes(t,o,XS))));const A=this._getTileOffset(n);return{parent:a,layer:this.getId(),x:t,y:e,z:n,idx:i,idy:r,res:o,extent2d:h,id:l||this._getTileId(t,e,n),url:this.getTileUrl(t,e,n+c),offset:A,error:s,children:[]}}}eI.mergeOptions({forceRenderOnMoving:!0,forceRenderOnZooming:!0,forceRenderOnRotating:!0,fadeAnimation:!1,fadeDuration:1e3/60*15,tileLimitPerFrame:2,newTerrainTileRenderLimitPerFrameOnInteracting:1,opacity:1,renderer:"gl",pyramidMode:1,tileSize:256,terrainWidth:65,backZoomOffset:0,depthMask:!0,blendSrc:"one",blendDst:"one minus src alpha",requireSkuToken:!0,cesiumIonTokenURL:"https://api.cesium.com/v1/assets/1/endpoint?access_token=",tileRetryCount:0,shader:"default",terrainTileMode:!0,tempTileCacheSize:64,tileStackStartDepth:7,tileStackDepth:6,currentTilesFirst:!1,exaggeration:1,colors:[]}),eI.registerJSONType("TerrainLayer"),eI.registerRenderer("gl",bS);const nI=[],iI=[],rI=[],oI=[],sI=new ht(0,0),aI=[],hI=[],lI=[],uI=[],cI=[],AI=[],fI=[],dI=[],pI=[];class gI{constructor(t,e,n=!0){this._from=t,this._to=e,this._isLngLat=n}setFromPoint(t){this._from=Array.isArray(t)?new $o(t):t}setToPoint(t){this._to=Array.isArray(t)?new $o(t):t}test(t,e,n={}){const i=n.count||0,r=[];let o=this._from,s=this._to;this._isLngLat&&(o=yI(e,this._from.x,this._from.y,this._from.z),s=yI(e,this._to.x,this._to.y,this._to.z));const a=new rr.Ray(o,s);for(let h=0;h<t.length;h++){const n=t[h];if(!this._checkBBox(n.getBoundingBox(),a))continue;const o=n.localTransform,s=n.geometry,l=s.data[s.desc.positionAttribute].array,u=s.data[s.desc.altitudeAttribute]&&s.data[s.desc.altitudeAttribute].array||aI,c=s.indices;if(!(l&&l.length&&c&&c.length))continue;const A=Hp(uI,o,n.positionMatrix),f=this._testMesh(n,a,e,l,u,c,s.desc.positionSize,A,i);if(f&&(r.push({mesh:n,coordinates:f}),0!==i&&r.length>=i))break}return r}_testMesh(t,e,n,i,r,o,s,a,h){const l=[];for(let u=0;u<o.length&&!(u>t.properties.skirtOffset);u+=3){const t=o[u],c=o[u+1],A=o[u+2],f=pg(cI,i[t*s],i[t*s+1],i[t*s+2]),d=this._toWorldPosition(iI,n,f,r[t]/100,a),p=pg(AI,i[c*s],i[c*s+1],i[c*s+2]),g=this._toWorldPosition(rI,n,p,r[c]/100,a),m=pg(fI,i[A*s],i[A*s+1],i[A*s+2]),y=this._toWorldPosition(oI,n,m,r[A]/100,a),v=pg(nI,d,g,y),_=Dg(hI,d,g),x=Dg(lI,d,y),b=this._testIntersection(dI,v,e);if(b){const e=n.pointAtResToAltitude(b[2],n.getGLRes());sI.x=b[0],sI.y=b[1];const i=n.pointAtResToCoordinate(sI,n.getGLRes());if(i.z=e,l.push({coordinate:i,indices:[t,c,A],normal:Tg([],_,x)}),0!==h&&l.length>=h)break}}return l.length?l:null}_toWorldPosition(t,e,n,i,r){let o;return gi.isNumber(i)?(o=e.altitudeToPoint(i,e.getGLRes()),qg(t,n[0],n[1],0,1),om(t,t,r),t[2]=o):(qg(t,n[0],n[1],n[2],1),om(t,t,r)),t}_testIntersection(t,e,n){return n.intersectTriangle(e[0],e[1],e[2],!0,t)}_checkBBox(t,e){return!!t&&e.intersectBox(t,pI)}}const mI=new $o(0,0);function yI(t,e,n,i){if(!t)return null;mI.set(e,n);const r=t.coordinateToPointAtRes(mI,t.getGLRes()),o=t.altitudeToPoint(i||0,t.getGLRes());return[r.x,r.y,o]}const vI=()=>{},_I=new $o(0,0),xI=[0,0,0],bI=[0,0,0],wI=[0,0,0];class CI extends sl{static fromJSON(t){if(!t||"GroupGLLayer"!==t.type)return null;const e=t.layers.map((t=>sl.fromJSON(t)));return new CI(t.id,e,t.options)}constructor(t,e,n){super(t,n),this.layers=e&&e.slice()||[],this.layers.forEach((t=>{if(t.getMap())throw new Error(`layer(${t.getId()} is already added on map`)})),this._checkChildren(),this.sortLayersByZIndex(),this._layerMap={}}sortLayersByZIndex(){if(this.layers&&this.layers.length){for(let t=0,e=this.layers.length;t<e;t++)this.layers[t].__group_gl_order=t;this.layers.sort(MI)}}setSceneConfig(t){this.options.sceneConfig=t;const e=this.getRenderer();return e&&e.updateSceneConfig(),this}getSceneConfig(){return JSON.parse(JSON.stringify(this._getSceneConfig()))}_getSceneConfig(){return this.options.sceneConfig||{}}getGroundConfig(){return this._getSceneConfig().ground}getWeatherConfig(){return this._getSceneConfig().weather}addLayer(t,e){if(t.getMap())throw new Error(`layer(${t.getId()}) is already added on map`);if("gl"!==t.options.renderer)throw new Error(`layer(${t.getId()})'s renderer is canvas, not supported to be added to GroupGLLayer`);void 0===e?this.layers.push(t):this.layers.splice(e,0,t),this._checkChildren(),this.sortLayersByZIndex();const n=this.getRenderer();return n?(this._prepareLayer(t),this._updateTerrainSkinLayers(),n.setToRedraw(),this):this}removeLayer(t){gi.isString(t)&&(t=this.getChildLayer(t));const e=this.layers.indexOf(t);if(e<0)return this;const n=t.getRenderer();n&&n.setTerrainHelper&&n.setTerrainHelper(null),t._doRemove(),this._unbindChildListeners(t),delete this._layerMap[t.getId()],this.layers.splice(e,1);const i=this.getRenderer();return i?(this._updateTerrainSkinLayers(),i.setToRedraw(),this):this}clearLayers(){const t=this.getLayers();for(let e=0;e<t.length;e++)t[e]&&t[e].remove();return this}_updatePolygonOffset(){let t=0;for(let n=0;n<this.layers.length;n++){const e=this.layers[n];e.setPolygonOffset&&e.getPolygonOffsetCount&&(t+=e.getPolygonOffsetCount())}let e=0;for(let n=this.layers.length-1;n>=0;n--){const i=this.layers[n];i.setPolygonOffset&&i.getPolygonOffsetCount&&(i.setPolygonOffset(e,t),e+=i.getPolygonOffsetCount())}this._polygonOffset=e}getPolygonOffsetCount(){return this._polygonOffset}getLayers(){return this.layers.slice()}_getLayers(){return this.layers}toJSON(){const t=[];if(this.layers)for(let e=0;e<this.layers.length;e++){const n=this.layers[e];n&&n&&n.toJSON&&t.push(n.toJSON())}return{type:this.getJSONType(),id:this.getId(),layers:t,options:this.config()}}onLoadEnd(){this.layers.forEach((t=>{this._prepareLayer(t)})),this.options.terrain&&this._initTerrainLayer(),super.onLoadEnd()}_prepareLayer(t){const e=this.getMap();this._layerMap[t.getId()]=t,t._canvas=this.getRenderer().canvas,t._bindMap(e),t.once("renderercreate",this._onChildRendererCreate,this),t.remove=()=>(this.removeLayer(t),t.constructor.prototype.remove.call(t),delete t.remove,this),t.load(),this._bindChildListeners(t)}onRemove(){this._removeTerrainLayer(),this.layers.forEach((t=>{this._resetSkinLayer(t),t._doRemove(),this._unbindChildListeners(t)})),this._layerMap={},this.clearAnalysis(),super.onRemove()}getChildLayer(t){return this._layerMap[t]||null}getLayer(t){return this.getChildLayer(t)}_bindChildListeners(t){t.on("show hide",this._onLayerShowHide,this),t.on("idchange",this._onLayerIDChange,this)}_unbindChildListeners(t){t.off("show hide",this._onLayerShowHide,this),t.off("idchange",this._onLayerIDChange,this)}_onLayerShowHide(){const t=this.getRenderer();t&&t.setToRedraw()}_onLayerIDChange(t){const e=t.new,n=t.old,i=this.getLayer(n);delete this._layerMap[n],this._layerMap[e]=i}_onChildRendererCreate(t){t.renderer.clearCanvas=PI}_checkChildren(){const t={};this.layers.forEach((e=>{const n=e.getId();if(t[n])throw new Error(`Duplicate child layer id (${n}) in the GroupGLLayer (${this.getId()})`);t[n]=1}))}addAnalysis(t){this._analysisTaskList=this._analysisTaskList||[],this._analysisTaskList.push(t);const e=this.getRenderer();e&&e.setToRedraw()}removeAnalysis(t){if(this._analysisTaskList){const e=this._analysisTaskList.indexOf(t);e>-1&&(this._analysisTaskList.splice(e,1),t.remove())}const e=this.getRenderer();e&&e.setToRedraw()}clearAnalysis(){this._analysisTaskList&&(this._analysisTaskList.forEach((t=>{t.remove()})),this._analysisTaskList=[]);const t=this.getRenderer();t&&t.setToRedraw()}identify(t,e){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=n.coordToContainerPoint(new $o(t));return this.identifyAtPoint(r,e)}identifyAtPoint(t,e={}){const n=e.includeInternals,i=this.getLayers(),r=e&&e.childLayers||i,o=this.getMap();if(!o)return[];const s=fM(e.count)?1:e.count;let a=[];for(let h=r.length-1;h>=0;h--){const o=r[h];if(i.indexOf(o)<0||!o.identifyAtPoint)continue;const s=o.options.geometryEvents;if(n&&(void 0===s||!1===s||0===s))continue;if(o.isGeometryListening&&n&&e.eventTypes.indexOf("mousemove")>=0&&!o.isGeometryListening(e.eventTypes))continue;const l=o.identifyAtPoint(t,e);if(!l||!l.length)continue;const u=o.getId();for(let t=0;t<l.length;t++)l[t]&&(l[t].layer=u);a.push(...l)}if(e.orderByCamera){const t=o.cameraPosition;a.sort(((e,n)=>n.point?e.point?Fg(e.point,t)-Fg(n.point,t):1:-1))}return s&&(a=a.slice(0,s)),a}getTerrain(){return this.options.terrain}setTerrain(t){return this.options.terrain=t,this.getRenderer()?(this._initTerrainLayer(),this.getMap().updateCenterAltitude(),this):this}removeTerrain(){return this.setTerrain(null)}updateTerrainMaterial(t){this._terrainLayer&&t&&(this.options.terrain.material?AM(this.options.terrain.material,t):this.options.terrain.material=t,this._terrainLayer.updateMaterial(t))}_initTerrainLayer(){const t=this.getRenderer();t&&t.setToRedraw();const e=this.options.terrain;if(this._terrainLayer){const t=this._terrainLayer,n=t.options;if(e&&n.urlTemplate===e.urlTemplate&&n.spatialReference===e.spatialReference){for(const n in e)"material"===n?t.setMaterial(e[n]):"urlTemplate"!==n&&"spatialReference"!==n&&t.config(n,e[n]);return this}this._removeTerrainLayer()}if(this._resetTerrainSkinLayers(),!e)return this;this._terrainLayer=new eI("__terrain_in_group",e),this._updateTerrainSkinLayers();const n=this._terrainLayer;n.on("tileload",this._onTerrainTileLoad,this),this._prepareLayer(n);const i=e.masks;return i&&i.length?n.setMask(i):n.removeMask(),this.fire("terrainlayercreated"),this}queryTerrain(t,e){return this._terrainLayer?this._terrainLayer.queryTerrain(t,e):(e&&(e[0]=null,e[1]=0),[null,0])}queryTerrainAtPoint(t){if(!this._terrainLayer)return null;const e=this._terrainLayer.getRenderer().getAnalysisMeshes();return this._queryRayCast(t,e)}query3DTilesAtPoint(t){const e=this._getLayers().filter((t=>t&&t.isGeo3DTilesLayer));if(!e.length)return null;for(let n=0;n<e.length;n++){if(!e[n].getRenderer())continue;const i=e[n].identifyAtPoint(t);if(i.length)return new $o(i[0].coordinate)}return null}_queryRayCast(t,e){const n=this.getMap(),i=n.getGLRes();n.getContainerPointRay(bI,wI,t);const r=new gI(bI,wI,!1).test(e,n,{count:1}),o=[];r.forEach((t=>{t.coordinates.forEach((t=>{o.push(t.coordinate)}))}));const s=n.pointAtResToCoordinate(new ht(bI[0],bI[1]),i,_I);s.z=bI[2]/n.altitudeToPoint(1,i);const a=pg(xI,s.x,s.y,s.z);return o.sort(((t,e)=>Fg(t.toArray(),a)-Fg(e.toArray(),a))),o[0]}queryTerrainByProjCoord(t,e){return this._terrainLayer?this._terrainLayer.queryTerrainByProjCoord(t,e):(e&&(e[0]=null,e[1]=0),[null,0])}_updateTerrainSkinLayers(){if(!this._terrainLayer)return;const t=this.layers,e=[];for(let n=0;n<t.length;n++){if(!t[n])continue;const i=t[n],r=i.getRenderer();if(r.renderTerrainSkin){if(r.deleteTile===vI){e.push(t[n]);continue}i.getTiles=()=>this._terrainLayer&&this._terrainLayer.getSkinTiles(i),r.drawTile=r.drawTileOnTerrain?(...t)=>r.drawTileOnTerrain(...t):vI,r.deleteTile=vI,e.push(t[n])}r.setTerrainHelper&&r.setTerrainHelper(this._terrainLayer)}this._terrainLayer.setSkinLayers(e)}_resetSkinLayer(t){if(!function(t){if(!t)return!1;const e=t.getRenderer();return!!e&&!!e.renderTerrainSkin}(t))return;const e=t.getRenderer();e&&(e.setTerrainHelper&&e.setTerrainHelper(null),e.clear&&e.clear(),delete e.drawTile,delete e.deleteTile),delete t.getTiles}_resetTerrainSkinLayers(){const t=this.layers;for(let e=0;e<t.length;e++)t[e]&&this._resetSkinLayer(t[e])}_onTerrainTileLoad(){const t=this.getRenderer();t&&t.setToRedraw()}_removeTerrainLayer(){if(this._terrainLayer){const t=this._terrainLayer;t.off("tileload",this._onTerrainTileLoad,this),this._unbindChildListeners(t),this._terrainLayer._doRemove(),delete this._terrainLayer,this.fire("terrainlayerremoved")}}getTerrainLayer(){return this._terrainLayer}_bindMap(...t){if(this.options.single){const e=t[0].getLayers();for(let t=0;t<e.length;t++)if(e[t]instanceof CI)throw new Error("Only one GroupGLLayer is allowed in a map instance. Set options.single to false if you want to add two or more GroupGLLayers.")}return super._bindMap(...t)}fire(...t){if("layerload"===t[0]){const t=this._getLayers();for(const e of t){const t=e.getRenderer();t&&t.isRenderComplete()&&e.fire("layerload")}}super.fire(...t)}}function PI(){}function MI(t,e){const n=t.getZIndex()-e.getZIndex();return 0===n?t.__group_gl_order-e.__group_gl_order:n}var TI;CI.mergeOptions({renderer:"gl",antialias:!0,extensions:[],single:!0,onlyWebGL1:!1,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_frag_depth","EXT_texture_filter_anisotropic","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"],forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,viewMoveThreshold:100,geometryEvents:!0,multiSamples:4,forceRedrawPerFrame:!1}),CI.registerJSONType("GroupGLLayer"),CI.registerRenderer("gl",class extends Uf.CanvasRenderer{setToRedraw(){this.setRetireFrames(),super.setToRedraw()}onAdd(){super.onAdd(),this.prepareCanvas()}updateSceneConfig(){this._groundPainter&&this._groundPainter.update(),this._envPainter&&this._envPainter.update(),this._weatherPainter&&this._weatherPainter.update(),this.setToRedraw()}render(...t){this.getMap()&&this.layer.isVisible()&&(this.forEachRenderer((t=>{t._replacedDrawFn||(t.draw=this._buildDrawFn(t.draw),t.drawOnInteracting=this._buildDrawOnInteractingFn(t.drawOnInteracting),t.setToRedraw=this._buildSetToRedrawFn(t.setToRedraw),t._replacedDrawFn=!0)})),this.prepareRender(),this.prepareCanvas(),this.layer._updatePolygonOffset(),this._toRedraw=!1,this._renderChildLayers("render",t),this._renderOutlines(),this._postProcess())}prepareCanvas(){super.prepareCanvas(),this.forEachRenderer((t=>{t.prepareCanvas()}))}drawOnInteracting(...t){this.getMap()&&this.layer.isVisible()&&(this.layer._updatePolygonOffset(),this._toRedraw=!1,this._renderChildLayers("drawOnInteracting",t),this._renderOutlines(),this._postProcess())}_renderChildLayers(t,e){this._renderMode="default";const n=this.hasRenderTarget(),i=this._getDrawContext(e);if(n&&(this._drawContext.renderTarget=this._getFramebufferTarget()),this._envPainter.paint(i),this.drawGround(!0),!n)return void this._renderInMode("default",null,t,e,!0);const r=this.glCtx,o=this.layer._getSceneConfig(),s=o&&o.postProcess,a=this.isSSROn();i.jitter=IT;const h=this.layer.getGroundConfig();i.hasSSRGround=!!(a&&h&&h.enable&&h.symbol&&h.symbol.ssr),r.resetDrawCalls(),this._renderInMode("default",this._targetFBO,t,e),a&&this._postProcessor.drawSSR(this._blitDepthTex(),this._targetFBO),s.bloom&&s.bloom.enable&&(this._bloomPainted=this._postProcessor.drawBloom(this._depthTex)),2===a&&this._postProcessor.drawSSR(this._blitDepthTex(),this._targetFBO,!0),r.resetDrawCalls(),this._weatherPainter.renderScene(i),this._pointDrawCount=r.getDrawCalls()}_renderInMode(t,e,n,i,r){this._renderMode=t;const o=this._getDrawContext(i);o.renderMode=this._renderMode,o.renderTarget&&(o.renderTarget.fbo=e),r&&(o.isFinalRender=!0),this.forEachRenderer(((t,r)=>{r.isVisible()&&(this.clearStencil(t,e),t[n].apply(t,i))}))}_getDrawContext(t){let e=t[0];return DT(e)||(e=t[1]),e!==this._contextFrameTime&&(this.forEachRenderer(((t,e)=>{e.isVisible()&&t.needRetireFrames&&t.needRetireFrames()&&this.setRetireFrames()})),this._drawContext=this._prepareDrawContext(e),this._contextFrameTime=e,this._frameEvent=DT(t[0])?null:t[0]),this._drawContext}_renderOutlines(){if(!this.isEnableOutline())return;const t=this._getOutlineFBO(),e=this.glCtx;e.resetDrawCalls(),this.forEachRenderer(((e,n)=>{n.isVisible()&&e.drawOutline&&e.drawOutline(t)})),this._outlineCounts=e.getDrawCalls()}_getOutlineFBO(){const{width:t,height:e}=this.canvas;let n=this._outlineFBO;if(n)t===n.width&&e===n.height||n.resize(t,e);else{const i=this.regl.texture({width:t,height:e,format:"rgba4"});n=this._outlineFBO=this.regl.framebuffer({width:t,height:e,colors:[i],depth:!1,stencil:!1})}return n}_getFBOColor(t){if(this._isUseMultiSample()){const e=this._getBlitFBO(t);return e.width!==t.width||e.height!==t.height?e.resize(t.width,t.height):this.regl.clear({color:[0,0,0,0],fbo:e}),e.blit(t),e.color[0]}return t.color[0]}_blitDepthTex(){if(this._depthTex.subimage)return this._depthTex;const{width:t,height:e}=this._depthTex;if(!this._blitDepthFBO){const n=this.regl,i=n.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:t,height:e,format:"depth stencil"}),r=n.renderbuffer({width:t,height:e,format:"rgba4"});this._blitDepthFBO=n.framebuffer({depthStencil:i,colors:[r],colorFormat:"rgba4",width:t,height:e})}return this._blitDepthFBO.width===t&&this._blitDepthFBO.height===e||this._blitDepthFBO.resize(t,e),this.regl.clear({color:[0,0,0,0],depth:1,fbo:this._blitDepthFBO}),this._blitDepthFBO.blit(this._targetFBO,256,"nearest"),this._blitDepthFBO.depthStencil}_getBlitFBO(t){if(this._blitFBOs||(this._blitFBOs=[]),!t._blitFBO){const e=this._createSimpleFBOInfo(!0,t.width,t.height),n=this.regl.framebuffer(e);this._blitFBOs.push(n),t._blitFBO=n}return t._blitFBO}_isUseMultiSample(){return 0===this.regl.limits.version.indexOf("WebGL 2.0")&&this.layer.options.antialias}hasRenderTarget(){const t=this.layer._getSceneConfig(),e=t&&t.postProcess;return!(!e||!e.enable)}testIfNeedRedraw(){if(this.layer.options.forceRedrawPerFrame)return!0;if(this._toRedraw)return this._toRedraw=!1,!0;if(this.getMap().isInteracting()&&(this._groundPainter&&this._groundPainter.isEnable()||this._envPainter&&this._envPainter.isEnable()))return!0;if(this._weatherPainter&&this._weatherPainter.isEnable())return!0;const t=this.layer.getTerrainLayer();if(t){const e=t.getRenderer();if(e&&e.testIfNeedRedraw())return this._needUpdateSSR=!0,!0}const e=this._getLayers();for(const n of e){if(!n||!n.isVisible())continue;const t=n.getRenderer();if(t&&t.testIfNeedRedraw())return this._needUpdateSSR=!0,!0}return!1}isRenderComplete(){const t=this._getLayers();for(const e of t){const t=e.getRenderer();if(t&&!t.isRenderComplete())return!1}return!0}mustRenderOnInteracting(){const t=this._getLayers();for(const e of t){const t=e.getRenderer();if(t&&t.mustRenderOnInteracting())return!0}return!1}isCanvasUpdated(){if(super.isCanvasUpdated())return!0;const t=this._getLayers();for(const e of t){const t=e.getRenderer();if(t&&t.isCanvasUpdated())return!0}return!1}isBlank(){if(this._groundPainter&&this._groundPainter.isEnable())return!1;if(this._envPainter&&this._envPainter.isEnable())return!1;const t=this.layer.getTerrainLayer();if(t){const e=t.getRenderer();if(e&&!e.isBlank())return!1}const e=this._getLayers();for(const n of e){const t=n.getRenderer();if(t&&!t.isBlank())return!1}return!0}createContext(){const t=this.layer,e=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0};e.preserveDrawingBuffer=!0,e.antialias=!!t.options.antialias,this.glOptions=e;const n=this.gl=function(t,e,n){const i=n?["webgl","experimental-webgl"]:["webgl2","webgl","experimental-webgl"];let r=null;for(let s=0;s<i.length;++s){try{r=t.getContext(i[s],e)}catch(o){}if(r)break}return r||console.error("Browser doesn't support WebGL."),r}(this.canvas,e,t.options.onlyWebGL1);this._initGL(n),n.wrap=()=>new lC(this.gl),this.glCtx=n.wrap(),this.canvas.gl=this.gl,this.reglGL=n.wrap(),this.regl=id({gl:this.reglGL,attributes:e,extensions:t.options.extensions,optionalExtensions:t.options.optionalExtensions}),this.gl.regl=this.regl,this._jitter=[0,0],this._groundPainter=new WM(this.regl,this.layer),this._envPainter=new JM(this.regl,this.layer);const i=this.layer.getWeatherConfig();this._weatherPainter=new yT(this.regl,t,i),this._analysisPainter=new MT(this.regl,t);const r=this.layer._getSceneConfig()||{},o=r&&r.postProcess;this._jitGetter=new Sx(o&&o.antialias&&o.antialias.jitterRatio||.2),this._postProcessor=new bT(this.regl,this.layer,this._jitGetter),this._shadowProcess=new MM(this.regl,this.layer)}_initGL(){const t=this.layer,e=this.gl,n=t.options.extensions;n&&n.forEach((t=>{e.getExtension(t)}));const i=t.options.optionalExtensions;i&&i.forEach((t=>{e.getExtension(t)})),this.gl.clearColor(0,0,0,0)}clearCanvas(){super.clearCanvas(),this._clearFramebuffers()}_clearFramebuffers(){const t=this.regl;this._targetFBO&&t.clear({color:TT,depth:1,stencil:255,framebuffer:this._targetFBO}),this._outlineFBO&&t.clear({color:TT,framebuffer:this._outlineFBO}),t.clear({color:TT,depth:1,stencil:255})}resizeCanvas(){const t=this.canvas.width,e=this.canvas.height;!this._targetFBO||this._targetFBO.width===t&&this._targetFBO.height===e||(super.resizeCanvas(),this._targetFBO.resize(t,e),this._clearFramebuffers(),this.forEachRenderer((t=>{t.canvas&&t.resizeCanvas()})))}getCanvasImage(){return this.forEachRenderer((t=>{t.getCanvasImage()})),super.getCanvasImage()}_getLayers(){return this.layer._getLayers()}forEachRenderer(t){const e=this._getLayers();for(const i of e){if(!i.isVisible()||!i.options.beneathTerrain)continue;const e=i.getRenderer();e&&t(e,i)}const n=this.layer.getTerrainLayer();if(n){const e=n.getRenderer();e&&t(e,n)}for(const i of e){if(!i.isVisible()||i.options.beneathTerrain)continue;const e=i.getRenderer();e&&t(e,i)}}clearStencil(t,e){const n={stencil:t.getStencilValue?t.getStencilValue():255};e&&(n.framebuffer=e),this.regl.clear(n)}onRemove(){this.canvas.pickingFBO&&this.canvas.pickingFBO.destroy&&this.canvas.pickingFBO.destroy(),this._destroyFramebuffers(),this._groundPainter&&(this._groundPainter.dispose(),delete this._groundPainter),this._envPainter&&(this._envPainter.dispose(),delete this._envPainter),this._shadowProcess&&(this._shadowProcess.dispose(),delete this._shadowProcess),this._postProcessor&&(this._postProcessor.dispose(),delete this._postProcessor),this._outlineFBO&&(this._outlineFBO.destroy(),delete this._outlineFBO),this._weatherPainter&&(this._weatherPainter.dispose(),delete this._weatherPainter),super.onRemove()}_destroyFramebuffers(){if(this._targetFBO&&(this._targetFBO.destroy(),delete this._targetFBO,this._postFBO&&(this._postFBO.destroy(),delete this._postFBO),this._blitDepthFBO&&(this._blitDepthFBO.destroy(),delete this._blitDepthFBO),this._blitFBOs)){for(let t=0;t<this._blitFBOs.length;t++)this._blitFBOs[t]&&this._blitFBOs[t].destroy();delete this._blitFBOs}}setRetireFrames(){this._needRetireFrames=!0}getFrameTime(){return this._contextFrameTime}getFrameEvent(){return this._frameEvent}getFrameContext(){return this._drawContext}drawGround(t){const e=this.layer.getGroundConfig();if(!e||!e.enable)return!1;if(!this._groundPainter)return!1;const n=this.getFrameContext(),i=n.jitter;n.jitter=IT;const r=this.layer.getPolygonOffsetCount();let o;n.offsetFactor=r+1,n.offsetUnits=r+1,t&&(o=n.sceneFilter,delete n.sceneFilter);const s=this._groundPainter.paint(n);return this._groundPainter.needToRedraw()&&this.setToRedraw(),o&&(n.sceneFilter=o),n.jitter=i,s}_buildDrawFn(t){const e=this;return function(n,i){return(i=i||e._drawContext)&&i.renderTarget&&(i.renderTarget.getFramebuffer=kT,i.renderTarget.getDepthTexture=LT),t.call(this,n,i)}}_buildDrawOnInteractingFn(t){const e=this;return function(n,i,r){return(r=r||e._drawContext)&&r.renderTarget&&(r.renderTarget.getFramebuffer=kT,r.renderTarget.getDepthTexture=LT),t.call(this,n,i,r)}}_buildSetToRedrawFn(t){return function(...e){return t.apply(this,e)}}isEnableSSR(){const t=this.layer._getSceneConfig(),e=t&&t.postProcess;return e&&e.enable&&e.ssr&&e.ssr.enable}isSSROn(){const t=this.isEnableSSR(),e=this.getMap();if(!t||e.getPitch()<=-.001)return 0;const n=e.projViewMatrix,i=this._postProcessor.getPrevSsrProjViewMatrix();return i&&hg(i,n)?1:2}isEnableTAA(){return!1}isEnableSSAO(){return!1}isEnableOutline(){const t=this.layer._getSceneConfig(),e=t&&t.postProcess;return e&&e.enable&&e.outline&&e.outline.enable}isEnableWeather(){const t=this.layer._getSceneConfig(),e=t&&t.weather;return e&&e.enable}_getViewStates(){const t=this.layer.getMap();if(!this._renderedView){this._renderedView={center:t.getCenter(),bearing:t.getBearing(),pitch:t.getPitch(),res:t.getResolution()};let e=!1;if(t.options.lights){const n=t.getLightManager().getDirectionalLight().direction||ST;this._renderedView.lightDirection=dg([],n),e=!0}return{viewChanged:!0,lightDirectionChanged:e}}const e=t.getResolution()/this._renderedView.res,n=t.coordToContainerPoint(this._renderedView.center),i=this.layer.options.viewMoveThreshold,r=n._sub(t.width/2,t.height/2).mag()>i||e<.95||e>1.05;let o=!1;if(t.options.lights){const e=t.getLightManager().getDirectionalLight().direction||ST;o=!Og(this._renderedView.lightDirection,e),o&&(this._renderedView.lightDirection=dg([],e))}return r&&(this._renderedView.center=t.getCenter(),this._renderedView.bearing=t.getBearing(),this._renderedView.pitch=t.getPitch(),this._renderedView.res=t.getResolution()),{viewChanged:r,lightDirectionChanged:o}}_prepareDrawContext(t){const e=this.layer._getSceneConfig(),n=e&&e.postProcess,i=e&&e.weather,r={timestamp:t,renderMode:this._renderMode||"default",includes:{},states:this._getViewStates(),testSceneFilter:t=>!r.sceneFilter||r.sceneFilter(t),isFinalRender:!1,weather:{fog:i&&i.fog}},o=this._jitGetter;o&&o.setRatio(n&&n.antialias&&n.antialias.jitterRatio||.2);const s=this.isSSROn();let a;if(n&&n.enable){this.isEnableTAA()?((this.getMap().isInteracting()||this._needRetireFrames)&&o.reset(),o.getJitter(this._jitter),o.frame()):ly(this._jitter,0,0),r.jitter=this._jitter;const t=n.bloom&&n.bloom.enable;t&&s?(r.bloom=1,r.sceneFilter=ET):t?(r.bloom=1,r.sceneFilter=OT):s&&(r.sceneFilter=RT),a=this._getFramebufferTarget(),a&&(r.renderTarget=a)}else this._destroyFramebuffers();return"noAa"!==this._renderMode&&(this._shadowContext=this._prepareShadowContext(r),this._shadowContext&&(r.includes.shadow=1),this._includesState=this._updateIncludesState(r)),this._shadowContext&&(r.shadow=this._shadowContext,r.includes.shadow=1),r.states.includesChanged=this._includesState,n&&n.enable&&this._postProcessor&&this._postProcessor.setContextIncludes(r),r}_renderAnalysis(t){const e=this._getLayers().filter((t=>t.isVisible()));return this.layer.getTerrainLayer()&&e.push(this.layer.getTerrainLayer()),this._analysisPainter.paint(t,e)}_updateIncludesState(t){let e=!1;const n=Object.keys(t.includes),i=this._prevIncludeKeys;if(i){const t=n.filter((t=>-1===i.indexOf(t))).concat(i.filter((t=>-1===n.indexOf(t))));t.length&&(e=t.reduce(((t,e)=>(t[e]=1,t)),{}))}return this._prevIncludeKeys=n,e}_prepareShadowContext(t){const e=this.layer._getSceneConfig();if(!e||!e.shadow||!e.shadow.enable)return this._shadowProcess&&(this._shadowProcess.dispose(),delete this._shadowProcess),null;this._shadowProcess||(this._shadowProcess=new MM(this.regl,this.layer));const n={config:e.shadow,defines:this._shadowProcess.getDefines(),uniformDeclares:MM.getUniformDeclares()};return n.renderUniforms=this._renderShadow(t),n}_renderShadow(t){const e=t.renderTarget&&t.renderTarget.fbo,n=this.layer._getSceneConfig(),i=[];let r=t.states.lightDirectionChanged||t.states.viewChanged;this.forEachRenderer(((t,e)=>{if(!t.getShadowMeshes||!e.isVisible())return;const n=t.getShadowMeshes();if(Array.isArray(n))for(let o=0;o<n.length;o++)n[o]&&(n[o].needUpdateShadow&&(r=!0,n[o].needUpdateShadow=!1),n[o].hasFunctionUniform&&(n[o].hasFunctionUniform("minAltitude")||n[o].setFunctionUniform("minAltitude",(()=>e&&e.options.altitude||0)),i.push(n[o])))})),this._shadowScene||(this._shadowScene=new Y_),this._shadowScene.setMeshes(i);const o=this.getMap(),s=n.shadow,a=o.getLightManager(),h=a&&a.getDirectionalLight().direction||ST;return this._shadowProcess.render(!n.ground||!n.ground.enable,o.projMatrix,o.viewMatrix,s.color,s.opacity,h,this._shadowScene,this._jitter,e,r)}_renderWeather(t){let e=[];if(this.forEachRenderer(((t,n)=>{if(!t.getAnalysisMeshes||!n.isVisible())return;const i=t.getAnalysisMeshes();e=e.concat(i)})),this._groundPainter){const t=this._groundPainter.getRenderMeshes();e=e.concat(t)}const n=this.layer.getWeatherConfig();return this._weatherPainter.paint(t,e,n)}getGroundMesh(){return this._groundPainter?this._groundPainter.getRenderMeshes():[]}_getFramebufferTarget(){const t=this.layer._getSceneConfig();if(!this._targetFBO){const e=this.regl;let n=this._depthTex;(!n||!n._texture||n._texture.refCount<=0)&&(n=null);const i=this.createFBOInfo(t&&t.postProcess,n);this._depthTex=i.depth||i.depthStencil,this._targetFBO=e.framebuffer(i),this._clearFramebuffers()}return{fbo:this._targetFBO}}_createSimpleFBOInfo(t,e,n){e=e||this.canvas.width,n=n||this.canvas.height;const i=this.regl,r=this._isUseMultiSample();let o;return o=!t&&r?i.renderbuffer({width:e,height:n,samples:this.layer.options.multiSamples,format:"rgba8"}):i.texture({min:"nearest",mag:"nearest",type:"uint8",width:e,height:n}),{width:e,height:n,colors:[o],colorFormat:r?"rgba8":"rgba"}}createFBOInfo(t,e){let{width:n,height:i}=this.canvas;n=n||1,i=i||1;const r=this.regl,o=this._createSimpleFBOInfo(),s=this._isUseMultiSample(),a=r.hasExtension("WEBGL_depth_texture");if(s){const t=e||r.renderbuffer({width:n,height:i,format:"depth24 stencil8",samples:this.layer.options.multiSamples});o.depthStencil=t}else if(a){const t=e||r.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:n,height:i,format:"depth stencil"});o.depthStencil=t}else{const t=e||r.renderbuffer({width:n,height:i,format:"depth stencil"});o.depthStencil=t}return o}_postProcess(){if(!this._targetFBO)return void(this._needRetireFrames=!1);const t=this.layer._getSceneConfig(),e=t&&t.postProcess;if(!e||!e.enable){if(this.isEnableWeather())throw new Error("you must enable the post process to turn on weather");return}this.layer.fire("postprocessstart");const n=this.layer.getMap();let i=e.sharpen&&e.sharpen.factor;i||0===i||(i=.2);let r=0,o=.2,s=.3,a=1,h=[1,1,0];e.outline&&(r=+!!e.outline.enable,o=FT(e.outline,"highlightFactor",o),s=FT(e.outline,"outlineFactor",s),a=FT(e.outline,"outlineWidth",a),h=FT(e.outline,"outlineColor",h));const l=e.ssr&&e.ssr.enable,u=e.bloom&&e.bloom.enable,c=this._analysisPainter._hasAnalysis(),A=this._weatherPainter._hasWeather(),f=u||l||c||A;let d=this._postFBO;if(f){if(!d){const t=this._createSimpleFBOInfo();this._isUseMultiSample()&&(t.depthStencil=this.regl.renderbuffer({width:this.canvas.width,height:this.canvas.height,samples:this.layer.options.multiSamples,format:"depth24 stencil8"})),d=this._postFBO=this.regl.framebuffer(t)}const{width:t,height:e}=this.canvas;d.width===t&&d.height===e||d.resize(t,e)}else d=null,this._postFBO&&(this._postFBO.destroy(),delete this._postFBO);let p=this._getFBOColor(this._targetFBO);if(this._postProcessor.fxaa(d,p,0,+!(!e.toneMapping||!e.toneMapping.enable),+!(f||!e.sharpen||!e.sharpen.enable),n.getDevicePixelRatio(),i,r&&this._outlineCounts>0&&this._getOutlineFBO(),o,s,a,h),d&&(p=this._getFBOColor(d)),u&&this._bloomPainted){const t=e.bloom,n=+t.threshold||0,i=FT(t,"factor",1),r=FT(t,"radius",1);p=this._postProcessor.bloom(p,null,null,n,i,r,0)}if(l&&(this._postProcessor.genSsrMipmap(p,this._blitDepthTex()),this._needUpdateSSR)){const t=this._needRetireFrames;this.setToRedraw(),this._needRetireFrames=t,this._needUpdateSSR=!1}this._analysisPainter&&(p=this._renderAnalysis(p)),this.isEnableWeather()&&(p=this._renderWeather(p)),f&&this._postProcessor.renderFBOToScreen(p,+!(!e.sharpen||!e.sharpen.enable),i,n.getDevicePixelRatio()),this.layer.fire("postprocessend")}}),CI.registerRenderer("canvas",null),function(t){t[t.AMBIENT=0]="AMBIENT",t[t.REALISTIC=1]="REALISTIC"}(TI||(TI={}));class SI{constructor(t){this._map=t,this._loader=new V_}getDirectionalLight(){return this._config&&this._config.directional||{}}getAmbientLight(){return this._config&&this._config.ambient||{}}getAmbientResource(){return this._iblMaps}setConfig(t){const e=this._config;this._urlModifier=t.urlModifier,this._config=JSON.parse(JSON.stringify(t));let n=!1;if(t&&t.ambient&&t.ambient.resource){if(!(e&&e.ambient&&(i=e.ambient,r=t.ambient,i.resource&&i.resource.url===r.resource.url)))return void this._initAmbientResources();this._iblMaps&&(t.ambient.prefilterCubeSize!==e.ambient&&e.ambient.prefilterCubeSize&&this._onHDRLoaded(),n=!0,t.ambient.resource.sh&&(this._iblMaps.sh=t.ambient.resource.sh))}else this._disposeCubeLight(),n=e&&e.ambient&&e.ambient.resource;var i,r;this._map.fire("updatelights",{ambientUpdate:n})}_tryToGetREGLContext(t){const e=t.getLayers();for(let r=0;r<e.length;r++){const t=e[r]&&e[r].getRenderer();if(t&&t.regl)return t.regl}const n=document.createElement("canvas"),i=id({canvas:n,attributes:{depth:!1,stencil:!1,alpha:!1}});return i._temp=!0,i}_initAmbientResources(){const t=this._config.ambient.resource,e=t&&t.url;if(!e)return;const n=[];let i=0,r=0;const o=()=>{r++,r>=i&&this._onSkyboxLoaded(n)},s=function(){throw new Error(`skybox image with url(${this.src}) failed to load, please check the image's url.`)},a=this._urlModifier;if(e.top||e.nx){const{front:t,back:r,right:h,left:l,top:u,bottom:c}=e,{nx:A,ny:f,px:d,py:p,nz:g,pz:m}=e;let y;y=t?[l,h,r,t,u,c]:[A,d,g,m,p,f],i=y.length;for(let e=0;e<i;e++){const t=new Image;t.onload=o,t.onerror=s,t.src=a&&a(y[e])||y[e],n[e]=t}}else{const e={url:t.url,arrayBuffer:!0,hdr:!0,flipY:!0};this._loader.setURLModifier(a),this._hdr=new sx(e,this._loader),this._hdr.once("complete",(()=>{this._onHDRLoaded()})),this._hdr.once("error",(()=>{this._onHDRError()}))}}dispose(){this._disposeCubeLight()}_onHDRLoaded(){this._hdr&&(this._iblMaps=this._createIBLMaps(this._hdr),this._map.fire("updatelights",{ambientUpdate:!0}))}_onHDRError(){this._map.fire("hdrerror")}_onSkyboxLoaded(t){this._iblMaps=this._createIBLMaps(t),this._map.fire("updatelights",{ambientUpdate:!0})}_createIBLMaps(t){const e=this._config.ambient.resource,n=e.prefilterCubeSize||512,i=this._tryToGetREGLContext(this._map),r=Xw.PBRHelper.createIBLMaps(i,{envTexture:Array.isArray(t)?t:t.getREGLTexture(i),ignoreSH:!!e.sh,envCubeSize:n,prefilterCubeSize:n,environmentExposure:this._config.ambient.exposure,format:"array"});if(e.sh&&(r.sh=e.sh,Array.isArray(r.sh[0]))){const t=r.sh,e=[];for(let n=0;n<t.length;n++)e.push(...t[n]);r.sh=e}return i._temp&&(delete this._hdr,i.destroy()),r}_disposeCubeLight(){this._hdr&&(this._hdr.dispose(),delete this._hdr),delete this._iblMaps}}let II,EI,OI,RI,DI;Al.include({setLights(t){return this.options.lights=t,this._initLightManager(),this},getLights(){return this.options.lights},_initLightManager(){this._lightManager||(this._lightManager=new SI(this)),this._lightManager.setConfig(this.getLights())},getLightManager(){return this._lightManager?this._lightManager:null}}),Al.addOnLoadHook((function(){this.options.lights&&this._initLightManager()}));const kI={color:[0,0,0,0]},LI={enable:!1};Al.include({setPostProcessConfig(t){return this.options.postProcessConfig=t,this},getPostProcessConfig(){return this.options.postProcessConfig}});const FI=Uf.MapCanvasRenderer.prototype.drawLayerCanvas;Uf.MapCanvasRenderer.prototype.drawLayerCanvas=function(){const t=FI.apply(this,arguments);return t&&function(t,e){const n=t.map.getPostProcessConfig();if(!n||!n.enable)return;var i,r;II||(i=e.width,r=e.height,II=document.createElement("canvas",i,r),EI=id({canvas:II,attributes:{depth:!1,stencil:!1,alpha:!0,antialias:!1,premultipliedAlpha:!1}}),OI=EI.texture({mag:"linear",min:"linear",mipmap:!1,flipY:!0,width:i,height:r}),RI=EI.texture()),II.width===e.width&&II.height===e.height||(II.width=e.width,II.height=e.height),EI.clear(kI);const o=n.filmicGrain||LI;void 0===o.enable&&(o.enable=!0);const s=n.vignette||LI;void 0===s.enable&&(s.enable=!0);const a=n.colorLUT||LI;void 0===a.enable&&(a.enable=!0),t._postProcessContext||(t._postProcessContext={});const h=t._postProcessContext;if(a.enable){const e=a.lut;if(!h.lutTexture||h.lutTexture.url!==e){const n=new Image;n.onload=function(){const i={data:n,min:"linear",mag:"linear"},r=h.lutTexture?h.lutTexture.texture(i):EI.texture(i);h.lutTexture={url:e,texture:r},t.setLayerCanvasUpdated()},n.src=e}}const l={enableGrain:+!!o.enable,grainFactor:void 0===o.factor?.15:o.factor,timeGrain:performance.now(),enableVignette:+!!s.enable,lensRadius:s.lensRadius||[.8,.25],frameMod:1,enableLut:+!!a.enable,lookupTable:h.lutTexture?h.lutTexture.texture:RI};DI||(DI=new bT(EI)),DI.postprocess(null,l,OI({width:II.width,height:II.height,data:e,flipY:!0,mag:"linear",min:"linear",mipmap:!1})),o.enable&&t.setLayerCanvasUpdated(),t.context.drawImage(II,0,0,II.width,II.height)}(this,this.canvas),t};const NI=Uf.MapCanvasRenderer.prototype.renderFrame;Uf.MapCanvasRenderer.prototype.renderFrame=function(){const t=NI.apply(this,arguments),e=this.map.getPostProcessConfig(),n=e&&e.filmicGrain;return!n||void 0!==n.enable&&!0!==n.enable||this.setLayerCanvasUpdated(),t};const zI=[];function BI(t){t.properties.showOnlyTimestamp&&(delete t.properties.showOnlyTimestamp,jI(t))}function HI(t,e){const n=t.geometry.properties;n.oldElementsBeforeHighlight||(n.oldElementsBeforeHighlight=t.geometry.elements),n.elements&&(n.oldElementsArrBeforeHighlight||(n.oldElementsArrBeforeHighlight=n.elements),n.elements=e)}function jI(t){const e=t.geometry.properties.oldElementsBeforeHighlight;e&&t.geometry.elements!==e&&(t.geometry.deleteElements(),t.geometry.setElements(t.geometry.properties.oldElementsBeforeHighlight),t.geometry.properties.oldElementsArrBeforeHighlight&&(t.geometry.properties.elements=t.geometry.properties.oldElementsArrBeforeHighlight,delete t.geometry.properties.oldElementsArrBeforeHighlight),delete t.geometry.properties.hasInvisible,delete t.geometry.properties.oldElementsBeforeHighlight)}function UI(t){if(!t.properties.highlightTimestamp)return;const e=t.defines;delete e.HAS_HIGHLIGHT_COLOR,delete e.HAS_HIGHLIGHT_OPACITY,t.setDefines(e),delete t.properties.highlightTimestamp,jI(t),GI(t)}function GI(t){if(!t)return;const{hlBloomMesh:e}=t.properties;if(e){const n=e.geometry;n.elements&&n.elements.destroy&&n.deleteElements(),e.dispose(),delete t.properties.hlBloomMesh}}var VI=Object.freeze({__proto__:null,clearHighlight:UI,clearShowOnly:BI,deleteHighlightBloomMesh:GI,highlightMesh:function(t,e,n,i,r){const{highlightTimestamp:o}=e.properties;if(!n)return void(o&&UI(e));if(i===o)return;const s=e.geometry.getVertexCount();let{aHighlightColor:a,aHighlightOpacity:h}=e.geometry.properties;a&&a.fill(0),h&&h.fill(255);let l=!1,u=!1;const c=n.keys();let A=null,f=null;for(const g of c)if(r.has(g)){const t=n.get(g),{color:e,bloom:i,visible:o}=t;let c,{opacity:d}=t;if(e&&(l||(a||(a=new Uint8Array(4*s)),l=!0),c=xM(zI,e)),d=fM(d)?1:d,d<1&&(u||(h||(h=new Uint8Array(s),h.fill(255)),u=!0)),!1===o&&(f||(f=new Set),f.add(g)),c||d<1||i){const t=r.get(g);if(t)for(let e=0;e<t.length;e++){const n=t[e];c&&qg(a.subarray(4*n,4*n+4),...c),d<1&&(h[n]=255*d),i&&(A||(A=[]),A.push(n))}}}const d=e.defines;if(l?(e.geometry.data.aHighlightColor?e.geometry.updateData("aHighlightColor",a):(e.geometry.data.aHighlightColor=a,e.geometry.generateBuffers(t)),e.geometry.properties.aHighlightColor=a,d.HAS_HIGHLIGHT_COLOR=1):d.HAS_HIGHLIGHT_COLOR&&(e.geometry.updateData("aHighlightColor",a),delete d.HAS_HIGHLIGHT_COLOR),u?(e.geometry.data.aHighlightOpacity?e.geometry.updateData("aHighlightOpacity",h):(e.geometry.data.aHighlightOpacity=h,e.geometry.generateBuffers(t)),e.geometry.properties.aHighlightOpacity=h,d.HAS_HIGHLIGHT_OPACITY=1):d.HAS_HIGHLIGHT_OPACITY&&(e.geometry.updateData("aHighlightOpacity",h),delete d.HAS_HIGHLIGHT_OPACITY),f&&f.size>0){let n=[];r.forEach(((t,e)=>{f.has(e)||yM(n,t)})),e.geometry.properties.hasInvisible=!0,HI(e,n);const i={data:n,primitive:e.geometry.getPrimitive()};e.geometry.elements!==e.geometry.properties.oldElementsBeforeHighlight&&e.geometry.elements.destroy&&e.geometry.deleteElements(),n=t.elements(i),e.geometry.setElements(n),e.geometry.generateBuffers(t)}else e.geometry.properties.hasInvisible&&jI(e);e.setDefines(d),e.properties.highlightTimestamp=i;let p=e.properties.hlBloomMesh;if(A&&A.length){if(p){const t=Fp(p.localTransform,e.localTransform),n=Fp(p.positionMatrix,e.positionMatrix);p.setLocalTransform(t),p.setPositionMatrix(n),e.properties.hlBloomMesh.geometry.setElements(A)}else{const n=new Jv(e.geometry.data,A,0,e.geometry.desc);n.generateBuffers(t),p=new z_(n,e.material,e.config);const i=e.uniforms;for(const t in i)Object.defineProperty(p.uniforms,t,{enumerable:!0,get:function(){return e.getUniform(t)}});const r=AM({},e.defines);r.HAS_BLOOM=1;const o=Fp([],e.localTransform),s=Fp([],e.positionMatrix);p.setLocalTransform(o),p.setPositionMatrix(s),AM(p.properties,e.properties),AM(n.properties,e.geometry.properties),p.setDefines(r),p.bloom=1}e.properties.hlBloomMesh=p}else p&&GI(e)},showOnly:function(t,e,n,i,r){const{showOnlyTimestamp:o}=e.properties;if(!n)return void(o&&BI(e));if(i===o)return;e.properties.showOnlyTimestamp=i;const s=n.keys(),a=[];for(const l of s){if(!r.has(l))continue;const t=r.get(l);t&&yM(a,t)}HI(e,a),e.geometry.elements!==e.geometry.properties.oldElementsBeforeHighlight&&e.geometry.elements.destroy&&e.geometry.deleteElements();const h={data:a,primitive:e.geometry.getPrimitive()};e.geometry.setElements(t.elements(h)),e.geometry.generateBuffers(t)}});const WI=[0,0,0,0];class qI{constructor(t,e,n,i,r,o){this.renderer=new j_(t),this.sceneConfig=e,this._layer=n,this._colorStops=i,this._stencil=r,this._polygonOffset=o||{factor:0,units:0},this._init(),this._outputSize=[]}render(t,e,n){this._check();const i=this._layer.getMap();this.renderer.regl.clear({color:WI,depth:1,stencil:255,framebuffer:this._heatmapFBO}),this.renderer.render(this._heatmapShader,e,t,this._heatmapFBO);const r=this._layer.getRenderer().canvas;this._outputSize[0]=r.width,this._outputSize[1]=r.height;const o=AM({colorRamp:this._colorRampTex,inputTexture:this._heatmapFBO,projViewMatrix:i.projViewMatrix,textureOutputSize:this._outputSize},e);return this._transformGround(),this.renderer.render(this._displayShader,o,this._groundScene,n)}dispose(){this._heatmapShader&&(this._heatmapShader.dispose(),delete this._heatmapShader),this._displayShader&&(this._displayShader.dispose(),delete this._displayShader),this._ground&&(this._ground.geometry.dispose(),this._ground.dispose(),delete this._ground,delete this._groundScene),this._heatmapFBO&&(this._heatmapFBO.destroy(),delete this._heatmapFBO)}_createColorRamp(){const t=this._colorStops;let e=this._rampCanvas,n=this._rampCtx;n?n.clearRect(0,0,256,1):(e=this._rampCanvas=document.createElement("canvas"),e.width=256,e.height=1,n=this._rampCtx=e.getContext("2d"));const i=n.createLinearGradient(0,0,256,1);for(let r=0;r<t.length;r++)i.addColorStop(t[r][0],t[r][1]);n.fillStyle=i,n.fillRect(0,0,256,1),this._colorRampTex&&this._colorRampTex.destroy(),this._colorRampTex=this.renderer.regl.texture({width:256,height:1,data:e,min:"linear",mag:"linear",premultiplyAlpha:!0})}_check(){const t=this._layer.getRenderer().canvas,e=Math.ceil(t.width/4),n=Math.ceil(t.height/4),i=this._heatmapFBO;i.width===e&&i.height===n||i.resize(e,n)}_init(){this._createColorRamp(),this._createShader(),this._createHeatmapTex(),this._createGround()}_createGround(){const t=new ax;t.generateBuffers(this.renderer.regl),this._ground=new z_(t),this._groundScene=new Y_([this._ground])}_transformGround(){const t=this._layer.getMap(),e=WM.getGroundTransform(this._ground.localTransform,t);this._ground.setLocalTransform(e)}_createHeatmapTex(){const t=this._layer.getRenderer().canvas,e=this.renderer.regl,n=e.hasExtension("OES_texture_half_float")?"half float":"float",i=Math.ceil(t.width/4),r=Math.ceil(t.height/4),o=e.texture({width:i,height:r,type:n,min:"linear",mag:"linear",format:"rgba"});this._heatmapFBO=e.framebuffer({width:i,height:r,color:[o]})}_createShader(){const t=this._layer.getRenderer().canvas,e=this.sceneConfig.depthRange,n={viewport:{x:0,y:0,width:()=>t?Math.ceil(t.width/4):1,height:()=>t?Math.ceil(t.height/4):1},depth:{enable:!0,func:"always"}};this._stencil&&(n.stencil=this._stencil),this._heatmapShader=new Dx({extraCommandProps:n}),this._displayShader=new Nx({x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},{extraCommandProps:{stencil:{enable:!1},depth:{enable:!0,range:e||[0,1],func:"<="},polygonOffset:{enable:!0,offset:this._polygonOffset},scissor:{enable:!1}}})}}class ZI extends zS{constructor(t,e){super(t,e)}_createMesh(t){const e=this._createGeometry(t),n=new z_(e);return this._setDefines(n),this._setLocalTransform(n),n}_updateUniforms(t,e,n){const i=this._getMaskMode();t.setUniform("maskMode",i);const r=this._getMaskColor();if(t.setUniform("maskColor",r),dM(e)){const i=this._getHeightRange();i[0]=(i[0]-n)*e,i[1]=(i[1]-n)*e,t.setUniform("heightRange",i)}}setHeightRange(t){this.options.heightRange=t,this._fireEvent("heightrangechange")}getHeightRange(){return this.options.heightRange}_getHeightRange(){const t=[0,0];return this.options.heightRange&&(t[0]=this._altitudeToPoint(this.options.heightRange[0]),t[1]=this._altitudeToPoint(this.options.heightRange[1])),t}_setDefines(t){const e=t.getDefines();e.HAS_MASK_COLOR=1,t.setDefines(e)}}class QI extends ZI{constructor(t,e){super(t,e),this._mode="clip-inside"}}class XI extends ZI{constructor(t,e){super(t,e),this._mode="clip-outside"}}class YI extends zS{constructor(t,e){super(t,e)}setFlatheight(t){this.options.flatHeight=t,this._fireEvent("flatheightchange")}_createMesh(t){const e=this._createGeometry(t),n=new z_(e);return this._setDefines(n),this._setLocalTransform(n),n}_updateUniforms(t){const e=this._getMaskMode();t.setUniform("maskMode",e);const n=this._getMaskColor();t.setUniform("maskColor",n);const i=this._altitudeToPoint(this.options.flatHeight||0);t.setUniform("flatHeight",i)}_setDefines(t){const e=t.getDefines();e.HAS_MASK_FLAT=1,t.setDefines(e)}_getHeightRange(){const t=[0,this.options.flatHeight];return t[1]=this._altitudeToPoint(t[1]),t}}let JI=class extends YI{constructor(t,e){super(t,e),this._mode="flat-inside"}};class KI extends YI{constructor(t,e){super(t,e),this._mode="flat-outside"}}class $I extends zS{constructor(t,e){super(t,e),this._mode="color"}setHeightRange(t){this.options.heightRange=t,this._fireEvent("heightrangechange")}_createMesh(t){const e=this._createGeometry(t),n=new z_(e);return this._setDefines(n),this._setLocalTransform(n),n}_updateUniforms(t,e,n){const i=this._getMaskMode();t.setUniform("maskMode",i);const r=this._getMaskColor();if(t.setUniform("maskColor",r),dM(e)){const i=this._getHeightRange();i[0]=(i[0]-n)*e,i[1]=(i[1]-n)*e,t.setUniform("heightRange",i)}}_setDefines(t){const e=t.getDefines();e.HAS_MASK_COLOR=1,t.setDefines(e)}_getHeightRange(){const t=[0,0];return this.options.heightRange&&(t[0]=this._altitudeToPoint(this.options.heightRange[0]),t[1]=this._altitudeToPoint(this.options.heightRange[1])),t}}class tE extends zS{constructor(t,e){super(t,e),this._mode="video"}play(){this._video&&this._video.play()}pause(){this._video&&this._video.pause()}setAudio(t){this._video&&(this.video.muted=t)}setUrl(t){this.options.url=t,this._createVideo(t)}getState(){return this._videoState}_createMesh(t){const e=this._createGeometry(t),n=new z_(e),i=this._createVideoTexture(t);return n.material=new T_({maskTexture:i}),this._setDefines(n),this._setLocalTransform(n),n}_updateUniforms(t){const e=this._getMaskMode();t.setUniform("maskMode",e);const n=this._getMaskColor();t.setUniform("maskColor",n)}_setDefines(t){const e=t.getDefines();e.HAS_VIDEO=1,t.setDefines(e)}_createVideoTexture(t){return this._createVideo(),t.texture()}_createVideo(){this._videoState="stop";const t=this.options.url;let e=document.getElementById(this.options.elementId);if(t&&(e=document.createElement("video"),e.src=t),!e)throw new Error("there is no element or url setting for video mask");e.autoplay=this.options.autoplay||!0,e.loop=this.options.loop||!0,e.muted=this.options.muted||!0,e.play(),e.addEventListener("playing",(()=>{this._videoState="playing"})),e.addEventListener("pause",(()=>{this._videoState="pause"})),this._video=e}_update(){const t=this._mesh;if(t&&t.material){const e=t.material.get("maskTexture");e&&this._video&&this._needUpdate()&&e(this._video)}}_needUpdate(){return"playing"===this._videoState}}class eE extends YI{constructor(t,e){super(t,e),this.setElevation(e.elevation),this._mode="elevate"}setElevation(t){this.options.elevation=t,this.setFlatheight(this.options.elevation)}}const nE=new ht(0,0),iE=new ht(0,0),rE=new ht(0,0),oE=new ht(0,0);class sE extends ZI{constructor(t,e){super([],e),this._position=t}setPosition(t){this._position=t,this._updateCoordinates()}getPosition(){return this._position}setWidth(t){this.options.width=t,this._updateCoordinates()}setLength(t){this.options.length=t,this._updateCoordinates()}setHeight(t){this.options.height=t,this._updateCoordinates()}setRotation(t){this.options.rotation=t,this._updateCoordinates()}_updateCoordinates(){const t=this.getLayer();if(!t)return;const e=t.getMap();if(e){const{length:t,width:n,height:i}=this.options,r=this._position,o=this.options.rotation||0,{coordinates:s,heightRange:a}=this._generateCoordinates(e,r,t,n,i,o);this.setCoordinates(s),this.setHeightRange(a)}}_generateCoordinates(t,e,n,i,r,o){const s=t.getGLRes(),a=t.distanceToPointAtRes(i/2,0,s,nE),h=t.distanceToPointAtRes(0,n/2,s,iE),l=t.coordinateToPointAtRes(e,s,rE),u=l.x-a.x,c=l.x+a.x,A=l.y+h.y,f=l.y-h.y,d=this._rotatePoint([[u,A],[c,A],[c,f],[u,f]],l,o);oE.set(d[0][0],d[0][1]);const p=t.pointAtResToCoordinate(oE,s);oE.set(d[1][0],d[1][1]);const g=t.pointAtResToCoordinate(oE,s);oE.set(d[2][0],d[2][1]);const m=t.pointAtResToCoordinate(oE,s);oE.set(d[3][0],d[3][1]);const y=t.pointAtResToCoordinate(oE,s),v=e.z-r/2;return{coordinates:[[p.x,p.y,v],[g.x,g.y,v],[m.x,m.y,v],[y.x,y.y,v],[p.x,p.y,v]],heightRange:[v,e.z+r/2]}}_rotatePoint(t,e,n){for(let i=0;i<t.length;i++)xy(t[i],t[i],[e.x,e.y],n*Math.PI/180);return t}}class aE extends sE{constructor(t,e){super(t,e),this._mode="clip-inside"}}class hE extends sE{constructor(t,e){super(t,e),this._mode="clip-outside"}}"undefined"!=typeof window&&window.maptalks&&(window.maptalks.GroupGLLayer=CI,window.maptalks.ClipInsideMask=QI,window.maptalks.ClipOutsideMask=XI,window.maptalks.FlatInsideMask=JI,window.maptalks.FlatOutsideMask=KI,window.maptalks.ElevateMask=eE,window.maptalks.ColorMask=$I,window.maptalks.VideoMask=tE,window.maptalks.BoxInsideClipMask=aE,window.maptalks.BoxOutsideClipMask=hE,window.maptalks.RayCaster=gI);const lE=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")},uE=lE(),cE=uE.gl_trans__coders=uE.gl_trans__coders||{};cE.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,i=e.substring(0,n),r=uE.gl_trans__coders=uE.gl_trans__coders||{};let o=`${i}\n    const _____getGlobal = ${lE.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const s in r)"inject"!==s&&"getTranscoder"!==s&&"registerTranscoder"!==s&&(o+='tran_____scoders["'+s+'"] ='+r[s].toString()+"\n;");return o+="\n"+e.substring(i.length),o},cE.registerTranscoder=function(t,e){cE[t]=e},cE.getTranscoder=function(t){return cE[t]};const AE="${";let fE;cr("@maptalks/terrain",`function(e){\n/*!\n     * @maptalks/gltf-loader v0.98.4\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.org\n     */\nvar n,t,r="undefined"!=typeof Float32Array?Float32Array:Array;function o(){var e=new r(3);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function i(e,n,t){var o=new r(3);return o[0]=e,o[1]=n,o[2]=t,o}function a(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)}),o(),n=new r(4),r!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),o(),i(1,0,0),i(0,1,0),a(),a(),t=new r(9),r!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1;let s=0;!function(e){e[0]=0,e[1]=0,e[2]=0,e[3]=1}([]),"undefined"!=typeof TextDecoder&&new TextDecoder("utf-8");const c={get:function(e,n={},t){n||(n={});const r=new AbortController,o=r.signal,i=function(e){for(let n=1;n<arguments.length;n++){const t=arguments[n];for(const n in t)e[n]=t[n]}return e}({},n);i.signal=o,i.method||(i.method="GET"),i.referrerPolicy=i.referrerPolicy||"origin","undefined"==typeof window||i.referrer||(i.referrer=window.location.href),t&&(e=t(e));const a=fetch(e,i).then((e=>{const t=this._(e,n.responseType);return t.message?t:t.then((t=>"arraybuffer"===n.responseType?{data:t,cacheControl:e.headers.get("Cache-Control"),expires:e.headers.get("Expires"),contentType:e.headers.get("Content-Type")}:t)).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}))})).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}));return a.xhr=r,a},_:(e,n)=>200!==e.status?{status:e.status,statusText:e.statusText,message:\`incorrect http request with status code(${AE}e.status}): ${AE}e.statusText}\`}:"arraybuffer"===n?e.arrayBuffer():"json"===n?e.json():e.text(),getArrayBuffer:(e,n={},t)=>(n||(n={}),n.responseType="arraybuffer",c.get(e,n,t)),getJSON:function(e,n={},t){return n&&n.jsonp?c.jsonp(e):((n=n||{}).responseType="json",c.get(e,n,t))},jsonp:function(e){const n="_maptalks_jsonp_"+s++;e.match(/\\?/)?e+="&callback="+n:e+="?callback="+n;let t=document.createElement("script");return t.type="text/javascript",t.src=e,new Promise((e=>{window[n]=function(r){document.getElementsByTagName("head")[0].removeChild(t),t=null,delete window[n],e(r)},document.getElementsByTagName("head")[0].appendChild(t)}))}};if("undefined"!=typeof TextDecoder&&new TextDecoder("utf-8"),"undefined"!=typeof OffscreenCanvas){let e;try{e=new OffscreenCanvas(2,2).getContext("2d")}catch(r){}}"undefined"!=typeof document&&document.createElement("canvas"),function(){function e(e){throw e}var n=void 0,t=!0,r=this;function o(e,t){var o,i=e.split("."),a=r;!(i[0]in a)&&a.execScript&&a.execScript("var "+i[0]);for(;i.length&&(o=i.shift());)i.length||t===n?a=a[o]?a[o]:a[o]={}:a[o]=t}var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function a(n,t){this.index="number"==typeof t?t:0,this.i=0,this.buffer=n instanceof(i?Uint8Array:Array)?n:new(i?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&e(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var e,n=this.buffer,t=n.length,r=new(i?Uint8Array:Array)(t<<1);if(i)r.set(n);else for(e=0;e<t;++e)r[e]=n[e];return this.buffer=r},a.prototype.d=function(e,n,t){var r,o=this.buffer,i=this.index,a=this.i,s=o[i];if(t&&1<n&&(e=8<n?(d[255&e]<<24|d[e>>>8&255]<<16|d[e>>>16&255]<<8|d[e>>>24&255])>>32-n:d[e]>>8-n),8>n+a)s=s<<n|e,a+=n;else for(r=0;r<n;++r)s=s<<1|e>>n-r-1&1,8==++a&&(a=0,o[i++]=d[s],s=0,i===o.length&&(o=this.f()));o[i]=s,this.buffer=o,this.i=a,this.index=i},a.prototype.finish=function(){var e,n=this.buffer,t=this.index;return 0<this.i&&(n[t]<<=8-this.i,n[t]=d[n[t]],t++),i?e=n.subarray(0,t):(n.length=t,e=n),e};var s,c=new(i?Uint8Array:Array)(256);for(s=0;256>s;++s){for(var f=h=s,l=7,h=h>>>1;h;h>>>=1)f<<=1,f|=1&h,--l;c[s]=(f<<l&255)>>>0}var d=c;function u(e){this.buffer=new(i?Uint16Array:Array)(2*e),this.length=0}function v(e){var n,t,r,o,a,s,c,f,l,h,d=e.length,u=0,v=Number.POSITIVE_INFINITY;for(f=0;f<d;++f)e[f]>u&&(u=e[f]),e[f]<v&&(v=e[f]);for(n=1<<u,t=new(i?Uint32Array:Array)(n),r=1,o=0,a=2;r<=u;){for(f=0;f<d;++f)if(e[f]===r){for(s=0,c=o,l=0;l<r;++l)s=s<<1|1&c,c>>=1;for(h=r<<16|f,l=s;l<n;l+=a)t[l]=h;++o}++r,o<<=1,a<<=1}return[t,u,v]}function _(e,n){this.h=g,this.w=0,this.input=i&&e instanceof Array?new Uint8Array(e):e,this.b=0,n&&(n.lazy&&(this.w=n.lazy),"number"==typeof n.compressionType&&(this.h=n.compressionType),n.outputBuffer&&(this.a=i&&n.outputBuffer instanceof Array?new Uint8Array(n.outputBuffer):n.outputBuffer),"number"==typeof n.outputIndex&&(this.b=n.outputIndex)),this.a||(this.a=new(i?Uint8Array:Array)(32768))}u.prototype.getParent=function(e){return 2*((e-2)/4|0)},u.prototype.push=function(e,n){var t,r,o,i=this.buffer;for(t=this.length,i[this.length++]=n,i[this.length++]=e;0<t&&(r=this.getParent(t),i[t]>i[r]);)o=i[t],i[t]=i[r],i[r]=o,o=i[t+1],i[t+1]=i[r+1],i[r+1]=o,t=r;return this.length},u.prototype.pop=function(){var e,n,t,r,o,i=this.buffer;for(n=i[0],e=i[1],this.length-=2,i[0]=i[this.length],i[1]=i[this.length+1],o=0;!((r=2*o+2)>=this.length)&&(r+2<this.length&&i[r+2]>i[r]&&(r+=2),i[r]>i[o]);)t=i[o],i[o]=i[r],i[r]=t,t=i[o+1],i[o+1]=i[r+1],i[r+1]=t,o=r;return{index:e,value:n,length:this.length}};var m,g=2,x={NONE:0,r:1,k:g,N:3},p=[];for(m=0;288>m;m++)switch(t){case 143>=m:p.push([m+48,8]);break;case 255>=m:p.push([m-144+400,9]);break;case 279>=m:p.push([m-256+0,7]);break;case 287>=m:p.push([m-280+192,8]);break;default:e("invalid literal: "+m)}function A(e,n){this.length=e,this.G=n}_.prototype.j=function(){var r,o,s,c,f=this.input;switch(this.h){case 0:for(s=0,c=f.length;s<c;){var l,h,d,u=o=i?f.subarray(s,s+65535):f.slice(s,s+65535),v=(s+=o.length)===c,_=n,m=n,x=this.a,A=this.b;if(i){for(x=new Uint8Array(this.a.buffer);x.length<=A+u.length+5;)x=new Uint8Array(x.length<<1);x.set(this.a)}if(l=v?1:0,x[A++]=0|l,d=65536+~(h=u.length)&65535,x[A++]=255&h,x[A++]=h>>>8&255,x[A++]=255&d,x[A++]=d>>>8&255,i)x.set(u,A),A+=u.length,x=x.subarray(0,A);else{for(_=0,m=u.length;_<m;++_)x[A++]=u[_];x.length=A}this.b=A,this.a=x}break;case 1:var y=new a(i?new Uint8Array(this.a.buffer):this.a,this.b);y.d(1,1,t),y.d(1,2,t);var b,E,O,S=w(this,f);for(b=0,E=S.length;b<E;b++)if(O=S[b],a.prototype.d.apply(y,p[O]),256<O)y.d(S[++b],S[++b],t),y.d(S[++b],5),y.d(S[++b],S[++b],t);else if(256===O)break;this.a=y.finish(),this.b=this.a.length;break;case g:var C,M,H,k,N,P,D,R,U,L,F,z,W,G,V,j=new a(i?new Uint8Array(this.a.buffer):this.a,this.b),X=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],K=Array(19);for(C=g,j.d(1,1,t),j.d(C,2,t),M=w(this,f),D=T(P=I(this.L,15)),U=T(R=I(this.K,7)),H=286;257<H&&0===P[H-1];H--);for(k=30;1<k&&0===R[k-1];k--);var B,q,Z,Y,J,$,Q=H,ee=k,ne=new(i?Uint32Array:Array)(Q+ee),te=new(i?Uint32Array:Array)(316),re=new(i?Uint8Array:Array)(19);for(B=q=0;B<Q;B++)ne[q++]=P[B];for(B=0;B<ee;B++)ne[q++]=R[B];if(!i)for(B=0,Y=re.length;B<Y;++B)re[B]=0;for(B=J=0,Y=ne.length;B<Y;B+=q){for(q=1;B+q<Y&&ne[B+q]===ne[B];++q);if(Z=q,0===ne[B])if(3>Z)for(;0<Z--;)te[J++]=0,re[0]++;else for(;0<Z;)($=138>Z?Z:138)>Z-3&&$<Z&&($=Z-3),10>=$?(te[J++]=17,te[J++]=$-3,re[17]++):(te[J++]=18,te[J++]=$-11,re[18]++),Z-=$;else if(te[J++]=ne[B],re[ne[B]]++,3>--Z)for(;0<Z--;)te[J++]=ne[B],re[ne[B]]++;else for(;0<Z;)($=6>Z?Z:6)>Z-3&&$<Z&&($=Z-3),te[J++]=16,te[J++]=$-3,re[16]++,Z-=$}for(r=i?te.subarray(0,J):te.slice(0,J),L=I(re,7),G=0;19>G;G++)K[G]=L[X[G]];for(N=19;4<N&&0===K[N-1];N--);for(F=T(L),j.d(H-257,5,t),j.d(k-1,5,t),j.d(N-4,4,t),G=0;G<N;G++)j.d(K[G],3,t);for(G=0,V=r.length;G<V;G++)if(z=r[G],j.d(F[z],L[z],t),16<=z){switch(G++,z){case 16:W=2;break;case 17:W=3;break;case 18:W=7;break;default:e("invalid code: "+z)}j.d(r[G],W,t)}var oe,ie,ae,se,ce,fe,le,he,de=[D,P],ue=[U,R];for(ce=de[0],fe=de[1],le=ue[0],he=ue[1],oe=0,ie=M.length;oe<ie;++oe)if(ae=M[oe],j.d(ce[ae],fe[ae],t),256<ae)j.d(M[++oe],M[++oe],t),se=M[++oe],j.d(le[se],he[se],t),j.d(M[++oe],M[++oe],t);else if(256===ae)break;this.a=j.finish(),this.b=this.a.length;break;default:e("invalid compression type")}return this.a};var y=function(){function n(n){switch(t){case 3===n:return[257,n-3,0];case 4===n:return[258,n-4,0];case 5===n:return[259,n-5,0];case 6===n:return[260,n-6,0];case 7===n:return[261,n-7,0];case 8===n:return[262,n-8,0];case 9===n:return[263,n-9,0];case 10===n:return[264,n-10,0];case 12>=n:return[265,n-11,1];case 14>=n:return[266,n-13,1];case 16>=n:return[267,n-15,1];case 18>=n:return[268,n-17,1];case 22>=n:return[269,n-19,2];case 26>=n:return[270,n-23,2];case 30>=n:return[271,n-27,2];case 34>=n:return[272,n-31,2];case 42>=n:return[273,n-35,3];case 50>=n:return[274,n-43,3];case 58>=n:return[275,n-51,3];case 66>=n:return[276,n-59,3];case 82>=n:return[277,n-67,4];case 98>=n:return[278,n-83,4];case 114>=n:return[279,n-99,4];case 130>=n:return[280,n-115,4];case 162>=n:return[281,n-131,5];case 194>=n:return[282,n-163,5];case 226>=n:return[283,n-195,5];case 257>=n:return[284,n-227,5];case 258===n:return[285,n-258,0];default:e("invalid length: "+n)}}var r,o,i=[];for(r=3;258>=r;r++)o=n(r),i[r]=o[2]<<24|o[1]<<16|o[0];return i}(),b=i?new Uint32Array(y):y;function w(r,o){function a(n,r){var o,i,a,s,c=n.G,f=[],l=0;switch(o=b[n.length],f[l++]=65535&o,f[l++]=o>>16&255,f[l++]=o>>24,t){case 1===c:i=[0,c-1,0];break;case 2===c:i=[1,c-2,0];break;case 3===c:i=[2,c-3,0];break;case 4===c:i=[3,c-4,0];break;case 6>=c:i=[4,c-5,1];break;case 8>=c:i=[5,c-7,1];break;case 12>=c:i=[6,c-9,2];break;case 16>=c:i=[7,c-13,2];break;case 24>=c:i=[8,c-17,3];break;case 32>=c:i=[9,c-25,3];break;case 48>=c:i=[10,c-33,4];break;case 64>=c:i=[11,c-49,4];break;case 96>=c:i=[12,c-65,5];break;case 128>=c:i=[13,c-97,5];break;case 192>=c:i=[14,c-129,6];break;case 256>=c:i=[15,c-193,6];break;case 384>=c:i=[16,c-257,7];break;case 512>=c:i=[17,c-385,7];break;case 768>=c:i=[18,c-513,8];break;case 1024>=c:i=[19,c-769,8];break;case 1536>=c:i=[20,c-1025,9];break;case 2048>=c:i=[21,c-1537,9];break;case 3072>=c:i=[22,c-2049,10];break;case 4096>=c:i=[23,c-3073,10];break;case 6144>=c:i=[24,c-4097,11];break;case 8192>=c:i=[25,c-6145,11];break;case 12288>=c:i=[26,c-8193,12];break;case 16384>=c:i=[27,c-12289,12];break;case 24576>=c:i=[28,c-16385,13];break;case 32768>=c:i=[29,c-24577,13];break;default:e("invalid distance")}for(o=i,f[l++]=o[0],f[l++]=o[1],f[l++]=o[2],a=0,s=f.length;a<s;++a)g[x++]=f[a];A[f[0]]++,y[f[3]]++,p=n.length+r-1,v=null}var s,c,f,l,h,d,u,v,_,m={},g=i?new Uint16Array(2*o.length):[],x=0,p=0,A=new(i?Uint32Array:Array)(286),y=new(i?Uint32Array:Array)(30),w=r.w;if(!i){for(f=0;285>=f;)A[f++]=0;for(f=0;29>=f;)y[f++]=0}for(A[256]=1,s=0,c=o.length;s<c;++s){for(f=h=0,l=3;f<l&&s+f!==c;++f)h=h<<8|o[s+f];if(m[h]===n&&(m[h]=[]),d=m[h],!(0<p--)){for(;0<d.length&&32768<s-d[0];)d.shift();if(s+3>=c){for(v&&a(v,-1),f=0,l=c-s;f<l;++f)_=o[s+f],g[x++]=_,++A[_];break}0<d.length?(u=E(o,s,d),v?v.length<u.length?(_=o[s-1],g[x++]=_,++A[_],a(u,0)):a(v,-1):u.length<w?v=u:a(u,0)):v?a(v,-1):(_=o[s],g[x++]=_,++A[_])}d.push(s)}return g[x++]=256,A[256]++,r.L=A,r.K=y,i?g.subarray(0,x):g}function E(e,n,t){var r,o,i,a,s,c,f=0,l=e.length;a=0,c=t.length;e:for(;a<c;a++){if(r=t[c-a-1],i=3,3<f){for(s=f;3<s;s--)if(e[r+s-1]!==e[n+s-1])continue e;i=f}for(;258>i&&n+i<l&&e[r+i]===e[n+i];)++i;if(i>f&&(o=r,f=i),258===i)break}return new A(f,n-o)}function I(e,n){var t,r,o,a,s,c=e.length,f=new u(572),l=new(i?Uint8Array:Array)(c);if(!i)for(a=0;a<c;a++)l[a]=0;for(a=0;a<c;++a)0<e[a]&&f.push(a,e[a]);if(t=Array(f.length/2),r=new(i?Uint32Array:Array)(f.length/2),1===t.length)return l[f.pop().index]=1,l;for(a=0,s=f.length/2;a<s;++a)t[a]=f.pop(),r[a]=t[a].value;for(o=function(e,n,t){function r(e){var t=v[e][_[e]];t===n?(r(e+1),r(e+1)):--d[t],++_[e]}var o,a,s,c,f,l=new(i?Uint16Array:Array)(t),h=new(i?Uint8Array:Array)(t),d=new(i?Uint8Array:Array)(n),u=Array(t),v=Array(t),_=Array(t),m=(1<<t)-n,g=1<<t-1;for(l[t-1]=n,a=0;a<t;++a)m<g?h[a]=0:(h[a]=1,m-=g),m<<=1,l[t-2-a]=(l[t-1-a]/2|0)+n;for(l[0]=h[0],u[0]=Array(l[0]),v[0]=Array(l[0]),a=1;a<t;++a)l[a]>2*l[a-1]+h[a]&&(l[a]=2*l[a-1]+h[a]),u[a]=Array(l[a]),v[a]=Array(l[a]);for(o=0;o<n;++o)d[o]=t;for(s=0;s<l[t-1];++s)u[t-1][s]=e[s],v[t-1][s]=s;for(o=0;o<t;++o)_[o]=0;for(1===h[t-1]&&(--d[0],++_[t-1]),a=t-2;0<=a;--a){for(c=o=0,f=_[a+1],s=0;s<l[a];s++)(c=u[a+1][f]+u[a+1][f+1])>e[o]?(u[a][s]=c,v[a][s]=n,f+=2):(u[a][s]=e[o],v[a][s]=o,++o);_[a]=0,1===h[a]&&r(a)}return d}(r,r.length,n),a=0,s=t.length;a<s;++a)l[t[a].index]=o[a];return l}function T(e){var n,t,r,o,a=new(i?Uint16Array:Array)(e.length),s=[],c=[],f=0;for(n=0,t=e.length;n<t;n++)s[e[n]]=1+(0|s[e[n]]);for(n=1,t=16;n<=t;n++)c[n]=f,f+=0|s[n],f<<=1;for(n=0,t=e.length;n<t;n++)for(f=c[e[n]],c[e[n]]+=1,r=a[n]=0,o=e[n];r<o;r++)a[n]=a[n]<<1|1&f,f>>>=1;return a}function O(n,t){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=i?new Uint8Array(n):n,this.s=!1,this.n=C,this.B=!1,!t&&(t={})||(t.index&&(this.c=t.index),t.bufferSize&&(this.m=t.bufferSize),t.bufferType&&(this.n=t.bufferType),t.resize&&(this.B=t.resize)),this.n){case S:this.b=32768,this.a=new(i?Uint8Array:Array)(32768+this.m+258);break;case C:this.b=0,this.a=new(i?Uint8Array:Array)(this.m),this.f=this.J,this.t=this.H,this.o=this.I;break;default:e(Error("invalid inflate mode"))}}var S=0,C=1,M={D:S,C:C};O.prototype.p=function(){for(;!this.s;){var r=Z(this,3);switch(1&r&&(this.s=t),r>>>=1){case 0:var o=this.input,a=this.c,s=this.a,c=this.b,f=o.length,l=n,h=s.length,d=n;switch(this.e=this.g=0,a+1>=f&&e(Error("invalid uncompressed block header: LEN")),l=o[a++]|o[a++]<<8,a+1>=f&&e(Error("invalid uncompressed block header: NLEN")),l===~(o[a++]|o[a++]<<8)&&e(Error("invalid uncompressed block header: length verify")),a+l>o.length&&e(Error("input buffer is broken")),this.n){case S:for(;c+l>s.length;){if(l-=d=h-c,i)s.set(o.subarray(a,a+d),c),c+=d,a+=d;else for(;d--;)s[c++]=o[a++];this.b=c,s=this.f(),c=this.b}break;case C:for(;c+l>s.length;)s=this.f({v:2});break;default:e(Error("invalid inflate mode"))}if(i)s.set(o.subarray(a,a+l),c),c+=l,a+=l;else for(;l--;)s[c++]=o[a++];this.c=a,this.b=c,this.a=s;break;case 1:this.o(K,q);break;case 2:var u,_,m,g,x=Z(this,5)+257,p=Z(this,5)+1,A=Z(this,4)+4,y=new(i?Uint8Array:Array)(P.length),b=n,w=n,E=n,I=n,T=n;for(T=0;T<A;++T)y[P[T]]=Z(this,3);if(!i)for(T=A,A=y.length;T<A;++T)y[P[T]]=0;for(u=v(y),b=new(i?Uint8Array:Array)(x+p),T=0,g=x+p;T<g;)switch(w=Y(this,u),w){case 16:for(I=3+Z(this,2);I--;)b[T++]=E;break;case 17:for(I=3+Z(this,3);I--;)b[T++]=0;E=0;break;case 18:for(I=11+Z(this,7);I--;)b[T++]=0;E=0;break;default:E=b[T++]=w}_=v(i?b.subarray(0,x):b.slice(0,x)),m=v(i?b.subarray(x):b.slice(x)),this.o(_,m);break;default:e(Error("unknown BTYPE: "+r))}}return this.t()};var H,k,N=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=i?new Uint16Array(N):N,D=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],R=i?new Uint16Array(D):D,U=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],L=i?new Uint8Array(U):U,F=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],z=i?new Uint16Array(F):F,W=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],G=i?new Uint8Array(W):W,V=new(i?Uint8Array:Array)(288);for(H=0,k=V.length;H<k;++H)V[H]=143>=H?8:255>=H?9:279>=H?7:8;var j,X,K=v(V),B=new(i?Uint8Array:Array)(30);for(j=0,X=B.length;j<X;++j)B[j]=5;var q=v(B);function Z(n,t){for(var r,o=n.g,i=n.e,a=n.input,s=n.c,c=a.length;i<t;)s>=c&&e(Error("input buffer is broken")),o|=a[s++]<<i,i+=8;return r=o&(1<<t)-1,n.g=o>>>t,n.e=i-t,n.c=s,r}function Y(n,t){for(var r,o,i=n.g,a=n.e,s=n.input,c=n.c,f=s.length,l=t[0],h=t[1];a<h&&!(c>=f);)i|=s[c++]<<a,a+=8;return(o=(r=l[i&(1<<h)-1])>>>16)>a&&e(Error("invalid code length: "+o)),n.g=i>>o,n.e=a-o,n.c=c,65535&r}function J(e){if("string"==typeof e){var n,t,r=e.split("");for(n=0,t=r.length;n<t;n++)r[n]=(255&r[n].charCodeAt(0))>>>0;e=r}for(var o,i=1,a=0,s=e.length,c=0;0<s;){s-=o=1024<s?1024:s;do{a+=i+=e[c++]}while(--o);i%=65521,a%=65521}return(a<<16|i)>>>0}function $(n,t){var r,o;if(this.input=n,this.c=0,!t&&(t={})||(t.index&&(this.c=t.index),t.verify&&(this.M=t.verify)),r=n[this.c++],o=n[this.c++],(15&r)===Q)this.method=Q;else e(Error("unsupported compression method"));0!=((r<<8)+o)%31&&e(Error("invalid fcheck flag:"+((r<<8)+o)%31)),32&o&&e(Error("fdict flag is not supported")),this.A=new O(n,{index:this.c,bufferSize:t.bufferSize,bufferType:t.bufferType,resize:t.resize})}O.prototype.o=function(e,n){var t=this.a,r=this.b;this.u=e;for(var o,i,a,s,c=t.length-258;256!==(o=Y(this,e));)if(256>o)r>=c&&(this.b=r,t=this.f(),r=this.b),t[r++]=o;else for(s=R[i=o-257],0<L[i]&&(s+=Z(this,L[i])),o=Y(this,n),a=z[o],0<G[o]&&(a+=Z(this,G[o])),r>=c&&(this.b=r,t=this.f(),r=this.b);s--;)t[r]=t[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},O.prototype.I=function(e,n){var t=this.a,r=this.b;this.u=e;for(var o,i,a,s,c=t.length;256!==(o=Y(this,e));)if(256>o)r>=c&&(c=(t=this.f()).length),t[r++]=o;else for(s=R[i=o-257],0<L[i]&&(s+=Z(this,L[i])),o=Y(this,n),a=z[o],0<G[o]&&(a+=Z(this,G[o])),r+s>c&&(c=(t=this.f()).length);s--;)t[r]=t[r++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=r},O.prototype.f=function(){var e,n,t=new(i?Uint8Array:Array)(this.b-32768),r=this.b-32768,o=this.a;if(i)t.set(o.subarray(32768,t.length));else for(e=0,n=t.length;e<n;++e)t[e]=o[e+32768];if(this.l.push(t),this.q+=t.length,i)o.set(o.subarray(r,r+32768));else for(e=0;32768>e;++e)o[e]=o[r+e];return this.b=32768,o},O.prototype.J=function(e){var n,t,r,o=this.input.length/this.c+1|0,a=this.input,s=this.a;return e&&("number"==typeof e.v&&(o=e.v),"number"==typeof e.F&&(o+=e.F)),2>o?t=(r=(a.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+r:s.length<<1:t=s.length*o,i?(n=new Uint8Array(t)).set(s):n=s,this.a=n},O.prototype.t=function(){var e,n,t,r,o,a=0,s=this.a,c=this.l,f=new(i?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return i?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(n=0,t=c.length;n<t;++n)for(r=0,o=(e=c[n]).length;r<o;++r)f[a++]=e[r];for(n=32768,t=this.b;n<t;++n)f[a++]=s[n];return this.l=[],this.buffer=f},O.prototype.H=function(){var e,n=this.b;return i?this.B?(e=new Uint8Array(n)).set(this.a.subarray(0,n)):e=this.a.subarray(0,n):(this.a.length>n&&(this.a.length=n),e=this.a),this.buffer=e},$.prototype.p=function(){var n,t=this.input;return n=this.A.p(),this.c=this.A.c,this.M&&((t[this.c++]<<24|t[this.c++]<<16|t[this.c++]<<8|t[this.c++])>>>0!==J(n)&&e(Error("invalid adler-32 checksum"))),n};var Q=8;function ee(e,n){this.input=e,this.a=new(i?Uint8Array:Array)(32768),this.h=ne.k;var t,r={};for(t in!n&&(n={})||"number"!=typeof n.compressionType||(this.h=n.compressionType),n)r[t]=n[t];r.outputBuffer=this.a,this.z=new _(this.input,r)}var ne=x;function te(e,n){var t,r,i,a;if(Object.keys)t=Object.keys(n);else for(r in t=[],i=0,n)t[i++]=r;for(i=0,a=t.length;i<a;++i)o(e+"."+(r=t[i]),n[r])}ee.prototype.j=function(){var n,t,r,o,a,s,c,f=0;if(c=this.a,(n=Q)===Q)t=Math.LOG2E*Math.log(32768)-8;else e(Error("invalid compression method"));if(r=t<<4|n,c[f++]=r,n===Q)switch(this.h){case ne.NONE:a=0;break;case ne.r:a=1;break;case ne.k:a=2;break;default:e(Error("unsupported compression type"))}else e(Error("invalid compression method"));return o=a<<6,c[f++]=o|31-(256*r+o)%31,s=J(this.input),this.z.b=f,f=(c=this.z.j()).length,i&&((c=new Uint8Array(c.buffer)).length<=f+4&&(this.a=new Uint8Array(c.length+4),this.a.set(c),c=this.a),c=c.subarray(0,f+4)),c[f++]=s>>24&255,c[f++]=s>>16&255,c[f++]=s>>8&255,c[f++]=255&s,c},o("Zlib.Inflate",$),o("Zlib.Inflate.prototype.decompress",$.prototype.p),te("Zlib.Inflate.BufferType",{ADAPTIVE:M.C,BLOCK:M.D}),o("Zlib.Deflate",ee),o("Zlib.Deflate.compress",(function(e,n){return new ee(e,n).j()})),o("Zlib.Deflate.prototype.compress",ee.prototype.j),te("Zlib.Deflate.CompressionType",{NONE:ne.NONE,FIXED:ne.r,DYNAMIC:ne.k})}.call(self);var f="undefined"!=typeof Float32Array?Float32Array:Array;function l(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});function h(){var e=new f(3);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function d(e,n,t){var r=new f(3);return r[0]=e,r[1]=n,r[2]=t,r}function u(e,n){var t=n[0],r=n[1],o=n[2],i=t*t+r*r+o*o;return i>0&&(i=1/Math.sqrt(i)),e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}function v(e,n,t){var r=n[0],o=n[1],i=n[2],a=t[0],s=t[1],c=t[2];return e[0]=o*c-i*s,e[1]=i*a-r*c,e[2]=r*s-o*a,e}var _=function(e,n,t){return e[0]=n[0]-t[0],e[1]=n[1]-t[1],e[2]=n[2]-t[2],e};function m(){var e=new f(4);return f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}h(),function(){var e,n=(e=new f(4),f!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e)}();var g;function x(e,n,t){return e[0]=n,e[1]=t,e}h(),d(1,0,0),d(0,1,0),m(),m(),g=new f(9),f!=Float32Array&&(g[1]=0,g[2]=0,g[3]=0,g[5]=0,g[6]=0,g[7]=0),g[0]=1,g[4]=1,g[8]=1,function(){var e=function(){var e=new f(2);return f!=Float32Array&&(e[0]=0,e[1]=0),e}()}(),\n/*!\n     * @maptalks/reshader.gl v0.101.1\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.com\n     */\nl([]),l([]),new Array(16),function(){const e=new ArrayBuffer(4),n=new Float32Array(e),t=new Uint32Array(e),r=new Uint32Array(512),o=new Uint32Array(512);for(let e=0;e<256;++e){const n=e-127;n<-27?(r[e]=0,r[256|e]=32768,o[e]=24,o[256|e]=24):n<-14?(r[e]=1024>>-n-14,r[256|e]=1024>>-n-14|32768,o[e]=-n-1,o[256|e]=-n-1):n<=15?(r[e]=n+15<<10,r[256|e]=n+15<<10|32768,o[e]=13,o[256|e]=13):n<128?(r[e]=31744,r[256|e]=64512,o[e]=24,o[256|e]=24):(r[e]=31744,r[256|e]=64512,o[e]=13,o[256|e]=13)}const i=new Uint32Array(2048),a=new Uint32Array(64),s=new Uint32Array(64);for(let e=1;e<1024;++e){let n=e<<13,t=0;for(;!(8388608&n);)n<<=1,t-=8388608;n&=-8388609,t+=947912704,i[e]=n|t}for(let e=1024;e<2048;++e)i[e]=939524096+(e-1024<<13);for(let e=1;e<31;++e)a[e]=e<<23;a[31]=1199570944,a[32]=2147483648;for(let e=33;e<63;++e)a[e]=2147483648+(e-32<<23);a[63]=3347054592;for(let e=1;e<64;++e)32!==e&&(s[e]=1024)}();const p={vsm_shadow_vert:"\\nuniform mat4 shadow_lightProjViewModelMatrix;\\nvarying vec4 shadow_vLightSpacePos;\\nvoid shadow_computeShadowPars(vec4 position) {\\n    shadow_vLightSpacePos = shadow_lightProjViewModelMatrix * position;\\n}",vsm_shadow_frag:"\\nuniform sampler2D shadow_shadowMap;\\nuniform float shadow_opacity;\\nuniform vec3 shadow_color;\\n#if defined(USE_ESM)\\n    uniform float esm_shadow_threshold;\\n#endif\\nvarying vec4 shadow_vLightSpacePos;\\n#ifdef PACK_FLOAT\\n    #include <common_pack_float>\\n#endif\\n#if defined(USE_ESM)\\nfloat esm(vec3 projCoords, vec4 shadowTexel) {\\n    float compare = projCoords.z;\\n    float c = 120.0;\\n    #ifdef PACK_FLOAT\\n        float depth = common_decodeDepth(shadowTexel);\\n        if (depth >= 1.0 - 1E-6 || compare <= depth) {\\n            return 1.0;\\n        }\\n    #else\\n        float depth = shadowTexel.r;\\n    #endif\\n    depth = exp(-c * min(compare - depth, 0.05));\\n    return clamp(depth, esm_shadow_threshold, 1.0);\\n}\\n#endif\\n#if defined(USE_VSM)\\nfloat vsm_shadow_chebyshevUpperBound(vec3 projCoords, vec4 shadowTexel){\\n    vec2 moments = shadowTexel.rg;\\n    float distance = projCoords.z;\\n    if (distance >= 1.0 || distance <= moments.x)\\n        return 1.0 ;\\n    float variance = moments.y - (moments.x * moments.x);\\n    variance = max(variance, 0.00002);\\n    float d = distance - moments.x;\\n    float p_max = variance / (variance + d * d);\\n    return p_max;\\n}\\n#endif\\nfloat shadow_computeShadow_coeff(sampler2D shadowMap, vec3 projCoords) {\\n    vec2 uv = projCoords.xy;\\n    vec4 shadowTexel = texture2D(shadowMap, uv);\\n    #if defined(USE_ESM)\\n        float esm_coeff = esm(projCoords, shadowTexel);\\n        float coeff = esm_coeff * esm_coeff;\\n    #endif\\n    #if defined(USE_VSM)\\n        float vsm_coeff = vsm_shadow_chebyshevUpperBound(projCoords, shadowTexel);\\n        float coeff = vsm_coeff;\\n    #endif\\n    return 1.0 - (1.0 - coeff) * shadow_opacity;\\n}\\nfloat shadow_computeShadow() {\\n    vec3 projCoords = shadow_vLightSpacePos.xyz / shadow_vLightSpacePos.w;\\n    projCoords = projCoords * 0.5 + 0.5;\\n    if(projCoords.z >= 1.0 || projCoords.x < 0.0 || projCoords.x > 1.0 || projCoords.y < 0.0 || projCoords.y > 1.0) return 1.0;\\n    return shadow_computeShadow_coeff(shadow_shadowMap, projCoords);\\n}\\nvec3 shadow_blend(vec3 color, float coeff) {\\n    color = color * coeff + shadow_color * shadow_opacity * (1.0 - coeff);\\n    return color;\\n}",fbo_picking_vert:"\\n#ifdef ENABLE_PICKING\\n#if HAS_PICKING_ID == 1\\nattribute float aPickingId;\\n#elif HAS_PICKING_ID == 2\\nuniform float uPickingId;\\n#endif\\nvarying float vPickingId;\\nvarying float vFbo_picking_viewZ;\\nvarying float vFbo_picking_visible;\\n#endif\\nvarying float vFbo_picking_fragDepth;\\nvoid fbo_picking_setData(float viewPosZ, bool visible) {\\n    #ifdef ENABLE_PICKING\\n    #if HAS_PICKING_ID == 1\\n       vPickingId = aPickingId;\\n    #elif HAS_PICKING_ID == 2\\n        vPickingId = uPickingId;\\n    #endif\\n        vFbo_picking_viewZ = viewPosZ;\\n    #endif\\n    vFbo_picking_visible = visible ? 1.0 : 0.0;\\n    vFbo_picking_fragDepth = viewPosZ + 1.0;\\n}",common_pack_float:"const float COMMON_FLOAT_MAX =  1.70141184e38;\\nconst float COMMON_FLOAT_MIN = 1.17549435e-38;\\nfloat common_packFloat(vec4 val){\\n    vec4 scl = floor(255.0 * val + 0.5);\\n    float sgn = (scl.a < 128.0) ? 1.0 : -1.0;\\n    float exn = mod(scl.a * 2.0, 256.0) + floor(scl.b / 128.0) - 127.0;\\n    float man = 1.0 +\\n        (scl.r / 8388608.0) +\\n        (scl.g / 32768.0) +\\n        mod(scl.b, 128.0) / 128.0;\\n    return sgn * man * pow(2.0, exn);\\n}\\nvec4 common_unpackFloat(highp float v) {\\n    highp float av = abs(v);\\n    if(av < COMMON_FLOAT_MIN) {\\n        return vec4(0.0, 0.0, 0.0, 0.0);\\n    } else if(v > COMMON_FLOAT_MAX) {\\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\\n    } else if(v < -COMMON_FLOAT_MAX) {\\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\\n    }\\n    highp vec4 c = vec4(0,0,0,0);\\n    highp float e = floor(log2(av));\\n    highp float m = av * pow(2.0, -e) - 1.0;\\n    c[1] = floor(128.0 * m);\\n    m -= c[1] / 128.0;\\n    c[2] = floor(32768.0 * m);\\n    m -= c[2] / 32768.0;\\n    c[3] = floor(8388608.0 * m);\\n    highp float ebias = e + 127.0;\\n    c[0] = floor(ebias / 2.0);\\n    ebias -= c[0] * 2.0;\\n    c[1] += floor(ebias) * 128.0;\\n    c[0] += 128.0 * step(0.0, -v);\\n    return c / 255.0;\\n}\\nvec4 common_encodeDepth(const in float depth) {\\n    float alpha = 1.0;\\n    vec4 pack = vec4(0.0);\\n    pack.a = alpha;\\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\\n    pack.rgb = vec3(code * depth);\\n    pack.gb = fract(pack.gb);\\n    pack.rg -= pack.gb * (1.0 / 256.0);\\n    pack.b -= mod(pack.b, 4.0 / 255.0);\\n    return pack;\\n}\\nfloat common_decodeDepth(const in vec4 pack) {\\n    return pack.r + pack.g / 255.0;\\n}",invert_matrix:"mat4 invert_matrix(mat4 matrix) {\\n    #if __VERSION__ == 300\\n        return inverse(matrix);\\n    #else\\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\\n        float a00 = vector1.x, a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\\n        float a10 = vector2.x, a11 = vector2.y, a12 = vector2.z, a13 = vector2.w;\\n        float a20 = vector3.x, a21 = vector3.y, a22 = vector3.z, a23 = vector3.w;\\n        float a30 = vector4.x, a31 = vector4.y, a32 = vector4.z, a33 = vector4.w;\\n        float b00 = a00 * a11 - a01 * a10;\\n        float b01 = a00 * a12 - a02 * a10;\\n        float b02 = a00 * a13 - a03 * a10;\\n        float b03 = a01 * a12 - a02 * a11;\\n        float b04 = a01 * a13 - a03 * a11;\\n        float b05 = a02 * a13 - a03 * a12;\\n        float b06 = a20 * a31 - a21 * a30;\\n        float b07 = a20 * a32 - a22 * a30;\\n        float b08 = a20 * a33 - a23 * a30;\\n        float b09 = a21 * a32 - a22 * a31;\\n        float b10 = a21 * a33 - a23 * a31;\\n        float b11 = a22 * a33 - a23 * a32;\\n        float det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\\n        det = 1.0 / det;\\n        mat4 m = mat4(\\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\\n            (a20 * b03 - a21 * b01 + a22 * b00) * det\\n        );\\n        return m;\\n    #endif\\n}\\nmat4 transpose_matrix(mat4 matrix) {\\n    #if __VERSION__ == 300\\n        return transpose(matrix);\\n    #else\\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\\n        float a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\\n        float a12 = vector2.z, a13 = vector2.w;\\n        float a23 = vector3.w;\\n        mat4 m = mat4(\\n            vector1.x,\\n            vector2.x,\\n            vector3.x,\\n            vector4.x,\\n            a01,\\n            vector2.y,\\n            vector3.y,\\n            vector4.y,\\n            a02,\\n            a12,\\n            vector3.z,\\n            vector4.z,\\n            a03,\\n            a13,\\n            a23,\\n            vector4.w\\n        );\\n        return m;\\n    #endif\\n}",get_output:"#include <invert_matrix>\\n#include <draco_decode_vert>\\n#ifdef HAS_INSTANCE\\n    #include <instance_vert>\\n    #ifdef HAS_INSTANCE_COLOR\\n        varying vec4 vInstanceColor;\\n    #endif\\n#endif\\n#ifdef HAS_SKIN\\n    uniform int skinAnimation;\\n    #include <skin_vert>\\n#endif\\n#include <mask_vert>\\n#ifdef HAS_MORPH\\n    attribute vec3 POSITION0;\\n    attribute vec3 POSITION1;\\n    attribute vec3 POSITION2;\\n    attribute vec3 POSITION3;\\n    attribute vec3 POSITION4;\\n    attribute vec3 POSITION5;\\n    attribute vec3 POSITION6;\\n    attribute vec3 POSITION7;\\n    #ifdef HAS_MORPHNORMALS\\n        attribute vec3 NORMAL0;\\n        attribute vec3 NORMAL1;\\n        attribute vec3 NORMAL2;\\n        attribute vec3 NORMAL3;\\n    #endif\\n    uniform vec4 morphWeights1;\\n    uniform vec4 morphWeights2;\\n#endif\\n#ifdef HAS_TERRAIN_ALTITUDE\\nattribute float aTerrainAltitude;\\n#endif\\nmat4 getPositionMatrix() {\\n    mat4 worldMatrix;\\n    #ifdef HAS_INSTANCE\\n        #ifdef HAS_INSTANCE_COLOR\\n            vInstanceColor = instance_getInstanceColor();\\n        #endif\\n        mat4 attributeMatrix = instance_getAttributeMatrix();\\n        #ifdef HAS_SKIN\\n            if (skinAnimation == 1) {\\n                worldMatrix = attributeMatrix * positionMatrix * skin_getSkinMatrix();\\n            } else {\\n                worldMatrix = attributeMatrix * positionMatrix;\\n            }\\n        #else\\n            worldMatrix = attributeMatrix * positionMatrix;\\n        #endif\\n    #else\\n        #ifdef HAS_SKIN\\n            if (skinAnimation == 1) {\\n                worldMatrix = skin_getSkinMatrix() * positionMatrix;\\n            } else {\\n                worldMatrix = positionMatrix;\\n            }\\n        #else\\n            worldMatrix = positionMatrix;\\n        #endif\\n    #endif\\n    return worldMatrix;\\n}\\n#ifdef HAS_MIN_ALTITUDE\\nuniform float minAltitude;\\n#endif\\nvec4 getPosition(vec3 aPosition) {\\n    vec3 position = decode_getPosition(aPosition);\\n    #ifdef HAS_MORPH\\n        vec4 POSITION = vec4(position + morphWeights1[0] * POSITION0 + morphWeights1[1] * POSITION1 + morphWeights1[2] * POSITION2 + morphWeights1[3] * POSITION3\\n        + morphWeights2[0] * POSITION4 + morphWeights2[1] * POSITION5 + morphWeights2[2] * POSITION6 + morphWeights2[3] * POSITION7\\n        , 1.0);\\n    #else\\n        vec4 POSITION = vec4(position, 1.0);\\n    #endif\\n    #ifdef HAS_TERRAIN_ALTITUDE\\n        POSITION.z += aTerrainAltitude * 100.0;\\n    #endif\\n    #ifdef HAS_MIN_ALTITUDE\\n        POSITION.z += minAltitude * 100.0;\\n    #endif\\n    return POSITION;\\n}\\nvec3 appendMorphNormal(vec3 NORMAL) {\\n    #ifdef HAS_MORPHNORMALS\\n        vec3 normal = NORMAL + morphWeights1[0] * NORMAL0 + morphWeights1[1] * NORMAL1 + morphWeights1[2] * NORMAL2 + morphWeights1[3] * NORMAL3;\\n    #else\\n        vec3 normal = NORMAL;\\n    #endif\\n    return normal;\\n}",instance_vert:"attribute vec4 instance_vectorA;\\nattribute vec4 instance_vectorB;\\nattribute vec4 instance_vectorC;\\n#ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\\nattribute float aTerrainAltitude;\\nuniform float terrainAltitudeScale;\\n#endif\\nmat4 instance_getAttributeMatrix() {\\n    mat4 mat =  mat4(\\n        instance_vectorA.x, instance_vectorB.x, instance_vectorC.x, 0.0,\\n        instance_vectorA.y, instance_vectorB.y, instance_vectorC.y, 0.0,\\n        instance_vectorA.z, instance_vectorB.z, instance_vectorC.z, 0.0,\\n        instance_vectorA.w, instance_vectorB.w, instance_vectorC.w, 1.0\\n    );\\n    #ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\\n        mat4 terrainMat = mat4(\\n            1., 0., 0., 0.,\\n            0., 1., 0., 0.,\\n            0., 0., 1., 0.,\\n            0., 0., aTerrainAltitude * terrainAltitudeScale, 1.\\n        );\\n        mat = terrainMat * mat;\\n    #endif\\n    return mat;\\n}\\n#ifdef HAS_INSTANCE_HIGHLIGHT\\n    attribute vec4 highlight_color;\\n#endif\\n#ifdef HAS_INSTANCE_COLOR\\n   \\n    attribute vec4 instance_color;\\n    vec4 instance_getInstanceColor() {\\n        vec4 color = instance_color;\\n        #ifdef HAS_INSTANCE_HIGHLIGHT\\n            color = instance_color * highlight_color;\\n        #endif\\n        return color;\\n    }\\n#endif",skin_vert:"attribute vec4 WEIGHTS_0;\\nattribute vec4 JOINTS_0;\\nuniform sampler2D jointTexture;\\nuniform vec2 jointTextureSize;\\nuniform float numJoints;\\n#define ROW0_U ((0.5 + 0.0) / 4.)\\n#define ROW1_U ((0.5 + 1.0) / 4.)\\n#define ROW2_U ((0.5 + 2.0) / 4.)\\n#define ROW3_U ((0.5 + 3.0) / 4.)\\nmat4 skin_getBoneMatrix(float jointNdx) {\\n    float v = (jointNdx + 0.5) / numJoints;\\n    return mat4(\\n        texture2D(jointTexture, vec2(ROW0_U, v)),\\n        texture2D(jointTexture, vec2(ROW1_U, v)),\\n        texture2D(jointTexture, vec2(ROW2_U, v)),\\n        texture2D(jointTexture, vec2(ROW3_U, v)));\\n}\\nmat4 skin_getSkinMatrix() {\\n        mat4 skinMatrix = skin_getBoneMatrix(JOINTS_0[0]) * WEIGHTS_0[0] +\\n                        skin_getBoneMatrix(JOINTS_0[1]) * WEIGHTS_0[1] +\\n                        skin_getBoneMatrix(JOINTS_0[2]) * WEIGHTS_0[2] +\\n                        skin_getBoneMatrix(JOINTS_0[3]) * WEIGHTS_0[3];\\n        return skinMatrix;\\n}",heatmap_render_vert:"#ifdef HAS_HEATMAP\\nvarying vec2 heatmap_vTexCoord;\\nvoid heatmap_compute(mat4 matrix, vec3 position) {\\n    vec4 pos = matrix * vec4(position.xy, 0., 1.);\\n    heatmap_vTexCoord = (1. + pos.xy / pos.w) / 2.;\\n}\\n#endif",heatmap_render_frag:"#ifdef HAS_HEATMAP\\nuniform sampler2D heatmap_inputTexture;\\nuniform sampler2D heatmap_colorRamp;\\nuniform float heatmap_heatmapOpacity;\\nvarying vec2 heatmap_vTexCoord;\\nvec4 heatmap_getColor(vec4 color) {\\n    float t = texture2D(heatmap_inputTexture, heatmap_vTexCoord).r;\\n    vec4 heatmapColor = texture2D(heatmap_colorRamp, vec2(t, 0.5)) * heatmap_heatmapOpacity;\\n    return color * (1.0 - heatmapColor.a) + heatmapColor * heatmapColor.a;\\n}\\n#endif",line_extrusion_vert:"#ifdef IS_LINE_EXTRUSION\\n    #define ALTITUDE_SCALE 32767.0;\\n    #define EXTRUDE_SCALE 63.0;\\n    attribute vec2 aExtrude;\\n    #ifdef HAS_LINE_WIDTH\\n        attribute float aLineWidth;\\n    #else\\n        uniform float lineWidth;\\n    #endif\\n    #ifdef HAS_LINE_HEIGHT\\n        attribute float aLineHeight;\\n    #else\\n        uniform float lineHeight;\\n    #endif\\n    uniform float linePixelScale;\\n    vec3 getLineExtrudePosition(vec3 position) {\\n        #ifdef HAS_LINE_WIDTH\\n            float lineWidth = aLineWidth / 2.0;\\n        #endif\\n        #ifdef HAS_LINE_HEIGHT\\n            float lineHeight = aLineHeight / 10.0;\\n        #endif\\n        float halfwidth = lineWidth / 2.0;\\n        float outset = halfwidth;\\n        vec2 dist = outset * aExtrude / EXTRUDE_SCALE;\\n        position.z *= lineHeight / ALTITUDE_SCALE;\\n        return position + vec3(dist, 0.0) * linePixelScale;\\n    }\\n#endif",gl2_vert:"#if __VERSION__ == 300\\n    #define texture2D texture\\n    #define varying out\\n    #define attribute in\\n#endif",gl2_frag:"#if __VERSION__ == 300\\n    #define varying in\\n    #define gl_FragDepthEXT gl_FragDepth\\n    #define texture2D texture\\n    #define textureCube texture\\n    #define texture2DProj textureProj\\n    #define texture2DLodEXT textureLod\\n    #define texture2DProjLodEXT textureProjLod\\n    #define textureCubeLodEXT textureLod\\n    #define texture2DGradEXT textureGrad\\n    #define texture2DProjGradEXT textureProjGrad\\n    #define textureCubeGradEXT textureGrad\\n    #define texture2D texture\\n    out vec4 glFragColor;\\n#else\\n    vec4 glFragColor;\\n#endif",hsv_frag:"\\nconst mediump vec4 HSV_K0 = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\\nconst mediump vec4 HSV_K1 = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\\nconst mediump float HSV_E = 1.0e-10;\\nvec3 hsv_rgb2hsv(vec3 c) {\\n    vec4 K = HSV_K0;\\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\\n    float d = q.x - min(q.w, q.y);\\n    float e = HSV_E;\\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\\n}\\nvec3 hsv_hsv2rgb(vec3 c) {\\n    vec4 K = HSV_K1;\\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\\n}\\nvec4 hsv_apply(vec4 c, vec3 hsvOffset) {\\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\\n    hsv += hsv * hsvOffset;\\n    hsv = clamp(hsv, 0.0, 1.0);\\n    return vec4(hsv_hsv2rgb(hsv), c.a);\\n}\\nvec3 hsv_apply(vec3 c, vec3 hsvOffset) {\\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\\n    hsv += hsv * hsvOffset;\\n    hsv = clamp(hsv, 0.0, 1.0);\\n    return hsv_hsv2rgb(hsv);\\n}\\nmat4 contrastMatrix(float contrast)\\n{\\n    float t = (1.0 - contrast) / 2.0;\\n    return mat4(\\n        contrast, 0., 0., 0.,\\n        0., contrast, 0., 0.,\\n        0., 0., contrast, 0.,\\n        t, t, t, 1\\n    );\\n}",snow_frag:"#ifdef HAS_SNOW\\n    float lerp(float a, float b, float w) {\\n        return a + w * (b - a);\\n    }\\n    vec3 snow(vec4 sceneColor, vec3 normalColor, float height) {\\n        float snowIntense = normalColor.b;\\n        vec3 fixedC = vec3(1.0, 1.0, 1.0);\\n        if (height < 1.0) {\\n            float r = lerp(0.5, fixedC.x, snowIntense);\\n            float g = lerp(0.5, fixedC.y, snowIntense);\\n            float b = lerp(0.5, fixedC.z, snowIntense);\\n            return vec3(r, g, b);\\n        } else {\\n            float r = lerp(sceneColor.r, fixedC.x, snowIntense);\\n            float g = lerp(sceneColor.g, fixedC.y, snowIntense);\\n            float b = lerp(sceneColor.b, fixedC.z, snowIntense);\\n            return vec3(r, g, b);\\n        }\\n    }\\n#endif",draco_decode_vert:"#if defined(HAS_TANGENT)\\n    attribute vec4 aTangent;\\n#elif defined(HAS_NORMAL)\\n    #ifdef HAS_DRACO_NORMAL\\n        attribute vec2 aNormal;\\n        uniform float gltf_u_dec_normal_rangeConstant;\\n    #else\\n        attribute vec3 aNormal;\\n    #endif\\n#endif\\n#ifdef HAS_DRACO_POSITION\\n    uniform float gltf_u_dec_position_normConstant;\\n    uniform vec3 minValues_pos;\\n    vec3 decodeDracoPosition(vec3 aPosition) {\\n        return minValues_pos + aPosition * gltf_u_dec_position_normConstant;\\n    }\\n#endif\\n#ifdef HAS_DRACO_TEXCOORD\\n    uniform vec2 minValues_tex;\\n    uniform float gltf_u_dec_texcoord_0_normConstant;\\n    vec2 decodeDracoTexcoord(vec2 aTexCoord) {\\n        return minValues_tex + aTexCoord * gltf_u_dec_texcoord_0_normConstant;\\n    }\\n#endif\\n#ifdef HAS_WEB3D_quantized_attributes_TEXCOORD\\n    uniform mat3 decodeMatrix;\\n#endif\\n#ifdef HAS_DRACO_NORMAL\\n    float czm_signNotZero(float value) {\\n        return value >= 0.0 ? 1.0 : -1.0;\\n    }\\n    vec2 czm_signNotZero(vec2 value) {\\n        return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\\n    }\\n    vec3 decodeDracoNormal(vec2 encoded, float range)\\n    {\\n        if (encoded.x == 0.0 && encoded.y == 0.0) {\\n            return vec3(0.0, 0.0, 0.0);\\n        }\\n        encoded = encoded / range * 2.0 - 1.0;\\n        vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\\n        if (v.z < 0.0) {\\n            v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\\n        }\\n        return normalize(v);\\n    }\\n    vec3 decode_getNormal(vec2 aNormal) {\\n        return decodeDracoNormal(aNormal, gltf_u_dec_normal_rangeConstant).zxy;\\n    }\\n#endif\\n#ifdef HAS_COMPRESSED_INT16\\n    #ifdef HAS_COMPRESSED_INT16_POSITION\\n      uniform vec2 compressedPositionRange;\\n    #endif\\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_0\\n      uniform vec2 compressedTexcoordRange_0;\\n    #endif\\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_1\\n      uniform vec2 compressedTexcoordRange_1;\\n    #endif\\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\\n      uniform vec2 compressedNormalRange;\\n    #endif\\n    #ifdef HAS_COMPRESSED_INT16_RATIO\\n      uniform float compressed_ratio;\\n    #endif\\n    float int16ToFloat32(float value, vec2 range) {\\n        float v = (value >= 32768.0) ? -(65536.0 - value) / 32768.0 : value / 32767.0;\\n        return (v + 1.0) * (range.y - range.x) / 2.0 + range.x;\\n    }\\n#endif\\nvec3 decode_getPosition(vec3 aPosition) {\\n    vec3 position = aPosition;\\n    #if defined(HAS_COMPRESSED_INT16) && defined(HAS_COMPRESSED_INT16_POSITION)\\n        float x = int16ToFloat32(aPosition.x, compressedPositionRange);\\n        float y = int16ToFloat32(aPosition.y, compressedPositionRange);\\n        float z = int16ToFloat32(aPosition.z, compressedPositionRange);\\n        #ifdef HAS_COMPRESSED_INT16_RATIO\\n          position = vec3(x / compressed_ratio, y / compressed_ratio, z);\\n        #else\\n          position = vec3(x, y, z);\\n        #endif\\n    #endif\\n    #ifdef HAS_DRACO_POSITION\\n        return decodeDracoPosition(position);\\n    #else\\n        return position;\\n    #endif\\n}\\nvec2 decode_getTexcoord(vec2 aTexCoord) {\\n    vec2 texcoord = aTexCoord;\\n    #if defined(HAS_COMPRESSED_INT16) && (defined(HAS_COMPRESSED_INT16_TEXCOORD_0) || defined(HAS_COMPRESSED_INT16_TEXCOORD_1))\\n        float x = int16ToFloat32(aTexCoord.x, compressedTexcoordRange_0);\\n        float y = int16ToFloat32(aTexCoord.y, compressedTexcoordRange_0);\\n        texcoord = vec2(x, y);\\n    #endif\\n    #ifdef HAS_DRACO_TEXCOORD\\n        return decodeDracoTexcoord(texcoord);\\n    #elif defined(HAS_WEB3D_quantized_attributes_TEXCOORD)\\n        vec3 web3dTexcoord = decodeMatrix * vec3(texcoord, 1.0);\\n        return vec2(web3dTexcoord.x, web3dTexcoord.y);\\n    #else\\n        return texcoord;\\n    #endif\\n}\\nvec3 decode_getNormal(vec3 aNormal) {\\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\\n        aNormal.x = int16ToFloat32(aNormal.x, compressedNormalRange);\\n        aNormal.y = int16ToFloat32(aNormal.y, compressedNormalRange);\\n        aNormal.z = int16ToFloat32(aNormal.z, compressedNormalRange);\\n    #endif\\n    return aNormal;\\n}",highlight_vert:"#if defined(HAS_HIGHLIGHT_COLOR)\\n    attribute vec4 aHighlightColor;\\n    varying vec4 vHighlightColor;\\n#endif\\n#if defined(HAS_HIGHLIGHT_OPACITY)\\n    attribute float aHighlightOpacity;\\n    varying float vHighlightOpacity;\\n#endif\\nvoid highlight_setVarying() {\\n    #if defined(HAS_HIGHLIGHT_COLOR)\\n        vHighlightColor = aHighlightColor / 255.0;\\n    #endif\\n    #if defined(HAS_HIGHLIGHT_OPACITY)\\n        vHighlightOpacity = aHighlightOpacity / 255.0;\\n    #endif\\n}",highlight_frag:"#if defined(HAS_HIGHLIGHT_COLOR)\\n\\tvarying vec4 vHighlightColor;\\n#endif\\n#if defined(HAS_HIGHLIGHT_OPACITY)\\n    varying float vHighlightOpacity;\\n#endif\\nvec4 highlight_blendColor(vec4 color) {\\n\\tvec4 outColor;\\n\\t#if defined(HAS_HIGHLIGHT_COLOR)\\n\\t\\tcolor.rgb = color.rgb * (1.0 - vHighlightColor.a) + vHighlightColor.rgb * vHighlightColor.a;\\n\\t\\t#ifndef HAS_HIGHLIGHT_COLOR_POINT\\n        \\tcolor.a = color.a * (1.0 - vHighlightColor.a) + vHighlightColor.a;\\n        #endif\\n        outColor = color;\\n\\t#else\\n\\t\\toutColor = color;\\n\\t#endif\\n\\t#if defined(HAS_HIGHLIGHT_OPACITY)\\n\\t\\toutColor *= vHighlightOpacity;\\n\\t#endif\\n\\treturn outColor;\\n}",mask_vert:"#ifdef HAS_MASK_EXTENT\\n    uniform vec4 mask_extent;\\n    uniform sampler2D mask_colorExtent;\\n    uniform sampler2D mask_modeExtent;\\n    uniform float mask_maskMode;\\n    uniform float mask_hasFlatOut;\\n    uniform mat4 viewMatrix;\\n    uniform float mask_heightRatio;\\n    uniform float mask_heightOffset;\\n    varying vec4 vWorldPosition;\\n    varying vec2 vUVInExtent;\\n    varying float vHeightRatio;\\n    varying float vHeightOffset;\\n    const float CLIPINSIDE_MODE = 0.2;\\n    const float FLATINSIDE_MODE = 0.3;\\n    const float FLATOUTSIDE_MODE = 0.4;\\n    const float ELEVATE_MODE = 0.7;\\n    float random (vec2 st) {\\n        return fract(sin(dot(st.xy,vec2(12.9898,78.233)))*43758.5453123) * 0.1;\\n    }\\n    bool isInExtent(vec4 color) {\\n        return length(color.rgb) > 0.0;\\n    }\\n    float getFlatHeight(float maskMode, float flatHeight, float height) {\\n      if (maskMode <= ELEVATE_MODE && maskMode > 0.6) {\\n          return flatHeight + height;\\n      } else {\\n        return flatHeight;\\n      }\\n    }\\n    vec4 getNoErrorPosition(vec4 position, vec4 wPosition) {\\n      vec4 realPos = modelViewMatrix * position;      vec4 pos = viewMatrix * wPosition;      vec4 tempPos = viewMatrix * modelMatrix * position;      float deltaX = realPos.x - tempPos.x;\\n      float deltaY = realPos.y - tempPos.y;\\n      float deltaZ = realPos.z - tempPos.z;\\n      pos.x = pos.x + deltaX;\\n      pos.y = pos.y + deltaY;\\n      pos.z = pos.z + deltaZ;\\n      return pos;\\n    }\\n    vec4 getMaskPosition(vec4 position, mat4 modelMatrix) {\\n        vWorldPosition = modelMatrix * position;\\n        float w = mask_extent.z - mask_extent.x;\\n        float h = mask_extent.y - mask_extent.w;\\n        vec2 uvInExtent = vec2((vWorldPosition.x - mask_extent.x) / abs(w), 1.0 - (vWorldPosition.y - mask_extent.w) / h);\\n        vec4 extentColor = texture2D(mask_colorExtent, uvInExtent);\\n        vec3 maskOptionColor = texture2D(mask_modeExtent, uvInExtent).rgb;\\n        float maskMode = maskOptionColor.r;\\n        float flatHeight = maskOptionColor.g / mask_heightRatio + mask_heightOffset;\\n        float height = getFlatHeight(maskMode, flatHeight, vWorldPosition.z);\\n        vec4 wPosition = vec4(vWorldPosition.x, vWorldPosition.y, height, vWorldPosition.w);\\n        vUVInExtent = uvInExtent;\\n        vHeightRatio = mask_heightRatio;\\n        vHeightOffset = mask_heightOffset;\\n        if (maskMode <= FLATOUTSIDE_MODE && maskMode > FLATINSIDE_MODE) {\\n            return modelViewMatrix * position;;\\n        } else if (mask_hasFlatOut == 1.0) {\\n            return getNoErrorPosition(position, wPosition);\\n        }\\n        if (isInExtent(extentColor) == true && maskMode <= FLATINSIDE_MODE && maskMode > CLIPINSIDE_MODE) {\\n            return getNoErrorPosition(position, wPosition);\\n        } if (isInExtent(extentColor) == true && maskMode <= ELEVATE_MODE && maskMode > 0.6) {\\n            return getNoErrorPosition(position, wPosition);\\n        } else {\\n            return modelViewMatrix * position;\\n        }\\n    }\\n#endif",mask_frag:"#ifdef HAS_MASK_EXTENT\\n    uniform sampler2D mask_colorExtent;\\n    uniform sampler2D mask_modeExtent;\\n    uniform float mask_hasClipOut;\\n    varying float vHeightRatio;\\n    varying float vHeightOffset;\\n    varying vec2 vUVInExtent;\\n    varying vec4 vWorldPosition;\\n    const float CLIPINSIDE_MODE = 0.1;\\n    const float CLIPOUTSIDE_MODE = 0.2;\\n    const float FLATINSIDE_MODE = 0.3;\\n    const float FLATOUTSIDE_MODE = 0.4;\\n    const float COLOR_MODE = 0.5;\\n    const float VIDEO_MODE = 0.6;\\n    bool isInExtent(vec4 color) {\\n        return length(color.rgb) > 0.0;\\n    }\\n    vec4 setMask(vec4 glFragColor) {\\n        vec4 extentColor = texture2D(mask_colorExtent, vUVInExtent);\\n        vec4 modeColor = texture2D(mask_modeExtent, vUVInExtent);\\n        float maskMode = modeColor.r;\\n        float minHeight = modeColor.b / vHeightRatio + vHeightOffset;\\n        float maxHeight = modeColor.a / vHeightRatio + vHeightOffset;\\n        if (maskMode > CLIPINSIDE_MODE && maskMode <= CLIPOUTSIDE_MODE) {\\n            if (minHeight == 0.0 && maxHeight == 0.0) {\\n                return glFragColor;\\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\\n                return glFragColor;\\n            } else {\\n              discard;\\n            }\\n        } else if (mask_hasClipOut == 1.0) {\\n            discard;\\n        }\\n        if (isInExtent(extentColor) == true && maskMode <= CLIPINSIDE_MODE && maskMode > 0.0) {\\n            if (minHeight == 0.0 && maxHeight == 0.0) {\\n                discard;\\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\\n                discard;\\n            } else {\\n              return glFragColor;\\n            }\\n        } else if (isInExtent(extentColor) == true && maskMode <= VIDEO_MODE && maskMode > FLATOUTSIDE_MODE) {\\n            if (minHeight == 0.0 && maxHeight == 0.0) {\\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\\n            }\\n        }\\n        return glFragColor;\\n    }\\n#endif",computeTexcoord_frag:"#ifdef HAS_KHR_TEXTURE_TRANSFORM\\n    uniform vec2 khr_offset;\\n    uniform float khr_rotation;\\n    uniform vec2 khr_scale;\\n    vec2 khr_tex_transformTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) {\\n        rotation = -rotation;\\n        mat3 transform = mat3(\\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, offset.x, offset.y, 1.0);\\n        vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy;\\n        return transformedTexCoords;\\n    }\\n#endif\\nvarying highp vec2 vTexCoord;\\n#ifdef HAS_I3S_UVREGION\\n    varying vec4 vUvRegion;\\n#endif\\nvec2 computeTexCoord(vec2 texCoord) {\\n    #ifdef HAS_I3S_UVREGION\\n        vec2 atlasScale = vUvRegion.zw - vUvRegion.xy;\\n        vec2 uvAtlas = fract(texCoord) * atlasScale + vUvRegion.xy;\\n        return uvAtlas;\\n    #elif defined(HAS_KHR_TEXTURE_TRANSFORM)\\n        return khr_tex_transformTexCoord(texCoord, khr_offset, khr_rotation, khr_scale);\\n    #else\\n        return texCoord;\\n    #endif\\n}",terrain_normal_frag:"#ifdef HAS_TERRAIN_NORMAL\\n    uniform sampler2D terrainHeightTexture;\\n    uniform vec2 terrainHeightMapResolution;\\n    uniform vec2 terrainResolution;\\n    uniform float terrainHeightScale;\\n    uniform float terrainTileResolution;\\n    uniform vec4 terrainUnpackFactors;\\n    float getHeight(vec2 uv) {\\n        vec4 color = texture2D(terrainHeightTexture, uv) * 255.0;\\n        color.a = -1.0;\\n        return dot(color, terrainUnpackFactors) / 4.0;\\n    }\\n    vec3 convertTerrainHeightToNormalMap(vec2 uv) {\\n        uv.y = 1.0 - uv.y;\\n        vec2 epsilon = 1.0 / terrainHeightMapResolution;\\n        float a = getHeight(uv + vec2(-epsilon.x, -epsilon.y));\\n        float b = getHeight(uv + vec2(0, -epsilon.y));\\n        float c = getHeight(uv + vec2(epsilon.x, -epsilon.y));\\n        float d = getHeight(uv + vec2(-epsilon.x, 0));\\n        float e = getHeight(uv + vec2(epsilon.x, 0));\\n        float f = getHeight(uv + vec2(-epsilon.x, epsilon.y));\\n        float g = getHeight(uv + vec2(0, epsilon.y));\\n        float h = getHeight(uv + vec2(epsilon.x, epsilon.y));\\n        vec2 dxy = vec2(\\n            (c + e + e + h) - (a + d + d + f),\\n            (f + g + g + h) - (a + b + b + c)\\n        );\\n        return normalize(vec3(dxy / epsilon, terrainResolution ));\\n    }\\n#endif",vertex_color_vert:"#ifdef HAS_VERTEX_COLOR\\nattribute float aVertexColorType;\\nuniform vec4 vertexColorsOfType[VERTEX_TYPES_COUNT];\\nvarying vec4 vertexColor_color;\\nvoid vertexColor_update() {\\n    vertexColor_color = vertexColorsOfType[int(aVertexColorType)];\\n}\\n#endif",vertex_color_frag:"#ifdef HAS_VERTEX_COLOR\\nvarying vec4 vertexColor_color;\\nvec4 vertexColor_get() {\\n\\treturn vertexColor_color;\\n}\\n#endif",excavate_vert:"#ifdef HAS_EXCAVATE_ANALYSIS\\n  uniform vec4 excavateExtent;\\n  varying vec2 vCoordinateTexcoord;\\n  varying float vHeight;\\n  float getWorldHeight() {\\n    vec4 wPosition = modelMatrix * getPosition(aPosition);\\n    return wPosition.z;\\n  }\\n  vec2 getCoordinateTexcoord() {\\n    mat4 localPositionMatrix = getPositionMatrix();\\n    vec4 wPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\\n    float x = (wPosition.x - excavateExtent.x) / (excavateExtent.z - excavateExtent.x);\\n    float y = (wPosition.y - excavateExtent.y) / (excavateExtent.w - excavateExtent.y);\\n    return vec2(x, y);\\n  }\\n#endif",excavate_frag:"#ifdef HAS_EXCAVATE_ANALYSIS\\n  uniform sampler2D heightmap;\\n  uniform float excavateHeight;\\n  varying vec2 vCoordinateTexcoord;\\n  varying float vHeight;\\n  const vec2 range = vec2(-100.0, 1000.0);\\n  float decodeHeight(const in vec4 pack) {\\n      return pack.r + pack.g / 255.0;\\n  }\\n  vec4 excavateColor(vec4 fragColor) {\\n      float samplerHeight = decodeHeight(texture2D(heightmap, vCoordinateTexcoord));\\n      float realHeight = samplerHeight * (range.y - range.x) + range.x;\\n      if(realHeight < range.x || realHeight > range.y) {\\n          realHeight = 0.0;\\n      }\\n      if(vHeight > realHeight) {\\n          discard;\\n      }\\n      return fragColor;\\n  }\\n#endif",srgb_frag:"vec3 linearTosRGB(const in vec3 color) {\\n    return vec3( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055);\\n}\\nvec3 sRGBToLinear(const in vec3 color) {\\n    return vec3( color.r < 0.04045 ? color.r * (1.0 / 12.92) : pow((color.r + 0.055) * (1.0 / 1.055), 2.4), color.g < 0.04045 ? color.g * (1.0 / 12.92) : pow((color.g + 0.055) * (1.0 / 1.055), 2.4), color.b < 0.04045 ? color.b * (1.0 / 12.92) : pow((color.b + 0.055) * (1.0 / 1.055), 2.4));\\n}"};var A={register(e,n){if(p[e])throw new Error(\`Key of ${AE}e} is already registered in ShaderLib.\`);p[e]=n},compile:e=>b(e)};const y=/^[ \\t]*#include +<([\\w\\d.]+)>/gm;function b(e){return e.replace(y,w)}function w(e,n){const t=p[n];if(!t)throw new Error("Can not resolve #include <"+n+">");return b(t)}const E=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],I=E.length,T=[0,0];for(let e=0;e<E.length;e++)T[0]+=E[e][0],T[1]+=E[e][1];T[0]/=I,T[1]/=I;!function(e,n,t){var r=n[0],o=n[1],i=n[2],a=n[3],s=r+r,c=o+o,f=i+i,l=r*s,h=r*c,d=r*f,u=o*c,v=o*f,_=i*f,m=a*s,g=a*c,x=a*f;e[0]=1-(u+_),e[1]=h+x,e[2]=d-g,e[3]=0,e[4]=h-x,e[5]=1-(l+_),e[6]=v+m,e[7]=0,e[8]=d+g,e[9]=v-m,e[10]=1-(l+u),e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1}([],function(e,n,t,r){var o=.5*Math.PI/180;n*=o,t*=o,r*=o;var i=Math.sin(n),a=Math.cos(n),s=Math.sin(t),c=Math.cos(t),f=Math.sin(r),l=Math.cos(r);return e[0]=i*c*l-a*s*f,e[1]=a*s*l+i*c*f,e[2]=a*c*f-i*s*l,e[3]=a*c*l+i*s*f,e}([],90,0,0),[0,0,0]),function(){const e=[0,0,0],n=90*Math.PI/180,t=[0,0,0,0],r=new Array(16)}(),A.compile("#define SHADER_NAME SKYBOX\\n#if __VERSION__ == 100\\n#ifdef GL_EXT_shader_texture_lod\\n#extension GL_EXT_shader_texture_lod : enable\\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\\n#else\\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\\n#endif\\n#else\\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\\n#endif\\nprecision highp float;\\n#define saturate(x)        clamp(x, 0.0, 1.0)\\n#include <gl2_frag>\\n#include <hsv_frag>\\nuniform vec3 hsv;\\nvarying vec3 vWorldPos;\\n#ifdef USE_AMBIENT\\nuniform vec3 diffuseSPH[9];\\n#else\\nuniform samplerCube cubeMap;\\nuniform float bias;\\nuniform float size;\\n#endif\\nuniform float environmentExposure;\\nuniform float backgroundIntensity;\\nvec4 c(const in samplerCube d, const in vec3 e, const in float f, const in float h) {\\n  vec3 i = e;\\n  return textureCubeLod(d, i, h);\\n}\\nvec3 j(const in vec3 k, const in vec3 l[9]) {\\n  float x = k.x;\\n  float y = k.y;\\n  float z = k.z;\\n  vec3 m = (l[0] + l[1] * x + l[2] * y + l[3] * z + l[4] * z * x + l[5] * y * z + l[6] * y * x + l[7] * (3. * z * z - 1.) + l[8] * (x * x - y * y));\\n  return max(m, vec3(.0));\\n}\\nfloat n(const in vec2 o) {\\n  vec3 u = fract(vec3(o.xyx) * .1031);\\n  u += dot(u, u.yzx + 19.19);\\n  return fract((u.x + u.y) * u.z);\\n}\\n#if defined(TONE_MAPPING)\\nconst float v = 1.;\\nvec3 A(vec3 B) {\\n  vec3 a = B * (B + .0245786) - .000090537;\\n  vec3 b = B * (.983729 * B + .4329510) + .238081;\\n  return a / b;\\n}\\nvec3 C(vec3 D) {\\n  const mat3 E = mat3(vec3(.59719, .07600, .02840), vec3(.35458, .90834, .13383), vec3(.04823, .01566, .83777));\\n  const mat3 F = mat3(vec3(1.60475, -.10208, -.00327), vec3(-.53108, 1.10813, -.07276), vec3(-.07367, -.00605, 1.07602));\\n  D *= v / .6;\\n  D = E * D;\\n  D = A(D);\\n  D = F * D;\\n  return saturate(D);\\n}\\nvec3 G(vec3 D) {\\n  return C(D);\\n}\\nvec4 H(in vec4 I) {\\n  return vec4(mix(pow(I.rgb, vec3(.41666)) * 1.055 - vec3(.055), I.rgb * 12.92, vec3(lessThanEqual(I.rgb, vec3(.0031308)))), I.a);\\n}\\nvec4 J(vec4 I) {\\n  return (H(I));\\n}\\n#endif\\nvoid main() {\\n  vec4 K;\\n#ifdef USE_AMBIENT\\nvec3 k = normalize(vWorldPos + mix(-.5 / 255., .5 / 255., n(gl_FragCoord.xy)) * 2.);\\n  K = vec4(j(k, diffuseSPH), 1.);\\n#else\\nK = c(cubeMap, vWorldPos, size, bias);\\n#endif\\nK.rgb *= environmentExposure;\\n  K.rgb *= backgroundIntensity;\\n  glFragColor = K;\\n  if(length(hsv) > .0) {\\n    glFragColor.rgb = hsv_apply(clamp(glFragColor.rgb, .0, 1.), hsv);\\n  }\\n#if defined(TONE_MAPPING)\\nglFragColor.rgb = G(glFragColor.rgb);\\n  glFragColor = J(glFragColor);\\n#endif\\n#if __VERSION__ == 100\\ngl_FragColor = glFragColor;\\n#endif\\n}"),function(){const e=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1]],n=new Array(16)}(),function(){let e=new Array(4);const n=new Array(3),t=[0,0,0,0],r=[0,1,0],o=new Array(3);let i=new Array(16),a=new Array(16);const s=new Array(16),c=[1,1,1],f=[0,0,0]}();const O=new Uint8Array(4);new Float32Array(O.buffer);var S={exports:{}};function C(e,n,t){t=t||2;var r,o,i,a,s,c,f,l=n&&n.length,h=l?n[0]*t:e.length,d=M(e,0,h,t,!0),u=[];if(!d||d.next===d.prev)return u;if(l&&(d=function(e,n,t,r){var o,i,a,s=[];for(o=0,i=n.length;o<i;o++)(a=M(e,n[o]*r,o<i-1?n[o+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(W(a));for(s.sort(U),o=0;o<s.length;o++)t=L(s[o],t);return t}(e,n,d,t)),e.length>80*t){r=i=e[0],o=a=e[1];for(var v=t;v<h;v+=t)(s=e[v])<r&&(r=s),(c=e[v+1])<o&&(o=c),s>i&&(i=s),c>a&&(a=c);f=0!==(f=Math.max(i-r,a-o))?32767/f:0}return k(d,u,t,r,o,f,0),u}function M(e,n,t,r,o){var i,a;if(o===ee(e,n,t,r)>0)for(i=n;i<t;i+=r)a=J(i,e[i],e[i+1],a);else for(i=t-r;i>=n;i-=r)a=J(i,e[i],e[i+1],a);return a&&X(a,a.next)&&($(a),a=a.next),a}function H(e,n){if(!e)return e;n||(n=e);var t,r=e;do{if(t=!1,r.steiner||!X(r,r.next)&&0!==j(r.prev,r,r.next))r=r.next;else{if($(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function k(e,n,t,r,o,i,a){if(e){!a&&i&&function(e,n,t,r){var o=e;do{0===o.z&&(o.z=z(o.x,o.y,n,t,r)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==e);o.prevZ.nextZ=null,o.prevZ=null,function(e){var n,t,r,o,i,a,s,c,f=1;do{for(t=e,e=null,i=null,a=0;t;){for(a++,r=t,s=0,n=0;n<f&&(s++,r=r.nextZ);n++);for(c=f;s>0||c>0&&r;)0!==s&&(0===c||!r||t.z<=r.z)?(o=t,t=t.nextZ,s--):(o=r,r=r.nextZ,c--),i?i.nextZ=o:e=o,o.prevZ=i,i=o;t=r}i.nextZ=null,f*=2}while(a>1)}(o)}(e,r,o,i);for(var s,c,f=e;e.prev!==e.next;)if(s=e.prev,c=e.next,i?P(e,r,o,i):N(e))n.push(s.i/t|0),n.push(e.i/t|0),n.push(c.i/t|0),$(e),e=c.next,f=c.next;else if((e=c)===f){a?1===a?k(e=D(H(e),n,t),n,t,r,o,i,2):2===a&&R(e,n,t,r,o,i):k(H(e),n,t,r,o,i,1);break}}}function N(e){var n=e.prev,t=e,r=e.next;if(j(n,t,r)>=0)return!1;for(var o=n.x,i=t.x,a=r.x,s=n.y,c=t.y,f=r.y,l=o<i?o<a?o:a:i<a?i:a,h=s<c?s<f?s:f:c<f?c:f,d=o>i?o>a?o:a:i>a?i:a,u=s>c?s>f?s:f:c>f?c:f,v=r.next;v!==n;){if(v.x>=l&&v.x<=d&&v.y>=h&&v.y<=u&&G(o,s,i,c,a,f,v.x,v.y)&&j(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function P(e,n,t,r){var o=e.prev,i=e,a=e.next;if(j(o,i,a)>=0)return!1;for(var s=o.x,c=i.x,f=a.x,l=o.y,h=i.y,d=a.y,u=s<c?s<f?s:f:c<f?c:f,v=l<h?l<d?l:d:h<d?h:d,_=s>c?s>f?s:f:c>f?c:f,m=l>h?l>d?l:d:h>d?h:d,g=z(u,v,n,t,r),x=z(_,m,n,t,r),p=e.prevZ,A=e.nextZ;p&&p.z>=g&&A&&A.z<=x;){if(p.x>=u&&p.x<=_&&p.y>=v&&p.y<=m&&p!==o&&p!==a&&G(s,l,c,h,f,d,p.x,p.y)&&j(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,A.x>=u&&A.x<=_&&A.y>=v&&A.y<=m&&A!==o&&A!==a&&G(s,l,c,h,f,d,A.x,A.y)&&j(A.prev,A,A.next)>=0)return!1;A=A.nextZ}for(;p&&p.z>=g;){if(p.x>=u&&p.x<=_&&p.y>=v&&p.y<=m&&p!==o&&p!==a&&G(s,l,c,h,f,d,p.x,p.y)&&j(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;A&&A.z<=x;){if(A.x>=u&&A.x<=_&&A.y>=v&&A.y<=m&&A!==o&&A!==a&&G(s,l,c,h,f,d,A.x,A.y)&&j(A.prev,A,A.next)>=0)return!1;A=A.nextZ}return!0}function D(e,n,t){var r=e;do{var o=r.prev,i=r.next.next;!X(o,i)&&K(o,r,r.next,i)&&Z(o,i)&&Z(i,o)&&(n.push(o.i/t|0),n.push(r.i/t|0),n.push(i.i/t|0),$(r),$(r.next),r=e=i),r=r.next}while(r!==e);return H(r)}function R(e,n,t,r,o,i){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&V(a,s)){var c=Y(a,s);return a=H(a,a.next),c=H(c,c.next),k(a,n,t,r,o,i,0),void k(c,n,t,r,o,i,0)}s=s.next}a=a.next}while(a!==e)}function U(e,n){return e.x-n.x}function L(e,n){var t=function(e,n){var t,r=n,o=e.x,i=e.y,a=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=o&&s>a&&(a=s,t=r.x<r.next.x?r:r.next,s===o))return t}r=r.next}while(r!==n);if(!t)return null;var c,f=t,l=t.x,h=t.y,d=1/0;r=t;do{o>=r.x&&r.x>=l&&o!==r.x&&G(i<h?o:a,i,l,h,i<h?a:o,i,r.x,r.y)&&(c=Math.abs(i-r.y)/(o-r.x),Z(r,e)&&(c<d||c===d&&(r.x>t.x||r.x===t.x&&F(t,r)))&&(t=r,d=c)),r=r.next}while(r!==f);return t}(e,n);if(!t)return n;var r=Y(t,e);return H(r,r.next),H(t,t.next)}function F(e,n){return j(e.prev,e,n.prev)<0&&j(n.next,e,e.next)<0}function z(e,n,t,r,o){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-t)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*o|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function W(e){var n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function G(e,n,t,r,o,i,a,s){return(o-a)*(n-s)>=(e-a)*(i-s)&&(e-a)*(r-s)>=(t-a)*(n-s)&&(t-a)*(i-s)>=(o-a)*(r-s)}function V(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!function(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&K(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}(e,n)&&(Z(e,n)&&Z(n,e)&&function(e,n){var t=e,r=!1,o=(e.x+n.x)/2,i=(e.y+n.y)/2;do{t.y>i!=t.next.y>i&&t.next.y!==t.y&&o<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==e);return r}(e,n)&&(j(e.prev,e,n.prev)||j(e,n.prev,n))||X(e,n)&&j(e.prev,e,e.next)>0&&j(n.prev,n,n.next)>0)}function j(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function X(e,n){return e.x===n.x&&e.y===n.y}function K(e,n,t,r){var o=q(j(e,n,t)),i=q(j(e,n,r)),a=q(j(t,r,e)),s=q(j(t,r,n));return o!==i&&a!==s||!(0!==o||!B(e,t,n))||!(0!==i||!B(e,r,n))||!(0!==a||!B(t,e,r))||!(0!==s||!B(t,n,r))}function B(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function q(e){return e>0?1:e<0?-1:0}function Z(e,n){return j(e.prev,e,e.next)<0?j(e,n,e.next)>=0&&j(e,e.prev,n)>=0:j(e,n,e.prev)<0||j(e,e.next,n)<0}function Y(e,n){var t=new Q(e.i,e.x,e.y),r=new Q(n.i,n.x,n.y),o=e.next,i=n.prev;return e.next=n,n.prev=e,t.next=o,o.prev=t,r.next=t,t.prev=r,i.next=r,r.prev=i,r}function J(e,n,t,r){var o=new Q(e,n,t);return r?(o.next=r.next,o.prev=r,r.next.prev=o,r.next=o):(o.prev=o,o.next=o),o}function $(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Q(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ee(e,n,t,r){for(var o=0,i=n,a=t-r;i<t;i+=r)o+=(e[a]-e[i])*(e[i+1]+e[a+1]),a=i;return o}S.exports=C,S.exports.default=C,C.deviation=function(e,n,t,r){var o=n&&n.length,i=Math.abs(ee(e,0,o?n[0]*t:e.length,t));if(o)for(var a=0,s=n.length;a<s;a++)i-=Math.abs(ee(e,n[a]*t,a<s-1?n[a+1]*t:e.length,t));var c=0;for(a=0;a<r.length;a+=3){var f=r[a]*t,l=r[a+1]*t,h=r[a+2]*t;c+=Math.abs((e[f]-e[h])*(e[l+1]-e[f+1])-(e[f]-e[l])*(e[h+1]-e[f+1]))}return 0===i&&0===c?0:Math.abs((c-i)/i)},C.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},r=0,o=0;o<e.length;o++){for(var i=0;i<e[o].length;i++)for(var a=0;a<n;a++)t.vertices.push(e[o][i][a]);o>0&&t.holes.push(r+=e[o-1].length)}return t},function(e){e&&e.T&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default}(S.exports);class ne{constructor(e=257){this.gridSize=e;const n=e-1;if(n&n-1)throw new Error(\`Expected grid size to be 2^n+1, got ${AE}e}.\`);this.numTriangles=n*n*2-2,this.numParentTriangles=this.numTriangles-n*n,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let e=0;e<this.numTriangles;e++){let t=e+2,r=0,o=0,i=0,a=0,s=0,c=0;for(1&t?i=a=s=n:r=o=c=n;(t>>=1)>1;){const e=r+i>>1,n=o+a>>1;1&t?(i=r,a=o,r=s,o=c):(r=i,o=a,i=s,a=c),s=e,c=n}const f=4*e;this.coords[f+0]=r,this.coords[f+1]=o,this.coords[f+2]=i,this.coords[f+3]=a}}createTile(e){return new te(e,this)}}class te{constructor(e,n){const t=n.gridSize;if(e.length!==t*t)throw new Error(\`Expected terrain data of length ${AE}t*t} (${AE}t} x ${AE}t}), got ${AE}e.length}.\`);this.terrain=e,this.martini=n,this.errors=new Float32Array(e.length),this.update()}update(){const{numTriangles:e,numParentTriangles:n,coords:t,gridSize:r}=this.martini,{terrain:o,errors:i}=this;for(let a=e-1;a>=0;a--){const e=4*a,s=t[e+0],c=t[e+1],f=t[e+2],l=t[e+3],h=s+f>>1,d=c+l>>1,u=h+d-c,v=d+s-h,_=(o[c*r+s]+o[l*r+f])/2,m=d*r+h,g=Math.abs(_-o[m]);if(i[m]=Math.max(i[m],g),a<n){const e=(c+v>>1)*r+(s+u>>1),n=(l+v>>1)*r+(f+u>>1);i[m]=Math.max(i[m],i[e],i[n])}}}getMesh(e=0){const{gridSize:n,indices:t}=this.martini,{errors:r}=this;let o=0,i=0;const a=n-1;function s(a,c,f,l,h,d){const u=a+f>>1,v=c+l>>1;Math.abs(a-h)+Math.abs(c-d)>1&&r[v*n+u]>e?(s(h,d,a,c,u,v),s(f,l,h,d,u,v)):(t[c*n+a]=t[c*n+a]||++o,t[l*n+f]=t[l*n+f]||++o,t[d*n+h]=t[d*n+h]||++o,i++)}t.fill(0),s(0,0,a,a,a,0),s(a,a,0,0,0,a);const c=new Uint16Array(2*o),f=new Uint32Array(3*i);let l=0;function h(o,i,a,s,d,u){const v=o+a>>1,_=i+s>>1;if(Math.abs(o-d)+Math.abs(i-u)>1&&r[_*n+v]>e)h(d,u,o,i,v,_),h(a,s,d,u,v,_);else{const e=t[i*n+o]-1,r=t[s*n+a]-1,h=t[u*n+d]-1;c[2*e]=o,c[2*e+1]=i,c[2*r]=a,c[2*r+1]=s,c[2*h]=d,c[2*h+1]=u,f[l++]=e,f[l++]=r,f[l++]=h}}return h(0,0,a,a,a,0),h(a,a,0,0,0,a),{vertices:c,triangles:f}}getMeshWithSkirts(e=0,n){const{gridSize:t,indices:r}=this.martini,{errors:o}=this;let i=0,a=0;const s=t-1;let c,f,l=0;const h=[],d=[],u=[],v=[];function _(n,m,g,x,p,A){const y=n+g>>1,b=m+x>>1;Math.abs(n-p)+Math.abs(m-A)>1&&o[b*t+y]>e?(_(p,A,n,m,y,b),_(g,x,p,A,y,b)):(c=m*t+n,f=x*t+g,l=A*t+p,0===r[c]&&(0===n?h.push(i):n===s&&d.push(i),0===m?u.push(i):m===s&&v.push(i),r[c]=++i),0===r[f]&&(0===g?h.push(i):g===s&&d.push(i),0===x?u.push(i):x===s&&v.push(i),r[f]=++i),0===r[l]&&(0===p?h.push(i):p===s&&d.push(i),0===A?u.push(i):A===s&&v.push(i),r[l]=++i),a++)}let m;r.fill(0),_(0,0,s,s,s,0),_(s,s,0,0,0,s),m=n?2*(i+3*h.length-2+3*d.length-2+3*u.length-2+3*v.length-2):2*(i+h.length+d.length+u.length+v.length);const g=3*(a+2*(h.length-1)+2*(d.length-1)+2*(u.length-1)+2*(v.length-1)),x=new Uint16Array(m),p=new Uint32Array(g);let A=0;function y(n,i,a,s,c,f){const l=n+a>>1,h=i+s>>1;if(Math.abs(n-c)+Math.abs(i-f)>1&&o[h*t+l]>e)y(c,f,n,i,l,h),y(a,s,c,f,l,h);else{const e=r[i*t+n]-1,o=r[s*t+a]-1,l=r[f*t+c]-1;x[2*e]=n,x[2*e+1]=i,x[2*o]=a,x[2*o+1]=s,x[2*l]=c,x[2*l+1]=f,p[A++]=e,p[A++]=o,p[A++]=l}}y(0,0,s,s,s,0),y(s,s,0,0,0,s),h.sort(((e,n)=>x[2*e+1]-x[2*n+1])),d.sort(((e,n)=>x[2*n+1]-x[2*e+1])),u.sort(((e,n)=>x[2*n]-x[2*e])),v.sort(((e,n)=>x[2*e]-x[2*n]));let b,w,E,I,T=2*i,O=0;function S(e){O=e.length;for(let t=0;t<O-1;t++)b=e[t],w=e[t+1],E=T/2,I=(T+(n?6:2))/2,x[T++]=2*b,x[T++]=2*b+1,n&&(x[T++]=2*b,x[T++]=2*b+1,x[T++]=2*w,x[T++]=2*w+1),n?(p[A++]=E+1,p[A++]=E,p[A++]=E+2,p[A++]=E,p[A++]=I,p[A++]=E+2):(p[A++]=b,p[A++]=E,p[A++]=w,p[A++]=E,p[A++]=I,p[A++]=w);x[T++]=2*e[O-1],x[T++]=2*e[O-1]+1}S(h);const C=T;S(d);const M=T;S(u);const H=T;S(v);return{vertices:x,triangles:p,numVerticesWithoutSkirts:i,numTrianglesWithoutSkirts:a,leftSkirtIndex:C,rightSkirtIndex:M,bottomSkirtIndex:H,topSkirtIndex:T}}}const re={};let oe;const ie={width:100,height:10};let ae,se=!1;try{const e=new OffscreenCanvas(1,1);e.getContext("2d").fillText("hello",0,0),se=!0}catch(e){se=!1}function ce(){if(!oe){const{width:e,height:n}=ie;se?oe=new OffscreenCanvas(e,n):(oe=document.createElement("canvas"),oe.width=e,oe.height=n)}return oe}class fe{constructor(e,n={}){if(!Array.isArray(e))return void console.error("colors is not array");if(e.length<2)return void console.error("colors.length should >1");this.colors=e;let t=1/0,r=-1/0;for(let n=0,o=e.length;n<o;n++){const o=e[n][0];t=Math.min(o,t),r=Math.max(o,r)}this.min=t,this.max=r,this.valueOffset=this.max-this.min,this.options=Object.assign({},ie,n),this.O()}getImageData(){return this.imgData}O(){const e=ce(),{width:n,height:t}=this.options;e.width=n,e.height=t;const r=e.getContext("2d");r.clearRect(0,0,e.width,e.height);const o=r.createLinearGradient(0,0,e.width,0),{colors:i,valueOffset:a}=this;for(let e=0,n=i.length;e<n;e++){const[n,t]=i[e],r=(n-this.min)/a;o.addColorStop(r,t)}r.fillStyle=o,r.fillRect(0,0,e.width,e.height),this.imgData=r.getImageData(0,0,e.width,e.height)}getColor(e){e=Math.max(this.min,e);const n=((e=Math.min(e,this.max))-this.min)/this.valueOffset;let t=Math.round(n*this.imgData.width);t=Math.min(t,this.imgData.width-1);const r=4*t;return[this.imgData.data[r],this.imgData.data[r+1],this.imgData.data[r+2],this.imgData.data[r+3]]}}let le=null,he=null;const de=[0,0,0],ue=[256,256];function ve(){try{le||(le=new OffscreenCanvas(1,1))}catch(e){console.error(e)}}const _e={},me={},ge={width:64,height:64,elementsPerHeight:3,heightOffset:-1e3,exaggeration:1,heightScale:.001,elementMultiplier:256,stride:4,skirtHeight:.002,skirtOffset:.01},xe={cesium_request_token:{Accept:"application/json,*/*;q=0.01","Accept-Encoding":"gzip, deflate, br"},tianditu:{"Accept-Encoding":"gzip, deflate, br"},cesium:{"Accept-Encoding":"gzip, deflate, br",Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"},mapbox:{Accept:"image/webp,*/*"}};xe["cesium-ion"]=xe.cesium;const pe=32767;let Ae=null,ye=null;function be(e,n){const t=function(e){if(e.length<1e3)return null;const n=new Zlib.Inflate(e);return n?n.decompress():null}(new Uint8Array(e));if(!t)throw new Error((r=new Uint8Array(e),we.decode(r)));var r;const o=function(e){const n=e,t=ge.width,r=ge.height,o=new Uint8Array(t*r*ge.stride);let i,a,s,c,f;for(let e=0;e<r;e++)for(let l=0;l<t;l++){c=parseInt(149*e/(r-1)),f=parseInt(149*l/(t-1)),a=2*(150*c+f),i=n[a]+256*n[a+1],(i>1e4||i<-2e3)&&(i=0),s=4*(e*t+l);const h=(i+1e3)/ge.heightScale,d=ge.elementMultiplier;o[s]=h/(d*d),o[s+1]=(h-o[s]*d*d)/d,o[s+2]=h-o[s]*d*d-o[s+1]*d,o[s+3]=255}return o}(t),i=function(e,n){const t=n,r=n,o=t+1,i=r+1,a=ge.elementsPerHeight,s=ge.heightOffset,c=ge.heightScale,f=ge.elementMultiplier,l=ge.skirtHeight,h=new Float32Array(o*i);let d=0,u=1/0,v=-1/0;for(let n=0;n<o;n++){const o=n>=r?r-1:n;for(let n=0;n<i;n++){let r=0;const i=o*(4*t)+4*(n>=t?t-1:n);for(let n=0;n<a;n++)r=r*f+e[i+n];r=1*(r*c+s),r-=l,h[d]=r,r<u&&(u=r),r>v&&(v=r),d++}}return{data:h,min:u,max:v}}(o,n-1);return i.width=i.height=n,i}const we=new TextDecoder("utf-8");function Ee(e){return e>>1^-(1&e)}const Ie=[];function Te(e){let n=0;const t=3*Float64Array.BYTES_PER_ELEMENT,r=3*Uint16Array.BYTES_PER_ELEMENT;let o=Uint16Array.BYTES_PER_ELEMENT;const i=new DataView(e);n+=t;const a=i.getFloat32(n,!0);n+=Float32Array.BYTES_PER_ELEMENT;const s=i.getFloat32(n,!0);n+=Float32Array.BYTES_PER_ELEMENT,n+=t;const c=i.getFloat64(n,!0);n+=Float64Array.BYTES_PER_ELEMENT,n+=t;const f=i.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;const l=new Uint16Array(e,n,3*f);n+=f*r,f>65536&&(o=Uint32Array.BYTES_PER_ELEMENT);!function(e,n,t){const r=e.length;let o=0,i=0,a=0;for(let s=0;s<r;++s)o+=Ee(e[s]),i+=Ee(n[s]),e[s]=o,n[s]=i,t&&(a+=Ee(t[s]),t[s]=a)}(l.subarray(0,f),l.subarray(f,2*f),l.subarray(2*f,3*f)),n%o!=0&&(n+=o-n%o);const h=i.getUint32(n,!0);n+=Uint32Array.BYTES_PER_ELEMENT;const d=f>65536?new Uint32Array(e,n,3*h):new Uint16Array(e,n,3*h);let u=0;const v=d.length;for(let e=0;e<v;++e){const n=d[e];d[e]=u-n,0===n&&++u}const _={minimumHeight:a,maximumHeight:s,quantizedVertices:l,indices:d}.quantizedVertices,m=_.length/3,g=_.subarray(0,m),x=_.subarray(m,2*m),p=_.subarray(2*m,3*m),A=Ie;for(let e=0;e<m;++e){const n=g[e],t=x[e],r=n/pe,o=t/pe,i=(y=a,b=s,(1-(w=p[e]/pe))*y+w*b);A[3*e]=r,A[3*e+1]=1-o,A[3*e+2]=i}var y,b,w;return{positions:A,radius:c,min:a,max:s,indices:d}}const Oe=[],Se=[],Ce=[],Me=[],He=[];class ke{constructor(e,n,t,r,o){this.p0=[],this.p1=[],this.p2=[],this.normal=[],this.min=[],this.max=[],this.set(e,n,t,r,o)}set(e,n,t,r,o){this.radius=o;let i=3*n,a=3*n+1,s=3*n+2;this.p0[0]=e[i]*o,this.p0[1]=e[a]*o,this.p0[2]=e[s],i=3*t,a=3*t+1,s=3*t+2,this.p1[0]=e[i]*o,this.p1[1]=e[a]*o,this.p1[2]=e[s],i=3*r,a=3*r+1,s=3*r+2,this.p2[0]=e[i]*o,this.p2[1]=e[a]*o,this.p2[2]=e[s],this.min[0]=Math.min(this.p0[0],this.p1[0],this.p2[0]),this.min[1]=Math.min(this.p0[1],this.p1[1],this.p2[1]),this.max[0]=Math.max(this.p0[0],this.p1[0],this.p2[0]),this.max[1]=Math.max(this.p0[1],this.p1[1],this.p2[1]);const c=_(Oe,this.p1,this.p0),f=_(Se,this.p2,this.p1);this.normal=u(this.normal,v(this.normal,c,f))}contains(e,n){if(e<this.min[0]||e>this.max[0]||n<this.min[1]||n>this.max[1])return!1;x(Ce,this.p0[0],this.p0[1]),x(Me,this.p1[0],this.p1[1]),x(He,this.p2[0],this.p2[1]);const t=Re(Ce[0],Ce[1],Me[0],Me[1],He[0],He[1]);return Re(e,n,Ce[0],Ce[1],He[0],He[1])+Re(e,n,Ce[0],Ce[1],Me[0],Me[1])+Re(e,n,Me[0],Me[1],He[0],He[1])-t<=1e-4}getHeight(e,n){const t=this.normal;return this.p0[2]-((e-this.p0[0])*t[0]+(n-this.p0[1])*t[1])/t[2]}}let Ne=null;function Pe(e,n,t){if(Ne&&Ne.contains(n,t))return Ne.getHeight(n,t);for(let r=0;r<e.length;r++)if(e[r].contains(n,t))return Ne=e[r],e[r].getHeight(n,t);return 0}const De=[];function Re(e,n,t,r,o,i){return.5*Math.abs(e*r+t*i+o*n-e*i-t*n-o*r)}function Ue(e,n,t,r,o,i){"cesium-ion"===t&&(n.Authorization="Bearer "+Ae),function(e,n,t){const r={method:"GET",referrer:t,headers:n},o=c.getArrayBuffer(e,r),i=o.xhr;return me[e]=i,o.then((n=>(delete me[e],n)))}(e,n,origin).then((e=>{if(!e||e.message)i(e?{empty:!0,originalError:e}:{error:{canceled:!0}});else{const n=e.data;let a=null;if("tianditu"===t){const e=be(n,r);Fe(o,e,r,null,!0,i)}else if("cesium-ion"===t||"cesium"===t){a=Te(n);const e=function(e,n){const{positions:t,min:r,max:o,indices:i,radius:a}=e,s=[];let c=0;for(let e=0;e<i.length;e+=3){let n=De[c];n?n.set(t,i[e],i[e+1],i[e+2],2*a):n=De[c]=new ke(t,i[e],i[e+1],i[e+2],2*a),c++,s.push(n)}const f=new Float32Array(n*n);c=0;for(let e=0;e<n;e++)for(let t=0;t<n;t++)f[c++]=Pe(s,t/n*a*2,e/n*a*2);return{data:f,min:r,max:o,width:n,height:n}}(a,r);Fe(o,e,r,null,!0,i)}else"mapbox"===t&&(a=function(e){const n=new self.Blob([new Uint8Array(e)]);return self.createImageBitmap(n)}(n),a.then((e=>{const n=function(e){const{width:n,height:t}=e;le||(le=new OffscreenCanvas(1,1),he=le.getContext("2d",{willReadFrequently:!0}));return le.width=n,le.height=t,he.drawImage(e,0,0,n,t),he.getImageData(0,0,n,t)}(e),t=function(e,n){const{data:t,width:r}=e;let o=1/0,i=-1/0;const a=new Float32Array(n*n),s=Math.round(r/n);for(let e=0;e<n;e++)for(let c=0;c<n;c++){const f=e+c*n;let l=0,h=0;const d=e,u=c;for(let e=0;e<s;e++)for(let n=0;n<s;n++){let o=d*s+e,i=u*s+n;i>r-1&&(i=r-1),o>r-1&&(o=r-1);const a=o+i*r,c=t[4*a],f=t[4*a+1],v=t[4*a+2];0===t[4*a+3]?h+=1:l+=.1*(256*c*256+256*f+v)-1e4}l/=s*s-h||1,l>i&&(i=l),l<o&&(o=l),a[f]=l}return{data:a,width:n,height:n,min:o,max:i}}(n,r);Fe(o,t,r,e,!0,i)})))}})).catch((n=>{delete me[e],i({empty:!0,originalError:n})}))}function Le(e,n){const t=Math.floor(10*(e+1e4)),r=t>>16,o=t>>8&255,i=255&t;return n?(n[0]=r,n[1]=o,n[2]=i,n):[r,o,i]}function Fe(e,n,t,r,o,i){const a=function(e,n,t,r){let o=re[t];o||(o=re[t]=new ne(t));const i=o.createTile(n).getMeshWithSkirts(e,!0),{triangles:a,vertices:s,leftSkirtIndex:c,rightSkirtIndex:f,bottomSkirtIndex:l,topSkirtIndex:h}=i;let{numVerticesWithoutSkirts:d,numTrianglesWithoutSkirts:u}=i;d||(d=s.legnth/3,u=a.length/3);const v=s.length/2,_=new Float32Array(3*v),m=new Float32Array(2*v);let g=1/0,x=-1/0;const p=t-1;for(let e=0;e<v;e++){const r=s[2*e],o=s[2*e+1];if(e>=d){const n=r/2*3;let t,o=.001;(e-(e<c/2?d:e<f/2?c/2:e<l/2?f/2:l/2))%3==0?(t=0,o=0):t=_[n+2],_[3*e]=_[n],_[3*e+1]=_[n+1],_[3*e+2]=t,m[2*e]=_[n]/p+o,m[2*e+1]=-_[n+1]/p+o}else _[3*e]=1*r,_[3*e+1]=1*-o,_[3*e+2]=n[o*t+r],m[2*e]=r/p,m[2*e+1]=o/p;const i=_[_.length-1];i<g&&(g=i),i>x&&(x=i)}return{positions:_,texcoords:m,triangles:a,leftSkirtIndex:c,rightSkirtIndex:f,bottomSkirtIndex:l,topSkirtIndex:h,numTrianglesWithoutSkirts:u,numVerticesWithoutSkirts:d,minHeight:g,maxHeight:x,terrainWidth:t}}(e,n.data,t),s=[a.positions.buffer,a.texcoords.buffer,a.triangles.buffer];r||(r=function(e){if(ve(),!le)return;const{width:n,height:t,data:r}=e;if(n&&t&&r)try{let e=le.getContext("2d",{willReadFrequently:!0});const o=e.createImageData(n,t);for(let e=0,n=r.length;e<n;e++){const n=r[e],[t,i,a]=Le(n,de),s=4*e;o.data[s]=t,o.data[s+1]=i,o.data[s+2]=a,o.data[s+3]=255}return le.width=n,le.height=t,e=le.getContext("2d",{willReadFrequently:!0}),ze(e),e.putImageData(o,0,0),le.transferToImageBitmap()}catch(e){console.log(e)}}(n)),r&&s.push(r);const c={mesh:a};c.image=r,c.data=n,s.push(n.data.buffer),i(c,s)}function ze(e){const n=e.canvas,{width:t,height:r}=n;e.clearRect(0,0,t,r)}function We(e,n,t){if(!n||!Array.isArray(n)||n.length<2)return;if(!e||!e.image)return null;let{width:r,height:o}=e.image;(t=t||ue)[0]===r&&t[1]===o||(r=t[0],o=t[1]),r*=2,o*=2;try{if(ve(),!le)return;const t=le;t.width=r,t.height=o;const i=t.getContext("2d",{willReadFrequently:!0});ze(i),i.drawImage(e.image,0,0,r,o);const a=i.getImageData(0,0,r,o);return function(e,n){const t=JSON.stringify(n);_e[t]||(_e[t]=new fe(n));const r=_e[t],o=e.data;for(let e=0,n=o.length;e<n;e+=4){const n=o[e],t=o[e+1],i=o[e+2];let a=0;0!==o[e+3]&&(a=.1*(256*n*256+256*t+i)-1e4,a=Math.max(a,0));const[s,c,f]=r.getColor(a);o[e]=s,o[e+1]=c,o[e+2]=f,o[e+3]=255}}(a,n),new Uint8Array(a.data)}catch(e){console.error(e)}}e.initialize=function(){},e.onmessage=function(e,n){const t=e.data;if("addLayer"===t.command||"removeLayer"===t.command)ae=e.workerId,self.postMessage({type:"<response>",actorId:t.actorId,workerId:ae,params:"ok",callback:e.callback});else if("fetchTerrain"===t.command){const e=(t.params||{}).colors,r=(t.params||{}).tileSize;!function(e,n){const{url:t,origin:r,type:o,accessToken:i,terrainWidth:a,error:s}=e,c=e.headers||xe[o];if("tianditu"===o)Ue(t,c,o,a,s,n);else if("cesium-ion"===o){const f=e.cesiumIonTokenURL+i;Ae?Ue(t,c,o,a,s,n):(ye||(ye=fetch(f,{responseType:"json",method:"GET",referrer:r,headers:{Accept:"application/json,*/*;q=0.01","Accept-Encoding":"gzip, deflate, br"}}).then((e=>e.json())).then((e=>{Ae=e.accessToken,ye=null}))),ye.then((()=>{Ue(t,c,o,a,s,n)})))}else("cesium"===o||"mapbox"===o)&&Ue(t,c,o,a,s,n)}(t.params,((t,o)=>{const i=We(t,e,r);i&&(t.colorsTexture=i,(o=o||[]).push(i.buffer)),n(t.error,t,o)}))}else"abortTerrain"===t.command&&(r=t.params.url,me[r]&&(me[r].abort(),delete me[r]));var r}}`);const dE={width:100,height:10};let pE=!1;try{new OffscreenCanvas(1,1).getContext("2d").fillText("hello",0,0),pE=!0}catch(uft){pE=!1}let gE=class{constructor(t,e={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let n=1/0,i=-1/0;for(let r=0,o=t.length;r<o;r++){const e=t[r][0];n=Math.min(e,n),i=Math.max(e,i)}this.min=n,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},dE,e),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const t=function(){if(!fE){const{width:t,height:e}=dE;pE?fE=new OffscreenCanvas(t,e):(fE=document.createElement("canvas"),fE.width=t,fE.height=e)}return fE}(),{width:e,height:n}=this.options;t.width=e,t.height=n;const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);const r=i.createLinearGradient(0,0,t.width,0),{colors:o,valueOffset:s}=this;for(let a=0,h=o.length;a<h;a++){const[t,e]=o[a];r.addColorStop((t-this.min)/s,e)}i.fillStyle=r,i.fillRect(0,0,t.width,t.height),this.imgData=i.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t),t=Math.min(t,this.max);let e=Math.round((t-this.min)/this.valueOffset*this.imgData.width);e=Math.min(e,this.imgData.width-1);const n=4*e;return[this.imgData.data[n],this.imgData.data[n+1],this.imgData.data[n+2],this.imgData.data[n+3]]}};var mE;function yE(t,e){var n,i,r;if(SE(t)){var o,s=t.stops&&"object"==typeof t.stops[0][0],a=s||!(s||void 0!==t.property),h=t.type||e||"exponential";if("exponential"===h)o=xE;else if("interval"===h)o=_E;else if("categorical"===h)o=vE;else if("identity"===h)o=CE;else if("color-interpolate"===h)o=wE;else{if("calculate-expression"!==h)throw new Error('Unknown function type "'+h+'"');o=PE}if(s){var l={},u=[];for(let e=0;e<t.stops.length;e++){var c=t.stops[e];void 0===l[c[0].zoom]&&(l[c[0].zoom]={zoom:c[0].zoom,type:t.type,property:t.property,default:t.default,stops:[]}),l[c[0].zoom].stops.push([c[0].value,c[1]])}for(let t in l)u.push([l[t].zoom,yE(l[t])]);n=function(e,n){const i=xE({stops:u,base:t.base},e)(e,n);return"function"==typeof i?i(e,n):i},i=!1,r=!1}else a?(n=function(e){const n=o(t,e);return"function"==typeof n?n(e):n},i=!0,r=!1):(n=function(e,n){const i=o(t,n?n[t.property]:null);return"function"==typeof i?i(e,n):i},i=!1,r=!0)}else n=function(){return t},i=!0,r=!0;return n.isZoomConstant=r,n.isFeatureConstant=i,n}function vE(t,e){for(let n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.default}function _E(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function xE(t,e){for(var n=void 0!==t.base?t.base:1,i=0;!(i>=t.stops.length||e<=t.stops[i][0]);)i++;return 0===i?t.stops[i][1]:i===t.stops.length?t.stops[i-1][1]:ME(e,n,t.stops[i-1][0],t.stops[i][0],t.stops[i-1][1],t.stops[i][1])}"function"==typeof Map&&(mE=new Map);const bE={width:100,height:1};function wE(t,e){const n=t.stops;if(n&&n.length>1){let t;if(mE){const e=JSON.stringify(n);if(!mE.has(e)){const t=new gE(n,bE);mE.set(e,t)}t=mE.get(e)}else t=new gE(n,bE);const[i,r,o,s]=t.getColor(e);return[i/255,r/255,o/255,s/255]}return n&&1===n.length?n[0][1]:null}function CE(t,e){return function(t,e){return void 0!==t?t:void 0!==e?e:null}(e,t.default)}function PE(t,e){const n=String(t.property),i=t.expression,r=e;function o(e){return null==e||""===e||isNaN(e)?t.default:e}return null==e||""===e||isNaN(e)||e<0?o(t.default):o(function e(n){if(!Array.isArray(n)){if("number"==typeof n)return n;throw new Error("Invalid expression format")}{const i=n[0];if(!["+","-","*","/"].includes(i))throw new Error(`Unknown operator: ${i}`);const r=n.slice(1).map((t=>e(t)));switch(i){case"+":return r.reduce(((t,e)=>t+e),0);case"-":return r.reduce(((t,e)=>t-e));case"*":return r.reduce(((t,e)=>t*e),1);case"/":return r.some((t=>0===t))?t.default:r.reduce(((t,e)=>t/e));default:throw new Error(`Unsupported operator: ${i}`)}}}(function t(e,n,i){const r=Number(i),o=String(n);return Array.isArray(e)?e.map((e=>t(e,o,r))):e===o?r:e}(i,n,r)))}function ME(t,e,n,i,r,o){return"function"==typeof r?function(){var s=r.apply(void 0,arguments),a=o.apply(void 0,arguments);return ME(t,e,n,i,s,a)}:r.length?function(t,e,n,i,r,o){var s=[];for(let a=0;a<r.length;a++)s[a]=TE(t,e,n,i,r[a],o[a]);return s}(t,e,n,i,r,o):TE(t,e,n,i,r,o)}function TE(t,e,n,i,r,o){var s,a=i-n,h=t-n;return r*(1-(s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)))+o*s}function SE(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type||t.expression&&"calculate-expression"===t.type)}function IE(t){for(const e in t)if(SE(t[e]))return!0;return!1}function EE(t){return DE(t,"exponential")}function OE(t){return DE(t,"interval")}function RE(t,e){if(!t)return null;var n=!1;if(Array.isArray(t)){var i,r=[];for(let o=0;o<t.length;o++)(i=RE(t[o],e))?(r.push(i),n=!0):r.push(t[o]);return n?r:t}var o,s={__fn_types_loaded:!0},a=[];for(o in t)t.hasOwnProperty(o)&&a.push(o);const h=function(t){Object.defineProperty(s,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=EE(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})};for(let l=0,u=a.length;l<u;l++)SE(t[o=a[l]])?(n=!0,s["_"+o]=t[o],h(o)):s[o]=t[o];return n?s:t}function DE(t,e){if(!SE(t))return function(){return t};let n=!0,i=!0;const r=(t=JSON.parse(JSON.stringify(t))).stops;if(r)for(let s=0;s<r.length;s++)if(SE(r[s][1])){const t=DE(r[s][1],e);n=n&&t.isZoomConstant,i=i&&t.isFeatureConstant,r[s]=[r[s][0],t]}const o=yE(t,e);return o.isZoomConstant=n&&o.isZoomConstant,o.isFeatureConstant=i&&o.isFeatureConstant,o}var kE={exports:{}},LE={exports:{}},FE=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},NE=Array.prototype.concat,zE=Array.prototype.slice,BE=LE.exports=function(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];FE(r)?e=NE.call(e,zE.call(r)):e.push(r)}return e};BE.wrap=function(t){return function(){return t(BE(arguments))}};var HE={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},jE=LE.exports,UE=Object.hasOwnProperty,GE=Object.create(null);for(var VE in HE)UE.call(HE,VE)&&(GE[HE[VE]]=VE);var WE=kE.exports={to:{},get:{}};function qE(t,e,n){return Math.min(Math.max(e,t),n)}function ZE(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}WE.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=WE.get.hsl(t),n="hsl";break;case"hwb":e=WE.get.hwb(t),n="hwb";break;default:e=WE.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},WE.get.rgb=function(t){if(!t)return null;var e,n,i,r=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=e[2],e=e[1],n=0;n<3;n++){var o=2*n;r[n]=parseInt(e.slice(o,o+2),16)}i&&(r[3]=parseInt(i,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(i=(e=e[1])[3],n=0;n<3;n++)r[n]=parseInt(e[n]+e[n],16);i&&(r[3]=parseInt(i+i,16)/255)}else if(e=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)r[n]=parseInt(e[n+1],0);e[4]&&(r[3]=e[5]?.01*parseFloat(e[4]):parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(e=t.match(/^(\w+)$/))?"transparent"===e[1]?[0,0,0,0]:UE.call(HE,e[1])?((r=HE[e[1]])[3]=1,r):null:null;for(n=0;n<3;n++)r[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(r[3]=e[5]?.01*parseFloat(e[4]):parseFloat(e[4]))}for(n=0;n<3;n++)r[n]=qE(r[n],0,255);return r[3]=qE(r[3],0,1),r},WE.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,qE(parseFloat(e[2]),0,100),qE(parseFloat(e[3]),0,100),qE(isNaN(n)?1:n,0,1)]}return null},WE.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,qE(parseFloat(e[2]),0,100),qE(parseFloat(e[3]),0,100),qE(isNaN(n)?1:n,0,1)]}return null},WE.to.hex=function(){var t=jE(arguments);return"#"+ZE(t[0])+ZE(t[1])+ZE(t[2])+(t[3]<1?ZE(Math.round(255*t[3])):"")},WE.to.rgb=function(){var t=jE(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},WE.to.rgb.percent=function(){var t=jE(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),i=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+i+"%)":"rgba("+e+"%, "+n+"%, "+i+"%, "+t[3]+")"},WE.to.hsl=function(){var t=jE(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},WE.to.hwb=function(){var t=jE(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},WE.to.keyword=function(t){return GE[t.slice(0,3)]};var QE=kE.exports,XE={exports:{}},YE={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},JE={};for(var KE in YE)YE.hasOwnProperty(KE)&&(JE[YE[KE]]=KE);var $E=XE.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var tO in $E)if($E.hasOwnProperty(tO)){if(!("channels"in $E[tO]))throw new Error("missing channels property: "+tO);if(!("labels"in $E[tO]))throw new Error("missing channel labels property: "+tO);if($E[tO].labels.length!==$E[tO].channels)throw new Error("channel and label counts mismatch: "+tO);var eO=$E[tO].channels,nO=$E[tO].labels;delete $E[tO].channels,delete $E[tO].labels,Object.defineProperty($E[tO],"channels",{value:eO}),Object.defineProperty($E[tO],"labels",{value:nO})}function iO(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}$E.rgb.hsl=function(t){var e,n,i=t[0]/255,r=t[1]/255,o=t[2]/255,s=Math.min(i,r,o),a=Math.max(i,r,o),h=a-s;return a===s?e=0:i===a?e=(r-o)/h:r===a?e=2+(o-i)/h:o===a&&(e=4+(i-r)/h),(e=Math.min(60*e,360))<0&&(e+=360),n=(s+a)/2,[e,100*(a===s?0:n<=.5?h/(a+s):h/(2-a-s)),100*n]},$E.rgb.hsv=function(t){var e,n,i,r,o,s=t[0]/255,a=t[1]/255,h=t[2]/255,l=Math.max(s,a,h),u=l-Math.min(s,a,h),c=function(t){return(l-t)/6/u+.5};return 0===u?r=o=0:(o=u/l,e=c(s),n=c(a),i=c(h),s===l?r=i-n:a===l?r=1/3+e-i:h===l&&(r=2/3+n-e),r<0?r+=1:r>1&&(r-=1)),[360*r,100*o,100*l]},$E.rgb.hwb=function(t){var e=t[0],n=t[1],i=t[2];return[$E.rgb.hsl(t)[0],1/255*Math.min(e,Math.min(n,i))*100,100*(i=1-1/255*Math.max(e,Math.max(n,i)))]},$E.rgb.cmyk=function(t){var e,n=t[0]/255,i=t[1]/255,r=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-i,1-r)))/(1-e)||0),100*((1-i-e)/(1-e)||0),100*((1-r-e)/(1-e)||0),100*e]},$E.rgb.keyword=function(t){var e=JE[t];if(e)return e;var n,i=1/0;for(var r in YE)if(YE.hasOwnProperty(r)){var o=iO(t,YE[r]);o<i&&(i=o,n=r)}return n},$E.keyword.rgb=function(t){return YE[t]},$E.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,i=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*e+.7152*n+.0722*i),100*(.0193*e+.1192*n+.9505*i)]},$E.rgb.lab=function(t){var e=$E.rgb.xyz(t),n=e[0],i=e[1],r=e[2];return i/=100,r/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},$E.hsl.rgb=function(t){var e,n,i,r,o,s=t[0]/360,a=t[1]/100,h=t[2]/100;if(0===a)return[o=255*h,o,o];e=2*h-(n=h<.5?h*(1+a):h+a-h*a),r=[0,0,0];for(var l=0;l<3;l++)(i=s+1/3*-(l-1))<0&&i++,i>1&&i--,r[l]=255*(o=6*i<1?e+6*(n-e)*i:2*i<1?n:3*i<2?e+(n-e)*(2/3-i)*6:e);return r},$E.hsl.hsv=function(t){var e=t[0],n=t[1]/100,i=t[2]/100,r=n,o=Math.max(i,.01);return n*=(i*=2)<=1?i:2-i,r*=o<=1?o:2-o,[e,100*(0===i?2*r/(o+r):2*n/(i+n)),(i+n)/2*100]},$E.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,i=t[2]/100,r=Math.floor(e)%6,o=e-Math.floor(e),s=255*i*(1-n),a=255*i*(1-n*o),h=255*i*(1-n*(1-o));switch(i*=255,r){case 0:return[i,h,s];case 1:return[a,i,s];case 2:return[s,i,h];case 3:return[s,a,i];case 4:return[h,s,i];case 5:return[i,s,a]}},$E.hsv.hsl=function(t){var e,n,i,r=t[0],o=t[1]/100,s=t[2]/100,a=Math.max(s,.01);return i=(2-o)*s,n=o*a,[r,100*(n=(n/=(e=(2-o)*a)<=1?e:2-e)||0),100*(i/=2)]},$E.hwb.rgb=function(t){var e,n,i,r,o,s,a,h=t[0]/360,l=t[1]/100,u=t[2]/100,c=l+u;switch(c>1&&(l/=c,u/=c),i=6*h-(e=Math.floor(6*h)),1&e&&(i=1-i),r=l+i*((n=1-u)-l),e){default:case 6:case 0:o=n,s=r,a=l;break;case 1:o=r,s=n,a=l;break;case 2:o=l,s=n,a=r;break;case 3:o=l,s=r,a=n;break;case 4:o=r,s=l,a=n;break;case 5:o=n,s=l,a=r}return[255*o,255*s,255*a]},$E.cmyk.rgb=function(t){var e=t[1]/100,n=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-i)+i)),255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i))]},$E.xyz.rgb=function(t){var e,n,i,r=t[0]/100,o=t[1]/100,s=t[2]/100;return n=-.9689*r+1.8758*o+.0415*s,i=.0557*r+-.204*o+1.057*s,e=(e=3.2406*r+-1.5372*o+-.4986*s)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(i=Math.min(Math.max(0,i),1))]},$E.xyz.lab=function(t){var e=t[0],n=t[1],i=t[2];return n/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},$E.lab.xyz=function(t){var e,n,i;e=t[1]/500+(n=(t[0]+16)/116),i=n-t[2]/200;var r=Math.pow(n,3),o=Math.pow(e,3),s=Math.pow(i,3);return n=r>.008856?r:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,i=s>.008856?s:(i-16/116)/7.787,[e*=95.047,n*=100,i*=108.883]},$E.lab.lch=function(t){var e,n=t[0],i=t[1],r=t[2];return(e=360*Math.atan2(r,i)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(i*i+r*r),e]},$E.lch.lab=function(t){var e,n=t[1];return e=t[2]/360*2*Math.PI,[t[0],n*Math.cos(e),n*Math.sin(e)]},$E.rgb.ansi16=function(t){var e=t[0],n=t[1],i=t[2],r=1 in arguments?arguments[1]:$E.rgb.hsv(t)[2];if(0===(r=Math.round(r/50)))return 30;var o=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===r&&(o+=60),o},$E.hsv.ansi16=function(t){return $E.rgb.ansi16($E.hsv.rgb(t),t[2])},$E.rgb.ansi256=function(t){var e=t[0],n=t[1],i=t[2];return e===n&&n===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)},$E.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},$E.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},$E.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},$E.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var i=parseInt(n,16);return[i>>16&255,i>>8&255,255&i]},$E.rgb.hcg=function(t){var e,n=t[0]/255,i=t[1]/255,r=t[2]/255,o=Math.max(Math.max(n,i),r),s=Math.min(Math.min(n,i),r),a=o-s;return e=a<=0?0:o===n?(i-r)/a%6:o===i?2+(r-n)/a:4+(n-i)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?s/(1-a):0)]},$E.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,i=1,r=0;return(i=n<.5?2*e*n:2*e*(1-n))<1&&(r=(n-.5*i)/(1-i)),[t[0],100*i,100*r]},$E.hsv.hcg=function(t){var e=t[2]/100,n=t[1]/100*e,i=0;return n<1&&(i=(e-n)/(1-n)),[t[0],100*n,100*i]},$E.hcg.rgb=function(t){var e=t[1]/100,n=t[2]/100;if(0===e)return[255*n,255*n,255*n];var i,r=[0,0,0],o=t[0]/360%1*6,s=o%1,a=1-s;switch(Math.floor(o)){case 0:r[0]=1,r[1]=s,r[2]=0;break;case 1:r[0]=a,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=s;break;case 3:r[0]=0,r[1]=a,r[2]=1;break;case 4:r[0]=s,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=a}return[255*(e*r[0]+(i=(1-e)*n)),255*(e*r[1]+i),255*(e*r[2]+i)]},$E.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),i=0;return n>0&&(i=e/n),[t[0],100*i,100*n]},$E.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,i=0;return n>0&&n<.5?i=e/(2*n):n>=.5&&n<1&&(i=e/(2*(1-n))),[t[0],100*i,100*n]},$E.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},$E.hwb.hcg=function(t){var e=1-t[2]/100,n=e-t[1]/100,i=0;return n<1&&(i=(e-n)/(1-n)),[t[0],100*n,100*i]},$E.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},$E.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},$E.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},$E.gray.hsl=$E.gray.hsv=function(t){return[0,0,t[0]]},$E.gray.hwb=function(t){return[0,100,t[0]]},$E.gray.cmyk=function(t){return[0,0,0,t[0]]},$E.gray.lab=function(t){return[t[0],0,0]},$E.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},$E.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var rO=XE.exports,oO=rO;function sO(t){var e=function(){for(var t={},e=Object.keys(oO),n=e.length,i=0;i<n;i++)t[e[i]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var i=n.pop(),r=Object.keys(oO[i]),o=r.length,s=0;s<o;s++){var a=r[s],h=e[a];-1===h.distance&&(h.distance=e[i].distance+1,h.parent=i,n.unshift(a))}return e}function aO(t,e){return function(n){return e(t(n))}}function hO(t,e){for(var n=[e[t].parent,t],i=oO[e[t].parent][t],r=e[t].parent;e[r].parent;)n.unshift(e[r].parent),i=aO(oO[e[r].parent][r],i),r=e[r].parent;return i.conversion=n,i}var lO=rO,uO=function(t){for(var e=sO(t),n={},i=Object.keys(e),r=i.length,o=0;o<r;o++){var s=i[o];null!==e[s].parent&&(n[s]=hO(s,e))}return n},cO={};Object.keys(lO).forEach((function(t){cO[t]={},Object.defineProperty(cO[t],"channels",{value:lO[t].channels}),Object.defineProperty(cO[t],"labels",{value:lO[t].labels});var e=uO(t);Object.keys(e).forEach((function(n){var i,r,o=e[n];cO[t][n]=(r=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var e=i(t);if("object"==typeof e)for(var n=e.length,r=0;r<n;r++)e[r]=Math.round(e[r]);return e},"conversion"in(i=o)&&(r.conversion=i.conversion),r),cO[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(o)}))}));var AO=QE,fO=cO,dO=[].slice,pO=["keyword","gray","hex"],gO={};Object.keys(fO).forEach((function(t){gO[dO.call(fO[t].labels).sort().join("")]=t}));var mO={};function yO(t,e){if(!(this instanceof yO))return new yO(t,e);if(e&&e in pO&&(e=null),e&&!(e in fO))throw new Error("Unknown model: "+e);var n,i;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof yO)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var r=AO.get(t);if(null===r)throw new Error("Unable to parse color from string: "+t);this.model=r.model,this.color=r.value.slice(0,i=fO[this.model].channels),this.valpha="number"==typeof r.value[i]?r.value[i]:1}else if(t.length){this.model=e||"rgb";var o=dO.call(t,0,i=fO[this.model].channels);this.color=xO(o,i),this.valpha="number"==typeof t[i]?t[i]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var s=Object.keys(t);"alpha"in t&&(s.splice(s.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=s.sort().join("");if(!(a in gO))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=gO[a];var h=fO[this.model].labels,l=[];for(n=0;n<h.length;n++)l.push(t[h[n]]);this.color=xO(l)}if(mO[this.model])for(i=fO[this.model].channels,n=0;n<i;n++){var u=mO[this.model][n];u&&(this.color[n]=u(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function vO(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(mO[t]||(mO[t]=[]))[e]=n})),t=t[0],function(i){var r;return arguments.length?(n&&(i=n(i)),(r=this[t]()).color[e]=i,r):(r=this[t]().color[e],n&&(r=n(r)),r)}}function _O(t){return function(e){return Math.max(0,Math.min(t,e))}}function xO(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}yO.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in AO.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return AO.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return AO.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=fO[this.model].channels,n=fO[this.model].labels,i=0;i<e;i++)t[n[i]]=this.color[i];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new yO(this.color.map(function(t){return function(e){return n=t,Number(e.toFixed(n));var n}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new yO(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:vO("rgb",0,_O(255)),green:vO("rgb",1,_O(255)),blue:vO("rgb",2,_O(255)),hue:vO(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:vO("hsl",1,_O(100)),lightness:vO("hsl",2,_O(100)),saturationv:vO("hsv",1,_O(100)),value:vO("hsv",2,_O(100)),chroma:vO("hcg",1,_O(100)),gray:vO("hcg",2,_O(100)),white:vO("hwb",1,_O(100)),wblack:vO("hwb",2,_O(100)),cyan:vO("cmyk",0,_O(100)),magenta:vO("cmyk",1,_O(100)),yellow:vO("cmyk",2,_O(100)),black:vO("cmyk",3,_O(100)),x:vO("xyz",0,_O(100)),y:vO("xyz",1,_O(100)),z:vO("xyz",2,_O(100)),l:vO("lab",0,_O(100)),a:vO("lab",1),b:vO("lab",2),keyword:function(t){return arguments.length?new yO(t):fO[this.model].keyword(this.color)},hex:function(t){return arguments.length?new yO(t):AO.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var i=t[n]/255;e[n]=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return yO.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return e.color[0]=n=(n=(n+t)%360)<0?360+n:n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var n=t.rgb(),i=this.rgb(),r=void 0===e?.5:e,o=2*r-1,s=n.alpha()-i.alpha(),a=((o*s==-1?o:(o+s)/(1+o*s))+1)/2,h=1-a;return yO.rgb(a*n.red()+h*i.red(),a*n.green()+h*i.green(),a*n.blue()+h*i.blue(),n.alpha()*r+i.alpha()*(1-r))}},Object.keys(fO).forEach((function(t){if(-1===pO.indexOf(t)){var e=fO[t].channels;yO.prototype[t]=function(){if(this.model===t)return new yO(this);if(arguments.length)return new yO(arguments,t);var n,i="number"==typeof arguments[e]?e:this.valpha;return new yO((n=fO[this.model][t].raw(this.color),Array.isArray(n)?n:[n]).concat(i),t)},yO[t]=function(n){return"number"==typeof n&&(n=xO(dO.call(arguments),e)),new yO(n,t)}}}));var bO=td(yO);const wO=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function CO(t){return new Function("f",`var p = (f && f.properties || {}); return ${MO(t)}`)}function PO(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":case"!has":return 2===t.length&&("string"==typeof t[1]||t[1].property&&t[1].op);case"in":case"!in":return t.length>=2&&("string"==typeof t[1]||t[1].property&&t[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===t.length&&("string"==typeof t[1]||t[1].property&&t[1].op);case"none":case"any":case"all":for(const e of t.slice(1))if(!PO(e)&&"boolean"!=typeof e)return!1;return!0;case"contains":return!0;default:return!1}}function MO(t){if(!t)return"true";const e=t[0];return t.length<=1?"any"===e?"false":"true":`(${"=="===e?SO(t[1],t[2],"===",!1):"!="===e?SO(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?SO(t[1],t[2],e,!0):"any"===e?EO(t.slice(1),"||"):"all"===e?EO(t.slice(1),"&&"):"none"===e?DO(EO(t.slice(1),"||")):"in"===e?OO(t[1],t.slice(2)):"!in"===e?DO(OO(t[1],t.slice(2))):"has"===e?RO(t[1]):"!has"===e?DO(RO(t[1])):"contains"===e?function(t,e,n){const i=TO(t);return void 0!==n?`(${i} + '').indexOf("${e}") === ${n}`:`(${i} + '').indexOf("${e}") >= 0`}(t[1],t[2],t[3]):"true"})`}function TO(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function SO(t,e,n,i){return"object"==typeof(r=t)&&r&&t.op?function(t,e,n,i){const r=t.property,o=t.op;let s=TO(r);return"length"!==o?(console.error(`not support ${o} op`),"false"):(s=`((${s}+='').length)`,IO(s,r,e,n,i))}(t,e,n,i):IO(TO(t),t,e,n,i);var r}function IO(t,e,n,i,r){const o="$type"===e?wO.indexOf(n):JSON.stringify(n);return(r?`typeof ${t}=== typeof ${o}&&`:"")+t+i+o}function EO(t,e){return t.map(MO).join(e)}function OO(t,e){"$type"===t&&(e=e.map((t=>wO.indexOf(t))));const n=JSON.stringify(e.sort(kO)),i=TO(t);return e.length<=200?`${n}.indexOf(${i}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${i}, ${n},0,${e.length-1})`}function RO(t){return"$id"===t?'"id" in f':`${JSON.stringify(t)} in p`}function DO(t){return`!(${t})`}function kO(t,e){return t<e?-1:t>e?1:0}function LO(t){if(!Array.isArray(t))return LO([t]);const e=[];for(let n=0;n<t.length;n++){let i;i=!0===t[n].filter?function(){return!0}:CO(t[n].filter),e.push(FO({},t[n],{filter:i}))}return e}function FO(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}var NO={exports:{}};!function(t){t.exports=function(){function t(t,n,r,o,s){e(t,n,r||0,o||t.length-1,s||i)}function e(t,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,h=i-r+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(h-a/2<0?-1:1);e(t,i,Math.max(r,Math.floor(i-h*u/a+c)),Math.min(o,Math.floor(i+(a-h)*u/a+c)),s)}var A=t[i],f=r,d=o;for(n(t,r,i),s(t[o],A)>0&&n(t,r,o);f<d;){for(n(t,f,d),f++,d--;s(t[f],A)<0;)f++;for(;s(t[d],A)>0;)d--}0===s(t[r],A)?n(t,r,d):n(t,++d,o),d<=i&&(r=d+1),i<=d&&(o=d-1)}}function n(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function i(t,e){return t<e?-1:t>e?1:0}return t}()}(NO);var zO=td(NO.exports),BO={exports:{}};function HO(t,e,n){n=n||2;var i,r,o,s,a,h,l,u=e&&e.length,c=u?e[0]*n:t.length,A=jO(t,0,c,n,!0),f=[];if(!A||A.next===A.prev)return f;if(u&&(A=function(t,e,n,i){var r,o,s,a=[];for(r=0,o=e.length;r<o;r++)(s=jO(t,e[r]*i,r<o-1?e[r+1]*i:t.length,i,!1))===s.next&&(s.steiner=!0),a.push(KO(s));for(a.sort(QO),r=0;r<a.length;r++)n=XO(a[r],n);return n}(t,e,A,n)),t.length>80*n){i=o=t[0],r=s=t[1];for(var d=n;d<c;d+=n)(a=t[d])<i&&(i=a),(h=t[d+1])<r&&(r=h),a>o&&(o=a),h>s&&(s=h);l=0!==(l=Math.max(o-i,s-r))?32767/l:0}return GO(A,f,n,i,r,l,0),f}function jO(t,e,n,i,r){var o,s;if(r===cR(t,e,n,i)>0)for(o=e;o<n;o+=i)s=hR(o,t[o],t[o+1],s);else for(o=n-i;o>=e;o-=i)s=hR(o,t[o],t[o+1],s);return s&&nR(s,s.next)&&(lR(s),s=s.next),s}function UO(t,e){if(!t)return t;e||(e=t);var n,i=t;do{if(n=!1,i.steiner||!nR(i,i.next)&&0!==eR(i.prev,i,i.next))i=i.next;else{if(lR(i),(i=e=i.prev)===i.next)break;n=!0}}while(n||i!==e);return e}function GO(t,e,n,i,r,o,s){if(t){!s&&o&&function(t,e,n,i){var r=t;do{0===r.z&&(r.z=JO(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e,n,i,r,o,s,a,h,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,i=n,a=0,e=0;e<l&&(a++,i=i.nextZ);e++);for(h=l;a>0||h>0&&i;)0!==a&&(0===h||!i||n.z<=i.z)?(r=n,n=n.nextZ,a--):(r=i,i=i.nextZ,h--),o?o.nextZ=r:t=r,r.prevZ=o,o=r;n=i}o.nextZ=null,l*=2}while(s>1)}(r)}(t,i,r,o);for(var a,h,l=t;t.prev!==t.next;)if(a=t.prev,h=t.next,o?WO(t,i,r,o):VO(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(h.i/n|0),lR(t),t=h.next,l=h.next;else if((t=h)===l){s?1===s?GO(t=qO(UO(t),e,n),e,n,i,r,o,2):2===s&&ZO(t,e,n,i,r,o):GO(UO(t),e,n,i,r,o,1);break}}}function VO(t){var e=t.prev,n=t,i=t.next;if(eR(e,n,i)>=0)return!1;for(var r=e.x,o=n.x,s=i.x,a=e.y,h=n.y,l=i.y,u=r<o?r<s?r:s:o<s?o:s,c=a<h?a<l?a:l:h<l?h:l,A=r>o?r>s?r:s:o>s?o:s,f=a>h?a>l?a:l:h>l?h:l,d=i.next;d!==e;){if(d.x>=u&&d.x<=A&&d.y>=c&&d.y<=f&&$O(r,a,o,h,s,l,d.x,d.y)&&eR(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function WO(t,e,n,i){var r=t.prev,o=t,s=t.next;if(eR(r,o,s)>=0)return!1;for(var a=r.x,h=o.x,l=s.x,u=r.y,c=o.y,A=s.y,f=a<h?a<l?a:l:h<l?h:l,d=u<c?u<A?u:A:c<A?c:A,p=a>h?a>l?a:l:h>l?h:l,g=u>c?u>A?u:A:c>A?c:A,m=JO(f,d,e,n,i),y=JO(p,g,e,n,i),v=t.prevZ,_=t.nextZ;v&&v.z>=m&&_&&_.z<=y;){if(v.x>=f&&v.x<=p&&v.y>=d&&v.y<=g&&v!==r&&v!==s&&$O(a,u,h,c,l,A,v.x,v.y)&&eR(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,_.x>=f&&_.x<=p&&_.y>=d&&_.y<=g&&_!==r&&_!==s&&$O(a,u,h,c,l,A,_.x,_.y)&&eR(_.prev,_,_.next)>=0)return!1;_=_.nextZ}for(;v&&v.z>=m;){if(v.x>=f&&v.x<=p&&v.y>=d&&v.y<=g&&v!==r&&v!==s&&$O(a,u,h,c,l,A,v.x,v.y)&&eR(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;_&&_.z<=y;){if(_.x>=f&&_.x<=p&&_.y>=d&&_.y<=g&&_!==r&&_!==s&&$O(a,u,h,c,l,A,_.x,_.y)&&eR(_.prev,_,_.next)>=0)return!1;_=_.nextZ}return!0}function qO(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!nR(r,o)&&iR(r,i,i.next,o)&&sR(r,o)&&sR(o,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(o.i/n|0),lR(i),lR(i.next),i=t=o),i=i.next}while(i!==t);return UO(i)}function ZO(t,e,n,i,r,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&tR(s,a)){var h=aR(s,a);return s=UO(s,s.next),h=UO(h,h.next),GO(s,e,n,i,r,o,0),void GO(h,e,n,i,r,o,0)}a=a.next}s=s.next}while(s!==t)}function QO(t,e){return t.x-e.x}function XO(t,e){var n=function(t,e){var n,i=e,r=t.x,o=t.y,s=-1/0;do{if(o<=i.y&&o>=i.next.y&&i.next.y!==i.y){var a=i.x+(o-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(a<=r&&a>s&&(s=a,n=i.x<i.next.x?i:i.next,a===r))return n}i=i.next}while(i!==e);if(!n)return null;var h,l=n,u=n.x,c=n.y,A=1/0;i=n;do{r>=i.x&&i.x>=u&&r!==i.x&&$O(o<c?r:s,o,u,c,o<c?s:r,o,i.x,i.y)&&(h=Math.abs(o-i.y)/(r-i.x),sR(i,t)&&(h<A||h===A&&(i.x>n.x||i.x===n.x&&YO(n,i)))&&(n=i,A=h)),i=i.next}while(i!==l);return n}(t,e);if(!n)return e;var i=aR(n,t);return UO(i,i.next),UO(n,n.next)}function YO(t,e){return eR(t.prev,t,e.prev)<0&&eR(e.next,t,t.next)<0}function JO(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function KO(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function $O(t,e,n,i,r,o,s,a){return(r-s)*(e-a)>=(t-s)*(o-a)&&(t-s)*(i-a)>=(n-s)*(e-a)&&(n-s)*(o-a)>=(r-s)*(i-a)}function tR(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&iR(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(sR(t,e)&&sR(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&r<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)&&(eR(t.prev,t,e.prev)||eR(t,e.prev,e))||nR(t,e)&&eR(t.prev,t,t.next)>0&&eR(e.prev,e,e.next)>0)}function eR(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function nR(t,e){return t.x===e.x&&t.y===e.y}function iR(t,e,n,i){var r=oR(eR(t,e,n)),o=oR(eR(t,e,i)),s=oR(eR(n,i,t)),a=oR(eR(n,i,e));return r!==o&&s!==a||!(0!==r||!rR(t,n,e))||!(0!==o||!rR(t,i,e))||!(0!==s||!rR(n,t,i))||!(0!==a||!rR(n,e,i))}function rR(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function oR(t){return t>0?1:t<0?-1:0}function sR(t,e){return eR(t.prev,t,t.next)<0?eR(t,e,t.next)>=0&&eR(t,t.prev,e)>=0:eR(t,e,t.prev)<0||eR(t,t.next,e)<0}function aR(t,e){var n=new uR(t.i,t.x,t.y),i=new uR(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function hR(t,e,n,i){var r=new uR(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function lR(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function uR(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function cR(t,e,n,i){for(var r=0,o=e,s=n-i;o<n;o+=i)r+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return r}BO.exports=HO,BO.exports.default=HO,HO.deviation=function(t,e,n,i){var r=e&&e.length,o=Math.abs(cR(t,0,r?e[0]*n:t.length,n));if(r)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(cR(t,e[s]*n,s<a-1?e[s+1]*n:t.length,n));var h=0;for(s=0;s<i.length;s+=3){var l=i[s]*n,u=i[s+1]*n,c=i[s+2]*n;h+=Math.abs((t[l]-t[c])*(t[u+1]-t[l+1])-(t[l]-t[u])*(t[c+1]-t[l+1]))}return 0===o&&0===h?0:Math.abs((h-o)/o)},HO.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[r][o][s]);r>0&&n.holes.push(i+=t[r-1].length)}return n};var AR=td(BO.exports),fR=Math.pow,dR=Math.sqrt,pR=Math.sin,gR=Math.cos,mR=Math.PI,yR=1.70158,vR=1.525*yR,_R=yR+1,xR=2*mR/3,bR=2*mR/4.5;function wR(t){var e=7.5625,n=2.75;return t<1/n?e*t*t:t<2/n?e*(t-=1.5/n)*t+.75:t<2.5/n?e*(t-=2.25/n)*t+.9375:e*(t-=2.625/n)*t+.984375}function CR(t,e){switch(t=t.toLowerCase()){case"swing":case"easeinquad":return PR(e);case"easeoutquad":return function(t){return 1-(1-t)*(1-t)}(e);case"easeinoutquad":return function(t){return t<.5?2*t*t:1-fR(-2*t+2,2)/2}(e);case"easeincubic":return function(t){return t*t*t}(e);case"easeoutcubic":return function(t){return 1-fR(1-t,3)}(e);case"easeinoutcubic":return function(t){return t<.5?4*t*t*t:1-fR(-2*t+2,3)/2}(e);case"easeinquart":return function(t){return t*t*t*t}(e);case"easeoutquart":return function(t){return 1-fR(1-t,4)}(e);case"easeinoutquart":return function(t){return t<.5?8*t*t*t*t:1-fR(-2*t+2,4)/2}(e);case"easeinquint":return function(t){return t*t*t*t*t}(e);case"easeoutquint":return function(t){return 1-fR(1-t,5)}(e);case"easeinoutquint":return function(t){return t<.5?16*t*t*t*t*t:1-fR(-2*t+2,5)/2}(e);case"easeinsine":return function(t){return 1-gR(t*mR/2)}(e);case"easeoutsine":return function(t){return pR(t*mR/2)}(e);case"easeinoutsine":return function(t){return-(gR(mR*t)-1)/2}(e);case"easeinexpo":return function(t){return 0===t?0:fR(2,10*t-10)}(e);case"easeoutexpo":return function(t){return 1===t?1:1-fR(2,-10*t)}(e);case"easeinoutexpo":return function(t){return 0===t?0:1===t?1:t<.5?fR(2,20*t-10)/2:(2-fR(2,-20*t+10))/2}(e);case"easeincirc":return function(t){return 1-dR(1-fR(t,2))}(e);case"easeoutcirc":return function(t){return dR(1-fR(t-1,2))}(e);case"easeinoutcirc":return function(t){return t<.5?(1-dR(1-fR(2*t,2)))/2:(dR(1-fR(-2*t+2,2))+1)/2}(e);case"easeinelastic":return function(t){return 0===t?0:1===t?1:-fR(2,10*t-10)*pR((10*t-10.75)*xR)}(e);case"easeoutelastic":return function(t){return 0===t?0:1===t?1:fR(2,-10*t)*pR((10*t-.75)*xR)+1}(e);case"easeinoutelastic":return function(t){return 0===t?0:1===t?1:t<.5?-fR(2,20*t-10)*pR((20*t-11.125)*bR)/2:fR(2,-20*t+10)*pR((20*t-11.125)*bR)/2+1}(e);case"easeinback":return function(t){return _R*t*t*t-yR*t*t}(e);case"easeoutback":return function(t){return 1+_R*fR(t-1,3)+yR*fR(t-1,2)}(e);case"easeinoutback":return function(t){return t<.5?fR(2*t,2)*(2*(vR+1)*t-vR)/2:(fR(2*t-2,2)*((vR+1)*(2*t-2)+vR)+2)/2}(e);case"easeinbounce":return function(t){return 1-wR(1-t)}(e);case"easeoutbounce":return function(t){return wR(t)}(e);case"easeinoutbounce":return function(t){return t<.5?(1-wR(1-2*t))/2:(1+wR(2*t-1))/2}(e)}throw new Error("Unsupported easing function:"+t)}function PR(t){return t*t}function MR(){}const TR=MR.prototype;TR.getType=function(){return Object.getPrototypeOf(this).constructor.type},TR.isVisible=function(){throw new Error("to be implemented.")},TR.prepareRender=function(){throw new Error("to be implemented.")},TR.updateCollision=function(){throw new Error("to be implemented.")},TR.supportRenderMode=function(){throw new Error("to be implemented.")},TR.startFrame=function(){throw new Error("to be implemented.")},TR.endFrame=function(){throw new Error("to be implemented.")},TR.paintTile=function(){throw new Error("to be implemented.")},TR.getShadowMeshes=function(){throw new Error("to be implemented.")},TR.updateSceneConfig=function(){throw new Error("to be implemented.")},TR.updateDataConfig=function(){throw new Error("to be implemented.")},TR.updateSymbol=function(){throw new Error("to be implemented.")},TR.pick=function(){throw new Error("to be implemented.")},TR.resize=function(){throw new Error("to be implemented.")},TR.deleteTile=function(){throw new Error("to be implemented.")},TR.remove=function(){throw new Error("to be implemented.")},TR.needToRedraw=function(){throw new Error("to be implemented.")},TR.needToRetireFrames=function(){throw new Error("to be implemented.")},TR.outline=function(){throw new Error("to be implemented.")},TR.outlineAll=function(){throw new Error("to be implemented.")},TR.needPolygonOffset=function(){throw new Error("to be implemented.")},TR.constructor=MR;const SR=Object.prototype.hasOwnProperty;function IR(t){t.registerPlugin(this)}function ER(t,e,n,i,r){OR(t,e,n||0,i||t.length-1,r||DR)}function OR(t,e,n,i,r){for(;i>n;){if(i-n>600){var o=i-n+1,s=e-n+1,a=Math.log(o),h=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*h*(o-h)/o)*(s-o/2<0?-1:1);OR(t,e,Math.max(n,Math.floor(e-s*h/o+l)),Math.min(i,Math.floor(e+(o-s)*h/o+l)),r)}var u=t[e],c=n,A=i;for(RR(t,n,e),r(t[i],u)>0&&RR(t,n,i);c<A;){for(RR(t,c,A),c++,A--;r(t[c],u)<0;)c++;for(;r(t[A],u)>0;)A--}0===r(t[n],u)?RR(t,n,A):RR(t,++A,i),A<=e&&(n=A+1),e<=A&&(i=A-1)}}function RR(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function DR(t,e){return t<e?-1:t>e?1:0}MR.extend=function(t,e){const n=function(){this.init&&this.init()},i=Object.create(TR);i.constructor=n,n.prototype=i,n.type=t;for(const r in e)SR.call(e,r)&&(n.prototype[r]=e[r]);return n.registerAt=IR.bind(n),n};class kR{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!qR(t,e))return n;const i=this.toBBox,r=[];for(;e;){for(let o=0;o<e.children.length;o++){const s=e.children[o],a=e.leaf?i(s):s;qR(t,a)&&(e.leaf?n.push(s):WR(t,a)?this._all(s,n):r.push(s))}e=r.pop()}return n}collides(t){let e=this.data;if(!qR(t,e))return!1;const n=[];for(;e;){for(let i=0;i<e.children.length;i++){const r=e.children[i],o=e.leaf?this.toBBox(r):r;if(qR(t,o)){if(e.leaf||WR(t,o))return!0;n.push(r)}}e=n.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=ZR([]),this}remove(t,e){if(!t)return this;let n=this.data;const i=this.toBBox(t),r=[],o=[];let s,a,h;for(;n||r.length;){if(n||(n=r.pop(),a=r[r.length-1],s=o.pop(),h=!0),n.leaf){const i=LR(t,n.children,e);if(-1!==i)return n.children.splice(i,1),r.push(n),this._condense(r),this}h||n.leaf||!WR(n,i)?a?(s++,n=a.children[s],h=!1):n=null:(r.push(n),o.push(s),s=0,a=n,n=n.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,i){const r=n-e+1;let o,s=this._maxEntries;if(r<=s)return o=ZR(t.slice(e,n+1)),FR(o,this.toBBox),o;i||(i=Math.ceil(Math.log(r)/Math.log(s)),s=Math.ceil(r/Math.pow(s,i-1))),o=ZR([]),o.leaf=!1,o.height=i;const a=Math.ceil(r/s),h=a*Math.ceil(Math.sqrt(s));QR(t,e,n,h,this.compareMinX);for(let l=e;l<=n;l+=h){const e=Math.min(l+h-1,n);QR(t,l,e,a,this.compareMinY);for(let n=l;n<=e;n+=a){const r=Math.min(n+a-1,e);o.children.push(this._build(t,n,r,i-1))}}return FR(o,this.toBBox),o}_chooseSubtree(t,e,n,i){for(;i.push(e),!e.leaf&&i.length-1!==n;){let n,i=1/0,r=1/0;for(let o=0;o<e.children.length;o++){const s=e.children[o],a=jR(s),h=GR(t,s)-a;h<r?(r=h,i=a<i?a:i,n=s):h===r&&a<i&&(i=a,n=s)}e=n||e.children[0]}return e}_insert(t,e,n){const i=n?t:this.toBBox(t),r=[],o=this._chooseSubtree(i,this.data,e,r);for(o.children.push(t),zR(o,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)}_split(t,e){const n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);const o=this._chooseSplitIndex(n,r,i),s=ZR(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,FR(n,this.toBBox),FR(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)}_splitRoot(t,e){this.data=ZR([t,e]),this.data.height=t.height+1,this.data.leaf=!1,FR(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let i,r=1/0,o=1/0;for(let s=e;s<=n-e;s++){const e=NR(t,0,s,this.toBBox),a=NR(t,s,n,this.toBBox),h=VR(e,a),l=jR(e)+jR(a);h<r?(r=h,i=s,o=l<o?l:o):h===r&&l<o&&(o=l,i=s)}return i||n-e}_chooseSplitAxis(t,e,n){const i=t.leaf?this.compareMinX:BR,r=t.leaf?this.compareMinY:HR;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)}_allDistMargin(t,e,n,i){t.children.sort(i);const r=this.toBBox,o=NR(t,0,e,r),s=NR(t,n-e,n,r);let a=UR(o)+UR(s);for(let h=e;h<n-e;h++){const e=t.children[h];zR(o,t.leaf?r(e):e),a+=UR(o)}for(let h=n-e-1;h>=e;h--){const e=t.children[h];zR(s,t.leaf?r(e):e),a+=UR(s)}return a}_adjustParentBBoxes(t,e,n){for(let i=n;i>=0;i--)zR(e[i],t)}_condense(t){for(let e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():FR(t[n],this.toBBox)}}function LR(t,e,n){if(!n)return e.indexOf(t);for(let i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function FR(t,e){NR(t,0,t.children.length,e,t)}function NR(t,e,n,i,r){r||(r=ZR(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(let o=e;o<n;o++){const e=t.children[o];zR(r,t.leaf?i(e):e)}return r}function zR(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function BR(t,e){return t.minX-e.minX}function HR(t,e){return t.minY-e.minY}function jR(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function UR(t){return t.maxX-t.minX+(t.maxY-t.minY)}function GR(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function VR(t,e){const n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,o-i)}function WR(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function qR(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function ZR(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function QR(t,e,n,i,r){const o=[e,n];for(;o.length;){if((n=o.pop())-(e=o.pop())<=i)continue;const s=e+Math.ceil((n-e)/i/2)*i;ER(t,s,e,n,r),o.push(e,s,s,n)}}const XR="${",YR=`function(t){let n;const e={width:100,height:10};let r=!1;try{const t=new OffscreenCanvas(1,1);t.getContext("2d").fillText("hello",0,0),r=!0}catch(t){r=!1}function i(){if(!n){const{width:t,height:i}=e;r?n=new OffscreenCanvas(t,i):(n=document.createElement("canvas"),n.width=t,n.height=i)}return n}class s{constructor(t,n={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let r=1/0,i=-1/0;for(let n=0,e=t.length;n<e;n++){const e=t[n][0];r=Math.min(e,r),i=Math.max(e,i)}this.min=r,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},e,n),this.t()}getImageData(){return this.imgData}t(){const t=i(),{width:n,height:e}=this.options;t.width=n,t.height=e;const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height);const s=r.createLinearGradient(0,0,t.width,0),{colors:o,valueOffset:a}=this;for(let t=0,n=o.length;t<n;t++){const[n,e]=o[t],r=(n-this.min)/a;s.addColorStop(r,e)}r.fillStyle=s,r.fillRect(0,0,t.width,t.height),this.imgData=r.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t);const n=((t=Math.min(t,this.max))-this.min)/this.valueOffset;let e=Math.round(n*this.imgData.width);e=Math.min(e,this.imgData.width-1);const r=4*e;return[this.imgData.data[r],this.imgData.data[r+1],this.imgData.data[r+2],this.imgData.data[r+3]]}}var o;function a(t,n){var e,r,i;if(g(t)){var s,o=t.stops&&"object"==typeof t.stops[0][0],c=o||void 0!==t.property,y=o||!c,m=t.type||n||"exponential";if("exponential"===m)s=h;else if("interval"===m)s=l;else if("categorical"===m)s=u;else if("identity"===m)s=d;else if("color-interpolate"===m)s=f;else{if("calculate-expression"!==m)throw new Error('Unknown function type "'+m+'"');s=p}if(o){var v={},b=[];for(let n=0;n<t.stops.length;n++){var w=t.stops[n];void 0===v[w[0].zoom]&&(v[w[0].zoom]={zoom:w[0].zoom,type:t.type,property:t.property,default:t.default,stops:[]}),v[w[0].zoom].stops.push([w[0].value,w[1]])}for(let t in v)b.push([v[t].zoom,a(v[t])]);e=function(n,e){const r=h({stops:b,base:t.base},n)(n,e);return"function"==typeof r?r(n,e):r},r=!1,i=!1}else y?(e=function(n){const e=s(t,n);return"function"==typeof e?e(n):e},r=!0,i=!1):(e=function(n,e){const r=s(t,e?e[t.property]:null);return"function"==typeof r?r(n,e):r},r=!1,i=!0)}else e=function(){return t},r=!0,i=!0;return e.isZoomConstant=i,e.isFeatureConstant=r,e}function u(t,n){for(let e=0;e<t.stops.length;e++)if(n===t.stops[e][0])return t.stops[e][1];return t.default}function l(t,n){for(var e=0;e<t.stops.length&&!(n<t.stops[e][0]);e++);return t.stops[Math.max(e-1,0)][1]}function h(t,n){for(var e=void 0!==t.base?t.base:1,r=0;!(r>=t.stops.length||n<=t.stops[r][0]);)r++;return 0===r?t.stops[r][1]:r===t.stops.length?t.stops[r-1][1]:y(n,e,t.stops[r-1][0],t.stops[r][0],t.stops[r-1][1],t.stops[r][1])}"function"==typeof Map&&(o=new Map);const c={width:100,height:1};function f(t,n){const e=t.stops;if(e&&e.length>1){let t;if(o){const n=JSON.stringify(e);if(!o.has(n)){const t=new s(e,c);o.set(n,t)}t=o.get(n)}else t=new s(e,c);const[r,i,a,u]=t.getColor(n);return[r/255,i/255,a/255,u/255]}return e&&1===e.length?e[0][1]:null}function d(t,n){return e=n,r=t.default,void 0!==e?e:void 0!==r?r:null;var e,r}function p(t,n){const e=String(t.property),r=t.expression,i=n;function s(n){return null==n||""===n||isNaN(n)?t.default:n}if(null==n||""===n||isNaN(n)||n<0)return s(t.default);{const n=function t(n,e,r){const i=Number(r),s=String(e);return Array.isArray(n)?n.map((n=>t(n,s,i))):n===s?i:n}(r,e,i);return s(function n(e){if(!Array.isArray(e)){if("number"==typeof e)return e;throw new Error("Invalid expression format")}{const r=e[0];if(!["+","-","*","/"].includes(r))throw new Error(\`Unknown operator: ${XR}r}\`);const i=e.slice(1).map((t=>n(t)));switch(r){case"+":return i.reduce(((t,n)=>t+n),0);case"-":return i.reduce(((t,n)=>t-n));case"*":return i.reduce(((t,n)=>t*n),1);case"/":return i.some((t=>0===t))?t.default:i.reduce(((t,n)=>t/n));default:throw new Error(\`Unsupported operator: ${XR}r}\`)}}}(n))}}function y(t,n,e,r,i,s){return"function"==typeof i?function(){var o=i.apply(void 0,arguments),a=s.apply(void 0,arguments);return y(t,n,e,r,o,a)}:i.length?function(t,n,e,r,i,s){var o=[];for(let a=0;a<i.length;a++)o[a]=m(t,n,e,r,i[a],s[a]);return o}(t,n,e,r,i,s):m(t,n,e,r,i,s)}function m(t,n,e,r,i,s){var o,a=r-e,u=t-e;return i*(1-(o=1===n?u/a:(Math.pow(n,u)-1)/(Math.pow(n,a)-1)))+s*o}function g(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type||t.expression&&"calculate-expression"===t.type)}function v(t){return M(t,"exponential")}function b(t){return M(t,"interval")}function w(t,n){if(!t)return null;var e=!1;if(Array.isArray(t)){var r,i=[];for(let s=0;s<t.length;s++)(r=w(t[s],n))?(i.push(r),e=!0):i.push(t[s]);return e?i:t}var s,o={__fn_types_loaded:!0},a=[];for(s in t)t.hasOwnProperty(s)&&a.push(s);const u=function(t){Object.defineProperty(o,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=v(this["_"+t])),this["__fn_"+t].apply(this,n())},set:function(n){this["_"+t]=n},configurable:!0,enumerable:!0})};for(let n=0,r=a.length;n<r;n++)g(t[s=a[n]])?(e=!0,o["_"+s]=t[s],u(s)):o[s]=t[s];return e?o:t}function M(t,n){if(!g(t))return function(){return t};let e=!0,r=!0;const i=(t=JSON.parse(JSON.stringify(t))).stops;if(i)for(let t=0;t<i.length;t++)if(g(i[t][1])){const s=M(i[t][1],n);e=e&&s.isZoomConstant,r=r&&s.isFeatureConstant,i[t]=[i[t][0],s]}const s=a(t,n);return s.isZoomConstant=e&&s.isZoomConstant,s.isFeatureConstant=r&&s.isFeatureConstant,s}let x=0;const F="function"==typeof Object.assign;function k(t,...n){if(F)return Object.assign(t,...n),t;for(let e=0;e<n.length;e++){const r=n[e];for(const n in r)t[n]=r[n]}return t}function A(t){return!O(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function P(t){return"number"==typeof t&&!isNaN(t)}function S(t){return!O(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function _(t){return!Array.isArray(t)&&"object"==typeof t&&!!t}function O(t){return null==t}function C(t){return g(t)&&t.property}const E="function"==typeof fetch&&"function"==typeof AbortController,$={jsonp:function(t,n){const e="_maptalks_jsonp_"+x++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let r=document.createElement("script");return r.type="text/javascript",r.src=t,window[e]=function(t){n(null,t),document.getElementsByTagName("head")[0].removeChild(r),r=null,delete window[e]},document.getElementsByTagName("head")[0].appendChild(r),this},get:function(t,n,e){if(S(n)){const t=e;e=n,n=t}(n=n||{}).method&&(n.method=n.method.toUpperCase());const r="POST"===n.method;if(E){const r=new AbortController,i=n;i.signal=r.signal,i.referrerPolicy=i.referrerPolicy||"origin",i.method=i.method||"GET";const s=new Request(t,i);return n.returnJSON&&s.headers.set("Accept","application/json"),fetch(s).then((r=>{const i=this.o(r,n.returnJSON,n.responseType);i.message?(i.url=t,e(i)):i.then((t=>{"arraybuffer"===n.responseType?e(null,{data:t,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires"),contentType:r.headers.get("Content-Type")}):e(null,t)})).catch((n=>{n.code&&n.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,n),e(n))}))})).catch((n=>{n.code&&n.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,n),e(n))})),r}{const i=$.u(e);if(i.open(n.method||"GET",t,!0),n){for(const t in n.headers)i.setRequestHeader(t,n.headers[t]);i.withCredentials="include"===n.credentials,n.responseType&&(i.responseType=n.responseType)}return i.send(r?n.body:null),i}},o:(t,n,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:\`incorrect http request with status code(${XR}t.status}): ${XR}t.statusText}\`}:"arraybuffer"===e?t.arrayBuffer():n?t.json():t.text(),m:function(t,n){return function(){if(4===t.readyState)if(200===t.status)if("arraybuffer"===t.responseType){0===t.response.byteLength?n({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):n(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")})}else n(null,t.responseText);else n({status:t.status,statusText:t.statusText,message:\`incorrect http request with status code(${XR}t.status}): ${XR}t.statusText}\`})}},u:function(t){let n;try{n=new XMLHttpRequest}catch(t){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return n.onreadystatechange=$.m(n,t),n},getArrayBuffer(t,n,e){if(S(n)){const t=e;e=n,n=t}return n||(n={}),n.responseType="arraybuffer",$.get(t,n,e)}};function I(t,n,e,r,i=3){let s=r;const o=e-n>>1;let a,u=e-n;const l=t[n],h=t[n+1],c=t[e],f=t[e+1];for(let r=n+i;r<e;r+=i){const n=z(t[r],t[r+1],l,h,c,f);if(n>s)a=r,s=n;else if(n===s){const t=Math.abs(r-o);t<u&&(a=r,u=t)}}s>r&&(a-n>i&&I(t,n,a,r,i),t[a+2]=s,e-a>i&&I(t,a,e,r,i))}function z(t,n,e,r,i,s){let o=i-e,a=s-r;if(0!==o||0!==a){const u=((t-e)*o+(n-r)*a)/(o*o+a*a);u>1?(e=i,r=s):u>0&&(e+=o*u,r+=a*u)}return o=t-e,a=n-r,o*o+a*a}function D(t,n,e,r,i,s){const o={id:null==t?null:t,type:n,geometry:e,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};i&&(o.layer=i);return function(t,n){const e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)T(t,e,n);else if("Polygon"===r)T(t,e[0],n);else if("MultiLineString"===r)for(const r of e)T(t,r,n);else if("MultiPolygon"===r)for(const r of e)T(t,r[0],n)}(o,s?4:3),o}function T(t,n,e){for(let r=0;r<n.length;r+=e)t.minX=Math.min(t.minX,n[r]),t.minY=Math.min(t.minY,n[r+1]),t.maxX=Math.max(t.maxX,n[r]),t.maxY=Math.max(t.maxY,n[r+1])}function U(t,n,e,r){if(r.layer=n,"FeatureCollection"===e.type)for(let n=0;n<e.features.length;n++)j(t,e.features[n],r,n);else"Feature"===e.type?j(t,e,r):j(t,{geometry:e},r)}function j(t,n,e,r){if(!n.geometry)return;const i=n.geometry.coordinates,s=n.geometry.type,o=Math.pow(e.tolerance/((1<<e.maxZoom)*e.extent),2);let a=[],u=n.id;if(e.promoteId?u=n.properties[e.promoteId]:e.generateId&&(u=r||0),"Point"===s)N(i,a,e);else if("MultiPoint"===s)for(const t of i)N(t,a,e);else if("LineString"===s)L(i,a,o,!1,e);else if("MultiLineString"===s){if(e.lineMetrics){for(const r of i)a=[],L(r,a,o,!1,e),t.push(D(u,"LineString",a,n.properties,e.layer,e.hasAltitude));return}H(i,a,o,!1,e)}else if("Polygon"===s)H(i,a,o,!0,e);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(const i of n.geometry.geometries)j(t,{id:u,geometry:i,properties:n.properties},e,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of i){const n=[];H(t,n,o,!0,e),a.push(n)}}t.push(D(u,s,a,n.properties,e.layer,e.hasAltitude))}function N(t,n,e){n.push(R(t[0]),V(t[1],e.projection),0),e.hasAltitude&&(t.length>2?n.push(t[2]):n.push(0))}function L(t,n,e,r,i){let s,o,a=0;for(let e=0;e<t.length;e++){const u=R(t[e][0]),l=V(t[e][1],i.projection);n.push(u,l,0),i.hasAltitude&&(t[e].length>2?n.push(t[e][2]):n.push(0)),e>0&&(a+=r?(s*l-u*o)/2:Math.sqrt(Math.pow(u-s,2)+Math.pow(l-o,2))),s=u,o=l}const u=i.hasAltitude?4:3,l=n.length-u;n[2]=1,I(n,0,l,e,u),n[l+2]=1,n.size=Math.abs(a),n.start=0,n.end=n.size}function H(t,n,e,r,i){for(let s=0;s<t.length;s++){const o=[];L(t[s],o,e,r,i),n.push(o)}}function R(t){return t/360+.5}function V(t,n){if("EPSG:4326"===n)return(90-t)/360;const e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function q(t,n,e,r,i,s,o,a){if(r/=n,s>=(e/=n)&&o<r)return t;if(o<e||s>=r)return null;const u=[];for(const n of t){const t=n.geometry;let s=n.type;const o=0===i?n.minX:n.minY,l=0===i?n.maxX:n.maxY;if(o>=e&&l<r){u.push(n);continue}if(l<e||o>=r)continue;let h=[];if("Point"===s||"MultiPoint"===s)G(t,h,e,r,i,a.hasAltitude);else if("LineString"===s)J(t,h,e,r,i,!1,a.lineMetrics,a.hasAltitude);else if("MultiLineString"===s)B(t,h,e,r,i,!1,a.hasAltitude);else if("Polygon"===s)B(t,h,e,r,i,!0,a.hasAltitude);else if("MultiPolygon"===s)for(const n of t){const t=[];B(n,t,e,r,i,!0,a.hasAltitude),t.length&&h.push(t)}if(h.length){if(a.lineMetrics&&"LineString"===s){for(const t of h)u.push(D(n.id,s,t,n.tags,n.layer,a.hasAltitude));continue}"LineString"!==s&&"MultiLineString"!==s||(1===h.length?(s="LineString",h=h[0]):s="MultiLineString"),"Point"!==s&&"MultiPoint"!==s||(s=3===h.length?"Point":"MultiPoint"),u.push(D(n.id,s,h,n.tags,n.layer,a.hasAltitude))}}return u.length?u:null}function G(t,n,e,r,i,s){const o=s?4:3;for(let a=0;a<t.length;a+=o){const o=t[a+i];o>=e&&o<=r&&(X(n,t[a],t[a+1],t[a+2]),s&&n.push(t[a+3]))}}function J(t,n,e,r,i,s,o,a){let u=W(t);const l=0===i?Y:K;let h,c,f=t.start;const d=a?4:3,p=s?t.length:t.length-d;for(let y=0;y<p;y+=d){const m=t[y],g=t[y+1],v=t[y+2];let b,w,M,x;s&&y===p-d?(b=t[0],w=t[1]):(b=t[y+d],w=t[y+d+1]),a&&(M=t[y+3],x=s&&y===p-d?t[3]:t[y+d+3]);const F=0===i?m:g,k=0===i?b:w;let A=!1;o&&(h=Math.sqrt(Math.pow(m-b,2)+Math.pow(g-w,2))),F<e?k>e&&(c=l(u,m,g,b,w,e),a&&u.push(Z(M,x,c)),o&&(u.start=f+h*c)):F>r?k<r&&(c=l(u,m,g,b,w,r),a&&u.push(Z(M,x,c)),o&&(u.start=f+h*c)):(X(u,m,g,v),a&&u.push(M)),k<e&&F>=e&&(c=l(u,m,g,b,w,e),a&&u.push(Z(M,x,c)),A=!0),k>r&&F<=r&&(c=l(u,m,g,b,w,r),a&&u.push(Z(M,x,c)),A=!0),!s&&A&&(o&&(u.end=f+h*c),n.push(u),u=W(t)),o&&(f+=h)}let y=t.length-d;if(!s){const n=t[y],s=t[y+1],o=t[y+2],l=0===i?n:s;if(l>=e&&l<=r&&X(u,n,s,o),l>=e&&l<=r&&a){const n=t[y+3];u.push(n)}}y=u.length-d,s&&y>=d&&(u[y]!==u[0]||u[y+1]!==u[1])&&(X(u,u[0],u[1],u[2]),a&&u.push(u[3])),u.length&&n.push(u)}function W(t){const n=[];return n.size=t.size,n.start=t.start,n.end=t.end,n}function B(t,n,e,r,i,s,o){for(const a of t)J(a,n,e,r,i,s,!1,o)}function X(t,n,e,r){t.push(n,e,r)}function Y(t,n,e,r,i,s){const o=(s-n)/(r-n);return X(t,s,e+(i-e)*o,1),o}function K(t,n,e,r,i,s){const o=(s-e)/(i-e);return X(t,n+(r-n)*o,s,1),o}function Z(t,n,e){return t+(n-t)*e}function Q(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=t[i],o=s.type;let a;if("Point"===o||"MultiPoint"===o||"LineString"===o)a=tt(s.geometry,n,e);else if("MultiLineString"===o||"Polygon"===o){a=[];for(const t of s.geometry)a.push(tt(t,n,e))}else if("MultiPolygon"===o){a=[];for(const t of s.geometry){const r=[];for(const i of t)r.push(tt(i,n,e));a.push(r)}}r.push(D(s.id,o,a,s.tags,s.layer,e))}return r}function tt(t,n,e){const r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);const i=e?4:3;for(let s=0;s<t.length;s+=i)r.push(t[s]+n,t[s+1],t[s+2]),e&&r.push(t[s+3]);return r}function nt(t,n,e){if(t.transformed)return t;const r=1<<t.z,i=t.x,s=t.y,o=e?3:2;for(const a of t.features){const t=a.geometry,u=a.type;if(a.geometry=[],1===u)for(let u=0;u<t.length;u+=o)a.geometry.push(et(t[u],t[u+1],n,r,i,s)),e&&a.geometry[a.geometry.length-1].push(t[u+2]);else for(let u=0;u<t.length;u++){const l=[];for(let a=0;a<t[u].length;a+=o)l.push(et(t[u][a],t[u][a+1],n,r,i,s)),e&&l[l.length-1].push(t[u][a+2]);a.geometry.push(l)}}return t.transformed=!0,t}function et(t,n,e,r,i,s){return[Math.round(e*(t*r-i)),Math.round(e*(n*r-s))]}function rt(t,n,e,r,i){const s=n===i.maxZoom?0:i.tolerance/((1<<n)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:e,y:r,z:n,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const n of t)it(o,n,s,i);return o}function it(t,n,e,r){const i=n.geometry,s=n.type,o=[],a=r.hasAltitude?4:3;if(t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),"Point"===s||"MultiPoint"===s)for(let n=0;n<i.length;n+=a)o.push(i[n],i[n+1]),r.hasAltitude&&o.push(i[n+3]),t.numPoints++,t.numSimplified++;else if("LineString"===s)ot(o,i,t,e,!1,!1,r);else if("MultiLineString"===s||"Polygon"===s)for(let n=0;n<i.length;n++)ot(o,i[n],t,e,"Polygon"===s,0===n,r);else if("MultiPolygon"===s)for(let n=0;n<i.length;n++){const s=i[n];for(let n=0;n<s.length;n++)ot(o,s[n],t,e,!0,0===n,r)}if(o.length){let e=n.tags||null;if("LineString"===s&&r.lineMetrics){e={};for(const t in n.tags)e[t]=n.tags[t];e.mapbox_clip_start=i.start/i.size,e.mapbox_clip_end=i.end/i.size}const a={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:e};n.layer&&(a.layer=n.layer),null!==n.id&&(a.id=n.id),t.features.push(a)}}function st(t,n,e){return 0===t[n+2]&&t[n+3]>0&&e}function ot(t,n,e,r,i,s,o){const a=r*r,{hasAltitude:u,disableFilter:l}=o,h=u?4:3;if(!l&&r>0&&n.size<(i?a:r))return void(e.numPoints+=n.length/h);const c=[];for(let t=0;t<n.length;t+=h)(0===r||n[t+2]>a||st(n,t,u))&&(e.numSimplified++,c.push(n[t],n[t+1]),u&&c.push(n[t+3])),e.numPoints++;i&&function(t,n,e){const r=e?3:2;let i=0;for(let n=0,e=t.length,s=e-r;n<e;s=n,n+=r)i+=(t[n]-t[s])*(t[n+1]+t[s+1]);if(i>0===n){const n=r,i=r-1,s=r-2;for(let o=0,a=t.length;o<a/2;o+=r){const r=t[o],u=t[o+1];let l;e&&(l=t[o+2]),t[o]=t[a-n-o],t[o+1]=t[a-i-o],e&&(t[o+2]=t[a-s-o]),t[a-n-o]=r,t[a-i-o]=u,e&&(t[a-s-o]=l)}}}(c,s,u),t.push(c)}$.getJSON=function(t,n,e){if(S(n)){const t=e;e=n,n=t}const r=function(t,n){const r="string"==typeof n?JSON.parse(n):n||null;e(t,r)};return n&&n.jsonp?$.jsonp(t,r):((n=n||{}).returnJSON=!0,$.get(t,n,r))};const at={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,hasAltitude:!1,disableFilter:!1,debug:0};class ut{constructor(t,n){const e=(n=this.options=function(t,n){for(const e in n)t[e]=n[e];return t}(Object.create(at),n)).debug;if(e&&console.time("preprocess data"),n.maxZoom<0||n.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(n.promoteId&&n.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(t,n){const e=[];if(Array.isArray(t)){for(let r=0;r<t.length;r++)U(e,t[r].layer,t[r].data,n);return e}if("FeatureCollection"===t.type)for(let r=0;r<t.features.length;r++)j(e,t.features[r],n,r);else"Feature"===t.type?j(e,t,n):j(e,{geometry:t},n);return e}(t,n);this.tiles={},this.tileCoords=[],e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",n.indexMaxZoom,n.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,n){const e=n.buffer/n.extent;let r=t;const i=q(t,1,-1-e,e,0,-1,2,n),s=q(t,1,1-e,2+e,0,-1,2,n);return(i||s)&&(r=q(t,1,-e,1+e,0,-1,2,n)||[],i&&(r=Q(i,1,n.hasAltitude).concat(r)),s&&(r=r.concat(Q(s,-1,n.hasAltitude)))),r}(r,n),r.length&&this.splitTile(r,0,0,0),e&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,n,e,r,i,s,o){const a=[t,n,e,r],u=this.options,l=u.debug;for(;a.length;){r=a.pop(),e=a.pop(),n=a.pop(),t=a.pop();const h=1<<n,c=lt(n,e,r);let f=this.tiles[c];if(!f&&(l>1&&console.time("creation"),f=this.tiles[c]=rt(t,n,e,r,u),this.tileCoords.push({z:n,x:e,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",n,e,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));const t=\`z${XR}n}\`;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(f.source=t,null==i){if(n===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue}else{if(n===u.maxZoom||n===i)continue;if(null!=i){const t=i-n;if(e!==s>>t||r!==o>>t)continue}}if(f.source=null,0===t.length)continue;l>1&&console.time("clipping");const d=.5*u.buffer/u.extent,p=.5-d,y=.5+d,m=1+d;let g=null,v=null,b=null,w=null,M=q(t,h,e-d,e+y,0,f.minX,f.maxX,u),x=q(t,h,e+p,e+m,0,f.minX,f.maxX,u);t=null,M&&(g=q(M,h,r-d,r+y,1,f.minY,f.maxY,u),v=q(M,h,r+p,r+m,1,f.minY,f.maxY,u),M=null),x&&(b=q(x,h,r-d,r+y,1,f.minY,f.maxY,u),w=q(x,h,r+p,r+m,1,f.minY,f.maxY,u),x=null),l>1&&console.timeEnd("clipping"),a.push(g||[],n+1,2*e,2*r),a.push(v||[],n+1,2*e,2*r+1),a.push(b||[],n+1,2*e+1,2*r),a.push(w||[],n+1,2*e+1,2*r+1)}}getTile(t,n,e){t=+t,n=+n,e=+e;const r=this.options,{extent:i,debug:s}=r,{hasAltitude:o,wrapX:a}=r;if(t<0||t>24)return null;if(a){const e=1<<t;n=n+e&e-1}const u=lt(t,n,e);if(this.tiles[u])return nt(this.tiles[u],i,o);s>1&&console.log("drilling down to z%d-%d-%d",t,n,e);let l,h=t,c=n,f=e;for(;!l&&h>0;)h--,c>>=1,f>>=1,l=this.tiles[lt(h,c,f)];return l&&l.source?(s>1&&(console.log("found parent tile z%d-%d-%d",h,c,f),console.time("drilling down")),this.splitTile(l.source,h,c,f,t,n,e),s>1&&console.timeEnd("drilling down"),this.tiles[u]?nt(this.tiles[u],i,o):null):null}}function lt(t,n,e){return 32*((1<<t)*e+n)+t}function ht(t,n,e,r,i,s,o){const a=e&&Array.isArray(e[0]);for(let u=0,l=e.length;u<l;u++){t[n]=(a?e[u][0]:e[u].x)*r,t[n+1]=(a?e[u][1]:e[u].y)*r,o!==Float32Array&&(t[n]=Math.round(t[n]),t[n+1]=Math.round(t[n+1]));let h=i||0;Array.isArray(i)&&(h=i[u]),h=h?Math.round(r*h):0,t[n+2]=h,n+=3,s&&0!==u&&u!==l-1&&(t[n]=t[n-3],t[n+1]=t[n-2],t[n+2]=t[n-1],n+=3)}return t.trySetLength&&t.trySetLength(n),n}function ct(t,n,e,r){const i=t[3*n],s=t[3*n+1],o=t[3*e],a=t[3*e+1];return i===o&&(i<0||i>r)||s===a&&(s<0||s>r)}var ft="undefined"!=typeof Float32Array?Float32Array:Array;function dt(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function pt(t,n){var e=n[0],r=n[1],i=n[2],s=e*e+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s,t}function yt(t,n,e){var r=n[0],i=n[1],s=n[2],o=e[0],a=e[1],u=e[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}function mt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function gt(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function vt(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t[3]=n[3]/e[3],t}function bt(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function wt(t,n,e){return t[0]=n,t[1]=e,t}function Mt(t,n){var e=n[0]-t[0],r=n[1]-t[1];return Math.hypot(e,r)}Math.hypot||(Math.hypot=function(){for(var t=0,n=arguments.length;n--;)t+=arguments[n]*arguments[n];return Math.sqrt(t)}),function(){var t,n=(t=new ft(3),ft!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t)}(),function(){var t,n=(t=new ft(4),ft!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var xt=function(t){var n=t[0],e=t[1];return Math.hypot(n,e)};!function(){var t,n=(t=new ft(2),ft!=Float32Array&&(t[0]=0,t[1]=0),t)}();const Ft=Math.PI/180,kt=6378137*Math.PI/180,At=85.0511287798;function Pt(t,n,e){if("EPSG:3857"===e)return function(t,n){const e=At,r=n[0],i=Math.max(Math.min(e,n[1]),-e);let s;s=0===i?0:Math.log(Math.tan((90+i)*Ft/2))/Ft;return t[0]=r*kt,t[1]=s*kt,t}(t,n);if("EPSG:4326"===e||"EPSG:4490"===e||"identity"===e)return St(t,n);if("baidu"===e)return St(t,n);throw new Error("unsupported projection:"+e)}function St(t,n){return t[0]=n[0],t[1]=n[1],t}function _t(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p){0===t?function(t,n,e,r,i,s,o,a,u,l){const h=1/(100*s[0]),c=1/(100*s[1]),f=l&&l[0]||0,d=l&&l[1]||0,p=[0,0];for(let i=t;i<n;i+=3){const t=i/3*2,n=r[i]-f,s=r[i+1]-d;e[t]=p[0]+n/o*h/a,e[t+1]=p[1]-s/o*c/u}}(n,e,r,i,0,o,a,u,l,p):1===t&&function(t,n,e,r,i,s,o,a,u,l,h){if(!t)return;let c,f,d,p;0===t[4]?(c=t[0],f=t[1],d=t[2],p=t[3]):(c=t[1],f=t[2],d=t[3],p=t[0]);const y=Mt(c,f),m=Mt(f,d),g=[],v=[],b=[];for(let t=n;t<e;t+=3){const n=t/3*2;wt(g,(s.x/u+i[t]/o)*a,s.y/u*a+(h?i[t+1]:-i[t+1])/o*a),"EPSG:4326"!==l&&"EPSG:4490"!==l||Pt(g,g,"EPSG:3857"),Ot(v,g,c,f),Ot(b,g,p,c),r[n]=Mt(c,v)/y,r[n+1]=Mt(c,b)/m}}(h,n,e,r,i,s,a,c,f,d,!!p)}function Ot(t,n,e,r){const i=e[0]-r[0],s=e[1]-r[1];let o=(n[0]-e[0])*(e[0]-r[0])+(n[1]-e[1])*(e[1]-r[1]);return o/=i*i+s*s,t[0]=e[0]+o*i,t[1]=e[1]+o*s,t}function Ct(t,n,e,r,i){const s=3*n[e-1],o=3*n[e-1]+1,a=t[s],u=t[o];return l=r,h=i,c=a,f=u,Math.sqrt((c-l)*(c-l)+(f-h)*(f-h));var l,h,c,f}"undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self&&self;function Et(t){return t&&t.M&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var $t={exports:{}};function It(t,n,e){e=e||2;var r,i,s,o,a,u,l,h=n&&n.length,c=h?n[0]*e:t.length,f=zt(t,0,c,e,!0),d=[];if(!f||f.next===f.prev)return d;if(h&&(f=function(t,n,e,r){var i,s,o,a=[];for(i=0,s=n.length;i<s;i++)(o=zt(t,n[i]*r,i<s-1?n[i+1]*r:t.length,r,!1))===o.next&&(o.steiner=!0),a.push(Gt(o));for(a.sort(Ht),i=0;i<a.length;i++)e=Rt(a[i],e);return e}(t,n,f,e)),t.length>80*e){r=s=t[0],i=o=t[1];for(var p=e;p<c;p+=e)(a=t[p])<r&&(r=a),(u=t[p+1])<i&&(i=u),a>s&&(s=a),u>o&&(o=u);l=0!==(l=Math.max(s-r,o-i))?32767/l:0}return Tt(f,d,e,r,i,l,0),d}function zt(t,n,e,r,i){var s,o;if(i===sn(t,n,e,r)>0)for(s=n;s<e;s+=r)o=nn(s,t[s],t[s+1],o);else for(s=e-r;s>=n;s-=r)o=nn(s,t[s],t[s+1],o);return o&&Xt(o,o.next)&&(en(o),o=o.next),o}function Dt(t,n){if(!t)return t;n||(n=t);var e,r=t;do{if(e=!1,r.steiner||!Xt(r,r.next)&&0!==Bt(r.prev,r,r.next))r=r.next;else{if(en(r),(r=n=r.prev)===r.next)break;e=!0}}while(e||r!==n);return n}function Tt(t,n,e,r,i,s,o){if(t){!o&&s&&function(t,n,e,r){var i=t;do{0===i.z&&(i.z=qt(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var n,e,r,i,s,o,a,u,l=1;do{for(e=t,t=null,s=null,o=0;e;){for(o++,r=e,a=0,n=0;n<l&&(a++,r=r.nextZ);n++);for(u=l;a>0||u>0&&r;)0!==a&&(0===u||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,u--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;e=r}s.nextZ=null,l*=2}while(o>1)}(i)}(t,r,i,s);for(var a,u,l=t;t.prev!==t.next;)if(a=t.prev,u=t.next,s?jt(t,r,i,s):Ut(t))n.push(a.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),en(t),t=u.next,l=u.next;else if((t=u)===l){o?1===o?Tt(t=Nt(Dt(t),n,e),n,e,r,i,s,2):2===o&&Lt(t,n,e,r,i,s):Tt(Dt(t),n,e,r,i,s,1);break}}}function Ut(t){var n=t.prev,e=t,r=t.next;if(Bt(n,e,r)>=0)return!1;for(var i=n.x,s=e.x,o=r.x,a=n.y,u=e.y,l=r.y,h=i<s?i<o?i:o:s<o?s:o,c=a<u?a<l?a:l:u<l?u:l,f=i>s?i>o?i:o:s>o?s:o,d=a>u?a>l?a:l:u>l?u:l,p=r.next;p!==n;){if(p.x>=h&&p.x<=f&&p.y>=c&&p.y<=d&&Jt(i,a,s,u,o,l,p.x,p.y)&&Bt(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function jt(t,n,e,r){var i=t.prev,s=t,o=t.next;if(Bt(i,s,o)>=0)return!1;for(var a=i.x,u=s.x,l=o.x,h=i.y,c=s.y,f=o.y,d=a<u?a<l?a:l:u<l?u:l,p=h<c?h<f?h:f:c<f?c:f,y=a>u?a>l?a:l:u>l?u:l,m=h>c?h>f?h:f:c>f?c:f,g=qt(d,p,n,e,r),v=qt(y,m,n,e,r),b=t.prevZ,w=t.nextZ;b&&b.z>=g&&w&&w.z<=v;){if(b.x>=d&&b.x<=y&&b.y>=p&&b.y<=m&&b!==i&&b!==o&&Jt(a,h,u,c,l,f,b.x,b.y)&&Bt(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,w.x>=d&&w.x<=y&&w.y>=p&&w.y<=m&&w!==i&&w!==o&&Jt(a,h,u,c,l,f,w.x,w.y)&&Bt(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;b&&b.z>=g;){if(b.x>=d&&b.x<=y&&b.y>=p&&b.y<=m&&b!==i&&b!==o&&Jt(a,h,u,c,l,f,b.x,b.y)&&Bt(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;w&&w.z<=v;){if(w.x>=d&&w.x<=y&&w.y>=p&&w.y<=m&&w!==i&&w!==o&&Jt(a,h,u,c,l,f,w.x,w.y)&&Bt(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function Nt(t,n,e){var r=t;do{var i=r.prev,s=r.next.next;!Xt(i,s)&&Yt(i,r,r.next,s)&&Qt(i,s)&&Qt(s,i)&&(n.push(i.i/e|0),n.push(r.i/e|0),n.push(s.i/e|0),en(r),en(r.next),r=t=s),r=r.next}while(r!==t);return Dt(r)}function Lt(t,n,e,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Wt(o,a)){var u=tn(o,a);return o=Dt(o,o.next),u=Dt(u,u.next),Tt(o,n,e,r,i,s,0),void Tt(u,n,e,r,i,s,0)}a=a.next}o=o.next}while(o!==t)}function Ht(t,n){return t.x-n.x}function Rt(t,n){var e=function(t,n){var e,r=n,i=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>o&&(o=a,e=r.x<r.next.x?r:r.next,a===i))return e}r=r.next}while(r!==n);if(!e)return null;var u,l=e,h=e.x,c=e.y,f=1/0;r=e;do{i>=r.x&&r.x>=h&&i!==r.x&&Jt(s<c?i:o,s,h,c,s<c?o:i,s,r.x,r.y)&&(u=Math.abs(s-r.y)/(i-r.x),Qt(r,t)&&(u<f||u===f&&(r.x>e.x||r.x===e.x&&Vt(e,r)))&&(e=r,f=u)),r=r.next}while(r!==l);return e}(t,n);if(!e)return n;var r=tn(e,t);return Dt(r,r.next),Dt(e,e.next)}function Vt(t,n){return Bt(t.prev,t,n.prev)<0&&Bt(n.next,t,t.next)<0}function qt(t,n,e,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function Gt(t){var n=t,e=t;do{(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next}while(n!==t);return e}function Jt(t,n,e,r,i,s,o,a){return(i-o)*(n-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(e-o)*(n-a)&&(e-o)*(s-a)>=(i-o)*(r-a)}function Wt(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&Yt(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}(t,n)&&(Qt(t,n)&&Qt(n,t)&&function(t,n){var e=t,r=!1,i=(t.x+n.x)/2,s=(t.y+n.y)/2;do{e.y>s!=e.next.y>s&&e.next.y!==e.y&&i<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==t);return r}(t,n)&&(Bt(t.prev,t,n.prev)||Bt(t,n.prev,n))||Xt(t,n)&&Bt(t.prev,t,t.next)>0&&Bt(n.prev,n,n.next)>0)}function Bt(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Xt(t,n){return t.x===n.x&&t.y===n.y}function Yt(t,n,e,r){var i=Zt(Bt(t,n,e)),s=Zt(Bt(t,n,r)),o=Zt(Bt(e,r,t)),a=Zt(Bt(e,r,n));return i!==s&&o!==a||(!(0!==i||!Kt(t,e,n))||(!(0!==s||!Kt(t,r,n))||(!(0!==o||!Kt(e,t,r))||!(0!==a||!Kt(e,n,r)))))}function Kt(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function Zt(t){return t>0?1:t<0?-1:0}function Qt(t,n){return Bt(t.prev,t,t.next)<0?Bt(t,n,t.next)>=0&&Bt(t,t.prev,n)>=0:Bt(t,n,t.prev)<0||Bt(t,t.next,n)<0}function tn(t,n){var e=new rn(t.i,t.x,t.y),r=new rn(n.i,n.x,n.y),i=t.next,s=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function nn(t,n,e,r){var i=new rn(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function en(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function rn(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function sn(t,n,e,r){for(var i=0,s=n,o=e-r;s<e;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}$t.exports=It,$t.exports.default=It,It.deviation=function(t,n,e,r){var i=n&&n.length,s=i?n[0]*e:t.length,o=Math.abs(sn(t,0,s,e));if(i)for(var a=0,u=n.length;a<u;a++){var l=n[a]*e,h=a<u-1?n[a+1]*e:t.length;o-=Math.abs(sn(t,l,h,e))}var c=0;for(a=0;a<r.length;a+=3){var f=r[a]*e,d=r[a+1]*e,p=r[a+2]*e;c+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},It.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<n;o++)e.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e};var on=Et($t.exports),an=un;function un(t,n){this.x=t,this.y=n}un.prototype={clone:function(){return new un(this.x,this.y)},add:function(t){return this.clone().F(t)},sub:function(t){return this.clone().k(t)},multByPoint:function(t){return this.clone().A(t)},divByPoint:function(t){return this.clone().P(t)},mult:function(t){return this.clone().S(t)},div:function(t){return this.clone().O(t)},rotate:function(t){return this.clone().C(t)},rotateAround:function(t,n){return this.clone().I(t,n)},matMult:function(t){return this.clone().D(t)},unit:function(){return this.clone().T()},perp:function(){return this.clone().U()},round:function(){return this.clone().j()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,e=t.y-this.y;return n*n+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},D:function(t){var n=t[0]*this.x+t[1]*this.y,e=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=e,this},F:function(t){return this.x+=t.x,this.y+=t.y,this},k:function(t){return this.x-=t.x,this.y-=t.y,this},S:function(t){return this.x*=t,this.y*=t,this},O:function(t){return this.x/=t,this.y/=t,this},A:function(t){return this.x*=t.x,this.y*=t.y,this},P:function(t){return this.x/=t.x,this.y/=t.y,this},T:function(){return this.O(this.mag()),this},U:function(){var t=this.y;return this.y=this.x,this.x=-t,this},C:function(t){var n=Math.cos(t),e=Math.sin(t),r=n*this.x-e*this.y,i=e*this.x+n*this.y;return this.x=r,this.y=i,this},I:function(t,n){var e=Math.cos(t),r=Math.sin(t),i=n.x+e*(this.x-n.x)-r*(this.y-n.y),s=n.y+r*(this.x-n.x)+e*(this.y-n.y);return this.x=i,this.y=s,this},j:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},un.convert=function(t){return t instanceof un?t:Array.isArray(t)?new un(t[0],t[1]):t};var ln=Et(an);const hn={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function cn(t,n={}){var e=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)fn(e,t.features[r],n,r);else"Feature"===t.type?fn(e,t,n):fn(e,{geometry:t},n);return e}function fn(t,n,e,r){if(n.geometry&&n.geometry.geometry){var i=n.geometry.coordinates,s=n.geometry.type,o=[],a=n.id;if(e.promoteId?a=n.properties[e.promoteId]:e.generateId&&(a=r||0),"Point"===s)dn(i,o);else if("MultiPoint"===s)for(var u=0;u<i.length;u++)dn(i[u],o);else if("LineString"===s)yn([i],o);else if("MultiLineString"===s){if(e.lineMetrics){for(u=0;u<i.length;u++)o=[],pn(i[u],o),t.push(mn(a,"LineString",o,n.properties));return}yn(i,o)}else if("Polygon"===s)yn(i,o);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(u=0;u<n.geometry.geometries.length;u++)fn(t,{id:a,geometry:n.geometry.geometries[u],properties:n.properties},e,r);return}return void console.warn(\`Input data type(${XR}s}) is not a valid GeoJSON geometry type.\`)}for(u=0;u<i.length;u++){var l=[];yn(i[u],l),o.push(l)}}t.push(mn(a,s,o,n.properties))}}function dn(t,n){const e=new ln(t[0],t[1]);e.z=100*(t[2]||0),n.push([e])}function pn(t,n){for(let e=0;e<t.length;e++){const r=t[e][0],i=t[e][1],s=new ln(r,i);s.z=100*(t[e][2]||0),n.push(s)}}function yn(t,n,e,r){for(var i=0;i<t.length;i++){var s=[];pn(t[i],s),n.push(s)}}function mn(t,n,e,r){return{id:void 0===t?null:t,type:hn[n],geometry:e,properties:r}}function gn(t,n,e){e=e||{},this.w=t||64,this.h=n||64,this.autoResize=!!e.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function vn(t,n,e){this.x=0,this.y=t,this.w=this.free=n,this.h=e}function bn(t,n,e,r,i,s,o){this.id=t,this.x=n,this.y=e,this.w=r,this.h=i,this.maxw=s||r,this.maxh=o||i,this.refcount=0}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */function wn(t,{width:n,height:e},r,i){if(i){if(i.length!==n*e*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(n*e*r);return t.width=n,t.height=e,t.data=i,t}function Mn(t,{width:n,height:e},r){if(n===t.width&&e===t.height)return;const i=wn({},{width:n,height:e},r);xn(t,i,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,e)},r),t.width=n,t.height=e,t.data=i.data}function xn(t,n,e,r,i,s){if(0===i.width||0===i.height)return n;if(i.width>t.width||i.height>t.height||e.x>t.width-i.width||e.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>n.width||i.height>n.height||r.x>n.width-i.width||r.y>n.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,a=n.data;if(o===a)return n;for(let u=0;u<i.height;u++){const l=((e.y+u)*t.width+e.x)*s,h=((r.y+u)*n.width+r.x)*s;for(let t=0;t<i.width*s;t++)a[h+t]=o[l+t]}return n}gn.prototype.pack=function(t,n){t=[].concat(t),n=n||{};for(var e,r,i,s,o=[],a=0;a<t.length;a++)if(e=t[a].w||t[a].width,r=t[a].h||t[a].height,i=t[a].id,e&&r){if(!(s=this.packOne(e,r,i)))continue;n.inPlace&&(t[a].x=s.x,t[a].y=s.y,t[a].id=s.id),o.push(s)}return this.shrink(),o},gn.prototype.packOne=function(t,n,e){var r,i,s,o,a,u,l,h,c={freebin:-1,shelf:-1,waste:1/0},f=0;if("string"==typeof e||"number"==typeof e){if(r=this.getBin(e))return this.ref(r),r;"number"==typeof e&&(this.maxId=Math.max(e,this.maxId))}else e=++this.maxId;for(o=0;o<this.freebins.length;o++){if(n===(r=this.freebins[o]).maxh&&t===r.maxw)return this.allocFreebin(o,t,n,e);n>r.maxh||t>r.maxw||n<=r.maxh&&t<=r.maxw&&(s=r.maxw*r.maxh-t*n)<c.waste&&(c.waste=s,c.freebin=o)}for(o=0;o<this.shelves.length;o++)if(f+=(i=this.shelves[o]).h,!(t>i.free)){if(n===i.h)return this.allocShelf(o,t,n,e);n>i.h||n<i.h&&(s=(i.h-n)*t)<c.waste&&(c.freebin=-1,c.waste=s,c.shelf=o)}return-1!==c.freebin?this.allocFreebin(c.freebin,t,n,e):-1!==c.shelf?this.allocShelf(c.shelf,t,n,e):n<=this.h-f&&t<=this.w?(i=new vn(f,this.w,n),this.allocShelf(this.shelves.push(i)-1,t,n,e)):this.autoResize?(a=u=this.h,((l=h=this.w)<=a||t>l)&&(h=2*Math.max(t,l)),(a<l||n>a)&&(u=2*Math.max(n,a)),this.resize(h,u),this.packOne(t,n,e)):null},gn.prototype.allocFreebin=function(t,n,e,r){var i=this.freebins.splice(t,1)[0];return i.id=r,i.w=n,i.h=e,i.refcount=0,this.bins[r]=i,this.ref(i),i},gn.prototype.allocShelf=function(t,n,e,r){var i=this.shelves[t].alloc(n,e,r);return this.bins[r]=i,this.ref(i),i},gn.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,n=0,e=0;e<this.shelves.length;e++){var r=this.shelves[e];n+=r.h,t=Math.max(r.w-r.free,t)}this.resize(t,n)}},gn.prototype.getBin=function(t){return this.bins[t]},gn.prototype.ref=function(t){if(1==++t.refcount){var n=t.h;this.stats[n]=1+(0|this.stats[n])}return t.refcount},gn.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},gn.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},gn.prototype.resize=function(t,n){this.w=t,this.h=n;for(var e=0;e<this.shelves.length;e++)this.shelves[e].resize(t);return!0},vn.prototype.alloc=function(t,n,e){if(t>this.free||n>this.h)return null;var r=this.x;return this.x+=t,this.free-=t,new bn(e,r,this.y,t,n,t,this.h)},vn.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};class Fn{constructor(t,n){wn(this,t,1,n)}resize(t){Mn(this,t,1)}clone(){return new Fn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,e,r,i){xn(t,n,e,r,i,1)}}class kn{constructor(t,n){wn(this,t,4,n)}resize(t){Mn(this,t,4)}clone(){return new kn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,e,r,i){xn(t,n,e,r,i,4)}}function An(t){let n=0;for(let e,r,i=0,s=t.length,o=s-1;i<s;o=i++)if(e=t[i],r=t[o],void 0!==e.x){if(e.z||r.z)return 1;n+=(r.x-e.x)*(e.y+r.y)}else{if(e[2]||r[2])return 1;n+=(r[0]-e[0])*(e[1]+r[1])}return n}function Pn(t,n,e,r,i){const s=t[n*r],o=t[n*r+1],a=t[e*r],u=t[e*r+1];return s===a&&(s<0||s>i)&&o!==u||o===u&&(o<0||o>i)&&s!==a}function Sn(t,n,e){let r=e;return n&&t&&(r=+t[n]),isNaN(r)&&(r=e||0),100*r}function _n(t,n,e,r,i,s,o){n||0===n||(n=1);const a=Sn(t.properties,e,r),u=a*n;let l=(s?100*s:0)||a;return i?l=Sn(t.properties,i,s):o&&(l=a-Sn(t.properties,o,s)),l*=n,{altitude:u,height:l}}function On(t,n){return n<1/0&&(t.x<0||t.x>n||t.y<0||t.y>n)}function Cn(t){return null==t}function En(t,n,e){if(t===e||t===n)return t;const r=e-n;return((t-n)%r+r)%r+n}function $n(t,n){if(!n)return null;const e=new Map;for(let r=0;r<n.length;r++){const i=n[r],s=t[i];let o=e.get(s);o||(o=[],e.set(s,o)),o.push(i)}return e}function In(t){return!(t&t-1)&&0!==t}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */class zn{constructor(t,n,{pixelRatio:e}){this.paddedRect=t,this.pixelRatio=e||1,this.padding=n}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Dn{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,n=Object.keys(t).length,e={},r=new gn(0,0,{autoResize:!0}),i=[],s=n>1?1:0;for(const n in t){const r=t[n],o={x:0,y:0,w:r.data.width+2*s,h:r.data.height+2*s};i.push(o),e[n]=new zn(o,s,r)}if(r.pack(i,{inPlace:!0}),!In(r.w)||!In(r.h)){const t=Tn(r.w),n=Tn(r.h);r.resize(t,n)}const o=new kn({width:r.w,height:r.h});for(const n in t){const r=t[n],i=e[n].paddedRect;kn.copy(r.data,o,{x:0,y:0},{x:i.x+s,y:i.y+s},r.data)}this.image=o,this.positions=e}}function Tn(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     * TODO 升级为potpack\n     */class Un{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,n={},e=new gn(0,0,{autoResize:!0}),r=[];for(const e in t){const i=t[e],s=n[e]={};for(const t in i){const n=i[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const e={x:0,y:0,w:n.bitmap.width+2,h:n.bitmap.height+2};r.push(e),s[t]={rect:e,metrics:n.metrics}}}e.pack(r,{inPlace:!0});const i=new Fn({width:e.w,height:e.h});for(const e in t){const r=t[e];for(const t in r){const s=r[+t];if(!s||0===s.bitmap.width||0===s.bitmap.height)continue;const o=n[e][t].rect;Fn.copy(s.bitmap,i,{x:0,y:0},{x:o.x+1,y:o.y+1},s.bitmap)}}this.image=i,this.positions=n}}function jn(t){return t<65536?Uint16Array:Uint32Array}function Nn(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:(Math.pow(2,24),Float32Array)}function Ln(t){return t<256?Uint8Array:t<65536?Uint16Array:Float32Array}function Hn(t,n){const e=t.getLength?t.getLength():t.length;if(t instanceof n)return t.slice(0,e);const r=new n(e);t=t.L||t;for(let n=0;n<e;n++)r[n]=t[n]||0;return r}function Rn(t){const n=t.type,e=[];if(1===n||4===n)for(let n=0;n<t.geometry.length;n++)dn(t.geometry[n],e);else if(2===n)yn(t.geometry,e);else if(3===n)yn(t.geometry,e);else if(5===n)yn(t.geometry,e);else if(6===n)for(let n=0;n<t.geometry.length;n++){const r=[];yn(t.geometry[n],r),e.push(r)}return t.geometry=e,t}var Vn={exports:{}},qn={exports:{}},Gn=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},Jn=Array.prototype.concat,Wn=Array.prototype.slice,Bn=qn.exports=function(t){for(var n=[],e=0,r=t.length;e<r;e++){var i=t[e];Gn(i)?n=Jn.call(n,Wn.call(i)):n.push(i)}return n};Bn.wrap=function(t){return function(){return t(Bn(arguments))}};var Xn=qn.exports,Yn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},Kn=Xn,Zn=Object.hasOwnProperty,Qn=Object.create(null);for(var te in Yn)Zn.call(Yn,te)&&(Qn[Yn[te]]=te);var ne=Vn.exports={to:{},get:{}};function ee(t,n,e){return Math.min(Math.max(n,t),e)}function re(t){var n=Math.round(t).toString(16).toUpperCase();return n.length<2?"0"+n:n}ne.get=function(t){var n,e;switch(t.substring(0,3).toLowerCase()){case"hsl":n=ne.get.hsl(t),e="hsl";break;case"hwb":n=ne.get.hwb(t),e="hwb";break;default:n=ne.get.rgb(t),e="rgb"}return n?{model:e,value:n}:null},ne.get.rgb=function(t){if(!t)return null;var n,e,r,i=[0,0,0,1];if(n=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=n[2],n=n[1],e=0;e<3;e++){var s=2*e;i[e]=parseInt(n.slice(s,s+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(n=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(n=n[1])[3],e=0;e<3;e++)i[e]=parseInt(n[e]+n[e],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(n=t.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(e=0;e<3;e++)i[e]=parseInt(n[e+1],0);n[4]&&(n[5]?i[3]=.01*parseFloat(n[4]):i[3]=parseFloat(n[4]))}else{if(!(n=t.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(n=t.match(/^(\\w+)$/))?"transparent"===n[1]?[0,0,0,0]:Zn.call(Yn,n[1])?((i=Yn[n[1]])[3]=1,i):null:null;for(e=0;e<3;e++)i[e]=Math.round(2.55*parseFloat(n[e+1]));n[4]&&(n[5]?i[3]=.01*parseFloat(n[4]):i[3]=parseFloat(n[4]))}for(e=0;e<3;e++)i[e]=ee(i[e],0,255);return i[3]=ee(i[3],0,1),i},ne.get.hsl=function(t){if(!t)return null;var n=t.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(n){var e=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,ee(parseFloat(n[2]),0,100),ee(parseFloat(n[3]),0,100),ee(isNaN(e)?1:e,0,1)]}return null},ne.get.hwb=function(t){if(!t)return null;var n=t.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(n){var e=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,ee(parseFloat(n[2]),0,100),ee(parseFloat(n[3]),0,100),ee(isNaN(e)?1:e,0,1)]}return null},ne.to.hex=function(){var t=Kn(arguments);return"#"+re(t[0])+re(t[1])+re(t[2])+(t[3]<1?re(Math.round(255*t[3])):"")},ne.to.rgb=function(){var t=Kn(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},ne.to.rgb.percent=function(){var t=Kn(arguments),n=Math.round(t[0]/255*100),e=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+n+"%, "+e+"%, "+r+"%)":"rgba("+n+"%, "+e+"%, "+r+"%, "+t[3]+")"},ne.to.hsl=function(){var t=Kn(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},ne.to.hwb=function(){var t=Kn(arguments),n="";return t.length>=4&&1!==t[3]&&(n=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+n+")"},ne.to.keyword=function(t){return Qn[t.slice(0,3)]};var ie=Vn.exports,se={exports:{}},oe={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},ae={};for(var ue in oe)oe.hasOwnProperty(ue)&&(ae[oe[ue]]=ue);var le=se.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var he in le)if(le.hasOwnProperty(he)){if(!("channels"in le[he]))throw new Error("missing channels property: "+he);if(!("labels"in le[he]))throw new Error("missing channel labels property: "+he);if(le[he].labels.length!==le[he].channels)throw new Error("channel and label counts mismatch: "+he);var ce=le[he].channels,fe=le[he].labels;delete le[he].channels,delete le[he].labels,Object.defineProperty(le[he],"channels",{value:ce}),Object.defineProperty(le[he],"labels",{value:fe})}le.rgb.hsl=function(t){var n,e,r=t[0]/255,i=t[1]/255,s=t[2]/255,o=Math.min(r,i,s),a=Math.max(r,i,s),u=a-o;return a===o?n=0:r===a?n=(i-s)/u:i===a?n=2+(s-r)/u:s===a&&(n=4+(r-i)/u),(n=Math.min(60*n,360))<0&&(n+=360),e=(o+a)/2,[n,100*(a===o?0:e<=.5?u/(a+o):u/(2-a-o)),100*e]},le.rgb.hsv=function(t){var n,e,r,i,s,o=t[0]/255,a=t[1]/255,u=t[2]/255,l=Math.max(o,a,u),h=l-Math.min(o,a,u),c=function(t){return(l-t)/6/h+.5};return 0===h?i=s=0:(s=h/l,n=c(o),e=c(a),r=c(u),o===l?i=r-e:a===l?i=1/3+n-r:u===l&&(i=2/3+e-n),i<0?i+=1:i>1&&(i-=1)),[360*i,100*s,100*l]},le.rgb.hwb=function(t){var n=t[0],e=t[1],r=t[2];return[le.rgb.hsl(t)[0],100*(1/255*Math.min(n,Math.min(e,r))),100*(r=1-1/255*Math.max(n,Math.max(e,r)))]},le.rgb.cmyk=function(t){var n,e=t[0]/255,r=t[1]/255,i=t[2]/255;return[100*((1-e-(n=Math.min(1-e,1-r,1-i)))/(1-n)||0),100*((1-r-n)/(1-n)||0),100*((1-i-n)/(1-n)||0),100*n]},le.rgb.keyword=function(t){var n=ae[t];if(n)return n;var e,r,i,s=1/0;for(var o in oe)if(oe.hasOwnProperty(o)){var a=oe[o],u=(r=t,i=a,Math.pow(r[0]-i[0],2)+Math.pow(r[1]-i[1],2)+Math.pow(r[2]-i[2],2));u<s&&(s=u,e=o)}return e},le.keyword.rgb=function(t){return oe[t]},le.rgb.xyz=function(t){var n=t[0]/255,e=t[1]/255,r=t[2]/255;return[100*(.4124*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.3576*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*n+.7152*e+.0722*r),100*(.0193*n+.1192*e+.9505*r)]},le.rgb.lab=function(t){var n=le.rgb.xyz(t),e=n[0],r=n[1],i=n[2];return r/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(e-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},le.hsl.rgb=function(t){var n,e,r,i,s,o=t[0]/360,a=t[1]/100,u=t[2]/100;if(0===a)return[s=255*u,s,s];n=2*u-(e=u<.5?u*(1+a):u+a-u*a),i=[0,0,0];for(var l=0;l<3;l++)(r=o+1/3*-(l-1))<0&&r++,r>1&&r--,s=6*r<1?n+6*(e-n)*r:2*r<1?e:3*r<2?n+(e-n)*(2/3-r)*6:n,i[l]=255*s;return i},le.hsl.hsv=function(t){var n=t[0],e=t[1]/100,r=t[2]/100,i=e,s=Math.max(r,.01);return e*=(r*=2)<=1?r:2-r,i*=s<=1?s:2-s,[n,100*(0===r?2*i/(s+i):2*e/(r+e)),100*((r+e)/2)]},le.hsv.rgb=function(t){var n=t[0]/60,e=t[1]/100,r=t[2]/100,i=Math.floor(n)%6,s=n-Math.floor(n),o=255*r*(1-e),a=255*r*(1-e*s),u=255*r*(1-e*(1-s));switch(r*=255,i){case 0:return[r,u,o];case 1:return[a,r,o];case 2:return[o,r,u];case 3:return[o,a,r];case 4:return[u,o,r];case 5:return[r,o,a]}},le.hsv.hsl=function(t){var n,e,r,i=t[0],s=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return r=(2-s)*o,e=s*a,[i,100*(e=(e/=(n=(2-s)*a)<=1?n:2-n)||0),100*(r/=2)]},le.hwb.rgb=function(t){var n,e,r,i,s,o,a,u=t[0]/360,l=t[1]/100,h=t[2]/100,c=l+h;switch(c>1&&(l/=c,h/=c),r=6*u-(n=Math.floor(6*u)),1&n&&(r=1-r),i=l+r*((e=1-h)-l),n){default:case 6:case 0:s=e,o=i,a=l;break;case 1:s=i,o=e,a=l;break;case 2:s=l,o=e,a=i;break;case 3:s=l,o=i,a=e;break;case 4:s=i,o=l,a=e;break;case 5:s=e,o=l,a=i}return[255*s,255*o,255*a]},le.cmyk.rgb=function(t){var n=t[0]/100,e=t[1]/100,r=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},le.xyz.rgb=function(t){var n,e,r,i=t[0]/100,s=t[1]/100,o=t[2]/100;return e=-.9689*i+1.8758*s+.0415*o,r=.0557*i+-.204*s+1.057*o,n=(n=3.2406*i+-1.5372*s+-.4986*o)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(n=Math.min(Math.max(0,n),1)),255*(e=Math.min(Math.max(0,e),1)),255*(r=Math.min(Math.max(0,r),1))]},le.xyz.lab=function(t){var n=t[0],e=t[1],r=t[2];return e/=100,r/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116)-16,500*(n-e),200*(e-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},le.lab.xyz=function(t){var n,e,r,i=t[0];n=t[1]/500+(e=(i+16)/116),r=e-t[2]/200;var s=Math.pow(e,3),o=Math.pow(n,3),a=Math.pow(r,3);return e=s>.008856?s:(e-16/116)/7.787,n=o>.008856?o:(n-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[n*=95.047,e*=100,r*=108.883]},le.lab.lch=function(t){var n,e=t[0],r=t[1],i=t[2];return(n=360*Math.atan2(i,r)/2/Math.PI)<0&&(n+=360),[e,Math.sqrt(r*r+i*i),n]},le.lch.lab=function(t){var n,e=t[0],r=t[1];return n=t[2]/360*2*Math.PI,[e,r*Math.cos(n),r*Math.sin(n)]},le.rgb.ansi16=function(t){var n=t[0],e=t[1],r=t[2],i=1 in arguments?arguments[1]:le.rgb.hsv(t)[2];if(0===(i=Math.round(i/50)))return 30;var s=30+(Math.round(r/255)<<2|Math.round(e/255)<<1|Math.round(n/255));return 2===i&&(s+=60),s},le.hsv.ansi16=function(t){return le.rgb.ansi16(le.hsv.rgb(t),t[2])},le.rgb.ansi256=function(t){var n=t[0],e=t[1],r=t[2];return n===e&&e===r?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(e/255*5)+Math.round(r/255*5)},le.ansi16.rgb=function(t){var n=t%10;if(0===n||7===n)return t>50&&(n+=3.5),[n=n/10.5*255,n,n];var e=.5*(1+~~(t>50));return[(1&n)*e*255,(n>>1&1)*e*255,(n>>2&1)*e*255]},le.ansi256.rgb=function(t){if(t>=232){var n=10*(t-232)+8;return[n,n,n]}var e;return t-=16,[Math.floor(t/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},le.rgb.hex=function(t){var n=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},le.hex.rgb=function(t){var n=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];var e=n[0];3===n[0].length&&(e=e.split("").map((function(t){return t+t})).join(""));var r=parseInt(e,16);return[r>>16&255,r>>8&255,255&r]},le.rgb.hcg=function(t){var n,e=t[0]/255,r=t[1]/255,i=t[2]/255,s=Math.max(Math.max(e,r),i),o=Math.min(Math.min(e,r),i),a=s-o;return n=a<=0?0:s===e?(r-i)/a%6:s===r?2+(i-e)/a:4+(e-r)/a+4,n/=6,[360*(n%=1),100*a,100*(a<1?o/(1-a):0)]},le.hsl.hcg=function(t){var n=t[1]/100,e=t[2]/100,r=1,i=0;return(r=e<.5?2*n*e:2*n*(1-e))<1&&(i=(e-.5*r)/(1-r)),[t[0],100*r,100*i]},le.hsv.hcg=function(t){var n=t[1]/100,e=t[2]/100,r=n*e,i=0;return r<1&&(i=(e-r)/(1-r)),[t[0],100*r,100*i]},le.hcg.rgb=function(t){var n=t[0]/360,e=t[1]/100,r=t[2]/100;if(0===e)return[255*r,255*r,255*r];var i,s=[0,0,0],o=n%1*6,a=o%1,u=1-a;switch(Math.floor(o)){case 0:s[0]=1,s[1]=a,s[2]=0;break;case 1:s[0]=u,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=a;break;case 3:s[0]=0,s[1]=u,s[2]=1;break;case 4:s[0]=a,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=u}return i=(1-e)*r,[255*(e*s[0]+i),255*(e*s[1]+i),255*(e*s[2]+i)]},le.hcg.hsv=function(t){var n=t[1]/100,e=n+t[2]/100*(1-n),r=0;return e>0&&(r=n/e),[t[0],100*r,100*e]},le.hcg.hsl=function(t){var n=t[1]/100,e=t[2]/100*(1-n)+.5*n,r=0;return e>0&&e<.5?r=n/(2*e):e>=.5&&e<1&&(r=n/(2*(1-e))),[t[0],100*r,100*e]},le.hcg.hwb=function(t){var n=t[1]/100,e=n+t[2]/100*(1-n);return[t[0],100*(e-n),100*(1-e)]},le.hwb.hcg=function(t){var n=t[1]/100,e=1-t[2]/100,r=e-n,i=0;return r<1&&(i=(e-r)/(1-r)),[t[0],100*r,100*i]},le.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},le.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},le.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},le.gray.hsl=le.gray.hsv=function(t){return[0,0,t[0]]},le.gray.hwb=function(t){return[0,100,t[0]]},le.gray.cmyk=function(t){return[0,0,0,t[0]]},le.gray.lab=function(t){return[t[0],0,0]},le.gray.hex=function(t){var n=255&Math.round(t[0]/100*255),e=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(e.length)+e},le.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var de=se.exports,pe=de;function ye(t){var n=function(){for(var t={},n=Object.keys(pe),e=n.length,r=0;r<e;r++)t[n[r]]={distance:-1,parent:null};return t}(),e=[t];for(n[t].distance=0;e.length;)for(var r=e.pop(),i=Object.keys(pe[r]),s=i.length,o=0;o<s;o++){var a=i[o],u=n[a];-1===u.distance&&(u.distance=n[r].distance+1,u.parent=r,e.unshift(a))}return n}function me(t,n){return function(e){return n(t(e))}}function ge(t,n){for(var e=[n[t].parent,t],r=pe[n[t].parent][t],i=n[t].parent;n[i].parent;)e.unshift(n[i].parent),r=me(pe[n[i].parent][i],r),i=n[i].parent;return r.conversion=e,r}var ve=de,be=function(t){for(var n=ye(t),e={},r=Object.keys(n),i=r.length,s=0;s<i;s++){var o=r[s];null!==n[o].parent&&(e[o]=ge(o,n))}return e},we={};Object.keys(ve).forEach((function(t){we[t]={},Object.defineProperty(we[t],"channels",{value:ve[t].channels}),Object.defineProperty(we[t],"labels",{value:ve[t].labels});var n=be(t);Object.keys(n).forEach((function(e){var r=n[e];we[t][e]=function(t){var n=function(n){if(null==n)return n;arguments.length>1&&(n=Array.prototype.slice.call(arguments));var e=t(n);if("object"==typeof e)for(var r=e.length,i=0;i<r;i++)e[i]=Math.round(e[i]);return e};return"conversion"in t&&(n.conversion=t.conversion),n}(r),we[t][e].raw=function(t){var n=function(n){return null==n?n:(arguments.length>1&&(n=Array.prototype.slice.call(arguments)),t(n))};return"conversion"in t&&(n.conversion=t.conversion),n}(r)}))}));var Me=ie,xe=we,Fe=[].slice,ke=["keyword","gray","hex"],Ae={};Object.keys(xe).forEach((function(t){Ae[Fe.call(xe[t].labels).sort().join("")]=t}));var Pe={};function Se(t,n){if(!(this instanceof Se))return new Se(t,n);if(n&&n in ke&&(n=null),n&&!(n in xe))throw new Error("Unknown model: "+n);var e,r;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof Se)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var i=Me.get(t);if(null===i)throw new Error("Unable to parse color from string: "+t);this.model=i.model,r=xe[this.model].channels,this.color=i.value.slice(0,r),this.valpha="number"==typeof i.value[r]?i.value[r]:1}else if(t.length){this.model=n||"rgb",r=xe[this.model].channels;var s=Fe.call(t,0,r);this.color=Ce(s,r),this.valpha="number"==typeof t[r]?t[r]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var o=Object.keys(t);"alpha"in t&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=o.sort().join("");if(!(a in Ae))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=Ae[a];var u=xe[this.model].labels,l=[];for(e=0;e<u.length;e++)l.push(t[u[e]]);this.color=Ce(l)}if(Pe[this.model])for(r=xe[this.model].channels,e=0;e<r;e++){var h=Pe[this.model][e];h&&(this.color[e]=h(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function _e(t,n,e){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(Pe[t]||(Pe[t]=[]))[n]=e})),t=t[0],function(r){var i;return arguments.length?(e&&(r=e(r)),(i=this[t]()).color[n]=r,i):(i=this[t]().color[n],e&&(i=e(i)),i)}}function Oe(t){return function(n){return Math.max(0,Math.min(t,n))}}function Ce(t,n){for(var e=0;e<n;e++)"number"!=typeof t[e]&&(t[e]=0);return t}Se.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var n=this.model in Me.to?this:this.rgb(),e=1===(n=n.round("number"==typeof t?t:1)).valpha?n.color:n.color.concat(this.valpha);return Me.to[n.model](e)},percentString:function(t){var n=this.rgb().round("number"==typeof t?t:1),e=1===n.valpha?n.color:n.color.concat(this.valpha);return Me.to.rgb.percent(e)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},n=xe[this.model].channels,e=xe[this.model].labels,r=0;r<n;r++)t[e[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new Se(this.color.map(function(t){return function(n){return function(t,n){return Number(t.toFixed(n))}(n,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new Se(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:_e("rgb",0,Oe(255)),green:_e("rgb",1,Oe(255)),blue:_e("rgb",2,Oe(255)),hue:_e(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:_e("hsl",1,Oe(100)),lightness:_e("hsl",2,Oe(100)),saturationv:_e("hsv",1,Oe(100)),value:_e("hsv",2,Oe(100)),chroma:_e("hcg",1,Oe(100)),gray:_e("hcg",2,Oe(100)),white:_e("hwb",1,Oe(100)),wblack:_e("hwb",2,Oe(100)),cyan:_e("cmyk",0,Oe(100)),magenta:_e("cmyk",1,Oe(100)),yellow:_e("cmyk",2,Oe(100)),black:_e("cmyk",3,Oe(100)),x:_e("xyz",0,Oe(100)),y:_e("xyz",1,Oe(100)),z:_e("xyz",2,Oe(100)),l:_e("lab",0,Oe(100)),a:_e("lab",1),b:_e("lab",2),keyword:function(t){return arguments.length?new Se(t):xe[this.model].keyword(this.color)},hex:function(t){return arguments.length?new Se(t):Me.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,n=[],e=0;e<t.length;e++){var r=t[e]/255;n[e]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*n[0]+.7152*n[1]+.0722*n[2]},contrast:function(t){var n=this.luminosity(),e=t.luminosity();return n>e?(n+.05)/(e+.05):(e+.05)/(n+.05)},level:function(t){var n=this.contrast(t);return n>=7.1?"AAA":n>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),n=0;n<3;n++)t.color[n]=255-t.color[n];return t},lighten:function(t){var n=this.hsl();return n.color[2]+=n.color[2]*t,n},darken:function(t){var n=this.hsl();return n.color[2]-=n.color[2]*t,n},saturate:function(t){var n=this.hsl();return n.color[1]+=n.color[1]*t,n},desaturate:function(t){var n=this.hsl();return n.color[1]-=n.color[1]*t,n},whiten:function(t){var n=this.hwb();return n.color[1]+=n.color[1]*t,n},blacken:function(t){var n=this.hwb();return n.color[2]+=n.color[2]*t,n},grayscale:function(){var t=this.rgb().color,n=.3*t[0]+.59*t[1]+.11*t[2];return Se.rgb(n,n,n)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var n=this.hsl(),e=n.color[0];return e=(e=(e+t)%360)<0?360+e:e,n.color[0]=e,n},mix:function(t,n){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var e=t.rgb(),r=this.rgb(),i=void 0===n?.5:n,s=2*i-1,o=e.alpha()-r.alpha(),a=((s*o==-1?s:(s+o)/(1+s*o))+1)/2,u=1-a;return Se.rgb(a*e.red()+u*r.red(),a*e.green()+u*r.green(),a*e.blue()+u*r.blue(),e.alpha()*i+r.alpha()*(1-i))}},Object.keys(xe).forEach((function(t){if(-1===ke.indexOf(t)){var n=xe[t].channels;Se.prototype[t]=function(){if(this.model===t)return new Se(this);if(arguments.length)return new Se(arguments,t);var e,r="number"==typeof arguments[n]?n:this.valpha;return new Se((e=xe[this.model][t].raw(this.color),Array.isArray(e)?e:[e]).concat(r),t)},Se[t]=function(e){return"number"==typeof e&&(e=Ce(Fe.call(arguments),n)),new Se(e,t)}}}));var Ee=Et(Se);function $e(t){for(let n=1;n<arguments.length;n++){const e=arguments[n];for(const n in e)t[n]=e[n]}return t}function Ie(t){return null==t}function ze(t){return"number"==typeof t&&!isNaN(t)}function De(t){return"object"==typeof t&&!!t}function Te(t){return!Ie(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}const Ue=Object.prototype.hasOwnProperty;function je(t,n){return Ue.call(t,n)}function Ne(t){return t&&g(t)&&t.property}const Le={};function He(t,n){if(!Array.isArray(n)){if(n&&void 0!==n.r&&void 0!==n.g&&void 0!==n.b)return t[0]=255*n.r,t[1]=255*n.g,t[2]=255*n.b,void 0!==n.a?t[3]=255*n.a:t[3]=255,t;const e=n;n=Le[e]=Le[e]||Ee(n).unitArray()}for(let e=0;e<n.length;e++)t[e]=255*n[e];return 3===n.length&&(t[3]=255),t}const Re={textFill:1,textSize:1,textOpacity:1,textDx:1,textDy:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1,polygonPatternFileWidth:1,polygonPatternFileOrigin:1,rotationX:1,rotationY:1,rotationZ:1,scaleX:1,scaleY:1,scaleZ:1,translationX:1,translationY:1,translationZ:1},Ve={textName:1,markerTextFitPadding:1,markerTextFit:1,lineGradientProperty:1};class qe{constructor(t,n,e,r){this.feature=t,this.symbol=n,this.fnTypes=e,this.options=r}getPolygonResource(){let t=this.symbol.polygonPatternFile;const{polygonPatternFileFn:n}=this.fnTypes,e=n;return this.H(t,e)}getLineResource(){let t=this.symbol.linePatternFile;const{linePatternFileFn:n}=this.fnTypes,e=n;return this.H(t,e)}H(t,n){if(n){const e=this.feature.properties;t=n(this.options.zoom,e)}return t}}\n/*!\n        Feature Filter by\n\n        (c) mapbox 2016 and maptalks 2018\n        www.mapbox.com | www.maptalks.org\n        License: MIT, header required.\n    */\nconst Ge=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function Je(t){return new Function("f",\`var p = (f && f.properties || {}); return ${XR}Be(t)}\`)}function We(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":case"!has":return 2===t.length&&("string"==typeof t[1]||t[1].property&&t[1].op);case"in":case"!in":return t.length>=2&&("string"==typeof t[1]||t[1].property&&t[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===t.length&&("string"==typeof t[1]||t[1].property&&t[1].op);case"none":case"any":case"all":for(const n of t.slice(1))if(!We(n)&&"boolean"!=typeof n)return!1;return!0;case"contains":return!0;default:return!1}}function Be(t){if(!t)return"true";const n=t[0];if(t.length<=1)return"any"===n?"false":"true";return\`(${XR}"=="===n?Ye(t[1],t[2],"===",!1):"!="===n?Ye(t[1],t[2],"!==",!1):"<"===n||">"===n||"<="===n||">="===n?Ye(t[1],t[2],n,!0):"any"===n?Ze(t.slice(1),"||"):"all"===n?Ze(t.slice(1),"&&"):"none"===n?nr(Ze(t.slice(1),"||")):"in"===n?Qe(t[1],t.slice(2)):"!in"===n?nr(Qe(t[1],t.slice(2))):"has"===n?tr(t[1]):"!has"===n?nr(tr(t[1])):"contains"===n?function(t,n,e){const r=Xe(t);return void 0!==e?\`(${XR}r} + '').indexOf("${XR}n}") === ${XR}e}\`:\`(${XR}r} + '').indexOf("${XR}n}") >= 0\`}(t[1],t[2],t[3]):"true"})\`}function Xe(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function Ye(t,n,e,r){if("object"==typeof(i=t)&&i&&t.op)return function(t,n,e,r){const i=t.property,s=t.op;let o=Xe(i);return"length"!==s?(console.error(\`not support ${XR}s} op\`),"false"):(o=\`((${XR}o}+='').length)\`,Ke(o,i,n,e,r))}(t,n,e,r);var i;return Ke(Xe(t),t,n,e,r)}function Ke(t,n,e,r,i){const s="$type"===n?Ge.indexOf(e):JSON.stringify(e);return(i?\`typeof ${XR}t}=== typeof ${XR}s}&&\`:"")+t+r+s}function Ze(t,n){return t.map(Be).join(n)}function Qe(t,n){"$type"===t&&(n=n.map((t=>Ge.indexOf(t))));const e=JSON.stringify(n.sort(er)),r=Xe(t);return n.length<=200?\`${XR}e}.indexOf(${XR}r}) !== -1\`:\`function(v, a, i, j) {\\n        while (i <= j) { var m = (i + j) >> 1;\\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\\n        }\\n    return false; }(${XR}r}, ${XR}e},0,${XR}n.length-1})\`}function tr(t){return"$id"===t?'"id" in f':\`${XR}JSON.stringify(t)} in p\`}function nr(t){return\`!(${XR}t})\`}function er(t,n){return t<n?-1:t>n?1:0}\n/*!\n     * a compact version of mapbox-gl-style-spec\n     * based on mapbox-gl-style-spec@13.28.0\n     * https://github.com/mapbox/mapbox-gl-js/tree/main/src/style-spec\n     * LICENSE : ISC\n     */var rr="undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self?self:{},ir={exports:{}};function sr(t,...n){for(const e of n)for(const n in e)t[n]=e[n];return t}\n/*! https://mths.be/punycode v1.3.2 by @mathias */\n!function(t,n){!function(e){var r=n&&!n.nodeType&&n,i=t&&!t.nodeType&&t,s="object"==typeof rr&&rr;s.global!==s&&s.window!==s&&s.self!==s||(e=s);var o,a,u=2147483647,l=36,h=1,c=26,f=38,d=700,p=72,y=128,m="-",g=/^xn--/,v=/[^\\x20-\\x7E]/,b=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,w={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},M=l-h,x=Math.floor,F=String.fromCharCode;function k(t){throw RangeError(w[t])}function A(t,n){for(var e=t.length,r=[];e--;)r[e]=n(t[e]);return r}function P(t,n){var e=t.split("@"),r="";return e.length>1&&(r=e[0]+"@",t=e[1]),r+A((t=t.replace(b,".")).split("."),n).join(".")}function S(t){for(var n,e,r=[],i=0,s=t.length;i<s;)(n=t.charCodeAt(i++))>=55296&&n<=56319&&i<s?56320==(64512&(e=t.charCodeAt(i++)))?r.push(((1023&n)<<10)+(1023&e)+65536):(r.push(n),i--):r.push(n);return r}function _(t){return A(t,(function(t){var n="";return t>65535&&(n+=F((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+=F(t)})).join("")}function O(t,n){return t+22+75*(t<26)-((0!=n)<<5)}function C(t,n,e){var r=0;for(t=e?x(t/d):t>>1,t+=x(t/n);t>M*c>>1;r+=l)t=x(t/M);return x(r+(M+1)*t/(t+f))}function E(t){var n,e,r,i,s,o,a,f,d,g,v,b=[],w=t.length,M=0,F=y,A=p;for((e=t.lastIndexOf(m))<0&&(e=0),r=0;r<e;++r)t.charCodeAt(r)>=128&&k("not-basic"),b.push(t.charCodeAt(r));for(i=e>0?e+1:0;i<w;){for(s=M,o=1,a=l;i>=w&&k("invalid-input"),((f=(v=t.charCodeAt(i++))-48<10?v-22:v-65<26?v-65:v-97<26?v-97:l)>=l||f>x((u-M)/o))&&k("overflow"),M+=f*o,!(f<(d=a<=A?h:a>=A+c?c:a-A));a+=l)o>x(u/(g=l-d))&&k("overflow"),o*=g;A=C(M-s,n=b.length+1,0==s),x(M/n)>u-F&&k("overflow"),F+=x(M/n),M%=n,b.splice(M++,0,F)}return _(b)}function $(t){var n,e,r,i,s,o,a,f,d,g,v,b,w,M,A,P=[];for(b=(t=S(t)).length,n=y,e=0,s=p,o=0;o<b;++o)(v=t[o])<128&&P.push(F(v));for(r=i=P.length,i&&P.push(m);r<b;){for(a=u,o=0;o<b;++o)(v=t[o])>=n&&v<a&&(a=v);for(a-n>x((u-e)/(w=r+1))&&k("overflow"),e+=(a-n)*w,n=a,o=0;o<b;++o)if((v=t[o])<n&&++e>u&&k("overflow"),v==n){for(f=e,d=l;!(f<(g=d<=s?h:d>=s+c?c:d-s));d+=l)A=f-g,M=l-g,P.push(F(O(g+A%M,0))),f=x(A/M);P.push(F(O(f,0))),s=C(e,w,r==i),e=0,++r}++e,++n}return P.join("")}if(o={version:"1.3.2",ucs2:{decode:S,encode:_},decode:E,encode:$,toASCII:function(t){return P(t,(function(t){return v.test(t)?"xn--"+$(t):t}))},toUnicode:function(t){return P(t,(function(t){return g.test(t)?E(t.slice(4).toLowerCase()):t}))}},r&&i)if(t.exports==r)i.exports=o;else for(a in o)o.hasOwnProperty(a)&&(r[a]=o[a]);else e.punycode=o}(rr)}(ir,ir.exports);class or extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var ar=or;class ur{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[t,e]of n)this.bindings[t]=e}concat(t){return new ur(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(\`${XR}t} not found in scope.\`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var lr=ur;const hr={kind:"null"},cr={kind:"number"},fr={kind:"string"},dr={kind:"boolean"},pr={kind:"color"},yr={kind:"object"},mr={kind:"value"},gr={kind:"collator"},vr={kind:"formatted"},br={kind:"resolvedImage"};function wr(t,n){return{kind:"array",itemType:t,N:n}}function Mr(t){if("array"===t.kind){const n=Mr(t.itemType);return"number"==typeof t.N?\`array<${XR}n}, ${XR}t.N}>\`:"value"===t.itemType.kind?"array":\`array<${XR}n}>\`}return t.kind}const xr=[hr,cr,fr,dr,pr,vr,yr,wr(mr),br];function Fr(t,n){if("error"===n.kind)return null;if("array"===t.kind){if("array"===n.kind&&(0===n.N&&"value"===n.itemType.kind||!Fr(t.itemType,n.itemType))&&("number"!=typeof t.N||t.N===n.N))return null}else{if(t.kind===n.kind)return null;if("value"===t.kind)for(const t of xr)if(!Fr(t,n))return null}return\`Expected ${XR}Mr(t)} but found ${XR}Mr(n)} instead.\`}function kr(t,n){return n.some((n=>n.kind===t.kind))}function Ar(t,n){return n.some((n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t))}var Pr,Sr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function _r(t){return(t=Math.round(t))<0?0:t>255?255:t}function Or(t){return t<0?0:t>1?1:t}function Cr(t){return"%"===t[t.length-1]?_r(parseFloat(t)/100*255):_r(parseInt(t))}function Er(t){return"%"===t[t.length-1]?Or(parseFloat(t)/100):Or(parseFloat(t))}function $r(t,n,e){return e<0?e+=1:e>1&&(e-=1),6*e<1?t+(n-t)*e*6:2*e<1?n:3*e<2?t+(n-t)*(2/3-e)*6:t}try{Pr={}.parseCSSColor=function(t){var n,e=t.replace(/ /g,"").toLowerCase();if(e in Sr)return Sr[e].slice();if("#"===e[0])return 4===e.length?(n=parseInt(e.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:7===e.length&&(n=parseInt(e.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var r=e.indexOf("("),i=e.indexOf(")");if(-1!==r&&i+1===e.length){var s=e.substr(0,r),o=e.substr(r+1,i-(r+1)).split(","),a=1;switch(s){case"rgba":if(4!==o.length)return null;a=Er(o.pop());case"rgb":return 3!==o.length?null:[Cr(o[0]),Cr(o[1]),Cr(o[2]),a];case"hsla":if(4!==o.length)return null;a=Er(o.pop());case"hsl":if(3!==o.length)return null;var u=(parseFloat(o[0])%360+360)%360/360,l=Er(o[1]),h=Er(o[2]),c=h<=.5?h*(l+1):h+l-h*l,f=2*h-c;return[_r(255*$r(f,c,u+1/3)),_r(255*$r(f,c,u)),_r(255*$r(f,c,u-1/3)),a];default:return null}}return null}}catch(t){}class Ir{constructor(t,n,e,r=1){this.r=t,this.g=n,this.b=e,this.a=r}static parse(t){if(!t)return;if(t instanceof Ir)return t;if("string"!=typeof t)return;const n=Pr(t);return n?new Ir(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,e,r]=this.toArray();return\`rgba(${XR}Math.round(t)},${XR}Math.round(n)},${XR}Math.round(e)},${XR}r})\`}toArray(){const{r:t,g:n,b:e,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*n/r,255*e/r,r]}toArray01(){const{r:t,g:n,b:e,a:r}=this;return 0===r?[0,0,0,0]:[t/r,n/r,e/r,r]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:e,a:r}=this;return[t,n,e,r]}}Ir.black=new Ir(0,0,0,1),Ir.white=new Ir(1,1,1,1),Ir.transparent=new Ir(0,0,0,0),Ir.red=new Ir(1,0,0,1),Ir.blue=new Ir(0,0,1,1);var zr=Ir;class Dr{constructor(t,n,e){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=e,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Tr{constructor(t,n,e,r,i){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=e,this.fontStack=r,this.textColor=i}}class Ur{constructor(t){this.sections=t}static fromString(t){return new Ur([new Tr(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Ur?t:Ur.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.name]);continue}t.push(n.text);const e={};n.fontStack&&(e["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(e["font-scale"]=n.scale),n.textColor&&(e["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(e)}return t}}class jr{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new jr({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Nr(t,n,e,r){if(!("number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255)){return\`Invalid rgba value [${XR}("number"==typeof r?[t,n,e,r]:[t,n,e]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.\`}return void 0===r||"number"==typeof r&&r>=0&&r<=1?null:\`Invalid rgba value [${XR}[t,n,e,r].join(", ")}]: 'a' must be between 0 and 1.\`}function Lr(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof zr)return!0;if(t instanceof Dr)return!0;if(t instanceof Ur)return!0;if(t instanceof jr)return!0;if(Array.isArray(t)){for(const n of t)if(!Lr(n))return!1;return!0}if("object"==typeof t){for(const n in t)if(!Lr(t[n]))return!1;return!0}return!1}function Hr(t){if(null===t)return hr;if("string"==typeof t)return fr;if("boolean"==typeof t)return dr;if("number"==typeof t)return cr;if(t instanceof zr)return pr;if(t instanceof Dr)return gr;if(t instanceof Ur)return vr;if(t instanceof jr)return br;if(Array.isArray(t)){const n=t.length;let e;for(const n of t){const t=Hr(n);if(e){if(e===t)continue;e=mr;break}e=t}return wr(e||mr,n)}return yr}function Rr(t){const n=typeof t;return null===t?"":"string"===n||"number"===n||"boolean"===n?String(t):t instanceof zr||t instanceof Ur||t instanceof jr?t.toString():JSON.stringify(t)}class Vr{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(2!==t.length)return n.error(\`'literal' expression requires exactly one argument, but found ${XR}t.length-1} instead.\`);if(!Lr(t[1]))return n.error("invalid value");const e=t[1];let r=Hr(e);const i=n.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new Vr(r,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof zr?["rgba"].concat(this.value.toArray()):this.value instanceof Ur?this.value.serialize():this.value}}var qr=Vr;var Gr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Jr={string:fr,number:cr,boolean:dr,object:yr};class Wr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let e,r=1;const i=t[0];if("array"===i){let i,s;if(t.length>2){const e=t[1];if("string"!=typeof e||!(e in Jr)||"object"===e)return n.error('The item type argument of "array" must be one of string, number, boolean',1);i=Jr[e],r++}else i=mr;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);s=t[2],r++}e=wr(i,s)}else e=Jr[i];const s=[];for(;r<t.length;r++){const e=n.parse(t[r],r,mr);if(!e)return null;s.push(e)}return new Wr(e,s)}evaluate(t){for(let n=0;n<this.args.length;n++){const e=this.args[n].evaluate(t);if(!Fr(this.type,Hr(e)))return e;if(n===this.args.length-1)throw new Gr(\`Expected value to be of type ${XR}Mr(this.type)}, but found ${XR}Mr(Hr(e))} instead.\`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,n=[t.kind];if("array"===t.kind){const e=t.itemType;if("string"===e.kind||"number"===e.kind||"boolean"===e.kind){n.push(e.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&n.push(r)}}return n.concat(this.args.map((t=>t.serialize())))}}var Br=Wr;class Xr{constructor(t){this.type=vr,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const e=t[1];if(!Array.isArray(e)&&"object"==typeof e)return n.error("First argument must be an image or text section.");const r=[];let i=!1;for(let e=1;e<=t.length-1;++e){const s=t[e];if(i&&"object"==typeof s&&!Array.isArray(s)){i=!1;let t=null;if(s["font-scale"]&&(t=n.parse(s["font-scale"],1,cr),!t))return null;let e=null;if(s["text-font"]&&(e=n.parse(s["text-font"],1,wr(fr)),!e))return null;let o=null;if(s["text-color"]&&(o=n.parse(s["text-color"],1,pr),!o))return null;const a=r[r.length-1];a.scale=t,a.font=e,a.textColor=o}else{const s=n.parse(t[e],1,mr);if(!s)return null;const o=s.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:s,scale:null,font:null,textColor:null})}}return new Xr(r)}evaluate(t){return new Ur(this.sections.map((n=>{const e=n.content.evaluate(t);return Hr(e)===br?new Tr("",e,null,null,null):new Tr(Rr(e),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)})))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const e={};n.scale&&(e["font-scale"]=n.scale.serialize()),n.font&&(e["text-font"]=n.font.serialize()),n.textColor&&(e["text-color"]=n.textColor.serialize()),t.push(e)}return t}}class Yr{constructor(t){this.type=br,this.input=t}static parse(t,n){if(2!==t.length)return n.error("Expected two arguments.");const e=n.parse(t[1],1,fr);return e?new Yr(e):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),e=jr.fromString(n);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(n)>-1),e}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Kr={"to-boolean":dr,"to-color":pr,"to-number":cr,"to-string":fr};class Zr{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const e=t[0];if(("to-boolean"===e||"to-string"===e)&&2!==t.length)return n.error("Expected one argument.");const r=Kr[e],i=[];for(let e=1;e<t.length;e++){const r=n.parse(t[e],e,mr);if(!r)return null;i.push(r)}return new Zr(r,i)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let n,e;for(const r of this.args){if(n=r.evaluate(t),e=null,n instanceof zr)return n;if("string"==typeof n){const e=t.parseColor(n);if(e)return e}else if(Array.isArray(n)&&(e=n.length<3||n.length>4?\`Invalid rbga value ${XR}JSON.stringify(n)}: expected an array containing either three or four numeric values.\`:Nr(n[0],n[1],n[2],n[3]),!e))return new zr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Gr(e||\`Could not parse color from value '${XR}"string"==typeof n?n:String(JSON.stringify(n))}'\`)}if("number"===this.type.kind){let n=null;for(const e of this.args){if(n=e.evaluate(t),null===n)return 0;const r=Number(n);if(!isNaN(r))return r}throw new Gr(\`Could not convert ${XR}JSON.stringify(n)} to number.\`)}return"formatted"===this.type.kind?Ur.fromString(Rr(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?jr.fromString(Rr(this.args[0].evaluate(t))):Rr(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new Xr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Yr(this.args[0]).serialize();const t=[\`to-${XR}this.type.kind}\`];return this.eachChild((n=>{t.push(n.serialize())})),t}}var Qr=Zr;const ti=["Unknown","Point","LineString","Polygon"];var ni=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this.R={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ti[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:e,y:r}=this.featureTileCoord,i=e*n-t[0],s=r*n-t[1];return this.featureDistanceData.bearing[0]*i+this.featureDistanceData.bearing[1]*s}return 0}parseColor(t){let n=this.R[t];return n||(n=this.R[t]=zr.parse(t)),n}};class ei{constructor(t,n,e,r){this.name=t,this.type=n,this.V=e,this.args=r}evaluate(t){return this.V(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,n){const e=t[0],r=ei.definitions[e];if(!r)return n.error(\`Unknown expression "${XR}e}". If you wanted a literal array, use ["literal", [...]].\`,0);const i=Array.isArray(r)?r[0]:r.type,s=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,o=s.filter((([n])=>!Array.isArray(n)||n.length===t.length-1));let a=null;for(const[r,s]of o){a=new Ci(n.registry,n.path,null,n.scope);const o=[];let u=!1;for(let n=1;n<t.length;n++){const e=t[n],i=Array.isArray(r)?r[n-1]:r.type,s=a.parse(e,1+o.length,i);if(!s){u=!0;break}o.push(s)}if(!u)if(Array.isArray(r)&&r.length!==o.length)a.error(\`Expected ${XR}r.length} arguments, but found ${XR}o.length} instead.\`);else{for(let t=0;t<o.length;t++){const n=Array.isArray(r)?r[t]:r.type,e=o[t];a.concat(t+1).checkSubtype(n,e.type)}if(0===a.errors.length)return new ei(e,i,s,o)}}if(1===o.length)n.errors.push(...a.errors);else{const e=(o.length?o:s).map((([t])=>{return n=t,Array.isArray(n)?\`(${XR}n.map(Mr).join(", ")})\`:\`(${XR}Mr(n.type)}...)\`;var n})).join(" | "),r=[];for(let e=1;e<t.length;e++){const i=n.parse(t[e],1+r.length);if(!i)return null;r.push(Mr(i.type))}n.error(\`Expected arguments of type ${XR}e}, but found (${XR}r.join(", ")}) instead.\`)}return null}static register(t,n){ei.definitions=n;for(const e in n)t[e]=ei}}var ri=ei;class ii{constructor(t,n,e){this.type=gr,this.locale=e,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(2!==t.length)return n.error("Expected one argument.");const e=t[1];if("object"!=typeof e||Array.isArray(e))return n.error("Collator options argument must be an object.");const r=n.parse(void 0!==e["case-sensitive"]&&e["case-sensitive"],1,dr);if(!r)return null;const i=n.parse(void 0!==e["diacritic-sensitive"]&&e["diacritic-sensitive"],1,dr);if(!i)return null;let s=null;return e.locale&&(s=n.parse(e.locale,1,fr),!s)?null:new ii(r,i,s)}evaluate(t){return new Dr(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const si=8192;function oi(t,n){t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),t[2]=Math.max(t[2],n[0]),t[3]=Math.max(t[3],n[1])}function ai(t,n){return!(t[0]<=n[0])&&(!(t[2]>=n[2])&&(!(t[1]<=n[1])&&!(t[3]>=n[3])))}function ui(t,n){const e=(180+t[0])/360;const r=(i=t[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360);var i;const s=Math.pow(2,n.z);return[Math.round(e*s*si),Math.round(r*s*si)]}function li(t,n,e){const r=t[0]-n[0],i=t[1]-n[1],s=t[0]-e[0],o=t[1]-e[1];return r*o-s*i==0&&r*s<=0&&i*o<=0}function hi(t,n){let e=!1;for(let o=0,a=n.length;o<a;o++){const a=n[o];for(let n=0,o=a.length;n<o-1;n++){if(li(t,a[n],a[n+1]))return!1;r=t,i=a[n],s=a[n+1],i[1]>r[1]!=s[1]>r[1]&&r[0]<(s[0]-i[0])*(r[1]-i[1])/(s[1]-i[1])+i[0]&&(e=!e)}}var r,i,s;return e}function ci(t,n){for(let e=0;e<n.length;e++)if(hi(t,n[e]))return!0;return!1}function fi(t,n,e,r){const i=t[0]-e[0],s=t[1]-e[1],o=n[0]-e[0],a=n[1]-e[1],u=r[0]-e[0],l=r[1]-e[1],h=i*l-u*s,c=o*l-u*a;return h>0&&c<0||h<0&&c>0}function di(t,n,e,r){const i=[n[0]-t[0],n[1]-t[1]],s=[r[0]-e[0],r[1]-e[1]];return 0!=(o=s)[0]*(a=i)[1]-o[1]*a[0]&&!(!fi(t,n,e,r)||!fi(e,r,t,n));var o,a}function pi(t,n,e){for(const r of e)for(let e=0;e<r.length-1;++e)if(di(t,n,r[e],r[e+1]))return!0;return!1}function yi(t,n){for(let e=0;e<t.length;++e)if(!hi(t[e],n))return!1;for(let e=0;e<t.length-1;++e)if(pi(t[e],t[e+1],n))return!1;return!0}function mi(t,n){for(let e=0;e<n.length;e++)if(yi(t,n[e]))return!0;return!1}function gi(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=[];for(let r=0;r<t[i].length;r++){const o=ui(t[i][r],e);oi(n,o),s.push(o)}r.push(s)}return r}function vi(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=gi(t[i],n,e);r.push(s)}return r}function bi(t,n,e,r){if(t[0]<e[0]||t[0]>e[2]){const n=.5*r;let i=t[0]-e[0]>n?-r:e[0]-t[0]>n?r:0;0===i&&(i=t[0]-e[2]>n?-r:e[2]-t[0]>n?r:0),t[0]+=i}oi(n,t)}function wi(t,n,e,r){const i=Math.pow(2,r.z)*si,s=[r.x*si,r.y*si],o=[];if(!t)return o;for(const r of t)for(const t of r){const r=[t.x+s[0],t.y+s[1]];bi(r,n,e,i),o.push(r)}return o}function Mi(t,n,e,r){const i=Math.pow(2,r.z)*si,s=[r.x*si,r.y*si],o=[];if(!t)return o;for(const e of t){const t=[];for(const r of e){const e=[r.x+s[0],r.y+s[1]];oi(n,e),t.push(e)}o.push(t)}if(n[2]-n[0]<=i/2){!function(t){t[0]=t[1]=1/0,t[2]=t[3]=-1/0}(n);for(const t of o)for(const r of t)bi(r,n,e,i)}return o}class xi{constructor(t,n){this.type=dr,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(\`'within' expression requires exactly one argument, but found ${XR}t.length-1} instead.\`);if(Lr(t[1])){const n=t[1];if("FeatureCollection"===n.type)for(let t=0;t<n.features.length;++t){const e=n.features[t].geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new xi(n,n.features[t].geometry)}else if("Feature"===n.type){const t=n.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new xi(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new xi(n,n)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,n){const e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===n.type){const s=gi(n.coordinates,r,i),o=wi(t.geometry(),e,r,i);if(!ai(e,r))return!1;for(const t of o)if(!hi(t,s))return!1}if("MultiPolygon"===n.type){const s=vi(n.coordinates,r,i),o=wi(t.geometry(),e,r,i);if(!ai(e,r))return!1;for(const t of o)if(!ci(t,s))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,n){const e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===n.type){const s=gi(n.coordinates,r,i),o=Mi(t.geometry(),e,r,i);if(!ai(e,r))return!1;for(const t of o)if(!yi(t,s))return!1}if("MultiPolygon"===n.type){const s=vi(n.coordinates,r,i),o=Mi(t.geometry(),e,r,i);if(!ai(e,r))return!1;for(const t of o)if(!mi(t,s))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Fi=xi;function ki(t){if(t instanceof ri){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Fi)return!1;let n=!0;return t.eachChild((t=>{n&&!ki(t)&&(n=!1)})),n}function Ai(t){if(t instanceof ri&&"feature-state"===t.name)return!1;let n=!0;return t.eachChild((t=>{n&&!Ai(t)&&(n=!1)})),n}function Pi(t,n){if(t instanceof ri&&n.indexOf(t.name)>=0)return!1;let e=!0;return t.eachChild((t=>{e&&!Pi(t,n)&&(e=!1)})),e}class Si{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("'var' expression requires exactly one string literal argument.");const e=t[1];return n.scope.has(e)?new Si(e,n.scope.get(e)):n.error(\`Unknown variable "${XR}e}". Make sure "${XR}e}" has been bound in an enclosing "let" expression before using it.\`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var _i=Si;class Oi{constructor(t,n=[],e,r=new lr,i=[]){this.registry=t,this.path=n,this.key=n.map((t=>\`[${XR}t}]\`)).join(""),this.scope=r,this.errors=i,this.expectedType=e}parse(t,n,e,r,i={}){return n?this.concat(n,e,r).q(t,i):this.q(t,i)}q(t,n){function e(t,n,e){return"assert"===e?new Br(n,[t]):"coerce"===e?new Qr(n,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(\`Expression name must be a string, but found ${XR}typeof r} instead. If you wanted a literal array, use ["literal", [...]].\`,0),null;const i=this.registry[r];if(i){let r=i.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else r=e(r,t,n.typeAnnotation||"coerce");else r=e(r,t,n.typeAnnotation||"assert")}if(!(r instanceof qr)&&"resolvedImage"!==r.type.kind&&Ei(r)){const t=new ni;try{r=new qr(r.type,r.evaluate(t))}catch(t){return this.error(t.message),null}}return r}return this.error(\`Unknown expression "${XR}r}". If you wanted a literal array, use ["literal", [...]].\`,0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"==typeof t?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(\`Expected an array, but found ${XR}typeof t} instead.\`)}concat(t,n,e){const r="number"==typeof t?this.path.concat(t):this.path,i=e?this.scope.concat(e):this.scope;return new Oi(this.registry,r,n||null,i,this.errors)}error(t,...n){const e=\`${XR}this.key}${XR}n.map((t=>\`[${XR}t}]\`)).join("")}\`;this.errors.push(new ar(e,t))}checkSubtype(t,n){const e=Fr(t,n);return e&&this.error(e),e}}var Ci=Oi;function Ei(t){if(t instanceof _i)return Ei(t.boundExpression);if(t instanceof ri&&"error"===t.name)return!1;if(t instanceof ii)return!1;if(t instanceof Fi)return!1;const n=t instanceof Qr||t instanceof Br;let e=!0;return t.eachChild((t=>{e=n?e&&Ei(t):e&&t instanceof qr})),!!e&&(ki(t)&&Pi(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function $i(t,n){const e=t.length-1;let r,i,s=0,o=e,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),r=t[a],i=t[a+1],r<=n){if(a===e||n<i)return a;s=a+1}else{if(!(r>n))throw new Gr("Input is not a number.");o=a-1}return 0}class Ii{constructor(t,n,e){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[t,n]of e)this.labels.push(t),this.outputs.push(n)}static parse(t,n){if(t.length-1<4)return n.error(\`Expected at least 4 arguments, but found only ${XR}t.length-1}.\`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const e=n.parse(t[1],1,cr);if(!e)return null;const r=[];let i=null;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);for(let e=1;e<t.length;e+=2){const s=1===e?-1/0:t[e],o=t[e+1],a=e,u=e+1;if("number"!=typeof s)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=s)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const l=n.parse(o,u,i);if(!l)return null;i=i||l.type,r.push([s,l])}return new Ii(i,e,r)}evaluate(t){const n=this.labels,e=this.outputs;if(1===n.length)return e[0].evaluate(t);const r=this.input.evaluate(t);if(r<=n[0])return e[0].evaluate(t);const i=n.length;if(r>=n[i-1])return e[i-1].evaluate(t);return e[$i(n,r)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var zi=Ii,Di=Ti;function Ti(t,n,e,r){this.cx=3*t,this.bx=3*(e-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(r-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=e,this.p2y=r}function Ui(t,n,e){return t*(1-e)+n*e}Ti.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(void 0===n&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var e=t,r=0;r<8;r++){var i=this.sampleCurveX(e)-t;if(Math.abs(i)<n)return e;var s=this.sampleCurveDerivativeX(e);if(Math.abs(s)<1e-6)break;e-=i/s}var o=0,a=1;for(e=t,r=0;r<20&&(i=this.sampleCurveX(e),!(Math.abs(i-t)<n));r++)t>i?o=e:a=e,e=.5*(a-o)+o;return e},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}};var ji=Object.freeze({__proto__:null,number:Ui,color:function(t,n,e){return new zr(Ui(t.r,n.r,e),Ui(t.g,n.g,e),Ui(t.b,n.b,e),Ui(t.a,n.a,e))},array:function(t,n,e){return t.map(((t,r)=>Ui(t,n[r],e)))}});const Ni=.95047,Li=1,Hi=1.08883,Ri=4/29,Vi=6/29,qi=3*Vi*Vi,Gi=Vi*Vi*Vi,Ji=Math.PI/180,Wi=180/Math.PI;function Bi(t){return t>Gi?Math.pow(t,1/3):t/qi+Ri}function Xi(t){return t>Vi?t*t*t:qi*(t-Ri)}function Yi(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ki(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Zi(t){const n=Ki(t.r),e=Ki(t.g),r=Ki(t.b),i=Bi((.4124564*n+.3575761*e+.1804375*r)/Ni),s=Bi((.2126729*n+.7151522*e+.072175*r)/Li);return{l:116*s-16,a:500*(i-s),b:200*(s-Bi((.0193339*n+.119192*e+.9503041*r)/Hi)),alpha:t.a}}function Qi(t){let n=(t.l+16)/116,e=isNaN(t.a)?n:n+t.a/500,r=isNaN(t.b)?n:n-t.b/200;return n=Li*Xi(n),e=Ni*Xi(e),r=Hi*Xi(r),new zr(Yi(3.2404542*e-1.5371385*n-.4985314*r),Yi(-.969266*e+1.8760108*n+.041556*r),Yi(.0556434*e-.2040259*n+1.0572252*r),t.alpha)}function ts(t,n,e){const r=n-t;return t+e*(r>180||r<-180?r-360*Math.round(r/360):r)}const ns={forward:Zi,reverse:Qi,interpolate:function(t,n,e){return{l:Ui(t.l,n.l,e),a:Ui(t.a,n.a,e),b:Ui(t.b,n.b,e),alpha:Ui(t.alpha,n.alpha,e)}}},es={forward:function(t){const{l:n,a:e,b:r}=Zi(t),i=Math.atan2(r,e)*Wi;return{h:i<0?i+360:i,c:Math.sqrt(e*e+r*r),l:n,alpha:t.a}},reverse:function(t){const n=t.h*Ji,e=t.c;return Qi({l:t.l,a:Math.cos(n)*e,b:Math.sin(n)*e,alpha:t.alpha})},interpolate:function(t,n,e){return{h:ts(t.h,n.h,e),c:Ui(t.c,n.c,e),l:Ui(t.l,n.l,e),alpha:Ui(t.alpha,n.alpha,e)}}};var rs=Object.freeze({__proto__:null,lab:ns,hcl:es});class is{constructor(t,n,e,r,i){this.type=t,this.operator=n,this.interpolation=e,this.input=r,this.labels=[],this.outputs=[];for(const[t,n]of i)this.labels.push(t),this.outputs.push(n)}static interpolationFactor(t,n,e,r){let i=0;if("exponential"===t.name)i=ss(n,t.base,e,r);else if("linear"===t.name)i=ss(n,1,e,r);else if("cubic-bezier"===t.name){const s=t.controlPoints;i=new Di(s[0],s[1],s[2],s[3]).solve(ss(n,1,e,r))}return i}static parse(t,n){let[e,r,i,...s]=t;if(!Array.isArray(r)||0===r.length)return n.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return n.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return n.error(\`Unknown interpolation type ${XR}String(r[0])}\`,1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return n.error(\`Expected at least 4 arguments, but found only ${XR}t.length-1}.\`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(i=n.parse(i,2,cr),!i)return null;const o=[];let a=null;"interpolate-hcl"===e||"interpolate-lab"===e?a=pr:n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);for(let t=0;t<s.length;t+=2){const e=s[t],r=s[t+1],i=t+3,u=t+4;if("number"!=typeof e)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(o.length&&o[o.length-1][0]>=e)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const l=n.parse(r,u,a);if(!l)return null;a=a||l.type,o.push([e,l])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new is(a,e,r,i,o):n.error(\`Type ${XR}Mr(a)} is not interpolatable.\`)}evaluate(t){const n=this.labels,e=this.outputs;if(1===n.length)return e[0].evaluate(t);const r=this.input.evaluate(t);if(r<=n[0])return e[0].evaluate(t);const i=n.length;if(r>=n[i-1])return e[i-1].evaluate(t);const s=$i(n,r),o=n[s],a=n[s+1],u=is.interpolationFactor(this.interpolation,r,o,a),l=e[s].evaluate(t),h=e[s+1].evaluate(t);return"interpolate"===this.operator?ji[this.type.kind.toLowerCase()](l,h,u):"interpolate-hcl"===this.operator?es.reverse(es.interpolate(es.forward(l),es.forward(h),u)):ns.reverse(ns.interpolate(ns.forward(l),ns.forward(h),u))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)n.push(this.labels[t],this.outputs[t].serialize());return n}}function ss(t,n,e,r){const i=r-e,s=t-e;return 0===i?0:1===n?s/i:(Math.pow(n,s)-1)/(Math.pow(n,i)-1)}var os=is;class as{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let e=null;const r=n.expectedType;r&&"value"!==r.kind&&(e=r);const i=[];for(const r of t.slice(1)){const t=n.parse(r,1+i.length,e,void 0,{typeAnnotation:"omit"});if(!t)return null;e=e||t.type,i.push(t)}const s=r&&i.some((t=>Fr(r,t.type)));return new as(s?mr:e,i)}evaluate(t){let n,e=null,r=0;for(const i of this.args){if(r++,e=i.evaluate(t),e&&e instanceof jr&&!e.available&&(n||(n=e),e=null,r===this.args.length))return n;if(null!==e)break}return e}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((n=>{t.push(n.serialize())})),t}}var us=as;class ls{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(\`Expected at least 3 arguments, but found ${XR}t.length-1} instead.\`);const e=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return n.error(\`Expected string, but found ${XR}typeof i} instead.\`,r);if(/[^a-zA-Z0-9_]/.test(i))return n.error("Variable names must contain only alphanumeric characters or '_'.",r);const s=n.parse(t[r+1],r+1);if(!s)return null;e.push([i,s])}const r=n.parse(t[t.length-1],t.length-1,n.expectedType,e);return r?new ls(e,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,e]of this.bindings)t.push(n,e.serialize());return t.push(this.result.serialize()),t}}var hs=ls;class cs{constructor(t,n,e){this.type=t,this.index=n,this.input=e}static parse(t,n){if(3!==t.length)return n.error(\`Expected 2 arguments, but found ${XR}t.length-1} instead.\`);const e=n.parse(t[1],1,cr),r=n.parse(t[2],2,wr(n.expectedType||mr));if(!e||!r)return null;const i=r.type;return new cs(i.itemType,e,r)}evaluate(t){const n=this.index.evaluate(t),e=this.input.evaluate(t);if(n<0)throw new Gr(\`Array index out of bounds: ${XR}n} < 0.\`);if(n>=e.length)throw new Gr(\`Array index out of bounds: ${XR}n} > ${XR}e.length-1}.\`);if(n!==Math.floor(n))throw new Gr(\`Array index must be an integer, but found ${XR}n} instead.\`);return e[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var fs=cs;class ds{constructor(t,n){this.type=dr,this.needle=t,this.haystack=n}static parse(t,n){if(3!==t.length)return n.error(\`Expected 2 arguments, but found ${XR}t.length-1} instead.\`);const e=n.parse(t[1],1,mr),r=n.parse(t[2],2,mr);return e&&r?kr(e.type,[dr,fr,cr,hr,mr])?new ds(e,r):n.error(\`Expected first argument to be of type boolean, string, number or null, but found ${XR}Mr(e.type)} instead\`):null}evaluate(t){const n=this.needle.evaluate(t),e=this.haystack.evaluate(t);if(null==e)return!1;if(!Ar(n,["boolean","string","number","null"]))throw new Gr(\`Expected first argument to be of type boolean, string, number or null, but found ${XR}Mr(Hr(n))} instead.\`);if(!Ar(e,["string","array"]))throw new Gr(\`Expected second argument to be of type array or string, but found ${XR}Mr(Hr(e))} instead.\`);return e.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ps=ds;class ys{constructor(t,n,e){this.type=cr,this.needle=t,this.haystack=n,this.fromIndex=e}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(\`Expected 3 or 4 arguments, but found ${XR}t.length-1} instead.\`);const e=n.parse(t[1],1,mr),r=n.parse(t[2],2,mr);if(!e||!r)return null;if(!kr(e.type,[dr,fr,cr,hr,mr]))return n.error(\`Expected first argument to be of type boolean, string, number or null, but found ${XR}Mr(e.type)} instead\`);if(4===t.length){const i=n.parse(t[3],3,cr);return i?new ys(e,r,i):null}return new ys(e,r)}evaluate(t){const n=this.needle.evaluate(t),e=this.haystack.evaluate(t);if(!Ar(n,["boolean","string","number","null"]))throw new Gr(\`Expected first argument to be of type boolean, string, number or null, but found ${XR}Mr(Hr(n))} instead.\`);if(!Ar(e,["string","array"]))throw new Gr(\`Expected second argument to be of type array or string, but found ${XR}Mr(Hr(e))} instead.\`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return e.indexOf(n,r)}return e.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var ms=ys;class gs{constructor(t,n,e,r,i,s){this.inputType=t,this.type=n,this.input=e,this.cases=r,this.outputs=i,this.otherwise=s}static parse(t,n){if(t.length<5)return n.error(\`Expected at least 4 arguments, but found only ${XR}t.length-1}.\`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let e,r;n.expectedType&&"value"!==n.expectedType.kind&&(r=n.expectedType);const i={},s=[];for(let o=2;o<t.length-1;o+=2){let a=t[o];const u=t[o+1];Array.isArray(a)||(a=[a]);const l=n.concat(o);if(0===a.length)return l.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return l.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return l.error(\`Branch labels must be integers no larger than ${XR}Number.MAX_SAFE_INTEGER}.\`);if("number"==typeof t&&Math.floor(t)!==t)return l.error("Numeric branch labels must be integer values.");if(e){if(l.checkSubtype(e,Hr(t)))return null}else e=Hr(t);if(void 0!==i[String(t)])return l.error("Branch labels must be unique.");i[String(t)]=s.length}const h=n.parse(u,o,r);if(!h)return null;r=r||h.type,s.push(h)}const o=n.parse(t[1],1,mr);if(!o)return null;const a=n.parse(t[t.length-1],t.length-1,r);return a?"value"!==o.type.kind&&n.concat(1).checkSubtype(e,o.type)?null:new gs(e,r,o,i,s,a):null}evaluate(t){const n=this.input.evaluate(t);return(Hr(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),e=[],r={};for(const t of n){const n=r[this.cases[t]];void 0===n?(r[this.cases[t]]=e.length,e.push([this.cases[t],[t]])):e[n][1].push(t)}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[n,r]of e)1===r.length?t.push(i(r[0])):t.push(r.map(i)),t.push(this.outputs[n].serialize());return t.push(this.otherwise.serialize()),t}}var vs=gs;class bs{constructor(t,n,e){this.type=t,this.branches=n,this.otherwise=e}static parse(t,n){if(t.length<4)return n.error(\`Expected at least 3 arguments, but found only ${XR}t.length-1}.\`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let e;n.expectedType&&"value"!==n.expectedType.kind&&(e=n.expectedType);const r=[];for(let i=1;i<t.length-1;i+=2){const s=n.parse(t[i],i,dr);if(!s)return null;const o=n.parse(t[i+1],i+1,e);if(!o)return null;r.push([s,o]),e=e||o.type}const i=n.parse(t[t.length-1],t.length-1,e);return i?new bs(e,r,i):null}evaluate(t){for(const[n,e]of this.branches)if(n.evaluate(t))return e.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,e]of this.branches)t(n),t(e);t(this.otherwise)}outputDefined(){return this.branches.every((([t,n])=>n.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((n=>{t.push(n.serialize())})),t}}var ws=bs;class Ms{constructor(t,n,e,r){this.type=t,this.input=n,this.beginIndex=e,this.endIndex=r}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(\`Expected 3 or 4 arguments, but found ${XR}t.length-1} instead.\`);const e=n.parse(t[1],1,mr),r=n.parse(t[2],2,cr);if(!e||!r)return null;if(!kr(e.type,[wr(mr),fr,mr]))return n.error(\`Expected first argument to be of type array or string, but found ${XR}Mr(e.type)} instead\`);if(4===t.length){const i=n.parse(t[3],3,cr);return i?new Ms(e.type,e,r,i):null}return new Ms(e.type,e,r)}evaluate(t){const n=this.input.evaluate(t),e=this.beginIndex.evaluate(t);if(!Ar(n,["string","array"]))throw new Gr(\`Expected first argument to be of type array or string, but found ${XR}Mr(Hr(n))} instead.\`);if(this.endIndex){const r=this.endIndex.evaluate(t);return n.slice(e,r)}return n.slice(e)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var xs=Ms;function Fs(t,n){return"=="===t||"!="===t?"boolean"===n.kind||"string"===n.kind||"number"===n.kind||"null"===n.kind||"value"===n.kind:"string"===n.kind||"number"===n.kind||"value"===n.kind}function ks(t,n,e,r){return 0===r.compare(n,e)}function As(t,n,e){const r="=="!==t&&"!="!==t;return class i{constructor(t,n,e){this.type=dr,this.lhs=t,this.rhs=n,this.collator=e,this.hasUntypedArgument="value"===t.type.kind||"value"===n.type.kind}static parse(t,n){if(3!==t.length&&4!==t.length)return n.error("Expected two or three arguments.");const e=t[0];let s=n.parse(t[1],1,mr);if(!s)return null;if(!Fs(e,s.type))return n.concat(1).error(\`"${XR}e}" comparisons are not supported for type '${XR}Mr(s.type)}'.\`);let o=n.parse(t[2],2,mr);if(!o)return null;if(!Fs(e,o.type))return n.concat(2).error(\`"${XR}e}" comparisons are not supported for type '${XR}Mr(o.type)}'.\`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return n.error(\`Cannot compare types '${XR}Mr(s.type)}' and '${XR}Mr(o.type)}'.\`);r&&("value"===s.type.kind&&"value"!==o.type.kind?s=new Br(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new Br(s.type,[o])));let a=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return n.error("Cannot use collator to compare non-string types.");if(a=n.parse(t[3],3,gr),!a)return null}return new i(s,o,a)}evaluate(i){const s=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const n=Hr(s),e=Hr(o);if(n.kind!==e.kind||"string"!==n.kind&&"number"!==n.kind)throw new Gr(\`Expected arguments for "${XR}t}" to be (string, string) or (number, number), but found (${XR}n.kind}, ${XR}e.kind}) instead.\`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=Hr(s),e=Hr(o);if("string"!==t.kind||"string"!==e.kind)return n(i,s,o)}return this.collator?e(i,s,o,this.collator.evaluate(i)):n(i,s,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const n=[t];return this.eachChild((t=>{n.push(t.serialize())})),n}}}const Ps=As("==",(function(t,n,e){return n===e}),ks),Ss=As("!=",(function(t,n,e){return n!==e}),(function(t,n,e,r){return!ks(0,n,e,r)})),_s=As("<",(function(t,n,e){return n<e}),(function(t,n,e,r){return r.compare(n,e)<0})),Os=As(">",(function(t,n,e){return n>e}),(function(t,n,e,r){return r.compare(n,e)>0})),Cs=As("<=",(function(t,n,e){return n<=e}),(function(t,n,e,r){return r.compare(n,e)<=0})),Es=As(">=",(function(t,n,e){return n>=e}),(function(t,n,e,r){return r.compare(n,e)>=0}));class $s{constructor(t,n,e,r,i,s){this.type=fr,this.number=t,this.locale=n,this.currency=e,this.unit=r,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(t,n){if(3!==t.length)return n.error("Expected two arguments.");const e=n.parse(t[1],1,cr);if(!e)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return n.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=n.parse(r.locale,1,fr),!i))return null;let s=null;if(r.currency&&(s=n.parse(r.currency,1,fr),!s))return null;let o=null;if(r.unit&&(o=n.parse(r.unit,1,fr),!o))return null;let a=null;if(r["min-fraction-digits"]&&(a=n.parse(r["min-fraction-digits"],1,cr),!a))return null;let u=null;return r["max-fraction-digits"]&&(u=n.parse(r["max-fraction-digits"],1,cr),!u)?null:new $s(e,i,s,o,a,u)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Is{constructor(t){this.type=cr,this.input=t}static parse(t,n){if(2!==t.length)return n.error(\`Expected 1 argument, but found ${XR}t.length-1} instead.\`);const e=n.parse(t[1],1);return e?"array"!==e.type.kind&&"string"!==e.type.kind&&"value"!==e.type.kind?n.error(\`Expected argument of type string or array, but found ${XR}Mr(e.type)} instead.\`):new Is(e):null}evaluate(t){const n=this.input.evaluate(t);if("string"==typeof n)return n.length;if(Array.isArray(n))return n.length;throw new Gr(\`Expected value to be of type string or array, but found ${XR}Mr(Hr(n))} instead.\`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((n=>{t.push(n.serialize())})),t}}const zs={"==":Ps,"!=":Ss,">":Os,"<":_s,">=":Es,"<=":Cs,array:Br,at:fs,boolean:Br,case:ws,coalesce:us,collator:ii,format:Xr,image:Yr,in:ps,"index-of":ms,interpolate:os,"interpolate-hcl":os,"interpolate-lab":os,length:Is,let:hs,literal:qr,match:vs,number:Br,"number-format":$s,object:Br,slice:xs,step:zi,string:Br,"to-boolean":Qr,"to-color":Qr,"to-number":Qr,"to-string":Qr,var:_i,within:Fi};function Ds(t,[n,e,r,i]){n=n.evaluate(t),e=e.evaluate(t),r=r.evaluate(t);const s=i?i.evaluate(t):1,o=Nr(n,e,r,s);if(o)throw new Gr(o);return new zr(n/255*s,e/255*s,r/255*s,s)}function Ts(t,n){return t in n}function Us(t,n){const e=n[t];return void 0===e?null:e}function js(t){return{type:t}}ri.register(zs,{error:[{kind:"error"},[fr],(t,[n])=>{throw new Gr(n.evaluate(t))}],typeof:[fr,[mr],(t,[n])=>Mr(Hr(n.evaluate(t)))],"to-rgba":[wr(cr,4),[pr],(t,[n])=>n.evaluate(t).toArray()],rgb:[pr,[cr,cr,cr],Ds],rgba:[pr,[cr,cr,cr,cr],Ds],has:{type:dr,overloads:[[[fr],(t,[n])=>Ts(n.evaluate(t),t.properties())],[[fr,yr],(t,[n,e])=>Ts(n.evaluate(t),e.evaluate(t))]]},get:{type:mr,overloads:[[[fr],(t,[n])=>Us(n.evaluate(t),t.properties())],[[fr,yr],(t,[n,e])=>Us(n.evaluate(t),e.evaluate(t))]]},"feature-state":[mr,[fr],(t,[n])=>Us(n.evaluate(t),t.featureState||{})],properties:[yr,[],t=>t.properties()],"geometry-type":[fr,[],t=>t.geometryType()],id:[mr,[],t=>t.id()],zoom:[cr,[],t=>t.globals.zoom],pitch:[cr,[],t=>t.globals.pitch||0],"distance-from-center":[cr,[],t=>t.distanceFromCenter()],"heatmap-density":[cr,[],t=>t.globals.heatmapDensity||0],"line-progress":[cr,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[cr,[],t=>t.globals.skyRadialProgress||0],accumulated:[mr,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[cr,js(cr),(t,n)=>{let e=0;for(const r of n)e+=r.evaluate(t);return e}],"*":[cr,js(cr),(t,n)=>{let e=1;for(const r of n)e*=r.evaluate(t);return e}],"-":{type:cr,overloads:[[[cr,cr],(t,[n,e])=>n.evaluate(t)-e.evaluate(t)],[[cr],(t,[n])=>-n.evaluate(t)]]},"/":[cr,[cr,cr],(t,[n,e])=>n.evaluate(t)/e.evaluate(t)],"%":[cr,[cr,cr],(t,[n,e])=>n.evaluate(t)%e.evaluate(t)],ln2:[cr,[],()=>Math.LN2],pi:[cr,[],()=>Math.PI],e:[cr,[],()=>Math.E],"^":[cr,[cr,cr],(t,[n,e])=>Math.pow(n.evaluate(t),e.evaluate(t))],sqrt:[cr,[cr],(t,[n])=>Math.sqrt(n.evaluate(t))],log10:[cr,[cr],(t,[n])=>Math.log(n.evaluate(t))/Math.LN10],ln:[cr,[cr],(t,[n])=>Math.log(n.evaluate(t))],log2:[cr,[cr],(t,[n])=>Math.log(n.evaluate(t))/Math.LN2],sin:[cr,[cr],(t,[n])=>Math.sin(n.evaluate(t))],cos:[cr,[cr],(t,[n])=>Math.cos(n.evaluate(t))],tan:[cr,[cr],(t,[n])=>Math.tan(n.evaluate(t))],asin:[cr,[cr],(t,[n])=>Math.asin(n.evaluate(t))],acos:[cr,[cr],(t,[n])=>Math.acos(n.evaluate(t))],atan:[cr,[cr],(t,[n])=>Math.atan(n.evaluate(t))],min:[cr,js(cr),(t,n)=>Math.min(...n.map((n=>n.evaluate(t))))],max:[cr,js(cr),(t,n)=>Math.max(...n.map((n=>n.evaluate(t))))],abs:[cr,[cr],(t,[n])=>Math.abs(n.evaluate(t))],round:[cr,[cr],(t,[n])=>{const e=n.evaluate(t);return e<0?-Math.round(-e):Math.round(e)}],floor:[cr,[cr],(t,[n])=>Math.floor(n.evaluate(t))],ceil:[cr,[cr],(t,[n])=>Math.ceil(n.evaluate(t))],"filter-==":[dr,[fr,mr],(t,[n,e])=>t.properties()[n.value]===e.value],"filter-id-==":[dr,[mr],(t,[n])=>t.id()===n.value],"filter-type-==":[dr,[fr],(t,[n])=>t.geometryType()===n.value],"filter-<":[dr,[fr,mr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r<i}],"filter-id-<":[dr,[mr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e<r}],"filter->":[dr,[fr,mr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r>i}],"filter-id->":[dr,[mr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e>r}],"filter-<=":[dr,[fr,mr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[dr,[mr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e<=r}],"filter->=":[dr,[fr,mr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[dr,[mr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e>=r}],"filter-has":[dr,[mr],(t,[n])=>n.value in t.properties()],"filter-has-id":[dr,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[dr,[wr(fr)],(t,[n])=>n.value.indexOf(t.geometryType())>=0],"filter-id-in":[dr,[wr(mr)],(t,[n])=>n.value.indexOf(t.id())>=0],"filter-in-small":[dr,[fr,wr(mr)],(t,[n,e])=>e.value.indexOf(t.properties()[n.value])>=0],"filter-in-large":[dr,[fr,wr(mr)],(t,[n,e])=>function(t,n,e,r){for(;e<=r;){const i=e+r>>1;if(n[i]===t)return!0;n[i]>t?r=i-1:e=i+1}return!1}(t.properties()[n.value],e.value,0,e.value.length-1)],all:{type:dr,overloads:[[[dr,dr],(t,[n,e])=>n.evaluate(t)&&e.evaluate(t)],[js(dr),(t,n)=>{for(const e of n)if(!e.evaluate(t))return!1;return!0}]]},any:{type:dr,overloads:[[[dr,dr],(t,[n,e])=>n.evaluate(t)||e.evaluate(t)],[js(dr),(t,n)=>{for(const e of n)if(e.evaluate(t))return!0;return!1}]]},"!":[dr,[dr],(t,[n])=>!n.evaluate(t)],"is-supported-script":[dr,[fr],(t,[n])=>{const e=t.globals&&t.globals.isSupportedScript;return!e||e(n.evaluate(t))}],upcase:[fr,[fr],(t,[n])=>n.evaluate(t).toUpperCase()],downcase:[fr,[fr],(t,[n])=>n.evaluate(t).toLowerCase()],concat:[fr,js(mr),(t,n)=>n.map((n=>Rr(n.evaluate(t)))).join("")],"resolved-locale":[fr,[gr],(t,[n])=>n.evaluate(t).resolvedLocale()]});var Ns=zs;function Ls(t){return{result:"success",value:t}}function Hs(t){return{result:"error",value:t}}function Rs(t){return!!t.expression&&t.expression.interpolated}function Vs(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function qs(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Gs(t){return t}function Js(t,n){const e="color"===n.type,r=t.stops&&"object"==typeof t.stops[0][0],i=r||void 0!==t.property,s=r||!i,o=t.type||(Rs(n)?"exponential":"interval");if(e&&((t=sr({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],zr.parse(t[1])]))),t.default?t.default=zr.parse(t.default):t.default=zr.parse(n.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!rs[t.colorSpace])throw new Error(\`Unknown color space: ${XR}t.colorSpace}\`);let a,u,l;if("exponential"===o)a=Ys;else if("interval"===o)a=Xs;else if("categorical"===o){a=Bs,u=Object.create(null);for(const n of t.stops)u[n[0]]=n[1];l=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(\`Unknown function type "${XR}o}"\`);a=Ks}if(r){const e={},r=[];for(let n=0;n<t.stops.length;n++){const i=t.stops[n],s=i[0].zoom;void 0===e[s]&&(e[s]={zoom:s,type:t.type,property:t.property,default:t.default,stops:[]},r.push(s)),e[s].stops.push([i[0].value,i[1]])}const i=[];for(const t of r)i.push([e[t].zoom,Js(e[t],n)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:os.interpolationFactor.bind(void 0,s),zoomStops:i.map((t=>t[0])),evaluate:({zoom:e},r)=>Ys({stops:i,base:t.base},n,e).evaluate(e,r)}}if(s){const e="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:e,interpolationFactor:os.interpolationFactor.bind(void 0,e),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:e})=>a(t,n,e,u,l)}}return{kind:"source",evaluate(e,r){const i=r&&r.properties?r.properties[t.property]:void 0;return void 0===i?Ws(t.default,n.default):a(t,n,i,u,l)}}}function Ws(t,n,e){return void 0!==t?t:void 0!==n?n:void 0!==e?e:void 0}function Bs(t,n,e,r,i){return Ws(typeof e===i?r[e]:void 0,t.default,n.default)}function Xs(t,n,e){if("number"!==Vs(e))return Ws(t.default,n.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(e<=t.stops[0][0])return t.stops[0][1];if(e>=t.stops[r-1][0])return t.stops[r-1][1];const i=$i(t.stops.map((t=>t[0])),e);return t.stops[i][1]}function Ys(t,n,e){const r=void 0!==t.base?t.base:1;if("number"!==Vs(e))return Ws(t.default,n.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(e<=t.stops[0][0])return t.stops[0][1];if(e>=t.stops[i-1][0])return t.stops[i-1][1];const s=$i(t.stops.map((t=>t[0])),e),o=function(t,n,e,r){const i=r-e,s=t-e;return 0===i?0:1===n?s/i:(Math.pow(n,s)-1)/(Math.pow(n,i)-1)}(e,r,t.stops[s][0],t.stops[s+1][0]),a=t.stops[s][1],u=t.stops[s+1][1];let l=ji[n.type]||Gs;if(t.colorSpace&&"rgb"!==t.colorSpace){const n=rs[t.colorSpace];l=(t,e)=>n.reverse(n.interpolate(n.forward(t),n.forward(e),o))}return"function"==typeof a.evaluate?{evaluate(...t){const n=a.evaluate.apply(void 0,t),e=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==e)return l(n,e,o)}}:l(a,u,o)}function Ks(t,n,e){return"color"===n.type?e=zr.parse(e):"formatted"===n.type?e=Ur.fromString(e.toString()):"resolvedImage"===n.type?e=jr.fromString(e.toString()):Vs(e)===n.type||"enum"===n.type&&n.values[e]||(e=void 0),Ws(e,t.default,n.default)}class Zs{constructor(t,n){this.expression=t,this.G={},this.J=new ni,this.W=n?function(t){return"color"===t.type&&(qs(t.default)||Array.isArray(t.default))?new zr(0,0,0,0):"color"===t.type?zr.parse(t.default)||null:void 0===t.default?null:t.default}(n):null,this.B=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(t,n,e,r,i,s,o,a){return this.J.globals=t,this.J.feature=n,this.J.featureState=e,this.J.canonical=r||null,this.J.availableImages=i||null,this.J.formattedSection=s,this.J.featureTileCoord=o||null,this.J.featureDistanceData=a||null,this.expression.evaluate(this.J)}evaluate(t,n,e,r,i,s,o,a){this.J.globals=t,this.J.feature=n||null,this.J.featureState=e||null,this.J.canonical=r||null,this.J.availableImages=i||null,this.J.formattedSection=s||null,this.J.featureTileCoord=o||null,this.J.featureDistanceData=a||null;try{const t=this.expression.evaluate(this.J);if(null==t||"number"==typeof t&&t!=t)return this.W;if(this.B&&!(t in this.B))throw new Gr(\`Expected value to be one of ${XR}Object.keys(this.B).map((t=>JSON.stringify(t))).join(", ")}, but found ${XR}JSON.stringify(t)} instead.\`);return t}catch(t){return this.G[t.message]||(this.G[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this.W}}}function Qs(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Ns}function to(t,n){const e=new Ci(Ns,[],n?function(t){const n={color:pr,string:fr,number:cr,enum:fr,boolean:dr,formatted:vr,resolvedImage:br};if("array"===t.type)return wr(n[t.value]||mr,t.length);return n[t.type]}(n):void 0),r=e.parse(t,void 0,void 0,void 0,n&&"string"===n.type?{typeAnnotation:"coerce"}:void 0);return r?Ls(new Zs(r,n)):Hs(e.errors)}class no{constructor(t,n){this.kind=t,this.X=n,this.isStateDependent="constant"!==t&&!Ai(n.expression)}evaluateWithoutErrorHandling(t,n,e,r,i,s){return this.X.evaluateWithoutErrorHandling(t,n,e,r,i,s)}evaluate(t,n,e,r,i,s){return this.X.evaluate(t,n,e,r,i,s)}}class eo{constructor(t,n,e,r){this.kind=t,this.zoomStops=e,this.X=n,this.isStateDependent="camera"!==t&&!Ai(n.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,n,e,r,i,s){return this.X.evaluateWithoutErrorHandling(t,n,e,r,i,s)}evaluate(t,n,e,r,i,s){return this.X.evaluate(t,n,e,r,i,s)}interpolationFactor(t,n,e){return this.interpolationType?os.interpolationFactor(this.interpolationType,t,n,e):0}}function ro(t,n){if("error"===(t=to(t,n)).result)return t;const e=t.value.expression,r=ki(e);if(!r&&!function(t){return"data-driven"===t["property-type"]}(n))return Hs([new ar("","data expressions not supported")]);const i=Pi(e,["zoom","pitch","distance-from-center"]);if(!i&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(n))return Hs([new ar("","zoom expressions not supported")]);const s=so(e);if(!s&&!i)return Hs([new ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(s instanceof ar)return Hs([s]);if(s instanceof os&&!Rs(n))return Hs([new ar("",'"interpolate" expressions cannot be used with this property')]);if(!s)return Ls(new no(r?"constant":"source",t.value));const o=s instanceof os?s.interpolation:void 0;return Ls(new eo(r?"camera":"composite",t.value,s.labels,o))}class io{constructor(t,n){this.Y=t,this.K=n,sr(this,Js(this.Y,this.K))}static deserialize(t){return new io(t.Y,t.K)}static serialize(t){return{Y:t.Y,K:t.K}}}function so(t){let n=null;if(t instanceof hs)n=so(t.result);else if(t instanceof us){for(const e of t.args)if(n=so(e),n)break}else(t instanceof zi||t instanceof os)&&t.input instanceof ri&&"zoom"===t.input.name&&(n=t);return n instanceof ar||t.eachChild((t=>{const e=so(t);e instanceof ar?n=e:!n&&e?n=new ar("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&e&&n!==e&&(n=new ar("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}function oo(t){if(Array.isArray(t))return t.map(oo);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const n={};for(const e in t)n[e]=oo(t[e]);return n}return function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}(t)}function ao(t,n="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};const e=t;let r=!0;try{r=function(t){if(!ho(t))return t;let n=oo(t);return lo(n),n=uo(n),n}(e)}catch(t){console.warn(\`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\\nand paste the contents of this message in the report.\\nThank you!\\nFilter Expression:\\n${XR}JSON.stringify(e,null,2)}\\n        \`)}const i=to(r,null);let s=null;if("error"===i.result)throw new Error(i.value.map((t=>\`${XR}t.key}: ${XR}t.message}\`)).join(", "));s=(t,n,e)=>i.value.evaluate(t,n,{},e);let o=null,a=null;if(r!==e){const t=to(e,null);if("error"===t.result)throw new Error(t.value.map((t=>\`${XR}t.key}: ${XR}t.message}\`)).join(", "));o=(n,e,r,i,s)=>t.value.evaluate(n,e,{},r,void 0,void 0,i,s),a=!ki(t.value.expression)}return{filter:s,dynamicFilter:o||void 0,needGeometry:fo(r),needFeature:!!a}}function uo(t){if(!Array.isArray(t))return t;const n=function(t){if(co.has(t[0]))for(let n=1;n<t.length;n++){if(ho(t[n]))return!0}return t}(t);return!0===n?n:n.map((t=>uo(t)))}function lo(t){let n=!1;const e=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)n=n||ho(t[r]),e.push(t[r+1]);e.push(t[t.length-1])}else if("match"===t[0]){n=n||ho(t[1]);for(let n=2;n<t.length-1;n+=2)e.push(t[n+1]);e.push(t[t.length-1])}else if("step"===t[0]){n=n||ho(t[1]);for(let n=1;n<t.length-1;n+=2)e.push(t[n+1])}n&&(t.length=0,t.push("any",...e));for(let n=1;n<t.length;n++)lo(t[n])}function ho(t){if(!Array.isArray(t))return!1;if(function(t){return"pitch"===t||"distance-from-center"===t}(t[0]))return!0;for(let n=1;n<t.length;n++){if(ho(t[n]))return!0}return!1}const co=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fo(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let n=1;n<t.length;n++)if(fo(t[n]))return!0;return!1}const po={StyleExpression:Zs,isExpression:Qs,isExpressionFilter:function t(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!t(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}},createExpression:to,createPropertyExpression:ro,normalizePropertyExpression:function(t,n){if(qs(t))return new io(t,n);if(Qs(t)){const e=ro(t,n);if("error"===e.result)throw new Error(e.value.map((t=>\`${XR}t.key}: ${XR}t.message}\`)).join(", "));return e.value}{let e=t;return"string"==typeof t&&"color"===n.type&&(e=zr.parse(t)),{kind:"constant",evaluate:()=>e}}},ZoomConstantExpression:no,ZoomDependentExpression:eo,StylePropertyFunction:io},{isExpression:yo,createExpression:mo}=po;function go(t=[]){return bo(t=t.map((t=>{const n=$e({},t);return n.filter&&n.filter.value&&(n.filter=n.filter.value),n})))}const vo={};function bo(t){if(!Array.isArray(t))return bo([t]);const n=[];for(let e=0;e<t.length;e++){let r;r=!0===t[e].filter?function(){return!0}:wo(t[e].filter),n.push($e({},t[e],{filter:r}))}return n}function wo(t){if(!0===t)return function(){return!0};if(t&&t.condition){if("any"===t.type){const n=t.condition,e=[];for(let t=0;t<n.length;t++)e.push(wo(n[t]));return(t,n)=>{for(let r=0;r<e.length;r++)if(e[r](t,n))return!0;return!1}}const n=wo(t.condition);if(Ie(t.layer))return n;const e=n=>n.layer===t.layer;return(t,r)=>e(t)&&n(t,r)}if(We(t))return Je(t);{let n=ao(t);n=n&&n.filter;const e=(t,e)=>(vo.zoom=e,n&&n(vo,t));return e}}const Mo={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function xo(t,n){Mo.type=n||"number";const e=mo(t,Mo);if("success"!==e.result)throw new Error(\`Invalid maplibre spec expression: ${XR}JSON.stringify(t)} (${XR}e.value})\`);return e.value}function Fo(t){return yo(t)}const ko={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function Ao(t){return ko[t]}const Po={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1},So={lineDasharray:1,markerLineDasharray:1,uvScale:1,uvOffset:1};function _o(t){return Po[t]?"string":Ao(t)?"number":So[t]?"array":"color"}const Oo="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,Co=function(t){return class extends t{pushIn(...t){const n=t.length;for(let e=0;e<n;e++)this[this.currentIndex++]=t[e]}fill(t,n,e){super.fill(t,n,e),e>this.currentIndex&&(this.currentIndex=e)}set(t,n){t>=this.currentIndex&&(this.currentIndex=t+1),this[t]=n}getLength(){return this.currentIndex}setLength(t){this.currentIndex=t,super.length<t&&(super.length=t)}trySetLength(t){t>this.currentIndex&&this.setLength(t)}reset(){this.currentIndex=0}slice(t,n){const e=super.slice(t,n);return e.currentIndex=n-t,e}}},Eo=Co(Array),$o={get:function(t,n){return"length"===n?t.getLength():t[n]}};class Io extends Array{setLength(t){this.length=t,this.currentIndex=t}trySetLength(t){this.length=t,this.currentIndex=t}getLength(){return this.length}}let zo;class Do{static createTypedArray(t,n){return Hn(t,n)}static getInstance(){return zo}static ensureCapacity(t,n){if(!t.BYTES_PER_ELEMENT)return t;if(t.length>=n)return t;const e=new t.constructor(n+Math.ceil(.5*n)),r=t.getLength();for(let n=0;n<r;n++)e[n]=t[n];return e.currentIndex=t.currentIndex,e}static getArray(t){let n;if(t){const e=Co(t),r=1048576/e.BYTES_PER_ELEMENT;n=new e(r)}else n=new Eo;return n.push=(...t)=>{n.pushIn(...t)},n}static getProxyArray(){const t=new Eo,n=new Proxy(t,$o);return n.push=(...n)=>{t.pushIn(...n)},n.L=t,n}constructor(){this.Z=[],this.tt=0,this.nt=[],this.et=0,this.rt={}}getProxy(){if(!Oo){const t=new Io;return t.currentIndex=0,t}const t=this.nt[this.et]=this.nt[this.et]||Do.getProxyArray();return t.reset(),this.et++,t}get(t){if(!Oo){const t=new Io;return t.currentIndex=0,t}if(t){const n=t.name;let e=this.rt[n];e||(e=this.rt[n]={arrays:[],index:0});const r=e.index,i=e.arrays[r]=e.arrays[r]||Do.getArray(t);return i.reset(),e.index++,i}const n=this.Z[this.tt]=this.Z[this.tt]||Do.getArray();return n.reset(),this.tt++,n}reset(){this.tt=0,this.et=0;for(const t in this.rt)this.rt[t].index=0}}zo=new Do;const To="__fea_idx",Uo=[],jo={},No={},Lo={},Ho=[],Ro=Do.getInstance();let Vo=!1;const qo=Math.pow(2,17);class Go{static isAtlasLoaded(t,n={}){const{iconAtlas:e}=n;return!!(!t||e&&e.positions[t])}static genFnTypes(t){const n={};for(const e in t)if(Fo(t[e])){const r=(e+"_Fn_0").trim(),i=(e+"Fn").trim(),s=_o(e);n[r]=xo(t[e],s),n[i]=(t,e)=>{let i;jo.zoom=t,No.properties=e;try{i=n[r].evaluateWithoutErrorHandling(jo,No,Lo,null,Ho)}catch(t){return null}return i}}else if(Ne(t[e])){const r=(e+"_Fn_0").trim(),i=(e+"Fn").trim();Ao(e)?(n[r]=v(t[e]),n[i]=(t,e)=>{const i=n[r](t,e);return Ne(i)?v(i)(t,e):i}):(n[r]=b(t[e]),n[i]=(t,e)=>{const i=n[r](t,e);return Ne(i)?b(i)(t,e):i})}return n}constructor(t,n,e){this.options=e;const r=[];this.symbolDef=n,this.symbol=w(n,(()=>(r[0]=e.zoom,r))),this.styledVectors=[],this.properties={},this.it=e.fnTypes||Go.genFnTypes(this.symbolDef),Ne(this.symbolDef.visible)&&(this.st=v(this.symbolDef.visible)),e.atlas&&(this.iconAtlas=e.atlas.iconAtlas,this.glyphAtlas=e.atlas.glyphAtlas),this.features=this.ot(t)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=qo||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Float32Array,width:3,name:"aPosition"}]}fillPosition(t,n,e,r){if(n<this.ut&&(this.ut=n),n>this.lt&&(this.lt=n),e<this.ht&&(this.ht=e),e>this.ct&&(this.ct=e),this.needAltitudeAttribute()){let i=t.aPosition.currentIndex;t.aPosition[i++]=n,t.aPosition[i++]=e,t.aPosition.currentIndex=i,i=t.aAltitude.currentIndex,t.aAltitude[i++]=r,t.aAltitude.currentIndex=i}else{!function(t,n,e,r){const i=Math.abs(r)>>15,s=i>>1,o=i%2;let a=r%Math.pow(2,15);const u=n+(s<<14)*Math.sign(n),l=e+(o<<14)*Math.sign(e);t[0]=u,t[1]=l,a=Math.round(a),t[2]=0===a?r<0?-1:0:a}(Uo,n,e,r);let i=t.aPosition.currentIndex;t.aPosition[i++]=Uo[0],t.aPosition[i++]=Uo[1],t.aPosition[i++]=Uo[2],t.aPosition.currentIndex=i}}ot(t){if(!t.length)return t;const n=(To+"").trim();let e,r=0,i=t[r];for(;!i.geometry;)r++,i=t[r];if(Array.isArray(i.geometry)&&i.properties){let n=i.geometry[0];for(;Array.isArray(n);)n=n[0];n instanceof ln&&(e=t)}if(!e)if(e=[],Array.isArray(i.geometry))for(let n=0;n<t.length;n++){const r=$e({},t[n]);e.push(Rn(r))}else for(let r=0;r<t.length;r++){const i=t[r],s=cn(i);for(let t=0;t<s.length;t++){const r=s[t];r[n]=i[n],e.push(r)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const t="line"===this.symbolDef.textPlacement;let n=0,r=!1;const{textPitchAlignmentFn:i}=this.it;!i&&t&&"map"===this.symbolDef.textPitchAlignment&&(r=!0);for(let s=0;s<e.length;s++){const o=Wo(e[s]&&e[s].geometry);if(o>n&&(n=o),t&&!r&&i&&e[s].properties){const t=i(null,e[s].properties);"map"===t&&(r=t)}}this.hasMapPitchAlign=r,this.maxPosZ=n}const s=this.options.order;if(s){const t=[];for(let n=0;n<s.length;n++)s[n]&&t.push(wo(s[n]));e=e.sort(((n,e)=>{const r=t.length;let i=-1,s=-1;for(let o=0;o<r&&(t[o](n)&&(i=o),t[o](e)&&(s=o),!(i>=0&&i<r&&s>=0&&s<r));o++);return i-s}))}return e}load(t=1){const n=(To+"").trim(),e="_debug_info".trim(),r=this.it,i=this.styledVectors;this.count=0;const s=this.features;if(!s||!s.length)return Promise.resolve(null);const o={},a={},u={zoom:this.options.zoom,isVector3D:!!this.options.center},l=[],h=w(this.symbolDef,(()=>(l[0]=u.zoom,l)));let c=0,f=s.length;const d=this.options.debugIndex;try{for(;c<f;c++){const t=s[c];if(!t||!t.geometry)continue;if(ze(d)&&t[e].index!==d)continue;t.properties||(t.properties={}),t.properties.$layer=t.layer,t.properties.$type=t.type;const l=this.createStyledVector(t,h,r,u,o,a);l&&l.feature.geometry&&(l.featureIdx=void 0===t[n]?c:t[n],this.count++,i.push(l))}}catch(t){return Promise.reject(t)}return this.options.atlas?Promise.resolve(this.pack(t)):this.loadAtlas(o,a).then((()=>this.pack(t)))}loadAtlas(t,n){return new Promise(((e,r)=>{this.fetchAtlas(t,n,((t,n)=>{if(t)r(t);else{if(n){const{icons:t,glyphs:e}=n;if(t&&Object.keys(t).length){for(const n in t){const e=t[n],{width:r,height:i,data:s}=e.data;e.data=new kn({width:r,height:i},s)}this.iconAtlas=new Dn(t)}if(e&&Object.keys(e).length){for(const t in e){const n=e[t];for(const t in n){const e=n[t],{width:r,height:i,data:s}=e.bitmap;e.bitmap=new Fn({width:r,height:i},s)}}this.glyphAtlas=new Un(e)}}e({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}}))}))}fetchAtlas(t,n,e){Object.keys(t).length>0||Object.keys(n).length>0?this.options.requestor(t,n,e):e()}pack(t){if(!this.count)return null;if(null==t)throw new Error("layout scale is undefined");const n=this.createDataPack(this.styledVectors,t);if(!n)return null;n.properties=this.properties,this.empty&&(n.empty=!0);const e=n.buffers;delete n.buffers;const r={data:n,buffers:e};if(this.iconAtlas){const t=r.data.iconAtlas=Jo(this.iconAtlas);if(t.glyphMap)for(const n in t.glyphMap){const r=t.glyphMap[n];e.push(r.data.data.buffer)}e.push(r.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(r.data.glyphAtlas=Jo(this.glyphAtlas),e.push(r.data.glyphAtlas.image.data.buffer)),r}createStyledVector(t,n,e,r){return new qe(t,n,e,r)}createDataPack(t,n){if(!t||!t.length)return null;this.maxIndex=0,this.maxPos=0,this.ut=this.ht=1/0,this.lt=this.ct=-1/0,this.maxAltitude=0,this.dynamicAttrs={};const e=this.data={};this.ft=Ro,Ro.reset();let r=this.elements=Ro.get();const i=this.dt=this.getFormat(Array.isArray(t[0])?t[0][0].symbol:t[0].symbol),s=this.needAltitudeAttribute()?2:3;for(let t=0;t<i.length;t++)e[i[t].name]=Ro.get(i[t].type);let o=Ro.get(),a=0;const u=Ro.get();let l=0,h=!1,c=!0;const f=new Set;for(let r=0,i=t.length;r<i;r++){if(!t[r].feature.geometry)continue;const i=Array.isArray(t[r])?t[r][0].feature.id:t[r].feature.id;c&&(void 0!==No.id?f&&(f.has(No.id)?c=!1:f.add(No.id)):c=!1),ze(i)&&(Math.abs(i)>l&&(l=Math.abs(i)),i<0&&(h=!0));const d=this.data.aPosition.getLength();if(Array.isArray(t[r]))for(let e=0;e<t[r].length;e++)this.yt(t[r][e],n);else this.yt(t[r],n);const p=(e.aPosition.getLength()-d)/s;for(let n=0;n<p;n++)o.push(t[r].featureIdx),ze(i)&&u.push(i);a=Math.max(a,t[r].featureIdx)}if(this.countOutOfAngle>0&&!Vo&&(Vo=!0,console.warn("text anchor along line is ignored as anchor's line angle is bigger than textMaxAngle.")),this.hasElements()&&!r.getLength())return null;const d=!!this.options.center?Float32Array:Ln(a);o=Do.createTypedArray(o,d),this.options.positionType?i[0].type=this.options.positionType:i[0].type=Nn(this.maxPos);const p=this.options.center;if(p&&(p[0]||p[1])){const t=e.aPosition,n=t.getLength();for(let e=0;e<n;e+=s)t[e]-=p[0],t[e+1]-=p[1]}const y=function(t,n){const e={};for(let r=0;r<t.length;r++){const i=t[r],s=i.type,o=i.name;e[o]=s===Array?n[o]:Hn(n[o],s)}return e}(i,e);y.aPickingId=o;const m=[];for(const t in y)m.push(y[t].buffer);const g=jn(this.maxIndex);r=Do.createTypedArray(r,g),m.push(r.buffer);const v={data:y,isIdUnique:c,is2D:0===this.maxPosZ,indices:this.hasElements()?r:null,positionSize:s,positionBounding:[this.ut,this.ht,this.lt,this.ct],buffers:m,symbolIndex:this.symbolDef.index||{index:0},dynamicAttributes:this.dynamicAttrs};if(this.gt&&(v.markerPlacement=this.gt),this.vt&&(v.textPlacement=this.vt),u.getLength()){const t=h?Nn(l):Ln(l);v.featureIds=Do.createTypedArray(u,t),m.push(v.featureIds.buffer)}else v.featureIds=[];return v.pickingIdIndiceMap=$n(o,v.indices),v}yt(t,n){const e=t.feature.properties;this.st&&!this.st(this.options.zoom,e)||this.placeVector(t,n,this.formatWidth)}addElements(t,n,e){this.maxIndex=Math.max(this.maxIndex,t,n,e);let r=this.elements.currentIndex;this.elements[r++]=t,this.elements[r++]=n,this.elements[r++]=e,this.elements.currentIndex=r}hasElements(){return!0}getAltitude(t){const{altitudeProperty:n,defaultAltitude:e,altitudeScale:r}=this.options;let i=Sn(t,n,e);return r&&(i*=r),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(i)),i}getIconAtlasMaxValue(){const t=this.iconAtlas.positions;let n=0;for(const e in t)if(je(t,e)){const{tl:r,displaySize:i}=t[e],s=Math.max(r[0],r[1],i[0]-1,i[1]-1);s>n&&(n=s)}return n}ensureDataCapacity(t,n){const e=this.dt;for(let r=0;r<e.length;r++){const i=this.data[e[r].name];if(!i)continue;const s=e[r].width*t,o=i.getLength();this.data[e[r].name]=Do.ensureCapacity(i,o+s*n)}}}function Jo(t){let n=t.positions,e=t.image&&t.image.format||"alpha";if(t instanceof Dn){n={};for(const e in t.positions){const r=t.positions[e];n[e]={paddedRect:r.paddedRect,pixelRatio:r.pixelRatio,tl:r.tl,br:r.br,displaySize:r.displaySize}}e="rgba"}const r=t.image;return{image:{width:r.width,height:r.height,data:r.data,format:e},glyphMap:t.glyphMap,positions:n}}function Wo(t){if(!t)return 0;let n=0;if(Array.isArray(t))for(let e=0;e<t.length;e++)if(Array.isArray(t[e])){const r=Wo(t[e]);r>n&&(n=r)}else{const r=Math.abs(t[e].z||0);r>n&&(n=r)}else{const e=Math.abs(t.z||0);e>n&&(n=e)}return n}const Bo="___fn_in_stops";function Xo(t,n,e,r){const i="__fn_textSize".trim();let s=t.textSize;if(Ie(n.textSize))return[16,16];t[i]&&(s=t[i]);const o=[];var a;if(Ie(a=s)||"function"!=typeof a&&(null===a.constructor||a.constructor!==Function)?o[0]=s:o[0]=s(r,e),g(o[0])){const n=o[0].__fn_key=o[0].__fn_key||JSON.stringify(o[0]);t[Bo]||(t[Bo]={}),t[Bo][n]||(t[Bo][n]=v(o[0]));const i=t[Bo][n];o[0]=i(r,e)}return o[1]=o[0],o}function Yo(t){const n=t.stops;let e=-1/0;for(let t=0;t<n.length;t++){let r=n[t][1];De(n[t][1])&&(r=Yo(n[t][1])),r>e&&(e=r)}return e}const Ko=["{","}"],Zo="";const Qo=/\\{[\\w-]+(?:\\|[\\w-]+)*\\}/g;function ta(t,n){if(!Te(t))return t;function e(t){if(!n)return Zo;const e=n[t];return Ie(e)?Zo:Array.isArray(e)?e.join():e}const[r,i]=Ko,s=function(t){t+=Zo;const[n,e]=Ko,r=[];let i=!1,s=Zo;for(let o=0,a=t.length;o<a;o++){const a=t[o];i||a!==n||(i=!0),a===n&&i&&(s=Zo),i&&a!==n&&a!==e&&(s+=a),a===e&&s&&(i=!1,r.push(s),s=Zo)}return r}(t);for(let n=0,o=s.length;n<o;n++){const o=s[n],a=\`${XR}r}${XR}o}${XR}i}\`;if(o.indexOf("|")>0){const n=o.split("|");let r=!1;for(let i=0;i<n.length;i++){const s=e(n[i]);if(s!==Zo){t=ea(t,a,s),r=!0;break}}r||(t=ea(t,a,Zo))}else{t=ea(t,a,e(o))}}return t}function na(t,n){if(2!==n.length||"get"!==n[0])for(let e=0;e<n.length;e++)2===n[e].length&&"get"===n[e][0]?t.push(n[e][1]):Array.isArray(n[e])&&na(t,n[e]);else t.push(n[1])}function ea(t,n,e){if(!t)return t;if(t.replaceAll)return t.replaceAll(n,e);for(;t.indexOf(n)>-1;)t=t.replace(n,e);return t}const ra={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function ia(t){return!ra.Arabic(t)&&(!ra["Arabic Supplement"](t)&&(!ra["Arabic Extended-A"](t)&&(!ra["Arabic Presentation Forms-A"](t)&&!ra["Arabic Presentation Forms-B"](t))))}function sa(t){return!(t<11904)&&(!!ra["Bopomofo Extended"](t)||(!!ra.Bopomofo(t)||(!!ra["CJK Compatibility Forms"](t)||(!!ra["CJK Compatibility Ideographs"](t)||(!!ra["CJK Compatibility"](t)||(!!ra["CJK Radicals Supplement"](t)||(!!ra["CJK Strokes"](t)||(!!ra["CJK Symbols and Punctuation"](t)||(!!ra["CJK Unified Ideographs Extension A"](t)||(!!ra["CJK Unified Ideographs"](t)||(!!ra["Enclosed CJK Letters and Months"](t)||(!!ra["Halfwidth and Fullwidth Forms"](t)||(!!ra.Hiragana(t)||(!!ra["Ideographic Description Characters"](t)||(!!ra["Kangxi Radicals"](t)||(!!ra["Katakana Phonetic Extensions"](t)||(!!ra.Katakana(t)||(!!ra["Vertical Forms"](t)||(!!ra["Yi Radicals"](t)||!!ra["Yi Syllables"](t))))))))))))))))))))}function oa(t){return 746===t||747===t||!(t<4352)&&(!!ra["Bopomofo Extended"](t)||(!!ra.Bopomofo(t)||(!(!ra["CJK Compatibility Forms"](t)||t>=65097&&t<=65103)||(!!ra["CJK Compatibility Ideographs"](t)||(!!ra["CJK Compatibility"](t)||(!!ra["CJK Radicals Supplement"](t)||(!!ra["CJK Strokes"](t)||(!(!ra["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||(!!ra["CJK Unified Ideographs Extension A"](t)||(!!ra["CJK Unified Ideographs"](t)||(!!ra["Enclosed CJK Letters and Months"](t)||(!!ra["Hangul Compatibility Jamo"](t)||(!!ra["Hangul Jamo Extended-A"](t)||(!!ra["Hangul Jamo Extended-B"](t)||(!!ra["Hangul Jamo"](t)||(!!ra["Hangul Syllables"](t)||(!!ra.Hiragana(t)||(!!ra["Ideographic Description Characters"](t)||(!!ra.Kanbun(t)||(!!ra["Kangxi Radicals"](t)||(!!ra["Katakana Phonetic Extensions"](t)||(!(!ra.Katakana(t)||12540===t)||(!(!ra["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||(!(!ra["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(!!ra["Unified Canadian Aboriginal Syllabics"](t)||(!!ra["Unified Canadian Aboriginal Syllabics Extended"](t)||(!!ra["Vertical Forms"](t)||(!!ra["Yijing Hexagram Symbols"](t)||(!!ra["Yi Syllables"](t)||!!ra["Yi Radicals"](t))))))))))))))))))))))))))))))}function aa(t){return!(oa(t)||function(t){return!!(ra["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||ra["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||ra["Letterlike Symbols"](t)||ra["Number Forms"](t)||ra["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||ra["Control Pictures"](t)&&9251!==t||ra["Optical Character Recognition"](t)||ra["Enclosed Alphanumerics"](t)||ra["Geometric Shapes"](t)||ra["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ra["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ra["CJK Symbols and Punctuation"](t)||ra.Katakana(t)||ra["Private Use Area"](t)||ra["CJK Compatibility Forms"](t)||ra["Small Form Variants"](t)||ra["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function ua(t){return t>=1424&&t<=2303||ra["Arabic Presentation Forms-A"](t)||ra["Arabic Presentation Forms-B"](t)}const la=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function ha(t){for(const n of la)if(t>=n[0]&&t<=n[1])return!0;return!1}const ca={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\\\":"＼","]":"﹈","^":"＾",_:"︳","\`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};const fa={horizontal:1,vertical:2,horizontalOnly:3};function da(t,n,e,r,i,s,o,a,u,l){let h=t.trim();l===fa.vertical&&(h=function(t){let n="";const e=Array.from(t);for(let t=0;t<e.length;t++){const r=e[t+1].codePointAt(0)||null,i=e[t-1].codePointAt(0)||null;r&&aa(r)&&!ca[e[t+1]]||i&&aa(i)&&!ca[e[t-1]]||!ca[e[t]]?n+=e[t]:n+=ca[e[t]]}return n}(h));const c=[],f={positionedGlyphs:c,text:h,top:a[1],bottom:a[1],left:a[0],right:a[0],writingMode:l};let d;return d=function(t,n){const e=[];let r=0;for(let i=0;i<n.length;i++){const s=n[i];e.push(t.substring(r,s)),r=s}return r<t.length&&e.push(t.substring(r,t.length)),e}(h,function(t,n,e,r){if(!e)return[];if(!t)return[];const i=[],s=function(t,n,e,r){let i=0;for(let e=0;e<t.length;e++){const s=r[t.codePointAt(e)];s&&(i+=s.metrics.advance+n)}const s=Math.max(1,Math.ceil(i/e));return i/s}(t,n,e,r);let o=0;for(let e=0;e<t.length;e++){const a=t.codePointAt(e),u=r[a];u&&(u&&!pa[a]&&(o+=u.metrics.advance+n),e<t.length-1&&(ya[a]||sa(a))&&i.push(va(e+1,o,s,i,ga(a,t.codePointAt(e+1)),!1)))}return ba(va(t.length,o,s,i,0,!0))}(h,o,e,n)),function(t,n,e,r,i,s,o,a,u,l){let h=0,c=0,f=0;const d=t.positionedGlyphs,p=.5;for(let t=0;t<e.length;t++){let i=e[t];if(i=i.trim(),!i.length){c-=r;continue}const s=d.length;for(let t=0;t<i.length;t++){const e=i.codePointAt(t),r=n[e];r&&(oa(e)&&o!==fa.horizontal?(32!==e&&d.push({glyph:e,x:h,y:0,vertical:!0}),h+=u+a):(32!==e&&d.push({glyph:e,x:h,y:c,vertical:!1}),h+=r.metrics.advance+a))}if(d.length!==s){const t=h-a;f=Math.max(t,f),Ma(d,n,s,d.length-1,p)}h=0,c-=r}const{horizontalAlign:y,verticalAlign:m}=wa(i,l);!function(t,n,e,r,i,s,o){const a=(n-e)*i,u=-(-r*o+.5)*s;if(!a&&!u)return;for(let n=0;n<t.length;n++)t[n].x+=a,t[n].y+=u}(d,p,y,m,f,r,e.length);const g=e.length*r;t.top+=-m*g,t.bottom=t.top+g,t.left+=-y*f,t.right=t.left+f}(f,n,d,r,i,0,l,o,u),!!c.length&&f}const pa={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ya={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function ma(t,n,e,r){const i=Math.pow(t-n,2);return r?t<n?i/2:2*i:i+Math.abs(e)*e}function ga(t,n){let e=0;return 10===t&&(e-=1e4),40!==t&&65288!==t||(e+=50),41!==n&&65289!==n||(e+=50),e}function va(t,n,e,r,i,s){let o=null,a=ma(n,e,i,s);for(let t=0;t<r.length;t++){const u=r[t],l=ma(n-u.x,e,i,s)+u.badness;l<=a&&(o=u,a=l)}return{index:t,x:n,priorBreak:o,badness:a}}function ba(t){return t?ba(t.priorBreak).concat(t.index):[]}function wa(t,n){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=n?1:0;break;case"left":case"top-left":case"bottom-left":e=n?0:1}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=n?1:0;break;case"top":case"top-right":case"top-left":r=n?0:1}return{horizontalAlign:e,verticalAlign:r}}function Ma(t,n,e,r,i){const s=n[t[r].glyph];if(s){const n=s.metrics.advance,o=(t[r].x+n)*i;if(!o)return;for(let n=e;n<=r;n++)t[n].x-=o}}function xa(t){if(!function(t){for(const n of t)if(ua(n.charCodeAt(0)))return!0;return!1}(t))return t;const n=[],e=[],r=[];let i=0,s=0,o=1,a=1;for(const u of t){const t=u.codePointAt(0);ha(t)?(r.push(u),i++):(o=ua(t)?-1:1,a!==o?(s=i,e.length&&(a>0&&e.reverse(),n.push(...e)),r.length&&(n.splice(s,0,...r),r.length=0),a=o,e.length=0):r.length&&(e.push(...r),r.length=0),e.push(u),i++)}return r.length&&e.push(...r),e.length&&(a>0&&e.reverse(),n.push(...e)),n.reverse().join("")}const Fa=/\\{ *([\\w_]+) *\\}/g;class ka{constructor(t,n,e,r,i){this.feature=t,this.symbolDef=n,this.symbol=e,this.options=i,this.bt=this.wt.bind(this),this.it=r}wt(t,n){return this.feature.properties[n]||""}getShape(t,n){if(this.Mt)return this.Mt;const{textHorizontalAlignmentFn:e,textVerticalAlignmentFn:r,markerHorizontalAlignmentFn:i,markerVerticalAlignmentFn:s,textWrapWidthFn:o}=this.it;let a;const u=this.symbol,l=this.getIconAndGlyph(),h=this.feature.properties;if(l&&l.glyph){const{font:t,text:i}=l.glyph;if(""===i)return null;const s=24,c=this.size[0]/s,f=24,d=u.textKeepUpright,p="map"===u.textRotationAlignment&&"line"===u.textPlacement&&!u.isIconText,y=n.glyphMap[t],m=Aa(e?e(null,h):u.textHorizontalAlignment,r?r(null,h):u.textVerticalAlignment),g=1.2*f,v=function(t){for(let n=0;n<t.length;n++)if(!ia(t.charAt(n).charCodeAt(0)))return!1;return!0}(i),b=v&&u.textLetterSpacing/c||0,w=[u.textDx/c||0,u.textDy/c||0],M=((o?o(null,h):u.textWrapWidth)||10*f)/c;a={},a.horizontal=da(i,y,M,g,m,0,b,w,f,fa.horizontal,this.options.isVector3D),v&&p&&d&&(a.vertical=da(i,y,M,g,m,0,b,w,f,fa.vertical))}else if(l&&l.icon){if(!t||!t.positions[l.icon.url])return null;const n=Aa(i?i(null,h):u.markerHorizontalAlignment,s?s(null,h):u.markerVerticalAlignment);a=function(t,n,e){let{horizontalAlign:r,verticalAlign:i}=wa(n,e);e?r=1-r:i=1-i;const s=-2048*r,o=-2048*i;return{image:t,top:o,bottom:o+2048,left:s,right:s+2048}}(t.positions[l.icon.url],n,this.options.isVector3D),this.size||(this.size=a.image.displaySize)}return this.Mt=a,a}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:t,markerTypeFn:n,markerPathFn:e,markerWidthFn:r,markerHeightFn:i,markerFillFn:s,markerFillPatternFileFn:o,markerFillOpacityFn:a,markerTextFitFn:u,markerTextFitPaddingFn:l,markerLineColorFn:h,markerLineWidthFn:c,markerLineOpacityFn:f,markerLineDasharrayFn:d,markerLinePatternFileFn:p,markerPathWidthFn:y,markerPathHeightFn:m,textNameFn:b,textFaceNameFn:w}=this.it,{zoom:M}=this.options,x={},F=this.symbol,k=this.feature.properties,A=t?t(null,k):F.markerFile,P=n?n(null,k):F.markerType,S=A||P||F.markerPath,_=!Ie(this.symbolDef.textName);let O;if(S){O=function(t,n,e,r,i,s){if(Ie(n.markerWidth)&&Ie(n.markerHeight))return null;const o="__fn_markerWidth".trim(),a="__fn_markerHeight".trim();let u=n.markerWidth||0,l=n.markerHeight||0;return De(u)&&("identity"!==u.type?u=Yo(u):(u=t.markerWidth,t[o]&&(u=t[o](r,e)),De(u)&&(u="identity"===u.type?i(r,e):Yo(u)))),De(l)&&("identity"!==l.type?l=Yo(l):(l=t.markerHeight,t[a]&&(l=t[a](r,e)),De(l)&&(l="identity"===l.type?s(r,e):Yo(l)))),[u,l]}(F,this.symbolDef,k,M,r,i)||[0,0];let t=F.markerTextFit;if(u&&(t=u(M,k)),t&&F.text&&"none"!==t){const n=F.text.textSize;let e=F.text.textName;g(e)&&(e=v(e)(M,k));const r=ta(e,k);if(r){const e="__fn_textSize".trim(),i="__fn_textSize_0".trim();g(n)&&!F.text[e]&&(F.text[i]=v(n),F.text[e]=(t,n)=>{const e=F.text[i](t,n);return g(e)?v(e)(t,n):e});const s=Xo(F.text,F.text,k,M);if("width"!==t&&"both"!==t||(O[0]=s[0]*r.length),"height"!==t&&"both"!==t||(O[1]=s[1]),s[0]&&s[1]){let t=F.markerTextFitPadding||[0,0,0,0];l&&(t=l(M,k)),O[0]+=t[1]+t[3],O[1]+=t[0]+t[2]}}else O[0]=O[1]=-1}}if(_&&(O=Xo(F,this.symbolDef,k,M)),!O)return x;if(O[0]=Math.ceil(O[0]),O[1]=Math.ceil(O[1]),this.size=O,S&&O[0]>=0&&O[1]>=0){let t;if(P){const n={};if(n.markerType=P,"path"===P&&(n.markerPath=e?e(null,k):F.markerPath,n.markerPathWidth=y?y(null,k):F.markerPathWidth,n.markerPathHeight=m?m(null,k):F.markerPathHeight),r){const t=r(null,k);Ie(t)||(n.markerWidth=t)}else F.markerWidth>=0&&(n.markerWidth=F.markerWidth);if(i){const t=i(null,k);Ie(t)||(n.markerHeight=t)}else F.markerHeight>=0&&(n.markerHeight=F.markerHeight);if(s){const t=s(null,k);Ie(t)||(n.markerFill=t)}else F.markerFill&&(n.markerFill=F.markerFill);if(o){const t=o(null,k);Ie(t)||(n.markerFillPatternFile=t)}else F.markerFillPatternFile&&(n.markerFillPatternFile=F.markerFillPatternFile);if(a){const t=a(null,k);Ie(t)||(n.markerFillOpacity=t)}else F.markerFillOpacity>=0&&(n.markerFillOpacity=F.markerFillOpacity);if(h){const t=h(null,k);Ie(t)||(n.markerLineColor=t)}else F.markerLineColor&&(n.markerLineColor=F.markerLineColor);if(c){const t=c(null,k);Ie(t)||(n.markerLineWidth=t)}else F.markerLineWidth>=0&&(n.markerLineWidth=F.markerLineWidth);if(f){const t=f(null,k);Ie(t)||(n.markerLineOpacity=t)}else F.markerLineOpacity>=0&&(n.markerLineOpacity=F.markerLineOpacity);if(d){const t=d(null,k);Ie(t)||(n.markerLineDasharray=t)}else F.markerLineDasharray&&(n.markerLineDasharray=F.markerLineDasharray);if(p){const t=p(null,k);Ie(t)||(n.markerLinePatternFile=t)}else F.markerLinePatternFile&&(n.markerLinePatternFile=F.markerLinePatternFile);t="vector://"+JSON.stringify(n)}else t=A?A.replace(Fa,this.bt):F.markerPath?function(t,n,e){if(!t.markerPath)return null;let r=1;const i=function(t){const n={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===n.stroke["stroke-width"]&&(n.stroke["stroke-opacity"]=0),n}(t);ze(t.markerOpacity)&&(r=t.markerOpacity),ze(t.opacity)&&(r*=t.opacity);const s={};if(i){for(const t in i.stroke)je(i.stroke,t)&&(Ie(i.stroke[t])||(s[t]=i.stroke[t]));for(const t in i.fill)je(i.fill,t)&&(Ie(i.fill[t])||(s[t]=i.fill[t]))}const o=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];let a;const u=[];for(let t=0;t<o.length;t++)a=Te(o[t])?{path:o[t]}:o[t],a=$e({},a,s),a.d=a.path,delete a.path,u.push(a);const l=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];r<1&&l.push('opacity="'+r+'"'),t.markerPathWidth&&t.markerPathHeight&&l.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),l.push('preserveAspectRatio="none"'),n&&l.push('width="'+n+'"'),e&&l.push('height="'+e+'"'),l.push("><defs></defs>");for(let t=0;t<u.length;t++){let n="<path ";for(const e in u[t])je(u[t],e)&&(n+=" "+e+'="'+u[t][e]+'"');n+="></path>",l.push(n)}return l.push("</svg>"),"data:image/svg+xml;base64,"+btoa(l.join(" "))}(F,O[0],O[1]):null;x.icon={url:t,size:O}}if(_){const t=b?b(this.options.zoom,k):F.textName;if(t||0===t){const n=function(t){return t||"Open Sans Regular"}(w?w(null,k):F.textFaceName);let e=ta(t,k);e&&e.length&&(e=xa(e),x.glyph={font:n,text:e})}}return this.iconGlyph=x,x}}function Aa(t,n){n&&"middle"!==n||(n="center"),t&&"middle"!==t||(t="center");let e="center"!==n?n:"";return e+="center"!==t?(e.length?"-":"")+t:"",e}\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */function Pa(t,n,e,r,i){const s=[];let o;for(let a=0;a<t.length;a++){const u=t[a];let l,h=!1;for(let t=0;t<u.length-1;t++){let a=u[t],c=u[t+1];a.x<n&&c.x<n||(a.x<n?(o=a,a=new ln(n,a.y+(c.y-a.y)*((n-a.x)/(c.x-a.x))).j(),a.z=o.z+(c.z-o.z)*((n-o.x)/(c.x-o.x)),h=!0):c.x<n&&(o=c,c=new ln(n,a.y+(c.y-a.y)*((n-a.x)/(c.x-a.x))).j(),c.z=a.z+(o.z-a.z)*((n-a.x)/(o.x-a.x)),h=!0),a.y<e&&c.y<e||(a.y<e?(o=a,a=new ln(a.x+(c.x-a.x)*((e-a.y)/(c.y-a.y)),e).j(),a.z=o.z+(c.z-o.z)*((e-o.y)/(c.y-o.y)),h=!0):c.y<e&&(o=c,c=new ln(a.x+(c.x-a.x)*((e-a.y)/(c.y-a.y)),e).j(),c.z=a.z+(o.z-a.z)*((e-a.y)/(o.y-a.y)),h=!0),a.x>=r&&c.x>=r||(a.x>=r?(o=a,a=new ln(r,a.y+(c.y-a.y)*((r-a.x)/(c.x-a.x))).j(),a.z=o.z+(c.z-o.z)*((r-o.x)/(c.x-o.x)),h=!0):c.x>=r&&(o=c,c=new ln(r,a.y+(c.y-a.y)*((r-a.x)/(c.x-a.x))).j(),c.z=a.z+(o.z-a.z)*((r-a.x)/(o.x-a.x)),h=!0),a.y>=i&&c.y>=i||(a.y>=i?(o=a,a=new ln(a.x+(c.x-a.x)*((i-a.y)/(c.y-a.y)),i).j(),a.z=o.z+(c.z-o.z)*((i-o.y)/(c.y-o.y)),h=!0):c.y>=i&&(o=c,c=new ln(a.x+(c.x-a.x)*((i-a.y)/(c.y-a.y)),i).j(),c.z=a.z+(o.z-a.z)*((i-a.y)/(o.y-a.y)),h=!0),l&&a.equals(l[l.length-1])||(l=[a],s.push(l)),h&&(l.clipped=!0),l.push(c)))))}}return s}class Sa extends ln{constructor(t,n,e,r){super(t,n),this.angle=e,void 0!==r&&(this.segment=r)}clone(){return new Sa(this.x,this.y,this.angle,this.segment)}}\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */function _a(t,n,e,r,i){if(void 0===n.segment)return!0;let s=n,o=n.segment+1,a=0;for(;a>-e/2;){if(o--,o<0)return!1;a-=t[o].dist(s),s=t[o]}a+=t[o].dist(t[o+1]),o++;const u=[];let l=0;for(;a<e/2;){const n=t[o-1],e=t[o],s=t[o+1];if(!s)return!1;let h=n.angleTo(e)-e.angleTo(s);for(h=Math.abs((h+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:a,angleDelta:h}),l+=h;a-u[0].distance>r;)l-=u.shift().angleDelta;if(l>i)return!1;o++,a+=e.dist(s)}return!0}function Oa(t,n,e,r,i,s,o,a,u,l,h){const c=function(t,n,e){return t?.6*n*e:0}(r,s,o),f=function(t,n){return Math.max(t?t.right-t.left:0,0)}(r),d=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;n-f*o<n/4&&(n=f*o+n/4);return Ca(t,d?n/2*a%n:(f/2+2*s)*o*a%n,n,c,e,f*o,d,!1,u,l,h)}function Ca(t,n,e,r,i,s,o,a,u,l,h){let c=0;const f=s/2,d=function(t){let n=0;for(let e=0;e<t.length-1;e++)n+=t[e].dist(t[e+1]);return n}(t);let p=0,y=n-e,m=[];for(let n=0;n<t.length-1;n++){const o=t[n],a=t[n+1],g=o.dist(a),v=a.angleTo(o);for(;y+e<p+g;){y+=e;const b=(y-p)/g,w=Ea(o.x,a.x,b),M=Ea(o.y,a.y,b),x=Ea(o.z||0,a.z||0,b);if(w>=0&&w<u&&M>=0&&M<u&&y-f>=0&&y+f<=d){const e=new Sa(w,M,v,n);e.z=x,l&&(e.axis=[o.y-M,w-o.x],e.angleR=x===(o.z||0)?0:Math.atan(.9*(x-(o.z||0))*h/o.dist(e))),e.line=t,e.j(),!r||_a(t,e,s,r,i)?m.push(e):r&&c++}}p+=g}return a||m.length||o||(m=Ca(t,p/2,e,r,i,s,o,!0,u,l,h)),m.countOutOfAngle=c,m}function Ea(t,n,e){return t*(1-e)+n*e}var $a={exports:{}};$a.exports=function(){function t(t,e,i,s,o){n(t,e,i||0,s||t.length-1,o||r)}function n(t,r,i,s,o){for(;s>i;){if(s-i>600){var a=s-i+1,u=r-i+1,l=Math.log(a),h=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*h*(a-h)/a)*(u-a/2<0?-1:1);n(t,r,Math.max(i,Math.floor(r-u*h/a+c)),Math.min(s,Math.floor(r+(a-u)*h/a+c)),o)}var f=t[r],d=i,p=s;for(e(t,i,r),o(t[s],f)>0&&e(t,i,s);d<p;){for(e(t,d,p),d++,p--;o(t[d],f)<0;)d++;for(;o(t[p],f)>0;)p--}0===o(t[i],f)?e(t,i,p):e(t,++p,s),p<=r&&(i=p+1),r<=p&&(s=p-1)}}function e(t,n,e){var r=t[n];t[n]=t[e],t[e]=r}function r(t,n){return t<n?-1:t>n?1:0}return t}();var Ia=Et($a.exports);function za(t,n){const e=t.length;if(e<=1)return[t];const r=[];let i,s;for(let n=0;n<e;n++){const e=An(t[n]);0!==e&&(t[n].area=Math.abs(e),void 0===s&&(s=e<0),s===e<0?(i&&r.push(i),i=[t[n]]):i.push(t[n]))}if(i&&r.push(i),n>1)for(let t=0;t<r.length;t++)r[t].length<=n||(Ia(r[t],n,1,r[t].length-1,Da),r[t]=r[t].slice(0,n));return r}function Da(t,n){return n.area-t.area}class Ta{constructor(t=[],n=Ua){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this.xt(t)}push(t){this.data.push(t),this.length++,this.Ft(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this.xt(0)),t}peek(){return this.data[0]}Ft(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,s=n[i];if(e(r,s)>=0)break;n[t]=s,t=i}n[t]=r}xt(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),s=n[r];const o=r+1;if(o<this.length&&e(n[o],s)<0&&(r=o,s=n[o]),e(s,i)>=0)break;n[t]=s,t=r}n[t]=i}}function Ua(t,n){return t<n?-1:t>n?1:0}function ja(t,n,e){const r=n.distSqr(e);if(0===r)return t.distSqr(n);const i=((t.x-n.x)*(e.x-n.x)+(t.y-n.y)*(e.y-n.y))/r;return i<0?t.distSqr(n):i>1?t.distSqr(e):t.distSqr(e.sub(n).S(i).F(n))}function Na(t,n=1,e=!1){let r=1/0,i=1/0,s=-1/0,o=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const n=a[t];(!t||n.x<r)&&(r=n.x),(!t||n.y<i)&&(i=n.y),(!t||n.x>s)&&(s=n.x),(!t||n.y>o)&&(o=n.y)}const u=s-r,l=o-i,h=Math.min(u,l);let c=h/2;const f=new Ta([],La);if(0===h)return new ln(r,i);for(let n=r;n<s;n+=h)for(let e=i;e<o;e+=h)f.push(new Ha(n+c,e+c,c,t));let d=function(t){let n=0,e=0,r=0;const i=t[0];for(let t=0,s=i.length,o=s-1;t<s;o=t++){const s=i[t],a=i[o],u=s.x*a.y-a.x*s.y;e+=(s.x+a.x)*u,r+=(s.y+a.y)*u,n+=3*u}return new Ha(e/n,r/n,0,t)}(t),p=f.length;for(;f.length;){const r=f.pop();(r.d>d.d||!d.d)&&(d=r,e&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=n||(c=r.h/2,f.push(new Ha(r.p.x-c,r.p.y-c,c,t)),f.push(new Ha(r.p.x+c,r.p.y-c,c,t)),f.push(new Ha(r.p.x-c,r.p.y+c,c,t)),f.push(new Ha(r.p.x+c,r.p.y+c,c,t)),p+=4)}return e&&(console.log(\`num probes: ${XR}p}\`),console.log(\`best distance: ${XR}d.d}\`)),d.p}function La(t,n){return n.max-t.max}function Ha(t,n,e,r){this.p=new ln(t,n),this.h=e,this.d=function(t,n){let e=!1,r=1/0;for(let i=0;i<n.length;i++){const s=n[i];for(let n=0,i=s.length,o=i-1;n<i;o=n++){const i=s[n],a=s[o];i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(e=!e),r=Math.min(r,ja(t,i,a))}}return(e?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}function Ra(t,n,e,r,i,s,o,a,u,l){const{feature:h,size:c,symbol:f}=t,d=c?24:0,p=i*(c?c[0]/d:1);if("line"===o){const t=[];t.countOutOfAngle=0;let i=h.geometry;s&&(i=Pa(h.geometry,0,0,s,s));for(let o=0;o<i.length;o++){const h=Oa(i[o],a,e,f.isIconText?null:r&&r.vertical||r&&r.horizontal||r,0,d,f.isIconText?1:p,1,s||1/0,u,l);if(f.textPlacement&&!f.isIconText)for(let t=0;t<h.length;t++)h[t].startIndex=n.length/3;if(t.push.apply(t,h),f.textPlacement&&!f.isIconText)for(let t=0;t<i[o].length;t++)n.push(i[o][t].x,i[o][t].y,i[o][t].z||0);t.countOutOfAngle+=h.countOutOfAngle||0}return t}return Va(h,o,s)}function Va(t,n,e,r,i){const s=[];if(3===t.type){const o=za(t.geometry,0);for(let t=0;t<o.length;t++){const a=o[t];if("vertex"===n)for(let t=0;t<a.length;t++){const n=a[t];for(let o=0;o<n.length;o++)On(n[o],e)||(s.push(n[o]),r&&(0===o?qa(n[o],n[o],n[t+1],i):qa(n[o],n[o-1],n[o],i)))}else if("vertex-first"===n){const t=a[0];t&&t[0]&&!On(t[0],e)&&(s.push(t[0]),r&&qa(t[0],t[0],t[1],i))}else if("vertex-last"===n||"vertex-firstlast"===n){const t=a[0];if("vertex-firstlast"===n&&t&&t[0]&&!On(t[0],e)&&(s.push(t[0]),r&&qa(t[0],t[0],t[1],i)),t&&t[t.length-1]&&!On(t[t.length-1],e)){const n=t.length-1;s.push(t[n]),r&&qa(t[n],t[n-1],t[n],i)}}else{const t=Na(a,16);On(t,e)||s.push(t)}}}else if(2===t.type)for(let o=0;o<t.geometry.length;o++){const a=t.geometry[o];if("vertex"===n)for(let t=0;t<a.length;t++)On(a[t],e)||(s.push(a[t]),r&&(0===t?qa(a[t],a[t],a[t+1],i):qa(a[t],a[t-1],a[t],i)));else if("vertex-last"===n||"vertex-firstlast"===n){if("vertex-firstlast"!==n||On(a[0],e)||(s.push(a[0]),r&&qa(a[0],a[0],a[1],i)),a&&a[a.length-1]&&!On(a[a.length-1],e)){const t=a.length-1;s.push(a[t]),r&&qa(a[t],a[t-1],a[t],i)}}else On(a[0],e)||(s.push(a[0]),r&&qa(a[0],a[0],a[1],i))}else if(1===t.type)for(let n=0;n<t.geometry.length;n++){const i=t.geometry[n];for(let t=0;t<i.length;t++){const n=i[t];On(n,e)||(r&&(n.xRotation=0,n.yRotation=0,n.zRotation=0),s.push(n))}}return s}function qa(t,n,e,r){if(t.xRotation||t.yRotation||t.zRotation)return t;const i=e.x-n.x,s=n.y-e.y,o=(e.z-n.z)*r,a=Math.atan2(s,i);t.zRotation=a;const u=Math.atan2(o,Math.sqrt(i*i+s*s));return t.xyRotation=u,t}function Ga(t,n){const e={},r={},i=[];let s=0;function o(n){i.push(t[n]),s++}function a(t,n,e){const s=r[t];return delete r[t],r[n]=s,i[s].geometry[0].pop(),i[s].geometry[0]=i[s].geometry[0].concat(e[0]),s}function u(t,n,r){const s=e[n];return delete e[n],e[t]=s,i[s].geometry[0].shift(),i[s].geometry[0]=r[0].concat(i[s].geometry[0]),s}function l(t,n,e){const r=e?n[0][n[0].length-1]:n[0][0];return\`${XR}t}:${XR}r.x}:${XR}r.y}\`}for(let h=0;h<t.length;h++){const c=t[h],f=c.geometry;if(!f)continue;const d=c.properties[n]?c.properties[n].toString():null;if(!d){o(h);continue}const p=l(d,f),y=l(d,f,!0);if(p in r&&y in e&&r[p]!==e[y]){const t=u(p,y,f),n=a(p,y,i[t].geometry);delete e[p],delete r[y],r[l(d,i[n].geometry,!0)]=n,i[t].geometry=null}else p in r?a(p,y,f):y in e?u(p,y,f):(o(h),e[p]=s-1,r[y]=s-1)}return i.filter((t=>t.geometry))}const Ja="__index";function Wa(t,n,e,r){const i=(Ja+"").trim(),s=function(t,n,e,r){const i=(Ja+"").trim(),{mergeOnPropertyFn:s}=e;if(!n.mergeOnProperty)return[];if(o=n.mergeOnProperty,!Cn(o)&&("string"==typeof o||null!==o.constructor&&o.constructor===String))return[{features:t,property:n.mergeOnProperty}];var o;const a=[],u={},l=[];for(let e=0;e<t.length;e++){t[e][i]=e;const o=t[e].properties=t[e].properties||{};o.$layer=t[e].layer,o.$type=t[e].type;const h=s?s(r,o):n.mergeOnProperty;Cn(h)?l.push(t[e]):(void 0===u[h]&&(u[h]=a.length,a.push({features:[],property:h})),a[u[h]].features.push(t[e]))}l.length&&a.push({features:l});return a}(t,n,e,r);if(s.length){const n=[];for(let e=0;e<s.length;e++)s[e].property?n.push(Ga(s[e].features,s[e].property)):n.push(t);if(1===n.length)return n[0];{let t=[];for(let e=0;e<n.length;e++)t=t.concat(n[e]);return t.sort(((t,n)=>t[i]-n[i])),t}}return[]}const Ba=14;class Xa extends Go{static needMerge(t,n,e){if(!t)return!1;let r="line"===t.textPlacement||"line"===t.markerPlacement;return r||(n.textPlacementFn&&(r="line"===n.textPlacementFn(e)),n.markerPlacementFn&&(r="line"===n.markerPlacementFn(e))),t.mergeOnProperty&&r}static mergeLineFeatures(t,n,e,r){let i=n.textPlacement,s=n.markerPlacement;return e.textPlacementFn&&(i=e.textPlacementFn(r)),e.markerPlacementFn&&(s=e.markerPlacementFn(r)),"line"!==i&&"line"!==s?t:Wa(t,n,e,r)}static splitPointSymbol(t,n=0){const e=[];if(Array.isArray(t)){const n=t;for(let t=0;t<n.length;t++)n[t]&&e.push(...Xa.splitPointSymbol(n[t],t));return e}let r=null,i=null;for(const n in t)0===n.indexOf("marker")?(r=r||{},r[n]=t[n]):0===n.indexOf("text")&&(i=i||{},i[n]=t[n]);return r&&(r.isIconText=!0,t.mergeOnProperty&&(r.mergeOnProperty=t.mergeOnProperty),e.push(r)),i&&(r&&(i.textPlacement=r.markerPlacement,i.textSpacing=r.markerSpacing,i.isIconText=!0),t.mergeOnProperty&&(i.mergeOnProperty=t.mergeOnProperty),e.push(i)),void 0!==t.visible&&(r&&(r.visible=t.visible),i&&(i.visible=t.visible)),r&&(r.markerTextFit&&i&&(r.text={},r.text.textName=i.textName,r.text.textSize=i.textSize),r.index={index:n,type:0}),i&&(i.index={index:n,type:1}),e}static isAtlasLoaded(t,n){const{icon:e,glyph:r}=t,{iconAtlas:i,glyphAtlas:s}=n;if(e&&(!i||!i.positions[e.url]))return!1;if(r){if(!s||!s.positions[r.font])return!1;const t=s.positions[r.font],{text:n}=r;for(const e of n)if(!t[e.codePointAt(0)])return!1}return!0}constructor(t,n,e){super(t,n,e),this.kt=n.textPlacement,this.it.textPlacementFn&&(this.kt=this.it.textPlacementFn(this.options.zoom))}createStyledVector(t,n,e,r,i,s){const o=new ka(t,this.symbolDef,n,e,r),a=o.getIconAndGlyph();if(a.icon&&!this.options.atlas){const{url:t,size:n}=a.icon;i[t]||(i[t]=a.icon.size),i[t][0]<n[0]&&(i[t][0]=n[0]),i[t][1]<n[1]&&(i[t][1]=n[1])}if(a.glyph&&!this.options.atlas){const{font:t,text:n}=a.glyph,e=s[t]=s[t]||{};for(const t of n)e[t.codePointAt(0)]=1;"line"===this.kt&&(s.options={isCharsCompact:!1})}return this.options.allowEmptyPack||a.icon||a.glyph?o:null}getFormat(t){const n=void 0!==t.textName,e=n?this.getPackSDFFormat(t):this.getPackMarkerFormat();n?e.push(...this.At()):e.push(...this.Pt());const{markerOpacityFn:r,textOpacityFn:i,markerPitchAlignmentFn:s,textPitchAlignmentFn:o,markerRotationAlignmentFn:a,textRotationAlignmentFn:u,markerRotationFn:l,textRotationFn:h,markerAllowOverlapFn:c,textAllowOverlapFn:f,markerIgnorePlacementFn:d,textIgnorePlacementFn:p}=this.it;return(r||i)&&e.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(s||o)&&e.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(a||u)&&e.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(l||h)&&e.push({type:Uint16Array,width:1,name:"aRotation"}),(c||f||d||p)&&e.push({type:Uint8Array,width:1,name:"aOverlap"}),e}St(){return this.hasMapPitchAlign}At(){const{textFillFn:t,textSizeFn:n,textHaloFillFn:e,textHaloRadiusFn:r,textHaloOpacityFn:i,textDxFn:s,textDyFn:o}=this.it,a=[];return t&&a.push({type:Uint8Array,width:4,name:"aTextFill"}),n&&a.push({type:Uint8Array,width:1,name:"aTextSize"}),e&&a.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),r&&a.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),i&&a.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),s&&a.push({type:Int8Array,width:1,name:"aTextDx"}),o&&a.push({type:Int8Array,width:1,name:"aTextDy"}),a}Pt(){const{markerWidthFn:t,markerHeightFn:n,markerDxFn:e,markerDyFn:r}=this.it,i=[];return t&&i.push({type:this.options.markerWidthType||Uint8Array,width:1,name:"aMarkerWidth"}),n&&i.push({type:this.options.markerHeightType||Uint8Array,width:1,name:"aMarkerHeight"}),e&&i.push({type:Int8Array,width:1,name:"aMarkerDx"}),r&&i.push({type:Int8Array,width:1,name:"aMarkerDy"}),i}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.countOutOfAngle=0,this.lineVertex=[];const t=super.createDataPack.apply(this,arguments);return t?(t.lineVertex=new Int16Array(this.lineVertex),t.buffers.push(t.lineVertex.buffer),t):null}placeVector(t,n){const e=t.getShape(this.iconAtlas,this.glyphAtlas),r=!e||!e.image,i=!e||!e.horizontal&&!e.vertical;if(!this.options.allowEmptyPack&&r&&i)return;const s=this._t(t,e,n);this.countOutOfAngle+=s.countOutOfAngle||0;if(0===s.length)return;const o=this.data,a=this.needAltitudeAttribute()?2:3;let u=this.data.aPosition.getLength()/a;const l=t.symbol,h=t.feature.properties,c="line"===this.kt&&!l.isIconText,f=void 0!==l.textName,d=f&&c&&function(t){let n=0;for(let e=0;e<t.length;e++)if(oa(t.charAt(e).charCodeAt(0)))n=0;else if(n++,n>=1)return!1;return!0}(t.getIconAndGlyph().glyph.text)?1:0,{textFillFn:p,textSizeFn:y,textHaloFillFn:m,textHaloRadiusFn:v,textHaloOpacityFn:b,textDxFn:w,textDyFn:M,textPitchAlignmentFn:x,textRotationAlignmentFn:F,textRotationFn:k,textAllowOverlapFn:A,textIgnorePlacementFn:P,textOpacityFn:S,markerWidthFn:_,markerHeightFn:O,markerDxFn:C,markerDyFn:E,markerPitchAlignmentFn:$,markerRotationAlignmentFn:I,markerRotationFn:z,markerAllowOverlapFn:D,markerIgnorePlacementFn:T,markerOpacityFn:U}=this.it;let j,N,L,H,R,V,q,G,J,W,B,X,Y,K,Z,Q,tt;if(f){const n=t.getIconAndGlyph().glyph.font;j=function(t,n,e){const r=t.positionedGlyphs,i=[];for(let s=0;s<r.length;s++){const o=r[s],a=e[o.glyph];if(!a)continue;const u=a.rect;if(!u)continue;const l=4,h=a.metrics.advance/2,c=a.metrics.height/2,f=n?[o.x+h,0]:[0,0],d=n?[0,o.y-c]:[o.x+h,o.y-c],p=a.metrics.left-l-h+d[0],y=a.metrics.top-l+d[1],m=p+u.w,g=y+u.h,v=new ln(p,y),b=new ln(m,y),w=new ln(p,g),M=new ln(m,g);if(n&&o.vertical){const t=new ln(-h,h),n=-Math.PI/2,e=new ln(5,0);v.I(n,t).F(e),b.I(n,t).F(e),w.I(n,t).F(e),M.I(n,t).F(e)}i.push({tl:v,tr:b,bl:w,br:M,tex:u,writingMode:t.writingMode,glyphOffset:f})}return i}(e.horizontal,c,this.glyphAtlas.positions[n]),p&&(N=p(null,h),g(N)?(this.dynamicAttrs.aTextFill=1,N=[0,0,0,0]):N=He([],N)),y&&(L=y(this.options.zoom,h),Cn(L)&&(L=Ba)),m&&(H=m(null,h),g(H)?(this.dynamicAttrs.aTextHaloFill=1,H=[0,0,0,0]):H=He([],H)),v&&(R=v(null,h)),b&&(V=255*b(null,h)),w&&(q=w(null,h)||0),M&&(G=M(null,h)||0),x&&(Y=+("map"===x(null,h))),F&&(K=+("map"===F(null,h))),k&&(Z=En(k(null,h),0,360)*Math.PI/180)}else j=e?function(t){const n=t.image,e=t.top-1/n.pixelRatio,r=t.left-1/n.pixelRatio,i=t.bottom+1/n.pixelRatio,s=t.right+1/n.pixelRatio;let o,a,u,l;return o=new ln(r,e),a=new ln(s,e),u=new ln(s,i),l=new ln(r,i),[{tl:o,tr:a,bl:l,br:u,tex:{x:n.tl[0],y:n.tl[1],w:n.displaySize[0],h:n.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(e):function(){const t=new ln(0,0),n=new ln(0,0),e=new ln(0,0);return[{tl:t,tr:n,bl:new ln(0,0),br:e,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),_&&(J=_(null,h)),Cn(J)&&(J=j[0].tex.w),O&&(W=O(null,h)),Cn(W)&&(W=j[0].tex.h),C&&(B=C(null,h)),E&&(X=E(null,h)),$&&(Y=+("map"===$(null,h))),I&&(K=+("map"===I(null,h))),z&&(Z=En(z(null,h),0,360)*Math.PI/180);g(L)&&(this.dynamicAttrs.aTextSize=1),g(R)&&(this.dynamicAttrs.aTextHaloRadius=1),g(V)&&(this.dynamicAttrs.aTextHaloOpacity=1),g(q)&&(this.dynamicAttrs.aTextDx=1),g(G)&&(this.dynamicAttrs.aTextDy=1),g(J)&&(this.dynamicAttrs.aMarkerWidth=1),g(W)&&(this.dynamicAttrs.aMarkerHeight=1),g(B)&&(this.dynamicAttrs.aMarkerDx=1),g(X)&&(this.dynamicAttrs.aMarkerDy=1),g(Y)&&(this.dynamicAttrs.aPitchAlign=1),g(K)&&(this.dynamicAttrs.aRotationAlign=1),g(Z)&&(this.dynamicAttrs.aRotation=1);const nt=D||A;nt&&(Q=nt(null,h)||0);const et=T||P;let rt;et&&(tt=et(null,h)||0);const it=S||U;it&&(rt=255*it(this.options.zoom,h));const st=j.length;this.ensureDataCapacity(4*st,s.length);const ot=this.options.EXTENT,{altitudeScale:at,altitudeProperty:ut,defaultAltitude:lt}=this.options,{altitude:ht}=_n(t.feature,at,ut,lt);for(let t=0;t<s.length;t++){const n=s[t],e=n.z||ht||0;if(ot!==1/0&&On(n,ot))continue;const r=n.x,i=n.y,a=j.length;for(let t=0;t<a;t++){const s=j[t],{tl:a,tr:l,bl:h,br:p,tex:y}=s;this.Ot(o,r,i,e,10*a.x,10*a.y,y.x,y.y+y.h),f&&this.Ct(o,c,st,s.glyphOffset,n,d,n.axis,n.angleR),this.Et(o,N,L,H,R,V,q,G,J,W,B,X,rt,Y,K,Z,Q,tt),this.Ot(o,r,i,e,10*l.x,10*l.y,y.x+y.w,y.y+y.h),f&&this.Ct(o,c,st,s.glyphOffset,n,d,n.axis,n.angleR),this.Et(o,N,L,H,R,V,q,G,J,W,B,X,rt,Y,K,Z,Q,tt),this.Ot(o,r,i,e,10*h.x,10*h.y,y.x,y.y),f&&this.Ct(o,c,st,s.glyphOffset,n,d,n.axis,n.angleR),this.Et(o,N,L,H,R,V,q,G,J,W,B,X,rt,Y,K,Z,Q,tt),this.Ot(o,r,i,e,10*p.x,10*p.y,y.x+y.w,y.y),f&&this.Ct(o,c,st,s.glyphOffset,n,d,n.axis,n.angleR),this.Et(o,N,L,H,R,V,q,G,J,W,B,X,rt,Y,K,Z,Q,tt),this.addElements(u,u+1,u+2),this.addElements(u+1,u+2,u+3),u+=4;const m=Math.max(Math.abs(r),Math.abs(i),Math.abs(e));m>this.maxPos&&(this.maxPos=m)}}}Ot(t,n,e,r,i,s,o,a){this.fillPosition(t,n,e,r);let u=t.aShape.currentIndex;t.aShape[u++]=i,t.aShape[u++]=s,t.aShape.currentIndex=u,u=t.aTexCoord.currentIndex,t.aTexCoord[u++]=o,t.aTexCoord[u++]=a,t.aTexCoord.currentIndex=u}Ct(t,n,e,r,i,s,o,a){let u=t.aCount.currentIndex;if(t.aCount[u++]=e,t.aCount.currentIndex=u,n){u=t.aGlyphOffset.currentIndex,t.aGlyphOffset[u++]=r[0],t.aGlyphOffset[u++]=r[1],t.aGlyphOffset.currentIndex=u,this.St()&&(u=t.aPitchRotation.currentIndex,t.aPitchRotation[u++]=o[0],t.aPitchRotation[u++]=o[1],t.aPitchRotation[u++]=a,t.aPitchRotation.currentIndex=u);const n=i.startIndex;u=t.aSegment.currentIndex,t.aSegment[u++]=i.segment+n,t.aSegment[u++]=n,t.aSegment[u++]=i.line.length,t.aSegment.currentIndex=u,u=t.aVertical.currentIndex,t.aVertical[u++]=s,t.aVertical.currentIndex=u}}Et(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p,y,m,g){const{textFillFn:v,textSizeFn:b,textHaloFillFn:w,textHaloRadiusFn:M,textHaloOpacityFn:x,textDxFn:F,textDyFn:k,textPitchAlignmentFn:A,textRotationAlignmentFn:P,textRotationFn:S,textAllowOverlapFn:_,textIgnorePlacementFn:O,textOpacityFn:C,markerWidthFn:E,markerHeightFn:$,markerDxFn:I,markerDyFn:z,markerPitchAlignmentFn:D,markerRotationAlignmentFn:T,markerRotationFn:U,markerAllowOverlapFn:j,markerIgnorePlacementFn:N,markerOpacityFn:L}=this.it;if(v){let e=t.aTextFill.currentIndex;t.aTextFill[e++]=n[0],t.aTextFill[e++]=n[1],t.aTextFill[e++]=n[2],t.aTextFill[e++]=n[3],t.aTextFill.currentIndex=e}if(b){let n=t.aTextSize.currentIndex;t.aTextSize[n++]=e,t.aTextSize.currentIndex=n}if(w){let n=t.aTextHaloFill.currentIndex;t.aTextHaloFill[n++]=r[0],t.aTextHaloFill[n++]=r[1],t.aTextHaloFill[n++]=r[2],t.aTextHaloFill[n++]=r[3],t.aTextHaloFill.currentIndex=n}if(M){let n=t.aTextHaloRadius.currentIndex;t.aTextHaloRadius[n++]=i,t.aTextHaloRadius.currentIndex=n}if(x){let n=t.aTextHaloOpacity.currentIndex;t.aTextHaloOpacity[n++]=s,t.aTextHaloOpacity.currentIndex=n}if(F){let n=t.aTextDx.currentIndex;t.aTextDx[n++]=o,t.aTextDx.currentIndex=n}if(k){let n=t.aTextDy.currentIndex;t.aTextDy[n++]=a,t.aTextDy.currentIndex=n}if(E){let n=t.aMarkerWidth.currentIndex;t.aMarkerWidth[n++]=u,t.aMarkerWidth.currentIndex=n}if($){let n=t.aMarkerHeight.currentIndex;t.aMarkerHeight[n++]=l,t.aMarkerHeight.currentIndex=n}if(I){let n=t.aMarkerDx.currentIndex;t.aMarkerDx[n++]=h,t.aMarkerDx.currentIndex=n}if(z){let n=t.aMarkerDy.currentIndex;t.aMarkerDy[n++]=c,t.aMarkerDy.currentIndex=n}if(L||C){let n=t.aColorOpacity.currentIndex;t.aColorOpacity[n++]=f,t.aColorOpacity.currentIndex=n}if(A||D){let n=t.aPitchAlign.currentIndex;t.aPitchAlign[n++]=d,t.aPitchAlign.currentIndex=n}if(T||P){let n=t.aRotationAlign.currentIndex;t.aRotationAlign[n++]=p,t.aRotationAlign.currentIndex=n}if(U||S){let n=t.aRotation.currentIndex;t.aRotation[n++]=9362*y,t.aRotation.currentIndex=n}const H=j||_,R=N||O;if(H||R){const n=(H?8:0)+4*m,e=(R?2:0)+g;let r=t.aOverlap.currentIndex;t.aOverlap[r++]=n+e,t.aOverlap.currentIndex=r}i>0&&(this.properties.hasHalo=1)}_t(t,n,e){const{feature:r,symbol:i}=t,s=this.$t(t,i),o=r.properties,{markerSpacingFn:a,textSpacingFn:u,textMaxAngleFn:l}=this.it,h=((a?a(null,o):i.markerSpacing)||(u?u(null,o):i.textSpacing)||250)*e;let c=l?l(this.options.zoom,o):i.textMaxAngle;Cn(c)&&(c=80),c*=Math.PI/180;const f=this.options.EXTENT,d=this.options.altitudeToTileScale,p=this.St();return Ra(t,this.lineVertex,c,n,e,f,s,h,p,d)}$t(t,n){let e;return e=this.it.markerPlacementFn?this.it.markerPlacementFn(this.options.zoom,t.feature.properties):n.markerPlacement||this.kt,this.gt||!n.markerPlacement&&!n.isIconText||(this.gt=e),!this.kt||n.isIconText||this.vt||(this.vt=e),e}getPackSDFFormat(t){if("line"!==this.kt||t.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const t=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this.St()&&t.push({type:Float32Array,width:3,name:"aPitchRotation"}),t}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}}class Ya{constructor(t){this.x=t.x,this.y=t.y,this.z=t.z||0}clone(){return new Ya(this)}T(){return this.O(this.mag()),this}O(t){return this.x/=t,this.y/=t,this.z/=t,this}U(){var t=this.y;return this.y=this.x,this.x=-t,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(t){return this.clone().F(t)}sub(t){return this.clone().k(t)}F(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}k(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}mult(t){return this.clone().S(t)}S(t){return this.x*=t,this.y*=t,this.z*=t,this}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){var n=t.x-this.x,e=t.y-this.y,r=t.z-this.z;return n*n+e*e+r*r}j(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}}const Ka=63,Za=Math.cos(Math.PI/180*37.5),Qa=Math.pow(2,16)/1,tu=new ln,nu=new ln,eu=new ln;class ru extends Go{static mergeLineFeatures(t,n,e,r){return Wa(t,n,e,r)}constructor(t,n,e){super(t,n,e);let r=!1;const{lineDasharrayFn:i,lineDashColorFn:s}=this.it;this.hasGradient=this.symbol.lineGradientProperty,i&&(r=function(t,n,e){for(let r=0;r<t.length;r++){if(e(n,t[r].properties))return!0}return!1}(t,this.options.zoom,i),r&&(this.dasharrayFn=i)),this.hasDasharray=ou(this.symbol.lineDasharray)||r,this.hasDasharray&&s&&(this.dashColorFn=s)}createStyledVector(t,n,e,r,i){const s=new qe(t,n,e,r),o=s.getLineResource();return!this.options.atlas&&o&&(i[o]=[0,0]),s}getFormat(){const{lineWidthFn:t,lineStrokeWidthFn:n,lineStrokeColorFn:e,lineColorFn:r,lineOpacityFn:i,lineDxFn:s,lineDyFn:o,linePatternAnimSpeedFn:a,linePatternGapFn:u}=this.it,l=[...this.getPositionFormat()];if(this.iconAtlas||this.hasDasharray?l.push({type:Int8Array,width:3,name:"aExtrude"}):l.push({type:Int8Array,width:2,name:"aExtrude"}),l.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),t&&l.push({type:Uint8Array,width:1,name:"aLineWidth"}),n&&l.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),r&&l.push({type:Uint8Array,width:4,name:"aColor"}),e&&l.push({type:Uint8Array,width:4,name:"aStrokeColor"}),i&&l.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&l.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&l.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const t=this.getIconAtlasMaxValue();l.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(s||o)&&l.push({type:Int8Array,width:2,name:"aLineDxDy"}),(a||u)&&l.push({type:Int8Array,width:2,name:"aLinePattern"}),l}placeVector(t){const{lineJoinFn:n,lineCapFn:e,lineWidthFn:r,lineHeightFn:i,lineStrokeWidthFn:s,lineStrokeColorFn:o,lineColorFn:a,lineOpacityFn:u,lineDxFn:l,lineDyFn:h,linePatternAnimSpeedFn:c,linePatternGapFn:f}=this.it,d=this.symbol,p=t.feature,y=p.properties;this.elements;let m=d.lineJoin||"miter",v=d.lineCap||"butt";if(n&&(m=n(this.options.zoom,y)||"miter"),e&&(v=e(this.options.zoom,y)||"butt"),r){let t=r(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineWidth=1,t=4),Ie(t)&&(t=4),this.feaLineWidth=+t}else this.feaLineWidth=+d.lineWidth;if(i){let t=i(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineHeight=1),Ie(t)&&(t=this.feaLineWidth),this.feaLineHeight=+t}else this.feaLineHeight=+d.lineHeight||this.feaLineWidth;if(s){let t=s(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineStrokeWidth=1,t=0),Ie(t)&&(t=0),this.feaLineStrokeWidth=t}else this.feaLineStrokeWidth=d.lineStrokeWidth||0;if(a&&(this.feaColor=a(this.options.zoom,y)||[255,255,255,255],g(this.feaColor)?(this.dynamicAttrs.aColor=1,this.feaColor=[0,0,0,0]):this.feaColor=He([],this.feaColor)),o&&(this.feaStrokeColor=o(this.options.zoom,y)||[0,0,0,255],g(this.feaStrokeColor)?(this.dynamicAttrs.aStrokeColor=1,this.feaStrokeColor=[0,0,0,0]):this.feaStrokeColor=He([],this.feaStrokeColor)),u){let t=u(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aOpacity=1,t=1),Ie(t)&&(t=1),this.feaOpacity=255*t}if(this.dasharrayFn){let t=this.dasharrayFn(this.options.zoom,y)||[0,0,0,0];if(g(t)&&(this.dynamicAttrs.aDasharray=1,t=[0,0,0,0]),t.length<4){const n=t;1===t.length?t=[n[0],n[0],n[0],n[0]]:2===t.length?t=[n[0],n[1],n[0],n[1]]:3===t.length&&(t=[n[0],n[1],n[2],n[2]])}this.feaDash=t}if(this.dashColorFn){let t=(this.dashColorFn?this.dashColorFn(this.options.zoom,y):this.symbol.lineDashColor)||[0,0,0,0];g(t)&&(this.dynamicAttrs.aDashColor=1,t=[0,0,0,0]),t=He([],t),this.feaDashColor=t}if(this.iconAtlas){const n=t.getLineResource(),e=this.iconAtlas.glyphMap[n];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],e){const{tl:t,displaySize:e}=this.iconAtlas.positions[n];this.feaTexInfo[0]=t[0]+1,this.feaTexInfo[1]=t[1]+1,this.feaTexInfo[2]=e[0]-3,this.feaTexInfo[3]=e[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(l){let t=l(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),Ie(t)&&(t=0),this.feaLineDx=t}if(h){let t=h(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),Ie(t)&&(t=0),this.feaLineDy=t}if(c){let t=c(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLinePatternAnimSpeed=1,t=0),Ie(t)&&(t=0),0!==t&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=t}if(f){let t=f(this.options.zoom,y);g(t)&&(this.dynamicAttrs.aLinePatternGap=1,t=0),Ie(t)&&(t=0),this.feaLinePatternGap=t}const b=this.options.EXTENT;let w=p.geometry;if(b!==1/0){w=[];const t=[];for(let n=0;n<p.geometry.length;n++){t[0]=p.geometry[n];const e=Pa(t,-1,-1,b+1,b+1);if(3===p.type&&e.length>1){const t=e[0],n=e[e.length-1];hu(t[0],n[n.length-1])&&(e[0]=n.concat(t.slice(1)),e.length=e.length-1)}w.push(...e)}}const M=this.needAltitudeAttribute()?2:3;for(let t=0;t<w.length;t++){this.offset=this.data.aPosition.getLength()/M;const n=w[t];this.It(n,p,m,v,2,1.05)}}zt(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}It(t,n,e,r,i,s){const o=this.zt()||ou(this.feaDash)||ou(this.symbol.lineDasharray),a=this.options.isTube;a&&(t=t.map((t=>new Ya(t)))),this.overscaling=1;const u=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&n.properties&&ze(n.properties.mapbox_clip_start)&&ze(n.properties.mapbox_clip_end)){this.clipStart=+n.properties.mapbox_clip_start,this.clipEnd=+n.properties.mapbox_clip_end;for(let n=0;n<t.length-1;n++)this.totalDistance+=t[n].dist(t[n+1]);this.updateScaledDistance()}const l=3===n.type&&!t.clipped;let h=t.length;for(;h>=2&&hu(t[h-1],t[h-2]);)h--;let c=0;for(;c<h-1&&hu(t[c],t[c+1]);)c++;if(h<(l?3:2))return;"bevel"===e&&(i=1.05);const f=this.overscaling<=16?15*u/(512*this.overscaling):0,d={vertexLength:0,primitiveLength:0,currentNormal:null};let p,y,m,g,v;this.e1=this.e2=-1,l&&(p=t[h-2],v=t[c].sub(p).T().U()),this.ensureDataCapacity(e,h,360,2);for(let n=c;n<h;n++){if(m=n===h-1?l?t[c+1]:void 0:t[n+1],m&&hu(t[n],m))continue;v&&(g=v),p&&(y=p),p=t[n],m&&p.x===m.x&&p.y===m.y&&(p.x+=1e-4),v=m?m.sub(p).T().U():g,d.dir=y?p.sub(y).T():m.sub(p).T(),g=g||v,d.currentNormal=g;let u=g.add(v);0===u.x&&0===u.y||u.T();const b=g.x*v.x+g.y*v.y,w=u.x*v.x+u.y*v.y,M=0!==w?1/w:1/0,x=2*Math.sqrt(2-2*w),F=w<Za&&y&&m,k=g.x*v.y-g.y*v.x>0;if(!a&&F&&n>c){const t=p.dist(y);if(t>2*f){const n=p.sub(p.sub(y).S(f/t).j());n.z=p.z,this.updateDistance(y,n),this.addCurrentVertex(n,g,0,0,d),y=n}}const A=y&&m;d.middleVertex=A;let P=A?e:l?"butt":r;if(A&&"round"===P&&(M<s?P="miter":M<=2&&(P="fakeround")),"miter"===P&&M>i&&!a&&(P="bevel"),"bevel"===P&&(M>2&&(P="flipbevel"),M<i&&(P="miter")),y&&this.updateDistance(y,p),"miter"===P)a?(this.addCurrentVertex(p,g,0,0,d),d.dir=m.sub(p).T(),this.addCurrentVertex(p,v,0,0,d)):(u.S(M),this.addCurrentVertex(p,u,0,0,d),o&&(d.currentNormal=v,d.dir=m.sub(p).T(),this.addCurrentVertex(p,u,0,0,d)));else if("flipbevel"===P){if(M>100)u=v.mult(-1);else{const t=M*g.add(v).mag()/g.sub(v).mag();u.U().S(t*(k?-1:1))}this.addCurrentVertex(p,u,0,0,d),this.addCurrentVertex(p,u.mult(-1),0,0,d)}else if("bevel"===P||"fakeround"===P){const t=-Math.sqrt(M*M-1),n=k?t:0,e=k?0:t;if(y&&this.addCurrentVertex(p,g,n,e,d),"fakeround"===P){const t=Math.round(180*x/Math.PI/20);for(let n=1;n<t;n++){let e=n/t;if(.5!==e){const t=e-.5;e+=e*t*(e-1)*((1.0904+b*(b*(3.55645-1.43519*b)-3.2452))*t*t+(.848013+b*(.215638*b-1.06021)))}const r=v.sub(g).S(e).F(g).T().S(k?-1:1);this.addHalfVertex(p,r.x,r.y,!1,k,0,d)}}m&&(d.currentNormal=v,d.dir=m.sub(p).T(),this.addCurrentVertex(p,v,-n,-e,d))}else if("butt"===P)this.addCurrentVertex(p,u,0,0,d);else if("square"===P){const t=y?1:-1;this.addCurrentVertex(p,u,t,t,d)}else"round"===P&&(y&&(this.addCurrentVertex(p,g,0,0,d),this.addCurrentVertex(p,g,1,1,d,!0)),m&&(this.addCurrentVertex(p,v,-1,-1,d,!0),this.addCurrentVertex(p,v,0,0,d)));if(!a&&F&&n<h-1){const t=p.dist(m);if(t>2*f){const n=p.add(m.sub(p).S(f/t).j());n.z=p.z,this.updateDistance(p,n),this.addCurrentVertex(n,v,0,0,d),p=n}}}}ensureDataCapacity(t,n,e,r){const i="round"===t?Math.round(e/20)-1:0;super.ensureDataCapacity((6+i)*r,n)}addCurrentVertex(t,n,e,r,i,s=!1){const o=n.x+n.y*e,a=n.y-n.x*e,u=-n.x+n.y*r,l=-n.y-n.x*r;let h=0,c=0;if(i.middleVertex){tu.x=o,tu.y=a;const t=i.currentNormal;if(h=lu(t,tu,i.dir),0===e&&0===r)c=-h;else{const n=nu;n.x=t.x,n.y=t.y,n.S(-1),eu.x=u,eu.y=l,c=lu(n,eu,i.dir)}}this.addHalfVertex(t,o,a,s,!1,e,i,h),this.addHalfVertex(t,u,l,s,!0,-r,i,c),this.prevVertex&&hu(t,this.prevVertex)||(this.prevVertex=t),this.distance>Qa/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,e,r,i,s))}addHalfVertex({x:t,y:n,z:e},r,i,s,o,a,u,l){const h=1*this.scaledDistance;this.fillData(this.data,t,n,e||0,r,i,s,o,h,l);const c=u.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,c),u.primitiveLength++),o?this.e2=c:this.e1=c}fillData(t,n,e,r,i,s,o,a,u,l){const{lineWidthFn:h,lineStrokeWidthFn:c,lineStrokeColorFn:f,lineColorFn:d,lineOpacityFn:p,lineDxFn:y,lineDyFn:m,linePatternAnimSpeedFn:g,linePatternGapFn:v}=this.it;this.fillPosition(t,n,e,r);let b=Ka*i;b=(Math.sign(b)||1)*((Math.floor(Math.abs(b))>>1<<1)+ +o);let w=Ka*s;w=(Math.sign(w)||1)*((Math.floor(Math.abs(w))>>1<<1)+ +a);let M=t.aExtrude.currentIndex;t.aExtrude[M++]=b,t.aExtrude[M++]=w,(this.iconAtlas||this.hasDasharray)&&(t.aExtrude[M++]=Ka*l),t.aExtrude.currentIndex=M,M=t.aLinesofar.currentIndex,t.aLinesofar[M++]=u,t.aLinesofar.currentIndex=M,h&&(M=t.aLineWidth.currentIndex,t.aLineWidth[M++]=Math.round(2*this.feaLineWidth),t.aLineWidth.currentIndex=M),c&&(M=t.aLineStrokeWidth.currentIndex,t.aLineStrokeWidth[M++]=Math.round(2*this.feaLineStrokeWidth),t.aLineStrokeWidth.currentIndex=M),d&&(M=t.aColor.currentIndex,t.aColor[M++]=this.feaColor[0],t.aColor[M++]=this.feaColor[1],t.aColor[M++]=this.feaColor[2],t.aColor[M++]=this.feaColor[3],t.aColor.currentIndex=M),f&&(M=t.aStrokeColor.currentIndex,t.aStrokeColor[M++]=this.feaStrokeColor[0],t.aStrokeColor[M++]=this.feaStrokeColor[1],t.aStrokeColor[M++]=this.feaStrokeColor[2],t.aStrokeColor[M++]=this.feaStrokeColor[3],t.aStrokeColor.currentIndex=M),p&&(M=t.aOpacity.currentIndex,t.aOpacity[M++]=this.feaOpacity,t.aOpacity.currentIndex=M),this.dasharrayFn&&(M=t.aDasharray.currentIndex,t.aDasharray[M++]=this.feaDash[0],t.aDasharray[M++]=this.feaDash[1],t.aDasharray[M++]=this.feaDash[2],t.aDasharray[M++]=this.feaDash[3],t.aDasharray.currentIndex=M),this.dashColorFn&&(M=t.aDashColor.currentIndex,t.aDashColor[M++]=this.feaDashColor[0],t.aDashColor[M++]=this.feaDashColor[1],t.aDashColor[M++]=this.feaDashColor[2],t.aDashColor[M++]=this.feaDashColor[3],t.aDashColor.currentIndex=M),this.iconAtlas&&(M=t.aTexInfo.currentIndex,t.aTexInfo[M++]=this.feaTexInfo[0],t.aTexInfo[M++]=this.feaTexInfo[1],t.aTexInfo[M++]=this.feaTexInfo[2],t.aTexInfo[M++]=this.feaTexInfo[3],t.aTexInfo.currentIndex=M),(y||m)&&(M=t.aLineDxDy.currentIndex,t.aLineDxDy[M++]=this.feaLineDx||0,t.aLineDxDy[M++]=this.feaLineDy||0,t.aLineDxDy.currentIndex=M),(g||v)&&(M=t.aLinePattern.currentIndex,t.aLinePattern[M++]=127*(this.feaPatternAnimSpeed||0),t.aLinePattern[M++]=10*(this.feaLinePatternGap||0),t.aLinePattern.currentIndex=M),this.maxPos=Math.max(this.maxPos,Math.abs(n)+1,Math.abs(e)+1)}addElements(t,n,e){super.addElements(this.offset+t,this.offset+n,this.offset+e)}Dt(t){const n=this.options.EXTENT,e=this.elements;for(let r=0;r<e.length;r+=3)if(n===1/0||!su(this.data.aPosition,e[r],e[r+1],3,n)&&!su(this.data.aPosition,e[r+1],e[r+2],3,n)){let n=t.currentIndex;t[n++]=e[r],t[n++]=e[r+1],t[n++]=e[r+2],t.currentIndex=n}}Tt(t){if(t.length<=1)return t;const n=[],e=this.options.EXTENT;let r,i=!0;for(r=0;r<t.length-1;r++){const s=iu(t[r],t[r+1],e);s&&i||(n.push(t[r]),i=s)}return i||n.push(t[r]),n}updateDistance(t,n){if(this.options.isTube){const e=t.dist(n),r=function(t){const{verticalCentimeterToPoint:n,tileRatio:e}=t;return n*e}(this.options)*(n.z-t.z);this.distance+=Math.sqrt(e*e+r*r)}else this.distance+=t.dist(n);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Qa-1):this.distance}}function iu(t,n,e){return e!==1/0&&(t.x<0&&n.x<0||t.x>e&&n.x>e||t.y<0&&n.y<0||t.y>e&&n.y>e)}function su(t,n,e,r,i){if(i===1/0)return!1;const s=Math.floor(.5*t[n*r]),o=Math.floor(.5*t[n*r+1]),a=Math.floor(.5*t[e*r]),u=Math.floor(.5*t[e*r+1]);return s===a&&(s<0||s>i)&&o!==u||o===u&&(o<0||o>i)&&s!==a}function ou(t){if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(t[n])return!0;return!1}const au=[],uu=[];function lu(t,n,e){const r=t.mag(),i=n.mag();wt(au,e.x,e.y),wt(uu,n.x,n.y);const s=(a=uu,(o=au)[0]*a[0]+o[1]*a[1]);var o,a;return-Math.sign(s)*Math.sqrt(i*i-r*r)}function hu(t,n){return t.equals(n)&&t.z===n.z}var cu="undefined"!=typeof Float32Array?Float32Array:Array;function fu(){var t=new cu(3);return cu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function du(t,n,e){var r=new cu(3);return r[0]=t,r[1]=n,r[2]=e,r}function pu(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function yu(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function mu(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t}function gu(t,n){var e=n[0],r=n[1],i=n[2],s=e*e+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s),t}function vu(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function bu(t,n,e){var r=n[0],i=n[1],s=n[2],o=e[0],a=e[1],u=e[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}var wu=function(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t};function Mu(){var t=new cu(4);return cu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function xu(t,n){var e=n[0]+n[4]+n[8],r=void 0;if(e>0)r=Math.sqrt(e+1),t[3]=.5*r,r=.5/r,t[0]=(n[5]-n[7])*r,t[1]=(n[6]-n[2])*r,t[2]=(n[1]-n[3])*r;else{var i=0;n[4]>n[0]&&(i=1),n[8]>n[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(n[3*i+i]-n[3*s+s]-n[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(n[3*s+o]-n[3*o+s])*r,t[s]=(n[3*s+i]+n[3*i+s])*r,t[o]=(n[3*o+i]+n[3*i+o])*r}return t}!function(){var t=fu()}(),function(){var t,n=(t=new cu(4),cu!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var Fu,ku=function(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t},Au=function(t,n){var e=n[0],r=n[1],i=n[2],s=n[3],o=e*e+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=e*o,t[1]=r*o,t[2]=i*o,t[3]=s*o),t};fu(),du(1,0,0),du(0,1,0),Mu(),Mu(),Fu=new cu(9),cu!=Float32Array&&(Fu[1]=0,Fu[2]=0,Fu[3]=0,Fu[5]=0,Fu[6]=0,Fu[7]=0),Fu[0]=1,Fu[4]=1,Fu[8]=1;\n/*!\n     * Contains code from google filament\n     * https://github.com/google/filament/\n     * License Apache-2.0\n     */\nconst Pu=8,Su=[],_u=[],Ou=[],Cu=[];function Eu(t,n,e){const r=bu(_u,n,e),i=function(t,n,e,r,i,s,o,a,u,l){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=l,t}(Su,e[0],e[1],e[2],...r,...n);t=xu(t,i),t=function(t){return t[3]<0?ku(t,t,-1):t}(t=Au(t,t));const s=1/((1<<2*Pu-1)-1);if(t[3]<s){t[3]=s;const n=Math.sqrt(1-s*s);t[0]*=n,t[1]*=n,t[2]*=n}const o=e[3]>0?bu(Ou,e,n):bu(Ou,n,e);return vu(bu(Cu,e,n),o)<0&&ku(t,t,-1),t}const $u=[];function Iu(t,n,e){const r=e||[];r.setLength&&r.setLength(t.length);const i=$u;i.length<t.length/3&&(i.length=t.length/3),i.fill(0,0,t.length/3);const s=void 0===n.length?n:n.length;for(let e=0;e<s/3;e++)void 0===n.length?Hu(t,3*e,3*e+1,3*e+2,r,i):Hu(t,n[3*e],n[3*e+1],n[3*e+2],r,i);const o=r.getLength?r.getLength():r.length;for(let t=0;t<o;t+=3){const n=i[t/3];0!==n?(r[t]/=n,r[t+1]/=n,r[t+2]/=n):(r[t]=0,r[t+1]=0,r[t+2]=0)}return r}const zu=[],Du=[],Tu=[],Uu=[],ju=[],Nu=[],Lu=[];function Hu(t,n,e,r,i,s){yu(Uu,t[3*n],t[3*n+1],t[3*n+2]),yu(ju,t[3*e],t[3*e+1],t[3*e+2]),yu(Nu,t[3*r],t[3*r+1],t[3*r+2]);const o=wu(zu,Nu,ju),a=wu(Du,Uu,ju),u=bu(Tu,o,a);gu(Lu,u),i[3*n]=i[3*n]||0,i[3*e]=i[3*e]||0,i[3*r]=i[3*r]||0,i[3*n+1]=i[3*n+1]||0,i[3*e+1]=i[3*e+1]||0,i[3*r+1]=i[3*r+1]||0,i[3*n+2]=i[3*n+2]||0,i[3*e+2]=i[3*e+2]||0,i[3*r+2]=i[3*r+2]||0,i[3*n]+=Lu[0],i[3*e]+=Lu[0],i[3*r]+=Lu[0],i[3*n+1]+=Lu[1],i[3*e+1]+=Lu[1],i[3*r+1]+=Lu[1],i[3*n+2]+=Lu[2],i[3*e+2]+=Lu[2],i[3*r+2]+=Lu[2],s[n]+=1,s[e]+=1,s[r]+=1}\n/*!\n     * Contains code from THREE.JS\n     * https://github.com/mrdoob/three.js/\n     * License MIT\n     *\n     * Generate tangents per vertex.\n     */function Ru(t,n,e){return t[0]=n[e],t[1]=n[e+1],t[2]=n[e+2],t}function Vu(t,n,e){return t[0]=n[e],t[1]=n[e+1],t}class qu extends ru{constructor(t,n,e){super(t,n,e),this.Ut=e.altitudeProperty}getFormat(){const{lineColorFn:t,lineWidthFn:n}=this.it,e=[{type:this.maxPosZ>=Math.pow(2,15)?Float32Array:Int16Array,width:3,name:"aPosition"},{type:Uint16Array,width:1,name:"aLinesofar"},{type:Uint8Array,width:1,name:"aUp"},{type:Int16Array,width:3,name:"aExtrudedPosition"},{type:Int8Array,width:2,name:"aExtrude"}];return t&&e.push({type:Uint8Array,width:4,name:"aColor"}),n&&e.push({type:Uint8Array,width:1,name:"aLineWidth"}),this.Ut&&e.push({type:Float32Array,width:1,name:"aLineHeight"}),e}placeVector(t){const n=t.feature;if(this.Ut){const{altitudeScale:t,altitudeProperty:e,defaultAltitude:r,heightProperty:i,defaultHeight:s,minHeightProperty:o}=this.options,{altitude:a,height:u}=_n(n,t,e,r,i,s,o);this.feaAltitude=a,this.feaMinHeight=(a-u)/a*32767,a>this.maxAltitude&&(this.maxAltitude=a)}return super.placeVector(t)}needAltitudeAttribute(){return!1}It(t,n,e,r,i,s){const o=this.data.aPosition.getLength()/3;super.It(t,n,e,r,i,s);const a=this.data.aPosition.getLength()/3,u=this.data.aPosition.getLength()/3-this.offset,l=3===n.type,h=!1!==this.options.side;if(!l&&u>0&&h){const t=!1!==this.options.top?1:0,n=t+4;let e=this.data.aPosition.getLength()/3;for(const t in this.data){const n=this.data[t],r=n.getLength()/e;let i=n.currentIndex;for(let t=0;t<r;t++)n[i++]=n[o*r+3*r+t];n.currentIndex=i}e=this.data.aPosition.getLength()/3;for(const t in this.data){const r=this.data[t],i=r.getLength()/e;let s=r.currentIndex;for(let t=0;t<i;t++)r[s++]=r[o*i+i*n+t];r.currentIndex=s}e=this.data.aPosition.getLength()/3;for(const t in this.data){const r=this.data[t],i=r.getLength()/e;let s=r.currentIndex;for(let t=0;t<i;t++)r[s++]=r[o*i+i*(n+3)+t];r.currentIndex=s}super.addElements(t+1,u+1,u),super.addElements(u,u+1,u+2);const r=this.data.aPosition.getLength()/3-this.offset;e=this.data.aPosition.getLength()/3;for(const t in this.data){const n=this.data[t],r=n.getLength()/e;let i=n.currentIndex;for(let t=0;t<r;t++)n[i++]=n[a*r-r+t];n.currentIndex=i}e=this.data.aPosition.getLength()/3;for(const t in this.data){const r=this.data[t],i=r.getLength()/e;let s=r.currentIndex;for(let t=0;t<i;t++)r[s++]=r[a*i-n*i-i+t];r.currentIndex=s}e=this.data.aPosition.getLength()/3;for(const t in this.data){const r=this.data[t],i=r.getLength()/e;let s=r.currentIndex;for(let t=0;t<i;t++)r[s++]=r[a*i-n*i-3*i+t];r.currentIndex=s}super.addElements(r,u-3,r+1),super.addElements(u-3,r+2,r+1)}}fillData(t,n,e,r,i,s,o,a,u){const l=!1!==this.options.top,h=!1!==this.options.side,c=this.options.EXTENT/this.options.tileSize,f=this.feaLineWidth||this.symbol.lineWidth/2*c,d=Ka*i,p=Ka*s,y=f*i+n,m=f*s+e;this.jt(t,n,e,i,s,o,a,u,y,m,d,p),h&&(l&&this.jt(t,n,e,i,s,o,a,u,y,m,d,p),this.jt(t,n,e,i,s,o,a,u,y,m,d,p),this.Nt(t,n,e,i,s,o,a,u,y,m,d,p),this.Nt(t,n,e,i,s,o,a,u,y,m,d,p)),this.maxPos=Math.max(this.maxPos,Math.abs(n),Math.abs(e))}jt(t,n,e,r,i,s,o,a,u,l,h,c){const{lineColorFn:f,lineWidthFn:d}=this.it;let p=t.aPosition.currentIndex;t.aPosition[p++]=n,t.aPosition[p++]=e,t.aPosition[p++]=32767,t.aPosition.currentIndex=p,p=t.aLinesofar.currentIndex,t.aLinesofar[p++]=a,t.aLinesofar.currentIndex=p,p=t.aUp.currentIndex,t.aUp[p++]=+o,t.aUp.currentIndex=p,p=t.aExtrudedPosition.currentIndex,t.aExtrudedPosition[p++]=u,t.aExtrudedPosition[p++]=l,t.aExtrudedPosition[p++]=1,t.aExtrudedPosition.currentIndex=p,p=t.aExtrude.currentIndex,t.aExtrude[p++]=h,t.aExtrude[p++]=c,t.aExtrude.push(h,c),f&&(p=t.aColor.currentIndex,t.aColor[p++]=this.feaColor[0],t.aColor[p++]=this.feaColor[1],t.aColor[p++]=this.feaColor[2],t.aColor[p++]=this.feaColor[3],t.aColor.currentIndex=p),d&&(p=t.aLineWidth.currentIndex,t.aLineWidth[p++]=Math.round(2*this.feaLineWidth),t.aLineWidth.currentIndex=p),this.Ut&&(p=t.aLineHeight.currentIndex,t.aLineHeight[p++]=this.feaAltitude,t.aLineHeight.currentIndex=p)}Nt(t,n,e,r,i,s,o,a,u,l,h,c){const{lineColorFn:f,lineWidthFn:d}=this.it;let p=t.aPosition.currentIndex;t.aPosition[p++]=n,t.aPosition[p++]=e,t.aPosition[p++]=this.feaMinHeight||0,t.aPosition.currentIndex=p,p=t.aLinesofar.currentIndex,t.aLinesofar[p++]=a,t.aLinesofar.currentIndex=p,p=t.aUp.currentIndex,t.aUp[p++]=+o,t.aUp.currentIndex=p,p=t.aExtrudedPosition.currentIndex,t.aExtrudedPosition[p++]=u,t.aExtrudedPosition[p++]=l,t.aExtrudedPosition[p++]=1,t.aExtrudedPosition.currentIndex=p,p=t.aExtrude.currentIndex,t.aExtrude[p++]=h,t.aExtrude[p++]=c,t.aExtrude.push(h,c),f&&(p=t.aColor.currentIndex,t.aColor[p++]=this.feaColor[0],t.aColor[p++]=this.feaColor[1],t.aColor[p++]=this.feaColor[2],t.aColor[p++]=this.feaColor[3],t.aColor.currentIndex=p),d&&(p=t.aLineWidth.currentIndex,t.aLineWidth[p++]=Math.round(2*this.feaLineWidth),t.aLineWidth.currentIndex=p),this.Ut&&(p=t.aLineHeight.currentIndex,t.aLineHeight[p++]=this.feaAltitude,t.aLineHeight.currentIndex=p)}addElements(t,n,e){const r=!1!==this.options.top,i=!1!==this.options.side,s=(r?1:0)+(i?4:0),o=this.offset;t*=s,n*=s,e*=s;if(this.data.aUp[o+e+4]){if(r&&super.addElements(n,t,e),i){const t=r?1:0;super.addElements(n+t,e+t,e+t+2),super.addElements(n+t+1,e+t+1+2,n+t+1+2)}}else if(r&&super.addElements(t,e,n),i){const n=r?1:0;super.addElements(t+n,t+n+2,e+n),super.addElements(t+n+1+2,e+n+1+2,e+n+1)}}createDataPack(t,n){this.maxAltitude=0;const e=super.createDataPack(t,n);if(!e)return e;const{data:r,indices:i}=e;this.getFormat().reduce(((t,n)=>(t[n.name]={size:n.width},t)),{}).aPickingId={size:1};const{aExtrudedPosition:s,aPosition:o,aLinesofar:a,aUp:u,aExtrude:l,aColor:h,aLineHeight:c,aLineWidth:f}=r,d={},p=Iu(s,i);let y,m=!0;for(let t=0;t<p.length;t++)p[t]=-p[t],p[t]%1!=0&&(m=!1);if(!1!==this.options.top&&this.symbol.material&&function(t){for(const n in t)if(n.indexOf("Texture")>=0&&t[n])return!0;return!1}(this.symbol.material)&&(y=function(t,n,e){const r=256,i=[];for(let s=0;s<t.length;s+=3){const t=n[s/3];e[s/3]?i.push(t/r,1):i.push(t/r,0)}return i}(s,a,u)),d.aPosition=o,y&&(d.aTexCoord0=new Float32Array(y)),d.aNormal=m?new Int8Array(p):new Float32Array(p),d.aPickingId=r.aPickingId,d.aExtrude=l,h&&(d.aColor=h),f&&(d.aLineWidth=f),c){const t=Nn(this.maxAltitude);d.aLineHeight=new t(c)}const g=[];for(const t in d)g.push(d[t].buffer);return e.data=d,e.buffers=g,e}}const Gu=Math.pow(2,16)/1;class Ju extends Go{getFormat(){return[...this.getPositionFormat()]}placeVector(t){const n=t.feature,e=3===n.type,r=n.geometry,i=this.elements;e&&(this.elements=this.ft.get());const s=this.needAltitudeAttribute()?2:3;for(let t=0;t<r.length;t++)this.offset=this.data.aPosition.getLength()/s,this.It(r[t],n),e&&(this.Dt(i),this.elements=this.ft.get());e&&(this.elements=i)}It(t,n){const e=3===n.type;let r=t.length;for(;r>=2&&t[r-1].equals(t[r-2]);)r--;let i,s,o,a=0;for(;a<r-1&&t[a].equals(t[a+1]);)a++;if(!(r<(e?3:2))){this.distance=0,this.vertexLength=0,this.primitiveLength=0,this.e1=this.e2=this.e3=-1,e&&(i=t[r-2]);for(let n=a;n<r;n++)o=e&&n===r-1?t[a+1]:t[n+1],o&&t[n].equals(o)||(i&&(s=i),i=t[n],s&&(this.distance+=i.dist(s)),this.addCurrentVertex(i,this.distance))}}addCurrentVertex(t,n){const e=this.vertexLength++;this.addLineVertex(this.data,t,n),e>=1&&this.addElements(e-1,e),n>Gu&&(this.distance=0,this.addCurrentVertex(t,this.distance))}addLineVertex(t,n){this.fillPosition(t,n.x,n.y,n.z||0),this.maxPos=Math.max(this.maxPos,Math.abs(n.x),Math.abs(n.y))}addElements(t,n){this.maxIndex=Math.max(this.maxIndex,this.offset+t,this.offset+n);let e=this.elements.currentIndex;this.elements[e++]=this.offset+t,this.elements[e++]=this.offset+n,this.elements.currentIndex=e}Dt(t){const n=this.options.EXTENT,e=this.elements,r=e.getLength();for(let i=0;i<r;i+=2)if(!Pn(this.data.aPosition,e[i],e[i+1],3,n)){let n=t.currentIndex;t[n++]=e[i],t[n++]=e[i+1],t.currentIndex=n}}}const Wu=45*Math.PI/100;class Bu extends Go{getFormat(){const{markerFillFn:t}=this.it;let n;return n="line"===this.symbol.markerRotationAlignment?[...this.getPositionFormat(),{type:Float32Array,width:1,name:"aXYRotation"},{type:Float32Array,width:1,name:"aZRotation"}]:[...this.getPositionFormat()],t&&n.push({type:Uint8Array,width:4,name:"aColor"}),n}placeVector(t){const n=t.feature.properties,{markerFillFn:e}=this.it;let r;e&&(r=e(this.options.zoom,n)||[255,255,255,255],g(r)?(this.dynamicAttrs.aColor=1,r=[0,0,0,0]):r=He([],r));const i=this.data,s=this.symbol.markerSpacing||250,o=this.symbol.markerPlacement||"point",a="line"===this.symbol.markerRotationAlignment,u=this._t(t,s,o,a);for(let t=0;t<u.length;t++){const n=u[t];if(this.fillPosition(this.data,n.x,n.y,n.z),a){let t=i.aXYRotation.currentIndex;i.aXYRotation[t++]=n.xyRotation||0,i.aXYRotation.currentIndex=t,t=i.aZRotation.currentIndex,i.aZRotation[t++]=n.zRotation||0,i.aZRotation.currentIndex=t}if(r){let t=i.aColor.currentIndex;i.aColor[t++]=r[0],i.aColor[t++]=r[1],i.aColor[t++]=r[2],i.aColor[t++]=r[3],i.aColor.currentIndex=t}const e=Math.max(Math.abs(n.x),Math.abs(n.y));e>this.maxPos&&(this.maxPos=e)}}_t(t,n,e,r){const i=t.feature,s=this.options.EXTENT;if("line"===e){const t=[];let e=i.geometry;s&&(e=Pa(i.geometry,0,0,s,s));for(let r=0;r<e.length;r++){const i=Oa(e[r],n,Wu,null,0,24,1,1,s||1/0);t.push.apply(t,i)}return t}return Va(i,e,s,r,this.options.altitudeToTileScale)}hasElements(){return!1}}\n/*!\n     * from @turf/bboxClip\n     * https://github.com/Turfjs/turf\n     * MIT LICENSE\n     */const Xu=[],Yu=[];function Ku(t,n){var e,r,i,s,o,a,u;for(r=1;r<=8;r*=2){for(e=[],s=!(Qu(i=t[t.length-1],n)&r),o=0;o<t.length;o++){if((u=!(Qu(a=t[o],n)&r))!==s){const t=Zu(i,a,r,n);void 0!==a.x?e.push(new ln(t[0],t[1])):e.push(t)}u&&e.push(a),i=a,s=u}if(!(t=e).length)break}return e}function Zu(t,n,e,r){return Xu[0]=void 0===t.x?t[0]:t.x,Xu[1]=void 0===t.y?t[1]:t.y,t=Xu,Yu[0]=void 0===n.x?n[0]:n.x,Yu[1]=void 0===n.y?n[1]:n.y,n=Yu,8&e?[t[0]+(n[0]-t[0])*(r[3]-t[1])/(n[1]-t[1]),r[3]]:4&e?[t[0]+(n[0]-t[0])*(r[1]-t[1])/(n[1]-t[1]),r[1]]:2&e?[r[2],t[1]+(n[1]-t[1])*(r[2]-t[0])/(n[0]-t[0])]:1&e?[r[0],t[1]+(n[1]-t[1])*(r[0]-t[0])/(n[0]-t[0])]:null}function Qu(t,n){Xu[0]=void 0===t.x?t[0]:t.x,Xu[1]=void 0===t.y?t[1]:t.y;var e=0;return(t=Xu)[0]<n[0]?e|=1:t[0]>n[2]&&(e|=2),t[1]<n[1]?e|=4:t[1]>n[3]&&(e|=8),e}const tl=[0,0,0,0],nl=-9999999;class el extends Go{constructor(...t){super(...t),this.lineElements=[]}createStyledVector(t,n,e,r,i){const s=new qe(t,n,e,r),o=s.getPolygonResource();return!this.options.atlas&&o&&(i[o]=[0,0]),s}getFormat(){const t=[...this.getPositionFormat()],{polygonFillFn:n,polygonOpacityFn:e,uvScaleFn:r,uvOffsetFn:i,polygonPatternUVFn:s}=this.it;if(this.iconAtlas){const n=this.getIconAtlasMaxValue();t.push({type:n>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return n&&t.push({type:Uint8Array,width:4,name:"aColor"}),e&&t.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&t.push({type:Uint16Array,width:2,name:"aUVScale"}),i&&t.push({type:Uint8Array,width:2,name:"aUVOffset"}),s&&t.push({type:Float32Array,width:2,name:"aTexCoord"}),t}placeVector(t,n){const e=t.feature,r=e.geometry;this.Lt(r,e,n)}Lt(t,n){let e,r,i,s;const{polygonFillFn:o,polygonOpacityFn:a,uvScaleFn:u,uvOffsetFn:l,uvOffsetInMeterFn:h,polygonPatternUVFn:c}=this.it,f=n.properties;o&&(e=o(this.options.zoom,f)||gt([],255,255,255,255),g(e)?(this.dynamicAttrs.aColor=1,e=tl):e=He([],e)),a&&(r=a(this.options.zoom,f),g(r)?(this.dynamicAttrs.aOpacity=1,r=255):(Ie(r)&&(r=1),r*=255)),u&&(i=u(this.options.zoom,f),g(i)?(i=[255,255],this.dynamicAttrs.aUVScale=1):(Ie(i)&&(i=[1,1]),i=[255*i[0],255*i[1]])),l&&(h&&h(null,f)?s=[0,0]:(s=l(this.options.zoom,f),g(s)?(s=[0,0],this.dynamicAttrs.aUVOffset=1):(Ie(s)&&(s=[0,0]),s=[255*s[0],255*s[1]])));const d=!!this.iconAtlas,p=za(t,500),y=[0,0],m=[0,0];if(d){const{polygonPatternFileFn:t}=this.it,n=t?t(null,f):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[n]){const t=this.iconAtlas.positions[n],e=!In(t.displaySize[0])||!In(t.displaySize[1]);y[0]=t.tl[0]+(e?1:0),y[1]=t.tl[1]+(e?1:0),m[0]=t.displaySize[0]-1-(e?2:0),m[1]=t.displaySize[1]-1-(e?2:0)}}let v,b=0;c&&(v=c(this.options.zoom,f));const w=this.needAltitudeAttribute()?2:3,M=[-1,-1,n.extent+1,n.extent+1],x=this.Ht=this.Ht||this.ft.getProxy(),F=this.Rt=this.Rt||this.ft.getProxy();for(let t=0;t<p.length;t++){const n=p[t],o=this.data.aPosition.getLength()/w;x.setLength(0),F.setLength(0);for(let t=0;t<n.length;t++){let o=n[t];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(o=Ku(o,M)),0===o.length)continue;0!==t&&F.push(x.length/3),this.ensureDataCapacity(o.length);const a=this.data;for(let t=0;t<o.length;t++){const n=o[t].x,u=o[t].y,l=o[t].z||0;if(this.fillPosition(this.data,n,u,l),d){let t=a.aTexInfo.currentIndex;a.aTexInfo[t++]=y[0],a.aTexInfo[t++]=y[1],a.aTexInfo[t++]=m[0],a.aTexInfo[t++]=m[1],a.aTexInfo.currentIndex=t}if(void 0!==e){let t=a.aColor.currentIndex;a.aColor[t++]=e[0],a.aColor[t++]=e[1],a.aColor[t++]=e[2],a.aColor[t++]=e[3],a.aColor.currentIndex=t}if(void 0!==r){let t=a.aOpacity.currentIndex;a.aOpacity[t++]=r,a.aOpacity.currentIndex=t}if(void 0!==i){let t=a.aUVScale.currentIndex;a.aUVScale[t++]=i[0],a.aUVScale[t++]=i[1],a.aUVScale.currentIndex=t}if(void 0!==s){let t=a.aUVOffset.currentIndex;a.aUVOffset[t++]=s[0],a.aUVOffset[t++]=s[1],a.aUVOffset.currentIndex=t}if(c){let t=a.aTexCoord.currentIndex;if(v){const n=Ie(v[2*b])?v[0]:v[2*b],e=Ie(v[2*b]+1)?v[1]:v[2*b+1];a.aTexCoord[t++]=n,a.aTexCoord[t++]=e}else a.aTexCoord[t++]=nl,a.aTexCoord[t++]=nl;a.aTexCoord.currentIndex=t,b++}const h=Math.abs(n),f=Math.abs(u);h>this.maxPos&&(this.maxPos=h),f>this.maxPos&&(this.maxPos=f),x.push(n,u,l)}}let a=on(x,F,3);if(x.length&&!a.length){const t=[];for(let n=0;n<x.length;n+=3)t[n]=x[n],t[n+1]=x[n+2],t[n+2]=x[n+1];if(a=on(t,F,3),!a.length){for(let n=0;n<x.length;n+=3)t[n]=x[n+1],t[n+1]=x[n+2],t[n+2]=x[n];a=on(t,F,3)}}for(let t=0;t<a.length;t+=3)this.addElements(o+a[t],o+a[t+1],o+a[t+2])}}ensureDataCapacity(t){super.ensureDataCapacity(1,t)}}const rl=[{type:Int16Array,width:3,name:"aPosition"}];class il extends Go{getFormat(){return rl}placeVector(t,n){const e=this._t(t,n);if(0===e.length)return;const r=this.data,i=this.getAltitude(t.feature.properties);let s=r.aPosition.getLength()/rl[0].width;for(let t=0;t<e.length;t++){const n=e[t];r.aPosition.push(2*n.x+0,2*n.y+0,i),r.aPosition.push(2*n.x+1,2*n.y+0,i),r.aPosition.push(2*n.x+1,2*n.y+1,i),r.aPosition.push(2*n.x+0,2*n.y+1,i),this.addElements(s,s+1,s+2),this.addElements(s,s+2,s+3),s+=4;const o=Math.max(Math.abs(2*n.x+1),Math.abs(2*n.y+1));o>this.maxPos&&(this.maxPos=o)}}_t(t,n){const{feature:e,symbol:r}=t,i=this.$t(t,r),s=e.properties,{markerSpacingFn:o}=this.it,a=((o?o(null,s):r.markerSpacing)||250)*n;return Ra(t,null,null,n,this.options.EXTENT,i,a)}$t(t,n){return this.it.markerPlacementFn?this.it.markerPlacementFn(this.options.zoom,t.feature.properties):n.markerPlacement}}class sl extends ru{constructor(t,n,e){(n=$e({},n)).lineJoin="miter",n.lineCap="butt",super(t,n,e),this.options.radialSegments%2==1&&this.options.radialSegments--}getFormat(){const{lineWidthFn:t,lineColorFn:n,lineOpacityFn:e,linePatternAnimSpeedFn:r,linePatternGapFn:i}=this.it,s=[...this.getPositionFormat(),{type:Int8Array,width:4,name:"aTubeNormal"},{type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}];if(this.iconAtlas){s.push({type:Int8Array,width:1,name:"aNormalDistance"});const t=this.getIconAtlasMaxValue();s.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return t&&s.push({type:Uint16Array,width:1,name:"aLineWidth"}),n&&s.push({type:Uint8Array,width:4,name:"aColor"}),e&&s.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&s.push({type:Int8Array,width:1,name:"aLinePatternAnimSpeed"}),i&&s.push({type:Int8Array,width:1,name:"aLinePatternGap"}),s}ensureDataCapacity(t,n,e,r){const i=this.options.radialSegments/2;return super.ensureDataCapacity(t,n,e,r*i)}addHalfVertex(t,n,e,r,i,s,o,a){const{x:u,y:l,z:h}=t,c=1*this.scaledDistance,f=this.options.radialSegments/2,{x:d,y:p,z:y}=o.dir,m=function(t,n,e,r,i,s,o,a){dt(ol,e,r,i),dt(al,s,o,0),yt(ul,ol,al),pt(al,al),pt(ul,ul),ll[n]||(ll[n]=[]);const u=ll[n];for(var l=0;l<n;l++){const e=Math.PI*l/n,r=0,i=1-Math.abs(e-r)/(Math.PI/2);u[l]=u[l]||[],hl(al,ul,u[l],t,e,i*(a?-1:1))}return u}(1,f,d,p,y,n,e,i);this.prevVertex&&this.fillTubeElements(i),this.fillData(this.data,u,l,h||0,m,i,c,a)}fillTubeElements(t){const n=this.options.radialSegments/2,e=this.needAltitudeAttribute()?2:3,r=this.data.aPosition.getLength()/e;for(let e=0;e<n;e++){const i=e+r,s=e+r-2*n;let o,a;e===n-1&&t?(o=e+r-2*n+1,a=e+r-2*n-2*n+1):(o=e+r+1,a=e+r+1-2*n),super.addElements(i-this.offset,o-this.offset,s-this.offset),super.addElements(s-this.offset,o-this.offset,a-this.offset)}}fillData(t,n,e,r,i,s,o,a){const{lineWidthFn:u,lineColorFn:l,lineOpacityFn:h,linePatternAnimSpeedFn:c,linePatternGapFn:f}=this.it,d=i.length;for(let s=0;s<d;s++){this.fillPosition(t,n,e,r),bt(i[s],i[s],Ka);let d=t.aTubeNormal.currentIndex;for(let n=0;n<i[s].length;n++)t.aTubeNormal[d++]=i[s][n];if(t.aTubeNormal.currentIndex=d,d=t.aLinesofar.currentIndex,t.aLinesofar[d++]=o,t.aLinesofar.currentIndex=d,this.iconAtlas&&(d=t.aNormalDistance.currentIndex,t.aNormalDistance[d++]=Ka*a,t.aNormalDistance.currentIndex=d,d=t.aTexInfo.currentIndex,t.aTexInfo[d++]=this.feaTexInfo[0],t.aTexInfo[d++]=this.feaTexInfo[1],t.aTexInfo[d++]=this.feaTexInfo[2],t.aTexInfo[d++]=this.feaTexInfo[3],t.aTexInfo.currentIndex=d),u){const n="centimeter"===(p=this.options.metric)||"cm"===p?1:"millimeter"===p||"mm"===p?.1:100;let e=this.feaLineWidth*n;isNaN(e)&&(e=0),d=t.aLineWidth.currentIndex,t.aLineWidth[d++]=Math.round(e),t.aLineWidth.currentIndex=d}l&&(d=t.aColor.currentIndex,t.aColor[d++]=this.feaColor[0],t.aColor[d++]=this.feaColor[1],t.aColor[d++]=this.feaColor[2],t.aColor[d++]=this.feaColor[3],t.aColor.currentIndex=d),h&&(d=t.aOpacity.currentIndex,t.aOpacity[d++]=this.feaOpacity,t.aOpacity.currentIndex=d),c&&(d=t.aLinePatternAnimSpeed.currentIndex,t.aLinePatternAnimSpeed[d++]=127*(this.feaPatternAnimSpeed||0),t.aLinePatternAnimSpeed.currentIndex=d),f&&(d=t.aLinePatternGap.currentIndex,t.aLinePatternGap[d++]=10*(this.feaLinePatternGap||0),t.aLinePatternGap.currentIndex=d)}var p;this.maxPos=Math.max(this.maxPos,Math.abs(n)+1,Math.abs(e)+1)}createDataPack(t,n){const e=super.createDataPack(t,n);return e&&(e.is2D=!1),e}}const ol=[],al=[],ul=[],ll={};function hl(t,n,e,r,i,s){return gt(e,r*(Math.cos(i)*t[0]+Math.sin(i)*n[0]),r*(Math.cos(i)*t[1]+Math.sin(i)*n[1]),r*(Math.cos(i)*t[2]+Math.sin(i)*n[2]),s),e}class cl extends sl{addHalfVertex(t,n,e,r,i,s,o,a){const{x:u,y:l,z:h}=t,c=1*this.scaledDistance,{x:f,y:d,z:p}=o.dir,y=gl(this.feaLineWidth,this.feaLineHeight,f,d,p,n,e,i);this.prevVertex&&this.fillTubeElements(i),this.fillData(this.data,u,l,h||0,y,i,c,a)}ensureDataCapacity(t,n,e,r){return super.ensureDataCapacity(t,n,e,2*r)}}const fl=[],dl=[],pl=[],yl=[],ml=[];function gl(t,n,e,r,i,s,o,a){dt(dl,e,r,i),dt(pl,s,o,0),yt(yl,dl,pl),pt(pl,pl),pt(yl,yl),wt(fl,t,n);const u=xt(fl)/t,l=Math.atan(n/t);let h=Math.PI/2+(Math.PI/2-l);return ml[0]||(ml[0]=[]),hl(pl,yl,ml[0],u,h,a?1:-1),h+=2*l,ml[1]||(ml[1]=[]),hl(pl,yl,ml[1],u,h,a?1:-1),ml}class vl{constructor(t){this.max=t,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(t,n){return this.has(t)?(this.order.splice(this.order.indexOf(t),1),this.data[t]=n,this.order.push(t)):(this.data[t]=n,this.order.push(t),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(t){return t in this.data}keys(){return this.order}getAndRemove(t){if(!this.has(t))return null;const n=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),n}get(t){if(!this.has(t))return null;return this.data[t]}remove(t){return this.has(t)?(delete this.data[t],this.order.splice(this.order.indexOf(t),1),this):this}setMaxSize(t){for(this.max=t;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}}\n/*!\n     * based on @mapbox/tiny-sdf\n     * https://github.com/mapbox/tiny-sdf\n     * @License BSD 2-Clause\n     */var bl=1e20;function wl(t,n,e,r,i,s,o){this.fontSize=t||24,this.buffer=void 0===n?3:n,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=s||"normal",this.fontStyle=o||"normal",this.radius=e||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas="undefined"==typeof document?new OffscreenCanvas(a,a):document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function Ml(t,n,e,r,i,s){for(var o=0;o<n;o++)xl(t,o,n,e,r,i,s);for(var a=0;a<e;a++)xl(t,a*n,1,n,r,i,s)}function xl(t,n,e,r,i,s,o){var a,u,l,h;for(s[0]=0,o[0]=-bl,o[1]=bl,a=0;a<r;a++)i[a]=t[n+a*e];for(a=1,u=0,l=0;a<r;a++){do{h=s[u],l=(i[a]-i[h]+a*a-h*h)/(a-h)/2}while(l<=o[u]&&--u>-1);s[++u]=a,o[u]=l,o[u+1]=bl}for(a=0,u=0;a<r;a++){for(;o[u+1]<a;)u++;h=s[u],t[n+a*e]=i[h]+(a-h)*(a-h)}}wl.prototype.draw=function(t,n,e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.textBaseline="top",this.ctx.fillText(t,this.buffer,this.buffer);for(var r=this.ctx.getImageData(0,0,n,e),i=new Uint8ClampedArray(n*e),s=0;s<n*e;s++){var o=r.data[4*s+3]/255;this.gridOuter[s]=1===o?0:0===o?bl:Math.pow(Math.max(0,.5-o),2),this.gridInner[s]=1===o?bl:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(Ml(this.gridOuter,n,e,this.f,this.v,this.z),Ml(this.gridInner,n,e,this.f,this.v,this.z),s=0;s<n*e;s++){var a=Math.sqrt(this.gridOuter[s])-Math.sqrt(this.gridInner[s]);i[s]=Math.round(255-255*(a/this.radius+this.cutoff))}return i};let Fl=0;class kl{constructor(t,n=15,e,r){this.entries={},this.Vt={},this.qt=new vl(2048,(function(){})),this.Gt=t,this.Jt=n,this.Wt=e,this.Bt=r}Xt(t){return t&&t.indexOf("{stack}")>=0&&t.indexOf("{range}")>0}getGlyphs(t,n){if(!t||!Object.keys(t).length)return void n(null,{glyphs:null});if(this.Xt(this.Bt))return void this.Yt(t,n);const e=this.entries,r=t.options;let i=!0;r&&(i=!1!==r.isCharsCompact),i=i||this.Wt;const s=(r,s,a)=>{let u=0,l=0;for(const n in t)if("options"!==n){e[n]=e[n]||{},s[n]=s[n]||{};for(const h in t[n]){if(l++,l<=r)continue;const t=i&&!oa(+h),c=n+":"+h+":"+t;let f;if(this.qt.has(c)?f=this.qt.get(c):(f=this.Kt(e[n],n,h,t),this.qt.add(c,f),u++),f=Al(f),s[n][h]=f,a.push(f.bitmap.data.buffer),this.Gt&&u>this.Jt)return void this.Gt(o(l,s,a))}}n(null,{glyphs:s,buffers:a})};function o(t,n,e){return()=>{s(t,n,e)}}s(0,{},[])}Yt(t,n){const e=[];for(const n in t)for(const r of t[n])e.push(this.Zt(n,r));Promise.all(e).then((t=>{n(null,t)}))}Zt(){return Promise.resolve(null)}Kt(t,n,e,r){const i=n;let s=t.tinySDF;const o=r?-1:2;if(!s){let n="400";/bolder/i.test(i)?n="1000":/bold/i.test(i)?n="900":/medium/i.test(i)?n="500":/light/i.test(i)&&(n="200"),s=t.tinySDF=new wl(24,2,8,.25,i,n)}const a=String.fromCodePoint(e),u=s.ctx.measureText(a),l=Math.round(u.width),h=s.draw(a,l+4,28);if(Fl<4){const t="undefined"!=typeof document&&document.getElementById("sdf-debug-"+Fl++);if(t){t.width=l+4,t.height=s.canvas.height;t.getContext("2d").drawImage(s.canvas,0,0)}}return{charCode:e,bitmap:{width:l+4,height:28,data:h},metrics:{width:l,height:24,left:1,top:-2,advance:l+2+o}}}}function Al(t){const n={width:t.bitmap.width,height:t.bitmap.height,data:new Uint8ClampedArray(t.bitmap.data)};return{charCode:t.charCode,bitmap:n,metrics:$e({},t.metrics)}}const Pl={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textFaceName:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1};Object.assign({visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},Pl),Object.assign({lineDasharray:1,topPolygonFill:1,bottomPolygonFill:1},Pl);const Sl="__fea_idx";new Float32Array([-1e12])[0];const _l="maptalks_ombb";function Ol(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p,y,m){const g=n.getLength(),v=i/3;for(let e=2,r=g;e<r;e+=3)t[i+e-2]=n[e-2],t[i+e-1]=n[e-1],t[i+e-0]=n[e]-o;i+=g;for(let e=2,r=g;e<r;e+=3)t[i+e-2]=n[e-2],t[i+e-1]=n[e-1],t[i+e-0]=n[e]-a;i+=g,t.trySetLength(i+g),t.copyWithin(i,i-2*g,i-g),i+=g,t.trySetLength(i+g),t.copyWithin(i,i-2*g,i-g),i+=g,(e=e||[]).push(g/3);const b=e.getLength();for(let n=0;n<b;n++){Cl(v+(e[n-1]||0),v+e[n],t,g/3,u,r,l,h,c,f,s,d,p,y,m)}return i}function Cl(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p){const y=s.getLength();let m,g;for(let o=t,a=n;o<a-1;o++)if(m=o,g=o+1,i===1/0||!ct(e,m,g,i))if((o-t)%2==1&&(m+=2*r,g+=2*r),p){let t=s.currentIndex;s[t++]=m+r,s[t++]=g,s[t++]=m,s[t++]=g+r,s[t++]=g,s[t++]=m+r,s.currentIndex=t}else{let t=s.currentIndex;s[t++]=m+r,s[t++]=m,s[t++]=g,s[t++]=g,s[t++]=g+r,s[t++]=m+r,s.currentIndex=t}o&&function(t,n,e,r,i,s,o,a,u,l,h,c){let f,d=0,p=0,y=0,m=0;const g=c?[1,3,4]:[2,3,4];for(let c=s.getLength()-1;c>=o;c--){const o=s[c],v=3*o+1,b=3*o+2,w=i[3*o],M=i[v],x=i[b];d||p||(d=Math.max(i[b],i[3*s[c-3]+2]),p=Math.min(i[b],i[3*s[c-3]+2]),f=d-p);let F=y;const k=c%6;0===t?(5===k&&(m=Ct(i,s,c,w,M)),F=k===g[0]||k===g[1]||k===g[2]?y:y+m):1===t&&(k===g[0]||k===g[1]||k===g[2]?F=0:5===k?(m=Ct(i,s,c,w,M),F=m):F=m);const A=F/l*(1/(100*h))/a;let P;P=1===n?x===d?1:0:"bottom"===e?x===d?f/100/u:0:x===d?0:-f/100/u,r[2*o]=A,r[2*o+1]=P,0===k&&(y+=m)}}(a,u,l,h,e,s,y,c[0],c[1],f,d,p)}function El(t){const n=[t[0]];let e=t[0];for(let r=1;r<t.length;r++)Array.isArray(t[r])?t[r][0]===e[0]&&t[r][1]===e[1]&&t[r][2]===e[2]||n.push(t[r]):t[r].x===e.x&&t[r].y===e.y&&t[r].z===e.z||n.push(t[r]),e=t[r];return n}const $l=Do.getInstance();function Il(t,n,e,r,i,s,o,a,u,l,h,c,f,d,p,y){void 0===n.top&&(n.top=!0),void 0===n.side&&(n.side=!0),$l.reset();const{altitudeScale:m,altitudeProperty:w,defaultAltitude:M,heightProperty:x,minHeightProperty:F,defaultHeight:k,tangent:A,uv:S,topUVMode:_,sideUVMode:O,sideVerticalUVMode:E,top:$,side:I,textureYOrigin:z,topThickness:D}=n,T=function(t,n,{altitudeScale:e,altitudeProperty:r,defaultAltitude:i,heightProperty:s,minHeightProperty:o,defaultHeight:a},{center:u,side:l,top:h,topThickness:c,uvOrigin:f,uv:d,uvSize:p,topUVMode:y,sideUVMode:m,sideVerticalUVMode:g,textureYOrigin:v,tileRatio:b,centimeterToPoint:w,verticalCentimeterToPoint:M,positionType:x,res:F,glScale:k,projectionCode:A},S,_){let O=n/t[0].extent;n===1/0&&(O=1);const C=n===1/0,E=_.get(),$=_.get(),I=_.get(),z=_.getProxy(),D=_.get(),T=_.get(),U=_.get(),j=!!d,N=!!h,L=!!l,H=j?_.get():null;function R(t,e,r,i,s,o){let a=e;if(N){const l=on(z,r,3);if(0===l.length)return e;let h=z.getLength(),d=D.currentIndex;for(let t=0;t<h;t++)D[d++]=z[t];if(D.currentIndex=d,e+=z.getLength(),o)for(let n=2,e=l.length;n<e;n+=3)l[n]+=t/3,l[n-1]+=t/3,l[n-2]+=t/3;else{let n;for(let e=2,r=l.length;e<r;e+=3)n=l[e-1],l[e-1]=l[e]+t/3,l[e]=n+t/3,l[e-2]+=t/3}h=l.length,d=T.currentIndex;for(let t=0;t<h;t++)T[d++]=l[t];T.currentIndex=d,j&&_t(y||0,t,e,H,D,f,w,b,p[0],p[1],s,F,k,A,u),c>0&&!L&&(e=Ol(D,z,r,T,e,H,0,c,n,j,m||0,g||0,v,p,b,M,i<0?!o:o)),U.setLength(e/3),U.fill(1,a/3,e/3)}if(L){N&&(c=0),a=e,e=Ol(D,z,r,T,e,H,c,i,n,j,m||0,g||0,v,p,b,M,i<0?!o:o),U.setLength(e/3);const t=z.getLength()/3;U.fill(1,a/3,a/3+t),U.fill(0,a/3+t,a/3+2*t),U.fill(1,a/3+2*t,a/3+3*t),U.fill(0,a/3+3*t,e/3)}return e}let V=0,q=0;const G=[-1,-1,n+1,n+1];let J=0,W=t.length;P(S)&&(J=S,W=S+1);let B=0,X=!1;const Y=_.getProxy();let K=!1;for(;J<W;J++){const u=t[J],l=u.id;P(l)&&(Math.abs(l)>B&&(B=Math.abs(l)),l<0&&(X=!0));const h=u.geometry,c=u.properties[_l];let f=Array.isArray(c&&c[0]&&c[0][0])?c[0]:c;const{altitude:d,height:p}=_n(u,e,r,i,s,a,o);p<0&&(K=!0),V=Math.max(Math.abs(d),V);const y=D.getLength();let m=0,g=q;Y.setLength(0),z.setLength(0);const v=An(h[0])<0;for(let t=0,e=h.length;t<e;t++){let r=h[t];v&&(r=r.reverse()),r=El(r);const i=An(r)<0;if(!i&&t>0&&(m++,f=c&&c[m],q=R(g,q,Y,p*O,f,C),z.setLength(0),Y.setLength(0),g=q),n!==1/0&&(r=Ku(r,G)),!r.length){t===e-1&&(q=R(g,q,Y,p*O,f,C));continue}const s=r.length;if(Array.isArray(r[0])?r[0][0]===r[s-1][0]&&r[0][1]===r[s-1][1]||r.push([r[0][0],r[0][1]]):r[0].x===r[s-1].x&&r[0].y===r[s-1].y||r.push(r[0]),i){let t=Y.currentIndex;Y[t++]=z.getLength()/3,Y.currentIndex=t}ht(z,z.getLength(),r,O,d,!1,x),t===e-1&&(q=R(g,q,Y,p*O,f,C))}const b=D.getLength()-y,w=(Sl+"").trim();for(let t=0;t<b/3;t++){let t=$.currentIndex;$[t++]=void 0===u[w]?J:u[w],$.currentIndex=t,t=E.currentIndex,E[t++]=J,E.currentIndex=t,P(l)&&(t=I.currentIndex,I[t++]=l,I.currentIndex=t)}}const Z=Ln($.getLength()?$[$.getLength()-1]:0),Q={hasNegativeHeight:K,maxAltitude:V,vertices:D,verticeTypes:U,indices:T,pickingIds:Do.createTypedArray($,Z),featureIndexes:E};if(I.getLength()){const t=X?Nn(B):Ln(B);Q.featureIds=Do.createTypedArray(I,t)}else Q.featureIds=[];return H&&(H.setLength(D.getLength()/3*2),Q.uvs=H),Q}(t,e,{altitudeScale:m,altitudeProperty:w,defaultAltitude:M||0,heightProperty:x,minHeightProperty:F,defaultHeight:k||0},{center:y,top:$,side:I,topThickness:10*D||0,uv:S||A,uvSize:[i,i],uvOrigin:r,topUVMode:_,sideUVMode:O,sideVerticalUVMode:E,textureYOrigin:z,tileRatio:a,centimeterToPoint:u,verticalCentimeterToPoint:l,positionType:p,res:s,glScale:o,projectionCode:f},d,$l),U=[],j=T.vertices.getLength()/3,N=jn(j),L=Do.createTypedArray(T.indices,N);delete T.indices,U.push(L.buffer,T.pickingIds.buffer);const H=Nn(Math.max(512,T.maxAltitude));T.vertices=Do.createTypedArray(T.vertices,H);const R=A?$l.getProxy():new Float32Array(3*j);R.setLength&&R.setLength(3*j);const V=Iu(T.vertices,L,R);let q=!0;const G=V.getLength?V.getLength():V.length;for(let t=0;t<G;t++){V[t]=-V[t];const n=V[t]%1;1-Math.abs(n)>1e-6?q=!1:0!==n&&(V[t]=Math.round(V[t]))}if(T.normals=V,A){let t=$l.get();t.setLength(4*j),t=function(t,n,e,r,i){const s=(t.getLength?t.getLength():t.length)/3,o=i||new Array(4*s),a=[],u=[];for(let t=0;t<s;t++)a[t]=[0,0,0],u[t]=[0,0,0];const l=[0,0,0],h=[0,0,0],c=[0,0,0],f=[0,0],d=[0,0],p=[0,0],y=[0,0,0],m=[0,0,0];function g(n,r,i){Ru(l,t,3*n),Ru(h,t,3*r),Ru(c,t,3*i),Vu(f,e,2*n),Vu(d,e,2*r),Vu(p,e,2*i);const s=h[0]-l[0],o=c[0]-l[0],g=h[1]-l[1],v=c[1]-l[1],b=h[2]-l[2],w=c[2]-l[2],M=d[0]-f[0],x=p[0]-f[0],F=d[1]-f[1],k=p[1]-f[1],A=1/(M*k-x*F);yu(y,(k*s-F*o)*A,(k*g-F*v)*A,(k*b-F*w)*A),yu(m,(M*o-x*s)*A,(M*v-x*g)*A,(M*w-x*b)*A),mu(a[n],a[n],y),mu(a[r],a[r],y),mu(a[i],a[i],y),mu(u[n],u[n],m),mu(u[r],u[r],m),mu(u[i],u[i],m)}for(let t=0,n=r.length;t<n;t+=3)g(r[t+0],r[t+1],r[t+2]);const v=[],b=[],w=[],M=[];let x,F,k;function A(t){Ru(w,n,3*t),pu(M,w),F=a[t],pu(v,F),wu(v,v,function(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}(w,w,vu(w,F))),gu(v,v),bu(b,M,F),k=vu(b,u[t]),x=k<0?-1:1,o[4*t]=v[0],o[4*t+1]=v[1],o[4*t+2]=v[2],o[4*t+3]=x}for(let t=0,n=r.length;t<n;t+=3)A(r[t+0]),A(r[t+1]),A(r[t+2]);return o}(T.vertices,T.normals,T.uvs,L,t),t=function(t,n){const e=n.getLength(),r=new Float32Array(e),i=[],s=[],o=[];for(let a=0;a<e;a+=4){const e=a/4*3;dt(s,t[e]||0,t[e+1]||0,t[e+2]||0),gt(i,n[a]||0,n[a+1]||0,n[a+2]||0,n[a+3]||0),Eu(o,s,i),mt(r.subarray(a,a+4),o)}return r}(T.normals,t),T.tangents=t,U.push(t.buffer),delete T.normals}if(T.normals&&(q&&(T.normals=Do.createTypedArray(T.normals,Int8Array)),U.push(T.normals.buffer)),T.uvs){const t=T.uvs;T.uvs=Do.createTypedArray(t,Float32Array),U.push(T.uvs.buffer)}const J=function(t,n,e,r){const i={},s={},o=r.getLength();if(C(n.polygonFill)){let a=b(n.polygonFill);const u=new Uint8Array(4*o);u.fill(255);for(let n=0;n<o;n++){const s=t[r[n]],o=s.properties||{};o.$layer=s.layer,o.$type=s.type;let l=a(e,o);g(l)&&(i.aColor=1,a=b(l),l=a(e,o)),delete o.$layer,delete o.$type,He(zl,l),u[4*n]=zl[0],u[4*n+1]=zl[1],u[4*n+2]=zl[2],u[4*n+3]=zl[3]}s.aColor=u}if(C(n.polygonOpacity)){let a=v(n.polygonOpacity);const u=new Uint8Array(o);u.fill(255);for(let n=0;n<o;n++){const s=t[r[n]],o=s.properties||{};o.$layer=s.layer,o.$type=s.type;let l=a(e,o);g(l)&&(i.aOpacity=1,a=b(l),l=a(e,o)),delete o.$layer,delete o.$type,u[n]=255*l}s.aOpacity=u}return s.dynamicAttributes=i,s}(t,h,c,T.featureIndexes),W=function(t,n,e,r,i){const s=[[],[]],o=C(r.topPolygonFill),a=C(r.bottomPolygonFill),u=[255,255,255,255],l=n.getLength();if(o||a){let h=o&&b(r.topPolygonFill),c=a&&b(r.bottomPolygonFill),f=null,d=null,p=null,y=null;for(let r=0;r<l;r++){if(1===t[r]&&!o||0===t[r]&&!a)continue;const l=1===t[r];if(l&&n[r]===f){t[r]=p;continue}if(!l&&n[r]===d){t[r]=y;continue}const m=e[n[r]],v=m.properties||{};v.$layer=m.layer,v.$type=m.type;let w=l?h:c,M=w(i,v);g(M)&&(w=b(M),M=w(i,v)),delete v.$layer,delete v.$type,He(zl,M),vt(zl,zl,u);let x=Dl(s,zl);x<0&&(x=s.length,s.push(mt([],zl))),t[r]=x,l?(f=n[r],p=x):(d=n[r],y=x)}}return s.slice(2)}(T.verticeTypes,T.featureIndexes,t,h,c),B={data:{data:{aVertexColorType:W.length<=252?Do.createTypedArray(T.verticeTypes,Uint8Array):Do.createTypedArray(T.verticeTypes,Uint16Array),aPosition:T.vertices,aNormal:T.normals,aTexCoord0:T.uvs,aTangent:T.tangents,aPickingId:T.pickingIds},indices:L,properties:{maxAltitude:T.maxAltitude,hasNegativeHeight:T.hasNegativeHeight},dynamicAttributes:J.dynamicAttributes,vertexColors:W},buffers:U};return T.featureIds.length?(B.data.featureIds=T.featureIds,U.push(B.data.featureIds.buffer)):B.data.featureIds=[],J.aColor&&(B.data.data.aColor=J.aColor,B.buffers.push(J.aColor.buffer)),J.aOpacity&&(B.data.data.aOpacity=J.aOpacity,B.buffers.push(J.aOpacity.buffer)),B.buffers.push(B.data.data.aPosition.buffer),B.data.pickingIdIndiceMap=$n(B.data.data.aPickingId,B.data.indices),B}const zl=[];function Dl(t,n){for(let i=0;i<t.length;i++)if(e=n,r=t[i],e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3])return i;var e,r;return-1}function Tl(t,n,e,r,{altitudeScale:i,altitudeProperty:s,defaultAltitude:o,heightProperty:a,minHeightProperty:u,defaultHeight:l,bottom:h}){const c=h,f=n/t[0].extent,d=2*function(t,n){let e=0;for(let n=0,r=t.length;n<r;n++){const r=t[n];if(P(r.geometry[0][0]))e+=3*r.geometry.length;else for(let t=0,n=r.geometry.length;t<n;t++){let n=3*r.geometry[t].length;3===r.type&&(n-=3),e+=n}}return e}(t)+3*t.length*2,p=[],y=new Int16Array(d),m=new Uint8Array(y.length/3*4);g(e)&&(e=wo(e));const v=[];function b(t,e,r){const i=e-t,s=y.subarray(t,e),o=y.subarray(e,e+i);o.set(s);for(let t=2,n=o.length;t<n;t+=3)o[t]=s[t]-r;const a=t/3,u=i/3;let l,h;for(let t=a,e=u+a;t<e;t++)t<e-1?(l=t,h=t+1):(l=t,h=a),ct(y,l,h,n)||(v.push(l,h),c&&v.push(l+u,h+u),Ul(y,l,n)||v.push(l,l+u));return e+i}let w=0,M=0;const x=(Sl+"").trim(),F=[];for(let n=0,h=t.length;n<h;n++){const h=t[n],c=h.geometry;if(e){let t;t="function"==typeof e?e(h&&h.properties):e,He(F,t)}else dt(F,255,255,255);const d=w/3*4,{altitude:g,height:k}=_n(h,i,s,o,a,l,u);M=Math.max(Math.abs(g),M);let A=w;for(let t=0,n=c.length;t<n;t++){let n=c[t];const e=n.length;n[0][0]===n[e-1][0]&&n[0][1]===n[e-1][1]&&(n=n.slice(0,e-1)),w=ht(y,A,n,f,g),w=b(A,w,k*f),A=w}const P=A/3*4;for(let t=d;t<P;t+=4)m[t]=F[0],m[t+1]=F[1],m[t+2]=F[2],m[t+3]=255*(r||1);const S=v.length-p.length;for(let t=0;t<S;t++)p.push(h[x])}const k=new(jn(v.reduce(((t,n)=>Math.max(t,n)),0)))(v),A=Ln(t.length);return{aPosition:new(Nn(Math.max(512,M)))(y),indices:k,aPickingId:new A(p),aColor:m}}function Ul(t,n,e){const r=t[3*n],i=t[3*n+1];return r<0||r>e||i<0||i>e}function jl(t,n,e,r){const i=Tl(t,n,e.lineColor,e.lineOpacity,r),s=[i.aPosition.buffer,i.indices.buffer,i.aPickingId.buffer],o=i.indices;return delete i.indices,{data:{data:i,indices:o},buffers:s}}let Nl=!1;try{const t=new OffscreenCanvas(1,1);t.getContext("2d").fillText("hello",0,0),Nl=!0}catch(t){Nl=!1}var Ll=Nl;const Hl="__original_properties",Rl="__fn-type_properties";class Vl{constructor(t,n,e,r,i){this.id=t,this.options=n,this.upload=e,this.Qt(n.style),this.requests={},this.qt=r,this.tn=1,this.loadings=i}updateStyle(t,n){this.options.style=t,this.tn=t.styleCounter,this.Qt(t),n()}updateOptions(t,n){this.options=k(this.options,t),n()}loadTile(t,n){const e=this.loadings,r=t.tileInfo.url,i=this.options.debugTile;if(i){const{x:e,y:r,z:s}=t.tileInfo;let o=!1;for(let t=0;t<i.length;t++)if(e===i[t].x&&r===i[t].y&&s===i[t].z){o=!0;break}if(!o)return void n()}if(e[r])return void e[r].push({context:t,callback:n,ref:this});e[r]=[{context:t,callback:n,ref:this}];const s=this.options.featureIdProperty;this.requests[r]=this.getTileFeatures(t,((n,i,o,a)=>{const u=e[r];if(delete e[r],this.checkIfCanceled(r))return delete this.requests[r],void this.nn(u,null,{canceled:!0});if(delete this.requests[r],(this.options.debug||s)&&i)for(let n=0;n<i.length;n++)if(this.options.debug&&(i[n]._debug_info={index:n,id:i[n].id,tileId:t.tileInfo.id}),s){const t=_(s)?s[i[n].layer]:s,e=i[n].properties;i[n].id=e&&e[t]||null}if(n)this.nn(u,n);else if(i&&i.length){if(u)for(let t=0;t<u.length;t++)this.en.call(u[t].ref,u[t].context,u[t].callback,r,o,i,a)}else this.nn(u)}))}en(t,n,e,r,i,s){this.rn(r,i,t).then((e=>{e.canceled?n(null,{canceled:!0}):(e.data.styleCounter=t.styleCounter,s&&k(e.data,s),n(null,e.data,e.buffers))})).catch((t=>{n(t)}))}abortTile(t,n){delete this.requests[t],this.sn(t),n()}sn(t){const n=this.loadings[t];if(n)for(let t=0;t<n.length;t++)n[t].callback(null,{canceled:!0});delete this.loadings[t]}nn(t,n,e){if(t)for(let r=0;r<t.length;r++)t[r].callback(n,e)}checkIfCanceled(t){return!this.requests[t]}onRemove(){this.loadings={},delete this.qt,this.requests={}}fetchIconGlyphs(t,n,e){if(this.options.workerGlyph&&Ll){const r=[];if(t&&Object.keys(t).length){const n=new Promise((n=>{this.upload("fetchIconGlyphs",{icons:t},null,((t,e)=>{n({err:t,iconData:e})}))}));r.push(n)}if(n&&Object.keys(n).length){const t=new Promise((t=>{this.an||(this.an=new kl),this.an.getGlyphs(n,((n,e)=>{t({err:n,glyphData:e})}))}));r.push(t)}Promise.all(r).then((t=>{const n={icons:null,glyphs:null};for(let r=0;r<t.length;r++){if(t[r].err)return void e(t[r].err);t[r].iconData?n.icons=t[r].iconData.icons:t[r].glyphData&&(n.glyphs=t[r].glyphData.glyphs)}return n})).then((t=>{e(null,t)}))}else this.upload("fetchIconGlyphs",{icons:t,glyphs:n},null,e)}rn(t,n,e){if(!n.length)return Promise.resolve({data:null,buffers:[]});const{glScale:r,tileInfo:i}=e,s=!this.options.style.style.length&&!this.options.style.featureStyle.length;let o=this.pluginConfig.slice(0);s&&(o=this.un(t)),this.featurePlugins&&function(t){for(let n=1;n<arguments.length;n++){const e=arguments[n];if(e)for(let n=0,r=e.length;n<r;n++)t.push(e[n])}t.length}(o,this.featurePlugins);const a={};for(let t=0;t<o.length;t++)Yl(n,e.tileInfo.z,o[t],a);const u=[],l=[];for(let t=0;t<n.length;t++){const e=n[t],r=a[t];if(r){l.fill(null);let t=0;for(const n in r){let i=0;const s=r[n].values();for(const t of s){let r=l[i];r||(r=th(e),l[i]=r),r.properties[n]=t,i++}i>t&&(t=i)}for(let n=0;n<t;n++)u.push(l[n])}else u.push(e)}const h=(n=u)[0].extent,c=i.z,f={x:i.extent2d.xmin*r,y:i.extent2d.ymax*r},d=[],p=[],y=[],m=this.options,g=[],v={},b=[Promise.resolve(e.styleCounter)];let w=0,M=-1;const x=[];let F=!1;for(let t=0;t<o.length;t++){M++;const r=o[t];r.type!==w&&(M=0,w=r.type);const a=0===r.type?d:p;if(r.symbol&&!1===r.symbol.visible){a[M]=null;continue}rh(r.symbol,x,t),F=F||x[t]&&x[t].size>0;const{tileFeatures:u,tileFeaIndexes:l}=this.hn(c,r.type,r.filter,n,v,t);if(!u.length){a[M]=null;continue}const m=jn(l[l.length-1]);a[M]={styledFeatures:new m(l)},y.push({idx:t,typeIdx:M}),g.push(a[M].styledFeatures.buffer);const A=k({},e,{extent:h,zoom:c,tilePoint:f});if(this.options.debugTile){const t=this.options.debugTile;for(let n=0;n<t.length;n++){const{x:e,y:r,z:s}=t[n];if(i.x===e&&i.y===r&&i.z===s){A.debugIndex=t[n].index;break}}}let P=this.cn(u,r,A);s&&(P=P.then((t=>{if(!t)return null;if(t.data)t.data.layer=u[0].layer;else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]&&t[n].data&&(t[n].data.layer=u[0].layer);return t}))),b.push(P)}return Promise.all(b).then((([e,...r])=>{if(e!==this.tn)return{canceled:!0};function i(t,n){if(void 0===t.data.ref&&(t.data.type=o[y[n].idx].renderPlugin.dataConfig.type,t.data.filter=o[y[n].idx].filter.def,t.buffers&&t.buffers.length))for(let n=0;n<t.buffers.length;n++)g.push(t.buffers[n])}for(let t=0;t<r.length;t++){if(!r[t])continue;const n=r[t],e=0===o[y[t].idx].type?d:p;if(Array.isArray(n)){const r=[];for(let e=0;e<n.length;e++)n[e]&&(i(n[e],t),(void 0===n[e].data.ref||n[n[e].data.ref])&&r.push(n[e].data));r.length&&(e[y[t].typeIdx].data=r)}else i(n,t),e[y[t].typeIdx].data=n.data}const s={},a=t;if(m.features||m.schema||F){let t,e=!1;for(let r=0,i=n.length;r<i;r++)if(t=n[r],a[t.layer].properties||(a[t.layer].properties=Jl(t.properties)),t&&(m.features||F&&v[r]))if("id"===m.features)s[r]=t.id;else{m.pickingGeometry||delete t.geometry,delete t.extent,delete t.properties.$layer,delete t.properties.$type,delete t.__index;const n=t.originalFeature;if(n){const n=t.properties,e=k({},t.originalFeature);delete n[Hl],e.customProps=k({},n),t=e}const i=k({},t);if(F&&v[r]&&(!m.features||"transient"===m.features)){const i=v[r];for(let r=0;r<i.length;r++){const i=x[r];i&&i.forEach((r=>{const i=n?n.properties:t.properties;i[Rl]||(i[Rl]=new Set),i[Rl].add(r),e=!0}))}}s[r]=i}if(e)for(const t in s){const n=s[t],e=n.properties[Rl];if(e){delete n.properties[Rl],"transient"===m.features&&(n.fnTypeProps=k({},n.properties));for(const t in n.properties)e.has(t)||("transient"===m.features?delete n.fnTypeProps[t]:delete n.properties[t])}}}return{data:{styleCounter:e,schema:a,data:d,featureData:p,extent:h,features:s},buffers:g}})).catch((t=>{console.error(t)}))}cn(t,n,e){let r=t;const i=n.renderPlugin.dataConfig,s=n.symbol,o=this.options.tileSize,{extent:a,glScale:u,zScale:l,zoom:h,tilePoint:c,centimeterToPoint:f,verticalCentimeterToPoint:d}=e,p=a/o,y=i.type,m=e.debugIndex;let g=k({},i,{EXTENT:a,zoom:h,debugIndex:m,features:this.options.features});if("3d-extrusion"===y){Wl(s)&&(i.uv=1);const t=this.options.projectionCode,n=s.material&&s.material.textureWidth||23.25;return Promise.all([Promise.resolve(Il(r,i,a,c,n,e.tileInfo.res,u,a/this.options.tileSize,f,d,s,h,t,m))])}if("3d-wireframe"===y)return Promise.all([Promise.resolve(jl(r,a,s,i))]);if("point"===y){g=k(g,{requestor:this.fetchIconGlyphs.bind(this),altitudeToTileScale:l*a/this.options.tileSize/u});const t=Xa.splitPointSymbol(s),n=Go.genFnTypes(t[0]);return Xa.needMerge(t[0],n,h)&&(r=Xa.mergeLineFeatures(r,t[0],n,h)),Promise.all(t.map(((t,e)=>(0===e?g.fnTypes=n:delete g.fnTypes,new Xa(r,t,g).load(p)))))}if("native-point"===y){const t=l*a/this.options.tileSize/u;return g.altitudeToTileScale=t,Bl(r,s,g,Bu,a/o)}if("line"===y)return g=k(g,{requestor:this.fetchIconGlyphs.bind(this),tileRatio:p}),Bl(r,s,g,ru,1,!0);if("native-line"===y)return Bl(r,s,g,Ju,1,!0);if("fill"===y)return g=k(g,{requestor:this.fetchIconGlyphs.bind(this)}),Bl(r,s,g,el);if("line-extrusion"===y){delete s.lineGradientProperty,s.lineJoin="miter",s.lineCap="butt";const t=Wl(s);if(t&&(i.uv=1),g=k(g,{tileSize:o,zScale:l,glScale:u}),s.mergeOnProperty){const t=Go.genFnTypes(s);r=ru.mergeLineFeatures(r,s,t,g.zoom)}if(t){const t=[];if(!1!==i.top){const n=k({},g);n.side=!1,t.push(new qu(r,s,n))}return!1!==i.side&&(g.side=!0,g.top=!1,t.push(new qu(r,s,g))),Promise.all(t.map((t=>t.load())))}return Promise.all([new qu(r,s,g).load()])}if("circle"===y)return Bl(r,s,g,il);if("round-tube"===y||"square-tube"===y){const t="round-tube"===y?sl:cl;return g=k(g,{requestor:this.fetchIconGlyphs.bind(this),radialSegments:"round-tube"===y?i.radialSegments||8:4,centimeterToPoint:f,verticalCentimeterToPoint:d,tileRatio:p,isTube:!0}),Bl(r,s,g,t)}return Promise.resolve([])}hn(t,n,e,r,i,s){const o=(Sl+"").trim(),a=[],u=[],l=r.length;for(let h=0;h<l;h++)if((1===n||void 0===r[h].id||!this.styledFeatures[r[h].id])&&((!e.def||"default"===e.def)&&!i[h]||!0===e.def||e.def&&(void 0!==e.def.condition||Array.isArray(e.def))&&e(r[h],t))){const t=r[h];if(void 0===t[o]&&(t[o]=h),i[h]||(i[h]=[]),i[h].push(s),u.push(t),a.push(h),1===n)break}return{tileFeatures:u,tileFeaIndexes:a}}Qt(t){const{style:n,featureStyle:e}=t,r={};e.forEach((t=>{Array.isArray(t.id)?(t.id.forEach((t=>{r[t]=1})),t.filter=["in","$id",...t.id]):(r[t.id]=1,t.filter=["==","$id",t.id])}));const i=go(n);for(let t=0;t<n.length;t++)i[t].filter&&(i[t].filter.def=n[t].filter?n[t].filter.value||n[t].filter:void 0),i[t].type=0;const s=[],o=go(e);for(let t=0;t<e.length;t++)o[t].type=1,o[t].filter.def=e[t].filter?e[t].filter.value||e[t].filter:void 0,o[t].renderPlugin&&s.push(o[t]);this.pluginConfig=i,this.featurePlugins=s,this.styledFeatures=r}un(t){let n=this.dn;this.dn||(n=this.dn={});const e=["","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"],r=[];for(const i in t){const s=i;if(!n[i]){const r=[];for(let n=0;n<t[i].types.length;n++){const o=t[i].types[n],a=["all",["==","$layer",s],["==","$type",e[o]]],u={filter:Je(a),renderPlugin:ql(o),symbol:Gl(o)};u.filter.def=a,u.type=0,r.push(u)}n[s]=r}r.push(...n[s])}return r}}function ql(t){switch(t){case 1:return{type:"native-point",dataConfig:{type:"native-point",only2D:!0}};case 2:return{type:"native-line",dataConfig:{type:"native-line",only2D:!0}};case 3:return{type:"fill",dataConfig:{type:"fill",only2D:!0}}}return null}function Gl(t){switch(t){case 1:return{markerFill:"#f00",markerSize:10};case 2:return{lineColor:"#fff"};case 3:return{polygonFill:"#00f",polygonOpacity:.4}}return null}function Jl(t){if(Array.isArray(t)||!_(t))return{};const n={};for(const e in t){const r=t[e];A(r)?n[e]="string":P(r)?n[e]="number":!0===r||!1===r?n[e]="boolean":Array.isArray(r)?n[e]="array":n[e]="object"}return n}function Wl(t){if(!t)return 0;let n=0;for(const e in t){if(("normalTexture"===e||"bumpTexture"===e)&&t[e])return 2;if(e.indexOf("Texture")>0&&t[e])n=1;else if(_(t[e])){const r=Wl(t[e]);if(2===r)return r;1===r&&(n=1)}}return n}function Bl(t,n,e,r,i,s){const o={},a=Array.isArray(n)?n:[n];let u=-1;for(let t=0;t<a.length;t++)o[t]=Xl(a[t]),!o[t]&&a[t]&&-1===u&&(u=t);const l=[];for(let n=0;n<a.length;n++){if(!a[n])continue;a[n].index={index:n};let h=t;if(s&&a[n].mergeOnProperty){const r=Go.genFnTypes(a[n]);h=ru.mergeLineFeatures(t,a[0],r,e.zoom)}o[n]||n===u?l.push(new r(h,a[n],e).load(i)):l.push({data:{ref:u,symbolIndex:{index:n}}})}return Promise.all(l)}function Xl(t){if(!t)return 0;for(const n in t)if(C(t[n]))return 1;return 0}function Yl(t,n,e,r){const i=e.customProperties;if(!i)return t;if(i)for(let t=0;t<i.length;t++)i[t].fn=wo(i[t].filter);for(let e=0;e<i.length;e++)for(let s=0,o=t.length;s<o;s++)if(i[e].fn(t[s],n))for(const t in i[e].properties){const n=i[e].properties[t];O(n)||(r[s]||(r[s]={}),r[s][t]||(r[s][t]=new Set),r[s][t].add(n))}}const Kl={get:(t,n)=>n in t?t[n]:t.originalFeature[n],has:(t,n)=>n in t||n in t.originalFeature},Zl={get:function(t,n){return n in t?t[n]:t[Hl][n]},has:(t,n)=>n in t||n in t[Hl]},Ql={};function th(t){const n={};n.originalFeature=t;const e=new Proxy(n,Kl);return e.properties=new Proxy({},Zl),e.properties[Hl]=t.properties||Ql,e}function nh(t,n,e){t[n]||(t[n]=new Set),t[n].add(e)}const eh=[];function rh(t,n,e){if(!t)return eh;for(const i in t){if(!t[i]||!Re[r=i]&&!Ve[r])continue;if(C(t[i]))nh(n,e,t[i].property);else{if("lineGradientProperty"===i){nh(n,e,t[i]);continue}if("textName"===i)if(A(t[i])){const r=t[i].match(Qo);if(r)for(let t=0;t<r.length;t++)nh(n,e,r[t])}else if(Fo(t[i])){const r=[];na(r,t[i]);for(let t=0;t<r.length;t++)nh(n,e,r[t])}}const s=t[i].stops;if(s&&s.length)for(let t=0;t<s.length;t++)C(s[t][1])&&nh(n,t,s[t][1].property)}var r;return n[e]}function ih(t,n){sh(t.geometry,n)}function sh(t,n){if(t)switch(t.type){case"Point":oh(t.coordinates,n);break;case"MultiPoint":case"LineString":ah(t.coordinates,n);break;case"MultiLineString":!function(t,n){for(let e=0,r=t.length;e<r;e++)ah(t[e],n)}(t.coordinates,n);break;case"Polygon":uh(t.coordinates,n);break;case"MultiPolygon":!function(t,n){for(let e=0,r=t.length;e<r;e++)uh(t[e],n)}(t.coordinates,n);break;case"GeometryCollection":const e=t.geometries.length;for(let r=0;r<e;r++)sh(t.geometries[r],n)}}function oh(t,n){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function ah(t,n){for(let e=0,r=t.length;e<r;e++)oh(t[e],n)}function uh(t,n){t.length&&ah(t[0],n)}function lh(t,n,e,r,i){hh(t,n,e||0,r||t.length-1,i||fh)}function hh(t,n,e,r,i){for(;r>e;){if(r-e>600){var s=r-e+1,o=n-e+1,a=Math.log(s),u=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*u*(s-u)/s)*(o-s/2<0?-1:1);hh(t,n,Math.max(e,Math.floor(n-o*u/s+l)),Math.min(r,Math.floor(n+(s-o)*u/s+l)),i)}var h=t[n],c=e,f=r;for(ch(t,e,n),i(t[r],h)>0&&ch(t,e,r);c<f;){for(ch(t,c,f),c++,f--;i(t[c],h)<0;)c++;for(;i(t[f],h)>0;)f--}0===i(t[e],h)?ch(t,e,f):ch(t,++f,r),f<=n&&(e=f+1),n<=f&&(r=f-1)}}function ch(t,n,e){var r=t[n];t[n]=t[e],t[e]=r}function fh(t,n){return t<n?-1:t>n?1:0}class dh{constructor(t=9){this.pn=Math.max(4,t),this.yn=Math.max(2,Math.ceil(.4*this.pn)),this.clear()}all(){return this.mn(this.data,[])}search(t){let n=this.data;const e=[];if(!kh(t,n))return e;const r=this.toBBox,i=[];for(;n;){for(let s=0;s<n.children.length;s++){const o=n.children[s],a=n.leaf?r(o):o;kh(t,a)&&(n.leaf?e.push(o):Fh(t,a)?this.mn(o,e):i.push(o))}n=i.pop()}return e}collides(t){let n=this.data;if(!kh(t,n))return!1;const e=[];for(;n;){for(let r=0;r<n.children.length;r++){const i=n.children[r],s=n.leaf?this.toBBox(i):i;if(kh(t,s)){if(n.leaf||Fh(t,s))return!0;e.push(i)}}n=e.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this.yn){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let n=this.gn(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this.vn(this.data,n);else{if(this.data.height<n.height){const t=this.data;this.data=n,n=t}this.bn(n,this.data.height-n.height-1,!0)}else this.data=n;return this}insert(t){return t&&this.bn(t,this.data.height-1),this}clear(){return this.data=Ah([]),this}remove(t,n){if(!t)return this;let e=this.data;const r=this.toBBox(t),i=[],s=[];let o,a,u;for(;e||i.length;){if(e||(e=i.pop(),a=i[i.length-1],o=s.pop(),u=!0),e.leaf){const r=ph(t,e.children,n);if(-1!==r)return e.children.splice(r,1),i.push(e),this.wn(i),this}u||e.leaf||!Fh(e,r)?a?(o++,e=a.children[o],u=!1):e=null:(i.push(e),s.push(o),o=0,a=e,e=e.children[0])}return this}toBBox(t){return t}compareMinX(t,n){return t.minX-n.minX}compareMinY(t,n){return t.minY-n.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}mn(t,n){const e=[];for(;t;)t.leaf?n.push(...t.children):e.push(...t.children),t=e.pop();return n}gn(t,n,e,r){const i=e-n+1;let s,o=this.pn;if(i<=o)return s=Ah(t.slice(n,e+1)),yh(s,this.toBBox),s;r||(r=Math.ceil(Math.log(i)/Math.log(o)),o=Math.ceil(i/Math.pow(o,r-1))),s=Ah([]),s.leaf=!1,s.height=r;const a=Math.ceil(i/o),u=a*Math.ceil(Math.sqrt(o));Ph(t,n,e,u,this.compareMinX);for(let i=n;i<=e;i+=u){const n=Math.min(i+u-1,e);Ph(t,i,n,a,this.compareMinY);for(let e=i;e<=n;e+=a){const i=Math.min(e+a-1,n);s.children.push(this.gn(t,e,i,r-1))}}return yh(s,this.toBBox),s}Mn(t,n,e,r){for(;r.push(n),!n.leaf&&r.length-1!==e;){let e,r=1/0,o=1/0;for(let a=0;a<n.children.length;a++){const u=n.children[a],l=wh(u),h=(i=t,s=u,(Math.max(s.maxX,i.maxX)-Math.min(s.minX,i.minX))*(Math.max(s.maxY,i.maxY)-Math.min(s.minY,i.minY))-l);h<o?(o=h,r=l<r?l:r,e=u):h===o&&l<r&&(r=l,e=u)}n=e||n.children[0]}var i,s;return n}bn(t,n,e){const r=e?t:this.toBBox(t),i=[],s=this.Mn(r,this.data,n,i);for(s.children.push(t),gh(s,r);n>=0&&i[n].children.length>this.pn;)this.xn(i,n),n--;this.Fn(r,i,n)}xn(t,n){const e=t[n],r=e.children.length,i=this.yn;this.kn(e,i,r);const s=this.An(e,i,r),o=Ah(e.children.splice(s,e.children.length-s));o.height=e.height,o.leaf=e.leaf,yh(e,this.toBBox),yh(o,this.toBBox),n?t[n-1].children.push(o):this.vn(e,o)}vn(t,n){this.data=Ah([t,n]),this.data.height=t.height+1,this.data.leaf=!1,yh(this.data,this.toBBox)}An(t,n,e){let r,i=1/0,s=1/0;for(let o=n;o<=e-n;o++){const n=mh(t,0,o,this.toBBox),a=mh(t,o,e,this.toBBox),u=xh(n,a),l=wh(n)+wh(a);u<i?(i=u,r=o,s=l<s?l:s):u===i&&l<s&&(s=l,r=o)}return r||e-n}kn(t,n,e){const r=t.leaf?this.compareMinX:vh,i=t.leaf?this.compareMinY:bh;this.Pn(t,n,e,r)<this.Pn(t,n,e,i)&&t.children.sort(r)}Pn(t,n,e,r){t.children.sort(r);const i=this.toBBox,s=mh(t,0,n,i),o=mh(t,e-n,e,i);let a=Mh(s)+Mh(o);for(let r=n;r<e-n;r++){const n=t.children[r];gh(s,t.leaf?i(n):n),a+=Mh(s)}for(let r=e-n-1;r>=n;r--){const n=t.children[r];gh(o,t.leaf?i(n):n),a+=Mh(o)}return a}Fn(t,n,e){for(let r=e;r>=0;r--)gh(n[r],t)}wn(t){for(let n,e=t.length-1;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():yh(t[e],this.toBBox)}}function ph(t,n,e){if(!e)return n.indexOf(t);for(let r=0;r<n.length;r++)if(e(t,n[r]))return r;return-1}function yh(t,n){mh(t,0,t.children.length,n,t)}function mh(t,n,e,r,i){i||(i=Ah(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=n;s<e;s++){const n=t.children[s];gh(i,t.leaf?r(n):n)}return i}function gh(t,n){return t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),t}function vh(t,n){return t.minX-n.minX}function bh(t,n){return t.minY-n.minY}function wh(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Mh(t){return t.maxX-t.minX+(t.maxY-t.minY)}function xh(t,n){const e=Math.max(t.minX,n.minX),r=Math.max(t.minY,n.minY),i=Math.min(t.maxX,n.maxX),s=Math.min(t.maxY,n.maxY);return Math.max(0,i-e)*Math.max(0,s-r)}function Fh(t,n){return t.minX<=n.minX&&t.minY<=n.minY&&n.maxX<=t.maxX&&n.maxY<=t.maxY}function kh(t,n){return n.minX<=t.maxX&&n.minY<=t.maxY&&n.maxX>=t.minX&&n.maxY>=t.minY}function Ah(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function Ph(t,n,e,r,i){const s=[n,e];for(;s.length;){if((e=s.pop())-(n=s.pop())<=r)continue;const o=n+Math.ceil((e-n)/r/2)*r;lh(t,o,n,e,i),s.push(n,o,o,e)}}var Sh={exports:{}},_h=function(t,n,e,r){var i=t[0],s=t[1],o=!1;void 0===e&&(e=0),void 0===r&&(r=n.length);for(var a=(r-e)/2,u=0,l=a-1;u<a;l=u++){var h=n[e+2*u+0],c=n[e+2*u+1],f=n[e+2*l+0],d=n[e+2*l+1];c>s!=d>s&&i<(f-h)*(s-c)/(d-c)+h&&(o=!o)}return o},Oh=function(t,n,e,r){var i=t[0],s=t[1],o=!1;void 0===e&&(e=0),void 0===r&&(r=n.length);for(var a=r-e,u=0,l=a-1;u<a;l=u++){var h=n[u+e][0],c=n[u+e][1],f=n[l+e][0],d=n[l+e][1];c>s!=d>s&&i<(f-h)*(s-c)/(d-c)+h&&(o=!o)}return o};Sh.exports=function(t,n,e,r){return n.length>0&&Array.isArray(n[0])?Oh(t,n,e,r):_h(t,n,e,r)};var Ch=Sh.exports.nested=Oh;Sh.exports.flat=_h;const Eh=11102230246251565e-32,$h=134217729,Ih=(3+8*Eh)*Eh;function zh(t,n,e,r,i){let s,o,a,u,l=n[0],h=r[0],c=0,f=0;h>l==h>-l?(s=l,l=n[++c]):(s=h,h=r[++f]);let d=0;if(c<t&&f<e)for(h>l==h>-l?(o=l+s,a=s-(o-l),l=n[++c]):(o=h+s,a=s-(o-h),h=r[++f]),s=o,0!==a&&(i[d++]=a);c<t&&f<e;)h>l==h>-l?(o=s+l,u=o-s,a=s-(o-u)+(l-u),l=n[++c]):(o=s+h,u=o-s,a=s-(o-u)+(h-u),h=r[++f]),s=o,0!==a&&(i[d++]=a);for(;c<t;)o=s+l,u=o-s,a=s-(o-u)+(l-u),l=n[++c],s=o,0!==a&&(i[d++]=a);for(;f<e;)o=s+h,u=o-s,a=s-(o-u)+(h-u),h=r[++f],s=o,0!==a&&(i[d++]=a);return 0===s&&0!==d||(i[d++]=s),d}function Dh(t){return new Float64Array(t)}const Th=33306690738754716e-32,Uh=22204460492503146e-32,jh=11093356479670487e-47,Nh=Dh(4),Lh=Dh(8),Hh=Dh(12),Rh=Dh(16),Vh=Dh(4);function qh(t,n,e,r,i,s){const o=(n-s)*(e-i),a=(t-i)*(r-s),u=o-a;if(0===o||0===a||o>0!=a>0)return u;const l=Math.abs(o+a);return Math.abs(u)>=Th*l?u:-function(t,n,e,r,i,s,o){let a,u,l,h,c,f,d,p,y,m,g,v,b,w,M,x,F,k;const A=t-i,P=e-i,S=n-s,_=r-s;w=A*_,f=$h*A,d=f-(f-A),p=A-d,f=$h*_,y=f-(f-_),m=_-y,M=p*m-(w-d*y-p*y-d*m),x=S*P,f=$h*S,d=f-(f-S),p=S-d,f=$h*P,y=f-(f-P),m=P-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Nh[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Nh[1]=b-(g+c)+(c-x),k=v+g,c=k-v,Nh[2]=v-(k-c)+(g-c),Nh[3]=k;let O=function(t,n){let e=n[0];for(let r=1;r<t;r++)e+=n[r];return e}(4,Nh),C=Uh*o;if(O>=C||-O>=C)return O;if(c=t-A,a=t-(A+c)+(c-i),c=e-P,l=e-(P+c)+(c-i),c=n-S,u=n-(S+c)+(c-s),c=r-_,h=r-(_+c)+(c-s),0===a&&0===u&&0===l&&0===h)return O;if(C=jh*o+Ih*Math.abs(O),O+=A*h+_*a-(S*l+P*u),O>=C||-O>=C)return O;w=a*_,f=$h*a,d=f-(f-a),p=a-d,f=$h*_,y=f-(f-_),m=_-y,M=p*m-(w-d*y-p*y-d*m),x=u*P,f=$h*u,d=f-(f-u),p=u-d,f=$h*P,y=f-(f-P),m=P-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Vh[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Vh[1]=b-(g+c)+(c-x),k=v+g,c=k-v,Vh[2]=v-(k-c)+(g-c),Vh[3]=k;const E=zh(4,Nh,4,Vh,Lh);w=A*h,f=$h*A,d=f-(f-A),p=A-d,f=$h*h,y=f-(f-h),m=h-y,M=p*m-(w-d*y-p*y-d*m),x=S*l,f=$h*S,d=f-(f-S),p=S-d,f=$h*l,y=f-(f-l),m=l-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Vh[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Vh[1]=b-(g+c)+(c-x),k=v+g,c=k-v,Vh[2]=v-(k-c)+(g-c),Vh[3]=k;const $=zh(E,Lh,4,Vh,Hh);w=a*h,f=$h*a,d=f-(f-a),p=a-d,f=$h*h,y=f-(f-h),m=h-y,M=p*m-(w-d*y-p*y-d*m),x=u*l,f=$h*u,d=f-(f-u),p=u-d,f=$h*l,y=f-(f-l),m=l-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Vh[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Vh[1]=b-(g+c)+(c-x),k=v+g,c=k-v,Vh[2]=v-(k-c)+(g-c),Vh[3]=k;const I=zh($,Hh,4,Vh,Rh);return Rh[I-1]}(t,n,e,r,i,s,l)}function Gh(t,n,e){n=Math.max(0,void 0===n?2:n),e=e||0;var r=function(t){for(var n=t[0],e=t[0],r=t[0],i=t[0],s=0;s<t.length;s++){var o=t[s];o[0]<n[0]&&(n=o),o[0]>r[0]&&(r=o),o[1]<e[1]&&(e=o),o[1]>i[1]&&(i=o)}var a=[n,e,r,i],u=a.slice();for(s=0;s<t.length;s++)Ch(t[s],a)||u.push(t[s]);return function(t){t.sort(rc);for(var n=[],e=0;e<t.length;e++){for(;n.length>=2&&Kh(n[n.length-2],n[n.length-1],t[e])<=0;)n.pop();n.push(t[e])}for(var r=[],i=t.length-1;i>=0;i--){for(;r.length>=2&&Kh(r[r.length-2],r[r.length-1],t[i])<=0;)r.pop();r.push(t[i])}return r.pop(),n.pop(),n.concat(r)}(u)}(t),i=new dh(16);i.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},i.compareMinX=function(t,n){return t[0]-n[0]},i.compareMinY=function(t,n){return t[1]-n[1]},i.load(t);for(var s,o=[],a=0;a<r.length;a++){var u=r[a];i.remove(u),s=Qh(u,s),o.push(s)}var l=new dh(16);for(a=0;a<o.length;a++)l.insert(Zh(o[a]));for(var h=n*n,c=e*e;o.length;){var f=o.shift(),d=f.p,p=f.next.p,y=tc(d,p);if(!(y<c)){var m=y/h;(u=Jh(i,f.prev.p,d,p,f.next.next.p,m,l))&&Math.min(tc(u,d),tc(u,p))<=m&&(o.push(f),o.push(Qh(u,f)),i.remove(u),l.remove(f),l.insert(Zh(f)),l.insert(Zh(f.next)))}}f=s;var g=[];do{g.push(f.p),f=f.next}while(f!==s);return g.push(f.p),g}function Jh(t,n,e,r,i,s,o){for(var a=new Ta([],Wh),u=t.data;u;){for(var l=0;l<u.children.length;l++){var h=u.children[l],c=u.leaf?nc(h,e,r):Bh(e,r,h);c>s||a.push({node:h,dist:c})}for(;a.length&&!a.peek().node.children;){var f=a.pop(),d=f.node,p=nc(d,n,e),y=nc(d,r,i);if(f.dist<p&&f.dist<y&&Yh(e,d,o)&&Yh(r,d,o))return d}(u=a.pop())&&(u=u.node)}return null}function Wh(t,n){return t.dist-n.dist}function Bh(t,n,e){if(Xh(t,e)||Xh(n,e))return 0;var r=ec(t[0],t[1],n[0],n[1],e.minX,e.minY,e.maxX,e.minY);if(0===r)return 0;var i=ec(t[0],t[1],n[0],n[1],e.minX,e.minY,e.minX,e.maxY);if(0===i)return 0;var s=ec(t[0],t[1],n[0],n[1],e.maxX,e.minY,e.maxX,e.maxY);if(0===s)return 0;var o=ec(t[0],t[1],n[0],n[1],e.minX,e.maxY,e.maxX,e.maxY);return 0===o?0:Math.min(r,i,s,o)}function Xh(t,n){return t[0]>=n.minX&&t[0]<=n.maxX&&t[1]>=n.minY&&t[1]<=n.maxY}function Yh(t,n,e){for(var r,i,s,o,a=Math.min(t[0],n[0]),u=Math.min(t[1],n[1]),l=Math.max(t[0],n[0]),h=Math.max(t[1],n[1]),c=e.search({minX:a,minY:u,maxX:l,maxY:h}),f=0;f<c.length;f++)if(r=c[f].p,i=c[f].next.p,s=t,r!==(o=n)&&i!==s&&Kh(r,i,s)>0!=Kh(r,i,o)>0&&Kh(s,o,r)>0!=Kh(s,o,i)>0)return!1;return!0}function Kh(t,n,e){return qh(t[0],t[1],n[0],n[1],e[0],e[1])}function Zh(t){var n=t.p,e=t.next.p;return t.minX=Math.min(n[0],e[0]),t.minY=Math.min(n[1],e[1]),t.maxX=Math.max(n[0],e[0]),t.maxY=Math.max(n[1],e[1]),t}function Qh(t,n){var e={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function tc(t,n){var e=t[0]-n[0],r=t[1]-n[1];return e*e+r*r}function nc(t,n,e){var r=n[0],i=n[1],s=e[0]-r,o=e[1]-i;if(0!==s||0!==o){var a=((t[0]-r)*s+(t[1]-i)*o)/(s*s+o*o);a>1?(r=e[0],i=e[1]):a>0&&(r+=s*a,i+=o*a)}return(s=t[0]-r)*s+(o=t[1]-i)*o}function ec(t,n,e,r,i,s,o,a){var u,l,h,c,f=e-t,d=r-n,p=o-i,y=a-s,m=t-i,g=n-s,v=f*f+d*d,b=f*p+d*y,w=p*p+y*y,M=f*m+d*g,x=p*m+y*g,F=v*w-b*b,k=F,A=F;0===F?(l=0,k=1,c=x,A=w):(c=v*x-b*M,(l=b*x-w*M)<0?(l=0,c=x,A=w):l>k&&(l=k,c=x+b,A=w)),c<0?(c=0,-M<0?l=0:-M>v?l=k:(l=-M,k=v)):c>A&&(c=A,-M+b<0?l=0:-M+b>v?l=k:(l=-M+b,k=v));var P=(1-(h=0===c?0:c/A))*i+h*o-((1-(u=0===l?0:l/k))*t+u*e),S=(1-h)*s+h*a-((1-u)*n+u*r);return P*P+S*S}function rc(t,n){return t[0]===n[0]?t[1]-n[1]:t[0]-n[0]}class ic{constructor(t,n){this.x=t,this.y=n}clone(){return new ic(this.x,this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}negate(){this.x=-this.x,this.y=-this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}diff(t){return new ic(this.x-t.x,this.y-t.y)}distance(t){const n=this.x-t.x,e=this.y-t.y;return Math.sqrt(n*n+e*e)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}orthogonal(){return new ic(this.y,-this.x)}}function sc(t,n,e,r){const i=n.x*r.y-n.y*r.x,s=e.x-t.x,o=e.y-t.y,a=(s*r.y-o*r.x)/i;return new ic(t.x+a*n.x,t.y+a*n.y)}const oc=[],ac=[];function uc(t){if(P(t[0]&&t[0].x)){const n=[];let e=0;for(let r=0;r<t.length;r++)ac[e]?(ac[e][0]=t[r].x,ac[e][1]=t[r].y):ac[e]=[t[r].x,t[r].y],n.push(ac[e]),e++;t=n}try{const n=Gh(t,1/0);let e=[1/0,1/0],r=[-1/0,-1/0];for(let t=0;t<n.length;t++)n[t][0]<e[0]&&(e[0]=n[t][0]),n[t][0]>r[0]&&(r[0]=n[t][0]),n[t][1]<e[1]&&(e[1]=n[t][1]),n[t][1]>r[1]&&(r[1]=n[t][1]);const i=[];let s=[],o=0;for(let t=0;t<n.length;t++)t===n.length-1&&n[t][0]===n[0][0]&&n[t][1]===n[0][1]||(Pt(i,n[t],"EPSG:3857"),oc[o]?(oc[o].x=i[0],oc[o].y=i[1]):oc[o]=new ic(i[0],i[1]),s.push(oc[o]),o++);An(s)<0&&(s=s.reverse());const a=function(t){let n,e=Number.MAX_VALUE;const r=function(t,r,i,s,o,a,u,l){var h=sc(t,r,o,a),c=sc(i,s,o,a),f=sc(u,l,t,r),d=sc(u,l,i,s),p=h.distance(c)*h.distance(f);0!==p&&p<e&&(n=[h,f,d,c],e=p)};var i=[];for(let n=0;n<t.length;n++)i.push(t[(n+1)%t.length].diff(t[n])),i[n].normalize();var s,o,a,u,l=new ic(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),h=new ic(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let n=0;n<t.length;n++){var c=t[n];c.x<l.x&&(l.x=c.x,s=n),c.x>h.x&&(h.x=c.x,o=n),c.y<l.y&&(l.y=c.y,u=n),c.y>h.y&&(h.y=c.y,a=n)}var f=new ic(0,-1),d=new ic(0,1),p=new ic(-1,0),y=new ic(1,0);for(let n=0;n<t.length;n++){var m=[Math.acos(f.dot(i[s])),Math.acos(d.dot(i[o])),Math.acos(p.dot(i[a])),Math.acos(y.dot(i[u]))];switch(m.indexOf(Math.min.apply(Math,m))){case 0:(d=(f=i[s].clone()).clone()).negate(),(y=(p=f.orthogonal()).clone()).negate(),s=(s+1)%t.length;break;case 1:(f=(d=i[o].clone()).clone()).negate(),(y=(p=f.orthogonal()).clone()).negate(),o=(o+1)%t.length;break;case 2:(y=(p=i[a].clone()).clone()).negate(),(d=(f=y.orthogonal()).clone()).negate(),a=(a+1)%t.length;break;case 3:(p=(y=i[u].clone()).clone()).negate(),(d=(f=y.orthogonal()).clone()).negate(),u=(u+1)%t.length}r(t[s],f,t[o],d,t[a],p,t[u],y)}return n}(s);if(!a||4!==a.length)return null;const u=a[0].distance(a[1]),l=a[1].distance(a[2]),h=a.map((t=>[t.x,t.y]));return h.push(+(l>u)),h}catch(t){return null}}const lc=[];function hc(t,n){const e=Array.isArray(t&&t[0]&&t[0][0]);for(let r=0;r<t.length;r++)e?t[r]=hc(t[r]):(Pt(lc,t[r],n),t[r][0]=lc[0],t[r][1]=lc[1]);return t}class cc extends Vl{constructor(t,n,e,r,i,s){super(t,n,e,r,i),(n=n||{}).extent||(n.extent=8192),this.setData(n.data,s)}setData(t,n){if(delete this.index,function(t){if(!t)return!0;if(Array.isArray(t)&&!t.length)return!0;if(t.features&&!t.features.length)return!0;return!1}(t))return this.empty=!0,void n();const e={maxZoom:24,tolerance:this.options.simplifyTolerance,extent:this.options.extent,buffer:P(this.options.tileBuffer)?this.options.tileBuffer:64,hasAltitude:!!this.options.hasAltitude,debug:0,lineMetrics:!0,indexMaxZoom:5,indexMaxPoints:1e5,disableFilter:!0};if(this.options.projection&&(e.projection=this.options.projection,"EPSG:4490"===e.projection&&(e.projection="EPSG:4326")),A(t)&&"{"!=t.substring(0,1)||t.url){const r=t.url?t.url:t;$.getJSON(r,t.url?t:{},((t,i)=>{if(t&&(console.error("Failed to fetch geojson:"+r),n(t)),!i)return void n(null,{extent:null,idMap:{}});let s=i;if(this.options.convertFn){s=new Function("data",this.options.convertFn+"\\nreturn convert(data)")(s)}const o=Array.isArray(s)?s:s.features;this.Sn(o);const{sample1000:a,idMap:u}=this._n(o);this.On(a,u,s,e,n)}))}else{"string"==typeof t&&(t=JSON.parse(t));const r=Array.isArray(t)?t:t.features,i=r&&r.length;this.Sn(r);let s=r;if(r&&i>1e3){s=[];for(let t=0;t<i;t++)fc(r[t],s,t,i)}this.On(s,null,t,e,n)}}Sn(t){if(this.options.generateOMBB&&t)for(let n=0;n<t.length;n++){const e=t[n];if(e&&e.geometry&&e.geometry.coordinates)if("Polygon"===e.geometry.type){const t=e.geometry.coordinates[0];if(!t)continue;const n=uc(t,t.length);e.properties=e.properties||{},e.properties[_l]=n}else if("MultiPolygon"===e.geometry.type){const t=e.geometry.coordinates;for(let n=0;n<t.length;n++){if(!t[n])continue;const r=t[n][0];if(!r)continue;const i=uc(r,r.length);e.properties=e.properties||{},e.properties[_l]=e.properties[_l]||[],e.properties[_l][n]=i}}}}On(t,n,e,r,i){try{const s=t&&t.length?function(t){let n=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const e=t.features.length;for(let r=0;r<e;r++)ih(t.features[r],n);break;case"Feature":ih(t,n);break;default:sh(t,n)}return n}({type:"FeatureCollection",features:t}):null;this.index=function(t,n){return new ut(t,n)}(e,this.options.geojsonvt||r),i(null,{extent:s,idMap:n})}catch(t){console.warn(t),i({error:t.message})}}_n(t){const n=[],e={};let r=0;const i=this.options.featureIdProperty;if(t){const s=t.length;t.forEach(((t,o)=>{!function(t,s,o){if(t&&("Feature"!==t.type||t.geometry)){if(P(t.id)||(t.id=r++),i){let n=i;_(i)&&(n=i[t.layer||"0"]),t.id=t.properties[n]}e[t.id]=k({},t),t.geometry?(e[t.id].geometry=k({},t.geometry),e[t.id].geometry.coordinates=null):t.coordinates&&(e[t.id].coordinates=null),fc(t,n,s,o)}}(t,o,s)}))}return{sample1000:n,idMap:e}}getTileFeatures(t,n){const e=t.tileInfo,r=[];if(!this.index)return this.empty?(setTimeout((function(){n(null,r,[])}),1),1):(setTimeout((function(){n({loading:!0})}),1),1);const i=this.index.getTile(e.z,e.x,e.y);if(!i||0===i.features.length)return setTimeout((function(){n(null,r,[])}),1),1;const s=[];for(let t=0,n=i.features.length;t<n;t++){const n=i.features[t];let e=n.layer;void 0===e&&(e="0"),s[e]={types:{}};s[e].types[n.type]=1,n.tags=n.tags||{},n.geometry.converted||(Rn(n),n.geometry.converted=1),r.push({type:n.type,layer:e,id:n.id,geometry:n.geometry,properties:n.tags,extent:this.options.extent})}for(const t in s)s[t].types=Object.keys(s[t].types).map((t=>+t));return setTimeout((function(){n(null,r,s)}),1),1}onRemove(){super.onRemove(),delete this.index}}function fc(t,n,e,r){const i=Math.floor(r/998);(0===e||e===r-1||(0===i||e%i==0)&&n.length<999)&&n.push(t)}var dc={\n/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nread:function(t,n,e,r,i){var s,o,a=8*i-r-1,u=(1<<a)-1,l=u>>1,h=-7,c=e?i-1:0,f=e?-1:1,d=t[n+c];for(c+=f,s=d&(1<<-h)-1,d>>=-h,h+=a;h>0;s=256*s+t[n+c],c+=f,h-=8);for(o=s&(1<<-h)-1,s>>=-h,h+=r;h>0;o=256*o+t[n+c],c+=f,h-=8);if(0===s)s=1-l;else{if(s===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),s-=l}return(d?-1:1)*o*Math.pow(2,s-r)},write:function(t,n,e,r,i,s){var o,a,u,l=8*s-i-1,h=(1<<l)-1,c=h>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,y=n<0||0===n&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(a=isNaN(n)?1:0,o=h):(o=Math.floor(Math.log(n)/Math.LN2),n*(u=Math.pow(2,-o))<1&&(o--,u*=2),(n+=o+c>=1?f/u:f*Math.pow(2,1-c))*u>=2&&(o++,u/=2),o+c>=h?(a=0,o=h):o+c>=1?(a=(n*u-1)*Math.pow(2,i),o+=c):(a=n*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;t[e+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;t[e+d]=255&o,d+=p,o/=256,l-=8);t[e+d-p]|=128*y}},pc=mc,yc=dc;function mc(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}mc.Varint=0,mc.Fixed64=1,mc.Bytes=2,mc.Fixed32=5;var gc=4294967296,vc=1/gc,bc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function wc(t){return t.type===mc.Bytes?t.readVarint()+t.pos:t.pos+1}function Mc(t,n,e){return e?4294967296*n+(t>>>0):4294967296*(n>>>0)+(t>>>0)}function xc(t,n,e){var r=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));e.realloc(r);for(var i=e.pos-1;i>=t;i--)e.buf[i+r]=e.buf[i]}function Fc(t,n){for(var e=0;e<t.length;e++)n.writeVarint(t[e])}function kc(t,n){for(var e=0;e<t.length;e++)n.writeSVarint(t[e])}function Ac(t,n){for(var e=0;e<t.length;e++)n.writeFloat(t[e])}function Pc(t,n){for(var e=0;e<t.length;e++)n.writeDouble(t[e])}function Sc(t,n){for(var e=0;e<t.length;e++)n.writeBoolean(t[e])}function _c(t,n){for(var e=0;e<t.length;e++)n.writeFixed32(t[e])}function Oc(t,n){for(var e=0;e<t.length;e++)n.writeSFixed32(t[e])}function Cc(t,n){for(var e=0;e<t.length;e++)n.writeFixed64(t[e])}function Ec(t,n){for(var e=0;e<t.length;e++)n.writeSFixed64(t[e])}function $c(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16)+16777216*t[n+3]}function Ic(t,n,e){t[e]=n,t[e+1]=n>>>8,t[e+2]=n>>>16,t[e+3]=n>>>24}function zc(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16)+(t[n+3]<<24)}mc.prototype={destroy:function(){this.buf=null},readFields:function(t,n,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),i=r>>3,s=this.pos;this.type=7&r,t(i,n,this),this.pos===s&&this.skip(r)}return n},readMessage:function(t,n){return this.readFields(t,n,this.readVarint()+this.pos)},readFixed32:function(){var t=$c(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=zc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=$c(this.buf,this.pos)+$c(this.buf,this.pos+4)*gc;return this.pos+=8,t},readSFixed64:function(){var t=$c(this.buf,this.pos)+zc(this.buf,this.pos+4)*gc;return this.pos+=8,t},readFloat:function(){var t=yc.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=yc.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var n,e,r=this.buf;return n=127&(e=r[this.pos++]),e<128?n:(n|=(127&(e=r[this.pos++]))<<7,e<128?n:(n|=(127&(e=r[this.pos++]))<<14,e<128?n:(n|=(127&(e=r[this.pos++]))<<21,e<128?n:function(t,n,e){var r,i,s=e.buf;if(i=s[e.pos++],r=(112&i)>>4,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(127&i)<<3,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(127&i)<<10,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(127&i)<<17,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(127&i)<<24,i<128)return Mc(t,r,n);if(i=s[e.pos++],r|=(1&i)<<31,i<128)return Mc(t,r,n);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(e=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&bc?function(t,n,e){return bc.decode(t.subarray(n,e))}(this.buf,n,t):function(t,n,e){var r="",i=n;for(;i<e;){var s,o,a,u=t[i],l=null,h=u>239?4:u>223?3:u>191?2:1;if(i+h>e)break;1===h?u<128&&(l=u):2===h?128==(192&(s=t[i+1]))&&(l=(31&u)<<6|63&s)<=127&&(l=null):3===h?(s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&((l=(15&u)<<12|(63&s)<<6|63&o)<=2047||l>=55296&&l<=57343)&&(l=null)):4===h&&(s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((l=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,h=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=h}return r}(this.buf,n,t)},readBytes:function(){var t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n},readPackedVarint:function(t,n){if(this.type!==mc.Bytes)return t.push(this.readVarint(n));var e=wc(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(n));return t},readPackedSVarint:function(t){if(this.type!==mc.Bytes)return t.push(this.readSVarint());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==mc.Bytes)return t.push(this.readBoolean());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==mc.Bytes)return t.push(this.readFloat());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==mc.Bytes)return t.push(this.readDouble());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==mc.Bytes)return t.push(this.readFixed32());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==mc.Bytes)return t.push(this.readSFixed32());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==mc.Bytes)return t.push(this.readFixed64());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==mc.Bytes)return t.push(this.readSFixed64());var n=wc(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed64());return t},skip:function(t){var n=7&t;if(n===mc.Varint)for(;this.buf[this.pos++]>127;);else if(n===mc.Bytes)this.pos=this.readVarint()+this.pos;else if(n===mc.Fixed32)this.pos+=4;else{if(n!==mc.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(t,n){this.writeVarint(t<<3|n)},realloc:function(t){for(var n=this.length||16;n<this.pos+t;)n*=2;if(n!==this.length){var e=new Uint8Array(n);e.set(this.buf),this.buf=e,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Ic(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Ic(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Ic(this.buf,-1&t,this.pos),Ic(this.buf,Math.floor(t*vc),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Ic(this.buf,-1&t,this.pos),Ic(this.buf,Math.floor(t*vc),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,n){var e,r;t>=0?(e=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(e=~(-t%4294967296))?e=e+1|0:(e=0,r=r+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(t,n,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}(e,0,n),function(t,n){var e=(7&t)<<4;if(n.buf[n.pos++]|=e|((t>>>=3)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;n.buf[n.pos++]=127&t}(r,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var n=this.pos;this.pos=function(t,n,e){for(var r,i,s=0;s<n.length;s++){if((r=n.charCodeAt(s))>55295&&r<57344){if(!i){r>56319||s+1===n.length?(t[e++]=239,t[e++]=191,t[e++]=189):i=r;continue}if(r<56320){t[e++]=239,t[e++]=191,t[e++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[e++]=239,t[e++]=191,t[e++]=189,i=null);r<128?t[e++]=r:(r<2048?t[e++]=r>>6|192:(r<65536?t[e++]=r>>12|224:(t[e++]=r>>18|240,t[e++]=r>>12&63|128),t[e++]=r>>6&63|128),t[e++]=63&r|128)}return e}(this.buf,t,this.pos);var e=this.pos-n;e>=128&&xc(n,e,this),this.pos=n-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),yc.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),yc.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var n=t.length;this.writeVarint(n),this.realloc(n);for(var e=0;e<n;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,n){this.pos++;var e=this.pos;t(n,this);var r=this.pos-e;r>=128&&xc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,n,e){this.writeTag(t,mc.Bytes),this.writeRawMessage(n,e)},writePackedVarint:function(t,n){n.length&&this.writeMessage(t,Fc,n)},writePackedSVarint:function(t,n){n.length&&this.writeMessage(t,kc,n)},writePackedBoolean:function(t,n){n.length&&this.writeMessage(t,Sc,n)},writePackedFloat:function(t,n){n.length&&this.writeMessage(t,Ac,n)},writePackedDouble:function(t,n){n.length&&this.writeMessage(t,Pc,n)},writePackedFixed32:function(t,n){n.length&&this.writeMessage(t,_c,n)},writePackedSFixed32:function(t,n){n.length&&this.writeMessage(t,Oc,n)},writePackedFixed64:function(t,n){n.length&&this.writeMessage(t,Cc,n)},writePackedSFixed64:function(t,n){n.length&&this.writeMessage(t,Ec,n)},writeBytesField:function(t,n){this.writeTag(t,mc.Bytes),this.writeBytes(n)},writeFixed32Field:function(t,n){this.writeTag(t,mc.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(t,n){this.writeTag(t,mc.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(t,n){this.writeTag(t,mc.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(t,n){this.writeTag(t,mc.Fixed64),this.writeSFixed64(n)},writeVarintField:function(t,n){this.writeTag(t,mc.Varint),this.writeVarint(n)},writeSVarintField:function(t,n){this.writeTag(t,mc.Varint),this.writeSVarint(n)},writeStringField:function(t,n){this.writeTag(t,mc.Bytes),this.writeString(n)},writeFloatField:function(t,n){this.writeTag(t,mc.Fixed32),this.writeFloat(n)},writeDoubleField:function(t,n){this.writeTag(t,mc.Fixed64),this.writeDouble(n)},writeBooleanField:function(t,n){this.writeVarintField(t,Boolean(n))}};var Dc=Et(pc),Tc=an,Uc=jc;function jc(t,n,e,r,i){this.properties={},this.extent=e,this.type=0,this.Cn=t,this.En=-1,this.$n=r,this.In=i,t.readFields(Nc,this,n)}function Nc(t,n,e){1==t?n.id=e.readVarint():2==t?function(t,n){var e=t.readVarint()+t.pos;for(;t.pos<e;){var r=n.$n[t.readVarint()],i=n.In[t.readVarint()];n.properties[r]=i}}(e,n):3==t?n.type=e.readVarint():4==t&&(n.En=e.pos)}function Lc(t){for(var n,e,r=0,i=0,s=t.length,o=s-1;i<s;o=i++)n=t[i],r+=((e=t[o]).x-n.x)*(n.y+e.y);return r}jc.types=["Unknown","Point","LineString","Polygon"],jc.prototype.loadGeometry=function(){var t=this.Cn;t.pos=this.En;for(var n,e=t.readVarint()+t.pos,r=1,i=0,s=0,o=0,a=[];t.pos<e;){if(i<=0){var u=t.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)s+=t.readSVarint(),o+=t.readSVarint(),1===r&&(n&&a.push(n),n=[]),n.push(new Tc(s,o));else{if(7!==r)throw new Error("unknown command "+r);n&&n.push(n[0].clone())}}return n&&a.push(n),a},jc.prototype.bbox=function(){var t=this.Cn;t.pos=this.En;for(var n=t.readVarint()+t.pos,e=1,r=0,i=0,s=0,o=1/0,a=-1/0,u=1/0,l=-1/0;t.pos<n;){if(r<=0){var h=t.readVarint();e=7&h,r=h>>3}if(r--,1===e||2===e)(i+=t.readSVarint())<o&&(o=i),i>a&&(a=i),(s+=t.readSVarint())<u&&(u=s),s>l&&(l=s);else if(7!==e)throw new Error("unknown command "+e)}return[o,u,a,l]},jc.prototype.toGeoJSON=function(t,n,e){var r,i,s=this.extent*Math.pow(2,e),o=this.extent*t,a=this.extent*n,u=this.loadGeometry(),l=jc.types[this.type];function h(t){for(var n=0;n<t.length;n++){var e=t[n],r=180-360*(e.y+a)/s;t[n]=[360*(e.x+o)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(r=0;r<u.length;r++)c[r]=u[r][0];h(u=c);break;case 2:for(r=0;r<u.length;r++)h(u[r]);break;case 3:for(u=function(t){var n=t.length;if(n<=1)return[t];for(var e,r,i=[],s=0;s<n;s++){var o=Lc(t[s]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(e&&i.push(e),e=[t[s]]):e.push(t[s]))}e&&i.push(e);return i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)h(u[r][i])}1===u.length?u=u[0]:l="Multi"+l;var f={type:"Feature",geometry:{type:l,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Hc=Uc,Rc=Vc;function Vc(t,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this.Cn=t,this.$n=[],this.In=[],this.zn=[],t.readFields(qc,this,n),this.length=this.zn.length}function qc(t,n,e){15===t?n.version=e.readVarint():1===t?n.name=e.readString():5===t?n.extent=e.readVarint():2===t?n.zn.push(e.pos):3===t?n.$n.push(e.readString()):4===t&&n.In.push(function(t){var n=null,e=t.readVarint()+t.pos;for(;t.pos<e;){var r=t.readVarint()>>3;n=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return n}(e))}Vc.prototype.feature=function(t){if(t<0||t>=this.zn.length)throw new Error("feature index out of bounds");this.Cn.pos=this.zn[t];var n=this.Cn.readVarint()+this.Cn.pos;return new Hc(this.Cn,n,this.extent,this.$n,this.In)};var Gc=Rc,Jc=function(t,n){this.layers=t.readFields(Wc,{},n)};function Wc(t,n,e){if(3===t){var r=new Gc(e,e.readVarint()+e.pos);r.length&&(n[r.name]=r)}}var Bc=Jc;class Xc extends Vl{constructor(t,n,e,r,i,s){super(t,n,e,r,i),n=n||{},s()}getTileFeatures(t,n){const e=t.tileInfo.url,r=t.fetchOptions||{},i=this.qt.get(e);if(i&&i.cacheIndex===t.workerCacheIndex){const{err:t,data:r}=i;return setTimeout((()=>{this.Dn(e,t,r,n)}),1)}return r.referrer=t.referrer,$.getArrayBuffer(e,r,((r,i)=>{this.qt&&(r?r.loading||this.qt.add(e,{err:r,data:i&&i.data,cacheIndex:t.workerCacheIndex}):i&&i.data&&this.qt.add(e,{err:null,data:i.data,cacheIndex:t.workerCacheIndex}),this.Dn(e,r,i&&i.data,n))}))}Dn(t,n,e,r){if(n)return void r(n);let i;try{i=new Bc(new Dc(e))}catch(n){return void r(n.message,[],[])}const s=[];if(!i.layers)return void r(null,s,[]);const o={};let a;for(const t in i.layers)if(u=i.layers,l=t,Object.prototype.hasOwnProperty.call(u,l)){o[t]={types:{}};const e=o[t].types;for(let r=0,o=i.layers[t].length;r<o;r++)try{a=i.layers[t].feature(r),e[a.type]=1;const n={type:a.type,layer:t,geometry:a.loadGeometry(),properties:a.properties,extent:a.extent};void 0!==a.id&&(n.id=a.id);let o=n.properties[_l];o&&(A(o)&&(o=JSON.parse(o)),n.properties[_l]=hc(o,"EPSG:3857")),s.push(n)}catch(n){console.warn("error when load vt geometry:",n)}}var u,l;for(const t in o)o[t].types=Object.keys(o[t].types).map((t=>+t));r(null,s,o,{byteLength:e.byteLength})}abortTile(t,n){const e=this.requests[t];delete this.requests[t],e&&e.abort&&e.abort(),this.sn(t),n()}onRemove(){super.onRemove();for(const t in this.requests){const n=this.requests[t];n&&n.abort&&n.abort()}this.requests={}}}let Yc=0;const Kc=new vl(128);class Zc{constructor(t){this.Tn={},this.Un={},this.workerId=t}addLayer({actorId:t,mapId:n,layerId:e,params:r},i){if(this.jn(n,e))return;const s=this.Nn(n,e),o=r.type,a=r.options,u=this.send.bind(this,t);this.Tn[s]="GeoJSONVectorTileLayer"===o?new cc(e,a,u,Kc,{},i):new Xc(e,a,u,Kc,{},i)}removeLayer({mapId:t,layerId:n},e){const r=this.jn(t,n),i=this.Nn(t,n);delete this.Tn[i],r&&r.onRemove(e)}loadTile({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.loadTile(e,r)}abortTile({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.abortTile&&i.abortTile(e.url,r)}removeTile({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.removeTile(e,r)}updateStyle({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.updateStyle(e,r)}updateOptions({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.updateOptions(e,r)}setData({mapId:t,layerId:n,params:e},r){const i=this.jn(t,n);i&&i.setData(e.data,r)}receive(t){const n=t.callback,e=this.Un[n];delete this.Un[n],e&&t.error?e(new Error(t.error)):e&&e(null,t.data)}send(t,n,e,r,i){const s=i?\`${XR}t}-${XR}Yc++}\`:null;i&&(this.Un[s]=i),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:n,params:e,callback:String(s)},r||[])}Nn(t,n){return\`${XR}t}-${XR}n}\`}jn(t,n){const e=this.Nn(t,n);return this.Tn[e]}Ln(){Kc.reset()}}t.initialize=function(){},t.onmessage=function(t,n){const e=t.data;if(this.dispatcher||(this.dispatcher=new Zc(t.workerId)),"<response>"===t.type)this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t);else{const r=e.command;this.dispatcher[r]({actorId:t.actorId,mapId:e.mapId,layerId:e.layerId,params:e.params},((t,e,i)=>{t&&404!==t.status&&204!==t.status&&!t.loading&&console.error(r,t),n(t,e,i)}))}}}`;var JR=KR;function KR(t,e){this.x=t,this.y=e}KR.prototype={clone:function(){return new KR(this.x,this.y)},add:function(t){return this.clone().i(t)},sub:function(t){return this.clone().o(t)},multByPoint:function(t){return this.clone().u(t)},divByPoint:function(t){return this.clone().m(t)},mult:function(t){return this.clone().A(t)},div:function(t){return this.clone().M(t)},rotate:function(t){return this.clone().S(t)},rotateAround:function(t,e){return this.clone().k(t,e)},matMult:function(t){return this.clone().P(t)},unit:function(){return this.clone().T()},perp:function(){return this.clone().I()},round:function(){return this.clone().F()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},P:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},i:function(t){return this.x+=t.x,this.y+=t.y,this},o:function(t){return this.x-=t.x,this.y-=t.y,this},A:function(t){return this.x*=t,this.y*=t,this},M:function(t){return this.x/=t,this.y/=t,this},u:function(t){return this.x*=t.x,this.y*=t.y,this},m:function(t){return this.x/=t.x,this.y/=t.y,this},T:function(){return this.M(this.mag()),this},I:function(){var t=this.y;return this.y=this.x,this.x=-t,this},S:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},k:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=r,this},F:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},KR.convert=function(t){return t instanceof KR?t:Array.isArray(t)?new KR(t[0],t[1]):t};var $R=function(t){return t&&t.t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(JR);const tD={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function eD(t,e={}){var n=[];if("FeatureCollection"===t.type)for(var i=0;i<t.features.length;i++)nD(n,t.features[i],e,i);else nD(n,"Feature"===t.type?t:{geometry:t},e);return n}function nD(t,e,n,i){if(e.geometry&&e.geometry.geometry){var r=e.geometry.coordinates,o=e.geometry.type,s=[],a=e.id;if(n.promoteId?a=e.properties[n.promoteId]:n.generateId&&(a=i||0),"Point"===o)iD(r,s);else if("MultiPoint"===o)for(var h=0;h<r.length;h++)iD(r[h],s);else if("LineString"===o)oD([r],s);else if("MultiLineString"===o){if(n.lineMetrics){for(h=0;h<r.length;h++)rD(r[h],s=[]),t.push(sD(a,"LineString",s,e.properties));return}oD(r,s)}else if("Polygon"===o)oD(r,s);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(h=0;h<e.geometry.geometries.length;h++)nD(t,{id:a,geometry:e.geometry.geometries[h],properties:e.properties},n,i);return}return void console.warn(`Input data type(${o}) is not a valid GeoJSON geometry type.`)}for(h=0;h<r.length;h++){var l=[];oD(r[h],l),s.push(l)}}t.push(sD(a,o,s,e.properties))}}function iD(t,e){const n=new $R(t[0],t[1]);n.z=100*(t[2]||0),e.push([n])}function rD(t,e){for(let n=0;n<t.length;n++){const i=new $R(t[n][0],t[n][1]);i.z=100*(t[n][2]||0),e.push(i)}}function oD(t,e,n,i){for(var r=0;r<t.length;r++){var o=[];rD(t[r],o),e.push(o)}}function sD(t,e,n,i){return{id:void 0===t?null:t,type:tD[e],geometry:n,properties:i}}function aD(t,e,n){n=n||{},this.w=t||64,this.h=e||64,this.autoResize=!!n.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function hD(t,e,n){this.x=0,this.y=t,this.w=this.free=e,this.h=n}function lD(t,e,n,i,r,o,s){this.id=t,this.x=e,this.y=n,this.w=i,this.h=r,this.maxw=o||i,this.maxh=s||r,this.refcount=0}function uD(t,{width:e,height:n},i,r){if(r){if(r.length!==e*n*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=r,t}function cD(t,{width:e,height:n},i){if(e===t.width&&n===t.height)return;const r=uD({},{width:e,height:n},i);AD(t,r,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,n)},i),t.width=e,t.height=n,t.data=r.data}function AD(t,e,n,i,r,o){if(0===r.width||0===r.height)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;if(s===a)return e;for(let h=0;h<r.height;h++){const l=((n.y+h)*t.width+n.x)*o,u=((i.y+h)*e.width+i.x)*o;for(let t=0;t<r.width*o;t++)a[u+t]=s[l+t]}return e}aD.prototype.pack=function(t,e){t=[].concat(t),e=e||{};for(var n,i,r,o=[],s=0;s<t.length;s++)if(i=t[s].h||t[s].height,(n=t[s].w||t[s].width)&&i){if(!(r=this.packOne(n,i,t[s].id)))continue;e.inPlace&&(t[s].x=r.x,t[s].y=r.y,t[s].id=r.id),o.push(r)}return this.shrink(),o},aD.prototype.packOne=function(t,e,n){var i,r,o,s,a,h,l,u,c={freebin:-1,shelf:-1,waste:1/0},A=0;if("string"==typeof n||"number"==typeof n){if(i=this.getBin(n))return this.ref(i),i;"number"==typeof n&&(this.maxId=Math.max(n,this.maxId))}else n=++this.maxId;for(s=0;s<this.freebins.length;s++){if(e===(i=this.freebins[s]).maxh&&t===i.maxw)return this.allocFreebin(s,t,e,n);e>i.maxh||t>i.maxw||e<=i.maxh&&t<=i.maxw&&(o=i.maxw*i.maxh-t*e)<c.waste&&(c.waste=o,c.freebin=s)}for(s=0;s<this.shelves.length;s++)if(A+=(r=this.shelves[s]).h,!(t>r.free)){if(e===r.h)return this.allocShelf(s,t,e,n);e>r.h||e<r.h&&(o=(r.h-e)*t)<c.waste&&(c.freebin=-1,c.waste=o,c.shelf=s)}return-1!==c.freebin?this.allocFreebin(c.freebin,t,e,n):-1!==c.shelf?this.allocShelf(c.shelf,t,e,n):e<=this.h-A&&t<=this.w?(r=new hD(A,this.w,e),this.allocShelf(this.shelves.push(r)-1,t,e,n)):this.autoResize?(a=h=this.h,((l=u=this.w)<=a||t>l)&&(u=2*Math.max(t,l)),(a<l||e>a)&&(h=2*Math.max(e,a)),this.resize(u,h),this.packOne(t,e,n)):null},aD.prototype.allocFreebin=function(t,e,n,i){var r=this.freebins.splice(t,1)[0];return r.id=i,r.w=e,r.h=n,r.refcount=0,this.bins[i]=r,this.ref(r),r},aD.prototype.allocShelf=function(t,e,n,i){var r=this.shelves[t].alloc(e,n,i);return this.bins[i]=r,this.ref(r),r},aD.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,e=0,n=0;n<this.shelves.length;n++){var i=this.shelves[n];e+=i.h,t=Math.max(i.w-i.free,t)}this.resize(t,e)}},aD.prototype.getBin=function(t){return this.bins[t]},aD.prototype.ref=function(t){if(1==++t.refcount){var e=t.h;this.stats[e]=1+(0|this.stats[e])}return t.refcount},aD.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},aD.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},aD.prototype.resize=function(t,e){this.w=t,this.h=e;for(var n=0;n<this.shelves.length;n++)this.shelves[n].resize(t);return!0},hD.prototype.alloc=function(t,e,n){if(t>this.free||e>this.h)return null;var i=this.x;return this.x+=t,this.free-=t,new lD(n,i,this.y,t,e,t,this.h)},hD.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};let fD=class t{constructor(t,e){uD(this,t,1,e)}resize(t){cD(this,t,1)}clone(){return new t({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){AD(t,e,n,i,r,1)}},dD=class t{constructor(t,e){uD(this,t,4,e)}resize(t){cD(this,t,4)}clone(){return new t({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,i,r){AD(t,e,n,i,r,4)}};function pD(t){let e=0;for(let n,i,r=0,o=t.length,s=o-1;r<o;s=r++)if(n=t[r],i=t[s],void 0!==n.x){if(n.z||i.z)return 1;e+=(i.x-n.x)*(n.y+i.y)}else{if(n[2]||i[2])return 1;e+=(i[0]-n[0])*(n[1]+i[1])}return e}function gD(t,e,n){let i=n;return e&&t&&(i=+t[e]),isNaN(i)&&(i=n||0),100*i}function mD(t,e,n,i,r,o,s){e||0===e||(e=1);const a=gD(t.properties,n,i),h=a*e;let l=(o?100*o:0)||a;return r?l=gD(t.properties,r,o):s&&(l=a-gD(t.properties,s,o)),l*=e,{altitude:h,height:l}}function yD(t,e){return e<1/0&&(t.x<0||t.x>e||t.y<0||t.y>e)}function vD(t){return null==t}function _D(t,e,n){if(t===n||t===e)return t;const i=n-e;return((t-e)%i+i)%i+e}function xD(t,e){if(!e)return null;const n=new Map;for(let i=0;i<e.length;i++){const r=e[i],o=t[r];let s=n.get(o);s||(s=[],n.set(o,s)),s.push(r)}return n}function bD(t){return!(t&t-1)&&0!==t}let wD=class{constructor(t,e,{pixelRatio:n}){this.paddedRect=t,this.pixelRatio=n||1,this.padding=e}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}},CD=class{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,e=Object.keys(t).length,n={},i=new aD(0,0,{autoResize:!0}),r=[],o=e>1?1:0;for(const a in t){const e=t[a],i={x:0,y:0,w:e.data.width+2*o,h:e.data.height+2*o};r.push(i),n[a]=new wD(i,o,e)}if(i.pack(r,{inPlace:!0}),!bD(i.w)||!bD(i.h)){const t=PD(i.w),e=PD(i.h);i.resize(t,e)}const s=new dD({width:i.w,height:i.h});for(const a in t){const e=t[a],i=n[a].paddedRect;dD.copy(e.data,s,{x:0,y:0},{x:i.x+o,y:i.y+o},e.data)}this.image=s,this.positions=n}};function PD(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}let MD=class{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,e={},n=new aD(0,0,{autoResize:!0}),i=[];for(const o in t){const n=t[o],r=e[o]={};for(const t in n){const e=n[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const o={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};i.push(o),r[t]={rect:o,metrics:e.metrics}}}n.pack(i,{inPlace:!0});const r=new fD({width:n.w,height:n.h});for(const o in t){const n=t[o];for(const t in n){const i=n[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const s=e[o][t].rect;fD.copy(i.bitmap,r,{x:0,y:0},{x:s.x+1,y:s.y+1},i.bitmap)}}this.image=r,this.positions=e}};function TD(t){return t<65536?Uint16Array:Uint32Array}function SD(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:Float32Array}function ID(t){return t<256?Uint8Array:t<65536?Uint16Array:Float32Array}function ED(t,e){const n=t.getLength?t.getLength():t.length;if(t instanceof e)return t.slice(0,n);const i=new e(n);t=t.C||t;for(let r=0;r<n;r++)i[r]=t[r]||0;return i}function OD(t){const e=t.type,n=[];if(1===e||4===e)for(let i=0;i<t.geometry.length;i++)iD(t.geometry[i],n);else if(2===e)oD(t.geometry,n);else if(3===e)oD(t.geometry,n);else if(5===e)oD(t.geometry,n);else if(6===e)for(let i=0;i<t.geometry.length;i++){const e=[];oD(t.geometry[i],e),n.push(e)}return t.geometry=n,t}function RD(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function DD(t){return null==t}function kD(t){return"number"==typeof t&&!isNaN(t)}function LD(t){return"object"==typeof t&&!!t}function FD(t){return!DD(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}const ND=Object.prototype.hasOwnProperty;function zD(t,e){return ND.call(t,e)}function BD(t){return t&&SE(t)&&t.property}const HD={};function jD(t,e){if(!Array.isArray(e)){if(e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b)return t[0]=255*e.r,t[1]=255*e.g,t[2]=255*e.b,t[3]=void 0!==e.a?255*e.a:255,t;e=HD[e]=HD[e]||bO(e).unitArray()}for(let n=0;n<e.length;n++)t[n]=255*e[n];return 3===e.length&&(t[3]=255),t}const UD={textFill:1,textSize:1,textOpacity:1,textDx:1,textDy:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1,polygonPatternFileWidth:1,polygonPatternFileOrigin:1,rotationX:1,rotationY:1,rotationZ:1,scaleX:1,scaleY:1,scaleZ:1,translationX:1,translationY:1,translationZ:1};let GD=class{constructor(t,e,n,i){this.feature=t,this.symbol=e,this.fnTypes=n,this.options=i}getPolygonResource(){let t=this.symbol.polygonPatternFile;const{polygonPatternFileFn:e}=this.fnTypes;return this.O(t,e)}getLineResource(){let t=this.symbol.linePatternFile;const{linePatternFileFn:e}=this.fnTypes;return this.O(t,e)}O(t,e){return e&&(t=e(this.options.zoom,this.feature.properties)),t}};function VD(t,e,n,i){const r=Math.abs(i)>>15,o=r>>1,s=r%2;let a=i%Math.pow(2,15);const h=e+(o<<14)*Math.sign(e),l=n+(s<<14)*Math.sign(n);return t[0]=h,t[1]=l,a=Math.round(a),t[2]=0===a?i<0?-1:0:a,t}const WD=Math.pow(2,14),qD=Math.pow(2,15);function ZD(t,e,n,i){const r=(Math.sign(e)||1)*(Math.abs(e)%WD),o=(Math.sign(n)||1)*(Math.abs(n)%WD),s=Math.floor(Math.abs(e)/WD),a=Math.floor(Math.abs(n)/WD);return t[0]=r,t[1]=o,t[2]=Math.sign(i+1e-5)*(2*s+a)*qD+i,t}var QD,XD,YD="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==t?t:"undefined"!=typeof self?self:{},JD={exports:{}};function KD(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}QD=JD,XD=JD.exports,function(t){var e=XD&&!XD.nodeType&&XD,n=QD&&!QD.nodeType&&QD,i="object"==typeof YD&&YD;i.global!==i&&i.window!==i&&i.self!==i||(t=i);var r,o,s=2147483647,a=36,h=26,l=38,u=700,c=/^xn--/,A=/[^\x20-\x7E]/,f=/[\x2E\u3002\uFF0E\uFF61]/g,d={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},p=a-1,g=Math.floor,m=String.fromCharCode;function y(t){throw RangeError(d[t])}function v(t,e){for(var n=t.length,i=[];n--;)i[n]=e(t[n]);return i}function _(t,e){var n=t.split("@"),i="";return n.length>1&&(i=n[0]+"@",t=n[1]),i+v((t=t.replace(f,".")).split("."),e).join(".")}function x(t){for(var e,n,i=[],r=0,o=t.length;r<o;)(e=t.charCodeAt(r++))>=55296&&e<=56319&&r<o?56320==(64512&(n=t.charCodeAt(r++)))?i.push(((1023&e)<<10)+(1023&n)+65536):(i.push(e),r--):i.push(e);return i}function b(t){return v(t,(function(t){var e="";return t>65535&&(e+=m((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+m(t)})).join("")}function w(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function C(t,e,n){var i=0;for(t=n?g(t/u):t>>1,t+=g(t/e);t>p*h>>1;i+=a)t=g(t/p);return g(i+(p+1)*t/(t+l))}function P(t){var e,n,i,r,o,l,u,c,A,f,d,p=[],m=t.length,v=0,_=128,x=72;for((n=t.lastIndexOf("-"))<0&&(n=0),i=0;i<n;++i)t.charCodeAt(i)>=128&&y("not-basic"),p.push(t.charCodeAt(i));for(r=n>0?n+1:0;r<m;){for(o=v,l=1,u=a;r>=m&&y("invalid-input"),((c=(d=t.charCodeAt(r++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:a)>=a||c>g((s-v)/l))&&y("overflow"),v+=c*l,!(c<(A=u<=x?1:u>=x+h?h:u-x));u+=a)l>g(s/(f=a-A))&&y("overflow"),l*=f;x=C(v-o,e=p.length+1,0==o),g(v/e)>s-_&&y("overflow"),_+=g(v/e),v%=e,p.splice(v++,0,_)}return b(p)}function M(t){var e,n,i,r,o,l,u,c,A,f,d,p,v,_,b,P=[];for(p=(t=x(t)).length,e=128,n=0,o=72,l=0;l<p;++l)(d=t[l])<128&&P.push(m(d));for(i=r=P.length,r&&P.push("-");i<p;){for(u=s,l=0;l<p;++l)(d=t[l])>=e&&d<u&&(u=d);for(u-e>g((s-n)/(v=i+1))&&y("overflow"),n+=(u-e)*v,e=u,l=0;l<p;++l)if((d=t[l])<e&&++n>s&&y("overflow"),d==e){for(c=n,A=a;!(c<(f=A<=o?1:A>=o+h?h:A-o));A+=a)P.push(m(w(f+(b=c-f)%(_=a-f),0))),c=g(b/_);P.push(m(w(c,0))),o=C(n,v,i==r),n=0,++i}++n,++e}return P.join("")}if(r={version:"1.3.2",ucs2:{decode:x,encode:b},decode:P,encode:M,toASCII:function(t){return _(t,(function(t){return A.test(t)?"xn--"+M(t):t}))},toUnicode:function(t){return _(t,(function(t){return c.test(t)?P(t.slice(4).toLowerCase()):t}))}},e&&n)if(QD.exports==e)n.exports=r;else for(o in r)r.hasOwnProperty(o)&&(e[o]=r[o]);else t.punycode=r}(YD);var $D=class extends Error{constructor(t,e){super(e),this.message=e,this.key=t}},tk=class t{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[n,i]of e)this.bindings[n]=i}concat(e){return new t(this,e)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}};const ek={kind:"null"},nk={kind:"number"},ik={kind:"string"},rk={kind:"boolean"},ok={kind:"color"},sk={kind:"object"},ak={kind:"value"},hk={kind:"collator"},lk={kind:"formatted"},uk={kind:"resolvedImage"};function ck(t,e){return{kind:"array",itemType:t,N:e}}function Ak(t){if("array"===t.kind){const e=Ak(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const fk=[ek,nk,ik,rk,ok,lk,sk,ck(ak),uk];function dk(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!dk(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of fk)if(!dk(t,e))return null}return`Expected ${Ak(t)} but found ${Ak(e)} instead.`}function pk(t,e){return e.some((e=>e.kind===t.kind))}function gk(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}var mk,yk={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function vk(t){return(t=Math.round(t))<0?0:t>255?255:t}function _k(t){return t<0?0:t>1?1:t}function xk(t){return vk("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function bk(t){return _k("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function wk(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{mk={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in yk)return yk[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(-1!==i&&r+1===n.length){var o=n.substr(0,i),s=n.substr(i+1,r-(i+1)).split(","),a=1;switch(o){case"rgba":if(4!==s.length)return null;a=bk(s.pop());case"rgb":return 3!==s.length?null:[xk(s[0]),xk(s[1]),xk(s[2]),a];case"hsla":if(4!==s.length)return null;a=bk(s.pop());case"hsl":if(3!==s.length)return null;var h=(parseFloat(s[0])%360+360)%360/360,l=bk(s[1]),u=bk(s[2]),c=u<=.5?u*(l+1):u+l-u*l,A=2*u-c;return[vk(255*wk(A,c,h+1/3)),vk(255*wk(A,c,h)),vk(255*wk(A,c,h-1/3)),a];default:return null}}return null}}catch(Aft){}let Ck=class t{constructor(t,e,n,i=1){this.r=t,this.g=e,this.b=n,this.a=i}static parse(e){if(!e)return;if(e instanceof t)return e;if("string"!=typeof e)return;const n=mk(e);return n?new t(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,e,n,i]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(n)},${i})`}toArray(){const{r:t,g:e,b:n,a:i}=this;return 0===i?[0,0,0,0]:[255*t/i,255*e/i,255*n/i,i]}toArray01(){const{r:t,g:e,b:n,a:i}=this;return 0===i?[0,0,0,0]:[t/i,e/i,n/i,i]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:n,a:i}=this;return[t,e,n,i]}};Ck.black=new Ck(0,0,0,1),Ck.white=new Ck(1,1,1,1),Ck.transparent=new Ck(0,0,0,0),Ck.red=new Ck(1,0,0,1),Ck.blue=new Ck(0,0,1,1);var Pk=Ck;let Mk=class{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}},Tk=class{constructor(t,e,n,i,r){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=n,this.fontStack=i,this.textColor=r}},Sk=class t{constructor(t){this.sections=t}static fromString(e){return new t([new Tk(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(e){return e instanceof t?e:t.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const n={};e.fontStack&&(n["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(n["font-scale"]=e.scale),e.textColor&&(n["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(n)}return t}},Ik=class t{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(e){return e?new t({name:e,available:!1}):null}serialize(){return["image",this.name]}};function Ek(t,e,n,i){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===i||"number"==typeof i&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof i?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ok(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Pk)return!0;if(t instanceof Mk)return!0;if(t instanceof Sk)return!0;if(t instanceof Ik)return!0;if(Array.isArray(t)){for(const e of t)if(!Ok(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Ok(t[e]))return!1;return!0}return!1}function Rk(t){if(null===t)return ek;if("string"==typeof t)return ik;if("boolean"==typeof t)return rk;if("number"==typeof t)return nk;if(t instanceof Pk)return ok;if(t instanceof Mk)return hk;if(t instanceof Sk)return lk;if(t instanceof Ik)return uk;if(Array.isArray(t)){const e=t.length;let n;for(const i of t){const t=Rk(i);if(n){if(n===t)continue;n=ak;break}n=t}return ck(n||ak,e)}return sk}function Dk(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Pk||t instanceof Sk||t instanceof Ik?t.toString():JSON.stringify(t)}var kk=class t{constructor(t,e){this.type=t,this.value=e}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ok(e[1]))return n.error("invalid value");const i=e[1];let r=Rk(i);const o=n.expectedType;return"array"!==r.kind||0!==r.N||!o||"array"!==o.kind||"number"==typeof o.N&&0!==o.N||(r=o),new t(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Pk?["rgba"].concat(this.value.toArray()):this.value instanceof Sk?this.value.serialize():this.value}},Lk=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Fk={string:ik,number:nk,boolean:rk,object:sk};var Nk=class t{constructor(t,e){this.type=t,this.args=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i,r=1;const o=e[0];if("array"===o){let t,o;if(e.length>2){const i=e[1];if("string"!=typeof i||!(i in Fk)||"object"===i)return n.error('The item type argument of "array" must be one of string, number, boolean',1);t=Fk[i],r++}else t=ak;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);o=e[2],r++}i=ck(t,o)}else i=Fk[o];const s=[];for(;r<e.length;r++){const t=n.parse(e[r],r,ak);if(!t)return null;s.push(t)}return new t(i,s)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!dk(this.type,Rk(n)))return n;if(e===this.args.length-1)throw new Lk(`Expected value to be of type ${Ak(this.type)}, but found ${Ak(Rk(n))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);const i=t.N;("number"==typeof i||this.args.length>1)&&e.push(i)}}return e.concat(this.args.map((t=>t.serialize())))}};let zk=class t{constructor(t){this.type=lk,this.sections=t}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[1];if(!Array.isArray(i)&&"object"==typeof i)return n.error("First argument must be an image or text section.");const r=[];let o=!1;for(let t=1;t<=e.length-1;++t){const i=e[t];if(o&&"object"==typeof i&&!Array.isArray(i)){o=!1;let t=null;if(i["font-scale"]&&(t=n.parse(i["font-scale"],1,nk),!t))return null;let e=null;if(i["text-font"]&&(e=n.parse(i["text-font"],1,ck(ik)),!e))return null;let s=null;if(i["text-color"]&&(s=n.parse(i["text-color"],1,ok),!s))return null;const a=r[r.length-1];a.scale=t,a.font=e,a.textColor=s}else{const i=n.parse(e[t],1,ak);if(!i)return null;const s=i.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,r.push({content:i,scale:null,font:null,textColor:null})}}return new t(r)}evaluate(t){return new Sk(this.sections.map((e=>{const n=e.content.evaluate(t);return Rk(n)===uk?new Tk("",n,null,null,null):new Tk(Dk(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const n={};e.scale&&(n["font-scale"]=e.scale.serialize()),e.font&&(n["text-font"]=e.font.serialize()),e.textColor&&(n["text-color"]=e.textColor.serialize()),t.push(n)}return t}},Bk=class t{constructor(t){this.type=uk,this.input=t}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const i=n.parse(e[1],1,ik);return i?new t(i):n.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=Ik.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}};const Hk={"to-boolean":rk,"to-color":ok,"to-number":nk,"to-string":ik};var jk=class t{constructor(t,e){this.type=t,this.args=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const i=e[0];if(("to-boolean"===i||"to-string"===i)&&2!==e.length)return n.error("Expected one argument.");const r=Hk[i],o=[];for(let t=1;t<e.length;t++){const i=n.parse(e[t],t,ak);if(!i)return null;o.push(i)}return new t(r,o)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,n;for(const i of this.args){if(e=i.evaluate(t),n=null,e instanceof Pk)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:Ek(e[0],e[1],e[2],e[3]),!n))return new Pk(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new Lk(n||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const i=Number(e);if(!isNaN(i))return i}throw new Lk(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?Sk.fromString(Dk(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Ik.fromString(Dk(this.args[0].evaluate(t))):Dk(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new zk([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Bk(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild((e=>{t.push(e.serialize())})),t}};const Uk=["Unknown","Point","LineString","Polygon"];var Gk=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this.D={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Uk[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this.D[t];return e||(e=this.D[t]=Pk.parse(t)),e}},Vk=class t{constructor(t,e,n,i){this.name=t,this.type=e,this.L=n,this.args=i}evaluate(t){return this.L(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(e,n){const i=e[0],r=t.definitions[i];if(!r)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);const o=Array.isArray(r)?r[0]:r.type,s=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,a=s.filter((([t])=>!Array.isArray(t)||t.length===e.length-1));let h=null;for(const[l,u]of a){h=new dL(n.registry,n.path,null,n.scope);const r=[];let s=!1;for(let t=1;t<e.length;t++){const n=e[t],i=Array.isArray(l)?l[t-1]:l.type,o=h.parse(n,1+r.length,i);if(!o){s=!0;break}r.push(o)}if(!s)if(Array.isArray(l)&&l.length!==r.length)h.error(`Expected ${l.length} arguments, but found ${r.length} instead.`);else{for(let t=0;t<r.length;t++){const e=Array.isArray(l)?l[t]:l.type,n=r[t];h.concat(t+1).checkSubtype(e,n.type)}if(0===h.errors.length)return new t(i,o,u,r)}}if(1===a.length)n.errors.push(...h.errors);else{const t=(a.length?a:s).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(Ak).join(", ")})`:`(${Ak(e.type)}...)`;var e})).join(" | "),i=[];for(let r=1;r<e.length;r++){const t=n.parse(e[r],1+i.length);if(!t)return null;i.push(Ak(t.type))}n.error(`Expected arguments of type ${t}, but found (${i.join(", ")}) instead.`)}return null}static register(e,n){t.definitions=n;for(const i in n)e[i]=t}};let Wk=class t{constructor(t,e,n){this.type=hk,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const i=e[1];if("object"!=typeof i||Array.isArray(i))return n.error("Collator options argument must be an object.");const r=n.parse(void 0!==i["case-sensitive"]&&i["case-sensitive"],1,rk);if(!r)return null;const o=n.parse(void 0!==i["diacritic-sensitive"]&&i["diacritic-sensitive"],1,rk);if(!o)return null;let s=null;return i.locale&&(s=n.parse(i.locale,1,ik),!s)?null:new t(r,o,s)}evaluate(t){return new Mk(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}};const qk=8192;function Zk(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Qk(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Xk(t,e){const n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*qk),Math.round(i*r*qk)]}function Yk(t,e,n){const i=t[0]-e[0],r=t[1]-e[1],o=t[0]-n[0],s=t[1]-n[1];return i*s-o*r==0&&i*o<=0&&r*s<=0}function Jk(t,e){let n=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(Yk(t,a[e],a[e+1]))return!1;(r=a[e])[1]>(i=t)[1]!=(o=a[e+1])[1]>i[1]&&i[0]<(o[0]-r[0])*(i[1]-r[1])/(o[1]-r[1])+r[0]&&(n=!n)}}var i,r,o;return n}function Kk(t,e){for(let n=0;n<e.length;n++)if(Jk(t,e[n]))return!0;return!1}function $k(t,e,n,i){const r=i[0]-n[0],o=i[1]-n[1],s=(t[0]-n[0])*o-r*(t[1]-n[1]),a=(e[0]-n[0])*o-r*(e[1]-n[1]);return s>0&&a<0||s<0&&a>0}function tL(t,e,n,i){return 0!=(r=[i[0]-n[0],i[1]-n[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-r[1]*o[0]&&!(!$k(t,e,n,i)||!$k(n,i,t,e));var r,o}function eL(t,e,n){for(const i of n)for(let n=0;n<i.length-1;++n)if(tL(t,e,i[n],i[n+1]))return!0;return!1}function nL(t,e){for(let n=0;n<t.length;++n)if(!Jk(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(eL(t[n],t[n+1],e))return!1;return!0}function iL(t,e){for(let n=0;n<e.length;n++)if(nL(t,e[n]))return!0;return!1}function rL(t,e,n){const i=[];for(let r=0;r<t.length;r++){const o=[];for(let i=0;i<t[r].length;i++){const s=Xk(t[r][i],n);Zk(e,s),o.push(s)}i.push(o)}return i}function oL(t,e,n){const i=[];for(let r=0;r<t.length;r++){const o=rL(t[r],e,n);i.push(o)}return i}function sL(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){const e=.5*i;let r=t[0]-n[0]>e?-i:n[0]-t[0]>e?i:0;0===r&&(r=t[0]-n[2]>e?-i:n[2]-t[0]>e?i:0),t[0]+=r}Zk(e,t)}function aL(t,e,n,i){const r=Math.pow(2,i.z)*qk,o=[i.x*qk,i.y*qk],s=[];if(!t)return s;for(const a of t)for(const t of a){const i=[t.x+o[0],t.y+o[1]];sL(i,e,n,r),s.push(i)}return s}function hL(t,e,n,i){const r=Math.pow(2,i.z)*qk,o=[i.x*qk,i.y*qk],s=[];if(!t)return s;for(const h of t){const t=[];for(const n of h){const i=[n.x+o[0],n.y+o[1]];Zk(e,i),t.push(i)}s.push(t)}if(e[2]-e[0]<=r/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const i of t)sL(i,e,n,r)}var a;return s}var lL=class t{constructor(t,e){this.type=rk,this.geojson=t,this.geometries=e}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ok(e[1])){const n=e[1];if("FeatureCollection"===n.type)for(let e=0;e<n.features.length;++e){const i=n.features[e].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new t(n,n.features[e].geometry)}else if("Feature"===n.type){const e=n.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new t(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new t(n,n)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=rL(e.coordinates,i,r),s=aL(t.geometry(),n,i,r);if(!Qk(n,i))return!1;for(const t of s)if(!Jk(t,o))return!1}if("MultiPolygon"===e.type){const o=oL(e.coordinates,i,r),s=aL(t.geometry(),n,i,r);if(!Qk(n,i))return!1;for(const t of s)if(!Kk(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],i=[1/0,1/0,-1/0,-1/0],r=t.canonicalID();if(!r)return!1;if("Polygon"===e.type){const o=rL(e.coordinates,i,r),s=hL(t.geometry(),n,i,r);if(!Qk(n,i))return!1;for(const t of s)if(!nL(t,o))return!1}if("MultiPolygon"===e.type){const o=oL(e.coordinates,i,r),s=hL(t.geometry(),n,i,r);if(!Qk(n,i))return!1;for(const t of s)if(!iL(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}};function uL(t){if(t instanceof Vk){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof lL)return!1;let e=!0;return t.eachChild((t=>{e&&!uL(t)&&(e=!1)})),e}function cL(t){if(t instanceof Vk&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!cL(t)&&(e=!1)})),e}function AL(t,e){if(t instanceof Vk&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild((t=>{n&&!AL(t,e)&&(n=!1)})),n}var fL=class t{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const i=e[1];return n.scope.has(i)?new t(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}},dL=class t{constructor(t,e=[],n,i=new tk,r=[]){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=i,this.errors=r,this.expectedType=n}parse(t,e,n,i,r={}){return e?this.concat(e,n,i).R(t,r):this.R(t,r)}R(t,e){function n(t,e,n){return"assert"===n?new Nk(e,[t]):"coerce"===n?new jk(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const o=this.registry[r];if(o){let r=o.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else r=n(r,t,e.typeAnnotation||"coerce");else r=n(r,t,e.typeAnnotation||"assert")}if(!(r instanceof kk)&&"resolvedImage"!==r.type.kind&&pL(r)){const t=new Gk;try{r=new kk(r.type,r.evaluate(t))}catch(i){return this.error(i.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(e,n,i){const r="number"==typeof e?this.path.concat(e):this.path,o=i?this.scope.concat(i):this.scope;return new t(this.registry,r,n||null,o,this.errors)}error(t,...e){const n=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new $D(n,t))}checkSubtype(t,e){const n=dk(t,e);return n&&this.error(n),n}};function pL(t){if(t instanceof fL)return pL(t.boundExpression);if(t instanceof Vk&&"error"===t.name)return!1;if(t instanceof Wk)return!1;if(t instanceof lL)return!1;const e=t instanceof jk||t instanceof Nk;let n=!0;return t.eachChild((t=>{n=e?n&&pL(t):n&&t instanceof kk})),!!n&&uL(t)&&AL(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function gL(t,e){const n=t.length-1;let i,r,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),i=t[a],r=t[a+1],i<=e){if(a===n||e<r)return a;o=a+1}else{if(!(i>e))throw new Lk("Input is not a number.");s=a-1}return 0}var mL=class t{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[i,r]of n)this.labels.push(i),this.outputs.push(r)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const i=n.parse(e[1],1,nk);if(!i)return null;const r=[];let o=null;n.expectedType&&"value"!==n.expectedType.kind&&(o=n.expectedType);for(let t=1;t<e.length;t+=2){const i=1===t?-1/0:e[t],s=e[t+1],a=t,h=t+1;if("number"!=typeof i)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=i)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const l=n.parse(s,h,o);if(!l)return null;o=o||l.type,r.push([i,l])}return new t(o,i,r)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const i=this.input.evaluate(t);if(i<=e[0])return n[0].evaluate(t);const r=e.length;return i>=e[r-1]?n[r-1].evaluate(t):n[gL(e,i)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}},yL=vL;function vL(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}function _L(t,e,n){return t*(1-n)+e*n}vL.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var s=0,a=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?s=n:a=n,n=.5*(a-s)+s;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var xL=Object.freeze({__proto__:null,number:_L,color:function(t,e,n){return new Pk(_L(t.r,e.r,n),_L(t.g,e.g,n),_L(t.b,e.b,n),_L(t.a,e.a,n))},array:function(t,e,n){return t.map(((t,i)=>_L(t,e[i],n)))}});const bL=.95047,wL=1.08883,CL=4/29,PL=6/29,ML=3*PL*PL,TL=PL*PL*PL,SL=Math.PI/180,IL=180/Math.PI;function EL(t){return t>TL?Math.pow(t,1/3):t/ML+CL}function OL(t){return t>PL?t*t*t:ML*(t-CL)}function RL(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function DL(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function kL(t){const e=DL(t.r),n=DL(t.g),i=DL(t.b),r=EL((.4124564*e+.3575761*n+.1804375*i)/bL),o=EL((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-EL((.0193339*e+.119192*n+.9503041*i)/wL)),alpha:t.a}}function LL(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*OL(e),n=bL*OL(n),i=wL*OL(i),new Pk(RL(3.2404542*n-1.5371385*e-.4985314*i),RL(-.969266*n+1.8760108*e+.041556*i),RL(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function FL(t,e,n){const i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}const NL={forward:kL,reverse:LL,interpolate:function(t,e,n){return{l:_L(t.l,e.l,n),a:_L(t.a,e.a,n),b:_L(t.b,e.b,n),alpha:_L(t.alpha,e.alpha,n)}}},zL={forward:function(t){const{l:e,a:n,b:i}=kL(t),r=Math.atan2(i,n)*IL;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){const e=t.h*SL,n=t.c;return LL({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:FL(t.h,e.h,n),c:_L(t.c,e.c,n),l:_L(t.l,e.l,n),alpha:_L(t.alpha,e.alpha,n)}}};var BL=Object.freeze({__proto__:null,lab:NL,hcl:zL});function HL(t,e,n,i){const r=i-n,o=t-n;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}var jL=class t{constructor(t,e,n,i,r){this.type=t,this.operator=e,this.interpolation=n,this.input=i,this.labels=[],this.outputs=[];for(const[o,s]of r)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(t,e,n,i){let r=0;if("exponential"===t.name)r=HL(e,t.base,n,i);else if("linear"===t.name)r=HL(e,1,n,i);else if("cubic-bezier"===t.name){const o=t.controlPoints;r=new yL(o[0],o[1],o[2],o[3]).solve(HL(e,1,n,i))}return r}static parse(e,n){let[i,r,o,...s]=e;if(!Array.isArray(r)||0===r.length)return n.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return n.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return n.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(o=n.parse(o,2,nk),!o)return null;const a=[];let h=null;"interpolate-hcl"===i||"interpolate-lab"===i?h=ok:n.expectedType&&"value"!==n.expectedType.kind&&(h=n.expectedType);for(let t=0;t<s.length;t+=2){const e=s[t],i=s[t+1],r=t+3,o=t+4;if("number"!=typeof e)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(a.length&&a[a.length-1][0]>=e)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const l=n.parse(i,o,h);if(!l)return null;h=h||l.type,a.push([e,l])}return"number"===h.kind||"color"===h.kind||"array"===h.kind&&"number"===h.itemType.kind&&"number"==typeof h.N?new t(h,i,r,o,a):n.error(`Type ${Ak(h)} is not interpolatable.`)}evaluate(e){const n=this.labels,i=this.outputs;if(1===n.length)return i[0].evaluate(e);const r=this.input.evaluate(e);if(r<=n[0])return i[0].evaluate(e);const o=n.length;if(r>=n[o-1])return i[o-1].evaluate(e);const s=gL(n,r),a=t.interpolationFactor(this.interpolation,r,n[s],n[s+1]),h=i[s].evaluate(e),l=i[s+1].evaluate(e);return"interpolate"===this.operator?xL[this.type.kind.toLowerCase()](h,l,a):"interpolate-hcl"===this.operator?zL.reverse(zL.interpolate(zL.forward(h),zL.forward(l),a)):NL.reverse(NL.interpolate(NL.forward(h),NL.forward(l),a))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e}},UL=class t{constructor(t,e){this.type=t,this.args=e}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let i=null;const r=n.expectedType;r&&"value"!==r.kind&&(i=r);const o=[];for(const t of e.slice(1)){const e=n.parse(t,1+o.length,i,void 0,{typeAnnotation:"omit"});if(!e)return null;i=i||e.type,o.push(e)}const s=r&&o.some((t=>dk(r,t.type)));return new t(s?ak:i,o)}evaluate(t){let e,n=null,i=0;for(const r of this.args){if(i++,n=r.evaluate(t),n&&n instanceof Ik&&!n.available&&(e||(e=n),n=null,i===this.args.length))return e;if(null!==n)break}return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}},GL=class t{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const i=[];for(let t=1;t<e.length-1;t+=2){const r=e[t];if("string"!=typeof r)return n.error(`Expected string, but found ${typeof r} instead.`,t);if(/[^a-zA-Z0-9_]/.test(r))return n.error("Variable names must contain only alphanumeric characters or '_'.",t);const o=n.parse(e[t+1],t+1);if(!o)return null;i.push([r,o])}const r=n.parse(e[e.length-1],e.length-1,n.expectedType,i);return r?new t(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,n]of this.bindings)t.push(e,n.serialize());return t.push(this.result.serialize()),t}},VL=class t{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,nk),r=n.parse(e[2],2,ck(n.expectedType||ak));return i&&r?new t(r.type.itemType,i,r):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new Lk(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new Lk(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new Lk(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}},WL=class t{constructor(t,e){this.type=rk,this.needle=t,this.haystack=e}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,ak),r=n.parse(e[2],2,ak);return i&&r?pk(i.type,[rk,ik,nk,ek,ak])?new t(i,r):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ak(i.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(null==n)return!1;if(!gk(e,["boolean","string","number","null"]))throw new Lk(`Expected first argument to be of type boolean, string, number or null, but found ${Ak(Rk(e))} instead.`);if(!gk(n,["string","array"]))throw new Lk(`Expected second argument to be of type array or string, but found ${Ak(Rk(n))} instead.`);return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}},qL=class t{constructor(t,e,n){this.type=nk,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,ak),r=n.parse(e[2],2,ak);if(!i||!r)return null;if(!pk(i.type,[rk,ik,nk,ek,ak]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ak(i.type)} instead`);if(4===e.length){const o=n.parse(e[3],3,nk);return o?new t(i,r,o):null}return new t(i,r)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!gk(e,["boolean","string","number","null"]))throw new Lk(`Expected first argument to be of type boolean, string, number or null, but found ${Ak(Rk(e))} instead.`);if(!gk(n,["string","array"]))throw new Lk(`Expected second argument to be of type array or string, but found ${Ak(Rk(n))} instead.`);if(this.fromIndex){const i=this.fromIndex.evaluate(t);return n.indexOf(e,i)}return n.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}},ZL=class t{constructor(t,e,n,i,r,o){this.inputType=t,this.type=e,this.input=n,this.cases=i,this.outputs=r,this.otherwise=o}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let i,r;n.expectedType&&"value"!==n.expectedType.kind&&(r=n.expectedType);const o={},s=[];for(let t=2;t<e.length-1;t+=2){let a=e[t];const h=e[t+1];Array.isArray(a)||(a=[a]);const l=n.concat(t);if(0===a.length)return l.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return l.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return l.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return l.error("Numeric branch labels must be integer values.");if(i){if(l.checkSubtype(i,Rk(t)))return null}else i=Rk(t);if(void 0!==o[String(t)])return l.error("Branch labels must be unique.");o[String(t)]=s.length}const u=n.parse(h,t,r);if(!u)return null;r=r||u.type,s.push(u)}const a=n.parse(e[1],1,ak);if(!a)return null;const h=n.parse(e[e.length-1],e.length-1,r);return h?"value"!==a.type.kind&&n.concat(1).checkSubtype(i,a.type)?null:new t(i,r,a,o,s,h):null}evaluate(t){const e=this.input.evaluate(t);return(Rk(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),n=[],i={};for(const o of e){const t=i[this.cases[o]];void 0===t?(i[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[t][1].push(o)}const r=t=>"number"===this.inputType.kind?Number(t):t;for(const[o,s]of n)t.push(1===s.length?r(s[0]):s.map(r)),t.push(this.outputs[o].serialize());return t.push(this.otherwise.serialize()),t}},QL=class t{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);const r=[];for(let t=1;t<e.length-1;t+=2){const o=n.parse(e[t],t,rk);if(!o)return null;const s=n.parse(e[t+1],t+1,i);if(!s)return null;r.push([o,s]),i=i||s.type}const o=n.parse(e[e.length-1],e.length-1,i);return o?new t(i,r,o):null}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}},XL=class t{constructor(t,e,n,i){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const i=n.parse(e[1],1,ak),r=n.parse(e[2],2,nk);if(!i||!r)return null;if(!pk(i.type,[ck(ak),ik,ak]))return n.error(`Expected first argument to be of type array or string, but found ${Ak(i.type)} instead`);if(4===e.length){const o=n.parse(e[3],3,nk);return o?new t(i.type,i,r,o):null}return new t(i.type,i,r)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!gk(e,["string","array"]))throw new Lk(`Expected first argument to be of type array or string, but found ${Ak(Rk(e))} instead.`);if(this.endIndex){const i=this.endIndex.evaluate(t);return e.slice(n,i)}return e.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}};function YL(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function JL(t,e,n,i){return 0===i.compare(e,n)}function KL(t,e,n){const i="=="!==t&&"!="!==t;return class r{constructor(t,e,n){this.type=rk,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let o=e.parse(t[1],1,ak);if(!o)return null;if(!YL(n,o.type))return e.concat(1).error(`"${n}" comparisons are not supported for type '${Ak(o.type)}'.`);let s=e.parse(t[2],2,ak);if(!s)return null;if(!YL(n,s.type))return e.concat(2).error(`"${n}" comparisons are not supported for type '${Ak(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${Ak(o.type)}' and '${Ak(s.type)}'.`);i&&("value"===o.type.kind&&"value"!==s.type.kind?o=new Nk(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new Nk(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,hk),!a)return null}return new r(o,s,a)}evaluate(r){const o=this.lhs.evaluate(r),s=this.rhs.evaluate(r);if(i&&this.hasUntypedArgument){const e=Rk(o),n=Rk(s);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new Lk(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${n.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){const t=Rk(o),n=Rk(s);if("string"!==t.kind||"string"!==n.kind)return e(r,o,s)}return this.collator?n(r,o,s,this.collator.evaluate(r)):e(r,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const $L=KL("==",(function(t,e,n){return e===n}),JL),tF=KL("!=",(function(t,e,n){return e!==n}),(function(t,e,n,i){return!JL(0,e,n,i)})),eF=KL("<",(function(t,e,n){return e<n}),(function(t,e,n,i){return i.compare(e,n)<0})),nF=KL(">",(function(t,e,n){return e>n}),(function(t,e,n,i){return i.compare(e,n)>0})),iF=KL("<=",(function(t,e,n){return e<=n}),(function(t,e,n,i){return i.compare(e,n)<=0})),rF=KL(">=",(function(t,e,n){return e>=n}),(function(t,e,n,i){return i.compare(e,n)>=0})),oF={"==":$L,"!=":tF,">":nF,"<":eF,">=":rF,"<=":iF,array:Nk,at:VL,boolean:Nk,case:QL,coalesce:UL,collator:Wk,format:zk,image:Bk,in:WL,"index-of":qL,interpolate:jL,"interpolate-hcl":jL,"interpolate-lab":jL,length:class t{constructor(t){this.type=nk,this.input=t}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const i=n.parse(e[1],1);return i?"array"!==i.type.kind&&"string"!==i.type.kind&&"value"!==i.type.kind?n.error(`Expected argument of type string or array, but found ${Ak(i.type)} instead.`):new t(i):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new Lk(`Expected value to be of type string or array, but found ${Ak(Rk(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}},let:GL,literal:kk,match:ZL,number:Nk,"number-format":class t{constructor(t,e,n,i,r,o){this.type=ik,this.number=t,this.locale=e,this.currency=n,this.unit=i,this.minFractionDigits=r,this.maxFractionDigits=o}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const i=n.parse(e[1],1,nk);if(!i)return null;const r=e[2];if("object"!=typeof r||Array.isArray(r))return n.error("NumberFormat options argument must be an object.");let o=null;if(r.locale&&(o=n.parse(r.locale,1,ik),!o))return null;let s=null;if(r.currency&&(s=n.parse(r.currency,1,ik),!s))return null;let a=null;if(r.unit&&(a=n.parse(r.unit,1,ik),!a))return null;let h=null;if(r["min-fraction-digits"]&&(h=n.parse(r["min-fraction-digits"],1,nk),!h))return null;let l=null;return r["max-fraction-digits"]&&(l=n.parse(r["max-fraction-digits"],1,nk),!l)?null:new t(i,o,s,a,h,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}},object:Nk,slice:XL,step:mL,string:Nk,"to-boolean":jk,"to-color":jk,"to-number":jk,"to-string":jk,var:fL,within:lL};function sF(t,[e,n,i,r]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);const o=r?r.evaluate(t):1,s=Ek(e,n,i,o);if(s)throw new Lk(s);return new Pk(e/255*o,n/255*o,i/255*o,o)}function aF(t,e){return t in e}function hF(t,e){const n=e[t];return void 0===n?null:n}function lF(t){return{type:t}}Vk.register(oF,{error:[{kind:"error"},[ik],(t,[e])=>{throw new Lk(e.evaluate(t))}],typeof:[ik,[ak],(t,[e])=>Ak(Rk(e.evaluate(t)))],"to-rgba":[ck(nk,4),[ok],(t,[e])=>e.evaluate(t).toArray()],rgb:[ok,[nk,nk,nk],sF],rgba:[ok,[nk,nk,nk,nk],sF],has:{type:rk,overloads:[[[ik],(t,[e])=>aF(e.evaluate(t),t.properties())],[[ik,sk],(t,[e,n])=>aF(e.evaluate(t),n.evaluate(t))]]},get:{type:ak,overloads:[[[ik],(t,[e])=>hF(e.evaluate(t),t.properties())],[[ik,sk],(t,[e,n])=>hF(e.evaluate(t),n.evaluate(t))]]},"feature-state":[ak,[ik],(t,[e])=>hF(e.evaluate(t),t.featureState||{})],properties:[sk,[],t=>t.properties()],"geometry-type":[ik,[],t=>t.geometryType()],id:[ak,[],t=>t.id()],zoom:[nk,[],t=>t.globals.zoom],pitch:[nk,[],t=>t.globals.pitch||0],"distance-from-center":[nk,[],t=>t.distanceFromCenter()],"heatmap-density":[nk,[],t=>t.globals.heatmapDensity||0],"line-progress":[nk,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[nk,[],t=>t.globals.skyRadialProgress||0],accumulated:[ak,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[nk,lF(nk),(t,e)=>{let n=0;for(const i of e)n+=i.evaluate(t);return n}],"*":[nk,lF(nk),(t,e)=>{let n=1;for(const i of e)n*=i.evaluate(t);return n}],"-":{type:nk,overloads:[[[nk,nk],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[nk],(t,[e])=>-e.evaluate(t)]]},"/":[nk,[nk,nk],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[nk,[nk,nk],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[nk,[],()=>Math.LN2],pi:[nk,[],()=>Math.PI],e:[nk,[],()=>Math.E],"^":[nk,[nk,nk],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[nk,[nk],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[nk,[nk],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[nk,[nk],(t,[e])=>Math.log(e.evaluate(t))],log2:[nk,[nk],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[nk,[nk],(t,[e])=>Math.sin(e.evaluate(t))],cos:[nk,[nk],(t,[e])=>Math.cos(e.evaluate(t))],tan:[nk,[nk],(t,[e])=>Math.tan(e.evaluate(t))],asin:[nk,[nk],(t,[e])=>Math.asin(e.evaluate(t))],acos:[nk,[nk],(t,[e])=>Math.acos(e.evaluate(t))],atan:[nk,[nk],(t,[e])=>Math.atan(e.evaluate(t))],min:[nk,lF(nk),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[nk,lF(nk),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[nk,[nk],(t,[e])=>Math.abs(e.evaluate(t))],round:[nk,[nk],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[nk,[nk],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[nk,[nk],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[rk,[ik,ak],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[rk,[ak],(t,[e])=>t.id()===e.value],"filter-type-==":[rk,[ik],(t,[e])=>t.geometryType()===e.value],"filter-<":[rk,[ik,ak],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[rk,[ak],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[rk,[ik,ak],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[rk,[ak],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[rk,[ik,ak],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[rk,[ak],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[rk,[ik,ak],(t,[e,n])=>{const i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[rk,[ak],(t,[e])=>{const n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[rk,[ak],(t,[e])=>e.value in t.properties()],"filter-has-id":[rk,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[rk,[ck(ik)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[rk,[ck(ak)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[rk,[ik,ck(ak)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[rk,[ik,ck(ak)],(t,[e,n])=>function(t,e,n,i){for(;n<=i;){const r=n+i>>1;if(e[r]===t)return!0;e[r]>t?i=r-1:n=r+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:rk,overloads:[[[rk,rk],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[lF(rk),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:rk,overloads:[[[rk,rk],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[lF(rk),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[rk,[rk],(t,[e])=>!e.evaluate(t)],"is-supported-script":[rk,[ik],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[ik,[ik],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[ik,[ik],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[ik,lF(ak),(t,e)=>e.map((e=>Dk(e.evaluate(t)))).join("")],"resolved-locale":[ik,[hk],(t,[e])=>e.evaluate(t).resolvedLocale()]});var uF=oF;function cF(t){return{result:"success",value:t}}function AF(t){return{result:"error",value:t}}function fF(t){return!!t.expression&&t.expression.interpolated}function dF(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function pF(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function gF(t){return t}function mF(t,e){const n="color"===e.type,i=t.stops&&"object"==typeof t.stops[0][0],r=i||!(i||void 0!==t.property),o=t.type||(fF(e)?"exponential":"interval");if(n&&((t=KD({},t)).stops&&(t.stops=t.stops.map((t=>[t[0],Pk.parse(t[1])]))),t.default=Pk.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!BL[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,h;if("exponential"===o)s=xF;else if("interval"===o)s=_F;else if("categorical"===o){s=vF,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];h=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=bF}if(i){const n={},i=[];for(let e=0;e<t.stops.length;e++){const r=t.stops[e],o=r[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},i.push(o)),n[o].stops.push([r[0].value,r[1]])}const r=[];for(const t of i)r.push([n[t].zoom,mF(n[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:jL.interpolationFactor.bind(void 0,o),zoomStops:r.map((t=>t[0])),evaluate:({zoom:n},i)=>xF({stops:r,base:t.base},e,n).evaluate(n,i)}}if(r){const n="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:jL.interpolationFactor.bind(void 0,n),zoomStops:t.stops.map((t=>t[0])),evaluate:({zoom:n})=>s(t,e,n,a,h)}}return{kind:"source",evaluate(n,i){const r=i&&i.properties?i.properties[t.property]:void 0;return void 0===r?yF(t.default,e.default):s(t,e,r,a,h)}}}function yF(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function vF(t,e,n,i,r){return yF(typeof n===r?i[n]:void 0,t.default,e.default)}function _F(t,e,n){if("number"!==dF(n))return yF(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const r=gL(t.stops.map((t=>t[0])),n);return t.stops[r][1]}function xF(t,e,n){const i=void 0!==t.base?t.base:1;if("number"!==dF(n))return yF(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const o=gL(t.stops.map((t=>t[0])),n),s=function(t,e,n,i){const r=i-n,o=t-n;return 0===r?0:1===e?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}(n,i,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],h=t.stops[o+1][1];let l=xL[e.type]||gF;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=BL[t.colorSpace];l=(t,n)=>e.reverse(e.interpolate(e.forward(t),e.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),n=h.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==n)return l(e,n,s)}}:l(a,h,s)}function bF(t,e,n){return"color"===e.type?n=Pk.parse(n):"formatted"===e.type?n=Sk.fromString(n.toString()):"resolvedImage"===e.type?n=Ik.fromString(n.toString()):dF(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),yF(n,t.default,e.default)}let wF=class{constructor(t,e){var n;this.expression=t,this.H={},this.V=new Gk,this.U=e?"color"===(n=e).type&&(pF(n.default)||Array.isArray(n.default))?new Pk(0,0,0,0):"color"===n.type?Pk.parse(n.default)||null:void 0===n.default?null:n.default:null,this.j=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,i,r,o,s,a){return this.V.globals=t,this.V.feature=e,this.V.featureState=n,this.V.canonical=i||null,this.V.availableImages=r||null,this.V.formattedSection=o,this.V.featureTileCoord=s||null,this.V.featureDistanceData=a||null,this.expression.evaluate(this.V)}evaluate(t,e,n,i,r,o,s,a){this.V.globals=t,this.V.feature=e||null,this.V.featureState=n||null,this.V.canonical=i||null,this.V.availableImages=r||null,this.V.formattedSection=o||null,this.V.featureTileCoord=s||null,this.V.featureDistanceData=a||null;try{const t=this.expression.evaluate(this.V);if(null==t||"number"==typeof t&&t!=t)return this.U;if(this.j&&!(t in this.j))throw new Lk(`Expected value to be one of ${Object.keys(this.j).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(h){return this.H[h.message]||(this.H[h.message]=!0,"undefined"!=typeof console&&console.warn(h.message)),this.U}}};function CF(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in uF}function PF(t,e){const n=new dL(uF,[],e?function(t){const e={color:ok,string:ik,number:nk,enum:ik,boolean:rk,formatted:lk,resolvedImage:uk};return"array"===t.type?ck(e[t.value]||ak,t.length):e[t.type]}(e):void 0),i=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return i?cF(new wF(i,e)):AF(n.errors)}let MF=class{constructor(t,e){this.kind=t,this.G=e,this.isStateDependent="constant"!==t&&!cL(e.expression)}evaluateWithoutErrorHandling(t,e,n,i,r,o){return this.G.evaluateWithoutErrorHandling(t,e,n,i,r,o)}evaluate(t,e,n,i,r,o){return this.G.evaluate(t,e,n,i,r,o)}},TF=class{constructor(t,e,n,i){this.kind=t,this.zoomStops=n,this.G=e,this.isStateDependent="camera"!==t&&!cL(e.expression),this.interpolationType=i}evaluateWithoutErrorHandling(t,e,n,i,r,o){return this.G.evaluateWithoutErrorHandling(t,e,n,i,r,o)}evaluate(t,e,n,i,r,o){return this.G.evaluate(t,e,n,i,r,o)}interpolationFactor(t,e,n){return this.interpolationType?jL.interpolationFactor(this.interpolationType,t,e,n):0}};function SF(t,e){if("error"===(t=PF(t,e)).result)return t;const n=t.value.expression,i=uL(n);if(!i&&"data-driven"!==e["property-type"])return AF([new $D("","data expressions not supported")]);const r=AL(n,["zoom","pitch","distance-from-center"]);if(!r&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(e))return AF([new $D("","zoom expressions not supported")]);const o=EF(n);return o||r?o instanceof $D?AF([o]):o instanceof jL&&!fF(e)?AF([new $D("",'"interpolate" expressions cannot be used with this property')]):cF(o?new TF(i?"camera":"composite",t.value,o.labels,o instanceof jL?o.interpolation:void 0):new MF(i?"constant":"source",t.value)):AF([new $D("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}let IF=class t{constructor(t,e){this.B=t,this.W=e,KD(this,mF(this.B,this.W))}static deserialize(e){return new t(e.B,e.W)}static serialize(t){return{B:t.B,W:t.W}}};function EF(t){let e=null;if(t instanceof GL)e=EF(t.result);else if(t instanceof UL){for(const n of t.args)if(e=EF(n),e)break}else(t instanceof mL||t instanceof jL)&&t.input instanceof Vk&&"zoom"===t.input.name&&(e=t);return e instanceof $D||t.eachChild((t=>{const n=EF(t);n instanceof $D?e=n:!e&&n?e=new $D("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new $D("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function OF(t){if(Array.isArray(t))return t.map(OF);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=OF(t[n]);return e}return(e=t)instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e;var e}function RF(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};const n=t;let i=!0;try{i=function(t){if(!LF(t))return t;let e=OF(t);return kF(e),e=DF(e),e}(n)}catch(h){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const r=PF(i,null);let o=null;if("error"===r.result)throw new Error(r.value.map((t=>`${t.key}: ${t.message}`)).join(", "));o=(t,e,n)=>r.value.evaluate(t,e,{},n);let s=null,a=null;if(i!==n){const t=PF(n,null);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s=(e,n,i,r,o)=>t.value.evaluate(e,n,{},i,void 0,void 0,r,o),a=!uL(t.value.expression)}return{filter:o,dynamicFilter:s||void 0,needGeometry:NF(i),needFeature:!!a}}function DF(t){if(!Array.isArray(t))return t;const e=function(t){if(FF.has(t[0]))for(let e=1;e<t.length;e++)if(LF(t[e]))return!0;return t}(t);return!0===e?e:e.map((t=>DF(t)))}function kF(t){let e=!1;const n=[];if("case"===t[0]){for(let i=1;i<t.length-1;i+=2)e=e||LF(t[i]),n.push(t[i+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||LF(t[1]);for(let e=2;e<t.length-1;e+=2)n.push(t[e+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||LF(t[1]);for(let e=1;e<t.length-1;e+=2)n.push(t[e+1])}e&&(t.length=0,t.push("any",...n));for(let i=1;i<t.length;i++)kF(t[i])}function LF(t){if(!Array.isArray(t))return!1;if(function(t){return"pitch"===t||"distance-from-center"===t}(t[0]))return!0;for(let e=1;e<t.length;e++)if(LF(t[e]))return!0;return!1}const FF=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function NF(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(NF(t[e]))return!0;return!1}const zF={StyleExpression:wF,isExpression:CF,isExpressionFilter:function t(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const n of e.slice(1))if(!t(n)&&"boolean"!=typeof n)return!1;return!0;default:return!0}},createExpression:PF,createPropertyExpression:SF,normalizePropertyExpression:function(t,e){if(pF(t))return new IF(t,e);if(CF(t)){const n=SF(t,e);if("error"===n.result)throw new Error(n.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return n.value}{let n=t;return"string"==typeof t&&"color"===e.type&&(n=Pk.parse(t)),{kind:"constant",evaluate:()=>n}}},ZoomConstantExpression:MF,ZoomDependentExpression:TF,StylePropertyFunction:IF},{isExpression:BF,createExpression:HF}=zF,jF={};function UF(t){if(!Array.isArray(t))return UF([t]);const e=[];for(let n=0;n<t.length;n++){let i;i=!0===t[n].filter?function(){return!0}:GF(t[n].filter),e.push(RD({},t[n],{filter:i}))}return e}function GF(t){if(!0===t)return function(){return!0};if(t&&t.condition){if("any"===t.type){const e=t.condition,n=[];for(let t=0;t<e.length;t++)n.push(GF(e[t]));return(t,e)=>{for(let i=0;i<n.length;i++)if(n[i](t,e))return!0;return!1}}const e=GF(t.condition);if(DD(t.layer))return e;const n=e=>e.layer===t.layer;return(t,i)=>n(t)&&e(t,i)}if(PO(t))return CO(t);{let e=RF(t);return e=e&&e.filter,(t,n)=>(jF.zoom=n,e&&e(jF,t))}}const VF={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function WF(t,e){VF.type=e||"number";const n=HF(t,VF);if("success"!==n.result)throw new Error(`Invalid maplibre spec expression: ${JSON.stringify(t)} (${n.value})`);return n.value}function qF(t){return BF(t)}const ZF={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function QF(t){return ZF[t]}const XF={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1},YF={lineDasharray:1,markerLineDasharray:1,uvScale:1,uvOffset:1};function JF(t){return XF[t]?"string":QF(t)?"number":YF[t]?"array":"color"}var KF=Object.freeze({__proto__:null,compileFilter:GF,compileStyle:function(t=[]){return UF(t=t.map((t=>{const e=RD({},t);return e.filter&&e.filter.value&&(e.filter=e.filter.value),e})))},createExpression:WF,getExpressionType:JF,isExpression:qF,isInterpolated:QF});const $F="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,tN=function(t){return class extends t{pushIn(...t){const e=t.length;for(let n=0;n<e;n++)this[this.currentIndex++]=t[n]}fill(t,e,n){super.fill(t,e,n),n>this.currentIndex&&(this.currentIndex=n)}set(t,e){t>=this.currentIndex&&(this.currentIndex=t+1),this[t]=e}getLength(){return this.currentIndex}setLength(t){this.currentIndex=t,super.length<t&&(super.length=t)}trySetLength(t){t>this.currentIndex&&this.setLength(t)}reset(){this.currentIndex=0}slice(t,e){const n=super.slice(t,e);return n.currentIndex=e-t,n}}},eN=tN(Array),nN={get:function(t,e){return"length"===e?t.getLength():t[e]}};let iN,rN=class extends Array{setLength(t){this.length=t,this.currentIndex=t}trySetLength(t){this.length=t,this.currentIndex=t}getLength(){return this.length}},oN=class t{static createTypedArray(t,e){return ED(t,e)}static getInstance(){return iN}static ensureCapacity(t,e){if(!t.BYTES_PER_ELEMENT)return t;if(t.length>=e)return t;const n=new t.constructor(e+Math.ceil(.5*e)),i=t.getLength();for(let r=0;r<i;r++)n[r]=t[r];return n.currentIndex=t.currentIndex,n}static getArray(t){let e;if(t){const n=tN(t);e=new n(1048576/n.BYTES_PER_ELEMENT)}else e=new eN;return e.push=(...t)=>{e.pushIn(...t)},e}static getProxyArray(){const t=new eN,e=new Proxy(t,nN);return e.push=(...e)=>{t.pushIn(...e)},e.C=t,e}constructor(){this.X=[],this.Y=0,this.q=[],this.J=0,this.K={}}getProxy(){if(!$F){const t=new rN;return t.currentIndex=0,t}const e=this.q[this.J]=this.q[this.J]||t.getProxyArray();return e.reset(),this.J++,e}get(e){if(!$F){const t=new rN;return t.currentIndex=0,t}if(e){const n=e.name;let i=this.K[n];i||(i=this.K[n]={arrays:[],index:0});const r=i.index,o=i.arrays[r]=i.arrays[r]||t.getArray(e);return o.reset(),i.index++,o}const n=this.X[this.Y]=this.X[this.Y]||t.getArray();return n.reset(),this.Y++,n}reset(){this.Y=0,this.J=0;for(const t in this.K)this.K[t].index=0}};iN=new oN;const sN="__fea_idx",aN=[],hN={},lN={},uN={},cN=[],AN=oN.getInstance();let fN=!1;const dN=Math.pow(2,17);let pN=class t{static isAtlasLoaded(t,e={}){const{iconAtlas:n}=e;return!!(!t||n&&n.positions[t])}static genFnTypes(t){const e={};for(const n in t)if(qF(t[n])){const i=(n+"_Fn_0").trim(),r=(n+"Fn").trim(),o=JF(n);e[i]=WF(t[n],o),e[r]=(t,n)=>{let r;hN.zoom=t,lN.properties=n;try{r=e[i].evaluateWithoutErrorHandling(hN,lN,uN,null,cN)}catch(o){return null}return r}}else if(BD(t[n])){const i=(n+"_Fn_0").trim(),r=(n+"Fn").trim();QF(n)?(e[i]=EE(t[n]),e[r]=(t,n)=>{const r=e[i](t,n);return BD(r)?EE(r)(t,n):r}):(e[i]=OE(t[n]),e[r]=(t,n)=>{const r=e[i](t,n);return BD(r)?OE(r)(t,n):r})}return e}constructor(e,n,i){this.options=i;const r=[];this.symbolDef=n,this.symbol=RE(n,(()=>(r[0]=i.zoom,r))),this.styledVectors=[],this.properties={},this.Z=i.fnTypes||t.genFnTypes(this.symbolDef),BD(this.symbolDef.visible)&&(this.tt=EE(this.symbolDef.visible)),i.atlas&&(this.iconAtlas=i.atlas.iconAtlas,this.glyphAtlas=i.atlas.glyphAtlas),this.features=this.et(e)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=dN||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Float32Array,width:3,name:"aPosition"}]}fillPosition(t,e,n,i){if(e<this.nt&&(this.nt=e),e>this.it&&(this.it=e),n<this.rt&&(this.rt=n),n>this.st&&(this.st=n),this.needAltitudeAttribute()){let r=t.aPosition.currentIndex;t.aPosition[r++]=e,t.aPosition[r++]=n,t.aPosition.currentIndex=r,r=t.aAltitude.currentIndex,t.aAltitude[r++]=i,t.aAltitude.currentIndex=r}else{VD(aN,e,n,i);let r=t.aPosition.currentIndex;t.aPosition[r++]=aN[0],t.aPosition[r++]=aN[1],t.aPosition[r++]=aN[2],t.aPosition.currentIndex=r}}et(t){if(!t.length)return t;const e=(sN+"").trim();let n,i=0,r=t[i];for(;!r.geometry;)i++,r=t[i];if(Array.isArray(r.geometry)&&r.properties){let e=r.geometry[0];for(;Array.isArray(e);)e=e[0];e instanceof $R&&(n=t)}if(!n)if(n=[],Array.isArray(r.geometry))for(let s=0;s<t.length;s++){const e=RD({},t[s]);n.push(OD(e))}else for(let s=0;s<t.length;s++){const i=t[s],r=eD(i);for(let t=0;t<r.length;t++){const o=r[t];o[e]=i[e],n.push(o)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const t="line"===this.symbolDef.textPlacement;let e=0,i=!1;const{textPitchAlignmentFn:r}=this.Z;!r&&t&&"map"===this.symbolDef.textPitchAlignment&&(i=!0);for(let o=0;o<n.length;o++){const s=mN(n[o]&&n[o].geometry);if(s>e&&(e=s),t&&!i&&r&&n[o].properties){const t=r(null,n[o].properties);"map"===t&&(i=t)}}this.hasMapPitchAlign=i,this.maxPosZ=e}const o=this.options.order;if(o){const t=[];for(let e=0;e<o.length;e++)o[e]&&t.push(GF(o[e]));n=n.sort(((e,n)=>{const i=t.length;let r=-1,o=-1;for(let s=0;s<i&&(t[s](e)&&(r=s),t[s](n)&&(o=s),!(r>=0&&r<i&&o>=0&&o<i));s++);return r-o}))}return n}load(t=1){const e=(sN+"").trim(),n="_debug_info".trim(),i=this.Z,r=this.styledVectors;this.count=0;const o=this.features;if(!o||!o.length)return Promise.resolve(null);const s={},a={},h={zoom:this.options.zoom,isVector3D:!!this.options.center},l=[],u=RE(this.symbolDef,(()=>(l[0]=h.zoom,l)));let c=0,A=o.length;const f=this.options.debugIndex;try{for(;c<A;c++){const t=o[c];if(!t||!t.geometry)continue;if(kD(f)&&t[n].index!==f)continue;t.properties||(t.properties={}),t.properties.$layer=t.layer,t.properties.$type=t.type;const l=this.createStyledVector(t,u,i,h,s,a);l&&l.feature.geometry&&(l.featureIdx=void 0===t[e]?c:t[e],this.count++,r.push(l))}}catch(d){return Promise.reject(d)}return this.options.atlas?Promise.resolve(this.pack(t)):this.loadAtlas(s,a).then((()=>this.pack(t)))}loadAtlas(t,e){return new Promise(((n,i)=>{this.fetchAtlas(t,e,((t,e)=>{if(t)i(t);else{if(e){const{icons:t,glyphs:n}=e;if(t&&Object.keys(t).length){for(const e in t){const n=t[e],{width:i,height:r,data:o}=n.data;n.data=new dD({width:i,height:r},o)}this.iconAtlas=new CD(t)}if(n&&Object.keys(n).length){for(const t in n){const e=n[t];for(const t in e){const n=e[t],{width:i,height:r,data:o}=n.bitmap;n.bitmap=new fD({width:i,height:r},o)}}this.glyphAtlas=new MD(n)}}n({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}}))}))}fetchAtlas(t,e,n){Object.keys(t).length>0||Object.keys(e).length>0?this.options.requestor(t,e,n):n()}pack(t){if(!this.count)return null;if(null==t)throw new Error("layout scale is undefined");const e=this.createDataPack(this.styledVectors,t);if(!e)return null;e.properties=this.properties,this.empty&&(e.empty=!0);const n=e.buffers;delete e.buffers;const i={data:e,buffers:n};if(this.iconAtlas){const t=i.data.iconAtlas=gN(this.iconAtlas);if(t.glyphMap)for(const e in t.glyphMap)n.push(t.glyphMap[e].data.data.buffer);n.push(i.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(i.data.glyphAtlas=gN(this.glyphAtlas),n.push(i.data.glyphAtlas.image.data.buffer)),i}createStyledVector(t,e,n,i){return new GD(t,e,n,i)}createDataPack(t,e){if(!t||!t.length)return null;this.maxIndex=0,this.maxPos=0,this.nt=this.rt=1/0,this.it=this.st=-1/0,this.maxAltitude=0,this.dynamicAttrs={};const n=this.data={};this.ot=AN,AN.reset();let i=this.elements=AN.get();const r=this.lt=this.getFormat(Array.isArray(t[0])?t[0][0].symbol:t[0].symbol),o=this.needAltitudeAttribute()?2:3;for(let v=0;v<r.length;v++)n[r[v].name]=AN.get(r[v].type);let s=AN.get(),a=0;const h=AN.get();let l=0,u=!1,c=!0;const A=new Set;for(let v=0,_=t.length;v<_;v++){if(!t[v].feature.geometry)continue;const i=Array.isArray(t[v])?t[v][0].feature.id:t[v].feature.id;c&&(void 0!==lN.id?A&&(A.has(lN.id)?c=!1:A.add(lN.id)):c=!1),kD(i)&&(Math.abs(i)>l&&(l=Math.abs(i)),i<0&&(u=!0));const r=this.data.aPosition.getLength();if(Array.isArray(t[v]))for(let n=0;n<t[v].length;n++)this.ht(t[v][n],e);else this.ht(t[v],e);const f=(n.aPosition.getLength()-r)/o;for(let e=0;e<f;e++)s.push(t[v].featureIdx),kD(i)&&h.push(i);a=Math.max(a,t[v].featureIdx)}if(this.countOutOfAngle>0&&!fN&&(fN=!0,console.warn("text anchor along line is ignored as anchor's line angle is bigger than textMaxAngle.")),this.hasElements()&&!i.getLength())return null;const f=this.options.center?Float32Array:ID(a);s=oN.createTypedArray(s,f),r[0].type=this.options.positionType?this.options.positionType:SD(this.maxPos);const d=this.options.center;if(d&&(d[0]||d[1])){const t=n.aPosition,e=t.getLength();for(let n=0;n<e;n+=o)t[n]-=d[0],t[n+1]-=d[1]}const p=function(t,e){const n={};for(let i=0;i<t.length;i++){const r=t[i],o=r.type,s=r.name;n[s]=o===Array?e[s]:ED(e[s],o)}return n}(r,n);p.aPickingId=s;const g=[];for(const v in p)g.push(p[v].buffer);const m=TD(this.maxIndex);i=oN.createTypedArray(i,m),g.push(i.buffer);const y={data:p,isIdUnique:c,is2D:0===this.maxPosZ,indices:this.hasElements()?i:null,positionSize:o,positionBounding:[this.nt,this.rt,this.it,this.st],buffers:g,symbolIndex:this.symbolDef.index||{index:0},dynamicAttributes:this.dynamicAttrs};if(this.ut&&(y.markerPlacement=this.ut),this.ct&&(y.textPlacement=this.ct),h.getLength()){const t=u?SD(l):ID(l);y.featureIds=oN.createTypedArray(h,t),g.push(y.featureIds.buffer)}else y.featureIds=[];return y.pickingIdIndiceMap=xD(s,y.indices),y}ht(t,e){this.tt&&!this.tt(this.options.zoom,t.feature.properties)||this.placeVector(t,e,this.formatWidth)}addElements(t,e,n){this.maxIndex=Math.max(this.maxIndex,t,e,n);let i=this.elements.currentIndex;this.elements[i++]=t,this.elements[i++]=e,this.elements[i++]=n,this.elements.currentIndex=i}hasElements(){return!0}getAltitude(t){const{altitudeProperty:e,defaultAltitude:n,altitudeScale:i}=this.options;let r=gD(t,e,n);return i&&(r*=i),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(r)),r}getIconAtlasMaxValue(){const t=this.iconAtlas.positions;let e=0;for(const n in t)if(zD(t,n)){const{tl:i,displaySize:r}=t[n],o=Math.max(i[0],i[1],r[0]-1,r[1]-1);o>e&&(e=o)}return e}ensureDataCapacity(t,e){const n=this.lt;for(let i=0;i<n.length;i++){const r=this.data[n[i].name];if(!r)continue;const o=n[i].width*t,s=r.getLength();this.data[n[i].name]=oN.ensureCapacity(r,s+o*e)}}};function gN(t){let e=t.positions,n=t.image&&t.image.format||"alpha";if(t instanceof CD){e={};for(const n in t.positions){const i=t.positions[n];e[n]={paddedRect:i.paddedRect,pixelRatio:i.pixelRatio,tl:i.tl,br:i.br,displaySize:i.displaySize}}n="rgba"}const i=t.image;return{image:{width:i.width,height:i.height,data:i.data,format:n},glyphMap:t.glyphMap,positions:e}}function mN(t){if(!t)return 0;let e=0;if(Array.isArray(t))for(let n=0;n<t.length;n++)if(Array.isArray(t[n])){const i=mN(t[n]);i>e&&(e=i)}else{const i=Math.abs(t[n].z||0);i>e&&(e=i)}else{const n=Math.abs(t.z||0);n>e&&(e=n)}return e}const yN="___fn_in_stops";function vN(t,e,n,i){const r="__fn_textSize".trim();let o=t.textSize;if(DD(e.textSize))return[16,16];t[r]&&(o=t[r]);const s=[];var a;if(s[0]=DD(a=o)||"function"!=typeof a&&(null===a.constructor||a.constructor!==Function)?o:o(i,n),SE(s[0])){const e=s[0].__fn_key=s[0].__fn_key||JSON.stringify(s[0]);t[yN]||(t[yN]={}),t[yN][e]||(t[yN][e]=EE(s[0])),s[0]=(0,t[yN][e])(i,n)}return s[1]=s[0],s}function _N(t){const e=t.stops;let n=-1/0;for(let i=0;i<e.length;i++){let t=e[i][1];LD(e[i][1])&&(t=_N(e[i][1])),t>n&&(n=t)}return n}const xN=["{","}"],bN="";function wN(t,e){if(!FD(t))return t;function n(t){if(!e)return bN;const n=e[t];return DD(n)?bN:Array.isArray(n)?n.join():n}const[i,r]=xN,o=function(t){t+=bN;const[e,n]=xN,i=[];let r=!1,o=bN;for(let s=0,a=t.length;s<a;s++){const a=t[s];r||a!==e||(r=!0),a===e&&r&&(o=bN),r&&a!==e&&a!==n&&(o+=a),a===n&&o&&(r=!1,i.push(o),o=bN)}return i}(t);for(let s=0,a=o.length;s<a;s++){const e=o[s],a=`${i}${e}${r}`;if(e.indexOf("|")>0){const i=e.split("|");let r=!1;for(let e=0;e<i.length;e++){const o=n(i[e]);if(o!==bN){t=CN(t,a,o),r=!0;break}}r||(t=CN(t,a,bN))}else t=CN(t,a,n(e))}return t}function CN(t,e,n){if(!t)return t;if(t.replaceAll)return t.replaceAll(e,n);for(;t.indexOf(e)>-1;)t=t.replace(e,n);return t}const PN={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function MN(t){return!(PN.Arabic(t)||PN["Arabic Supplement"](t)||PN["Arabic Extended-A"](t)||PN["Arabic Presentation Forms-A"](t)||PN["Arabic Presentation Forms-B"](t))}function TN(t){return!(t<11904||!(PN["Bopomofo Extended"](t)||PN.Bopomofo(t)||PN["CJK Compatibility Forms"](t)||PN["CJK Compatibility Ideographs"](t)||PN["CJK Compatibility"](t)||PN["CJK Radicals Supplement"](t)||PN["CJK Strokes"](t)||PN["CJK Symbols and Punctuation"](t)||PN["CJK Unified Ideographs Extension A"](t)||PN["CJK Unified Ideographs"](t)||PN["Enclosed CJK Letters and Months"](t)||PN["Halfwidth and Fullwidth Forms"](t)||PN.Hiragana(t)||PN["Ideographic Description Characters"](t)||PN["Kangxi Radicals"](t)||PN["Katakana Phonetic Extensions"](t)||PN.Katakana(t)||PN["Vertical Forms"](t)||PN["Yi Radicals"](t)||PN["Yi Syllables"](t)))}function SN(t){return!(746!==t&&747!==t&&(t<4352||!(PN["Bopomofo Extended"](t)||PN.Bopomofo(t)||PN["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||PN["CJK Compatibility Ideographs"](t)||PN["CJK Compatibility"](t)||PN["CJK Radicals Supplement"](t)||PN["CJK Strokes"](t)||!(!PN["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||PN["CJK Unified Ideographs Extension A"](t)||PN["CJK Unified Ideographs"](t)||PN["Enclosed CJK Letters and Months"](t)||PN["Hangul Compatibility Jamo"](t)||PN["Hangul Jamo Extended-A"](t)||PN["Hangul Jamo Extended-B"](t)||PN["Hangul Jamo"](t)||PN["Hangul Syllables"](t)||PN.Hiragana(t)||PN["Ideographic Description Characters"](t)||PN.Kanbun(t)||PN["Kangxi Radicals"](t)||PN["Katakana Phonetic Extensions"](t)||PN.Katakana(t)&&12540!==t||!(!PN["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!PN["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||PN["Unified Canadian Aboriginal Syllabics"](t)||PN["Unified Canadian Aboriginal Syllabics Extended"](t)||PN["Vertical Forms"](t)||PN["Yijing Hexagram Symbols"](t)||PN["Yi Syllables"](t)||PN["Yi Radicals"](t))))}function IN(t){return!(SN(t)||(e=t,PN["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||PN["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||PN["Letterlike Symbols"](e)||PN["Number Forms"](e)||PN["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||PN["Control Pictures"](e)&&9251!==e||PN["Optical Character Recognition"](e)||PN["Enclosed Alphanumerics"](e)||PN["Geometric Shapes"](e)||PN["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||PN["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||PN["CJK Symbols and Punctuation"](e)||PN.Katakana(e)||PN["Private Use Area"](e)||PN["CJK Compatibility Forms"](e)||PN["Small Form Variants"](e)||PN["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function EN(t){return t>=1424&&t<=2303||PN["Arabic Presentation Forms-A"](t)||PN["Arabic Presentation Forms-B"](t)}const ON=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function RN(t){for(const e of ON)if(t>=e[0]&&t<=e[1])return!0;return!1}const DN={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},kN=1,LN=2;function FN(t,e,n,i,r,o,s,a,h,l){let u=t.trim();l===LN&&(u=function(t){let e="";const n=Array.from(t);for(let i=0;i<n.length;i++){const t=n[i+1].codePointAt(0)||null,r=n[i-1].codePointAt(0)||null;t&&IN(t)&&!DN[n[i+1]]||r&&IN(r)&&!DN[n[i-1]]||!DN[n[i]]?e+=n[i]:e+=DN[n[i]]}return e}(u));const c=[],A={positionedGlyphs:c,text:u,top:a[1],bottom:a[1],left:a[0],right:a[0],writingMode:l};let f;return f=function(t,e){const n=[];let i=0;for(let r=0;r<e.length;r++){const o=e[r];n.push(t.substring(i,o)),i=o}return i<t.length&&n.push(t.substring(i,t.length)),n}(u,function(t,e,n,i){if(!n)return[];if(!t)return[];const r=[],o=function(t,e,n,i){let r=0;for(let o=0;o<t.length;o++){const n=i[t.codePointAt(o)];n&&(r+=n.metrics.advance+e)}return r/Math.max(1,Math.ceil(r/n))}(t,e,n,i);let s=0;for(let a=0;a<t.length;a++){const n=t.codePointAt(a),h=i[n];h&&(h&&!NN[n]&&(s+=h.metrics.advance+e),a<t.length-1&&(zN[n]||TN(n))&&r.push(jN(a+1,s,o,r,HN(n,t.codePointAt(a+1)),!1)))}return UN(jN(t.length,s,o,r,0,!0))}(u,s,n,e)),function(t,e,n,i,r,o,s,a,h){let l=0,u=0,c=0;const A=t.positionedGlyphs;for(let g=0;g<n.length;g++){let t=n[g];if(t=t.trim(),!t.length){u-=i;continue}const r=A.length;for(let n=0;n<t.length;n++){const i=t.codePointAt(n),r=e[i];r&&(SN(i)&&s!==kN?(32!==i&&A.push({glyph:i,x:l,y:0,vertical:!0}),l+=h+a):(32!==i&&A.push({glyph:i,x:l,y:u,vertical:!1}),l+=r.metrics.advance+a))}A.length!==r&&(c=Math.max(l-a,c),VN(A,e,r,A.length-1,.5)),l=0,u-=i}const{horizontalAlign:f,verticalAlign:d}=GN(r,void 0);!function(t,e,n,i,r,o,s){const a=(.5-n)*r,h=-(-i*s+.5)*o;if(a||h)for(let l=0;l<t.length;l++)t[l].x+=a,t[l].y+=h}(A,0,f,d,c,i,n.length);const p=n.length*i;t.top+=-d*p,t.bottom=t.top+p,t.left+=-f*c,t.right=t.left+c}(A,e,f,i,r,0,l,s,h),!!c.length&&A}const NN={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},zN={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function BN(t,e,n,i){const r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function HN(t,e){let n=0;return 10===t&&(n-=1e4),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function jN(t,e,n,i,r,o){let s=null,a=BN(e,n,r,o);for(let h=0;h<i.length;h++){const t=i[h],l=BN(e-t.x,n,r,o)+t.badness;l<=a&&(s=t,a=l)}return{index:t,x:e,priorBreak:s,badness:a}}function UN(t){return t?UN(t.priorBreak).concat(t.index):[]}function GN(t,e){let n=.5,i=.5;switch(t){case"right":case"top-right":case"bottom-right":n=e?1:0;break;case"left":case"top-left":case"bottom-left":n=e?0:1}switch(t){case"bottom":case"bottom-right":case"bottom-left":i=e?1:0;break;case"top":case"top-right":case"top-left":i=e?0:1}return{horizontalAlign:n,verticalAlign:i}}function VN(t,e,n,i,r){const o=e[t[i].glyph];if(o){const e=(t[i].x+o.metrics.advance)*r;if(!e)return;for(let r=n;r<=i;r++)t[r].x-=e}}function WN(t){if(!function(t){for(const e of t)if(EN(e.charCodeAt(0)))return!0;return!1}(t))return t;const e=[],n=[],i=[];let r=0,o=0,s=1,a=1;for(const h of t){const t=h.codePointAt(0);RN(t)?(i.push(h),r++):(s=EN(t)?-1:1,a!==s?(o=r,n.length&&(a>0&&n.reverse(),e.push(...n)),i.length&&(e.splice(o,0,...i),i.length=0),a=s,n.length=0):i.length&&(n.push(...i),i.length=0),n.push(h),r++)}return i.length&&n.push(...i),n.length&&(a>0&&n.reverse(),e.push(...n)),e.reverse().join("")}const qN=/\{ *([\w_]+) *\}/g;let ZN=class{constructor(t,e,n,i,r){this.feature=t,this.symbolDef=e,this.symbol=n,this.options=r,this.ft=this.dt.bind(this),this.Z=i}dt(t,e){return this.feature.properties[e]||""}getShape(t,e){if(this.yt)return this.yt;const{textHorizontalAlignmentFn:n,textVerticalAlignmentFn:i,markerHorizontalAlignmentFn:r,markerVerticalAlignmentFn:o,textWrapWidthFn:s}=this.Z;let a;const h=this.symbol,l=this.getIconAndGlyph(),u=this.feature.properties;if(l&&l.glyph){const{font:t,text:r}=l.glyph;if(""===r)return null;const o=this.size[0]/24,c=24,A=h.textKeepUpright,f="map"===h.textRotationAlignment&&"line"===h.textPlacement&&!h.isIconText,d=e.glyphMap[t],p=QN(n?n(null,u):h.textHorizontalAlignment,i?i(null,u):h.textVerticalAlignment),g=1.2*c,m=function(t){for(let e=0;e<t.length;e++)if(!MN(t.charAt(e).charCodeAt(0)))return!1;return!0}(r),y=m&&h.textLetterSpacing/o||0,v=[h.textDx/o||0,h.textDy/o||0],_=((s?s(null,u):h.textWrapWidth)||10*c)/o;a={},a.horizontal=FN(r,d,_,g,p,0,y,v,c,kN),m&&f&&A&&(a.vertical=FN(r,d,_,g,p,0,y,v,c,LN))}else if(l&&l.icon){if(!t||!t.positions[l.icon.url])return null;const e=QN(r?r(null,u):h.markerHorizontalAlignment,o?o(null,u):h.markerVerticalAlignment);a=function(t,e,n){let{horizontalAlign:i,verticalAlign:r}=GN(e,n);n?i=1-i:r=1-r;const o=-2048*i,s=-2048*r;return{image:t,top:s,bottom:s+2048,left:o,right:o+2048}}(t.positions[l.icon.url],e,this.options.isVector3D),this.size||(this.size=a.image.displaySize)}return this.yt=a,a}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:t,markerTypeFn:e,markerPathFn:n,markerWidthFn:i,markerHeightFn:r,markerFillFn:o,markerFillPatternFileFn:s,markerFillOpacityFn:a,markerTextFitFn:h,markerTextFitPaddingFn:l,markerLineColorFn:u,markerLineWidthFn:c,markerLineOpacityFn:A,markerLineDasharrayFn:f,markerLinePatternFileFn:d,markerPathWidthFn:p,markerPathHeightFn:g,textNameFn:m,textFaceNameFn:y}=this.Z,{zoom:v}=this.options,_={},x=this.symbol,b=this.feature.properties,w=t?t(null,b):x.markerFile,C=e?e(null,b):x.markerType,P=w||C||x.markerPath,M=!DD(this.symbolDef.textName);let T;if(P){T=function(t,e,n,i,r,o){if(DD(e.markerWidth)&&DD(e.markerHeight))return null;const s="__fn_markerWidth".trim(),a="__fn_markerHeight".trim();let h=e.markerWidth||0,l=e.markerHeight||0;return LD(h)&&("identity"!==h.type?h=_N(h):(h=t.markerWidth,t[s]&&(h=t[s](i,n)),LD(h)&&(h="identity"===h.type?r(i,n):_N(h)))),LD(l)&&("identity"!==l.type?l=_N(l):(l=t.markerHeight,t[a]&&(l=t[a](i,n)),LD(l)&&(l="identity"===l.type?o(i,n):_N(l)))),[h,l]}(x,this.symbolDef,b,v,i,r)||[0,0];let t=x.markerTextFit;if(h&&(t=h(v,b)),t&&x.text&&"none"!==t){const e=x.text.textSize;let n=x.text.textName;SE(n)&&(n=EE(n)(v,b));const i=wN(n,b);if(i){const n="__fn_textSize".trim(),r="__fn_textSize_0".trim();SE(e)&&!x.text[n]&&(x.text[r]=EE(e),x.text[n]=(t,e)=>{const n=x.text[r](t,e);return SE(n)?EE(n)(t,e):n});const o=vN(x.text,x.text,b,v);if("width"!==t&&"both"!==t||(T[0]=o[0]*i.length),"height"!==t&&"both"!==t||(T[1]=o[1]),o[0]&&o[1]){let t=x.markerTextFitPadding||[0,0,0,0];l&&(t=l(v,b)),T[0]+=t[1]+t[3],T[1]+=t[0]+t[2]}}else T[0]=T[1]=-1}}if(M&&(T=vN(x,this.symbolDef,b,v)),!T)return _;if(T[0]=Math.ceil(T[0]),T[1]=Math.ceil(T[1]),this.size=T,P&&T[0]>=0&&T[1]>=0){let t;if(C){const e={};if(e.markerType=C,"path"===C&&(e.markerPath=n?n(null,b):x.markerPath,e.markerPathWidth=p?p(null,b):x.markerPathWidth,e.markerPathHeight=g?g(null,b):x.markerPathHeight),i){const t=i(null,b);DD(t)||(e.markerWidth=t)}else x.markerWidth>=0&&(e.markerWidth=x.markerWidth);if(r){const t=r(null,b);DD(t)||(e.markerHeight=t)}else x.markerHeight>=0&&(e.markerHeight=x.markerHeight);if(o){const t=o(null,b);DD(t)||(e.markerFill=t)}else x.markerFill&&(e.markerFill=x.markerFill);if(s){const t=s(null,b);DD(t)||(e.markerFillPatternFile=t)}else x.markerFillPatternFile&&(e.markerFillPatternFile=x.markerFillPatternFile);if(a){const t=a(null,b);DD(t)||(e.markerFillOpacity=t)}else x.markerFillOpacity>=0&&(e.markerFillOpacity=x.markerFillOpacity);if(u){const t=u(null,b);DD(t)||(e.markerLineColor=t)}else x.markerLineColor&&(e.markerLineColor=x.markerLineColor);if(c){const t=c(null,b);DD(t)||(e.markerLineWidth=t)}else x.markerLineWidth>=0&&(e.markerLineWidth=x.markerLineWidth);if(A){const t=A(null,b);DD(t)||(e.markerLineOpacity=t)}else x.markerLineOpacity>=0&&(e.markerLineOpacity=x.markerLineOpacity);if(f){const t=f(null,b);DD(t)||(e.markerLineDasharray=t)}else x.markerLineDasharray&&(e.markerLineDasharray=x.markerLineDasharray);if(d){const t=d(null,b);DD(t)||(e.markerLinePatternFile=t)}else x.markerLinePatternFile&&(e.markerLinePatternFile=x.markerLinePatternFile);t="vector://"+JSON.stringify(e)}else t=w?w.replace(qN,this.ft):x.markerPath?function(t,e,n){if(!t.markerPath)return null;let i=1;const r=function(t){const e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}(t);kD(t.markerOpacity)&&(i=t.markerOpacity),kD(t.opacity)&&(i*=t.opacity);const o={};if(r){for(const t in r.stroke)zD(r.stroke,t)&&(DD(r.stroke[t])||(o[t]=r.stroke[t]));for(const t in r.fill)zD(r.fill,t)&&(DD(r.fill[t])||(o[t]=r.fill[t]))}const s=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];let a;const h=[];for(let u=0;u<s.length;u++)a=FD(s[u])?{path:s[u]}:s[u],a=RD({},a,o),a.d=a.path,delete a.path,h.push(a);const l=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];i<1&&l.push('opacity="'+i+'"'),t.markerPathWidth&&t.markerPathHeight&&l.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),l.push('preserveAspectRatio="none"'),e&&l.push('width="'+e+'"'),n&&l.push('height="'+n+'"'),l.push("><defs></defs>");for(let u=0;u<h.length;u++){let t="<path ";for(const e in h[u])zD(h[u],e)&&(t+=" "+e+'="'+h[u][e]+'"');t+="></path>",l.push(t)}return l.push("</svg>"),"data:image/svg+xml;base64,"+btoa(l.join(" "))}(x,T[0],T[1]):null;_.icon={url:t,size:T}}if(M){const t=m?m(this.options.zoom,b):x.textName;if(t||0===t){const e=function(t){return t||"Open Sans Regular"}(y?y(null,b):x.textFaceName);let n=wN(t,b);n&&n.length&&(n=WN(n),_.glyph={font:e,text:n})}}return this.iconGlyph=_,_}};function QN(t,e){e&&"middle"!==e||(e="center"),t&&"middle"!==t||(t="center");let n="center"!==e?e:"";return n+="center"!==t?(n.length?"-":"")+t:"",n}function XN(t,e,n,i,r){const o=[];let s;for(let a=0;a<t.length;a++){const h=t[a];let l,u=!1;for(let t=0;t<h.length-1;t++){let a=h[t],c=h[t+1];a.x<e&&c.x<e||(a.x<e?(s=a,a=new $R(e,a.y+(e-a.x)/(c.x-a.x)*(c.y-a.y)).F(),a.z=s.z+(e-s.x)/(c.x-s.x)*(c.z-s.z),u=!0):c.x<e&&(s=c,c=new $R(e,a.y+(e-a.x)/(c.x-a.x)*(c.y-a.y)).F(),c.z=a.z+(e-a.x)/(s.x-a.x)*(s.z-a.z),u=!0),a.y<n&&c.y<n||(a.y<n?(s=a,a=new $R(a.x+(n-a.y)/(c.y-a.y)*(c.x-a.x),n).F(),a.z=s.z+(n-s.y)/(c.y-s.y)*(c.z-s.z),u=!0):c.y<n&&(s=c,c=new $R(a.x+(n-a.y)/(c.y-a.y)*(c.x-a.x),n).F(),c.z=a.z+(n-a.y)/(s.y-a.y)*(s.z-a.z),u=!0),a.x>=i&&c.x>=i||(a.x>=i?(s=a,a=new $R(i,a.y+(i-a.x)/(c.x-a.x)*(c.y-a.y)).F(),a.z=s.z+(i-s.x)/(c.x-s.x)*(c.z-s.z),u=!0):c.x>=i&&(s=c,c=new $R(i,a.y+(i-a.x)/(c.x-a.x)*(c.y-a.y)).F(),c.z=a.z+(i-a.x)/(s.x-a.x)*(s.z-a.z),u=!0),a.y>=r&&c.y>=r||(a.y>=r?(s=a,a=new $R(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r).F(),a.z=s.z+(r-s.y)/(c.y-s.y)*(c.z-s.z),u=!0):c.y>=r&&(s=c,c=new $R(a.x+(r-a.y)/(c.y-a.y)*(c.x-a.x),r).F(),c.z=a.z+(r-a.y)/(s.y-a.y)*(s.z-a.z),u=!0),l&&a.equals(l[l.length-1])||(l=[a],o.push(l)),u&&(l.clipped=!0),l.push(c)))))}}return o}let YN=class t extends $R{constructor(t,e,n,i){super(t,e),this.angle=n,void 0!==i&&(this.segment=i)}clone(){return new t(this.x,this.y,this.angle,this.segment)}};function JN(t,e,n,i,r){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const h=[];let l=0;for(;a<n/2;){const e=t[s],n=t[s+1];if(!n)return!1;let o=t[s-1].angleTo(e)-e.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),h.push({distance:a,angleDelta:o}),l+=o;a-h[0].distance>i;)l-=h.shift().angleDelta;if(l>r)return!1;s++,a+=e.dist(n)}return!0}function KN(t,e,n,i,r,o,s,a,h,l,u){const c=(d=o,p=s,i?.6*d*p:0),A=function(t){return Math.max(t?t.right-t.left:0,0)}(i),f=0===t[0].x||t[0].x===h||0===t[0].y||t[0].y===h;var d,p;return e-A*s<e/4&&(e=A*s+e/4),$N(t,f?e/2*a%e:(A/2+2*o)*s*a%e,e,c,n,A*s,f,!1,h,l,u)}function $N(t,e,n,i,r,o,s,a,h,l,u){let c=0;const A=o/2,f=function(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}(t);let d=0,p=e-n,g=[];for(let m=0;m<t.length-1;m++){const e=t[m],s=t[m+1],a=e.dist(s),y=s.angleTo(e);for(;p+n<d+a;){p+=n;const v=(p-d)/a,_=tz(e.x,s.x,v),x=tz(e.y,s.y,v),b=tz(e.z||0,s.z||0,v);if(_>=0&&_<h&&x>=0&&x<h&&p-A>=0&&p+A<=f){const n=new YN(_,x,y,m);n.z=b,l&&(n.axis=[e.y-x,_-e.x],n.angleR=b===(e.z||0)?0:Math.atan(.9*(b-(e.z||0))*u/e.dist(n))),n.line=t,n.F(),!i||JN(t,n,o,i,r)?g.push(n):i&&c++}}d+=a}return a||g.length||s||(g=$N(t,d/2,n,i,r,o,s,!0,h,l,u)),g.countOutOfAngle=c,g}function tz(t,e,n){return t*(1-n)+e*n}function ez(t,e){const n=t.length;if(n<=1)return[t];const i=[];let r,o;for(let s=0;s<n;s++){const e=pD(t[s]);0!==e&&(t[s].area=Math.abs(e),void 0===o&&(o=e<0),o===e<0?(r&&i.push(r),r=[t[s]]):r.push(t[s]))}if(r&&i.push(r),e>1)for(let s=0;s<i.length;s++)i[s].length<=e||(zO(i[s],e,1,i[s].length-1,nz),i[s]=i[s].slice(0,e));return i}function nz(t,e){return e.area-t.area}let iz=class{constructor(t=[],e=rz){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this.gt(n)}push(t){this.data.push(t),this.length++,this.vt(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this.gt(0)),t}peek(){return this.data[0]}vt(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,o=e[r];if(n(i,o)>=0)break;e[t]=o,t=r}e[t]=i}gt(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1),o=e[i];const s=i+1;if(s<this.length&&n(e[s],o)<0&&(i=s,o=e[s]),n(o,r)>=0)break;e[t]=o,t=i}e[t]=r}};function rz(t,e){return t<e?-1:t>e?1:0}function oz(t,e,n){const i=e.distSqr(n);if(0===i)return t.distSqr(e);const r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e).A(r).i(e))}function sz(t,e=1,n=!1){let i=1/0,r=1/0,o=-1/0,s=-1/0;const a=t[0];for(let f=0;f<a.length;f++){const t=a[f];(!f||t.x<i)&&(i=t.x),(!f||t.y<r)&&(r=t.y),(!f||t.x>o)&&(o=t.x),(!f||t.y>s)&&(s=t.y)}const h=Math.min(o-i,s-r);let l=h/2;const u=new iz([],az);if(0===h)return new $R(i,r);for(let f=i;f<o;f+=h)for(let e=r;e<s;e+=h)u.push(new hz(f+l,e+l,l,t));let c=function(t){let e=0,n=0,i=0;const r=t[0];for(let o=0,s=r.length,a=s-1;o<s;a=o++){const t=r[o],s=r[a],h=t.x*s.y-s.x*t.y;n+=(t.x+s.x)*h,i+=(t.y+s.y)*h,e+=3*h}return new hz(n/e,i/e,0,t)}(t),A=u.length;for(;u.length;){const i=u.pop();(i.d>c.d||!c.d)&&(c=i,n&&Math.round(1e4*i.d)),i.max-c.d<=e||(l=i.h/2,u.push(new hz(i.p.x-l,i.p.y-l,l,t)),u.push(new hz(i.p.x+l,i.p.y-l,l,t)),u.push(new hz(i.p.x-l,i.p.y+l,l,t)),u.push(new hz(i.p.x+l,i.p.y+l,l,t)),A+=4)}return n&&c.d,c.p}function az(t,e){return e.max-t.max}function hz(t,e,n,i){this.p=new $R(t,e),this.h=n,this.d=function(t,e){let n=!1,i=1/0;for(let r=0;r<e.length;r++){const o=e[r];for(let e=0,r=o.length,s=r-1;e<r;s=e++){const r=o[e],a=o[s];r.y>t.y!=a.y>t.y&&t.x<(a.x-r.x)*(t.y-r.y)/(a.y-r.y)+r.x&&(n=!n),i=Math.min(i,oz(t,r,a))}}return(n?1:-1)*Math.sqrt(i)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}function lz(t,e){const n={},i={},r=[];let o=0;function s(e){r.push(t[e]),o++}function a(t,e,n){const o=i[t];return delete i[t],i[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(n[0]),o}function h(t,e,i){const o=n[e];return delete n[e],n[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function l(t,e,n){const i=n?e[0][e[0].length-1]:e[0][0];return`${t}:${i.x}:${i.y}`}for(let u=0;u<t.length;u++){const c=t[u],A=c.geometry;if(!A)continue;const f=c.properties[e]?c.properties[e].toString():null;if(!f){s(u);continue}const d=l(f,A),p=l(f,A,!0);if(d in i&&p in n&&i[d]!==n[p]){const t=h(d,p,A),e=a(d,p,r[t].geometry);delete n[d],delete i[p],i[l(f,r[e].geometry,!0)]=e,r[t].geometry=null}else d in i?a(d,p,A):p in n?h(d,p,A):(s(u),n[d]=o-1,i[p]=o-1)}return r.filter((t=>t.geometry))}const uz="__index";function cz(t,e,n,i){const r=(uz+"").trim(),o=function(t,e,n,i){const r=(uz+"").trim(),{mergeOnPropertyFn:o}=n;if(!e.mergeOnProperty)return[];if(!vD(s=e.mergeOnProperty)&&("string"==typeof s||null!==s.constructor&&s.constructor===String))return[{features:t,property:e.mergeOnProperty}];var s;const a=[],h={},l=[];for(let u=0;u<t.length;u++){t[u][r]=u;const n=t[u].properties=t[u].properties||{};n.$layer=t[u].layer,n.$type=t[u].type;const s=o?o(i,n):e.mergeOnProperty;vD(s)?l.push(t[u]):(void 0===h[s]&&(h[s]=a.length,a.push({features:[],property:s})),a[h[s]].features.push(t[u]))}return l.length&&a.push({features:l}),a}(t,e,n,i);if(o.length){const e=[];for(let n=0;n<o.length;n++)e.push(o[n].property?lz(o[n].features,o[n].property):t);if(1===e.length)return e[0];{let t=[];for(let n=0;n<e.length;n++)t=t.concat(e[n]);return t.sort(((t,e)=>t[r]-e[r])),t}}return[]}let Az=class t extends pN{static needMerge(t,e,n){if(!t)return!1;let i="line"===t.textPlacement||"line"===t.markerPlacement;return i||(e.textPlacementFn&&(i="line"===e.textPlacementFn(n)),e.markerPlacementFn&&(i="line"===e.markerPlacementFn(n))),t.mergeOnProperty&&i}static mergeLineFeatures(t,e,n,i){let r=e.textPlacement,o=e.markerPlacement;return n.textPlacementFn&&(r=n.textPlacementFn(i)),n.markerPlacementFn&&(o=n.markerPlacementFn(i)),"line"!==r&&"line"!==o?t:cz(t,e,n,i)}static splitPointSymbol(e,n=0){const i=[];if(Array.isArray(e)){const n=e;for(let e=0;e<n.length;e++)n[e]&&i.push(...t.splitPointSymbol(n[e],e));return i}let r=null,o=null;for(const t in e)0===t.indexOf("marker")?(r=r||{},r[t]=e[t]):0===t.indexOf("text")&&(o=o||{},o[t]=e[t]);return r&&(r.isIconText=!0,e.mergeOnProperty&&(r.mergeOnProperty=e.mergeOnProperty),i.push(r)),o&&(r&&(o.textPlacement=r.markerPlacement,o.textSpacing=r.markerSpacing,o.isIconText=!0),e.mergeOnProperty&&(o.mergeOnProperty=e.mergeOnProperty),i.push(o)),void 0!==e.visible&&(r&&(r.visible=e.visible),o&&(o.visible=e.visible)),r&&(r.markerTextFit&&o&&(r.text={},r.text.textName=o.textName,r.text.textSize=o.textSize),r.index={index:n,type:0}),o&&(o.index={index:n,type:1}),i}static isAtlasLoaded(t,e){const{icon:n,glyph:i}=t,{iconAtlas:r,glyphAtlas:o}=e;if(n&&(!r||!r.positions[n.url]))return!1;if(i){if(!o||!o.positions[i.font])return!1;const t=o.positions[i.font],{text:e}=i;for(const n of e)if(!t[n.codePointAt(0)])return!1}return!0}constructor(t,e,n){super(t,e,n),this.xt=e.textPlacement,this.Z.textPlacementFn&&(this.xt=this.Z.textPlacementFn(this.options.zoom))}createStyledVector(t,e,n,i,r,o){const s=new ZN(t,this.symbolDef,e,n,i),a=s.getIconAndGlyph();if(a.icon&&!this.options.atlas){const{url:t,size:e}=a.icon;r[t]||(r[t]=a.icon.size),r[t][0]<e[0]&&(r[t][0]=e[0]),r[t][1]<e[1]&&(r[t][1]=e[1])}if(a.glyph&&!this.options.atlas){const{font:t,text:e}=a.glyph,n=o[t]=o[t]||{};for(const i of e)n[i.codePointAt(0)]=1;"line"===this.xt&&(o.options={isCharsCompact:!1})}return this.options.allowEmptyPack||a.icon||a.glyph?s:null}getFormat(t){const e=void 0!==t.textName,n=e?this.getPackSDFFormat(t):this.getPackMarkerFormat();e?n.push(...this.bt()):n.push(...this.wt());const{markerOpacityFn:i,textOpacityFn:r,markerPitchAlignmentFn:o,textPitchAlignmentFn:s,markerRotationAlignmentFn:a,textRotationAlignmentFn:h,markerRotationFn:l,textRotationFn:u,markerAllowOverlapFn:c,textAllowOverlapFn:A,markerIgnorePlacementFn:f,textIgnorePlacementFn:d}=this.Z;return(i||r)&&n.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(o||s)&&n.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(a||h)&&n.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(l||u)&&n.push({type:Uint16Array,width:1,name:"aRotation"}),(c||A||f||d)&&n.push({type:Uint8Array,width:1,name:"aOverlap"}),n}At(){return this.hasMapPitchAlign}bt(){const{textFillFn:t,textSizeFn:e,textHaloFillFn:n,textHaloRadiusFn:i,textHaloOpacityFn:r,textDxFn:o,textDyFn:s}=this.Z,a=[];return t&&a.push({type:Uint8Array,width:4,name:"aTextFill"}),e&&a.push({type:Uint8Array,width:1,name:"aTextSize"}),n&&a.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),i&&a.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),r&&a.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),o&&a.push({type:Int8Array,width:1,name:"aTextDx"}),s&&a.push({type:Int8Array,width:1,name:"aTextDy"}),a}wt(){const{markerWidthFn:t,markerHeightFn:e,markerDxFn:n,markerDyFn:i}=this.Z,r=[];return t&&r.push({type:this.options.markerWidthType||Uint8Array,width:1,name:"aMarkerWidth"}),e&&r.push({type:this.options.markerHeightType||Uint8Array,width:1,name:"aMarkerHeight"}),n&&r.push({type:Int8Array,width:1,name:"aMarkerDx"}),i&&r.push({type:Int8Array,width:1,name:"aMarkerDy"}),r}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.countOutOfAngle=0,this.lineVertex=[];const t=super.createDataPack.apply(this,arguments);return t?(t.lineVertex=new Int16Array(this.lineVertex),t.buffers.push(t.lineVertex.buffer),t):null}placeVector(t,e){const n=t.getShape(this.iconAtlas,this.glyphAtlas);if(!(this.options.allowEmptyPack||n&&n.image||n&&(n.horizontal||n.vertical)))return;const i=this.Mt(t,n,e);if(this.countOutOfAngle+=i.countOutOfAngle||0,0===i.length)return;const r=this.data,o=this.needAltitudeAttribute()?2:3;let s=this.data.aPosition.getLength()/o;const a=t.symbol,h=t.feature.properties,l="line"===this.xt&&!a.isIconText,u=void 0!==a.textName,c=u&&l&&function(t){let e=0;for(let n=0;n<t.length;n++)if(SN(t.charAt(n).charCodeAt(0)))e=0;else if(e++,e>=1)return!1;return!0}(t.getIconAndGlyph().glyph.text)?1:0,{textFillFn:A,textSizeFn:f,textHaloFillFn:d,textHaloRadiusFn:p,textHaloOpacityFn:g,textDxFn:m,textDyFn:y,textPitchAlignmentFn:v,textRotationAlignmentFn:_,textRotationFn:x,textAllowOverlapFn:b,textIgnorePlacementFn:w,textOpacityFn:C,markerWidthFn:P,markerHeightFn:M,markerDxFn:T,markerDyFn:S,markerPitchAlignmentFn:I,markerRotationAlignmentFn:E,markerRotationFn:O,markerAllowOverlapFn:R,markerIgnorePlacementFn:D,markerOpacityFn:k}=this.Z;let L,F,N,z,B,H,j,U,G,V,W,q,Z,Q,X,Y,J;if(u){const e=t.getIconAndGlyph().glyph.font;L=function(t,e,n){const i=t.positionedGlyphs,r=[];for(let o=0;o<i.length;o++){const s=i[o],a=n[s.glyph];if(!a)continue;const h=a.rect;if(!h)continue;const l=4,u=a.metrics.advance/2,c=a.metrics.height/2,A=e?[s.x+u,0]:[0,0],f=e?[0,s.y-c]:[s.x+u,s.y-c],d=a.metrics.left-l-u+f[0],p=a.metrics.top-l+f[1],g=d+h.w,m=p+h.h,y=new $R(d,p),v=new $R(g,p),_=new $R(d,m),x=new $R(g,m);if(e&&s.vertical){const t=new $R(-u,u),e=-Math.PI/2,n=new $R(5,0);y.k(e,t).i(n),v.k(e,t).i(n),_.k(e,t).i(n),x.k(e,t).i(n)}r.push({tl:y,tr:v,bl:_,br:x,tex:h,writingMode:t.writingMode,glyphOffset:A})}return r}(n.horizontal,l,this.glyphAtlas.positions[e]),A&&(F=A(null,h),SE(F)?(this.dynamicAttrs.aTextFill=1,F=[0,0,0,0]):F=jD([],F)),f&&(N=f(this.options.zoom,h),vD(N)&&(N=14)),d&&(z=d(null,h),SE(z)?(this.dynamicAttrs.aTextHaloFill=1,z=[0,0,0,0]):z=jD([],z)),p&&(B=p(null,h)),g&&(H=255*g(null,h)),m&&(j=m(null,h)||0),y&&(U=y(null,h)||0),v&&(Z=+("map"===v(null,h))),_&&(Q=+("map"===_(null,h))),x&&(X=_D(x(null,h),0,360)*Math.PI/180)}else L=n?function(t){const e=t.image,n=t.top-1/e.pixelRatio,i=t.left-1/e.pixelRatio,r=t.bottom+1/e.pixelRatio,o=t.right+1/e.pixelRatio;let s,a,h,l;return s=new $R(i,n),a=new $R(o,n),h=new $R(o,r),l=new $R(i,r),[{tl:s,tr:a,bl:l,br:h,tex:{x:e.tl[0],y:e.tl[1],w:e.displaySize[0],h:e.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(n):function(){const t=new $R(0,0),e=new $R(0,0),n=new $R(0,0);return[{tl:t,tr:e,bl:new $R(0,0),br:n,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),P&&(G=P(null,h)),vD(G)&&(G=L[0].tex.w),M&&(V=M(null,h)),vD(V)&&(V=L[0].tex.h),T&&(W=T(null,h)),S&&(q=S(null,h)),I&&(Z=+("map"===I(null,h))),E&&(Q=+("map"===E(null,h))),O&&(X=_D(O(null,h),0,360)*Math.PI/180);SE(N)&&(this.dynamicAttrs.aTextSize=1),SE(B)&&(this.dynamicAttrs.aTextHaloRadius=1),SE(H)&&(this.dynamicAttrs.aTextHaloOpacity=1),SE(j)&&(this.dynamicAttrs.aTextDx=1),SE(U)&&(this.dynamicAttrs.aTextDy=1),SE(G)&&(this.dynamicAttrs.aMarkerWidth=1),SE(V)&&(this.dynamicAttrs.aMarkerHeight=1),SE(W)&&(this.dynamicAttrs.aMarkerDx=1),SE(q)&&(this.dynamicAttrs.aMarkerDy=1),SE(Z)&&(this.dynamicAttrs.aPitchAlign=1),SE(Q)&&(this.dynamicAttrs.aRotationAlign=1),SE(X)&&(this.dynamicAttrs.aRotation=1);const K=R||b;K&&(Y=K(null,h)||0);const $=D||w;let tt;$&&(J=$(null,h)||0);const et=C||k;et&&(tt=255*et(this.options.zoom,h));const nt=L.length;this.ensureDataCapacity(4*nt,i.length);const it=this.options.EXTENT,{altitudeScale:rt,altitudeProperty:ot,defaultAltitude:st}=this.options,{altitude:at}=mD(t.feature,rt,ot,st);for(let ht=0;ht<i.length;ht++){const t=i[ht],e=t.z||at||0;if(it!==1/0&&yD(t,it))continue;const n=t.x,o=t.y,a=L.length;for(let i=0;i<a;i++){const a=L[i],{tl:h,tr:A,bl:f,br:d,tex:p}=a;this._t(r,n,o,e,10*h.x,10*h.y,p.x,p.y+p.h),u&&this.St(r,l,nt,a.glyphOffset,t,c,t.axis,t.angleR),this.kt(r,F,N,z,B,H,j,U,G,V,W,q,tt,Z,Q,X,Y,J),this._t(r,n,o,e,10*A.x,10*A.y,p.x+p.w,p.y+p.h),u&&this.St(r,l,nt,a.glyphOffset,t,c,t.axis,t.angleR),this.kt(r,F,N,z,B,H,j,U,G,V,W,q,tt,Z,Q,X,Y,J),this._t(r,n,o,e,10*f.x,10*f.y,p.x,p.y),u&&this.St(r,l,nt,a.glyphOffset,t,c,t.axis,t.angleR),this.kt(r,F,N,z,B,H,j,U,G,V,W,q,tt,Z,Q,X,Y,J),this._t(r,n,o,e,10*d.x,10*d.y,p.x+p.w,p.y),u&&this.St(r,l,nt,a.glyphOffset,t,c,t.axis,t.angleR),this.kt(r,F,N,z,B,H,j,U,G,V,W,q,tt,Z,Q,X,Y,J),this.addElements(s,s+1,s+2),this.addElements(s+1,s+2,s+3),s+=4;const g=Math.max(Math.abs(n),Math.abs(o),Math.abs(e));g>this.maxPos&&(this.maxPos=g)}}}_t(t,e,n,i,r,o,s,a){this.fillPosition(t,e,n,i);let h=t.aShape.currentIndex;t.aShape[h++]=r,t.aShape[h++]=o,t.aShape.currentIndex=h,h=t.aTexCoord.currentIndex,t.aTexCoord[h++]=s,t.aTexCoord[h++]=a,t.aTexCoord.currentIndex=h}St(t,e,n,i,r,o,s,a){let h=t.aCount.currentIndex;if(t.aCount[h++]=n,t.aCount.currentIndex=h,e){h=t.aGlyphOffset.currentIndex,t.aGlyphOffset[h++]=i[0],t.aGlyphOffset[h++]=i[1],t.aGlyphOffset.currentIndex=h,this.At()&&(h=t.aPitchRotation.currentIndex,t.aPitchRotation[h++]=s[0],t.aPitchRotation[h++]=s[1],t.aPitchRotation[h++]=a,t.aPitchRotation.currentIndex=h);const e=r.startIndex;h=t.aSegment.currentIndex,t.aSegment[h++]=r.segment+e,t.aSegment[h++]=e,t.aSegment[h++]=r.line.length,t.aSegment.currentIndex=h,h=t.aVertical.currentIndex,t.aVertical[h++]=o,t.aVertical.currentIndex=h}}kt(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d,p,g,m){const{textFillFn:y,textSizeFn:v,textHaloFillFn:_,textHaloRadiusFn:x,textHaloOpacityFn:b,textDxFn:w,textDyFn:C,textPitchAlignmentFn:P,textRotationAlignmentFn:M,textRotationFn:T,textAllowOverlapFn:S,textIgnorePlacementFn:I,textOpacityFn:E,markerWidthFn:O,markerHeightFn:R,markerDxFn:D,markerDyFn:k,markerPitchAlignmentFn:L,markerRotationAlignmentFn:F,markerRotationFn:N,markerAllowOverlapFn:z,markerIgnorePlacementFn:B,markerOpacityFn:H}=this.Z;if(y){let n=t.aTextFill.currentIndex;t.aTextFill[n++]=e[0],t.aTextFill[n++]=e[1],t.aTextFill[n++]=e[2],t.aTextFill[n++]=e[3],t.aTextFill.currentIndex=n}if(v){let e=t.aTextSize.currentIndex;t.aTextSize[e++]=n,t.aTextSize.currentIndex=e}if(_){let e=t.aTextHaloFill.currentIndex;t.aTextHaloFill[e++]=i[0],t.aTextHaloFill[e++]=i[1],t.aTextHaloFill[e++]=i[2],t.aTextHaloFill[e++]=i[3],t.aTextHaloFill.currentIndex=e}if(x){let e=t.aTextHaloRadius.currentIndex;t.aTextHaloRadius[e++]=r,t.aTextHaloRadius.currentIndex=e}if(b){let e=t.aTextHaloOpacity.currentIndex;t.aTextHaloOpacity[e++]=o,t.aTextHaloOpacity.currentIndex=e}if(w){let e=t.aTextDx.currentIndex;t.aTextDx[e++]=s,t.aTextDx.currentIndex=e}if(C){let e=t.aTextDy.currentIndex;t.aTextDy[e++]=a,t.aTextDy.currentIndex=e}if(O){let e=t.aMarkerWidth.currentIndex;t.aMarkerWidth[e++]=h,t.aMarkerWidth.currentIndex=e}if(R){let e=t.aMarkerHeight.currentIndex;t.aMarkerHeight[e++]=l,t.aMarkerHeight.currentIndex=e}if(D){let e=t.aMarkerDx.currentIndex;t.aMarkerDx[e++]=u,t.aMarkerDx.currentIndex=e}if(k){let e=t.aMarkerDy.currentIndex;t.aMarkerDy[e++]=c,t.aMarkerDy.currentIndex=e}if(H||E){let e=t.aColorOpacity.currentIndex;t.aColorOpacity[e++]=A,t.aColorOpacity.currentIndex=e}if(P||L){let e=t.aPitchAlign.currentIndex;t.aPitchAlign[e++]=f,t.aPitchAlign.currentIndex=e}if(F||M){let e=t.aRotationAlign.currentIndex;t.aRotationAlign[e++]=d,t.aRotationAlign.currentIndex=e}if(N||T){let e=t.aRotation.currentIndex;t.aRotation[e++]=9362*p,t.aRotation.currentIndex=e}const j=z||S,U=B||I;if(j||U){let e=t.aOverlap.currentIndex;t.aOverlap[e++]=(j?8:0)+4*g+((U?2:0)+m),t.aOverlap.currentIndex=e}r>0&&(this.properties.hasHalo=1)}Mt(t,e,n){const{feature:i,symbol:r}=t,o=this.Pt(t,r),s=i.properties,{markerSpacingFn:a,textSpacingFn:h,textMaxAngleFn:l}=this.Z,u=((a?a(null,s):r.markerSpacing)||(h?h(null,s):r.textSpacing)||250)*n;let c=l?l(this.options.zoom,s):r.textMaxAngle;vD(c)&&(c=80),c*=Math.PI/180;const A=this.options.EXTENT,f=this.options.altitudeToTileScale,d=this.At();return function(t,e,n,i,r,o,s,a,h,l){const{feature:u,size:c,symbol:A}=t,f=c?24:0,d=r*(c?c[0]/f:1);if("line"===s){const t=[];t.countOutOfAngle=0;let r=u.geometry;o&&(r=XN(u.geometry,0,0,o,o));for(let s=0;s<r.length;s++){const u=KN(r[s],a,n,A.isIconText?null:i&&i.vertical||i&&i.horizontal||i,0,f,A.isIconText?1:d,1,o||1/0,h,l);if(A.textPlacement&&!A.isIconText)for(let t=0;t<u.length;t++)u[t].startIndex=e.length/3;if(t.push.apply(t,u),A.textPlacement&&!A.isIconText)for(let t=0;t<r[s].length;t++)e.push(r[s][t].x,r[s][t].y,r[s][t].z||0);t.countOutOfAngle+=u.countOutOfAngle||0}return t}return function(t,e,n){const i=[];if(3===t.type){const r=ez(t.geometry,0);for(let t=0;t<r.length;t++){const o=r[t];if("vertex"===e)for(let t=0;t<o.length;t++){const e=o[t];for(let t=0;t<e.length;t++)yD(e[t],n)||i.push(e[t])}else if("vertex-first"===e){const t=o[0];t&&t[0]&&!yD(t[0],n)&&i.push(t[0])}else if("vertex-last"===e||"vertex-firstlast"===e){const t=o[0];"vertex-firstlast"===e&&t&&t[0]&&!yD(t[0],n)&&i.push(t[0]),t&&t[t.length-1]&&!yD(t[t.length-1],n)&&i.push(t[t.length-1])}else{const t=sz(o,16);yD(t,n)||i.push(t)}}}else if(2===t.type)for(let r=0;r<t.geometry.length;r++){const o=t.geometry[r];if("vertex"===e)for(let t=0;t<o.length;t++)yD(o[t],n)||i.push(o[t]);else"vertex-last"===e||"vertex-firstlast"===e?("vertex-firstlast"!==e||yD(o[0],n)||i.push(o[0]),o&&o[o.length-1]&&!yD(o[o.length-1],n)&&i.push(o[o.length-1])):yD(o[0],n)||i.push(o[0])}else if(1===t.type)for(let r=0;r<t.geometry.length;r++){const e=t.geometry[r];for(let t=0;t<e.length;t++){const r=e[t];yD(r,n)||i.push(r)}}return i}(u,s,o)}(t,this.lineVertex,c,e,n,A,o,u,d,f)}Pt(t,e){let n;return n=this.Z.markerPlacementFn?this.Z.markerPlacementFn(this.options.zoom,t.feature.properties):e.markerPlacement||this.xt,this.ut||!e.markerPlacement&&!e.isIconText||(this.ut=n),!this.xt||e.isIconText||this.ct||(this.ct=n),n}getPackSDFFormat(t){if("line"!==this.xt||t.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const t=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this.At()&&t.push({type:Float32Array,width:3,name:"aPitchRotation"}),t}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}},fz=class t{constructor(t){this.x=t.x,this.y=t.y,this.z=t.z||0}clone(){return new t(this)}T(){return this.M(this.mag()),this}M(t){return this.x/=t,this.y/=t,this.z/=t,this}I(){var t=this.y;return this.y=this.x,this.x=-t,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(t){return this.clone().i(t)}sub(t){return this.clone().o(t)}i(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}o(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}mult(t){return this.clone().A(t)}A(t){return this.x*=t,this.y*=t,this.z*=t,this}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){var e=t.x-this.x,n=t.y-this.y,i=t.z-this.z;return e*e+n*n+i*i}F(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}};const dz=Math.cos(Math.PI/180*37.5),pz=Math.pow(2,16)/1,gz=new $R,mz=new $R,yz=new $R;let vz=class extends pN{static mergeLineFeatures(t,e,n,i){return cz(t,e,n,i)}constructor(t,e,n){super(t,e,n);let i=!1;const{lineDasharrayFn:r,lineDashColorFn:o}=this.Z;this.hasGradient=this.symbol.lineGradientProperty,r&&(i=function(t,e,n){for(let i=0;i<t.length;i++)if(n(e,t[i].properties))return!0;return!1}(t,this.options.zoom,r),i&&(this.dasharrayFn=r)),this.hasDasharray=bz(this.symbol.lineDasharray)||i,this.hasDasharray&&o&&(this.dashColorFn=o)}createStyledVector(t,e,n,i,r){const o=new GD(t,e,n,i),s=o.getLineResource();return!this.options.atlas&&s&&(r[s]=[0,0]),o}getFormat(){const{lineWidthFn:t,lineStrokeWidthFn:e,lineStrokeColorFn:n,lineColorFn:i,lineOpacityFn:r,lineDxFn:o,lineDyFn:s,linePatternAnimSpeedFn:a,linePatternGapFn:h}=this.Z,l=[...this.getPositionFormat()];if(l.push(this.iconAtlas||this.hasDasharray?{type:Int8Array,width:3,name:"aExtrude"}:{type:Int8Array,width:2,name:"aExtrude"}),l.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),t&&l.push({type:Uint8Array,width:1,name:"aLineWidth"}),e&&l.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),i&&l.push({type:Uint8Array,width:4,name:"aColor"}),n&&l.push({type:Uint8Array,width:4,name:"aStrokeColor"}),r&&l.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&l.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&l.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const t=this.getIconAtlasMaxValue();l.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(o||s)&&l.push({type:Int8Array,width:2,name:"aLineDxDy"}),(a||h)&&l.push({type:Int8Array,width:2,name:"aLinePattern"}),l}placeVector(t){const{lineJoinFn:e,lineCapFn:n,lineWidthFn:i,lineHeightFn:r,lineStrokeWidthFn:o,lineStrokeColorFn:s,lineColorFn:a,lineOpacityFn:h,lineDxFn:l,lineDyFn:u,linePatternAnimSpeedFn:c,linePatternGapFn:A}=this.Z,f=this.symbol,d=t.feature,p=d.properties;let g=f.lineJoin||"miter",m=f.lineCap||"butt";if(e&&(g=e(this.options.zoom,p)||"miter"),n&&(m=n(this.options.zoom,p)||"butt"),i){let t=i(this.options.zoom,p);SE(t)&&(this.dynamicAttrs.aLineWidth=1,t=4),DD(t)&&(t=4),this.feaLineWidth=+t}else this.feaLineWidth=+f.lineWidth;if(r){let t=r(this.options.zoom,p);SE(t)&&(this.dynamicAttrs.aLineHeight=1),DD(t)&&(t=this.feaLineWidth),this.feaLineHeight=+t}else this.feaLineHeight=+f.lineHeight||this.feaLineWidth;if(o){let t=o(this.options.zoom,p);SE(t)&&(this.dynamicAttrs.aLineStrokeWidth=1,t=0),DD(t)&&(t=0),this.feaLineStrokeWidth=t}else this.feaLineStrokeWidth=f.lineStrokeWidth||0;if(a&&(this.feaColor=a(this.options.zoom,p)||[255,255,255,255],SE(this.feaColor)?(this.dynamicAttrs.aColor=1,this.feaColor=[0,0,0,0]):this.feaColor=jD([],this.feaColor)),s&&(this.feaStrokeColor=s(this.options.zoom,p)||[0,0,0,255],SE(this.feaStrokeColor)?(this.dynamicAttrs.aStrokeColor=1,this.feaStrokeColor=[0,0,0,0]):this.feaStrokeColor=jD([],this.feaStrokeColor)),h){let t=h(this.options.zoom,p);SE(t)&&(this.dynamicAttrs.aOpacity=1,t=1),DD(t)&&(t=1),this.feaOpacity=255*t}if(this.dasharrayFn){let t=this.dasharrayFn(this.options.zoom,p)||[0,0,0,0];if(SE(t)&&(this.dynamicAttrs.aDasharray=1,t=[0,0,0,0]),t.length<4){const e=t;1===t.length?t=[e[0],e[0],e[0],e[0]]:2===t.length?t=[e[0],e[1],e[0],e[1]]:3===t.length&&(t=[e[0],e[1],e[2],e[2]])}this.feaDash=t}if(this.dashColorFn){let t=(this.dashColorFn?this.dashColorFn(this.options.zoom,p):this.symbol.lineDashColor)||[0,0,0,0];SE(t)&&(this.dynamicAttrs.aDashColor=1,t=[0,0,0,0]),t=jD([],t),this.feaDashColor=t}if(this.iconAtlas){const e=t.getLineResource(),n=this.iconAtlas.glyphMap[e];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],n){const{tl:t,displaySize:n}=this.iconAtlas.positions[e];this.feaTexInfo[0]=t[0]+1,this.feaTexInfo[1]=t[1]+1,this.feaTexInfo[2]=n[0]-3,this.feaTexInfo[3]=n[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(l){let t=l(this.options.zoom,p);SE(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),DD(t)&&(t=0),this.feaLineDx=t}if(u){let t=u(this.options.zoom,p);SE(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),DD(t)&&(t=0),this.feaLineDy=t}if(c){let t=c(this.options.zoom,p);SE(t)&&(this.dynamicAttrs.aLinePatternAnimSpeed=1,t=0),DD(t)&&(t=0),0!==t&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=t}if(A){let t=A(this.options.zoom,p);SE(t)&&(this.dynamicAttrs.aLinePatternGap=1,t=0),DD(t)&&(t=0),this.feaLinePatternGap=t}const y=this.options.EXTENT;let v=d.geometry;if(y!==1/0){v=[];const t=[];for(let e=0;e<d.geometry.length;e++){t[0]=d.geometry[e];const n=XN(t,-1,-1,y+1,y+1);if(3===d.type&&n.length>1){const t=n[0],e=n[n.length-1];Mz(t[0],e[e.length-1])&&(n[0]=e.concat(t.slice(1)),n.length=n.length-1)}v.push(...n)}}const _=this.needAltitudeAttribute()?2:3;for(let x=0;x<v.length;x++)this.offset=this.data.aPosition.getLength()/_,this.Tt(v[x],d,g,m,2,1.05)}It(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}Tt(t,e,n,i,r,o){const s=this.It()||bz(this.feaDash)||bz(this.symbol.lineDasharray),a=this.options.isTube;a&&(t=t.map((t=>new fz(t)))),this.overscaling=1;const h=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&e.properties&&kD(e.properties.mapbox_clip_start)&&kD(e.properties.mapbox_clip_end)){this.clipStart=+e.properties.mapbox_clip_start,this.clipEnd=+e.properties.mapbox_clip_end;for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance()}const l=3===e.type&&!t.clipped;let u=t.length;for(;u>=2&&Mz(t[u-1],t[u-2]);)u--;let c=0;for(;c<u-1&&Mz(t[c],t[c+1]);)c++;if(u<(l?3:2))return;"bevel"===n&&(r=1.05);const A=this.overscaling<=16?15*h/(512*this.overscaling):0,f={vertexLength:0,primitiveLength:0,currentNormal:null};let d,p,g,m,y;this.e1=this.e2=-1,l&&(d=t[u-2],y=t[c].sub(d).T().I()),this.ensureDataCapacity(n,u,360,2);for(let v=c;v<u;v++){if(g=v===u-1?l?t[c+1]:void 0:t[v+1],g&&Mz(t[v],g))continue;y&&(m=y),d&&(p=d),d=t[v],g&&d.x===g.x&&d.y===g.y&&(d.x+=1e-4),y=g?g.sub(d).T().I():m,f.dir=p?d.sub(p).T():g.sub(d).T(),m=m||y,f.currentNormal=m;let e=m.add(y);0===e.x&&0===e.y||e.T();const h=m.x*y.x+m.y*y.y,_=e.x*y.x+e.y*y.y,x=0!==_?1/_:1/0,b=2*Math.sqrt(2-2*_),w=_<dz&&p&&g,C=m.x*y.y-m.y*y.x>0;if(!a&&w&&v>c){const t=d.dist(p);if(t>2*A){const e=d.sub(d.sub(p).A(A/t).F());e.z=d.z,this.updateDistance(p,e),this.addCurrentVertex(e,m,0,0,f),p=e}}const P=p&&g;f.middleVertex=P;let M=P?n:l?"butt":i;if(P&&"round"===M&&(x<o?M="miter":x<=2&&(M="fakeround")),"miter"===M&&x>r&&!a&&(M="bevel"),"bevel"===M&&(x>2&&(M="flipbevel"),x<r&&(M="miter")),p&&this.updateDistance(p,d),"miter"===M)a?(this.addCurrentVertex(d,m,0,0,f),f.dir=g.sub(d).T(),this.addCurrentVertex(d,y,0,0,f)):(e.A(x),this.addCurrentVertex(d,e,0,0,f),s&&(f.currentNormal=y,f.dir=g.sub(d).T(),this.addCurrentVertex(d,e,0,0,f)));else if("flipbevel"===M){if(x>100)e=y.mult(-1);else{const t=x*m.add(y).mag()/m.sub(y).mag();e.I().A(t*(C?-1:1))}this.addCurrentVertex(d,e,0,0,f),this.addCurrentVertex(d,e.mult(-1),0,0,f)}else if("bevel"===M||"fakeround"===M){const t=-Math.sqrt(x*x-1),e=C?t:0,n=C?0:t;if(p&&this.addCurrentVertex(d,m,e,n,f),"fakeround"===M){const t=Math.round(180*b/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+h*(h*(3.55645-1.43519*h)-3.2452))*t*t+(.848013+h*(.215638*h-1.06021)))}const i=y.sub(m).A(n).i(m).T().A(C?-1:1);this.addHalfVertex(d,i.x,i.y,!1,C,0,f)}}g&&(f.currentNormal=y,f.dir=g.sub(d).T(),this.addCurrentVertex(d,y,-e,-n,f))}else if("butt"===M)this.addCurrentVertex(d,e,0,0,f);else if("square"===M){const t=p?1:-1;this.addCurrentVertex(d,e,t,t,f)}else"round"===M&&(p&&(this.addCurrentVertex(d,m,0,0,f),this.addCurrentVertex(d,m,1,1,f,!0)),g&&(this.addCurrentVertex(d,y,-1,-1,f,!0),this.addCurrentVertex(d,y,0,0,f)));if(!a&&w&&v<u-1){const t=d.dist(g);if(t>2*A){const e=d.add(g.sub(d).A(A/t).F());e.z=d.z,this.updateDistance(d,e),this.addCurrentVertex(e,y,0,0,f),d=e}}}}ensureDataCapacity(t,e,n,i){const r="round"===t?Math.round(n/20)-1:0;super.ensureDataCapacity((6+r)*i,e)}addCurrentVertex(t,e,n,i,r,o=!1){const s=e.x+e.y*n,a=e.y-e.x*n,h=e.y*i-e.x,l=-e.y-e.x*i;let u=0,c=0;if(r.middleVertex){gz.x=s,gz.y=a;const t=r.currentNormal;if(u=Pz(t,gz,r.dir),0===n&&0===i)c=-u;else{const e=mz;e.x=t.x,e.y=t.y,e.A(-1),yz.x=h,yz.y=l,c=Pz(e,yz,r.dir)}}this.addHalfVertex(t,s,a,o,!1,n,r,u),this.addHalfVertex(t,h,l,o,!0,-i,r,c),this.prevVertex&&Mz(t,this.prevVertex)||(this.prevVertex=t),this.distance>pz/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,n,i,r,o))}addHalfVertex({x:t,y:e,z:n},i,r,o,s,a,h,l){this.fillData(this.data,t,e,n||0,i,r,o,s,1*this.scaledDistance,l);const u=h.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,u),h.primitiveLength++),s?this.e2=u:this.e1=u}fillData(t,e,n,i,r,o,s,a,h,l){const{lineWidthFn:u,lineStrokeWidthFn:c,lineStrokeColorFn:A,lineColorFn:f,lineOpacityFn:d,lineDxFn:p,lineDyFn:g,linePatternAnimSpeedFn:m,linePatternGapFn:y}=this.Z;this.fillPosition(t,e,n,i);let v=63*r;v=(Math.sign(v)||1)*((Math.floor(Math.abs(v))>>1<<1)+ +s);let _=63*o;_=(Math.sign(_)||1)*((Math.floor(Math.abs(_))>>1<<1)+ +a);let x=t.aExtrude.currentIndex;t.aExtrude[x++]=v,t.aExtrude[x++]=_,(this.iconAtlas||this.hasDasharray)&&(t.aExtrude[x++]=63*l),t.aExtrude.currentIndex=x,x=t.aLinesofar.currentIndex,t.aLinesofar[x++]=h,t.aLinesofar.currentIndex=x,u&&(x=t.aLineWidth.currentIndex,t.aLineWidth[x++]=Math.round(2*this.feaLineWidth),t.aLineWidth.currentIndex=x),c&&(x=t.aLineStrokeWidth.currentIndex,t.aLineStrokeWidth[x++]=Math.round(2*this.feaLineStrokeWidth),t.aLineStrokeWidth.currentIndex=x),f&&(x=t.aColor.currentIndex,t.aColor[x++]=this.feaColor[0],t.aColor[x++]=this.feaColor[1],t.aColor[x++]=this.feaColor[2],t.aColor[x++]=this.feaColor[3],t.aColor.currentIndex=x),A&&(x=t.aStrokeColor.currentIndex,t.aStrokeColor[x++]=this.feaStrokeColor[0],t.aStrokeColor[x++]=this.feaStrokeColor[1],t.aStrokeColor[x++]=this.feaStrokeColor[2],t.aStrokeColor[x++]=this.feaStrokeColor[3],t.aStrokeColor.currentIndex=x),d&&(x=t.aOpacity.currentIndex,t.aOpacity[x++]=this.feaOpacity,t.aOpacity.currentIndex=x),this.dasharrayFn&&(x=t.aDasharray.currentIndex,t.aDasharray[x++]=this.feaDash[0],t.aDasharray[x++]=this.feaDash[1],t.aDasharray[x++]=this.feaDash[2],t.aDasharray[x++]=this.feaDash[3],t.aDasharray.currentIndex=x),this.dashColorFn&&(x=t.aDashColor.currentIndex,t.aDashColor[x++]=this.feaDashColor[0],t.aDashColor[x++]=this.feaDashColor[1],t.aDashColor[x++]=this.feaDashColor[2],t.aDashColor[x++]=this.feaDashColor[3],t.aDashColor.currentIndex=x),this.iconAtlas&&(x=t.aTexInfo.currentIndex,t.aTexInfo[x++]=this.feaTexInfo[0],t.aTexInfo[x++]=this.feaTexInfo[1],t.aTexInfo[x++]=this.feaTexInfo[2],t.aTexInfo[x++]=this.feaTexInfo[3],t.aTexInfo.currentIndex=x),(p||g)&&(x=t.aLineDxDy.currentIndex,t.aLineDxDy[x++]=this.feaLineDx||0,t.aLineDxDy[x++]=this.feaLineDy||0,t.aLineDxDy.currentIndex=x),(m||y)&&(x=t.aLinePattern.currentIndex,t.aLinePattern[x++]=127*(this.feaPatternAnimSpeed||0),t.aLinePattern[x++]=10*(this.feaLinePatternGap||0),t.aLinePattern.currentIndex=x),this.maxPos=Math.max(this.maxPos,Math.abs(e)+1,Math.abs(n)+1)}addElements(t,e,n){super.addElements(this.offset+t,this.offset+e,this.offset+n)}Ft(t){const e=this.options.EXTENT,n=this.elements;for(let i=0;i<n.length;i+=3)if(e===1/0||!xz(this.data.aPosition,n[i],n[i+1],3,e)&&!xz(this.data.aPosition,n[i+1],n[i+2],3,e)){let e=t.currentIndex;t[e++]=n[i],t[e++]=n[i+1],t[e++]=n[i+2],t.currentIndex=e}}Ct(t){if(t.length<=1)return t;const e=[],n=this.options.EXTENT;let i,r=!0;for(i=0;i<t.length-1;i++){const o=_z(t[i],t[i+1],n);o&&r||(e.push(t[i]),r=o)}return r||e.push(t[i]),e}updateDistance(t,e){if(this.options.isTube){const n=t.dist(e),i=function(t){const{verticalCentimeterToPoint:e,tileRatio:n}=t;return e*n}(this.options)*(e.z-t.z);this.distance+=Math.sqrt(n*n+i*i)}else this.distance+=t.dist(e);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(pz-1):this.distance}};function _z(t,e,n){return n!==1/0&&(t.x<0&&e.x<0||t.x>n&&e.x>n||t.y<0&&e.y<0||t.y>n&&e.y>n)}function xz(t,e,n,i,r){if(r===1/0)return!1;const o=Math.floor(.5*t[e*i]),s=Math.floor(.5*t[e*i+1]),a=Math.floor(.5*t[n*i]),h=Math.floor(.5*t[n*i+1]);return o===a&&(o<0||o>r)&&s!==h||s===h&&(s<0||s>r)&&o!==a}function bz(t){if(!Array.isArray(t))return!1;for(let e=0;e<t.length;e++)if(t[e])return!0;return!1}const wz=[],Cz=[];function Pz(t,e,n){const i=t.mag(),r=e.mag();ly(wz,n.x,n.y),ly(Cz,e.x,e.y);const o=vy(wz,Cz);return-Math.sign(o)*Math.sqrt(r*r-i*i)}function Mz(t,e){return t.equals(e)&&t.z===e.z}const Tz=[],Sz=[];function Iz(t,e){var n,i,r,o,s,a,h;for(i=1;i<=8;i*=2){for(n=[],o=!(Oz(r=t[t.length-1],e)&i),s=0;s<t.length;s++){if((h=!(Oz(a=t[s],e)&i))!==o){const t=Ez(r,a,i,e);n.push(void 0!==a.x?new $R(t[0],t[1]):t)}h&&n.push(a),r=a,o=h}if(!(t=n).length)break}return n}function Ez(t,e,n,i){return Tz[0]=void 0===t.x?t[0]:t.x,Tz[1]=void 0===t.y?t[1]:t.y,t=Tz,Sz[0]=void 0===e.x?e[0]:e.x,Sz[1]=void 0===e.y?e[1]:e.y,e=Sz,8&n?[t[0]+(e[0]-t[0])*(i[3]-t[1])/(e[1]-t[1]),i[3]]:4&n?[t[0]+(e[0]-t[0])*(i[1]-t[1])/(e[1]-t[1]),i[1]]:2&n?[i[2],t[1]+(e[1]-t[1])*(i[2]-t[0])/(e[0]-t[0])]:1&n?[i[0],t[1]+(e[1]-t[1])*(i[0]-t[0])/(e[0]-t[0])]:null}function Oz(t,e){Tz[0]=void 0===t.x?t[0]:t.x,Tz[1]=void 0===t.y?t[1]:t.y;var n=0;return(t=Tz)[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}const Rz=[0,0,0,0],Dz=-9999999;let kz=class extends pN{constructor(...t){super(...t),this.lineElements=[]}createStyledVector(t,e,n,i,r){const o=new GD(t,e,n,i),s=o.getPolygonResource();return!this.options.atlas&&s&&(r[s]=[0,0]),o}getFormat(){const t=[...this.getPositionFormat()],{polygonFillFn:e,polygonOpacityFn:n,uvScaleFn:i,uvOffsetFn:r,polygonPatternUVFn:o}=this.Z;if(this.iconAtlas){const e=this.getIconAtlasMaxValue();t.push({type:e>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return e&&t.push({type:Uint8Array,width:4,name:"aColor"}),n&&t.push({type:Uint8Array,width:1,name:"aOpacity"}),i&&t.push({type:Uint16Array,width:2,name:"aUVScale"}),r&&t.push({type:Uint8Array,width:2,name:"aUVOffset"}),o&&t.push({type:Float32Array,width:2,name:"aTexCoord"}),t}placeVector(t,e){const n=t.feature;this.Ot(n.geometry,n,e)}Ot(t,e){let n,i,r,o;const{polygonFillFn:s,polygonOpacityFn:a,uvScaleFn:h,uvOffsetFn:l,uvOffsetInMeterFn:u,polygonPatternUVFn:c}=this.Z,A=e.properties;s&&(n=s(this.options.zoom,A)||qg([],255,255,255,255),SE(n)?(this.dynamicAttrs.aColor=1,n=Rz):n=jD([],n)),a&&(i=a(this.options.zoom,A),SE(i)?(this.dynamicAttrs.aOpacity=1,i=255):(DD(i)&&(i=1),i*=255)),h&&(r=h(this.options.zoom,A),SE(r)?(r=[255,255],this.dynamicAttrs.aUVScale=1):(DD(r)&&(r=[1,1]),r=[255*r[0],255*r[1]])),l&&(u&&u(null,A)?o=[0,0]:(o=l(this.options.zoom,A),SE(o)?(o=[0,0],this.dynamicAttrs.aUVOffset=1):(DD(o)&&(o=[0,0]),o=[255*o[0],255*o[1]])));const f=!!this.iconAtlas,d=ez(t,500),p=[0,0],g=[0,0];if(f){const{polygonPatternFileFn:t}=this.Z,e=t?t(null,A):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[e]){const t=this.iconAtlas.positions[e],n=!bD(t.displaySize[0])||!bD(t.displaySize[1]);p[0]=t.tl[0]+(n?1:0),p[1]=t.tl[1]+(n?1:0),g[0]=t.displaySize[0]-1-(n?2:0),g[1]=t.displaySize[1]-1-(n?2:0)}}let m,y=0;c&&(m=c(this.options.zoom,A));const v=this.needAltitudeAttribute()?2:3,_=[-1,-1,e.extent+1,e.extent+1],x=this.Et=this.Et||this.ot.getProxy(),b=this.Dt=this.Dt||this.ot.getProxy();for(let w=0;w<d.length;w++){const t=d[w],e=this.data.aPosition.getLength()/v;x.setLength(0),b.setLength(0);for(let a=0;a<t.length;a++){let e=t[a];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(e=Iz(e,_)),0===e.length)continue;0!==a&&b.push(x.length/3),this.ensureDataCapacity(e.length);const s=this.data;for(let t=0;t<e.length;t++){const a=e[t].x,h=e[t].y,l=e[t].z||0;if(this.fillPosition(this.data,a,h,l),f){let t=s.aTexInfo.currentIndex;s.aTexInfo[t++]=p[0],s.aTexInfo[t++]=p[1],s.aTexInfo[t++]=g[0],s.aTexInfo[t++]=g[1],s.aTexInfo.currentIndex=t}if(void 0!==n){let t=s.aColor.currentIndex;s.aColor[t++]=n[0],s.aColor[t++]=n[1],s.aColor[t++]=n[2],s.aColor[t++]=n[3],s.aColor.currentIndex=t}if(void 0!==i){let t=s.aOpacity.currentIndex;s.aOpacity[t++]=i,s.aOpacity.currentIndex=t}if(void 0!==r){let t=s.aUVScale.currentIndex;s.aUVScale[t++]=r[0],s.aUVScale[t++]=r[1],s.aUVScale.currentIndex=t}if(void 0!==o){let t=s.aUVOffset.currentIndex;s.aUVOffset[t++]=o[0],s.aUVOffset[t++]=o[1],s.aUVOffset.currentIndex=t}if(c){let t=s.aTexCoord.currentIndex;if(m){const e=DD(m[2*y])?m[0]:m[2*y],n=DD(m[2*y]+1)?m[1]:m[2*y+1];s.aTexCoord[t++]=e,s.aTexCoord[t++]=n}else s.aTexCoord[t++]=Dz,s.aTexCoord[t++]=Dz;s.aTexCoord.currentIndex=t,y++}const u=Math.abs(a),A=Math.abs(h);u>this.maxPos&&(this.maxPos=u),A>this.maxPos&&(this.maxPos=A),x.push(a,h,l)}}let s=AR(x,b,3);if(x.length&&!s.length){const t=[];for(let e=0;e<x.length;e+=3)t[e]=x[e],t[e+1]=x[e+2],t[e+2]=x[e+1];if(s=AR(t,b,3),!s.length){for(let e=0;e<x.length;e+=3)t[e]=x[e+1],t[e+1]=x[e+2],t[e+2]=x[e];s=AR(t,b,3)}}for(let n=0;n<s.length;n+=3)this.addElements(e+s[n],e+s[n+1],e+s[n+2])}}ensureDataCapacity(t){super.ensureDataCapacity(1,t)}},Lz=class{constructor(t){this.max=t,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(t,e){return this.has(t)?(this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t)):(this.data[t]=e,this.order.push(t),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(t){return t in this.data}keys(){return this.order}getAndRemove(t){if(!this.has(t))return null;const e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e}get(t){return this.has(t)?this.data[t]:null}remove(t){return this.has(t)?(delete this.data[t],this.order.splice(this.order.indexOf(t),1),this):this}setMaxSize(t){for(this.max=t;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}};var Fz=1e20;function Nz(t,e,n,i,r,o,s){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=i||.25,this.fontFamily=r||"sans-serif",this.fontWeight=o||"normal",this.fontStyle=s||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas="undefined"==typeof document?new OffscreenCanvas(a,a):document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function zz(t,e,n,i,r,o){for(var s=0;s<e;s++)Bz(t,s,e,n,i,r,o);for(var a=0;a<n;a++)Bz(t,a*e,1,e,i,r,o)}function Bz(t,e,n,i,r,o,s){var a,h,l,u;for(o[0]=0,s[0]=-Fz,s[1]=Fz,a=0;a<i;a++)r[a]=t[e+a*n];for(a=1,h=0,l=0;a<i;a++){do{l=(r[a]-r[u=o[h]]+a*a-u*u)/(a-u)/2}while(l<=s[h]&&--h>-1);o[++h]=a,s[h]=l,s[h+1]=Fz}for(a=0,h=0;a<i;a++){for(;s[h+1]<a;)h++;t[e+a*n]=r[u=o[h]]+(a-u)*(a-u)}}Nz.prototype.draw=function(t,e,n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.textBaseline="top",this.ctx.fillText(t,this.buffer,this.buffer);for(var i=this.ctx.getImageData(0,0,e,n),r=new Uint8ClampedArray(e*n),o=0;o<e*n;o++){var s=i.data[4*o+3]/255;this.gridOuter[o]=1===s?0:0===s?Fz:Math.pow(Math.max(0,.5-s),2),this.gridInner[o]=1===s?Fz:0===s?0:Math.pow(Math.max(0,s-.5),2)}for(zz(this.gridOuter,e,n,this.f,this.v,this.z),zz(this.gridInner,e,n,this.f,this.v,this.z),o=0;o<e*n;o++){var a=Math.sqrt(this.gridOuter[o])-Math.sqrt(this.gridInner[o]);r[o]=Math.round(255-255*(a/this.radius+this.cutoff))}return r};let Hz=0,jz=class{constructor(t,e=15,n,i){this.entries={},this.Lt={},this.Rt=new Lz(2048,(function(){})),this.Ht=t,this.zt=e,this.Nt=n,this.Vt=i}Ut(t){return t&&t.indexOf("{stack}")>=0&&t.indexOf("{range}")>0}getGlyphs(t,e){if(!t||!Object.keys(t).length)return void e(null,{glyphs:null});if(this.Ut(this.Vt))return void this.jt(t,e);const n=this.entries,i=t.options;let r=!0;i&&(r=!1!==i.isCharsCompact),r=r||this.Nt;const o=(i,o,a)=>{let h=0,l=0;for(const e in t)if("options"!==e){n[e]=n[e]||{},o[e]=o[e]||{};for(const u in t[e]){if(l++,l<=i)continue;const t=r&&!SN(+u),c=e+":"+u+":"+t;let A;if(this.Rt.has(c)?A=this.Rt.get(c):(A=this.Gt(n[e],e,u,t),this.Rt.add(c,A),h++),A=Uz(A),o[e][u]=A,a.push(A.bitmap.data.buffer),this.Ht&&h>this.zt)return void this.Ht(s(l,o,a))}}e(null,{glyphs:o,buffers:a})};function s(t,e,n){return()=>{o(t,e,n)}}o(0,{},[])}jt(t,e){const n=[];for(const i in t)for(const e of t[i])n.push(this.Bt(i,e));Promise.all(n).then((t=>{e(null,t)}))}Bt(){return Promise.resolve(null)}Gt(t,e,n,i){const r=e;let o=t.tinySDF;const s=i?-1:2;if(!o){let e="400";/bolder/i.test(r)?e="1000":/bold/i.test(r)?e="900":/medium/i.test(r)?e="500":/light/i.test(r)&&(e="200"),o=t.tinySDF=new Nz(24,2,8,.25,r,e)}const a=String.fromCodePoint(n),h=o.ctx.measureText(a),l=Math.round(h.width),u=o.draw(a,l+4,28);if(Hz<4){const t="undefined"!=typeof document&&document.getElementById("sdf-debug-"+Hz++);t&&(t.width=l+4,t.height=o.canvas.height,t.getContext("2d").drawImage(o.canvas,0,0))}return{charCode:n,bitmap:{width:l+4,height:28,data:u},metrics:{width:l,height:24,left:1,top:-2,advance:l+2+s}}}};function Uz(t){const e={width:t.bitmap.width,height:t.bitmap.height,data:new Uint8ClampedArray(t.bitmap.data)};return{charCode:t.charCode,bitmap:e,metrics:RD({},t.metrics)}}let Gz=class{constructor(t){this.options=t||{},this.$t={},this.Rt=new Lz(256,(function(){}));const e=document.createElement("canvas");this.ctx=e.getContext("2d",{willReadFrequently:!0})}getIcons(t,e){if(!t||!Object.keys(t).length)return void e(null,{icons:null});const n=Object.keys(t),i={},r=[];let o=0,s=0;const a=this;function h(t,n){i[t]=a.Wt(t,n),i[t]&&"error"!==i[t]?r.push(i[t].data.data.buffer):delete i[t],s++,s===o&&e(null,{icons:i,buffers:r})}function l(t){const e=a.$t[t.url];for(let n=0;n<e.length;n++)e[n].call(t,t.url,t.size);delete a.$t[t.url]}function u(){const t=a.ctx;let e,n;try{e=this.width,n=this.height,this.size[0]=e,this.size[1]=n,a.Xt(null,this.size),e=this.size[0],n=this.size[1];const i=t.canvas;i.width=e,i.height=n,t.imageSmoothingEnabled=!1,t.drawImage(this,0,0,e,n);const r=t.getImageData(0,0,i.width,i.height).data;a.Yt(this.url,r,i.width,i.height)}catch(i){console.warn(i)}l(this)}function c(t){console.warn(`failed loading icon(${this.index}) at "${this.url}"`),console.warn(t),a.options.iconErrorUrl?this.src=a.options.iconErrorUrl:(a.Yt(this.url),l(this))}const A=this.options.urlModifier;let f,d=!1;for(let p=0;p<n.length;p++){const e=n[p],s=t[e];this.Xt(e,s);const a=this.Wt(e,s);if(a&&"error"!==a){i[e]=this.Wt(e,s);continue}if("error"===a)continue;let l,g=e;if(0===e.indexOf("vector://")&&(l=JSON.parse(e.substring(9)),"path"===l.markerType&&(g=gi.getMarkerPathBase64(l,l.markerWidth,l.markerHeight))),0===e.indexOf("vector://")&&"path"!==l.markerType){f=f||new Bl([0,0]);const{markerFill:t,markerLineColor:n}=l;t&&Array.isArray(t)&&(l.markerFill=Vz(t)),n&&Array.isArray(n)&&(l.markerLineColor=Vz(n)),delete l.markerHorizontalAlignment,delete l.markerVerticalAlignment,delete l.markerDx,delete l.markerDy,delete l.markerPlacement,delete l.markerFile,l.markerWidth=s[0],l.markerHeight=s[1],f.setSymbol(l);const o=f["_getSprite".trim()]();if(o){const t=o.canvas,n=t.width,s=t.height,a=t.getContext("2d").getImageData(0,0,n,s).data;i[e]={data:{data:new Uint8ClampedArray(a),width:n,height:s},url:e},r.push(i[e].data.data.buffer),this.Yt(e,a,n,s)}}else{if(this.$t[e]){d=!0,o++,this.$t[e].push(h);continue}this.$t[e]=[],this.$t[e].push(h);const t=new Image;t.index=p,t.size=s,t.onload=u,t.onerror=c,t.onabort=c,t.url=e,t.crossOrigin="Anonymous",d=!0,o++,t.src=A&&A(g)||g}}d||e(null,{icons:i,buffers:r})}qt(t,e,n){const i=this.Rt.get(t);return i&&"error"!==i&&i.data.width>=e&&i.data.height>=n}Yt(t,e,n,i){this.qt(t,n,i)||this.Rt.add(t,e?{data:{data:e,width:n,height:i},url:t}:"error")}Wt(t,e){if(!this.qt(t,e[0],e[1]))return null;const n=this.Rt.get(t);return n?"error"===n?n:{data:{data:new Uint8ClampedArray(n.data.data),width:n.data.width,height:n.data.height},url:n.url}:null}Xt(t,e){if(!e[0]||!e[1])return;const n=this.options.maxSize||2048;let[i,r]=e;const o=i/r;if(t){const e=this.Rt.get(t);if(e&&"error"!==e){const{width:t,height:n}=e.data;t>i&&(i=t),n>r&&(r=n)}}i>n&&(r=n/o,i=n),r>n&&(i=n*o,r=n),e[0]=Math.floor(i),e[1]=Math.floor(r)}};function Vz(t){return 3===t.length&&t.push(1),t.reduce(((t,e,n)=>t+(n<3?255*e+",":e+")")),"rgba(")}var Wz=Object.freeze({__proto__:null,calculateSignedArea:pD,clipPolygon:Iz,convertGeometry:OD,convertRTLText:WN,generatePickingIndiceIndex:xD,getFeaAltitudeAndHeight:mD,getIndexArrayType:TD,getPosArrayType:SD,getUnsignedArrayType:ID,packPosition:VD,unpackPosition:ZD});const qz={},Zz={},Qz=[];function Xz(t,e){if(!t)return null;var n=!1;if(Array.isArray(t)){var i,r=[];for(let o=0;o<t.length;o++)(i=Xz(t[o],e))?(r.push(i),n=!0):r.push(t[o]);return n?r:t}var o={__fn_types_loaded:!0};const s=[];for(const u in t)zD(t,u)&&s.push(u);const a=function(t){Object.defineProperty(o,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=EE(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},h={},l=function(t,n){Object.defineProperty(o,t,{get:function(){this["__fn_"+t]||(this["__fn_"+t]=WF(this["_"+t],n));const i=e()[0];h.zoom=i;try{return this["__fn_"+t].evaluateWithoutErrorHandling(h,qz,Zz,null,Qz)}catch(r){return null}},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})};for(let u=0,c=s.length;u<c;u++){const e=s[u];if(SE(t[e]))n=!0,o["_"+e]=t[e],a(e);else if(qF(t[e])){n=!0;const i=JF(e);o["_"+e]=t[e],l(e,i)}else o[e]=t[e]}return n?o:t}const Yz={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textFaceName:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1},Jz={visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},Kz={lineDasharray:1,topPolygonFill:1,bottomPolygonFill:1};Object.assign(Jz,Yz),Object.assign(Kz,Yz);let $z=0;function tB(){return $z++}const eB="function"==typeof Object.assign;function nB(t,...e){if(eB)return Object.assign(t,...e),t;for(let n=0;n<e.length;n++){const i=e[n];for(const e in i)t[e]=i[e]}return t}function iB(t){return!aB(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function rB(t){return"number"==typeof t&&!isNaN(t)}function oB(t){return!aB(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function sB(t){return!Array.isArray(t)&&"object"==typeof t&&!!t}function aB(t){return null==t}function hB(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)for(let e=0,i=n.length;e<i;e++)t.push(n[e])}return t.length}function lB(t){return SE(t)&&t.property}function uB(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function cB(t,e){let n;if(e.altitudeToPoint){n=e.altitudeToPoint(100,t);const i=e.options.heightFactor;i&&1!==i&&(n/=i)}else n=e.distanceToPointAtRes(100,0,t).x;return n/100/100}function AB(t,e,n){for(let i=0;i<t.length;i++){const r=t[i],o=nB({},r),{renderPlugin:s}=r,a=nB({},s);a.sceneConfig&&!Object.keys(a.sceneConfig).length&&delete a.sceneConfig;let h=-1;for(let t=n.length-1;t>=0;t--)if(tC(a,n[t])){h=t;break}h<0&&(h=n.length,n.push(a)),o.renderPlugin=h,e.push(o)}}const fB="function"==typeof fetch&&"function"==typeof AbortController,dB={jsonp:function(t,e){const n="_maptalks_jsonp_"+tB();t.match(/\?/)?t+="&callback="+n:t+="?callback="+n;let i=document.createElement("script");return i.type="text/javascript",i.src=t,window[n]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(t,e,n){if(oB(e)){const t=n;n=e,e=t}(e=e||{}).method&&(e.method=e.method.toUpperCase());const i="POST"===e.method;if(fB){const i=new AbortController,r=e;r.signal=i.signal,r.referrerPolicy=r.referrerPolicy||"origin",r.method=r.method||"GET";const o=new Request(t,r);return e.returnJSON&&o.headers.set("Accept","application/json"),fetch(o).then((i=>{const r=this.Jt(i,e.returnJSON,e.responseType);r.message?(r.url=t,n(r)):r.then((t=>{n(null,"arraybuffer"===e.responseType?{data:t,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires"),contentType:i.headers.get("Content-Type")}:t)})).catch((e=>{e.code&&e.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,e),n(e))}))})).catch((e=>{e.code&&e.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,e),n(e))})),i}{const r=dB.Kt(n);if(r.open(e.method||"GET",t,!0),e){for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(i?e.body:null),r}},Jt:(t,e,n)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===n?t.arrayBuffer():e?t.json():t.text(),Zt:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e({status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}))}},Kt:function(t){let e;try{e=new XMLHttpRequest}catch(n){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}}}return e.onreadystatechange=dB.Zt(e,t),e},getArrayBuffer(t,e,n){if(oB(e)){const t=n;n=e,e=t}return e||(e={}),e.responseType="arraybuffer",dB.get(t,e,n)},getJSON:function(t,e,n){if(oB(e)){const t=n;n=e,e=t}const i=function(t,e){const i="string"==typeof e?JSON.parse(e):e||null;n(t,i)};return e&&e.jsonp?dB.jsonp(t,i):((e=e||{}).returnJSON=!0,dB.get(t,e,i))}},pB=["GeoJSONVectorTileLayer"];class gB extends $f.Actor{constructor(t,e){super(t);const n=e.getMap().id;this.Qt=e,this.te=n,this.ee="vt_"+tB();const i=e.getJSONType();this.ne=pB.indexOf(i)>=0,this.ie={},this.re=new Gz({iconErrorUrl:e.options.iconErrorUrl,maxSize:e.options.maxIconSize,urlModifier:t=>{const n=e.getURLModifier();return n&&n(t)||t}});const r=!e.getRenderer().isEnableWorkAround("win-intel-gpu-crash");this.se=new jz((t=>{e.getMap().getRenderer().callInNextFrame(t)}),e.options.glyphSdfLimitPerFrame,r)}initialize(t){t(null)}addLayer(t){const e=this.Qt,n=e.getWorkerOptions()||{},i=this.ee,r=e.getJSONType(),o={mapId:this.te,layerId:i,command:"addLayer",params:{type:r,options:n}};this.ne?(void 0===this.ie[i]&&(this.ie[i]=this.getDedicatedWorker()),this.send(o,null,t,this.ie[i])):this.broadcast(o,null,t)}abortTile(t,e){const n=this.ee,i={mapId:this.te,layerId:n,command:"abortTile",params:{url:t}};this.ne?(void 0===this.ie[n]&&(this.ie[n]=this.getDedicatedWorker()),this.send(i,null,e,this.ie[n])):this.broadcast(i,null,e)}removeLayer(t){const e=this.ee,n={mapId:this.te,layerId:e,command:"removeLayer"};this.ne?(void 0!==this.ie[e]&&this.send(n,null,t,this.ie[e]),delete this.ie[e]):this.broadcast(n,null,t)}updateStyle(t,e){const n=this.ee,i={mapId:this.te,layerId:n,command:"updateStyle",params:t};this.ne?void 0!==this.ie[n]&&this.send(i,null,e,this.ie[n]):this.broadcast(i,null,e)}updateOptions(t,e){const n=this.ee,i={mapId:this.te,layerId:n,command:"updateOptions",params:t};this.ne?void 0!==this.ie[n]&&this.send(i,null,e,this.ie[n]):this.broadcast(i,null,e)}loadTile(t,e){const n=nB({},t);n.tileInfo=function(t){const e={};for(const n in t)null!=t[n]&&(e[n]=t[n].toJSON?t[n].toJSON():t[n]);return e}(t.tileInfo);const i=this.ee,r={mapId:this.te,layerId:i,command:"loadTile",params:n},{x:o,y:s}=t.tileInfo;this.send(r,null,e,void 0===this.ie[i]?this.workers[(o+s)%this.workers.length].id:this.ie[i])}remove(){super.remove(),this.ie={}}fetchIconGlyphs({icons:t,glyphs:e},n){this.se.getGlyphs(e,((e,i)=>{if(e)throw e;const r=i.buffers||[];this.re.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&e.buffers.length&&r.push(...e.buffers),n(null,{icons:e.icons,glyphs:i.glyphs},r)}))}))}setData(t,e){const n=this.ee;this.send({mapId:this.te,layerId:n,command:"setData",params:{data:t}},null,e,this.ie[n])}oe(t){return t.id}}const mB={},yB={collision:!0,fading:!1,fadingDuration:224,fadeInDelay:600,fadeOutDelay:100,uniquePlacement:!1,depthFunc:"always"};let vB=class{constructor(t,e,n){this.ae=t,this.le=e,this.he=n||[0,1,0]}draw(t,e,n,i,r){if(this.ue||this.ce(),this.fe||(this.fe=this.ae.buffer(_B(i)),this.de=this.ae.buffer(xB(i,i/n))),i!==this.pe){const t=i/n;this.fe(_B(i)),this.de(xB(i,t))}this.pe=i;let o=this.me;if(!o){const t=this.le.getDevicePixelRatio()>1?2:1;o=this.me=document.createElement("canvas"),o.width=512*t,o.height=64*t;const e=o.getContext("2d");e.font="36px monospace",e.scale(t,t),this.ye=this.ae.texture({width:o.width,height:o.height,data:o})}const s=o.getContext("2d");s.clearRect(0,0,o.width,o.height),s.fillStyle=`rgba(${this.he.map((t=>255*t)).join()})`,s.fillText(t,20,36),this.ye({width:o.width,height:o.height,data:o}),this.ue({transform:e,data:this.fe,texData:this.ge,debugLine:1,primitive:"lines",framebuffer:r||null,image:this.ye,count:8}),this.ue({transform:e,data:this.de,texData:this.ge,debugLine:0,primitive:"triangle strip",framebuffer:r||null,image:this.ye,count:4})}delete(){this.ye&&(this.ye.destroy(),delete this.ye),this.ge&&(this.ge.destroy(),delete this.ge),this.fe&&(this.fe.destroy(),this.de.destroy(),delete this.fe,delete this.de),this.ue&&(this.ue.destroy(),delete this.ue)}ce(){this.ge=this.ae.buffer(new Uint8Array([0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1])),this.ue=this.ae({vert:"\n                attribute vec2 aPosition;\n                attribute vec2 aTexCoord;\n                uniform mat4 transform;\n\n                varying vec2 vTexCoord;\n                void main()\n                {\n                    gl_Position = transform * vec4(aPosition, 0.0, 1.0);\n                    vTexCoord = aTexCoord;\n                }\n            ",frag:"\n                precision mediump float;\n                uniform sampler2D uImage;\n                uniform vec3 uColor;\n                uniform float uOpacity;\n                uniform float uDebugLine;\n\n                varying vec2 vTexCoord;\n\n                void main()\n                {\n                    if (uDebugLine == 1.) {\n                        gl_FragColor = vec4(uColor, 1.0) * uOpacity;\n                    } else {\n                        gl_FragColor = texture2D(uImage, vTexCoord) * uOpacity;\n                    }\n                    gl_FragColor *= gl_FragColor.a;\n                }\n            ",attributes:{aPosition:this.ae.prop("data"),aTexCoord:this.ae.prop("texData")},uniforms:{transform:this.ae.prop("transform"),uColor:this.he,uOpacity:1,uDebugLine:this.ae.prop("debugLine"),uImage:this.ae.prop("image")},count:this.ae.prop("count"),primitive:this.ae.prop("primitive"),depth:{enable:!1,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},stencil:{enable:!1},viewport:{x:0,y:0,width:()=>this.le.getRenderer().canvas.width,height:()=>this.le.getRenderer().canvas.height},framebuffer:this.ae.prop("framebuffer")})}};function _B(t){return new Uint16Array([0,0,0,t,0,t,t,t,t,t,t,0,t,0,0,0])}function xB(t,e){return new Uint16Array([0,t-64*e,0,t,512*e,t-64*e,512*e,t])}const bB=new Uint8Array([0,0,0,1,1,0,1,0,0,1,1,1]),wB=[];class CB{constructor(t,e,n){this.ae=t,(this.ve=new Jv({aPosition:bB},null,bB.length/2,{positionSize:2})).generateBuffers(t),this.xe=new Y_,this.be=[],this.we=0,this.Ae=e,this.le=n,this.ce(t)}start(){this.we=0,this.xe.clear()}add(t,e,n){const i=this.Me(n);i.setUniform("ref",t),pg(wB,e,e,1);const r=i.localTransform;Qp(r,wB),lg(r,n,r),i.setLocalTransform(r),this.xe.addMesh(i)}render(t){this._e.render(this.Se,{projViewMatrix:this.le.projViewMatrix},this.xe,t)}Me(){const t=this.we++;return this.be[t]||(this.be[t]=new z_(this.ve)),this.be[t]}ce(t){const e=this.Ae,n={viewport:{x:0,y:0,width:()=>e.width,height:()=>e.height},stencil:{enable:!0,mask:255,func:{cmp:"always",ref:(t,e)=>e.ref,mask:255},op:{fail:"replace",zfail:"replace",zpass:"replace"}},depth:{enable:!0,func:"always",mask:!1},colorMask:[!1,!1,!1,!1]};this.Se=new mx({vert:"\n#define SHADER_NAME TILE_STENCIL_VERT\nattribute vec2 aPosition;\nuniform mat4 projViewModelMatrix;\n\nvoid main()\n{\n    gl_Position = projViewModelMatrix * vec4(aPosition, 0.0, 1.0);\n}\n",frag:"\n#define SHADER_NAME TILE_STENCIL_FRAG\nvoid main()\n{\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 0.1);\n}\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:n}),this._e=new j_(t)}remove(){this.ve.dispose();for(let t=0;t<this.be.length;t++)this.be[t].dispose();this.be.length=0,this.Se.dispose()}}const PB="__fea_idx",MB=-999999,TB=new Float32Array([-1e12])[0],SB="maptalks_ombb",IB=(PB+"").trim();function EB(t,e,n,i,r,o){const s={};if(function(t){if(!t)return!1;for(const e in t)if(null!=t[e])return!0;return!1}(t))for(let a=0,h=(e||t).length;a<h;a++){let h=e?t[e[a]]:t[a];"id"===r.options.features&&r.getFeature&&(h=r.getFeature(h),h.layer=n),r instanceof lA&&(h=LB(h,o)),s[e?e[a]:h[IB]]={feature:h,symbol:i}}return s}const OB="__original_properties",RB="__external_properties",DB={get:function(t,e){return e in t?t[e]:t[OB][e]||t[RB]&&t[RB][e]},has:function(t,e){return e in t||e in t[OB]||t[RB]&&e in t[RB]}},kB={};function LB(t,e){const n=t.properties;if(n&&n[OB])return t;e&&(t=nB({},t)),t.customProps=t.customProps||{};const i=t.customProps;return i.$layer=t.layer,i.$type=t.type,i[OB]=n||kB,t.properties=new Proxy(i,DB),t}function FB(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function NB(t,e,n){return Math.min(n,Math.max(e,t))}function zB(t,e,n){if(t===n||t===e)return t;const i=n-e;return((t-e)%i+i)%i+e}function BB(t){return null==t}function HB(t){return JSON.parse(JSON.stringify(t))}function jB(t,e,n,i,r,o){e in t||Object.defineProperty(t,e,{enumerable:!0,get:function(){const t=BB(n[i])||SE(n[i])?r:n[i];return o?o(t):t}})}const UB=[];function GB(t){for(let e=0;e<t.length;e++)UB[e]=t[e],UB[e]*=255;return 3===t.length&&(UB[3]=255),UB}function VB(t,e=4){return WB.bind(this,t,e)}function WB(t,e,n){if(Array.isArray(n))return 3===n.length&&4===e&&n.push(1),n;if(t&&t[n])return t[n];if(void 0!==n.r&&void 0!==n.g&&void 0!==n.b&&void 0!==n.a)return[n.r,n.g,n.b,n.a];const i=bO(n).unitArray();return 3===i.length&&4===e&&i.push(1),t&&(t[n]=i),i}function qB(t,e,n,i){if(t.fill)t.fill(e,n,i);else for(let r=n;r<i;r++)t[r]=e}function ZB(t){return"number"==typeof t&&!isNaN(t)}function QB(t){return t&&(t.markerFile||t.markerType)&&void 0!==t.textName}function XB(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function YB(t,e){if(e){let e=t[t.length-1];const n=[e];for(let i=t.length-2;i>=0;i--)t[i]!==e&&(n.push(t[i]),e=t[i]);return n}{let e=t[t[0]];const n=[e];for(let i=1;i<t.length;i++)t[i]!==e&&(n.push(t[i]),e=t[i]);return n}}const JB=new $o(0,0);function KB(t,e,n,i,r){const o=t.distanceToPointAtRes(e,e,i,n,JB);return r?o.y:o.x}const $B=[],tH=[0,0,0,0],eH=new ht(0,0),nH={color:tH,depth:1,stencil:0},iH=t=>t.isTerrainSkin(),rH=t=>t.isTerrainVector();class oH extends Uf.TileLayerCanvasRenderer{supportRenderMode(){return!0}constructor(t){super(t),this.ke=0,this.ready=!1,this.Pe=1,this.Te={},this.Ie={},this.Fe={}}getTileLevelValue(t,e){if(this.isBackTile(t.id)){const n=t.z,i=5;return n-e>=0?e+i-n:i+(e-n)}return 0}getWorkerConnection(){return this.Ce}getStyleCounter(){return this.Pe}setStyle(){if(this.Oe&&this.Oe.update(),this.Ce){this.Pe++,this.Ee();const t=this.layer.De();t.styleCounter=this.Pe,this.Le=!0,this.Ce.updateStyle(t,(t=>{if(this.Le=!1,t)throw new Error(t);this.Re=!0,this.He(),this.setToRedraw(),this.layer.fire("refreshstyle")}))}else this.He()}Ee(){if(this.ze)for(const e in this.ze){const t=this.ze[e];t&&this.deleteTile(t)}this.ze=this.tilesInView;const t=this.tileCache;for(const e in this.ze){const n=this.ze[e];n&&n.info&&t.getAndRemove(n.info.id)}t.reset(),this.tilesInView={},this.tilesLoading={},this.Te={},this._parentTiles=[],this._childTiles=[],this._tileZoom=void 0}updateOptions(t){this.Ce&&this.Ce.updateOptions(this.layer.getWorkerOptions(),(e=>{if(e)throw new Error(e);t&&(t.features||t.pickingGeometry||t.altitudeProperty)&&(this.clear(),this.Ne(),this.He()),this.setToRedraw()}))}updateSceneConfig(t,e,n){const i=0===t?this.Ve():this.Ue();if(!i||!i[e])return;this.Re=!0;const r=this.layer.De(),o=this.layer.je(t,r);i[e].config=o[e].renderPlugin,i[e].updateSceneConfig({sceneConfig:n}),this.setToRedraw()}updateDataConfig(t,e,n,i){const r=0===t?this.Ve():this.Ue();r&&r[e]&&(this.Re=!0,r[e].updateDataConfig(n,i)?this.setStyle():this.setToRedraw())}updateSymbol(t,e,n){const i=0===t?this.Ve():this.Ue();if(!i||!i[e])return!1;const r=this.layer.De(),o=this.layer.je(t,r),s=i[e];s.style=o[e];const a=s.updateSymbol(n,o[e].symbol);return!a&&lH(n)&&this.setStyle(),this.setToRedraw(),a}needToRedraw(){const t=super.needToRedraw();if(!t){const t=this.Ge();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRedraw())return!0}return t}needRetireFrames(){if(this.Re)return!0;const t=this.Ge();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRetireFrames())return!0;return!1}isAnimating(){const t=this.getMap().getRenderer(),e=t.getFrameTimestamp&&t.getFrameTimestamp()||t._frameTimestamp;if(this.Be&&(this.$e=e,delete this.Be),this.$e===e)return!0;const n=this.Ge();for(let i=0;i<n.length;i++)if(n[i]&&n[i].isAnimating())return!0;return!1}needToRefreshTerrainTileOnZooming(){const t=this.Ge();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRefreshTerrainTileOnZooming())return!0;return!1}We(){return!!(this.canvas&&this.canvas.gl&&this.canvas.gl.wrap)}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;if(t)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const{gl:t,regl:e,attributes:n}=this.Xe(this.canvas);this.gl=t,this.regl=e,this.glOptions=n}if(t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.Ye=new vB(this.regl,this.getMap()),this.qe(),this.Oe=new WM(this.regl,this.layer),!this.consumeTile){const t=this.getMap().VERSION;throw new Error(`Incompatible version of maptalks: ${t}, upgrade maptalks >= v1.0.0-rc.14`)}}Xe(t){const e=this.layer,n=e.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};n.preserveDrawingBuffer=!0,n.stencil=!0;const i=this.Je(t,n);return{gl:i,attributes:n,regl:id({gl:i,attributes:n,extensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],optionalExtensions:e.options.glExtensions||["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_draw_buffers","EXT_shader_texture_lod","EXT_frag_depth"]})}}qe(){this.Ce||(this.Ce=new gB("@maptalks/vt",this.layer)),this.Ce.addLayer(((t,e)=>{this.layer&&(this.ready=!0,this.layer.onWorkerReady(t,e),this.layer.fire("workerready"),this.setToRedraw())}))}Ke(){this.ke++}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear({color:tH,depth:1,stencil:0})}isDrawable(){return!0}checkResources(){return $B}_drawTiles(t,e,n,i,r){if(super._drawTiles(t,e,n,i,r),this.ze)if(Object.keys(this.ze).length)for(const o in this.ze){const t=this.ze[o];t&&t.info&&t.info.id&&!this.tileCache.has(t.info.id)&&this._drawTile(t.info,t.image,r)}else this.Ze(),delete this.ze}Ze(){const t=this.Pe,e=[],n=[];for(const i in this.Ie)+i!==t&&(e.push(i),this.Ve(i).forEach((t=>{t.remove()})));for(const i in this.Fe)+i!==t&&(n.push(i),this.Ue(i).forEach((t=>{t.remove()})));for(let i=0;i<e.length;i++)delete this.Ie[e[i]];for(let i=0;i<n.length;i++)delete this.Fe[n[i]]}draw(t,e){this.Qe!==t&&(this.Re=!1,this.tn());const n=this.layer;if(this.prepareCanvas(),!this.ready||!n.ready)return;let i=this.Ie[this.Pe];i||(this.He(),this.tn(),i=this.Ve());const r=this.Ue();n.isDefaultRender()||i.length||r.length?(n.options.collision&&n.clearCollisionIndex(),this.en=t,this.nn=this.rn(this.getMap().getGLRes()),this.sn=e||{},this.an(t),super.draw(t),this.Qe!==t&&this.hn(t),this.un(t),this.Qe=t):this.completeRender()}tn(){this.Ge().forEach(((t,e)=>{t&&(t.renderIndex=e)}))}hn(){const t=this.Ge();this.cn=this.cn||[];let e=0;for(let n=t.length-1;n>=0;n--){const i=t[n];i.isVisible()&&i.hasMesh()&&(this.cn[n]=e,i.needPolygonOffset()&&e++)}this.Oe.isEnable()&&e++,this.dn=e}getFrameTimestamp(){return this.en}drawOnInteracting(t,e,n){this.draw(e,n)}drawOutline(t){(this.pn||this.mn)&&(this.mn?this.paintOutlineAll(t):this.pn.forEach((e=>{this[e[0]](t,...e[1])})))}getAnalysisMeshes(){return this.getShadowMeshes()}getShadowMeshes(){const t=[];return this.yn().forEach((e=>{if(!e)return;if(!this.gn(e))return;const n=e.getShadowMeshes();if(Array.isArray(n))for(let i=0;i<n.length;i++)t.push(n[i])})),t}isForeground(t){return!(!this.vn||!this.vn[t.properties.tile.id])}xn(t){const e=this.layer;let n=e._getTileZoom(this.getMap().getZoom());const i=e.getMinZoom(),r=e.getMaxZoom();return n=gi.clamp(n,i,r),n-t.properties.tile.z}isTileNearCamera(t){return this.xn(t)<=1}isBackTile(t){return!(!this.bn||!this.bn[t])}loadTileQueue(t){this.Le||super.loadTileQueue(t)}loadTile(t){const{url:e}=t,n=this.Te[e];if(n)n.keys[t.id]||(n.tiles.push(t),n.keys[t.id]=1);else{const n=this.getMap(),i=eH.set(t.extent2d.xmin,t.extent2d.ymax),r=n.pointAtResToCoord(new ht(i),t.res),o=[KB(n,1,r,t.res)/100,KB(n,1,r,t.res,1)/100],s=this.getCentimeterToPoint(t.z),a=this.getTileGLScale(t.z);this.Te[e]={keys:{},tiles:[t]},this.Te[e].keys[t.id]=1;const h=window&&window.location.href;this.Ce.loadTile({tileInfo:{res:t.res,x:t.x,y:t.y,z:t.z,url:t.url,id:t.id,extent2d:t.extent2d},glScale:a,zScale:this.nn,centimeterToPoint:o,verticalCentimeterToPoint:s,fetchOptions:this.layer.options.fetchOptions,styleCounter:this.Pe,referrer:h,workerCacheIndex:this.ke},this.wn.bind(this,e))}return{}}getTileGLScale(t){const e=this.getMap();return this.layer.getSpatialReference().getResolution(t)/e.getGLRes()}getCentimeterToPoint(t){const e=this.getMap();return cB(this.layer.getSpatialReference().getResolution(t),e)}getRenderedFeatures(){const t=[],e=this.tileCache.keys();for(let n=0;n<e.length;n++){const i=this.tileCache.get(e[n]);if(!i||!i.info||!i.image)continue;const{info:r,image:o}=i,s=cH(o);t.push({tile:{id:r.id,x:r.x,y:r.y,z:r.z,url:r.url},current:!!this.tilesInView[r.id],features:s})}return t}wn(t,e,n){if(this.setToRedraw(),!this.Te[t])return;if(n&&n.canceled)return;const i=this.layer,r=i.isDefaultRender(),{tiles:o}=this.Te[t];if(delete this.Te[t],e){if(e.status&&(404===e.status||204===e.status))for(let t=0;t<o.length;t++)this.onTileError(mB,o[t]);return}if(!n){for(let t=0;t<o.length;t++)this.consumeTile({An:!0},o[t]);return}if(n.styleCounter!==this.Pe)return;let s=!1;const a=n.features,h=[];for(let u=0;u<n.data.length;u++){const t=n.data[u];if(!t||!t.data||!t.styledFeatures.length)continue;const{isUpdated:e,layer:i}=this.Mn(0,u,t,a,h);h.push(i),e&&(s=e)}for(let u=0;u<n.featureData.length;u++){const t=n.featureData[u];t&&t.data&&t.styledFeatures.length&&this.Mn(1,u,t,a)}s&&i._n();const l=this.layer.getDataSchema(o[0].z);if(this.Sn(l,n.schema),delete n.features,r&&n.data.length!==h.length){const t=n.data;n.data=[];for(let e=0;e<t.length;e++)t[e]&&t[e].features&&n.data.push(t[e])}n.layers=h;for(let u=0;u<o.length;u++){const t=o[u];if(0===u&&i.options.debugTileData){const{x:e,y:n,z:r}=t;i.getId(),hH(Object.values(a))}const e=0===u?n:sH(n);for(let n=0;n<e.data.length;n++){if(!e.data[n])continue;const i=e.data[n].features;for(const e in i)i[e].tile=t}t.extent=e.extent,this.kn||(this.kn=t.extent),e.features=Object.values(a),e.styleCounter=n.styleCounter,this.onTileLoad(e,t)}this.layer.fire("datareceived",{url:t})}Mn(t,e,n,i){const{style:r,isUpdated:o}=this.Pn(t,e,n.data),s=this.layer,a=s.isDefaultRender(),h=EB(i,n.styledFeatures,e,r.symbol,s,!(!s.getData||!s.getData()));delete n.styledFeatures,n.features=h;let l=n.data;return Array.isArray(l)&&(l=l[0]),{isUpdated:o,layer:a?{layer:l.layer,type:l.type}:null}}Sn(t,e){for(const n in e){t[n]||(t[n]={types:e[n].types,properties:{}});const i=e[n].properties,r=t[n].properties;for(const t in i)(!r[t]||r[t]&&"object"!==i[t]&&"object"===r[t])&&(r[t]=i[t])}}Pn(t,e,n){Array.isArray(n)&&(n=n[0]);const i=this.layer;let r,o=!1;if(i.isDefaultRender()&&0===t){let t=this.Tn;t||(t=this.Tn={});const e=n.layer,i=n.type;t[e]||(t[e]=[]);const s=("plugin_"+i).trim();t[e][s]?r=t[e][s]:(r=this.In(i),r.filter=n.filter,t[e].push(r),t[e][s]=r,o=!0)}else{const s=i.De(),a=i.je(t,s),h=this.Ve();if(r=a[e],!r.renderPlugin){o=!0;const{plugin:t,symbol:i,renderPlugin:s}=this.In(n.type);h[e]=t,r.symbol=i,r.renderPlugin=s}}return{style:r,isUpdated:o}}Ge(t){const e=t&&t.style;let n=this.Ve(e)||[];this.layer.isDefaultRender()&&this.Tn&&(n=[],t?t.layers&&t.layers.forEach((t=>{if(!t)return;const e=("plugin_"+t.type).trim();n.push(this.Tn[t.layer][e].plugin)})):Object.keys(this.Tn).forEach((t=>{for(let e=0;e<this.Tn[t].length;e++)n.push(this.Tn[t][e].plugin)})));const i=this.Ue(e);return i&&i.length&&(n=n.slice(),hB(n,i)),n}yn(){if(this.layer.isDefaultRender()&&this.Tn){const t=[];return Object.keys(this.Tn).forEach((e=>{for(let n=0;n<this.Tn[e].length;n++)t.push(this.Tn[e][n].plugin)})),t}const t=[];for(const e in this.Ie)t.push(...this.Ie[e]);for(const e in this.Fe)t.push(...this.Fe[e]);return t}Ve(t){return aB(t)&&(t=this.Pe),this.Ie[t]||$B}Ue(t){return aB(t)&&(t=this.Pe),this.Fe[t]||$B}an(t,e){const n=!!this.Fn,i=this.layer.isDefaultRender()&&this.Tn,r=this.sn;this.yn().forEach(((o,s)=>{if(!o||e&&!e(o))return;if(!this.gn(s))return;const a={regl:this.regl,layer:this.layer,symbol:i?o.defaultSymbol:o.style&&o.style.symbol,gl:this.gl,isRenderingTerrain:n,sceneConfig:o.config?o.config.sceneConfig:null,dataConfig:o.config?o.config.dataConfig:null,pluginIndex:s,timestamp:t};r&&nB(a,r),o.startFrame(a)}))}un(t){const e=this.sn,n=e.renderMode,i=e&&e.renderTarget&&e.renderTarget.fbo,r=this.getMap().cameraPosition,o=this.yn(),s=!!this.Fn,a=!e.timestamp||e.isFinalRender;o.forEach(this.layer.options.collision&&!e.isPostProcess?e=>{if(!this.gn(e)||!e.hasMesh())return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(s&&!rH(e))return;const i=this.Cn(e,0,r,t);e.prepareRender(i),e.updateCollision(i)}:e=>{if(!this.gn(e)||!e.hasMesh())return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(s&&!rH(e))return;const i=this.Cn(e,0,r,t);e.prepareRender(i)});let h=!1;if(this.Qe!==e.timestamp&&!s){const e=this.layer.getPolygonOffset()+this.layer.getPolygonOffsetCount(),n=this.Cn(null,e,r,t);n.offsetFactor=e,n.offsetUnits=e,this.Oe.paint(n)}o.forEach(((e,o)=>{if(!this.On(e))return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(s&&!rH(e))return;this.regl.clear({stencil:255,framebuffer:i});const a=this.Cn(e,this.cn[o]||0,r,t);e.painter&&e.painter.isEnableTileStencil(a)&&this.En(i,e.painter);const l=e.endFrame(a);l&&l.redraw&&this.setToRedraw(),h=!0})),h&&this.layer.fire("canvasisdirty"),a&&this.Dn()}getPolygonOffsetCount(){return this.dn||0}Dn(){if(this.layer.options.debug){const t=this.sn,e=[],n=this.getMap().projViewMatrix;for(const i in this.tilesInView){const r=this.tilesInView[i].info,o=this.tilesInView[i].image;if(o.An)continue;const s=r.transform,a=o.extent,h=t&&t.renderTarget;if(s&&a){const t=this.getDebugInfo(r.id),i=Hp(e,n,s),o=this.layer.getTileSize().width;this.Ye.draw(t,i,o,a,h&&h.fbo)}}}}On(t){if(!t)return!0;const e=this.sn,n=this.gn(t),i=e&&e.states&&e.states.includesChanged,r=this.Ln(t.painter.scene.getMeshes());return n&&(i||r)?r?2:1:0}Cn(t,e,n,i){const r=!!this.Fn,o=r&&t&&iH(t),s={regl:this.regl,layer:this.layer,gl:this.gl,isRenderingTerrain:r,isRenderingTerrainSkin:o,sceneConfig:t&&t.config.sceneConfig,pluginIndex:t&&t.renderIndex,polygonOffsetIndex:e,cameraPosition:n,timestamp:i},a=this.sn;return a&&nB(s,a),s}Ln(t){if(!t)return!1;const e=this.sn&&this.sn.sceneFilter;return e?t.filter((t=>e(t)||t.properties.hlBloomMesh&&e(t.properties.hlBloomMesh))).length>0:t.length>0}En(t,e){const n=e.isUniqueStencilRefPerTile(),i=this.getCurrentTileZoom();let r=this.Rn;r||(r=this.Rn=new CB(this.regl,this.canvas,this.getMap())),r.start();const{tiles:o}=this.Hn;let{parentTiles:s,childTiles:a}=this.Hn,h=1;a=a.sort(aH);for(let u=0;u<a.length;u++){const t=n?h:this.getTileLevelValue(a[u].info,i);this.zn(a[u].info,t),h++}s=s.sort(aH);for(let u=0;u<s.length;u++){const t=n?h:this.getTileLevelValue(s[u].info,i);this.zn(s[u].info,t),h++}const l=o.sort(aH);for(let u=l.length-1;u>=0;u--){const t=n?h:this.getTileLevelValue(l[u].info,i);this.zn(l[u].info,t),h++}r.render(t)}zn(t,e){const n=eH.set(t.extent2d.xmin,t.extent2d.ymax),i=t.extent||this.kn||8192,r=t.transform=t.transform||this.calculateTileMatrix(n,t.z,i);t.stencilRef=e,this.Rn.add(e,i,r)}onDrawTileStart(t){super.onDrawTileStart(t);const{tiles:e,childTiles:n,parentTiles:i}=t;this.vn={},this.bn={};for(let r=0;r<e.length;r++)this.vn[e[r].info.id]=1;for(let r=0;r<n.length;r++)this.bn[n[r].info.id]=1;for(let r=0;r<i.length;r++)this.bn[i[r].info.id]=1;this.Hn=t}isEnableTileStencil(){if(this.layer.options.altitude)return!1;const t=this.Ge();for(let e=0;e<t.length;e++)if(t[e]&&t[e].painter&&!t[e].painter.isOnly2D())return!1;return!0}setTerrainHelper(t){this.Fn=t}getTerrainHelper(){return this.Fn}drawTileOnTerrain(...t){oH.prototype.drawTile.call(this,...t)}createTerrainTexture(t){const e=this.layer.getTileSize().width,n=2*e,i=2*e,r=t.texture({min:"linear",mag:"linear",type:"uint8",width:n,height:i});this.Nn||(this.Nn=t.renderbuffer({width:n,height:i,format:"depth24 stencil8"}));const o={width:n,height:i,colors:[r],colorFormat:"rgba",ignoreStatusCheck:!0};o.depthStencil=this.Nn;const s=t.framebuffer(o);return s.colorTex=r,s}deleteTerrainTexture(t){t.destroy(),t.colorTex&&(t.colorTex.destroy(),delete t.colorTex)}renderTerrainSkin(t,e,n){const i=this.Qe,r=this.sn,o=this.layer.getTileSize().width;this.an(i);for(let s=0;s<n.length;s++){const e=n[s].texture;this.sn={renderTarget:{fbo:e}},nH.framebuffer=e,t.clear(nH),this.sn.viewport=uH(o),this.Vn(n[s].tile,e)}this.Un(n),this.sn=r}Vn(t){const{info:e,image:n}=t;this.drawTile(e,n,iH)}Un(t){const e=this.yn(),n=this.getMap().cameraPosition,i=this.Qe||0;e.forEach(this.layer.options.collision?t=>{if(!this.gn(t)||!t.hasMesh())return;if(!iH(t)||!this.layer.options.awareOfTerrain)return;const e=this.Cn(t,0,n,i);e.isRenderingTerrainSkin=!0,t.prepareRender(e),t.updateCollision(e)}:t=>{if(!this.gn(t)||!t.hasMesh())return;if(!iH(t)||!this.layer.options.awareOfTerrain)return;const e=this.Cn(t,0,n,i);e.isRenderingTerrainSkin=!0,t.prepareRender(e)}),e.forEach(((e,n)=>{if(!this.On(e)||!iH(e))return;for(let r=0;r<t.length;r++)this.regl.clear({stencil:255,framebuffer:t[r].texture});const i=this.Cn(e,this.cn[n]||0,[0,0,0],this.Qe);i.isRenderingTerrainSkin=!0,e.endFrame(i)}))}drawTile(t,e,n){if(!e.cache)return;const i=!!this.Fn,r=e.cache,o=eH.set(t.extent2d.xmin,t.extent2d.ymax),s=t.extent||this.kn||8192,a=t.transform=t.transform||this.calculateTileMatrix(o,t.z,s),h=t.tileTranslationMatrix=t.tileTranslationMatrix||this.calculateTileTranslationMatrix(o,t.z),l=t.terrainTransform=t.terrainTransform||this.calculateTerrainTileMatrix(o,t.z,s),u=this.sn,c=[];hB(c,e.data),hB(c,e.featureData),this.Ge(e).forEach(((o,s)=>{if(!o||n&&!n(o))return;if(!c[s])return;if(!r[s])return;const A=i&&iH(o),f={regl:this.regl,layer:this.layer,gl:this.gl,sceneConfig:o.config.sceneConfig,pluginIndex:s,tileCache:r[s],tileData:c[s],tileTransform:A?l:a,tileVectorTransform:a,tileTranslationMatrix:h,tileExtent:e.extent,timestamp:this.en,tileInfo:t,tileZoom:this._tileZoom,bloom:this.sn&&this.sn.bloom,isRenderingTerrain:i,isRenderingTerrainSkin:A};A&&u&&u.renderTarget&&(f.renderTarget=u.renderTarget);const d=o.paintTile(f);!this.Re&&(d.retire||d.redraw)&&o.supportRenderMode("taa")&&(this.Re=!0),d.redraw&&this.setToRedraw()})),e&&e.style===this.Pe&&this.jn(t),this.setCanvasUpdated()}Gn(t,e){if(!e.loadTime||e.An)return;let n=e.cache;n||(n=e.cache={});const i=!!this.Fn,r=eH.set(t.extent2d.xmin,t.extent2d.ymax),o=t.transform=t.transform||this.calculateTileMatrix(r,t.z,e.extent),s=t.tileTranslationMatrix=t.tileTranslationMatrix||this.calculateTileTranslationMatrix(r,t.z),a=t.terrainTransform=t.terrainTransform||this.calculateTerrainTileMatrix(r,t.z,t.extent),h=[];hB(h,e.data),hB(h,e.featureData),this.Ge(e).forEach(((r,l)=>{if(!r)return;if(!h[l])return;const u=i&&iH(r),c=this.regl,A=this.gl;n[l]||(n[l]={});const f=r.createTile({regl:c,layer:this.layer,gl:A,sceneConfig:r.config.sceneConfig,pluginIndex:l,tileCache:n[l],tileData:h[l],tileTransform:u?a:o,tileVectorTransform:o,isRenderingTerrain:i,isRenderingTerrainSkin:u,tileTranslationMatrix:s,tileExtent:e.extent,timestamp:this.en,tileInfo:t,tileZoom:this._tileZoom});n[l].geometry&&(e.data[l]=1),!this.Re&&f.retire&&r.supportRenderMode("taa")&&(this.Re=!0)}))}checkTileInQueue(t){return t.styleCounter===this.Pe}pick(t,e,n){const i=[];return this.layer.isVisible()?(this.Ge().forEach((r=>{if(!r)return;if(!this.gn(r))return;const o=r.pick(t,e,n.tolerance);o&&(o.type=r.getType(),i.push(o))})),i):i}deleteTile(t){if(t){if(t.image&&!t.image.An){const e=this.Ve(t.image&&t.image.style);e&&e.forEach(((e,n)=>{e&&e.deleteTile({pluginIndex:n,regl:this.regl,layer:this.layer,gl:this.gl,tileCache:t.image.cache?t.image.cache[n]:{},tileInfo:t.info,tileData:t.image})})),t.image.cache={}}t.info&&(delete t.info.completeTerrainQuery,delete t.info.terrainQueryStatus),super.deleteTile(t)}}abortTileLoading(t,e){e&&e.url&&(this.Ce&&this.Ce.abortTile(e.url),delete this.Te[e.url]),super.abortTileLoading(t,e)}resizeCanvas(t){super.resizeCanvas(t);const e=this.canvas;e&&(!this.pickingFBO||this.pickingFBO.width===e.width&&this.pickingFBO.height===e.height||(this.pickingFBO.resize(e.width,e.height),this.Ge().forEach((t=>{t&&t.resize(e.width,e.height)}))))}onRemove(){this.Rn&&this.Rn.remove(),this.Ce&&(this.Ce.removeLayer((t=>{if(t)throw t})),this.Ce.remove(),delete this.Ce),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.Ye&&(this.Ye.delete(),delete this.Ye),this.Nn&&(this.Nn.destroy(),delete this.Nn),this.Oe&&(this.Oe.dispose(),delete this.Oe),super.onRemove&&super.onRemove(),this.Ne()}Ne(){this.yn().forEach((t=>{t.remove()})),this.plugins={}}hitDetect(t){if(!this.gl||!this.layer.options.hitDetect)return!1;const e=this.gl,n=new Uint8Array(4);return e.readPixels(t.x,this.canvas.height-t.y,1,1,e.RGBA,e.UNSIGNED_BYTE,n),n[3]>0}He(){const{style:t,featureStyle:e}=this.layer.De(),n=t.map(((t,e)=>{const n=t.renderPlugin;if(!n)return null;if(!n.type)throw new Error("invalid plugin type for style at "+e);const i=this.Bn(n);return i.styleCounter=this.Pe,i.style=t,i})),i=[];e.forEach(((t,e)=>{const n=t.renderPlugin;if(!n)return null;if(!n.type)throw new Error("invalid plugin type for features at "+e);const r=this.Bn(n);return r.style=t,r.styleCounter=this.Pe,i.push(r),r}));const r=this.Pe;return this.Ie[r]=n,this.Fe[r]=i,this.layer.fire("pluginsinited"),(this.$n&&this.$n.size||this.layer.$n)&&(this.layer.$n&&this.layer.Wn(),this.getMap().getRenderer().callInNextFrame((()=>{this.Ge().forEach((t=>{t.highlight(this.$n)}))}))),n}Bn(t){const e=this.layer.constructor.getPlugins()[t.type];if(!e)throw new Error(`Plugin for (${t.type}) is not loaded.`);const n=new e;return n.config=t,n.config.sceneConfig||(n.config.sceneConfig={}),n}Je(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let o=0;o<n.length;++o){try{i=t.getContext(n[o],e)}catch(r){}if(i)break}return i}rn(t){return cB(t,this.getMap())}debugFBO(t,e){const n=document.getElementById(t),i=e.width,r=e.height;n.width=i,n.height=r;const o=n.getContext("2d"),s=this.regl.read({framebuffer:e}),a=r/2|0,h=4*i;for(let c=0;c<s.length;c++)s[c]*=255;const l=new Uint8Array(4*i);for(let c=0;c<a;++c){const t=c*h,e=(r-c-1)*h;l.set(s.subarray(t,t+h)),s.copyWithin(t,e,e+h),s.set(l,e)}const u=new ImageData(i,r);u.data.set(s),o.putImageData(u,0,0)}In(t){let e;switch(t){case"native-line":e={type:"native-line",dataConfig:{type:"native-line",only2D:!0}};break;case"native-point":e={type:"native-point",dataConfig:{type:"native-point",only2D:!0}};break;case"fill":e={type:"fill",dataConfig:{type:"fill",only2D:!0},sceneConfig:{antialias:!0}};break;default:e=null}const n=function(t){switch(t){case"native-point":return{markerFill:"#f00",markerSize:6,markerOpacity:.5};case"native-line":return{lineColor:"#bbb",lineOpacity:.5};case"fill":return{polygonFill:"#76a6f0",polygonOpacity:.8}}return null}(t),i=this.Bn(e);return i.defaultSymbol=n,{plugin:i,symbol:n,renderPlugin:e}}gn(){return!0}isEnableWorkAround(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&function(t){const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&"undefined"!=typeof navigator){const n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),i="Win32"===navigator.platform||"Win64"===navigator.platform;if(n&&n.toLowerCase().indexOf("intel")>=0&&i)return!0}return!1}(this.gl)}getZScale(){return this.nn}outline(t,e){e&&(Array.isArray(e)||(e=[e]),this.pn||(this.pn=[]),this.pn.push(["paintOutline",[t,e]]),this.setToRedraw())}outlineFeatures(t){t&&(Array.isArray(t)||(t=[t]),this.pn||(this.pn=[]),this.pn.push(["paintOutline",[null,t]]),this.setToRedraw())}outlineBatch(t){this.pn||(this.pn=[]),this.pn.push(["paintBatchOutline",[t]]),this.setToRedraw()}outlineAll(){this.mn=!0,this.setToRedraw()}paintOutlineAll(t){const e=this.Ge();for(let n=0;n<e.length;n++)e[n].outlineAll(t)}paintOutline(t,e,n){if(!aB(e)){const i=e,r=this.Ge();if(!r[i]||r[i].painter&&!r[i].painter.isVisible())return;return void r[i].outline(t,n)}const i=this.Ge();for(let r=0;r<n.length;r++){const e=n[r];for(let n=0;n<i.length;n++)i[n].style&&i[n].style.id===e&&i[n].outline(t,[e])}}paintBatchOutline(t,e){const n=this.Ge();!n[e]||n[e].painter&&!n[e].painter.isVisible()||n[e].outlineAll(t)}cancelOutline(){delete this.pn,delete this.mn,this.setToRedraw()}setZIndex(){return this.setToRedraw(),this.Re=!0,super.setZIndex.apply(this,arguments)}consumeTile(t,e){if(this.jn(e),super.consumeTile(t,e),"transient"===this.layer.options.features&&t.data){for(let e=0;e<t.data.length;e++){if(!t.data[e])continue;const n=t.data[e].features;if(n)for(const t in n){const e=n[t]&&n[t].feature;e&&(e.fnTypeProps?e.customProps[OB]=e.fnTypeProps:n[t]=null)}}this.layer.fire("_transientfeature",{tileImage:t})}t&&t.features&&(t.features=[]),this.Gn(e,t)}onTileError(t,e){this.jn(e),super.onTileError(t,e)}jn(t){const{id:e}=t;this.ze&&this.ze[e]&&(this.deleteTile(this.ze[e]),delete this.ze[e])}highlight(t){if(this.$n||(this.$n=new Map),Array.isArray(t))for(let e=0;e<t.length;e++)aB(t[e].name)&&!aB(t[e].id)&&(t[e]=nB({},t[e]),t[e].name=t[e].id),this.$n.set(t[e].name,t[e]);else aB(t.name)&&!aB(t.id)&&((t=nB({},t)).name=t.id),this.$n.set(t.name,t);this.Ge().forEach((t=>{t.highlight(this.$n)})),this.Be=!0}cancelHighlight(t){if(this.$n){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.$n.delete(t[e]);else this.$n.delete(t);this.Ge().forEach((t=>{t.highlight(this.$n)})),this.Be=!0}}cancelAllHighlight(){this.$n&&(delete this.$n,this.Ge().forEach((t=>{t.cancelAllHighlight()})),this.Be=!0)}Xn(){const t=this.layer.options.opacity;return this.We()?aB(t)?1:t:1}}function sH(t){let e;Array.isArray(t.data)?(e=[],hB(e,t.data)):(e={},nB(e,t.data));const n=nB({},t);return n.data=e,n}function aH(t,e){return e.info.z-t.info.z}function hH(t){const e={};for(let n=0;n<t.length;n++){const i=t[n].layer||"default";e[i]||(e[i]=[]),e[i].push(t[n])}return e}function lH(t){if(Array.isArray(t)){const e=t;for(let t=0;t<e.length;t++)if(lH(e[t]))return!0}for(const e in t)if(SE(t[e])||qF(t[e]))return!0;return!1}function uH(t){return{x:0,y:0,width:2*t,height:2*t}}function cH(t){if(!t.cache)return[];for(const e in t.cache){const n=t.cache[e];if(n.geometry)for(let t=0;t<n.geometry.length;t++){const e=n.geometry[t]&&n.geometry[t].geometry;if(e&&e.properties&&e.properties.features){const t=e.properties.features.empty;delete e.properties.features.empty;const n=Object.values(e.properties.features);return void 0!==t&&(e.properties.features.empty=t),n}}}return[]}oH.include({calculateTileMatrix:function(){const t=new Array(3),e=new Array(3),n=new Array(3);return function(i,r,o){const s=this.getTileGLScale(r),a=i,h=this.layer.getTileSize().width,l=Np([]);return Up(l,l,pg(t,s,s,this.nn)),jp(l,l,pg(e,a.x,a.y,0)),Up(l,l,pg(n,h/o,-h/o,1)),l}}(),calculateTerrainTileMatrix:function(){const t=new Array(3);return function(e,n,i){const r=Np([]),o=i/2;return Up(r,r,pg(t,1/o,-1/o,0)),jp(r,r,pg(t,-o,-o,0)),r}}(),calculateTileTranslationMatrix:function(){const t=new Array(3);return function(e,n){const i=this.getTileGLScale(n),r=e,o=Np([]);return jp(o,o,pg(t,r.x*i,r.y*i,0)),o}}()});const AH=new ht(0,0),fH=new $o(0,0),dH=[null,0],pH=[];class gH extends lA{static loadFrom(t,e){return fetch(t,e||{}).then((t=>t.json())).then((t=>gH.fromJSON(t)))}constructor(t,e){super(t,e),this.Yn={},this.VERSION=gH.VERSION,this.setStyle(e&&e.style)}setURLModifier(t){this.qn=t;const e=this.getRenderer();return e&&e.updateOptions(),this}getURLModifier(){return this.qn}onAdd(){const t=this.getMap();this.Jn();const e=this.getSpatialReference().toJSON().projection,n=t.getSpatialReference().toJSON().projection;if((e&&e.toLowerCase())!==(n&&n.toLowerCase()))throw new Error(`VectorTileLayer's projection(${e}) must be the same with map(${n}).`)}setFeatureState(t,e){if(aB(t.id))throw new Error("missing id in first parameter of setFeatureState.");this.Kn||(this.Kn={});const n=t.layer||"0";let i=this.Kn[n];return this.Kn[n]||(i=this.Kn[n]=new Map),i.set(t.id,e),this.Zn(),this}removeFeatureState(t,e){if(aB(t.id))throw new Error("missing id in first parameter of removeFeatureState.");if(!this.Kn)return this;const n=this.Kn[t.layer||"0"];if(!n)return this;if(e){const i=n.get(t.id);if(sB(e))for(const t in e)delete i[t];else delete i[e];n.set(t.id,i)}else n.delete(t.id);return this.Zn(),this}getFeatureState(t){if(aB(t.id))throw new Error("missing id in first parameter of getFeatureState.");return this.Kn?this.Kn[t.layer||"0"].get(t.id):null}Zn(){const t=this.getRenderer();if(!t)return;const e=t.getFrameTimestamp();this.Qn=e}ti(){return this.Qn}ei(t){return this.Qn&&this.Qn!==t}Jn(){const t=this.options,e=this.getMap().getProjection(),n="EPSG:4326"===e.code||"EPSG:4490"===e.code,i="EPSG:3857"===e.code;t.spatialReference||512===this.getTileSize().width&&(i?t.spatialReference="preset-vt-3857":n&&(t.spatialReference="preset-vt-4326")),t.tileSystem||(t.tms?i?t.tileSystem=[1,1,-6378137*Math.PI,-6378137*Math.PI]:n&&(t.tileSystem=[1,1,-180,-90]):n&&(t.tileSystem=[1,-1,-180,90]))}forceReload(){const t=this.getRenderer();return t&&t.Ke(),super.forceReload()}onWorkerReady(){}onConfig(t){const e=this.getRenderer();e&&e.updateOptions(t)}getWorkerOptions(){return{debug:this.options.debug,debugTile:this.options.debugTile,altitudeProperty:this.options.altitudeProperty,tileSize:this.getTileSize().width,style:this.isDefaultRender()?{style:[],featureStyle:[]}:this.De(),features:this.options.debugTileData||this.options.features,schema:this.options.schema,pickingGeometry:this.options.pickingGeometry,projectionCode:this.getSpatialReference().getProjection().code,workerGlyph:this.options.workerGlyph&&!this.getURLModifier(),featureIdProperty:this.options.featureIdProperty}}setStyle(t){if(t&&(iB(t)||t.url)){const e=t,n=e.lastIndexOf("/"),i=n<0?".":e.substring(0,n);return this.ready=!1,dB.getJSON(t.url?t.url:t,t.url?t:{},((t,n)=>{if(t)throw this.setStyle([]),t;let r;n.style?(r=n,r.$root||(r.$root=i)):r={$root:i,style:n},this.options.style=e,this.ni(r)})),this}return this.options.style=t,this.ni(t),this}ii(t,e,n,i){const r=i/this.getTileSize().width;return t.set(n.x+e.x/r,n.y-e.y/r)}queryTilePointTerrain(t,e,n,i,r){const o=this.getRenderer(),s=o&&o.getTerrainHelper();if(!o||!s)return dH[0]=null,dH[1]=0,dH;const a=this.ii(AH,t,n,i);return e&&s.queryTileTerrainByPointAtRes?s.queryTileTerrainByPointAtRes(a,r,e.id,e,pH):(dH[0]=null,dH[1]=0,dH)}queryTerrainTiles(t){const e=this.getRenderer(),n=e&&e.getTerrainHelper();return e&&n?n.getTerrainTiles(t):null}ni(t){if(t&&t.$root){let e=t.$root;e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),this.dt=function(t){return"{$root}"===t?e:null}}this.ready=!0,t=t||[],Array.isArray(t)?t={style:t}:t.renderPlugin&&(t={style:[t]}),t=function(t){if(!t.plugins)return t;const{plugins:e,styles:n}=t;let{style:i,featureStyle:r}=n;i=i||[],r=r||[];const o=new Array(i.length);for(let h=0;h<i.length;h++)o[h]=nB({},i[h]),o[h].renderPlugin=e[i[h].renderPlugin];const s=new Array(r.length);for(let h=0;h<r.length;h++)s[h]=nB({},r[h]),s[h].renderPlugin=e[r[h].renderPlugin];const a={style:o,featureStyle:s};return t.$root&&(a.$root=t.$root),a}(t=JSON.parse(JSON.stringify(t))),this.ri=t.featureStyle||[],this.si=function(t){if(!t||!Array.isArray(t))return[];const e=[];for(let n=0;n<t.length;n++){const i=t[n].style;if(i&&Array.isArray(i)&&i.length)for(let r=0;r<i.length;r++){const o=nB({},t[n],i[r]);i[r].oi=e.length,delete o.style,e.push(o)}else e.push(nB({},t[n]))}return e}(t.featureStyle),this.ai=t.style||[];const e=t.background||{};this.li={enable:e.enable||!1,color:yH(e.color)||[0,0,0,0],opacity:vH(e.opacity,1),patternFile:e.patternFile,depthRange:e.depthRange},this.validateStyle(),this.dt&&this.hi(),this._n();const n=this.getRenderer();n&&n.setStyle(),this.fire("setstyle",{style:this.getStyle(),computedStyle:this.getComputedStyle()})}getPolygonOffsetCount(){const t=this.getRenderer();return t?t.getPolygonOffsetCount():0}getPolygonOffset(){return this.ui||0}setPolygonOffset(t,e){return this.ui=t,this.ci=e,this}getTotalPolygonOffset(){return this.ci}fi(t){if(!t||!t.length)return;const e=this._getTileConfig();let n;for(let i=0,r=t.length;i<r;i++){const{feature:r,tile:o}=t[i],s=r.geometry;if(!r||!o||!s)continue;if(s.type)continue;const{x:a,y:h,res:l,extent:u}=o;void 0===a&&void 0===h&&void 0===l||(n=e.getTilePointNW(a,h,l));const c=this.di(r.type,s,n,u,l);r.geometry=c}}getRenderedFeatures(){const t=this.getRenderer();if(!t)return[];const e=t.getRenderedFeatures()||[];for(let n=0,i=e.length;n<i;n++){const t=e[n];t&&this.fi(t.features||[])}return e}getRenderedFeaturesAsync(t={}){return new Promise(((e,n)=>{const i=this.getRenderer();if(i)if(kr){const n=i.getRenderedFeatures()||[],r=[];n.forEach((t=>{const e=t.features||[];e.length&&hB(r,e)}));const o=(t=Object.assign({},{countPerTime:1e4},t)).countPerTime,s=Math.ceil(r.length/o);let a=1;const h=()=>{const t=r.slice((a-1)*o,a*o);this.fi(t),a++};kr.runTaskAsync({count:s,run:h}).then((()=>{e(n)}))}else e(this.getRenderedFeatures());else e([])}))}outlineAll(){const t=this.getRenderer();return t?(t.outlineAll(),this):this}outline(t,e){const n=this.getRenderer();return n?(n.outline(t,e),this):this}outlineBatch(t){const e=this.getRenderer();return e?(e.outlineBatch(t),this):this}outlineFeatures(t){const e=this.getRenderer();return e?(e.outlineFeatures(t),this):this}cancelOutline(){const t=this.getRenderer();return t?(t.cancelOutline(),this):this}highlight(t){this.mi(t);const e=this.getRenderer();return e?(e.highlight(t),this):(this.$n||(this.$n=[]),this.$n.push(t),this)}mi(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.mi(t[e]);else{if(t.filter){if(!this.options.features)throw new Error("options.features must be turned on to support filter in highlight");if(!t.name)throw new Error("A name is required for highlight with filter")}if(aB(t.filter)&&aB(t.id))throw new Error("id or filter must be provided for highlight")}}Wn(){if(this.$n){for(let t=0;t<this.$n.length;t++)this.highlight(this.$n[t]);delete this.$n}}cancelHighlight(t){const e=this.getRenderer();return e?(e.cancelHighlight(t),this):this}cancelAllHighlight(){const t=this.getRenderer();return t?(t.cancelAllHighlight(),this):this}hi(){gi.convertStylePath(this.ai,this.dt),gi.convertStylePath(this.si,this.dt)}updateSceneConfig(t,e){return iB(t)&&(t=this.yi(t)),this.gi(0,t,e)}updateFeatureSceneConfig(t,e,n){return this.gi(1,t,n,e)}gi(t,e,n,i){const r=this.je(t);if(!r)return this;let o,s=e;if(r[e].renderPlugin.sceneConfig||(r[e].renderPlugin.sceneConfig={}),nB(r[e].renderPlugin.sceneConfig,n),void 0!==i){_H(this.ri,e,i),s=this.ri[e].style[i].oi;const t=r[s].renderPlugin;t.sceneConfig||(t.sceneConfig={}),o=t.sceneConfig}else xH(r,e),o=r[e].renderPlugin.sceneConfig;if(nB(o,n),Array.isArray(this.options.style)){const t=this.options.style[e].renderPlugin;t.sceneConfig||(t.sceneConfig={}),nB(t.sceneConfig,n)}else{const r=this.je(t,this.options.style);let o;void 0!==i?(_H(r,e,i),o=r[e].style[i].renderPlugin):(xH(r,e),o=r[e].renderPlugin),o.sceneConfig||(o.sceneConfig={}),nB(o.sceneConfig,n)}const a=this.getRenderer();return a&&a.updateSceneConfig(t,s,n),0===t?this.fire("updatesceneconfig",{index:e,sceneConfig:n}):1===t&&this.fire("updatefeaturesceneconfig",{index:e,styleIdx:i,sceneConfig:n}),this}updateDataConfig(t,e){return iB(t)&&(t=this.yi(t)),this.vi(0,t,e)}updateFeatureDataConfig(t,e,n){return this.vi(1,t,n,e)}vi(t,e,n,i){const r=this.je(t);if(!r)return this;let o,s=e;void 0!==i?(_H(this.ri,e,i),s=this.ri[e].style[i].oi,o=r[s].renderPlugin.dataConfig):(xH(r,e),o=r[e].renderPlugin.dataConfig);const a=nB({},o);if(nB(o,n),Array.isArray(this.options.style))nB(this.options.style[e].renderPlugin.dataConfig,n);else{const r=this.je(t,this.options.style);let o;void 0!==i?(_H(r,e,i),o=r[e].style[i].renderPlugin):(xH(r,e),o=r[e].renderPlugin),o.dataConfig||(o.dataConfig={}),nB(o.dataConfig,n)}const h=this.getRenderer();return h&&h.updateDataConfig(t,s,n,a),0===t?this.fire("updatedataconfig",{index:e,dataConfig:n}):1===t&&this.fire("updatefeaturedataconfig",{index:e,styleIdx:i,dataConfig:n}),this}updateSymbol(t,e){return iB(t)&&(t=this.yi(t)),this.xi(0,t,e)}updateFeatureSymbol(t,e,n){return this.xi(1,t,n,e)}xi(t,e,n,i){const r=this.je(t);if(!r)return this;let o=e;void 0!==i&&(_H(this.ri,e,i),o=this.ri[e].style[i].oi);const s=r[o];if(!s)throw new Error(`No style defined at ${e}`);const a=this,h=this.dt;function l(n,r,o){if(!n)return!1;h&&(n=JSON.parse(JSON.stringify(n)),gi.parseSymbolPath(n,h));const s=Object.keys(n);let l=!1;for(let t=0;t<s.length;t++){const e=s[t];if(mH(r[e])||mH(n[e])){l=!0;break}}for(const t in n)uB(n,t)&&(!gi.isObject(n[t])||Array.isArray(n[t])||SE(n[t])?r[t]=n[t]:(r[t]||(r[t]={}),nB(r[t],n[t])));let u=a.options.style;if(iB(u))return l;Array.isArray(u)||(u=a.je(t,a.options.style));const c=JSON.parse(JSON.stringify(r));return void 0!==i?(_H(u,e,i),void 0===o?u[e].style[i].symbol=c:u[e].style[i].symbol[o]=c):(xH(u,e),void 0===o?u[e].symbol=c:u[e].symbol[o]=c),l}const u=this.getRenderer();if(!u)return l(),this._n(),this;let c=!1;const A=s.symbol;if(Array.isArray(n))for(let f=0;f<n.length;f++){const t=l(n[f],A[f],f);t&&(c=t)}else l(n,A);return this._n(),c?u.setStyle():(c=u.updateSymbol(t,o,n),c&&u.setStyle()),0===t?this.fire("updatesymbol",{index:e,symbol:n}):1===t&&this.fire("updatefeaturesymbol",{index:e,featureStyleIndex:i,symbol:n}),this}je(t,e){return e?0===t?e.style:e.featureStyle:0===t?this.ai:this.si}isDefaultRender(){return!!this.bi&&this.options.defaultRendering}validateStyle(){this.bi=!1;let t=this.ai;this.options.style||(this.bi=!0,t=this.ai=[]),Array.isArray(t)||(t=this.ai=[t]);for(let e=0;e<t.length;e++){let n=t[e].filter;if(n&&n.value&&(n=n.value),n||console.warn(`render plugin at ${e} doesn't define filter, its filter will be set to 'default' by default.`),void 0!==n&&"default"!==n&&!0!==n&&!Array.isArray(n)&&void 0===n.condition)throw new Error(`Invalid filter at ${e} : ${JSON.stringify(n)}`)}}getStyle(){return this.options.style?JSON.parse(JSON.stringify(this.options.style)):null}yi(t){const e=this.ai;if(!e)return-1;for(let n=0;n<e.length;n++)if(e[n].name===t)return n;throw new Error(`No style defined with name: ${t}`)}getGroundConfig(){this.wi||(this.wi={enable:!0,renderPlugin:{type:"fill",sceneConfig:{}},symbol:{polygonFill:[0,0,0,0],polygonOpacity:1}});const t=this.De().background||{};return this.wi.enable=t.enable,this.wi.symbol.polygonFill=t.color,this.wi.symbol.polygonOpacity=t.opacity,this.wi.symbol.polygonPatternFile=t.patternFile,this.wi.renderPlugin.sceneConfig.depthRange=t.depthRange,this.wi}getComputedStyle(){return JSON.parse(JSON.stringify(this.De()))}De(){return{background:this.li,style:this.ai||[],featureStyle:this.si||[]}}identify(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=n.coordToContainerPoint(new $o(t));return this.identifyAtPoint(r,e)}identifyAtPoint(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=n.getDevicePixelRatio();let o=i.pick(t.x*r,t.y*r,e);return this.options.features&&"id"!==this.options.features&&(o=this.Ai(o)),e&&e.filter?o.filter((t=>e.filter(t))):o}Ai(t){if(!this.getRenderer())return t;const e=this._getTileConfig(),n=this.getSpatialReference();for(let i=0;i<t.length;i++){let r=t[i];if(!r||!r.data)continue;const{tile:o}=r.data,{x:s,y:a,z:h,extent:l}=o,u=n.getResolution(h),c=e.getTilePointNW(s,a,u),A=r.data.feature&&r.data.feature.geometry;if(A){r.data=nB({},r.data),r.data.feature=nB({},r.data.feature);const t=r.data.feature.type;r.data.feature.type="Feature",r.data.feature.geometry=this.di(t,A,c,l,u)}}return t}di(t,e,n,i,r){if(e.type&&e.coordinates)return e;let o,s;if(1===t)e.length<=1?(o="Point",s=this.Mi(e,n,i,r)||[]):(o="MultiPoint",s=this.Mi(e,n,i,r));else if(2===t)e.length<=1?(o="LineString",s=this.Mi(e,n,i,r)||[]):(o="MultiLineString",s=this.Mi(e,n,i,r));else if(3===t){s=[];let t=[],a=0;for(let o=0;o<e.length;o++)pD(e[o])>0&&(a++,t&&t.length&&s.push(t),t=[]),t.push(this.Mi(e[o],n,i,r));t.length&&s.push(t),a<=1?(o="Polygon",s=s[0]):o="MultiPolygon"}return{type:o,coordinates:s}}Mi(t,e,n,i){const r=n/this.getTileSize().width,o=this.getMap(),s=t=>{const n=[];sB(t)&&(t=[t]);for(let s=0,a=t.length;s<a;s++){const a=t[s];AH.x=e.x+a.x/r,AH.y=e.y-a.y/r,o.pointAtResToCoord(AH,i,fH),n.push(fH.toArray())}return 1===t.length?n[0]:n};if(sB(t))return s(t);const a=t.length;if(1===a)return s(t[0]);{let e=[];for(let n=0;n<a;n++)e.push(s(t[n]));return e}}getDataSchema(t){return this.Yn||(this.Yn={}),aB(t)||this.Yn[t]||(this.Yn[t]={}),aB(t)?this.Yn:this.Yn[t]}onRemove(){super.onRemove()}static fromJSON(t){return t&&"VectorTileLayer"===t.type?new gH(t.id,t.options):null}_n(){}static registerPlugin(t){gH.plugins||(gH.plugins={}),gH.plugins[t.type]=t}static getPlugins(){return gH.plugins||{}}static compressStyleJSON(t){return Array.isArray(t)&&t.length?function(t){Array.isArray(t)&&(t={style:t,featureStyle:[]});const e=[],n=[],i=[];AB(t.style,e,i),AB(t.featureStyle,n,i);const r={plugins:i,styles:{style:e,featureStyle:n}};return t.$root&&(r.$root=t.$root),r}(t):t}}function mH(t){return!(!t||!t.properties)}function yH(t){return t?(Array.isArray(t)||(t=bO(t).unitArray()),3===t.length&&t.push(1),t):null}function vH(t,e){return null==t?e:t}function _H(t,e,n){if(!t[e]||!t[e].style||!t[e].style[n])throw new Error(`No plugin defined at feature style of ${e} - ${n}`)}function xH(t,e){if(!t[e])throw new Error(`No plugin defined at style of ${e}`)}gH.prototype._getTileZoom=function(t){return t=Math.floor(t),lA.prototype._getTileZoom.call(this,t)},gH.registerJSONType("VectorTileLayer"),gH.mergeOptions({urlTemplate:null,renderer:"gl",altitudeProperty:"altitude",forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,tileSize:[512,512],features:!1,schema:!1,cascadeTiles:!0,collision:!0,collisionBuffserSize:0,picking:!0,pickingPoint:!0,pickingGeometry:!1,glyphSdfLimitPerFrame:15,tileLimitPerFrame:1,loadingLimitOnInteracting:5,loadingLimit:0,antialias:!1,iconErrorUrl:null,collisionFrameLimit:1.5,defaultRendering:!0,textGamma:1,maxIconSize:254,workarounds:{"win-intel-gpu-crash":!1},pyramidMode:1,styleScale:1,enableAltitude:!0,fadeAnimation:!1,debugTileData:!1,fetchOptions:null,awareOfTerrain:!0,altitudeQueryTimeLimitPerFrame:3,workerGlyph:!0,featureIdProperty:null,currentTilesFirst:!0}),gH.registerRenderer("gl",oH),gH.registerRenderer("canvas",null);const bH=new Jt(1,1);class wH extends xu{static registerPainter(t,e){wH.painters||(wH.painters={}),wH.painters[t]=e}static get3DPainterClass(t){return wH.painters[t]}setURLModifier(t){return this.qn=t,this}getURLModifier(){return this.qn}getEvents(){let t;return t=super.getEvents?super.getEvents():{},t.spatialreferencechange=this._i,t}onConfig(t){if(super.onConfig(t),void 0!==t.enableBloom){const e=this.getRenderer();e&&e.updateBloom(t.enableBloom)}}updateSymbol(t,e){if(!this.options.style)throw new Error("can't call update symbol when style is not set");const n=Array.isArray(this.options.style)?this.options.style:this.options.style.style;if(!n[t])throw new Error(`invalid style at ${t}`);return nB(n[t].symbol,e),this.setStyle(this.options.style),this}getPolygonOffsetCount(){return this.isEmpty()||this.options.altitude?0:1}getPolygonOffset(){return this.options.altitude?0:this.ui||0}setPolygonOffset(t,e){return this.ui=t,this.ci=e,this}getTotalPolygonOffset(){return this.ci}identify(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=n.coordToContainerPoint(new $o(t));return this.identifyAtPoint(r,e)}identifyAtPoint(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=this.getMap().getDevicePixelRatio(),o=i.pick(t.x*r,t.y*r,e);return e&&e.filter?o.filter((t=>e.filter(t))):o}getComputedStyle(){return{style:this.getStyle()||[]}}outlineAll(){const t=this.getRenderer();return t?(t.outlineAll(),this):this}outline(t){if(!Array.isArray(t)||!t.length)return this;const e=this.getRenderer();return e?(e.outline(t),this):this}cancelOutline(){const t=this.getRenderer();return t?(t.cancelOutline(),this):this}toJSON(){const t={type:this.getJSONType(),id:this.getId(),options:this.config(),geometries:[]},e=this.getGeometries();for(let n=0,i=e.length;n<i;n++){const i=e[n].toJSON();t.geometries.push(i)}return t}getTileSize(){return bH}_i(){const t=this.getRenderer();t&&t._i()}}wH.mergeOptions({picking:!0,pickingPoint:!0,renderer:"gl",collision:!1,collisionBufferSize:0,textGamma:1,geometryEvents:!0,styleScale:1,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,meshRenderOrder:0,enableBloom:!1,enableAltitude:!0,workarounds:{"win-intel-gpu-crash":!0}});const CH={redraw:!1,retire:!1},PH=[];let MH=1;function TH(t,e){return MR.extend(t,{init:function(){this.Si={}},isVisible(){return this.painter&&this.painter.isVisible()},supportRenderMode:function(t){return this.painter.supportRenderMode(t)},hasMesh(){return this.painter&&this.painter.hasMesh()},startFrame:function(t){const n=t.sceneConfig;let i=this.painter;i||(i=this.painter=new e(t.regl,t.layer,t.symbol,n,t.pluginIndex,t.dataConfig)),this.Si||(this.Si={});const r=n.excludes;this.ki?r!==this.ki&&(this.Pi=r?CO(r):null,this.ki=r):r&&(this.ki=r),i.startFrame(t),this.Ti={}},updateCollision:function(t){const e=this.painter;return e&&e.isVisible()?e.updateCollision(t):null},prepareRender:function(t){const e=this.painter;return e&&e.isVisible()?e.prepareRender(t):null},endFrame:function(t){const e=this.painter;return e&&e.isVisible()?e.render(t):null},getShadowMeshes(){const t=this.painter;return t&&t.getShadowMeshes&&t.getShadowMeshes()||PH},createTile:function(t){const{tileCache:e,tileData:n}=t;let i=!1;const r=this.painter;if(!r)return{retire:i};const o=this.Ii(t);let s=e.geometry;if(!s){const o=n.features,a=n.data;if(!a||!a.length)return{retire:i};const h=a;if(this.painter.colorSymbol&&!function(t){if(!t)return!0;for(const e in t)return!1;return!0}(o))for(let t=0;t<a.length;t++){const e=this.Fi(o,a[t].data.aPickingId,a[t].indices,a[t].data.aPosition,a[t].positionSize);a[t].data.aColor=e}s=e.geometry=r.createGeometries(h,o);for(let e=0;e<s.length;e++)s[e]&&s[e].geometry&&(i=!0,s[e].geometry.properties.features=o,this.Ci(s[e].geometry,t))}let a=this.Me(o);if(!a){const{meshes:e,retire:n}=this.Oi(s,t);i||(i=n),a=e}return{retire:i}},Oi(t,e){const{tileInfo:n,tileExtent:i,tileTransform:r,tileTranslationMatrix:o,tileVectorTransform:s,tileZoom:a,sceneConfig:h}=e;let l=!1;const u=this.painter,c=u.createMeshes(t,r,{tileExtent:i,tilePoint:[n.extent2d.xmin,n.extent2d.ymax],tileZoom:a,tileTranslationMatrix:o,tileVectorTransform:s},e);if(c.length){for(let n=0;n<c.length;n++)c[n]&&(l=!0,this.Ei(c[n],r,e.timestamp,MH++,u.isEnableTileStencil()));h.animation&&(c.Di=e.timestamp);const t=this.Ii(e);this.Si[t]=c}return{meshes:c,retire:l}},paintTile:function(t){const{tileCache:e,tileInfo:n,tileZoom:i,sceneConfig:r}=t,o=this.painter;if(!o)return CH;let s=e.geometry;if(!s)return CH;let a=!1;const h=this.Ii(t);let l=this.Me(h);if(!l){const{meshes:e,retire:n}=this.Oi(s,t);a||(a=n),l=e}if(!l.length)return CH;const u=o.getTileLevelValue(n,i);l.forEach((t=>{t.properties.tile=n,t.properties.level=u}));let c=!1;if(!this.Ti[h]){let e=null,n=r.animation;if(n){const i=t.sceneConfig.animationDuration||800,r=(t.timestamp-l.Di)/i;l.Di-l[0].properties.createTime<i&&r<1&&(!0!==n&&1!==n||(n="linear"),e="linear"===n?r:CR(n,r),c=!0)}o.addMesh(l,e,t),this.Ti[h]=1}return{redraw:c,retire:a}},Ei:function(t,e,n,i,r){if(t.properties.tileTransform=e,t.properties.createTime=n,t.properties.meshKey=i,t.needUpdateShadow=!0,r){const e=t.defines||{};e.ENABLE_TILE_STENCIL=1,t.setDefines(e)}"stencilRef"in t.uniforms||Object.defineProperty(t.uniforms,"stencilRef",{enumerable:!0,get:function(){return t.properties.tile&&void 0!==t.properties.tile.stencilRef?t.properties.tile.stencilRef:t.properties.level}})},Ci:function(t,e){const{layer:n,tileInfo:i}=e,r=n.getMap(),o=(n.getSpatialReference?n.getSpatialReference():r.getSpatialReference()).getResolution(i.z),s=e.tileExtent/n.getTileSize().width;t.properties.tileResolution=o,t.properties.tileRatio=s,t.properties.z=i.z,t.properties.tileExtent=e.tileExtent},updateSceneConfig:function(t){const e=this.painter;e&&e.updateSceneConfig(t.sceneConfig)},updateDataConfig:function(t,e){const n=this.painter;return!n||n.updateDataConfig(t,e)},updateSymbol:function(t,e){const n=this.painter;if(!n)return!1;if(n.shouldDeleteMeshOnUpdateSymbol(t)){if(this.Si)for(const t in this.Si)n.deleteMesh(this.Si[t],!0);delete this.Si,delete this.Ti}return n.updateSymbol(t,e)},pick:function(t,e,n){return this.painter&&this.painter.pick?this.painter.pick(t,e,n):null},deleteTile:function(t){if(!this.Si)return;const e=this.Ii(t),n=this.Si[e];n&&this.painter&&this.painter.deleteMesh(n),delete this.Si[e],this.Ti&&delete this.Ti[e]},remove:function(){const t=this.painter;if(t&&this.Si){for(const e in this.Si)t.deleteMesh(this.Si[e]);t.delete(),delete this.painter}delete this.Si,delete this.Ti},resize:function(t,e){const n=this.painter;n&&n.resize(t,e)},needToRedraw:function(){return!!this.painter&&this.painter.needToRedraw()},needToRetireFrames:function(){return!!this.painter&&this.painter.needToRetireFrames()},isAnimating(){return!!this.painter&&this.painter.isAnimating()},needToRefreshTerrainTileOnZooming:function(){return!!this.painter&&this.painter.needToRefreshTerrainTileOnZooming()},isTerrainSkin:function(){return!!this.painter&&this.painter.isTerrainSkin()},isTerrainVector:function(){return!!this.painter&&this.painter.isTerrainVector()},Fi:function(t,e,n,i,r=3){if(!i||!t||!e.length)return null;const o=new Uint8Array(i.length/r*4);let s,a;const h=this.painter.colorSymbol,l={};let u;for(let c=0,A=e.length;c<A;c++){const n=e[c];if(s=t[n].symbol,a=l[n],!a)if(h){let e;e="function"==typeof h?h(t[n].feature&&t[n].feature.properties):h,e=bO(e),a=l[n]=e.array()}else a=l[n]=[255,255,255];u=4*c,o[u]=a[0],o[u+1]=a[1],o[u+2]=a[2],o[u+3]=255*(s[this.painter.opacitySymbol]||1)}return o},Ii:function(t){const e=t.tileInfo;return e.meshKey||(e.meshKey=MH++),e.meshKey},Me:function(t){return this.Si[t]},Li(t,e){if(Array.isArray(t))t.forEach(((t,n)=>{const{features:i}=t.properties;this.Ri(t,e[n],i)}));else{const{features:n}=t.properties;this.Ri(t,Array.isArray(e)?e[0]:e,n)}},Ri(t,e,n){const i=e.featureIndexes||e.data.featureIndexes;if(i)if(this.Pi){const r=e.indices;let o=null,s=!1;const a=[];for(let t=0;t<r.length;t++)null!==o&&o===r[t]||(s=this.Pi(n[i[r[t]]].feature),o=r[t]),s||a.push(r[t]);t.setElements(new e.indices.constructor(a))}else t.setElements(e.indices)},outline(t,e){const n=this.painter;n&&n.outline(t,e)},outlineAll(t){const e=this.painter;e&&e.outlineAll(t)},needPolygonOffset(){const t=this.painter;return t&&t.needPolygonOffset()},highlight(t){const e=this.painter,n=this.style.name,i=this.renderIndex;if(t){const e=[];if(t.forEach(((t,r)=>{null!=t.plugin&&(Array.isArray(t.plugin)?t.plugin.length&&t.plugin.indexOf(n)<0&&t.plugin.indexOf(i)<0&&e.push(r):t.plugin!==n&&t.plugin!==i&&e.push(r))})),e.length){const n=new Map(t);for(let t=0;t<e.length;t++)n.delete(e[t]);t=n}}return e&&e.highlight(t)},cancelAllHighlight(){const t=this.painter;return t&&t.cancelAllHighlight()}})}function SH(t){return!t||(void 0!==t.empty||(t.empty=function(t){for(const e in t)return!1;return!0}(t)),t.empty)}const IH="_fn_type_",EH="__current_fn_types";function OH(t,e,n,i){if(!SH(t.properties.features))for(let r=0;r<n.length;r++){const{symbolName:o}=n[r];(t[EH]=t[EH]||{})[o]=e[o],RH(t,e,n[r],i)}}function RH(t,e,n,i){const r=function(t){const e=t.properties;let n=e.aPickingId;return n||(n=e.aPickingId=new t.data.aPickingId.constructor(t.data.aPickingId)),n}(t),{attrName:o,symbolName:s,related:a}=n;let h=t.data[o];return h?UH(e[s])||function(t,e){if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(UH(e[t[n]]))return!0;return!1}(a,e)?(UH(e[s])&&DH(t,e,n),h):(t.deleteData(o),kH(t,o),null):UH(e[s])?(h=t.data[o]=new n.type(n.width*r.length),function(t,e,n,i,r){const{attrName:o}=i,s=(IH+o+"Index").trim();DH(e,n,i),BH(e,e.properties[s],i,r)}(0,t,e,n,i),h):null}function DH(t,e,n){const{attrName:i,symbolName:r}=n,o=t.properties,s=(IH+i+"Index").trim(),a=(IH+i).trim();if(o[s]&&o[a])return;const h=function(t){if(!t)return zH;const e=[];for(let n=0;n<t.length;n++)SE(t[n][1])&&!EE(t[n][1]).isZoomConstant&&e.push(t[n][0]);return e}(e[r].stops),l="identity"===e[r].type&&function(t,e,n){if(Array.isArray(n)||(n=Object.values(n)),!n||!n.length)return!1;if(!UD[t])return!1;for(let i=0;i<n.length;i++){const t=n[i]&&(n[i].feature||n[i]);if(!t)continue;const r=t.properties&&t.properties[e];if(r&&SE(r)&&!EE(r).isZoomConstant)return!0}return!1}(r,e[r].property,o.features);if(!l&&!h.length)return void kH(t,i);const{features:u,aPickingId:c}=o,A=function(t,e,n,i,r){const o=[];let s=0,a=e[0];for(let h=1,l=e.length;h<l;h++)!t[a]||e[h]===a&&h!==l-1||((r||NH(t[a].feature,n,i))&&o.push(s,h===l-1?l:h),a=e[h],s=h);return o}(u,c,e[r].property,h,l);if(!A.length)return void kH(t,i);const f=t.data[i];o[s]=A,o[a]=f.BYTES_PER_ELEMENT?new f.constructor(f):new n.type(f.length)}function kH(t,e){const n=t.properties,i=(IH+e+"Index").trim(),r=(IH+e).trim();delete n[i],delete n[r]}function LH(t,e,n,i,r,o){if(!r)return;const s=r.geometry;if(s&&!SH(s.properties.features)){for(let a=0;a<i.length;a++){const h=i[a],l=h.attrName;if(!(FH(s,n,h)||e.ei&&e.ei(r.geometry.Hi))){const{aPickingId:t}=s.properties;if(!t||s.zi===o)continue;const n=(IH+l+"Index").trim(),i=s.properties[n];if(!i)continue;BH(s,i,h,e);continue}const u=RH(s,n,h),c=h.define;if(u){const n=(IH+l+"Index").trim();if(BH(s,s.properties[n],h,e),e.ti&&(s.Hi=e.ti()),c){const t=r.defines;t[c]=1,r.setDefines(t)}s.generateBuffers(t)}else if(c){const t=r.defines;t[c]&&(delete t[c],r.setDefines(t))}}s.zi=o}}function FH(t,e,n){const i=e[n.symbolName],r=t[EH];return!tC(i,r[n.symbolName])&&(r[n.symbolName]=i,!0)}function NH(t,e,n){for(let i=0;i<n.length;i++)if("$"===e[0]&&t[e.substring(1)]===n[i]||t.properties[e]===n[i])return!0;return!1}const zH=[];function BH(t,e,n,i){const{attrName:r,evaluate:o}=n,{aPickingId:s,features:a}=t.properties;let h;if(e){const n=(IH+r).trim();h=t.properties[n];const l=h.length/s.length,u=e.length;for(let r=0;r<u;r+=2){const n=e[r];let u=a[s[n]];u&&u.feature&&jH(h,u,o,n,e[r+1],l,t,i)}}else{if(h=t.data[r],l=h,Array.isArray(l)||l.constructor===Float32Array||l.constructor===Float64Array||l.constructor===Uint8Array||l.constructor===Int8Array||l.constructor===Uint16Array||l.constructor===Int16Array||l.constructor===Uint32Array||l.constructor===Int32Array||l.constructor===Uint8ClampedArray)h.dirty=!0;else{const e=(IH+r).trim();h=t.properties[e],h||(h=t.properties[e]=new n.type(n.width*s.length),h.dirty=!0)}const e=h.length/s.length,u=s.length;let c=0;for(let n=0;n<u;n++){if(s[n]===s[c]&&n<u-1)continue;let r=a[s[c]];r&&r.feature&&(jH(h,r,o,c,n===u-1?u:n,e,t,i),c=n)}}var l;h.dirty&&(t.updateData(r,h),h.dirty=!1)}const HH={};function jH(t,e,n,i,r,o,s,a){const h=(e=e.feature).properties||{};if(void 0===h.$layer&&(e.properties||(e.properties=h),h.$layer=e.layer,h.$type=e.type),a.getFeatureState&&(HH.layer=e.layer,HH.id=e.id,e[RB]&&(e[RB]=null),!BB(e.id))){const t=a.getFeatureState(HH);e.properties[RB]=t}const l=n(h,s,t,i*o);if(Array.isArray(l)){let e=!1;for(let n=0;n<o;n++)if(t[i*o+n]!==l[n]){e=!0;break}if(e){for(let e=i*o;e<r*o;e+=o)t.set(l,e);t.dirty=!0}}else t[i]!==l&&(qB(t,l,i,r),t.dirty=!0)}function UH(t){return BD(t)}const GH=[];function VH(t,e,n,i,r){return qg(GH,e[0],e[1],e[2],1),om(GH,GH,n),t[2]=GH[3],Jg(GH,GH,1/GH[3]),t[0]=(GH[0]+1)*i/2,t[1]=(1-GH[1])*r/2,t}const WH=[],qH=[],ZH=[],QH=[-99999,-99999],XH=new ht(0,0),YH=[];function JH(t,e,n,i,r,o,s,a){const{res:h,extent:l,extent2d:u}=n.properties.tile,{xmin:c,ymax:A}=u,f=c+i.x*r,d=A-i.y*r;let p=null;if(a)for(let v=0;v<a.length;v++)if(KH(a[v],f,d,h)){p=a[v];break}if(!p)return QH;const g=XH.set(c,A),m=o.queryTilePointTerrain(i,p,g,l,h),y=null===m[0]?TB:m[0];if(y){let n=pg(YH,i.x,i.y,0);return n[2]+=100*y,n=VH(t,n,s,e.width,e.height),n}return t[0]=i.x,t[1]=i.y,t}function KH(t,e,n,i){const r=XH.set(e,n)._multi(i/t.res);return t.extent2d.contains(r)}const{loginIBLResOnCanvas:$H,logoutIBLResOnCanvas:tj,getIBLResOnCanvas:ej}=Xw.PBRUtils,nj="__gl_textures",ij=[],rj=new ht(0,0),oj=new ht(0,0),sj=new Float32Array(1),aj=[],hj=t=>0===t.properties.level,lj=t=>t.properties.level>0;class uj{static getBloomSymbol(){return["bloom"]}constructor(t,e,n,i,r,o){this.Ni=!0,this.regl=t,this.layer=e,this.canvas=t._gl.canvas,this.sceneConfig=i||{},this.dataConfig=o||{},this.pluginIndex=r,this.scene=new Y_,this.pickingFBO=e.getRenderer().pickingFBO,this.level0Filter=hj,this.levelNFilter=lj,this.loginTextureCache(),this.symbolDef=Array.isArray(n)?n.map((t=>HB(t))):[HB(n)],this.Vi(),this.pickingViewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.sortByCommandKey=cj.bind(this),this.colorCache={},this.Ui=this.symbolDef.map((t=>!(!t||!1!==t.visible)))}hasMesh(){const t=this.scene&&this.scene.getMeshes();return this.isVisible()&&t&&!!t.length}getMap(){return this.layer?this.layer.getMap():null}getTileLevelValue(t,e){const n=this.layer.getRenderer();return n.getTileLevelValue&&n.getTileLevelValue(t,e)||0}getAnalysisMeshes(){return this.getShadowMeshes?this.getShadowMeshes():aj}isVisible(){const{minZoom:t,maxZoom:e}=this.sceneConfig,n=this.getMap().getZoom();if(!BB(t)&&n<t)return!1;if(!BB(e)&&n>e)return!1;const i=this.tt;if(i.length)for(let o=0;o<i.length;o++)if(i[o]&&!i[o].isFeatureConstant)return!0;const r=this.getSymbols();for(let o=0;o<r.length;o++){const t=r[o].visible;if(!1!==t&&0!==t)return!0}return!1}isMeshVisible(t){const e=t&&t.properties&&t.properties.symbolIndex;if(!e)return!1;const n=this.tt,i=e.index;let r;if(n[i]){if(!n[i].isFeatureConstant)return!0;r=n[i](this.getMap().getZoom())}else r=this.getSymbol(e).visible;return!1!==r&&0!==r}isAnimating(){return!1}needToRedraw(){return this.isAnimating()||this.ji}needToRetireFrames(){return this.Re}needToRefreshTerrainTileOnZooming(){return!0}isTerrainSkin(){return this.layer.options.awareOfTerrain}isTerrainVector(){return!1}isShadowIncludeChanged(t){const e=t&&t.isRenderingTerrain&&this.isTerrainSkin();return t&&t.states&&t.states.includesChanged.shadow||e&&this.Gi}fillIncludes(t,e,n){if(delete this.Gi,n&&n.isRenderingTerrain&&this.isTerrainSkin())return;const i=n&&n.includes;if(i){let r="";for(const o in i)i[o]&&(r+=o,n[o].uniformDeclares&&e.push(...n[o].uniformDeclares),n[o].defines&&FB(t,n[o].defines));this.Gi=r}}setIncludeUniformValues(t,e){if(e&&e.isRenderingTerrain&&this.isTerrainSkin())return;const n=e&&e.includes;if(n)for(const i in n)n[i]&&e[i].renderUniforms&&FB(t,e[i].renderUniforms)}createGeometries(t,e){if(!t.length)return aj;const n=[];for(let i=0;i<t.length;i++)if(t[i])if(void 0!==t[i].ref)n.push(n[t[i].ref]?{geometry:n[t[i].ref].geometry,symbolIndex:t[i].symbolIndex,ref:t[i].ref}:null);else{t[i]&&!t[i].is2D&&(this.Ni=!1);const r=this.createGeometry(t[i],e,i);if(r&&r.geometry){const o=r.geometry.properties,{pickingIdMap:s,idPickingMap:a,hasFeaIds:h}=this.Bi(t[i]);h&&(o.feaIdPickingMap=s,o.feaPickingIdMap=a),o.symbolIndex=r.symbolIndex,o.features=e,o.is2D=t[i].is2D,o.layer=this.layer,o.positionBounding=t[i].positionBounding,this.postCreateGeometry(r,n)}n.push(r)}return n}isOnly2D(){return this.Ni}postCreateGeometry(){}Bi(t){if(!t)return{};if(Array.isArray(t)&&!(t=t[0]))return{};const e=t.featureIds,n={},i={},r=e&&e.length;if(r)for(let o=0;o<e.length;o++){const r=t.data.aPickingId[o];void 0===n[r]&&(n[r]=e[o],i[e[o]]||(i[e[o]]=[]),i[e[o]].push(t.data.aPickingId[o]))}return{hasFeaIds:r,idPickingMap:n,pickingIdMap:i}}createGeometry(){throw new Error("not implemented")}createMeshes(t,e,n,i){const r=this.layer.options.awareOfTerrain,o=[];for(let s=0;s<t.length;s++){if(!t[s])continue;if(r&&i&&i.isRenderingTerrain&&this.isTerrainVector()){const e=t[s],n=e&&e.geometry;this.$i(n,n.data,n.properties,n.positionSize||n.desc.positionSize,i)}let a=this.createMesh(t[s],e,n,i||{});Array.isArray(a)?(a=a.filter((t=>!!t)),o.push(...a)):a&&o.push(a)}return o}createMesh(){throw new Error("not implemented")}getAltitudeOffsetMatrix(){const t=100*(this.dataConfig.altitudeOffset||0),e=Np([]);return pg(ij,0,0,t),jp(e,e,ij),e}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).bloom}forbiddenTerrainUpscale(){return!0}addMesh(t,e,n){if(n.isRenderingTerrain&&this.isTerrainSkin()&&this.forbiddenTerrainUpscale()){const t=this.getMap().getResolution();if(n.tileInfo.res/t>3)return}const i=n.isRenderingTerrain&&this.isTerrainVector(),r=this.getRenderFBO(n);t=t.filter((t=>this.isMeshVisible(t))),i&&(t=t.filter((t=>t.geometry&&t.geometry.data.aTerrainAltitude)));const o=void 0===this.sceneConfig.castShadow||!!this.sceneConfig.castShadow,s=!(!n||!n.bloom);t.forEach((t=>{const e=this.isBloom(t)&&s;t.bloom=e,t.castShadow=o;let a=!1;const h=t.defines||{};if(!!h.HAS_BLOOM!==e&&(a=!0,e?h.HAS_BLOOM=1:delete h.HAS_BLOOM),i){if(t.geometry.data.aTerrainAltitude){const e=t.geometry;this.$i(e,e.data,e.properties,e.desc.positionSize,n)}t.geometry.data.aTerrainAltitude&&!h.HAS_TERRAIN_ALTITUDE&&(h.HAS_TERRAIN_ALTITUDE=1,a=!0)}else h.HAS_TERRAIN_ALTITUDE&&(delete h.HAS_TERRAIN_ALTITUDE,a=!0);a&&t.setDefines(h),r?t.setUniform("targetFramebuffer",r):t.uniforms.targetFramebuffer&&(t.uniforms.targetFramebuffer=null),this.Wi(t)})),this.scene.addMesh(t)}updateCollision(){}render(t){return this.pluginIndex=t.pluginIndex,this.polygonOffsetIndex=t.polygonOffsetIndex,this.paint(t),{redraw:this.ji,drawCount:this.Xi}}prepareRender(t){if(this.Qe===t.timestamp)return;if(!this.createFnTypeConfig)return;const e=this.scene.getMeshes();if(!e||!e.length)return;const n=t&&t.sceneFilter,i=this.getMap().getZoom();for(let r=0;r<e.length;r++){if(!e[r]||!e[r].geometry)continue;if(n&&!n(e[r]))continue;const{symbolIndex:o}=e[r].properties,s=this.getSymbolDef(o);if(!s)continue;this.Qe=t.timestamp;const a=this.getFnTypeConfig(o);LH(this.regl,this.layer,s,a,e[r],i)}}paint(t){const e=this.layer.getMap();if(!e)return{redraw:!1};this.Yi=t;const n=this.getUniformValues(e,t);return this.callShader(n,t),{redraw:this.ji}}setToRedraw(t){t&&(this.Re=t),this.ji=!0}callShader(t,e){this.callCurrentTileShader(t,e),this.callBackgroundTileShader(t,e)}callCurrentTileShader(t,e){this.shader&&(this.shader.filter=e&&e.sceneFilter?[this.level0Filter,e.sceneFilter]:this.level0Filter),this.callRenderer(this.shader,t,e)}callBackgroundTileShader(t,e){this.shader&&(this.shader.filter=e&&e.sceneFilter?[this.levelNFilter,e.sceneFilter]:this.levelNFilter),this.scene.getMeshes().sort(Aj),this.callRenderer(this.shader,t,e)}callRenderer(t,e,n){const i=this.scene.getMeshes(),r=[];i.forEach((t=>{t.properties.hlBloomMesh&&n&&n.bloom&&r.push(t.properties.hlBloomMesh),r.push(t)})),this.qi(e),this.scene.setMeshes(r),this.Xi+=this.renderer.render(t,e,this.scene,this.getRenderFBO(n)),this.scene.setMeshes(i)}qi(t){const e=this.layer.options.altitude||0,n=this.layer.getRenderer();t.layerOpacity=n.Xn(),t.minAltitude=e}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}needPolygonOffset(){return!1}getPolygonOffset(){const t=this.layer;return{factor:()=>t.getPolygonOffset()+(this.polygonOffsetIndex||0),units:()=>t.getPolygonOffset()+(this.polygonOffsetIndex||0)}}getBlendFunc(){return{src:()=>this.sceneConfig.blendSrc||"one",dst:()=>this.sceneConfig.blendDst||"one minus src alpha"}}pick(t,e,n=3){if(!this.layer.options.picking||!1===this.sceneConfig.picking)return null;if(!this.pickingFBO||!this.picking)return null;const i=this.getMap(),r=this.getUniformValues(i);this.qi(r);for(let o=0;o<this.picking.length;o++){const s=this.picking[o];s.render(this.scene.getMeshes(),r,!0);let a={};s.getRenderedMeshes().length&&(a=s.pick(t,e,n,r,{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:this.layer.options.pickingPoint&&!1!==this.sceneConfig.pickingPoint,logDepthBufFC:2/(Math.log(i.cameraFar+1)/Math.LN2)}));const{meshId:h,pickingId:l,point:u}=a,c=(0===h||h)&&s.getMeshAt(h);if(!c||!c.geometry)continue;let A=c.geometry.properties;return A.features||(A=c.properties),u&&u.length&&(u[0]=Math.round(1e5*u[0])/1e5,u[1]=Math.round(1e5*u[1])/1e5,u[2]=Math.round(1e5*u[2])/1e5),{data:this.Ji(A&&A.features&&A.features[l]),point:u,coordinate:a.coordinate,plugin:this.pluginIndex}}return null}Ji(t){const e=t&&t.feature;if(!e||!e.customProps)return t;const n=FB({},t);return n.feature=FB({},t.feature),delete n.feature.customProps,n.feature.properties=FB({},e.properties,e.properties[OB],e.properties[RB]),delete n.feature.properties[RB],delete n.feature.properties[OB],delete n.feature.properties.$layer,delete n.feature.properties.$type,n}updateSceneConfig(){}updateDataConfig(t){return FB(this.dataConfig,t),!0}deleteMesh(t,e){if(t)if(this.scene.removeMesh(t),Array.isArray(t))for(let n=0;n<t.length;n++){if(!t[n].isValid())continue;const i=t[n].geometry;!e&&i&&i.dispose(),t[n].material&&t[n].material.dispose(),t[n].dispose(),VI.deleteHighlightBloomMesh(t[n])}else{if(!t.isValid())return;!e&&t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),t.dispose(),VI.deleteHighlightBloomMesh(t)}}startFrame(t){this.Ki||(this.init(t),this.Ki=!0),this.Qe!==t.timestamp&&(this.ji=!1,this.Re=!1,this.Xi=0),this.scene.clear()}resize(){}delete(){if(this.scene.clear(),this.shader&&this.shader.dispose(),this.picking){for(let t=0;t<this.picking.length;t++)this.picking[t].dispose();delete this.picking}if(this.Zi){for(let t=0;t<this.Zi.length;t++)this.Zi[t].dispose();delete this.Zi}delete this.Qi,this.logoutTextureCache()}updateSymbol(t,e){Array.isArray(t)||(t=[t],e=[e]);let n=!1;for(let i=0;i<t.length;i++)if(t[i]){const r=this.er(i,t[i],e[i]);r&&(n=r)}return delete this.nr,this.setToRedraw(!1),n}ir(t,e){for(const n in e)if(XB(e,n)){if(BD(e[n])&&!this.layer.options.features&&(!t[n]||t[n].property!==e[n].property))return!0;if(Jz[n]&&!tC(e[n],t[n]))return!0}return!1}er(t,e,n){if(!this.rr)return!1;const i=this.ir(this.symbolDef[t]||{},n);if(this.Ui[t]&&!1!==n.visible)return this.Ui[t]=!1,!0;this.symbolDef[t]=HB(n);const r=this.rr[t];for(const h in r)delete r[h];const o=this.getMap(),s=[],a=Xz(this.symbolDef[t],(()=>(s[0]=o.getZoom(),s)));for(const h in a){const t=Object.getOwnPropertyDescriptor(a,h);t.get?Object.defineProperty(r,h,{get:t.get,set:t.set,configurable:!0,enumerable:!0}):r[h]=a[h]}return SE(n.visible)&&(this.tt[t]=EE(n.visible)),i}getSymbolDef(t){return this.symbolDef[t.index]}getSymbols(){return this.rr}getSymbol(t){return this.rr[t.index]}Vi(){const t=this.getMap(),e=[],n=()=>(e[0]=t.getZoom(),e);this.rr=[],this.tt=[];for(let i=0;i<this.symbolDef.length;i++)this.rr[i]=Xz(FB({},this.symbolDef[i]),n),this.symbolDef[i]&&SE(this.symbolDef[i].visible)&&(this.tt[i]=EE(this.symbolDef[i].visible))}getFnTypeConfig(t){this.nr||(this.nr=[]);const e=t.index;if(!this.nr[e]){const n=this.getSymbolDef(t),i=this.getMap();this.nr[e]=this.createFnTypeConfig(i,n)}return this.nr[e]}sr(){delete this.nr}loginTextureCache(){const t=(nj+"").trim(),e=this.getMap();e[t]||(e[t]={count:0}),e[t].count++}logoutTextureCache(){const t=(nj+"").trim(),e=this.getMap(),n=this.ar;if(n)for(const i in n)XB(n,i)&&e[t][i]&&(e[t][i].count--,e[t][i].count<=0&&delete e[t][i]);e[t].count--,e[t].count<=0&&(e[t]={})}getCachedTexture(t){const e=(nj+"").trim(),n=this.getMap()[e][t];return n?n.data:null}addCachedTexture(t,e){const n=(nj+"").trim(),i=this.getMap();let r=i[n][t];r?r.data=e:r=i[n][t]={data:e,count:0},this.ar||(this.ar={}),r.data.then||this.ar[t]||(r.count++,this.ar[t]=1)}disposeCachedTexture(t){let e;if(e="string"==typeof t?t:t.url,!this.ar||!this.ar[e])return;const n=(nj+"").trim();delete this.ar[e];const i=this.getMap();i[n][e]&&(i[n][e].count--,i[n][e].count<=0&&delete i[n][e])}shouldDeleteMeshOnUpdateSymbol(){return!1}isEnableTileStencil(){return!0}isUniqueStencilRefPerTile(){return this.isOnly2D()}supportRenderMode(t){return"taa"===t||"fxaa"===t}outline(t,e){const n={};for(let i=0;i<e.length;i++)BB(e[i])||n[e[i]]||(this.lr(t,e[i]),n[e[i]]=1)}lr(t,e){if(!this.picking)return;if(this.hr||(this.hr=new Y_),!this.Zi&&(this.ur(),!this.Zi))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const n=this.getUniformValues(this.getMap(),this.Yi);this.qi(n);const i=this.cr(e);if(i.length)for(let r=0;r<i.length;r++){const o=i[r].geometry.properties.feaIdPickingMap;if(o){const s=o[e];if(s){const e={};this.hr.setMeshes(i[r]);for(let i=0;i<s.length;i++){const r=s[i];if(!e[r]){e[r]=1,n.highlightPickingId=r;for(let e=0;e<this.Zi.length;e++)this.renderer.render(this.Zi[e],n,this.hr,t)}}}}}}cr(t){const e=[],n=this.scene.getMeshes();for(let i=0;i<n.length;i++){const r=n[i],o=r.geometry.properties.feaIdPickingMap;o&&void 0!==o[t]&&e.push(r)}return e}outlineAll(t){if(!this.picking)return;if(!this.Zi&&(this.ur(),!this.Zi))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const e=this.getUniformValues(this.getMap(),this.Yi);this.qi(e),e.highlightPickingId=-1;for(let n=0;n<this.Zi.length;n++)this.renderer.render(this.Zi[n],e,this.scene,t)}ur(){if(!this.picking)return;const t=this.layer.getRenderer().canvas;this.Zi=[];for(let e=0;e<this.picking.length;e++){const n=this.picking[e].getPickingVert(),i={ENABLE_PICKING:1,HAS_PICKING_ID:1},r=this.picking[e].getUniformDeclares().slice(0);void 0!==r.uPickingId&&(i.HAS_PICKING_ID=2),this.Zi[e]=new mx({vert:n,frag:"precision highp float;\nuniform float highlightPickingId;\nvarying float vPickingId;\nvoid main() {\n  if(highlightPickingId < .0 || floor(highlightPickingId + .5) == floor(vPickingId + .5)) {\n    gl_FragColor = vec4(1.);\n  } else {\n    discard;\n  }\n}",uniforms:r,defines:i,extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height},depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this.Zi[e].filter=this.picking[e].filter}}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}updateIBLDefines(t){const e=t.shaderDefines;let n=!1;this.hasIBL()?e[["HAS_IBL_LIGHTING"]]||(e.HAS_IBL_LIGHTING=1,n=!0):e[["HAS_IBL_LIGHTING"]]&&(delete e.HAS_IBL_LIGHTING,n=!0),n&&(t.shaderDefines=e)}getIBLRes(){const t=this.layer.getRenderer().canvas;return ej(t)}createIBLTextures(){const t=this.layer.getRenderer().canvas;$H(t,this.regl,this.getMap()),this.setToRedraw(!0),this.layer.fire("iblupdated")}disposeIBLTextures(){const t=this.layer.getRenderer().canvas;tj(t,this.getMap())}evaluateInFnTypeConfig(t,e,n,i,r){let o=this.dr;o||(o=this.dr={});const s=function(t){let e=0;const n=t&&t.length||0;if(!n)return e;let i;for(let r=0;r<n;r++)i=t.codePointAt(r),e=(e<<5)-e+i,e|=0;return e}(JSON.stringify(t));let a=o[s];return a||(a=o[s]=r?OE(t):EE(t)),a(n.getZoom(),i)}highlight(t){this.$n=t,this.pr=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}cancelAllHighlight(){this.$n=null,this.pr=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}mr(t,e){const{featureIds:n,pickingIdIndiceMap:i}=e;t.properties.aFeaIds=n,t.properties.pickingIdIndiceMap=i}Wi(t){if(t&&t.properties.isHalo)return;const{pickingIdIndiceMap:e}=t.geometry.properties,n=this.$n?function(t,e,n){const{aPickingId:i,feaIdPickingMap:r,features:o}=t.geometry.properties,s=new Map,a=n.keys();for(const h of a){const t=n.get(h);if(t)if(BB(t.id)){if(t.filter&&i){let n=null;for(let r=0;r<i.length;r++){i[r]!==n&&(n=i[r]);const a=o[n];t.filter(a&&a.feature,e)&&s.set(n,t)}}}else{const e=r[t.id];if(!e||!e.length)continue;for(let n=0;n<e.length;n++)s.set(e[n],t)}}return s}(t,this.layer,this.$n):null;VI.highlightMesh(this.regl,t,n,this.pr,e)}$i(t,e,n,i,r){let o=n.aAnchor;if(!o){const{aPosition:t}=e;o=n.aAnchor=t.slice(0)}let s=n.aTerrainAltitude;s||(s=n.aTerrainAltitude=new Float32Array(o.length/i),s.fill(TB)),this.yr(s,o,r.tileInfo,0,s.length-1),e.aTerrainAltitude?s.dirty&&this.gr(t,s):e.aTerrainAltitude=s,s.dirty=!1}gr(t,e){t&&t.updateData&&t.updateData("aTerrainAltitude",e)}yr(t,e,n,i,r){const{res:o,extent:s,extent2d:a,id:h}=n,l=this.pluginIndex,u=h+"-"+l;if(n.completeTerrainQuery||(n.completeTerrainQuery=[]),n.completeTerrainQuery[l])return;if(!n.completeTerrainQuery[l]&&this.Qi&&this.Qi.has(u)){const e=this.Qi.getAndRemove(u);return this.Qi.add(u,e),t.set(e.altitudeData),n.terrainTileInfos=e.terrainTileInfos,t.dirty=!0,void(n.completeTerrainQuery[l]=!0)}const c=this.layer,A=c.getMap(),f=c.getRenderer(),d=f&&f.getTerrainHelper();let p=n.terrainTileInfos;p||(p=n.terrainTileInfos=this.layer.queryTerrainTiles(n)),n.terrainQueryStatus||(n.terrainQueryStatus=[]);let g=!1,m=[];for(let T=0;T<n.terrainTileInfos.length;T++)if(m[T]=+d.isTerrainTileLoaded(n.terrainTileInfos[T].id),m[T]&&n.terrainQueryStatus[l]&&!n.terrainQueryStatus[l][T]){g=!0;break}if(!g&&n.terrainQueryStatus[l])return;const y=c.constructor;if(A.isInteracting()){const t=f.getFrameTimestamp();if(y.altitudeQueryFrameTimestamp!==t&&(y.altitudeQueryFrameTimestamp=t,y.altitudeQueryFrameTime=0),y.altitudeQueryFrameTime>c.options.altitudeQueryTimeLimitPerFrame)return}const v=performance.now();n.terrainQueryStatus[l]=m;const{xmin:_,ymax:x}=a,b=rj.set(_,x),w=this.layer.getTileSize().width/n.extent,C=e.length/t.length;let P=t.queryResult;P||(P=t.queryResult=new Map);let M=!0;for(let T=i;T<=r;T++){let n=e[T*C];n<0?n=0:n>s&&(n=s);let i=e[T*C+1];i<0?i=0:i>s&&(i=s);const r=n+i*s;let a,h,l=P.get(r);if(l||0===l)t[T]!==l&&(t[T]=l,t.dirty=!0);else{for(let t=0;t<p.length;t++)if(KH(p[t],_+w*n,x-w*i,o)){a=p[t];break}a&&(d.getRenderer().isTileCached(a.id)||t[T]===TB)&&(oj.set(n,i),h=this.layer.queryTilePointTerrain(oj,a,b,s,o)),l=t[T],h&&(l=null===h[0]?TB:h[0],sj[0]=l,l=sj[0]),t[T]!==l&&(t[T]=l,t.dirty=!0),h&&h[1]?P.set(r,l):M=!1}}y.altitudeQueryFrameTime=(y.altitudeQueryFrameTime||0)+(performance.now()-v),n.completeTerrainQuery[l]=M,M&&(this.Qi||(this.Qi=new zr(4*this.layer.options.maxCacheSize)),this.Qi.add(u,{altitudeData:t,terrainTileInfos:p}))}}function cj(t,e){const n=t&&t.getCommandKey(this.regl)||"",i=e&&e.getCommandKey(this.regl)||"";return n.localeCompare(i)}function Aj(t,e){return t.properties.level-e.properties.level}class fj extends uj{createGeometry(t,e){if(!t.data)return{geometry:null,symbolIndex:t.symbolIndex};t.iconAtlas&&t.iconAtlas.image&&(t.iconAtlas.image.dataType=t.type,t.iconAtlas.image.type="icon"),t.glyphAtlas&&t.glyphAtlas.image&&(t.glyphAtlas.image.type="glyph");const n=FB({},t.data),i={primitive:this.getPrimitive(),positionSize:t.positionSize};n.aAltitude&&(i.altitudeAttribute="aAltitude");const r=new Jv(n,t.indices,0,i);return r.properties={features:e},t.iconAtlas&&(r.properties.iconAtlas=t.iconAtlas.image,r.properties.iconPositions=t.iconAtlas.positions),t.glyphAtlas&&(r.properties.glyphAtlas=t.glyphAtlas.image),SH(e)||(r.properties.aFeaIds=t.featureIds,this.mr(r,t)),t.markerPlacement&&(r.properties.markerPlacement=t.markerPlacement),t.textPlacement&&(r.properties.textPlacement=t.textPlacement),FB(r.properties,t.properties),{geometry:r,symbolIndex:t.symbolIndex}}getRayCastData(t,e){const{features:n,aFeaIds:i}=t.geometry.properties;return n&&i?n[i[e]]:null}getPrimitive(){return"triangles"}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}supportRenderMode(t){return"noAa"===t}drawDebugAtlas(t){if(document.getElementById("MAPTALKS_ICON_DEBUG")){const e=document.getElementById("MAPTALKS_ICON_DEBUG");let n;if(e.width=t.width,e.height=t.height,e.style.width=t.width+"px",e.style.height=t.height+"px","alpha"===t.format){n=new Uint8ClampedArray(4*t.data.length);for(let e=0;e<t.data.length;e++)n[4*e+3]=t.data[e]}else n=new Uint8ClampedArray(t.data);const i=e.getContext("2d");i.imageSmoothingEnabled=!1,i.putImageData(new ImageData(n,t.width,t.height),0,0)}}}var dj="#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#include <fbo_picking_vert>\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n  fbo_picking_setData(gl_Position.w, true);\n}";function pj(t,e,n,i){if(i){const t=Lv.resizeToPowerOfTwo(e.data,e.width,e.height);e.data=t}const r={width:e.width,height:e.height,data:e.data,format:e.format,mag:"linear",min:i?"linear mipmap linear":"linear",flipY:n,premultiplyAlpha:!0};if("icon"===e.type){const t="point"!==e.dataType?"repeat":"clamp";r.wrapS=t,r.wrapT=t}return t.texture(r)}const gj=[0,0],mj=[];function yj(t){if(!t.properties.iconPositions)return gj;let e,n=0;for(const o in t.properties.iconPositions)if(e=o,n++,n>1)return gj;if(!e)return gj;const i=t.properties.iconPositions[e],r=i.displaySize[1];return mj[0]=i.displaySize[0],mj[1]=r,mj}const vj=Np([]),_j={polygonFill:[1,1,1,1],polygonOpacity:1,uvScale:[1,1],uvOffset:[0,0],patternWidth:[0,0],patternOffset:[0,0]},xj=[],bj=new $o(0,0),wj=new $o(0,0),Cj=new $o(0,0),Pj=[];class Mj extends fj{static getBloomSymbol(){return["polygonBloom"]}prepareSymbol(t){const e=t.polygonFill;Array.isArray(e)&&(3===e.length&&e.push(1),t.polygonFill=e.map((t=>255*t)))}supportRenderMode(t){return this.sceneConfig.antialias||void 0===this.sceneConfig.antialias?"fxaa"===t||"fxaaBeforeTaa"===t:super.supportRenderMode(t)}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex)[Mj.getBloomSymbol()[0]]}forbiddenTerrainUpscale(){return!0}needPolygonOffset(){return!0}getAnalysisMeshes(){return this.isVisible()?this.scene.getMeshes().filter((t=>0===t.properties.level)):xj}createMesh(t,e,n){const i=this.getMap(),{tilePoint:r}=n,{geometry:o,symbolIndex:s,ref:a}=t,h=this.layer instanceof lA,l=this.layer.getTileSize().width,u=o.properties.tileExtent/l,c=o.properties.tileResolution,A=i.pointAtResToCoord(bj.set(r[0],r[1]),c),f={tileExtent:o.properties.tileExtent,tileRatio:u},d=this.getSymbol(s),p=this.getSymbolDef(s);if(SE(p.polygonPatternFileOrigin)&&this.vr(p,t,h?[0,0]:r,c),(SE(p.polygonPatternFileWidth)||SE(p.polygonPatternFileWidth))&&this.wr(p,t,h?u:1,A,c),p.uvOffsetInMeter&&SE(p.uvOffset)&&this.Ar(p,t,A,c),jB(f,"polygonFill",d,"polygonFill",_j.polygonFill,VB(this.colorCache)),jB(f,"polygonOpacity",d,"polygonOpacity",_j.polygonOpacity),jB(f,"uvScale",d,"uvScale",_j.uvScale),void 0===a){const t=this.getFnTypeConfig(s);OH(o,p,t,this.layer),o.generateBuffers(this.regl)}const g=o.properties.iconAtlas,m=2048;if(g&&o.data.aTexInfo){const t=[];Object.defineProperty(f,"uvOrigin",{enumerable:!0,get:()=>{const e=f.tileScale;if(o.data.aPatternOrigin)return t[0]=r[0]*e%m,t[1]=r[1]*e%m,t;const n=d.polygonPatternFileOrigin;return n?(bj.set(n[0],n[1]),i.coordToPointAtRes(bj,c,wj),ly(t,r[0]-wj.x,r[1]-wj.y)):(t[0]=r[0]*e%m,t[1]=r[1]*e%m,t)}});const e=[];Object.defineProperty(f,"patternWidth",{enumerable:!0,get:()=>{if(o.data.aPatternWidth)return _j.patternWidth;const t=p.polygonPatternFileWidth,n=p.polygonPatternFileHeight;if(!t&&!n)return _j.patternWidth;const[i,r]=this.Mr(Pj,t,n,h?u:1,A,c);return ly(e,i,r)}}),Object.defineProperty(f,"uvOffset",{enumerable:!0,get:()=>o.data.aPatternOffset||p.uvOffsetInMeter?_j.uvOffset:d.uvOffset||_j.uvOffset});const n=[];Object.defineProperty(f,"patternOffset",{enumerable:!0,get:()=>{if(o.data.aPatternOffset)return _j.uvOffset;if(!p.uvOffsetInMeter)return _j.uvOffset;const t=p.uvOffset;if(!t)return _j.uvOffset;const e=KB(i,t[0],A,c),r=KB(i,t[1],A,c);return ly(n,e,r)}}),Object.defineProperty(f,"tileScale",{enumerable:!0,get:function(){return p.polygonPatternFileWidth||p.polygonPatternFileHeight?1:o.properties.tileResolution/i.getResolution()}}),f.polygonPatternFile=pj(this.regl,g,!1,!1),f.atlasSize=[g.width,g.height],this.drawDebugAtlas(g)}const y=new T_(f,_j),v=new z_(o,y,{castShadow:!1,picking:!0}),_={};return g&&o.data.aTexInfo&&(_.HAS_PATTERN=1),g&&o.data.aTexCoord&&(_.HAS_TEX_COORD=1,_.INVALID_TEX_COORD=Dz+".0"),o.data.aAltitude&&(_.HAS_ALTITUDE=1),o.data.aColor&&(_.HAS_COLOR=1),o.data.aOpacity&&(_.HAS_OPACITY=1),o.data.aUVScale&&(_.HAS_UV_SCALE=1),o.data.aUVOffset&&(_.HAS_UV_OFFSET=1),o.data.aPatternOrigin&&(_.HAS_PATTERN_ORIGIN=1),o.data.aPatternWidth&&(_.HAS_PATTERN_WIDTH=1),o.data.aPatternOffset&&(_.HAS_PATTERN_OFFSET=1),h&&(_.IS_VT=1),v.setDefines(_),v.setLocalTransform(e),v.properties.symbolIndex=s,v}wr(t,e,n,i,r){if(!(e=e&&e.geometry))return;const o=e.properties.features;if(SH(o))return;const s=t.polygonPatternFileWidth,a=t.polygonPatternFileHeight,h=EE(t.polygonPatternFileOrigin);let l,u;SE(s)&&(l=EE(s)),SE(a)&&(u=EE(a));const{aPickingId:c,aPatternOrigin:A}=e.data,f=new Float32Array(2*c.length);let d,p,g;for(let m=0,y=c.length;m<y;m++){let t,e;if(c[m]===d){f[2*m]=p,f[2*m+1]=g;continue}const y=o[c[m]];if(t=l?l(null,y.feature.properties):s,e=u?u(null,y.feature.properties):a,d=c[m],t||e){let o=i;if(A){const t=h(null,y.feature.properties);t&&(o=Cj.set(t[0],t[1]))}const[s,a]=this.Mr(Pj,t,e,n,o,r);p=f[2*m]=s,g=f[2*m+1]=a}else p=f[2*m]=0,g=f[2*m+1]=0}e.data.aPatternWidth=f}Ar(t,e,n,i){if(!(e=e&&e.geometry))return;const r=e.properties.features;if(SH(r))return;const o=this.getMap();let s=SE(t.uvOffsetInMeter)&&OE(t.uvOffsetInMeter);const a=EE(t.uvOffset),h=EE(t.polygonPatternFileOrigin),{aPickingId:l,aPatternOrigin:u}=e.data,c=new Float32Array(2*l.length);let A,f,d;for(let p=0,g=l.length;p<g;p++){if(l[p]===A){c[2*p]=f,c[2*p+1]=d;continue}const t=r[l[p]],e=a(null,t.feature.properties);let g=!0;if(s&&(g=s(null,t.feature.properties)),A=l[p],e&&g){let r=n;if(u){const e=h(null,t.feature.properties);e&&(r=Cj.set(e[0],e[1]))}const s=KB(o,e[0],r,i),a=KB(o,e[0],r,i);f=c[2*p]=s,d=c[2*p+1]=a}else f=c[2*p]=0,d=c[2*p+1]=0}e.data.aPatternOffset=c}vr(t,e,n,i){if(!(e=e&&e.geometry))return;const r=e.properties.features;if(SH(r))return;const o=this.getMap(),s=EE(t.polygonPatternFileOrigin),a=e.data.aPickingId,h=new Float32Array(2*a.length);let l,u,c;for(let A=0,f=a.length;A<f;A++){if(a[A]===l){h[2*A]=u,h[2*A+1]=c;continue}l=a[A];const t=s(null,r[l].feature.properties);t?(bj.set(t[0],t[1]),o.coordToPointAtRes(bj,i,wj),u=h[2*A]=wj.x,c=h[2*A+1]=wj.y):(u=h[2*A]=n[0],c=h[2*A+1]=n[1])}e.data.aPatternOrigin=h}createFnTypeConfig(t,e){const n=OE(e.polygonFill),i=EE(e.polygonOpacity),r=EE(e.uvScale),o=EE(e.uvOffset),s=new Uint8Array(1),a=new Uint16Array(2),h=new Uint8Array(2);return[{attrName:"aColor",symbolName:"polygonFill",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||bO(r).unitArray()),r=GB(r),r}},{attrName:"aOpacity",symbolName:"polygonOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),s[0]=255*r,s[0]}},{attrName:"aUVScale",symbolName:"uvScale",type:Uint16Array,width:2,define:"HAS_UV_SCALE",evaluate:e=>{const n=r(t.getZoom(),e);return a[0]=255*n[0],a[1]=255*n[1],a}},{attrName:"aUVOffset",symbolName:"uvOffset",type:Uint8Array,width:2,define:"HAS_UV_OFFSET",evaluate:e=>{const n=o(t.getZoom(),e);return h[0]=255*n[0],h[1]=255*n[1],h}}]}paint(t){this.isShadowIncludeChanged(t)&&(this.shader.dispose(),this._r(t)),super.paint(t)}isEnableTileStencil(t){const e="VectorTileLayer"===this.layer.getJSONType(),n=this.layer instanceof lA;return!(t&&t.isRenderingTerrain&&this.isTerrainSkin())&&(e||n&&this.isOnly2D())}init(t){const e=this.canvas,n={x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,n)=>n.viewport?n.viewport.width:e?e.width:1,height:(t,n)=>n.viewport?n.viewport.height:e?e.height:1};this.renderer=new j_(this.regl);const i={viewport:n,stencil:{enable:()=>this.isEnableTileStencil(t),func:{cmp:()=>this.isOnly2D()?"=":"<=",ref:(t,e)=>e.stencilRef},op:{fail:"keep",zfail:"keep",zpass:()=>{const t="VectorTileLayer"===this.layer.getJSONType(),e=this.isOnly2D();return t&&e?"zero":"replace"}}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:(t,e)=>{if(!BB(this.sceneConfig.depthMask))return!!this.sceneConfig.depthMask;if(e.hasSSRGround)return!0;if(e.meshConfig.transparent)return!1;const n=e.polygonOpacity;return!(ZB(n)&&n<1)},func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};if(this._r(t,i),this.pickingFBO){const t=[];this.picking=[new cw(this.renderer,{vert:dj,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Hp(t,n.projViewMatrix,n.modelMatrix),t}}],extraCommandProps:i},this.pickingFBO,this.getMap())]}}_r(t,e){const n=[],i=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp(n,e.projViewMatrix,e.modelMatrix),n}}],r={};this.fillIncludes(r,i,t),this.shader=new mx({vert:"#define SHADER_NAME FILL\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef IS_VT\nuniform mat4 modelMatrix;\n#endif\n#ifdef HAS_PATTERN\n#ifdef HAS_TEX_COORD\nattribute vec2 aTexCoord;\n#endif\nattribute vec4 aTexInfo;\nuniform vec2 patternWidth;\nuniform vec2 patternOffset;\nuniform vec2 uvOrigin;\nuniform vec2 uvScale;\n#ifdef IS_VT\nuniform float tileRatio;\nuniform float tileScale;\n#else\nuniform float glScale;\n#endif\n#ifdef HAS_UV_SCALE\nattribute vec2 aUVScale;\nvarying vec2 vUVScale;\n#endif\n#ifdef HAS_UV_OFFSET\nattribute vec2 aUVOffset;\nvarying vec2 vUVOffset;\n#endif\n#ifdef HAS_PATTERN_WIDTH\nattribute vec2 aPatternWidth;\n#endif\n#ifdef HAS_PATTERN_ORIGIN\nattribute vec2 aPatternOrigin;\n#endif\n#ifdef HAS_PATTERN_OFFSET\nattribute vec2 aPatternOffset;\n#endif\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d, vec2 e) {\n  \n#ifdef IS_VT\nfloat f = d.x / e.x;\n  float h = d.y / e.y;\n  return vec2(f, h);\n#else\nfloat i = glScale;\n#ifdef HAS_PATTERN_WIDTH\nfloat j = sign(length(aPatternWidth));\n  i = mix(glScale, 1., j);\n#endif\nvec2 k = uvOrigin;\n#ifdef HAS_PATTERN_ORIGIN\nk = aPatternOrigin;\n#endif\n#ifdef HAS_PATTERN_OFFSET\nvec2 l = aPatternOffset;\n#else\nvec2 l = patternOffset;\n#endif\nk += l;\n  float f = (d.x - k.x) * i / e.x;\n  float h = (d.y - k.y) * i / e.y;\n  return vec2(f, -h);\n#endif\n}\nvec2 m(vec4 n, vec2 o) {\n  \n#ifdef IS_VT\n#ifdef HAS_PATTERN_OFFSET\nvec2 l = aPatternOffset;\n#else\nvec2 l = patternOffset;\n#endif\nvec2 k = uvOrigin + l;\n#ifdef HAS_PATTERN_ORIGIN\nk = k - aPatternOrigin * tileScale;\n#endif\nfloat j = sign(length(patternWidth));\n  vec2 A = mix(o, patternWidth, j);\n#ifdef HAS_PATTERN_WIDTH\nA = aPatternWidth;\n#endif\nvec2 B = k * vec2(1., -1.) / A;\n  return mod(B, 1.) + c(n.xy * tileScale / tileRatio, A);\n#else\nvec2 A = o;\n#ifdef HAS_PATTERN_WIDTH\nfloat j = sign(length(aPatternWidth));\n  A = mix(o, aPatternWidth, j);\n#endif\nvec4 C = modelMatrix * n;\n  return c(C.xy, A);\n#endif\n}\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <vt_position_vert>\n#include <highlight_vert>\nvoid main() {\n  vec3 D = unpackVTPosition();\n  vec4 n = vec4(D, 1.);\n  gl_Position = projViewModelMatrix * n;\n#ifdef HAS_PATTERN\nvec2 o = aTexInfo.zw + 1.;\n  vTexInfo = vec4(aTexInfo.xy, o);\n#ifdef HAS_TEX_COORD\nif(aTexCoord.x == INVALID_TEX_COORD) {\n    vTexCoord = m(n, o);\n  } else {\n    vTexCoord = aTexCoord;\n  }\n#else\nvTexCoord = m(n, o);\n#endif\n#ifdef HAS_UV_SCALE\nvUVScale = aUVScale / 255.;\n#endif\n#ifdef HAS_UV_OFFSET\nvUVOffset = aUVOffset / 255.;\n#endif\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\nhighlight_setVarying();\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(n);\n#endif\n}",frag:"#define SHADER_NAME FILL\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n#ifdef HAS_UV_SCALE\nvarying vec2 vUVScale;\n#else\nuniform highp vec2 uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvarying vec2 vUVOffset;\n#else\nuniform vec2 uvOffset;\n#endif\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D polygonPatternFile;\nuniform vec2 atlasSize;\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c() {\n  \n#ifdef HAS_UV_SCALE\nvec2 d = vUVScale;\n#else\nvec2 d = uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvec2 e = vUVOffset;\n#else\nvec2 e = uvOffset;\n#endif\nvec2 f = mod(vTexCoord * d + e, 1.);\n  vec2 h = vTexInfo.xy;\n  vec2 i = vTexInfo.zw;\n  return (h + f * i) / atlasSize;\n}\n#endif\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#include <highlight_frag>\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float polygonOpacity;\n#endif\nuniform float layerOpacity;\nuniform float tileExtent;\nvoid main() {\n  \n#ifdef HAS_COLOR\nvec4 j = vColor;\n#else\nvec4 j = polygonFill;\n#endif\n#ifdef HAS_PATTERN\nif(vTexInfo.z * vTexInfo.w > 1.) {\n    vec2 f = c();\n    j = texture2D(polygonPatternFile, f);\n  }\n#endif\n#ifdef HAS_OPACITY\ngl_FragColor = j * vOpacity;\n#else\ngl_FragColor = j * polygonOpacity;\n#endif\ngl_FragColor *= layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat k = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, k);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:i,defines:r,extraCommandProps:e})}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i={projViewMatrix:n?vj:t.projViewMatrix,glScale:e&&e.isRenderingTerrainSkin?1:1/t.getGLScale(),viewport:n&&e&&e.viewport,hasSSRGround:e&&e.hasSSRGround};return this.setIncludeUniformValues(i,e),i}Mr(t,e,n,i,r,o){let s,a;const h=this.getMap();return e&&(s=KB(h,e,r,o)),n&&(a=KB(h,n,r,o,1)),s=s||a,a=a||s,t[0]=s,t[1]=a,t}}var Tj="#define SHADER_NAME LINE\n#define AA_CLIP_LIMIT 2.0\n#define AA_LINE_WIDTH 16.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\n#ifdef PICKING_MODE\n#include <gl2_vert>\n#endif\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY)\nattribute vec3 aExtrude;\n#else\nattribute vec2 aExtrude;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nattribute float aLinesofar;\nvarying highp float vLinesofar;\n#endif\nuniform float cameraToCenterDistance;\n#if defined(HAS_STROKE_WIDTH)\nattribute float aLineStrokeWidth;\n#else\nuniform float lineStrokeWidth;\n#endif\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\nuniform float tileResolution;\nuniform float resolution;\nuniform float tileRatio;\nuniform float isRenderingTerrain;\n#if defined(HAS_LINE_DX) || defined(HAS_LINE_DY)\nattribute vec2 aLineDxDy;\n#endif\n#ifndef HAS_LINE_DX\nuniform float lineDx;\n#endif\n#ifndef HAS_LINE_DY\nuniform float lineDy;\n#endif\nuniform vec2 canvasSize;\nuniform float layerScale;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef USE_LINE_OFFSET\nattribute vec2 aExtrudeOffset;\n#endif\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#ifndef PICKING_MODE\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_PATTERN\n#if defined(HAS_PATTERN_ANIM) || defined(HAS_PATTERN_GAP)\nattribute vec2 aLinePattern;\n#endif\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#endif\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nattribute vec4 aDasharray;\nvarying vec4 vDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nattribute vec4 aDashColor;\nvarying vec4 vDashColor;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nattribute vec4 aStrokeColor;\nvarying vec4 vStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\n#ifdef HAS_GRADIENT\nattribute float aGradIndex;\nvarying float vGradIndex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvarying vec3 vVertex;\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  float d = mod(abs(aExtrude.x), 2.);\n  float e = mod(abs(aExtrude.y), 2.);\n  vNormal = vec2(d, e * 2. - 1.);\n  vec4 f = vec4(c, 1.);\n  vec4 h = projViewModelMatrix * positionMatrix * f;\n  if(isRenderingTerrain == 1.) {\n    vVertex = (positionMatrix * f).xyz;\n  } else {\n    vVertex = (modelMatrix * positionMatrix * f).xyz;\n  }\n#ifdef HAS_STROKE_WIDTH\nfloat i = aLineStrokeWidth / 2. * layerScale;\n#else\nfloat i = lineStrokeWidth;\n#endif\n#ifdef HAS_LINE_WIDTH\nfloat j = aLineWidth / 2. * layerScale;\n#else\nfloat j = lineWidth * layerScale;\n#endif\nfloat k = j / 2. + i;\n  float l = sign(i) * j / 2.;\n  float m = l + sign(l) * ANTIALIASING;\n  float n = k + sign(k) * ANTIALIASING;\n#ifdef USE_LINE_OFFSET\nvec2 o = lineOffset * (vNormal.y * (aExtrude.xy - aExtrudeOffset) + aExtrudeOffset);\n  vec2 u = (n * aExtrude.xy + o) / EXTRUDE_SCALE;\n#else\nvec2 v = aExtrude.xy / EXTRUDE_SCALE;\n  vec2 u = n * v;\n#endif\nfloat A = tileResolution / resolution;\n  vec4 B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n  gl_Position = projViewModelMatrix * positionMatrix * B;\n  if(isRenderingTerrain == .0) {\n    float C = min(AA_CLIP_LIMIT / canvasSize.x, AA_CLIP_LIMIT / canvasSize.y);\n    float D = distance(gl_Position.xy / gl_Position.w, h.xy / h.w) - C;\n    if(D * j < .0) {\n      float E = -D / C;\n      float F = E * E * E * E * AA_LINE_WIDTH;\n      u += F * v;\n      n += F / 6.;\n      B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n      gl_Position = projViewModelMatrix * positionMatrix * B;\n    }\n  }\n#ifdef HAS_LINE_DX\nfloat G = aLineDxDy[0];\n#else\nfloat G = lineDx;\n#endif\n#ifdef HAS_LINE_DY\nfloat H = aLineDxDy[1];\n#else\nfloat H = lineDy;\n#endif\nfloat I = gl_Position.w;\n  gl_Position.xy += vec2(G, H) * 2. / canvasSize * I;\n#ifndef PICKING_MODE\nvWidth = vec2(n, m);\n  if(isRenderingTerrain == 1.) {\n    vGammaScale = 1.;\n  } else {\n    vGammaScale = I / cameraToCenterDistance;\n  }\n#ifndef ENABLE_TILE_STENCIL\nvPosition = c.xy;\n#ifdef USE_LINE_OFFSET\nvPosition += tileRatio * o / EXTRUDE_SCALE;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT)\n#ifdef HAS_GRADIENT\nvLinesofar = aLinesofar / MAX_LINE_DISTANCE;\n  vGradIndex = aGradIndex;\n#else\nfloat J = aLinesofar - k * aExtrude.z / EXTRUDE_SCALE / A * tileRatio;\n  vLinesofar = J / tileRatio * A;\n#endif\n#endif\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nvColor = aColor;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvDasharray = aDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvDashColor = aDashColor / 255.;\n#endif\n#endif\n#ifdef HAS_PATTERN\nvTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n#ifdef HAS_PATTERN_ANIM\nvLinePatternAnimSpeed = aLinePattern[0] / 127.;\n#endif\n#ifdef HAS_PATTERN_GAP\nvLinePatternGap = aLinePattern[1] / 10.0;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nvStrokeColor = aStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(B);\n#endif\nhighlight_setVarying();\n#else\nfbo_picking_setData(I, true);\n#endif\n}";const Sj=Np([]),Ij=[];class Ej extends fj{static getBloomSymbol(){return["lineBloom"]}isUniqueStencilRefPerTile(){return!1}prepareSymbol(t){const e=t.lineColor;Array.isArray(e)&&(3===e.length&&e.push(1),t.lineColor=e.map((t=>255*t)));const n=t.lineStrokeColor;Array.isArray(n)&&(3===n.length&&n.push(1),t.lineStrokeColor=n.map((t=>255*t)));const i=t.lineDashColor;Array.isArray(i)&&(3===i.length&&i.push(1),t.lineDashColor=i.map((t=>255*t)))}isAnimating(){if(this.Sr)return!0;const t=this.getSymbols(),e=this.sceneConfig.trailAnimation;if(e&&e.enable)return!0;for(let n=0;n<t.length;n++)if(t[n].linePatternFile&&t[n].linePatternAnimSpeed)return!0;return!1}needToRedraw(){return!!super.needToRedraw()||!!this.isAnimating()}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex)[Ej.getBloomSymbol()[0]]}needPolygonOffset(){return!0}createMesh(t,e){if(!t.geometry)return null;const{geometry:n,symbolIndex:i,ref:r}=t,o=this.getSymbolDef(i);void 0===r&&OH(n,o,this.getFnTypeConfig(i),this.layer);const s=this.getSymbol(i),a={tileResolution:n.properties.tileResolution,tileRatio:n.properties.tileRatio,tileExtent:n.properties.tileExtent};this.setLineUniforms(s,a),jB(a,"lineColor",s,"lineColor","#fff",VB(this.colorCache)),jB(a,"linePatterGapColor",s,"linePatterGapColor",[0,0,0,0],VB(this.colorCache)),jB(a,"lineStrokeColor",s,"lineStrokeColor",[0,0,0,0],VB(this.colorCache)),jB(a,"lineDasharray",s,"lineDasharray",[0,0,0,0],(t=>{let e;return t&&t.length&&(1===t.length?e=[t[0],t[0],t[0],t[0]]:2===t.length?e=[t[0],t[1],t[0],t[1]]:3===t.length?e=[t[0],t[1],t[2],t[2]]:4===t.length?e=t:t.length>4&&(e=t.slice(0,4))),e||[0,0,0,0]})),jB(a,"lineDashColor",s,"lineDashColor",[0,0,0,0],VB(this.colorCache));const h=n.properties.iconAtlas,l=this.layer instanceof lA;h&&(a.linePatternFile=pj(this.regl,h,!1,!1),a.atlasSize=h?[h.width,h.height]:[0,0],a.flipY=l?-1:1,this.drawDebugAtlas(h)),void 0===r&&n.generateBuffers(this.regl);const u=new T_(a),c=new z_(n,u,{castShadow:!1,picking:!0});c.setLocalTransform(e),c.positionMatrix=this.getAltitudeOffsetMatrix();const A={};return h&&(A.HAS_PATTERN=1),c.properties.symbolIndex=i,this.kr(c,A),n.data.aColor&&(A.HAS_COLOR=1),n.data.aStrokeColor&&(A.HAS_STROKE_COLOR=1),this.setMeshDefines(A,n,o),n.data.aAltitude&&(A.HAS_ALTITUDE=1),c.setDefines(A),c}addMesh(...t){delete this.Sr;const e=t[0];Array.isArray(e)?e.forEach((t=>{this.Pr(t)})):this.Pr(e),super.addMesh(...t)}Pr(t){if(!t.geometry.aLineWidth&&t.material.get("lineWidth")<=0||!t.geometry.aOpacity&&t.material.get("lineOpacity")<=0)return;const e=t.defines;this.kr(t,e),t.setDefines(e),t.geometry.properties.hasPatternAnim&&(this.Sr=1)}kr(t,e){const n=t.geometry,i=this.getSymbol(t.properties.symbolIndex);n.data.aDasharray||Array.isArray(i.lineDasharray)&&i.lineDasharray.reduce(((t,e)=>t+e),0)>0?(e.HAS_DASHARRAY=1,n.data.aDasharray&&(e.HAS_DASHARRAY_ATTR=1),n.data.aDashColor&&(e.HAS_DASHARRAY_COLOR=1)):e.HAS_DASHARRAY&&delete e.HAS_DASHARRAY}setLineUniforms(t,e){jB(e,"lineWidth",t,"lineWidth",2),jB(e,"lineOpacity",t,"lineOpacity",1),jB(e,"lineStrokeWidth",t,"lineStrokeWidth",0),jB(e,"lineBlur",t,"lineBlur",.7),jB(e,"lineOffset",t,"lineOffset",0),jB(e,"lineDx",t,"lineDx",0),jB(e,"lineDy",t,"lineDy",0),jB(e,"linePatternAnimSpeed",t,"linePatternAnimSpeed",0),jB(e,"linePatternGap",t,"linePatternGap",0)}setMeshDefines(t,e,n){e.data.aOpacity&&(t.HAS_OPACITY=1),e.data.aLineWidth&&(t.HAS_LINE_WIDTH=1),e.data.aLineStrokeWidth&&(t.HAS_STROKE_WIDTH=1),UH(n.lineDx)&&(t.HAS_LINE_DX=1),UH(n.lineDy)&&(t.HAS_LINE_DY=1),UH(n.linePatternAnimSpeed)&&(t.HAS_PATTERN_ANIM=1),UH(n.linePatternGap)&&(t.HAS_PATTERN_GAP=1)}paint(t){this.isShadowIncludeChanged(t)&&(this.shader.dispose(),this.createShader(t)),super.paint(t)}createFnTypeConfig(t,e){const n=OE(e.lineColor),i=OE(e.aLinePatternAnimSpeed),r=OE(e.aLinePatternGap),o=this.createShapeFnTypeConfigs(t,e),s=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||bO(r).unitArray()),r=GB(r),r}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(e,n,r,o)=>{let a=i(t.getZoom(),e);return BB(a)&&(a=0),0!==a&&(n.properties.hasPatternAnim=1),s[0]=a/127,s[1]=r[o+1],s}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(e,n,i,o)=>{let a=r(t.getZoom(),e);return BB(a)&&(a=0),s[1]=10*a,s[0]=i[o],s}}].concat(o)}createShapeFnTypeConfigs(t,e){const n=EE(e.lineWidth),i=EE(e.lineOpacity),r=EE(e.lineStrokeWidth),o=EE(e.lineDx),s=EE(e.lineDy),a=new Uint16Array(1),h=new Int8Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e)),a[0]=Math.round(2*r),a[0]}},{attrName:"aLineStrokeWidth",symbolName:"lineStrokeWidth",type:Uint8Array,width:1,define:"HAS_STROKE_WIDTH",evaluate:e=>{const n=r(t.getZoom(),e);return a[0]=Math.round(2*n),a[0]}},{attrName:"aLineDxDy",symbolName:"lineDx",type:Int8Array,width:2,define:"HAS_LINE_DX",evaluate:e=>{const n=o(t.getZoom(),e);return h[0]=n,h[0]}},{attrName:"aLineDxDy",symbolName:"lineDy",type:Int8Array,width:2,define:"HAS_LINE_DY",evaluate:e=>{const n=s(t.getZoom(),e);return h[0]=n,h[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),a[0]=255*r,a[0]}}]}updateSceneConfig(t){t.trailAnimation&&this.createShader(this.Tr)}init(t){this.renderer=new j_(this.regl),this.createShader(t),this.pickingFBO&&(this.picking=[new cw(this.renderer,{vert:"#define PICKING_MODE 1\n"+Tj,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO,this.getMap())])}createShader(t){this.Tr=t;const e=[],n={};this.fillIncludes(n,e,t),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(n.HAS_TRAIL=1);const i=[];e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp(i,e.projViewMatrix,e.modelMatrix),i}}),this.shader=new mx({vert:Tj,frag:"#define SHADER_NAME LINE\n#define DEVICE_PIXEL_RATIO 1.0\nprecision highp float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform lowp float blendSrcIsOne;\nuniform lowp float lineBlur;\nuniform float isRenderingTerrain;\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform lowp vec4 lineColor;\n#endif\n#include <highlight_frag>\n#ifdef HAS_STROKE_COLOR\nvarying vec4 vStrokeColor;\n#else\nuniform lowp vec4 lineStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\nuniform float layerOpacity;\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatterGapColor;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d) {\n  vec2 e = mod(d, 1.);\n  vec2 f = vTexInfo.xy;\n  vec2 h = vTexInfo.zw;\n  return (f + e * h) / atlasSize;\n}\n#endif\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\nuniform float tileExtent;\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvarying vec4 vDasharray;\n#else\nuniform vec4 lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvarying vec4 vDashColor;\n#else\nuniform vec4 lineDashColor;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nvarying highp float vLinesofar;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\n#endif\n#if defined(HAS_TRAIL) || defined(HAS_PATTERN)\nuniform float currentTime;\n#endif\nfloat i(float j, float k) {\n  float l = k / 2.;\n  float m = abs(j - l);\n  float n = (.1 + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  return clamp(min(m + n, l - m) / n, .0, 1.);\n}\nvarying vec3 vVertex;\nuniform vec3 cameraPosition;\nuniform float cameraToCenterDistance;\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat o = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(o == .0) {\n    discard;\n  }\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nfloat u = vLinesofar;\n#endif\nfloat v = length(vNormal) * vWidth.s;\n#ifdef HAS_PATTERN\nvec2 h = vTexInfo.zw;\n  float A = sign(h.x * h.y);\n  float B = mix(lineBlur, .0, A);\n#else\nfloat B = lineBlur;\n#endif\nfloat n = (B + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float C = clamp(min(v - (vWidth.t - n), vWidth.s - v) / n, .0, 1.);\n#ifdef HAS_COLOR\nvec4 D = vColor / 255.;\n#else\nvec4 D = lineColor;\n#endif\n#ifdef HAS_PATTERN\nif(A == 1.) {\n    \n#ifdef HAS_PATTERN_GAP\nfloat E = vLinePatternGap;\n#else\nfloat E = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat F = vLinePatternAnimSpeed;\n#else\nfloat F = linePatternAnimSpeed;\n#endif\nfloat G = h.x * vWidth.s * 2. / h.y;\n    float H = G * (1. + E);\n    u += mod(currentTime * -F * .2, H);\n    float I = mod(u / H, 1.);\n    float J = mod((flipY * vNormal.y + 1.) / 2., 1.);\n    vec4 K = texture2D(linePatternFile, c(vec2(I * (1. + E), J)));\n    float L = clamp(sign(1. / (1. + E) - I) + .000001, .0, 1.);\n    K = mix(linePatterGapColor, K, L);\n    D *= K;\n  }\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvec4 M = vDasharray;\n#else\nvec4 M = lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvec4 N = vDashColor;\n#else\nvec4 N = lineDashColor;\n#endif\nfloat k = M[0] + M[1] + M[2] + M[3];\n  float j = mod(u, k);\n  float O = max(sign(M[0] - j), .0);\n  float P = j - M[0] - M[1];\n  float Q = max(sign(P), .0) * max(sign(M[2] - P), .0);\n  float R = O + Q;\n  float S = i(j, M[0]);\n  float T = i(P, M[2]);\n  float U = S * O + T * Q;\n  D = D * (1. - U) + N * U;\n#endif\n#ifdef HAS_STROKE_COLOR\nvec4 V = vStrokeColor / 255.;\n#else\nvec4 V = lineStrokeColor;\n#endif\nV = mix(D, V, sign(vWidth.t));\n  D = V * C + max(sign(vWidth.t - v), .0) * D * (1. - C);\n#ifdef HAS_TRAIL\nfloat W = mod(u - currentTime * trailSpeed * .1, trailCircle);\n  float X = W < trailLength ? mix(.0, 1., W / trailLength) : .0;\n  D *= X;\n#endif\n#ifdef HAS_OPACITY\nfloat Y = vOpacity;\n#else\nfloat Y = lineOpacity;\n#endif\ngl_FragColor = D * Y * layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat Z = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, Z);\n#endif\nfloat ba;\n  if(isRenderingTerrain == 1.) {\n    ba = 1.;\n  } else {\n    ba = clamp(cameraToCenterDistance * 1.5 / distance(vVertex, cameraPosition), .0, 1.);\n  }\n  gl_FragColor *= ba;\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:e,defines:n,extraCommandProps:this.getExtraCommandProps(t)})}isEnableTileStencil(t){return!(t&&t.isRenderingTerrain&&this.isTerrainSkin())}getExtraCommandProps(t){const e=this.canvas;return{viewport:{x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,n)=>n.viewport?n.viewport.width:e?e.width:1,height:(t,n)=>n.viewport?n.viewport.height:e?e.height:1},stencil:{enable:()=>this.isEnableTileStencil(t),mask:255,func:{cmp:()=>"<=",ref:(t,e)=>e.stencilRef},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!1,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i=this.layer.getTileSize().width,r=n?Sj:t.projViewMatrix,o=t.viewMatrix,s=t.cameraToCenterDistance,a=t.getResolution(),h=ly(Ij,t.width,t.height);n&&ly(h,i,i);const l=this.getBlendFunc().src(),u=this.sceneConfig.trailAnimation||{},c={layerScale:this.layer.options.styleScale||1,projViewMatrix:r,viewMatrix:o,cameraToCenterDistance:s,resolution:a,canvasSize:h,trailSpeed:u.speed||1,trailLength:u.trailLength||500,trailCircle:u.trailCircle||1e3,currentTime:this.layer.getRenderer().getFrameTimestamp()||0,blendSrcIsOne:+!(1!==l&&"one"!==l),cameraPosition:t.cameraPosition,viewport:n&&e&&e.viewport,isRenderingTerrain:+!!n};return this.setIncludeUniformValues(c,e),c}}class Oj extends Ej{postCreateGeometry(t){const{symbolIndex:e,geometry:n}=t,{features:i}=n.properties,r=this.getSymbol(e).lineGradientProperty,o=n.data.aPickingId,s=new Uint8Array(o.length),a=[],h=new Map;function l(t){let e=t&&t[r];Array.isArray(e)||(e=[0,"black",1,"black"]);let n,i=e.join();return h.has(i)?n=h.get(i):(n=a.length,h.set(i,n),a.push(e)),n}let u=o[0],c=i[u].feature.properties,A=l(c);for(let f=1;f<o.length;f++)o[f]!==u&&(u=o[f],c=i[u].feature.properties,A=l(c)),s[f]=A;n.data.aGradIndex=s,n.properties.gradients=a}createMesh(t,e){const{geometry:n,symbolIndex:i,ref:r}=t,o=this.getSymbolDef(i);void 0===r&&OH(n,o,this.getFnTypeConfig(i),this.layer);const s={tileResolution:n.properties.tileResolution,tileRatio:n.properties.tileRatio,tileExtent:n.properties.tileExtent},a=this.getSymbol(i);this.setLineUniforms(a,s);const h=n.properties.gradients,l=this.regl.texture({width:256,height:2*h.length,data:Rj(h),format:"rgba",mag:"linear",min:"linear",flipY:!1});s.lineGradientTexture=l,s.lineGradientTextureHeight=l.height,void 0===r&&n.generateBuffers(this.regl);const u=new T_(s),c=new z_(n,u,{castShadow:!1,picking:!0});c.setLocalTransform(e);const A={HAS_GRADIENT:1};return n.data.aAltitude&&(A.HAS_ALTITUDE=1),this.setMeshDefines(A,n,o),c.setDefines(A),c.properties.symbolIndex=i,c}createFnTypeConfig(t,e){return this.createShapeFnTypeConfigs(t,e)}createShader(t){this.Tr=t;const e=[],n={};this.fillIncludes(n,e,t),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(n.HAS_TRAIL=1);const i=[];e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp(i,e.projViewMatrix,e.modelMatrix),i}}),this.shader=new mx({vert:Tj,frag:"#define SHADER_NAME LINE_GRADIENT\n#define DEVICE_PIXEL_RATIO 1.0\n#define MAX_LINE_COUNT 128.0\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\nuniform float layerOpacity;\nuniform lowp float lineBlur;\nuniform float lineGradientTextureHeight;\nuniform float tileExtent;\nuniform sampler2D lineGradientTexture;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\nvarying highp float vLinesofar;\nvarying float vGradIndex;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\nuniform float currentTime;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat c = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(c == .0) {\n    discard;\n  }\n#endif\nfloat d = length(vNormal) * vWidth.s;\n  float e = (lineBlur + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float f = clamp(min(d - (vWidth.t - e), vWidth.s - d) / e, .0, 1.);\n  float h = vLinesofar;\n  vec4 i = texture2D(lineGradientTexture, vec2(h, (vGradIndex * 2. + .5) / lineGradientTextureHeight)) * f;\n  i *= max(sign(MAX_LINE_COUNT - vGradIndex), .0);\n#ifdef HAS_TRAIL\nfloat j = mod(h - currentTime * trailSpeed * .1, trailCircle);\n  float k = j < trailLength ? mix(.0, 1., j / trailLength) : .0;\n  i *= k;\n#endif\n#ifdef HAS_OPACITY\nfloat l = vOpacity;\n#else\nfloat l = lineOpacity;\n#endif\ngl_FragColor = i * l * layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat m = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, m);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:e,defines:n,extraCommandProps:this.getExtraCommandProps()})}}function Rj(t){t.length>2048&&console.warn(`Gradients count is (${t.length}), it may be slow to render.`);const e=document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=2*t.length;for(let i=0;i<t.length;i++){const e=t[i],r=n.createLinearGradient(0,0,256,0);for(let t=0;t<e.length;t+=2)r.addColorStop(+e[t],e[t+1]);n.fillStyle=r;const o=i%256;n.fillRect(0,2*o,256,2*o+2)}return n.canvas}class Dj{constructor(t){this.be=t||[],this.properties={}}set meshes(t){this.be=t}get meshes(){return this.be}}const kj=224,Lj=100,Fj=new Uint8Array(1),Nj=[],zj={collides:0,boxes:[]},Bj=[],Hj=[];class jj extends fj{createGeometry(...t){const e=super.createGeometry(...t);if(!e||!e.geometry)return e;const{geometry:n}=e,i=t[0];return n.properties.collideIds=i.featureIds&&i.featureIds.length&&i.isIdUnique?i.featureIds:i.data.aPickingId,n.properties.uniqueCollideIds=YB(n.properties.collideIds,!(this.layer instanceof lA)),e}supportRenderMode(t){const e=this.sceneConfig.renderToPointRenderTarget;return e||void 0===e?"point"===t:"fxaa"===t||"fxaaAfterTaa"===t}addMesh(t,e,n){if(t&&!this.isEnableCollision()){let e=t;Array.isArray(e)||(Bj[0]=t,e=Bj);for(let t=0;t<e.length;t++){const n=e[t].defines;delete n.ENABLE_COLLISION,e[t].setDefines(n);const{elements:i,visElemts:r}=e[t].geometry.properties;r&&void 0!==r.count&&r.count!==i.length&&(e[t].geometry.setElements(i),r.count=i.length)}}return super.addMesh(t,e,n)}startMeshCollision(t){const{meshKey:e}=t.properties,{renderer:n}=this.Ir,i=n.isForeground(t instanceof Dj?t.meshes[0]:t);if(t.properties.isForeground=i,t instanceof Dj&&t.meshes.length)for(let r=0;r<t.meshes.length;r++)t.meshes[r].properties.isForeground=i;this.Fr=performance.now(),this.Cr=this.Or(),this.Er=this.Dr(e)}endMeshCollision(t){const e=this.Lr.tags[t];if(this.Cr&&e&&this.Er){const t=this.getMap();this.Rr||(this.Rr=new $o(0,0),this.Hr=new $o(0,0)),e.anchor0=t.containerPointToCoord(this.zr,this.Rr),e.anchor1=t.containerPointToCoord(this.Nr,this.Hr),e.anchor0.z=t.getZoom(),e.anchor0.width=t.width,e.anchor0.height=t.height,e.anchor0.pitch=t.getPitch()}this.getMap().collisionFrameTime+=performance.now()-this.Fr}Dr(t){const e=this.getMap(),n=e.getZoom(),i=e.getPitch(),[r,o]=this.Vr(t);return!r||!o||r.z!==n||r.width!==e.width||r.height!==e.height||r.pitch!==i||r.distanceTo(this.zr)>3||o.distanceTo(this.Nr)>3}Ur(){const t=this.getMap();this.jr={},this.zr=new ht(t.width/3,t.height/2),this.Nr=new ht(2*t.width/3,t.height/2),delete this.Cr,this.Lr||(this.Lr={tags:{}}),this.Ir={layer:this.layer,renderer:this.layer.getRenderer(),frameTimestamp:this.layer.getRenderer().getFrameTimestamp(),map:this.getMap(),zoom:t.getZoom(),collisionTags:this.Lr.tags,isEnableUniquePlacement:this.isEnableUniquePlacement()}}Gr(){}Br(t,e){const n=this.Lr;return n.tags[t]&&n.tags[t][e]}$r(t,e,n){const i=this.Lr;i.tags[t]=i.tags[t]||[],i.tags[t][e]=n}Or(){const t=this.getMap();return!t.isInteracting()||t.collisionFrameTime<=this.layer.options.collisionFrameLimit}Vr(t){const e="__meshAnchorKey".trim(),n=this.Lr.tags[t];if(n&&n.anchor0){const{anchor0:t,anchor1:i}=n,r=t[e]=t[e]||t.x+","+t.y,o=i[e]=i[e]||i.x+","+i.y;let s=this.jr[r],a=this.jr[o];if(!s||!a){const e=this.getMap();s=this.jr[r]=e.coordToContainerPoint(t),a=this.jr[o]=e.coordToContainerPoint(i)}return s.z=t.z,Nj[0]=s,Nj[1]=a,s.width=t.width,s.height=t.height,Nj}return Nj[0]=Nj[1]=null,Nj}updateBoxCollisionFading(t,e,n,i,r){const{layer:o,renderer:s,zoom:a,collisionTags:h,isEnableUniquePlacement:l}=this.Ir,{meshKey:u,isForeground:c}=e.properties;if(l&&this.Wr(u,r))return!1;const A=n.length;let f=h[u]&&h[u][r];const d=f,p=this.Xr&&f;if((!p||0===f.collides)&&t&&(this.Cr||p&&0===f.collides))if((this.Er||f&&f.z!==a)&&(f=null),f){if(f.boxes&&f.boxes.length){const{boxes:t,isAllowOverlap:e}=f;let n=0;if(!e){let e=0;for(let i=0;i<t.length;i++)if(!n){const r=this.isCollides(t[i]);if(-1===r)e++;else if(1===r){n=1;break}}e===t.length&&(n=-1)}f.collides=n}}else{f=d||{collides:0,boxes:[]},f.boxes.length=0,f.z=a;let t=0;for(let e=0;e<A;e++){const{mesh:o,allElements:s,boxCount:a,start:h,end:l}=n[e],u=this.Yr(o,s,a,h,l,i,r);u.isAllowOverlap&&(f.isAllowOverlap=1),0===t&&(t=u.collides),u.boxes&&f.boxes.push(...u.boxes)}f.collides=t,this.$r(u,r,f)}let g=t&&f&&0===f.collides,m=1,y=!1;if(this.sceneConfig.fading){const t=this.qr(e);if(this.Jr)t[r]=g?1:-1;else if(c&&delete e.Kr,m=this.Zr(c,g,t,r),c?(m>0&&(g=!0),y=this.isBoxFading(e,r),y&&this.setToRedraw()):g||(this.Qr(t,r),m=0),g){const n=e.Kr;if(n&&1===m&&t[r]>0){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;BB(e)&&(e=kj),BB(t)&&(t=Lj);const i=NB(1-(s.getFrameTimestamp()-n-t)/e,0,1);m*=i,i>0&&this.setToRedraw()}}}if(f&&o.options.debugCollision&&this.addCollisionDebugBox(f.boxes,f.collides?0:1),g||y){const{mesh:t,start:e}=n[0],i=this.getSymbol(t.properties.symbolIndex);!this.ts(i,t,e)&&f&&f.boxes&&this.es(f.boxes,t)}if(g){const t=Fj[0]=255*m;for(let e=0;e<A;e++){const{mesh:i,allElements:r,start:o,end:s,boxIndex:a}=n[e];this.setCollisionOpacity(i,r,t,o,s,a)}}return g&&m>0}isMeshIterable(){return!0}setCollisionOpacity(t,e,n,i,r){this.ns(t,n,e[i],e[r-1])}ns(t,e,n,i){const{aOpacity:r}=t.geometry.properties;if(!r)return;const o=n;if(r[o]!==e){const t=i;for(let n=o;n<=t;n++)r[n]=e;r.dirty=!0}}isBoxFading(t,e){const{frameTimestamp:n}=this.Ir;let i=this.sceneConfig.fadingDuration;return BB(i)&&(i=kj),n-Math.abs(this.qr(t)[e])<i}Yr(t,e,n,i,r,o,s){const a=this.getSymbol(t.properties.symbolIndex),h=this.ts(a,t,e[i]),l=this.rs(a,t,e[i]);if(!this.isEnableCollision()||h&&l)return zj;const u=this.isBoxCollides(t,e,n,i,r,o,s);return l&&(u.collides=0,u.isAllowOverlap=1),u}ts(t,e,n){if(!this.isEnableCollision())return!0;const i=e.geometry.properties.aOverlap;if(!i)return 1==+t[this.propIgnorePlacement];const r=i[n];return r<2?1==+t[this.propIgnorePlacement]:r%8%2}rs(t,e,n){if(!this.isEnableCollision())return!0;const i=e.geometry.properties.aOverlap;if(!i)return 1==+t[this.propAllowOverlap];const r=i[n];return r<2?1==+t[this.propAllowOverlap]:(r>>2)%2}es(t){if(Array.isArray(t[0]))for(let e=0;e<t.length;e++)this.insertCollisionBox(t[e]);else this.insertCollisionBox(t)}Zr(t,e,n,i){let{fadingDuration:r,fadeInDelay:o,fadeOutDelay:s}=this.sceneConfig;BB(r)&&(r=kj),BB(o)&&(o=600),BB(s)&&(s=Lj);const{frameTimestamp:a}=this.Ir;let h=n[i],l=e?1:0;if(!h)return e&&t&&(n[i]=a+o),0;if(a<Math.abs(h)&&(!e&&h>0||e&&h<0)){const t=a-r;n[i]=h=e?t:-t}return a-Math.abs(h)<r?l=h>0?(a-h)/r:1-(a+h)/r:e?(h<0&&(n[i]=h=a+o),l=(a-h)/r):(h>0&&(n[i]=h=-(a+s)),l=1-(a+h)/r),(l<0||l>1)&&(l=NB(l,0,1)),l}qr(t){this.ss||(this.ss={});const{meshKey:e}=t.properties;if(!this.ss[e]){const{frameTimestamp:t}=this.Ir;this.ss[e]={timestamp:t}}return this.ss[e]}os(t){if(!this.ls)return void(this.ls=t);const e=this.scene.getMeshes();if(e&&e.length){for(let n=0;n<e.length;n++){const i=this.qr(e[n]);i.timestamp<this.ls?delete e[n]._fading_timestamps:i.timestamp=t}this.ls=t}}Qr(t,e){if(!t)return;const{frameTimestamp:n}=this.Ir;let{fadingDuration:i}=this.sceneConfig;BB(i)&&(i=kj),t[e]=-(n-i-1)}deleteMesh(t,e){if(t){if(Array.isArray(t))for(let e=0;e<t.length;e++){const n=t[e].properties.meshKey;this.Lr&&delete this.Lr.tags[n],this.ss&&delete this.ss[n]}else{const e=t.properties.meshKey;this.Lr&&delete this.Lr.tags[e],this.ss&&delete this.ss[e]}super.deleteMesh(t,e)}}delete(t){this.hs&&(this.hs.geometry.dispose(),this.us.dispose(),this.hs.dispose(),delete this.hs,delete this.us,delete this.cs),delete this.Lr,super.delete(t)}isCollides(t){const e=this.layer,n=e.getMap(),i=n.getDevicePixelRatio();if(Jg(Hj,t,1/i),n.isOffscreen(Hj))return-1;const r=e.getCollisionIndex(),o=this.sceneConfig.collisionBufferSize||e.options.collisionBufferSize||0;return o&&(t=Wj(Hj,t,o)),+r.collides(t)}insertCollisionBox(t){const e=this.layer,n=e.getCollisionIndex(),i=this.sceneConfig.collisionBufferSize||e.options.collisionBufferSize||0;let r=t;i&&(r=t.fs=t.fs||[],t=Wj(r,t,i)),n.insertBox(r)}addCollisionDebugBox(t,e){if(t&&t.length)if(Array.isArray(t[0]))for(let n=0;n<t.length;n++)this.ds(t[n],e);else this.ds(t,e)}ds(t,e){if(!t)return;const n=this.ps=this.ps||{aPosition:[],aVisible:[],indices:[]},i=this.sceneConfig.collisionBufferSize||this.layer.options.collisionBufferSize||0;i&&(t=Wj(Hj,t,i));const r=this.getMap(),o=r.getDevicePixelRatio();if(Jg(Hj,t,1/o),r.isOffscreen(Hj))return;const s=n.aPosition.length/2;n.aPosition.push(t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]),n.aVisible.push(e,e,e,e),n.indices.push(s,s+1,s+1,s+2,s+2,s+3,s+3,s)}updateCollision(t){super.updateCollision(t),this.Ur(),this.ys(),this.gs&&this.gs.length&&(this.vs(),this.gs&&(this.setToRedraw(),this.scene.addMesh(this.gs))),(this.getMap().isZooming()||this.gs&&this.gs.length)&&(this.xs(),this.bs(this.scene.getMeshes()))}paint(t){const e=super.paint(t);return this.ws(t),!1===this.Cr&&this.setToRedraw(),e}shouldIgnoreBackground(){return!this.getMap().isZooming()&&!this.gs}ys(){const t=this.getMap(),e=t.isZooming();if(!e&&this.Xr){const t=this.layer.getRenderer();this.gs=this.scene.getMeshes().filter((e=>!t.isForeground(e)&&!e.properties.isLinePlacement))}else e&&!this.Xr&&(this.As=t.getResolution());if(e)this.Ms&&(clearTimeout(this.Ms),delete this.Jr,delete this.Ms),this.Jr=this.As&&t.getResolution()>this.As;else if(this.Xr&&!this.Ms){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;BB(t)&&(t=Lj),BB(e)&&(e=kj),this.Ms=setTimeout((()=>{delete this.Jr,delete this.Ms}),t+e+1)}this.Xr=e}ws(t){if(!this.ps||!this.layer.options.debugCollision)return;this.cs||this._s();const{aPosition:e,aVisible:n,indices:i}=this.ps;if(!this.hs){const t=new Jv({aPosition:[],aVisible:[]},[],0,{positionSize:2,primitive:"lines"});this.hs=new z_(t),this.Ss=new Y_,this.Ss.addMesh(this.hs)}const r=this.hs.geometry;r.updateData("aPosition",new Float32Array(e)),r.updateData("aVisible",new Uint8Array(n)),r.setElements(i),this.cs.render(this.us,{size:[this.canvas.width,this.canvas.height]},this.Ss,this.getRenderFBO(t)),delete this.ps}_s(){this.cs=new j_(this.regl);const t=this.canvas;this.us=new mx({vert:"attribute vec2 aPosition;\nattribute float aVisible;\nuniform vec2 size;\nvarying vec4 vColor;\nvoid main() {\n  vec2 c = (aPosition / size - .5) * 2. * vec2(1., -1.);\n  gl_Position = vec4(c, .0, 1.);\n  vColor = mix(vec4(1., .0, .0, 1.5) * .5, vec4(.0, 1., .0, 1.) * .4, aVisible);\n}",frag:"precision mediump float;\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vec4(vColor.rgb, .5);\n}",uniforms:["size"],extraCommandProps:{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},depth:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}})}vs(){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;BB(t)&&(t=Lj),BB(e)&&(e=kj);const n=this.layer.getRenderer(),i=n.getCurrentTileZoom(),r=n.getFrameTimestamp(),o=[];for(let s=0;s<this.gs.length;s++){const a=this.gs[s],h=a.properties.tile;!a.Kr&&n.isBackTile(h.id)&&(a.Kr=r),a.properties.level=h.z-i>0?2*(h.z-i)-1:2*(i-h.z),n.isForeground(a)||a.Kr&&r-a.Kr>t+e?delete a.Kr:o.push(a)}delete this.gs,o.length&&(this.gs=o)}isEnableCollision(){return this.layer.options.collision&&!!this.sceneConfig.collision}isEnableUniquePlacement(){return this.isEnableCollision()&&this.sceneConfig.uniquePlacement}isMeshUniquePlaced(t){return this.isMeshIterable(t)}xs(){if(!this.isEnableUniquePlacement())return;const t=this.scene.getMeshes(),e=(t,e,n,i)=>{const{start:r,end:o}=e[0],s=t.geometry.properties,a=s.elements;let h=s.uniquePlacements;if(h||(h=s.uniquePlacements=[]),void 0===h[i]){const e=this.getUniqueEntryKey(t,a[r],i);h[i]=e?{key:e,index:i,start:a[r],end:a[o-1]}:null}};for(let n=0;n<t.length;n++){const i=t[n];this.isMeshUniquePlaced(i)&&this.forEachBox(i,e)}}bs(t){if(!this.isEnableUniquePlacement())return;const e=this.getMap().getZoom();let n=!this.ks||this.Ps!==e;if(!n)for(let o=0;o<t.length;o++)if(!this.ks[t[o].properties.meshKey]){n=!0;break}if(!n)return;this.Ps=e,this.Ts={},this.ks={},t=t.sort(Vj);const i=this.getMap().getGLScale(),r={};for(let o=0;o<t.length;o++){const e=t[o];if(!e.geometry)continue;const{meshKey:n}=e.properties;this.ks[n]=1;const{uniquePlacements:s}=e.geometry.properties;if(s)for(let t=0;t<s.length;t++){if(!s[t])continue;const{key:n,index:o}=s[t],a=this.qr(e),h=Gj(n,i),l=r[h];if(l){const t=l.length,n=l[t-3].properties.meshKey,i=l[t-2],r=l[t-1];this.Ts[n]=this.Ts[n]||{},this.Ts[n][r]=1,this.Is(a,o,i,r),l.push(e,a,o)}else r[h]=[e,a,o]}}for(const o in r){const t=r[o];if(t.length<=6)continue;const e=t.length,n=t[e-2][t[e-1]];if(t[1][t[2]]!==n)for(let i=0;i<e-6;i+=3)t[i+1][t[i+2]]=n}}Is(t,e,n,i){if(void 0!==n[i])if(void 0===t[e])t[e]=n[i];else{let r=t[e];Math.abs(n[i])>Math.abs(r)?t[e]=n[i]:n[i]=t[e]}else void 0!==t[e]&&(n[i]=t[e])}Wr(t,e){return this.Ts&&this.Ts[t]&&this.Ts[t][e]}Fs(t,e){const{symbolIndex:n}=t.properties,i=n.type||0;let r=t.properties._collidesBoxes;r||(r=t.properties._collidesBoxes=[]);let o=r[n.index];o||(o=t.properties._collidesBoxes=[]),o[i]||(o[i]=[]),o=o[i];const s=e/6;if(!o[s]){const t=[];o[s]={boxes:t,collision:{boxes:t}}}return o[s]}Cs(t){let e=this.Os;if(e||(e=this.Os=[]),!e[t]){e[t]=[];for(let n=0;n<t;n++)e[t][n]={}}return e[t]}Es(t){return!(t&&t.geometry&&(!t.geometry.properties.glyphAtlas||!t.material.get("isHalo")||t.geometry.data.aTextHaloRadius&&t.geometry.properties.hasHalo||(!t.geometry.data.aTextHaloRadius||t.geometry.properties.hasHalo)&&this.getSymbol(t.geometry.properties.symbolIndex).textHaloRadius))}}const Uj=10;function Gj(t,e){return Math.round(t[0]/e/Uj)*Math.round(t[1]/e/Uj)*(t[2]?Math.round(t[2]/Uj):1)+"-"+t[3]}function Vj(t,e){const n=e.properties.level-t.properties.level;return 0===n?t.properties.meshKey-e.properties.meshKey:n}function Wj(t,e,n){return t[0]=e[0]-n,t[1]=e[1]-n,t[2]=e[2]+n,t[3]=e[3]+n,t}var qj="#include <gl2_vert>\n#define SHADER_NAME MARKER\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_MARKER_WIDTH\nattribute float aMarkerWidth;\n#else\nuniform float markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nattribute float aMarkerHeight;\n#else\nuniform float markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nattribute float aMarkerDx;\n#else\nuniform float markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nattribute float aMarkerDy;\n#else\nuniform float markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#ifdef HAS_ROTATION\nattribute float aRotation;\n#else\nuniform float markerRotation;\n#endif\n#ifdef HAS_PAD_OFFSET\nattribute float aPadOffsetX;\nattribute float aPadOffsetY;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float markerPerspectiveRatio;\nuniform vec2 iconSize;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\n#include <vt_position_vert>\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vOpacity;\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_MARKER_WIDTH\nfloat d = aMarkerWidth;\n#else\nfloat d = markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nfloat e = aMarkerHeight;\n#else\nfloat e = markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nfloat f = aMarkerDx;\n#else\nfloat f = markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nfloat h = aMarkerDy;\n#else\nfloat h = markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat i = aPitchAlign;\n#else\nfloat i = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat j = aRotationAlign;\n#else\nfloat j = rotateWithMap;\n#endif\ngl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  float k = gl_Position.w;\n  float l;\n  if(isRenderingTerrain == 1. && i == 1.) {\n    l = 1.;\n  } else {\n    float m = (1. - cameraToCenterDistance / k) * markerPerspectiveRatio;\n    l = clamp(.5 + .5 * (1. - m), .0, 4.);\n  }\n#ifdef HAS_ROTATION\nfloat n = -aRotation / 9362. - mapRotation * j;\n#else\nfloat n = -markerRotation - mapRotation * j;\n#endif\nif(i == 1.) {\n    n += mapRotation;\n  }\n  float o = sin(n);\n  float u = cos(n);\n  mat2 v = mat2(u, -1. * o, o, u);\n  vec2 A = (aShape / 10.0);\n  if(i == 1. && flipY == .0) {\n    A *= vec2(1., -1.);\n  }\n#ifdef HAS_PAD_OFFSET\nA = (A / iconSize * vec2(d, e) + vec2(aPadOffsetX - 1., aPadOffsetY)) * layerScale;\n#else\nA = A / iconSize * vec2(d, e) * layerScale;\n#endif\nA = v * A;\n  if(i == .0) {\n    vec2 B = A * 2. / canvasSize;\n    gl_Position.xy += B * l * k;\n  } else {\n    float C;\n    if(isRenderingTerrain == 1.) {\n      C = 1.;\n    } else {\n      C = k / cameraToCenterDistance;\n    }\n    vec2 B = A;\n    gl_Position = projViewModelMatrix * positionMatrix * vec4(c + vec3(B, .0) * tileRatio / zoomScale * C * l, 1.);\n  }\n  gl_Position.xy += vec2(f, -h) * 2. / canvasSize * k;\n#ifndef PICKING_MODE\nvTexCoord = aTexCoord / texSize;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool D = aOpacity == 255.;\n#else\nbool D = true;\n#endif\nfbo_picking_setData(gl_Position.w, D);\n#endif\n}";const Zj=[],Qj=[],Xj=[],Yj=[],Jj=[],Kj=[];function $j(t,e,n,i,r,o,s,a,h,l,u,c,A,f){const{tileRatio:d,tileResolution:p}=h,g=d/(p/l.getResolution())*(u/l.cameraToCenterDistance)*c;dy(n,n,g),dy(i,i,g),dy(r,r,g),dy(o,o,g),pg(Zj,n[0],n[1],A?n[2]/f:0),pg(Qj,i[0],i[1],A?i[2]/f:0),pg(Xj,r[0],r[1],A?r[2]/f:0),pg(Yj,o[0],o[1],A?o[2]/f:0),gg(Zj,Zj,e),gg(Qj,Qj,e),gg(Xj,Xj,e),gg(Yj,Yj,e),VH(n,Zj,s,l.width,l.height),VH(i,Qj,s,l.width,l.height),VH(r,Xj,s,l.width,l.height),VH(o,Yj,s,l.width,l.height),ly(Jj,Math.min(n[0],i[0],r[0],o[0]),Math.min(n[1],i[1],r[1],o[1])),ly(Kj,Math.max(n[0],i[0],r[0],o[0]),Math.max(n[1],i[1],r[1],o[1])),qg(t,Jj[0]+a[0],Jj[1]+a[1],Kj[0]+a[0],Kj[1]+a[1])}function tU(t,e,n,i,r,o,s,a){1!==a&&(dy(n,n,a),dy(i,i,a),dy(r,r,a),dy(o,o,a)),ly(Jj,Math.min(n[0],i[0],r[0],o[0]),Math.min(n[1],i[1],r[1],o[1])),ly(Kj,Math.max(n[0],i[0],r[0],o[0]),Math.max(n[1],i[1],r[1],o[1])),qg(t,e[0]+Jj[0]+s[0],e[1]+Jj[1]-s[1],e[0]+Kj[0]+s[0],e[1]+Kj[1]-s[1])}function eU(t,e,n,i,r){e-=n*i,1===r&&(e+=n);const o=Math.sin(e),s=Math.cos(e);return mp(t,s,-o,o,s)}const nU=2048,iU=24,rU=.01,oU=[],sU=[],aU=[],hU=[],lU=[],uU=[],cU=[],AU=[],fU=[1,-1],dU=[1,1];function pU(t,e,n,i,r){const o=e.material.uniforms,s=r.cameraToCenterDistance,a=e.geometry.properties,h=this.getSymbol(a.symbolIndex),l=e.geometry.desc.positionSize,u=a.aAnchor,c=pg(oU,u[n*l],u[n*l+1],2===l?0:u[n*l+2]),{aTerrainAltitude:A}=a;if(A){const t=100*A[2*n];t&&(c[2]+=t)}let f=VH(sU,c,i,r.width,r.height);const d=f[2];let p=1;o.markerPerspectiveRatio&&(p=NB(.5+.5*(1-(1-s/d)*o.markerPerspectiveRatio),0,4));const{aShape:g,aMarkerDx:m,aMarkerDy:y,aMarkerWidth:v,aMarkerHeight:_,aPitchAlign:x,aRotationAlign:b,aRotation:w}=a,C=x?x[n]:o.pitchWithMap,P=b?b[n]:o.rotateWithMap,M=ly(AU,(m?m[n]:h.markerDx)||0,-((y?y[n]:h.markerDy)||0));let T=ly(hU,g[2*n]/10,g[2*n+1]/10),S=ly(lU,g[2*n+2]/10,g[2*n+3]/10),I=ly(uU,g[2*n+4]/10,g[2*n+5]/10),E=ly(cU,g[2*n+6]/10,g[2*n+7]/10);0===o.flipY&&1===C&&(Ay(T,T,fU),Ay(S,S,fU),Ay(I,I,fU),Ay(E,E,fU));const[O,R]=yj(e.geometry);let D=v?v[n]:h.markerWidth;BB(D)&&(D=O||15);let k=_?_[n]:h.markerHeight;BB(k)&&(k=R||15);const L=ly(dU,D/nU,k/nU);Py(T,T,L),Py(S,S,L),Py(I,I,L),Py(E,E,L);const F=-(w?w[n]/9362:-(h.markerRotation||0)*Math.PI/180),N=r.getBearing()*Math.PI/180;if(N*P||F){const t=eU(aU,F,N,P,C);T=_y(T,T,t),S=_y(S,S,t),I=_y(I,I,t),E=_y(E,E,t)}1===C?$j(t,c,T,S,I,E,i,M,o,r,d,p):(Ay(T,T,fU),Ay(S,S,fU),Ay(I,I,fU),Ay(E,E,fU),tU(t,f,T,S,I,E,M,p));const z=this.getMap().getDevicePixelRatio();return 1!==z&&(t[0]*=z,t[1]*=z,t[2]*=z,t[3]*=z),t}const gU=1,mU=[],yU=[],vU=[],_U=[],xU=[],bU=[],wU=[1,-1];function CU(t,e,n,i,r,o,s,a,h){const l=i.material.uniforms,u=h.cameraToCenterDistance,c=i.geometry.properties,A=this.getSymbol(c.symbolIndex),f="line"===A.textPlacement&&!QB(A),d=iU,p=n[2];let g=1;l.textPerspectiveRatio&&(g=NB(.5+.5*(1-(1-u/p)*l.textPerspectiveRatio),0,4));const{aTextDx:m,aTextDy:y,aPitchAlign:v,aRotationAlign:_,aRotation:x}=i.geometry.properties,b=v?v[s]:l.pitchWithMap,w=_?_[s]:l.rotateWithMap,C=ly(bU,(m?m[s]:A.textDx)||0,-((y?y[s]:A.textDy)||0));if(f){const{aOffset:i,aShape:r}=c,o=i.length!==r.length;let u,A,f,d;if(o?(u=pg(yU,i[3*s]/10,i[3*s+1]/10,i[3*s+2]/10),A=pg(vU,i[3*s+3]/10,i[3*s+4]/10,i[3*s+5]/10),f=pg(_U,i[3*s+6]/10,i[3*s+7]/10,i[3*s+8]/10),d=pg(xU,i[3*s+9]/10,i[3*s+10]/10,i[3*s+11]/10)):(u=ly(yU,i[2*s]/10,i[2*s+1]/10),A=ly(vU,i[2*s+2]/10,i[2*s+3]/10),f=ly(_U,i[2*s+4]/10,i[2*s+5]/10),d=ly(xU,i[2*s+6]/10,i[2*s+7]/10)),1===b){const n=cB(h.getResolution(),h);$j(t,e,u,A,f,d,a,C,l,h,p,g,o,n)}else Ay(u,u,wU),Ay(A,A,wU),Ay(f,f,wU),Ay(d,d,wU),tU(t,n,u,A,f,d,C,g)}else{const{aShape:i}=c;let o=ly(yU,i[2*s]/10,-i[2*s+1]/10),u=ly(vU,i[2*s+2]/10,-i[2*s+3]/10),m=ly(_U,i[2*s+4]/10,-i[2*s+5]/10),y=ly(xU,i[2*s+6]/10,-i[2*s+7]/10);0===l.flipY&&1===b&&(Ay(o,o,wU),Ay(u,u,wU),Ay(m,m,wU),Ay(y,y,wU));const v=x?x[s]/9362:(A.textRotation||0)*Math.PI/180,_=f?0:h.getBearing()*Math.PI/180;if(v||_){const t=eU(mU,v,_,w,b);o=_y(o,o,t),u=_y(u,u,t),m=_y(m,m,t),y=_y(y,y,t)}const P=r/d;dy(o,o,P),dy(u,u,P),dy(m,m,P),dy(y,y,P),1===b?$j(t,e,o,u,m,y,a,C,l,h,p,g):tU(t,n,o,u,m,y,C,g)}t[0]-=(o=o||0)+gU,t[1]-=o+gU,t[2]+=o+gU,t[3]+=o+gU;const P=this.getMap().getDevicePixelRatio();return 1!==P&&(t[0]*=P,t[1]*=P,t[2]*=P,t[3]*=P),t}function PU(t,e,n){const i=e.geometry.desc.positionSize,{aAnchor:r,aAltitude:o,aTerrainAltitude:s}=e.geometry.properties,a=n*i;if(o?pg(t,r[a],r[a+1],o[n]):3===i?ZD(t,r[a],r[a+1],r[a+2]):pg(t,r[a],r[a+1],0),s){const e=100*s[2*n];e&&(t[2]+=e)}return t}const MU={textFill:[0,0,0,1],textOpacity:1,textPitchAlignment:0,textRotationAlignment:0,textHaloRadius:0,textHaloFill:[1,1,1,1],textHaloBlur:0,textHaloOpacity:1,textPerspectiveRatio:0,textSize:14,textDx:0,textDy:0,textRotation:0};function TU(t,e,n,i,r,o,s,a,h){const l=[];if(e.isDisposed()||0===e.data.aPosition.length)return l;const u=e.properties.glyphAtlas;if(!u)return l;if(0===i.textSize||0===i.textOpacity)return l;if(OH(e,i,o,this.layer),!e.properties.aCount){SU.call(this,e,s||h,a);const{aTextSize:t,aTextDx:n,aTextDy:i,aPitchAlign:r,aRotationAlign:o,aRotation:l,aOverlap:u,aAltitude:c}=e.data;if(t){const n=(IH+"aTextSize").trim();e.properties.aTextSize=e.properties[n]||new t.constructor(t)}if(n){const t=(IH+"aTextDx").trim();e.properties.aTextDx=e.properties[t]||new n.constructor(n)}if(i){const t=(IH+"aTextDy").trim();e.properties.aTextDy=e.properties[t]||new i.constructor(i)}if(r){const t=(IH+"aPitchAlign").trim();e.properties.aPitchAlign=e.properties[t]||new r.constructor(r)}if(o){const t=(IH+"aRotationAlign").trim();e.properties.aRotationAlign=e.properties[t]||new o.constructor(o)}if(l){const t=(IH+"aRotation").trim();e.properties.aRotation=e.properties[t]||new l.constructor(l)}if(u){const t=(IH+"aOverlap").trim();e.properties.aOverlap=e.properties[t]||new u.constructor(u)}if(c){const t=(IH+"aAltitude").trim();e.properties.aAltitude=e.properties[t]||new c.constructor(c)}}const c=pj(t,u,!1),A={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio,texture:c,texSize:[u.width,u.height]};IU(e,A,r);let f=!1;r.textOpacity<1&&(f=!0),e.properties.memorySize=e.getMemorySize(),e.generateBuffers(t,{excludeElementsInVAO:!0});const d=new T_(A,MU),p=new z_(e,d,{disableVAO:!0,transparent:f,castShadow:!1,picking:!0});if(p.setLocalTransform(n),p.setUniform("alphaTest",rU),A.isHalo&&(p.properties.isHalo=!0),s&&p.setDefines({ENABLE_COLLISION:1}),l.push(p),A.isHalo){const t={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio,texture:c,texSize:[u.width,u.height],isHalo:0};IU(e,t,r);const i=new T_(t,MU),o=new z_(e,i,{disableVAO:!0,transparent:f,castShadow:!1,picking:!0});o.setUniform("alphaTest",rU),o.properties.haloMesh=p,Object.defineProperty(o.properties,"textSize",{enumerable:!0,get:function(){return t.textSize}}),s&&o.setDefines({ENABLE_COLLISION:1}),o.setLocalTransform(n),l.push(o)}return l.forEach((t=>{const n=t.defines||{};e.data.aTextFill&&(n.HAS_TEXT_FILL=1),e.data.aTextSize&&(n.HAS_TEXT_SIZE=1),e.data.aColorOpacity&&(n.HAS_OPACITY=1),e.data.aTextHaloFill&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_FILL=1),e.data.aTextHaloRadius&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_RADIUS=1),e.data.aTextHaloOpacity&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_OPACITY=1),e.data.aTextDx&&(n.HAS_TEXT_DX=1),e.data.aTextDy&&(n.HAS_TEXT_DY=1),e.data.aPitchAlign&&(n.HAS_PITCH_ALIGN=1),e.data.aRotationAlign&&(n.HAS_ROTATION_ALIGN=1),e.data.aRotation&&(n.HAS_ROTATION=1),e.data.aAltitude&&(n.HAS_ALTITUDE=1),e.properties.aOffset&&e.properties.aShape&&e.properties.aOffset.length!==e.properties.aShape.length&&(n.HAS_OFFSET_Z=1),t.setDefines(n),t.properties.symbolIndex=e.properties.symbolIndex})),l}function SU(t,e,n){const i=this.getSymbol(t.properties.symbolIndex),r="line"===t.properties.textPlacement&&!QB(i),{aPosition:o,aShape:s}=t.data,a=o.length/t.desc.positionSize;if(t.properties.aPickingId=t.data.aPickingId,t.properties.aCount=t.data.aCount,delete t.data.aCount,(e||r)&&(t.properties.aAnchor=o,t.properties.aShape=s),t.properties.visElemts||(t.properties.elements=t.elements,t.properties.visElemts=new t.elements.constructor(t.elements.length)),r){const{aVertical:e,aSegment:n,aGlyphOffset:i,aPitchRotation:r}=t.data,o=!!r;t.properties.aGlyphOffset=i,t.properties.aPitchRotation=r,t.properties.aSegment=n,t.properties.aVertical=e,delete t.data.aSegment,delete t.data.aVertical,delete t.data.aGlyphOffset,delete t.data.aPitchRotation;const a=s.length/2*(o?3:2);t.data.aOffset={usage:"dynamic",data:new Int16Array(a)},t.properties.aOffset=new Int16Array(a)}if(e){t.data.aOpacity={usage:"dynamic",data:new Uint8Array(a)},t.properties.aOpacity=new Uint8Array(a),n&&(t.properties.aOpacity.fill(255,0),t.data.aOpacity.data.fill(255,0));const{aTextHaloRadius:e}=t.data;if(e&&!t.properties.aTextHaloRadius){const n=(IH+"aTextHaloRadius").trim();t.properties.aTextHaloRadius=t.properties[n]||new e.constructor(e)}}}function IU(t,e,n){void 0===e.isHalo&&(e.isHalo=1),jB(e,"textOpacity",n,"textOpacity",MU.textOpacity),jB(e,"textFill",n,"textFill",MU.textFill,VB()),jB(e,"textHaloFill",n,"textHaloFill",MU.textHaloFill,VB()),jB(e,"textHaloBlur",n,"textHaloBlur",MU.textHaloBlur),jB(e,"textHaloRadius",n,"textHaloRadius",MU.textHaloRadius),jB(e,"textHaloOpacity",n,"textHaloOpacity",MU.textHaloOpacity),jB(e,"textPerspectiveRatio",n,"textPerspectiveRatio",MU.textPerspectiveRatio,(e=>"line"===t.properties.textPlacement?1:e)),jB(e,"rotateWithMap",n,"textRotationAlignment",MU.textRotationAlignment,(t=>+("map"===t))),jB(e,"pitchWithMap",n,"textPitchAlignment",MU.textPitchAlignment,(t=>+("map"===t))),jB(e,"textSize",n,"textSize",MU.textSize),jB(e,"textDx",n,"textDx",MU.textDx),jB(e,"textDy",n,"textDy",MU.textDy),jB(e,"textRotation",n,"textRotation",MU.textRotation,(t=>t*Math.PI/180))}function EU(t,e){const n=[];return{uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp(n,e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!0,mask:255,func:{cmp:"<=",ref:(t,e)=>e.stencilRef,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:e.depthRange||[0,1],func:e.depthFunc||"always",mask:!1},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}}function OU(t,e){const n=EE(e.textFill),i=EE(e.textSize),r=EE(e.textHaloFill),o=EE(e.textHaloRadius),s=EE(e.textHaloOpacity),a=EE(e.textDx),h=EE(e.textDy),l=EE(e.textOpacity),u=OE(e.textPitchAlignment),c=OE(e.textRotationAlignment),A=EE(e.textRotation),f=OE(e.textAllowOverlapFn),d=OE(e.textIgnorePlacement),p={},g=new Int16Array(1),m=new Uint16Array(1);return[{attrName:"aTextFill",symbolName:"textFill",define:"HAS_TEXT_FILL",type:Uint8Array,width:4,evaluate:(e,i)=>{let r=n(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=p[r]=p[r]||bO(r).unitArray()),r=GB(r),r}},{attrName:"aTextSize",symbolName:"textSize",define:"HAS_TEXT_SIZE",type:Uint8Array,width:1,evaluate:(e,n)=>{let r=i(t.getZoom(),e)||MU.textSize;return SE(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),g[0]=r,g[0]}},{attrName:"aTextHaloFill",symbolName:"textHaloFill",define:"HAS_TEXT_HALO_FILL",type:Uint8Array,width:4,evaluate:e=>{let n=r(t.getZoom(),e);return Array.isArray(n)||(n=p[n]=p[n]||bO(n).unitArray()),n=GB(n),n}},{attrName:"aTextHaloRadius",symbolName:"textHaloRadius",define:"HAS_TEXT_HALO_RADIUS",type:Uint8Array,width:1,evaluate:e=>{const n=o(t.getZoom(),e);return g[0]=n,g[0]}},{attrName:"aTextHaloOpacity",symbolName:"textHaloOpacity",define:"HAS_TEXT_HALO_OPACITY",type:Uint8Array,width:1,evaluate:e=>{const n=s(t.getZoom(),e);return g[0]=n,g[0]}},{attrName:"aTextDx",symbolName:"textDx",define:"HAS_TEXT_DX",type:Uint8Array,width:1,evaluate:(e,n)=>{let i=a(t.getZoom(),e);return SE(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),g[0]=i,g[0]}},{attrName:"aTextDy",symbolName:"textDy",define:"HAS_TEXT_DY",type:Uint8Array,width:1,evaluate:(e,n)=>{let i=h(t.getZoom(),e);return SE(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),g[0]=i,g[0]}},{attrName:"aColorOpacity",symbolName:"textOpacity",define:"HAS_OPACITY",type:Uint8Array,width:1,evaluate:(e,n)=>{let i=l(t.getZoom(),e);return SE(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),g[0]=255*i,g[0]}},{attrName:"aPitchAlign",symbolName:"textPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:e=>+("map"===u(t.getZoom(),e))},{attrName:"aRotationAlign",symbolName:"textRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:e=>+("map"===c(t.getZoom(),e))},{attrName:"aRotation",symbolName:"textRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:e=>{const n=zB(A(t.getZoom(),e),0,360)*Math.PI/180;return m[0]=9362*n,m[0]}},{attrName:"aOverlap",symbolName:"textAllowOverlap",type:Uint8Array,width:1,evaluate:n=>{let i=f(t.getZoom(),n)||0,r=(d?d(t.getZoom(),n):e.textIgnorePlacement)||0;return i=1<<3+4*i,r=(d?2:0)+r,i+r}},{attrName:"aOverlap",symbolName:"textIgnorePlacement",type:Uint8Array,width:1,evaluate:n=>{let i=(f?f(t.getZoom(),n):e.textAllowOverlap)||0,r=d(t.getZoom(),n)||0;return i=(f?8:0)+4*i,r=1<<1+r,i+r}}]}const RU=[],DU=[],kU=[],LU=[];function FU(t,e,n,i,r,o,s){t=1===t?1:0;const a=this.getMap(),h=e.geometry.properties,l=this.getSymbol(h.symbolIndex),u="line"===h.textPlacement&&!QB(l),{aTextSize:c,aTextHaloRadius:A,aShape:f}=h;let d=c?c[n[r]]:e.properties.textSize;null==d&&(d=MU.textSize);const p=A?A[n[r]]:e.properties.textHaloRadius,g=PU(kU,e,n[r]),{aProjectedAnchor:m}=e.geometry.properties;let y=LU;const v=3*n[r];m&&m[v]!==MB?(LU[0]=m[v],LU[1]=m[v+1],LU[2]=m[v+2]):y=VH(LU,g,s,a.width,a.height);const _=i,{boxes:x,collision:b}=this.Fs(e,r);let w=0;if(u||1===e.material.uniforms.rotateWithMap||l.textRotation){let i=0;for(let o=r;o<r+6*_;o+=6){const r=x[w]=x[w]||[];w++;const h=CU.call(this,r,g,y,e,d,p,n[o],s,a);if(!t){const e=this.isCollides(h);1===e?t=1:-1===e&&i++}}i===_&&(t=-1)}else{let i=n[r],h=f[2*i+1];for(let l=r;l<o;l+=6){const r=f[2*n[l]+1];if(h!==r||l===o-6){const u=n[l===o-6?l:l-6],c=CU.call(this,RU,g,y,e,d,p,i,s,a),A=CU.call(this,DU,g,y,e,d,p,u,s,a),f=x[w]=x[w]||[];w++,f[0]=Math.min(c[0],A[0]),f[1]=Math.min(c[1],A[1]),f[2]=Math.max(c[2],A[2]),f[3]=Math.max(c[3],A[3]),i=n[l],h=r,!t&&this.isCollides(f)&&(t=1)}}}return b.collides=t,b}function NU(t,e){const n=function(t,e){const{aPickingId:n,features:i}=t.geometry.properties,r=n[e],o=i&&i[r]&&i[r].feature;return o&&o.label}(t,e);return n?function(t,e,n){if(!n)return null;const i=t.localTransform,r=PU(zU,t,e);qg(BU,r[0],r[1],r[2],1);const o=om(BU,BU,i);let s=0;for(const a of n)s+=a.codePointAt(0);return[Math.floor(o[0]),Math.floor(o[1]),Math.floor(o[2]),s]}(t,e,n):null}const zU=[],BU=[];var HU="#define SHADER_NAME TEXT_VERT\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#if defined(HAS_ROTATION)\nattribute float aRotation;\n#else\nuniform float textRotation;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float glyphSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_SIZE\nfloat d = aTextSize * layerScale;\n#else\nfloat d = textSize * layerScale;\n#endif\n#ifdef HAS_TEXT_DX\nfloat e = aTextDx;\n#else\nfloat e = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat f = aTextDy;\n#else\nfloat f = textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat i = aRotationAlign;\n#else\nfloat i = rotateWithMap;\n#endif\nvec2 j = aShape / 10.0;\n  if(h == 1. && flipY == .0) {\n    j = j * vec2(1., -1.);\n  }\n  vec2 k = aTexCoord;\n  gl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  float l = gl_Position.w;\n  float m;\n  if(isRenderingTerrain == 1. && h == 1.) {\n    m = 1.;\n  } else {\n    float n = (1. - cameraToCenterDistance / l) * textPerspectiveRatio;\n    m = clamp(.5 + .5 * (1. - n), .0, 4.);\n  }\n#ifdef HAS_ROTATION\nfloat o = -aRotation / 9362. - mapRotation * i;\n#else\nfloat o = -textRotation - mapRotation * i;\n#endif\nif(h == 1.) {\n    \n#ifdef REVERSE_MAP_ROTATION_ON_PITCH\no += mapRotation;\n#else\no -= mapRotation;\n#endif\n  }\n  float u = sin(o);\n  float v = cos(o);\n  mat2 A = mat2(v, -1. * u, u, v);\n  j = A * (j / glyphSize * d);\n  float B;\n  if(isRenderingTerrain == 1.) {\n    B = 1.;\n  } else {\n    B = l / cameraToCenterDistance;\n  }\n  if(h == .0) {\n    vec2 C = j * 2. / canvasSize;\n    gl_Position.xy += C * m * l;\n  } else {\n    float D;\n    if(isRenderingTerrain == 1.) {\n      D = tileRatio / zoomScale;\n    } else {\n      D = tileRatio / zoomScale * B * m;\n    }\n    vec2 C = j;\n    gl_Position = projViewModelMatrix * positionMatrix * vec4(c + vec3(C, .0) * D, 1.);\n  }\n  gl_Position.xy += vec2(e, -f) * 2. / canvasSize * l;\n#ifndef PICKING_MODE\nif(h == .0) {\n    vGammaScale = mix(1., B, textPerspectiveRatio);\n  } else {\n    vGammaScale = B + mapPitch / 4.;\n  }\n  vTexCoord = k / texSize;\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vSize = d;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool E = aOpacity == 255.;\n#else\nbool E = true;\n#endif\nfbo_picking_setData(gl_Position.w, E);\n#endif\n}",jU="#define SHADER_NAME TEXT_FRAG\n#define HAS_HIGHLIGHT_COLOR_POINT 1\n#define SDF_PX 8.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define EDGE_GAMMA 0.105 / DEVICE_PIXEL_RATIO\nprecision mediump float;\nuniform sampler2D texture;\nuniform float textOpacity;\nuniform highp float gammaScale;\nuniform int isHalo;\nuniform highp float textHaloBlur;\nuniform float alphaTest;\n#ifdef HAS_TEXT_HALO_OPACITY\nvarying float vTextHaloOpacity;\n#else\nuniform float textHaloOpacity;\n#endif\nuniform float layerOpacity;\nvarying vec2 vTexCoord;\nvarying float vSize;\nvarying float vGammaScale;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nvarying vec4 vTextFill;\n#else\nuniform vec4 textFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvarying vec4 vTextHaloFill;\n#else\nuniform vec4 textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvarying float vTextHaloRadius;\n#else\nuniform highp float textHaloRadius;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifdef HAS_TEXT_FILL\nvec4 c = vTextFill;\n#else\nvec4 c = textFill;\n#endif\nfloat d = vSize / 24.;\n  lowp vec4 e = c;\n  highp float f = EDGE_GAMMA / (d * gammaScale);\n  lowp float h = 185. / 256.;\n  if(isHalo == 1) {\n    \n#ifdef HAS_TEXT_HALO_FILL\nvec4 i = vTextHaloFill;\n#else\nvec4 i = textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nfloat j = vTextHaloRadius;\n#else\nfloat j = textHaloRadius;\n#endif\ne = i;\n    f = (textHaloBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (d * gammaScale);\n    h = (6. - j / d) / SDF_PX;\n#ifdef HAS_TEXT_HALO_OPACITY\nfloat k = vTextHaloOpacity / 255.;\n#else\nfloat k = textHaloOpacity;\n#endif\ne *= k * 1.25;\n  }\n  float l = texture2D(texture, vTexCoord).a;\n  highp float m = f * vGammaScale * .7;\n  float n = clamp(smoothstep(h - m, h + m, l), .0, 1.);\n  gl_FragColor = e * (n * textOpacity * vOpacity * layerOpacity);\n  if(gl_FragColor.a < alphaTest) {\n    discard;\n  }\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}";const UU=6,GU=4,VU=new Uint16Array(1),WU=new Int8Array(1);function qU(t,e){const n=EE(e.markerWidth),i=EE(e.markerHeight),r=EE(e.markerDx),o=EE(e.markerDy),s=EE(e.markerOpacity),a=EE(e.markerTextFit),h=OE(e.markerPitchAlignment),l=OE(e.markerRotationAlignment),u=EE(e.markerRotation),c=OE(e.markerAllowOverlapFn),A=OE(e.markerIgnorePlacement),f=new Int16Array(1),d=new Uint16Array(1);return[{attrName:"aMarkerWidth",symbolName:"markerWidth",type:Uint16Array,width:1,define:"HAS_MARKER_WIDTH",evaluate:(i,r,o,s)=>{const h=o[s],l=e.markerTextFit,u=a?a(t.getZoom(),i):l;if("both"===u||"width"===u)return h;let c=n(t.getZoom(),i);return SE(c)&&(c=this.evaluateInFnTypeConfig(c,r,t,i)),f[0]=c,f[0]}},{attrName:"aMarkerHeight",symbolName:"markerHeight",type:Uint16Array,width:1,define:"HAS_MARKER_HEIGHT",evaluate:(n,r,o,s)=>{const h=o[s],l=e.markerTextFit,u=a?a(t.getZoom(),n):l;if("both"===u||"height"===u)return h;let c=i(t.getZoom(),n);return SE(c)&&(c=this.evaluateInFnTypeConfig(c,r,t,n)),f[0]=c,f[0]}},{attrName:"aMarkerDx",symbolName:"markerDx",type:Uint8Array,width:1,define:"HAS_MARKER_DX",evaluate:(e,n)=>{let i=r(t.getZoom(),e);return SE(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),f[0]=i,f[0]}},{attrName:"aMarkerDy",symbolName:"markerDy",type:Uint8Array,width:1,define:"HAS_MARKER_DY",evaluate:(e,n)=>{let i=o(t.getZoom(),e);return SE(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),f[0]=i,f[0]}},{attrName:"aColorOpacity",symbolName:"markerOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let i=s(t.getZoom(),e);return SE(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),f[0]=255*i,f[0]}},{attrName:"aPitchAlign",symbolName:"markerPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:e=>+("map"===h(t.getZoom(),e))},{attrName:"aRotationAlign",symbolName:"markerRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:e=>+("map"===l(t.getZoom(),e))},{attrName:"aRotation",symbolName:"markerRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:e=>{const n=zB(u(t.getZoom(),e),0,360)*Math.PI/180;return d[0]=9362*n,d[0]}},{attrName:"aOverlap",symbolName:"markerAllowOverlap",type:Uint8Array,width:1,evaluate:n=>{let i=c(t.getZoom(),n)||0,r=(A?A(t.getZoom(),n):e.markerIgnorePlacement)||0;return i=1<<3+4*i,r=(A?2:0)+r,i+r}},{attrName:"aOverlap",symbolName:"markerIgnorePlacement",type:Uint8Array,width:1,evaluate:n=>{let i=(c?c(t.getZoom(),n):e.markerAllowOverlap)||0,r=A(t.getZoom(),n)||0;return i=(c?8:0)+4*i,r=2+r,i+r}}]}function ZU(t,e,n,i){if(!n||!i||"none"===i)return;const r=function(t,e,n){let i=t.properties.textFitFn;SE(n)&&(i=t.properties.textFitFn=OE(n));const r="none"!==n,o=[],s=t.getElements(),a=t.data.aPickingId;let h,l,u;e&&(h=e.getElements(),l=e.data.aPickingId,u=e.data.aCount);const c=t.properties.features;let A;if(e){let t=h[0];A={pickingId:l[t],start:0,end:u[t]*UU}}let f=!1,d=!1,p=0;const g=new Set;for(let m=0;m<s.length;m+=UU){const t=a[s[m]];if(!f&&A)for(;A.pickingId<t&&A.end<h.length;){const t=A.end,e=h[t];A.start=t,A.end=t+u[e]*UU,A.pickingId=l[e]}if(!f&&A&&A.pickingId<t&&(f=!0,!r)){if(!d)return[];for(let t=m;t<s.length;t+=UU)o[p++]=[-1,-1];return o}const e=c[t]&&c[t].feature,y=i?i(null,e&&e.properties||{}):n;if(A&&t===A.pickingId){o[p++]=[A.start,A.end];const t=A.end,e=h[t];A.start=t,A.end=t+u[e]*UU,A.pickingId=l[e],d=!0}else if(y&&"none"!==y)for(let n=m;n<m+UU;n++)g.add(n);else o[p++]=[-1,-1]}if(g.size)if(g.size===s.length)t.setElements([]);else{const e=[];for(let t=0;t<s.length;t++)g.has(t)||e.push(s[t]);t.setElements(new s.constructor(e))}return d?o:[]}(e,n,i);if(e.getElements().length&&r.length&&(e.properties.labelIndex=r,r.length&&i&&"none"!==i&&n)){const i=function(t,e){const n=[],i=t.properties.labelIndex,{aShape:r}=e.data;let o=!1;for(let s=0;s<i.length;s++){const[t,a]=i[s];if(-1===t)n.push(0,0,0,0);else{o=!0;let i=1/0,s=1/0,h=-1/0,l=-1/0;const u=e.elements;for(let e=t;e<a;e++){const t=u[e],n=r[2*t],o=r[2*t+1];n<i&&(i=n),n>h&&(h=n),o<s&&(s=o),o>l&&(l=o)}n.push(i,s,h,l)}}return o?n:[]}(e,n);i.length&&(e.properties.labelShape=i,QU.call(this,t,e,n))}}function QU(t,e){const n=this.getSymbolDef(e.properties.symbolIndex),i=n.markerTextFit,r=e.properties;let o="both"===i||"width"===i,s="both"===i||"height"===i;if(SE(n.markerTextFit)){let t=e.properties.textFitFn;t||(t=e.properties.textFitFn=EE(n.markerTextFit));const{features:i}=e.properties,a=e.properties.elements||e.elements,{aPickingId:h}=e.data,l=[],u=[];let c=!0;for(let e=0;e<a.length;e+=UU){const n=i[h[a[e]]],r=(n&&n.feature||{}).properties||{};let o=t(null,r);SE(o)&&(o=(r.textFitFn=r.textFitFn||EE(o))(null,r)),"both"===o?(l.push(e/UU),u.push(e/UU)):"width"===o?(c=!1,l.push(e/UU)):"height"===o&&(c=!1,u.push(e/UU))}c?(r.fitIcons=l,o=!0,s=!0):(l.length&&(r.fitWidthIcons=l,o=!0),u.length&&(r.fitHeightIcons=u,s=!0))}r.aPickingId||(r.aPickingId=new e.data.aPickingId.constructor(e.data.aPickingId));const{aMarkerWidth:a,aMarkerHeight:h,aPickingId:l}=r,u=l.length;if(o)if(a){const t=e.data.aMarkerWidth;e.data.aMarkerWidth=new Uint16Array(t),r.aMarkerWidth=new Uint16Array(t);const n=(IH+"aMarkerWidth").trim();r[n]&&(r[n]=r.aMarkerWidth)}else{const t=this.getSymbol(e.properties.symbolIndex).markerWidth||0;r.aMarkerWidth=new Uint16Array(u),r.aMarkerWidth.fill(t),t&&(r.aMarkerWidth.dirty=!0),e.data.aMarkerWidth=new Uint16Array(u)}if(s)if(h){const t=e.data.aMarkerHeight;e.data.aMarkerHeight=new Uint16Array(t),r.aMarkerHeight=new Uint16Array(t);const n=(IH+"aMarkerHeight").trim();r[n]&&(r[n]=r.aMarkerHeight)}else{const t=this.getSymbol(e.properties.symbolIndex).markerHeight||0;r.aMarkerHeight=new Uint16Array(u),r.aMarkerHeight.fill(t),t&&(r.aMarkerHeight.dirty=!0),e.data.aMarkerHeight=new Uint16Array(u)}const c=this.getSymbolDef(e.properties.textGeo.properties.symbolIndex),A=EE(c.textSize);YU.call(this,t,e),(!SE(c.textSize)||A.isZoomConstant&&A.isFeatureConstant)&&(r.isFitConstant=!0)}const XU=[0,0,0,0];function YU(t,e){const n=e.properties.textGeo;if(!n)return;const i=n.properties,r=e.properties;if(r.isFitConstant||!r.labelShape||!r.labelShape.length)return;const o=this.getSymbolDef(e.properties.symbolIndex),s=this.getSymbolDef(n.properties.symbolIndex).textSize;let a;SE(s)&&(a=i.Ds?i.Ds:i.Ds=EE(s));const h=o.markerTextFitPadding||XU;let l;SE(h)&&(l=r.Ls?r.Ls:r.Ls=OE(h));const u=t.getZoom(),{fitIcons:c,fitWidthIcons:A,fitHeightIcons:f}=r,{aMarkerWidth:d,aMarkerHeight:p,labelShape:g}=r,m=r.elements||e.elements,{features:y,aPickingId:v}=r,_=(t,e,n,i)=>{const o=g[4*e],c=g[4*e+1],A=g[4*e+2],f=g[4*e+3];if(!(o||c||A||f))return;const m=v[t],_=y[m]&&y[m].feature,x=_&&_.properties||{};let b=a?a(u,x):s;SE(b)&&(b=(x.textSizeFn=x.textSizeFn||EE(b))(u,x)),b/=iU;let w,C,P=l&&l(u,x)||h;if(SE(P)&&(P=(x.fitPaddingFn=x.fitPaddingFn||OE(P))(u,x)),P=P||XU,P[0]===P[2]&&P[1]===P[3]||(w=r.aPadOffsetX,C=r.aPadOffsetY,w||(w=r.aPadOffsetX=new Int8Array(d.length),C=r.aPadOffsetY=new Int8Array(d.length))),d&&n){const e=Math.abs((A-o)/10*b)+(P[1]+P[3]||0);if(VU[0]=e,d[t]!==VU[0]&&(qB(d,VU[0],t,t+GU),d.dirty=!0),w){const e=(P[1]+P[3])/2-P[3];WU[0]=e,w[t]!==WU[0]&&(qB(w,e,t,t+GU),w.dirty=!0)}}if(p&&i){const e=Math.abs((f-c)/10*b)+(P[0]+P[2]||0);if(VU[0]=e,p[t]!==VU[0]&&(qB(p,VU[0],t,t+GU),p.dirty=!0),C){const e=P[0]-(P[0]+P[2])/2;WU[0]=e,C[t]!==WU[0]&&(qB(C,e,t,t+GU),C.dirty=!0)}}};if(c||A||f){if(c)for(let w=0;w<c.length;w++){const t=c[w];_(m[t*UU],t,!0,!0)}else if(A||f){if(A)for(let t=0;t<A.length;t++){const e=A[t];_(m[e*UU],e,!0,!1)}if(f)for(let t=0;t<f.length;t++){const e=f[t];_(m[e*UU],e,!1,!0)}}}else for(let w=0;w<m.length;w+=UU)_(m[w],w/UU,!0,!0);const{aPadOffsetX:x,aPadOffsetY:b}=r;x&&(e.data.aPadOffsetX=x,e.data.aPadOffsetY=b)}const JU=function(t){const e=this.layer.getRenderer();return!this.Es(t)&&e.isForeground(t)&&!!t.geometry.properties.iconAtlas&&!t.geometry.properties.isEmpty},KU=function(t){const e=this.layer.getRenderer();return!(this.Es(t)||e.isForeground(t)||!t.geometry.properties.iconAtlas||t.geometry.properties.isEmpty)},$U=function(t){const e=this.layer.getRenderer();return!this.Es(t)&&e.isForeground(t)&&!!t.geometry.properties.glyphAtlas},tG=function(t){const e=this.layer.getRenderer();return!this.Es(t)&&!e.isForeground(t)&&!!t.geometry.properties.glyphAtlas},eG=[],nG={collides:-1},iG=[nU,nU],rG=Np([]),oG=[];let sG=class extends jj{static getBloomSymbol(){return["markerBloom","textBloom"]}constructor(t,e,n,i,r,o){super(t,e,n,i,r,o),this.propAllowOverlap="markerAllowOverlap",this.propIgnorePlacement="markerIgnorePlacement",this.nr={},this.isLabelCollides=FU.bind(this),this.Rs=JU.bind(this),this.Hs=KU.bind(this),this.zs=$U.bind(this),this.Ns=tG.bind(this),this.Vs=[]}needToRefreshTerrainTileOnZooming(){for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t].markerPitchAlignment;if("map"===e||SE(e)||qF(e))return!0}return!1}isTerrainVector(){return this.layer.options.awareOfTerrain&&!this.needToRefreshTerrainTileOnZooming()}isTerrainSkin(){return super.isTerrainSkin()&&this.needToRefreshTerrainTileOnZooming()}setTextShaderDefines(t){this.Us=t}createFnTypeConfig(t,e){return{icon:qU.call(this,t,e),text:OU.call(this,t,e)}}startFrame(...t){return this.Vs.length=0,super.startFrame(...t)}createGeometry(t,e){return t&&t.empty&&(t.data={aPosition:new Uint8Array(t.data.aPosition),aPickingId:t.data.aPickingId}),super.createGeometry(t,e)}postCreateGeometry(t,e){const{geometry:n,symbolIndex:i}=t,r=this.getSymbolDef(i),o=this.getFnTypeConfig(i);if(this.js(n))n.properties.iconAtlas?this.drawDebugAtlas(n.properties.iconAtlas):n.properties.isEmpty=!0,s=n,a=r,h=o.icon,l=this.layer,OH(s,a,h,l),function(t){const{aMarkerWidth:e,aMarkerHeight:n,aMarkerDx:i,aMarkerDy:r,aPitchAlign:o,aRotationAlign:s,aRotation:a,aOverlap:h}=t.data;if(e){const n=(IH+"aMarkerWidth").trim();t.properties.aMarkerWidth=t.properties[n]||new e.constructor(e)}if(n){const e=(IH+"aMarkerHeight").trim();t.properties.aMarkerHeight=t.properties[e]||new n.constructor(n)}if(i){const e=(IH+"aMarkerDx").trim();t.properties.aMarkerDx=t.properties[e]||new i.constructor(i)}if(r){const e=(IH+"aMarkerDy").trim();t.properties.aMarkerDy=t.properties[e]||new r.constructor(r)}if(o){const e=(IH+"aPitchAlign").trim();t.properties.aPitchAlign=t.properties[e]||new o.constructor(o)}if(s){const e=(IH+"aRotationAlign").trim();t.properties.aRotationAlign=t.properties[e]||new s.constructor(s)}if(a){const e=(IH+"aRotation").trim();t.properties.aRotation=t.properties[e]||new a.constructor(a)}if(h){const e=(IH+"aOverlap").trim();t.properties.aOverlap=t.properties[e]||new h.constructor(h)}}(s);else if(this.Gs(n)&&QB(r)){const t=e[e.length-1];if(t){const{geometry:e,symbolIndex:o}=t;if(e&&o.index===i.index){const t=this.getMap(),i=r.markerTextFit;e.properties.textGeo=n,ZU.call(this,t,e,n,i)}}}var s,a,h,l}prepareCollideIndex(t){const{collideIds:e,elements:n,aCount:i}=t.properties;if(!e)return;const r=e,o={};if(!n)return void(t.properties.collideBoxIndex=o);let s=0,a=n[0],h=0,l=r[a],u=1;i&&(u=i[n[h]]);for(let c=0;c<=n.length;c+=UU)a=n[c],r[a]===l&&c!==n.length||(o[l]=[h,c,(c-h)/(u*UU),s++],l=r[a],h=c,i&&(u=i[n[h]]));t.properties.collideBoxIndex=o}createMesh(t,e,n,i){const r=this.isEnableCollision(),o=this.layer,{geometry:s,symbolIndex:a}=t;s.properties.symbolIndex=a;const h=this.getSymbolDef(a),l=this.getSymbol(a),u=this.getFnTypeConfig(a),c=[];if(this.js(s)){const t=function(t,e,n,i,r,o,s,a){if(e.isDisposed()||0===e.data.aPosition.length)return null;const h=e.properties.iconAtlas;if(!h&&!e.properties.isEmpty)return null;const l={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio};if(!e.properties.aShape){const{aPosition:t,aShape:n}=e.data,i=e.data.aPosition.length/e.desc.positionSize,r=new Uint8Array(i);a&&r.fill(255,0),e.data.aOpacity={usage:"dynamic",data:r},e.properties.aOpacity=new Uint8Array(i),a&&e.properties.aOpacity.fill(255,0),e.properties.aAnchor=t,e.properties.aShape=n}e.properties.visElemts||(e.properties.elements=e.elements,e.properties.visElemts=new e.elements.constructor(e.elements.length));const[u,c]=yj(e);jB(l,"markerOpacity",r,"markerOpacity",1),jB(l,"markerPerspectiveRatio",r,"markerPerspectiveRatio",r.markerTextFit?0:1),jB(l,"markerWidth",r,"markerWidth",u||15),jB(l,"markerHeight",r,"markerHeight",c||15),jB(l,"markerDx",r,"markerDx",0),jB(l,"markerDy",r,"markerDy",0),jB(l,"markerRotation",r,"markerRotation",0,(t=>t*Math.PI/180)),jB(l,"pitchWithMap",r,"markerPitchAlignment",0,(t=>"map"===t?1:0)),jB(l,"rotateWithMap",r,"markerRotationAlignment",0,(t=>"map"===t?1:0)),l.iconTex=h?pj(t,h,!1):null,l.texSize=h?[h.width,h.height]:[0,0],e.generateBuffers(t,{excludeElementsInVAO:!0});const A=new T_(l),f=new z_(e,A,{disableVAO:!0,transparent:!0,castShadow:!1,picking:!0}),d={};return s&&(d.ENABLE_COLLISION=1),e.data.aMarkerWidth&&(d.HAS_MARKER_WIDTH=1),e.data.aMarkerHeight&&(d.HAS_MARKER_HEIGHT=1),e.data.aColorOpacity&&(d.HAS_OPACITY=1),e.data.aMarkerDx&&(d.HAS_MARKER_DX=1),e.data.aMarkerDy&&(d.HAS_MARKER_DY=1),e.data.aPitchAlign&&(d.HAS_PITCH_ALIGN=1),e.data.aRotationAlign&&(d.HAS_ROTATION_ALIGN=1),e.data.aRotation&&(d.HAS_ROTATION=1),e.data.aPadOffsetX&&(d.HAS_PAD_OFFSET=1),e.data.aAltitude&&(d.HAS_ALTITUDE=1),f.setDefines(d),f.setUniform("alphaTest",rU),f.setLocalTransform(n),f.properties.symbolIndex=e.properties.symbolIndex,f}(this.regl,s,e,0,l,0,o.options.collision,!r,this.isEnableUniquePlacement());t&&(t.positionMatrix=this.getAltitudeOffsetMatrix(),delete t.geometry.properties.glyphAtlas,c.push(t))}else if(this.Gs(s)){const t=TU.call(this,this.regl,s,e,h,l,u.text,o.options.collision,!r,this.isEnableUniquePlacement());t.length&&(t.forEach((t=>{t.positionMatrix=this.getAltitudeOffsetMatrix(),delete t.geometry.properties.iconAtlas})),c.push(...t))}return"line"===s.properties.markerPlacement&&this.Bs(s,i),"line"===s.properties.markerPlacement&&c.forEach((t=>t.properties.isLinePlacement=!0)),this.prepareCollideIndex(s),c}Bs(t,e){const n=this.layer instanceof lA,{collideIds:i}=t.properties,r=new Uint16Array(i.length);if(this.js(t)){let o=0;for(let t=0;t<i.length;t+=GU)r.fill(o++,t,t+GU);t.properties.collideIds=r,t.properties.uniqueCollideIds=YB(r,!n),e.markerCollideMap={old:i,new:r}}else if(this.Gs(t)){const{collideIds:i,aCount:r}=t.properties;if(!r)return;if(e.markerCollideMap){const{markerCollideMap:o}=e;let s=o.new[o.new.length-1],a=0,h=i[0],l=e.markerCollideMap.old.indexOf(h),u=r[0];for(let t=0;t<i.length;){const n=i[t];h!==n&&(h=n,l=e.markerCollideMap.old.indexOf(h),a=0);const o=-1===l?++s:e.markerCollideMap.new[l+a*GU],c=t+u*GU;i.fill(o,t,c),t+=u*GU,a++,c<i.length&&(u=r[c])}t.properties.uniqueCollideIds=YB(i,!n)}else{let e=0,o=r[0];for(let t=0;t<i.length;){const n=t+o*GU;i.fill(e++,t,n),t+=o*GU,n<i.length&&(o=r[n])}t.properties.uniqueCollideIds=YB(i,!n)}}}addMesh(t){if(this.isEnableCollision()&&t.length>0){const e=new Dj(t);e.properties.uniqueCollideIds=t[0].geometry.properties.uniqueCollideIds,e.properties.meshKey=t[0].properties.meshKey,e.properties.level=t[0].properties.level,this.Vs.push(e)}for(let n=0;n<t.length;n++){if(!this.isMeshIterable(t[n]))continue;const e=t[n].geometry,{symbolIndex:i}=e.properties;QB(this.getSymbolDef(i))&&YU.call(this,this.getMap(),e)}const e=this.getMap().getZoom();for(let n=0;n<t.length;n++){if(!this.isMeshIterable(t[n]))continue;const i=t[n].geometry,{symbolIndex:r}=i.properties,o=this.getSymbolDef(r),s=this.getFnTypeConfig(r);LH(this.regl,this.layer,o,0===r.type?s.icon:s.text,t[n],e);const{aMarkerWidth:a,aMarkerHeight:h,aPadOffsetX:l,aPadOffsetY:u}=i.properties;a&&a.dirty&&(i.updateData("aMarkerWidth",a),a.dirty=!1),h&&h.dirty&&(i.updateData("aMarkerHeight",h),h.dirty=!1),l&&l.dirty&&(i.updateData("aPadOffsetX",l),l.dirty=!1),u&&u.dirty&&(i.updateData("aPadOffsetY",u),u.dirty=!1)}super.addMesh(...arguments)}updateCollision(t){if(!this.isEnableCollision())return;super.updateCollision(t);const e=this.scene.getMeshes();e&&e.length?(this.$s(t.timestamp),this.Vs=[],this.Gr()):this.Gr()}callCurrentTileShader(t,e){this.shader.filter=e.sceneFilter?[this.Rs,e.sceneFilter]:this.Rs,this.callRenderer(this.shader,t,e),this.Ws.filter=e.sceneFilter?[this.zs,e.sceneFilter]:this.zs,this.callRenderer(this.Ws,t,e)}callBackgroundTileShader(t,e){this.shader.filter=e.sceneFilter?[this.Hs,e.sceneFilter]:this.Hs,this.callRenderer(this.shader,t,e),this.Ws.filter=e.sceneFilter?[this.Ns,e.sceneFilter]:this.Ns,this.callRenderer(this.Ws,t,e)}isMeshIterable(t){return t&&t.geometry&&!t.geometry.properties.isEmpty&&t.material&&!t.material.get("isHalo")&&this.isMeshVisible(t)&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(t))}$s(){if(!this.isEnableCollision())return;let t=this.Vs;t&&t.length&&this.Xs(t)}Ys(t,e,n,i){return this.updateBoxCollisionFading(!0,t,e,n,i)}isEnableUniquePlacement(){return this.isEnableCollision()&&!0===this.sceneConfig.uniquePlacement}Xs(t){const e=this.layer.getRenderer();t=t.sort(aG);for(let n=0;n<t.length;n++){const i=t[n];if(!i||!i.meshes.length)continue;let r=!1;if(1===i.meshes.length)r=this.isMeshIterable(i.meshes[0]);else for(let t=0;t<i.meshes.length;t++)if(this.isMeshIterable(i.meshes[t])){r=!0;break}if(!r)continue;const o=e.isForeground(i.meshes[0]);if(this.shouldIgnoreBackground()&&!o)continue;const s=i.properties.meshKey;this.startMeshCollision(i),this.qs(i),this.forEachBox(i,this.Ys),this.Js(i),this.endMeshCollision(s);for(let t=0;t<i.meshes.length;t++)this.Ks(i.meshes[t])}}Ks(t){const e=t&&t.geometry&&t.geometry.properties.aOpacity;e&&e.dirty&&(t.geometry.updateData("aOpacity",e),e.dirty=!1)}forEachBox(t,e){const n=t.properties.uniqueCollideIds;if(!n)return;const i={boxIndex:0},r=n.length;for(let o=0;o<r;o++)this.Zs(t,n[o],e,i)}Zs(t,e,n,i){const r=this.getMap(),{collideBoxIndex:o}=t.meshes[0].geometry.properties;if(!o||!o[e])return!1;const s=Hp(eG,r.projViewMatrix,t.meshes[0].localTransform);let a,h=!1;const l=t.meshes;let u=0;for(let A=0;A<l.length;A++){if(!this.isMeshIterable(l[A]))continue;const{collideBoxIndex:t}=l[A].geometry.properties;t[e]&&u++}if(!u)return!1;a=this.Cs(u);let c=0;for(let A=0;A<l.length;A++){if(!this.isMeshIterable(l[A]))continue;h=!0;const t=l[A].geometry.properties,{elements:n,aCount:i,collideBoxIndex:r}=t,o=r[e];if(!o)continue;const[s,u,f]=o;let d=1;i&&(d=i[n[s]]);const p=s+0*d*UU;a[c].mesh=l[A],a[c].start=p,a[c].end=u,a[c].boxCount=t.glyphAtlas?d:f,a[c].allElements=n,c++}return!!h&&(n.call(this,t,a,s,i.boxIndex++)&&this.Qs(t,e),!0)}qs(t){const e=t.meshes;for(let n=0;n<e.length;n++){const t=e[n],i=t&&t.geometry;i&&(i.properties.visElemts.count=0)}}Qs(t,e){const n=t.meshes;for(let i=0;i<n.length;i++){const t=n[i];if(t.properties.isHalo)continue;const r=t&&t.geometry;if(!r||r.properties.isEmpty)continue;const{collideBoxIndex:o,elements:s,visElemts:a}=r.properties,h=o[e];if(!h)continue;const[l,u]=h;let c=a.count;for(let e=l;e<u;e++)a[c++]=s[e];a.count=c}}Js(t){const e=t.meshes;for(let n=0;n<e.length;n++){const t=e[n],i=t&&t.geometry;if(!i)continue;const{visElemts:r}=i.properties;i.setElements(r,r.count)}}isBoxCollides(t,e,n,i,r,o){if(this.Gs(t.geometry))return FU.call(this,0,t,e,n,i,r,o);if(t.geometry.properties.isEmpty)return nG;const{aTerrainAltitude:s}=t.geometry.properties;if(s&&s[2*e[i]]===TB)return nG;const a=this.getMap(),{boxes:h,collision:l}=this.Fs(t,i);let u=0,c=0,A=0;for(let f=i;f<r;f+=UU){const n=h[A]=h[A]||[];A++;const i=pU.call(this,n,t,e[f],o,a);if(!u){const t=this.isCollides(i);1===t?u=1:-1===t&&c++}}return c===n&&(u=-1),l.collides=u,l}deleteMesh(t,e){t&&(t instanceof Dj&&(t=t.meshes),e&&(Array.isArray(t)?t.forEach((t=>{t&&t.material&&delete t.material.uniforms.iconTex})):t.material&&delete t.material.uniforms.iconTex),super.deleteMesh(t,e))}isBloom(t){const e=t&&t.material&&!BB(t.material.get("markerOpacity")),n=this.getSymbol(t.properties.symbolIndex);return!!(e?n.markerBloom:n.textBloom)}isUniqueStencilRefPerTile(){return!1}init(){const t=this.canvas;this.renderer=new j_(this.regl);const e={viewport:{x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(e,n)=>n.viewport?n.viewport.width:t?t.width:1,height:(e,n)=>n.viewport?n.viewport.height:t?t.height:1},stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.stencilRef},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},depth:{enable:!0,range:()=>this.sceneConfig.depthRange||[0,1],func:()=>this.sceneConfig.depthFunc||"always",mask:!!BB(this.sceneConfig.depthMask)||this.sceneConfig.depthMask},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};this.shader=new mx({vert:qj,frag:"#define SHADER_NAME MARKER\n#define HAS_HIGHLIGHT_COLOR_POINT 1\nprecision mediump float;\n#include <gl2_frag>\nuniform float alphaTest;\nuniform sampler2D iconTex;\nuniform lowp float markerOpacity;\nuniform lowp float blendSrcIsOne;\nuniform float layerOpacity;\n#include <highlight_frag>\nvarying vec2 vTexCoord;\nvarying float vOpacity;\nvoid main() {\n  vec4 c = texture2D(iconTex, vTexCoord) * markerOpacity * vOpacity * layerOpacity;\n  if(c.a < .05) {\n    discard;\n  }\n  glFragColor = c;\n  glFragColor = highlight_blendColor(glFragColor);\n  if(glFragColor.a < alphaTest) {\n    discard;\n  }\n  glFragColor = highlight_blendColor(glFragColor);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:e}),this.shader.version=300;const{uniforms:n,extraCommandProps:i}=EU.call(this,t,this.sceneConfig);if(this.Ws=new mx({vert:HU,frag:jU,uniforms:n,extraCommandProps:i,defines:this.Us||{}}),this.pickingFBO){const t=new cw(this.renderer,{vert:"#define PICKING_MODE 1\n"+qj,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:e},this.pickingFBO,this.getMap());t.filter=t=>!!t.geometry.properties.iconAtlas;const r=new cw(this.renderer,{vert:"#define PICKING_MODE 1\n"+HU,uniforms:n,extraCommandProps:i},this.pickingFBO,this.getMap());r.filter=t=>!!t.geometry.properties.glyphAtlas,this.picking=[t,r]}}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i=this.layer.getTileSize().width,r=n?rG:t.projViewMatrix,o=t.cameraToCenterDistance,s=ly(oG,t.width,t.height);n&&ly(s,i,i);const a=this.getBlendFunc(),h=gi.isFunction(a.src)?a.src():a.src;return{layerScale:this.layer.options.styleScale||1,mapPitch:t.getPitch()*Math.PI/180,mapRotation:t.getBearing()*Math.PI/180,projViewMatrix:r,cameraToCenterDistance:o,canvasSize:s,iconSize:iG,resolution:t.getResolution(),glyphSize:iU,gammaScale:1,blendSrcIsOne:+!("one"!==h&&1!==h),viewport:n&&e&&e.viewport,isRenderingTerrain:+!!n}}getUniqueEntryKey(t,e){if(!this.Gs(t.geometry))return null;const{elements:n}=t.geometry.properties;return NU(t,n[e])}js(t){const{symbolIndex:e}=t.properties;return 0===e.type}Gs(t){const{symbolIndex:e}=t.properties;return 1===e.type}};function aG(t,e){return t.properties.level-e.properties.level||t.properties.meshKey-e.properties.meshKey}const hG=[],lG=[],uG=[];function cG(t,e,n,i,r,o,s,a,h,l,u,c,A){const{aGlyphOffset:f,aSegment:d,aTextDx:p,aTextDy:g,symbolIndex:m}=e.geometry.properties,y=this.getSymbol(m),v=ly(uG,(p?p[r]:y.textDx)||0,(g?g[r]:y.textDy)||0),_=ly(hG,f[2*r],f[2*r+1]),x=pg(lG,d[3*r],d[3*r+1],d[3*r+2]);return function(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d,p,g,m){d||(d=i);const y=e.geometry.properties.line,v=o[0]*c,_=A?v-s:v+s;let x=_>0?1:-1,b=0;A&&(x*=-1,b=Math.PI),x<0&&(b+=Math.PI);const w=l+u,C=Math.abs(_);let P=x>0?h:h+1,M=$R.convert(i),T=$R.convert(i),S=$R.convert(r),I=$R.convert(r),E=0,O=0;for(;E+O<=C;){if(P+=x,P<l||P>=w)return null;T.x=M.x,T.y=M.y,I.x=S.x,I.y=S.y,M.x=n[3*P],M.y=n[3*P+1],S.x=y[3*P],S.y=y[3*P+1],E+=O,O=T.dist(M)/f}const R=(C-E)/O,D=p&&p.getRenderer(),k=D&&D.getTerrainHelper(),L=e.properties.tile.terrainTileInfos;if(!m&&k){const{extent:n}=e.properties.tile,i=p.getTileSize().width/n,r=p.getMap();let o=S.sub(I).mult(R).i(I);M=JH(WH,r,e,S,i,p,g,L),T=JH(qH,r,e,I,i,p,g,L),o=JH(ZH,r,e,o,i,p,g,L);const s=b+Math.atan2(M[1]-T[1],M[0]-T[0]);return t[0]=(o[0]-d[0])/f,t[1]=(o[1]-d[1])/f,t[2]=s,t}const F=M.sub(T),N=F.mult(R).i(T);N.i(F.T().I().A(a*x));const z=b+Math.atan2(M.y-T.y,M.x-T.x);return t[0]=(N.x-i[0])/f,t[1]=(N.y-i[1])/f,t[2]=z,t}(t,e,i,o,s,_,v[0],v[1],x[0],x[1],x[2],n/24,h,a,l,u,c,A)}const AG=[],fG=[];function dG(t,e,n,i,r,o,s,a,h,l,u,c){const{aVertical:A}=n.geometry.properties,f=A[o];let d,p,g=cG.call(this,AG,n,i,r,o,a,h,l,!1);if(!g)return null;if(dg(t,g),g=cG.call(this,fG,n,i,r,s,a,h,l,!1),!g)return null;if(dg(e,g),c&&(_y(AG,AG,c),_y(fG,fG,c)),f){const t=Math.abs(fG[1]-AG[1]),e=Math.abs(fG[0]-AG[0])*u;p=AG[0]>fG[0]?1:0,t>e?(d=1,p=AG[1]<fG[1]?0:1):d=0}else d=0,p=AG[0]>fG[0]?1:0;return 2*p+d}var pG="#define SHADER_NAME TEXT_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aTexCoord;\n#ifdef HAS_OFFSET_Z\nattribute vec3 aOffset;\nuniform float altitudeScale;\n#else\nattribute vec2 aOffset;\n#endif\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\nuniform float zoomScale;\nuniform float cameraToCenterDistance;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform float mapPitch;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\nuniform float textPitchFilter;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_DX\nfloat d = aTextDx;\n#else\nfloat d = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat e = aTextDy;\n#else\nfloat e = textDy;\n#endif\n#ifdef HAS_TEXT_SIZE\nfloat f = aTextSize * layerScale;\n#else\nfloat f = textSize * layerScale;\n#endif\n#ifdef HAS_PITCH_ALIGN\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\ngl_Position = projViewModelMatrix * vec4(c, 1.);\n  float i = gl_Position.w;\n  float j = i / cameraToCenterDistance;\n  float k;\n  if(isRenderingTerrain == 1.) {\n    k = 1.;\n  } else {\n    float l = (1. - cameraToCenterDistance / i) * textPerspectiveRatio;\n    k = clamp(.5 + .5 * (1. - l), .0, 4.);\n  }\n#ifdef HAS_OFFSET_Z\nvec3 m = aOffset / 10.0;\n  m[2] /= altitudeScale;\n#else\nvec3 m = vec3(aOffset / 10.0, .0);\n#endif\nvec2 n = aTexCoord;\n  if(h == 1.) {\n    float o;\n    if(isRenderingTerrain == 1.) {\n      o = tileRatio;\n    } else {\n      o = tileRatio / zoomScale * j * k;\n    }\n    m.xy *= o;\n    gl_Position = projViewModelMatrix * vec4(c + m, 1.);\n  } else {\n    gl_Position.xy += m.xy * 2. / canvasSize * k * i;\n  }\n  gl_Position.xy += vec2(d, -e) * 2. / canvasSize * i;\n  if(textPitchFilter > .0) {\n    if(textPitchFilter == 1. && h == .0 || textPitchFilter == 2. && h == 1.) {\n      gl_Position = vec4(-9999., -9999., .0, 1.);\n    }\n  }\n#ifndef PICKING_MODE\nif(h == 1.) {\n    vGammaScale = j + mapPitch / 4.;\n  } else {\n    vGammaScale = mix(1., j, textPerspectiveRatio);\n  }\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vTexCoord = n / texSize;\n  vSize = f;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool u = aOpacity == 255.;\n#else\nbool u = true;\n#endif\nfbo_picking_setData(gl_Position.w, u);\n#endif\n}";const gG=function(t){const e=this.layer.getRenderer();return!this.Es(t)&&e.isTileNearCamera(t)&&"line"!==t.geometry.properties.textPlacement},mG=function(t){const e=this.layer.getRenderer();return!this.Es(t)&&!e.isForeground(t)&&"line"!==t.geometry.properties.textPlacement},yG=function(t){const e=this.layer.getRenderer();return!this.Es(t)&&e.isTileNearCamera(t)&&"line"===t.geometry.properties.textPlacement},vG=function(t){const e=this.layer.getRenderer(),n=t.properties.tile.z,i=e.getCurrentTileZoom();return!this.Es(t)&&!e.isForeground(t)&&"line"===t.geometry.properties.textPlacement&&n<i},_G=[0,0,3],xG=[],bG=[],wG=[],CG=[],PG=[],MG=[],TG=[],SG=[],IG=[1,-1],EG=new Int16Array(3),OG=[],RG=[],DG=[],kG=[],LG=[],FG=[],NG=[],zG={},BG={},HG={},jG=[],UG=[],GG=Np([]),VG=[];class WG extends jj{static getBloomSymbol(){return["textBloom"]}constructor(t,e,n,i,r,o){super(t,e,n,i,r,o),this.propAllowOverlap="textAllowOverlap",this.propIgnorePlacement="textIgnorePlacement",this.colorCache={},this.eo=gG.bind(this),this.no=mG.bind(this),this.io=yG.bind(this),this.ro=vG.bind(this),this.isLabelCollides=FU.bind(this),this.so()}prepareRender(...t){super.prepareRender(...t);const e=this.scene.getMeshes();if(e&&e.length)for(let n=0;n<e.length;n++){if(e[n].properties.isHalo)continue;const{haloMesh:t}=e[n].properties;t.dirtyDefines&&e[n].setDefines(t.defines)}}updateSymbol(...t){this.oo=void 0,this.ao=void 0;const e=super.updateSymbol(...t);return this.so(),e}isTerrainVector(){if(!super.isTerrainSkin())return!1;if(void 0!==this.oo)return this.oo;for(let t=0;t<this.symbolDef.length;t++)if("map"!==this.symbolDef[t].textPitchAlignment)return this.oo=!0,!0;return this.oo=!1,!1}isTerrainSkin(){if(!super.isTerrainSkin())return!1;if(void 0!==this.ao)return this.ao;for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t].textPitchAlignment;if("map"===e||SE(e)||qF(e))return this.ao=!0,!0}return this.ao=!1,!1}so(){this.lo=[];for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t];if(qF(e.textName)){const n=WF(e.textName,"string");this.lo[t]=(t,e)=>{let i;zG.zoom=t,BG.properties=e;try{i=n.evaluateWithoutErrorHandling(zG,BG,HG,null,jG)}catch(r){i=null}return i}}else SE(e.textName)&&(this.lo[t]=EE(e.textName))}}shouldDeleteMeshOnUpdateSymbol(t){if(!Array.isArray(t))return(0===t.textHaloRadius||0===this.symbolDef[0].textHaloRadius)&&t.textHaloRadius!==this.symbolDef[0].textHaloRadius;for(let e=0;e<t.length;e++)if(t[e]&&(0===t[e].textHaloRadius||0===this.symbolDef[e].textHaloRadius)&&t[e].textHaloRadius!==this.symbolDef[e].textHaloRadius)return!0;return!1}createFnTypeConfig(t,e){return OU(t,e)}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex)[WG.getBloomSymbol()[0]]}createGeometry(t,e,n){const i=t;if(!i.glyphAtlas)return null;const r=super.createGeometry(i,e);if(!r||!r.geometry)return null;const{geometry:o}=r;return o.properties.glyphAtlas&&this.drawDebugAtlas(o.properties.glyphAtlas),o&&i.lineVertex&&(o.properties.line=i.lineVertex,o.properties.line.id=n),r}createMesh(t,e,{tileVectorTransform:n}){const i=this.isEnableCollision(),r=this.isEnableUniquePlacement(),{geometry:o,symbolIndex:s}=t;o.properties.symbolIndex=s;const a=this.getSymbol(s),h=this.getSymbolDef(s),l=this.getFnTypeConfig(s),u=TU.call(this,this.regl,o,e,h,a,l,this.layer.options.collision,!i,r);return u.length&&("line"===o.properties.textPlacement?this.ho=!0:this.uo=!0),u.forEach((t=>{t.positionMatrix=this.getAltitudeOffsetMatrix(),t.properties.tileVectorTransform=n})),u}updateCollision(t){super.updateCollision(t);const e=this.scene.getMeshes();e&&e.length?(this.co={},this.fo(t.timestamp),this.Gr()):this.Gr()}callCurrentTileShader(t,e){this.shader.filter=e.sceneFilter?[this.eo,e.sceneFilter]:this.eo,this.callRenderer(this.shader,t,e),this.do.filter=e.sceneFilter?[this.io,e.sceneFilter]:this.io,this.callRenderer(this.do,t,e)}callBackgroundTileShader(t,e){this.shader.filter=e.sceneFilter?[this.no,e.sceneFilter]:this.no,this.callRenderer(this.shader,t,e),this.do.filter=e.sceneFilter?[this.ro,e.sceneFilter]:this.ro,this.callRenderer(this.do,t,e)}callRenderer(t,e,n){n&&n.isRenderingTerrain&&SE(this.symbolDef.textPitchAlignment)&&(e.textPitchFilter=n.isRenderingTerrainSkin?1:2),super.callRenderer(t,e,n)}fo(){let t=this.scene.getMeshes();if(!t||!t.length)return;const e=-this.getMap().getBearing()*Math.PI/180,n=vp(wG,e),i=(t,e,n,i)=>{const{start:r,end:o,mesh:s,allElements:a}=e[0];if(this.updateBoxCollisionFading(!0,s,e,n,i)){let e=t.count;for(let n=r;n<o;n++)t[e++]=a[n];t.count=e}},r=this.isEnableCollision(),o=this.layer.getRenderer();t=t.sort(ZG);for(let s=0;s<t.length;s++){const e=t[s];if(!this.isMeshIterable(e))continue;if(!o.isTileNearCamera(e)){const{visElemts:t}=e.geometry.properties;t&&(t.count=0),e.geometry.setElements(t,0);continue}const a=e.geometry,h=this.getSymbol(e.properties.symbolIndex);e.properties.textHaloRadius=BB(h.textHaloRadius)?MU.textHaloRadius:h.textHaloRadius;const l=e.properties.meshKey;if("line"===a.properties.textPlacement){if(!a.properties.line)continue;r&&this.startMeshCollision(e),this.po(e,n);const{aOffset:t,aOpacity:i}=a.properties;t.dirty&&(a.updateData("aOffset",t),t.dirty=!1),i&&i.dirty&&(a.updateData("aOpacity",i),i.dirty=!1),r&&this.endMeshCollision(l)}else if(r){this.startMeshCollision(e);const{elements:t,aOpacity:n,visElemts:r}=a.properties;r.count=0,this.forEachBox(e,((t,e,n,o,s)=>{i(r,e,n,o)})),n&&n.dirty&&a.updateData("aOpacity",n),r.count===t.length&&a.count===t.length||!r.count&&!a.count||a.setElements(r,r.count),this.endMeshCollision(l)}}}isMeshIterable(t){return t.isValid()&&t.material&&!t.material.get("isHalo")&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(t))}isMeshUniquePlaced(t){return!!this.isMeshIterable(t)&&"line"!==this.getSymbol(t.properties.symbolIndex).textPlacement}getUniqueEntryKey(t,e){return NU(t,e)}po(t,e){const n=this.getMap(),i=t.geometry,r=i.properties;let o=r.line;if(!o)return;const s=n.getPitch(),a=n.getBearing(),{lineTextPitch:h,lineTextBearing:l}=t.properties,u=1===t.material.uniforms.pitchWithMap,c=r.elements;if(!u){const e=Hp(xG,n.projViewMatrix,t.localTransform),i=o.id+"-"+e.join();let s;this.co[i]?o=this.co[i]:(s=r.projectedLine=r.projectedLine||new Array(o.length),o=this.mo(s,o,e,n.width,n.height),this.co[i]=s)}const A=this.isEnableCollision(),f=i.properties.visElemts=i.properties.visElemts||new c.constructor(c.length),d=i.properties.visCache=i.properties.visCache||[];A&&(f.count=0);const p=void 0===h||!n.isInteracting()||Math.abs(s-h)>2||Math.abs(a-l)>2;p&&(this.Er=!0),this.forEachBox(t,((t,n,i,r)=>{const{start:s,end:a}=n[0];let h=d[r];if((void 0===h||p)&&(h=this.yo(t,c,s,a,o,i,u?e:null,r)),d[r]=h,A&&(h=this.updateBoxCollisionFading(h,t,n,i,r),h)){let t=f.count;for(let e=s;e<a;e++)f[t++]=c[e];f.count=t}})),p&&(t.properties.lineTextPitch=s,t.properties.lineTextBearing=a);const g=t.geometry.properties.aAltitude;g&&g.dirty&&(i.updateData("aAltitude",g),g.dirty=!1),!A||f.count===c.length&&i.count===f.count||i.setElements(f,f.count)}mo(t,e,n,i,r){return function(t,e,n,i,r){for(let o=0;o<e.length;o+=3)qg(GH,e[o],e[o+1],e[o+2],1),VH(GH,GH,n,i,r),t[o]=GH[0],t[o+1]=GH[1],t[o+2]=e[o+2];return t}(t,e,n,i,r)}forEachBox(t,e){const n=this.getMap(),i=Hp(xG,n.projViewMatrix,t.properties.tileVectorTransform),{collideIds:r,aCount:o,features:s,elements:a}=t.geometry.properties,h=r;if(!h)return;const l=this.isEnableUniquePlacement(),u=this.Cs(1);u[0].allElements=a,u[0].mesh=t;let c=0,A=a[0],f=0,d=h[A];for(let p=0;p<=a.length;p+=6)if(A=a[p],h[A]!==d||p===a.length){const n=s[d]&&s[d].feature;if(l&&this.isMeshUniquePlaced(t)&&n&&!n.label){const e=n.properties||{},{symbolIndex:i}=t.properties,r=wN(i&&this.lo[i.index]?this.lo[i.index](t.properties.z,e):this.getSymbol(t.properties.symbolIndex).textName,e);n.label=r}const r=p,g=o[a[f]];for(let o=f;o<r;o+=6*g)u[0].start=o,u[0].end=o+6*g,u[0].boxCount=g,e.call(this,t,u,i,c++);d=h[A],f=p}}yo(t,e,n,i,r,o,s){const a=this.layer.getRenderer(),h=t.material.uniforms,l=1===h.pitchWithMap,u=!l&&a.getTerrainHelper&&a.getTerrainHelper(),c=this.isEnableCollision(),A=this.getMap(),f=t.geometry,d=f.desc.positionSize,{aShape:p,aOffset:g,aAnchor:m,aAltitude:y,aPitchRotation:v}=f.properties;let{aProjectedAnchor:_}=f.properties;_||(_=f.properties.aProjectedAnchor=new Array(m.length/d*3));const x=f.properties.aTextSize,b=!s,w=e[n],C=w*d;let P;P=f.data.aAltitude?pg(CG,m[C],m[C+1],y[w]):ZD(CG,m[C],m[C+1],m[C+2]);const M=VH(PG,P,o,A.width,A.height),T=f.properties.aTerrainAltitude;let S;if(T){const t=T[w];if(t===TB)return _[3*w]=MB,_[3*w+1]=MB,_[3*w+2]=MB,!1;t?(S=pg(UG,...P),S[2]=100*t,S=VH(S,S,o,A.width,A.height)):S=M}else S=M;const I=A.getDevicePixelRatio();if(Jg(VG,S,1/I),A.isOffscreen(VG))return c||qG(g,e,n,i),_[3*w]=MB,_[3*w+1]=MB,_[3*w+2]=MB,!1;b&&(P=M),_[3*w]=S[0],_[3*w+1]=S[1],_[3*w+2]=S[2];const E=b?1:f.properties.tileExtent/this.layer.getTileSize().width;let O=!0;const R=e[n],D=e[i-1],k=x?x[R]:t.properties.textSize,L=this.vo(t,k,r,R,D,P,CG,E,s);if(null===L)return qG(g,e,n,i),!1;const F=D-R<=3,N=Math.floor(L/2),z=L%2;for(let B=n;B<i;B+=6){const s=e[B];let a;if(a=N||B!==n||F||u?N||B!==i-6||F||u?cG.call(this,bG,t,k,r,s,P,CG,E,N,S,this.layer,o,l):NG:FG,!a){O=!1,c||qG(g,e,n,i);break}let A=a[2];z&&(A-=Math.PI/2);const f=eU(MG,A,0,h.rotateWithMap,h.pitchWithMap),d=g.length>p.length;let m;if(d){pg(kG,v[3*s],v[3*s+1],0);const t=Pg(kG,kG),e=-v[3*s+2];if(e){const n=vm(OG,t,e);Zp(RG,_G),eg(DG,n),m=Hp(DG,DG,RG)}}for(let t=0;t<4;t++){const e=2*(s+t);ly(TG,p[e]/10,p[e+1]/10),dy(TG,TG,k/24),_y(TG,TG,f),l?(Ay(TG,TG,IG),uy(SG,TG,a),d&&(SG[2]=0,m&&Sg(SG,SG,m))):(Ay(SG,a,IG),uy(SG,TG,SG)),EG[0]=10*SG[0],EG[1]=10*SG[1],d&&(EG[2]=10*SG[2]);const n=(d?3:2)*(s+t);(g[n]!==EG[0]||g[n+1]!==EG[1]||d&&g[n+2]!==EG[2])&&(g.dirty=!0,g[n]=EG[0],g[n+1]=EG[1],d&&(g[n+2]=EG[2]))}}return O}vo(t,e,n,i,r,o,s,a,h){const l=r-i<=3,u=this.getMap();return l?0:dG.call(this,FG,NG,t,e,n,i,r,o,s,a,u.width/u.height,h)}isBoxCollides(t,e,n,i,r,o){return this.isLabelCollides(0,t,e,n,i,r,o)}deleteMesh(t,e){t&&(e&&(Array.isArray(t)?t.forEach((t=>{t&&t.material&&delete t.material.uniforms.texture})):t.material&&delete t.material.uniforms.texture),super.deleteMesh(t,e))}delete(){super.delete(),this.do.dispose(),delete this.co,this.xo&&this.xo.dispose()}isUniqueStencilRefPerTile(){return!1}isEnableTileStencil(){return!this.layer.getRenderer().isEnableWorkAround("win-intel-gpu-crash")}init(){this.renderer=new j_(this.regl);const{uniforms:t,extraCommandProps:e}=EU.call(this,this.canvas,this.sceneConfig),n=this.canvas,i={x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,e)=>e.viewport?e.viewport.width:n?n.width:1,height:(t,e)=>e.viewport?e.viewport.height:n?n.height:1};e.viewport=i,this.shader=new mx({vert:HU,frag:jU,uniforms:t,extraCommandProps:e});let r=e;if(this.layer.getRenderer().isEnableWorkAround("win-intel-gpu-crash")&&(r=FB({},e),r.stencil=FB({},e.stencil),r.stencil.enable=!0,r.stencil.func.cmp="<",r.stencil.func.ref=(t,e)=>2*e.level+(e.isHalo||0)+1),this.do=new mx({vert:pG,frag:jU,uniforms:t,extraCommandProps:r}),this.pickingFBO){const e=new cw(this.renderer,{vert:"#define PICKING_MODE 1\n"+HU,uniforms:t,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap());e.filter=t=>"line"!==this.getSymbol(t.properties.symbolIndex).textPlacement;const n=new cw(this.renderer,{vert:"#define PICKING_MODE 1\n"+pG,uniforms:t,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap());n.filter=t=>"line"===t.geometry.properties.textPlacement,this.picking=[e,n]}}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i=this.layer.getTileSize().width,r=n?GG:t.projViewMatrix,o=t.cameraToCenterDistance,s=ly(LG,t.width,t.height);n&&ly(s,i,i);const a=cB(t.getResolution(),t);return{layerScale:this.layer.options.styleScale||1,mapPitch:t.getPitch()*Math.PI/180,mapRotation:t.getBearing()*Math.PI/180,projViewMatrix:r,viewMatrix:t.viewMatrix,cameraToCenterDistance:o,canvasSize:s,glyphSize:iU,gammaScale:1*(this.layer.options.textGamma||1),resolution:t.getResolution(),altitudeScale:a,viewport:n&&e&&e.viewport,textPitchFilter:0,isRenderingTerrain:+!!n}}}function qG(t,e,n,i){for(let r=n;r<i;r+=6){const n=e[r];for(let e=0;e<4;e++){const i=3*(n+e);(t[i]||t[i+1]||t[i+2])&&(t.dirty=!0,t[i]=0,t[i+1]=0,t[i+2]=0)}}}function ZG(t,e){const n=t.properties.level-e.properties.level;return 0===n?t.properties.meshKey-e.properties.meshKey:n}var QG="#define SHADER_NAME NATIVE_POINT\n#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float markerSize;\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  gl_PointSize = markerSize;\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const XG={markerFill:[0,0,0],markerOpacity:1,markerSize:10};class YG extends fj{getPrimitive(){return"points"}isTerrainSkin(){return!1}isTerrainVector(){return this.layer.options.awareOfTerrain}isUniqueStencilRefPerTile(){return!1}createMesh(t,e){const{geometry:n,symbolIndex:i,ref:r}=t,o=this.getSymbol(i);void 0===r&&(OH(n,this.getSymbolDef(i),this.getFnTypeConfig(i),this.layer),n.generateBuffers(this.regl));const s={};jB(s,"markerOpacity",o,"markerOpacity",1),jB(s,"markerSize",o,"markerSize",10),jB(s,"markerFill",o,"markerFill","#000",VB(this.colorCache,3));const a=new T_(s,XG);a.createDefines=()=>"square"!==o.markerType?{USE_CIRCLE:1}:null,a.appendDefines=t=>("square"!==o.markerType&&(t.USE_CIRCLE=1),t);const h=new z_(n,a,{castShadow:!1,picking:!0}),l={};return h.geometry.data.aAltitude&&(l.HAS_ALTITUDE=1),n.data.aColor&&(l.HAS_COLOR=1),h.setDefines(l),h.positionMatrix=this.getAltitudeOffsetMatrix(),h.setLocalTransform(e),h.properties.symbolIndex=i,h}createFnTypeConfig(t,e){const n=OE(e.markerFill);return[{attrName:"aColor",symbolName:"markerFill",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||bO(r).unitArray()),r=GB(r),r}}]}init(){this.renderer=new j_(this.regl);const t=[],e={vert:QG,frag:"#define SHADER_NAME NATIVE_POINT\nprecision mediump float;\n#include <gl2_frag>\n#ifdef USE_CIRCLE\n#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#define STANDARD_DERIVATIVES_ENABLED 1\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define STANDARD_DERIVATIVES_ENABLED 1\n#endif\n#endif\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform vec3 markerFill;\n#endif\nuniform float markerOpacity;\nuniform float layerOpacity;\nvoid main() {\n  float c = 1.;\n#ifdef USE_CIRCLE\nfloat r = .0, d = .0;\n  vec2 e = 2. * gl_PointCoord - 1.;\n  r = dot(e, e);\n  if(r > 1.) {\n    discard;\n  }\n#ifdef STANDARD_DERIVATIVES_ENABLED\nd = fwidth(r);\n  c = 1. - smoothstep(1. - d, 1. + d, r);\n#endif\n#endif\n#ifdef HAS_COLOR\nvec4 f = vColor;\n#else\nvec4 f = vec4(markerFill, 1.);\n#endif\nglFragColor = f * markerOpacity * c * layerOpacity;\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Hp(t,n.projViewMatrix,n.modelMatrix),t}}],defines:null,extraCommandProps:{viewport:{x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},depth:{enable:!0,mask:!1,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"always"},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"}}};if(this.shader=new mx(e),this.shader.version=300,this.pickingFBO){const t=[];this.picking=[new cw(this.renderer,{vert:"#define PICKING_MODE 1\n"+QG,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return Hp(t,n.projViewMatrix,n.modelMatrix),t}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())]}}getUniformValues(t){return{projViewMatrix:t.projViewMatrix}}}var JG="#define SHADER_NAME NATIVE_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\n#else\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const KG=Np([]);class $G extends fj{constructor(t,e,n,i,r,o){if(super(t,e,n,i,r,o),this.primitive="lines",SE(this.symbolDef.lineColor)){const t=e.getMap(),n=OE(this.symbolDef.lineColor);this.colorSymbol=e=>n(t.getZoom(),e)}}needPolygonOffset(){return!0}createMesh(t,e){const{geometry:n,symbolIndex:i,ref:r}=t,o=this.getSymbol(i),s=this.getMeshUniforms(n,o);void 0===r&&n.generateBuffers(this.regl);const a=new T_(s),h=new z_(n,a,{castShadow:!1,picking:!0});h.setLocalTransform(e),h.properties.symbolIndex=i;const l={};return h.geometry.data.aAltitude&&(l.HAS_ALTITUDE=1),h.setDefines(l),h}getMeshUniforms(t,e){const n={};return jB(n,"lineColor",e,"lineColor","#000",VB(this.colorCache)),jB(n,"lineOpacity",e,"lineOpacity",1),n}isEnableTileStencil(t){return!(t&&t.isRenderingTerrain&&this.isTerrainSkin())}init(t){this.renderer=new j_(this.regl);const e=this.canvas,n=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}}],i={vert:JG,frag:"#define SHADER_NAME NATIVE_LINE\nprecision mediump float;\nuniform float lineOpacity;\nuniform vec4 lineColor;\nuniform float layerOpacity;\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#endif\nvoid main() {\n  gl_FragColor = lineColor * lineOpacity;\n#if defined(HAS_COLOR)\ngl_FragColor *= vColor;\n#endif\ngl_FragColor *= layerOpacity;\n}",uniforms:n,defines:null,extraCommandProps:{viewport:{x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,n)=>n.viewport?n.viewport.width:e?e.width:1,height:(t,n)=>n.viewport?n.viewport.height:e?e.height:1},stencil:{enable:()=>this.isEnableTileStencil(t),mask:255,func:{cmp:()=>this.isOnly2D()?"=":"<=",ref:(t,e)=>e.stencilRef,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}};this.shader=new mx(i),this.pickingFBO&&(this.picking=[new cw(this.renderer,{vert:"#define PICKING_MODE 1\n"+JG,uniforms:n,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())])}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin;return{projViewMatrix:n?KG:t.projViewMatrix,viewport:n&&e&&e.viewport}}getPrimitive(){return"lines"}}const tV=[1,1,1],eV=[1,1,1,1],nV=[0,0],iV=[1,1],rV=[],oV=new $o(0,0),sV=new $o(0,0),aV=[],hV=[];class lV extends uj{isEnableTileStencil(){return!1}supportRenderMode(t){return this.isAnimating()?"fxaa"===t||"fxaaAfterTaa"===t:"taa"===t||"fxaa"===t}isTerrainSkin(){return!1}isTerrainVector(){return this.layer.options.awareOfTerrain}isAnimating(){return!1}createMesh(t,e,{tilePoint:n}){if(!this.material)return this.setToRedraw(),null;const{geometry:i,symbolIndex:r}=t,o=this.layer instanceof lA,s=new z_(i,this.material);if(this.sceneConfig.animation){tV[2]=.01;const t=[];Qp(t,tV),Hp(t,e,t),e=t}const a=this.getSymbolDef(r),h=this.getFnTypeConfig(r);OH(i,a,h,this.layer);const l=this.getShader(),u=l.getGeometryDefines?l.getGeometryDefines(i):{},c=this.getSymbol(r),A=VB(this.colorCache);if(i.data.aExtrude){u.IS_LINE_EXTRUSION=1;const{tileResolution:t,tileRatio:e}=i.properties,n=this.getMap();Object.defineProperty(s.uniforms,"linePixelScale",{enumerable:!0,get:function(){return e*n.getResolution()/t}}),jB(s.uniforms,"lineWidth",c,"lineWidth",4),jB(s.uniforms,"lineOpacity",c,"lineOpacity",1),jB(s.uniforms,"lineColor",c,"lineColor","#fff",A),Object.defineProperty(s.uniforms,"lineHeight",{enumerable:!0,get:()=>{const t=this.dataConfig.defaultAltitude*(this.dataConfig.altitudeScale||1);return ZB(t)?t:0}})}else{jB(s.uniforms,"polygonFill",c,"polygonFill",eV,A),jB(s.uniforms,"polygonOpacity",c,"polygonOpacity",1);const t=[];Object.defineProperty(s.uniforms,"vertexColorsOfType",{enumerable:!0,get:()=>{const e=A(c.bottomPolygonFill||eV),n=A(c.topPolygonFill||eV);t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3];const i=s.geometry.properties.vertexColors;if(i){let e=8;t.length=8+i.length;for(let n=0;n<i.length;n++)t[e++]=i[n][0],t[e++]=i[n][1],t[e++]=i[n][2],t[e++]=i[n][3]}return t}})}if(i.data.aColor&&(u.HAS_COLOR=1),i.data.aOpacity&&(u.HAS_OPACITY=1),i.data.aLineWidth&&(u.HAS_LINE_WIDTH=1),i.data.aLineHeight&&(u.HAS_LINE_HEIGHT=1),i.data.aTerrainAltitude&&(u.HAS_TERRAIN_ALTITUDE=1),i.data.aVertexColorType){const t=s.geometry.properties.vertexColors;let e=2;t&&(e+=t.length),u.VERTEX_TYPES_COUNT=e}if(i.data.aOpacity){const t=i.data.aOpacity;for(let e=0;e<t.length;e++)if(t[e]<255){i.properties.hasAlpha=!0;break}}u.HAS_MIN_ALTITUDE=1,u.HAS_LAYER_OPACITY=1,i.generateBuffers(this.regl),s.setDefines(u),s.setPositionMatrix(this.getAltitudeOffsetMatrix()),s.setLocalTransform(e),(i.properties.maxAltitude<=0||s.properties.level>=3)&&(s.castShadow=!1),s.setUniform("maxAltitude",s.geometry.properties.maxAltitude),Object.defineProperty(s.uniforms,"minAltitude",{enumerable:!0,get:()=>this.layer.options.altitude||0});const{tileResolution:f}=i.properties,d=this.getMap(),p=this.layer.getRenderer(),g=d.pointAtResToCoord(new ht(n),f),m=(v=g,_=f,d.pointAtResToDistance(1,0,_,v)),y=[];var v,_;Object.defineProperty(s.uniforms,"uvOrigin",{enumerable:!0,get:()=>this.bo(y,r,n,f,m,o)}),s.setUniform("uvOffset",[0,0]),Object.defineProperty(s.uniforms,"hasAlpha",{enumerable:!0,get:()=>{const t=this.getSymbol(r);return i.properties.hasAlpha||t.polygonOpacity<1||t.lineOpacity<1||s.material&&(s.material.uniforms.baseColorTexture||s.material.uniforms.emissiveTexture)}});const x=this.layer.getMap().getMaxNativeZoom();return Object.defineProperty(s.uniforms,"stencilRef",{enumerable:!0,get:()=>p.isForeground(s)?0:x-s.properties.tile.z}),s.properties.symbolIndex=r,s}bo(t,e,n,i,r,o){if(1===this.dataConfig.topUVMode)return t[0]=0,t[1]=0,t;const s=this.getMap(),a=this.getSymbol(e).material;let h=n;!this.dataConfig.side&&a&&a.textureOrigin&&(oV.set(a.textureOrigin[0],a.textureOrigin[1]),s.coordToPointAtRes(oV,i,sV),h=ly(aV,n[0]-sV.x,n[1]-sV.y));const l=!!a&&a.uvOffsetInMeter;let u=a&&a.uvOffset||nV;const c=this.getUVOffsetAnim();c&&(u=this.getUVOffset(c));const A=a&&a.uvScale||iV;let f=this.dataConfig.side?0:h[0],d=this.dataConfig.side?0:h[1];const p=a&&a.textureWidth||23.25;l&&(f+=u[0]/r,d+=u[1]/r);const g=ly(t,f*r*A[0]/p+(l?0:u[0]),d*r*A[1]/(p*A[1]/A[0])+(l?0:u[1]));return o||(g[1]*=-1),g}callShader(t,e){const n=this.sceneConfig.cullFace;this.sceneConfig.cullFace="front",this.callBackgroundTileShader(t,e),void 0===n?delete this.sceneConfig.cullFace:this.sceneConfig.cullFace=n,super.callShader(t,e)}getShadowMeshes(){if(!this.isVisible())return rV;this.shadowCount=this.scene.getMeshes().length;const t=this.scene.getMeshes().filter((t=>0===t.properties.level));for(let e=0;e<t.length;e++){const n=t[e];n.material!==this.material&&n.setMaterial(this.material)}return t}getUVOffsetAnim(){const t=this.getSymbols()[0];return t.material&&t.material.uvOffsetAnim}getUVOffset(t){const e=this.getSymbols()[0],n=e.material&&e.material.uvOffset||nV,i=!!e.material&&e.material.uvOffsetInMeter,r=performance.now()/1e3,o=ly(hV,n[0],n[1]);return o[0]=r*t[0],o[1]=r*t[0],i||(o[0]%=1,o[1]%=1),o}needPolygonOffset(){return this.wo}startFrame(...t){return delete this.wo,super.startFrame(...t)}addMesh(t,e){t.forEach((t=>{this.Pr(t,e)})),super.addMesh(...arguments)}Pr(t,e){if(null!==e){const n=t.localTransform;0===e&&(e=.01),tV[2]=e,Qp(n,tV),Hp(n,t.properties.tileTransform,n),t.setLocalTransform(n)}else t.setLocalTransform(t.properties.tileTransform);t.material!==this.material&&t.setMaterial(this.material),t.geometry.properties.maxAltitude<=0&&(this.wo=!0),t.ssr=this.getSymbol(t.properties.symbolIndex).ssr?1:0}deleteMaterial(){this.material&&(this.material.dispose(),delete this.material)}deleteMesh(t,e){if(t)if(this.scene.removeMesh(t),Array.isArray(t))for(let n=0;n<t.length;n++)e||(t[n].geometry.dispose(),delete t[n].geometry.properties.layer),t[n].dispose();else e||(t.geometry.dispose(),delete t.geometry.properties.layer),t.dispose()}updateDataConfig(t,e){return!("line-extrusion"===this.dataConfig.type&&!t.altitudeProperty&&!e.altitudeProperty)}createFnTypeConfig(t,e){const n=OE(e.polygonFill||e.lineColor),i=EE(e.polygonOpacity||e.lineOpacity),r=EE(e.lineWidth),o=new Uint8Array(1),s=new Uint16Array(1);return[{attrName:"aColor",type:Uint8Array,width:4,symbolName:e.polygonFill?"polygonFill":e.lineColor?"lineColor":"polygonFill",define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||bO(r).unitArray()),r=GB(r),r}},{attrName:"aOpacity",type:Uint8Array,width:1,symbolName:e.polygonOpacity?"polygonOpacity":e.lineOpacity?"lineOpacity":"polygonOpacity",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e,!1)),o[0]=255*r,o[0]<255&&(n.properties.hasAlpha=!0),o[0]}},{attrName:"aLineWidth",type:Uint8Array,width:1,symbolName:"lineWidth",define:"HAS_LINE_WIDTH",evaluate:e=>{const n=r(t.getZoom(),e);return s[0]=Math.round(2*n),s[0]}}]}updateSymbol(t,e){let n=!1;t&&t.material&&(n=function(t,e){for(const n in e)if(cV[n]&&e[n]!==t[n]&&(!t[n]||!e[n]))return!0;return!1}(this.symbolDef[0].material||{},t.material));const i=super.updateSymbol(t,e);return t&&t.material&&this.Ao(t.material),n||i}ir(t,e){return uV(t)!==uV(e)}}function uV(t){if(!t||!t.material)return!1;for(const e in t.material)if(e.indexOf("Texture")>0&&t.material[e])return!0;return!1}const cV={normalTexture:1,bumpTexture:1};class AV extends lV{createGeometry(t){const e=t.data,n=this.getSymbols()[0];if(n.material&&n.material.extrusionOpacity){const t=new Uint8Array(e.aPosition.length/3);for(let n=0;n<e.aPosition.length;n+=3)t[n/3]=e.aPosition[n+2]>0?0:1;e.aExtrusionOpacity=t}const i=new Jv(e,t.indices);return FB(i.properties,t.properties),this.mr(i,t),{geometry:i,symbolIndex:{index:0}}}updateSceneConfig(t){let e;if(this.sceneConfig.cullFace!==t.cullFace&&(e=!0),FB(this.sceneConfig,t),e){const t=this.getShaderConfig();this.shader.dispose(),this.shader=new yx(t)}this.setToRedraw()}getShader(){return this.shader}delete(t){this.getMap().off("updatelights",this.Mo,this),super.delete(t),this.material.dispose()}init(){this.getMap().on("updatelights",this.Mo,this),this.renderer=new j_(this.regl);const t=this.getShaderConfig();this.shader=new yx(t),this.Ao();const e={vert:this.getPickingVert(),uniforms:["projViewMatrix","modelMatrix","positionMatrix",{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp([],e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:this.pickingViewport}};this.picking=[new cw(this.renderer,e,this.layer.getRenderer().pickingFBO,this.getMap())]}Mo(){this.setToRedraw()}getShaderConfig(){const t=this.canvas,e={x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1};return{extraCommandProps:{cull:{enable:()=>void 0===this.sceneConfig.cullFace||!!this.sceneConfig.cullFace,face:()=>{let t=this.sceneConfig.cullFace;return!0===t&&(t="back"),t||"back"}},stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},viewport:e,polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}}Ao(){this.material&&this.material.dispose();const t=this.layer instanceof lA,e=this.getSymbols()[0].material,n={};for(const i in e)XB(e,i)&&(n[i]=e[i],"uvRotation"===i&&(n[i]=n[i]*Math.PI/180,t||(n[i]*=-1)));this.material=new E_(n)}getUniformValues(t,e){const n=t.viewMatrix,i=t.projMatrix,r=t.cameraPosition,o=this._o(),s=FB({viewMatrix:n,projMatrix:i,cameraPosition:r,projViewMatrix:t.projViewMatrix},o);s.halton=e&&e.jitter?e.jitter:[0,0];const a=this.layer.getRenderer().canvas;return s.outSize=[a.width,a.height],s}getPickingVert(){return"\n            attribute vec3 aPosition;\n            uniform mat4 projViewModelMatrix;\n            uniform mat4 modelMatrix;\n            uniform mat4 positionMatrix;\n            //引入fbo picking的vert相关函数\n            #include <fbo_picking_vert>\n            #include <get_output>\n            void main()\n            {\n                mat4 localPositionMatrix = getPositionMatrix();\n                vec4 localPosition = getPosition(aPosition);\n\n                gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n                //传入gl_Position的depth值\n                fbo_picking_setData(gl_Position.w, true);\n            }\n        "}_o(){const t=this.getMap().getLightManager(),e=t&&t.getAmbientLight()||{},n=t&&t.getDirectionalLight()||{};return{ambientColor:e.color||[.2,.2,.2],light0_diffuse:[...n.color||[.1,.1,.1],1],lightSpecular:n.specular||[.8,.8,.8],light0_viewDirection:n.direction||[1,1,-1]}}}const fV=[1,1,1];class dV extends uj{createGeometry(t){const{data:e,indices:n}=t,i=new Jv(e,n,0,{primitive:"lines"});return i.generateBuffers(this.regl),{geometry:i,symbolIndex:{index:0}}}createMesh(t,e){const{geometry:n}=t,i=new z_(n);if(i.castShadow=!1,this.sceneConfig.animation){fV[2]=.01;const t=[];Qp(t,fV),Hp(t,e,t),e=t}return i.setLocalTransform(e),i.properties.symbolIndex={index:0},i}addMesh(t,e){if(!t.length)return this;let n;null!==e?(0===e&&(e=.01),n=t[0].localTransform,fV[2]=e,Qp(n,fV),Hp(n,t[0].properties.tileTransform,n)):n=t[0].properties.tileTransform;for(let i=0;i<t.length;i++)t[i].setLocalTransform(n);return this.scene.addMesh(t),this}init(){const t=this.regl;this.scene=new Y_,this.renderer=new j_(t);const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},n={vert:"\n    attribute vec3 aPosition;\n    attribute vec4 aColor;\n\n    uniform mat4 projViewModelMatrix;\n    uniform vec2 outSize;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n        vColor = aColor / 255.0;\n    }\n",frag:"\n    #ifdef GL_ES\n        precision lowp float;\n    #endif\n\n    uniform float opacity;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_FragColor = vColor * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},viewport:e}};this.shader=new mx(n)}getUniformValues(t){const e=this.sceneConfig.opacity||.3,n=this.layer.getRenderer().canvas;return{projViewMatrix:t.projViewMatrix,outSize:[n.width,n.height],opacity:e}}}const{getPBRUniforms:pV}=Xw.PBRUtils;class gV extends lV{constructor(...t){super(...t),this.So=new V_(null,this.layer.getURLModifier()),this.scene.sortFunction=this.sortByCommandKey}supportRenderMode(t){return this.getSymbols()[0].ssr?"fxaa"===t||"fxaaAfterTaa"===t:super.supportRenderMode(t)}isAnimating(){const t=this.ko();if(t&&(t[0]||t[1]))return!0}needToRedraw(){const t=this.ko();return!(!t||!t[0]&&!t[1])||super.needToRedraw()}ko(){const t=this.getSymbols()[0];return t.material&&t.material.uvOffsetAnim}createGeometry(t){if(!t.data||!t.data.aPosition||!t.data.aPosition.length)return null;const e={uv0Attribute:"aTexCoord0"};t.data.aAltitude&&(e.altitudeAttribute="aAltitude");const n=new Jv(t.data,t.indices,0,e);return FB(n.properties,t.properties),t.vertexColors&&(n.properties.vertexColors=t.vertexColors),this.material.uniforms.normalTexture&&!n.data[n.desc.tangentAttribute]&&n.data[n.desc.uv0Attribute]&&(n.data[n.desc.normalAttribute]||n.createNormal(),n.createTangent()),this.mr(n,t),{geometry:n,symbolIndex:{index:0}}}paint(t){const e=!!t.shadow;t.states&&t.states.includesChanged&&(this.shader.dispose(),delete this.shader,this.Po.dispose(),delete this.Po,this._r(t));let n=!!t.ssr&&this.getSymbols()[0].ssr;const i=this.shader,r=i.shaderDefines;if(n){const e=FB({},r,t.ssr.defines);i.shaderDefines=e}if(t.onlyUpdateDepthInTaa&&(this.shader=this.Po,!n&&this.To&&(this.shader=i,this.setToRedraw(!0))),this.updateIBLDefines(i),super.paint(t),void 0!==this.shadowCount&&e){const t=this.scene.getMeshes().length;this.shadowCount!==t&&this.setToRedraw()}this.shader=i,n&&(i.shaderDefines=r),delete this.shadowCount,this.To=n}updateSceneConfig(t){FB(this.sceneConfig,t),this.setToRedraw()}delete(){super.delete(),this.disposeIBLTextures(),this.material.dispose(),this.Po&&(this.Po.dispose(),delete this.Po)}init(t){this.getMap().on("updatelights",this.Io,this),this.createIBLTextures(),this.Tr=this.Tr||t,this.renderer=new j_(this.regl),this.Fo=this.Co.bind(this),this.Oo=this.disposeCachedTexture.bind(this),this.Eo=this.Do.bind(this),this.Ao(),this._r(t);const e={vert:"\n                #include <gl2_vert>\n                attribute vec3 aPosition;\n                uniform mat4 projViewModelMatrix;\n                uniform mat4 positionMatrix;\n                //引入fbo picking的vert相关函数\n                #include <line_extrusion_vert>\n                #include <get_output>\n                #include <fbo_picking_vert>\n                void main() {\n                    mat4 localPositionMatrix = getPositionMatrix();\n                    #ifdef IS_LINE_EXTRUSION\n                        vec3 linePosition = getLineExtrudePosition(aPosition);\n                        vec4 localVertex = getPosition(linePosition);\n                    #else\n                        vec4 localVertex = getPosition(aPosition);\n                    #endif\n\n                    gl_Position = projViewModelMatrix * localPositionMatrix * localVertex;\n                    fbo_picking_setData(gl_Position.w, true);\n                }\n            ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.pickingViewport,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<=",mask:!!BB(this.sceneConfig.depthMask)||this.sceneConfig.depthMask}}};this.picking=[new cw(this.renderer,e,this.layer.getRenderer().pickingFBO,this.getMap())]}_r(t){const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},n={},i=[];i.push(...Rx.getUniformDeclares()),this.fillIncludes(n,i,t);const r={cull:{enable:(t,e)=>!(e.geometryProperties.hasNegativeHeight||void 0!==this.sceneConfig.cullFace&&!this.sceneConfig.cullFace),face:()=>this.sceneConfig.cullFace||"back"},stencil:{enable:!1},viewport:e,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:(t,e)=>void 0===e.hasAlpha||!!e.hasAlpha,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}},o={uniforms:i,defines:this.Lo(n),extraCommandProps:r};this.shader=new Xw.StandardShader(o),o.frag="\n            precision mediump float;\n            #include <gl2_frag>\n            void main() {\n                glFragColor = vec4(0.0);\n                #if __VERSION__ == 100\n                    gl_FragColor = glFragColor;\n                #endif\n            }\n        ",this.Po=new Xw.StandardShader(o)}Co({resources:t}){for(let e=0;e<t.length;e++)this.addCachedTexture(t[e].url,t[e].data);this.setToRedraw(!0)}Do(){this.setToRedraw(!0)}Ao(t){if(t){const e=this.getSymbols()[0].material;e&&FB(e,t)}const e=this.layer instanceof lA,n=this.dataConfig,i=t||this.getSymbols()[0].material,r={};let o=!1;for(const s in i)if(XB(i,s))if(s.indexOf("Texture")>0){let t=i[s];if(!t){r[s]=void 0;continue}const e="string"==typeof t?t:t.url,a=this.getCachedTexture(e);a?a.then?e===t?t={promise:a,wrap:"repeat"}:t.promise=a:e===t?t={data:a,wrap:"repeat"}:t.data=a:e===t&&(t={url:e,wrap:"repeat"}),t.flipY=!n.upsideUpTexture,t.min="linear mipmap linear",t.mag="linear",r[s]=new sx(t,this.So),r[s].once("complete",this.Fo),r[s].once("disposed",this.Oo),r[s].promise&&this.addCachedTexture(e,r[s].promise),o=!0}else r[s]=i[s],"uvRotation"===s&&(r[s]=Math.PI*r[s]/180,e||(r[s]*=-1));if(void 0===r.alphaTest&&this.getMaterialClazz&&(r.alphaTest=.05),this.material){for(let t in r)this.material.set(t,r[t]);this.setToRedraw(!0)}else this.material=new Xw.StandardMaterial(r),this.material.once("complete",this.Eo);o||this.Do()}getShader(){return this.shader}getUniformValues(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=pV(t,n,i,e&&e.ssr,e&&e.jitter);return this.setIncludeUniformValues(r,e),r}Lo(t){return this.hasIBL()?t.HAS_IBL_LIGHTING=1:delete t.HAS_IBL_LIGHTING,t}Io(){if(!this.shader)return;const t=this.shader.shaderDefines;this.Lo(t),this.shader.shaderDefines=t}}var mV="#include <gl2_vert>\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\nuniform mat4 projViewModelMatrix;\nuniform vec2 centiMeterToLocal;\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec4 aTubeNormal;\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#include <vt_position_vert>\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#else\nuniform mat4 modelViewMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelMatrix;\n#if defined(HAS_PATTERN)\nuniform float resolution;\nuniform float tileResolution;\nuniform float tileRatio;\nattribute float aLinesofar;\nvarying highp float vLinesofar;\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvarying float vPatternHeight;\nattribute float aNormalDistance;\n#if defined(HAS_PATTERN_ANIM)\nattribute float aLinePatternAnimSpeed;\nvarying float vLinePatternAnimSpeed;\n#endif\n#if defined(HAS_PATTERN_GAP)\nattribute float aLinePatternGap;\nvarying float vLinePatternGap;\n#endif\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\n#endif\nvarying float vOpacity;\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\nvarying vec3 vModelVertex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\nvoid main() {\n  \n#ifdef HAS_LINE_WIDTH\nfloat c = aLineWidth;\n#else\nfloat c = lineWidth;\n#endif\nfloat d = c / 2.;\n  vec3 e = aTubeNormal.xyz / EXTRUDE_SCALE;\n  vec3 f = unpackVTPosition();\n  vec4 h = vec4(f, 1.);\n  h.xy += e.xy * d * centiMeterToLocal;\n  h.z += e.z * d;\n  gl_Position = projViewModelMatrix * h;\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#else\nvViewVertex = modelViewMatrix * h;\n  vec3 i = normalize(e);\n  vModelNormal = modelNormalMatrix * i;\n  vModelVertex = (modelMatrix * h).xyz;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(h);\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_PATTERN\nfloat j = tileResolution / resolution;\n  float k = aLinesofar - d * centiMeterToLocal.y * aNormalDistance / EXTRUDE_SCALE;\n  vLinesofar = k / tileRatio * j;\n  vTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n  vPatternHeight = c * centiMeterToLocal.x / tileRatio * j;\n  vNormalY = aTubeNormal.w / EXTRUDE_SCALE;\n#if defined(HAS_PATTERN_ANIM)\nvLinePatternAnimSpeed = aLinePatternAnimSpeed / 127.;\n#endif\n#if defined(HAS_PATTERN_GAP)\nvLinePatternGap = aLinePatternGap / 10.0;\n#endif\n#endif\nhighlight_setVarying();\n#endif\n}";const{getPBRUniforms:yV}=Xw.PBRUtils;class vV extends fj{needToRedraw(){return super.needToRedraw()||this.isAnimating()}isTerrainSkin(){return!1}isTerrainVector(){return!0}isUniqueStencilRefPerTile(){return!1}supportRenderMode(t){return this.isAnimating()?"fxaa"===t||"fxaaAfterTaa"===t:"taa"===t||"fxaa"===t}isAnimating(){if(this.Sr)return!0;const t=this.getSymbols();for(let e=0;e<t.length;e++)if(t[e].linePatternFile&&t[e].linePatternAnimSpeed)return!0;return!1}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).lineBloom}createMesh(t,e){if(!t.geometry)return null;const n=this.getMap(),{geometry:i,symbolIndex:r,ref:o}=t,s=this.getSymbolDef(r);void 0===o&&OH(i,s,this.getFnTypeConfig(r),this.layer);const a=this.getSymbol(r),{tileResolution:h,tileRatio:l}=i.properties,u={tileResolution:h,tileRatio:l};jB(u,"lineColor",a,"lineColor","#fff",VB(this.colorCache)),jB(u,"linePatternGapColor",a,"linePatternGapColor",[1,1,1,1],VB(this.colorCache)),jB(u,"lineWidth",a,"lineWidth",2,(t=>{var e;return("centimeter"===(e=this.dataConfig.metric)||"cm"===e?1:"millimeter"===e||"mm"===e?.1:100)*t})),jB(u,"lineOpacity",a,"lineOpacity",1),jB(u,"linePatternAnimSpeed",a,"linePatternAnimSpeed",0),jB(u,"linePatternGap",a,"linePatternGap",0),jB(u,"metallicFactor",a,"metallicFactor",0),jB(u,"roughnessFactor",a,"roughnessFactor",.4),jB(u,"emissiveFactor",a,"emissiveFactor",[0,0,0]),jB(u,"uvScale",a,"uvScale",[1,1]);const c=i.properties.iconAtlas,A=this.layer instanceof lA;c&&(u.linePatternFile=pj(this.regl,c,!1),u.atlasSize=c?[c.width,c.height]:[0,0],u.flipY=A?-1:1,this.drawDebugAtlas(c)),void 0===o&&i.generateBuffers(this.regl),u.alphaTest=-1;const f=new Xw.StandardMaterial(u),d=new z_(i,f,{castShadow:!1,picking:!0}),p=n.distanceToPointAtRes(100,100,i.properties.tileResolution)._multi(l/1e4).toArray();d.setUniform("centiMeterToLocal",p);const g=n.getResolution(n.getMaxNativeZoom());d.setUniform("animSpeedScale",h/g),d.setLocalTransform(e);const m={IS_LINE_EXTRUSION:1,HAS_LAYER_OPACITY:1};return"square-tube"===this.dataConfig.type&&(m.IS_SQUARE_TUBE=1),c&&(m.HAS_PATTERN=1),d.properties.symbolIndex=r,i.data.aColor&&(m.HAS_COLOR=1),this.setMeshDefines(m,i,s),i.data.aAltitude&&(m.HAS_ALTITUDE=1),d.setDefines(m),d}setMeshDefines(t,e,n){e.data.aOpacity&&(t.HAS_OPACITY=1),e.data.aLineWidth&&(t.HAS_LINE_WIDTH=1),UH(n.linePatternAnimSpeed)&&(t.HAS_PATTERN_ANIM=1),UH(n.linePatternGap)&&(t.HAS_PATTERN_GAP=1)}paint(t){t.states&&t.states.includesChanged.shadow&&(this.shader.dispose(),this.createShader(t)),super.paint(t)}init(t){if(this.getMap().on("updatelights",this.Io,this),this.createIBLTextures(),this.renderer=new j_(this.regl),this.createShader(t),this.pickingFBO){const t=[];this.picking=[new cw(this.renderer,{vert:"#define PICKING_MODE 1\n"+mV,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}},{name:"modelNormalMatrix",type:"function",fn:(e,n)=>Mp(t,n.modelMatrix)}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO,this.getMap())]}}createShader(t){this.Tr=t;const e=[],n={};this.fillIncludes(n,e,t),e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}}),this.shader=new Xw.StandardShader({vert:mV,uniforms:e,defines:this.Lo(n),extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.canvas;return{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!0,func:{cmp:()=>"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},cull:{enable:()=>!!this.sceneConfig.cullFace,face:this.sceneConfig.cullFace||"back"},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!0,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=yV(t,n,i,null,e&&e.jitter),o=t.viewMatrix;return r.projViewMatrix=t.projViewMatrix,r.viewMatrix=o,r.resolution=t.getResolution(),r.currentTime=this.layer.getRenderer().getFrameTimestamp()||0,this.setIncludeUniformValues(r,e),r}createFnTypeConfig(t,e){const n=OE(e.lineColor),i=OE(e.aLinePatternAnimSpeed),r=OE(e.aLinePatternGap),o=this.createShapeFnTypeConfigs(t,e),s=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return SE(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||bO(r).unitArray()),r=GB(r),r}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(e,n,r,o)=>{let a=i(t.getZoom(),e);return BB(a)&&(a=0),0!==a&&(n.properties.hasPatternAnim=1),s[0]=a/127,s[1]=r[o+1],s}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(e,n,i,o)=>{let a=r(t.getZoom(),e);return BB(a)&&(a=0),s[1]=10*a,s[0]=i[o],s}}].concat(o)}createShapeFnTypeConfigs(t,e){const n=EE(e.lineWidth),i=EE(e.lineOpacity),r=new Uint16Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(e,i)=>{let o=n(t.getZoom(),e);return SE(o)&&(o=this.evaluateInFnTypeConfig(o,i,t,e)),r[0]=Math.round(2*o),r[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let o=i(t.getZoom(),e);return SE(o)&&(o=this.evaluateInFnTypeConfig(o,n,t,e)),r[0]=255*o,r[0]}}]}Lo(t){return this.hasIBL()?t.HAS_IBL_LIGHTING=1:delete t.HAS_IBL_LIGHTING,t}Io(){if(!this.shader)return;const t=this.shader.shaderDefines;this.Lo(t),this.shader.shaderDefines=t}delete(){super.delete(),this.disposeIBLTextures(),this.shader&&(this.shader.dispose(),delete this.shader)}}const _V=[],xV=[],bV=[],wV=[],CV=[],PV=[0,0,0],MV=[0,0,0],TV=[1,1,1],SV=[],IV=[1,1,1,1],EV=[],OV=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],RV=t=>class extends t{constructor(t,e,n,i,r,o){super(t,e,n,i,r,o),this.Ro=!1,this.scene.sortFunction=this.sortByCommandKey;const s=i.fetchOptions||{};s.referrer=window&&window.location.href,this.Ho=new Pb(t,{fetchOptions:s,urlModifier:t=>{const n=e.getURLModifier();return n&&n(t)||t}}),this.zo(),this.No()}isUniqueStencilRefPerTile(){return!1}isAnimating(){const t=this.getSymbols();for(let e=0;e<t.length;e++)if(t[e]&&this.Vo[e]&&this.Uo(e))return!0;return!1}createGeometry(t,e){const{data:n,positionSize:i}=t;return{geometry:{properties:FB({},t.properties),data:n,positionSize:i,features:e},symbolIndex:t.symbolIndex}}getFnTypeConfig(){return SV}createMesh(t,e,{tileTranslationMatrix:n,tileExtent:i},{timestamp:r}){if(!this.Ro)return null;const o=this.getMap(),{geometry:s}=t,{positionSize:a,features:h}=s,{aPosition:l,aPickingId:u,aXYRotation:c,aZRotation:A,aAltitude:f}=s.data,d=l.length/a;if(0===d)return null;const p={instance_vectorA:new Float32Array(4*d),instance_vectorB:new Float32Array(4*d),instance_vectorC:new Float32Array(4*d),aPickingId:[]},g=this.jo(p,n,i,s.properties.z,l,f,c,A,a,u,h);s.data.aTerrainAltitude&&(p.aTerrainAltitude=s.data.aTerrainAltitude);const m={};for(const w in p)m[w]={buffer:this.regl.buffer({dimension:p[w].length/d,data:p[w]}),divisor:1};const y=this.Go(),v=this.Bo(),_=Np([]);Up(_,_,[v,v,v]);const x=[],b=this.getSymbols();for(let w=0;w<b.length;w++){const t=b[w],e=this.$o[w];if(!e)continue;const i=this.Vo[w][0],{fixSizeOnZoom:a}=t;let h=Np([]);y||(h=this.Wo(h));let l=0;e.forEach((e=>{const{geometry:n,nodeMatrix:i}=e;Hp(EV,OV,i),Hp(EV,h,EV);const r=Hp(EV,_,EV),o=n.boundingBox.copy();o.transform(r);const s=this.Xo(o,t);Math.abs(s)>Math.abs(l)&&(l=s)}));const u=[0,0,l],c=e.map(((e,c)=>{const{geometry:A,materialInfo:f,morphWeights:y,extraInfo:v,nodeIndex:x}=e;t.alphaTest&&(f.alphaTest=t.alphaTest);const b=new(this.getMaterialClazz(f))(f),C={},P=new B_(m,d,A,b,{transparent:!1,picking:!0});if(i.hasSkinAnimation()){const t=this.Yo(P,w,0)[x];P.setUniform("jointTexture",t.jointTexture),P.setUniform("jointTextureSize",t.jointTextureSize),P.setUniform("numJoints",t.numJoints),P.setUniform("skinAnimation",+this.Uo(w)),P.properties.startTime=r,C.HAS_SKIN=1}y&&(P.setUniform("morphWeights",y),C.HAS_MORPH=1),P.setUniform("hasAlpha",v.alphaMode&&"BLEND"===v.alphaMode.toUpperCase()),jB(P.uniforms,"polygonFill",t,"markerFill",IV,VB(this.colorCache)),jB(P.uniforms,"polygonOpacity",t,"markerOpacity",1);const M=[];P.setPositionMatrix((()=>{const t=this.qo(w,c,x);Hp(M,OV,t),Hp(M,h,M),Hp(M,_,M);const e=Np(EV);if(0!==l&&(Zp(e,u),Hp(M,e,M)),ZB(a)){const t=o.getGLScale()/o.getGLScale(a);return pg(_V,t,t,t),Qp(e,_V),Hp(e,e,M)}return M}));const T=this.layer.getRenderer().getZScale(),S=[],I=[];return P.setLocalTransform((()=>{const t=this.layer.options.altitude||0;return dg(I,g),I[2]+=100*t*T,jp(S,n,I),S})),A.generateBuffers(this.regl,{excludeElementsInVAO:!0}),p.instance_color&&(C.HAS_INSTANCE_COLOR=1),p.aTerrainAltitude&&(C.HAS_INSTANCE_TERRAIN_ALTITUDE=1,P.setUniform("terrainAltitudeScale",100*this.layer.getRenderer().getZScale())),C.HAS_LAYER_OPACITY=1,FB(P.properties,s.properties),P.setDefines(C),P.properties.symbolIndex={index:w},P}));x.push(...c)}return x.insContext={instanceData:p,tileTranslationMatrix:n,tileExtent:i,aPosition:l,positionSize:a},x}qo(t,e,n){const i=this.$o[t][e];return this.Uo(t)&&this.Jo&&this.Jo[n]||i.nodeMatrix}Yo(t,e,n){if(!this.Vo)return;const i=this.Vo[e][0];this.Ko||(this.Ko={}),this.Jo={},this.Ko[t.uuid]||(this.Ko[t.uuid]={});const r=this.getSymbols()[e],o=this.Zo[e],{loop:s,speed:a,animationName:h}=r;return i.updateAnimation(n,s||!1,a||1,h||o.animations[0].name,t.properties.startTime||0,this.Jo,this.Ko[t.uuid]),this.Ko[t.uuid]}Xo(t,e){const n=e.anchorZ||"center";let i=0;const r=t.max[2]-t.min[2];return"bottom"===n?i=r/2:"top"===n&&(i=-r/2),i}addMesh(t,e,n){if(!t)return null;if(t[0].properties.level>2)return null;const i=n.timestamp;for(let r=0;r<t.length;r++){if(!t[r]||!t[r].geometry)continue;t[r].instancedData.aTerrainAltitude&&this.$i(t[r],t[r].instancedData,t[r].properties,3,n);const e=t[r].properties.symbolIndex.index,o=this.Uo(e);o&&this.Yo(t[r],e,i),t[r].setUniform("skinAnimation",+o)}return this.scene.addMesh(t),this}gr(t,e){t&&t.updateInstancedData&&t.updateInstancedData("aTerrainAltitude",e)}prepareRender(t){const e=this.getSymbols();let n=!1;for(let i=0;i<e.length;i++)if(e[i]&&this.Vo[i]&&this.Uo(i)&&this.Vo[i]&&!n){n=!0;break}n&&this.setToRedraw(!0),super.prepareRender(t)}getShadowMeshes(){return this.isVisible()?(this.shadowCount=this.scene.getMeshes().length,this.scene.getMeshes().filter((t=>0===t.properties.level))):SV}Uo(t){const e=this.getSymbols()[t];return!!(e&&e.animation&&this.Vo[t]&&this.Vo[t][0]&&this.Vo[t][0].hasSkinAnimation())}jo(t,e,n,i,r,o,s,a,h,l,u){function c(e,n,i,r){t[e][4*n]=i[r],t[e][4*n+1]=i[r+4],t[e][4*n+2]=i[r+8],t[e][4*n+3]=i[r+12]}const A=r.length/h,f=this.layer.getTileSize().width/n*this.layer.getRenderer().getTileGLScale(i),d=this.layer.getRenderer().getZScale(),p=100*(this.dataConfig.altitudeOffset||0);let g=1/0,m=1/0,y=1/0,v=-1/0,_=-1/0,x=-1/0;const b=[],w=[];for(let E=0;E<A;E++){o?pg(w,r[E*h],r[E*h+1],o[E]):ZD(w,r[E*h],r[E*h+1],r[E*h+2]);const t=pg(b,w[0]*f,-w[1]*f,(w[2]+p)*d);t[0]<g&&(g=t[0]),t[0]>v&&(v=t[0]),t[1]<m&&(m=t[1]),t[1]>_&&(_=t[1]),t[2]<y&&(y=t[2]),t[2]>x&&(x=t[2])}const C=(g+v)/2,P=(m+_)/2,M=(y+x)/2,T=[],S=this.Go(),I=[0,0,1];for(let E=0;E<A;E++){o?pg(w,r[E*h],r[E*h+1],o[E]):ZD(w,r[E*h],r[E*h+1],r[E*h+2]);const e=w[0],n=w[1],i=pg(b,e*f-C,-n*f-P,(w[2]+p)*d-M),A=s&&s[E]||0,g=a&&a[E]||0;if(A||g){Xp(T,g,I);const t=pg(_V,e,n,0);Gp(T,T,A,Pg(t,Tg(t,t,I))),Hp(T,Zp(EV,i),T)}else Zp(T,i);S&&Hp(T,T,this.Wo(EV,u,l,E)),c("instance_vectorA",E,T,0),c("instance_vectorB",E,T,1),c("instance_vectorC",E,T,2),t.aPickingId[E]=E}return pg(b,C,P,M),b}Bo(){if(!this.Qo){const t=this.getMap();this.Qo=100*cB(t.getGLRes(),t)}return this.Qo}Wo(t,e,n,i){const r=this.getMap(),o=this.symbolDef[0],s=this.Bo();let a=o.translationX||0,h=o.translationY||0,l=o.translationZ||0,u=o.rotationX||0,c=o.rotationY||0,A=o.rotationZ||0,f=o.scaleX||1,d=o.scaleY||1,p=o.scaleZ||1;const g=e&&e[n&&n[i]],m=r.getZoom(),y=g&&g.feature&&g.feature.properties,v=this.ta(m,y);this.ea&&(a=this.ea(m,y)),this.na&&(h=this.na(m,y)),this.ia&&(l=this.ia(m,y));const _=pg(xV,a*s,h*s,l*s);this.ra&&(u=this.ra(m,y)),this.sa&&(c=this.sa(m,y)),this.oa&&(A=this.oa(m,y));const x=pg(bV,u,c,A);this.aa&&(f=this.aa(m,y)),this.la&&(d=this.la(m,y)),this.ha&&(p=this.ha(m,y));const b=pg(wV,f*v,d*v,p*v);return this.ua(t,_,x,b)}ta(t,e){const n=this.symbolDef[0];let i=this.ca?this.ca(t,e):n.modelHeight;if(aB(i))return 1;const r=this.fa[0];return i/Math.abs(r.max[1]-r.min[1])}getShaderConfig(){const t=super.getShaderConfig();return t.positionAttribute="POSITION",t.normalAttribute="NORMAL",t}init(t){super.init(t),this.No()}zo(){const t=this.symbolDef[0];SE(t.modelHeight)&&(this.ca=EE(t.modelHeight)),SE(t.translationX)&&(this.ea=EE(t.translationX)),SE(t.translationY)&&(this.na=EE(t.translationY)),SE(t.translationZ)&&(this.ia=EE(t.translationZ)),SE(t.rotationX)&&(this.ra=EE(t.rotationX)),SE(t.rotationY)&&(this.sa=EE(t.rotationY)),SE(t.rotationZ)&&(this.oa=EE(t.rotationZ)),SE(t.scaleX)&&(this.aa=EE(t.scaleX)),SE(t.scaleY)&&(this.la=EE(t.scaleY)),SE(t.scaleZ)&&(this.ha=EE(t.scaleZ))}Go(){return!!(this.ca&&!this.ca.isFeatureConstant||this.ea&&!this.ea.isFeatureConstant||this.na&&!this.na.isFeatureConstant||this.ia&&!this.ia.isFeatureConstant||this.ra&&!this.ra.isFeatureConstant||this.sa&&!this.sa.isFeatureConstant||this.oa&&!this.oa.isFeatureConstant||this.aa&&!this.aa.isFeatureConstant||this.la&&!this.la.isFeatureConstant||this.ha&&!this.ha.isFeatureConstant)}No(){if(this.Vo)return;this.Vo=[],this.Zo=[],this.fa=[],this.$o=[];const t=this.getSymbols();this.da=0;for(let e=0;e<t.length;e++){const n=t[e].url||"pyramid";this.Ho.loginGLTF(n);const i=this.Ho.getGLTF(n);if(i.then)i.then((n=>{if(!n.gltfPack)return this.da++,void(this.da>=t.length&&(this.Ro=!0,this.setToRedraw(!0)));const{gltfPack:i,json:r,bbox:o}=n;this.Vo[e]=[i],this.$o[e]=i.getMeshesInfo(),this.Zo[e]=r,this.fa[e]=o,this.da++,this.da>=t.length&&(this.Ro=!0),this.setToRedraw(!0)}));else{const{gltfPack:t,json:n,bbox:r}=i;t&&(this.Vo[e]=[t],this.$o[e]=t.getMeshesInfo(),this.Zo[e]=n,this.fa[e]=r,this.da++)}}this.da>=t.length&&(this.Ro=!0)}getPickingVert(){return"\n    attribute vec3 aPosition;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 modelMatrix;\n    uniform mat4 positionMatrix;\n    //引入fbo picking的vert相关函数\n    #include <fbo_picking_vert>\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        //传入gl_Position的depth值\n        fbo_picking_setData(gl_Position.w, true);\n    }"}deleteMesh(t){if(t){this.scene.removeMesh(t);for(let e=0;e<t.length;e++){const n=this.Ko&&this.Ko[t[e].uuid];if(n){for(const t in n)n[t].jointTexture&&n[t].jointTexture.destroy();delete this.Ko[t[e].uuid]}t[e].disposeInstancedData(),t[e].dispose()}}}delete(){super.delete();const t=this.getSymbols();for(let e=0;e<t.length;e++)this.Ho.logoutGLTF(t[e].url||"pyramid");if(this.Ko){for(const t in this.Ko){const e=this.Ko[t];for(const t in e)e[t].jointTexture&&e[t].jointTexture.destroy()}delete this.Ko}delete this.Jo}ua(t,e,n,i){const r=pg(_V,...e||PV),o=n||MV,s=i||TV;return tg(t,Sm(CV,o[0],o[1],o[2]),r,s)}};class DV extends(RV(AV)){getMaterialClazz(t){return t.diffuseFactor?L_:E_}}class kV extends(RV(gV)){getMaterialClazz(t){return t.specularGlossinessTexture||t.diffuseTexture?Xw.StandardSpecularGlossinessMaterial:Xw.StandardMaterial}}const{getPBRUniforms:LV}=Xw.PBRUtils,FV={color:[2.0303,2.028,2.028],direction:[0,-.2717,-1]},NV=.3737,zV={index:0},BV=[0,0,0],HV=[2,2];class jV extends fj{supportRenderMode(t){return"fxaa"===t||"fxaaBeforeTaa"===t}needPolygonOffset(){return!0}isTerrainSkin(){return!1}isTerrainVector(){return!0}needToRedraw(){return!!super.needToRedraw()||this.getSymbol(zV).animation}createMesh(t,e){const{geometry:n}=t;n.generateBuffers(this.regl);const i=new z_(n,null,{castShadow:!1,picking:!0});return i.properties.symbolIndex=zV,i.setLocalTransform(e),i}callShader(t,e){super.callShader(t,e),this.transformWater();const n=this.pa(this.getMap(),e);this.Xi+=this.renderer.render(this.ma,n,this.ya,this.getRenderFBO(e))}addMesh(t,e){this.Pr(t,e),super.addMesh(...arguments)}Pr(t){const e=this.getSymbol(zV).ssr;for(let n=0;n<t.length;n++)t[n].ssr=e?1:0}paint(t){t.states&&t.states.includesChanged&&(this.shader.dispose(),this.ma.dispose(),this._r(t));const e=!!t.ssr&&this.getSymbol(zV).ssr,n=this.ma,i=n.shaderDefines;if(e){const e=FB({},i,t.ssr.defines);n.shaderDefines=e}this.updateIBLDefines(n),this.ga.ssr=e?1:0,super.paint(t),e&&(n.shaderDefines=i)}isEnableTileStencil(){return!1}init(t){this.createIBLTextures(),this.renderer=new j_(this.regl),this.createGround(),this._r(t),this.pickingFBO&&(this.picking=[new cw(this.renderer,{vert:dj,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())]),this.va()}va(){const t=this.regl;this.xa||(this.xa=t.texture(2));const e=this.layer.getURLModifier(),n=this.getSymbol({index:0}),i=n.texWaveNormal,r=this.getCachedTexture(i),o=this;if(r)this.ba||(r.isLoading?setTimeout((()=>{this.shader&&this.va()}),20):this.ba=this.wa(t,r));else{const n=new Image;n.isLoading=!0,n.onload=function(){delete this.isLoading,o.ba=o.wa(t,this),o.setToRedraw()},n.onerror=()=>{console.error("invalid water wave normal texture:"+i)},this.addCachedTexture(i,n),n.src=e&&e(i)||i}const s=n.texWavePerturbation,a=this.getCachedTexture(s);if(a)this.Aa||(a.isLoading?setTimeout((()=>{this.va()}),20):this.Aa=this.wa(t,a));else{const n=new Image;n.isLoading=!0,n.onload=function(){delete this.isLoading,o.Aa=o.wa(t,this),o.setToRedraw()},n.onerror=()=>{console.error("invalid water wave perturbation texture:"+s)},this.addCachedTexture(s,n),n.src=e&&e(s)||s}}wa(t,e){return this.xa?t.texture({width:e.width,height:e.height,mag:"linear",min:"linear mipmap linear",wrapS:"repeat",wrapT:"repeat",flipY:!0,data:e}):null}_r(t){const e=this.canvas,n=[],i=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}},{name:"modelViewNormalMatrix",type:"function",fn:(t,e)=>{const n=Hp([],e.viewMatrix,e.modelMatrix),i=Bp(n,n);return Mp([],zp(i,i))}},{name:"modelViewMatrix",type:"function",fn:(t,e)=>Hp([],e.viewMatrix,e.modelMatrix)},{name:"environmentTransform",type:"function",fn:(t,e)=>Op(n,Math.PI*(e.environmentOrientation||0)/180)}],r={TIME_NOISE_TEXTURE_REPEAT:NV};this.fillIncludes(r,i,t);const o={x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1};this.shader=new mx({vert:"\n                attribute vec3 aPosition;\n\n                uniform mat4 projViewModelMatrix;\n                uniform float minAltitude;\n\n                void main() {\n                    vec3 position = aPosition;\n                    position.z += minAltitude * 100.0;\n                    gl_Position = projViewModelMatrix * vec4(position, 1.);\n                }\n            ",frag:"\n    #define SHADER_NAME WATER_STENCIL\n    precision mediump float;\n    void main() {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return Hp(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{viewport:o,colorMask:[!1,!1,!1,!1],stencil:{enable:!0,mask:255,func:{cmp:"<=",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}});const s={viewport:o,stencil:{enable:!0,mask:255,func:{cmp:"==",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!1}};i.push(...Rx.getUniformDeclares()),this.ma=new mx({vert:"#define SHADER_NAME WATER\nuniform mat4 modelMatrix;\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform vec2 uvOffset;\nuniform vec2 noiseUvOffset;\nuniform vec2 uvScale;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\n#ifdef HAS_SSR\nuniform mat4 modelViewMatrix;\nvarying vec4 vViewVertex;\n#endif\n#include <highlight_vert>\nmat3 c(in vec3 d) {\n  vec3 t = normalize(cross(d, vec3(.0, 1., .0)));\n  vec3 e = normalize(cross(d, t));\n  return mat3(t, e, d);\n}\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_vert>\n#endif\nconst vec3 f = vec3(0., 0., 1.);\nvoid main(void) {\n  vec4 h = vec4(aPosition, 1.);\n  vec4 i = modelMatrix * h;\n  vPos = i.xyz;\n  vTbnMatrix = c(f);\n  gl_Position = projViewModelMatrix * h;\n  vUv = aTexCoord * uvScale + uvOffset;\n  vNoiseUv = aTexCoord * uvScale * TIME_NOISE_TEXTURE_REPEAT + noiseUvOffset;\n#ifdef HAS_SSR\nvec4 j = modelViewMatrix * h;\n  vViewVertex = j;\n#endif\n#if defined(HAS_SHADOWING)\nshadow_computeShadowPars(h);\n#endif\nhighlight_setVarying();\n}",frag:"#define SHADER_NAME WATER\nprecision highp float;\nprecision highp sampler2D;\n#include <hsv_frag>\nuniform vec3 hsv;\nuniform float contrast;\nuniform float layerOpacity;\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform sampler2D brdfLUT;\nuniform mat3 environmentTransform;\nuniform vec3 diffuseSPH[9];\nvec3 c(const in vec3 d) {\n  vec3 e = environmentTransform * d;\n  float x = e.x;\n  float y = e.y;\n  float z = e.z;\n  vec3 f = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    f = hsv_apply(f, hdrHSV);\n  }\n  return max(f, vec3(.0));\n}\nvec3 h(const in vec3 i, const in float j, const in float k, const in float l) {\n  vec4 rgba = texture2D(brdfLUT, vec2(k, j));\n  float b = (rgba[3] * 65280.0 + rgba[2] * 255.);\n  float a = (rgba[1] * 65280.0 + rgba[0] * 255.);\n  const float m = 1. / 65535.;\n  return (i * a + b * l) * m;\n}\n#else\nuniform vec3 ambientColor;\n#endif\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nvec3 o(const in vec4 u, const in float v) {\n  if(v <= .0)\n    return u.rgb;\n  return v * u.rgb * u.a;\n}\n#ifdef HAS_SSR\nvarying vec4 vViewVertex;\nuniform mat3 modelViewNormalMatrix;\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nuniform vec2 cameraNearFar;\nfloat A(const in vec4 B) {\n  return B.r + B.g / 255.;\n}\nfloat C(const in vec2 D, const in float E) {\n  vec3 F = vec3(.06711056, .00583715, 52.9829189);\n  return fract(F.z * fract(dot(D.xy + E * vec2(47., 17.) * .695, F.xy))) * .5;\n}\nvec3 G(const in float H, const in float I, const in vec2 J) {\n  float K = min(I - .01, H);\n  float L = floor(K);\n  float M = min(I, L + 1.);\n  float N = pow(2., M);\n  vec2 O = 2. * N / J;\n  if(K - L > .5)\n    N *= 2.;\n  return vec3(O, N);\n}\nvec2 P(const in vec2 Q, const in vec3 R) {\n  vec2 S = max(R.xy, min(1. - R.xy, Q));\n  return vec2(2. * S.x, R.z - 1. - S.y) / R.z;\n}\nvec3 T(const in mat4 U, const in vec3 V) {\n  vec4 W = U * vec4(V, 1.);\n  return vec3(.5 + .5 * W.xy / W.w, W.w);\n}\nvec3 X(const in float Y, const in vec2 S) {\n  return texture2D(TextureReflected, S).rgb;\n}\nfloat Z(float ba) {\n  highp mat4 U = projMatrix;\n  highp float z = ba * 2. - 1.;\n  return -U[3].z / (z + U[2].z);\n}\nfloat bb(const vec2 S) {\n  float ba = A(texture2D(TextureDepth, S));\n  return ba;\n}\nvec3 bc(const in float E, const in vec3 bd, const in vec3 be, const in vec3 bf, const in vec3 bg, const in float bh) {\n  vec2 bi;\n  bi.x = C(gl_FragCoord.yx, E);\n  bi.y = fract(bi.x * 52.9829189);\n  bi.y = mix(bi.y, 1., .7);\n  float bj = 2. * 3.14159 * bi.x;\n  float bk = pow(max(bi.y, .000001), bh / (2. - bh));\n  float bl = sqrt(1. - bk * bk);\n  vec3 bm = vec3(bl * cos(bj), bl * sin(bj), bk);\n  bm = bm.x * bd + bm.y * be + bm.z * bf;\n  return normalize((2. * dot(bg, bm)) * bm - bg);\n}\nfloat bn(const in float E) {\n  return (C(gl_FragCoord.xy, E) - .5);\n}\nvec3 bo(const in vec3 bp, const in float bq, const in vec3 br) {\n  vec3 bs = T(projMatrix, vViewVertex.xyz + br * bq);\n  bs.z = 1. / bs.z;\n  bs -= bp;\n  float bt = min(1., .99 * (1. - bp.x) / max(1e-5, bs.x));\n  float bu = min(1., .99 * (1. - bp.y) / max(1e-5, bs.y));\n  float bv = min(1., .99 * bp.x / max(1e-5, -bs.x));\n  float bw = min(1., .99 * bp.y / max(1e-5, -bs.y));\n  return bs * min(bt, bu) * min(bv, bw);\n}\nfloat bx(const in vec3 bp, const in vec3 bs, inout float by, inout float bz) {\n  float bA = (bz + by) * .5;\n  vec3 bB = bp + bs * bA;\n  float z = bb(bB.xy);\n  float ba = Z(z);\n  float bC = -1. / bB.z;\n  by = ba > bC ? by : bA;\n  bz = ba > bC ? bA : bz;\n  return bA;\n}\nvec4 bD(const in vec3 bp, const in float bq, in float bE, const in vec3 br, const in float j, const in float E) {\n  const int bF = 20;\n  float bG = 1. / float(bF);\n  bE *= bG;\n  vec3 bs = bo(bp, bq, br);\n  float bH = bG;\n  vec3 bI = vec3(.0, bH, 1.);\n  vec3 bB;\n  float z, ba, bC, bJ, bK, bL;\n  bool bM;\n  float bN = 1.;\n  float bA;\n  for(int bO = 0; bO < bF; bO++) {\n    bB = bp + bs * bI.y;\n    z = bb(bB.xy);\n    ba = Z(z);\n    bC = -1. / bB.z;\n    bJ = bC - ba;\n    bJ *= clamp(sign(abs(bJ) - bq * bG * bG), .0, 1.);\n    bM = abs(bJ + bE) < bE;\n    bK = clamp(bI.x / (bI.x - bJ), .0, 1.);\n    bL = bM ? bI.y + bK * bG - bG : 1.;\n    bI.z = min(bI.z, bL);\n    bI.x = bJ;\n    if(bM) {\n      float by = bI.y - bG;\n      float bz = bI.y;\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bN = bA;\n      break;\n    }\n    bI.y += bG;\n  }\n  return vec4(bp + bs * bN, 1. - bN);\n}\nvec3 bP(in vec4 bQ, const in float bR, const in vec3 bS, const in vec3 bT, const in float j) {\n  vec4 bU = mix(outputFovInfo[0], outputFovInfo[1], bQ.x);\n  bQ.xyz = vec3(mix(bU.xy, bU.zw, bQ.y), 1.) * -1. / bQ.z;\n  bQ.xyz = (reprojViewProjMatrix * vec4(bQ.xyz, 1.)).xyw;\n  bQ.xy /= bQ.z;\n  float bV = clamp(6. - 6. * max(abs(bQ.x), abs(bQ.y)), .0, 1.);\n  bQ.xy = .5 + .5 * bQ.xy;\n  return vec3(bQ.xy, 1.);\n}\nvec3 ssr(const in vec3 bS, const in vec3 bT, const in float j, const in vec3 d, const in vec3 bg) {\n  float bW = .0;\n  vec4 f = vec4(.0);\n  float bh = j * j;\n  bh = bh * bh;\n  vec3 bX = abs(d.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 bd = normalize(cross(bX, d));\n  vec3 be = cross(d, bd);\n  float bR = ssrFactor * clamp(-4. * dot(bg, d) + 3.8, .0, 1.);\n  bR *= clamp(4.7 - j * 5., .0, 1.);\n  vec3 bp = T(projMatrix, vViewVertex.xyz);\n  bp.z = 1. / bp.z;\n  vec3 br = bc(bW, bd, be, d, bg, bh);\n  float bq = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, br.z * .5 + .5);\n  float bE = .5 * bq;\n  vec4 bQ;\n  if(dot(br, d) > .001 && bR > .0) {\n    bQ = bD(bp, bq, bE, br, j, bW);\n    if(bQ.w > .0)\n      return bP(bQ, bR, bS, bT, j);\n    \n  }\n  return vec3(.0);\n}\n#endif\nconst vec3 bY = vec3(0., 0., 1.);\nuniform mat4 viewMatrix;\nuniform sampler2D normalTexture;\nuniform sampler2D heightTexture;\nuniform vec4 waveParams;\nuniform vec2 waterDir;\nuniform vec4 waterBaseColor;\nuniform vec3 lightDirection;\nuniform vec3 lightColor;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\nfloat bZ(vec3 e, float ca) {\n  float cb = max(.015, ca);\n  return max((e.x + e.y) * .3303545 / cb + .3303545, .0);\n}\nconst vec2 cc = vec2(6. / 25., 5. / 24.);\nvec2 cd(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rg - 1.;\n}\nfloat cf(vec2 S) {\n  return texture2D(heightTexture, S).b;\n}\nvec3 cg(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rgb - 1.;\n}\nfloat ch(vec2 S, float ci) {\n  return fract(ci);\n}\nfloat cj(vec2 S, float ci) {\n  float ck = ch(S, ci);\n  return 1. - abs(1. - 2. * ck);\n}\nvec3 cl(sampler2D cm, vec2 S, float ci, float cn) {\n  float co = waveParams[2];\n  float cp = waveParams[3];\n  vec2 cq = cd(cm, S) * co;\n  float ck = ch(S, ci + cn);\n  float cr = cj(S, ci + cn);\n  vec2 f = S;\n  f -= cq * (ck + cp);\n  f += cn;\n  f += (ci - ck) * cc;\n  return vec3(f, cr);\n}\nconst float cs = 7.77;\nvec3 ct(sampler2D cu, sampler2D cv, vec2 cw, vec2 cx, float ci) {\n  float ca = waveParams[0];\n  vec2 cy = ci * -cx;\n  float cz = cf(vNoiseUv) * cs;\n  vec3 cA = cl(cv, cw + cy, ci + cz, .0);\n  vec3 cB = cl(cv, cw + cy, ci + cz, .5);\n  vec3 cC = cg(cu, cA.xy) * cA.z;\n  vec3 cD = cg(cu, cB.xy) * cB.z;\n  vec3 cE = normalize(cC + cD);\n  cE.xy *= ca;\n  cE.z = sqrt(1. - dot(cE.xy, cE.xy));\n  return cE;\n}\nvec4 cF(vec2 cw, float cG) {\n  float cH = waveParams[1];\n  vec3 d = ct(normalTexture, heightTexture, cw * cH, waterDir, cG);\n  float cI = bZ(d, waveParams[0]);\n  return vec4(d, cI);\n}\nconst float cJ = 3.141592653589793;\nconst float cK = 1. / cJ;\nconst float cL = .3183098861837907;\nconst float cM = 1.570796326794897;\nconst float cN = .4;\nfloat cO = 2.2;\nvec3 cP(float cQ, vec3 cR, float l) {\n  return cR + (l - cR) * pow(1. - cQ, 5.);\n}\nfloat cS(float cT, float j) {\n  float cU = j * j;\n  float cV = cT * cT;\n  float cW = pow((cV * (cU - 1.) + 1.), cO) * cJ;\n  return cU / cW;\n}\nfloat cX(float cY) {\n  return .25 / (cY * cY);\n}\nvec3 cZ(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float da = 2.2;\nconst float db = .4545454545;\nvec4 dc(vec4 u) {\n  return vec4(pow(u.rgb, vec3(db)), u.w);\n}\nvec3 dd(vec3 u) {\n  return pow(u, vec3(da));\n}\nconst vec3 de = vec3(.02, 1., 5.);\nconst vec2 df = vec2(.02, .1);\nconst float j = .06;\nconst float dg = 1.7;\nconst vec3 dh = vec3(0, .6, .9);\nconst vec3 di = vec3(.72, .92, 1.);\nconst float dj = .65;\nconst float dk = 300000.0;\nconst float dl = 500000.0;\nconst float dm = .775;\nconst float dn = .8;\nPBRShadingWater dp;\nvec3 dq(in PBRShadingWater dr, float j, vec3 ds, float dt) {\n  vec3 du = cP(dr.VdotH, ds, dt);\n  float dv = cS(dr.NdotH, j);\n  float dw = cX(dr.LdotH);\n  float dx = mix(j + .045, j + .385, 1. - dr.VdotH);\n  float dy = 1.2;\n  float dz = cS(dr.NdotH, dx) * dy;\n  return ((dv + dz) * dw) * du;\n}\nvec3 dA(float dg, float dB, vec3 dh, float dC) {\n  return dg * (.075 * dh * pow(dB, 4.) + 50. * pow(dB, 23.)) * dC;\n}\nvec3 dD(in float bk, in vec3 dE, in vec3 dF) {\n  float dG = pow((1. - bk), de[2]);\n  return mix(dF, dE, dG);\n}\nvec3 dH(in vec3 e, in vec3 dI, in float dJ, in float j) {\n  \n#ifdef HAS_IBL_LIGHTING\nvec3 dK = reflect(-dI, e);\n  vec3 dL = textureCube(prefilterMap, environmentTransform * dK).rgb;\n  float dM = clamp(1. + dot(dK, e), .0, 1.);\n  dL *= dM * dM;\n  vec3 i = dL;\n  vec3 dN = c(e);\n  float l = clamp(50.0 * waterBaseColor.g, .0, 1.);\n  vec3 dO = h(waterBaseColor.rgb, j, dot(e, dI), l);\n  return i * dO + dN;\n#else\nvec3 dP = dd(di);\n  vec3 dQ = dd(dh);\n  vec3 di = dD(dJ, dP, dQ);\n  return di;\n#endif\n}\nvec3 dR(in vec3 e, in vec3 dI, in vec3 dS, vec3 u, in vec3 dT, in vec3 dU, in float dV, float dW, vec3 dX) {\n  float dY = 0.;\n  vec3 dZ = dd(u);\n  vec3 bm = normalize(dS + dI);\n  dp.NdotL = clamp(dot(e, dS), .0, 1.);\n  dp.NdotV = clamp(dot(e, dI), .001, 1.);\n  dp.VdotN = clamp(dot(dI, e), .001, 1.);\n  dp.NdotH = clamp(dot(e, bm), .0, 1.);\n  dp.VdotH = clamp(dot(dI, bm), .0, 1.);\n  dp.LdotH = clamp(dot(dS, bm), .0, 1.);\n  float dJ = max(dot(dU, dI), .0);\n  vec3 di = dH(e, dI, dJ, j);\n  float ea = max(dot(dU, dS), .0);\n  float eb = .1 + ea * .9;\n  di *= eb;\n  float ec = clamp(dV, .8, 1.);\n  vec3 ed = cP(dp.VdotN, vec3(de[0]), de[1]);\n  vec3 ee = ed * di * ec;\n  vec3 ef = dZ * mix(di, ea * dT * cK, 2. / 3.) * ec;\n  vec3 i = vec3(.0);\n  if(dJ > .0 && ea > .0) {\n    vec3 eg = dq(dp, j, vec3(df[0]), df[1]);\n    vec3 eh = dT * cK * dV;\n    i = dp.NdotL * eh * eg;\n  }\n  vec3 cI = vec3(.0);\n  if(dJ > .0) {\n    cI = dA(dg, dW, dh, eb);\n  }\n  vec3 ei = vec3(.0);\n#ifdef HAS_SSR\nfloat ej = smoothstep(dl, dk, -dX.z);\n  mat4 ek = viewMatrix;\n  vec4 el = vec4(dX.xyz, 1.);\n  vec3 em = normalize(el.xyz);\n  vec4 en = ek * vec4(e, .0);\n  vec3 eo = normalize(en.xyz);\n  vec4 ep = ek * vec4(dU, .0);\n  float eq = pow(max(dot(-em, ep.xyz), .0), cN);\n  vec3 er = mix(ep.xyz, eo, eq);\n  vec3 es = ssr(vec3(.0), vec3(1.), j, normalize(er), -normalize(vViewVertex.xyz));\n  if(es.z > .0) {\n    vec2 et = smoothstep(.3, .6, abs(vec2(.5) - es.xy));\n    dY = dm * clamp(1. - 1.3 * et.y, .0, 1.) * ej;\n    vec3 eu = X(.0, es.xy);\n    ei = dd(eu) * dY * ed.y * dj;\n  }\n#endif\nfloat ev = mix(dn, dn * .5, dY);\n  return cZ((1. - dY) * ee + ei + ef * ev + i + cI);\n}\nvoid main() {\n  vec3 dU = bY;\n  vec4 ew = cF(vUv, timeElapsed);\n  vec3 e = normalize(vTbnMatrix * ew.xyz);\n  vec3 dI = -normalize(vPos - camPos);\n  vec3 dS = normalize(-lightDirection);\n#if defined(HAS_SHADOWING)\nfloat dV = shadow_computeShadow();\n#else\nfloat dV = 1.;\n#endif\nvec4 ex = viewMatrix * vec4(vPos, 1.);\n  vec4 ey = vec4(dR(e, dI, dS, waterBaseColor.rgb, lightColor, dU, dV, ew.w, ex.xyz), waterBaseColor.a);\n  gl_FragColor = dc(ey);\n  if(contrast != 1.) {\n    gl_FragColor = contrastMatrix(contrast) * gl_FragColor;\n  }\n  if(length(hsv) > .0) {\n    gl_FragColor = hsv_apply(gl_FragColor, hsv);\n  }\n  gl_FragColor = highlight_blendColor(gl_FragColor) * layerOpacity;\n}",defines:r,uniforms:i,extraCommandProps:s})}getUniformValues(t){return{projViewMatrix:t.projViewMatrix,minAltitude:this.layer.options.altitude||0}}pa(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=LV(t,n,i,e&&e.ssr,e&&e.jitter),o=t.getLightManager();let s=o&&o.getDirectionalLight()||{};const a=o&&o.getAmbientLight()||{},h=this.getSymbol(zV),l=this.Ma=this.Ma||[],u=this._a=this._a||[];qg(u,.09,h.uvScale||3,.03,-.5),FB(r,{ambientColor:a.color||[.2,.2,.2],viewMatrix:t.viewMatrix,lightDirection:s.direction||FV.direction,lightColor:s.color||FV.color,camPos:t.cameraPosition,timeElapsed:h.animation?(this.layer.getRenderer().getFrameTimestamp()||0)/(1/(h.waterSpeed||1)*1e4):0,normalTexture:this.ba||this.xa,heightTexture:this.Aa||this.xa,waveParams:u,waterDir:UV(l,h.waterDirection||0),waterBaseColor:h.waterBaseColor||[.1451,.2588,.4863,1],contrast:h.contrast||1,hsv:h.hsv||BV});const c=this.layer.getRenderer();return r.layerOpacity=c.Xn(),this.setIncludeUniformValues(r,e),e&&e.ssr&&e.ssr.renderUniforms&&FB(r,e.ssr.renderUniforms),r}delete(){super.delete(),this.xa&&(this.xa.destroy(),delete this.xa),this.ba&&this.ba.destroy(),this.Aa&&this.Aa.destroy(),this.shader&&(this.shader.dispose(),delete this.shader),this.ma&&this.ma.dispose(),this.ga&&(this.ga.geometry.dispose(),this.ga.material&&this.ga.material.dispose(),this.ga.dispose(),delete this.ga),this.disposeIBLTextures()}createGround(){const t=new ax;t.data.aTexCoord=new Uint8Array([0,1,1,1,0,0,1,0]),t.generateBuffers(this.renderer.regl),this.ga=new z_(t,null,{castShadow:!1}),this.ya=new Y_([this.ga])}transformWater(){const t=this.getMap(),e=WM.getGroundTransform(this.ga.localTransform,t);this.ga.setLocalTransform(e);const n=t._get2DExtentAtRes(t.getGLRes()),i=n.getWidth(),r=n.getHeight(),o=t.cameraLookAt,s=(o[0]-i)/HV[0],a=(o[1]+r)/HV[1],h=s*NV%1,l=a*NV%1,u=i/HV[0]*2,c=r/HV[1]*2;this.ga.setUniform("uvOffset",[s%1,a%1]),this.ga.setUniform("noiseUvOffset",[h,l]),this.ga.setUniform("uvScale",[u,-c])}}function UV(t,e){return e=Math.PI*e/180,t[0]=Math.sin(e),t[1]=Math.cos(e),t}const GV=TH("fill",Mj);GV.registerAt(gH);const VV=TH("line",Ej);VV.registerAt(gH);const WV=TH("line-gradient",Oj);WV.registerAt(gH);const qV=TH("icon",sG);qV.registerAt(gH);const ZV=TH("text",WG);ZV.registerAt(gH);const QV=TH("native-line",$G);QV.registerAt(gH),TH("native-point",YG).registerAt(gH);const XV=TH("phong",AV);XV.registerAt(gH);const YV=TH("wireframe",dV);YV.registerAt(gH);const JV=TH("lit",gV);JV.registerAt(gH);const KV=TH("tube",vV);KV.registerAt(gH);const $V=TH("gltf-phong",DV);$V.registerAt(gH);const tW=TH("gltf-lit",kV);tW.registerAt(gH);const eW=TH("heatmap",class extends fj{createFnTypeConfig(t,e){const n=EE(e.heatmapWeight),i=new Int16Array(1);return[{attrName:"aWeight",symbolName:"heatmapWeight",type:Int16Array,width:1,define:"HAS_HEAT_WEIGHT",evaluate:e=>{const r=n(t.getZoom(),e);return i[0]=255*r,i[0]}}]}createMesh(t,e){const{geometry:n,symbolIndex:i,ref:r}=t;void 0===r&&OH(n,this.getSymbolDef(i),this.getFnTypeConfig(i),this.layer);const o=this.getSymbol(i),s={tileRatio:n.properties.tileRatio,dataResolution:n.properties.tileResolution};jB(s,"heatmapIntensity",o,"heatmapIntensity",1),jB(s,"heatmapRadius",o,"heatmapRadius",6),jB(s,"heatmapWeight",o,"heatmapWeight",1),jB(s,"heatmapOpacity",o,"heatmapOpacity",1),n.generateBuffers(this.regl);const a=new T_(s),h=new z_(n,a,{transparent:!0,castShadow:!1,picking:!0}),l={};return n.data.aWeight&&(l.HAS_HEAT_WEIGHT=1),h.setDefines(l),h.setLocalTransform(e),h.properties.symbolIndex=i,h}callRenderer(t,e,n){const i=this.getRenderFBO(n);this.Xi+=this.Sa.render(this.scene,e,i)}getUniformValues(t){const e=this.getSymbol({index:0}),{projViewMatrix:n}=t;return{glScale:1/t.getGLScale(),resolution:t.getResolution(),projViewMatrix:n,heatmapOpacity:e.heatmapOpacity}}getHeatmapMeshes(){return this.scene.getMeshes()}delete(){super.delete(...arguments),this.Sa.dispose(),delete this.Sa}init(){this.renderer=new j_(this.regl);const t=this.getPolygonOffset(),e=this.getSymbols()[0];this.Sa=new qI(this.regl,this.sceneConfig,this.layer,e.heatmapColor,null,t)}});eW.registerAt(gH);const nW=TH("water",jV);nW.registerAt(gH),wH.registerPainter("lit",gV),wH.registerPainter("icon",sG),wH.registerPainter("fill",Mj),wH.registerPainter("line",Ej),wH.registerPainter("line-gradient",Oj),wH.registerPainter("water",jV),wH.registerPainter("tube",vV);class iW extends gH{getTileUrl(t,e,n){const i=this.getMap().getResolution(n);return super.getTileUrl(t,e,(r=i,19-Math.log(r/rW)/Math.LN2));var r}static fromJSON(t){return t&&"MapboxVectorTileLayer"===t.type?new iW(t.id,t.options):null}}iW.registerJSONType("MapboxVectorTileLayer");const rW=12756274*Math.PI/(256*Math.pow(2,20));class oW extends gH{constructor(t,e){(e=e||{}).spatialReference=null,super(t,e),this.setData(e.data)}onAdd(){this.Jn()}Jn(){const t=this.getMap(),e=t.getMaxNativeZoom(),n=t.getProjection(),i="EPSG:4326"===n.code||"EPSG:4490"===n.code;var r,o;i&&(this.options.tileSystem=[1,-1,-180,90]),this.options.spatialReference=i?(o=e,{projection:n.code,fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){const t=[];for(let e=0;e<=o+1;e++)t[e]=90/(128*Math.pow(2,e));return t}()}):(r=e,{projection:"EPSG:3857",resolutions:function(){const t=[],e=6378137*Math.PI;for(let n=0;n<=r+1;n++)t[n]=e/(256*Math.pow(2,n));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}})}getWorkerOptions(){const t=super.getWorkerOptions();let e=this.options.data;return iB(e)||e&&e.url?(e.url&&(e=JSON.parse(JSON.stringify(e))),e=aW(e,this.getURLModifier())):e=this.features,t.data=e,t.tileBuffer=this.options.tileBuffer,t.extent=this.options.extent,t.hasAltitude=this.options.enableAltitude,t.simplifyTolerance=this.options.simplifyTolerance,t.projection=this.getSpatialReference().getProjection().code,t.generateOMBB=this.options.generateOMBB,t.convertFn=this.options.convertFn?this.options.convertFn+"":null,t}setData(t){return this.options.data=t,t&&(iB(t)||t.url)?(!!this.getRenderer()&&this.ka(),this):(this.Pa(t),this.ka(),this)}Pa(t){return this.options.convertFn&&(t=new Function("data",this.options.convertFn+"\nreturn convert(data)")(t)),this.features=t,this.Ta(),this}ka(){const t=this.getRenderer();if(t){const e=t.getWorkerConnection();if(e){let n=this.options.data;iB(n)||n&&n.url?(n.url&&(n=JSON.parse(JSON.stringify(n))),n=aW(n,this.getURLModifier())):n=this.features,e.setData(n,((e,n)=>{t.clear(),this.onWorkerReady(null,n),t.setToRedraw(),setTimeout((()=>{t.setToRedraw()}),500)}))}}}getExtent(){return this.Ia}onWorkerReady(t,e){t?this.fire("dataerror",{error:t}):(e&&(e.extent&&this.Fa(e.extent),e.idMap&&(this.Ca=e.idMap)),this.fire("dataload",{extent:e&&e.extent}))}Fa(t){this.Ia=new fs(...t)}Oa(t,e){iB(t)?dB.getJSON(t,e):dB.getJSON(t.url,t,e)}getData(){return this.features||null}getTileUrl(t,e,n){return this.getId()+","+t+","+e+","+n}getFeature(t){return this.Ca[t]}static fromJSON(t){return t&&"GeoJSONVectorTileLayer"===t.type?new oW(t.id,t.options):null}getGeometryById(t){return this.Ca?this.Ca[t]:null}Ta(){if(!this.features)return;if(this.features=JSON.parse(JSON.stringify(this.features)),!this.features)return;let t=0;this.Ca={};const e=this.options.featureIdProperty,n=this.features;Array.isArray(n)?n.forEach((n=>{if(n){if(rB(n.id)||(n.id=t++),e){let t=e;sB(e)&&(t=e[n.layer||"0"]),n.id=n.properties[t]}this.Ca[n.id]=n}})):n.features&&n.features.forEach((n=>{if(n){if(rB(n.id)||(n.id=t++),e){let t=e;sB(e)&&(t=e[n.layer||"0"]),n.id=n.properties[t]}this.Ca[n.id]=n}}))}}function sW(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}function aW(t,e){return t.url?t.url=e?e(t.url):sW(t.url):t=e?e(t):sW(t),t}oW.registerJSONType("GeoJSONVectorTileLayer"),oW.mergeOptions({features:"id",tileBuffer:64,extent:8192,pyramidMode:1,simplifyTolerance:3,tileStackDepth:0,generateOMBB:!0});const hW={markerFile:{type:"identity",default:null,property:"_symbol_markerFile"},markerWidth:{type:"identity",default:null,property:"_symbol_markerWidth"},markerHeight:{type:"identity",default:null,property:"_symbol_markerHeight"},markerPathWidth:{type:"identity",default:20,property:"_symbol_markerPathWidth"},markerPathHeight:{type:"identity",default:20,property:"_symbol_markerPathHeight"},markerDx:{type:"identity",default:null,property:"_symbol_markerDx"},markerDy:{type:"identity",default:null,property:"_symbol_markerDy"},markerType:{type:"identity",default:null,property:"_symbol_markerType"},markerPath:{type:"identity",default:null,property:"_symbol_markerPath"},markerFill:{type:"identity",default:null,property:"_symbol_markerFill"},markerFillPatternFile:{type:"identity",default:null,property:"_symbol_markerFillPatternFile"},markerFillOpacity:{type:"identity",default:null,property:"_symbol_markerFillOpacity"},markerLineColor:{type:"identity",default:null,property:"_symbol_markerLineColor"},markerLineWidth:{type:"identity",default:null,property:"_symbol_markerLineWidth"},markerLineOpacity:{type:"identity",default:null,property:"_symbol_markerLineOpacity"},markerLineDasharray:{type:"identity",default:null,property:"_symbol_markerLineDasharray"},markerLinePatternFile:{type:"identity",default:null,property:"_symbol_markerLinePatternFile"},markerVerticalAlignment:{type:"identity",default:"top",property:"_symbol_markerVerticalAlignment"},markerHorizontalAlignment:{type:"identity",default:"middle",property:"_symbol_markerHorizontalAlignment"},markerOpacity:{type:"identity",default:1,property:"_symbol_markerOpacity"},markerPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_markerPitchAlignment"},markerRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_markerRotationAlignment"},markerRotation:{type:"identity",default:0,property:"_symbol_markerRotation"},markerAllowOverlap:{type:"identity",default:0,property:"_symbol_markerAllowOverlap"},markerIgnorePlacement:{type:"identity",default:0,property:"_symbol_markerIgnorePlacement"},markerTextFit:{type:"identity",default:null,property:"_symbol_markerTextFit"},markerSpacing:{type:"identity",default:250,property:"_symbol_markerSpacing"},markerTextFitPadding:{type:"identity",default:null,property:"_symbol_markerTextFitPadding"},markerPlacement:{type:"identity",default:"point",property:"_symbol_markerPlacement"}},lW={textName:{type:"identity",default:null,property:"_symbol_textName"},textFaceName:{type:"identity",default:null,property:"_symbol_textFaceName"},textWrapWidth:{type:"identity",default:null,property:"_symbol_textWrapWidth"},textHorizontalAlignment:{type:"identity",default:null,property:"_symbol_textHorizontalAlignment"},textVerticalAlignment:{type:"identity",default:null,property:"_symbol_textVerticalAlignment"},textFill:{type:"identity",default:null,property:"_symbol_textFill"},textSize:{type:"identity",default:null,property:"_symbol_textSize"},textHaloRadius:{type:"identity",default:null,property:"_symbol_textHaloRadius"},textHaloFill:{type:"identity",default:null,property:"_symbol_textHaloFill"},textHaloOpacity:{type:"identity",default:1,property:"_symbol_textHaloOpacity"},textDx:{type:"identity",default:0,property:"_symbol_textDx"},textDy:{type:"identity",default:0,property:"_symbol_textDy"},textOpacity:{type:"identity",default:1,property:"_symbol_textOpacity"},textPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_textPitchAlignment"},textRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_textRotationAlignment"},textRotation:{type:"identity",default:0,property:"_symbol_textRotation"},textAllowOverlap:{type:"identity",default:0,property:"_symbol_textAllowOverlap"},textIgnorePlacement:{type:"identity",default:0,property:"_symbol_textIgnorePlacement"},textSpacing:{type:"identity",default:250,property:"_symbol_textSpacing"},textPlacement:{type:"identity",default:"point",property:"_symbol_textPlacement"}},uW={lineWidth:{type:"identity",default:2,property:"_symbol_lineWidth"},lineStrokeWidth:{type:"identity",default:0,property:"_symbol_lineStrokeWidth"},lineColor:{type:"identity",default:[1,1,1,1],property:"_symbol_lineColor"},lineStrokeColor:{type:"identity",default:[0,0,0,0],property:"_symbol_lineStrokeColor"},lineDx:{type:"identity",default:0,property:"_symbol_lineDx"},lineDy:{type:"identity",default:0,property:"_symbol_lineDy"},linePatternFile:{type:"identity",default:null,property:"_symbol_linePatternFile"},linePatternAnimSpeed:{type:"identity",default:0,property:"_symbol_linePatternAnimSpeed"},linePatternGap:{type:"identity",default:0,property:"_symbol_linePatternGap"},lineOpacity:{type:"identity",default:1,property:"_symbol_lineOpacity"},lineJoin:{type:"identity",default:null,property:"_symbol_lineJoin"},lineCap:{type:"identity",default:null,property:"_symbol_lineCap"},lineDasharray:{type:"identity",default:null,property:"_symbol_lineDasharray"},lineDashColor:{type:"identity",default:null,property:"_symbol_lineDashColor"}},cW="_line_gradient_property",AW=new ht(0,0),fW="_vector3dlayer_id",dW=(cW+"").trim();function pW(t,e,n){const i=(PB+"").trim(),r=t.getMap(),o=r.getGLRes();let s=t.getCoordinates();const a=[],h=[];let l=1;if(t instanceof Bl||t instanceof ql){t instanceof Bl&&(s=[s]);for(let t=0;t<s.length;t++)r.coordToPointAtRes(s[t],o,AW),a.push([AW.x,AW.y,s[t].z||0]),h.push([s[t].x,s[t].y])}else if(t instanceof jl||t instanceof Ql){l=2,t instanceof jl&&(s=[s]);for(let t=0;t<s.length;t++){a[t]=[],h[t]=[];for(let e=0;e<s[t].length;e++)r.coordToPointAtRes(s[t][e],o,AW),a[t].push([AW.x,AW.y,s[t][e].z||0]),h[t].push([s[t][e].x,s[t][e].y])}}else if(t instanceof Fl||t instanceof Xl){l=3,t instanceof eu||t instanceof ru||t instanceof iu||t instanceof ou?s=[[t.getShell()]]:t instanceof Fl&&(s=[s]);let e=0;for(let t=0;t<s.length;t++){let n=!1;for(let i=0;i<s[t].length;i++){if(a[e]=[],h[e]=[],n)for(let n=s[t][i].length-1;n>=0;n--)r.coordToPointAtRes(s[t][i][n],o,AW),a[e].push([AW.x,AW.y,s[t][i][n].z||0]),h[e].push([s[t][i][n].x,s[t][i][n].y]);else for(let n=0;n<s[t][i].length;n++)r.coordToPointAtRes(s[t][i][n],o,AW),a[e].push([AW.x,AW.y,s[t][i][n].z||0]),h[e].push([s[t][i][n].x,s[t][i][n].y]);0===i&&(n=pD(a[e])<0,n&&(a[e]=a[e].reverse(),h[e]=h[e].reverse())),e++}}}const u=t.getProperties()?Object.assign({},t.getProperties()):{},c=t._getInternalSymbol()||((f=t)instanceof Bl||f instanceof ql?{markerType:"ellipse",markerWidth:8,markerHeight:0,markerFill:"#000"}:f instanceof jl||f instanceof Ql?{lineColor:"#000",lineWidth:1}:f instanceof Fl||f instanceof Xl?{polygonFill:"#fff",lineColor:"#000",lineWidth:1}:void 0),A=n?Array.isArray(n)?n[0].id:n.id:e.id++;var f;if(Array.isArray(c)&&c.length){const r=[],o=c.length;for(let s=0;s<o;s++){const f=s===o-1?u:nB({},u),d=gW(c[s],f);for(const t in c[s])uB(c[s],t)&&(f[("_symbol_"+t).trim()]=c[s][t]);d&&(c[s].lineGradientProperty=d);const p=n&&n[s]?n[s][i]:e.pickingId++,g={type:l,id:A,properties:f,visible:t.isVisible(),geometry:a,coordinates:h,extent:1/0};g[i]=p,r.push(g)}return r}if(c){const t=gW(c,u);for(const e in c)uB(c,e)&&(u[("_symbol_"+e).trim()]=c[e]);t&&(c.lineGradientProperty=t)}const d=n?n.id:e.pickingId++,p={type:l,id:A,properties:u,visible:t.isVisible(),geometry:a,coordinates:h,extent:1/0};return p[i]=d,p}function gW(t,e){const n=t.lineGradientProperty;return n&&(e[dW]=e[n],e.mapbox_clip_start=0,e.mapbox_clip_end=1,delete e[n]),n}let mW=!1,yW=1;const vW="_symbol_".trim(),_W=(PB+"").trim();let xW=new Float32Array(1);const bW=[];class wW extends Uf.CanvasRenderer{constructor(...t){super(...t),this.features={},this.Ea={},this.we=0,this.Da={},this.La={},this.Ra={},this.Ha={},this.za={},this.Na=!0,this.Va={id:0,pickingId:0},this.Ua={}}setURLModifier(t){this.qn=t}getURLModifier(){return this.qn}needToRedraw(){return super.needToRedraw()||this.painter&&this.painter.needToRedraw()||this.ja&&this.ja.needToRedraw()||this.Ga&&this.Ga.needToRedraw()}getAnalysisMeshes(){return this.painter&&this.painter.getAnalysisMeshes()||bW}getRayCastData(){return null}draw(t,e){this.en=t;const n=this.layer;this.prepareCanvas(),this.nn=this.rn(this.getMap().getGLRes()),this.sn=e||{};const i=this.sn.renderMode,r=this.Ba();if(this.an(r,i),this.Na)this.buildMesh(),this.$a(),this.Wa(),this.Ua={},this.Xa=!1,this.Na=!1,this.Ya=!1;else if(this.Xa){const t=this.atlas,e=this.qa,n=this.Ja;delete this.atlas,delete this.qa,delete this.Ja,this.buildMesh(t),this.$a(e),this.Wa(n),this.Xa=!1,this.Ya=!1}else if(this.Ya){const t=this.Ja;delete this.Ja,this.Wa(t),this.Ya=!1}if(!this.meshes&&!this.Ka&&!this.Za)return void this.completeRender();this.Qa&&(this.el(),this.Qa=!1),this.nl();const o=!i||"default"===i;let s=0;0===this.layer.options.meshRenderOrder&&this.il(r,s,i);let a=0;if(this.Za&&(o||this.Ga.supportRenderMode(i))){this.Ga.startFrame(r),this.Ga.addMesh(this.Za,null,{bloom:this.sn.bloom}),this.Ga.prepareRender(r);const t=r.polygonOffsetIndex||0;s=this.meshes&&this.meshes.length?s-1:s,r.polygonOffsetIndex=(r.polygonOffsetIndex||0)+s,a=this.Ga.render(r).drawCount,r.polygonOffsetIndex=t}if(1===this.layer.options.meshRenderOrder&&this.il(r,a?s-1:s,i),this.Ka&&(o||this.ja.supportRenderMode(i))){const e=!this.sn.timestamp||this.sn.isFinalRender,i=!this.rl||this.rl!==t;n.options.collision&&i&&n.clearCollisionIndex();const o=this.layer.options.sceneConfig;this.ja.sceneConfig.collision=!o||!!aB(o.collision)||o.collision,this.ja.startFrame(r),this.ja.addMesh(this.Ka,null,{bloom:this.sn.bloom}),this.ja.prepareRender(r),n.options.collision&&i&&(this.ja.updateCollision(r),e&&(this.rl=t)),this.ja.render(r)}(o||e&&e.isFinalRender)&&(this.completeRender(),this.layer.fire("canvasisdirty"))}an(t,e){this.painter&&(!e||"default"===e||this.painter.supportRenderMode(e))&&this.painter.startFrame(t)}il(t,e,n){return this.painter&&this.meshes&&(!n||"default"===n||this.painter.supportRenderMode(n))?(this.painter.addMesh(this.meshes,null,{bloom:t&&t.bloom}),this.painter.prepareRender(t),t.polygonOffsetIndex=(t.polygonOffsetIndex||0)+e,this.painter.render(t)):{redraw:!1,drawCount:0}}supportRenderMode(){return!0}isForeground(){return!0}Ba(){const t={regl:this.regl,layer:this.layer,symbol:this.sl,gl:this.gl,sceneConfig:this.layer.options.sceneConfig,pluginIndex:0,cameraPosition:this.getMap().cameraPosition,timestamp:this.getFrameTimestamp()};return this.sn&&nB(t,this.sn),t}drawOnInteracting(t,e,n){this.draw(e,n)}getFrameTimestamp(){return this.en}ol(t,e){(t=t||e)===e&&(e=null);const n=[],i=[0,0,0,0];this.layer._sortGeometries();const r=this.layer.getGeometries();for(let o=0;o<r.length;o++){const s=r[o][fW];if(!this.features[s])continue;const a=this.features[s];if(Array.isArray(a))for(let r=0;r<a.length;r++){const o=a[r],s=o[_W];(!t||t[s]||e&&(!e||e[s]))&&(o.visible||(this.Qa=!0),this.al(o.geometry,i,o.coordinates),n.push(o))}else{a.visible||(this.Qa=!0);const r=a[_W];if(t&&!t[r]&&(!e||e&&!e[r]))continue;this.al(a.geometry,i,a.coordinates),n.push(a)}}if(n.length||(this.meshes&&this.painter&&(this.painter.deleteMesh(this.meshes),delete this.meshes),this.Ka&&(this.ja.deleteMesh(this.Ka),delete this.Ka),this.Za&&(this.Ga.deleteMesh(this.Za),delete this.Za)),i[3]&&(i[0]/=i[3],i[1]/=i[3]),isNaN(i[0])||isNaN(i[1]))throw new Error(`invalid geometry coordinates for ${this.layer.getJSONType()}`);return{features:n,center:i}}buildMesh(){}createVectorPacks(t,e,n,i,r,o){return t&&i&&i.length?new e(i,n,{zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.requestor,atlas:r,center:o,positionType:Float32Array}).load():Promise.resolve(null)}createMesh(t,e,n,i,r,o){return this.createVectorPacks(t,e,n,i,r,o).then((s=>this.ll(s,t,e,n,i,r,o)))}ll(t,e,n,i,r,o,s){if(!t)return null;const a=e.createGeometries([t.data],EB(r,null,0,i,this.layer));for(let u=0;u<a.length;u++)a[u]&&this.Ci(a[u].geometry);const h=Np([]);jp(h,h,pg([],s[0],s[1],0)),Up(h,h,pg([],1,1,this.nn));const l=e.createMeshes(a,h,{tilePoint:[s[0],s[1]]});for(let u=0;u<l.length;u++){const t=l[u];t.properties.level=0,t.properties.tileTransform=h;const e=t.defines;e.ENABLE_TILE_STENCIL=1,t.setDefines(e),t.properties.meshKey=this.layer.getId()}return{meshes:l,atlas:{iconAtlas:t.data.iconAtlas}}}al(t,e,n){for(let i=0;i<t.length;i++)if(Array.isArray(t[i][0]))for(let r=0;r<t[i].length;r++)if(Array.isArray(t[i][r][0]))for(let o=0;o<t[i][r].length;o++)isNaN(+t[i][r][o][0])||isNaN(+t[i][r][o][1])||this.hl(e,t[i][r][o][0],t[i][r][o][1],t[i][r][o][2],1,n[i][r][o]);else isNaN(+t[i][r][0])||isNaN(+t[i][r][1])||this.hl(e,t[i][r][0],t[i][r][1],t[i][r][2],1,n[i][r]);else isNaN(+t[i][0])||isNaN(+t[i][1])||this.hl(e,t[i][0],t[i][1],t[i][2],1,n[i])}hl(t,e,n,i,r,o){const s=this.getMap().getProjection().isSphere();let a=!1;(o[0]>180||o[0]<-180)&&(a=!0,s&&!mW&&(mW=!0,console.warn(`Layer(${this.layer.getId()}) has invalid longitude value: ${o[0]}`))),(o[1]>90||o[1]<-90)&&(a=!0,s&&!mW&&(mW=!0,console.warn(`Layer(${this.layer.getId()}) has invalid latitude value: ${o[1]}`))),a||(t[0]+=e,t[1]+=n,t[2]+=i||0,t[3]+=r)}Ci(t){const e=this.getMap().getGLRes(),n=t.properties;n.tileResolution=e,n.tileRatio=1,n.z=1,n.tileExtent=1,n.elements=t.elements,n.aPickingId=t.data.aPickingId}ul(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&PW(this.gl)}prepareRequestors(){if(this.re)return;const t=this.layer;this.re=new Gz({iconErrorUrl:t.options.iconErrorUrl,urlModifier:e=>{const n=t.getURLModifier();return n&&n(e)||e}});const e=!this.ul("win-intel-gpu-crash");this.se=new jz((e=>{t.getMap().getRenderer().callInNextFrame(e)}),t.options.glyphSdfLimitPerFrame,e),this.requestor=this.cl.bind(this),this.fl=this.dl.bind(this)}cl(t,e,n){const i=[];this.re.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&i.push(...e.buffers),n(null,{icons:e.icons},i)}))}dl(t,e,n){this.se.getGlyphs(e,((e,i)=>{if(e)throw e;const r=i.buffers||[];this.re.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&e.buffers.length&&r.push(...e.buffers),n(null,{icons:e.icons,glyphs:i.glyphs},r)}))}))}$a(t){const e=Object.keys(this.Ra),n=Object.keys(this.Ha);if(!e.length&&!n.length)return void(this.Ka&&(this.ja.deleteMesh(this.Ka),delete this.Ka));const{features:i,center:r}=this.ol(this.Ra,this.Ha),o=[],s=[];for(let c=0;c<i.length;c++){const t=i[c][_W];this.Ra[t]&&o.push(i[c]),this.Ha[t]&&s.push(i[c])}if(!o.length&&!s.length)return void(this.Ka&&(this.ja.deleteMesh(this.Ka),delete this.Ka));const a=this.Qa;this.pl=r;const h=this.ml(o,s,t,r);this.qa={};const l=[],u=[];this.yl=!0,Promise.all(h).then((t=>{if(this.Ka&&(this.ja.deleteMesh(this.Ka),delete this.Ka),!t||!t.length)return void this.setToRedraw();const e=this.ja.createGeometries(t.map((t=>(t&&t.data&&(t.data.isIdUnique=!0),t&&t.data))),this.Da);for(let r=0;r<e.length;r++)this.Ci(e[r].geometry,t[r]&&t[r].data);const n=t[0]&&t[0].data.iconAtlas,i=t[0]&&t[0].data.glyphAtlas||t[1]&&t[1].data.glyphAtlas;n&&(this.qa.iconAtlas=n),i&&(this.qa.glyphAtlas=i);const o=Np([]);jp(o,o,pg(u,r[0],r[1],0)),Up(o,o,pg(l,1,1,this.nn));const s=this.ja.createMeshes(e,o);for(let r=0;r<s.length;r++)s[r].geometry.properties.originElements=s[r].geometry.properties.elements.slice(),s[r].properties.level=0,s[r].material.set("flipY",1),s[r].properties.meshKey=yW++;this.Ka=s,a&&(this.Qa=!0),this.yl=!1,this.setToRedraw(),this.layer.fire("buildmarkermesh")}))}el(){if(this.Ka&&(this.vl(this.Ka[0],this.Ra),this.vl(this.Ka[1],this.Ha),this.Ka[0]&&this.ja.prepareCollideIndex(this.Ka[0].geometry),this.Ka[1]&&this.ja.prepareCollideIndex(this.Ka[1].geometry)),this.Za)for(let t=0;t<this.Za.length;t++)this.vl(this.Za[t],this.za);if(this.meshes)for(let t=0;t<this.meshes.length;t++)this.vl(this.meshes[t],this.Da)}vl(t,e){if(!t)return;const{aPickingId:n,originElements:i}=t.geometry.properties,r=[];for(let s=0;s<i.length;s++){const t=n[i[s]];e[t]&&e[t].feature.visible&&r.push(i[s])}const o=t.geometry.properties.elements=new i.constructor(r);t.geometry.setElements(o)}ml(t,e,n,i){const r={zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.fl,atlas:n,center:i,positionType:Float32Array,defaultAltitude:0,forceAltitudeAttribute:!0,markerWidthType:Uint16Array,markerHeightType:Uint16Array},o=nB({},r);return r.allowEmptyPack=1,Az.splitPointSymbol(this.xl).map(((n,i)=>new Az(0===i?t:e,n,0===i?r:o).load()))}updateMesh(){}wl(t){const e=t._getInternalSymbol(),n={zoom:this.getMap().getZoom(),isVector3D:!0},i=this.Al(t);if(!this.Ka)return!1;let r=this.features[i];Array.isArray(r)||(r=[r]);const o=[],s=[],a=[],h=this.getMap().getZoom();let l,u;l=Array.isArray(e)?e.map((t=>t?RE(t,(()=>(o[0]=h,o))):t)):RE(e,(()=>(o[0]=h,o))),u=Array.isArray(e)?e.map((t=>t?pN.genFnTypes(t):t)):pN.genFnTypes(e);for(let d=0;d<r.length;d++){if(!r[d])continue;const t=Array.isArray(e)?e[d]:e,i=Array.isArray(l)?l[d]:l,o=Array.isArray(u)?u[d]:u,s=new ZN(r,t,i,o,n).getIconAndGlyph();if(!this.qa||!Az.isAtlasLoaded(s,this.qa))return this.Ml(),this.setToRedraw(),!1}for(let d=0;d<r.length;d++){const t=r[d][_W];this.Ra[t]&&s.push(r[d]),this.Ha[t]&&a.push(r[d])}const c=r[0].id,A=this.ml(s,a,this.qa,this.pl),f=this.Ka;return Promise.all(A).then((t=>{for(let e=0;e<t.length;e++){if(!t[e])continue;t[e].data&&(t[e].data.isIdUnique=!0);const n=f[e],i=n.geometry.properties.aFeaIds.indexOf(c);if(i<0)continue;const r=t[e].data.featureIds.length,o=t[e].data.dynamicAttributes;for(const s in t[e].data.data){if("aPickingId"===s)continue;if(o[s])continue;const a=t[e].data.data[s];a&&n.geometry.updateSubData(s,a,i*a.length/r)}}this.setToRedraw()})),!0}_l(t){return this.Sl(t,this.Za,this.Ja,this.kl,this.Ga,vz,uW,this.Pl)}Sl(t,e,n,i,r,o,s,a){if(!e)return!1;if(!n)return this.Ml(),this.setToRedraw(),!1;const h=t._getInternalSymbol(),l={zoom:this.getMap().getZoom()};let u=this.features[t[fW]];Array.isArray(u)||(u=[u]);const c=[];for(let g=0;g<u.length;g++){const t=u[g];if(!t)continue;const e=Array.isArray(h)?h[g]:h,i=pN.genFnTypes(e),r=new GD(u,e,i,l),s=o===vz?r.getLineResource():r.getPolygonResource();if(!pN.isAtlasLoaded(s,n[g]))return this.Ml(),this.setToRedraw(),!1;c.push(t)}const A=u[0].id,f=a.call(this,c);for(let g=0;g<f.length;g++)if(f[g].length){const t=e.filter((t=>t.feaGroupIndex===g));if(!t.length)return this.Ml(),this.setToRedraw(),!1;if(t[0].geometry.properties.aFeaIds.indexOf(A)<0)return this.Ml(),this.setToRedraw(),!1}const d=nB({},s),p=f.map((t=>this.createVectorPacks(r,o,d,t,n[0],i)));return Promise.all(p).then((t=>{for(let n=0;n<t.length;n++){let i;if(Array.isArray(e)){for(let t=0;t<e.length;t++)if(e[t].feaGroupIndex===n){i=e[t];break}}else i=e;i&&this.Tl(i,A,t[n])}})),!0}Tl(t,e,n){const i=t.geometry.properties.aFeaIds,r=i.indexOf(e);if(!(r<0)){if(n){const e=n.data.dynamicAttributes,i=n.data.featureIds.length,o=n.data.data;for(const n in o)if(!e[n]&&uB(o,n)&&o[n]){const e=o[n];t.geometry.updateSubData(n,e,r*e.length/i)}}else{let n=r+1;for(;i[n]===e;)n++;const o=n-r,s=t.geometry.desc.positionSize;xW.length!==3*o&&(xW=new Float32Array(o*s),xW.fill(-1/0,0)),t.geometry.updateSubData(t.geometry.desc.positionAttribute,xW,r*s)}this.layer.fire("updatemesh"),this.setToRedraw()}}Wa(t){if(!Object.keys(this.za).length)return void(this.Za&&(this.Ga.deleteMesh(this.Za),delete this.Za));const{features:e,center:n}=this.ol(this.za);if(!e.length)return;const i=this.Qa;this.kl=n;const r=this.Pl(e),o=nB({},uW),s=r.map(((e,i)=>this.createMesh(this.Ga,vz,o,e,t&&t[i],n)));this.Il=!0,Promise.all(s).then((t=>{this.Za&&this.Ga.deleteMesh(this.Za);const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i]&&t[i].meshes;if(r){for(let t=0;t<r.length;t++){const n=r[t];n.feaGroupIndex=i,e.push(n),n.geometry.properties.originElements=n.geometry.properties.elements.slice()}n[i]=t[i].atlas}}this.Za=e,this.Ja=n,i&&(this.Qa=i),this.Il=!1,this.setToRedraw(),this.layer.fire("buildlinemesh")}))}Pl(t){const e=(vW+"lineDasharray").trim(),n=(vW+"linePatternFile").trim(),i=[],r=[],o=[];for(let s=0;s<t.length;s++){const a=t[s],h=a.properties&&a.properties[e];h&&OW(h)?o.push(a):a.properties&&a.properties[n]?r.push(a):i.push(a)}return[i,r,o]}Fl(){this.Xa=!0,this.setToRedraw()}Ml(){this.Na=!0,this.setToRedraw()}Cl(t){const e=this.layer.getId();for(let n=0;n<t.length;n++){const i=t[n];let r=!1;for(let t=0;t<this.GeometryTypes.length;t++)if(i instanceof this.GeometryTypes[t]){r=!0;break}if(!r)throw new Error(`${i.getJSONType()} can't be added to ${this.layer.getJSONType()}(id:${e}).`);this.Al(i)}}Al(t){void 0===t[fW]&&(t[fW]=this.we++);const e=t[fW];return this.features[e]&&this.Ol(e),this.features[e]=pW(t,this.Va,this.features[e]),this.El(this.features[e],e),this.Ea[e]=t,e}El(t,e){if(!t)return;const n=Array.isArray(t)?t[0].id:t.id;if(this.La[n]=t,Array.isArray(t))for(let i=0;i<t.length;i++){const n=t[i][_W];if(t[i][fW]=e,this.Da[n]={feature:t[i]},this.Da[n][fW]=e,!this.needCheckPointLineSymbols())continue;const r={feature:t[i]};(MW(t[i])||TW(t[i]))&&(this.Ra[n]=r),TW(t[i])&&(this.Ha[n]=r),EW(t[i])&&(this.za[n]=r)}else{t[fW]=e;const n={feature:t},i=t[_W];if(this.Da[i]=n,!this.needCheckPointLineSymbols())return;(MW(t)||TW(t))&&(this.Ra[i]=n),TW(t)&&(this.Ha[i]=n),EW(t)&&(this.za[i]=n)}}needCheckPointLineSymbols(){return!0}Ol(t){const e=this.features[t];if(e)if(Array.isArray(e))for(let n=0;n<e.length;n++){const t=e[n][_W];delete this.La[e[n].id],delete this.Da[t],delete this.Ra[t],delete this.Ha[t],delete this.za[t]}else{const t=e[_W];delete this.La[e.id],delete this.Da[t],delete this.Ra[t],delete this.Ha[t],delete this.za[t]}}pick(t,e,n){const i=[];return this.layer.isVisible()?([this.painter,this.ja,this.Ga].forEach((r=>{if(!r)return;const o=r.pick(t,e,n.tolerance);if(o&&o.data&&o.data.feature){const t=this.Ea[o.data.feature[fW]];n&&n.includeInternals?i.push(t):(o.geometry=t,delete o.plugin,delete o.data,delete o.point,i.push(o))}})),i):i}Dl(t){const e=this.features[t[fW]];return Array.isArray(e)?e[0][_W]:e[_W]}nl(){let t=!1;for(const e in this.Ua){const n=this.Ua[e],i=this.Dl(n);if(!this.yl&&(this.Ra[i]||this.Ha[i])){const e=this.wl(n);t=t||e}if(!this.Il&&this.za[i]){const e=this._l(n);t=t||e}if(!this.Ll){const e=this.updateMesh(n);t=t||e}}this.Ua={},t&&(CW(this),this.layer.fire("partialupdate"))}Rl(t){this.Al(t),this.Ml(),CW(this)}onGeometryAdd(t){this.setToRedraw(),this.canvas&&t&&t.length&&(this.Cl(t),this.Ml(),CW(this))}onGeometryRemove(t){if(t&&t.length){for(let e=0;e<t.length;e++){const n=t[e][fW];void 0!==n&&(delete this.Ea[n],this.Ol(n),delete this.features[n])}this.Ml(),CW(this)}}onGeometrySymbolChange(t){const e=t.target._getParent()||t.target,n=e[fW];if(void 0===n)return;let i=t.properties;if(Array.isArray(i)){const t={};for(let e=0;e<i.length;e++)i[e]&&nB(t,i[e]);i=t}else if(i&&void 0!==i[0]){const t={};for(const e in i)i[e]&&nB(t,i[e]);i=t}for(const h in i)if(uB(i,h)&&Kz[h])return void this.Rl(e);const r=e._getInternalSymbol(),o=this.features[n];if(this.Al(e),o)if(s=r,a=o,Array.isArray(s)?Array.isArray(a)&&s.length===a.length:!Array.isArray(a)){if(Array.isArray(r)){for(let t=0;t<r.length;t++)if(!RW(r[t],o[t]))return void this.Rl(e)}else if(!RW(r,o))return void this.Rl(e);this.onGeometryPositionChange(t)}else this.Rl(e);else this.Rl(e);var s,a}onGeometryShapeChange(t){const e=t.target._getParent()||t.target;void 0!==e[fW]&&(this.Cl([e]),this.Fl(),CW(this))}onGeometryPositionChange(t){const e=t.target._getParent()||t.target,n=e[fW];void 0!==n&&(this.Cl([e]),this.Ua[n]=e,CW(this))}onGeometryZIndexChange(t){void 0!==(t.target._getParent()||t.target)[fW]&&this.Ml()}onGeometryShow(t){void 0!==(t.target._getParent()||t.target)[fW]&&this.Hl(t)}onGeometryHide(t){void 0!==(t.target._getParent()||t.target)[fW]&&this.Hl(t)}Hl(t){const e=t.target._getParent()||t.target,n=this.features[e[fW]];if(n){const t=e.isVisible();if(Array.isArray(n)){if(t===n[0].visible)return;for(let e=0;e<n.length;e++)n[e].visible=t}else{if(t===n.visible)return;n.visible=t}this.zl(),CW(this)}}zl(){this.Qa=!0}onGeometryPropertiesChange(t){const e=t.target._getParent()||t.target,n=e[fW];void 0!==n&&(this.features[n]=pW(e,this.Va),this.El(this.features[n],n),this.Ml(),CW(this))}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;t?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this.Xe(),t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.prepareRequestors(),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=this.createPainter();const e=wH.get3DPainterClass("icon");let n=e.getBloomSymbol();const i=nB({},hW,lW);i.markerPerspectiveRatio=this.layer.options.markerPerspectiveRatio||0,this.Nl(i,n),this.xl=i;const r=nB({},yB,this.layer.options.sceneConfig||{});this.ja=new e(this.regl,this.layer,i,r,0),this.ja.setTextShaderDefines({REVERSE_MAP_ROTATION_ON_PITCH:1});const o=wH.get3DPainterClass("line"),s=nB({},uW);n=o.getBloomSymbol(),this.Nl(s,n),this.Vl=s;const a=nB({},this.layer.options.sceneConfig||{});void 0===a.depthMask&&(a.depthMask=!0),this.Ga=new o(this.regl,this.layer,s,a,0),this.layer.getGeometries()&&this.onGeometryAdd(this.layer.getGeometries())}We(){return!!(this.canvas&&this.canvas.gl&&this.canvas.gl.wrap)}Nl(t,e){for(let n=0;n<e.length;n++)t[e[n]]=this.layer.options.enableBloom}updateBloom(t){this.ja&&this.Ul(this.ja,this.xl,t),this.Ga&&this.Ul(this.Ga,this.Vl,t),this.painter&&this.Ul(this.painter,this.painterSymbol,t)}Ul(t,e,n){const i=t.constructor.getBloomSymbol().reduce(((t,i)=>(t[i]=n,e[i]=n,t)),{});t.updateSymbol(i,e)}createPainter(){}Xe(){const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0,antialias:!1};t.preserveDrawingBuffer=!0,t.stencil=!0,this.glOptions=t,this.gl=this.gl||this.Je(this.canvas,t),this.regl=id({gl:this.gl,attributes:t,extensions:zv.WEBGL_EXTENSIONS,optionalExtensions:zv.WEBGL_OPTIONAL_EXTENSIONS})}Je(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let o=0;o<n.length;++o){try{i=t.getContext(n[o],e)}catch(r){}if(i)break}return i}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:255})}resizeCanvas(t){super.resizeCanvas(t);const e=this.canvas;e&&(!this.pickingFBO||this.pickingFBO.width===e.width&&this.pickingFBO.height===e.height||this.pickingFBO.resize(e.width,e.height),this.painter&&this.painter.resize(e.width,e.height))}onRemove(){super.onRemove(),this.painter&&(this.painter.delete(),delete this.painter),this.ja&&(this.ja.delete(),delete this.ja),this.Ga&&(this.Ga.delete(),delete this.Ga)}drawOutline(t){if(this.mn&&(this.painter&&this.painter.outlineAll(t),this.ja.outlineAll(t),this.Ga.outlineAll(t)),this.jl)for(let e=0;e<this.jl.length;e++)this.painter&&this.painter.outline(t,this.jl[e]),this.ja.outline(t,this.jl[e]),this.Ga.outline(t,this.jl[e])}outlineAll(){this.mn=!0,this.setToRedraw()}outline(t){this.jl||(this.jl=[]);const e=[];for(let n=0;n<t.length;n++){const i=this.layer.getGeometryById(t[n]);if(i){const t=this.features[i[fW]];if(Array.isArray(t))for(let n=0;n<t.length;n++)e.push(t[n].id);else e.push(t.id)}}this.jl.push(e),this.setToRedraw()}cancelOutline(){delete this.mn,delete this.jl,this.setToRedraw()}isEnableWorkAround(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&PW(this.gl)}rn(t){return cB(t,this.getMap())}_i(){const t=this.layer.getGeometries();t&&this.Cl(t),this.Ml()}Xn(){const t=this.layer.options.opacity;return this.We()?aB(t)?1:t:1}}function CW(t){t.setToRedraw()}function PW(t){const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&"undefined"!=typeof navigator){const n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),i="Win32"===navigator.platform||"Win64"===navigator.platform;if(n&&n.toLowerCase().indexOf("intel")>=0&&i)return!0}return!1}function MW({properties:t}){const e=(vW+"markerFile").trim(),n=(vW+"markerType").trim();return t[e]||t[n]}function TW({properties:t}){return t[(vW+"textName").trim()]}const SW=(vW+"lineWidth").trim(),IW=(cW+"").trim();function EW(t){return 2===t.type&&!t.properties[IW]||3===t.type&&void 0!==t.properties[SW]}function OW(t){if(!Array.isArray(t))return 0;let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function RW(t,e){if(Object.keys(t).sort().join()!==Object.keys(e.properties||{}).filter((t=>0===t.indexOf(vW))).map((t=>t.substring(vW.length))).sort().join())return!1;for(const n in t)if(uB(t,n)){const i=(vW+n).trim();if(SE(t[n])!==SE(e.properties[i]))return!1}return!0}function DW(t,e,n){if(!t||t.type!==e)return null;const i=new n(t.id,t.options),r=t.geometries,o=[];for(let s=0;s<r.length;s++){const t=Kh.fromJSON(r[s]);t&&o.push(t)}return i.addGeometry(o),i}class kW extends wH{static fromJSON(t){return DW(t,"PointLayer",kW)}constructor(...t){super(...t),this.options.sceneConfig||(this.options.sceneConfig=nB({},yB))}getPolygonOffsetCount(){return 0}getPolygonOffset(){return 0}}kW.mergeOptions({glyphSdfLimitPerFrame:15,iconErrorUrl:null,workarounds:{"win-intel-gpu-crash":!0},collision:!1,collisionFrameLimit:1}),kW.registerJSONType("PointLayer"),kW.registerRenderer("canvas",null),kW.registerRenderer("gl",class extends wW{constructor(...t){super(...t),this.GeometryTypes=[Bl,ql]}onGeometryAdd(t){t&&(Array.isArray(t)?t.forEach((t=>{t.options.maxMarkerWidth=t.options.maxMarkerHeight=255})):t.options.maxMarkerWidth=t.options.maxMarkerHeight=255,super.onGeometryAdd(t))}});class LW extends wH{static fromJSON(t){return DW(t,"LineStringLayer",LW)}}LW.mergeOptions({meshRenderOrder:1}),LW.registerJSONType("LineStringLayer");const FW=(cW+"").trim();LW.registerRenderer("gl",class extends wW{constructor(...t){super(...t),this.GeometryTypes=[jl,Ql]}createPainter(){const t=wH.get3DPainterClass("line-gradient");this.painterSymbol=nB({},{lineGradientProperty:FW},uW),this.Nl(this.painterSymbol,t.getBloomSymbol());const e=nB({},this.layer.options.sceneConfig||{});return void 0===e.depthMask&&(e.depthMask=!0),new t(this.regl,this.layer,this.painterSymbol,e,0)}buildMesh(){let{features:t,center:e}=this.ol();if(t=t.filter((t=>!!t.properties[FW])),!t.length)return;const n=this.Qa;this.Gl=e;const i=nB({},this.painterSymbol),r=this.createMesh(this.painter,vz,i,t,null,e);this.Ll=!0,r.then((t=>{this.meshes&&this.painter.deleteMesh(this.meshes);const e=[],i=t&&t.meshes;if(i){e.push(...i);for(let t=0;t<i.length;t++)i[t].feaGroupIndex=0,i[t].geometry.properties.originElements=i[t].geometry.properties.elements.slice()}this.meshes=e,n&&(this.Qa=n),this.Ll=!1,this.setToRedraw()}))}}),LW.registerRenderer("canvas",null);class NW extends wH{static fromJSON(t){return DW(t,"PolygonLayer",NW)}}NW.registerJSONType("PolygonLayer");const zW={polygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_polygonFill"},polygonPatternFile:{type:"identity",default:void 0,property:"_symbol_polygonPatternFile"},polygonOpacity:{type:"identity",default:1,property:"_symbol_polygonOpacity"},uvScale:{type:"identity",default:[1,1],property:"_symbol_uvScale"},uvOffset:{type:"identity",default:[0,0],property:"_symbol_uvOffset"},uvOffsetInMeter:{type:"identity",default:!1,property:"_symbol_uvOffsetInMeter"},polygonPatternFileWidth:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileWidth"},polygonPatternFileHeight:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileHeight"},polygonPatternFileOrigin:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileOrigin"},polygonPatternUV:{type:"identity",default:void 0,property:"_symbol_polygonPatternUV"}};class BW extends wW{constructor(){super(...arguments),this.GeometryTypes=[Fl,Xl]}getPolygonOffsetCount(){return this.options.altitude>0?0:2}buildMesh(t){const{features:e,center:n}=this.ol();if(!e.length)return;const i=this.Qa;this.Gl=n;const r=this.Bl(e),o=nB({},zW),s=r.map(((e,i)=>this.createMesh(this.painter,kz,o,e,t&&t[i],n)));this.Ll=!0,Promise.all(s).then((t=>{this.meshes&&this.painter.deleteMesh(this.meshes),t=function(t){const e=[];for(let n=0;n<t.length;n++)Array.isArray(t[n])?e.push(...t[n]):e.push(t[n]);return e}(t);const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i]&&t[i].meshes;if(r){e.push(...r);for(let t=0;t<r.length;t++)r[t].feaGroupIndex=i,r[t].geometry.properties.originElements=r[t].geometry.properties.elements.slice(),1===i&&(r[t].transparent=!0);n[i]=t[i].atlas}}this.meshes=e,this.atlas=n,i&&(this.Qa=i),this.Ll=!1,this.setToRedraw(),this.layer.fire("buildmesh")}))}getRayCastData(t,e){const n=this.painter.getRayCastData(t,e);return n&&n.feature?this.Ea[n.feature[fW]]:null}Bl(t){const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i];r.properties&&r.properties._symbol_polygonOpacity<1?n.push(r):e.push(r)}return[e,n]}createPainter(){const t=wH.get3DPainterClass("fill"),e=this.painterSymbol=nB({},zW);return this.Nl(e,t.getBloomSymbol()),new t(this.regl,this.layer,e,this.layer.options.sceneConfig,0)}updateMesh(t){return this.Sl(t,this.meshes,this.atlas,this.Gl,this.painter,kz,zW,this.Bl)}}function HW(t,e,n,i,r,o,s){const a=n&&Array.isArray(n[0]);for(let h=0,l=n.length;h<l;h++){t[e]=(a?n[h][0]:n[h].x)*i,t[e+1]=(a?n[h][1]:n[h].y)*i,s!==Float32Array&&(t[e]=Math.round(t[e]),t[e+1]=Math.round(t[e+1]));let o=r||0;Array.isArray(r)&&(o=r[h]),o=o?Math.round(i*o):0,t[e+2]=o,e+=3}return t.trySetLength&&t.trySetLength(e),e}NW.registerRenderer("gl",BW),NW.registerRenderer("canvas",null);const jW=Math.PI/180,UW=6378137*Math.PI/180,GW=85.0511287798;function VW(t,e,n){return function(t,e){const n=GW,i=e[0],r=Math.max(Math.min(n,e[1]),-n);let o;return o=0===r?0:Math.log(Math.tan((90+r)*jW/2))/jW,t[0]=i*UW,t[1]=o*UW,t}(t,e)}function WW(t,e,n,i){const r=n[0]-i[0],o=n[1]-i[1];let s=(e[0]-n[0])*(n[0]-i[0])+(e[1]-n[1])*(n[1]-i[1]);return s/=r*r+o*o,t[0]=n[0]+s*r,t[1]=n[1]+s*o,t}function qW(t,e,n,i,r){return o=i,s=r,a=t[3*e[n-1]],h=t[3*e[n-1]+1],Math.sqrt((a-o)*(a-o)+(h-s)*(h-s));var o,s,a,h}function ZW(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d,p,g){const m=e.getLength(),y=r/3;for(let _=2,x=m;_<x;_+=3)t[r+_-2]=e[_-2],t[r+_-1]=e[_-1],t[r+_-0]=e[_]-s;r+=m;for(let _=2,x=m;_<x;_+=3)t[r+_-2]=e[_-2],t[r+_-1]=e[_-1],t[r+_-0]=e[_]-a;t.trySetLength((r+=m)+m),t.copyWithin(r,r-2*m,r-m),t.trySetLength((r+=m)+m),t.copyWithin(r,r-2*m,r-m),r+=m,(n=n||[]).push(m/3);const v=n.getLength();for(let _=0;_<v;_++)QW(y+(n[_-1]||0),y+n[_],t,m/3,h,i,l,u,c,A,o,f,d,p,g);return r}function QW(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d){const p=o.getLength();let g,m;for(let y=t,v=e;y<v-1;y++)if(g=y,m=y+1,r===1/0)if((y-t)%2==1&&(g+=2*i,m+=2*i),d){let t=o.currentIndex;o[t++]=g+i,o[t++]=m,o[t++]=g,o[t++]=m+i,o[t++]=m,o[t++]=g+i,o.currentIndex=t}else{let t=o.currentIndex;o[t++]=g+i,o[t++]=g,o[t++]=m,o[t++]=m,o[t++]=m+i,o[t++]=g+i,o.currentIndex=t}s&&function(t,e,n,i,r,o,s,a,h,l,u,c){let A,f=0,d=0,p=0,g=0;const m=c?[1,3,4]:[2,3,4];for(let y=o.getLength()-1;y>=s;y--){const s=o[y],c=3*s+2,v=r[3*s],_=r[3*s+1],x=r[c];f||d||(f=Math.max(r[c],r[3*o[y-3]+2]),d=Math.min(r[c],r[3*o[y-3]+2]),A=f-d);let b=p;const w=y%6;let C;0===t?(5===w&&(g=qW(r,o,y,v,_)),b=w===m[0]||w===m[1]||w===m[2]?p:p+g):1===t&&(w===m[0]||w===m[1]||w===m[2]?b=0:5===w?(g=qW(r,o,y,v,_),b=g):b=g),C=1===e?x===f?1:0:"bottom"===n?x===f?A/100/h:0:x===f?0:-A/100/h,i[2*s]=b/l*(1/(100*u))/a,i[2*s+1]=C,0===w&&(p+=g)}}(a,h,l,u,n,o,p,c[0],c[1],A,f,d)}function XW(t){const e=[t[0]];let n=t[0];for(let i=1;i<t.length;i++)Array.isArray(t[i])?t[i][0]===n[0]&&t[i][1]===n[1]&&t[i][2]===n[2]||e.push(t[i]):t[i].x===n.x&&t[i].y===n.y&&t[i].z===n.z||e.push(t[i]),n=t[i];return e}const YW=oN.getInstance();function JW(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d,p){void 0===e.top&&(e.top=!0),void 0===e.side&&(e.side=!0),YW.reset();const{altitudeScale:g,altitudeProperty:m,defaultAltitude:y,heightProperty:v,minHeightProperty:_,defaultHeight:x,tangent:b,uv:w,topUVMode:C,sideUVMode:P,sideVerticalUVMode:M,top:T,side:S,textureYOrigin:I,topThickness:E}=e,O=!!p,R=function(t,e,{altitudeScale:n,altitudeProperty:i,defaultAltitude:r,heightProperty:o,minHeightProperty:s,defaultHeight:a},{center:h,side:l,top:u,topThickness:c,uvOrigin:A,uv:f,uvSize:d,topUVMode:p,sideUVMode:g,sideVerticalUVMode:m,textureYOrigin:y,tileRatio:v,centimeterToPoint:_,verticalCentimeterToPoint:x,positionType:b,res:w,glScale:C,projectionCode:P},M,T){t[0].extent;const S=e===1/0,I=T.get(),E=T.get(),O=T.get(),R=T.getProxy(),D=T.get(),k=T.get(),L=T.get(),F=!!f,N=!!u,z=!!l,B=F?T.get():null;function H(t,n,i,r,o,s){let a=n;if(N){const N=AR(R,i,3);if(0===N.length)return n;let W=R.getLength(),q=D.currentIndex;for(let t=0;t<W;t++)D[q++]=R[t];if(D.currentIndex=q,n+=R.getLength(),s)for(let e=2,n=N.length;e<n;e+=3)N[e]+=t/3,N[e-1]+=t/3,N[e-2]+=t/3;W=N.length,q=k.currentIndex;for(let t=0;t<W;t++)k[q++]=N[t];k.currentIndex=q,F&&(l=p||0,u=t,f=n,b=B,M=D,T=A,S=_,I=v,E=d[0],O=d[1],H=o,j=w,U=C,G=P,V=h,0===l?function(t,e,n,i,r,o,s,a,h,l){const u=1/(100*o[0]),c=1/(100*o[1]),A=l&&l[0]||0,f=l&&l[1]||0,d=[0,0];for(let p=t;p<e;p+=3){const t=p/3*2,e=i[p+1]-f;n[t]=d[0]+(i[p]-A)/s*u/a,n[t+1]=d[1]-e/s*c/h}}(u,f,b,M,0,S,I,E,O,V):1===l&&function(t,e,n,i,r,o,s,a,h,l,u){if(!t)return;let c,A,f,d;0===t[4]?(c=t[0],A=t[1],f=t[2],d=t[3]):(c=t[1],A=t[2],f=t[3],d=t[0]);const p=py(c,A),g=py(A,f),m=[],y=[],v=[];for(let _=e;_<n;_+=3){const t=_/3*2;ly(m,(o.x/h+r[_]/s)*a,o.y/h*a+(u?r[_+1]:-r[_+1])/s*a),"EPSG:4326"!==l&&"EPSG:4490"!==l||VW(m,m),WW(y,m,c,A),WW(v,m,d,c),i[t]=py(c,y)/p,i[t+1]=py(c,v)/g}}(H,u,f,b,M,T,I,j,U,G,!!V)),c>0&&!z&&(n=ZW(D,R,i,k,n,B,0,c,e,F,g||0,m||0,y,d,v,x,r<0?!s:s)),L.setLength(n/3),L.fill(1,a/3,n/3)}var l,u,f,b,M,T,S,I,E,O,H,j,U,G,V;if(z){N&&(c=0),a=n,n=ZW(D,R,i,k,n,B,c,r,e,F,g||0,m||0,y,d,v,x,r<0?!s:s),L.setLength(n/3);const t=R.getLength()/3;L.fill(1,a/3,a/3+t),L.fill(0,a/3+t,a/3+2*t),L.fill(1,a/3+2*t,a/3+3*t),L.fill(0,a/3+3*t,n/3)}return n}let j=0,U=0,G=0,V=t.length;rB(M)&&(G=M,V=M+1);let W=0,q=!1;const Z=T.getProxy();let Q=!1;for(;G<V;G++){const e=t[G],h=e.id;rB(h)&&(Math.abs(h)>W&&(W=Math.abs(h)),h<0&&(q=!0));const l=e.geometry,u=e.properties[SB];let c=Array.isArray(u&&u[0]&&u[0][0])?u[0]:u;const{altitude:A,height:f}=mD(e,n,i,r,o,a,s);f<0&&(Q=!0),j=Math.max(Math.abs(A),j);const d=D.getLength();let p=0,g=U;Z.setLength(0),R.setLength(0);const m=pD(l[0])<0;for(let t=0,n=l.length;t<n;t++){let e=l[t];m&&(e=e.reverse()),e=XW(e);const i=pD(e)<0;if(!i&&t>0&&(p++,c=u&&u[p],U=H(g,U,Z,1*f,c,S),R.setLength(0),Z.setLength(0),g=U),!e.length){t===n-1&&(U=H(g,U,Z,1*f,c,S));continue}const r=e.length;if(Array.isArray(e[0])?e[0][0]===e[r-1][0]&&e[0][1]===e[r-1][1]||e.push([e[0][0],e[0][1]]):e[0].x===e[r-1].x&&e[0].y===e[r-1].y||e.push(e[0]),i){let t=Z.currentIndex;Z[t++]=R.getLength()/3,Z.currentIndex=t}HW(R,R.getLength(),e,1,A,0,b),t===n-1&&(U=H(g,U,Z,1*f,c,S))}const y=D.getLength()-d,v=(PB+"").trim();for(let t=0;t<y/3;t++){let t=E.currentIndex;E[t++]=void 0===e[v]?G:e[v],E.currentIndex=t,t=I.currentIndex,I[t++]=G,I.currentIndex=t,rB(h)&&(t=O.currentIndex,O[t++]=h,O.currentIndex=t)}}const X=ID(E.getLength()?E[E.getLength()-1]:0),Y={hasNegativeHeight:Q,maxAltitude:j,vertices:D,verticeTypes:L,indices:k,pickingIds:oN.createTypedArray(E,X),featureIndexes:I};if(O.getLength()){const t=q?SD(W):ID(W);Y.featureIds=oN.createTypedArray(O,t)}else Y.featureIds=[];return B&&(B.setLength(D.getLength()/3*2),Y.uvs=B),Y}(t,n,{altitudeScale:g,altitudeProperty:m,defaultAltitude:y||0,heightProperty:v,minHeightProperty:_,defaultHeight:x||0},{center:p,top:T,side:S,topThickness:10*E||0,uv:w||b,uvSize:[r,r],uvOrigin:i,topUVMode:C,sideUVMode:P,sideVerticalUVMode:M,textureYOrigin:I,tileRatio:a,centimeterToPoint:h,verticalCentimeterToPoint:l,positionType:d,res:o,glScale:s,projectionCode:A},f,YW),D=[],k=R.vertices.getLength()/3,L=TD(k),F=oN.createTypedArray(R.indices,L);delete R.indices,D.push(F.buffer,R.pickingIds.buffer);const N=d||SD(Math.max(512,R.maxAltitude));R.vertices=oN.createTypedArray(R.vertices,N);const z=b?YW.getProxy():new Float32Array(3*k);z.setLength&&z.setLength(3*k);const B=$y(R.vertices,F,z);let H=!0;const j=B.getLength?B.getLength():B.length;for(let W=0;W<j;W++){O||(B[W]=-B[W]);const t=B[W]%1;1-Math.abs(t)>1e-6?H=!1:0!==t&&(B[W]=Math.round(B[W]))}if(R.normals=B,b){let t=YW.get();t.setLength(4*k),t=hv(R.vertices,R.normals,R.uvs,F,t),t=function(t,e){const n=e.getLength(),i=new Float32Array(n),r=[],o=[],s=[];for(let a=0;a<n;a+=4){const n=a/4*3;pg(o,t[n]||0,t[n+1]||0,t[n+2]||0),qg(r,e[a]||0,e[a+1]||0,e[a+2]||0,e[a+3]||0),Jy(s,o,r),Wg(i.subarray(a,a+4),s)}return i}(R.normals,t),R.tangents=t,D.push(t.buffer),delete R.normals}if(R.normals&&(H&&(R.normals=oN.createTypedArray(R.normals,Int8Array)),D.push(R.normals.buffer)),R.uvs&&(R.uvs=oN.createTypedArray(R.uvs,Float32Array),D.push(R.uvs.buffer)),p){const t=R.vertices,e=t.length;for(let n=0;n<e;n+=3)t[n]-=p[0],t[n+1]-=p[1]}const U=function(t,e,n,i){const r={},o={},s=i.getLength();if(lB(e.polygonFill)){let a=OE(e.polygonFill);const h=new Uint8Array(4*s);h.fill(255);for(let e=0;e<s;e++){const o=t[i[e]],s=o.properties||{};s.$layer=o.layer,s.$type=o.type;let l=a(n,s);SE(l)&&(r.aColor=1,a=OE(l),l=a(n,s)),delete s.$layer,delete s.$type,jD(KW,l),h[4*e]=KW[0],h[4*e+1]=KW[1],h[4*e+2]=KW[2],h[4*e+3]=KW[3]}o.aColor=h}if(lB(e.polygonOpacity)){let a=EE(e.polygonOpacity);const h=new Uint8Array(s);h.fill(255);for(let e=0;e<s;e++){const o=t[i[e]],s=o.properties||{};s.$layer=o.layer,s.$type=o.type;let l=a(n,s);SE(l)&&(r.aOpacity=1,a=OE(l),l=a(n,s)),delete s.$layer,delete s.$type,h[e]=255*l}o.aOpacity=h}return o.dynamicAttributes=r,o}(t,u,c,R.featureIndexes),G=function(t,e,n,i,r){const o=[[],[]],s=lB(i.topPolygonFill),a=lB(i.bottomPolygonFill),h=[255,255,255,255],l=e.getLength();if(s||a){let u=s&&OE(i.topPolygonFill),c=a&&OE(i.bottomPolygonFill),A=null,f=null,d=null,p=null;for(let i=0;i<l;i++){if(1===t[i]&&!s||0===t[i]&&!a)continue;const l=1===t[i];if(l&&e[i]===A){t[i]=d;continue}if(!l&&e[i]===f){t[i]=p;continue}const g=n[e[i]],m=g.properties||{};m.$layer=g.layer,m.$type=g.type;let y=l?u:c,v=y(r,m);SE(v)&&(y=OE(v),v=y(r,m)),delete m.$layer,delete m.$type,jD(KW,v),Yg(KW,KW,h);let _=$W(o,KW);_<0&&(_=o.length,o.push(Wg([],KW))),t[i]=_,l?(A=e[i],d=_):(f=e[i],p=_)}}return o.slice(2)}(R.verticeTypes,R.featureIndexes,t,u,c),V={data:{data:{aVertexColorType:oN.createTypedArray(R.verticeTypes,G.length<=252?Uint8Array:Uint16Array),aPosition:R.vertices,aNormal:R.normals,aTexCoord0:R.uvs,aTangent:R.tangents,aPickingId:R.pickingIds},indices:F,properties:{maxAltitude:R.maxAltitude,hasNegativeHeight:R.hasNegativeHeight},dynamicAttributes:U.dynamicAttributes,vertexColors:G},buffers:D};return R.featureIds.length?(V.data.featureIds=R.featureIds,D.push(V.data.featureIds.buffer)):V.data.featureIds=[],U.aColor&&(V.data.data.aColor=U.aColor,V.buffers.push(U.aColor.buffer)),U.aOpacity&&(V.data.data.aOpacity=U.aOpacity,V.buffers.push(U.aOpacity.buffer)),V.buffers.push(V.data.data.aPosition.buffer),V.data.pickingIdIndiceMap=xD(V.data.data.aPickingId,V.data.indices),V}const KW=[];function $W(t,e){for(let n=0;n<t.length;n++)if(sm(e,t[n]))return n;return-1}var tq={exports:{}},eq=function(t,e,n,i){var r=t[0],o=t[1],s=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);for(var a=(i-n)/2,h=0,l=a-1;h<a;l=h++){var u=e[n+2*h+0],c=e[n+2*h+1],A=e[n+2*l+1];c>o!=A>o&&r<(e[n+2*l+0]-u)*(o-c)/(A-c)+u&&(s=!s)}return s},nq=function(t,e,n,i){var r=t[0],o=t[1],s=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);for(var a=i-n,h=0,l=a-1;h<a;l=h++){var u=e[h+n][0],c=e[h+n][1],A=e[l+n][1];c>o!=A>o&&r<(e[l+n][0]-u)*(o-c)/(A-c)+u&&(s=!s)}return s};tq.exports=function(t,e,n,i){return e.length>0&&Array.isArray(e[0])?nq(t,e,n,i):eq(t,e,n,i)};var iq=tq.exports.nested=nq;tq.exports.flat=eq;const rq=11102230246251565e-32,oq=134217729,sq=(3+8*rq)*rq;function aq(t,e,n,i,r){let o,s,a,h,l=e[0],u=i[0],c=0,A=0;u>l==u>-l?(o=l,l=e[++c]):(o=u,u=i[++A]);let f=0;if(c<t&&A<n)for(u>l==u>-l?(s=l+o,a=o-(s-l),l=e[++c]):(s=u+o,a=o-(s-u),u=i[++A]),o=s,0!==a&&(r[f++]=a);c<t&&A<n;)u>l==u>-l?(s=o+l,h=s-o,a=o-(s-h)+(l-h),l=e[++c]):(s=o+u,h=s-o,a=o-(s-h)+(u-h),u=i[++A]),o=s,0!==a&&(r[f++]=a);for(;c<t;)s=o+l,h=s-o,a=o-(s-h)+(l-h),l=e[++c],o=s,0!==a&&(r[f++]=a);for(;A<n;)s=o+u,h=s-o,a=o-(s-h)+(u-h),u=i[++A],o=s,0!==a&&(r[f++]=a);return 0===o&&0!==f||(r[f++]=o),f}function hq(t){return new Float64Array(t)}const lq=33306690738754716e-32,uq=22204460492503146e-32,cq=11093356479670487e-47,Aq=hq(4),fq=hq(8),dq=hq(12),pq=hq(16),gq=hq(4);function mq(t,e,n,i,r,o,s){for(var a=new iz([],yq),h=t.data;h;){for(var l=0;l<h.children.length;l++){var u=h.children[l],c=h.leaf?Mq(u,n,i):vq(n,i,u);c>o||a.push({node:u,dist:c})}for(;a.length&&!a.peek().node.children;){var A=a.pop(),f=A.node,d=Mq(f,e,n),p=Mq(f,i,r);if(A.dist<d&&A.dist<p&&xq(n,f,s)&&xq(i,f,s))return f}(h=a.pop())&&(h=h.node)}return null}function yq(t,e){return t.dist-e.dist}function vq(t,e,n){if(_q(t,n)||_q(e,n))return 0;var i=Tq(t[0],t[1],e[0],e[1],n.minX,n.minY,n.maxX,n.minY);if(0===i)return 0;var r=Tq(t[0],t[1],e[0],e[1],n.minX,n.minY,n.minX,n.maxY);if(0===r)return 0;var o=Tq(t[0],t[1],e[0],e[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var s=Tq(t[0],t[1],e[0],e[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===s?0:Math.min(i,r,o,s)}function _q(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function xq(t,e,n){for(var i,r,o,s,a=Math.min(t[0],e[0]),h=Math.min(t[1],e[1]),l=Math.max(t[0],e[0]),u=Math.max(t[1],e[1]),c=n.search({minX:a,minY:h,maxX:l,maxY:u}),A=0;A<c.length;A++)if(r=c[A].next.p,o=t,(i=c[A].p)!==(s=e)&&r!==o&&bq(i,r,o)>0!=bq(i,r,s)>0&&bq(o,s,i)>0!=bq(o,s,r)>0)return!1;return!0}function bq(t,e,n){return function(t,e,n,i,r,o){const s=(e-o)*(n-r),a=(t-r)*(i-o),h=s-a;if(0===s||0===a||s>0!=a>0)return h;const l=Math.abs(s+a);return Math.abs(h)>=lq*l?h:-function(t,e,n,i,r,o,s){let a,h,l,u,c,A,f,d,p,g,m,y,v,_,x,b,w,C;const P=t-r,M=n-r,T=e-o,S=i-o;_=P*S,A=oq*P,f=A-(A-P),d=P-f,A=oq*S,p=A-(A-S),g=S-p,x=d*g-(_-f*p-d*p-f*g),b=T*M,A=oq*T,f=A-(A-T),d=T-f,A=oq*M,p=A-(A-M),g=M-p,w=d*g-(b-f*p-d*p-f*g),m=x-w,c=x-m,Aq[0]=x-(m+c)+(c-w),y=_+m,c=y-_,v=_-(y-c)+(m-c),m=v-b,c=v-m,Aq[1]=v-(m+c)+(c-b),C=y+m,c=C-y,Aq[2]=y-(C-c)+(m-c),Aq[3]=C;let I=function(t,e){let n=e[0];for(let i=1;i<4;i++)n+=e[i];return n}(0,Aq),E=uq*s;if(I>=E||-I>=E)return I;if(c=t-P,a=t-(P+c)+(c-r),c=n-M,l=n-(M+c)+(c-r),c=e-T,h=e-(T+c)+(c-o),c=i-S,u=i-(S+c)+(c-o),0===a&&0===h&&0===l&&0===u)return I;if(E=cq*s+sq*Math.abs(I),I+=P*u+S*a-(T*l+M*h),I>=E||-I>=E)return I;_=a*S,A=oq*a,f=A-(A-a),d=a-f,A=oq*S,p=A-(A-S),g=S-p,x=d*g-(_-f*p-d*p-f*g),b=h*M,A=oq*h,f=A-(A-h),d=h-f,A=oq*M,p=A-(A-M),g=M-p,w=d*g-(b-f*p-d*p-f*g),m=x-w,c=x-m,gq[0]=x-(m+c)+(c-w),y=_+m,c=y-_,v=_-(y-c)+(m-c),m=v-b,c=v-m,gq[1]=v-(m+c)+(c-b),C=y+m,c=C-y,gq[2]=y-(C-c)+(m-c),gq[3]=C;const O=aq(4,Aq,4,gq,fq);_=P*u,A=oq*P,f=A-(A-P),d=P-f,A=oq*u,p=A-(A-u),g=u-p,x=d*g-(_-f*p-d*p-f*g),b=T*l,A=oq*T,f=A-(A-T),d=T-f,A=oq*l,p=A-(A-l),g=l-p,w=d*g-(b-f*p-d*p-f*g),m=x-w,c=x-m,gq[0]=x-(m+c)+(c-w),y=_+m,c=y-_,v=_-(y-c)+(m-c),m=v-b,c=v-m,gq[1]=v-(m+c)+(c-b),C=y+m,c=C-y,gq[2]=y-(C-c)+(m-c),gq[3]=C;const R=aq(O,fq,4,gq,dq);_=a*u,A=oq*a,f=A-(A-a),d=a-f,A=oq*u,p=A-(A-u),g=u-p,x=d*g-(_-f*p-d*p-f*g),b=h*l,A=oq*h,f=A-(A-h),d=h-f,A=oq*l,p=A-(A-l),g=l-p,w=d*g-(b-f*p-d*p-f*g),m=x-w,c=x-m,gq[0]=x-(m+c)+(c-w),y=_+m,c=y-_,v=_-(y-c)+(m-c),m=v-b,c=v-m,gq[1]=v-(m+c)+(c-b),C=y+m,c=C-y,gq[2]=y-(C-c)+(m-c),gq[3]=C;const D=aq(R,dq,4,gq,pq);return pq[D-1]}(t,e,n,i,r,o,l)}(t[0],t[1],e[0],e[1],n[0],n[1])}function wq(t){var e=t.p,n=t.next.p;return t.minX=Math.min(e[0],n[0]),t.minY=Math.min(e[1],n[1]),t.maxX=Math.max(e[0],n[0]),t.maxY=Math.max(e[1],n[1]),t}function Cq(t,e){var n={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function Pq(t,e){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function Mq(t,e,n){var i=e[0],r=e[1],o=n[0]-i,s=n[1]-r;if(0!==o||0!==s){var a=((t[0]-i)*o+(t[1]-r)*s)/(o*o+s*s);a>1?(i=n[0],r=n[1]):a>0&&(i+=o*a,r+=s*a)}return(o=t[0]-i)*o+(s=t[1]-r)*s}function Tq(t,e,n,i,r,o,s,a){var h,l,u,c,A=n-t,f=i-e,d=s-r,p=a-o,g=t-r,m=e-o,y=A*A+f*f,v=A*d+f*p,_=d*d+p*p,x=A*g+f*m,b=d*g+p*m,w=y*_-v*v,C=w,P=w;0===w?(l=0,C=1,c=b,P=_):(c=y*b-v*x,(l=v*b-_*x)<0?(l=0,c=b,P=_):l>C&&(l=C,c=b+v,P=_)),c<0?(c=0,-x<0?l=0:-x>y?l=C:(l=-x,C=y)):c>P&&(c=P,-x+v<0?l=0:-x+v>y?l=C:(l=-x+v,C=y));var M=(1-(u=0===c?0:c/P))*r+u*s-((1-(h=0===l?0:l/C))*t+h*n),T=(1-u)*o+u*a-((1-h)*e+h*i);return M*M+T*T}function Sq(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}class Iq{constructor(t,e){this.x=t,this.y=e}clone(){return new Iq(this.x,this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}negate(){this.x=-this.x,this.y=-this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}diff(t){return new Iq(this.x-t.x,this.y-t.y)}distance(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}orthogonal(){return new Iq(this.y,-this.x)}}function Eq(t,e,n,i){const r=((n.x-t.x)*i.y-(n.y-t.y)*i.x)/(e.x*i.y-e.y*i.x);return new Iq(t.x+r*e.x,t.y+r*e.y)}const Oq=[],Rq=[];function Dq(t){if(rB(t[0]&&t[0].x)){const e=[];let n=0;for(let i=0;i<t.length;i++)Rq[n]?(Rq[n][0]=t[i].x,Rq[n][1]=t[i].y):Rq[n]=[t[i].x,t[i].y],e.push(Rq[n]),n++;t=e}try{const e=function(t,e,n){e=Math.max(0,void 0===e?2:e),n=n||0;var i=function(t){for(var e=t[0],n=t[0],i=t[0],r=t[0],o=0;o<t.length;o++){var s=t[o];s[0]<e[0]&&(e=s),s[0]>i[0]&&(i=s),s[1]<n[1]&&(n=s),s[1]>r[1]&&(r=s)}var a=[e,n,i,r],h=a.slice();for(o=0;o<t.length;o++)iq(t[o],a)||h.push(t[o]);return function(t){t.sort(Sq);for(var e=[],n=0;n<t.length;n++){for(;e.length>=2&&bq(e[e.length-2],e[e.length-1],t[n])<=0;)e.pop();e.push(t[n])}for(var i=[],r=t.length-1;r>=0;r--){for(;i.length>=2&&bq(i[i.length-2],i[i.length-1],t[r])<=0;)i.pop();i.push(t[r])}return i.pop(),e.pop(),e.concat(i)}(h)}(t),r=new kR(16);r.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},r.compareMinX=function(t,e){return t[0]-e[0]},r.compareMinY=function(t,e){return t[1]-e[1]},r.load(t);for(var o,s=[],a=0;a<i.length;a++){var h=i[a];r.remove(h),o=Cq(h,o),s.push(o)}var l=new kR(16);for(a=0;a<s.length;a++)l.insert(wq(s[a]));for(var u=e*e,c=n*n;s.length;){var A=s.shift(),f=A.p,d=A.next.p,p=Pq(f,d);if(!(p<c)){var g=p/u;(h=mq(r,A.prev.p,f,d,A.next.next.p,g,l))&&Math.min(Pq(h,f),Pq(h,d))<=g&&(s.push(A),s.push(Cq(h,A)),r.remove(h),l.remove(A),l.insert(wq(A)),l.insert(wq(A.next)))}}A=o;var m=[];do{m.push(A.p),A=A.next}while(A!==o);return m.push(A.p),m}(t,1/0);let n=[1/0,1/0],i=[-1/0,-1/0];for(let t=0;t<e.length;t++)e[t][0]<n[0]&&(n[0]=e[t][0]),e[t][0]>i[0]&&(i[0]=e[t][0]),e[t][1]<n[1]&&(n[1]=e[t][1]),e[t][1]>i[1]&&(i[1]=e[t][1]);const r=[];let o=[],s=0;for(let t=0;t<e.length;t++)t===e.length-1&&e[t][0]===e[0][0]&&e[t][1]===e[0][1]||(VW(r,e[t]),Oq[s]?(Oq[s].x=r[0],Oq[s].y=r[1]):Oq[s]=new Iq(r[0],r[1]),o.push(Oq[s]),s++);pD(o)<0&&(o=o.reverse());const a=function(t){let e,n=Number.MAX_VALUE;const i=function(t,i,r,o,s,a,h,l){var u=Eq(t,i,s,a),c=Eq(r,o,s,a),A=Eq(h,l,t,i),f=Eq(h,l,r,o),d=u.distance(c)*u.distance(A);0!==d&&d<n&&(e=[u,A,f,c],n=d)};var r=[];for(let m=0;m<t.length;m++)r.push(t[(m+1)%t.length].diff(t[m])),r[m].normalize();var o,s,a,h,l=new Iq(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=new Iq(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let m=0;m<t.length;m++){var c=t[m];c.x<l.x&&(l.x=c.x,o=m),c.x>u.x&&(u.x=c.x,s=m),c.y<l.y&&(l.y=c.y,h=m),c.y>u.y&&(u.y=c.y,a=m)}var A=new Iq(0,-1),f=new Iq(0,1),d=new Iq(-1,0),p=new Iq(1,0);for(let m=0;m<t.length;m++){var g=[Math.acos(A.dot(r[o])),Math.acos(f.dot(r[s])),Math.acos(d.dot(r[a])),Math.acos(p.dot(r[h]))];switch(g.indexOf(Math.min.apply(Math,g))){case 0:(f=(A=r[o].clone()).clone()).negate(),(p=(d=A.orthogonal()).clone()).negate(),o=(o+1)%t.length;break;case 1:(A=(f=r[s].clone()).clone()).negate(),(p=(d=A.orthogonal()).clone()).negate(),s=(s+1)%t.length;break;case 2:(p=(d=r[a].clone()).clone()).negate(),(f=(A=p.orthogonal()).clone()).negate(),a=(a+1)%t.length;break;case 3:(d=(p=r[h].clone()).clone()).negate(),(f=(A=p.orthogonal()).clone()).negate(),h=(h+1)%t.length}i(t[o],A,t[s],f,t[a],d,t[h],p)}return e}(o);if(!a||4!==a.length)return null;const h=a[0].distance(a[1]),l=a[1].distance(a[2]),u=a.map((t=>[t.x,t.y]));return u.push(+(l>h)),u}catch(e){return null}}class kq extends wH{static fromJSON(t){return DW(t,"ExtrudePolygonLayer",kq)}getPolygonOffsetCount(){return 0}getPolygonOffset(){return 0}onConfig(t){const e=this.getRenderer();return e&&e.onConfig(t),super.onConfig(t)}updateMaterial(t){this.options.material||(this.options.material={}),t?nB(this.options.material,t):this.options.material=null;const e=this.getRenderer();return e&&e.updateMaterial(t),this}updateSideMaterial(t){let e=!1;this.options.sideMaterial||(this.options.sideMaterial={},e=!0),t?nB(this.options.sideMaterial,t):this.options.sideMaterial=null;const n=this.getRenderer();return n&&(e&&n.$l(),n.updateSideMaterial(t)),this}updateDataConfig(t){if(!t)return this;this.options.dataConfig||(this.options.dataConfig={});const e=JSON.parse(JSON.stringify(this.options.dataConfig));nB(this.options.dataConfig,t);const n=this.getRenderer();return n&&n.updateDataConfig(t,e),this}}kq.registerJSONType("ExtrudePolygonLayer"),kq.mergeOptions({cullFace:!1,castShadow:!0});const Lq={polygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_polygonFill"},polygonOpacity:{type:"identity",default:1,property:"_symbol_polygonOpacity"},topPolygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_topPolygonFill"},bottomPolygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_bottomPolygonFill"}},Fq={defaultAltitude:20},Nq=t=>1===t.properties.top;if(kq.registerRenderer("gl",class extends BW{constructor(...t){super(...t),this.GeometryTypes=[Fl,Xl]}Bl(t){return[t]}onConfig(t){this.painter&&(aB(t.cullFace)||this.painter.updateSceneConfig({cullFace:t.cullFace}))}updateMaterial(t){this.painter&&(this.painter.Ao(t),this.layer.options.sideMaterial||this.sidePainter.Ao(t),this.setToRedraw())}$l(){this.sidePainter&&this.sidePainter.deleteMaterial()}updateSideMaterial(t){this.sidePainter&&(t?this.sidePainter.Ao(t):(this.sidePainter.deleteMaterial(),this.sidePainter.Ao(this.layer.options.material)),this.setToRedraw())}updateDataConfig(t,e){this.painter&&(this.painter.updateDataConfig(t,e),this.Ml())}updateBloom(t){super.updateBloom(t),this.sidePainter&&this.Ul(this.sidePainter,this.sidePainterSymbol,t)}needCheckPointLineSymbols(){return!1}draw(t,e){return super.draw(t,e)}createPainter(){const t=wH.get3DPainterClass("lit");this.painterSymbol=nB({},Lq),this.sidePainterSymbol=nB({},Lq),this.Nl(this.painterSymbol,t.getBloomSymbol());const e=this.layer,n=nB({},Fq,e.options.dataConfig||{});e.options.material&&(this.painterSymbol.material=e.options.material),this.sidePainterSymbol.material=e.options.sideMaterial?e.options.sideMaterial:e.options.material;const i={cullFace:e.options.cullFace};Object.defineProperty(i,"castShadow",{enumerable:!0,get:()=>e.options.castShadow}),Object.defineProperty(i,"depthMask",{enumerable:!0,get:()=>e.options.depthMask});const r=nB({},n);r.upsideUpTexture=!0;const o=new t(this.regl,e,this.painterSymbol,i,0,r);return this.sidePainter=new t(this.regl,e,this.sidePainterSymbol,i,0,n),o}an(...t){super.an(...t);const e=this.painter;this.painter=this.sidePainter,super.an(...t),this.painter=e}il(...t){const e=t[0],n=e.sceneFilter;e.sceneFilter=t=>(!n||n(t))&&Nq(t);const i=super.il(...t);e.sceneFilter=t=>(!n||n(t))&&Nq(t);const r=this.painter;this.painter=this.sidePainter;const o=e.sceneFilter=t=>(!n||n(t))&&1===t.properties.side;return super.il(...t),this.painter=r,e.sceneFilter=n,{redraw:i.redraw||o.redraw,drawCount:(i.drawCount||0)+(o.drawCount||0)}}createMesh(t,e,n,i,r,o){const s=[];this.Wl=o;const a=this.Xl(i,n,!0,!1),h=this.Xl(i,n,!1,!0);if(a){const r=this.ll(a,t,e,n,i,null,o);r.meshes[0].properties.top=1,s.push(r)}if(h){const r=this.ll(h,t,e,n,i,null,o);r.meshes[0].properties.side=1,s.push(r)}return s}Xl(t,e,n,i){const r=this.getMap();e=Lq;const o=this.Wl,s=r.getZoom(),a=new ht(0,0),h=new $o(0,0),l=nB({},Fq,this.layer.options.dataConfig);if(l.uv=!0,l.top&&(l.top=n),l.side&&(l.side=i),!1===l.top&&!1===l.side)return null;if(!t.length)return null;const u=r.getGLRes(),c=r.getProjection().code,A=n?this.painterSymbol&&this.painterSymbol.material:this.sidePainterSymbol&&this.sidePainterSymbol.material,f=A&&A.textureWidth||23.25,d=[KB(r,1,h,u)/100,KB(r,1,h,u,1)/100];return JW(t,l,1/0,a,f,r.getGLRes(),1,1,d,this.nn,e,s,c,void 0,Float32Array,o)}updateMesh(t){let e=this.features[t[fW]];if(!e||!this.meshes)return;const n=this.Xl([e],this.painterSymbol,!0,!1);let i=0;n&&n.data&&this.Tl(this.meshes[i++],e.id,n);const r=this.Xl([e],this.painterSymbol,!1,!0);r&&r.data&&this.Tl(this.meshes[i++],e.id,r)}Al(t){if(t.getProperties()||t.setProperties({}),!t.getProperties()[SB]){const e=t.getCoordinates();if(t instanceof Xl){const n=[];for(let t=0;t<e.length;t++)n[t]=Dq(e[t]&&e[t][0]);t.getProperties()[SB]=n}else{const n=Dq(e[0]);t.getProperties()[SB]=n}}return super.Al(t)}resizeCanvas(t){super.resizeCanvas(t),this.sidePainter&&this.sidePainter.resize(this.canvas.width,this.canvas.height)}onRemove(){super.onRemove(),this.sidePainter&&(this.sidePainter.delete(),delete this.sidePainter)}drawOutline(t){if(super.drawOutline(t),this.mn&&this.sidePainter&&this.sidePainter.outlineAll(t),this.jl)for(let e=0;e<this.jl.length;e++)this.sidePainter&&this.sidePainter.outline(t,this.jl[e])}getShadowMeshes(){return this.painter?this.painter.getShadowMeshes():[]}}),kq.registerRenderer("canvas",null),lx.register("vt_position_vert","#ifdef HAS_TERRAIN_ALTITUDE\n    attribute float aTerrainAltitude;\n#endif\nuniform float minAltitude;\n#ifdef HAS_ALTITUDE\n    vec3 unpackVTPosition() {\n        float altitude = aAltitude;\n        #ifdef HAS_TERRAIN_ALTITUDE\n            altitude += aTerrainAltitude * 100.0;\n        #endif\n        altitude += minAltitude * 100.0;\n        return vec3(aPosition, altitude);\n    }\n#else\n    float position_modValue = 16384.0;\n    float position_delta = 0.00001;\n    vec3 unpackVTPosition() {\n        float z = aPosition.z;\n        vec2 pos = sign(aPosition.xy + position_delta) * mod(abs(aPosition.xy), position_modValue);\n        vec2 highs = floor(abs(aPosition.xy) / position_modValue);\n        float altitude = sign(z + position_delta) * (highs.x * 2.0 + highs.y) * pow(2.0, 15.0) + z;\n        #ifdef HAS_TERRAIN_ALTITUDE\n            altitude += aTerrainAltitude * 100.0;\n        #endif\n        altitude += minAltitude * 100.0;\n        return vec3(pos, altitude);\n    }\n#endif"),Lp(),cE){const t=Al.VERSION;t.indexOf("1.0.0-beta")>=0||t.indexOf("1.0.0-alpha")>=0?cr("@maptalks/vt",cE.inject(YR)):cr("@maptalks/vt",(function(){return cE.inject(YR)}))}else cr("@maptalks/vt",YR);for(var zq=[],Bq=0;Bq<6;Bq++)zq[Bq]=[];var Hq=[];function jq(t,e,n){Kq(t);for(var i=0;i<6;i++){var r=zq[i];if(Hq[0]=r[0]>0?e[1][0]:e[0][0],Hq[1]=r[1]>0?e[1][1]:e[0][1],Hq[2]=r[2]>0?e[1][2]:e[0][2],tZ(r,Hq)<0)return!1}return!0}var Uq=3,Gq=4,Vq=5,Wq=6,qq=7,Zq=8,Qq=9,Xq=10,Yq=11;function Jq(t,e){var n=e,i=e,r=t[0],o=t[1],s=t[2],a=Math.abs(r*i[Uq]+o*i[Gq]+s*i[Vq])+Math.abs(r*i[Wq]+o*i[qq]+s*i[Zq])+Math.abs(r*i[Qq]+o*i[Xq]+s*i[Yq]);return!(tZ(t,n)<=-a)}function Kq(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],s=t[5],a=t[6],h=t[7],l=t[8],u=t[9],c=t[10],A=t[11],f=t[12],d=t[13],p=t[14],g=t[15];$q(zq[0],r-e,h-o,A-l,g-f),$q(zq[1],r+e,h+o,A+l,g+f),$q(zq[2],r+n,h+s,A+u,g+d),$q(zq[3],r-n,h-s,A-u,g-d),$q(zq[4],r-i,h-a,A-c,g-p),$q(zq[5],r+i,h+a,A+c,g+p)}function $q(t,e,n,i,r){var o=1/Math.sqrt(e*e+n*n+i*i);return t[0]=e*o,t[1]=n*o,t[2]=i*o,t[3]=r*o,t}function tZ(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}const eZ="${",nZ=`function(t){\n/*!\n   * @maptalks/gltf-loader v0.98.4\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.org\n   */\nvar e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],f=e[7],l=e[8],h=e[9],d=e[10],y=e[11],m=e[12],b=e[13],p=e[14],g=e[15],w=n[0],v=n[1],M=n[2],A=n[3];return t[0]=w*r+v*a+M*l+A*m,t[1]=w*i+v*c+M*h+A*b,t[2]=w*s+v*u+M*d+A*p,t[3]=w*o+v*f+M*y+A*g,w=n[4],v=n[5],M=n[6],A=n[7],t[4]=w*r+v*a+M*l+A*m,t[5]=w*i+v*c+M*h+A*b,t[6]=w*s+v*u+M*d+A*p,t[7]=w*o+v*f+M*y+A*g,w=n[8],v=n[9],M=n[10],A=n[11],t[8]=w*r+v*a+M*l+A*m,t[9]=w*i+v*c+M*h+A*b,t[10]=w*s+v*u+M*d+A*p,t[11]=w*o+v*f+M*y+A*g,w=n[12],v=n[13],M=n[14],A=n[15],t[12]=w*r+v*a+M*l+A*m,t[13]=w*i+v*c+M*h+A*b,t[14]=w*s+v*u+M*d+A*p,t[15]=w*o+v*f+M*y+A*g,t}function r(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function i(t,n,r){var i=new e(3);return i[0]=t,i[1]=n,i[2]=r,i}function s(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function a(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function c(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function u(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function f(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*s+n[12]*o,t[1]=n[1]*r+n[5]*i+n[9]*s+n[13]*o,t[2]=n[2]*r+n[6]*i+n[10]*s+n[14]*o,t[3]=n[3]*r+n[7]*i+n[11]*s+n[15]*o,t}function l(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),r(),function(){var t;t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var h,d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};r(),i(1,0,0),i(0,1,0),l(),l(),h=new e(9),e!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1;let y=0;function m(t){return null==t}function b(t){return!m(t)}function p(t){return!m(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function g(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function w(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+t)}function v(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function M(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return r.buffer}const A=[],T=[],_=[],k=[0,0,0],O=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),x=[1,1,1];function S(t,e,n,r,i,s,o){const a=w(o),c=a.BYTES_PER_ELEMENT;if((0===i||i===r*c)&&s%c==0){const i=new a(e,s,n*r);return t.set(i),t}0===i&&(i=r*c);const u=new Uint8Array(r*c);for(let o=0;o<n;o++){let n=null;const f=new Uint8Array(e,i*o+s,r*c);u.set(f),n=new a(u.buffer,0,r);for(let e=0;e<r;e++)t[o*r+e]=n[e]}return t}const I="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function E(t,e,n){const r=new Uint8Array(t,e,n);return I.decode(r)}const C={get:function(t,e={},n){e||(e={});const r=new AbortController,i=r.signal,s=g({},e);s.signal=i,s.method||(s.method="GET"),s.referrerPolicy=s.referrerPolicy||"origin","undefined"==typeof window||s.referrer||(s.referrer=window.location.href),n&&(t=n(t));const o=fetch(t,s).then((t=>{const n=this.t(t,e.responseType);return n.message?n:n.then((n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return o.xhr=r,o},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:\`incorrect http request with status code(${eZ}t.status}): ${eZ}t.statusText}\`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={},n)=>(e||(e={}),e.responseType="arraybuffer",C.get(t,e,n)),getJSON:function(t,e={},n){return e&&e.jsonp?C.jsonp(t):((e=e||{}).responseType="json",C.get(t,e,n))},jsonp:function(t){const e="_maptalks_jsonp_"+y++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise((t=>{window[e]=function(r){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(r)},document.getElementsByTagName("head")[0].appendChild(n)}))}};class U{constructor(t,e,n,r,i){this.i=t,this.decoders=e,this.o=n,this.images={},this.u={},this.h=r||{},this.m=i}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const r=this.buffers[t.id],i=this.p(e,r);return this.getImageByBuffer(i,n)}if(this.u[t.id])return this.u[t.id].then((()=>{const r=this.buffers[t.id],i=this.p(e,r);return this.getImageByBuffer(i,n)}));if(v(t.uri)){const r=this.buffers[t.id]=M(t.uri),i=this.p(e,r);return this.getImageByBuffer(i,n)}let r;const i=t.uri.indexOf("blob:")>=0;return r=t.uri.indexOf("://")>0||i?t.uri:this.rootPath+"/"+t.uri,this.u[t.id]=C.getArrayBuffer(r,this.h,this.m).then((r=>{const i=this.buffers[t.id]=r.data,s=this.p(e,i);return this.getImageByBuffer(s,n)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;return n[e.mimeType]?n[e.mimeType](t,{supportedFormats:this.o}):"image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType?(console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this.v(e.id,t)}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.u[t.id]?this.u[t.id].then((()=>this.images[t.id])):this.u[t.id]=this.v(t.id,e)}v(t,e){return new Promise(((n,r)=>{let i=e;this.m&&(i=this.m(e)),this.i(i,this.h,((i,s)=>{i?r(i):(URL.revokeObjectURL(e),this.images[t]=s,n(this.images[t]))}))}))}}const F=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],N=[];class P{constructor(t,e,n,r,i){this.rootPath=t,this.gltf=e,this.M=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this.A(),this.h=r,this.m=i}T(t,e){const n=this.gltf,r=n.accessors[e];if(void 0===r.bufferView)return this.accessors[r.id]=this._(t,e,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);const i=n.bufferViews[r.bufferView];return this.k(i).then((n=>{const{buffer:i,byteOffset:s}=n;return this.accessors[r.id]=this._(t,e,i,s)}))}k(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then((()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(v(e.uri)){const t=this.buffers[e.id]=M(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=C.getArrayBuffer(t,this.h,!n&&this.m).then((r=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=r.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_(t,e,n,r=0){const i=this.gltf,s=i.accessors[e],o=void 0!==s.bufferView?i.bufferViews[s.bufferView]:{},a=(o.byteOffset||0)+r,c=this.O(s.type),u=w(s.componentType),l=o.byteStride||0,h={array:void 0,name:t,accessorName:e,byteLength:s.count*c*u.BYTES_PER_ELEMENT,componentType:s.componentType,count:s.count,type:s.type,itemSize:c,max:s.max,min:s.min,extensions:s.extensions};if(s.min&&(h.min=s.min),s.max&&(h.max=s.max),n)if(this.M)h.byteStride=l,h.byteOffset=a+(s.byteOffset||0),!l||l===c*u.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(h.array=this.S(n,s.count,c,a+(s.byteOffset||0),u),h.array.buffer.byteLength===h.byteLength&&(h.byteOffset=0)):h.array=new Uint8Array(n,a,o.byteLength);else if(s.interleaved){h.byteStride=0,h.byteOffset=0;const t=new u(s.count*c);if(h.array=S(t,n,s.count,c,l,a+(s.byteOffset||0),s.componentType),h.extensions&&h.extensions.WEB3D_quantized_attributes&&c>2){const t=new Float32Array(h.array.length),{decodeMatrix:e}=h.extensions.WEB3D_quantized_attributes;for(let n=0;n<h.array.length;n+=c){N[0]=h.array[n],N[1]=h.array[n+1],N[2]=h.array[n+2],N[3]=1;const r=f(N,N,e);t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2]}h.componentType=5126,h.array=t}}else h.byteStride=0,h.array=this.S(n,s.count,c,a+(s.byteOffset||0),u),h.byteOffset=h.array.byteOffset;else{h.array=new u(s.count);const t=h.min||h.max;t&&(h.array[0]=t[0],h.array[1]=t[1],h.array[2]=t[2])}return h}A(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}S(t,e,n,r,i){return r%i.BYTES_PER_ELEMENT!=0&&(t=t.slice(r,r+e*n*i.BYTES_PER_ELEMENT),r=0),new i(t,r,n*e)}O(t){const e=F.indexOf(t);return F[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this.k(e).then((r=>{const{buffer:i,byteOffset:s}=r,o=E(i,s+(e.byteOffset||0),n);return t.content=o,t}))}if(t.uri){if(v(t.uri)){const e=M(t.uri),n=E(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return C.get(e,this.h,this.m).then((e=>(t.content=e,t)))}}return Promise.resolve(t)}));return Promise.all(n).then((()=>t))}}class B extends U{constructor(t,e,n,r,i,s,o,a){super(r,i,s,o,a),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new P(t,e,n,o,a)}iterate(t,e){const n=this.gltf[e];if(!n)return;let r=0;for(const e in n)t(e,n[e],r++)}createNode(t){const e={};if(b(t.name)&&(e.name=t.name),b(t.children)&&(e.children=t.children),b(t.jointName)&&(e.jointName=t.jointName),b(t.matrix)&&(e.matrix=t.matrix),b(t.rotation)&&(e.rotation=t.rotation),b(t.scale)&&(e.scale=t.scale),b(t.translation)&&(e.translation=t.translation),b(t.extras)&&(e.extras=t.extras),b(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(A,e.translation||k),i=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,c=i+i,u=n*o,f=r*o,l=r*a,h=i*o,d=i*a,y=i*c,m=s*o,b=s*a,p=s*c;return t[0]=1-l-y,t[1]=f+p,t[2]=h-b,t[3]=0,t[4]=f-p,t[5]=1-u-y,t[6]=d+m,t[7]=0,t[8]=h+b,t[9]=d-m,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(T,e.rotation||O),s=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(_,e.scale||x);return n(s,i,s),n(t,r,s)}return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}I(t){const e={};for(const n in t){const r=t[n];let i,s;r.instanceTechnique&&r.instanceTechnique.values?(i=r.instanceTechnique,s=i.values.diffuse):(i=r,s=i.values.tex||i.values.diffuseTex||i.values.diffuse);const o={baseColorTexture:{index:s}};r.name&&(o.name=r.name),r.extensions&&(o.extensions=r.extensions),r.extras&&(o.extras=r.extras),e[n]=o}return e}C(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],r=(n.byteOffset||0)+this.glbBuffer.byteOffset,i=n.byteLength,s=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,r,i);return this.getImageByBuffer(s,t)}return this.requestExternalImage(t)}U(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.C(n).then((t=>{const r=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:r}}))}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,r;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,r=n.values.diffuse):(n=e,r=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const i=this.gltf.textures[r];if(!i)return null;const s=this.gltf.samplers[i.sampler];return{format:i.format||6408,internalFormat:i.internalFormat||6408,type:i.type||5121,sampler:s,source:this.gltf.images[i.source]}}getMaterial(){return null}getAnimations(){return null}}const D=9729;class R extends U{constructor(t,e,n,r,i,s,o,a){super(r,i,s,o,a),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new P(t,e,n,o,a)}iterate(t,e){const n=this.gltf[e];if(n)for(let e=0;e<n.length;e++)t(e,n[e],e)}createNode(t){const e={};return g(e,t),!b(t.weights)&&this.gltf.meshes&&b(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}U(t){const e=this.gltf.textures[t];if(!e)return null;let n=e.source;if(e.extensions&&e.extensions.EXT_texture_webp&&(n=e.extensions.EXT_texture_webp.source),!b(n))return null;const r=this.gltf.images[n];return this.C(r).then((t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};g(n,e);const i=b(e.sampler)?this.gltf.samplers[e.sampler]:void 0;if(i&&(n.sampler=i,n.sampler.magFilter=i.magFilter||D,n.sampler.minFilter=i.minFilter||9987,n.sampler.wrapS=i.wrapS||10497,n.sampler.wrapT=i.wrapT||10497),"image/ktx2"===n.image.mimeType&&!n.image.mipmap&&n.sampler&&n.sampler.minFilter!==D&&9728!==n.sampler.minFilter){const t=n.sampler.minFilter;n.sampler.minFilter=9984===t||9986===t?9728:D}return t.format&&(n.format=t.format),n}))}C(t){if(!b(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this.F(e,t)}return null}F(t,e){const n=this.p(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}p(t,e,n){n=n||0;const r=(t.byteOffset||0)+n,i=t.byteLength;return new Uint8Array(e,r,i)}N(t,e){const n=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)n[e]=String.fromCharCode(t[e]);n.join("");const r="data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(n)));return r}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t}))}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(b(t[n].input)||b(t[n].output))&&(e.push(this.accessor.T("input",t[n].input)),e.push(this.accessor.T("output",t[n].output)));return Promise.all(e).then((e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t}))}}const L="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class j{static read(t,e=0,n=0){n||(n=t.byteLength);const r=new DataView(t,e,n),i=r.getUint32(4,!0);if(1===i)return j.readV1(r,e);if(2===i)return j.readV2(t,e);throw new Error("Unsupported glb version : "+i)}static readV1(t,e){const n=t.getUint32(8,!0),r=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const i=z(t.buffer,20+e,r);return{json:JSON.parse(i),glbBuffer:{byteOffset:20+e+r,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,r,i;const s=new DataView(t,e+12);let o=0;for(;o+8<s.byteLength;){const a=s.getUint32(o,!0);o+=4;const c=s.getUint32(o,!0);if(o+=4,1313821514===c)n=z(t,e+12+o,a);else if(5130562===c){i=e+12+o,r=a;break}o+=a}return{json:JSON.parse(n),glbBuffer:{byteOffset:i,buffer:t,byteLength:r}}}}function z(t,e,n){if(L){const r=new Uint8Array(t,e,n);return L.decode(r)}return function(t){const e=t.length;let n="";for(let r=0;r<e;){let i=t[r++];if(128&i){let n=q[i>>3&7];if(!(64&i)||!n||r+n>e)return null;for(i&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;i=i<<6|63&e}}n+=String.fromCharCode(i)}return n}(new Uint8Array(t,e,n))}const q=[1,1,1,1,2,2,3,0],V=[0,0,0],G=[0,0,0,1],$=[1,1,1],X={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},H={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},J={P(t,e,n,r,i,o,a,c){const u=b(t)?e.animations:[e.animations[0]],f={};for(let e=0;e<u.length;e++){const l=u[e],h=l.name||e;if(b(t)&&h!==t)continue;const y=l.channelsMap[n];if(y)for(let t=0;t<y.length;t++){const e=y[t];"translation"===e.target.path?(this.B(i,l.samplers[e.sampler],r,1),f.translation=s(V,i)):"rotation"===e.target.path?(this.D(o,l.samplers[e.sampler],r,1),f.rotation=d(G,o)):"scale"===e.target.path?(this.B(a,l.samplers[e.sampler],r,1),f.scale=s($,a)):"weights"===e.target.path&&c&&(this.B(c,l.samplers[e.sampler],r,c.length),f.weights=c)}}return f},B(t,e,n,r){switch(e.interpolation){case"LINEAR":{const i=this.R(H,e,n,1*r);i&&(t=function(t,e,n,r){for(let i=0;i<t.length;i++)t[i]=e[i]+r*(n[i]-e[i]);return t}(t,i.PREVIOUS,i.NEXT,i.INTERPOLATION));break}case"STEP":{const i=this.R(H,e,n,1*r);i&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...i.PREVIOUS));break}case"CUBICSPLINE":{const i=this.R(H,e,n,3*r);i&&(t=this.L(t,i,e.input.array,3*r));break}}return t},D(t,e,n){switch(e.interpolation){case"LINEAR":{const r=this.R(H,e,n,1);r&&function(t,e,n,r){var i,s,o,a,c,u=e[0],f=e[1],l=e[2],h=e[3],d=n[0],y=n[1],m=n[2],b=n[3];(s=u*d+f*y+l*m+h*b)<0&&(s=-s,d=-d,y=-y,m=-m,b=-b),1-s>1e-6?(i=Math.acos(s),o=Math.sin(i),a=Math.sin((1-r)*i)/o,c=Math.sin(r*i)/o):(a=1-r,c=r),t[0]=a*u+c*d,t[1]=a*f+c*y,t[2]=a*l+c*m,t[3]=a*h+c*b}(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const r=this.R(H,e,n,1);r&&(t=u(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this.R(H,e,n,3);if(r){for(let t=0;t<r.PREVIOUS.length;t++)r.PREVIOUS[t]=Math.acos(r.PREVIOUS[t]),r.NEXT[t]=Math.acos(r.NEXT[t]);t=this.L(t,r,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},j(t,e){const n=t.length;let r,i,s,o=0,a=n-1,c=Math.floor((o+a)/2);for(;o<=n-1&&a>=0;){if(o===a)return null;if(t[c]<=e&&e<=t[c+1]){const n=t[c];return r=c,i=c+1,s=(e-n)/(t[c+1]-n),{preIndx:r,nextIndex:i,interpolation:s}}e<t[c]?(a=c,c=Math.floor((o+a)/2)):t[c+1]<e&&(o=c,c=Math.floor((o+a)/2))}return null},R(t,e,n,r){const i=e.input.array,s=e.output.array,o=e.output.itemSize;(n<i[0]||n>i[i.length-1])&&(n=Math.max(i[0],Math.min(i[i.length-1],n))),n===i[i.length-1]&&(n=i[0]);const a=this.j(i,n);if(!a||!a.nextIndex)return null;const{preIndx:c,nextIndex:u,interpolation:f}=a;t.PREINDEX=c,t.NEXTINDEX=u,t.INTERPOLATION=f;const l=o*r;return t.PREVIOUS=s.subarray(t.PREINDEX*l,(t.PREINDEX+1)*l),t.NEXT=s.subarray(t.NEXTINDEX*l,(t.NEXTINDEX+1)*l),t},L(t,e,n,r){const i=e.INTERPOLATION,s=n[e.PREINDEX],o=n[e.NEXTINDEX];for(let n=0;n<3;n++){const a=e.PREVIOUS[r+n],c=(o-s)*e.PREVIOUS[2*r+n],u=e.NEXT[3+n],f=(o-s)*e.NEXT[n],l=(2*Math.pow(i,3)-3*Math.pow(i,2)+1)*a+(Math.pow(i,3)-2*Math.pow(i,2)+i)*c+(2*-Math.pow(i,3)+3*Math.pow(i,2))*u+(Math.pow(i,3)-Math.pow(i,2))*f;t[n]=l}return t},getAnimationClip(t,e,n,r){const i=t.nodes[e]&&t.nodes[e].weights;return o(V,...X.TRANSLATION),u(G,...X.ROTATION),o($,...X.SCALE),this.P(r,t,e,n,V,G,$,i)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,n)=>{let r=-1/0,i=1/0;const s=e.channels;for(let t=0;t<s.length;t++){const n=s[t],o=e.samplers[n.sampler].input.array;o[o.length-1]>r&&(r=o[o.length-1]),o[0]<i&&(i=o[0])}const o=e.name||n;t.timeSpan[o]={max:r,min:i}})),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?b(e)?n[e]:n[Object.keys(n)[0]]:null}};let K=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(Je){}t&&"undefined"!=typeof createImageBitmap&&(K=!0)}const Y="undefined"==typeof document?null:document.createElement("canvas");class Q{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),this.h=this.options.fetchOptions||{},e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:r}=j.read(e.buffer,e.byteOffset,e.byteLength);this.q(t,n,r)}else this.q(t,e);this.V=new P(this.rootPath,this.gltf,this.glbBuffer,this.h,this.options.urlModifier),this.G()}G(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders["image/ktx2"])throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded");if(t.indexOf("EXT_meshopt_compression")>=0)throw new Error("EXT_meshopt_compression extension is not supported yet.")}}$(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.V.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){t=t||{};const e=this.X(t),n=this.H(),r=this.J(),i=this.$();return Promise.all([e,n,r,i]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const n=e[t];n.channelsMap={};for(let t=0;t<n.channels.length;t++){const e=n.channels[t];n.channelsMap[e.target.node]||(n.channelsMap[e.target.node]=[]),n.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let n=0;n<e.length;n++)e[n].uri&&e[n].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[n].uri});for(let e=0;e<n.length;e++)n[e].uri&&n[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[e].uri})}return t}static getAnimationClip(t,e,n,r){return J.getAnimationClip(t,e,n,r)}static getAnimationTimeSpan(t,e){return J.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return w(t)}static readInterleavedArray(t,e,n,r,i,s,o){return S(t,e,n,r,i,s,o)}q(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=K?it.bind(this):this.options.requestImage||W,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new R(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.h,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="buffer_"+n}),"buffers"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors")):(this.adapter=new B(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.h,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"))}K(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||p(t.children[0])))return t;const r=t.children.map((t=>{const n=e[t];return n.nodeIndex=t,this.K(n,e)}));t.children=r}var n;return t}X(t){return this.Y(t).then((t=>{const e=this.scenes=[];let n;for(const e in t)t[e]=this.K(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate(((r,i,s)=>{const o={};i.name&&(o.name=i.name),i.nodes&&(o.nodes=i.nodes.map((e=>t[e]))),this.gltf.scene===r&&(n=s),e.push(o)}),"scenes");const r={textures:this.gltf.textures,asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.I(this.gltf.materials);r.materials=t}return delete this.gltf.buffers,r.json=this.gltf,r}))}Y(t){return this.W(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,n)=>{const r=this.adapter.createNode(n,this.meshes,this.skins);t[e]=r}),"nodes"),t}))}Z(){this.skins=[];const t=[];return this.adapter.iterate(((e,n,r)=>{t.push(this.tt(n).then((t=>{t.index=r,this.skins.push(t)})))}),"skins"),t}tt(t){const e=t.inverseBindMatrices;return this.adapter.accessor.T("inverseBindMatrices",e).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}H(){const t=this.gltf.animations;return b(t)?this.adapter.getAnimations(t):null}W(t){this.meshes={};let e=[];return this.adapter.iterate(((n,r,i)=>{e.push(this.et(r,t).then((t=>{t.index=i,this.meshes[n]=t})))}),"meshes"),e=e.concat(this.Z()),Promise.all(e)}et(t,e){const n=t.primitives.map((t=>this.nt(t,e))).filter((t=>!!t));return Promise.all(n).then((e=>{const n={};return g(n,t),n.primitives=e,n}))}J(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter.U(n));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t]&&e[t].image.array;if(n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},r=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[r[t]]=e[t]);return n}return e}))}nt(t,e){let n;const r=[],i=t.extensions;if(b(t.targets))for(let e=0;e<t.targets.length;e++){const n=t.targets[e];for(const t in n){const i=this.adapter.accessor.T(\`morphTargets_${eZ}t}_${eZ}e}\`,n[t]);i&&r.push(i)}}if(i&&i.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:s,attributes:o}=i.KHR_draco_mesh_compression,a=this.gltf.bufferViews[s],c=this.V.k(a).then((n=>{const{buffer:r,byteOffset:i}=n;let{byteOffset:s}=a;const c=a.byteLength;s||(s=0);const u=new DataView(r,i+s,c),f={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(u,f).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));r.push(c),n=Promise.all(r)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor.T(t,e[t]);n&&r.push(n)}if(b(t.indices)){const e=this.adapter.accessor.T("indices",t.indices);e&&r.push(e)}n=Promise.all(r)}return n.then((e=>{if(i&&i.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,r;const s={attributes:e.reduce(((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)r=r||{},r[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:r,array:i}=e,s=i.length/r;for(let e=0;e<s;e++)for(let s=0;s<r;s++){const o=e*r+s;i[o]<t[s]&&(t[s]=i[o]),i[o]>n[s]&&(n[s]=i[o])}if(e.quantization){const r=e.quantization,i=r.range/(1<<r.quantizationBits),s=r.minValues;c(t,t,i),a(t,t,s),c(n,n,i),a(n,n,s)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return n&&(s.indices=n),r&&(s.morphTargets=r),s.mode=b(t.mode)?t.mode:4,b(t.extras)&&(s.extras=t.extras),s}))}}function W(t,e,n){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!Y)return void n(new Error("There is no canvas to draw image!"));Y.width=r.width,Y.height=r.height;const t=Y.getContext("2d",{willReadFrequently:!0});t.drawImage(r,0,0,r.width,r.height);const e=t.getImageData(0,0,r.width,r.height),i={width:r.width,height:r.height,data:new Uint8Array(e.data)};n(null,i)},r.onerror=function(t){n(t)},r.src=t}const Z=[],tt=[],et=30;let nt,rt;function it(t,e,n){nt||(nt=new OffscreenCanvas(2,2),rt=nt.getContext("2d",{willReadFrequently:!0}));let r=null;if(p(t))this.options.urlModifier&&(t=this.options.urlModifier(t)),Z.push([t,e,n,this]),st();else{const e=new Blob([t]);r=createImageBitmap(e),r.then(ot.bind(this)).then((t=>{n(null,t)})).catch((t=>{console.warn(t),n(t)}))}}function st(){if(!Z.length||tt.length>et)return;const t=Z.shift(),[e,n,r,i]=t;tt.push(t),fetch(e,n).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then(ot.bind(i)).then((e=>{r.call(i,null,e);const n=tt.indexOf(t);tt.splice(n,1),st()})).catch((e=>{console.warn(e),r.call(i,e);const n=tt.indexOf(t);tt.splice(n,1),st()}))}function ot(t){let{width:e,height:n}=t;at(e)||(e=ct(e)),at(n)||(n=ct(n));const r=this.options.maxTextureSize;r&&(e=Math.min(r,e),n=Math.min(r,n)),nt.width=e,nt.height=n,rt.drawImage(t,0,0,e,n),t.close();const i=rt.getImageData(0,0,e,n);return{width:e,height:n,data:new Uint8Array(i.data)}}function at(t){return!(t&t-1)&&0!==t}function ct(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var ut="undefined"!=typeof Float32Array?Float32Array:Array;function ft(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function lt(t,e,n){var r=e[0],i=e[1],s=e[2],o=e[3],a=e[4],c=e[5],u=e[6],f=e[7],l=e[8],h=e[9],d=e[10],y=e[11],m=e[12],b=e[13],p=e[14],g=e[15],w=n[0],v=n[1],M=n[2],A=n[3];return t[0]=w*r+v*a+M*l+A*m,t[1]=w*i+v*c+M*h+A*b,t[2]=w*s+v*u+M*d+A*p,t[3]=w*o+v*f+M*y+A*g,w=n[4],v=n[5],M=n[6],A=n[7],t[4]=w*r+v*a+M*l+A*m,t[5]=w*i+v*c+M*h+A*b,t[6]=w*s+v*u+M*d+A*p,t[7]=w*o+v*f+M*y+A*g,w=n[8],v=n[9],M=n[10],A=n[11],t[8]=w*r+v*a+M*l+A*m,t[9]=w*i+v*c+M*h+A*b,t[10]=w*s+v*u+M*d+A*p,t[11]=w*o+v*f+M*y+A*g,w=n[12],v=n[13],M=n[14],A=n[15],t[12]=w*r+v*a+M*l+A*m,t[13]=w*i+v*c+M*h+A*b,t[14]=w*s+v*u+M*d+A*p,t[15]=w*o+v*f+M*y+A*g,t}function ht(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function dt(){var t=new ut(3);return ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function yt(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function mt(t,e,n){var r=new ut(3);return r[0]=t,r[1]=e,r[2]=n,r}function bt(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function pt(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function gt(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function wt(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;return s>0&&(s=1/Math.sqrt(s)),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t}function vt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Mt(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[3]*r+n[7]*i+n[11]*s+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*i+n[8]*s+n[12])/o,t[1]=(n[1]*r+n[5]*i+n[9]*s+n[13])/o,t[2]=(n[2]*r+n[6]*i+n[10]*s+n[14])/o,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var At=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},Tt=function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t},_t=yt;function kt(){var t=new ut(4);return ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}dt(),function(){var t,e=(t=new ut(4),ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var Ot;function xt(t){return t&&t.rt&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}dt(),mt(1,0,0),mt(0,1,0),kt(),kt(),Ot=new ut(9),ut!=Float32Array&&(Ot[1]=0,Ot[2]=0,Ot[3]=0,Ot[5]=0,Ot[6]=0,Ot[7]=0),Ot[0]=1,Ot[4]=1,Ot[8]=1;var St={exports:{}},It={exports:{}},Et=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},Ct=Array.prototype.concat,Ut=Array.prototype.slice,Ft=It.exports=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];Et(i)?e=Ct.call(e,Ut.call(i)):e.push(i)}return e};Ft.wrap=function(t){return function(){return t(Ft(arguments))}};var Nt=It.exports,Pt={"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aqua":[0,255,255],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"black":[0,0,0],"blanchedalmond":[255,235,205],"blue":[0,0,255],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"fuchsia":[255,0,255],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"gray":[128,128,128],"green":[0,128,0],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"lime":[0,255,0],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"maroon":[128,0,0],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"navy":[0,0,128],"oldlace":[253,245,230],"olive":[128,128,0],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"purple":[128,0,128],"rebeccapurple":[102,51,153],"red":[255,0,0],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"silver":[192,192,192],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"teal":[0,128,128],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"white":[255,255,255],"whitesmoke":[245,245,245],"yellow":[255,255,0],"yellowgreen":[154,205,50]},Bt=Nt,Dt=Object.hasOwnProperty,Rt=Object.create(null);for(var Lt in Pt)Dt.call(Pt,Lt)&&(Rt[Pt[Lt]]=Lt);var jt=St.exports={to:{},get:{}};function zt(t,e,n){return Math.min(Math.max(e,t),n)}function qt(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}jt.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=jt.get.hsl(t),n="hsl";break;case"hwb":e=jt.get.hwb(t),n="hwb";break;default:e=jt.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},jt.get.rgb=function(t){if(!t)return null;var e,n,r,i=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=e[2],e=e[1],n=0;n<3;n++){var s=2*n;i[n]=parseInt(e.slice(s,s+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(e=e[1])[3],n=0;n<3;n++)i[n]=parseInt(e[n]+e[n],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(e=t.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(n=0;n<3;n++)i[n]=parseInt(e[n+1],0);e[4]&&(e[5]?i[3]=.01*parseFloat(e[4]):i[3]=parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(e=t.match(/^(\\w+)$/))?"transparent"===e[1]?[0,0,0,0]:Dt.call(Pt,e[1])?((i=Pt[e[1]])[3]=1,i):null:null;for(n=0;n<3;n++)i[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(e[5]?i[3]=.01*parseFloat(e[4]):i[3]=parseFloat(e[4]))}for(n=0;n<3;n++)i[n]=zt(i[n],0,255);return i[3]=zt(i[3],0,1),i},jt.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,zt(parseFloat(e[2]),0,100),zt(parseFloat(e[3]),0,100),zt(isNaN(n)?1:n,0,1)]}return null},jt.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,zt(parseFloat(e[2]),0,100),zt(parseFloat(e[3]),0,100),zt(isNaN(n)?1:n,0,1)]}return null},jt.to.hex=function(){var t=Bt(arguments);return"#"+qt(t[0])+qt(t[1])+qt(t[2])+(t[3]<1?qt(Math.round(255*t[3])):"")},jt.to.rgb=function(){var t=Bt(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},jt.to.rgb.percent=function(){var t=Bt(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},jt.to.hsl=function(){var t=Bt(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},jt.to.hwb=function(){var t=Bt(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},jt.to.keyword=function(t){return Rt[t.slice(0,3)]};var Vt=St.exports,Gt={exports:{}},$t={"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aqua":[0,255,255],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"black":[0,0,0],"blanchedalmond":[255,235,205],"blue":[0,0,255],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"fuchsia":[255,0,255],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"gray":[128,128,128],"green":[0,128,0],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"lime":[0,255,0],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"maroon":[128,0,0],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"navy":[0,0,128],"oldlace":[253,245,230],"olive":[128,128,0],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"purple":[128,0,128],"rebeccapurple":[102,51,153],"red":[255,0,0],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"silver":[192,192,192],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"teal":[0,128,128],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"white":[255,255,255],"whitesmoke":[245,245,245],"yellow":[255,255,0],"yellowgreen":[154,205,50]},Xt={};for(var Ht in $t)$t.hasOwnProperty(Ht)&&(Xt[$t[Ht]]=Ht);var Jt=Gt.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var Kt in Jt)if(Jt.hasOwnProperty(Kt)){if(!("channels"in Jt[Kt]))throw new Error("missing channels property: "+Kt);if(!("labels"in Jt[Kt]))throw new Error("missing channel labels property: "+Kt);if(Jt[Kt].labels.length!==Jt[Kt].channels)throw new Error("channel and label counts mismatch: "+Kt);var Yt=Jt[Kt].channels,Qt=Jt[Kt].labels;delete Jt[Kt].channels,delete Jt[Kt].labels,Object.defineProperty(Jt[Kt],"channels",{value:Yt}),Object.defineProperty(Jt[Kt],"labels",{value:Qt})}function Wt(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}Jt.rgb.hsl=function(t){var e,n,r=t[0]/255,i=t[1]/255,s=t[2]/255,o=Math.min(r,i,s),a=Math.max(r,i,s),c=a-o;return a===o?e=0:r===a?e=(i-s)/c:i===a?e=2+(s-r)/c:s===a&&(e=4+(r-i)/c),(e=Math.min(60*e,360))<0&&(e+=360),n=(o+a)/2,[e,100*(a===o?0:n<=.5?c/(a+o):c/(2-a-o)),100*n]},Jt.rgb.hsv=function(t){var e,n,r,i,s,o=t[0]/255,a=t[1]/255,c=t[2]/255,u=Math.max(o,a,c),f=u-Math.min(o,a,c),l=function(t){return(u-t)/6/f+.5};return 0===f?i=s=0:(s=f/u,e=l(o),n=l(a),r=l(c),o===u?i=r-n:a===u?i=1/3+e-r:c===u&&(i=2/3+n-e),i<0?i+=1:i>1&&(i-=1)),[360*i,100*s,100*u]},Jt.rgb.hwb=function(t){var e=t[0],n=t[1],r=t[2];return[Jt.rgb.hsl(t)[0],100*(1/255*Math.min(e,Math.min(n,r))),100*(r=1-1/255*Math.max(e,Math.max(n,r)))]},Jt.rgb.cmyk=function(t){var e,n=t[0]/255,r=t[1]/255,i=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-r,1-i)))/(1-e)||0),100*((1-r-e)/(1-e)||0),100*((1-i-e)/(1-e)||0),100*e]},Jt.rgb.keyword=function(t){var e=Xt[t];if(e)return e;var n,r=1/0;for(var i in $t)if($t.hasOwnProperty(i)){var s=Wt(t,$t[i]);s<r&&(r=s,n=i)}return n},Jt.keyword.rgb=function(t){return $t[t]},Jt.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,r=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*e+.7152*n+.0722*r),100*(.0193*e+.1192*n+.9505*r)]},Jt.rgb.lab=function(t){var e=Jt.rgb.xyz(t),n=e[0],r=e[1],i=e[2];return r/=100,i/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},Jt.hsl.rgb=function(t){var e,n,r,i,s,o=t[0]/360,a=t[1]/100,c=t[2]/100;if(0===a)return[s=255*c,s,s];e=2*c-(n=c<.5?c*(1+a):c+a-c*a),i=[0,0,0];for(var u=0;u<3;u++)(r=o+1/3*-(u-1))<0&&r++,r>1&&r--,s=6*r<1?e+6*(n-e)*r:2*r<1?n:3*r<2?e+(n-e)*(2/3-r)*6:e,i[u]=255*s;return i},Jt.hsl.hsv=function(t){var e=t[0],n=t[1]/100,r=t[2]/100,i=n,s=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,i*=s<=1?s:2-s,[e,100*(0===r?2*i/(s+i):2*n/(r+n)),100*((r+n)/2)]},Jt.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,r=t[2]/100,i=Math.floor(e)%6,s=e-Math.floor(e),o=255*r*(1-n),a=255*r*(1-n*s),c=255*r*(1-n*(1-s));switch(r*=255,i){case 0:return[r,c,o];case 1:return[a,r,o];case 2:return[o,r,c];case 3:return[o,a,r];case 4:return[c,o,r];case 5:return[r,o,a]}},Jt.hsv.hsl=function(t){var e,n,r,i=t[0],s=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return r=(2-s)*o,n=s*a,[i,100*(n=(n/=(e=(2-s)*a)<=1?e:2-e)||0),100*(r/=2)]},Jt.hwb.rgb=function(t){var e,n,r,i,s,o,a,c=t[0]/360,u=t[1]/100,f=t[2]/100,l=u+f;switch(l>1&&(u/=l,f/=l),r=6*c-(e=Math.floor(6*c)),1&e&&(r=1-r),i=u+r*((n=1-f)-u),e){default:case 6:case 0:s=n,o=i,a=u;break;case 1:s=i,o=n,a=u;break;case 2:s=u,o=n,a=i;break;case 3:s=u,o=i,a=n;break;case 4:s=i,o=u,a=n;break;case 5:s=n,o=u,a=i}return[255*s,255*o,255*a]},Jt.cmyk.rgb=function(t){var e=t[0]/100,n=t[1]/100,r=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},Jt.xyz.rgb=function(t){var e,n,r,i=t[0]/100,s=t[1]/100,o=t[2]/100;return n=-.9689*i+1.8758*s+.0415*o,r=.0557*i+-.204*s+1.057*o,e=(e=3.2406*i+-1.5372*s+-.4986*o)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},Jt.xyz.lab=function(t){var e=t[0],n=t[1],r=t[2];return n/=100,r/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},Jt.lab.xyz=function(t){var e,n,r,i=t[0];e=t[1]/500+(n=(i+16)/116),r=n-t[2]/200;var s=Math.pow(n,3),o=Math.pow(e,3),a=Math.pow(r,3);return n=s>.008856?s:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[e*=95.047,n*=100,r*=108.883]},Jt.lab.lch=function(t){var e,n=t[0],r=t[1],i=t[2];return(e=360*Math.atan2(i,r)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(r*r+i*i),e]},Jt.lch.lab=function(t){var e,n=t[0],r=t[1];return e=t[2]/360*2*Math.PI,[n,r*Math.cos(e),r*Math.sin(e)]},Jt.rgb.ansi16=function(t){var e=t[0],n=t[1],r=t[2],i=1 in arguments?arguments[1]:Jt.rgb.hsv(t)[2];if(0===(i=Math.round(i/50)))return 30;var s=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===i&&(s+=60),s},Jt.hsv.ansi16=function(t){return Jt.rgb.ansi16(Jt.hsv.rgb(t),t[2])},Jt.rgb.ansi256=function(t){var e=t[0],n=t[1],r=t[2];return e===n&&n===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},Jt.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},Jt.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},Jt.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},Jt.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},Jt.rgb.hcg=function(t){var e,n=t[0]/255,r=t[1]/255,i=t[2]/255,s=Math.max(Math.max(n,r),i),o=Math.min(Math.min(n,r),i),a=s-o;return e=a<=0?0:s===n?(r-i)/a%6:s===r?2+(i-n)/a:4+(n-r)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?o/(1-a):0)]},Jt.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=1,i=0;return(r=n<.5?2*e*n:2*e*(1-n))<1&&(i=(n-.5*r)/(1-r)),[t[0],100*r,100*i]},Jt.hsv.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=e*n,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},Jt.hcg.rgb=function(t){var e=t[0]/360,n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];var i,s=[0,0,0],o=e%1*6,a=o%1,c=1-a;switch(Math.floor(o)){case 0:s[0]=1,s[1]=a,s[2]=0;break;case 1:s[0]=c,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=a;break;case 3:s[0]=0,s[1]=c,s[2]=1;break;case 4:s[0]=a,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=c}return i=(1-n)*r,[255*(n*s[0]+i),255*(n*s[1]+i),255*(n*s[2]+i)]},Jt.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),r=0;return n>0&&(r=e/n),[t[0],100*r,100*n]},Jt.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,r=0;return n>0&&n<.5?r=e/(2*n):n>=.5&&n<1&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},Jt.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},Jt.hwb.hcg=function(t){var e=t[1]/100,n=1-t[2]/100,r=n-e,i=0;return r<1&&(i=(n-r)/(1-r)),[t[0],100*r,100*i]},Jt.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},Jt.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},Jt.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},Jt.gray.hsl=Jt.gray.hsv=function(t){return[0,0,t[0]]},Jt.gray.hwb=function(t){return[0,100,t[0]]},Jt.gray.cmyk=function(t){return[0,0,0,t[0]]},Jt.gray.lab=function(t){return[t[0],0,0]},Jt.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},Jt.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var Zt=Gt.exports,te=Zt;function ee(t){var e=function(){for(var t={},e=Object.keys(te),n=e.length,r=0;r<n;r++)t[e[r]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var r=n.pop(),i=Object.keys(te[r]),s=i.length,o=0;o<s;o++){var a=i[o],c=e[a];-1===c.distance&&(c.distance=e[r].distance+1,c.parent=r,n.unshift(a))}return e}function ne(t,e){return function(n){return e(t(n))}}function re(t,e){for(var n=[e[t].parent,t],r=te[e[t].parent][t],i=e[t].parent;e[i].parent;)n.unshift(e[i].parent),r=ne(te[e[i].parent][i],r),i=e[i].parent;return r.conversion=n,r}var ie=Zt,se=function(t){for(var e=ee(t),n={},r=Object.keys(e),i=r.length,s=0;s<i;s++){var o=r[s];null!==e[o].parent&&(n[o]=re(o,e))}return n},oe={};Object.keys(ie).forEach((function(t){oe[t]={},Object.defineProperty(oe[t],"channels",{value:ie[t].channels}),Object.defineProperty(oe[t],"labels",{value:ie[t].labels});var e=se(t);Object.keys(e).forEach((function(n){var r=e[n];oe[t][n]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"==typeof n)for(var r=n.length,i=0;i<r;i++)n[i]=Math.round(n[i]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}(r),oe[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(r)}))}));var ae=Vt,ce=oe,ue=[].slice,fe=["keyword","gray","hex"],le={};Object.keys(ce).forEach((function(t){le[ue.call(ce[t].labels).sort().join("")]=t}));var he={};function de(t,e){if(!(this instanceof de))return new de(t,e);if(e&&e in fe&&(e=null),e&&!(e in ce))throw new Error("Unknown model: "+e);var n,r;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof de)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var i=ae.get(t);if(null===i)throw new Error("Unable to parse color from string: "+t);this.model=i.model,r=ce[this.model].channels,this.color=i.value.slice(0,r),this.valpha="number"==typeof i.value[r]?i.value[r]:1}else if(t.length){this.model=e||"rgb",r=ce[this.model].channels;var s=ue.call(t,0,r);this.color=be(s,r),this.valpha="number"==typeof t[r]?t[r]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var o=Object.keys(t);"alpha"in t&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=o.sort().join("");if(!(a in le))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=le[a];var c=ce[this.model].labels,u=[];for(n=0;n<c.length;n++)u.push(t[c[n]]);this.color=be(u)}if(he[this.model])for(r=ce[this.model].channels,n=0;n<r;n++){var f=he[this.model][n];f&&(this.color[n]=f(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function ye(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(he[t]||(he[t]=[]))[e]=n})),t=t[0],function(r){var i;return arguments.length?(n&&(r=n(r)),(i=this[t]()).color[e]=r,i):(i=this[t]().color[e],n&&(i=n(i)),i)}}function me(t){return function(e){return Math.max(0,Math.min(t,e))}}function be(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}function pe(t){return null==t}function ge(t){return"object"==typeof t&&!!t}function we(t){return t/Math.PI*180}de.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in ae.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return ae.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return ae.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=ce[this.model].channels,n=ce[this.model].labels,r=0;r<e;r++)t[n[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new de(this.color.map(function(t){return function(e){return function(t,e){return Number(t.toFixed(e))}(e,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new de(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:ye("rgb",0,me(255)),green:ye("rgb",1,me(255)),blue:ye("rgb",2,me(255)),hue:ye(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:ye("hsl",1,me(100)),lightness:ye("hsl",2,me(100)),saturationv:ye("hsv",1,me(100)),value:ye("hsv",2,me(100)),chroma:ye("hcg",1,me(100)),gray:ye("hcg",2,me(100)),white:ye("hwb",1,me(100)),wblack:ye("hwb",2,me(100)),cyan:ye("cmyk",0,me(100)),magenta:ye("cmyk",1,me(100)),yellow:ye("cmyk",2,me(100)),black:ye("cmyk",3,me(100)),x:ye("xyz",0,me(100)),y:ye("xyz",1,me(100)),z:ye("xyz",2,me(100)),l:ye("lab",0,me(100)),a:ye("lab",1),b:ye("lab",2),keyword:function(t){return arguments.length?new de(t):ce[this.model].keyword(this.color)},hex:function(t){return arguments.length?new de(t):ae.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var r=t[n]/255;e[n]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return de.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n=(n+t)%360)<0?360+n:n,e.color[0]=n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var n=t.rgb(),r=this.rgb(),i=void 0===e?.5:e,s=2*i-1,o=n.alpha()-r.alpha(),a=((s*o==-1?s:(s+o)/(1+s*o))+1)/2,c=1-a;return de.rgb(a*n.red()+c*r.red(),a*n.green()+c*r.green(),a*n.blue()+c*r.blue(),n.alpha()*i+r.alpha()*(1-i))}},Object.keys(ce).forEach((function(t){if(-1===fe.indexOf(t)){var e=ce[t].channels;de.prototype[t]=function(){if(this.model===t)return new de(this);if(arguments.length)return new de(arguments,t);var n,r="number"==typeof arguments[e]?e:this.valpha;return new de((n=ce[this.model][t].raw(this.color),Array.isArray(n)?n:[n]).concat(r),t)},de[t]=function(n){return"number"==typeof n&&(n=be(ue.call(arguments),e)),new de(n,t)}}}));const ve=[1,1,1,1,2,2,3,0];function Me(t){const e=t.length;let n="";for(let r=0;r<e;){let i=t[r++];if(128&i){let n=ve[i>>3&7];if(!(64&i)||!n||r+n>e)return null;for(i&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;i=i<<6|63&e}}n+=String.fromCharCode(i)}return n}new Array(3),new Array(3);const Ae=[1/6378137,1/6378137,1/6356752.314245179],Te=[1/40680631590769,1/40680631590769,1/40408299984661.445],_e=new Array(3),ke=new Array(3),Oe=new Array(3);function xe(t,e){const n=Te,r=function(t,e,n,r,i){const s=e[0],o=e[1],a=e[2],c=n[0],u=n[1],f=n[2],l=s*s*c*c,h=o*o*u*u,d=a*a*f*f,y=l+h+d,m=Math.sqrt(1/y),b=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}(Se,e,m);if(y<i)return isFinite(m)?b:void 0;const p=r[0],g=r[1],w=r[2],v=Ie;v[0]=b[0]*p*2,v[1]=b[1]*g*2,v[2]=b[2]*w*2;let M,A,T,_,k,O,x,S,I,E,C,U=(1-m)*Ce(e)/(.5*Ce(v)),F=0;do{U-=F,T=1/(1+U*p),_=1/(1+U*g),k=1/(1+U*w),O=T*T,x=_*_,S=k*k,I=O*T,E=x*_,C=S*k,M=l*O+h*x+d*S-1,A=l*I*p+h*E*g+d*C*w;F=M/(-2*A)}while(Math.abs(M)>Ee);return t[0]=s*T,t[1]=o*_,t[2]=a*k,t}(_e,e,Ae,n,.1);let i=Tt(ke,r,n);i=function(t,e){const n=e[0],r=e[1],i=e[2];let s=n*n+r*r+i*i;s>0&&(s=Math.sqrt(s),t[0]=e[0]/s,t[1]=e[1]/s,t[2]=e[2]/s);return t}(i,i);const s=At(Oe,e,r),o=Math.atan2(i[1],i[0]),a=Math.asin(i[2]),c=function(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}(vt(s,e))*Ce(s);return t[0]=we(o),t[1]=we(a),t[2]=c,t}const Se=new Array(3),Ie=new Array(3),Ee=1e-12;function Ce(t){return yt(t)}function Ue(t,e){let n="";for(let r=0;r<4;r++){const i=t.getUint8(e+r);n+=String.fromCharCode(i)}return n}const Fe="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function Ne(t,e,n){const r=new Uint8Array(t,e,n);return Fe?JSON.parse(Fe.decode(r)):JSON.parse(Me(r))}function Pe(t,e,n){const r=new Uint8Array(t,e,n);return Fe?JSON.parse(Fe.decode(r)):JSON.parse(Me(r))}function Be(t,e,n){return{offset:e,byteLength:n}}function De(t,e,n,r){const{byteOffset:i,componentType:s,type:o}=t,{ctor:a,type:c}=function(t){return je[t]}(s||"UNSIGNED_SHORT"),u=function(t){if(!t)return 1;return Le[t]}(o);return{byteStride:0,byteOffset:i+n,itemSize:u,count:r*u,componentType:c,array:new a(e,n+i,r*u)}}function Re(t,e,n,r){const i=De(t,e,n,r);return i.array.buffer.byteLength!==e.byteLength&&(i.array=i.array.slice()),i}const Le={"SCALAR":1,"VEC2":2,"VEC3":3,"VEC4":4};const je={"BYTE":{ctor:Int8Array,type:5120,name:"Int8Array"},"UNSIGNED_BYTE":{ctor:Uint8Array,type:5121,name:"Uint8Array"},"SHORT":{ctor:Int16Array,type:5122,name:"Int16Array"},"UNSIGNED_SHORT":{ctor:Uint16Array,type:5123,name:"Uint16Array"},"INT":{ctor:Int32Array,type:5124,name:"Int32Array"},"UNSIGNED_INT":{ctor:Uint32Array,type:5125,name:"Uint32Array"},"FLOAT":{ctor:Float32Array,type:5126,name:"Float32Array"},"DOUBLE":{ctor:Float64Array,type:5126,name:"Float64Array"}};function ze(t){for(const e in je)if(t===je[e].ctor)return je[e].type;throw new Error("unrecognized ctor:"+t)}function qe(t,e,n,r){const i=t,s=e.length/3;for(let t=0;t<s;t++)i[3*t]=e[3*t]/65535*r[0]+n[0],i[3*t+1]=e[3*t+1]/65535*r[1]+n[1],i[3*t+2]=e[3*t+2]/65535*r[2]+n[2];return i}function Ve(t,e,n){const r=t.getUint32(12,!0),i=t.getUint32(16,!0),s=t.getUint32(20,!0),o=t.getUint32(24,!0),a=t.buffer;let c,u={},f={},l=null;r>0&&(u=Ne(a,e,r),e+=r),i>0&&(c=function(t,e,n){return{offset:e,byteLength:n}}(0,e,i),e+=i),s>0&&(f=Pe(a,e,s),e+=s);const h=Be(0,e,o);return l=a.slice(h.offset,h.offset+h.byteLength),n.push(l),{featureTable:u,featureTableBin:c,batchTable:f,batchTableBin:l}}const Ge={5120:Int8Array,5122:Int16Array,5124:Int32Array,5121:Uint8Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function $e(t){for(const e in Ge)if(t===Ge[e])return+e;throw new Error("unrecognized ctor:"+t)}\n/*!\n   * @maptalks/gl v0.102.1\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.com\n   */const Xe=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},He=Xe(),Je=He.gl_trans__coders=He.gl_trans__coders||{};Je.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),i=He.gl_trans__coders=He.gl_trans__coders||{};let s=\`${eZ}r}\\n    const _____getGlobal = ${eZ}Xe.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};\`;for(const t in i)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(s+='tran_____scoders["'+t+'"] ='+i[t].toString()+"\\n;");return s+="\\n"+e.substring(r.length),s},Je.registerTranscoder=function(t,e){Je[t]=e},Je.getTranscoder=function(t){return Je[t]};let Ke=null;function Ye(){return Ke||(Ke={"image/crn":Je.crn&&Je.crn(),"image/ktx2":Je.ktx2&&Je.ktx2(),"image/cttf":Je.ktx2&&Je.ktx2(),"draco":Je.draco&&Je.draco()}),Ke}class Qe{constructor(t,e,n){this.i=t,this.it=e||Q,this.o=n,this.st=Ye()}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,n=0,r=0,i){return e?(r||(r=e.byteLength),this.ot(t,e,n,r,i)):C.getArrayBuffer(t,{}).then((e=>{const i=e.data;return r||(r=i.byteLength),this.ot(t,i,n,r)}))}ot(t,e,n,r,i){const s=i&&i.maxTextureSize,o=this.ct(e,n,r,t);if(o.error)return Promise.resolve(o);const a=t.substring(0,t.lastIndexOf("/"));let c;try{c=new this.it(a,o.glb,{transferable:!0,requestImage:this.i,decoders:this.st,supportedFormats:this.o,maxTextureSize:s})}catch(t){return Promise.resolve({error:t})}return c.load({skipAttributeTransform:!1}).then((e=>{e.url=\`${eZ}t}-${eZ}n}-${eZ}r}\`;const i=c.transferables;for(let t=0;t<o.transferables.length;t++)i.indexOf(o.transferables[t])<0&&i.push(o.transferables[t]);return{magic:"b3dm",count:o.count,transferables:i,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,gltf:e}}))}ct(t,e,n,r){const i=new DataView(t,e,n),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported b3dm version: "+s+", url:"+r;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in b3dm header is inconsistent with b3dm's byte length, url: "+r;return console.warn(t),{error:t}}let o,a=i.getUint32(12,!0),c=i.getUint32(16,!0),u=i.getUint32(20,!0),f=i.getUint32(24,!0),l=28+e;u>=570425344?(l-=8,o=a,u=c,f=0,a=0,c=0):f>=570425344&&(l-=4,o=u,u=a,f=c,a=0,c=0);const h=[t];let d,y,m;if(a>0?(d=Ne(t,l,a),l+=a,o=d.BATCH_LENGTH):d={"BATCH_LENGTH":o},c>0&&(l+=c),u>0&&(y=Pe(t,l,u),l+=u,f>0)){const e=Be(0,l,f);m=t.slice(e.offset,e.offset+e.byteLength),l+=f,h.push(m)}const b=d.BATCH_LENGTH,p={};if(d&&d.BATCH_ID){p.BATCH_ID=Re(d.BATCH_ID,t,undefined.offset,b);const e=p.BATCH_ID.array&&p.BATCH_ID.array.buffer;e&&h.indexOf(e)<0&&h.push(e)}return{count:o,transferables:h,featureTable:d,batchTable:y,batchTableBin:m,b3dm:p,glb:{buffer:t,byteOffset:l,byteLength:i.byteLength+i.byteOffset-l}}}ut(){return null}}class We{constructor(t,e,n,r){this.i=t,this.it=e||Q,this.o=n,this.st=Ye(),this.ft=r}load(t,e,n=0,r=0,i){return e?(r||(r=e.byteLength),this.ot(t,e,n,r,i)):C.getArrayBuffer(t,{}).then((e=>{const i=e.data;return r||(r=i.byteLength),this.ot(t,i,n,r)}))}ot(t,e,n,r,i){return this.lt(t,e,n,r,i).then((({gltf:i,transferables:s})=>{const o=this.ht(e,n,r,t);if(o.error)return Promise.resolve(o);for(let t=0;t<s.length;t++)-1===o.transferables.indexOf(s[t])&&o.transferables.push(s[t]);return delete i.transferables,Promise.resolve({magic:"i3dm",count:o.count,transferables:o.transferables,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,i3dm:o.i3dm,gltf:i})}))}lt(t,e,n,r,i){const s=i&&i.maxTextureSize,o={transferable:!0,requestImage:this.i,decoders:this.st,supportedFormats:this.o,maxTextureSize:s},a=new DataView(e,n,r),c=32+a.getUint32(12,!0)+a.getUint32(16,!0)+a.getUint32(20,!0)+a.getUint32(24,!0);if(0===a.getUint32(28,!0)){let r=Me(new Uint8Array(e,c+n,a.byteLength-c));-1==r.indexOf("://")&&(r=t.substring(0,t.lastIndexOf("/"))+"/"+r);return r.indexOf(".glb")>0?C.getArrayBuffer(r,{}).then((t=>this.dt(r,{buffer:t.data,byteOffset:0},o))):C.getJSON(r,{}).then((t=>this.dt(r,t,o)))}{const r={buffer:e,byteOffset:c+n,byteLength:a.byteLength-c};return this.dt(t,r,o)}}dt(t,e,n){const r=t.substring(0,t.lastIndexOf("/")),i=new this.it(r,e,n);return i.load({skipAttributeTransform:!0}).then((n=>{let r=0,s=0;return e.buffer&&(r=e.byteOffset||0,s=e.byteLength||0),n.url=\`${eZ}t}-${eZ}r}-${eZ}s}\`,{transferables:i.transferables,gltf:n}}))}ht(t,e,n,r){const i=new DataView(t,e,n),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported pnts version: "+s+", url:"+r;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+r;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:u,batchTableBin:f}=Ve(i,32+e,o),l={},h=a.INSTANCES_LENGTH;if(a.POSITION){const{byteOffset:e}=a.POSITION;l.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(l.POSITION.array.buffer)}else if(a.POSITION_QUANTIZED){const e=a.QUANTIZED_VOLUME_OFFSET,n=a.QUANTIZED_VOLUME_SCALE,{byteOffset:r}=a.POSITION_QUANTIZED;l.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.yt(new Uint16Array(t,r+c.offset,3*h),e,n)},o.push(l.POSITION.array.buffer)}if(a.BATCH_ID){l.BATCH_ID=Re(a.BATCH_ID,t,c.offset,h);const e=l.BATCH_ID.array&&l.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}if(a.NORMAL_UP){let{byteOffset:e}=a.NORMAL_UP;l.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(l.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT.byteOffset,l.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(l.NORMAL_RIGHT.array.buffer)}else if(a.NORMAL_UP_OCT32P){let{byteOffset:e}=a.NORMAL_UP_OCT32P;l.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.bt(new Uint16Array(t,e+c.offset,2*h))},o.push(l.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT_OCT32P.byteOffset,l.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:this.bt(new Uint16Array(t,e+c.offset,2*h))},o.push(l.NORMAL_RIGHT.array.buffer)}if(a.SCALE){const{byteOffset:e}=a.SCALE;l.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,h).slice()},o.push(l.SCALE.array.buffer)}else if(a.SCALE_NON_UNIFORM){const{byteOffset:e}=a.SCALE_NON_UNIFORM;l.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:h,componentType:5126,array:new Float32Array(t,e+c.offset,3*h).slice()},o.push(l.SCALE_NON_UNIFORM.array.buffer)}return{count:h,batchTable:u,batchTableBin:f,featureTable:a,i3dm:l,transferables:o}}bt(t){const e=t.length/2,n=new Float32Array(3*e),r=[];for(let i=0;i<e;i++)Ze(r,t[2*i],t[2*i+1],65535),n[3*i]=r[0],n[3*i+1]=r[1],n[3*i+2]=r[2];return n}yt(t,e,n){return qe(new Float32Array(t.length),t,e,n)}ut(){return null}}function Ze(t,e,n,r){if(t[0]=tn(e,r),t[1]=tn(n,r),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*en(e),t[1]=(1-Math.abs(e))*en(t[1])}return wt(t,t)}function tn(t,e){return e=function(t,e){if(null!=t)return t;return e}(e,255),function(t,e,n){return t<e?e:t>n?n:t}(t,0,e)/e*2-1}function en(t){return t<0?-1:1}class nn{constructor(){}load(t,e,n=0,r=0){return e?(r||(r=e.byteLength),this.ot(t,e,n,r)):C.getArrayBuffer(t,{}).then((e=>{const i=e.data;return r||(r=i.byteLength),this.ot(t,i,n,r)}))}ot(t,e,n,r){return this.gt(e,n,r,t).then((t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts}))}gt(t,e,n,r){const i=new DataView(t,e,n),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported pnts version: "+s+", url:"+r;return console.warn(t),{error:t}}if(i.getUint32(8,!0)!==i.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+r;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:u,batchTableBin:f}=Ve(i,e+28,o),l=a.QUANTIZED_VOLUME_OFFSET,h=a.QUANTIZED_VOLUME_SCALE,d=a.POINTS_LENGTH;let y,m={};if(a.extensions&&a.extensions["3DTILES_draco_point_compression"]){m=a.extensions["3DTILES_draco_point_compression"],y=new DataView(t,m.byteOffset+c.offset,m.byteLength);const e={attributes:m.properties,useUniqueIDs:!1};return this.wt||(this.wt=Ye().draco),this.wt(y,e).then((e=>{const n=e.attributes;!a.POSITION&&!a.POSITION_QUANTIZED||n.POSITION||n.POSITION_QUANTIZED||(n.POSITION=a.POSITION,n.POSITION_QUANTIZED=a.POSITION_QUANTIZED),!(a.RGB||a.RGBA||a.RGB565)||n.RGB||n.RGBA||n.RGB565||(n.RGB=a.RGB,n.RGBA=a.RGBA,n.RGB565=a.RGB565),!a.NORMAL&&!a.NORMAL_OCT16P||n.NORMAL||n.NORMAL_OCT16P||(n.NORMAL=a.NORMAL,n.NORMAL_OCT16P=a.NORMAL_OCT16P);const r=this.vt(t,e.attributes,c.offset,d,o,l,h);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;r.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:ze(t.constructor),array:t},o.push(t.buffer)}else if(a.BATCH_ID||Object.keys(u).length){a.BATCH_ID?r.BATCH_ID=Re(a.BATCH_ID,t,c.offset,d):r.BATCH_ID=rn(d);const e=r.BATCH_ID.array&&r.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return{count:d,batchTable:u,batchTableBin:f,featureTable:a,pnts:r,transferables:o}}))}const b=this.vt(t,a,c.offset,d,o,l,h);if(a.BATCH_ID||Object.keys(u).length){a.BATCH_ID?b.BATCH_ID=Re(a.BATCH_ID,t,c.offset,d):b.BATCH_ID=rn(d);const e=b.BATCH_ID.array&&b.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return Promise.resolve({count:d,batchTable:u,batchTableBin:f,featureTable:a,pnts:b,transferables:o})}vt(t,e,n,r,i,s,o){const a={};if(e.POSITION){let{byteOffset:s,array:o}=e.POSITION;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+3*r*4);o=new Float32Array(e)}a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:o},i.push(o.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:c}=e.POSITION_QUANTIZED;const{array:u}=e.POSITION_QUANTIZED;c=c||0;const f=u?0:n;a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:this.yt(u||new Uint16Array(t,c+f,3*r),s,o)},i.push(a.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:s,array:o}=e.RGBA;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+4*r);o=new Uint8Array(e)}a.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:r,componentType:5121,array:o},i.push(o.buffer)}else if(e.RGB){let{byteOffset:s,array:o}=e.RGB;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+3*r);o=new Uint8Array(e)}a.RGB={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5121,array:o},i.push(o.buffer)}else if(e.RGB565){let{byteOffset:s,array:o}=e.RGB565;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+2*r);o=new Uint16Array(e)}a.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:r,componentType:5123,array:o},i.push(o.buffer)}if(e.NORMAL){let{byteOffset:s,array:o}=e.NORMAL;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+3*r*4);o=new Float32Array(e)}a.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:o},i.push(o.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:s,array:o}=e.NORMAL_OCT16P;s=s||0;const c=o?0:n;if(!o){const e=t.slice(s+c,s+c+2*r);o=new Uint8Array(e)}a.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:r,componentType:5121,array:o},i.push(o.buffer)}return a}yt(t,e,n){return qe(new Float32Array(t.length),t,e,n)}ut(){return null}}function rn(t){const e=(n=t)<256?Uint8Array:n<65536?Uint16Array:Uint32Array;var n;const r=new e(t);for(let e=0;e<t;e++)r[e]=e;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:ze(e),array:r}}class sn{constructor(t,e,n,r){this.o=n,this.i=t,this.it=e||Q,this.ft=r}load(t,e,n=0,r=0,i){return e?this.ot(t,e,n,r,i):C.getArrayBuffer(t,{}).then((e=>{const i=e.data;return this.ot(t,i,n,r)}))}ot(t,e,n,r,i){r||(r=e.byteLength);const s=this.Mt(e,t,n,r),o=[];for(let n=0;n<s.length;n++){let r;if("b3dm"===s[n].magic)r=new Qe(this.i,this.it,this.o);else if("i3dm"===s[n].magic)r=new We(this.i,this.it,this.o,this.ft);else if("pnts"===s[n].magic)r=new nn;else{if("cmpt"!==s[n].magic){console.warn("Unsupported magic in CMPT tile:",s[n].magic);continue}r=new sn(this.i,this.it,this.o,this.ft)}o.push(r.load(t,e,s[n].offset,s[n].byteLength,i).then((t=>t)))}return Promise.all(o).then((t=>({magic:"cmpt",tiles:t})))}Mt(t,e,n,r){const i=new DataView(t,n,r),s=i.getUint32(4,!0);if(1!==s){const t="Unsupported cmpt version: "+s+", url:"+e;return console.warn(t),{error:t}}if(16===i.byteLength)return[];const o=[],a=i.getUint32(12,!0);let c=16;for(let e=0;e<a;e++){const e=Ue(i,c),r=i.getUint32(c+8,!0);o.push({magic:e,buffer:t,offset:c+n,byteLength:r}),c+=r}return o}}function on(t,e){if(t.scenes&&t.scenes.length)for(let n=0,r=t.scenes.length;n<r;n++){const r=t.scenes[n].nodes;for(let n=0,i=r.length;n<i;n++){const i=[];dn(r[n],i,t,e)}}}const an=[],cn=[],un=[],fn=[0,0,0],ln=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),hn=[1,1,1];function dn(t,e,n,r){const i=e.slice(0);if(t.matrix)i.push(t.matrix);else if(t.rotation||t.translation||t.scale){const e=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(an,t.translation||fn),n=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=n+n,a=r+r,c=i+i,u=n*o,f=r*o,l=r*a,h=i*o,d=i*a,y=i*c,m=s*o,b=s*a,p=s*c;return t[0]=1-l-y,t[1]=f+p,t[2]=h-b,t[3]=0,t[4]=f-p,t[5]=1-u-y,t[6]=d+m,t[7]=0,t[8]=h+b,t[9]=d-m,t[10]=1-u-l,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(cn,t.rotation||ln),r=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(un,t.scale||hn);lt(r,n,r);const s=lt([],e,r);i.push(s)}if(t.children&&t.children.length)for(let e=0,s=t.children.length;e<s;e++)dn(t.children[e],i,n,r);if(void 0!==t.mesh){const e=t.mesh,s=n.meshes[e];if(s){const t=i.slice(0),o=s.primitives;for(let i=0,s=o.length;i<s;i++){const s=o[i];s&&(s.matrices=t,r(s,e,i,n))}}}}function yn(t,e){let{byteOffset:n,byteStride:r,count:i}=t;const{componentType:s,itemSize:o}=t,a=t.array.buffer,c=s?Q.getTypedArrayCtor(s):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,r=r||0,i=i||t.array.length/o,(!r||r===o*c.BYTES_PER_ELEMENT)&&n%c.BYTES_PER_ELEMENT==0){const t=new c(a,n,i*o);for(let r=0;r<i*o;r+=o){e(new c(t.buffer,n+r*c.BYTES_PER_ELEMENT,o),r/o)}return}const u=new Uint8Array(o*c.BYTES_PER_ELEMENT);r||(r=o*c.BYTES_PER_ELEMENT);for(let t=0;t<i;t++){const i=new Uint8Array(a,r*t+n,o*c.BYTES_PER_ELEMENT);u.set(i);e(new c(u.buffer),t),i.set(u)}}var mn=vn("DXT1"),bn=vn("DXT3"),pn=vn("DXT5"),gn=vn("DX10"),wn=function(t){var e,n,r=new Int32Array(t,0,31);if(542327876!==r[0])throw new Error("Invalid magic number in DDS header");if(4&!r[20])throw new Error("Unsupported format, must contain a FourCC code");var i=r[21];switch(i){case mn:e=8,n="dxt1";break;case bn:e=16,n="dxt3";break;case pn:e=16,n="dxt5";break;case 116:n="rgba32f";break;case gn:var s=new Uint32Array(t.slice(128,148));n=s[0];var o=s[1];if(s[2],s[3],s[4],3!==o||2!==n)throw new Error("Unsupported DX10 texture format "+n);n="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+(a=i,String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)))}var a;var c=r[2],u=1;131072&c&&(u=Math.max(1,r[7]));var f=!1;512&r[28]&&(f=!0);var l,h=r[4],d=r[3],y=r[1]+4,m=h,b=d,p=[];i===gn&&(y+=20);if(f)for(var g=0;g<6;g++){if("rgba32f"!==n)throw new Error("Only RGBA32f cubemaps are supported");h=m,d=b;for(var w=Math.log(h)/Math.log(2)+1,v=0;v<w;v++)l=h*d*16,p.push({offset:y,length:l,shape:[h,d]}),v<u&&(y+=l),h=Math.floor(h/2),d=Math.floor(d/2)}else for(v=0;v<u;v++)l=Math.max(4,h)/4*Math.max(4,d)/4*e,p.push({offset:y,length:l,shape:[h,d]}),y+=l,h=Math.floor(h/2),d=Math.floor(d/2);return{shape:[m,b],images:p,format:n,flags:c,cubemap:f}};function vn(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}var Mn=xt(wn),An=Math.abs,Tn=Math.sin,_n=Math.cos,kn=Math.tan,On=Math.atan,xn=Math.atan2,Sn=Math.sqrt,In=Math.log,En=Math.hypot,Cn=Math.sinh,Un=Math.cosh,Fn=1/0;function Nn(t){var e,n,r,i,s,o,a=[],c=[],u=[],f=[];function l(t,e){for(var n,r=2*_n(2*e),i=t.length-1,s=t[i],o=0;--i>=0;)n=r*s-o+t[i],o=s,s=n;return e+n*Tn(2*e)}function h(t,e,n){for(var r,i,s=Tn(e),o=_n(e),a=Cn(n),c=Un(n),u=2*o*c,f=-2*s*a,l=t.length-1,h=t[l],d=0,y=0,m=0;--l>=0;)r=y,i=d,h=u*(y=h)-r-f*(d=m)+t[l],m=f*y-i+u*d;return[(u=s*c)*h-(f=o*a)*m,u*m+f*h]}t.es,s=i=(r=t.es/(1+Sn(1-t.es)))/(2-r),a[0]=i*(2+i*(-2/3+i*(i*(116/45+i*(26/45+i*(-2854/675)))-2))),c[0]=i*(i*(2/3+i*(4/3+i*(-82/45+i*(32/45+i*(4642/4725)))))-2),s*=i,a[1]=s*(7/3+i*(i*(-227/45+i*(2704/315+i*(2323/945)))-1.6)),c[1]=s*(5/3+i*(-16/15+i*(-13/9+i*(904/315+i*(-1522/945))))),s*=i,a[2]=s*(56/15+i*(-136/35+i*(-1262/105+i*(73814/2835)))),c[2]=s*(-26/15+i*(34/21+i*(1.6+i*(-12686/2835)))),s*=i,a[3]=s*(4279/630+i*(-332/35+i*(-399572/14175))),c[3]=s*(1237/630+i*(i*(-24832/14175)-2.4)),s*=i,a[4]=s*(4174/315+i*(-144838/6237)),c[4]=s*(-734/315+i*(109598/31185)),s*=i,a[5]=s*(601676/22275),c[5]=s*(444337/155925),s=i*i,e=t.k0/(1+i)*(1+s*(1/4+s*(1/64+s/256))),u[0]=i*(i*(2/3+i*(-37/96+i*(1/360+i*(81/512+i*(-96199/604800)))))-.5),f[0]=i*(.5+i*(-2/3+i*(5/16+i*(41/180+i*(-127/288+i*(7891/37800)))))),u[1]=s*(-1/48+i*(-1/15+i*(437/1440+i*(-46/105+i*(1118711/3870720))))),f[1]=s*(13/48+i*(i*(557/1440+i*(281/630+i*(-1983433/1935360)))-.6)),s*=i,u[2]=s*(-17/480+i*(37/840+i*(209/4480+i*(-5569/90720)))),f[2]=s*(61/240+i*(-103/140+i*(15061/26880+i*(167603/181440)))),s*=i,u[3]=s*(-4397/161280+i*(11/504+i*(830251/7257600))),f[3]=s*(49561/161280+i*(-179/168+i*(6601661/7257600))),s*=i,u[4]=s*(-4583/161280+i*(108847/3991680)),f[4]=s*(34729/80640+i*(-3418889/1995840)),s*=i,u[5]=s*(-20648693/638668800),f[5]=.6650675310896665*s,o=l(c,t.phi0),n=-e*(o+function(t,e){var n,r=2*_n(e),i=t.length-1,s=t[i],o=0;for(;--i>=0;)n=r*s-o+t[i],o=s,s=n;return Tn(e)*n}(f,2*o)),t.fwd=function(t,r){var i,s,o,a,u,d=t.phi,y=t.lam;d=l(c,d),i=Tn(d),s=_n(d),a=Tn(y),o=_n(y),d=xn(i,o*s),y=xn(a*s,En(i,s*o)),y=function(t){var e=An(t);return e=function(t){var e=1+t,n=e-1;return 0===n?t:t*In(e)/n}(e*(1+e/(En(1,e)+1))),t<0?-e:e}(kn(y)),u=h(f,2*d,2*y),d+=u[0],y+=u[1],An(y)<=2.623395162778?(r.y=e*d+n,r.x=e*y):r.x=r.y=Fn},t.inv=function(t,r){var i,s,o,c,f,d=t.y,y=t.x;d=(d-n)/e,An(y/=e)<=2.623395162778?(d+=(f=h(u,2*d,2*y))[0],y+=f[1],y=On(Cn(y)),i=Tn(d),s=_n(d),c=Tn(y),o=_n(y),y=xn(c,o*s),d=xn(i*o,En(c,o*s)),r.phi=l(a,d),r.lam=y):r.phi=r.lam=Fn}}const Pn=Math.PI/180,Bn=6378137*Math.PI/180,Dn=85.0511287798,Rn={};function Ln(t,e,n,r){if("EPSG:3857"===n)return function(t,e){const n=Dn,r=e[0],i=Math.max(Math.min(n,e[1]),-n);let s;s=0===i?0:Math.log(Math.tan((90+i)*Pn/2))/Pn;return t[0]=r*Bn,t[1]=s*Bn,t}(t,e);if(!n||"EPSG:9807"!==n.code&&"Traverse_Mercator"!==n.code){if("EPSG:4326"===n||"EPSG:4490"===n||"identity"===n)return jn(t,e);if("baidu"===n)return jn(t,e);throw new Error("unsupported projection:"+n)}{if(!(!r||4326===r.wkid))return function(t,e){return t[0]=e[0],t[1]=e[1],t}(t,e);const i=JSON.stringify(n);let s=Rn[i];return s||(s=Rn[i]=function(t){const e={a:qn,es:Vn,x0:pe(t.falseEasting)?5e5:t.falseEasting,y0:pe(t.falseNorthing)?0:t.falseNorthing,k0:t.scaleFactor||.9996,lam0:(t.centralMeridian||0)*zn,phi0:(t.latitudeOfOrigin||0)*zn,originLam0:t.startLongtitude||0,originPhi0:t.startLatitude||0};Nn(e);const n={lam:0,phi:0},r={};let i=0,s=0;(e.originLam0||e.originPhi0)&&(n.lam=e.originLam0*zn-e.lam0,n.phi=e.originPhi0*zn,e.fwd(n,r),i=e.a*r.x+e.x0,s=e.a*r.y+e.y0);return{project:function(t,o){n.lam=t[0]*zn-e.lam0,n.phi=t[1]*zn,e.fwd(n,r);const a=e.a*r.x+e.x0-i,c=e.a*r.y+e.y0-s;return o[0]=a,o[1]=c,o}}}(n)),s.project(e,t)}}function jn(t,e){return t[0]=e[0],t[1]=e[1],t}const zn=.017453292519943295,qn=6378137,Vn=.0066943799901413165;const Gn=ft([]),$n=Ye().draco,Xn=Ye().ktx2,Hn={"pbrMetallicRoughness":{"baseColorFactor":[.5,.5,.5,1],"metallicFactor":0,"roughnessFactor":.5}},Jn={"position":{name:"POSITION",accessor:{"componentType":5126,"type":"VEC3"}},"normal":{name:"NORMAL",accessor:{"componentType":5126,"type":"VEC3"}},"uv0":{name:"TEXCOORD_0",accessor:{"componentType":5126,"type":"VEC2"}},"color":{name:"COLOR_0",accessor:{"componentType":5121,"type":"VEC4"}},"uv-region":{name:"uvRegion",accessor:{"componentType":5123,"type":"VEC4"}},"feature-index":{name:"_BATCHID",accessor:{"componentType":5125,"type":"SCALAR"}},"faceRange":{name:"faceRange",accessor:{"componentType":5125,"type":"VEC2"}}};function Kn(t,e,n,r,i,s){const o=[],a=[],c=[];for(let e=0;e<t.meshes.length;e++){const{geometry:n,material:r}=t.meshes[e],i=C.getArrayBuffer(n.url,s);i.xhr.url=n.url,c.push(i.xhr);const u=i.then((t=>({buffer:t})));o.push(u);const f=[];if(rr(r,f),f.length){const t=f.map((t=>{const e=C.getArrayBuffer(t.url,s);return e.xhr.url=t.url,c.push(e.xhr),e.then((e=>e&&e.status?null:{buffer:e,mimeType:t.mimeType,format:t.format}))}));o.push(...t)}a[e]=f.length}const u=Promise.all(o).then((s=>{for(let t=0;t<s.length;t++)if(!s[t]||!s[t].buffer)return Promise.resolve(null);const o=[];let c=0;for(let t=0;t<a.length;t++){const e=a[t];o.push({geoBuffer:{data:s[c].buffer.data},textureBuffers:s.slice(c+1,e+c+1).map((t=>({data:t.buffer.data,mimeType:t.mimeType,format:t.format})))}),c+=1+e}const u=function(t,e,n,r,i,s){const o={asset:{generator:"i3s",version:"2.0"},extensions:{},scene:0,scenes:[{nodes:[]}],nodes:{},meshes:{},materials:[],skins:[],animations:null,textures:[],transferables:[]},a=[];for(let c=0;c<t.meshes.length;c++){let{material:u}=t.meshes[c];const{geometry:f}=t.meshes[c];let l;const h=e[c].geoBuffer.data;if(!h)continue;l=ur(h)?Qn(o,c,f,h,t.transform,t.center,i,s):Zn(o,c,f,h,t.transform,t.center,i,s),a.push(l),o.nodes[c]={mesh:c,nodeIndex:c,matrix:ft([])},o.scenes[0].nodes[c]=o.nodes[c],u||(u=Hn);const d=er(c,o,u,e[c].textureBuffers,n,r);a.push(d)}return Promise.all(a).then((()=>({gltf:o,featureTable:{BATCH_LENGTH:0},transferables:o.transferables})))}(t,o,e,i,n,r);return u}));return u.xhr=c,u}const Yn={"magFilter":9728,"minFilter":9728,"wrapR":33071,"wrapS":33071,"wrapT":33071};function Qn(t,e,n,r,i,s,o,a){const c=n.info.compressedAttributes.attributes.reduce(((t,e,n)=>{const r=Jn[e];if(!r)return t;return t[r.name||e]=n,t}),{});return $n(r,{attributes:c,metadatas:{"POSITION":[{name:"i3s-scale_x",type:"double"},{name:"i3s-scale_y",type:"double"}]},useUniqueIDs:!1,skipAttributeTransform:!1}).then((n=>tr(n,t,e,i,s,o,a)))}const Wn={position:function(t,e,n){const r=3*t.vertexCount,i=new Float32Array(e,n,r);return t.position={array:i,componentType:5126,itemSize:3,count:r/3,meta:{"i3s-scale_x":1,"i3s-scale_y":1},type:"VEC3"},n+=4*r},normal:function(t,e,n){const r=3*t.vertexCount,i=new Float32Array(e,n,r);return t.normal={array:i,componentType:5126,itemSize:3,count:r/3,type:"VEC3"},n+=4*r},uv0:function(t,e,n){const r=2*t.vertexCount,i=new Float32Array(e,n,r);return t.uv0={array:i,componentType:5126,itemSize:2,count:r/2,type:"VEC2"},n+=4*r},color:function(t,e,n){const r=4*t.vertexCount,i=new Uint8Array(e,n,r);return t.color={array:i,componentType:5121,itemSize:4,count:r/4,type:"VEC4"},n+=r},featureId:function(t,e,n){return n+=8*t.featureCount},id:function(t,e,n){return n+=8*t.featureCount},faceRange:function(t,e,n){const r=2*t.featureCount,i=new Uint32Array(e,n,r);return t.faceRange={array:i,componentType:5125,itemSize:2,count:r/2,type:"VEC2"},n+=4*r},uvRegion:function(t,e,n){const r=4*t.vertexCount,i=new Uint16Array(e,n,r);return t["uv-region"]={array:i,componentType:5123,itemSize:4,count:r/4,type:"VEC4"},n+=2*r},region:function(t,e,n){const r=4*t.vertexCount,i=new Uint16Array(e,n,r);return t["uv-region"]={array:i,componentType:5123,itemSize:4,count:r/4,type:"VEC4"},n+=2*r}};function Zn(t,e,n,r,i,s,o,a){const c={vertexCount:0},u=new DataView(r);try{let t=0;c.vertexCount=u.getUint32(t,1),t+=4,c.featureCount=u.getUint32(t,1),t+=4;const e=n.info.ordering?null:n.info;if(e){const n=[];for(const t in e)"offset"!==t&&""!==t&&n.push(t);for(let e=0;e<n.length;e++)Wn[n[e]]?t=Wn[n[e]](c,r,t):console.error("Unknown decoder for",n[e])}else{const e=n.info;let i=e.ordering,s=e.featureAttributeOrder;const o=null;o&&o.geometryData&&o.geometryData[0]&&o.geometryData[0].params;for(let e=0;e<i.length;e++){const n=Wn[i[e]];n||console.log(i[e]),t=n(c,r,t)}for(let e=0;e<s.length;e++){const n=Wn[s[e]];n||console.log(s[e]),t=n(c,r,t)}}}catch(t){}c.scale_x=1,c.scale_y=1;const f={};for(const t in c){const e=Jn[t]&&Jn[t].name;e&&(f[e]=c[t])}if(c.faceRange){const t=c.faceRange.array,e=t.length/2,n=(l=e)<=255?Uint8Array:l<=65535?Uint16Array:Uint32Array,r=new n(f.POSITION.array.length/3);for(let e=0;e<t.length-1;e+=2){const n=e/2,i=t[e],s=t[e+1];for(let t=i;t<=s;t++)r[3*t]=n,r[3*t+1]=n,r[3*t+2]=n}f._BATCHID={componentType:$e(n),array:r,itemSize:1,count:r.length,type:"SCALAR"}}var l;return tr({attributes:f},t,e,i,s,o,a)}function tr(t,e,n,r,i,s,o){const a={attributes:t.attributes,material:n,indices:t.indices,mode:4};!function(t){const e=t.array,n=t.meta&&t.meta["i3s-scale_x"],r=t.meta&&t.meta["i3s-scale_y"];if(n&&r&&(1!==n||1!==r))for(let t=0;t<e.length;t+=3)e[t]*=n.value,e[t+1]*=r.value}(t.attributes.POSITION);const c=function(t,e,n,r,i){let s,o=[0,0,0,1];const a=[0,0],c=Ln([],n,r,i);c[2]=n[2];const u=e&&ht(Gn,e);return yn(t,(t=>(o[0]=t[0],o[1]=t[1],o[2]=t[2],u||(o=Mt(o,o,e)),n&&gt(o,o,n),Ln(a,o,r,i),s=o[2],t[0]=a[0]-c[0],t[1]=a[1]-c[1],t[2]=s-c[2],t))),c}(t.attributes.POSITION,r,i,s,o);e.meshes[n]={primitives:[a],index:n},e.extensions.MAPTALKS_RTC={projCenter:c},e.extensions.CESIUM_RTC={rtcCoord:i};for(const n in t.attributes)cr(e.transferables,t.attributes[n].array.buffer);return t.indices&&cr(e.transferables,t.indices.array.buffer),a}function er(t,e,n,r,i,s){const o=r.map((t=>function(t,e,n,r,i){if("dds"===e){const e=Mn(t),r=e.images.map((e=>new Uint8Array(t,e.offset,e.length))),i="dxt1"===e.format?33777:33779;return Promise.resolve({image:{mipmap:r,width:e.shape[0],height:e.shape[1],mimeType:n},sampler:Yn,format:i})}if("png"===e||"jpg"===e)return function(t,e){ir||(ir=new OffscreenCanvas(2,2),sr=ir.getContext("2d",{willReadFrequently:!0}));const n=new Blob([new Uint8Array(t)]);return createImageBitmap(n).then((t=>{let{width:n,height:r}=t;or(n)||(n=ar(n)),or(r)||(r=ar(r));const i=e;i&&(n=Math.min(i,n),r=Math.min(i,r)),ir.width=n,ir.height=r,sr.drawImage(t,0,0,n,r),t.close();const s=sr.getImageData(0,0,n,r);return{width:n,height:r,array:new Uint8Array(s.data)}})).catch((()=>({width:2,height:2,array:new Uint8Array(4)})))}(t,i).then((t=>{t.mimeType=n;return{image:t,sampler:Yn,format:6408}}));if("ktx2"===e)return Xn(t,r).then((t=>(t.mimeType=n,{image:t,sampler:Yn,format:t.format})));return null}(t.data,t.format,t.mimeType,i,s).then((t=>{if(t.image)if(t.image.array)cr(e.transferables,t.image.array.buffer);else if(t.image.mipmap)for(let n=0;n<t.image.mipmap.length;n++)cr(e.transferables,t.image.mipmap[n].buffer);return t}))));return Promise.all(o).then((r=>{nr(t,e,n,r)}))}function nr(t,e,n,r){const i=JSON.parse(JSON.stringify(n)),s=e.textures;r.ptr||(r.ptr=0);for(const t in n)n[t]&&n[t].url?(s.push(r[r.ptr++]),i[t]={index:s.length-1},void 0!==n[t].factor&&(i[t].scale=n[t].factor)):ge(n[t])&&(i[t]=nr(-1,e,n[t],r));return t>=0&&(e.materials[t]=i),i}function rr(t,e){for(const n in t)t[n]&&t[n].url?e.push({url:t[n].url,mimeType:t[n].mimeType,format:t[n].format}):ge(t[n])&&rr(t[n],e)}let ir,sr;function or(t){return!(t&t-1)&&0!==t}function ar(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function cr(t,e){e&&(t.indexOf(e)>=0||t.push(e))}function ur(t){const e=new Uint8Array(t,0,5);return e[0]==="D".charCodeAt()&&e[1]==="R".charCodeAt()&&e[2]==="A".charCodeAt()&&e[3]==="C".charCodeAt()&&e[4]==="O".charCodeAt()}var fr="undefined"!=typeof Float32Array?Float32Array:Array;function lr(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}var hr=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t};!function(){var t=function(){var t=new fr(3);return fr!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}()}();const dr=[];const yr=[],mr=[],br=[],pr=[],gr=[],wr=[],vr=[];function Mr(t,e,n,r,i,s){lr(pr,t[3*e],t[3*e+1],t[3*e+2]),lr(gr,t[3*n],t[3*n+1],t[3*n+2]),lr(wr,t[3*r],t[3*r+1],t[3*r+2]);const o=hr(yr,wr,gr),a=hr(mr,pr,gr),c=function(t,e,n){var r=e[0],i=e[1],s=e[2],o=n[0],a=n[1],c=n[2];return t[0]=i*c-s*a,t[1]=s*o-r*c,t[2]=r*a-i*o,t}(br,o,a);!function(t,e){var n=e[0],r=e[1],i=e[2],s=n*n+r*r+i*i;s>0&&(s=1/Math.sqrt(s),t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s)}(vr,c),i[3*e]=i[3*e]||0,i[3*n]=i[3*n]||0,i[3*r]=i[3*r]||0,i[3*e+1]=i[3*e+1]||0,i[3*n+1]=i[3*n+1]||0,i[3*r+1]=i[3*r+1]||0,i[3*e+2]=i[3*e+2]||0,i[3*n+2]=i[3*n+2]||0,i[3*r+2]=i[3*r+2]||0,i[3*e]+=vr[0],i[3*n]+=vr[0],i[3*r]+=vr[0],i[3*e+1]+=vr[1],i[3*n+1]+=vr[1],i[3*r+1]+=vr[1],i[3*e+2]+=vr[2],i[3*n+2]+=vr[2],i[3*r+2]+=vr[2],s[e]+=1,s[n]+=1,s[r]+=1}const Ar=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],Tr=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],_r=2*Math.PI*6378137/360,kr="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let Or,xr,Sr=!1;if("undefined"!=typeof OffscreenCanvas){try{xr=new OffscreenCanvas(2,2).getContext("2d",{willReadFrequently:!0})}catch(t){}xr&&"undefined"!=typeof createImageBitmap&&(Sr=!0)}const Ir=ft([]),Er=[0,0,0],Cr=[],Ur=[],Fr=[],Nr=[],Pr={"POSITION":1,"TEXCOORD_0":1,"TEXCOORD_1":1,"NORMAL":1,"TANGENT":1},Br={"TEXCOORD_0":1e-4,"TEXCOORD_1":1e-4};let Dr;class Rr{constructor(t,e,n,r){this.id=t,this.options=e,this.At=(...t)=>this.requestImage.call(this,...t),this.Tt=n,this._t={},r(null,{},[])}kt(t){this.Ot||(this.o=t,this.xt=new nn,this.Ot=new Qe(this.At,Q,t),this.St=new We(this.At,Q,t))}requestImage(t,e){Sr?fetch(t).then((t=>t.arrayBuffer())).then((t=>{const e=new self.Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then((t=>{Or.width=t.width,Or.height=t.height,xr.drawImage(t,0,0);const n=xr.getImageData(0,0,Or.width,Or.height);t.close(),e(null,{width:t.width,height:t.height,data:new Uint8Array(n.data)})})):this.Tt("requestImage",{url:t},null,e)}loadTile(t,e){this.kt(t.supportedFormats);const{service:n,url:r,arraybuffer:i}=t,s=n.fetchOptions||{};if(s.referrer=t.referrer,s.referrerPolicy=s.referrerPolicy||"origin",function(t){return t.indexOf("i3s:")>=0}(r)){const i=t.i3sInfo,o=n.maxTextureSize||0,a=Kn(i,t.supportedFormats,this.options.projection,t.projection,o,s);return a.then((t=>{if(delete this._t[r],!t)return void e({status:404,url:r,i3sInfo:i});if(!Object.keys(t.gltf.meshes).length)return void e({status:404,url:r,i3sInfo:i});t.gltf.url=r;const{transferables:s}=t;t.magic="b3dm",n.createNormalIfMissed&&this.It(t.gltf),Hr(n)&&this.Et(t.gltf),e(null,t,s)})),void(this._t[r]=a.xhr)}if(i){delete this._t[r];const n=Ue(new DataView(i),0);if("{"===n[0]||" "===n[0]||"<"===n[0]){const n=function(t,e,n){if(kr){const r=new Uint8Array(t,e,n);return kr.decode(r)}return Me(new Uint8Array(t,e,n))}(i,0,i.byteLength),s=JSON.parse(n);s.accessors?this.Ct(s,r,t,"gltf",e):this.Ut(t.rootIdx,s,i,r,e)}else this.Ct(i,r,t,n,e)}else{let i=n.urlParams;i&&(i=(r.indexOf("?")>0?"&":"?")+i);const o=r.replace(/\\+/g,"%2B");let a=C.getArrayBuffer(o+(i||""),s);const c=a.xhr;a=a.then((n=>{delete this._t[r],n&&n.status?e(n):(t.arraybuffer=n&&n.data,this.loadTile(t,e))})).catch((t=>{delete this._t[r],e(t)})),this._t[r]=c}}Ct(t,e,n,r,i){r=r&&r.toLowerCase();const{service:s}=n;if("b3dm"===r){this.Ot.load(e,t,0,0,{maxTextureSize:s.maxTextureSize||0}).then((t=>{if(t.error)return void i(t);const{content:e,transferables:r}=this.Ft(t,n);s.createNormalIfMissed&&this.It(e.gltf),Hr(s)&&this.Et(e.gltf),i(null,e,r)})).catch((t=>{i(t)}))}else if("pnts"===r){const r=n.transform||Ir;this.xt.load(e,t).then((t=>{const{content:e,transferables:s}=this.Nt(t,r,n.rootIdx);this.Pt(e),i(null,e,s)}))}else if("i3dm"===r){const r=n.transform||Ir;this.St.load(e,t,0,0,{maxTextureSize:s.maxTextureSize||0}).then((t=>{const{content:e,transferables:o}=this.Bt(t,r,n.rootIdx);s.createNormalIfMissed&&this.It(e.gltf),Hr(s)&&this.Et(e.gltf),i(null,e,o)}))}else if("cmpt"===r){new sn(this.At,Q,this.o,s.maxTextureSize||0).load(e,t,0,0,{maxTextureSize:s.maxTextureSize||0}).then((t=>{const{content:e,transferables:r}=this.Dt(t,n);this.Rt(e,s),Hr(s)&&this.Lt(e),i(null,e,r)})).catch((t=>{i(t)}))}else if("gltf"===r){this.st||(this.st=Ye());const r=e.substring(0,e.lastIndexOf("/")),o=t instanceof ArrayBuffer&&{buffer:t,byteOffset:0,byteLength:t.byteLength}||t;let a;try{a=new Q(r,o,{transferable:!0,requestImage:this.At,decoders:this.st,supportedFormats:this.o,maxTextureSize:s.maxTextureSize||0})}catch(t){i(t)}a.load({skipAttributeTransform:!1}).then((t=>{t.url=e,this.jt(t,null,n),s.createNormalIfMissed&&this.It(t),Hr(s)&&this.Et(t),i(null,{magic:"gltf",gltf:t},a.transferables)}))}else i(new Error("unsupported tile format: "+r))}Rt(t,e){t.content?t.content.forEach((t=>{this.Rt(t,e)})):e.createNormalIfMissed&&this.It(t.gltf)}Lt(t){t.content?t.content.forEach((t=>{this.Lt(t)})):this.Et(t.gltf)}zt(t,e){if(this.qt(t,e)&&!t.attributes.NORMAL){const e=t.attributes.POSITION.array,n=e.length,r=this.Vt()?Dr.subarray(0,n):e,i=function(t,e,n){const r=n||[];r.setLength&&r.setLength(t.length);const i=dr;i.length<t.length/3&&(i.length=t.length/3),i.fill(0,0,t.length/3);const s=void 0===e.length?e:e.length;for(let n=0;n<s/3;n++)void 0===e.length?Mr(t,3*n,3*n+1,3*n+2,r,i):Mr(t,e[3*n],e[3*n+1],e[3*n+2],r,i);const o=r.getLength?r.getLength():r.length;for(let t=0;t<o;t+=3){const e=i[t/3];0!==e?(r[t]/=e,r[t+1]/=e,r[t+2]/=e):(r[t]=0,r[t+1]=0,r[t+2]=0)}return r}(r,t.indices.array,new Float32Array(r.length));t.attributes.NORMAL={array:i,byteLength:i.byteLength,byteOffset:0,byteStride:0,componentType:5126,count:i.length/3,itemSize:3,name:"NORMAL",type:"VEC3"}}}Et(t){if(!t||!t.meshes||t.extensionsUsed&&t.extensionsUsed.indexOf("KHR_techniques_webgl")>-1)return;if(t.asset&&t.asset.sharePosition)return;const e=t.meshes;for(const t in e){e[t].primitives.forEach((t=>{t.compressed_int16_params={};const e=t.attributes;for(const n in e)if(Pr[n]&&e[n].array&&e[n].array instanceof Float32Array){let r=1;this.Vt()&&"POSITION"===n&&(r=_r,t.compressed_int16_params.compressed_ratio=r);const i=Gr(e[n].array,r,e[n].min,e[n].max,n);if(!i)continue;const{array:s,range:o}=i;e[n].componentType=5124,e[n].array=s,t.compressed_int16_params[n]=o}}))}}It(t){if(!t||!t.meshes||t.extensionsUsed&&t.extensionsUsed.indexOf("KHR_techniques_webgl")>-1)return;if(t.asset&&t.asset.sharePosition)return;const e=t.meshes;for(const n in e){e[n].primitives.forEach((e=>{this.zt(e,t)}))}}Pt(t){if(!t||!t.pnts)return;const e=t.pnts;t.compressed_int16_params={};for(const n in e)if(Pr[n]&&e[n].array&&e[n].array instanceof Float32Array){let r=1;this.Vt()&&"POSITION"===n&&(r=_r,t.compressed_int16_params.compressed_ratio=r);const{array:i,range:s}=Gr(e[n].array,r,e[n].min,e[n].max,n);e[n].array=i,t.compressed_int16_params[n]=s}}Gt(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n];if(!r.childTile)continue;const i={boundingVolume:{sphere:[r.boundingSphere.center.x,r.boundingSphere.center.y,r.boundingSphere.center.z,r.boundingSphere.radius]},content:{uri:r.childTile},geometricError:r.boundingSphere.radius/r.rangeList*16,refine:"REPLACE"};e.push(i)}return e}Ut(t,e,n,r,i){return e.capabilities,void i(null,e)}Dt(t,e){const{tiles:n}=t,r={magic:"cmpt",content:[]},i=[];for(let t=0;t<n.length;t++){const{magic:s}=n[t];if("b3dm"===s){const{content:s,transferables:o}=this.Ft(n[t],e);qr(i,o),r.content.push(s)}else if("i3dm"===s){const{transform:s,rootIdx:o}=e,{content:a,transferables:c}=this.Bt(n[t],s,o);qr(i,c),r.content.push(a)}else if("pnts"===s){const{transform:s,rootIdx:o}=e,{content:a,transferables:c}=this.Nt(n[t],s,o);qr(i,c),r.content.push(a)}else if("cmpt"===s){const{content:s,transferables:o}=this.Dt(n[t],e);qr(i,o),r.content.push(s)}}return{content:r,transferables:i}}Ft(t,e){const{gltf:n,transferables:r,featureTable:i}=t;return this.jt(n,i,e),delete t.transferables,{content:t,transferables:r}}jt(t,e,n){const r=function(t){if(!t||!t.meshes)return!1;const e="visited";let n=1;const r=[];for(const i in t.meshes){const s=t.meshes[i],{primitives:o}=s;if(o)for(let t=0;t<o.length;t++){const i=o[t].attributes&&o[t].attributes.POSITION;if(!i||!i.array)continue;i.array.buffer[e]||(i.array.buffer[e]=n++);const s=n-1+"-"+(i.byteOffset||0);if(r.indexOf(s)>=0)return!0;r.push(s)}}return!1}(t);this.$t(t);n.service.createNormalIfMissed||this.Xt(t),t.asset||(t.asset={}),r?(t.asset.sharePosition=!0,this.Ht(t,e,n.upAxis,n.transform)):this.Jt(t,e,n.upAxis,n.transform)}Bt(t,e,n){const{featureTable:r}=t,i=t.i3dm,s=r&&r.RTC_CENTER||[0,0,0],o=this.options.projection,a=e&&ht(Ir,e),c={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};jr(i.POSITION.array,3,s,Ir,c);const u=zr(c);e&&!a&&Mt(u,u,e);const f=this.Kt(u),l=[];Ln(l,f,o),l[2]=f[2];const h=bt([],u),d=[0,0,0],y=[0,0,0],m=[0,0],b=[1/0,1/0,1/0],p=[-1/0,-1/0,-1/0];yn(i.POSITION,(t=>{d[0]=t[0]+s[0],d[1]=t[1]+s[1],d[2]=t[2]+s[2],e&&!a&&Mt(d,d,e),0===_t(d)?pt(y,0,0,-6378137):xe(y,d),Ln(m,y,o),t[0]=m[0]-l[0],t[1]=m[1]-l[1],t[2]=y[2]-l[2],t[0]<b[0]&&(b[0]=t[0]),t[1]<b[1]&&(b[1]=t[1]),t[2]<b[2]&&(b[2]=t[2]),t[0]>p[0]&&(p[0]=t[0]),t[1]>p[1]&&(p[1]=t[1]),t[2]>p[2]&&(p[2]=t[2])})),i.POSITION.min=b,i.POSITION.max=p,e&&Mt(u,u,e),t.rtcCenter=h,t.rtcCoord=f,t.projCenter=l,t.rootIdx=n;const g=t.transferables;return delete t.transferables,{content:t,transferables:g}}Nt(t,e,n){const{featureTable:r}=t,i=t.pnts,s=r&&r.RTC_CENTER||[0,0,0],o=this.options.projection,a=e&&ht(Ir,e),c={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};jr(i.POSITION.array,3,s,e,c);const u=zr(c),f=this.Yt(u),l=bt([],u),h=[1/0,1/0,1/0],d=[-1/0,-1/0,-1/0];let y=[0,0,0,1];const m=[0,0,0],b=[0,0];yn(i.POSITION,(t=>(y[0]=t[0]+s[0],y[1]=t[1]+s[1],y[2]=t[2]+s[2],e&&!a&&(y=Mt(y,y,e)),0===_t(y)?pt(m,0,0,-6378137):xe(m,y),Ln(b,m,o),t[0]=b[0]-f[0],t[1]=b[1]-f[1],t[2]=m[2]-f[2],t[0]<h[0]&&(h[0]=t[0]),t[1]<h[1]&&(h[1]=t[1]),t[2]<h[2]&&(h[2]=t[2]),t[0]>d[0]&&(d[0]=t[0]),t[1]>d[1]&&(d[1]=t[1]),t[2]>d[2]&&(d[2]=t[2]),t))),i.POSITION.min=h,i.POSITION.max=d,e&&Mt(u,u,e);const p=this.Kt(u);t.rtcCenter=l,t.projCenter=f,t.rtcCoord=p,t.rootIdx=n;const g=t.transferables;return delete t.transferables,{content:t,transferables:g}}$t(t){if(!Array.isArray(t.textures))return;const e=t.textures;for(let t=0;t<e.length;t++){const n=e[t]&&e[t].image&&e[t].image.array;if(n&&n.length){const r=n[0],i=n[1],s=n[2],o=n[3];let a=!0;for(let t=4;t<n.length;t+=4)if(n[t]!==r||n[t+1]!==i||n[t+2]!==s||n[t+3]!==o){a=!1;break}a&&(e[t].image.color=[r/255,i/255,s/255,o/255],delete e[t].image.array)}}}Xt(t){const e=t.meshes;for(const n in e){const r=e[n];if(!r)continue;const i=r.primitives;if(i)for(let e=0;e<i.length;e++){if(!i[e])continue;if(!i[e].attributes||i[e].attributes.NORMAL)continue;const n=i[e].material;if(!pe(n)){const e=t.materials[n];if(!e)continue;e.extensions||(e.extensions={}),e.extensions.KHR_materials_unlit={}}}}}abortTileLoading(t,e){const n=this._t[t.url];if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t].abort();else n&&n.abort&&n.abort();delete this._t[t.url],e(null)}Qt(t,e,n,r){const i=e&&e.RTC_CENTER||t.extensions&&t.extensions.CESIUM_RTC&&t.extensions.CESIUM_RTC.center;let s=Ar;"X"===(n=n&&n.toUpperCase())?s=Tr:"Z"===n&&(s=Ir),t.extensions=t.extensions||{},t.extensions.CESIUM_RTC||(t.extensions.CESIUM_RTC={}),i&&(t.extensions.CESIUM_RTC.center=i),t.extensions.MAPTALKS_RTC={};const o={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};on(t,(t=>{if(!(t.attributes&&t.attributes.POSITION))return;const e=ft(Cr);t.matrices&&Vr(e,t.matrices);const n=t.attributes.POSITION.array,a=t.attributes.POSITION.itemSize;lt(e,s,e),r&&lt(e,r,e),jr(n,a,i||Er,e,o,t.compressUniforms)}));const a=zr(o);return{rtcCenter:i,modelCenter:a,upAxisTransform:s}}Ht(t,e,n,r){const{modelCenter:i,upAxisTransform:s,rtcCenter:o}=this.Qt(t,e,n),a=this.Yt(i);t.extensions.MAPTALKS_RTC.projCenter=a,t.extensions.MAPTALKS_RTC.rtcCoord=t.extensions.CESIUM_RTC.rtcCoord=this.Kt(i);const c=bt([],i);r&&Mt(i,i,r),t.extensions.CESIUM_RTC.rtcCoord=this.Kt(i),o||(on(t,(t=>{if(t.attributes&&t.attributes.POSITION){const e=t.attributes.POSITION;if(e.array.buffer.projected&&e.array.buffer.projected[e.byteOffset])return;const n=ft(Cr);t.matrices&&Vr(n,t.matrices),lt(n,s,n);const r=function(t,e){var n=e[0],r=e[1],i=e[2],s=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8],l=e[9],h=e[10],d=e[11],y=e[12],m=e[13],b=e[14],p=e[15],g=n*a-r*o,w=n*c-i*o,v=n*u-s*o,M=r*c-i*a,A=r*u-s*a,T=i*u-s*c,_=f*m-l*y,k=f*b-h*y,O=f*p-d*y,x=l*b-h*m,S=l*p-d*m,I=h*p-d*b,E=g*I-w*S+v*x+M*O-A*k+T*_;return E?(E=1/E,t[0]=(a*I-c*S+u*x)*E,t[1]=(i*S-r*I-s*x)*E,t[2]=(m*T-b*A+p*M)*E,t[3]=(h*A-l*T-d*M)*E,t[4]=(c*O-o*I-u*k)*E,t[5]=(n*I-i*O+s*k)*E,t[6]=(b*v-y*T-p*w)*E,t[7]=(f*T-h*v+d*w)*E,t[8]=(o*S-a*O+u*_)*E,t[9]=(r*O-n*S-s*_)*E,t[10]=(y*A-m*v+p*g)*E,t[11]=(l*v-f*A-d*g)*E,t[12]=(a*k-o*x-c*_)*E,t[13]=(n*x-r*k+i*_)*E,t[14]=(m*w-y*M-b*g)*E,t[15]=(f*M-l*w+h*g)*E,t):null}(Ur,n),i=[1/0,1/0,1/0],o=[-1/0,-1/0,-1/0];yn(e,(t=>{Mt(t,t,n),t[0]=t[0]-c[0],t[1]=t[1]-c[1],t[2]=t[2]-c[2],Mt(t,t,r),t[0]<i[0]&&(i[0]=t[0]),t[1]<i[1]&&(i[1]=t[1]),t[2]<i[2]&&(i[2]=t[2]),t[0]>o[0]&&(o[0]=t[0]),t[1]>o[1]&&(o[1]=t[1]),t[2]>o[2]&&(o[2]=t[2])})),e.min=i,e.max=o,e.array.buffer.projected||(e.array.buffer.projected={}),e.array.buffer.projected[e.byteOffset]=1}})),t.extensions.CESIUM_RTC.center=c)}Jt(t,e,n,r){const{modelCenter:i,rtcCenter:s}=this.Qt(t,e,n,r),o=this.Yt(i);t.extensions.MAPTALKS_RTC.projCenter=o,t.extensions.MAPTALKS_RTC.rtcCoord=t.extensions.CESIUM_RTC.rtcCoord=this.Kt(i),on(t,(e=>{if(e.attributes&&e.attributes.POSITION){const i=this.qt(e,t);if(i){const t=e.attributes.POSITION.array.length;(!Dr||Dr.length<t)&&(Dr=new Float32Array(t))}e.attributes.NORMAL&&this.Wt(e.attributes.NORMAL,e.matrices,n),e.attributes.TANGENT&&this.Wt(e.attributes.TANGENT,e.matrices,n);const{newPositions:o}=this.Zt(e.attributes.POSITION,e.matrices,s,t.extensions.MAPTALKS_RTC,n,r,e.compressUniforms,i),{componentType:a}=e.attributes.POSITION;5126!==a&&(e.attributes.POSITION.array=new Float32Array(o))}}));for(const e in t.nodes){t.nodes[e].matrix=Ir}}Yt(t){const e=this.options.projection;"identity"===e?bt(Fr,t):0===_t(t)?pt(Fr,0,0,-6378137):xe(Fr,t),Ln(Nr,Fr,e);const n=Fr[2],r=[];return r[0]=Nr[0],r[1]=Nr[1],r[2]=n,r}Wt(t,e,n){let r;r="Y"===n?Ar:"X"===n?Tr:Ir;const i=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}([],r);if(Vr(i,e),ht(i,Ir))return;const s=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}([],i),o=[];yn(t,(t=>(function(t,e,n){var r=e[0],i=e[1],s=e[2];t[0]=r*n[0]+i*n[3]+s*n[6],t[1]=r*n[1]+i*n[4]+s*n[7],t[2]=r*n[2]+i*n[5]+s*n[8]}(o,t,s),wt(o,o),bt(t,o),o)))}Zt(t,e,n,r,i,s,o,a){if(t.array.buffer.projected&&t.array.buffer.projected[t.byteOffset])return null;const c=ft([]);Vr(c,e);const u=this.options.projection;i=i&&i.toUpperCase();const f=n;let l=null;"Y"===i?l=Ar:"X"===i&&(l=Tr);let h=[0,0,0,1];const d=[0,0,0],y=[0,0],m=r.projCenter,b=Ln([],r.rtcCoord,"EPSG:3857"),p=s&&ht(Ir,s),g=t.min=t.min||[],w=t.max=t.max||[];pt(g,1/0,1/0,1/0),pt(w,-1/0,-1/0,-1/0);const v=o||{},{decode_position_min:M,decode_position_normConstant:A}=v;let T=[0,0,0,0],_=1;M&&(T=M),A&&(_=A);const k=[];return yn(t,((e,n)=>{if(h[0]=e[0]*_+T[0],h[1]=e[1]*_+T[1],h[2]=e[2]*_+T[2],h=Mt(h,h,c),l&&(h=Mt(h,h,l)),f&&gt(h,h,f),s&&!p&&(h=Mt(h,h,s)),0===_t(h)?pt(d,0,0,-6378137):xe(d,h),a){const t=Dr;Ln(y,d,u),t[3*n]=y[0]-b[0],t[3*n+1]=y[0]-b[1],t[3*n+2]=y[0]-b[2]}if(Ln(y,d,u),e instanceof Float32Array)e[0]=y[0]-m[0],e[1]=y[1]-m[1],e[2]=d[2]-m[2];else{const n=y[0]-m[0],r=y[1]-m[1],i=d[2]-m[2];5126!==t.componentType&&(k.push(n),k.push(r),k.push(i),k.push(e[3]))}return e[0]<g[0]&&(g[0]=e[0]),e[1]<g[1]&&(g[1]=e[1]),e[2]<g[2]&&(g[2]=e[2]),e[0]>w[0]&&(w[0]=e[0]),e[1]>w[1]&&(w[1]=e[1]),e[2]>w[2]&&(w[2]=e[2]),e})),t.array.buffer.projected||(t.array.buffer.projected={}),t.array.buffer.projected[t.byteOffset]=1,{projCenter:m,newPositions:k}}Kt(t){return 0===_t(t)?pt([],0,0,-6378137):xe([],t)}onRemove(){}Vt(){return"EPSG:4326"===this.options.projection||"EPSG:4490"===this.options.projection}qt(t,e){if(!t.attributes.POSITION||function(t,e){const n=e.materials[t.material],r=n&&n.extensions&&n.extensions.KHR_materials_unlit;return r}(t,e))return!1;return!t.attributes.TANGENT}}const Lr=[];function jr(t,e,n,r,i,s){const o=s||{},{decode_position_min:a,decode_position_normConstant:c}=o;let u=[0,0,0,0],f=1;a&&(u=a),c&&(f=c);for(let s=0,o=t.length;s<o;s+=e){const{xmin:o,ymin:a,xmax:c,ymax:l,hmin:h,hmax:d}=i;pt(Lr,t[s]*f+u[0],t[s+1]*f+u[1],t[s+2]*f+u[2]),Mt(Lr,Lr,r);const y=gt(Lr,n,Lr);y[0]<o&&(i.xmin=y[0]),y[0]>c&&(i.xmax=y[0]),y[1]<a&&(i.ymin=y[1]),y[1]>l&&(i.ymax=y[1]),e>2&&(y[2]<h&&(i.hmin=y[2]),y[2]>d&&(i.hmax=y[2]))}}function zr(t){const{xmax:e,ymax:n,xmin:r,ymin:i,hmin:s,hmax:o}=t,a=[(r+e)/2,(i+n)/2,(s+o)/2];return e===-1/0&&(a[0]=0),n===-1/0&&(a[1]=0),o===-1/0&&(a[2]=0),isNaN(a[2])&&(a[2]=0),a}function qr(t,e){for(let n=0;n<e.length;n++)t.indexOf(e[n])<0&&t.push(e[n])}function Vr(t,e){const n=t;for(let t=e.length-1;t>=0;t--)lt(n,e[t],n);return n}function Gr(t,e,n,r,i){if(e&&e>1)for(let n=0;n<t.length;n++)(n+1)%3!=0&&(t[n]*=e);let s,o;if(n&&r&&1===e)s=Math.min(...n),o=Math.max(...r);else{const{min:e,max:n}=function(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++)t[r]>n&&(n=t[r]),t[r]<e&&(e=t[r]);return{min:e,max:n}}(t);s=e,o=n}return!function(t,e,n,r){for(let i=0;i<t.length;i++){const s=$r(Xr(t[i],e,n),e,n);if(Math.abs(s-t[i])>Br[r])return!1}return!0}(t,s,o,i)&&Br[i]?null:function(t,e,n){const r=new Int16Array(t.length);for(let i=0;i<t.length;i++)r[i]=Xr(t[i],e,n);return{array:r,range:[e,n]}}(t,s,o)}function $r(t,e,n){return((t>=32768?-(65536-t)/32768:t/32767)+1)*(n-e)/2+e}function Xr(t,e,n){const r=2*(t-e)/(n-e)-1,i=Math.max(-1,Math.min(1,r));return i<0?32768*i:32767*i}function Hr(t){return void 0===t.compressGeometry||t.compressGeometry}let Jr=0;class Kr{constructor(t){this.workerId=t,this.workers={},this.te={}}addLayer({actorId:t,mapId:e,layerId:n,params:r},i){if(this.ee(e,n))return;const s=this.ne(e,n),o=r.options;this.workers[s]=new Rr(n,o,((...e)=>this.send.call(this,t,...e)),i)}removeLayer({mapId:t,layerId:e},n){const r=this.ee(t,e),i=this.ne(t,e);delete this.workers[i],r&&r.onRemove(n)}loadTile({mapId:t,layerId:e,params:n},r){const i=this.ee(t,e);i&&i.loadTile(n,r)}abortTileLoading({mapId:t,layerId:e,params:n},r){const i=this.ee(t,e);i&&i.abortTileLoading(n,r)}receive(t){const e=t.callback,n=this.te[e];delete this.te[e],n&&t.error?n(new Error(t.error)):n&&n(null,t.data)}send(t,e,n,r,i){const s=i?\`${eZ}t}-${eZ}Jr++}\`:null;i&&(this.te[s]=i),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:e,params:n,callback:String(s)},r||[])}ne(t,e){return\`${eZ}t}-${eZ}e}\`}ee(t,e){const n=this.ne(t,e);return this.workers[n]}}t.initialize=function(){},t.onmessage=function(t,e){const n=t.data;this.dispatcher||(this.dispatcher=new Kr(t.workerId)),"<response>"===t.type?this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t):this.dispatcher[n.command]({actorId:n.actorId,mapId:n.mapId,layerId:n.layerId,params:n.params},((t,n,r)=>{t&&404!==t.status&&204!==t.status&&console.error(t),t instanceof Error&&(t={message:t.message}),e(t,n,r)}))}}`;var iZ={exports:{}},rZ={exports:{}},oZ=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},sZ=Array.prototype.concat,aZ=Array.prototype.slice,hZ=rZ.exports=function(t){for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];oZ(r)?e=sZ.call(e,aZ.call(r)):e.push(r)}return e};hZ.wrap=function(t){return function(){return t(hZ(arguments))}};var lZ={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},uZ=rZ.exports,cZ=Object.hasOwnProperty,AZ=Object.create(null);for(var fZ in lZ)cZ.call(lZ,fZ)&&(AZ[lZ[fZ]]=fZ);var dZ=iZ.exports={to:{},get:{}};function pZ(t,e,n){return Math.min(Math.max(e,t),n)}function gZ(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}dZ.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=dZ.get.hsl(t),n="hsl";break;case"hwb":e=dZ.get.hwb(t),n="hwb";break;default:e=dZ.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},dZ.get.rgb=function(t){if(!t)return null;var e,n,i,r=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(i=e[2],e=e[1],n=0;n<3;n++){var o=2*n;r[n]=parseInt(e.slice(o,o+2),16)}i&&(r[3]=parseInt(i,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(i=(e=e[1])[3],n=0;n<3;n++)r[n]=parseInt(e[n]+e[n],16);i&&(r[3]=parseInt(i+i,16)/255)}else if(e=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)r[n]=parseInt(e[n+1],0);e[4]&&(r[3]=e[5]?.01*parseFloat(e[4]):parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(e=t.match(/^(\w+)$/))?"transparent"===e[1]?[0,0,0,0]:cZ.call(lZ,e[1])?((r=lZ[e[1]])[3]=1,r):null:null;for(n=0;n<3;n++)r[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(r[3]=e[5]?.01*parseFloat(e[4]):parseFloat(e[4]))}for(n=0;n<3;n++)r[n]=pZ(r[n],0,255);return r[3]=pZ(r[3],0,1),r},dZ.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,pZ(parseFloat(e[2]),0,100),pZ(parseFloat(e[3]),0,100),pZ(isNaN(n)?1:n,0,1)]}return null},dZ.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,pZ(parseFloat(e[2]),0,100),pZ(parseFloat(e[3]),0,100),pZ(isNaN(n)?1:n,0,1)]}return null},dZ.to.hex=function(){var t=uZ(arguments);return"#"+gZ(t[0])+gZ(t[1])+gZ(t[2])+(t[3]<1?gZ(Math.round(255*t[3])):"")},dZ.to.rgb=function(){var t=uZ(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},dZ.to.rgb.percent=function(){var t=uZ(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),i=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+i+"%)":"rgba("+e+"%, "+n+"%, "+i+"%, "+t[3]+")"},dZ.to.hsl=function(){var t=uZ(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},dZ.to.hwb=function(){var t=uZ(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},dZ.to.keyword=function(t){return AZ[t.slice(0,3)]};var mZ=iZ.exports,yZ={exports:{}},vZ={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},_Z={};for(var xZ in vZ)vZ.hasOwnProperty(xZ)&&(_Z[vZ[xZ]]=xZ);var bZ=yZ.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var wZ in bZ)if(bZ.hasOwnProperty(wZ)){if(!("channels"in bZ[wZ]))throw new Error("missing channels property: "+wZ);if(!("labels"in bZ[wZ]))throw new Error("missing channel labels property: "+wZ);if(bZ[wZ].labels.length!==bZ[wZ].channels)throw new Error("channel and label counts mismatch: "+wZ);var CZ=bZ[wZ].channels,PZ=bZ[wZ].labels;delete bZ[wZ].channels,delete bZ[wZ].labels,Object.defineProperty(bZ[wZ],"channels",{value:CZ}),Object.defineProperty(bZ[wZ],"labels",{value:PZ})}bZ.rgb.hsl=function(t){var e,n,i=t[0]/255,r=t[1]/255,o=t[2]/255,s=Math.min(i,r,o),a=Math.max(i,r,o),h=a-s;return a===s?e=0:i===a?e=(r-o)/h:r===a?e=2+(o-i)/h:o===a&&(e=4+(i-r)/h),(e=Math.min(60*e,360))<0&&(e+=360),n=(s+a)/2,[e,100*(a===s?0:n<=.5?h/(a+s):h/(2-a-s)),100*n]},bZ.rgb.hsv=function(t){var e,n,i,r,o,s=t[0]/255,a=t[1]/255,h=t[2]/255,l=Math.max(s,a,h),u=l-Math.min(s,a,h),c=function(t){return(l-t)/6/u+.5};return 0===u?r=o=0:(o=u/l,e=c(s),n=c(a),i=c(h),s===l?r=i-n:a===l?r=1/3+e-i:h===l&&(r=2/3+n-e),r<0?r+=1:r>1&&(r-=1)),[360*r,100*o,100*l]},bZ.rgb.hwb=function(t){var e=t[0],n=t[1],i=t[2];return[bZ.rgb.hsl(t)[0],1/255*Math.min(e,Math.min(n,i))*100,100*(i=1-1/255*Math.max(e,Math.max(n,i)))]},bZ.rgb.cmyk=function(t){var e,n=t[0]/255,i=t[1]/255,r=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-i,1-r)))/(1-e)||0),100*((1-i-e)/(1-e)||0),100*((1-r-e)/(1-e)||0),100*e]},bZ.rgb.keyword=function(t){var e=_Z[t];if(e)return e;var n,i,r,o=1/0;for(var s in vZ)if(vZ.hasOwnProperty(s)){var a=(i=t,r=vZ[s],Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2)+Math.pow(i[2]-r[2],2));a<o&&(o=a,n=s)}return n},bZ.keyword.rgb=function(t){return vZ[t]},bZ.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,i=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)),100*(.2126*e+.7152*n+.0722*i),100*(.0193*e+.1192*n+.9505*i)]},bZ.rgb.lab=function(t){var e=bZ.rgb.xyz(t),n=e[0],i=e[1],r=e[2];return i/=100,r/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116)-16,500*(n-i),200*(i-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},bZ.hsl.rgb=function(t){var e,n,i,r,o,s=t[0]/360,a=t[1]/100,h=t[2]/100;if(0===a)return[o=255*h,o,o];e=2*h-(n=h<.5?h*(1+a):h+a-h*a),r=[0,0,0];for(var l=0;l<3;l++)(i=s+1/3*-(l-1))<0&&i++,i>1&&i--,r[l]=255*(o=6*i<1?e+6*(n-e)*i:2*i<1?n:3*i<2?e+(n-e)*(2/3-i)*6:e);return r},bZ.hsl.hsv=function(t){var e=t[0],n=t[1]/100,i=t[2]/100,r=n,o=Math.max(i,.01);return n*=(i*=2)<=1?i:2-i,r*=o<=1?o:2-o,[e,100*(0===i?2*r/(o+r):2*n/(i+n)),(i+n)/2*100]},bZ.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,i=t[2]/100,r=Math.floor(e)%6,o=e-Math.floor(e),s=255*i*(1-n),a=255*i*(1-n*o),h=255*i*(1-n*(1-o));switch(i*=255,r){case 0:return[i,h,s];case 1:return[a,i,s];case 2:return[s,i,h];case 3:return[s,a,i];case 4:return[h,s,i];case 5:return[i,s,a]}},bZ.hsv.hsl=function(t){var e,n,i,r=t[0],o=t[1]/100,s=t[2]/100,a=Math.max(s,.01);return i=(2-o)*s,n=o*a,[r,100*(n=(n/=(e=(2-o)*a)<=1?e:2-e)||0),100*(i/=2)]},bZ.hwb.rgb=function(t){var e,n,i,r,o,s,a,h=t[0]/360,l=t[1]/100,u=t[2]/100,c=l+u;switch(c>1&&(l/=c,u/=c),i=6*h-(e=Math.floor(6*h)),1&e&&(i=1-i),r=l+i*((n=1-u)-l),e){default:case 6:case 0:o=n,s=r,a=l;break;case 1:o=r,s=n,a=l;break;case 2:o=l,s=n,a=r;break;case 3:o=l,s=r,a=n;break;case 4:o=r,s=l,a=n;break;case 5:o=n,s=l,a=r}return[255*o,255*s,255*a]},bZ.cmyk.rgb=function(t){var e=t[1]/100,n=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-i)+i)),255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,n*(1-i)+i))]},bZ.xyz.rgb=function(t){var e,n,i,r=t[0]/100,o=t[1]/100,s=t[2]/100;return n=-.9689*r+1.8758*o+.0415*s,i=.0557*r+-.204*o+1.057*s,e=(e=3.2406*r+-1.5372*o+-.4986*s)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,i=i>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(i=Math.min(Math.max(0,i),1))]},bZ.xyz.lab=function(t){var e=t[0],n=t[1],i=t[2];return n/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},bZ.lab.xyz=function(t){var e,n,i;e=t[1]/500+(n=(t[0]+16)/116),i=n-t[2]/200;var r=Math.pow(n,3),o=Math.pow(e,3),s=Math.pow(i,3);return n=r>.008856?r:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,i=s>.008856?s:(i-16/116)/7.787,[e*=95.047,n*=100,i*=108.883]},bZ.lab.lch=function(t){var e,n=t[0],i=t[1],r=t[2];return(e=360*Math.atan2(r,i)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(i*i+r*r),e]},bZ.lch.lab=function(t){var e,n=t[1];return e=t[2]/360*2*Math.PI,[t[0],n*Math.cos(e),n*Math.sin(e)]},bZ.rgb.ansi16=function(t){var e=t[0],n=t[1],i=t[2],r=1 in arguments?arguments[1]:bZ.rgb.hsv(t)[2];if(0===(r=Math.round(r/50)))return 30;var o=30+(Math.round(i/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===r&&(o+=60),o},bZ.hsv.ansi16=function(t){return bZ.rgb.ansi16(bZ.hsv.rgb(t),t[2])},bZ.rgb.ansi256=function(t){var e=t[0],n=t[1],i=t[2];return e===n&&n===i?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(i/255*5)},bZ.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},bZ.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},bZ.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},bZ.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var i=parseInt(n,16);return[i>>16&255,i>>8&255,255&i]},bZ.rgb.hcg=function(t){var e,n=t[0]/255,i=t[1]/255,r=t[2]/255,o=Math.max(Math.max(n,i),r),s=Math.min(Math.min(n,i),r),a=o-s;return e=a<=0?0:o===n?(i-r)/a%6:o===i?2+(r-n)/a:4+(n-i)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?s/(1-a):0)]},bZ.hsl.hcg=function(t){var e,n=t[1]/100,i=t[2]/100,r=0;return(e=i<.5?2*n*i:2*n*(1-i))<1&&(r=(i-.5*e)/(1-e)),[t[0],100*e,100*r]},bZ.hsv.hcg=function(t){var e=t[2]/100,n=t[1]/100*e,i=0;return n<1&&(i=(e-n)/(1-n)),[t[0],100*n,100*i]},bZ.hcg.rgb=function(t){var e=t[1]/100,n=t[2]/100;if(0===e)return[255*n,255*n,255*n];var i,r=[0,0,0],o=t[0]/360%1*6,s=o%1,a=1-s;switch(Math.floor(o)){case 0:r[0]=1,r[1]=s,r[2]=0;break;case 1:r[0]=a,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=s;break;case 3:r[0]=0,r[1]=a,r[2]=1;break;case 4:r[0]=s,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=a}return[255*(e*r[0]+(i=(1-e)*n)),255*(e*r[1]+i),255*(e*r[2]+i)]},bZ.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),i=0;return n>0&&(i=e/n),[t[0],100*i,100*n]},bZ.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,i=0;return n>0&&n<.5?i=e/(2*n):n>=.5&&n<1&&(i=e/(2*(1-n))),[t[0],100*i,100*n]},bZ.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},bZ.hwb.hcg=function(t){var e=1-t[2]/100,n=e-t[1]/100,i=0;return n<1&&(i=(e-n)/(1-n)),[t[0],100*n,100*i]},bZ.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},bZ.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},bZ.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},bZ.gray.hsl=bZ.gray.hsv=function(t){return[0,0,t[0]]},bZ.gray.hwb=function(t){return[0,100,t[0]]},bZ.gray.cmyk=function(t){return[0,0,0,t[0]]},bZ.gray.lab=function(t){return[t[0],0,0]},bZ.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},bZ.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var MZ=yZ.exports,TZ=MZ;function SZ(t,e){return function(n){return e(t(n))}}function IZ(t,e){for(var n=[e[t].parent,t],i=TZ[e[t].parent][t],r=e[t].parent;e[r].parent;)n.unshift(e[r].parent),i=SZ(TZ[e[r].parent][r],i),r=e[r].parent;return i.conversion=n,i}var EZ=MZ,OZ=function(t){for(var e=function(t){var e=function(){for(var t={},e=Object.keys(TZ),n=e.length,i=0;i<n;i++)t[e[i]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var i=n.pop(),r=Object.keys(TZ[i]),o=r.length,s=0;s<o;s++){var a=r[s],h=e[a];-1===h.distance&&(h.distance=e[i].distance+1,h.parent=i,n.unshift(a))}return e}(t),n={},i=Object.keys(e),r=i.length,o=0;o<r;o++){var s=i[o];null!==e[s].parent&&(n[s]=IZ(s,e))}return n},RZ={};Object.keys(EZ).forEach((function(t){RZ[t]={},Object.defineProperty(RZ[t],"channels",{value:EZ[t].channels}),Object.defineProperty(RZ[t],"labels",{value:EZ[t].labels});var e=OZ(t);Object.keys(e).forEach((function(n){var i,r,o=e[n];RZ[t][n]=(r=function(t){if(null==t)return t;arguments.length>1&&(t=Array.prototype.slice.call(arguments));var e=i(t);if("object"==typeof e)for(var n=e.length,r=0;r<n;r++)e[r]=Math.round(e[r]);return e},"conversion"in(i=o)&&(r.conversion=i.conversion),r),RZ[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(o)}))}));var DZ=mZ,kZ=RZ,LZ=[].slice,FZ=["keyword","gray","hex"],NZ={};Object.keys(kZ).forEach((function(t){NZ[LZ.call(kZ[t].labels).sort().join("")]=t}));var zZ={};function BZ(t,e){if(!(this instanceof BZ))return new BZ(t,e);if(e&&e in FZ&&(e=null),e&&!(e in kZ))throw new Error("Unknown model: "+e);var n,i;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof BZ)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var r=DZ.get(t);if(null===r)throw new Error("Unable to parse color from string: "+t);this.model=r.model,this.color=r.value.slice(0,i=kZ[this.model].channels),this.valpha="number"==typeof r.value[i]?r.value[i]:1}else if(t.length){this.model=e||"rgb";var o=LZ.call(t,0,i=kZ[this.model].channels);this.color=UZ(o,i),this.valpha="number"==typeof t[i]?t[i]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var s=Object.keys(t);"alpha"in t&&(s.splice(s.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=s.sort().join("");if(!(a in NZ))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=NZ[a];var h=kZ[this.model].labels,l=[];for(n=0;n<h.length;n++)l.push(t[h[n]]);this.color=UZ(l)}if(zZ[this.model])for(i=kZ[this.model].channels,n=0;n<i;n++){var u=zZ[this.model][n];u&&(this.color[n]=u(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function HZ(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(zZ[t]||(zZ[t]=[]))[e]=n})),t=t[0],function(i){var r;return arguments.length?(n&&(i=n(i)),(r=this[t]()).color[e]=i,r):(r=this[t]().color[e],n&&(r=n(r)),r)}}function jZ(t){return function(e){return Math.max(0,Math.min(t,e))}}function UZ(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}BZ.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in DZ.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return DZ.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return DZ.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=kZ[this.model].channels,n=kZ[this.model].labels,i=0;i<e;i++)t[n[i]]=this.color[i];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new BZ(this.color.map(function(t){return function(e){return n=t,Number(e.toFixed(n));var n}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new BZ(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:HZ("rgb",0,jZ(255)),green:HZ("rgb",1,jZ(255)),blue:HZ("rgb",2,jZ(255)),hue:HZ(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:HZ("hsl",1,jZ(100)),lightness:HZ("hsl",2,jZ(100)),saturationv:HZ("hsv",1,jZ(100)),value:HZ("hsv",2,jZ(100)),chroma:HZ("hcg",1,jZ(100)),gray:HZ("hcg",2,jZ(100)),white:HZ("hwb",1,jZ(100)),wblack:HZ("hwb",2,jZ(100)),cyan:HZ("cmyk",0,jZ(100)),magenta:HZ("cmyk",1,jZ(100)),yellow:HZ("cmyk",2,jZ(100)),black:HZ("cmyk",3,jZ(100)),x:HZ("xyz",0,jZ(100)),y:HZ("xyz",1,jZ(100)),z:HZ("xyz",2,jZ(100)),l:HZ("lab",0,jZ(100)),a:HZ("lab",1),b:HZ("lab",2),keyword:function(t){return arguments.length?new BZ(t):kZ[this.model].keyword(this.color)},hex:function(t){return arguments.length?new BZ(t):DZ.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var i=t[n]/255;e[n]=i<=.03928?i/12.92:Math.pow((i+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return BZ.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n=(n+t)%360)<0?360+n:n,e.color[0]=n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var n=t.rgb(),i=this.rgb(),r=void 0===e?.5:e,o=2*r-1,s=n.alpha()-i.alpha(),a=((o*s==-1?o:(o+s)/(1+o*s))+1)/2,h=1-a;return BZ.rgb(a*n.red()+h*i.red(),a*n.green()+h*i.green(),a*n.blue()+h*i.blue(),n.alpha()*r+i.alpha()*(1-r))}},Object.keys(kZ).forEach((function(t){if(-1===FZ.indexOf(t)){var e=kZ[t].channels;BZ.prototype[t]=function(){if(this.model===t)return new BZ(this);if(arguments.length)return new BZ(arguments,t);var n,i="number"==typeof arguments[e]?e:this.valpha;return new BZ((n=kZ[this.model][t].raw(this.color),Array.isArray(n)?n:[n]).concat(i),t)},BZ[t]=function(n){return"number"==typeof n&&(n=UZ(LZ.call(arguments),e)),new BZ(n,t)}}}));var GZ=function(t){return t&&t.t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(BZ);function VZ(t){return null==t}function WZ(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function qZ(t){return null!=t&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function ZZ(t){return"object"==typeof t&&!!t}function QZ(t){return"number"==typeof t&&!isNaN(t)}function XZ(t){return t*Math.PI/180}function YZ(t){return t/Math.PI*180}function JZ(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}function KZ(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}const $Z=[1,1,1,1,2,2,3,0];function tQ(t){const e=t.length;let n="";for(let i=0;i<e;){let r=t[i++];if(128&r){let n=$Z[r>>3&7];if(!(64&r)||!n||i+n>e)return null;for(r&=63>>n;n>0;n-=1){const e=t[i++];if(128!=(192&e))return null;r=r<<6|63&e}}n+=String.fromCharCode(r)}return n}function eQ(t,e,n){return t[3*n]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2],t}function nQ(t){return t.flat?t.flat(1/0):t.reduce(((t,e)=>t.concat(e)),[])}function iQ(t){return t<256?Uint8Array:t<65536?Uint16Array:Uint32Array}function rQ(t){return 0===t.indexOf("data:")}function oQ(t){const e=t.indexOf("base64,"),n=t.substring(e+7),i=window.atob(n),r=i.length,o=new Uint8Array(r);for(let s=0;s<r;s++)o[s]=i.charCodeAt(s);return o.buffer}function sQ(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)for(let e=0,i=n.length;e<i;e++)t.push(n[e])}return t.length}const aQ={};function hQ(t,e){Array.isArray(e)||(e=aQ[e]=aQ[e]||GZ(e).array().map((t=>t/255)));for(let n=0;n<e.length;n++)t[n]=e[n];return 3===e.length&&(t[3]=1),t}var lQ=Object.freeze({__proto__:null,base64URLToArrayBuffer:oQ,extend:WZ,flatArr:nQ,getAbsoluteURL:JZ,getBatchIdArrayType:iQ,isBase64:rQ,isFunction:qZ,isNil:VZ,isNumber:QZ,isObject:ZZ,normalizeColor:hQ,pushIn:sQ,setColumn3:eQ,sign:KZ,stringFromUTF8Array:tQ,toDegree:YZ,toRadian:XZ});function uQ(t){return-1===t.indexOf("http://")&&-1===t.indexOf("https://")&&-1===t.indexOf("file://")}function cQ(t){return(t=t||{}).referrerPolicy=t.referrerPolicy||"origin",t.referrer=window&&window.location.href,t}const AQ="undefined"==typeof document?null:document.createElement("canvas");let fQ=class extends $f.Actor{constructor(t,e,n){super(t),this.mapId=e,this.i=n}initialize(t){t(null)}loadTile(t,e,n){let i=null;e&&e.arraybuffer&&(i=[e.arraybuffer]),this.send({mapId:this.mapId,layerId:t,command:"loadTile",params:e},i,n)}abortTileLoading(t,e,n){this.broadcast({mapId:this.mapId,layerId:t,command:"abortTileLoading",params:{url:e}},null,n)}addLayer(t,e,n){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:e}},null,n)}removeLayer(t,e){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,e)}requestImage({url:t},e){const n=new Image;n.onload=()=>{if(!this.isActive())return;if(!AQ)return void e(new Error("There is no canvas to draw image!"));const t=this.i?n:function(t){if(dQ(t.width)&&dQ(t.height))return t;let e=t.width,n=t.height;dQ(e)||(e=pQ(e)),dQ(n)||(n=pQ(n));const i=document.createElement("canvas");i.width=e,i.height=n,i.getContext("2d").drawImage(t,0,0,e,n);const r=t.src,o=r.lastIndexOf("/")+1,s=r.substring(o);return console.warn(`Texture(${s})'s size is not power of two, resize from (${t.width}, ${t.height}) to (${e}, ${n})`),i}(n);AQ.width=t.width,AQ.height=t.height;const i=AQ.getContext("2d",{willReadFrequently:!0});i.drawImage(t,0,0,t.width,t.height);const r=i.getImageData(0,0,t.width,t.height),o={width:t.width,height:t.height,data:new Uint8Array(r.data)};e(null,o,[o.data.buffer])},n.onerror=function(t){e(t)},n.src=t}};function dQ(t){return!(t&t-1)&&0!==t}function pQ(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function gQ(t,e){if(t.scenes&&t.scenes.length)for(let n=0,i=t.scenes.length;n<i;n++){const i=t.scenes[n].nodes;for(let n=0,r=i.length;n<r;n++)wQ(i[n],[],t,e)}}const mQ=[],yQ=[],vQ=[],_Q=[0,0,0],xQ=ym([]),bQ=[1,1,1];function wQ(t,e,n,i){const r=e.slice(0);if(t.matrix)r.push(t.matrix);else if(t.rotation||t.translation||t.scale){const e=Zp(mQ,t.translation||_Q),n=eg(yQ,t.rotation||xQ),i=Qp(vQ,t.scale||bQ);Hp(i,n,i);const o=Hp([],e,i);r.push(o)}if(t.children&&t.children.length)for(let o=0,s=t.children.length;o<s;o++)wQ(t.children[o],r,n,i);if(void 0!==t.mesh){const e=t.mesh,o=n.meshes[e];if(o){const t=r.slice(0),s=o.primitives;for(let r=0,o=s.length;r<o;r++){const o=s[r];o&&(o.matrices=t,i(o,e,r,n))}}}}function CQ(t,e,n){let{byteOffset:i,byteStride:r}=e;const{componentType:o,itemSize:s}=e,a=e.array.buffer,h=o?tp.getTypedArrayCtor(o):e.array.constructor;if(i=void 0===i?e.array.byteOffset:i,r=r||0,!r||r===s*h.BYTES_PER_ELEMENT&&i%h.BYTES_PER_ELEMENT==0){const e=new h(a,i+n*s*h.BYTES_PER_ELEMENT,s);return t.set(e),t}r||(r=s*h.BYTES_PER_ELEMENT);const l=new Uint8Array(a,r*n+i,s*h.BYTES_PER_ELEMENT);return new Uint8Array(t.buffer).set(l),t}function PQ(t,e,n,i){t[4*e]=n[i],t[4*e+1]=n[i+4],t[4*e+2]=n[i+8],t[4*e+3]=n[i+12]}var MQ="#include <gl2_vert>\n\nconst float SHIFT_RIGHT_11 = 1.0 / 2048.0;\n\nconst float SHIFT_RIGHT_5 = 1.0 / 32.0;\n\nconst float SHIFT_LEFT_11 = 2048.0;\n\nconst float SHIFT_LEFT_5 = 32.0;\n\nconst float NORMALIZE_6 = 1.0 / 64.0;\n\nconst float NORMALIZE_5 = 1.0 / 32.0;\n\n\n\n#ifdef HAS_POSITION\n\n    attribute vec3 POSITION;\n\n#endif\n\n\n\n#if defined(HAS_RGB)\n\n    attribute vec3 RGB;\n\n#elif defined(HAS_RGBA)\n\n    attribute vec4 RGBA;\n\n#elif defined(HAS_RGB565)\n\n    attribute float RGB565;\n\n#endif\n\n\n\nuniform vec4 pointColor;\n\nuniform float pointSize;\n\n\n\nuniform mat4 projViewModelMatrix;\n\nuniform float pointOpacity;\n\n\n\nvarying vec4 vColor;\n\n\n\n#ifdef HAS_NORMAL\n\n    #ifdef HAS_NORMAL_OCT16P\n\n        attribute vec2 NORMAL_OCT16P;\n\n        float signNotZero(float value) {\n\n            return value >= 0.0 ? 1.0 : -1.0;\n\n        }\n\n        vec2 signNotZero(vec2 value) {\n\n            return vec2(signNotZero(value.x), signNotZero(value.y));\n\n        }\n\n        vec3 octDecode(vec2 encoded, float range) {\n\n            if (encoded.x == 0.0 && encoded.y == 0.0) {\n\n                return vec3(0.0, 0.0, 0.0);\n\n            }\n\n            encoded = encoded / range * 2.0 - 1.0;\n\n            vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n\n            if (v.z < 0.0) {\n\n                v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\n\n            }\n\n            return normalize(v);\n\n        }\n\n        vec3 octDecode(vec2 encoded) {\n\n            return octDecode(encoded, 255.0);\n\n        }\n\n    #else\n\n        attribute vec3 NORMAL;\n\n    #endif\n\n    uniform vec3 lightDir;\n\n    uniform mat3 modelNormalMatrix;\n\n    uniform mat4 positionMatrix;\n\n    float getLambertDiffuse(vec3 lightDir, vec3 normal) {\n\n        return max(dot(-lightDir, normal), 0.0);\n\n    }\n\n#endif\n\n#ifdef PICKING_MODE\n\n    #include <fbo_picking_vert>\n\n#endif\n\n#include <draco_decode_vert>\n\nvoid main() {\n\n    #ifdef HAS_POSITION\n\n        vec3 localPos = decode_getPosition(POSITION);\n\n    #endif\n\n    gl_Position = projViewModelMatrix * vec4(localPos, 1.0);\n\n    gl_PointSize = pointSize;\n\n\n\n    #ifdef PICKING_MODE\n\n        fbo_picking_setData(gl_Position.w, true);\n\n    #else\n\n        #if defined(HAS_RGB)\n\n            vColor = vec4(RGB / 255.0, 1.0) * pointOpacity;\n\n        #elif defined(HAS_RGBA)\n\n            vColor = RGBA / 255.0 * pointOpacity;\n\n        #elif defined(HAS_RGB565)\n\n            float compressed = RGB565;\n\n            float r = floor(compressed * SHIFT_RIGHT_11);\n\n            compressed -= r * SHIFT_LEFT_11;\n\n            float g = floor(compressed * SHIFT_RIGHT_5);\n\n            compressed -= g * SHIFT_LEFT_5;\n\n            float b = compressed;\n\n            vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5);\n\n            vColor = vec4(rgb, 1.0);\n\n        #else\n\n            vColor = pointColor;\n\n        #endif\n\n\n\n        #ifdef HAS_NORMAL\n\n            mat3 positionNormalMatrix = mat3(positionMatrix);\n\n            mat3 normalMatrix = modelNormalMatrix * positionNormalMatrix;\n\n            #ifdef HAS_NORMAL_OCT16P\n\n                vec3 localNormal = octDecode(NORMAL_OCT16P);\n\n            #else\n\n                vec3 localNormal = NORMAL;\n\n            #endif\n\n            vec3 normal = normalize(normalMatrix * localNormal);\n\n            float colorStrength = getLambertDiffuse(lightDir, normal);\n\n            colorStrength = max(colorStrength, 0.5);\n\n            vColor *= colorStrength;\n\n        #endif\n\n    #endif\n\n\n\n\n\n\n\n\n\n}\n\n";const TQ=new Array(3),SQ=new Array(3),IQ=[40680631590769,40680631590769,40408299984661.445];function EQ(t,e,n,i){const r=IQ,o=Math.cos(n);TQ[0]=o*Math.cos(e),TQ[1]=o*Math.sin(e),TQ[2]=Math.sin(n),jQ(TQ,TQ),yg(SQ,r,TQ);const s=Math.sqrt(Mg(TQ,SQ));var a,h,l;return(a=SQ)[0]=(h=SQ)[0]/(l=s),a[1]=h[1]/l,a[2]=h[2]/l,_g(TQ,TQ,i),gg(t,SQ,TQ)}const OQ=[1/6378137,1/6378137,1/6356752.314245179],RQ=[1/40680631590769,1/40680631590769,1/40408299984661.445],DQ=new Array(3),kQ=new Array(3),LQ=new Array(3);function FQ(t,e){const n=RQ,i=function(t,e,n,i){const r=e[0],o=e[1],s=e[2],a=n[0],h=n[1],l=n[2],u=r*r*a*a,c=o*o*h*h,A=s*s*l*l,f=u+c+A,d=Math.sqrt(1/f),p=_g(NQ,e,d);if(f<.1)return isFinite(d)?p:void 0;const g=i[0],m=i[1],y=i[2],v=zQ;v[0]=p[0]*g*2,v[1]=p[1]*m*2,v[2]=p[2]*y*2;let _,x,b,w,C,P,M,T,S,I,E,O=(1-d)*HQ(e)/(.5*HQ(v)),R=0;do{O-=R,b=1/(1+O*g),w=1/(1+O*m),C=1/(1+O*y),P=b*b,M=w*w,T=C*C,S=P*b,I=M*w,E=T*C,_=u*P+c*M+A*T-1,x=u*S*g+c*I*m+A*E*y,R=_/(-2*x)}while(Math.abs(_)>BQ);return t[0]=r*b,t[1]=o*w,t[2]=s*C,t}(DQ,e,OQ,n);let r=kg(kQ,i,n);r=jQ(r,r);const o=Dg(LQ,e,i),s=Math.atan2(r[1],r[0]),a=Math.asin(r[2]),h=KZ(Mg(o,e))*HQ(o);return t[0]=YZ(s),t[1]=YZ(a),t[2]=h,t}const NQ=new Array(3),zQ=new Array(3),BQ=1e-12;function HQ(t){return Ag(t)}function jQ(t,e){const n=e[0],i=e[1],r=e[2];let o=n*n+i*i+r*r;return o>0&&(o=Math.sqrt(o),t[0]=e[0]/o,t[1]=e[1]/o,t[2]=e[2]/o),t}function UQ(t,e){return yg(e,t,RQ),Pg(e,e)}function GQ(t,e){const n=t[0],i=t[1],r=Math.cos(i),o=r*Math.cos(n),s=r*Math.sin(n),a=Math.sin(i);return e.x=o,e.y=s,e.z=a,Pg(e,e)}var VQ=Object.freeze({__proto__:null,cartesian3ToDegree:FQ,geodeticSurfaceNormal:UQ,geodeticSurfaceNormalCartographic:GQ,normalizeCartesian:jQ,radianToCartesian3:EQ});function WQ(t,e,n,i){n=n||0,i=i||n;const r=Math.abs(t-e);return r<=i||r<=n*Math.max(Math.abs(t),Math.abs(e))}function qQ(t,e){let n="";for(let i=0;i<4;i++){const r=t.getUint8(e+i);n+=String.fromCharCode(r)}return n}const ZQ="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function QQ(t,e,n){const i=new Uint8Array(t,e,n);return ZQ?JSON.parse(ZQ.decode(i)):JSON.parse(tQ(i))}function XQ(t,e,n){const i=new Uint8Array(t,e,n);return ZQ?JSON.parse(ZQ.decode(i)):JSON.parse(tQ(i))}function YQ(t,e,n){return{offset:e,byteLength:n}}function JQ(t,e,n,i){const{byteOffset:r,componentType:o,type:s}=t,{ctor:a,type:h}=iX(o||"UNSIGNED_SHORT"),l=eX(s);return{byteStride:0,byteOffset:r+n,itemSize:l,count:i*l,componentType:h,array:new a(e,n+r,i*l)}}function KQ(t,e,n,i){const r=JQ(t,e,n,i);return r.array.buffer.byteLength!==e.byteLength&&(r.array=r.array.slice()),r}function $Q(t,e,n,i){const{byteOffset:r,componentType:o,type:s}=t,{ctor:a}=iX(o||"UNSIGNED_SHORT"),h=eX(s),l=new a(e,r,n*h);return 1===h?l[i]:l.subarray(i*h,i*h+h)}const tX={SCALAR:1,VEC2:2,VEC3:3,VEC4:4};function eX(t){return t?tX[t]:1}const nX={BYTE:{ctor:Int8Array,type:5120,name:"Int8Array"},UNSIGNED_BYTE:{ctor:Uint8Array,type:5121,name:"Uint8Array"},SHORT:{ctor:Int16Array,type:5122,name:"Int16Array"},UNSIGNED_SHORT:{ctor:Uint16Array,type:5123,name:"Uint16Array"},INT:{ctor:Int32Array,type:5124,name:"Int32Array"},UNSIGNED_INT:{ctor:Uint32Array,type:5125,name:"Uint32Array"},FLOAT:{ctor:Float32Array,type:5126,name:"Float32Array"},DOUBLE:{ctor:Float64Array,type:5126,name:"Float64Array"}};function iX(t){return nX[t]}function rX(t){for(const e in nX)if(t===nX[e].ctor)return nX[e].type;throw new Error("unrecognized ctor:"+t)}function oX(t,e,n,i){const r=t,o=e.length/3;for(let s=0;s<o;s++)r[3*s]=e[3*s]/65535*i[0]+n[0],r[3*s+1]=e[3*s+1]/65535*i[1]+n[1],r[3*s+2]=e[3*s+2]/65535*i[2]+n[2];return r}function sX(t,e,n){const i=t.getUint32(12,!0),r=t.getUint32(16,!0),o=t.getUint32(20,!0),s=t.getUint32(24,!0),a=t.buffer;let h,l={},u={},c=null;i>0&&(l=QQ(a,e,i),e+=i),r>0&&(h=function(t,e,n){return{offset:e,byteLength:n}}(0,e,r),e+=r),o>0&&(u=XQ(a,e,o),e+=o);const A=YQ(0,e,s);return c=a.slice(A.offset,A.offset+A.byteLength),n.push(c),{featureTable:l,featureTableBin:h,batchTable:u,batchTableBin:c}}const aX={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},hX={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},lX={},uX={east:[],north:[],up:[],west:[],south:[],down:[]};let cX=[],AX=[],fX=[];const dX=[0,0,0];function pX(t,e,n){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=t[15],n}const gX=function(t,e){const n=aX[t][e];let i;const r=t+e;return lX[r]?i=lX[r]:(i=function(i,r,o){if(Og(i,dX))dg(cX,hX[t]),dg(AX,hX[e]),dg(fX,hX[n]);else if(WQ(i[0],0,1e-14)&&WQ(i[1],0,1e-14)){const r=KZ(i[2]);dg(cX,hX[t]),dg(AX,hX[e]),_g(AX,AX,r),dg(fX,hX[n]),_g(fX,fX,r)}else{UQ(i,uX.up);const r=uX.up,o=uX.east;o[0]=-i[1],o[1]=i[0],o[2]=0,Pg(uX.east,o),Tg(uX.north,r,o),_g(uX.down,uX.up,-1),_g(uX.west,uX.east,-1),_g(uX.south,uX.north,-1),cX=uX[t],AX=uX[e],fX=uX[n]}return o[0]=cX[0],o[1]=cX[1],o[2]=cX[2],o[3]=0,o[4]=AX[0],o[5]=AX[1],o[6]=AX[2],o[7]=0,o[8]=fX[0],o[9]=fX[1],o[10]=fX[2],o[11]=0,o[12]=i[0],o[13]=i[1],o[14]=i[2],o[15]=1,o},lX[r]=i),i}("east","north"),mX=[],yX=[],vX=[],_X=[],xX=[],bX=[],wX=[],CX={x:0,y:0},PX={x:0,y:0},MX=Math.PI/180;let TX;const SX={width:100,height:10};let IX=!1;try{new OffscreenCanvas(1,1).getContext("2d").fillText("hello",0,0),IX=!0}catch(fft){IX=!1}let EX=class{constructor(t,e={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let n=1/0,i=-1/0;for(let r=0,o=t.length;r<o;r++){const e=t[r][0];n=Math.min(e,n),i=Math.max(e,i)}this.min=n,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},SX,e),this.o()}getImageData(){return this.imgData}o(){const t=function(){if(!TX){const{width:t,height:e}=SX;IX?TX=new OffscreenCanvas(t,e):(TX=document.createElement("canvas"),TX.width=t,TX.height=e)}return TX}(),{width:e,height:n}=this.options;t.width=e,t.height=n;const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);const r=i.createLinearGradient(0,0,t.width,0),{colors:o,valueOffset:s}=this;for(let a=0,h=o.length;a<h;a++){const[t,e]=o[a];r.addColorStop((t-this.min)/s,e)}i.fillStyle=r,i.fillRect(0,0,t.width,t.height),this.imgData=i.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t);const e=((t=Math.min(t,this.max))-this.min)/this.valueOffset;let n=Math.round(e*this.imgData.width);n=Math.min(n,this.imgData.width-1);const i=4*n;return[this.imgData.data[i],this.imgData.data[i+1],this.imgData.data[i+2],this.imgData.data[i+3]]}};var OX;function RX(t,e){var n,i,r;if(UX(t)){var o,s=t.stops&&"object"==typeof t.stops[0][0],a=s||!(s||void 0!==t.property),h=t.type||e||"exponential";if("exponential"===h)o=LX;else if("interval"===h)o=kX;else if("categorical"===h)o=DX;else if("identity"===h)o=zX;else if("color-interpolate"===h)o=NX;else{if("calculate-expression"!==h)throw new Error('Unknown function type "'+h+'"');o=BX}if(s){var l={},u=[];for(let e=0;e<t.stops.length;e++){var c=t.stops[e];void 0===l[c[0].zoom]&&(l[c[0].zoom]={zoom:c[0].zoom,type:t.type,property:t.property,default:t.default,stops:[]}),l[c[0].zoom].stops.push([c[0].value,c[1]])}for(let t in l)u.push([l[t].zoom,RX(l[t])]);n=function(e,n){const i=LX({stops:u,base:t.base},e)(e,n);return"function"==typeof i?i(e,n):i},i=!1,r=!1}else a?(n=function(e){const n=o(t,e);return"function"==typeof n?n(e):n},i=!0,r=!1):(n=function(e,n){const i=o(t,n?n[t.property]:null);return"function"==typeof i?i(e,n):i},i=!1,r=!0)}else n=function(){return t},i=!0,r=!0;return n.isZoomConstant=r,n.isFeatureConstant=i,n}function DX(t,e){for(let n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.default}function kX(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function LX(t,e){for(var n=void 0!==t.base?t.base:1,i=0;!(i>=t.stops.length||e<=t.stops[i][0]);)i++;return 0===i?t.stops[i][1]:i===t.stops.length?t.stops[i-1][1]:HX(e,n,t.stops[i-1][0],t.stops[i][0],t.stops[i-1][1],t.stops[i][1])}"function"==typeof Map&&(OX=new Map);const FX={width:100,height:1};function NX(t,e){const n=t.stops;if(n&&n.length>1){let t;if(OX){const e=JSON.stringify(n);if(!OX.has(e)){const t=new EX(n,FX);OX.set(e,t)}t=OX.get(e)}else t=new EX(n,FX);const[i,r,o,s]=t.getColor(e);return[i/255,r/255,o/255,s/255]}return n&&1===n.length?n[0][1]:null}function zX(t,e){return i=t.default,void 0!==(n=e)?n:void 0!==i?i:null;var n,i}function BX(t,e){const n=String(t.property),i=t.expression,r=e;function o(e){return null==e||""===e||isNaN(e)?t.default:e}return null==e||""===e||isNaN(e)||e<0?o(t.default):o(function e(n){if(!Array.isArray(n)){if("number"==typeof n)return n;throw new Error("Invalid expression format")}{const i=n[0];if(!["+","-","*","/"].includes(i))throw new Error(`Unknown operator: ${i}`);const r=n.slice(1).map((t=>e(t)));switch(i){case"+":return r.reduce(((t,e)=>t+e),0);case"-":return r.reduce(((t,e)=>t-e));case"*":return r.reduce(((t,e)=>t*e),1);case"/":return r.some((t=>0===t))?t.default:r.reduce(((t,e)=>t/e));default:throw new Error(`Unsupported operator: ${i}`)}}}(function t(e,n,i){const r=Number(i),o=String(n);return Array.isArray(e)?e.map((e=>t(e,o,r))):e===o?r:e}(i,n,r)))}function HX(t,e,n,i,r,o){return"function"==typeof r?function(){var s=r.apply(void 0,arguments),a=o.apply(void 0,arguments);return HX(t,e,n,i,s,a)}:r.length?function(t,e,n,i,r,o){var s=[];for(let a=0;a<r.length;a++)s[a]=jX(t,e,n,i,r[a],o[a]);return s}(t,e,n,i,r,o):jX(t,e,n,i,r,o)}function jX(t,e,n,i,r,o){var s,a=i-n,h=t-n;return r*(1-(s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)))+o*s}function UX(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type||t.expression&&"calculate-expression"===t.type)}function GX(t){return VX(t,"exponential")}function VX(t,e){if(!UX(t))return function(){return t};let n=!0,i=!0;const r=(t=JSON.parse(JSON.stringify(t))).stops;if(r)for(let s=0;s<r.length;s++)if(UX(r[s][1])){const t=VX(r[s][1],e);n=n&&t.isZoomConstant,i=i&&t.isFeatureConstant,r[s]=[r[s][0],t]}const o=RX(t,e);return o.isZoomConstant=n&&o.isZoomConstant,o.isFeatureConstant=i&&o.isFeatureConstant,o}const{getTextureMagFilter:WX,getTextureMinFilter:qX,getTextureWrap:ZX,getMaterialType:QX,getMaterialFormat:XX,getPrimitive:YX,getUniqueREGLBuffer:JX}=p_,KX=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],$X=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],{loginIBLResOnCanvas:tY,logoutIBLResOnCanvas:eY,getIBLResOnCanvas:nY,getPBRUniforms:iY}=Xw.PBRUtils,rY={factor:0,units:0},oY=[1,1,1,1],sY=[0,0,0],aY={specularStrength:0,materialShininess:1},hY=[1,1,1],lY=Np([]),uY=[0,0,0],cY=[0,0],AY=[],fY=t=>t.material instanceof E_,dY=t=>t.material instanceof Xw.StandardMaterial,pY=[],gY=new $o(0,0),mY=new ht(0,0),yY=new ht(0,0),vY=new ht(0,0),_Y=[],xY=[],bY=[],wY=[],CY=[],PY=[],MY=[],TY=[],SY=[],IY=[],EY=[],OY=[],RY=[],DY=[],kY={POSITION:"POSITION",NORMAL:"NORMAL",TEXCOORD_0:"TEXCOORD_0",TEXCOORD_1:"TEXCOORD_1",COLOR_0:"COLOR_0",TANGENT:"TANGENT",_BATCHID:"_BATCHID"},LY=[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],FY=function(t){const e=2*Math.PI/t,n=[],i=[];for(let o=0;o<=t;o++){const t=1*Math.cos(e*o),i=1*Math.sin(e*o),r=0;n[3*o]=t,n[3*o+1]=i,n[3*o+2]=r}for(let o=t;o<=200;o++){const t=1*Math.cos(e*o),i=1*Math.sin(e*o);n[3*o]=0,n[3*o+1]=t,n[3*o+2]=i}for(let o=200;o<=300;o++){const t=1*Math.cos(e*o),i=1*Math.sin(e*o),r=0;n[3*o]=t,n[3*o+1]=r,n[3*o+2]=i}const r=n.length/3-1;for(let o=0;o<r;o++)99!==o&&199!==o&&(i[2*o]=o,i[2*o+1]=o+1);return n.push(0,0,0),n.push(1,0,0),n.push(0,1,0),n.push(0,0,1),i.push(r+1,r+2),i.push(r+1,r+3),i.push(r+1,r+4),{vertices:n,indices:i}}(100),NY=[0,0,0,1],zY=[1,1,1];let BY=class{constructor(t,e){this.h=e,this.u=e.getRenderer().canvas,this.pickingFBO=e.getRenderer().pickingFBO,this.m=t,this.p=new j_(t),this.v={},this.T={},this._={},this.M={},this.O={},this.A={},this.I=new Y_,this.S=new Y_,this.C=new Y_,this.N=new Y_,this.k=new V_(t.texture(2)),this.R=(...t)=>this.L.call(this,...t),this.P=new vw(this.m,this.B(),this.k);const n=this.getMap();this.U=n.altitudeToPoint(100,n.getGLRes())/100}getI3DMMeshes(){return this.M}getPNTSMeshes(){return this._}getB3DMMeshes(){return this.T}getPaintedMeshes(){return this.D}getMap(){return this.h.getMap()}paint(t,e,n,i){const r=i&&i.renderTarget,o=i&&i.sceneFilter,s=this.getMap();if(!t.length||!s)return null;const a=this.F(),h=s.projViewMatrix,l=[],u=[],c=[],A=[],f=[];for(let m=0,y=t.length;m<y;m++){const n=t[m].data.node;let r=this.j(n);if(!r)continue;const o=this.h.q(n.H),s=o.debugNodes,a=o.heightOffset||0,d=o.coordOffset||cY;this.O[n.id]&&(r=this.O[n.id],r=nQ(r));let p=o.polygonOffset||rY;qZ(p)&&(p=p()),Array.isArray(r)||(l[0]=r,r=l);for(let l=0,g=r.length;l<g;l++){if(!r[l]||!r[l].isValid||!r[l].isValid())continue;const o=r[l].properties.magic;if(r[l].properties.heightOffset===a&&r[l].properties.coordOffset[0]===d[0]&&r[l].properties.coordOffset[1]===d[1]||(this.G(r[l]),r[l].V=Fp([],r[l].localTransform)),r[l].J=n,"b3dm"===o){if(r[l].getBoundingBox&&!jq(h,r[l].getBoundingBox()))continue;const{batchIdData:t,batchIdMap:e}=r[l].geometry.properties;if(t&&e){const t=r[l].properties.node.H;this.$&&this.$[t]?VI.highlightMesh(this.m,r[l],this.$[t],this.K,e):this.$&&this.$[t]||VI.highlightMesh(this.m,r[l],null,this.K,e),VI.showOnly(this.m,r[l],this.X&&this.X[t],this.Y,e)}if(s&&s.length&&s.indexOf(r[l].J.id)<0)continue;i&&i.bloom&&r[l].properties.hlBloomMesh&&(r[l].properties.hlBloomMesh.properties.depthFunc="always",r[l].properties.hlBloomMesh.properties.polygonOffset=p,c.push(r[l].properties.hlBloomMesh)),c.push(r[l])}else"pnts"===o?A.push(r[l]):"i3dm"===o&&f.push(r[l]);r[l].properties.isLeaf=!!e[n.id],r[l].properties.selectionDepth=255-t[m].selectionDepth,r[l].properties.polygonOffset=p,e[n.id]||u.push(r[l]),this.Z(r[l]),this.W(r[l],n)}}let d=0;const p=this.P.getExcludeFilter();$T.setIncludeUniformValues(a,i),d+=this.tt(this.et,a,[o,fY,p],r,u,c,f),d+=this.tt(this.nt,a,[o,dY,p],r,u,c,f),this.P.forEachShader(((t,e,n)=>{const i=this.F(n);d+=this.tt(t,i,[o,e],r,u,c,f)})),this.S.setMeshes(A);const g=this.rt();return d+=this.p.render(this.it,g,this.S,r&&r.fbo),this.D={pntsMeshes:A,i3dmMeshes:f,b3dmMeshes:c},this.N.setMeshes(n),this.p.render(this.st,a,this.N,r&&r.fbo),d}prepareRender(t){this.ot(t)}ot(t){t&&t.states&&t.states.includesChanged&&(this.nt.dispose(),delete this.nt,this.et.dispose(),delete this.et),this.ct(t)}tt(t,e,n,i,r,o,s){t.filter=n.filter((t=>!!t)),e.stencilEnable=!1;const a=i&&i.fbo;let h=0;const l=[];for(let u=0;u<o.length;u++){const{isLeaf:n,selectionDepth:i}=o[u].properties;n&&255===i?(e.stencilEnable&&(this.ht(a),this.I.setMeshes(l),h+=this.p.render(t,e,this.I,a),l.length=0,e.stencilEnable=!1),l.push(o[u])):(e.stencilEnable||(this.I.setMeshes(l),h+=this.p.render(t,e,this.I,a),l.length=0,e.stencilEnable=!0),l.push(o[u])),u===o.length-1&&(e.stencilEnable&&this.ht(a),this.I.setMeshes(l),h+=this.p.render(t,e,this.I,a))}return this.I.setMeshes(o.filter((t=>t.properties.isLeaf))),this.C.setMeshes(s),h+=this.p.render(t,e,this.C,i&&i.fbo),h}ht(t){this.m.clear({stencil:255,framebuffer:t})}getCurrentB3DMMeshes(){return this.I.getMeshes()}getCurrentI3DMMeshes(){return this.C.getMeshes()}lt(t,e){return e.J.ut-t.J.ut}deleteTile(t){const e=t.node;e.ft&&(e.ft.geometry.dispose(),e.ft.dispose(),delete e.ft),this.dt(e.id)}dt(t){const e=this.T[t]||this._[t]||this.M[t]||this.O[t]||this.v[t];this.O[t]?this.gt(t):e&&(this.bt(e),delete this.T[t],delete this._[t],delete this.M[t],delete this.v[t])}gt(t){let e=this.O[t];e=nQ(e);for(let n=0;n<e.length;n++){const{id:t}=e[n].properties;this.dt(t)}delete this.O[t]}bt(t){if(Array.isArray(t))for(let e=0,n=t.length;e<n;e++)this.bt(t[e]);else{VI.showOnly(this.m,t),VI.highlightMesh(this.m,t);const e=t.geometry.properties.url;if(e){const n=this.A[e];n&&n.refMeshes&&(n.refMeshes.delete(t.uuid),n.refMeshes.size||(n.geometry.dispose(),n.material.dispose(),delete this.A[e]))}else t.geometry.dispose(),t.material&&t.material.dispose();t.dispose()}}remove(){const t=this.h;eY(t.getRenderer().canvas,t.getMap());for(const e in this.O)this.gt(e);this.O={};for(const e in this.T)this.dt(e);this.T={};for(const e in this._)this.dt(e);this._={};for(const e in this.M)this.dt(e);this.M={};for(const e in this.v)this.dt(e);this.v={},this.et&&(this.et.dispose(),delete this.et),this.nt&&(this.nt.dispose(),delete this.nt),this.it&&(this.it.dispose(),delete this.it),this.st&&(this.st.dispose(),delete this.st),this.P.dispose(),this.picking&&this.picking.dispose()}j(t){return this.T[t.id]||this._[t.id]||this.M[t.id]||this.O[t.id]}has(t){return this.j(t)||this.v[t.id]}G(t){const e=t.properties.magic;"b3dm"===e?this.yt(t):"i3dm"===e?this.wt(t):"pnts"===e&&this.vt(t)}createPntsMesh(t,e,n,i){if(this._[e]){const t=this._[e];return console.warn(`pnts mesh with id(${e}) was already created.`),i(null,{id:e,mesh:t}),t}const{pnts:r,featureTable:o,rootIdx:s,compressed_int16_params:a}=t,h=o.POINTS_LENGTH;r.BATCH_ID||(r.BATCH_ID=new Uint8Array(h),r.BATCH_ID.fill(0));const l=new Jv(r,null,h,{static:!0,primitive:"points",positionAttribute:"POSITION",pickingIdAttribute:"BATCH_ID"});l.generateBuffers(this.m);const u={};r.POSITION?u.HAS_POSITION=1:r.POSITION_QUANTIZED&&(u.HAS_POSITION_QUANTIZED=1),r.RGB?u.HAS_RGB=1:r.RGBA?u.HAS_RGBA=1:r.RGB565&&(u.HAS_RGB565=1),(r.NORMAL||r.NORMAL_OCT16P)&&(u.HAS_NORMAL=1,r.NORMAL_OCT16P&&(u.HAS_NORMAL_OCT16P=1)),this.Tt(u,a),t.featureTable.CONSTANT_RGBA&&(t.featureTable.CONSTANT_RGBA=t.featureTable.CONSTANT_RGBA.map((t=>t/255)));const{rtcCenter:c,rtcCoord:A,projCenter:f}=t,d=this.h.q(s),p=new z_(l);p.properties.magic="pnts",p.properties.id=e,p.properties.node=n,p.properties.count=h,p.properties.batchTable=t.batchTable,p.properties.batchTableBin=t.batchTableBin,p.properties.serviceIndex=s,p.properties.rtcCoord=A,p.properties.rtcCenter=c,p.properties.projCenter=f,p.setDefines(u),p.setFunctionUniform("pointColor",(function(){return t.featureTable.CONSTANT_RGBA?t.featureTable.CONSTANT_RGBA:d&&d.pointColor||[1,1,1,1]}));const g=this.getMap();let m=null,y=null;p.setFunctionUniform("pointSize",(function(){if(!d)return 2;if(UX(d.pointSize)){const t=JSON.stringify(d.pointSize);return t!==m&&(y=GX(d.pointSize),m=t),y(g.getZoom())}return d.pointSize||2}));let v=null,_=null;return p.setFunctionUniform("pointOpacity",(function(){if(!d)return 1;if(UX(d.pointOpacity)){const t=JSON.stringify(d.pointOpacity);return t!==v&&(_=GX(d.pointOpacity),v=t),_(g.getZoom())}return d.pointOpacity||1})),this._t(p,a),this.vt(p),p.V=Fp([],p.localTransform),this._[e]=p,i(null,{id:e,mesh:[p]}),[p]}vt(t){const e=t.localTransform||[],{rtcCoord:n,node:i,projCenter:r}=t.properties;this.Mt(e,n,r,i.H),t.setLocalTransform(e)}createI3DMMesh(t,e,n,i){if(this.M[e]){const t=this.M[e];return console.warn(`i3dm mesh with id(${e}) was already created.`),this.v[e]||i(null,{id:e,mesh:t}),t}const r=this.h.q(n.H),o=this.Ot(n.At),{i3dm:s,featureTable:a,gltf:h,batchTable:l,batchTableBin:u,count:c}=t,A=a.INSTANCES_LENGTH,{rtcCenter:f,rtcCoord:d,projCenter:p}=t,g=this.xt(wY,n,f,d);pX(g,uY,g);const m=$p(CY,g);Qm(m,m);const y=Kp(PY,g),v=Qp(MY,y),_=this.It(TY,p,n),x=this.St(EY),b=this.Et(OY,d),w=Lg(RY,b,x),C=Qp(DY,w),{POSITION:P,NORMAL_UP:M,NORMAL_RIGHT:T,SCALE:S,SCALE_NON_UNIFORM:I}=s,E={instance_vectorA:new Float32Array(4*A),instance_vectorB:new Float32Array(4*A),instance_vectorC:new Float32Array(4*A),aPickingId:new Uint16Array(A)};for(let q=0;q<A;q++)E.aPickingId[q]=q;const O=new Float32Array(3),R=new Float32Array(3),D=[],k=new Float32Array(1),L=new Float32Array(3),F=[],N=[],z=[],B=[];!function(t,e){let{byteOffset:n,byteStride:i,count:r}=t;const{componentType:o,itemSize:s}=t,a=t.array.buffer,h=o?tp.getTypedArrayCtor(o):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,i=i||0,r=r||t.array.length/s,(!i||i===s*h.BYTES_PER_ELEMENT)&&n%h.BYTES_PER_ELEMENT==0){const t=new h(a,n,r*s);for(let i=0;i<r*s;i+=s)e(new h(t.buffer,n+i*h.BYTES_PER_ELEMENT,s),i/s);return}const l=new Uint8Array(s*h.BYTES_PER_ELEMENT);i||(i=s*h.BYTES_PER_ELEMENT);for(let u=0;u<r;u++){const t=new Uint8Array(a,i*u+n,s*h.BYTES_PER_ELEMENT);l.set(t),e(new h(l.buffer),u),t.set(l)}}(P,((t,e)=>{M?(CQ(R,T,e),CQ(O,M,e),Tg(D,R,O),Pg(D,D),eQ(F,R,0),eQ(F,O,1),eQ(F,D,2),Tm(N,F),Qm(N,N),_m(N,m,N)):ym(N),S?(CQ(k,S,e),pg(z,k[0],k[0],k[0])):I?(CQ(L,I,e),pg(z,...L)):pg(z,1,1,1),tg(B,N,t,z),PQ(E.instance_vectorA,e,B,0),PQ(E.instance_vectorB,e,B,1),PQ(E.instance_vectorC,e,B,2)}));const H={};for(const q in E)H[q]={buffer:this.m.buffer({dimension:E[q].length/A,data:E[q]}),divisor:1};const j=r.shader||"pbr";let U=0,G=!0;const V=[],W=[];return gQ(h,((t,i,r,s)=>{const h=this.Ct(t,i,r,s,n,!0,j,W),{geometry:m,material:y}=h;y&&!y.isReady()&&(G=!1,U++);const x=new B_(H,A,m,y);h.refMeshes||(h.refMeshes=new Set,h.refMeshes.add(x.uuid)),x.properties.magic="i3dm",x.properties.id=e,x.properties.count=c,x.properties.batchTable=l,x.properties.batchTableBin=u,x.properties.serviceIndex=n.H,x.properties.rtcCoord=d,x.properties.rtcCenter=f,x.properties.projCenter=p,x.properties.node=n;const b=this.Nt(t,m,y,n.H,s);t.compressed_int16_params&&this._t(x,t.compressed_int16_params),this.kt(x,t.attributes);const w=Np([]);if(t.matrices&&t.matrices.length)for(let e=0;e<t.matrices.length;e++)Hp(w,w,t.matrices[e]);Hp(w,o,w),Hp(w,C,w),Hp(w,a.EAST_NORTH_UP||M?v:g,w),x.setPositionMatrix(w),this.wt(x,_),x.setDefines(b),x.properties.polygonOffset={offset:0,factor:0},V.push(x),delete t.attributes,x.V=Fp([],x.localTransform)})),HY(W),G?(this.M[e]=V,i(null,{id:e,mesh:V})):(this.v[e]={meshes:V,count:U},V.Rt=i),V}wt(t,e){const{rtcCoord:n,node:i,projCenter:r}=t.properties;e||(e=this.It(TY,r,i));const o=this.h.q(i.H),s=t.localTransform||[];o.coordOffset?Hp(s,this.Lt(wY,i.H,n),e):Fp(s,e),t.setLocalTransform(s),t.properties.heightOffset=o.heightOffset||0,t.properties.coordOffset=o.coordOffset&&o.coordOffset.slice(0)||cY}It(t,e,n){Qp(t,this.St(EY));const i=this.Pt(xY,e,n.H);return Hp(t,Zp(SY,i),t),t}createB3DMMesh(t,e,n,i){if(t.gltf&&(t.gltf.transferables=null),this.T[e]||this.v[e]){const t=this.T[e];return console.warn(`mesh with id(${e}) was already created.`),this.v[e]||i(null,{id:e,mesh:t}),t}let r;if(n.maxExtent){const t=new fs(n.maxExtent).convertTo((t=>this._pointToPrj(t)));r=[t.xmin,t.ymin,t.xmax,t.ymax]}const o=t.gltf,{projCenter:s}=o.extensions.MAPTALKS_RTC,{rtcCoord:a,center:h}=o.extensions.CESIUM_RTC,l=o.asset.sharePosition,u=this.Ot(n.At),c=this.Bt(TY,l,a,h,s,n),A=this.h.q(n.H);let f=A.shader||"pbr";if(A.unlit)f="phong";else if(o.materials)for(let y=0;y<o.materials.length;y++)if(o.materials[y]&&o.materials[y].extensions&&o.materials[y].extensions.KHR_materials_unlit){f="phong";break}const d=[],p=[];let g=0,m=!0;return gQ(o,((i,o,y,v)=>{const _=this.Ct(i,o,y,v,n,!1,f,d),{geometry:x,material:b}=_;b&&!b.isReady()&&(m=!1,g++);const w=new z_(x,b);_.refMeshes||(_.refMeshes=new Set,_.refMeshes.add(w.uuid)),w.properties.magic="b3dm",w.properties.id=e,w.properties.node=n,t.batchTable&&(w.properties.batchTable=t.batchTable,w.properties.batchTableBin=t.batchTableBin),w.properties.count=t.featureTable&&t.featureTable.BATCH_LENGTH||0,w.properties.serviceIndex=n.H;const C=this.Nt(i,x,b,n.H,v);w.setDefines(C);const P=i.compressUniforms;if(P)for(const t in P)w.setUniform(t,P[t]);i.compressed_int16_params&&this._t(w,i.compressed_int16_params),this.kt(w,i.attributes),r&&(C.USE_MAX_EXTENT=1,w.setUniform("maxPrjExtent",r)),w.hasFunctionUniform("polygonOpacity")||w.setFunctionUniform("polygonOpacity",(function(){return QZ(A.opacity)?A.opacity:1})),w.hasFunctionUniform("polygonFill")||w.setFunctionUniform("polygonFill",(function(){return hQ([],A.polygonFill||oY)})),w.material.hasFunctionUniform("hsv")||w.material.setFunctionUniform("hsv",(function(){return A.hsv||sY}));const M=Np([]);if(l&&i.matrices&&i.matrices.length)for(let t=0;t<i.matrices.length;t++)Hp(M,M,i.matrices[t]);l&&Hp(M,u,M),w.properties.node=n,w.properties.projCenter=s,w.properties.nodeMatrix=M,w.properties.isSharedPosition=l,w.properties.rtcCoord=a,w.properties.rtcCenter=h,this.yt(w,c),p.push(w),delete i.attributes,w.V=Fp([],w.localTransform)})),HY(d),m?(this.T[e]=p,i(null,{id:e,mesh:p})):(this.v[e]={meshes:p,count:g},p.Rt=i),p}Ut(t){const e=this.h.Dt(t.id);if(!e||t.ft)return;let n,i,r,o;if(e.obbox)n=e.boxPosition,i=LY,r=e.boxCenter,o=zY;else if(e.sphereBox){const t=e.sphereBox[1];n=FY.vertices,i=FY.indices,r=e.sphereBox[0],o=[t,t,t]}const s=new Jv({POSITION:n},i,0,{primitive:"lines",positionAttribute:"POSITION"}),a=new z_(s,new T_({lineColor:[.8,.8,.1,1],lineOpacity:1})),h=[];tg(h,NY,r,o),a.localTransform=h,a.V=Fp([],h),a.properties.node=t,t.ft=a}Ft(t){t.ft&&(t.ft.geometry.dispose(),t.ft.dispose(),delete t.ft)}_t(t,e){e.POSITION&&t.setUniform("compressedPositionRange",e.POSITION),e.TEXCOORD_0&&t.setUniform("compressedTexcoordRange_0",e.TEXCOORD_0),e.TEXCOORD_1&&t.setUniform("compressedTexcoordRange_1",e.TEXCOORD_0),e.NORMAL&&t.setUniform("compressedNormalRange",e.NORMAL),e.TANGENT&&t.setUniform("compressedTangentRange",e.TANGENT),e.compressed_ratio&&t.setUniform("compressed_ratio",e.compressed_ratio)}yt(t,e){const{isSharedPosition:n,rtcCoord:i,rtcCenter:r,projCenter:o,nodeMatrix:s,node:a}=t.properties;e||(e=this.Bt(e||TY,n,i,r,o,a));const h=t.localTransform||Np([]);Hp(h,e,s);const l=this.h.q(a.H);l.coordOffset&&Hp(h,this.Lt(wY,a.H,i),h),t.setLocalTransform(h),t.properties.heightOffset=l.heightOffset||0,t.properties.coordOffset=l.coordOffset&&l.coordOffset.slice(0)||cY}Bt(t,e,n,i,r,o){if(e){const e=this.Et(OY,n),r=Qp(bY,e);Hp(t,this.xt(wY,o,i,n),r)}else this.Mt(t,n,r,o.H);return t}kt(t,e){e&&e.TEXCOORD_0&&e.TEXCOORD_0.extensions&&e.TEXCOORD_0.extensions.WEB3D_quantized_attributes&&t.setUniform("decodeMatrix",e.TEXCOORD_0.extensions.WEB3D_quantized_attributes.decodeMatrix)}xt(t,e,n,i){const r=this.getMap(),o=this.h.q(e.H).heightOffset||0,s=e.matrix?Fp(t,e.matrix):Np(t);n&&pX(s,Sg(pY,n,s),s);const a=function(t,e,n,i,r,o,s){e=dg(mX,e);const a=EQ(mX,e[0]*MX,e[1]*MX,e[2]),h=Jp(yX,n),l=i.ellipsoid;let u;u=0===zg(h)?pg(vX,0,0,-6378137):FQ(vX,h),CX.x=u[0],CX.y=u[1];const c=i.project(CX,PX);_X[0]=c.x/r,_X[1]=c.y/r,_X[2]=(u[2]+s)*o;const A=gX(a,l,xX);return pX(function(t,e,n){const i=t[0],r=t[1],o=t[2],s=t[4],a=t[5],h=t[6],l=t[8],u=t[9],c=t[10],A=e[0],f=e[1],d=e[2],p=e[3],g=e[4],m=e[5],y=e[6],v=e[7],_=e[8],x=r*A+a*f+u*d,b=o*A+h*f+c*d,w=i*p+s*g+l*m,C=r*p+a*g+u*m,P=o*p+h*g+c*m,M=i*y+s*v+l*_,T=r*y+a*v+u*_,S=o*y+h*v+c*_;return n[0]=i*A+s*f+l*d,n[1]=x,n[2]=b,n[3]=0,n[4]=w,n[5]=C,n[6]=P,n[7]=0,n[8]=M,n[9]=T,n[10]=S,n[11]=0,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}(Bp(bX,A),Mp(wX,n),t),_X,t),t}(s,i,s,r.getProjection(),r.getGLRes(),this.U,o),h=(pg(l=xY,(u=a)[12],u[13],u[14]),l);var l,u;let c=this.h.options.offset;if(qZ(c)){const t=this.h.Dt(e.id).boxCoord;c=c.call(this.h,t)}return pg(_Y,c[0],c[1],0),Dg(h,h,_Y),pX(a,h,a),a}Lt(t,e,n){const i=this.h.q(e);if(!i.coordOffset)return null;const r=this.getMap(),o=r.getGLRes();gY.set(n[0],n[1]);const s=r.coordToPointAtRes(gY,o,yY),a=i.coordOffset,h=gY.set(n[0]+a[0],n[1]+a[1]),l=r.coordToPointAtRes(h,o,vY);return Zp(t,pg(_Y,l.x-s.x,l.y-s.y,(a[2]||0)*this.U))}createCMPTMesh(t,e,n,i){if(this.O[e]){const t=this.O[e];return console.warn(`mesh with id(${e}) was already created.`),i(null,{id:e,mesh:t}),t}const{content:r}=t,o=[];for(let s=0;s<r.length;s++){const{magic:t}=r[s],i=e+"."+s;"b3dm"===t?this.createB3DMMesh(r[s],i,n,((t,{mesh:e})=>{o.push(e)})):"i3dm"===t?this.createI3DMMesh(r[s],i,n,((t,{mesh:e})=>{o.push(e)})):"pnts"===t?this.createPntsMesh(r[s],i,n,((t,{mesh:e})=>{o.push(e)})):"cmpt"===t&&this.createCMPTMesh(r[s],i,n,((t,{mesh:e})=>{o.push(e)}))}return this.O[e]=o,i(null,{id:e,mesh:o}),o}Nt(t,e,n,i,r){const o=("phong"===(this.h.q(i).shader||"pbr")?this.et:this.nt).getGeometryDefines(e);return r.asset&&"S3M"===r.asset.generator&&this.jt(o,e),e.data.uvRegion&&(o.HAS_I3S_UVREGION=1),e.data[e.desc.normalAttribute]&&(o.VertexNormal=1),e.data[e.desc.color0Attribute]&&(o.VertexColor=1),e.data[e.desc.uv0Attribute]&&(o.TexCoord=1),e.data[e.desc.textureCoordMatrixAttribute]&&(o.HAS_TextureCoordMatrix=1),n.get("uTexture")&&(o.COMPUTE_TEXCOORD=1),n.get("uTexture2")&&(o.TexCoord2=1),"MESHOPT"===this.h.zt&&(o.MeshOPT_Compress=1),this.hasIBL()&&(o.HAS_IBL_LIGHTING=1),t.attributes&&t.attributes.TEXCOORD_0&&"WEB3D_quantized_attributes"===t.attributes.TEXCOORD_0.extensions&&(o.HAS_WEB3D_quantized_attributes_TEXCOORD=1),o.HAS_MIN_ALTITUDE=1,o.HAS_LAYER_OPACITY=1,this.Tt(o,t.compressed_int16_params),WZ(o,t.compressDefines),o}Tt(t,e){e&&Object.keys(e).length>0&&(t.HAS_COMPRESSED_INT16=1,e.POSITION&&(t.HAS_COMPRESSED_INT16_POSITION=1),e.TEXCOORD_0&&(t.HAS_COMPRESSED_INT16_TEXCOORD_0=1),e.TEXCOORD_1&&(t.HAS_COMPRESSED_INT16_TEXCOORD_1=1),e.NORMAL&&(t.HAS_COMPRESSED_INT16_NORMAL=1),e.TANGENT&&(t.HAS_COMPRESSED_INT16_TANGENT=1),e.compressed_ratio&&(t.HAS_COMPRESSED_INT16_RATIO=1))}Z(t){const e=this.h.getRenderer();e&&e.updateMaskDefines(t)}jt(t,e){e.data.aNormal&&(t.VertexNormal=1),e.data.instanceId&&(t.Instance=1),e.data.aTexCoord0&&(t.TexCoord=1),e.data.aColor&&(t.VertexColor=1),e.data.aTexCoord1&&(t.TexCoord2=1),e.data.uv2&&(t.InstanceBim=1)}Ct(t,e,n,i,r,o,s,a){let h=!1;i.asset&&"S3M"===i.asset.generator&&(h=!0,i.extensions=i.extensions||{});const l=i.url+"-"+e+"-"+n;if(this.A[l])return this.A[l];let u,c;a.push(t);const A=i.materials&&i.materials[t.material],f=i.extensions&&i.extensions.KHR_techniques_webgl,d=this.h.q(r.H);if(f&&A.extensions&&A.extensions.KHR_techniques_webgl){const e=this.qt(t,i,o,h);u=e.material,c=e.geometry,d.fillEmptyDataInMissingAttribute&&(c.desc.fillEmptyDataInMissingAttribute=!0)}else c=this.Ht(t,o,kY),u=this.Gt(t.material,i,s,d.material||aY,a,d);u&&(u.setFunctionUniform("alphaTest",(function(){const t=d.alphaTest;return VZ(t)?.1:t})),u.setFunctionUniform("environmentExposure",(()=>{const t=d.ambientLight;let e=d.environmentExposure;const n=this.getMap().getLightManager(),i=n&&n.getAmbientLight();return!t||i&&!i.color||void 0!==e||(e=t[0]/(i&&i.color?i.color[0]:.2)),e||1}))),u&&!u.isReady()?u.Vt=r.id:u||(u=new E_({baseColorFactor:[1,1,1,1]}));const p={geometry:c,material:u};return c.properties.url=l,this.A[l]=p,p}qt(t,e,n,i){const{geometry:r,material:o}=this.P.createMesh(t,e,n,i);return{geometry:r,material:o}}Ht(t,e,n){const i=t.attributes,r="COLOR_0";let o=i._BATCHID&&i._BATCHID.array;if(o&&o.byteOffset&&(o=new o.constructor(o)),i[r]){const t=i[r].array||i[r];if(t instanceof Float32Array){const e=new Uint8Array(t.length);for(let n=0;n<e.length;n++)e[n]=Math.round(255*t[n]);i[r].array?(i[r].array=e,i[r].componentType=5121):i[r]=e}}const s={};for(const l in i){const t=JX(this.m,i[l],{dimension:i[l].itemSize}),e=n[l]||l;s[e]={buffer:t},i[l].quantization&&(s[e].quantization=i[l].quantization),e===n.POSITION&&(s[e].array=i[l].array,s[e].min=i[l].min,s[e].max=i[l].max)}const a=t.indices?t.indices.array?t.indices.array.slice():t.indices:null,h=new Jv(s,a,0,{positionAttribute:n.POSITION,normalAttribute:n.NORMAL,uv0Attribute:n.TEXCOORD_0,uv1Attribute:n.TEXCOORD_1,color0Attribute:n.COLOR_0,tangentAttribute:n.TANGENT,pickingIdAttribute:n._BATCHID,primitive:void 0===t.mode?"triangles":YX(t.mode)});return o&&a&&(h.properties.batchIdData=o,h.properties.batchIdMap=function(t,e){if(!e)return null;const n=new Map;for(let i=0;i<e.length;i++){const r=e[i],o=t[r];let s=n.get(o);s||(s=[],n.set(o,s)),s.push(r)}return n}(o,a)),h.generateBuffers(this.m,{excludeElementsInVAO:e}),h}Mt(t,e,n,i){const r=Np(t),o=this.St(hY);return this.Pt(xY,n,i),jp(r,r,xY),Up(r,r,o),r}Pt(t,e,n){const i=this.U;gY.x=e[0],gY.y=e[1];const r=this._prjToPoint(gY);let o=this.h.options.offset;qZ(o)&&(o=o.call(this.h,gY));const s=this.h.q(n).heightOffset||0;return pg(t,r.x-o[0],r.y-o[1],i*e[2]+i*s),t}W(t,e){const n=this.h.Jt(IY,e);t.localTransform=Hp(t.localTransform,n,t.V)}Et(t,e){const n=this.getMap();gY.x=e[0],gY.y=e[1];const i=n.distanceToPointAtRes(100,100,n.getGLRes(),gY);return pg(t,i.x/100,i.y/100,this.U),t}ct(t){if(this.nt)return;const e=[],n=[];this.it=new mx({vert:MQ,frag:"#define SHADER_NAME PNTS\n\nprecision mediump float;\n\n\n\nvarying vec4 vColor;\n\n\n\nvoid main() {\n\n    vec2 circCoord = 2.0 * gl_PointCoord - 1.0;\n\n    if (dot(circCoord, circCoord) > 1.0) {\n\n        discard;\n\n    } else {\n\n        gl_FragColor = vColor;\n\n    }\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp(n,e.projViewMatrix,e.modelMatrix)},{name:"modelNormalMatrix",type:"function",fn:(t,n)=>Mp(e,n.modelMatrix)}],extraCommandProps:{viewport:{x:0,y:0,width:()=>this.u?this.u.width:1,height:()=>this.u?this.u.height:1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:[0,1],func:"<"}}});const i={},r=[];$T.fillIncludes(i,r,t);const o=this.B();this.et=new yx({uniforms:r,defines:i,extraCommandProps:o}),this.nt=new Xw.StandardShader({uniforms:r,defines:i,extraCommandProps:o}),this.st=new Bx({extraCommandProps:{viewport:{x:0,y:0,width:()=>this.u?this.u.width:1,height:()=>this.u?this.u.height:1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}});const s=this.h;tY(s.getRenderer().canvas,this.m,s.getMap()),this.picking=new cw(this.p,{vert:this.nt.vert,extraCommandProps:o,uniforms:this.nt.uniforms,defines:{PICKING_MODE:1,ENABLE_PICKING:1,HAS_PICKING_ID:1}},this.pickingFBO,this.getMap()),this.$t=new cw(this.p,{vert:MQ,extraCommandProps:o,uniforms:this.it.uniforms,defines:{PICKING_MODE:1,ENABLE_PICKING:1,HAS_PICKING_ID:1}},this.pickingFBO,this.getMap())}B(){return{viewport:{x:0,y:0,width:()=>this.u?this.u.width:1,height:()=>this.u?this.u.height:1},cull:{enable:!0},stencil:{enable:(t,e)=>e.stencilEnable,func:{cmp:">=",ref:(t,e)=>e.meshProperties.selectionDepth},opFront:{fail:"keep",zfail:"keep",zpass:"replace"},opBack:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:[0,1],func:(t,e)=>e.meshProperties.depthFunc||"<"},blend:{enable:!0,func:{src:1,dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:(t,e)=>e.meshProperties.polygonOffset}}}rt(t){const e=this.getMap(),n=e.getLightManager(),i=(n&&n.getDirectionalLight()||{}).direction||[1,1,-1];return{projViewMatrix:e.projViewMatrix,pointOpacity:t&&t.pointOpacity||1,lightDir:Pg(AY,i)}}F(){const t=this.getMap(),e=this.h,n=e.getRenderer().canvas,{iblTexes:i,dfgLUT:r}=nY(n),o=iY(t,i,r),s=this.h.getRenderer(),a=s.getMaskUniforms();return o.minAltitude=e.options.altitude||0,o.layerOpacity=s.canvas.gl&&s.canvas.gl.wrap?e.options.opacity||0:1,WZ(o,{czm_lightDirectionEC:o.light0_viewDirection,lightSpecular:[1,1,1],viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,outSize:[n.width,n.height],polygonFill:[1,1,1,1],polygonOpacity:1}),WZ(o,a),o}Gt(t,e,n,i,r,o){const s=e.materials&&e.materials[t];if(!s||!s.baseColorTexture&&!s.pbrMetallicRoughness)return null;const a=WZ({},i);if(s.baseColorTexture){const t=e.textures[s.baseColorTexture.index];let n;t&&!t.image.color&&(n=this.Kt(t,r)),a.baseColorFactor=t&&t.image.color||s.baseColorFactor||[1,1,1,1],n&&(a.baseColorTexture=n)}else{if(s.normalTexture){const t=this.Kt(e.textures[s.normalTexture.index],r);if(t){const e=s.normalTexture.scale||1;a.normalTexture=t,a.normalMapFactor=e}}if(s.occlusionTexture){const t=this.Kt(e.textures[s.occlusionTexture.index],r);if(t){const e=s.occlusionTexture.strength||1;a.occlusionTexture=t,a.occlusionFactor=e}}if(s.emissiveTexture){const t=this.Kt(e.textures[s.emissiveTexture.index],r);t&&(a.emissiveTexture=t)}s.emissiveFactor&&(a.emissiveFactor=s.emissiveFactor);const t=s.pbrMetallicRoughness;if(t){if(t.baseColorFactor&&(a.baseColorFactor=t.baseColorFactor),t.baseColorTexture&&void 0!==t.baseColorTexture.index){const n=e.textures[t.baseColorTexture.index];if(n&&n.image&&n.image.color)a.baseColorFactor=a.baseColorFactor?Xg(a.baseColorFactor,a.baseColorFactor,n.image.color):n.image.color;else{const t=this.Kt(n,r);t&&(a.baseColorTexture=t,a.baseColorTexture.getREGLTexture(this.m))}}if(VZ(t.metallicFactor)||(a.metallicFactor=t.metallicFactor),VZ(t.roughnessFactor)||(a.roughnessFactor=t.roughnessFactor),s.metallicRoughnessTexture){const t=this.Kt(e.textures[s.metallicRoughnessTexture.index],r);t&&(a.metallicRoughnessTexture=t)}}}if(s.s3mMaterial)return new T_(a);if(o.unlit||s.extensions&&s.extensions.KHR_materials_unlit){a.ambientColor=[1,1,1],a.light0_diffuse=[0,0,0,0],a.lightSpecular=[0,0,0];const t=new E_(a);return t.unlit=void 0===o.unlit||!!o.unlit,t}let h=new Xw.StandardMaterial(a);"phong"===n&&(h=E_.convertFrom(h));const l=s.pbrMetallicRoughness,u=l&&l.baseColorTexture&&l.baseColorTexture.extensions;return u&&u.KHR_texture_transform&&(h.set("khr_offset",u.KHR_texture_transform.offset||[0,0]),h.set("khr_rotation",u.KHR_texture_transform.rotation||0),h.set("khr_scale",u.KHR_texture_transform.scale||[1,1])),h.doubleSided=!(!o.doubleSided&&!s.doubleSided),h.once("complete",this.R),h}Kt(t,e){if(!t)return null;const n={type:t.type?QX(t.type):"uint8",format:t.format?XX(t.format):"rgba",flipY:!!t.flipY},i=t.image;if(e.push(i),i.array?n.data=i.array:i.mipmap&&(n.mipmap=i.mipmap),!n.data&&!n.mipmap)return null;if(n.width=i.width,n.height=i.height,n.mipmap&&(n.width<4||n.height<4))return null;const r=t.sampler||t.texture&&t.texture.sampler;return r&&(r.magFilter&&(n.mag=WX(r.magFilter)),r.minFilter&&(n.min=qX(r.minFilter)),r.wrapS&&(n.wrapS=ZX(r.wrapS)),r.wrapT&&(n.wrapT=ZX(r.wrapT))),new sx(n,this.k)}L({target:t}){const e=t.Vt,n=this.v[e];if(n.count--,!n.count){const t=n.meshes;this.T[e]=t,delete this.v[e];const i=t.Rt;delete t.Rt,i(null,{mesh:n.meshes,id:e})}}St(t){const e=1/this.getMap().getGLRes(),n=this.U;return t[0]=t[1]=e,t[2]=n,t}Xt(t){return this.h.Xt(t)}_pointToPrj(t){const e=this.getMap();return e.getGLZoom?e._pointToPrj(t,e.getGLZoom()):e._pointToPrjAtRes(t,e.getGLRes())}_prjToPoint(t){const e=this.getMap();return e.getGLZoom?e._prjToPoint(t,e.getGLZoom()):e._prjToPointAtRes(t,e.getGLRes(),mY)}Ot(t){return"Y"===t?KX:"X"===t?$X:lY}pick(t,e,n=3){const i=this.h;if(!i||!i.options.picking)return[];if(!this.pickingFBO||!this.picking)return[];const r=[],o=this.F(),s=this.Yt(this.picking,o,this.I,t,e,n);s&&r.push(s);const a=this.Yt(this.picking,o,this.C,t,e,n);a&&r.push(a);const h=this.rt(),l=this.Yt(this.$t,h,this.S,t,e,n);return l&&r.push(l),r}Yt(t,e,n,i,r,o){if(!n.getMeshes().length)return null;const s=this.h,a=this.getMap();t.render(n.getMeshes().filter((t=>!t.bloom)),e,!0);let h={};t.getRenderedMeshes().length&&(h=t.pick(i,r,o,e,{viewMatrix:a.viewMatrix,projMatrix:a.projMatrix,returnPoint:s.options.pickingPoint}));const{meshId:l,pickingId:u,point:c,coordinate:A}=h,f=(0===l||l)&&t.getMeshAt(l);if(!f||!f.geometry)return null;const d=f.properties;c&&c.length&&(c[0]=Math.round(1e5*c[0])/1e5,c[1]=Math.round(1e5*c[1])/1e5,c[2]=Math.round(1e5*c[2])/1e5);const p={batchId:u},g=s.options.services,m=g&&g[f.properties.serviceIndex];if(m&&m.debug&&(p.debugInfo=d),d&&d.batchTable){const{batchTable:t,batchTableBin:e,count:n}=d,i=u;for(const r in t)p[r]=void 0!==t[r].byteOffset?$Q(t[r],e,n,i):t[r][i]}return{service:f.properties.serviceIndex,data:p,point:c,coordinate:A}}highlight(t){this.$=t;const e=this.h.getRenderer();this.K=e.getFrameTimestamp(),e.setToRedraw(!0)}cancelAllHighlight(){this.$=null;const t=this.h.getRenderer();this.K=t.getFrameTimestamp(),t.setToRedraw(!0)}showOnly(t){this.X=t;const e=this.h.getRenderer();this.Y=e.getFrameTimestamp(),e.setToRedraw(!0)}cancelShowOnly(){this.X=null;const t=this.h.getRenderer();this.Y=t.getFrameTimestamp(),t.setToRedraw(!0)}Zt(){if(!this.D)return[];const t={},e=[];for(const n in this.D){const i=this.D[n];if(i)for(let n=0;n<i.length;n++){const r=i[n],o=r&&r.geometry;if(!r||!o)continue;const s=r.properties.serviceIndex;t[s]||(t[s]=new Set);const a=o.properties.batchIdData;if(a)for(let n=0;n<a.length;n++)t[s].has(a[n])||(e.push({id:a[n],service:s}),t[s].add(a[n]))}}return e}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}};function HY(t){for(let e=0;e<t.length;e++)t[e]&&(t[e].array&&(t[e].array=null),t[e].mipmap&&(t[e].mipmap=null),t[e].indices&&(t[e].indices=null))}const jY=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")},UY=jY(),GY=UY.gl_trans__coders=UY.gl_trans__coders||{};function VY(t,e){if(e)for(let n=0;n<e.length;n++)t[e[n].id||e[n].index]=e[n]}GY.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,i=e.substring(0,n),r=UY.gl_trans__coders=UY.gl_trans__coders||{};let o=`${i}\n    const _____getGlobal = ${jY.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const s in r)"inject"!==s&&"getTranscoder"!==s&&"registerTranscoder"!==s&&(o+='tran_____scoders["'+s+'"] ='+r[s].toString()+"\n;");return o+="\n"+e.substring(i.length),o},GY.registerTranscoder=function(t,e){GY[t]=e},GY.getTranscoder=function(t){return GY[t]};const WY=[];let qY=class{constructor(t,e,n,i,r){this.h=i,this.Wt=t,this.H=e,this.Qt=r,this.te=n.version,t.indexOf("i3s:tileset:")<0?(this.ee=this.te<=1.6?"root":0,n.version=this.te):(this.ee=t.substring(12),this.te>1.6&&(this.ee=parseInt(this.ee))),this.Wt=t,this.ne=n}load(){const t=this.ne,e=t.layerScene.baseUrl;if(this.te<=1.6)return t[this.ee]&&t[this.ee].lodSelection?(this.re=t[this.ee],this.ie()):new Promise((n=>{let i=e+"/nodes/"+this.ee;t.layerScene.eslpk&&(i+="/3dNodeIndexDocument.json"),this.Qt(this.H,i,(()=>{this.re=t[this.ee],n(this.ie())}))}));if(this.te>=1.7){if(t[this.ee])return this.re=t[this.ee],this.ie();const n=Math.floor(this.ee/t.nodesPerPage);return new Promise((i=>{let r=e+"/nodepages/"+n;t.layerScene.eslpk&&(r+=".json"),this.Qt(this.H,r,(()=>{this.re=t[this.ee],i(this.ie())}))}))}return null}getTileset(){return this.se}getChildrenURL(){return this.oe}ie(){const t=this.ne,e=t.layerScene.baseUrl,n=this.re.children,i=[],r={};if(n)for(let o=0;o<n.length;o++)if(this.te<=1.6){const s=n[o].id;if(t[s])continue;const a=s;r[a]||(r[a]=new Promise((n=>{let i=e+"/nodes/"+a;t.layerScene.eslpk&&(i+="/3dNodeIndexDocument.json"),this.Qt(this.H,i,(()=>{n()}))})),i.push(r[a]))}else{const s=n[o];if(t[s])continue;const a=Math.floor(s/t.nodesPerPage);r[a]||(r[a]=new Promise((n=>{let i=e+"/nodepages/"+a;t.layerScene.eslpk&&(i+=".json"),this.Qt(this.H,i,(()=>{n()}))})),i.push(r[a]))}return i.length?Promise.all(i).then((()=>this.ae())):this.ae()}ae(){return Promise.resolve(this.ce())}he(t){VY(this.ne,t)}ce(){return{asset:{i3s:!0,version:"1.0",gltfUpAxis:"Z"},geometricError:Number.MAX_VALUE,root:this.le(this.re,!0)}}le(t){const e=this.h.getRenderer(),n=this.ne.projection,i=!n||n&&4326===n.wkid,r=this.te,o=this.ne,s=t,a=s.obb,h=s.mbs,l={};let u;if(h)u=pg([],h[0],h[1],h[2]),i||(u=e.ue(u,u)),u=ZY([],u[0],u[1],u[2]),l.sphere=[...u,h[3]];else if(a){u=pg([],a.center[0],a.center[1],a.center[2]),i||(u=e.ue(u,u)),u=ZY([],u[0],u[1],u[2]);const t=function(t,e,n){const i=Rp([],n);return i[0]=i[0]*e[0],i[1]=i[1]*e[0],i[2]=i[2]*e[0],i[3]=i[3]*e[1],i[4]=i[4]*e[1],i[5]=i[5]*e[1],i[6]=i[6]*e[2],i[7]=i[7]*e[2],i[8]=i[8]*e[2],[...t,...i]}(u,a.halfSize,a.quaternion);pg(WY,t[3]+t[6]+t[9],t[4]+t[7]+t[10],t[5]+t[8]+t[11]);const n=zg(WY);l.sphere=[...u,n]}let c=1/0,A=0;if(s.mbs?A=s.mbs[3]:s.obb&&(A=Math.max(Math.max(s.obb.halfSize[0],s.obb.halfSize[1]),s.obb.halfSize[2])),void 0!==s.lodThreshold)"maxScreenThresholdSQ"===o.lodSelectionMetricType?c=A/(Math.sqrt(s.lodThreshold)/(.25*Math.PI)):console.error("Unsupported lodSelectionMetricType in Layer");else if(void 0!==s.lodSelection)for(let y=0;y<s.lodSelection.length;y++)"maxScreenThreshold"===s.lodSelection[y].metricType&&(c=A/s.lodSelection[y].maxError);(c===1/0||isNaN(c))&&(c=1e5);const f=16*c,d=Np([]),p=s.children;let g;if(p){g=[];const t=this.ne;for(let e=0;e<p.length;e++){const n=r<=1.6?p[e].id:p[e];if(!t[n]){g=null;break}g.push(this.le(t[n]))}}const m={refine:"REPLACE",boundingVolume:l,transform:d,geometricError:f};return r<=1.6?t.lodSelection?t.geometryData&&(m.content={uri:"i3s:mesh:"+(t.id||t.index)}):m.content={uri:"i3s:tileset:"+(t.id||t.index)}:p&&p.length&&!g?m.content={uri:"i3s:tileset:"+(t.id||t.index)}:s.mesh&&(m.content={uri:"i3s:mesh:"+(t.id||t.index)}),g&&g.length&&(m.children=g),m}getJSON(){return this.re}};function ZY(t,e,n,i){return EQ(t,XZ(e),XZ(n),i)}const QY=!!GY.ktx2,XY=Np([]),YY=(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(uft){}return!1})();function JY(t){return t.indexOf("i3s:mesh")>=0}function KY(t,e,n,i,r){const o=e.layerScene.eslpk,s=function(t,e){const n=e.substring(9);return t>=1.7?parseInt(n):n}(e.version,t),a=e[s],h=e.layerScene.baseUrl,l=[];let u=!1;const c=XY;let A,f;if(e.version<=1.6){if(!a.geometryData)return null;const t=a.geometryData.length;if(!t)return null;let n=h+`/nodes/${a.id}/`+a.geometryData[t-1].href;o&&(n+=".bin");const i={geometry:{url:n,info:e.layerScene.store.defaultGeometrySchema}};let r=a.textureData&&a.textureData[0]&&a.textureData[0].href;if(r){const t=e.layerScene.store.textureEncoding[0];let n;n="image/jpeg"===t?"jpg":"png",o&&(r+="."+n),i.material={pbrMetallicRoughness:{baseColorTexture:{url:h+`/nodes/${a.id}/`+r,factor:1,format:n,mimeType:t},metallicFactor:0}}}l.push(i)}else{A=a.mesh.geometry,f=a.mesh.material;const t=(e.layerScene.store||{}).textureEncoding,s=e.layerScene.geometryDefinitions[A.definition],{geometryBuffers:c}=s;u=i&&2===c.length;let d=h+`/nodes/${A.resource}/geometries/`+(GY.draco&&u?1:0);o&&(d+=".bin");const p={geometry:{url:d,info:GY.draco&&u?c[1]:c[0]}};if(r&&YY&&u&&!GY.draco)throw new Error("Must import @maptalks/transcoder.draco to load i3s draco compressed geometry");const g=e.layerScene.materialDefinitions;let m,y=0;f&&(y=g[f.definition]),m=g?function(t,e,n,i,r,o,s){const a=JSON.parse(JSON.stringify(e));return $Y(t,a,n,i,r,o,s),a}(t,y,e.layerScene.textureSetDefinitions,h,f.resource,n,e.layerScene.eslpk):{pbrMetallicRoughness:{metallicFactor:0}},p.material=m,l.push(p)}return{dracoCompression:u,meshes:l,nodeIndex:s,center:a.obb&&a.obb.center||a.mbs&&[a.mbs[0],a.mbs[1],a.mbs[2]],transform:c}}function $Y(t,e,n,i,r,o,s){for(const a in e)if(e[a]&&e[a].textureSetDefinitionId>=0){const h=n[e[a].textureSetDefinitionId],l="images/"+h.formats[0].format,u=eJ(h.formats,o,t),c={url:i+`/nodes/${r}/textures/${u.name}`,factor:void 0===e[a].factor?1:e[a].factor,format:u.format,mimeType:l};if(s){let t="";switch(u.format){case"dds":t="bin.dds";break;case"jpg":case"png":t=u.format}c.url+="."+t}e[a]=c}else ZZ(e[a])&&$Y(t,e[a],n,i,r,o,s)}const tJ={"image/jpeg":"jpg","image/jpg":"jpg","image/png":"jpg","image/vnd-ms.dds":"dds","image/ktx":"jpg"};function eJ(t,e,n){if(n&&n.length){const e=n[n.length-1],i=tJ[e];if(i){for(let n=0,r=t.length;n<r;n++)if(t[n].format===i)return t[n]}else console.error("i3s not find texture format type from:",tJ,"current textureEncoding:",e)}for(let i=0;i<=t.length;i++){const n=t[i].format;if("dds"===n&&e.hasExtension("WEBGL_compressed_texture_s3tc"))return t[i];if("jpg"===n||"png"===n)return t[i];if("ktx2"===n&&QY)return t[i]}return null}const nJ=new $o(0,0),iJ=new $o(0,0),rJ=new Set,oJ=[],sJ=new class{constructor(t,e){this.max=t,this.currentSize=0,this.data=new Map,this.onRemove=e}reset(t){if(this.data){const e=this.data.keys();for(const n of e){const e=this.data.get(n);t&&t!==e.renderer||this.fe(n,e)}}return t||(this.data=new Map,this.currentSize=0),this}clear(t){this.reset(t)}add(t,e){if(!e)return this;if(e.node&&e.node.memorySize&&(this.currentSize+=e.node.memorySize),this.has(t)){const n=this.data.get(t);n&&n.node&&n.node.memorySize&&(this.currentSize-=n.node.memorySize),this.data.delete(t),this.data.set(t,e)}else this.data.set(t,e);return this}shrink(){if(this.currentSize>this.max){let t=!1;const e=this.data.keys();let n=e.next();for(;this.currentSize>this.max&&void 0!==n.value;){!t&&this.data.get(n.value).current&&(t=!0,console.warn(`current maxGPUMemory(${this.max/1024/1024}) for Geo3DTilesLayer is not enough, one or more current tiles will be discarded.`));const i=this.getAndRemove(n.value);i&&this.onRemove(i),n=e.next()}}}has(t){return this.data.has(t)}keys(){const t=new Array(this.data.size);let e=0;const n=this.data.keys();for(const i of n)t[e++]=i;return t}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return e.node&&e.node.memorySize&&(this.currentSize-=e.node.memorySize),this.data.delete(t),e}get(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),this.data.set(t,e),e}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.fe(t,e),this}fe(t,e){e.node&&e.node.memorySize&&(this.currentSize-=e.node.memorySize),this.data.delete(t),this.onRemove(e)}setMaxSize(t){return this.max=t,this.shrink(),this}getMemorySize(){let t=0;const e=this.data.values();for(const n of e){const e=n&&n.node;e&&e.memorySize&&(t+=e.memorySize)}return t}markAll(t,e){const n=this.data.values();for(const i of n)t&&i.renderer!==t||(i.current=e)}}(1024*(Q.mobile?32:1024)*1024,(t=>{const e=t.renderer;delete t.renderer,e.deleteTile(t)}));let aJ=0,hJ=class extends(dS(Uf.CanvasRenderer)){constructor(t){super(t);const e=1024*t.options.maxGPUMemory*1024;e>sJ.max&&sJ.setMaxSize(e),this.tileCache=sJ,aJ++,this.tilesLoading={},this.de={},this.me=[],this.Qt=(...t)=>this.pe.call(this,...t)}getAnalysisMeshes(){if(!this.painter)return oJ;const t=this.painter.getPaintedMeshes();if(!t)return oJ;const e=[],{b3dmMeshes:n,pntsMeshes:i,i3dmMeshes:r}=t;return n.length&&sQ(e,n.filter((t=>!(!t||!t.geometry)))),i.length&&sQ(e,i.filter((t=>!(!t||!t.geometry)))),r.length&&sQ(e,r.filter((t=>!(!t||!t.geometry)))),e}needToRedraw(){return!!this.getMap().isInteracting()||!!this.me.length||super.needToRedraw()}getFrameTimestamp(){return this.ge}drawOnInteracting(t,e,n){this.draw(e,n)}draw(t,e){this.ge=t;const n=this.prepareCanvas();if(n&&!n.intersects(this.canvasExtent2D))return void this.completeRender();const{root:i,tiles:r}=this.layer.getTiles();if(!r||!r.length)return void this.completeRender();this.painter.prepareRender(e),this.be(),this.ye(e);const{selectedTiles:o,leaves:s,requests:a}=this.we(i,r);a.length&&this.loadTiles(a),this.ve(o,s,e),this.Te(),a.length||this.completeRender()}we(t,e){let n=[];this._e();let i=0;const r=this.Me(),o={};let s=!1,a=!1;for(let u=0;u<e.length;u++){const t=e[u],r=t.node;if(o[r.id])continue;o[r.id]=1;let h=!1;const l=this.getCachedTile(r.id);this.Oe(r.id)?(i++,h=a=!0,this.tilesLoading[r.id].current=!0):l?(this.getTileOpacity(l)<1&&(h=a=!0),s=!0,t.selected=!0,t.data=l):this.painter.has(r)||(h=a=!0,n.push(r)),h&&(this.Ae(t)||this.xe(t).length)&&(s=!0)}let h=[],l={};if(s&&({selectedTiles:h,leaves:l}=this.Ie(t)),n.length>1&&(n.sort(lJ),r)){const t=r-i;n=t>0?n.slice(0,t):[]}return{loading:a,requests:n,selectedTiles:h,leaves:l}}Ie(t){const e=[],n={};let i;const r=[t],o=[];for(;r.length>0||o.length>0;){if(o.length>0){const t=o[o.length-1];if(t.Se===r.length){o.pop(),t===i&&(t.leave=!0,n[t.node.id]=1),e.push(t);continue}}const t=r.pop(),s=t.children;if(t.selected)if("add"===t.node.refine)n[t.node.id]=1,t.selectionDepth=o.length,e.push(t);else{if(t.selectionDepth=o.length,i=t,0===s.length){t.leave=!0,n[t.node.id]=1,e.push(t);continue}o.push(t),t.Se=r.length}for(let e=0;e<s.length;e++)r.push(s[e])}return{selectedTiles:e,leaves:n}}Ae(t){if(!t.parent)return null;let e=t.parent;for(;e&&e.level>=0;){const t=e.node.id;if(this.tileCache.has(t))return e.selected=!0,e.data=this.tileCache.get(t),e;e=e.parent}return null}xe(t){const e=[];if(!t.node.children||!t.node.children.length)return e;const n=t.Ee+1,i=[t.node];for(;i.length>0;){const r=i.pop().children;for(let o=0,s=r.length;o<s;o++){if((!r[o].content||!r[o].content.url)&&r[o].children&&r[o].children.length){i.push(r[o]);continue}const s=r[o].id;if(this.tileCache.has(s)){const n=this.layer.Ce(r[o],t);n.selected=!0,n.data=this.tileCache.get(s),t.children.push(n),e.push(n)}else r[o].Ee<=n&&i.push(r[o])}}return e}ve(t,e,n){this.tileCache.markAll(this,!1);const i=[];for(let a=0,h=t.length;a<h;a++){const e=t[a].data;e.current=!0,e.renderer=this,this.tileCache.add(t[a].node.id,e);const n=e.node,r=this.layer.q(n.H);n.ft&&r.debug&&!Array.isArray(r.debug)&&i.push(n.ft)}const r=this.layer.options.services;for(let a=0;a<r.length;a++){const t=r[a],e=Array.isArray(t.debug)&&t.debug;if(e)for(const n of e){const t=this.layer.Dt(n),e=t&&t.node;e&&e.ft&&i.push(e.ft)}}const o={tiles:t,leaves:e};this.onDrawTileStart(o);const s=this.painter.paint(t,e,i,n);this.layer.fire("drawtiles",{count:s}),this.onDrawTileEnd(o),s&&this.layer.fire("canvasisdirty",{renderCount:s}),this.tileCache.shrink()}onDrawTileStart(){}onDrawTileEnd(){}loadTiles(t){for(let e=0,n=t.length;e<n;e++){const n=t[e];this.tilesLoading[n.id]={current:!0,node:n},this.loadTile(n)}}loadTile(t){let e=t.content.url;if(rQ(e)){const n=oQ(e);return this.Ne(e,n,t),null}if(e.indexOf("i3s:tileset")>=0){const n=t.H;return new qY(e,n,this.ke[n],this.layer,this.Qt).load().then((n=>{this.onTilesetLoad(n,t,e)}))}return t&&uQ(e)&&!JY(e)&&(e=t.baseUrl+e),this.Ne(e,null,t),null}Ne(t,e,n){let i=this.Re;i||(i=Lv.getSupportedFormats(this.gl.gl||this.gl),this.Re=i);const r=this.layer.q(n.H);r.isSuperMapiServer&&(t=function(t,e){const n=t.substring(e.length).split("/"),i=[];for(let r=0;r<n.length;r++)i.push(encodeURIComponent(n[r]));return e+i.join("/")}(t,n.baseUrl));const o={url:this.layer.getTileUrl(t,this.layer.Le[n.H]),arraybuffer:e,rootIdx:n.H,upAxis:n.At,transform:n.matrix,supportedFormats:i};if(JY(t)){const e=this.ke[n.H];if(o.projection=e.projection,o.i3sInfo=KY(t,e,this.regl,this.layer.options.enableI3SCompressedGeometry,this.layer.options.forceI3SCompressedGeometry),!o.i3sInfo)return void this.onTileError({status:404},n,t)}o.service=WZ({},r),r.offset&&delete o.service.offset,o.referrer=window&&window.location.href,this.workerConn.loadTile(this.layer.getId(),o,((e,i)=>{if(e)return void this.onTileError(e,n,t);const{magic:r}=i;"b3dm"===r||"pnts"===r||"i3dm"===r||"cmpt"===r||"gltf"===r?this.me.push({data:i,tile:n}):this.onTilesetLoad(i,n,t)}))}Ut(t){this.painter&&this.painter.Ut(t)}Ft(t){this.painter&&this.painter.Ft(t)}ye(){const t=this.getMap(),e=this.layer.options.meshLimitPerFrame;let n=0;for(;this.me.length&&(n<e||!t.isInteracting());){const{data:t,tile:e}=this.me.shift(),{magic:i}=t;"b3dm"===i||"gltf"===i?this.painter.createB3DMMesh(t,e.id,e,((n,{mesh:i})=>{this.Pe(t,e,n,i)})):"pnts"===i?this.painter.createPntsMesh(t,e.id,e,((n,{mesh:i})=>{this.Pe(t,e,n,i)})):"i3dm"===i?this.painter.createI3DMMesh(t,e.id,e,((n,{mesh:i})=>{this.Pe(t,e,n,i)})):"cmpt"===i&&this.painter.createCMPTMesh(t,e.id,e,((n,{mesh:i})=>{this.Pe(t,e,n,i)})),n++}}Pe(t,e,n,i){if(n)this.onTileError(n,e);else{const n=this.Be(i);e.memorySize=n,this.onTileLoad(t,e)}}Be(t){let e=0;if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]&&(e+=this.Be(t[n]));else t&&(e+=t.getMemorySize());return e}onTileLoad(t,e){this.layer&&(delete this.tilesLoading[e.id],this.layer.onTileLoad(t,e),this.Ue(e),this.setToRedraw(),this.layer.fire("tileload",{node:e}))}onTilesetLoad(t,e,n){this.layer&&(this.layer.zt=t.extensions&&t.extensions["s3m:VertexCompressionType"],t.capabilities||t.layers&&t.layers[0]&&t.layers[0].capabilities?this.De(t,e,n):(delete this.tilesLoading[e.id],this.layer.onTilesetLoad(t,e,n)))}onTileError(t,e,n){if(!this.layer)return;const i=n||e.content.url,r=t&&t.message||t;t&&(404===t.status||204===t.status)||rJ.has(r)||(console.warn("failed to load 3d tile: "+i),console.warn(t),rJ.add(r)),delete this.tilesLoading[e.id],(!this.layer.options.onlyCacheNoContentTileWhenError||t&&!gi.isNoContentHttpCode(t.status))&&this.Fe(e,t),this.setToRedraw(),this.layer.fire("tileerror",{node:e,error:t})}getCachedTile(t){return this.tileCache.get(t)}getShadowMeshes(){if(!this.painter)return[];const t=[],e=this.painter.getCurrentB3DMMeshes();for(const i in e)e[i]&&e[i].isValid&&e[i].isValid()&&t.push(e[i]);const n=this.painter.getCurrentI3DMMeshes();for(const i in n)n[i]&&n[i].isValid&&n[i].isValid()&&t.push(n[i]);return t}Fe(t,e){const n={loadTime:gi.now(),current:!0,error:e,node:t};n.renderer=this,this.tileCache.add(t.id,n)}Ue(t){const e={loadTime:gi.now(),current:!0,node:t};e.renderer=this,this.tileCache.add(t.id,e)}abortTileLoading(t){if(!t||!this.workerConn)return;const e=t.node.content.url;this.workerConn.abortTileLoading(this.layer.getId(),e),delete this.de[e]}_e(){if(this.tilesLoading)for(const t in this.tilesLoading)this.tilesLoading[t].current=!1}deleteTile(t){this.painter.deleteTile(t)}createContext(){const t=this.layer,e=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:t.options.antialias},n=this.canvas.gl&&this.canvas.gl.wrap;n?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):(this.glOptions=e,this.gl=this.je(this.canvas,e)),this.regl=this.regl||id({gl:this.gl,attributes:e,extensions:["OES_element_index_uint"],optionalExtensions:t.options.optionalExtensions||[]}),this.prepareWorker(),n&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=new BY(this.regl,t),this.layer.ze(),this.layer.fire("contextcreate",{regl:this.regl})}prepareWorker(){const t=this.getMap();this.workerConn||(this.workerConn=new fQ("@maptalks/3dtiles",t.id,Lv.supportNPOT(this.regl)));const e=this.workerConn;if(!e.isActive())return;let n=this.layer.options||{};n=WZ({},n),delete n.offset;const i=t.options.spatialReference;n.projection=i&&i.coordType||i&&i.projection||t.getSpatialReference().getProjection().code;const r=this.layer.getId();e.addLayer(r,n,(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}onRemove(){this.painter&&this.painter.remove(),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),aJ--,aJ||sJ.reset(),this.clear(),delete this.tileCache,super.onRemove()}clear(){this.Te(!0),this.tileCache.reset(this),this.tilesLoading={},super.clear()}clearCanvas(){this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas()}getTileOpacity(){return 1}getStencilValue(){return 0}Te(t){this.qe||(this.qe=Date.now());const e=Date.now();if(!t&&e-this.qe<this.layer.options.retireInterval)return;this.qe=e;const n=[];for(const i in this.tilesLoading){const e=this.tilesLoading[i];!t&&e.current||(n.push(i),this.abortTileLoading(e))}for(let i=0;i<n.length;i++)delete this.tilesLoading[n[i]]}Me(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit}je(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let o=0;o<n.length;++o){try{i=t.getContext(n[o],e)}catch(r){}if(i)break}return i}Oe(t){return!!this.tilesLoading[t]}getI3DMMeshes(){return this.painter.getI3DMMeshes()}getPNTSMeshes(){return this.painter.getPNTSMeshes()}getB3DMMeshes(){return this.painter.getB3DMMeshes()}readBatchData(t,e,n){return JQ(t,e,0,n)}be(){if(!this.He)return;const t=this.layer.options.i3sNodepageLimitPerFrame||Number.MAX_VALUE;let e=0;const n=[];for(const i in this.He){const r=this.He[i];if("pending"===r.status)continue;r.status="pending";const o=r.rootIdx,s=cQ(this.layer.q(o).fetchOptions);if(n.push(kd.getJSON(i,s).then((t=>{delete this.He[i];const e=this.ke[o];if(e){t.nodes?VY(e,t.nodes):(e[t.id]=t,VY(e,t.children));for(let t=0;t<r.length;t++)r[t]();this.setToRedraw()}else this.setToRedraw()}))),e++,e>=t)break}n.length&&Promise.all(n)}pe(t,e,n){this.He||(this.He={}),this.He[e]=this.He[e]||[],this.He[e].rootIdx=t,this.He[e].push(n),this.setToRedraw()}De(t,e,n){this.ke||(this.ke=[]);const i=e.H;this.ke[i]||(this.ke[i]={});const r=this.ke[i],o=this.layer.q(i);t.layers&&(t=t.layers[0],"/"!==n[n.length-1]&&(n+="/"),n+="layers/0"),r.version=+(o.i3sVersion||t.store.version),!t.spatialReference||t.spatialReference.wkid&&4326===t.spatialReference.wkid||console.warn("i3s has a spatialReference other than 4326.",t.spatialReference),t.spatialReference&&4490===t.spatialReference.wkid&&(console.warn("i3s spatialReference is 4490,auto set spatialReference to 4326,This may cause some location issues, please ensure that your service is 4326"),t.spatialReference.wkid=4326),r.projection=t.spatialReference,function(t,e,n,i,r,o,s){if(!o.layerScene){o.layerScene=e,o.nodesPerPage=e.nodePages&&e.nodePages.nodesPerPage||64,o.lodSelectionMetricType=e.nodePages&&e.nodePages.lodSelectionMetricType;let t=r;if(o.layerScene.eslpk=t.indexOf("3dSceneLayer.json")>=0,t.endsWith(".json")){const e=r.lastIndexOf("/");t=e<0?"./":r.substring(0,e)}o.layerScene.baseUrl=t.split("?")[0]}return new qY(r,n,o,t,s).load()}(this.layer,t,i,0,n,r,this.Qt).then((t=>{this.onTilesetLoad(t,e,n)}))}pick(t,e,n){if(!this.painter)return[];const i=this.pickingFBO,{width:r,height:o}=this.canvas;return!this.pickingFBO||i.width===r&&i.height===o||i.resize(r,o),this.painter.pick(t,e,n&&n.tolerance)}highlight(t){if(this.$||(this.$=[]),Array.isArray(t))for(let e=0;e<t.length;e++){const n=t[e].service||0;let i=this.$[n];i||(i=this.$[n]=new Map),i.set(t[e].id,t[e])}else{const e=t.service||0;let n=this.$[e];n||(n=this.$[e]=new Map),n.set(t.id,t)}this.painter.highlight(this.$)}cancelHighlight(t,e){if(!this.$)return;const n=this.$[t];if(n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n.delete(e[t]);else n.delete(e);n.size||(this.$[t]=null),this.painter.highlight(this.$)}}cancelAllHighlight(){delete this.$,this.painter.cancelAllHighlight()}showOnly(t){if(this.X||(this.X=[]),Array.isArray(t))for(let e=0;e<t.length;e++){const n=t[e].service||0;let i=this.X[n];i||(i=this.X[n]=new Map),i.set(t[e].id,t[e])}else{const e=t.service||0;let n=this.X[e];n||(n=this.X[e]=new Map),n.set(t.id,t)}this.painter.showOnly(this.X)}cancelShowOnly(){delete this.X,this.painter.cancelShowOnly()}Zt(){return this.painter?this.painter.Zt():[]}ue(t,e){const n=this.getMap();if("identity"===n.getProjection().code.toLowerCase()){const n=this.Ge();return nJ.set(e[0],e[1]),n.unproject(nJ,iJ),t[0]=iJ.x,t[1]=iJ.y,t}return nJ.set(e[0],e[1]),n.getProjection().unproject(nJ,iJ),t[0]=iJ.x,t[1]=iJ.y,t}Ve(t,e){const n=this.Ge();return nJ.set(e[0],e[1]),n.project(nJ,iJ),t[0]=iJ.x,t[1]=iJ.y,t}Je(t,e){const n=this.Ge();return nJ.set(e[0],e[1]),n.unproject(nJ,iJ),t[0]=iJ.x,t[1]=iJ.y,t}Ge(){const t=this.getMap().options.spatialReference.coordType;if(!t)throw new Error("Missing coordType in map spatialReference.");return this.$e||(this.$e=Qh.getProjectionInstance(t)),this.$e}};function lJ(t,e){return t.ut-e.ut}function uJ(t,e,n){return t[0]=e[n],t[1]=e[n+3],t[2]=e[n+6],t}const cJ=[],AJ=[],fJ=[],dJ=[],pJ=[],gJ=2*Math.PI;let mJ=class{constructor(t,e,n,i){this.west=t,this.south=e,this.east=n,this.north=i}static contains(t,e){let n=e[0];const i=e[1],r=t.west;let o=t.east;return o<r&&(o+=gJ,n<0&&(n+=gJ)),(n>r||WQ(n,r,1e-14))&&(n<o||WQ(n,o,1e-14))&&i>=t.south&&i<=t.north}static southwest(t,e){return e[0]=t.west,e[1]=t.south,e[2]=0,e}static northeast(t,e){return e[0]=t.east,e[1]=t.north,e[2]=0,e}static southeast(t,e){return e[0]=t.east,e[1]=t.south,e[2]=0,e}static northwest(t,e){return e[0]=t.west,e[1]=t.north,e[2]=0,e}};const yJ=[0,0,1];function vJ(t,e){return EQ(e,t[0],t[1],t[2])}let _J=class{constructor(t,e){this.normal=dg([],t),this.distance=e}static fromPointNormal(t,e,n){const i=-Mg(e,t);return dg(n.normal,e),n.distance=i,n}};const xJ=[],bJ=[],wJ=[],CJ=[],PJ=[],MJ=[],TJ=[],SJ=[],IJ=[],EJ=[],OJ=new _J([1,0,0],0),RJ=[];let DJ=class{constructor(t){this.southwestCornerCartesian=[],this.northeastCornerCartesian=[],this.westNormal=[],this.eastNormal=[],this.southNormal=[],this.northNormal=[],this.rectangle=new mJ(...t),this.minimumHeight=t[4],this.maximumHeight=t[5],this.computeBox(this.rectangle)}distanceToCamera(t,e){let n=0;if(!mJ.contains(this.rectangle,e)){const e=this.northeastCornerCartesian,i=this.westNormal,r=this.southNormal,o=this.eastNormal,s=this.northNormal,a=mg(RJ,t,this.southwestCornerCartesian),h=Mg(a,i),l=Mg(a,r),u=mg(RJ,t,e),c=Mg(u,o),A=Mg(u,s);h>0?n+=h*h:c>0&&(n+=c*c),l>0?n+=l*l:A>0&&(n+=A*A)}const i=e[2],r=this.minimumHeight,o=this.maximumHeight;if(i>o){const t=i-o;n+=t*t}else if(i<r){const t=r-i;n+=t*t}return Math.sqrt(n)}computeBox(t){const e=this;vJ(mJ.southwest(t,bJ),e.southwestCornerCartesian),vJ(mJ.northeast(t,bJ),e.northeastCornerCartesian),xJ[0]=t.west,xJ[1]=.5*(t.south+t.north),xJ[2]=0;const n=vJ(xJ,wJ),i=Tg(PJ,n,yJ);Pg(e.westNormal,i),xJ[0]=t.east;const r=vJ(xJ,SJ),o=Tg(PJ,yJ,r);Pg(e.eastNormal,o);const s=mg(PJ,n,r),a=Pg(CJ,s),h=t.south;let l;if(h>0){xJ[0]=.5*(t.west+t.east),xJ[1]=h;const n=vJ(xJ,IJ);dg(EJ,a);const i=_J.fromPointNormal(e.southwestCornerCartesian,e.westNormal,OJ);kJ(IJ,EJ,i,e.southwestCornerCartesian),l=UQ(n,MJ)}else l=GQ(mJ.southeast(t,bJ),MJ);const u=Tg(TJ,l,s);Pg(e.southNormal,u);const c=t.north;let A;if(c<0){xJ[0]=.5*(t.west+t.east),xJ[1]=c;const n=vJ(xJ,IJ);_g(EJ,a,-1);const i=_J.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,OJ);kJ(IJ,EJ,i,e.northeastCornerCartesian),A=UQ(n,MJ)}else A=GQ(mJ.northwest(t,bJ),MJ);const f=Tg(TJ,s,A);Pg(e.northNormal,f)}};function kJ(t,e,n,i){const r=t,o=e,s=n.normal,a=Mg(s,o);if(Math.abs(a)<1e-15)return;const h=(-n.distance-Mg(s,r))/a;return h<0?void 0:gg(i=_g(i,o,h),r,i)}function LJ(t){return[t.xmin,t.ymin,t.xmax,t.ymax]}const FJ=Ni,NJ={services:[],maxGPUMemory:Q.mobile?32:1536,retireInterval:2e3,loadingLimitOnInteracting:5,loadingLimit:10,debug:!1,meshLimitPerFrame:1,i3sNodepageLimitPerFrame:1,enableI3SCompressedGeometry:!0,forceI3SCompressedGeometry:!0,onlyCacheNoContentTileWhenError:!0,picking:!0,pickingPoint:!0,geometryEvents:!1,alwaysShowTopTiles:!0,antialias:!1,offset:[0,0],renderer:"gl",forceRenderOnZooming:!0,forceRenderOnRotating:!0,forceRenderOnMoving:!0,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"]},zJ=[0,0,0],BJ=[0,0,0],HJ=[0,0,0],jJ=[0,0,0],UJ=[0,0,0],GJ=[0,0,0],VJ=[0,0,0],WJ=[1,1,1],qJ=[1,1,1],ZJ=[0,0,0,0],QJ=[],XJ=new $o(0,0),YJ=new ht(0,0),JJ=[0,0,0,0,0,0,0,0,0],KJ=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],$J=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],tK=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],eK=new ht(0,0),nK=Np([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),iK=[0,0],rK=[0,0,0],oK=[1,1,1],sK=[0,0,0],aK=[0,0,0],hK=[0,0,0,0],lK=[1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1];let uK=class t extends(qS(sl)){static fromJSON(e){return e&&"Geo3DTilesLayer"===e.type?new t(e.id,e.options):null}static getEnuTransform(t,e=[1,1,1],n=[0,0,0]){const i=EQ([],t[0]*Math.PI/180,t[1]*Math.PI/180,t[2]||0),r=gX(i,null,[]),o=tg([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],Sm([0,0,0,0],...n),[0,0,0],e);return Hp(o,r,o)}constructor(t,e){super(t,e),this.isGeo3DTilesLayer=!0,this.Ke(),this.Xe=[]}Ke(){const t=this.options.services.map((t=>t.url));this.Ye=this.Ye||{},this.Le=this.Le||[];for(let e=0;e<t.length;e++){const n=t[e];let i=this.Ye[n];void 0===i&&(i=this.Ye[n]=this.Le.length),this.Le[i]=fK(n,i,this.options.services[e])}this.fire("rootready",{roots:this.Le.slice(0)})}showService(t){return this.updateService(t,{visible:!0}),this}hideService(t){return this.updateService(t,{visible:!1}),this}setToRedraw(){return this.Ze(),this}addService(t){return this.options.services=this.options.services||[],this.options.services.push(t),this.Ke(),this.Ze(),this}updateService(t,e){if(!e)return this;const n=this.options.services;let i=!1;n&&n[t]&&(i=!(gK(n[t].coordOffset,e.coordOffset)&&gK(n[t].heightOffset,e.heightOffset)&&gK(n[t].scale,e.scale)&&gK(n[t].rotation,e.rotation)),WZ(n[t],e));const r=this.Le&&this.Le[this.Ye[n[t].url]];return r&&(VZ(e.visible)||(r.visible=e.visible),i&&r.version++),this.Ze(),this}removeService(t){const e=this.options.services;if(e&&e[t]){const n=e[t].url,i=this.Ye[n];this.Le[i]&&(this.Le[i]=null),delete this.Ye[n],e.splice(t,1)}return this.Ze(),this}getTileUrl(t,e){const n=e&&e.service&&e.service.subdomains;if(n&&e.domainKey){const i=n.length;if(i){const r=[...t].reduce(((t,e)=>t+e.charCodeAt(0)),0)%i;return t.replace(e.domainKey,n[r])}}return t}getExtent(t){if(!t&&0!==t){const t=new fs;for(let e=0;e<this.Le.length;e++){const n=this.Le[e];if(n&&n.boundingVolume){const e=this.boundingVolumeToExtent(n);t._combine(e)}}return t}const e=this.Le[t];return e&&e.boundingVolume?this.boundingVolumeToExtent(e):null}boundingVolumeToExtent(t){const e=t.boundingVolume.We?nK:t.matrix,n=this.getMap(),i="identity"===n.getProjection().code.toLowerCase(),r=this.getRenderer();if(t.boundingVolume.region){const e=t.boundingVolume.region;return new fs(YZ(e[0]),YZ(e[1]),YZ(e[2]),YZ(e[3]))}if(t.boundingVolume.sphere){const o=t.boundingVolume.sphere,s=FQ([],Sg([0,0,0],o,e));i&&r.Ve(s,s);const a=o[3],h=n.locate(s,-a,a),l=n.locate(s,a,-a);return new fs(h,l)}if(t.boundingVolume.box){const o=t.boundingVolume.box,s=Sg([0,0,0],o,e),a=new $o(FQ([],s));i&&r.Ve(a,a);const h=o.slice(3);Ep(h,Mp([0,0,0,0,0,0,0,0,0],t.matrix),h);const l=Ag(h.slice(0,3)),u=Ag(h.slice(3,6)),c=Ag(h.slice(6,9)),A=Math.max(l,u,c),f=n.locate(a,-A,A),d=n.locate(a,A,-A);return new fs(f,d)}return null}getRootTiles(){return this.Le}getTiles(){const t=this.getRenderer();if(!t.ready)return this.Ze(),{tiles:QJ};const e=this.getMap(),n=e.cameraPosition,i=e.pointAtResToDistance(n[2],0,e.getGLRes()),r=this.Qe(n);this.tn=this.tn||[0,0,0],pg(this.tn,XZ(r.x),XZ(r.y),i),this.nn=EQ(this.nn||[],this.tn[0],this.tn[1],this.tn[2]),this.rn=2*Math.tan(.5*XZ(e.getFov()));const o=e.projViewMatrix;let s;if(e.getPitch()<=80){const t=e.getExtent(),n=t.getWidth()/2,i=t.getHeight()/2;t.xmin-=n,t.ymin-=i,t.xmax+=n,t.ymax+=i,s=LJ(t)}const a=(this.getMasks()||[]).filter((t=>t&&t instanceof XI));a.forEach((t=>{if(!t.maskGeoJSON&&t.toGeoJSON)try{t.maskGeoJSON=t.toGeoJSON();const e=t.getExtent();t.maskGeoJSON.bbox=LJ(e)}catch(e){console.error(e)}}));const h={children:[],level:-1};let l=h;const u=[];for(let c=0;c<this.Le.length;c++){const e=this.Le[c];if(!e||!e.visible)continue;const n=e.service,i=[e],r=this.sn(c);for(;i.length>0;){const e=i.pop();for(e.id||this.an(e);l.level>=e.Ee;)l=l.parent;const h=this.cn(e,r,o,s,a);if(e.service=n,!(h===mK.VISIBLE||h!==mK.OUT_OF_FRUSTUM&&this.options.alwaysShowTopTiles&&pK(e))){let t=l;for(;t&&!t.content;)t=t.parent;h===mK.SCREEN_ERROR_TOO_SMALL&&t&&t.content&&this.hn(u,t);continue}e.ut<1/0&&this.ln(e);const c=this.Ce(e,l);l.children.push(c);const A=e.children,f=A&&A.length,d=c.content;if(d&&(!f||h===mK.SCREEN_ERROR_TOO_SMALL)&&this.hn(u,c),h!==mK.SCREEN_ERROR_TOO_SMALL&&f){d&&"add"===e.refine&&this.hn(u,c),l=c;const n=A[0].parent;let r=!1;for(let o=0,s=A.length;o<s;o++){if(n){const e=t.getCachedTile(A[o].id);if(e&&e.error&&404!==e.error.status)continue;r=!0}else{r=!0,A[o].parent=e,A[o].At=e.At,A[o].baseUrl=e.baseUrl;const t=A[o].content&&(A[o].content.url||A[o].content.uri);t&&(rQ(t)||t.indexOf("i3s:")>=0?A[o].baseUrl=e.baseUrl:uQ(t)?A[o].content.url=e.baseUrl+t:A[o].baseUrl=t.substring(0,t.lastIndexOf("/")+1))}i.push(A[o])}!r&&d&&this.hn(u,c)}}}return{root:h,tiles:u}}hn(t,e){const{viewerRequestVolume:n,matrix:i}=e.node;n&&!function(t,e,n,i){if(n.region){const e=n.region;if(t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3])return!0}else{if(n.sphere)return cK(n,e,i)<=0;if(n.box)return 0===AK(n,e,i)}return!1}(this.tn,this.nn,n,i)||t.push(e)}Ce(t,e){return{id:t.id,node:t,children:[],level:t.Ee,parent:e,content:t.content&&t.content.url}}an(t){const e=this.getId();var n;t.id=e+":"+gi.GUID(),t.matrix=t.transform||Np([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),t.un=this.dn(t),t.parent&&((n=t).content&&n.content.uri&&n.content.uri.indexOf("i3s:")>=0||(t.matrix=Hp(t.matrix,t.parent.matrix,t.matrix)),t.H=t.parent.H,void 0===t.Ee&&(t.Ee=t.parent.Ee+1),t.maxExtent=t.parent.maxExtent),t.refine=t.refine&&t.refine.toLowerCase()||"replace",t.content&&!t.content.url&&t.content.uri&&(t.content.url=t.content.uri)}q(t){return this.Le[t].service}mn(t){const e=t.boundingVolume;if(!e||e.We&&!this.pn(t))return;const n=this.q(t.H),i=n.heightOffset||0,r=this.options.offset,o=qZ(r)||r[0]||r[1],s=n.coordOffset||iK;if(!Array.isArray(s))throw new Error("service.coordOffset must be an array");if(!e.We&&(!t.boundingVolume||!i&&hg(t.matrix,nK)&&!o&&s===iK))return;e.box&&e.region&&delete e.region;const{region:a,box:h,sphere:l}=e;if(e.coordOffset=[s[0],s[1]],e.heightOffset=i,a){e.originalVolume||(e.originalVolume=a.slice(0));const t=e.originalVolume,n=this.gn([YZ(t[0]),YZ(t[1])]);a[0]=XZ(n.x+s[0]),a[1]=XZ(n.y+s[1]);const r=this.gn([YZ(t[2]),YZ(t[3])]);a[2]=XZ(r.x+s[0]),a[3]=XZ(r.y+s[1]),a[4]=t[4]+i+(s[2]||0),a[5]=t[5]+i+(s[2]||0)}else if(h||l){e.originalVolume||(e.originalVolume=(h||l).slice(0));const n=h||l,r=Sg(zJ,e.originalVolume,t.matrix),o=FQ(BJ,r),a=this.gn([o[0]+s[0],o[1]+s[1]]);o[0]=a.x,o[1]=a.y,o[2]+=i+(s[2]||0),EQ(n,XZ(o[0]),XZ(o[1]),o[2])}e.We=!0;try{t.extent=this.boundingVolumeToExtent(t)}catch(u){console.error(u)}}pn(t){const e=t.boundingVolume,n=this.q(t.H),i=n.coordOffset||iK;return e.coordOffset[0]!==i[0]||e.coordOffset[1]!==i[1]||e.heightOffset!==(n.heightOffset||0)}dn(t){return void 0===t.geometricError||!t.boundingVolume}ln(t){let e=t.parent;for(;e&&e.un&&!(e.ut<=t.ut);)e.ut=t.ut,e=t.parent}onTileLoad(t,e){if(t.children&&(!e.children||!e.children.length)){e.children=t.children;const n=e.content.url;e.baseUrl=n.substring(0,n.lastIndexOf("/")+1),this.Ze()}}onTilesetLoad(t,e,n){if(!t)return void console.warn("invalid tileset at : "+n);const i=(t.asset&&t.asset.gltfUpAxis||e&&e.At||"Y").toUpperCase();t.root.baseUrl=n.substring(0,n.lastIndexOf("/")+1);const r=n.indexOf("realspace/")>-1;0===e.Ee&&t.asset&&t.asset.s3mType&&r&&(t.root.baseUrl+="data/path/");const o=t.asset.i3s;if(t.root.At=i,e){const n=e.boundingVolume;WZ(e,t.root),e.refine=e.refine&&e.refine.toLowerCase()||"replace",n&&(e.boundingVolume=n);const i=t.root.transform||Np([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);if(e.parent)o||(e.matrix=Hp([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e.parent.matrix,i));else{const t=this.q(e.H);e.matrix=t.ecefTransform?Hp([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],t.ecefTransform,i):i}delete e.content,t.root.content&&(e.content=t.root.content),e.un=this.dn(e);const r=e.content&&(e.content.url||e.content.uri);r&&e.content.uri&&(e.content.url=e.content.uri,delete e.content.uri),!o&&r&&!rQ(r)&&uQ(r)&&(e.content.url=e.baseUrl+r),t.root&&!e.parent&&this.bn(e)}this.Ze(),this.fire("loadtileset",{tileset:t,index:e&&e.H,url:n})}yn(t,e,n){if(!t.extent||!FJ)return!0;const i=t.extent;if(hK[0]=i.xmin,hK[1]=i.ymin,hK[2]=i.xmax,hK[3]=i.ymax,e&&!FJ.bboxIntersect(hK,e))return!1;if(n.length){for(let t=0,e=n.length;t<e;t++){const e=n[t].maskGeoJSON;if(!e||!e.bbox||FJ.bboxInMask(hK,e))return!0}return!1}return!0}cn(t,e,n,i,r){if(!this.yn(t,i,r))return mK.OUT_OF_FRUSTUM;if(t.ut=1/0,0===t.Ee||t.un)return this.bn(t),mK.VISIBLE;if(this.mn(t),!this.wn(t,e,n))return mK.OUT_OF_FRUSTUM;if(0===t.geometricError)return mK.VISIBLE;let o=this.q(t.H).maximumScreenSpaceError;null==o&&(o=16);let s=this.vn(t);return 0===s&&t.parent&&(s=.5*(t.parent.Tn||0)),s>=o?mK.VISIBLE:mK.SCREEN_ERROR_TOO_SMALL}Xt(t,e){e||(e=new ht(0,0));const n=this.getMap();return n.coordToPointAtRes(t,n.getGLRes(),e)}wn(t,e,n){const i=t.id;let r=this.Xe[i];const{boundingVolume:o}=t,s=o.region,a=o.box,h=o.sphere,l=this._n(t.H),u=this.getRenderer();return r&&r.version===l.version||(s?r=this.Xe[i]=this.Mn(t):a?r=this.Xe[i]=this.On(t):h&&(r=this.Xe[i]=this.An(t)),r.version=l.version,t.ft&&(u.Ft(t.ft),delete t.ft)),this.q(t.H).debug&&(this.Xe[i].node=t,u.Ut(t)),r.obbox?function(t,e){Kq(t);for(var n=0;n<6;n++)if(!Jq(zq[n],e))return!1;return!0}(n,r.obbox):!!h&&function(t,e){Kq(t);for(var n=e[0],i=-e[1],r=0;r<6;r++)if(tZ(zq[r],n)<i)return!1;return!0}(n,r.sphereBox)}Mn(t){const e=this.getMap(),n=e.getGLRes(),i=t.boundingVolume.region;let{ws:r,en:o}=function(t){const e=t[2],n=t[3],i=t[5],r=EQ([],t[0],t[1],t[4]),o=EQ([],e,n,i);return{ws:FQ(r,r),en:FQ(o,o)}}(i);r=new $o(r),o=new $o(o);const s=e.coordToPointAtRes(r,n);s.z=e.altitudeToPoint(r.z,n);const a=e.coordToPointAtRes(o,n);a.z=e.altitudeToPoint(o.z,n);const h=[a.x,s.y,a.z,a.x,a.y,a.z,s.x,a.y,a.z,s.x,s.y,a.z,a.x,s.y,s.z,a.x,a.y,s.z,s.x,a.y,s.z,s.x,s.y,s.z],l=[(h[0]+h[18])/2,(h[1]+h[19])/2,(h[2]+h[20])/2],u=this._n(t.H);t!==u||u.xn||(u.xn=l);const c=this.Jt([],t),A=hg(nK,c);if(!A){Sg(l,l,c);const t=zJ;for(let e=0;e<h.length;e+=3){let n=pg(t,h[e],h[e+1],h[e+2]);A||(n=Sg(n,n,c)),h[e]=n[0],h[e+1]=n[1],h[e+2]=n[2]}}const f=e.pointAtResToCoord(new ht(l),n);f.z=(r.z+o.z)/2;const d=this.In(h,l);for(let p=0;p<h.length;p++)h[p]-=l[p%3];return{obbox:d,boxPosition:h,boxCenter:l,boxCoord:f}}On(t){const e=this.getRenderer(),n=this.getMap(),i="identity"===n.getProjection().code.toLowerCase(),r=n.getGLRes(),{boxCenter:o,boxCoord:s}=this.Sn(t),a=t.boundingVolume.box,h=(l=[],u=(b=this.En(a,t.matrix))[0],c=b[3],A=b[6],f=(w=a)[0],d=b[1],p=b[4],g=b[7],m=w[1],y=b[2],v=b[5],_=b[8],x=w[2],l[0]=u||0,l[1]=d||0,l[2]=y||0,l[3]=0,l[4]=c||0,l[5]=p||0,l[6]=v||0,l[7]=0,l[8]=A||0,l[9]=g||0,l[10]=_||0,l[11]=0,l[12]=f||0,l[13]=m||0,l[14]=x||0,l[15]=1,l);var l,u,c,A,f,d,p,g,m,y,v,_,x,b,w;const C=this.Jt([],t),P=hg(nK,C);P||Sg(o,o,C);const M=[],T=zJ;for(let I=0;I<lK.length;I+=3){T[0]=lK[I],T[1]=lK[I+1],T[2]=lK[I+2],Sg(T,T,h),FQ(T,T),i&&e.Ve(T,T);const t=XJ.set(T[0],T[1],T[2]);n.coordToPointAtRes(t,r,YJ);let o=pg(T,YJ.x,YJ.y,n.altitudeToPoint(t.z,r));P||(o=Sg(o,o,C)),M[I]=o[0],M[I+1]=o[1],M[I+2]=o[2]}const S=this.In(M,o);for(let I=0;I<M.length;I++)M[I]-=o[I%3];return{obbox:S,boxPosition:M,boxCenter:o,boxCoord:s}}An(t){const e=this.getMap(),n=this.getRenderer(),i="identity"===e.getProjection().code.toLowerCase(),r=t.boundingVolume.sphere;let o=zJ;0===r[0]&&0===r[1]&&0===r[2]?o=[0,0,-6378137]:FQ(o,r),i&&n.Ve(o,o);const s=new $o(o),a=this.Xt(s,YJ).toArray();a[2]=e.altitudeToPoint(s.z,e.getGLRes());const h=this.Cn(s);return{boxCenter:a,boxCoord:s,sphereBox:[a,r[3]*h[2]]}}In(t,e){const n=dK(UJ,t,0,1,4,5),i=dK(GJ,t,0,3,4,7),r=dK(VJ,t,0,1,2,3);return[...e,...Dg(zJ,n,e),...Dg(BJ,i,e),...Dg(HJ,r,e)]}Sn(t){const e=this.getMap(),n=this.getRenderer(),i="identity"===e.getProjection().code.toLowerCase(),r=e.getGLRes(),o=t.boundingVolume.box.slice(0,3);FQ(o,o),i&&n.Ve(o,o);const s=new $o(o),a=e.coordToPointAtRes(s,r);return{boxCenter:[a.x,a.y,e.altitudeToPoint(s.z,r)],boxCoord:s}}Jt(t,e){const n=this._n(e.H),i=this.q(e.H),r=n.xn,o=Zp(KJ,pg(zJ,-r[0],-r[1],-r[2])),s=Zp($J,r),a=Sm(ZJ,...i.rotation||rK),h=i.scale;let l;return l=Array.isArray(h)?pg(sK,h[0],h[1],h[2]):h&&pg(sK,h,h,h)||oK,t=Hp(t,tg(tK,a,aK,l),o),Hp(t,s,t)}bn(t){const e=this.q(t.H);if(!t.boundingVolume||this.Nn(t,e))return;const n=t.boundingVolume.region,i=t.boundingVolume.sphere;let r=null;t.boundingVolume.box?r=this.kn(t).boxCenter:n?r=this.Rn(t).boxCenter:i&&(r=this.An(t).boxCenter);const o=e.heightOffset||0,s=e.coordOffset||[0,0];t.Ln=[s[0]||0,s[1]||0],t.Pn=o,t.xn=r}Nn(t,e){if(!t.Ln)return!1;const n=e.coordOffset||iK;return t.Ln[0]===n[0]&&t.Ln[1]===n[1]&&t.Pn===(e.heightOffset||0)}Rn(t){return this.mn(t),this.Mn(t)}kn(t){return this.mn(t),this.Sn(t)}En(t,e){let n=t.slice(3,12);return n=Ep(n,Mp(JJ,e),n),n}Cn(t){const e=this.getMap(),n=e.distanceToPointAtRes(100,100,e.getGLRes(),t);let i;return i=e.altitudeToPoint?e.altitudeToPoint(100,e.getGLRes())/100:n.y/100,pg(WJ,n.x/100*1.01,n.y/100*1.01,i),WJ}gn(t){Array.isArray(t)&&(t=new $o(t));let e=this.options.offset;if(qZ(e)&&(e=e.call(this,Array.isArray(t)?new $o(t):t)),e[0]||e[1]){const n=this.getMap(),i=n.getGLRes(),r=n.coordToPointAtRes(t,i);return YJ.set(e[0],e[1]),r._sub(YJ),n.pointAtResToCoord(r,i)}return t}_n(t){return this.Le[t]}sn(t){const e=this.q(t).maxExtent;if(!e)return null;const n=this.Le[t];return n.maxExtent||(n.maxExtent=new fs(e).convertTo((t=>this.Xt(t)))),n.maxExtent}vn(t){const e=this.rn,n=t.geometricError;if(0===n)return t.Tn=0,0;const i=this.q(t.H);let r=i.scale||1;if(Array.isArray(r)&&(r=Ag(r)),i.ecefTransform){const t=Kp(qJ,i.ecefTransform);r*=zg(t)}const o=this.getMap();let s;var a,h,l;t.boundingVolume.region?(a=t,h=this.nn,l=this.tn,a.Bn||(a.Bn=new DJ(a.boundingVolume.region)),s=a.Bn.distanceToCamera(h,l)):t.boundingVolume.sphere?s=cK(t.boundingVolume,this.nn):t.boundingVolume.box&&(s=AK(t.boundingVolume,this.nn));const u=Math.max(Math.abs(s),1e-7),c=n*r*o.height/(u*e);return t.ut=s,t.Tn=c,c}Ze(){const t=this.getRenderer();t&&t.setToRedraw()}Dt(t){return this.Xe[t]}identify(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];Array.isArray(t)&&(t=new $o(t));const r=n.coordToContainerPoint(t);return this.identifyAtPoint(r,e)}identifyAtPoint(t,e={}){const n=[];if(!e.excludeMasks){const i=this.identifyMask(t,e);i&&i.length&&sQ(n,i)}const i=this.getMap(),r=this.getRenderer();if(!i||!r)return[];const o=i.getDevicePixelRatio();return sQ(n,r.pick(t.x*o,t.y*o,e)),e&&e.filter&&!e.excludeMasks?n.filter((t=>e.filter(t))):n}getCurrentBatchIDs(){const t=this.getMap(),e=this.getRenderer();return t&&e?e.Zt():[]}highlight(t){const e=this.getRenderer();return Array.isArray(t)||(t=[t]),e?(e.highlight(t),this):(this.$||(this.$=[]),this.$.push(t),this)}ze(){if(this.$){for(let t=0;t<this.$.length;t++)this.highlight(this.$[t]);delete this.$}}cancelHighlight(t,e){const n=this.getRenderer();return n?(n.cancelHighlight(t,e),this):this}cancelAllHighlight(){const t=this.getRenderer();return t?(t.cancelAllHighlight(),this):this}showOnly(t){const e=this.getRenderer();return e?(e.showOnly(t),this):(this.X||(this.X=[]),this.X.push(t),this)}Un(){if(this.X){for(let t=0;t<this.X.length;t++)this.showOnly(this.X[t]);delete this.X}}cancelShowOnly(t){const e=this.getRenderer();return e?(e.cancelShowOnly(t),this):this}setServiceOpacity(t,e){const n=this.options.services[t];return n&&(n.opacity=e),this.getRenderer()?(this.Ze(),this):this}setServiceDebug(t,e){const n=this.options.services[t];return n&&(n.debug=e),this.getRenderer()?(this.Ze(),this):this}Qe(t){const e=this.getMap(),n=e.getGLRes();eK.set(t[0],t[1]);const i=e.pointAtResToCoord(eK,n);return"identity"===e.getProjection().code.toLowerCase()?(BJ[0]=i.x,BJ[1]=i.y,this.getRenderer().Je(zJ,BJ),i.set(zJ[0],zJ[1]),i):i}toJSON(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}}};function cK(t,e,n){let i=t.sphere;n&&(i=Sg([0,0,0],i,n));const r=Fg(i,e),o=t.sphere[3];return r<o?0:r-o}function AK(t,e,n){const i=t.box;let r=pg(zJ,i[0],i[1],i[2]);return n&&(r=Sg([0,0,0],r,n)),o=r,s=Tp(JJ,i[3],i[4],i[5],i[6],i[7],i[8],i[9],i[10],i[11]),a=e,Math.sqrt(function(t,e,n){const i=mg(cJ,n,t),r=uJ(AJ,e,0),o=uJ(fJ,e,1),s=uJ(dJ,e,2),a=zg(r),h=zg(o),l=zg(s);Pg(r,r),Pg(o,o),Pg(s,s);const u=pJ;u[0]=Mg(i,r),u[1]=Mg(i,o),u[2]=Mg(i,s);let c,A=0;return u[0]<-a?(c=u[0]+a,A+=c*c):u[0]>a&&(c=u[0]-a,A+=c*c),u[1]<-h?(c=u[1]+h,A+=c*c):u[1]>h&&(c=u[1]-h,A+=c*c),u[2]<-l?(c=u[2]+l,A+=c*c):u[2]>l&&(c=u[2]-l,A+=c*c),A}(o,s,a));var o,s,a}function fK(t,e,n){const i=(t=JZ(t)).indexOf("{s}")>=0?"{s}":t.indexOf("%7Bs%7D")>=0?"%7Bs%7D":null;return{version:0,un:!0,service:n,visible:!!VZ(n.visible)||n.visible,baseUrl:t.substring(0,t.lastIndexOf("/"))+"/",content:{url:t},refine:"replace",matrix:Np([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),H:e,Ee:0,domainKey:i}}function dK(t,e,n,i,r,o){const s=pg(zJ,e[3*n],e[3*n+1],e[3*n+2]),a=pg(BJ,e[3*i],e[3*i+1],e[3*i+2]),h=pg(HJ,e[3*r],e[3*r+1],e[3*r+2]),l=pg(jJ,e[3*o],e[3*o+1],e[3*o+2]);return t[0]=(s[0]+a[0]+h[0]+l[0])/4,t[1]=(s[1]+a[1]+h[1]+l[1])/4,t[2]=(s[2]+a[2]+h[2]+l[2])/4,t}function pK(t){if(!t.content||t.hasParentContent)return!1;let e=t.parent;if(e&&(e.content||e.hasParentContent))return t.hasParentContent||(t.hasParentContent=!0),!1;for(;e;){if(e.content||e.hasParentContent)return t.hasParentContent||(t.hasParentContent=!0),!1;e=e.parent}return!0}function gK(t,e){return Array.isArray(t)&&Array.isArray(e)?2===t.length?by(t,e):Eg(t,e):t===e}var mK;uK.mergeOptions(NJ),uK.registerRenderer("gl",hJ),uK.registerJSONType("Geo3DTilesLayer"),function(t){t[t.OUT_OF_FRUSTUM=0]="OUT_OF_FRUSTUM",t[t.SCREEN_ERROR_TOO_SMALL=1]="SCREEN_ERROR_TOO_SMALL",t[t.VISIBLE=2]="VISIBLE"}(mK||(mK={}));let yK=null;function vK(){return yK||(yK={"image/crn":GY.crn&&GY.crn(),"image/ktx2":GY.ktx2&&GY.ktx2(),"image/cttf":GY.ktx2&&GY.ktx2(),draco:GY.draco&&GY.draco()}),yK}let _K=class{constructor(t,e,n){this.Dn=t,this.Fn=e||tp,this.Re=n,this.jn=vK()}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,n=0,i=0,r){return e?(i||(i=e.byteLength),this.zn(t,e,n,i,r)):kd.getArrayBuffer(t,{}).then((e=>{const r=e.data;return i||(i=r.byteLength),this.zn(t,r,n,i)}))}zn(t,e,n,i,r){const o=r&&r.maxTextureSize,s=this.qn(e,n,i,t);if(s.error)return Promise.resolve(s);const a=t.substring(0,t.lastIndexOf("/"));let h;try{h=new this.Fn(a,s.glb,{transferable:!0,requestImage:this.Dn,decoders:this.jn,supportedFormats:this.Re,maxTextureSize:o})}catch(l){return Promise.resolve({error:l})}return h.load({skipAttributeTransform:!1}).then((e=>{e.url=`${t}-${n}-${i}`;const r=h.transferables;for(let t=0;t<s.transferables.length;t++)r.indexOf(s.transferables[t])<0&&r.push(s.transferables[t]);return{magic:"b3dm",count:s.count,transferables:r,featureTable:s.featureTable,batchTable:s.batchTable,batchTableBin:s.batchTableBin,gltf:e}}))}qn(t,e,n,i){const r=new DataView(t,e,n),o=r.getUint32(4,!0);if(1!==o){const t="Unsupported b3dm version: "+o+", url:"+i;return console.warn(t),{error:t}}if(r.getUint32(8,!0)!==r.byteLength){const t="Length in b3dm header is inconsistent with b3dm's byte length, url: "+i;return console.warn(t),{error:t}}let s,a=r.getUint32(12,!0),h=r.getUint32(16,!0),l=r.getUint32(20,!0),u=r.getUint32(24,!0),c=28+e;l>=570425344?(c-=8,s=a,l=h,u=0,a=0,h=0):u>=570425344&&(c-=4,s=l,l=a,u=h,a=0,h=0);const A=[t];let f,d,p;if(a>0?(f=QQ(t,c,a),c+=a,s=f.BATCH_LENGTH):f={BATCH_LENGTH:s},h>0&&(c+=h),l>0&&(d=XQ(t,c,l),c+=l,u>0)){const e=YQ(0,c,u);p=t.slice(e.offset,e.offset+e.byteLength),c+=u,A.push(p)}const g=f.BATCH_LENGTH,m={};if(f&&f.BATCH_ID){m.BATCH_ID=KQ(f.BATCH_ID,t,(void 0).offset,g);const e=m.BATCH_ID.array&&m.BATCH_ID.array.buffer;e&&A.indexOf(e)<0&&A.push(e)}return{count:s,transferables:A,featureTable:f,batchTable:d,batchTableBin:p,b3dm:m,glb:{buffer:t,byteOffset:c,byteLength:r.byteLength+r.byteOffset-c}}}Hn(){return null}},xK=class{constructor(t,e,n,i){this.Dn=t,this.Fn=e||tp,this.Re=n,this.jn=vK(),this.Gn=i}load(t,e,n=0,i=0,r){return e?(i||(i=e.byteLength),this.zn(t,e,n,i,r)):kd.getArrayBuffer(t,{}).then((e=>{const r=e.data;return i||(i=r.byteLength),this.zn(t,r,n,i)}))}zn(t,e,n,i,r){return this.Vn(t,e,n,i,r).then((({gltf:r,transferables:o})=>{const s=this.Jn(e,n,i,t);if(s.error)return Promise.resolve(s);for(let t=0;t<o.length;t++)-1===s.transferables.indexOf(o[t])&&s.transferables.push(o[t]);return delete r.transferables,Promise.resolve({magic:"i3dm",count:s.count,transferables:s.transferables,featureTable:s.featureTable,batchTable:s.batchTable,batchTableBin:s.batchTableBin,i3dm:s.i3dm,gltf:r})}))}Vn(t,e,n,i,r){const o={transferable:!0,requestImage:this.Dn,decoders:this.jn,supportedFormats:this.Re,maxTextureSize:r&&r.maxTextureSize},s=new DataView(e,n,i),a=32+s.getUint32(12,!0)+s.getUint32(16,!0)+s.getUint32(20,!0)+s.getUint32(24,!0);if(0===s.getUint32(28,!0)){let i=tQ(new Uint8Array(e,a+n,s.byteLength-a));return-1==i.indexOf("://")&&(i=t.substring(0,t.lastIndexOf("/"))+"/"+i),i.indexOf(".glb")>0?kd.getArrayBuffer(i,{}).then((t=>this.$n(i,{buffer:t.data,byteOffset:0},o))):kd.getJSON(i,{}).then((t=>this.$n(i,t,o)))}return this.$n(t,{buffer:e,byteOffset:a+n,byteLength:s.byteLength-a},o)}$n(t,e,n){const i=t.substring(0,t.lastIndexOf("/")),r=new this.Fn(i,e,n);return r.load({skipAttributeTransform:!0}).then((n=>{let i=0,o=0;return e.buffer&&(i=e.byteOffset||0,o=e.byteLength||0),n.url=`${t}-${i}-${o}`,{transferables:r.transferables,gltf:n}}))}Jn(t,e,n,i){const r=new DataView(t,e,n),o=r.getUint32(4,!0);if(1!==o){const t="Unsupported pnts version: "+o+", url:"+i;return console.warn(t),{error:t}}if(r.getUint32(8,!0)!==r.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+i;return console.warn(t),{error:t}}const s=[t],{featureTable:a,featureTableBin:h,batchTable:l,batchTableBin:u}=sX(r,32+e,s),c={},A=a.INSTANCES_LENGTH;if(a.POSITION){const{byteOffset:e}=a.POSITION;c.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:A,componentType:5126,array:new Float32Array(t,e+h.offset,3*A).slice()},s.push(c.POSITION.array.buffer)}else if(a.POSITION_QUANTIZED){const e=a.QUANTIZED_VOLUME_OFFSET,n=a.QUANTIZED_VOLUME_SCALE,{byteOffset:i}=a.POSITION_QUANTIZED;c.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:A,componentType:5126,array:this.Kn(new Uint16Array(t,i+h.offset,3*A),e,n)},s.push(c.POSITION.array.buffer)}if(a.BATCH_ID){c.BATCH_ID=KQ(a.BATCH_ID,t,h.offset,A);const e=c.BATCH_ID.array&&c.BATCH_ID.array.buffer;e&&s.indexOf(e)<0&&s.push(e)}if(a.NORMAL_UP){let{byteOffset:e}=a.NORMAL_UP;c.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:A,componentType:5126,array:new Float32Array(t,e+h.offset,3*A).slice()},s.push(c.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT.byteOffset,c.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:A,componentType:5126,array:new Float32Array(t,e+h.offset,3*A).slice()},s.push(c.NORMAL_RIGHT.array.buffer)}else if(a.NORMAL_UP_OCT32P){let{byteOffset:e}=a.NORMAL_UP_OCT32P;c.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:A,componentType:5126,array:this.Xn(new Uint16Array(t,e+h.offset,2*A))},s.push(c.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT_OCT32P.byteOffset,c.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:A,componentType:5126,array:this.Xn(new Uint16Array(t,e+h.offset,2*A))},s.push(c.NORMAL_RIGHT.array.buffer)}if(a.SCALE){const{byteOffset:e}=a.SCALE;c.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:A,componentType:5126,array:new Float32Array(t,e+h.offset,A).slice()},s.push(c.SCALE.array.buffer)}else if(a.SCALE_NON_UNIFORM){const{byteOffset:e}=a.SCALE_NON_UNIFORM;c.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:A,componentType:5126,array:new Float32Array(t,e+h.offset,3*A).slice()},s.push(c.SCALE_NON_UNIFORM.array.buffer)}return{count:A,batchTable:l,batchTableBin:u,featureTable:a,i3dm:c,transferables:s}}Xn(t){const e=t.length/2,n=new Float32Array(3*e),i=[];for(let r=0;r<e;r++)bK(i,t[2*r],t[2*r+1],65535),n[3*r]=i[0],n[3*r+1]=i[1],n[3*r+2]=i[2];return n}Kn(t,e,n){return oX(new Float32Array(t.length),t,e,n)}Hn(){return null}};function bK(t,e,n,i){if(t[0]=wK(e,i),t[1]=wK(n,i),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*CK(e),t[1]=(1-Math.abs(e))*CK(t[1])}return Pg(t,t)}function wK(t,e){return function(t,e,n){return t<0?0:t>n?n:t}(t,0,e=null!=(n=e)?n:255)/e*2-1;var n}function CK(t){return t<0?-1:1}let PK=class{constructor(){}load(t,e,n=0,i=0){return e?(i||(i=e.byteLength),this.zn(t,e,n,i)):kd.getArrayBuffer(t,{}).then((e=>{const r=e.data;return i||(i=r.byteLength),this.zn(t,r,n,i)}))}zn(t,e,n,i){return this.Yn(e,n,i,t).then((t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts}))}Yn(t,e,n,i){const r=new DataView(t,e,n),o=r.getUint32(4,!0);if(1!==o){const t="Unsupported pnts version: "+o+", url:"+i;return console.warn(t),{error:t}}if(r.getUint32(8,!0)!==r.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+i;return console.warn(t),{error:t}}const s=[t],{featureTable:a,featureTableBin:h,batchTable:l,batchTableBin:u}=sX(r,e+28,s),c=a.QUANTIZED_VOLUME_OFFSET,A=a.QUANTIZED_VOLUME_SCALE,f=a.POINTS_LENGTH;let d,p={};if(a.extensions&&a.extensions["3DTILES_draco_point_compression"]){p=a.extensions["3DTILES_draco_point_compression"],d=new DataView(t,p.byteOffset+h.offset,p.byteLength);const e={attributes:p.properties,useUniqueIDs:!1};return this.Zn||(this.Zn=vK().draco),this.Zn(d,e).then((e=>{const n=e.attributes;!a.POSITION&&!a.POSITION_QUANTIZED||n.POSITION||n.POSITION_QUANTIZED||(n.POSITION=a.POSITION,n.POSITION_QUANTIZED=a.POSITION_QUANTIZED),!(a.RGB||a.RGBA||a.RGB565)||n.RGB||n.RGBA||n.RGB565||(n.RGB=a.RGB,n.RGBA=a.RGBA,n.RGB565=a.RGB565),!a.NORMAL&&!a.NORMAL_OCT16P||n.NORMAL||n.NORMAL_OCT16P||(n.NORMAL=a.NORMAL,n.NORMAL_OCT16P=a.NORMAL_OCT16P);const i=this.Wn(t,e.attributes,h.offset,f,s,c,A);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;i.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:rX(t.constructor),array:t},s.push(t.buffer)}else if(a.BATCH_ID||Object.keys(l).length){i.BATCH_ID=a.BATCH_ID?KQ(a.BATCH_ID,t,h.offset,f):MK(f);const e=i.BATCH_ID.array&&i.BATCH_ID.array.buffer;e&&s.indexOf(e)<0&&s.push(e)}return{count:f,batchTable:l,batchTableBin:u,featureTable:a,pnts:i,transferables:s}}))}const g=this.Wn(t,a,h.offset,f,s,c,A);if(a.BATCH_ID||Object.keys(l).length){g.BATCH_ID=a.BATCH_ID?KQ(a.BATCH_ID,t,h.offset,f):MK(f);const e=g.BATCH_ID.array&&g.BATCH_ID.array.buffer;e&&s.indexOf(e)<0&&s.push(e)}return Promise.resolve({count:f,batchTable:l,batchTableBin:u,featureTable:a,pnts:g,transferables:s})}Wn(t,e,n,i,r,o,s){const a={};if(e.POSITION){let{byteOffset:o,array:s}=e.POSITION;o=o||0;const h=s?0:n;if(!s){const e=t.slice(o+h,o+h+3*i*4);s=new Float32Array(e)}a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:i,componentType:5126,array:s},r.push(s.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:h}=e.POSITION_QUANTIZED;const{array:l}=e.POSITION_QUANTIZED;h=h||0,a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:i,componentType:5126,array:this.Kn(l||new Uint16Array(t,h+(l?0:n),3*i),o,s)},r.push(a.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:o,array:s}=e.RGBA;o=o||0;const h=s?0:n;if(!s){const e=t.slice(o+h,o+h+4*i);s=new Uint8Array(e)}a.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:i,componentType:5121,array:s},r.push(s.buffer)}else if(e.RGB){let{byteOffset:o,array:s}=e.RGB;o=o||0;const h=s?0:n;if(!s){const e=t.slice(o+h,o+h+3*i);s=new Uint8Array(e)}a.RGB={byteStride:0,byteOffset:0,itemSize:3,count:i,componentType:5121,array:s},r.push(s.buffer)}else if(e.RGB565){let{byteOffset:o,array:s}=e.RGB565;o=o||0;const h=s?0:n;if(!s){const e=t.slice(o+h,o+h+2*i);s=new Uint16Array(e)}a.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:i,componentType:5123,array:s},r.push(s.buffer)}if(e.NORMAL){let{byteOffset:o,array:s}=e.NORMAL;o=o||0;const h=s?0:n;if(!s){const e=t.slice(o+h,o+h+3*i*4);s=new Float32Array(e)}a.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:i,componentType:5126,array:s},r.push(s.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:o,array:s}=e.NORMAL_OCT16P;o=o||0;const h=s?0:n;if(!s){const e=t.slice(o+h,o+h+2*i);s=new Uint8Array(e)}a.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:i,componentType:5121,array:s},r.push(s.buffer)}return a}Kn(t,e,n){return oX(new Float32Array(t.length),t,e,n)}Hn(){return null}};function MK(t){const e=iQ(t),n=new e(t);for(let i=0;i<t;i++)n[i]=i;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:rX(e),array:n}}if(cE){const t=Al.VERSION;t.indexOf("1.0.0-beta")>=0||t.indexOf("1.0.0-alpha")>=0?cr("@maptalks/3dtiles",cE.inject(nZ)):cr("@maptalks/3dtiles",(function(){return cE.inject(nZ)}))}else cr("@maptalks/3dtiles",nZ);const TK="${",SK=`function(t){\n/*!\n     * @maptalks/gltf-loader v0.98.4\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.org\n     */\nvar e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3],c=e[4],a=e[5],u=e[6],h=e[7],f=e[8],l=e[9],d=e[10],m=e[11],p=e[12],w=e[13],g=e[14],y=e[15],_=n[0],b=n[1],A=n[2],T=n[3];return t[0]=_*r+b*c+A*f+T*p,t[1]=_*s+b*a+A*l+T*w,t[2]=_*i+b*u+A*d+T*g,t[3]=_*o+b*h+A*m+T*y,_=n[4],b=n[5],A=n[6],T=n[7],t[4]=_*r+b*c+A*f+T*p,t[5]=_*s+b*a+A*l+T*w,t[6]=_*i+b*u+A*d+T*g,t[7]=_*o+b*h+A*m+T*y,_=n[8],b=n[9],A=n[10],T=n[11],t[8]=_*r+b*c+A*f+T*p,t[9]=_*s+b*a+A*l+T*w,t[10]=_*i+b*u+A*d+T*g,t[11]=_*o+b*h+A*m+T*y,_=n[12],b=n[13],A=n[14],T=n[15],t[12]=_*r+b*c+A*f+T*p,t[13]=_*s+b*a+A*l+T*w,t[14]=_*i+b*u+A*d+T*g,t[15]=_*o+b*h+A*m+T*y,t}function r(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t,n,r){var s=new e(3);return s[0]=t,s[1]=n,s[2]=r,s}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function c(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function a(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function u(t,e,n,r,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=s,t}function h(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3];return t[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*o,t[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*o,t[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*o,t[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*o,t}function f(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)}),r(),function(){var t;t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var l,d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};r(),s(1,0,0),s(0,1,0),f(),f(),l=new e(9),e!=Float32Array&&(l[1]=0,l[2]=0,l[3]=0,l[5]=0,l[6]=0,l[7]=0),l[0]=1,l[4]=1,l[8]=1;let m=0;function p(t){return null==t}function w(t){return!p(t)}function g(t){return!p(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function y(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function _(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+t)}function b(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function A(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return r.buffer}const T=[],x=[],I=[],M=[0,0,0],E=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),v=[1,1,1];function O(t,e,n,r,s,i,o){const c=_(o),a=c.BYTES_PER_ELEMENT;if((0===s||s===r*a)&&i%a==0){const s=new c(e,i,n*r);return t.set(s),t}0===s&&(s=r*a);const u=new Uint8Array(r*a);for(let o=0;o<n;o++){let n=null;const h=new Uint8Array(e,s*o+i,r*a);u.set(h),n=new c(u.buffer,0,r);for(let e=0;e<r;e++)t[o*r+e]=n[e]}return t}const P="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function k(t,e,n){const r=new Uint8Array(t,e,n);return P.decode(r)}const N={get:function(t,e={},n){e||(e={});const r=new AbortController,s=r.signal,i=y({},e);i.signal=s,i.method||(i.method="GET"),i.referrerPolicy=i.referrerPolicy||"origin","undefined"==typeof window||i.referrer||(i.referrer=window.location.href),n&&(t=n(t));const o=fetch(t,i).then((t=>{const n=this.t(t,e.responseType);return n.message?n:n.then((n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n)).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}))})).catch((t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t}));return o.xhr=r,o},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:\`incorrect http request with status code(${TK}t.status}): ${TK}t.statusText}\`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={},n)=>(e||(e={}),e.responseType="arraybuffer",N.get(t,e,n)),getJSON:function(t,e={},n){return e&&e.jsonp?N.jsonp(t):((e=e||{}).responseType="json",N.get(t,e,n))},jsonp:function(t){const e="_maptalks_jsonp_"+m++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise((t=>{window[e]=function(r){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(r)},document.getElementsByTagName("head")[0].appendChild(n)}))}};class S{constructor(t,e,n,r,s){this.i=t,this.decoders=e,this.o=n,this.images={},this.u={},this.h=r||{},this.l=s}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const r=this.buffers[t.id],s=this.m(e,r);return this.getImageByBuffer(s,n)}if(this.u[t.id])return this.u[t.id].then((()=>{const r=this.buffers[t.id],s=this.m(e,r);return this.getImageByBuffer(s,n)}));if(b(t.uri)){const r=this.buffers[t.id]=A(t.uri),s=this.m(e,r);return this.getImageByBuffer(s,n)}let r;const s=t.uri.indexOf("blob:")>=0;return r=t.uri.indexOf("://")>0||s?t.uri:this.rootPath+"/"+t.uri,this.u[t.id]=N.getArrayBuffer(r,this.h,this.l).then((r=>{const s=this.buffers[t.id]=r.data,i=this.m(e,s);return this.getImageByBuffer(i,n)}))}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;return n[e.mimeType]?n[e.mimeType](t,{supportedFormats:this.o}):"image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType?(console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this.p(e.id,t)}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.u[t.id]?this.u[t.id].then((()=>this.images[t.id])):this.u[t.id]=this.p(t.id,e)}p(t,e){return new Promise(((n,r)=>{let s=e;this.l&&(s=this.l(e)),this.i(s,this.h,((s,i)=>{s?r(s):(URL.revokeObjectURL(e),this.images[t]=i,n(this.images[t]))}))}))}}const B=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],R=[];class U{constructor(t,e,n,r,s){this.rootPath=t,this.gltf=e,this._=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this.A(),this.h=r,this.l=s}T(t,e){const n=this.gltf,r=n.accessors[e];if(void 0===r.bufferView)return this.accessors[r.id]=this.I(t,e,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);const s=n.bufferViews[r.bufferView];return this.M(s).then((n=>{const{buffer:s,byteOffset:i}=n;return this.accessors[r.id]=this.I(t,e,s,i)}))}M(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then((()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}));if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(b(e.uri)){const t=this.buffers[e.id]=A(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=N.getArrayBuffer(t,this.h,!n&&this.l).then((r=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=r.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}I(t,e,n,r=0){const s=this.gltf,i=s.accessors[e],o=void 0!==i.bufferView?s.bufferViews[i.bufferView]:{},c=(o.byteOffset||0)+r,a=this.v(i.type),u=_(i.componentType),f=o.byteStride||0,l={array:void 0,name:t,accessorName:e,byteLength:i.count*a*u.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:a,max:i.max,min:i.min,extensions:i.extensions};if(i.min&&(l.min=i.min),i.max&&(l.max=i.max),n)if(this._)l.byteStride=f,l.byteOffset=c+(i.byteOffset||0),!f||f===a*u.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(l.array=this.O(n,i.count,a,c+(i.byteOffset||0),u),l.array.buffer.byteLength===l.byteLength&&(l.byteOffset=0)):l.array=new Uint8Array(n,c,o.byteLength);else if(i.interleaved){l.byteStride=0,l.byteOffset=0;const t=new u(i.count*a);if(l.array=O(t,n,i.count,a,f,c+(i.byteOffset||0),i.componentType),l.extensions&&l.extensions.WEB3D_quantized_attributes&&a>2){const t=new Float32Array(l.array.length),{decodeMatrix:e}=l.extensions.WEB3D_quantized_attributes;for(let n=0;n<l.array.length;n+=a){R[0]=l.array[n],R[1]=l.array[n+1],R[2]=l.array[n+2],R[3]=1;const r=h(R,R,e);t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2]}l.componentType=5126,l.array=t}}else l.byteStride=0,l.array=this.O(n,i.count,a,c+(i.byteOffset||0),u),l.byteOffset=l.array.byteOffset;else{l.array=new u(i.count);const t=l.min||l.max;t&&(l.array[0]=t[0],l.array[1]=t[1],l.array[2]=t[2])}return l}A(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}O(t,e,n,r,s){return r%s.BYTES_PER_ELEMENT!=0&&(t=t.slice(r,r+e*n*s.BYTES_PER_ELEMENT),r=0),new s(t,r,n*e)}v(t){const e=B.indexOf(t);return B[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map((t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this.M(e).then((r=>{const{buffer:s,byteOffset:i}=r,o=k(s,i+(e.byteOffset||0),n);return t.content=o,t}))}if(t.uri){if(b(t.uri)){const e=A(t.uri),n=k(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return N.get(e,this.h,this.l).then((e=>(t.content=e,t)))}}return Promise.resolve(t)}));return Promise.all(n).then((()=>t))}}class C extends S{constructor(t,e,n,r,s,i,o,c){super(r,s,i,o,c),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new U(t,e,n,o,c)}iterate(t,e){const n=this.gltf[e];if(!n)return;let r=0;for(const e in n)t(e,n[e],r++)}createNode(t){const e={};if(w(t.name)&&(e.name=t.name),w(t.children)&&(e.children=t.children),w(t.jointName)&&(e.jointName=t.jointName),w(t.matrix)&&(e.matrix=t.matrix),w(t.rotation)&&(e.rotation=t.rotation),w(t.scale)&&(e.scale=t.scale),w(t.translation)&&(e.translation=t.translation),w(t.extras)&&(e.extras=t.extras),w(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(T,e.translation||M),s=function(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,c=r+r,a=s+s,u=n*o,h=r*o,f=r*c,l=s*o,d=s*c,m=s*a,p=i*o,w=i*c,g=i*a;return t[0]=1-f-m,t[1]=h+g,t[2]=l-w,t[3]=0,t[4]=h-g,t[5]=1-u-m,t[6]=d+p,t[7]=0,t[8]=l+w,t[9]=d-p,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(x,e.rotation||E),i=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(I,e.scale||v);return n(i,s,i),n(t,r,i)}return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}P(t){const e={};for(const n in t){const r=t[n];let s,i;r.instanceTechnique&&r.instanceTechnique.values?(s=r.instanceTechnique,i=s.values.diffuse):(s=r,i=s.values.tex||s.values.diffuseTex||s.values.diffuse);const o={baseColorTexture:{index:i}};r.name&&(o.name=r.name),r.extensions&&(o.extensions=r.extensions),r.extras&&(o.extras=r.extras),e[n]=o}return e}k(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],r=(n.byteOffset||0)+this.glbBuffer.byteOffset,s=n.byteLength,i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,r,s);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}N(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.k(n).then((t=>{const r=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:r}}))}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,r;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,r=n.values.diffuse):(n=e,r=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const s=this.gltf.textures[r];if(!s)return null;const i=this.gltf.samplers[s.sampler];return{format:s.format||6408,internalFormat:s.internalFormat||6408,type:s.type||5121,sampler:i,source:this.gltf.images[s.source]}}getMaterial(){return null}getAnimations(){return null}}const L=9729;class D extends S{constructor(t,e,n,r,s,i,o,c){super(r,s,i,o,c),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new U(t,e,n,o,c)}iterate(t,e){const n=this.gltf[e];if(n)for(let e=0;e<n.length;e++)t(e,n[e],e)}createNode(t){const e={};return y(e,t),!w(t.weights)&&this.gltf.meshes&&w(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}N(t){const e=this.gltf.textures[t];if(!e)return null;let n=e.source;if(e.extensions&&e.extensions.EXT_texture_webp&&(n=e.extensions.EXT_texture_webp.source),!w(n))return null;const r=this.gltf.images[n];return this.k(r).then((t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};y(n,e);const s=w(e.sampler)?this.gltf.samplers[e.sampler]:void 0;if(s&&(n.sampler=s,n.sampler.magFilter=s.magFilter||L,n.sampler.minFilter=s.minFilter||9987,n.sampler.wrapS=s.wrapS||10497,n.sampler.wrapT=s.wrapT||10497),"image/ktx2"===n.image.mimeType&&!n.image.mipmap&&n.sampler&&n.sampler.minFilter!==L&&9728!==n.sampler.minFilter){const t=n.sampler.minFilter;n.sampler.minFilter=9984===t||9986===t?9728:L}return t.format&&(n.format=t.format),n}))}k(t){if(!w(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this.S(e,t)}return null}S(t,e){const n=this.m(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}m(t,e,n){n=n||0;const r=(t.byteOffset||0)+n,s=t.byteLength;return new Uint8Array(e,r,s)}B(t,e){const n=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)n[e]=String.fromCharCode(t[e]);n.join("");const r="data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(n)));return r}getAnimations(t){const e=[];return t.forEach((t=>{e.push(this.getSamplers(t.samplers))})),Promise.all(e).then((e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t}))}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(w(t[n].input)||w(t[n].output))&&(e.push(this.accessor.T("input",t[n].input)),e.push(this.accessor.T("output",t[n].output)));return Promise.all(e).then((e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t}))}}const q="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class F{static read(t,e=0,n=0){n||(n=t.byteLength);const r=new DataView(t,e,n),s=r.getUint32(4,!0);if(1===s)return F.readV1(r,e);if(2===s)return F.readV2(t,e);throw new Error("Unsupported glb version : "+s)}static readV1(t,e){const n=t.getUint32(8,!0),r=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const s=V(t.buffer,20+e,r);return{json:JSON.parse(s),glbBuffer:{byteOffset:20+e+r,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,r,s;const i=new DataView(t,e+12);let o=0;for(;o+8<i.byteLength;){const c=i.getUint32(o,!0);o+=4;const a=i.getUint32(o,!0);if(o+=4,1313821514===a)n=V(t,e+12+o,c);else if(5130562===a){s=e+12+o,r=c;break}o+=c}return{json:JSON.parse(n),glbBuffer:{byteOffset:s,buffer:t,byteLength:r}}}}function V(t,e,n){if(q){const r=new Uint8Array(t,e,n);return q.decode(r)}return function(t){const e=t.length;let n="";for(let r=0;r<e;){let s=t[r++];if(128&s){let n=j[s>>3&7];if(!(64&s)||!n||r+n>e)return null;for(s&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;s=s<<6|63&e}}n+=String.fromCharCode(s)}return n}(new Uint8Array(t,e,n))}const j=[1,1,1,1,2,2,3,0],H=[0,0,0],K=[0,0,0,1],X=[1,1,1],$={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},G={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},z={R(t,e,n,r,s,o,c,a){const u=w(t)?e.animations:[e.animations[0]],h={};for(let e=0;e<u.length;e++){const f=u[e],l=f.name||e;if(w(t)&&l!==t)continue;const m=f.channelsMap[n];if(m)for(let t=0;t<m.length;t++){const e=m[t];"translation"===e.target.path?(this.U(s,f.samplers[e.sampler],r,1),h.translation=i(H,s)):"rotation"===e.target.path?(this.C(o,f.samplers[e.sampler],r,1),h.rotation=d(K,o)):"scale"===e.target.path?(this.U(c,f.samplers[e.sampler],r,1),h.scale=i(X,c)):"weights"===e.target.path&&a&&(this.U(a,f.samplers[e.sampler],r,a.length),h.weights=a)}}return h},U(t,e,n,r){switch(e.interpolation){case"LINEAR":{const s=this.L(G,e,n,1*r);s&&(t=function(t,e,n,r){for(let s=0;s<t.length;s++)t[s]=e[s]+r*(n[s]-e[s]);return t}(t,s.PREVIOUS,s.NEXT,s.INTERPOLATION));break}case"STEP":{const s=this.L(G,e,n,1*r);s&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this.L(G,e,n,3*r);s&&(t=this.D(t,s,e.input.array,3*r));break}}return t},C(t,e,n){switch(e.interpolation){case"LINEAR":{const r=this.L(G,e,n,1);r&&function(t,e,n,r){var s,i,o,c,a,u=e[0],h=e[1],f=e[2],l=e[3],d=n[0],m=n[1],p=n[2],w=n[3];(i=u*d+h*m+f*p+l*w)<0&&(i=-i,d=-d,m=-m,p=-p,w=-w),1-i>1e-6?(s=Math.acos(i),o=Math.sin(s),c=Math.sin((1-r)*s)/o,a=Math.sin(r*s)/o):(c=1-r,a=r),t[0]=c*u+a*d,t[1]=c*h+a*m,t[2]=c*f+a*p,t[3]=c*l+a*w}(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const r=this.L(G,e,n,1);r&&(t=u(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this.L(G,e,n,3);if(r){for(let t=0;t<r.PREVIOUS.length;t++)r.PREVIOUS[t]=Math.acos(r.PREVIOUS[t]),r.NEXT[t]=Math.acos(r.NEXT[t]);t=this.D(t,r,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},q(t,e){const n=t.length;let r,s,i,o=0,c=n-1,a=Math.floor((o+c)/2);for(;o<=n-1&&c>=0;){if(o===c)return null;if(t[a]<=e&&e<=t[a+1]){const n=t[a];return r=a,s=a+1,i=(e-n)/(t[a+1]-n),{preIndx:r,nextIndex:s,interpolation:i}}e<t[a]?(c=a,a=Math.floor((o+c)/2)):t[a+1]<e&&(o=a,a=Math.floor((o+c)/2))}return null},L(t,e,n,r){const s=e.input.array,i=e.output.array,o=e.output.itemSize;(n<s[0]||n>s[s.length-1])&&(n=Math.max(s[0],Math.min(s[s.length-1],n))),n===s[s.length-1]&&(n=s[0]);const c=this.q(s,n);if(!c||!c.nextIndex)return null;const{preIndx:a,nextIndex:u,interpolation:h}=c;t.PREINDEX=a,t.NEXTINDEX=u,t.INTERPOLATION=h;const f=o*r;return t.PREVIOUS=i.subarray(t.PREINDEX*f,(t.PREINDEX+1)*f),t.NEXT=i.subarray(t.NEXTINDEX*f,(t.NEXTINDEX+1)*f),t},D(t,e,n,r){const s=e.INTERPOLATION,i=n[e.PREINDEX],o=n[e.NEXTINDEX];for(let n=0;n<3;n++){const c=e.PREVIOUS[r+n],a=(o-i)*e.PREVIOUS[2*r+n],u=e.NEXT[3+n],h=(o-i)*e.NEXT[n],f=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*c+(Math.pow(s,3)-2*Math.pow(s,2)+s)*a+(2*-Math.pow(s,3)+3*Math.pow(s,2))*u+(Math.pow(s,3)-Math.pow(s,2))*h;t[n]=f}return t},getAnimationClip(t,e,n,r){const s=t.nodes[e]&&t.nodes[e].weights;return o(H,...$.TRANSLATION),u(K,...$.ROTATION),o(X,...$.SCALE),this.R(r,t,e,n,H,K,X,s)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach(((e,n)=>{let r=-1/0,s=1/0;const i=e.channels;for(let t=0;t<i.length;t++){const n=i[t],o=e.samplers[n.sampler].input.array;o[o.length-1]>r&&(r=o[o.length-1]),o[0]<s&&(s=o[0])}const o=e.name||n;t.timeSpan[o]={max:r,min:s}})),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?w(e)?n[e]:n[Object.keys(n)[0]]:null}};let J=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(ft){}t&&"undefined"!=typeof createImageBitmap&&(J=!0)}const W="undefined"==typeof document?null:document.createElement("canvas");class Q{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),this.h=this.options.fetchOptions||{},e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:r}=F.read(e.buffer,e.byteOffset,e.byteLength);this.F(t,n,r)}else this.F(t,e);this.V=new U(this.rootPath,this.gltf,this.glbBuffer,this.h,this.options.urlModifier),this.j()}j(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders["image/ktx2"])throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded");if(t.indexOf("EXT_meshopt_compression")>=0)throw new Error("EXT_meshopt_compression extension is not supported yet.")}}H(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.V.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then((e=>(t.KHR_techniques_webgl=e,t))):Promise.resolve(t)}load(t){t=t||{};const e=this.K(t),n=this.X(),r=this.$(),s=this.H();return Promise.all([e,n,r,s]).then((t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0])))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const n=e[t];n.channelsMap={};for(let t=0;t<n.channels.length;t++){const e=n.channels[t];n.channelsMap[e.target.node]||(n.channelsMap[e.target.node]=[]),n.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let n=0;n<e.length;n++)e[n].uri&&e[n].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[n].uri});for(let e=0;e<n.length;e++)n[e].uri&&n[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[e].uri})}return t}static getAnimationClip(t,e,n,r){return z.getAnimationClip(t,e,n,r)}static getAnimationTimeSpan(t,e){return z.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return _(t)}static readInterleavedArray(t,e,n,r,s,i,o){return O(t,e,n,r,s,i,o)}F(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=J?st.bind(this):this.options.requestImage||Y,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new D(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.h,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="buffer_"+n}),"buffers"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors")):(this.adapter=new C(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.h,this.options.urlModifier),this.adapter.iterate(((t,e,n)=>{e.id="accessor_"+n}),"accessors"),this.adapter.iterate(((t,e,n)=>{e.id="image_"+n}),"images"))}G(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||g(t.children[0])))return t;const r=t.children.map((t=>{const n=e[t];return n.nodeIndex=t,this.G(n,e)}));t.children=r}var n;return t}K(t){return this.J(t).then((t=>{const e=this.scenes=[];let n;for(const e in t)t[e]=this.G(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate(((r,s,i)=>{const o={};s.name&&(o.name=s.name),s.nodes&&(o.nodes=s.nodes.map((e=>t[e]))),this.gltf.scene===r&&(n=i),e.push(o)}),"scenes");const r={textures:this.gltf.textures,asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.P(this.gltf.materials);r.materials=t}return delete this.gltf.buffers,r.json=this.gltf,r}))}J(t){return this.W(t).then((()=>{const t=this.nodes={};return this.adapter.iterate(((e,n)=>{const r=this.adapter.createNode(n,this.meshes,this.skins);t[e]=r}),"nodes"),t}))}Y(){this.skins=[];const t=[];return this.adapter.iterate(((e,n,r)=>{t.push(this.Z(n).then((t=>{t.index=r,this.skins.push(t)})))}),"skins"),t}Z(t){const e=t.inverseBindMatrices;return this.adapter.accessor.T("inverseBindMatrices",e).then((e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t)))}X(){const t=this.gltf.animations;return w(t)?this.adapter.getAnimations(t):null}W(t){this.meshes={};let e=[];return this.adapter.iterate(((n,r,s)=>{e.push(this.tt(r,t).then((t=>{t.index=s,this.meshes[n]=t})))}),"meshes"),e=e.concat(this.Y()),Promise.all(e)}tt(t,e){const n=t.primitives.map((t=>this.et(t,e))).filter((t=>!!t));return Promise.all(n).then((e=>{const n={};return y(n,t),n.primitives=e,n}))}$(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter.N(n));return Promise.all(e).then((e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t]&&e[t].image.array;if(n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},r=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[r[t]]=e[t]);return n}return e}))}et(t,e){let n;const r=[],s=t.extensions;if(w(t.targets))for(let e=0;e<t.targets.length;e++){const n=t.targets[e];for(const t in n){const s=this.adapter.accessor.T(\`morphTargets_${TK}t}_${TK}e}\`,n[t]);s&&r.push(s)}}if(s&&s.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:i,attributes:o}=s.KHR_draco_mesh_compression,c=this.gltf.bufferViews[i],a=this.V.M(c).then((n=>{const{buffer:r,byteOffset:s}=n;let{byteOffset:i}=c;const a=c.byteLength;i||(i=0);const u=new DataView(r,s+i,a),h={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(u,h).then((t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e}))}));r.push(a),n=Promise.all(r)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor.T(t,e[t]);n&&r.push(n)}if(w(t.indices)){const e=this.adapter.accessor.T("indices",t.indices);e&&r.push(e)}n=Promise.all(r)}return n.then((e=>{if(s&&s.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,r;const i={attributes:e.reduce(((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)r=r||{},r[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:r,array:s}=e,i=s.length/r;for(let e=0;e<i;e++)for(let i=0;i<r;i++){const o=e*r+i;s[o]<t[i]&&(t[i]=s[o]),s[o]>n[i]&&(n[i]=s[o])}if(e.quantization){const r=e.quantization,s=r.range/(1<<r.quantizationBits),i=r.minValues;a(t,t,s),c(t,t,i),a(n,n,s),c(n,n,i)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t}),{}),material:t.material};return n&&(i.indices=n),r&&(i.morphTargets=r),i.mode=w(t.mode)?t.mode:4,w(t.extras)&&(i.extras=t.extras),i}))}}function Y(t,e,n){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!W)return void n(new Error("There is no canvas to draw image!"));W.width=r.width,W.height=r.height;const t=W.getContext("2d",{willReadFrequently:!0});t.drawImage(r,0,0,r.width,r.height);const e=t.getImageData(0,0,r.width,r.height),s={width:r.width,height:r.height,data:new Uint8Array(e.data)};n(null,s)},r.onerror=function(t){n(t)},r.src=t}const Z=[],tt=[],et=30;let nt,rt;function st(t,e,n){nt||(nt=new OffscreenCanvas(2,2),rt=nt.getContext("2d",{willReadFrequently:!0}));let r=null;if(g(t))this.options.urlModifier&&(t=this.options.urlModifier(t)),Z.push([t,e,n,this]),it();else{const e=new Blob([t]);r=createImageBitmap(e),r.then(ot.bind(this)).then((t=>{n(null,t)})).catch((t=>{console.warn(t),n(t)}))}}function it(){if(!Z.length||tt.length>et)return;const t=Z.shift(),[e,n,r,s]=t;tt.push(t),fetch(e,n).then((t=>t.arrayBuffer())).then((t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)})).then(ot.bind(s)).then((e=>{r.call(s,null,e);const n=tt.indexOf(t);tt.splice(n,1),it()})).catch((e=>{console.warn(e),r.call(s,e);const n=tt.indexOf(t);tt.splice(n,1),it()}))}function ot(t){let{width:e,height:n}=t;ct(e)||(e=at(e)),ct(n)||(n=at(n));const r=this.options.maxTextureSize;r&&(e=Math.min(r,e),n=Math.min(r,n)),nt.width=e,nt.height=n,rt.drawImage(t,0,0,e,n),t.close();const s=rt.getImageData(0,0,e,n);return{width:e,height:n,data:new Uint8Array(s.data)}}function ct(t){return!(t&t-1)&&0!==t}function at(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}\n/*!\n     * @maptalks/gl v0.102.1\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.com\n     */const ut=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},ht=ut(),ft=ht.gl_trans__coders=ht.gl_trans__coders||{};ft.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),s=ht.gl_trans__coders=ht.gl_trans__coders||{};let i=\`${TK}r}\\n    const _____getGlobal = ${TK}ut.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};\`;for(const t in s)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(i+='tran_____scoders["'+t+'"] ='+s[t].toString()+"\\n;");return i+="\\n"+e.substring(r.length),i},ft.registerTranscoder=function(t,e){ft[t]=e},ft.getTranscoder=function(t){return ft[t]};const lt={"image/crn":ft.crn&&ft.crn(),"image/ktx2":ft.ktx2&&ft.ktx2(),"image/cttf":ft.ktx2&&ft.ktx2(),"draco":ft.draco&&ft.draco()};let dt;const mt={};function pt(t,e,n){return new Q(t,e,n).load({skipAttributeTransform:!0})}function wt(t,e,n,r){const s=e.lastIndexOf("/"),i=e.slice(0,s);r&&(e=r(e));const o=(...e)=>gt.call(this,t,...e);return function(t,e){return N.getArrayBuffer(t,e)}(e,n).then((t=>{if(t.message)return t;const s=t.data;return new DataView(s,s.byteOffset,s.byteLength).getUint32(4,!0)>2?function(t,e){return N.getJSON(t,e)}(e,n).then((t=>t.message?t:pt(i,t,{requestImage:o,decoders:lt,transferable:!0,fetchOptions:n,urlModifier:r}))):pt(i,{buffer:t.data,byteOffset:0},{requestImage:o,decoders:lt,transferable:!0,fetchOptions:n,urlModifier:r})}))}function gt(t,e,n,r){t?mt[e]?mt[e].push(r):(mt[e]=[r],self.postMessage({type:"<request>",command:"sendImageData",actorId:t,workerId:dt,params:e})):function(t,e){const n=new Image;n.onload=()=>{if(!yt)return void e(new Error("There is no canvas to draw image!"));yt.width=n.width,yt.height=n.height;const t=yt.getContext("2d");t.drawImage(n,0,0,n.width,n.height);const r=t.getImageData(0,0,n.width,n.height),s={width:n.width,height:n.height,data:new Uint8Array(r.data)};e(null,s,[s.data.buffer])},n.onerror=function(t){e(t)},n.src=t}(e,r)}const yt="undefined"==typeof document?null:document.createElement("canvas");t.loadGLTF=wt,t.onmessage=function(t){const e=t.data,n=e.url;if("addLayer"===e.command||"removeLayer"===e.command)dt=t.workerId,self.postMessage({type:"<response>",actorId:e.actorId,workerId:dt,params:"ok"});else if(n)!function(t){const e=t.data,n=t.callback,r=t.actorId,s=e.url,i=e.fetchOptions||{};i.referrerPolicy=i.referrerPolicy||"origin",i.referrer=e.referrer,wt(r,s,i).then((t=>{t.message?self.postMessage({callback:n,error:t}):self.postMessage({callback:n,data:t},t.transferables)})).catch((t=>{self.postMessage({callback:n,error:t})})),mt.receive=n}(t);else if(e.imageUrl){const t=mt[e.imageUrl];if(delete mt[e.imageUrl],t)for(let n=0;n<t.length;n++)t[n](null,e.result)}}}`;function IK(t){return null==t}function EK(t){return!IK(t)}function OK(t,e){if(!t||!e)return null;let n=e;if(Array.isArray(e)){if(!gi.isNumber(e[0]))return null;n=new $o(e)}const i=t.coordinateToPointAtRes(n,t.getGLRes()),r=t.altitudeToPoint(n.z||0,t.getGLRes());return[i.x,i.y,r]}function RK(t,e){return Math.abs(t)*Math.sign(e)}function DK(t,e,n){const i=Ss.Measurer.getInstance().measureLenBetween(t,e);let r=n.count;r&&n.snapToEndVertexes&&(r-=1);const o=r>0?i/r:n.gapLength+n.bboxWidth,s=Math.floor(i/o),a=[],h=n.rotateAlongLine+function(t,e,n){const i=n.getGLRes(),r=n.coordinateToPointAtRes(t,i),o=n.coordinateToPointAtRes(e,i);return gi.computeDegree(o.x,o.y,r.x,r.y)/Math.PI*180}(t,e,n.map);if(s>=1){const r=0,l=s;if(n.snapToEndVertexes)for(let n=r;n<=l;n++){const r={coordinates:kK(t,e,o*n/i),scale:[1,1,1],rotation:[0,0,h]};a.push(r)}else for(let n=r+1;n<=l;n++){const r={coordinates:kK(t,e,o*(n-.5)/i),scale:[1,1,1],rotation:[0,0,h]};a.push(r)}if(n.scaleEndModel){const n=(i-o*s)/o,r={coordinates:kK(t,e,(o*s+(i-o*s)/2)/i),scale:[n,1,1],rotation:[0,0,h]};a.push(r)}}else if(n.scaleEndModel){const n=i/o,r={coordinates:kK(t,e,.5),scale:[n,1,1],rotation:[0,0,h]};a.push(r)}return a}function kK(t,e,n){const i=LK(t.x,e.x,n),r=LK(t.y,e.y,n);return new $o(i,r)}function LK(t,e,n){return t+n*(e-t)}const FK={},NK="undefined"==typeof document?null:document.createElement("canvas");let zK=class extends $f.Actor{constructor(t,e){super(t),this.mapId=e.getMap().id,this.t=e}loadGLTF(t){const e={url:function(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}(t),referrer:window&&window.location.href,fetchOptions:this.t.options.fetchOptions};return new Promise(((t,n)=>{this.send(e,null,((e,i)=>{e?n(e):t(i)}))}))}sendImageData(t,e){!function(t,e){const n=new Image;n.onload=()=>{if(!NK)return void e(new Error("There is no canvas to draw image!"));NK.width=n.width,NK.height=n.height;const t=NK.getContext("2d");t.drawImage(n,0,0,n.width,n.height);const i=t.getImageData(0,0,n.width,n.height),r={width:n.width,height:n.height,data:new Uint8Array(i.data)};e(null,r)},n.onerror=function(t){e(t)},n.src=t}(t,((n,i)=>{n||this.isActive()&&e(null,{result:i,imageUrl:t})}))}addLayer(t,e,n){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:e}},null,n)}removeLayer(t,e,n){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,n)}};const BK=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t)return t;throw new Error("unable to locate global object")},HK=BK(),jK=HK.gl_trans__coders=HK.gl_trans__coders||{};jK.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,i=e.substring(0,n),r=HK.gl_trans__coders=HK.gl_trans__coders||{};let o=`${i}\n    const _____getGlobal = ${BK.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const s in r)"inject"!==s&&"getTranscoder"!==s&&"registerTranscoder"!==s&&(o+='tran_____scoders["'+s+'"] ='+r[s].toString()+"\n;");return o+="\n"+e.substring(i.length),o},jK.registerTranscoder=function(t,e){jK[t]=e},jK.getTranscoder=function(t){return jK[t]};const UK={"image/crn":jK.crn&&jK.crn(),"image/ktx2":jK.ktx2&&jK.ktx2(),"image/cttf":jK.ktx2&&jK.ktx2(),draco:jK.draco&&jK.draco()};let GK;const VK={};function WK(t,e,n){return new tp(t,e,n).load({skipAttributeTransform:!0})}function qK(t,e,n,i){const r=e.lastIndexOf("/"),o=e.slice(0,r);i&&(e=i(e));const s=(...e)=>ZK.call(this,t,...e);return(a=e,h=n,kd.getArrayBuffer(a,h)).then((t=>{if(t.message)return t;const r=t.data;return new DataView(r,r.byteOffset,r.byteLength).getUint32(4,!0)>2?function(t,e){return kd.getJSON(t,e)}(e,n).then((t=>t.message?t:WK(o,t,{requestImage:s,decoders:UK,transferable:!0,fetchOptions:n,urlModifier:i}))):WK(o,{buffer:t.data,byteOffset:0},{requestImage:s,decoders:UK,transferable:!0,fetchOptions:n,urlModifier:i})}));var a,h}function ZK(t,e,n,i){t?VK[e]?VK[e].push(i):(VK[e]=[i],self.postMessage({type:"<request>",command:"sendImageData",actorId:t,workerId:GK,params:e})):function(t,e){const n=new Image;n.onload=()=>{if(!QK)return void e(new Error("There is no canvas to draw image!"));QK.width=n.width,QK.height=n.height;const t=QK.getContext("2d");t.drawImage(n,0,0,n.width,n.height);const i=t.getImageData(0,0,n.width,n.height),r={width:n.width,height:n.height,data:new Uint8Array(i.data)};e(null,r,[r.data.buffer])},n.onerror=function(t){e(t)},n.src=t}(e,i)}const QK="undefined"==typeof document?null:document.createElement("canvas"),XK=[],YK=[],JK=[],KK=[],$K=[1,1,1],t$=[],e$=[],n$=[1,1,1],i$=[],r$=new Vv,o$=function(t,e){const n=[];return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[3],n[5]=t[4],n[6]=t[5],n[7]=0,n[8]=t[6],n[9]=t[7],n[10]=t[8],n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}(function(t){const e=Math.cos(t),n=Math.sin(t),i=[];return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=e,i[5]=n,i[6]=0,i[7]=-n,i[8]=e,i}(.5*Math.PI),[0,0,0]),s$=new ht(0,0),a$=[186/255,186/255,186/255,1],h$={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},l$=new Set(["url","translationX","translationY","translationZ","rotationX","rotationY","rotationZ","scaleX","scaleY","scaleZ","anchorZ","markerPixelHeight","modelHeight"]),u$=[1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1],c$=[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],A$=[.8,.8,.1,1];let f$=class t extends Bl{constructor(t,e){const n=gi.extend({},e),i=n.symbol;super(t,n),this.options.symbol=i,this.i=!1,this.o=Np([]),this.h="gltfmarker",this.l=!0,this.u=!0,this.m={get translation(){return[0,0,0]},get rotation(){return[0,0,0]},get scale(){return[1,1,1]}},this.p()}static parseJSONData(e){const n=t.fromJSON(e);return n.setZoomOnAdded(e.zoomOnAdded),n}static fromJSON(e){return new t(e.coordinates,e.options)}static getGLTFAnchorsAlongLineString(t,e,n,i){const r=[];for(let o=0;o<t.length-1;o++){const s=DK(t[o],t[o+1],{map:n,bboxWidth:e,gapLength:i.gapLength||0,count:i.count,rotateAlongLine:i.rotateAlongLine,snapToEndVertexes:i.snapToEndVertexes,scaleEndModel:i.scaleEndModel});gi.pushIn(r,s)}return r}static combineGLTFBoundingBox(t){const e=[];for(let o=0;o<t.length;o++){const n=t[o].getBoundingBox();e.push([n.min,n.max])}const n=e[0];if(!n)return null;const i=dg([],n[0]),r=dg([],n[1]);for(let o=1;o<e.length;o++){const t=e[o],n=dg([],t[0]),s=dg([],t[1]);n[0]<i[0]&&(i[0]=n[0]),n[1]<i[1]&&(i[1]=n[1]),n[2]<i[2]&&(i[2]=n[2]),s[0]>r[0]&&(r[0]=s[0]),s[1]>r[1]&&(r[1]=s[1]),s[2]>r[2]&&(r[2]=s[2])}return{min:i,max:r}}setTransformOrigin(t){this._=t}getTransformOrigin(){return this._||this.getCenter()}getMeshes(t,e,n){let i=[];const r=this.getMap();if(e&&(this.regl=e),this.getLayer().isVisible()&&this.isVisible()&&this.T()){if(!this.v)return this.M(t,e),i;let o=this.isAnimated()||this.O()&&r.isZooming()||this.u||"multigltfmarker"===this.getGLTFMarkerType()&&this.l;if(!o){const t=this.o;Fp(t$,t),this.p(),o=!hg(t,t$)}o&&this.A(this.v,n),i=this.v.filter((t=>!!(jq(r.projViewMatrix,t.getBoundingBox())||t instanceof B_)&&(this.S(t),this.I(t),!0))),this.P(!1)}return i}getGLTFJSON(){return this.k}getAllMeshes(){return this.v}L(){return this.k}N(t){this.k=t}C(t,e){this._externSymbol=this._externSymbol||{},this._externSymbol[t]=e,"uniforms"===t&&(this.R=!0)}setUrl(t){return this.updateSymbol({url:t}),this}setSymbol(t){const e=this.getUrl();super.setSymbol(t);const n=this.getShader(),i=this.B;i&&t.url!==e&&(i.logoutGLTF(e),this.F=!1,this.D(!1),delete this.v),this.U&&this.U!==n&&this.V(i,this.regl),this.U=n,this.R=!0,this.l=!0}getCenter(){const t=this.getMap();if(!t)return null;const e=OK(t,super.getCenter()||this.getCoordinates());if(!e)return null;const n=this.q(),i=new ht([e[0]+n[0],e[1]+n[1],e[2]+n[2]]),r=t.getGLRes(),o=t.pointAtResToCoord(i,r);return o.z=i.z/t.altitudeToPoint(100,r)*100,o}getPointZ(){const t=this.getCoordinates(),e=this.getMap();return e&&t?e.altitudeToPoint(t.z||0,e.getGLRes()):null}getUrl(){const t=this._getInternalSymbol();return t&&t.url||"pyramid"}addTo(t){if(this.getLayer())throw new Error("GLTFMarker cannot be added to two or more layers at the same time.");return t.addGeometry(this),this}M(t,e){const n=this.getUrl();if(this.B=t,!this.F){const e=this.getLayer().getRenderer();t.loginGLTF(n,((...t)=>e.G.apply(e,t))),this.F=!0}const i=t.getGLTF(n);i&&!i.then&&(this.D(!0),this.j(i,t,e))}S(t,e){"effectmarker"===this.getGLTFMarkerType()?this.updateUV(e):"glowmarker"===this.getGLTFMarkerType()&&this.X();const n=this.getUniforms();if(n&&this.isDirty()&&this.H())for(const i in n)t.setUniform(i,n[i]);this.J()&&(t.transparent=!0),t.setUniform("uPickingId",this.W()),t.properties.isAnimated=this.isAnimated()}I(t){const e=this.getShader(),n=t.getDefines();let i=!1;if("pbr"===e||"pbr-lite"===e){const t=this.getLayer(),{iblTexes:e}=Xw.PBRUtils.getIBLResOnCanvas(t.getRenderer().canvas);e?n.HAS_IBL_LIGHTING||(n.HAS_IBL_LIGHTING=1,i=!0):n.HAS_IBL_LIGHTING&&(i=!0,delete n.HAS_IBL_LIGHTING)}i&&t.setDefines(n);const r=this.getLayer().getRenderer();r&&r.updateMaskDefines(t)}V(t){const e=this.getUrl(),n=this.v;t&&n&&(t.isSimpleModel(e)?this.Z(n):t.getGLTF(e)&&(n.forEach((t=>{this.S(t)})),this.Z(n)))}Z(t){const e=this.getShader();t.forEach((t=>{const n=this.Y(t.properties.geometryResource);"wireframe"===e?(t.properties.geometryResource&&!t.properties.geometryResource.copyGeometry&&t.properties.geometryResource.copyEdgeGeometry(),t.geometry=t.properties.geometryResource.copyGeometry):t.geometry=t.properties.geometryResource.geometry,t.material=n}))}A(t,e){pg($K,1,1,1);const n=Np(t$),i=this.isAnimated();this.p();const r=this.getModelMatrix(),{nodeMatrixMap:o,skinMap:s}=this.K(e);this.$($K);let a=0;t.forEach((t=>{const e=t.properties.geometryResource.nodeIndex,h=o[e],l=i&&h?h:t.nodeMatrix;Up(n,r,$K),Hp(n,n,o$),t.tt=t.tt||Np([]);const u=Hp(i$,t.tt,l);t instanceof B_?(t.positionMatrix=Hp(t.positionMatrix,n,u),t.localTransform=this.et(),this.nt(t)):t.localTransform=Hp(t.localTransform,n,u);const c=t.geometry.boundingBox.copy(r$);c.transform(t.positionMatrix,t.localTransform);const A=this.st(c);if(Math.abs(A)>Math.abs(a)&&(a=A),i){const n=s[e];n&&(t.material.set("skinAnimation",1),t.material.set("jointTextureSize",n.jointTextureSize),t.material.set("numJoints",n.numJoints),t.material.set("jointTexture",n.jointTexture));const i=t.geometry.properties.morphWeights;i&&this.it(i,t.material)}else t.material.set("skinAnimation",0)}));const h=this.rt();if(h&&(Up(n,r,$K),Hp(n,n,o$),this.ot.localTransform=Hp(this.ot.localTransform,n,this.ot.ht)),0!==a){pg(e$,0,0,a);const e=Zp(t$,e$);t.forEach((t=>{if(t instanceof B_)t.positionMatrix=Hp(t.positionMatrix,e,t.positionMatrix),this.nt(t);else{const n=Hp(t.localTransform,e,t.localTransform);t.localTransform=n}})),h&&(this.ot.localTransform=Hp(this.ot.localTransform,e,this.ot.localTransform))}t.forEach((t=>{t instanceof B_&&this.nt(t)})),this.fire("updatematrix",{target:this})}getBoundingBoxCenter(){const t=this.ct,e=this.getMap();if(!t||!this.ot||!e)return null;const n=e.getGLRes(),{min:i,max:r}=t,o=gg([],i,r);_g(o,o,.5),Sg(o,o,this.ot.localTransform);const s=new ht(o),a=e.pointAtResToCoordinate(s,n);return a.z=100/e.altitudeToPoint(100,n)*o[2],a}getBoundingBoxWidth(t){const e=this.ct;if(!e)return 0;let n=0;"x"===t?n=0:"y"===t?n=2:"z"===t&&(n=1);const{min:i,max:r}=e,o=this.lt()[n];return(r[n]-i[n])*o}getAxisXWidth(){return this.getBoundingBoxWidth("x")}getAxisYWidth(){return this.getBoundingBoxWidth("y")}getAxisZWidth(){return this.getBoundingBoxWidth("z")}$(t){const e=this.getMap(),n=e.getGLRes(),i=e.altitudeToPoint(100,n);return t[0]*=i/100,t[1]*=i/100,t[2]*=i/100,t}ut(t,e){const n=this.ct,i=e/Math.abs(n.max[1]-n.min[1]);return pg(t,i,i,i)}ft(t,e){const n=this.ct;if(!e||e<0||!n)return t;const i=this.getMap(),r=Math.abs(n.max[1]-n.min[1]),o=i.altitudeToPoint(r,i.getGLRes()),s=e*i.getGLScale()/o;return pg(t,s,s,s)}getCurrentPixelHeight(){const t=this.getBoundingBox();return Math.abs(t.max[2]-t.min[2])/this.getMap().getGLScale()}getFitTranslate(t){const e=this.ct,n=pg(t,(e.min[0]+e.max[0])/2,(e.min[1]+e.max[1])/2,(e.min[2]+e.max[2])/2);return _g(n,n,-1)}st(t){const e=this.getSymbol(),n=e&&e.anchorZ||"center";let i=0;const r=t.max[2]-t.min[2];return"bottom"===n?i=r/2:"top"===n&&(i=-r/2),i}K(t){const e=this.isAnimated(),n=this.dt(),i={},r=this.gt();if(t&&e&&this.gltfPack&&n){const e=this.bt();if(EK(e)){this.yt(t);const n=this._t(),o=this.isAnimationLooped(),s=this.getAnimationSpeed(),a=this.getSymbol(),h=a&&a.animationNodes;for(let l=0;l<e.length;l++)this.gltfPack.updateAnimation(t,o,s,e[l],n,i,r,h)}else console.warn("animation specified does not exist!")}return{nodeMatrixMap:i,skinMap:r}}j(t,e,n){const i=this.getUrl();this.N(t.json),this.wt(i,e,n),this.V(e,n),this.createdBygltfmarker||(this.fire("load",{data:t.json}),this.fire("setUrl-debug"),this._fireEvent("meshcreate",{url:i}))}wt(t,e,n){const i=[],r=this.getShader(),o=e.getGLTF(t);if(o&&o.resources){if(!o.resources.length)return void this._fireEvent("modelerror",{url:t,info:"there are no geomtries in the gltf model"});this.gltfPack=o.gltfPack,o.resources.forEach((t=>{const e=this.xt(t,r,n);i.push(e)}))}this.v=i,this.ct=this.Tt(),this.vt(this.v),this.fire("createscene-debug",{meshes:this.v})}vt(t){this.A(t);const e=this.getBoundingBox();if(!e)return;const n=this.getMap(),{max:i,min:r}=e;Ag([i[0]-r[0],i[1]-r[1],i[2]-r[2]])/n.getGLScale()<20&&(console.warn("Model's size on screen is too small, try to increase its symbol.scaleX/Y/Z"),this.fire("smallonscreen"))}rt(){if(this.ot)return this.ot.material.set("lineColor",this.Mt||A$),this.ot.material.set("lineOpacity",this.Ot||1),this.ot;const t=this.ct;if(!t)return null;const{min:e,max:n}=t;u$[0]=n[0],u$[1]=e[1],u$[2]=n[2],u$[3]=n[0],u$[4]=n[1],u$[5]=n[2],u$[6]=e[0],u$[7]=n[1],u$[8]=n[2],u$[9]=e[0],u$[10]=e[1],u$[11]=n[2],u$[12]=n[0],u$[13]=e[1],u$[14]=e[2],u$[15]=n[0],u$[16]=n[1],u$[17]=e[2],u$[18]=e[0],u$[19]=n[1],u$[20]=e[2],u$[21]=e[0],u$[22]=e[1],u$[23]=e[2];const i=new Jv({POSITION:u$},c$,0,{primitive:"lines",positionAttribute:"POSITION"});i.generateBuffers(this.regl);const r=new z_(i,new T_({lineColor:this.Mt||A$,lineOpacity:this.Ot||1}));return this.ot=r,this.ot.ht=Fp([],r.localTransform),r}showBoundingBox(t){this.options.showDebugBoundingBox=!0,this.Mt=t&&t.lineColor,this.Ot=t&&t.lineOpacity,this.l=!0}hideBoundingBox(){this.options.showDebugBoundingBox=!1,this.l=!0}getBoundingBox(){const t=this.v;if(!t||!t.length)return null;if(!this.u)return this.At;"multigltfmarker"===this.getGLTFMarkerType()&&t.forEach((t=>{this.nt(t),t.updateBoundingBox()}));const e=t[0].getBoundingBox(),n=dg([],e[0]),i=dg([],e[1]);for(let o=1;o<t.length;o++){const e=t[o].getBoundingBox(),r=dg([],e[0]),s=dg([],e[1]);r[0]<n[0]&&(n[0]=r[0]),r[1]<n[1]&&(n[1]=r[1]),r[2]<n[2]&&(n[2]=r[2]),s[0]>i[0]&&(i[0]=s[0]),s[1]>i[1]&&(i[1]=s[1]),s[2]>i[2]&&(i[2]=s[2])}const r={min:n,max:i};return this.At=r,this.u=!1,r}Tt(){return this.gltfPack.getGLTFBBox()}xt(t,e,n){const i=this.St(t,e,n),r=i.getDefines();return i instanceof B_?(r.HAS_PICKING_ID=1,r.HAS_INSTANCE_COLOR=1):r.HAS_PICKING_ID=2,i.geometry.data.COLOR_0&&(r.HAS_COLOR0=1),r.HAS_MIN_ALTITUDE=1,r.HAS_LAYER_OPACITY=1,i.setDefines(r),i}St(t,e,n){const i=this.getGLTFMarkerType();let r=null;const o=this.Y(t);let s=t.geometry;if("wireframe"===e&&(t.copyEdgeGeometry(),s=t.copyGeometry),n?s.generateBuffers(n):(this.It=this.It||[],this.It.push(s)),"multigltfmarker"===i){this.Et();const t=this.Pt(Np(KK)),e=this.kt();r=new B_(t.attributesData,e,s,o),r.setUniform("instance",1),n?r.generateInstancedBuffers(n):(this.Lt=this.Lt||[],this.Lt.push(r))}else r=new z_(s,o),r.setUniform("instance",0);r.nodeMatrix=Fp([],t.nodeMatrix),r.properties.geometryResource=t,r.properties.nodeIndex=t.nodeIndex,this.isBloom()&&(r.bloom=1),r.transparent=this.J(),"BLEND"===t.extraInfo.alphaMode&&(r.transparent=!0),r.properties.pickingId=this.W(),this.Nt(r);const a=this.getLayer();return Object.defineProperty(r.uniforms,"minAltitude",{enumerable:!0,get:()=>a.options.altitude||0}),r}Y(t){let e=null;const n=this.getShader(),i=this.getUniforms()||{},r=t.materialInfo||{},o=this.getLayer().getRenderer();if("phong"===n)if("pbrSpecularGlossiness"===r.name)e=new L_(r);else{for(const t in h$)i[t]=i[t]||h$[t];e=new E_(r)}else if("pbr"===n){if(e="pbrSpecularGlossiness"===r.name?new Xw.StandardSpecularGlossinessMaterial(r):new Xw.StandardMaterial(r),o.regl&&!Xw.PBRUtils.isSupported(o.regl)){e=E_.convertFrom(e);for(const t in h$)i[t]=i[t]||h$[t]}}else e="pbr-lite"===n?new R_(r):new T_(r);const s=this.getSymbol(),a=s&&s.doubleSided;EK(a)&&(e.doubleSided=a);for(const h in i)e.set(h,i[h]);return t.morphWeights&&this.it(t.morphWeights,e),t.skin&&e.set("skinAnimation",0),e}it(t,e){const n=e.get("morphWeights1")||[],i=e.get("morphWeights2")||[];for(let r=0;r<4;r++)n[r]=t[r]||0,i[r]=t[r+4]||0;e.set("morphWeights1",n),e.set("morphWeights2",i)}Nt(t){const e=this.getSymbol();e&&e.uniforms?(t.setUniform("polygonFill",e.uniforms.polygonFill||a$),t.setUniform("polygonOpacity",void 0===e.uniforms.polygonOpacity?1:e.uniforms.polygonOpacity),t.setUniform("lineColor",e.uniforms.lineColor||a$),t.setUniform("lineOpacity",void 0===e.uniforms.lineOpacity?1:e.uniforms.lineOpacity)):(t.setUniform("polygonFill",a$),t.setUniform("polygonOpacity",1),t.setUniform("lineColor",a$),t.setUniform("lineOpacity",1))}Ct(){const t=this.getLayer();if(!t)return null;const e=t.getMap();if(!e)return null;const n=this.getBoundingBox();if(!n)return null;const i=this.getPointZ()||0,r=n.min,o=n.max,s=qg(YK,(r[0]+o[0])/2,(r[1]+o[1])/2,r[2]+i,1),a=qg(JK,(r[0]+o[0])/2,(r[1]+o[1])/2,o[2]+i,1),h=om(s,s,e.projViewMatrix),l=om(a,a,e.projViewMatrix),u=(h[0]/h[3]+1)*e.width/2,c=(1-h[1]/h[3])*e.height/2,A=(l[0]/l[3]+1)*e.width/2,f=(1-l[1]/l[3])*e.height/2,d=Math.min(u,A),p=Math.max(u,A),g=Math.min(c,f),m=Math.max(c,f);return new fs({xmin:d,ymin:g,xmax:p,ymax:m})}onAdd(){const t=this.getLayer().getMap();if(t&&!EK(this.Rt)){const e=t.getZoom();this.Rt=e}}onRemove(){this.Bt()}remove(){const t=this.getUrl();if(this.B&&(delete this.v,this.B.logoutGLTF(t),delete this.B),this.Ft){for(const t in this.Ft)this.Ft[t]&&this.Ft[t].jointTexture&&this.Ft[t].jointTexture.destroy();delete this.Ft}this.ot&&(this.ot.geometry.dispose(),this.ot.dispose(),delete this.ot),this.v&&this.v.forEach((t=>{t.dispose(),t.properties.bloomMesh&&(t.properties.bloomMesh.dispose(),delete t.properties.bloomMesh)})),this.F=!1,delete this.k,delete this.gltfPack,super.remove()}show(){return super.updateSymbol({visible:!0}),this}hide(){super.updateSymbol({visible:!1})}setBloom(t){return this.updateSymbol({bloom:t}),this}isBloom(){const t=this._getInternalSymbol();return t&&t.bloom}setCastShadow(t){return super.updateSymbol({shadow:t}),this}isCastShadow(){const t=this._getInternalSymbol();return t&&(t.shadow||void 0===t.shadow)}outlineNodes(t){const e=this.v;return e?(e.forEach((e=>{t.indexOf(e.properties.nodeIndex)>-1&&(e.properties.outline=!0)})),this.l=!0,this):this}outline(){this.updateSymbol({outline:!0});const t=this.v;return t?(t.forEach((t=>{t.properties.outline=!0})),this.l=!0,this):this}cancelOutline(t){this.updateSymbol({outline:!1});const e=this.v;return e?(e.forEach((e=>{t?t.indexOf(e.properties.nodeIndex)>-1&&(e.properties.outline=!1):e.properties.outline=!1})),this.l=!0,this):this}isOutline(){const t=this._getInternalSymbol();return!(!t||!EK(t.outline))&&t.outline}isVisible(){const t=this._getInternalSymbol();return!t||!EK(t.visible)||t.visible}setCoordinates(t){return super.setCoordinates(t),this.l=!0,this.u=!0,this}copy(){const e=this.toJSON(),n=t.fromJSON(e);return n.setZoomOnAdded(this.Rt),n}setShader(t){return super.updateSymbol({shader:t}),this}getShader(){const t=this._getInternalSymbol();return t&&t.shader||"pbr"}setUniforms(t){return super.updateSymbol({uniforms:t}),this.R=!0,this}getUniforms(){const t=this._getInternalSymbol();return t&&t.uniforms}setUniform(t,e){const n=this.getUniforms()||{};return n[t]=e,super.updateSymbol({uniforms:n}),this.R=!0,this}getUniform(t){const e=this._getInternalSymbol();return e&&e.uniforms&&e.uniforms[t]}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation&&this.k&&this.k.animations}isDashAnimated(){const t=this._getInternalSymbol();return t&&t.uniforms&&t.uniforms.dashEnabled&&t.uniforms.dashAnimate}setAnimation(t){return super.updateSymbol({animation:t}),delete this.Dt,this}setAnimationLoop(t){return super.updateSymbol({loop:t}),delete this.Dt,this.l=!0,this}isAnimationLooped(){const t=this._getInternalSymbol();return t&&t.loop}getAnimationSpeed(){const t=this._getInternalSymbol();return t&&EK(t.speed)?t.speed:1}setAnimationSpeed(t){return super.updateSymbol({speed:t}),this}Ut(t){const e=this.getMap();return e?OK(e,t||this.getCoordinates()):null}setTRS(t,e,n){const i=t||this.m.translation;return this.updateSymbol({translationX:i[0],translationY:i[1],translationZ:i[2],rotationX:e[0],rotationY:e[1],rotationZ:e[2],scaleX:n[0],scaleY:n[1],scaleZ:n[2]}),this}Vt(){const t=this.q(),e=this.Ut();return e?gg(t,t,e):t}updateSymbol(t){for(const e in t)if("bloom"===e&&this.v&&this.v.forEach((n=>{n.bloom=+!!t[e]})),l$.has(e)){this.u=!0;break}return super.updateSymbol(t)}setTranslation(t,e,n){return this.updateSymbol({translationX:t,translationY:e,translationZ:n}),this}setRotation(t,e,n){return this.updateSymbol({rotationX:t,rotationY:e,rotationZ:n}),this}rotateAround(t,e){const n=this.getMap();if(!n)return;const i=n.getGLRes();let r=this.getCoordinates();const o=n.coordinateToPointAtRes(r,i),s=n.coordinateToPointAtRes(t,i),a=o.x-s.x,h=o.y-s.y,l=180*Math.atan2(h,a)/Math.PI+e,u=Math.sqrt(a*a+h*h),c=Math.PI*l/180,A=u*Math.cos(c)+s.x,f=u*Math.sin(c)+s.y;s$.set(A,f),r=n.pointAtResToCoordinate(s$,i),this.setCoordinates(r),this.updateSymbol({rotationZ:l})}setScale(t,e,n){return this.updateSymbol({scaleX:t,scaleY:e,scaleZ:n}),this}getTranslation(){const t=this._getInternalSymbol();return pg(this.m.translation,t&&t.translationX||0,t&&t.translationY||0,t&&t.translationZ||0)}q(){const t=this.getTranslation();return this.getMap()?this.qt(t):this.m.translation}qt(t){const e=this.getMap(),n=e.distanceToPointAtRes(t[0],t[1],e.getGLRes(),s$),i=e.altitudeToPoint(t[2],e.getGLRes());return pg(e$,RK(n.x,t[0]),RK(n.y,t[1]),RK(i,t[2]))}getRotation(){const t=this._getInternalSymbol();return pg(this.m.rotation,t&&t.rotationX||0,t&&t.rotationY||0,t&&t.rotationZ||0)}getScale(){const t=this._getInternalSymbol();return pg(this.m.scale,t&&t.scaleX||1,t&&t.scaleY||1,t&&t.scaleZ||1)}lt(){const t=this.getScale();if(this.ct){const e=this.O(),n=this.getModelHeight();if(e&&e>0){const n=this.ft(n$,e);return yg(n,n,t)}if(n){const e=this.ut(n$,n);return yg(e,e,t)}}return t}cancelMarkerPixelHeight(){return this.updateSymbol({markerPixelHeight:null})}setAnchorZ(t){return this.updateSymbol({anchorZ:t}),this}getAnchorZ(){const t=this._getInternalSymbol();return t&&t.anchorZ||"bottom"}_setExternSymbol(t){return this.l=!0,super._setExternSymbol(t)}Gt(t){return RE(t,(()=>{const t=this.getMap();return t?[t.getZoom()]:null}))}_prepareSymbol(t){super._prepareSymbol(t);const e=this.Gt(t);return e&&e.uniforms&&(e.uniforms=this.Gt(t.uniforms)),delete this.jt,e}hasFunctionDefinition(){if(EK(this.jt))return this.jt;const t=this._getInternalSymbol();return this.jt=IE(t)||t&&t.uniforms&&IE(t.uniforms),this.jt}setModelMatrix(t){const e=Jp(this.m.translation,t),n=$p(this.m.rotation,t),i=Kp(this.m.scale,t);return this.setTranslation(e[0],e[1],e[2]),this.setRotation(n[0],n[1],n[2]),this.setScale(i[0],i[1],i[2]),this}getModelMatrix(){return this.o}p(){const t=this.Vt(),e=this.getRotation(),n=Sm(XK,e[0],e[1],e[2]),i=this.lt();this.o=tg(this.o,n,t,i)}isDirty(){return this.l}P(t){return this.l=t,this}Xt(){const t=this.toJSON();return t.zoomOnAdded=this.Rt,t}toJSON(){const t=JSON.parse(JSON.stringify({coordinates:this.getCoordinates(),options:this.options||{},type:"GLTFMarker"})),e=this.getId();gi.isNil(e)||(t.options.id=e);const n=this.getProperties();n&&(t.options.properties=JSON.parse(JSON.stringify(n)));const i=this.getSymbol();return i&&(t.options.symbol=JSON.parse(JSON.stringify(i))),t}setZoomOnAdded(t){this.Rt=t}getZoomOnAdded(){return this.Rt}J(){return this.T()<1}T(){const t=this.getUniforms(),e=this.getShader();return"pbr"===e||"phong"===e?t&&EK(t.polygonOpacity)?t.polygonOpacity:1:"wireframe"===e&&t&&EK(t.lineOpacity)?t.lineOpacity:1}D(t){this.i=t}isLoaded(){return this.i}getGLTFMarkerType(){return this.h}Ht(t){this.zt=t}W(){return this.zt}getCount(){return 1}getContainerExtent(){return this.Ct()}getGLTFAsset(){return this.k&&this.k.asset}openInfoWindow(t){this.k?super.openInfoWindow(t):this.once("load",(()=>{super.openInfoWindow(t)}))}getAnimations(){if(!this.k)return null;const t=this.k,e=t.animations?t.animations.map(((t,e)=>({name:EK(t.name)?t.name:e}))):null;return e?e.map(((t,e)=>t.name||e)):null}getCurrentAnimation(){const t=this._getInternalSymbol();return t&&t.animationName}bt(){const t=this.getAnimations();if(!t)return null;let e=this.getCurrentAnimation();if(!EK(e))return t.slice(0,1);const n=[];e=Array.isArray(e)?e:[e];for(let i=0;i<e.length;i++)t.indexOf(e[i])>-1&&n.push(e[i]);return n.length?n:null}setCurrentAnimation(t){this.updateSymbol({animationName:t})}yt(t){EK(this.Dt)||(this.Dt=t)}_t(){return this.Dt||0}gt(){return this.Ft=this.Ft||{},this.Ft}O(){const t=this._getInternalSymbol();return t&&t.markerPixelHeight}setModelHeight(t){return this.updateSymbol({modelHeight:t}),this}getModelHeight(){const t=this._getInternalSymbol();return t&&t.modelHeight}getGLTFBBox(){return this.ct}zoomTo(t,e={animation:!1}){const n=this.getBoundingBox(),i=this.getMap();if(!i||!n)return;const{min:r,max:o}=n;s$.set(r[0],r[1]);const s=i.pointAtResToCoordinate(s$,i.getGLRes());s$.set(o[0],o[1]);const a=i.pointAtResToCoordinate(s$,i.getGLRes()),h=new fs(s,a);i.fitExtent(h,t,e,(t=>{"finished"===t.state.playState&&this.Jt(r,o,h)})),!1===e.animation&&this.Jt(r,o,h)}Jt(t,e,n){const i=this.getMap(),r=i.getGLRes(),o=(t[2]+e[2])/2/i.altitudeToPoint(1,r),s=i.cameraPosition,a=i.pointAtResToCoordinate(new ht(s),r),h=s[2]/i.altitudeToPoint(1,r);a.z=h+o,i.setCameraOrientation({position:[a.x,a.y,a.z],pitch:i.getPitch(),bearing:i.getBearing()}),this.fire("zoomtoend",{target:this,extent:n})}H(){return this.R}Wt(){this.R=!1}setAnimationTimeframe(t){const e=this._t(),n=this.gt();this.gltfPack.updateAnimation(t,this.isAnimationLooped(),this.getAnimationSpeed(),e,{},n)}Bt(){delete this.At,delete this.Rt}dt(){return"effectmarker"!==this.getGLTFMarkerType()&&"glowmarker"!==this.getGLTFMarkerType()}_onEvent(t,e){const n=this.getLayer();if(!n)return;const i=n.getId();this.Zt=t.gltfPickingInfo&&t.gltfPickingInfo[i]||{},super._onEvent(t,e)}_fireEvent(t,e){for(const n in this.Zt)e[n]=this.Zt[n];delete this.Zt,super._fireEvent(t,e)}Yt(){let t=[];return this.v&&this.isVisible()&&this.T()?this.isOutline&&this.isOutline()?this.v:(t=this.v.filter((t=>t.properties.outline)),t):t}highlightNodes(t){const e=this.v;e?this.Kt(t,e):this.once("load",(()=>{this.Kt(t,this.v)}),this)}Kt(t,e){t.forEach((t=>{e.forEach((e=>{e.properties.nodeIndex===t.nodeIndex&&this.$t(e,t.color,t.opacity,t.bloom)}))})),this.l=!0}highlight(t){const{color:e,opacity:n,bloom:i}=t,r=this.v;r?(r.forEach((t=>{this.$t(t,e,n,i)})),this.l=!0):this.once("load",(()=>{this.v.forEach((t=>{this.$t(t,e,n,i)})),this.l=!0}),this)}$t(t,e,n,i){t.properties.polygonFill||(t.properties.polygonFill=t.getUniform("polygonFill")||a$),t.properties.polygonOpacity||(t.properties.polygonOpacity=t.getUniform("polygonOpacity")||1),t.setUniform("polygonFill",e||a$),t.setUniform("polygonOpacity",n||1),t.bloom=i}Qt(){if(this.te)if(Array.isArray(this.te)){const t=this.te.map((t=>t.nodeIndex));this.cancelHighlight(t)}else this.cancelHighlight(this.te.nodeIndex)}cancelHighlight(t){const e=this.getLayer();if(!e)return;const n=e.getRenderer();if(!n)return;let i=this.v;if(i){if(t){let e=t;Array.isArray(e)||(e=[e]),i=i.filter((t=>e.indexOf(t.properties.nodeIndex)>-1))}i.forEach((t=>{const{polygonFill:e,polygonOpacity:n}=t.properties;t.setUniform("polygonFill",e),t.setUniform("polygonOpacity",n),t.bloom=!1})),n.setToRedraw()}}setNodeTRS(t,e={}){const n=this.v;if(!n)return;const i=e.translation||this.m.translation,r=e.rotation||this.m.rotation,o=Sm(XK,r[0],r[1],r[2]),s=e.scale||this.m.scale;return n.forEach((e=>{e.properties.nodeIndex===t&&(e.tt=tg(e.tt||[],o,i,s))})),this.A(n),this.l=!0,this}};f$.mergeOptions({symbol:null}),f$.registerJSONType("GLTFMarker");const d$=[1,1,1,1],p$=[],g$=[],m$=[1,1,1],y$=new $o(0,0),v$=[1,1,1],_$=[1,1,1];let x$=class t extends f${constructor(t,e){super(null,e),this.ee=t||[],this.ne=[],this.se=[0,0,0],this.ie=Np([]),this.h="multigltfmarker",this.re=[]}static fromJSON(e){return new t(e.data,e.options)}setCoordinates(t){return this.oe=Array.isArray(t[0])?t.map((t=>new $o(t))):t,this.updateAllData("coordinates",this.oe),this.l=!0,this}getCoordinates(t){return t&&this.ee&&this.ee.length?this.ee[t.index].coordinates:null}addData(t){return this.ee||(this.ee=[]),this.ee.push(t),this.l=!0,this}removeData(t){this.ee.splice(t,1),this.ne&&this.ne.splice(t,1);const e=this.getLayer();return e&&e.ae(),this.l=!0,this}getData(t){return this.ee[t]}updateData(t,e,n){return this.ee[t][e]=n,this.l=!0,this}getAllData(){return this.ee}updateAllData(t,e){for(let n=0;n<this.ee.length;n++)this.updateData(n,t,e[n]);return this}removeAllData(){this.ee&&(this.ee=[],this.ne=[],this.l=!0)}Et(){const t=this.getMap();if(this.ee&&t){this.he(),this.ne=this.ne||[];for(let t=0;t<this.ee.length;t++)if(!1!==this.ee[t].visible){const e=this.ce(t);this.ne[t]=e}}}openInfoWindow(t){let e=null;e=EK(t)&&this.ee[t]?this.ee[t].coordinates:this.getCenter(),super.openInfoWindow(e)}getCenter(){let t=0,e=0,n=0,i=0;for(let r=0,o=this.ee.length;r<o;r++){let o=this.ee[r].coordinates;o instanceof $o&&(o=o.toArray()),t+=o[0],e+=o[1],n+=o[2]||0,i++}return 0===i?null:y$.set(t/i,e/i,n/i)}getMap(){return super.getMap()||this.t&&this.t.getMap()}le(t){this.t=t}getLayer(){return super.getLayer()||this.t}he(){const t=this.getMap(),e=this.getCenter();if(!e)return;this.se=OK(t,e);const n=Sm(g$,0,0,0);tg(this.ie,n,this.se,m$)}ce(t){const e=this.ee[t],n=this.Ut(e.coordinates);if(!n)return null;const i=Dg(p$,n,this.se),r=this.qt(e.translation||this.m.translation),o=gg(p$,r||this.m.translation,i||this.m.translation),s=e.rotation||this.m.rotation,a=this.ue(t),h=Sm(g$,s[0]||0,s[1]||0,s[2]||0);return tg(this.ne[t]||[],h,o,a)}ue(t){const e=this.ee[t],{modelHeight:n,markerPixelHeight:i}=e,r=e.scale||this.m.scale;if(this.ct){if(i&&i>0){const t=this.ft(v$,i);return yg(t,t,r)}if(n){const t=this.ut(v$,n);return yg(t,t,r)}}return r}D(t){if(super.D(t),this.ee)for(let e=0;e<this.ee.length;e++){const n=this.ee[e];n.target&&n.target instanceof f$&&n.target.D(t)}}p(){super.p(),this.Et()}fe(){this.de={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_color:[],aPickingId:[],aOutline:[],highlight_color:[],aBloom:[]},this.me={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_color:[],aPickingId:[],aOutline:[],highlight_color:[],aBloom:[]};for(let t=0;t<this.ne.length;t++){let e=this.de;this.ee[t].bloom&&(e=this.me);const n=this.ne[t],i=e.instance_vectorA.length/4;this.ge(e,"instance_vectorA",i,n,0),this.ge(e,"instance_vectorB",i,n,1),this.ge(e,"instance_vectorC",i,n,2);const r=this.ee[t].color||d$,o=this.ee[t].highlightColor||d$;e.instance_color[4*i]=r[0],e.instance_color[4*i+1]=r[1],e.instance_color[4*i+2]=r[2],e.instance_color[4*i+3]=r[3],e.aPickingId[i]=this.W()+t,e.aOutline[i]=this.ee[t].outline?1:0,e.highlight_color[4*i]=o[0],e.highlight_color[4*i+1]=o[1],e.highlight_color[4*i+2]=o[2],e.highlight_color[4*i+3]=o[3],e.aBloom[i]=this.ee[t].bloom?1:0}return{attributesData:this.de,bloomAttributesData:this.me}}nt(t){const{attributesData:e,bloomAttributesData:n}=this.Pt();for(const i in e)t.updateInstancedData(i,e[i]);if(this.regl?t.generateInstancedBuffers(this.regl):(this.Lt=this.Lt||[],this.Lt.push(t)),t.instanceCount=this.de.instance_vectorA.length/4,this.pe()){const e=n,i=e.aBloom.length;t.properties.bloomMesh=t.properties.bloomMesh||new B_(e,i,t.geometry,t.material);const r=t.properties.bloomMesh;r.positionMatrix=t.positionMatrix,r.localTransform=t.localTransform;for(const t in e)r.updateInstancedData(t,e[t]);r.generateInstancedBuffers(this.regl);const o=t.getDefines();r.setDefines(o),r.uniforms=t.uniforms,r.bloom=1,r.instanceCount=i}else t.properties.bloomMesh&&(t.properties.bloomMesh.dispose(),delete t.properties.bloomMesh)}be(t,e,n,i){this.me[t]&&n&&(this.me[t][4*e]=n[i],this.me[t][4*e+1]=n[i+4],this.me[t][4*e+2]=n[i+8],this.me[t][4*e+3]=n[i+12])}pe(){return this.me&&this.me.aBloom.length}ge(t,e,n,i,r){t[e]&&i&&(t[e][4*n]=i[r],t[e][4*n+1]=i[r+4],t[e][4*n+2]=i[r+8],t[e][4*n+3]=i[r+12])}Pt(t){return!this.l&&this.de?{attributesData:this.de,bloomAttributesData:this.me}:this.fe(t)}et(){return this.ie}getCount(){return this.ee.length}ye(){return this.Et(),this.me?this.me.aBloom.length:0}kt(){return this.getCount()-this.ye()}toJSON(){const t=JSON.parse(JSON.stringify({data:this.ee,options:this.options,type:"MultiGLTFMarker"})),e=this.getProperties();return t.options&&(t.options.properties=e),t}getIndexByPickingId(t){return t-this.W()}outline(t){return EK(t)&&this.updateData(t,"outline",!0),this}cancelOutline(t){return EK(t)&&this.updateData(t,"outline",!1),this}isOutline(){if(!this.ee||!this.ee.length)return!1;for(let t=0;t<this.ee.length;t++)if(this.ee[t].outline)return!0;return!1}J(){const t=this.getAllData();for(let e=0;e<t.length;e++){const n=t[e].color;if(n&&n[3]<1)return!0}return!1}highlightNodes(t,e){const n=this.v;if(!n)return;const i=this.ee[t];i&&(e.forEach((t=>{n.forEach((e=>{if(e.properties.nodeIndex===t.nodeIndex){const{color:n,opacity:r,bloom:o}=t;i.highlightColor=n||_$,i.highlightColor[3]=r||1,i.highlightBloom=o;const s=e.getDefines();s.HAS_INSTANCE_HIGHLIGHT=1,e.setDefines(s)}}))})),this.l=!0)}highlight(t,e){const{color:n,opacity:i,bloom:r}=e,o=this.v;if(!o)return;const s=this.ee[t];s&&(s.highlightColor=n||_$,s.highlightColor[3]=i||1,s.highlightBloom=r,o.forEach((t=>{const e=t.getDefines();e.HAS_INSTANCE_HIGHLIGHT=1,t.setDefines(e)})),this.l=!0)}cancelHighlight(t,e){let n=this.v;if(!n)return;const i=this.ee[t];if(i){if(e){let t=e;Array.isArray(t)||(t=[t]),n=n.filter((e=>t.indexOf(e.properties.nodeIndex)>-1))}n.forEach((t=>{const e=t.getDefines();delete e.HAS_INSTANCE_HIGHLIGHT,t.setDefines(e),i.highlightColor=_$,i.highlightColor[3]=1,i.highlightBloom=0})),this.l=!0}}};x$.registerJSONType("MultiGLTFMarker");const b$=[],w$=[],C$=["points","lines","line strip","line loop"];let P$=class extends(dS(Uf.OverlayLayerCanvasRenderer)){constructor(t){super(t),this._e={},this.we=[],this.xe={}}onAdd(){super.onAdd(),this.prepareWorker()}draw(t,e){this.prepareCanvas(),this.Te(e,t)}drawOnInteracting(t,e,n){this.Te(n,e)}Te(t,e){this.ve=t,this.Me=e;let n=0;this.Oe(t),this.Ae={},this.Se(t);const i=this.Ie(t);this.Ee(e);const r=t&&t.renderTarget?t.renderTarget.fbo:null;let o=0;for(const a in this._e){if("pointline"===a)continue;if(t){const{newShader:e,uniforms:n}=this.Pe(t,a);this._e[a].shader=e,gi.extend(i,n)}const e=this.ke(a),s=this._e[a].shader;s.filter=t&&t.sceneFilter||null,o+=this.renderer.render(s,i,e,r),n++}const s=this.ke("pointline");if(s.getMeshes().length){i.pointSize=this.layer.options.pointSize||1;const e=this._e.pointline.shader;e.filter=t&&t.sceneFilter||null,o+=this.renderer.render(e,i,s,r),n++}this.Le(i,r),o&&this.layer.fire("canvasisdirty",{renderCount:o}),this.Ne=!0,this.completeRender(),this.layer.fire("rendercomplete-debug",{count:n})}Le(t,e){this.Ce||(this.Ce=new Y_);const n=this.layer.getGeometries(),i=[];for(let r=0;r<n.length;r++){if(!n[r].options.showDebugBoundingBox)continue;const t=n[r].rt();t&&i.push(t)}i.length&&(this.Ce.setMeshes(i),this.renderer.render(this._e.wireframe.shader,t,this.Ce,e))}Re(t){const e=t.getUniform("polygonFill")||[1,1,1,1],n=t.getUniform("polygonOpacity")||1;return e[3]=n,{coordinates:t.getCoordinates(),translation:t.getTranslation(),rotation:t.getRotation(),scale:t.getScale(),visible:t.isVisible(),color:e,bloom:t.isBloom(),outline:t.isOutline(),modelHeight:t.getModelHeight(),markerPixelHeight:t.O(),anchorZ:t.getAnchorZ(),pickingId:t.W(),target:t}}Be(t){const e=this.Re(t),n=new x$([e],{symbol:{url:t.getUrl(),shader:t.getShader(),shadow:t.isCastShadow()}});return n.Fe=n.Fe||[],t.De=!0,n.Fe.push(t),n.le(t.getLayer()),n}Ue(){for(const t in this.xe)this.xe[t].removeAllData()}Ve(t,e){const n=t.getMeshes(this.B,this.regl,e),i=t.getShader();if(n.length){this.we.push(t),this.Ae[i]=this.Ae[i]||[],gi.pushIn(this.Ae[i],n);for(let t=0;t<n.length;t++)n[t].properties.bloomMesh&&this.Ae[i].push(n[t].properties.bloomMesh)}}Ee(t){this.we.length=0;const e=this.layer.getGeometries();this.qe()&&this.Ue();for(let n=0;n<e.length;n++){const i=e[n],r=i.getUrl();if(i instanceof x$||i.isAnimated()||!i.De)this.Ve(i,t);else if(this.qe()){const t=`${r}_${i.getShader()}_${i.isCastShadow()?1:0}`;this.xe[t]?this.xe[t].addData(this.Re(i)):this.xe[t]=this.Be(i)}}for(const n in this.xe){const e=this.xe[n];e.createdBygltfmarker=!0,this.Ve(e,t)}}Ie(){const t={};this.Ge.outSize=[this.canvas.width,this.canvas.height],this.Ge.halton=[0,0],t.layerOpacity=this.canvas.gl&&this.canvas.gl.wrap?this.layer.options.opacity||0:1,gi.extend(t,this.Ge);const e=this.getMaskUniforms();return gi.extend(t,e),t}ke(t){const e=[],n=[];if("pointline"===t){for(const n in this.Ae)"wireframe"!==n&&this.Ae[n].forEach((t=>{C$.indexOf(t.geometry.desc.primitive)>-1&&e.push(t)}));const t=new Y_(e);return t.sortMeshes(this.Ge.cameraPosition),t}for(const r in this.Ae)r===t&&this.Ae[r].forEach((e=>{(C$.indexOf(e.geometry.desc.primitive)<0||"wireframe"===t)&&n.push(e)}));const i=this.je=this.je||new Y_;return i.setMeshes(n),i.sortMeshes(this.Ge.cameraPosition),i}needToRedraw(){return!!super.needToRedraw()||this.qe()}qe(){const t=this.layer.getGeometries();for(let e=0;e<t.length;e++)if(this.we.indexOf(t[e])>-1&&(t[e].isDirty()||t[e].isAnimated()))return!0;return!1}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),super.onRemove()}hitDetect(){return!1}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;if(t)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this.Xe(this.canvas,t),this.regl=id({gl:this.gl,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_s3tc"]})}t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.B=this.regl.gltfManager=this.regl.gltfManager||this.He(),this.ze(),this.Lt&&this.Lt.forEach((t=>{t.generateInstancedBuffers(this.regl)})),this.It&&this.It.forEach((t=>{t.generateBuffers(this.regl)})),this.layer.fire("contextcreate",{regl:this.regl})}getGLTFManager(){return this.B}He(){return new Pb(this.regl)}ze(){const t=this.layer.getMap(),e=new j_(this.regl);this.renderer=e,this.Ge={projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,viewMatrix:t.viewMatrix,cameraPosition:t.cameraPosition,altitudeScale:1},Xw.PBRUtils.loginIBLResOnCanvas(this.canvas,this.regl,t),this.Je=new cw(e,{vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform float pointSize;\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = pointSize;\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp([],e.viewMatrix,e.modelMatrix)}}]},this.pickingFBO,t)}prepareWorker(){this.workerConn||(this.workerConn=new zK("@maptalks/gltf-layer",this.layer));const t=this.workerConn;if(!t.isActive())return;const e=this.layer.options||{},n=this.layer.getId();t.addLayer(n,{markerType:e.markerTypes,pointSize:e.pointSize},(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}G(t){let e;return e=this.layer.getURLModifier()?qK(null,t,this.layer.options.fetchOptions,(t=>{const e=this.layer.getURLModifier();return e?e(t):t})):this.workerConn.loadGLTF(t),e.then((t=>(this.setToRedraw(),this.We=!0,t))).catch((e=>{console.error(e),this.layer.fire("modelerror",{type:"modelerror",url:t,info:e})}))}Se(t){const e=FK;for(const n in e){if(this._e[n])continue;const i=e[n];this.Ze(t,i.name,i.type,i.config)}}Ze(t,e,n,i){this.viewport||(this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1}),i.extraCommandProps||(i.extraCommandProps={});const r={};t&&this.Ye(r,b$,t);const o=gi.extend({},i);o.extraCommandProps=gi.extend({},i.extraCommandProps),o.extraCommandProps.viewport=this.viewport,o.uniforms=gi.extend([],i.uniforms,b$),o.defines=gi.extend({},o.defines,r),n.indexOf(".")>-1?(n=n.split("."),this._e[e]={shader:new Yw[n[0]][n[1]](o),type:n}):this._e[e]={shader:new Yw[n](o),type:n}}remove(){this.Ke();const t=this._e;for(const e in t)t[e].shader.dispose();this.extentShader&&this.extentShader.dispose(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}resizeCanvas(t){super.resizeCanvas(t),this.pickingFBO&&this.pickingFBO.resize(this.canvas.width,this.canvas.height),this.layer.fire("resizecanvas",{size:t})}getFrameTimestamp(){return this.Me}getFrameContext(){return this.ve}needRetireFrames(){return this.We}Ye(t,e,n){const i=n&&n.includes;if(i)for(const r in i)i[r]&&(n[r].uniformDeclares&&(e.length=0,e.push(...n[r].uniformDeclares)),n[r].defines&&gi.extend(t,n[r].defines))}$e(t,e){const n=e&&e.includes;if(n)for(const i in n)n[i]&&e[i].renderUniforms&&gi.extend(t,e[i].renderUniforms)}Pe(t,e){const{shader:n,type:i}=this._e[e];let r=null;const o={};if(this.$e(o,t),t.states.includesChanged){const e={};this.Ye(e,b$,t);const o={vert:n.vert,frag:n.frag,uniforms:n.uniforms,extraCommandProps:n.extraCommandProps};o.defines=e,o.uniforms=gi.extend([],o.uniforms,b$),r=Array.isArray(i)?new Yw[i[0]][i[1]](o):new Yw[i](o),n.dispose()}else r=n;return{uniforms:o,newShader:r}}Qe(t,e,n){if(t.viewshed){for(const e in t.viewshed.renderUniforms)n[e]=t.viewshed.renderUniforms[e];gi.extend(e.shaderDefines,t.viewshed.defines)}if(t.floodAnalysis){for(const e in t.floodAnalysis.renderUniforms)n[e]=t.floodAnalysis.renderUniforms[e];gi.extend(e.shaderDefines,t.floodAnalysis.defines)}return n}getShadowMeshes(){const t=[];if(!this.layer||!this.layer.isVisible()||!this.Ae)return t;const e=this.layer.getGeometries();for(let n=0;n<e.length;n++)e[n].isCastShadow()&&e[n].isVisible()&&e[n].T()&&!e[n].De&&gi.pushIn(t,e[n].v||[]);for(const n in this.xe){const e=this.xe[n];e.isCastShadow()&&e.isVisible()&&e.T()&&gi.pushIn(t,e.v||[])}return t}tn(){const t=[];if(!this.Ae||!Object.keys(this.Ae).length)return t;for(const e in this.Ae)gi.pushIn(t,this.Ae[e]);return t}getAnalysisMeshes(){return this.tn()}getRayCastData(t){const e=this.layer.getGeometries();for(let n=0;n<e.length;n++){const i=e[n].v;if(i&&i.indexOf(t)>-1)return e[n]}return null}drawOutline(t){this.extentShader||(this.extentShader=new mx({vert:"attribute vec3 aPosition;\n\nattribute float aOutline;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float instance;\n\n#include <get_output>\n\n\n\nvarying float vOutline;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * getPosition(aPosition);\n\n    if (instance == 0.0) {\n\n        vOutline = 1.0;\n\n    } else {\n\n        vOutline = aOutline;\n\n    }\n\n}\n\n",frag:"precision highp float;\n\nvarying float vOutline;\n\nvoid main() {\n\n    gl_FragColor = vec4(vOutline);\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:(t,e)=>Hp([],e.viewMatrix,e.modelMatrix)}],positionAttribute:"POSITION",extraCommandProps:{viewport:this.viewport,cull:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}));const e=this.getOutlineMeshes();e.length&&(this.en=this.en||new Y_,this.en.setMeshes(e),this.renderer.render(this.extentShader,{projMatrix:this.Ge.projMatrix,viewMatrix:this.Ge.viewMatrix},this.en,t))}getOutlineMeshes(){const t=[];if(!this.layer)return t;const e=this.layer.getGeometries();for(let n=0;n<e.length;n++){if(e[n].De)continue;const i=e[n].Yt();gi.pushIn(t,i)}for(const n in this.xe){const e=this.xe[n].Yt();gi.pushIn(t,e)}return t}Ke(){this.canvas&&Xw.PBRUtils.logoutIBLResOnCanvas(this.canvas,this.getMap())}Oe(t){const e=this.layer.getMap(),{iblTexes:n,dfgLUT:i}=Xw.PBRUtils.getIBLResOnCanvas(this.canvas);if(e&&e.getLights()){const r=Xw.PBRUtils.getPBRUniforms(e,n,i,t&&t.ssr,t&&t.jitter),o=e.getLights();this.Ge.ambientColor=o.ambient&&o.ambient.color?o.ambient.color:[.2,.2,.2],r&&gi.extend(this.Ge,r)}else{const n=Xw.PBRUtils.getPBRUniforms(e,null,i,t&&t.ssr,t&&t.jitter);gi.extend(this.Ge,n)}}Xe(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let o=0;o<n.length;++o){try{i=t.getContext(n[o],e)}catch(r){}if(i)break}return i}nn(t,e,n={}){if(!this.Je||!this.layer.isVisible())return null;const i=this.layer.getMap();if(this.Ne||this.canvas.gl&&this.canvas.gl.wrap){if(!this.Ae||!Object.keys(this.Ae).length)return null;const t=this.tn(),e=gi.extend({},this.Ge);e.pointSize=this.layer.options.pointSize||1,this.Je.render(t,e,!0),this.Ne=!1}const r=this.Je[n.returnAll?"pickAll":"pick"](t,e,n.tolerance||3,{projMatrix:i.projMatrix,viewMatrix:i.viewMatrix,pointSize:this.layer.options.pointSize||1},{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:!0});if(r.length){const t={},e=[];for(let n=0;n<r.length;n++)if(!t[r[n].pickingId]){const i=this.sn(r[n]);t[r[n].pickingId]=!0,e.push(i)}return e}return this.sn(r)}sn(t){const{meshId:e,pickingId:n,point:i,coordinate:r}=t,o=this.tn()[e],s=this.rn(n);return{meshId:e,mesh:o,data:this.layer.an()[s],pickingId:n,point:i,coordinate:r,index:n-s,nodeIndex:this.hn(e)}}hn(t){const e=this.tn()[t];return e&&e.properties.nodeIndex}rn(t){if(!EK(t))return null;if(this.layer.an()[t])return t;const e=Object.keys(this.layer.an()),n=e.length;let i=0,r=n-1,o=Math.floor((i+r)/2);for(;i<=n-1&&r>=0;){if(i===r)return e[i];if(e[o]<=t&&t<e[o+1])return e[o];t<e[o]?(r=o-1,o=Math.floor((i+r)/2)):e[o+1]<t&&(i=o+1,o=Math.floor((i+r)/2))}return null}isInFrustum(t){const e=this.layer.getMap(),n=t.getBoundingBox();if(!n||"multigltfmarker"===t.getGLTFMarkerType())return!0;const i=ly(w$,n.min,n.max);return!!jq(e.projViewMatrix,i)}getRenderMeshesTest(){return this.tn()}isMarkerTransparent(t){return t.J()}getMarkerFitSizeScale(t){return t.cn()}getMarkerFitTranslate(t){return t.ln()}getFBORayPicking(){return this.Je}getShaderList(){return this._e}};const M$=/\{ *([\w_]+) *\}/g;let T$=class t extends f${constructor(t,e){super(t,e),this.h="effectmarker"}static fromJSON(e){return new t(e.coordinates,e.options)}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation}setTexture(t){const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const n=this.getTextureUrl();e.un(n),e.dn(t)}return super.updateSymbol({textureUrl:t}),this}mn(t){const e=this.getTextureUrl(),n=this.getLayer()&&this.getLayer().getRenderer();if(n){let i=e;const r=this.gn();if(r){const n=this.isAnimationLooped(),o=this.getAnimationSpeed()||1,s=n?Math.floor(.01*t*o)%r.length:Math.floor(.01*t);i=e.replace(M$,r[s]),this.setUniform("width",1),this.setUniform("height",1),this.setUniform("uvOffset",[0,0])}return n.pn(i,this.W())}return null}gn(){const t=this._getInternalSymbol();return t&&t.textureNames}getTextureUrl(){const t=this._getInternalSymbol();return t&&t.textureUrl||"default"}getUrl(){return"plane"}getShader(){return"effect"}setTransparent(t){return this.options.symbol.transparent=t,this}isTransparent(){return this.options.symbol.transparent}updateUV(t){const e=this.isAnimationLooped(),n=this.getAnimationSpeed()||1,i=this.getUniforms()||{},r=i.width||1,o=i.height||1;let s;const a=this.getEffectType();"uv"===a?s=e?.01*t*n%(r*o):.01*t:"sequence"===a&&(s=e?Math.floor(.01*t*n)%(r*o):Math.floor(.01*t));const h=Number(s%r),l=Math.floor(s/r),u=this.mn(t);this._getSymbol()?(this.setUniform("uvOffset",[h,l]),this.setUniform("width",r),this.setUniform("height",o),this.setUniform("texture",u)):this.C("uniforms",{uvOffset:[h,l],width:r,height:o,texture:u})}_setExternSymbol(t){super._setExternSymbol(t);const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const t=this.getTextureUrl();e.dn(t)}}getEffectType(){const t=this._getInternalSymbol();return t&&t.effect||"uv"}setEffectType(t){return this._getInternalSymbol().effect=t,this}remove(){const t=this.getLayer()&&this.getLayer().getRenderer();if(t){const e=this.getTextureUrl();t.un(e)}super.remove()}};const S$=["Point","Polygon","LineString","MultiPoint","MultiPolygon","MultiLineString","GeometryCollection","Feature","FeatureCollection"].reduce(((t,e)=>(t[e]=!0,t)),{}),I$={toGeometry:function(t,e){if(gi.isString(t)&&(t=gi.parseJSON(t)),Array.isArray(t)){const n=[];for(let i=0,r=t.length;i<r;i++){const r=I$.bn(t[i],e);Array.isArray(r)?gi.pushIn(n,r):n.push(r)}return n}return I$.bn(t,e)},bn:function(t,e){if(!t||gi.isNil(t.type))return null;const n=t.type;if("Feature"===n){const n=I$.bn(t.geometry,e);return n?(n.setId(t.id),n.setProperties(t.properties),n):null}if("FeatureCollection"===n){const n=t.features;return n?I$.toGeometry(n,e):null}if("Point"===n)return i=t.coordinates,"EffectLayer"===e?new T$(i):new f$(i);var i;if("GeometryCollection"===n){const n=t.geometries,i=[],r=n.length;for(let t=0;t<r;t++)i.push(I$.bn(n[t],e));return i}throw new Error("geometry's type is invalid, only support type of Point")},isGeoJSON:function(t){return!(!t||"object"!=typeof t||!t.type||!S$[t.type]||t instanceof Kh)}},E$=/\{*(\$root)*\}/g;let O$=class extends xu{constructor(t,e,n){!e||e instanceof Kh||Array.isArray(e)||S$[e.type]||(n=e,e=null),super(t,null,n),this.pickingId=0,this.yn={},this._n={},this.wn={},this.setStyle(n&&n.style),e&&this.addGeometry(e)}static registerShader(t,e,n,i){FK[t]={name:t,type:e,config:n,uniforms:i}}static removeShader(t){delete FK[t]}static getShaders(){const t=[];for(const e in FK)t.push({shader:e,uniforms:FK[e].uniforms});return t}static getShaderMap(){return FK}addGeometry(t,e){let n=I$.isGeoJSON(t)?I$.toGeometry(t,this.getJSONType()):t;n=Array.isArray(n)?n:[n];for(let i=0;i<n.length;i++)if(!this.xn(n[i]))return void console.error("type of geometry is invalid");super.addGeometry(n,e),Array.isArray(n)&&this.addMarker(n)}addMarker(t){for(let e=0;e<t.length;e++){const n=t[e];n.Ht(this.pickingId),this.yn[this.pickingId]=n;const i=n.getId();i&&(this.wn[i]=n),n.fire("add",{type:"add",target:n,layer:this});const r=n.getUrl(),o=this.getRenderer();if(o&&o.xe[r]&&n.fire("load",{type:"load",target:n,data:o.xe[r].L()}),"multigltfmarker"===n.getGLTFMarkerType()){const t=n.getCount()||1;this.pickingId+=t}else this.pickingId++}}Tn(t){const e=this.getRenderer();e&&e.loginGLTFMarker(t)}toJSON(t){t||(t={});const e={type:this.getJSONType(),id:this.getId(),options:this.config()};if((IK(t.style)||t.style)&&(e.style=this.getStyle()),IK(t.geometries)||t.geometries){const t=[],n=this._geoList;for(let e=0;e<n.length;e++){const i=n[e].Xt();t.push(i)}e.geometries=t}return e}xn(t){return!!t.getGLTFMarkerType&&this.options.markerTypes.indexOf(t.getGLTFMarkerType())>-1}setStyle(t){return t?(this.options.style=t,this.vn=JSON.parse(JSON.stringify(t)),this.Mn(),this.fire("setstyle",{target:this,style:this.vn}),this):(delete this.vn,delete this.options.style,this)}getStyle(){return this.options.style}updateSymbol(t,e){const n=this.getStyle();this.On(t,e,n),this.On(t,e,this.vn),this.Mn(),this.fire("updatesymbol",{target:this,index:t,symbol:e})}On(t,e,n){if(!n)return;const i=(n.style?n.style:n)[t].symbol||{};for(const r in e)i[r]=e[r]}Mn(){this._processRootUrl(this.vn),this.An=LO(this.vn.style?this.vn.style:this.vn),this._geoList.forEach((function(t){this.Sn(t)}),this)}getGLTFUrls(){return Object.keys(this._n)}_processRootUrl(t){gi.isString(t.$root)&&t.style.forEach((e=>{const n=e.symbol.url;n&&n.indexOf("{$root}")>-1&&(e.symbol.url=n.replace(E$,t.$root))}))}Sn(t){if(!this.An)return!1;for(let e=0,n=this.An.length;e<n;e++)if(!0===this.An[e].filter({properties:t.getProperties()})){const n=this.An[e].symbol;return t.C("url",n.url),t.updateSymbol(n),!0}return!1}In(t){if(this.An)for(let e=0,n=this.An.length;e<n;e++)!0===this.An[e].filter({properties:t.getProperties()})&&this.An[e].outline&&t.outline()}En(t){const e=gi.isString(t)?this.wn[t].W():t.W(),n=this.getRenderer();n&&n.Pn(e),delete this.yn[e],delete this.wn[t]}clear(){return super.clear(),this.yn={},this.wn={},this}an(){return this.yn}nn(t,e,n){const i=this.getRenderer();return i?i.nn(t,e,n):null}_isModelsLoadComplete(){const t=this._geoList;for(let e=0;e<t.length;e++)if(!t[e].isLoaded())return!1;return!0}Ct(t){const e=this.getRenderer();return e?e.Ct(t):null}V(t){const e=this.getRenderer();e&&e.V(t)}outlineBatch(t){const e=this.vn.style?this.vn.style:this.vn;e[t].outline=!0,this.An=LO(e),this._geoList.forEach((t=>{this.In(t)}))}outlineAll(){this._geoList.forEach((t=>{t.outline()}))}cancelOutline(){this.vn&&(this.vn.style?this.vn.style:this.vn).forEach((t=>{delete t.outline})),this._geoList.forEach((t=>{t.cancelOutline()}))}};O$.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0});let R$=class t extends(qS(O$)){static initDefaultShader(){const e={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new E_};t.registerShader("phong","PhongShader",e.shader,e.material.getUniforms());const n={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",tangentAttribute:"TANGENT",colorAttribute:"COLOR_0",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",extraCommandProps:{cull:{enable:!0},frontFace:"ccw",blend:{enable:(t,e)=>!!e.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}},material:new Xw.StandardMaterial({})};t.registerShader("pbr","pbr.StandardShader",n.shader,n.material.getUniforms()),t.registerShader("depth","pbr.StandardDepthShader",n.shader,n.material.getUniforms());const i={shader:{positionAttribute:"POSITION",color0Attribute:"COLOR_0",extraCommandProps:{blend:{enable:!1,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new T_};t.registerShader("pointline","PointLineShader",i.shader,i.material.getUniforms());const r={shader:{positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}},material:new T_({lineColor:[0,0,0,1],lineOpacity:1})};t.registerShader("wireframe","EdgeShader",r.shader,r.material.getUniforms());const o={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new R_};t.registerShader("pbr-lite","StandardLiteShader",o.shader,o.material.getUniforms())}static fromJSON(e){if(!e||"GLTFLayer"!==e.type)return null;const n=new t(e.id,e.options),i=e.geometries,r=[];for(let t=0;t<i.length;t++){const e=i[t].type,n=f$.getJSONClass(e);if(!n||!n.fromJSON)throw new Error("unsupported gltfmarker type:"+e);const o=n.fromJSON(i[t]);o&&r.push(o)}return n.addGeometry(r),e.style&&n.setStyle(e.style),n}setURLModifier(t){return this.kn=t,this}getURLModifier(){return this.kn}onAdd(){const t=this.getMap();this._geoList.forEach((e=>{EK(e.getZoomOnAdded())||e.setZoomOnAdded(t.getZoom())})),super.onAdd()}onRemove(){super.onRemove(),this.clear()}identify(t,e){const n=this.getMap();if(!n)return[];const i=n.coordinateToContainerPoint(new $o(t));return this.identifyAtPoint(i,e)}identifyAtPoint(t,e={}){const n=[];if(!e.excludeMasks){const i=this.identifyMask(t,e);i&&i.length&&gi.pushIn(n,i)}const i=this.getMap();if(!i)return[];const r=i.getDevicePixelRatio(),o=this.nn(t.x*r,t.y*r,e);if(o&&(o.data||o.length))if(e.includeInternals&&!e.excludeMasks){n.push(o.data);const t=e.domEvent;t&&(t.gltfPickingInfo=t.gltfPickingInfo||{},t.gltfPickingInfo[this.getId()]=o)}else n.push(o);return e&&e.filter&&!e.excludeMasks?n.filter((t=>e.filter(t.data||t))):n}ae(){this.pickingId=0;const t={};for(const e in this.yn){const n=this.yn[e];n.Ht(this.pickingId),n.P(!0),t[this.pickingId]=n;const i=n.getCount()||1;this.pickingId+=i}this.yn=t}_onGeometryEvent(t){if(!t||!t.target)return;const e=t.type;if("meshcreate"===e)this.Ln(t);else if("modelerror"===e)this.Nn(t);else if("positionchange"===e){const t=this.getRenderer();t&&t.setToRedraw()}super._onGeometryEvent(t)}Nn(t){const{url:e,info:n}=t;console.error(n),this.fire("modelerror",{type:"modelerror",url:e,info:n})}Ln(t){this._n[t.url]=1,this.getRenderer().setToRedraw(),this._isModelsLoadComplete()&&this.fire("modelload",{models:this.getGLTFUrls()})}};R$.initDefaultShader(),R$.mergeOptions({markerTypes:["gltfmarker","multigltfmarker"],pointSize:1}),R$.registerJSONType("GLTFLayer"),R$.registerRenderer("gl",P$);const D$=new $o(0,0),k$=new ht(0,0),L$=new ht(0,0),F$=new ht(0,0),N$=[];let z$=class t extends x${constructor(t,e){super(null,e),this.on("load",(()=>{this.setCoordinates(t)}))}static fromJSON(e){return new t(e.data,e.options)}setCoordinates(t){this.oe=t,this.Cn()}getCoordinates(){return this.oe}toJSON(){const t=super.toJSON();return t.type="GLTFLineString",t}Cn(){const t=this.oe;if(t){this.removeAllData();for(let e=0;e<t.length-1;e++){const n=this.Rn(t[e]),i=this.Rn(t[e+1]);this.Bn(n,i).forEach((t=>{this.addData(t)}))}this.l=!0}}Bn(t,e){const n=[],i=this.getMap();if(!i)return n;const r=i.getProjection().measureLenBetween(t,e),o=this.Fn(t,e),s=Math.floor(r/o),a=this.Dn(t,e);if(s>=1){for(let i=1;i<=s;i++){const s={coordinates:this.Un(t,e,o*(i-.5)/r),scale:[1,1,1],rotation:[0,0,a]};n.push(s)}if(this.options.scaleVertex){const i=(r-o*s)/o,h={coordinates:this.Un(t,e,(o*s+(r-o*s)/2)/r),scale:[i,1,1],rotation:[0,0,a]};n.push(h)}}else if(this.options.scaleVertex){const i=r/o,s={coordinates:this.Un(t,e,.5),scale:[i,1,1],rotation:[0,0,a]};n.push(s)}return n}Un(t,e,n){const i=B$(t.x,e.x,n),r=B$(t.y,e.y,n),o=B$(t.z||0,e.z||0,n);return new $o(i,r,o)}Fn(t,e){const n=this.getMap(),i=n.getGLRes(),r=new $o(0,(t.y+e.y)/2),o=n.altitudeToPoint(100,i,r)/n.altitudeToPoint(100,i),s=this.getGLTFBBox(),a=this.options.direction||0,h=[1,1,1];if(this.getModelHeight())this.ut(h);else{const t=this.getSymbol();pg(h,t.scaleX||1,t.scaleY||1,t.scaleZ||1)}const l=Dg(N$,s.max,s.min);return yg(l,l,h),l[a]/o+this.options.gapLength}Dn(t,e){const n=this.getMap(),i=n.getGLRes(),r=n.coordinateToPointAtRes(t,i),o=n.coordinateToPointAtRes(e,i);return gi.computeDegree(o.x,o.y,r.x,r.y)/Math.PI*180}Rn(t){return Array.isArray(t)?new $o(t):t}};function B$(t,e,n){return t+n*(e-t)}z$.mergeOptions({direction:0,gapLength:0,scaleVertex:!0}),z$.registerJSONType("GLTFLineString");const H$=new sx({url:void 0,mag:"linear"});let j$=class extends P${constructor(t){super(t),this._textureMap={}}pn(t){return this.regl&&this._textureMap[t]?this._textureMap[t].texture.getREGLTexture(this.regl):H$}dn(t){if(this._textureMap[t])this._textureMap[t].count++;else{this.Vn=this.Vn||new V_;const e=new sx({url:"default"===t?void 0:t,mag:"linear"},this.Vn);e.once("complete",(()=>{this.setToRedraw()}),this),this._textureMap[t]={count:1,texture:e}}}un(t){this._textureMap[t]&&(this._textureMap[t].count--,this._textureMap[t].count<1&&(this._textureMap[t].texture.dispose(),delete this._textureMap[t]))}},U$=class t extends O${static initDefaultShader(){const e={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new T_};t.registerShader("effect","MeshShader",e.shader,e.material.getUniforms())}onAddGeometry(t){super.onAddGeometry(t);const e=t.getTextureUrl(),n=this.getRenderer();n?n.dn(e):this.on("renderercreate",(t=>{t.renderer.dn(e)}))}remove(){const t=this.getRenderer();t&&this._geoList.forEach((e=>{const n=e.getTextureUrl();t.un(n)})),super.remove()}clear(){const t=this.getRenderer();t&&this._geoList.forEach((e=>{const n=e.getTextureUrl();t.un(n)})),super.clear()}getTextureMapTest(){const t=this.getRenderer();return t?t._textureMap:null}};U$.initDefaultShader(),U$.mergeOptions({markerTypes:["effectmarker"]}),U$.registerJSONType("EffectLayer"),U$.registerRenderer("gl",j$);let G$=class t extends f${constructor(t,e){super(t,e),this.h="glowmarker"}static fromJSON(e){return new t(e.coordinates,e.options)}getUrl(){return"plane"}setSpeed(t){this.setUniform("speed",t)}getSpeed(){return this._getInternalSymbol().uniforms.speed}getShader(){return"glowmarker"}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation}X(){let t=this._getInternalSymbol().uniforms.time||0;t+=.01,this.setUniform("time",t)}};G$.mergeOptions({visible:!0});let V$=class t extends O${static initDefaultShader(){const e={shader:{vert:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        attribute vec3 aPosition;\n        uniform mat4 projViewModelMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 positionMatrix;\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        #include <get_output>\n        void main(){\n            mat4 localPositionMatrix = getPositionMatrix();\n            vec4 localVertex = getPosition(aPosition);\n            vec4 position = localPositionMatrix * localVertex;\n            gl_Position = projViewModelMatrix * position;\n            vec4 worldPos = modelMatrix * position;\n            v_FragPos = worldPos.xyz;\n            v_center = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;\n        }\n    ",frag:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        #define pi 3.14159\n        const float dotsnb = 30.0; // Number of dots\n\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        uniform float time;\n        uniform float radius;\n        uniform vec3 color;\n        uniform float speed;\n        vec3 hsb2rgb(in vec3 c)\n        {\n            vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0,0.0,1.0 );\n            rgb = rgb*rgb*(4.0-2.0*rgb);\n            return c.z * mix( vec3(1.0), rgb, c.y);\n        }\n\n        void main()\n        {\n            float r = length(v_FragPos - v_center);\n            r = r*2.-1.;\n            if(r>radius) {\n                gl_FragColor = vec4(1.0,1.0,1.0, 0.0);\n            } else {\n                //vec3 color = hsb2rgb(vec3(fract(time*.1),.7,.4));\n                vec3 color = color;\n                float s = abs(sin(pow(r+5.0, 1.5)-time*speed+sin(r*0.9))*sin(r+.99));\n                color *= (abs(1./(s*10.8))-.01);\n                gl_FragColor = vec4(color, (color.x + color.y + color.z) / 1.0);\n            }\n        }\n    ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp([],e.projViewMatrix,e.modelMatrix)}}],positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]}}},material:new T_};t.registerShader("glowmarker","MeshShader",e.shader,e.material.getUniforms())}};V$.initDefaultShader(),V$.mergeOptions({markerTypes:["glowmarker"]}),V$.registerJSONType("GlowMarkerLayer"),V$.registerRenderer("gl",P$);const W$={url:"plane",animation:!0,loop:!0,rotation:[0,0,0],translation:[0,0,30],scale:[1,1,30]},q$={width:1,height:1,modelHeight:60,startOpacity:0,endOpacity:1};let Z$=class t extends O${static initDefaultShader(){const e={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        varying float vHeight;\n        void main()\n        {\n            vec4 worldPosition = modelMatrix * vec4(aPosition, 1.0);\n            gl_Position = projViewMatrix * worldPosition;\n            vHeight = worldPosition.z;\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n        uniform float modelHeight;\n        uniform float startOpacity;\n        uniform float endOpacity;\n        varying float vHeight;\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            float opacity = (endOpacity - startOpacity) * (1.0 - vHeight / modelHeight);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a * opacity;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new T_};t.registerShader("effectline","MeshShader",e.shader)}};Z$.initDefaultShader(),Z$.mergeOptions({markerTypes:["effectmarker"]}),Z$.registerJSONType("EffectLineLayer"),Z$.registerRenderer("gl",j$);const Q$={offsetX:0,offsetY:0,uReflectivity:.8,opacity:.9,color:[.9,0,0,1]};let X$=class t extends O${static initDefaultShader(){const e={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        attribute vec3 aNormal;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 normalMatrix;\n        uniform float offsetX;\n        uniform float offsetY;\n        varying vec2 uv;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            uv = vec2(aTexCoord.x + offsetX, aTexCoord.y + offsetY);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D effectTexture;\n        uniform vec3 uCameraPosition;\n        uniform mat4 viewMatrix;\n        uniform float uReflectivity;\n        uniform vec4 color;\n        uniform float opacity;\n\n        varying vec2 uv;\n\n        vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {\n            return normalize((vec4(dir, 0.0) * matrix).xyz);\n        }\n\n        const float GAMMA_FACTOR = 2.0;\n        vec4 GammaToLinear(in vec4 value, in float gammaFactor) {\n            return vec4(pow(value.xyz, vec3(gammaFactor)), value.w);\n        }\n\n        vec4 mixTexelToLinear(vec4 value) {\n            return GammaToLinear(value, float(GAMMA_FACTOR));\n        }\n\n        void main() {\n            vec4 texColor = texture2D(effectTexture, uv);\n            if (color.a == 0.0) {\n                discard;\n            }\n            vec4 mixColor = mixTexelToLinear(color);\n            texColor.rgb += mixColor.xyz * uReflectivity;\n            texColor.a*= opacity;\n            gl_FragColor = texColor;\n        }\n    ",uniforms:[{name:"normalMatrix",type:"function",fn:function(t,e){const n=[];return Bp(n,e.modelMatrix),zp(n,n),n}}],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new T_};t.registerShader("effectring","MeshShader",e.shader)}};X$.initDefaultShader(),X$.mergeOptions({markerTypes:["effectring"]}),X$.registerJSONType("EffectRingLayer"),X$.registerRenderer("gl",P$);const Y$={animation:!0,loop:!0,url:"plane",effect:"sequence",speed:1,scale:[1,1,1],rotation:[90,0,0]},J$={width:9,height:5};if(cE){const t=Al.VERSION;t.indexOf("1.0.0-beta")>=0||t.indexOf("1.0.0-alpha")>=0?cr("@maptalks/gltf-layer",cE.inject(SK)):cr("@maptalks/gltf-layer",(function(){return cE.inject(SK)}))}else cr("@maptalks/gltf-layer",SK);var K$="[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0)&&!process.versions.electron&&!process.versions.nw&&!process.versions["node-webkit"],$$={isTest:!1,idleLog:!1,idleForceTimeThreshold:48,workerCount:("undefined"!=typeof globalThis?globalThis:t||self).MAPTALKS_WORKER_COUNT||0,messagePostRatioPerWorker:.3,maxFPS:0};function t0(){return Date.now()}function e0(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var i=0;i<e.length;i++){var r=e[i];for(var o in r)t[o]=r[o]}return t}function n0(t){return null==t}function i0(t){return"number"==typeof t&&!isNaN(t)}function r0(t){return(0|t)===t}function o0(t){return"object"==typeof t&&!!t}function s0(t){return!n0(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function a0(t){return!n0(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}var h0=Object.prototype.hasOwnProperty;function l0(t,e){return h0.call(t,e)}var u0=Math.PI/180;function c0(t){return t*u0}function A0(t){return t/u0}var f0={};function d0(){return window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI}if(!K$){var p0=navigator.userAgent.toLowerCase(),g0=document.documentElement||{style:{}},m0="ActiveXObject"in window,y0=-1!==p0.indexOf("webkit"),v0=-1!==p0.indexOf("phantom"),_0=-1!==p0.search("android [23]"),x0=-1!==p0.indexOf("chrome"),b0=-1!==p0.indexOf("gecko")&&!y0&&!window.opera&&!m0,w0=/iphone/i.test(p0)&&/micromessenger/i.test(p0),C0="undefined"!=typeof orientation||-1!==p0.indexOf("mobile"),P0=!window.PointerEvent&&window.MSPointerEvent,M0=window.PointerEvent&&navigator.pointerEnabled||P0,T0=m0&&"transition"in g0.style,S0="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!_0,I0="MozPerspective"in g0.style,E0="OTransition"in g0.style,O0=(T0||S0||I0)&&!E0&&!v0,R0="undefined"!=typeof window&&a0(window.createImageBitmap),D0="undefined"!=typeof window&&a0(window.ResizeObserver),k0="undefined"!=typeof window&&a0(window.btoa),L0="undefined"!=typeof window&&a0(window.Proxy),F0="undefined"!=typeof window&&a0(window.requestIdleCallback),N0=0;x0&&(N0=p0.match(/chrome\/([\d.]+)/)[1]);var z0=!v0&&(M0||"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch),B0="undefined"!=typeof window&&"WebGLRenderingContext"in window,H0=d0(),j0=!1;try{new OffscreenCanvas(2,2).getContext("2d"),j0=!0}catch(uft){j0=!1}var U0=!1;try{window.addEventListener("testPassive",(function(){}),{get passive(){return U0=!0,!0}})}catch(cft){}f0={IS_NODE:K$,isTest:!1,ie:m0,ielt9:m0&&!document.addEventListener,edge:"msLaunchUri"in navigator&&!("documentMode"in document),webkit:y0,gecko:b0,android:-1!==p0.indexOf("android"),android23:_0,chrome:x0,chromeVersion:N0,safari:!x0&&-1!==p0.indexOf("safari"),phantomjs:v0,ie3d:T0,webkit3d:S0,gecko3d:I0,opera12:E0,any3d:O0,iosWeixin:w0,mobile:C0,mobileWebkit:C0&&y0,mobileWebkit3d:C0&&S0,mobileOpera:C0&&window.opera,mobileGecko:C0&&b0,touch:!!z0,msPointer:!!P0,pointer:!!M0,retina:H0>1,devicePixelRatio:H0,language:navigator.browserLanguage?navigator.browserLanguage:navigator.language,ie9:m0&&9===document.documentMode,ie10:m0&&10===document.documentMode,webgl:B0,imageBitMap:R0,resizeObserver:D0,btoa:k0,decodeImageInWorker:j0,monitorDPRChange:!0,supportsPassive:U0,proxy:L0,requestIdleCallback:F0,checkDevicePixelRatio:function(){if("undefined"!=typeof window&&f0.monitorDPRChange){var t=d0(),e=t!==f0.devicePixelRatio;return e&&(f0.devicePixelRatio=t),e}return!1}}}var G0=f0,V0=function(t,e){return(V0=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function W0(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}V0(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var q0=function(){return q0=Object.assign||function(t){for(var e,n=1,i=arguments.length;n<i;n++)for(var r in e=arguments[n])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t},q0.apply(this,arguments)};function Z0(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],i=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Q0(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var i,r,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(i=o.next()).done;)s.push(i.value)}catch(a){r={error:a}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(r)throw r.error}}return s}function X0(t,e,n){if(2===arguments.length)for(var i,r=0,o=e.length;r<o;r++)!i&&r in e||(i||(i=Array.prototype.slice.call(e,0,r)),i[r]=e[r]);return t.concat(i||Array.prototype.slice.call(e))}"function"==typeof SuppressedError&&SuppressedError;var Y0,J0,K0=function(){function t(t,e,n){if(n0(t)||n0(e)?n0(t.x)||n0(t.y)?Array.isArray(t)&&(this.x=+t[0],this.y=+t[1],this.z=t[2]):(this.x=+t.x,this.y=+t.y,this.z=t.z):(this.x=+t,this.y=+e,this.z=n),this._isNaN())throw new Error("Position is NaN")}return t.prototype.set=function(t,e,n){return this.x=t,this.y=e,this.z=n||0,this},t.prototype._abs=function(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this},t.prototype._round=function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},t.prototype._ceil=function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},t.prototype.distanceTo=function(t){var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},t.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype._floor=function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},t.prototype._add=function(t,e){return n0(t.x)?n0(t[0])?(this.x+=t,this.y+=e):(this.x+=t[0],this.y+=t[1]):(this.x+=t.x,this.y+=t.y),this},t.prototype._sub=function(t,e){return n0(t.x)?n0(t[0])?(this.x-=t,this.y-=e):(this.x-=t[0],this.y-=t[1]):(this.x-=t.x,this.y-=t.y),this},t.prototype._substract=function(t,e){return i0(e)?this._sub(t,e):this._sub(t)},t.prototype.substract=function(t,e){return this.sub(t,e)},t.prototype._multi=function(t){return this.x*=t,this.y*=t,this},t.prototype.div=function(t){return this.multi(1/t)},t.prototype._div=function(t){return this._multi(1/t)},t.prototype._isNaN=function(){return isNaN(this.x)||isNaN(this.y)||i0(this.z)&&isNaN(this.z)},t.prototype.isZero=function(){return 0===this.x&&0===this.y},t.prototype.toArray=function(){return i0(this.z)?[this.x,this.y,this.z]:[this.x,this.y]},t.prototype.toJSON=function(){var t={x:this.x,y:this.y};return i0(this.z)&&(t.z=this.z),t},t}(),$0=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},e.prototype.unit=function(){return this.copy()._unit()},e.prototype._unit=function(){return this._div(this.mag()),this},e.prototype.perp=function(){return this.copy()._perp()},e.prototype._perp=function(){var t;return t=Q0([-this.y,this.x],2),this.x=t[0],this.y=t[1],this},e.prototype.angleWith=function(t){return this.angleWithSep(t.x,t.y)},e.prototype.angleWithSep=function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},e.prototype._rotate=function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},e.prototype.rotate=function(t){return this.copy()._rotate(t)},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.round=function(){return new e(Math.round(this.x),Math.round(this.y))},e.prototype.ceil=function(){return new e(Math.ceil(this.x),Math.ceil(this.y))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.copy=function(){return new e(this.x,this.y,this.z)},e.prototype.toFixed=function(t){return new e(this.x.toFixed(t),this.y.toFixed(t),i0(this.z)?this.z.toFixed(t):void 0)},e.prototype.add=function(t,n){var i,r;return n0(t.x)?n0(t[0])?(i=this.x+t,r=this.y+n):(i=this.x+t[0],r=this.y+t[1]):(i=this.x+t.x,r=this.y+t.y),new e(i,r)},e.prototype.sub=function(t,n){var i,r;return n0(t.x)?n0(t[0])?(i=this.x-t,r=this.y-n):(i=this.x-t[0],r=this.y-t[1]):(i=this.x-t.x,r=this.y-t.y),new e(i,r)},e.prototype.multi=function(t){return new e(this.x*t,this.y*t)},e.prototype.equals=function(t){return t instanceof this.constructor&&this.x===t.x&&this.y===t.y&&this.z===t.z},e}(K0);function t1(t){var e="data:image/svg+xml";return t.length>4&&".svg"===t.slice(-4)?1:t.slice(0,18)===e?2:0}function e1(t,e){K$&&e1.node?e1.node(t,e):t.src=e[0]}!function(){if(K$)return Y0=function(t){return setTimeout(t,16)},void(J0=clearTimeout);var t,e,n=1e3/30;function i(t){return setTimeout(t,n)}function r(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}"undefined"!=typeof window?(t=window.requestAnimationFrame||r("RequestAnimationFrame")||i,e=window.cancelAnimationFrame||r("CancelAnimationFrame")||r("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)}):(t=i,e=clearTimeout),Y0=function(e){return t(e)},J0=function(t){t&&e(t)}}();var n1=0;function i1(){return n1++}var r1=i1;function o1(t){return t&&s0(t)?JSON.parse(t):t}function s1(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=t[0],i=1;i<t.length;i++){var r=t[i];if(r&&r.length)for(var o=0,s=r.length;o<s;o++)n.push(r[o])}return n.length}function a1(t,e){var n=e.indexOf(t);n>-1&&e.splice(n,1)}function h1(t,e,n){if(!Array.isArray(t))return n?e.call(n,t):e(t);for(var i,r,o=[],s=0,a=t.length;s<a;s++)n0(i=t[s])?o.push(null):Array.isArray(i)?o.push(h1(i,e,n)):(r=n?e.call(n,i):e(i),o.push(r));return o}function l1(t,e){return void 0===t?e:t}function u1(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}function c1(t,e,n){return t*(1-n)+e*n}function A1(t,e,n){if(t===n||t===e)return t;var i=n-e;return((t-e)%i+i)%i+e}function f1(t,e,n){return Math.min(n,Math.max(e,t))}function d1(t){return Array.isArray(t)&&t.length>0}var p1=/^([a-z][a-z\d+\-.]*:)?\/\//i,g1=/^url\((['"])(.+)\1\)$/i,m1=/^url\(([^'"].*[^'"])\)$/i;function y1(t){var e,n=s0(e=t)?m1.test(e)?1:g1.test(e)?2:3:0;return 3===n?t:1===n?m1.exec(t)[1]:2===n?g1.exec(t)[2]:t}var v1="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function _1(t,e,n,i){return Math.atan2(i-e,n-t)}var x1="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7";function b1(t,e){if(!t&&!e)return!0;if(!t||!e)return!1;for(var n in t)if("center"===n){if(!e[n]||!w1(t[n][0],e[n][0])||!w1(t[n][1],e[n][1]))return!1}else if(t[n]!==e[n])return!1;return!0}function w1(t,e,n){return null==n&&(n=1e-6),t>=e-n&&t<=e+n}function C1(t,e,n,i){void 0===t&&(t=100),void 0===e&&(e=4),void 0===n&&(n=null),void 0===i&&(i=null),t||(t=100),e||(e=4);var r=this,o=this.isVisible();return e*=2,this._flashTimeout&&clearTimeout(this._flashTimeout),this._flashTimeout=setTimeout((function s(){if(0===e)return o?r.show():r.hide(),void(n&&(i?n.call(i):n()));e%2==0?r.hide():r.show(),e--,r._flashTimeout=setTimeout(s,t)}),t),this}function P1(t,e){void 0===t&&(t=[]),void 0===e&&(e="_pt");for(var n=[],i=0,r=t.length;i<r;i++){var o=t[i];if(o){o[e]||(o[e]=new $0(0,0));var s=o[e];s.x=0,s.y=0,n.push(s)}else n.push(null)}return n}function M1(t,e){e(t.data)}function T1(t){if(t&&0===t.indexOf("http://")||0===t.indexOf("https://"))return t;var e=document.createElement("a");return e.href=t,t=e.href,e=null,t}var S1={cssWidth:"1px",cssHeight:"1px",width:1,height:1};function I1(t,e){void 0===e&&(e=1);var n=t.width,i=t.height;return S1.cssWidth=n+"px",S1.cssHeight=i+"px",S1.width=Math.round(n*e),S1.height=Math.round(i*e),S1}var E1="_maptalks__internal_layer_",O1=["MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"],R1=["FeatureCollection","Feature","Point","LineString","Polygon"].concat(O1),D1=["markerFile","polygonPatternFile","linePatternFile","markerFillPatternFile","markerLinePatternFile"],k1=[["markerWidth","markerHeight"],[],[null,"lineWidth"],[],[null,"markerLineWidth"]],L1={lineWidth:1,lineOpacity:1,lineDx:1,lineDy:1,polygonOpacity:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerOpacity:1,markerFillOpacity:1,markerLineWidth:1,markerLineOpacity:1,textSize:1,textOpacity:1,textHaloRadius:1,textWrapWidth:1,textLineSpacing:1,textDx:1,textDy:1},F1=["lineColor","polygonFill","markerFill","markerLineColor","textFill"],N1=14,z1=function(){function t(t,e){i0(t)&&i0(e)?(this.width=t,this.height=e):i0(t.width)?(this.width=t.width,this.height=t.height):Array.isArray(t)&&(this.width=t[0],this.height=t[1])}return t.prototype.copy=function(){return new t(this.width,this.height)},t.prototype.add=function(e,n){var i,r;return e instanceof t?(i=this.width+e.width,r=this.height+e.height):(i=this.width+e,r=this.height+n),new t(i,r)},t.prototype.equals=function(t){return this.width===t.width&&this.height===t.height},t.prototype.multi=function(e){return new t(this.width*e,this.height*e)},t.prototype._multi=function(t){return this.width*=t,this.height*=t,this},t.prototype._round=function(){return this.width=Math.round(this.width),this.height=Math.round(this.height),this},t.prototype.toPoint=function(){return new $0(this.width,this.height)},t.prototype.toArray=function(){return[this.width,this.height]},t.prototype.toJSON=function(){return{width:this.width,height:this.height}},t}(),B1="";function H1(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function j1(t,e,n){if(!t)return t;for(;t.indexOf(e)>-1;)t=t.replace(e,n);return t}var U1=/[\b\t\r\v\f]/gim;function G1(t){return s0(t)?t.replace(U1,B1):t}var V1="undefined"!=typeof document?document.createElement("canvas").getContext("2d"):null;function W1(t,e){return W1.node?W1.node(t,e):(V1.font=e,V1.measureText(t).width)}function q1(t,e,n){var i=W1(t,e);return new z1(i,n||N1)}function Z1(t,e,n,i){if(!t||0===t.length)return[{text:"",width:0}];var r=n0(i)?W1(t,e):i,o=r/t.length,s=Math.floor(n/o/2);if(o>=n||s<=0)return[{text:"",width:n}];if(r<=n)return[{text:t,width:r}];for(var a=[],h=t.substring(0,s),l=o*s,u=s,c=t.length;u<c;u++){var A=t[u],f=W1(h+A);f>=n?(a.push({text:h,width:l}),h=t.substring(u,s+u),u+=s-1,l=o*s):(h+=A,l=f),u>=c-1&&(l=W1(h),a.push({text:h,width:l}))}return a}var Q1=["{","}"];function X1(t,e){if(!s0(t))return t;function n(t){if(!e)return B1;var n=e[t];return n0(n)?B1:Array.isArray(n)?n.join():n}for(var i=Q0(Q1,2),r=i[0],o=i[1],s=function(t){t+=B1;for(var e=Q0(Q1,2),n=e[0],i=e[1],r=[],o=!1,s=B1,a=0,h=t.length;a<h;a++){var l=t[a];o||l!==n||(o=!0),l===n&&o&&(s=B1),o&&l!==n&&l!==i&&(s+=l),l===i&&s&&(o=!1,r.push(s),s=B1)}return r}(t),a=0,h=s.length;a<h;a++){var l=s[a],u=n(l);t=j1(t,"".concat(r).concat(l).concat(o),u)}return t}function Y1(t,e){i0(t)&&(t+="");var n=e.textMaxHeight||0,i=e2(t=t||"",e);return n&&n<i.size.height&&(i.size.height=n),i}function J1(t,e,n){var i=t.width,r=t.height;return new $0("left"===e?-i:"right"===e?0:-i/2,"top"===n?-r:"bottom"===n?0:-r/2)}var K1="sans-serif",$1=14;function t2(t){if(t.textFont)return t.textFont;var e=t.textSize;return n0(e)&&(e=$1),(t.textStyle&&"normal"!==t.textStyle?t.textStyle+" ":"")+(t.textWeight&&"normal"!==t.textWeight?t.textWeight+" ":"")+e+"px "+(t.textFaceName&&function(t){for(var e=t.split(","),n=0;n<e.length;n++)e[n].trim&&(e[n]=e[n].trim()),e[n].indexOf(" ")>0&&'"'!==e[n][0]&&"'"!==e[n][0]&&(e[n]='"'+e[n]+'"');return e.join(",")}(t.textFaceName)||K1)}function e2(t,e){var n=t2(e),i=e.textLineSpacing||0,r=q1(t,n,e.textSize),o=r.width,s=r.height,a=e.textWrapCharacter||"\n",h=[],l=e.textWrapWidth;(!l||l>o)&&(l=o),s0(t)||(t+="");var u=0;if(a&&t.indexOf(a)>=0)for(var c=t.split(a),A=0,f=c.length;A<f;A++){var d=c[A],p=W1(d,n);if(p>l)for(var g=0,m=(y=Z1(d,n,l,p)).length;g<m;g++)(v=y[g].width)>u&&(u=v),h.push({text:y[g].text,size:new z1(v,s)});else p>u&&(u=p),h.push({text:d,size:new z1(p,s)})}else if(o>l){var y=Z1(t,n,l,o);for(A=0;A<y.length;A++){var v;(v=y[A].width)>u&&(u=v),h.push({text:y[A].text,size:new z1(v,s)})}}else o>u&&(u=o),h.push({text:t,size:r});var _=h.length;return{total:_,size:new z1(u,s*_+i*(_-1)),rows:h,rawSize:r}}function n2(t){var e=0,n=t&&t.length||0;if(!n)return e;for(var i=0;i<n;i++)e=(e<<5)-e+t.charCodeAt(i),e|=0;return e}var i2=K$?function(t){return t[0]}:function(t){for(var e=document.documentElement&&document.documentElement.style||{},n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1},r2=i2(["transform","WebkitTransform","OTransform","MozTransform","msTransform"]),o2=i2(["transformOrigin","WebkitTransformOrigin","OTransformOrigin","MozTransformOrigin","msTransformOrigin"]),s2=i2(["transition","WebkitTransition","OTransition","MozTransition","msTransition"]);function a2(t,e){var n=document.createElement(t);return e&&x2(n,e),n}function h2(t,e,n){var i=a2(t);return e&&y2(i,e),n&&n.appendChild(i),i}function l2(t){if(!t)return this;if(G0.ielt9||G0.ie9){var e=a2("div");e.appendChild(t),e.innerHTML="",e=null}else t.parentNode&&t.parentNode.removeChild(t);return this}function u2(t,e,n,i){if(!(t&&t.addEventListener&&e&&n))return this;for(var r=function(e){e||(e=window.event),n.call(i||t,e)},o=e.split(" "),s=o.length-1;s>=0;s--){var a=o[s];a&&(t["Z__"+a]||(t["Z__"+a]=[]),A2(t,a,n)>=0&&(console.warn(t,"find '".concat(a,"' handler:"),n," The old listener function will be removed"),c2(t,a,n)),t["Z__"+a].push({callback:r,src:n}),t.addEventListener(a,r,!!G0.supportsPassive&&{capture:!1,passive:!1}))}return this}function c2(t,e,n){function i(e,n){"mousewheel"===e&&G0.gecko&&(e="DOMMouseScroll"),t.removeEventListener(e,n,!1)}if(!t||!t.removeEventListener||!e)return this;for(var r=e.split(" "),o=r.length-1;o>=0;o--){var s=r[o];if(s){if(!n&&t["Z__"+s]){for(var a=t["Z__"+s],h=0,l=a.length;h<l;h++)i(a[h].callback);return delete t["Z__"+s],this}var u=A2(t,s,n);if(u<0)return this;i(s,t["Z__"+s][u].callback),t["Z__"+s].splice(u,1)}}return this}function A2(t,e,n){if(!t||!t["Z__"+e]||!n)return-1;for(var i=t["Z__"+e],r=0,o=i.length;r<o;r++)if(i[r].src===n)return r;return-1}function f2(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function d2(t){return t._cancelBubble=!0,t.stopPropagation?t.stopPropagation():t.cancelBubble=!0,this}function p2(t,e){return t?(G0.any3d?(n=t,i=e||new $0(0,0),n.style[r2]=G0.any3d?"translate3d("+i.x+"px,"+i.y+"px,0px)":"translate("+i.x+"px,"+i.y+"px)"):(t.style.left=e.x+"px",t.style.top=e.y+"px"),e):null;var n,i}function g2(t){var e=window.getComputedStyle(t),n=[parseInt(e["padding-left"]),parseInt(e["padding-top"])],i=t.getBoundingClientRect(),r=t.offsetWidth,o=t.offsetHeight;return t.__position=[i.left+n[0],i.top+n[1],r?i.width/r:1,o?i.height/o:1],t.__position}function m2(t,e){t||(t=window.event);var n=e.__position;n||(n=g2(e));var i=t;return i.touches&&i.touches.length&&(t=i.touches[0]),i.changedTouches&&i.changedTouches.length&&(t=i.changedTouches[0]),new $0((t.clientX-n[0]-e.clientLeft)/n[2],(t.clientY-n[1]-e.clientTop)/n[3])}function y2(t,e){var n,i,r,o=t.style.cssText;return i=";",(r=(n=o).length-i.length)>=0&&n.indexOf(i,r)===r||(o+=";"),t.style.cssText=o+e,this}function v2(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=b2(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function _2(t,e){if(void 0===t.classList||v2(t,e)){var n=b2(t);x2(t,(n?n+" ":"")+e)}else for(var i=H1(e).split(/\s+/),r=0,o=i.length;r<o;r++)t.classList.add(i[r]);return this}function x2(t,e){return n0(t.className.baseVal)?t.className=e:t.className.baseVal=e,this}function b2(t){return n0(t.className.baseVal)?t.className:t.className.baseVal}function w2(t){return/<[a-z\][\s\S]*>/i.test(t)}function C2(t,e){var n,i=((n=document.createElement(t)).style.cssText="position:absolute;left:-10000px;top:-10000px;",document.body.appendChild(n),n);s0(e)?i.innerHTML=e:i.appendChild(e);var r=new z1(i.clientWidth,i.clientHeight);return l2(i),r}i2(["filter","WebkitFilter","OFilter","MozFilter","msFilter"]);var P2=u2,M2=c2;function T2(t){return t&&("mousemove"===t||"touchmove"===t)}function S2(t,e){var n=t0();return!!(t._mousemoveTime&&n-t._mousemoveTime<(e||48))||(t._mousemoveTime=n,!1)}var I2={jsonp:function(t,e){var n="_maptalks_jsonp_"+i1();t.match(/\?/)?t+="&callback="+n:t+="?callback="+n;var i=document.createElement("script");return i.type="text/javascript",i.src=t,window[n]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(t,e,n){if(a0(e)){var i=n;n=e,e=i}if(K$&&I2.get.node)return I2.get.node(t,n,e);var r=I2._getClient(n);if(r.open("GET",t,!0),e){for(var o in e.headers)r.setRequestHeader(o,e.headers[o]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(null),r},post:function(t,e,n){var i,r;if(s0(t)?(a0(e)&&(r=n,n=e,e=r),i=(e=e||{}).postData):(i=e,t=(e=t).url,n=r=n),K$&&I2.post.node)return e.url=t,I2.post.node(e,i,n);var o=I2._getClient(n);if(o.open("POST",e.url,!0),e.headers||(e.headers={}),e.headers["Content-Type"]||(e.headers["Content-Type"]="application/x-www-form-urlencoded"),"setRequestHeader"in o)for(var s in e.headers)e.headers.hasOwnProperty(s)&&o.setRequestHeader(s,e.headers[s]);return s0(i)||(i=JSON.stringify(i)),o.send(i),o},_wrapCallback:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e(new Error("http status 200 returned without content.")):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e(new Error(t.statusText+","+t.status)))}},_getClient:function(t){var e;try{e=new XMLHttpRequest}catch(n){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(i){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(r){}}}return e.onreadystatechange=I2._wrapCallback(e,t),e},getArrayBuffer:function(t,e,n){if(a0(e)){var i=n;n=e,e=i}return e||(e={}),e.responseType="arraybuffer",I2.get(t,e,n)},getImage:function(t,e,n){return I2.getArrayBuffer(e,n,(function(e,n){if(e)t.onerror&&t.onerror(e);else if(n){var i=window.URL||window.webkitURL,r=t.onload;t.onload=function(){r&&r(),i.revokeObjectURL(t.src)};var o=new Blob([new Uint8Array(n.data)],{type:n.contentType});t.cacheControl=n.cacheControl,t.expires=n.expires,t.src=n.data.byteLength?i.createObjectURL(o):x1}}))},getJSON:function(t,e,n){}};I2.getJSON=function(t,e,n){if(a0(e)){var i=n;n=e,e=i}var r=function(t,e){var i=e?o1(e):null;n(t,i)};return e&&e.jsonp?I2.jsonp(t,r):I2.get(t,e,r)};var E2="",O2=/data:image\/.*;base64,/;function R2(t,e){for(var n in void 0===e&&(e={}),e){var i=e[n];if(i&&i.target&&(o=n,i0(r=t)&&(r+=E2),i0(o)&&(o+=E2),r&&o&&(r.includes?r.includes(o):r.indexOf(o)>-1)))return t.replace(n,i.target)}var r,o;return E2}var D2={host:E2,resources:{},proxy:{},origin:{},fromJSON:function(t){try{s0(t)&&(t=JSON.parse(t)),o0(t)&&e0(D2,t)}catch(e){console.error(e)}},toJSON:function(){return{host:D2.host,proxy:e0({},D2.proxy||{}),origin:e0({},D2.origin||{})}},getResource:function(t){return D2.resources[t]},removeResource:function(t){delete D2.resources[t]},addResource:function(t,e){D2.resources[t]?console.warn("".concat(t," resource Already exists,the ").concat(t," Cannot be added,the resource name Cannot repeat ")):D2.resources[t]=e},updateResource:function(t,e){D2.resources[t]=e},allResource:function(){return D2.resources},loadSprite:function(t){return void 0===t&&(t={imgUrl:"",jsonUrl:""}),new Promise((function(e,n){var i=t.imgUrl,r=t.jsonUrl;if(!i||!r)return n(new Error("not find imgUrl/jsonUrl from options")),void console.error(t);function o(t,e,n){t.width=e,t.height=n;var i=t.getContext("2d");return i.clearRect(0,0,e,n),i}function s(i,r){void 0===i&&(i={});var s,a=(G0.IS_NODE?console.error("Current environment does not support canvas dom"):s=a2("canvas"),s);if(a){var h=[];for(var l in i)h.push({name:l,spriteItem:i[l]});var u=function(){var t;return G0.decodeImageInWorker&&(t=new OffscreenCanvas(2,2)),t}(),c=t.sourceName||"";h.forEach((function(t){var e,n=t.name,i=t.spriteItem,s=i.x,h=i.y,l=i.width,A=i.height;u?(o(u,l,A).drawImage(r,s,h,l,A,0,0,l,A),e=u.transferToImageBitmap()):(o(a,l,A).drawImage(r,s,h,l,A,0,0,l,A),e=a.toDataURL()),t.resource=e,D2.addResource(c+n,e)})),e(h)}else n(new Error("can not create canvas"))}I2.getJSON(r,{},(function(t,e){if(t)n(t);else{var r=new Image;r.onload=function(){s(e,r)},r.onerror=function(t){n(t)},I2.getImage(r,i,{})}}))}))},loadSvgs:function(t){return new Promise((function(e,n){var i="",r=[],o="",s="",a="";if(Array.isArray(t)||t instanceof NodeList?r=t:o0(t)?(i=t.url,r=t.symbols,o=t.fill,s=t.stroke,a=t.sourceName||""):s0(t)&&(i=t),i||!r||0!==r.length){var h=[],l=function(t,e){var n=function(t){var e=L2.parseFromString(t,"text/xml").querySelector("svg");if(!e)return null;for(var n=e.childNodes,i=[],r=e.attributes,o=F2(r,"fill"),s=F2(r,"fill-opacity"),a=F2(r,"stroke"),h=F2(r,"stroke-opacity"),l=F2(r,"stroke-width"),u=0,c=n.length;u<c;u++){var A=n[u],f=A.attributes;if(f){var d=void 0,p="path"===(A.tagName||"").toLowerCase();if(d=p?F2(f,"d"):A){var g=F2(f,"fill")||o,m=F2(f,"stroke")||a,y={path:d};if(g&&(y.fill=g,y["fill-opacity"]=F2(f,"fill-opacity")||s||1),m&&(y.stroke=m,y["stroke-opacity"]=F2(f,"stroke-opacity")||h||1,y["stroke-width"]=F2(f,"stroke-width")||l||1),i.push(y),!p)for(var v in y)"path"!==v&&y.hasOwnProperty(v)&&A.setAttribute(v,y[v])}}}return i}(e);n&&(n.forEach((function(t){o&&(t.fill=o),s&&(t.stroke=s)})),D2.addResource(a+t,n)),h.push({name:t,paths:n,body:e})};if(i&&s0(i))fetch(i).then((function(t){return t.json()})).then((function(t){t.forEach((function(t){l(t.name,t.body)})),e(h)})).catch((function(t){n(t)}));else if(r){for(var u=0,c=r.length;u<c;u++){var A=r[u],f=A.id,d="<xml><svg>".concat(A.innerHTML,"</svg></xml>");f&&l(f,d)}e(h)}else n(new Error("not support svgs params type"))}else n(new Error("not find svgs data"))}))}};function k2(t){if(i0(t)&&(t+=E2),!t)return console.error("resouce path is null,path:",t),t;if(!s0(t))return t;if(e=t,O2.test(e)||function(t){return 0===t.indexOf("blob:")}(t))return t;var e;if("$"===t[0])return D2.getResource(t.substring(1,1/0))||"";var n=D2.origin||{},i=function(t){return p1.test(t)}(t);if(i&&o0(n))return(r=R2(t,n))||t;var r,o=D2.proxy||{};if(o0(o)&&(r=R2(t,o)))return r;var s=D2.host;return!i&&s&&s0(s)?"".concat(s).concat(t):T1(t)}var L2=new DOMParser;function F2(t,e){return t?t[e]&&t[e].value:null}let N2;const z2={width:100,height:10};function B2(){if(!N2){const{width:t,height:e}=z2;OffscreenCanvas?N2=new OffscreenCanvas(t,e):(N2=document.createElement("canvas"),N2.width=t,N2.height=e)}return N2}class H2{constructor(t,e={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let n=1/0,i=-1/0;for(let r=0,o=t.length;r<o;r++){const e=t[r][0];n=Math.min(e,n),i=Math.max(e,i)}this.min=n,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},z2,e),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const t=B2(),{width:e,height:n}=this.options;t.width=e,t.height=n;const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);const r=i.createLinearGradient(0,0,t.width,0),{colors:o,valueOffset:s}=this;for(let a=0,h=o.length;a<h;a++){const[t,e]=o[a];r.addColorStop((t-this.min)/s,e)}i.fillStyle=r,i.fillRect(0,0,t.width,t.height),this.imgData=i.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t),t=Math.min(t,this.max);let e=Math.round((t-this.min)/this.valueOffset*this.imgData.width);e=Math.min(e,this.imgData.width-1);const n=4*e;return[this.imgData.data[n],this.imgData.data[n+1],this.imgData.data[n+2],this.imgData.data[n+3]]}}var j2;function U2(t,e){var n,i,r;if(J2(t)){var o,s=t.stops&&"object"==typeof t.stops[0][0],a=s||!(s||void 0!==t.property),h=t.type||e||"exponential";if("exponential"===h)o=W2;else if("interval"===h)o=V2;else if("categorical"===h)o=G2;else if("identity"===h)o=Q2;else{if("color-interpolate"!==h)throw new Error('Unknown function type "'+h+'"');o=Z2}if(s){var l={},u=[];for(let e=0;e<t.stops.length;e++){var c=t.stops[e];void 0===l[c[0].zoom]&&(l[c[0].zoom]={zoom:c[0].zoom,type:t.type,property:t.property,default:t.default,stops:[]}),l[c[0].zoom].stops.push([c[0].value,c[1]])}for(let t in l)u.push([l[t].zoom,U2(l[t])]);n=function(e,n){const i=W2({stops:u,base:t.base},e)(e,n);return"function"==typeof i?i(e,n):i},i=!1,r=!1}else a?(n=function(e){const n=o(t,e);return"function"==typeof n?n(e):n},i=!0,r=!1):(n=function(e,n){const i=o(t,n?n[t.property]:null);return"function"==typeof i?i(e,n):i},i=!1,r=!0)}else n=function(){return t},i=!0,r=!0;return n.isZoomConstant=r,n.isFeatureConstant=i,n}function G2(t,e){for(let n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.default}function V2(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function W2(t,e){for(var n=void 0!==t.base?t.base:1,i=0;!(i>=t.stops.length||e<=t.stops[i][0]);)i++;return 0===i?t.stops[i][1]:i===t.stops.length?t.stops[i-1][1]:X2(e,n,t.stops[i-1][0],t.stops[i][0],t.stops[i-1][1],t.stops[i][1])}"function"==typeof Map&&(j2=new Map);const q2={width:100,height:1};function Z2(t,e){const n=t.stops;if(n&&n.length>1){let t;if(j2){const e=JSON.stringify(n);if(!j2.has(e)){const t=new H2(n,q2);j2.set(e,t)}t=j2.get(e)}else t=new H2(n,q2);const[i,r,o,s]=t.getColor(e);return[i/255,r/255,o/255,s/255]}return n&&1===n.length?n[0][1]:null}function Q2(t,e){return function(t,e){return void 0!==t?t:void 0!==e?e:null}(e,t.default)}function X2(t,e,n,i,r,o){return"function"==typeof r?function(){var s=r.apply(void 0,arguments),a=o.apply(void 0,arguments);return X2(t,e,n,i,s,a)}:r.length?function(t,e,n,i,r,o){var s=[];for(let a=0;a<r.length;a++)s[a]=Y2(t,e,n,i,r[a],o[a]);return s}(t,e,n,i,r,o):Y2(t,e,n,i,r,o)}function Y2(t,e,n,i,r,o){var s,a=i-n,h=t-n;return r*(1-(s=1===e?h/a:(Math.pow(e,h)-1)/(Math.pow(e,a)-1)))+o*s}function J2(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function K2(t){for(const e in t)if(J2(t[e]))return!0;return!1}function $2(t){return n5(t,"exponential")}function t5(t,e){if(!t)return null;var n=!1;if(Array.isArray(t)){var i,r=[];for(let o=0;o<t.length;o++)(i=t5(t[o],e))?(r.push(i),n=!0):r.push(t[o]);return n?r:t}var o,s={__fn_types_loaded:!0},a=[];for(o in t)t.hasOwnProperty(o)&&a.push(o);const h=function(t){Object.defineProperty(s,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=$2(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})};for(let l=0,u=a.length;l<u;l++)J2(t[o=a[l]])?(n=!0,s["_"+o]=t[o],h(o)):s[o]=t[o];return n?s:t}function e5(t){if(!t||!t.stops)return[];const e=[];for(let n=0,i=t.stops.length;n<i;n++)e.push(t.stops[n][1]);return e}function n5(t,e){if(!J2(t))return function(){return t};let n=!0,i=!0;const r=(t=JSON.parse(JSON.stringify(t))).stops;if(r)for(let s=0;s<r.length;s++)if(J2(r[s][1])){const t=n5(r[s][1],e);n=n&&t.isZoomConstant,i=i&&t.isFeatureConstant,r[s]=[r[s][0],t]}const o=U2(t,e);return o.isZoomConstant=n&&o.isZoomConstant,o.isFeatureConstant=i&&o.isFeatureConstant,o}const i5=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function r5(t){return new Function("f",`var p = (f && f.properties || {}); return ${o5(t)}`)}function o5(t){if(!t)return"true";const e=t[0];return t.length<=1?"any"===e?"false":"true":`(${"=="===e?a5(t[1],t[2],"===",!1):"!="===e?a5(t[1],t[2],"!==",!1):"<"===e||">"===e||"<="===e||">="===e?a5(t[1],t[2],e,!0):"any"===e?l5(t.slice(1),"||"):"all"===e?l5(t.slice(1),"&&"):"none"===e?A5(l5(t.slice(1),"||")):"in"===e?u5(t[1],t.slice(2)):"!in"===e?A5(u5(t[1],t.slice(2))):"has"===e?c5(t[1]):"!has"===e?A5(c5(t[1])):"contains"===e?function(t,e,n){const i=s5(t);return void 0!==n?`(${i} + '').indexOf("${e}") === ${n}`:`(${i} + '').indexOf("${e}") >= 0`}(t[1],t[2],t[3]):"true"})`}function s5(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function a5(t,e,n,i){return"object"==typeof(r=t)&&r&&t.op?function(t,e,n,i){const r=t.property,o=t.op;let s=s5(r);return"length"!==o?(console.error(`not support ${o} op`),"false"):(s=`((${s}+='').length)`,h5(s,r,e,n,i))}(t,e,n,i):h5(s5(t),t,e,n,i);var r}function h5(t,e,n,i,r){const o="$type"===e?i5.indexOf(n):JSON.stringify(n);return(r?`typeof ${t}=== typeof ${o}&&`:"")+t+i+o}function l5(t,e){return t.map(o5).join(e)}function u5(t,e){"$type"===t&&(e=e.map((t=>i5.indexOf(t))));const n=JSON.stringify(e.sort(f5)),i=s5(t);return e.length<=200?`${n}.indexOf(${i}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${i}, ${n},0,${e.length-1})`}function c5(t){return"$id"===t?'"id" in f':`${JSON.stringify(t)} in p`}function A5(t){return`!(${t})`}function f5(t,e){return t<e?-1:t>e?1:0}function d5(t){const e=t._toJSON(),n=e.feature;return n.type=i5.indexOf(n.geometry.type),n.subType=e.subType,n}function p5(t){if(!Array.isArray(t))return p5([t]);const e=[];for(let n=0;n<t.length;n++){let i;i=!0===t[n].filter?function(){return!0}:r5(t[n].filter),e.push(g5({},t[n],{filter:i}))}return e}function g5(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}var m5=[],y5={};function v5(t,e){return t5(t,(function(){var t,n,i,r,o=e.getMap();return function(t,e,n){return t[0]=e,t[1]=n,t}(m5,o?o.getZoom():12,e0({},e.getProperties(),(t=y5,n=o&&o.getBearing()||0,i=o&&o.getPitch()||0,r=o?o.getZoom():10,t["{bearing}"]=n,t["{pitch}"]=i,t["{zoom}"]=r,t)))}))}function _5(t,e,n){if(!t.markerPath)return null;var i,r,o=1,s=(0===(r={stroke:{stroke:(i=t).markerLineColor,"stroke-width":i.markerLineWidth,"stroke-opacity":i.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:i.markerFill,"fill-opacity":i.markerFillOpacity}}).stroke["stroke-width"]&&(r.stroke["stroke-opacity"]=0),r);i0(t.markerOpacity)&&(o=t.markerOpacity),i0(t.opacity)&&(o*=t.opacity);var a,h={};if(s){for(var l in s.stroke)s.stroke.hasOwnProperty(l)&&(n0(s.stroke[l])||(h[l]=s.stroke[l]));for(var l in s.fill)s.fill.hasOwnProperty(l)&&(n0(s.fill[l])||(h[l]=s.fill[l]))}var u,c=t.markerPath;a=s0(c)&&"$"===c[0]?D2.getResource(c.substring(1,1/0))||[]:Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];for(var A=[],f=0;f<a.length;f++)(u=e0({},u=s0(a[f])?{path:a[f]}:a[f],h)).d=u.path,delete u.path,A.push(u);var d=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];for(o<1&&d.push('opacity="'+o+'"'),t.markerPathWidth&&t.markerPathHeight&&d.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),d.push('preserveAspectRatio="none"'),e&&d.push('width="'+e+'"'),n&&d.push('height="'+n+'"'),d.push("><defs></defs>"),f=0;f<A.length;f++)if(A[f].d instanceof Element)d.push(A[f].d.outerHTML);else{var p="<path ";for(var l in A[f])A[f].hasOwnProperty(l)&&(p+=" "+l+'="'+A[f][l]+'"');d.push(p+="></path>")}d.push("</svg>");var g="data:image/svg+xml;base64,"+function(t){if(G0.btoa)return window.btoa(t);for(var e=String(t),n="",i=void 0,r=void 0,o=0,s=v1;e.charAt(0|o)||(s="=",o%1);n+=s.charAt(63&i>>8-o%1*8)){if((r=e.charCodeAt(o+=3/4))>255)throw new Error("'btoa' failed: The string to be encoded contains characters outside of the Latin1 range.");i=i<<8|r}return n}(d.join(" "));return g}function x5(t,e){if(!t)return[];var n=t;Array.isArray(t)||(n=[t]);for(var i,r,o,s,a=[],h=D1,l=n.length-1;l>=0;l--)if(t=n[l]){e&&(t=b5(t));for(var u=0;u<h.length;u++)if(J2(i=t[h[u]])&&(i=e5(i)),i){Array.isArray(i)||(i=[i]);for(var c=0;c<i.length;c++)"url("===i[c].slice(0,4)&&(i[c]=y1(i[c])),a.push([i[c],t[(r=k1[u])[0]],t[r[1]]])}if("path"===t.markerType&&t.markerPath)if(o=J2(t.markerWidth)?200:t.markerWidth,s=J2(t.markerHeight)?200:t.markerHeight,J2(t.markerPath)){i=e5(t.markerPath);var A=t.markerPath;for(c=0;c<i.length;c++)t.markerPath=i[c],a.push([_5(t),o,s]);t.markerPath=A}else a.push([_5(t),o,s])}return a}function b5(t){if(!t)return null;var e=t;if(K$)return e;for(var n,i=D1,r=0,o=i.length;r<o;r++)(n=e[i[r]])&&(e[i[r]]=w5(n));return e}function w5(t){if(J2(t)&&t.stops){for(var e=t.stops,n=0;n<e.length;n++)e[n][1]=w5(e[n][1]);return t}return"url("===t.slice(0,4)&&(t=y1(t)),t}function C5(t){return t&&t.colorStops}function P5(t){var e=[t.type];if(t.places&&e.push(t.places.join()),t.colorStops){for(var n=[],i=t.colorStops.length-1;i>=0;i--)n.push(t.colorStops[i].join());e.push(n.join(","))}return e.join("_")}function M5(t,e){if(!t)return 1;var n=[];if(Array.isArray(t)){for(var i=0;i<t.length;i++)n.push(M5(t[i]));return n.sort().join(",")}var r=Object.keys(t).sort().reduce((function(e,n){return e[n]=t[n],e}),{});return n2(JSON.stringify(r))}function T5(t,e){function n(t,e){n0(t.opacity)?t.opacity=e:t.opacity*=e}var i;if(Array.isArray(t)){i=[];for(var r=0;r<t.length;r++){var o=e0({},t[r]);n(o,e),i.push(o)}}else n(i=e0({},t),e);return i}function S5(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=t[0],i=Array.prototype.slice.call(t,1);if(i&&i.length||(i=[{}]),Array.isArray(n)){for(var r=void 0,o=void 0,s=[],a=0,h=n.length;a<h;a++){r=n[a],o={};for(var l=0,u=i.length;l<u;l++)Array.isArray(i[l])?n0(i[l][a])?e0(o,r||{}):e0(o,r,i[l][a]):e0(o,r,i[l]?i[l]:{});s.push(o)}return s}var c=[{},n];return c.push.apply(c,i),e0.apply(this,c)}function I5(t){if(t.symbol&&(t=[t]),Array.isArray(t))return t;var e=t.$root,n=t.$iconset;return t=t.style,(e||n)&&(e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),n&&"/"===n[n.length-1]&&(n=n.substring(0,n.length-1)),function(t,e){for(var n=0;n<t.length;n++){var i=t[n].symbol;i&&O5(i,e)}}(t,(function(t){return"{$root}"===t?e:"{$iconset}"===t?n:null}))),t}var E5=/(\{\$root\}|\{\$iconset\})/g;function O5(t,e){for(var n in t)t.hasOwnProperty(n)&&"textName"!==n&&(s0(t[n])&&t[n].length>2?t[n]=t[n].replace(E5,e):J2(t[n])?t[n]=R5(t[n],e):o0(t[n])&&O5(t[n],e))}function R5(t,e){var n=t.default;s0(n)&&(t.default=n.replace(E5,e));var i=t.stops;if(!i)return t;for(var r=0;r<i.length;r++)Array.isArray(i[r])&&(s0(i[r][1])?i[r][1]=i[r][1].replace(E5,e):J2(i[r][1])&&(i[r][1]=R5(i[r][1],e)));return t}function D5(t,e,n,i,r){var o=1/Math.tan(e/2),s=1/(i-r);return t[0]=o/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=o,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=(r+i)*s,t[11]=-1,t[12]=0,t[13]=0,t[14]=2*r*i*s,t[15]=0,t}function k5(t,e,n){var i,r,o,s,a,h,l,u,c,A,f,d,p=n[0],g=n[1],m=n[2];return e===t?(t[12]=e[0]*p+e[4]*g+e[8]*m+e[12],t[13]=e[1]*p+e[5]*g+e[9]*m+e[13],t[14]=e[2]*p+e[6]*g+e[10]*m+e[14],t[15]=e[3]*p+e[7]*g+e[11]*m+e[15]):(r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=e[9],f=e[10],d=e[11],t[0]=i=e[0],t[1]=r,t[2]=o,t[3]=s,t[4]=a,t[5]=h,t[6]=l,t[7]=u,t[8]=c,t[9]=A,t[10]=f,t[11]=d,t[12]=i*p+a*g+c*m+e[12],t[13]=r*p+h*g+A*m+e[13],t[14]=o*p+l*g+f*m+e[14],t[15]=s*p+u*g+d*m+e[15]),t}function L5(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function F5(t,e,n){var i=e[0],r=e[1],o=e[2],s=e[3],a=e[4],h=e[5],l=e[6],u=e[7],c=e[8],A=e[9],f=e[10],d=e[11],p=e[12],g=e[13],m=e[14],y=e[15],v=n[0],_=n[1],x=n[2],b=n[3];return t[0]=v*i+_*a+x*c+b*p,t[1]=v*r+_*h+x*A+b*g,t[2]=v*o+_*l+x*f+b*m,t[3]=v*s+_*u+x*d+b*y,t[4]=(v=n[4])*i+(_=n[5])*a+(x=n[6])*c+(b=n[7])*p,t[5]=v*r+_*h+x*A+b*g,t[6]=v*o+_*l+x*f+b*m,t[7]=v*s+_*u+x*d+b*y,t[8]=(v=n[8])*i+(_=n[9])*a+(x=n[10])*c+(b=n[11])*p,t[9]=v*r+_*h+x*A+b*g,t[10]=v*o+_*l+x*f+b*m,t[11]=v*s+_*u+x*d+b*y,t[12]=(v=n[12])*i+(_=n[13])*a+(x=n[14])*c+(b=n[15])*p,t[13]=v*r+_*h+x*A+b*g,t[14]=v*o+_*l+x*f+b*m,t[15]=v*s+_*u+x*d+b*y,t}function N5(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],s=e[4],a=e[5],h=e[6],l=e[7],u=e[8],c=e[9],A=e[10],f=e[11],d=e[12],p=e[13],g=e[14],m=e[15],y=n*a-i*s,v=n*h-r*s,_=n*l-o*s,x=i*h-r*a,b=i*l-o*a,w=r*l-o*h,C=u*p-c*d,P=u*g-A*d,M=u*m-f*d,T=c*g-A*p,S=c*m-f*p,I=A*m-f*g,E=y*I-v*S+_*T+x*M-b*P+w*C;return E?(t[0]=(a*I-h*S+l*T)*(E=1/E),t[1]=(r*S-i*I-o*T)*E,t[2]=(p*w-g*b+m*x)*E,t[3]=(A*b-c*w-f*x)*E,t[4]=(h*M-s*I-l*P)*E,t[5]=(n*I-r*M+o*P)*E,t[6]=(g*_-d*w-m*v)*E,t[7]=(u*w-A*_+f*v)*E,t[8]=(s*S-a*M+l*C)*E,t[9]=(i*M-n*S-o*C)*E,t[10]=(d*b-p*_+m*y)*E,t[11]=(c*_-u*b-f*y)*E,t[12]=(a*P-s*T-h*C)*E,t[13]=(n*T-i*P+r*C)*E,t[14]=(p*v-d*x-g*y)*E,t[15]=(u*x-c*v+A*y)*E,t):null}function z5(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function B5(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function H5(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var j5=U5;function U5(t,e,n){var i,r,o,s,a,h=t.length,l=V5(t[0],e),u=[];for(n||(n=[]),i=1;i<h;i++){for(r=t[i-1],s=a=V5(o=t[i],e);;){if(!(l|s)){u.push(r),s!==a?(u.push(o),i<h-1&&(n.push(u),u=[])):i===h-1&&u.push(o);break}if(l&s)break;l?l=V5(r=G5(r,o,l,e),e):s=V5(o=G5(r,o,s,e),e)}l=a}return u.length&&n.push(u),n}function G5(t,e,n,i){return 8&n?[t[0]+(e[0]-t[0])*(i[3]-t[1])/(e[1]-t[1]),i[3]]:4&n?[t[0]+(e[0]-t[0])*(i[1]-t[1])/(e[1]-t[1]),i[1]]:2&n?[i[2],t[1]+(e[1]-t[1])*(i[2]-t[0])/(e[0]-t[0])]:1&n?[i[0],t[1]+(e[1]-t[1])*(i[0]-t[0])/(e[0]-t[0])]:null}function V5(t,e){var n=0;return t[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}U5.polyline=U5,U5.polygon=function(t,e){var n,i,r,o,s,a,h;for(i=1;i<=8;i*=2){for(n=[],o=!(V5(r=t[t.length-1],e)&i),s=0;s<t.length;s++)(h=!(V5(a=t[s],e)&i))!==o&&n.push(G5(r,a,i,e)),h&&n.push(a),r=a,o=h;if(!(t=n).length)break}return n};var W5=H5(j5),q5=1/0,Z5=1/0,Q5=-1/0,X5=-1/0;function Y5(){return[q5,Z5,Q5,X5]}var J5=Y5();function K5(t){t[0]=q5,t[1]=Z5,t[2]=Q5,t[3]=X5}function $5(t,e){if(t)if(Array.isArray(t[0]))for(var n=0,i=t.length;n<i;n++)$5(t[n],e);else if(Array.isArray(t))for(n=0,i=t.length;n<i;n++){var r=t[n],o=r.x,s=r.y;e[0]=Math.min(o,e[0]),e[1]=Math.min(s,e[1]),e[2]=Math.max(o,e[2]),e[3]=Math.max(s,e[3])}else o=t.x,s=t.y,e[0]=Math.min(o,e[0]),e[1]=Math.min(s,e[1]),e[2]=Math.max(o,e[2]),e[3]=Math.max(s,e[3])}function t3(t,e,n,i,r){(0===e||e)&&(Array.isArray(e)&&(n=e[1],i=e[2],r=e[3],e=e[0]),t[0]=Math.min(e,t[0]),t[1]=Math.min(n,t[1]),t[2]=Math.max(i,t[2]),t[3]=Math.max(r,t[3]))}function e3(t){return t&&t[0]!==1/0&&void 0!==t[0]}function n3(t,e){void 0===e&&(e=0),t[0]-=e,t[1]-=e,t[2]+=e,t[3]+=e}function i3(t,e){var n=Q0(t,4);return n[0]>=e[0]&&n[2]<=e[2]&&n[1]>=e[1]&&n[3]<=e[3]}var r3,o3="core-fetch-image",s3=!1,a3=[];function h3(t){return a3.indexOf(t)>-1}function l3(t){h3(t)||a3.push(t)}var u3={};function c3(t,e){u3[t]=e}var A3,f3="\n    var adapters = {};\n    // Dynamic Create Adapter\n    function createAdapter(key,code){\n        if(adapters[key]||!code){\n            return;\n        }\n        var func=new Function('exports',code+'(exports)');\n        var workerExports={};\n        func(workerExports,self);\n        adapters[key]=workerExports;\n        workerExports.initialize && workerExports.initialize(self);\n\n    }\n    onmessage = function (msg) {\n        msg = msg.data;\n        //createAdapter\n        if (msg.messageType === 'createAdapter') {\n           var key=msg.key;\n           var code=msg.code;\n           createAdapter(key,code);\n           postMessage({adapterName:key});\n           return;\n        }\n        // postMessage when main thread idle\n        if(msg.messageType==='idle'){\n            var messageRatio = msg.messageRatio;\n            handleMessageQueue(messageRatio);\n            return;\n        }\n        if (msg.messageType === 'batch') {\n            const messages = msg.messages;\n            if (messages) {\n                for (let i = 0; i < messages.length; i++) {\n                    dispatch(messages[i]);\n                }\n            }\n        } else {\n            dispatch(msg);\n        }\n    };\n\n    function dispatch(msg) {\n        var workerKey = msg.workerKey;\n        var adapter = adapters[workerKey];\n        if (!adapter) {\n            post(msg.callback, 'Unregistered worker adapters for ' + workerKey);\n            return;\n        }\n        try {\n            adapter.onmessage(msg, wrap(msg.callback));\n        } catch (err) {\n            post(msg.callback, workerKey + ':' + err.message);\n            console.error(err);\n            throw err;\n        }\n    }\n\n    var messageResultQueue = [];\n\n    function handleMessageQueue(messageRatio){\n       if(messageResultQueue.length===0){\n          return;\n       }\n       var count = Math.ceil((messageRatio || 1) * messageResultQueue.length);\n       var queues = messageResultQueue.slice(0, count);\n       queues.forEach(function(queue){\n          post(queue.callback,queue.err,queue.data,queue.buffers);\n       });\n       messageResultQueue=messageResultQueue.slice(count, Infinity);\n    }\n\n    function post(callback, err, data, buffers) {\n        var msg = {\n            callback : callback\n        };\n        if (err) {\n            msg.error = err;\n        } else {\n            msg.data = data;\n        }\n        if (buffers && buffers.length > 0) {\n            postMessage(msg, buffers);\n        } else {\n            postMessage(msg);\n        }\n    }\n\n    function joinQueue(callback,err,data,buffers){\n        messageResultQueue.push({\n            callback:callback,\n            err:err,\n            data:data,\n            buffers:buffers\n        });\n    }\n\n    function wrap(callback) {\n        return function (err, data, buffers) {\n            joinQueue(callback, err, data, buffers);\n        };\n    }\n    var workerExports;\n",d3="\n    workerExports = null;\n";function p3(){if("undefined"==typeof window)return null;if(!A3){var t=function(){var t=f3;for(var e in u3){var n=u3[e];l3(e),a0(n)&&0===n.length&&(n=n()),t+="\n    workerExports = {};\n    (".concat(n,")(workerExports, self);\n    adapters['").concat(e,"'] = workerExports"),t+="\n    workerExports.initialize && workerExports.initialize(self);\n        "}return t+d3}();A3=window.URL.createObjectURL(new Blob([t],{type:"text/javascript"})),u3={}}return A3}function g3(t,e){if(u3[t]){var n=u3[t];if(a0(n)&&0===n.length&&(n=n()),n="(".concat(n,")"),r3){var i=r3.workers||[];0===i.length&&console.error("workerpool workers count is 0");var r=0,o=function(n){(n=n.data||{}).adapterName===t&&++r===i.length&&(i.forEach((function(t){t.removeEventListener("message",o)})),delete u3[t],e())};i.forEach((function(e){e.addEventListener("message",o),e.postMessage({key:t,code:n,messageType:"createAdapter"})}))}}else console.error("not find ".concat(t," adapter"))}var m3,y3="undefined"!=typeof window?window.navigator.hardwareConcurrency||4:0,v3=Math.max(Math.floor(y3/2),1),_3=function(){function t(t){void 0===t&&(t=50),this._limit=t,this._messages=[],this.buffers=[]}return t.prototype.addMessage=function(t,e){if(this._messages.push(t),Array.isArray(e))for(var n=0;n<e.length;n++)this.buffers.indexOf(e[n])<0&&this.buffers.push(e[n])},t.prototype.isFull=function(){return this._messages.length>=this._limit},t.prototype.getMessage=function(){return{messageType:"batch",messages:this._messages}},t}(),x3=function(){function t(){this.active={},this.workerCount="undefined"!=typeof window?$$.workerCount||v3:0,this._messages=[],this._messageBuffers=[]}return t.prototype.acquire=function(t){if(!this.workers){this.workers=[];for(var e=p3(),n=0;n<this.workerCount;n++){var i=new Worker(e);i.id=n,this.workers.push(i)}URL.revokeObjectURL(e),s3=!0}return this.active[t]=!0,this.workers.slice()},t.prototype.release=function(t){delete this.active[t],0===Object.keys(this.active).length&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},t.prototype.addMessage=function(t,e,n){var i=this._messages[t];i&&i.length||(i=this._messages[t]=[new _3]);var r=i[i.length-1];r.isFull()&&(r=new _3,this._messages[t].push(r)),r.addMessage(e,n)},t.prototype.commit=function(){if(this.workers&&this._messages.length)for(var t=0;t<this._messages.length;t++)if(this._messages[t]&&this._messages[t].length){var e=this._messages[t].shift();this.workers[t].postMessage(e.getMessage(),e.buffers)}},t.prototype.getWorkers=function(){return this.workers||[]},t.prototype.broadcastIdleMessage=function(t){return this.getWorkers().forEach((function(e){e.postMessage({messageType:"idle",messageRatio:t})})),this},t}();function b3(){return m3||(m3=new x3,r3=m3),m3}var w3=[],C3=[];function P3(t){var e=$$.messagePostRatioPerWorker*(t?.5:1);b3().commit(),b3().broadcastIdleMessage(e),function(){if(0!==w3.length){for(var t=[],e=[],n=w3.length,i=0;i<n;i++)if((o=w3[i]).count--,-1===o.count)e.push(o);else{t.push(o);var r=o.run();o.results.push(r)}for(w3=t,n=e.length,i=0;i<n;i++){var o;(o=e[i]).resolve&&o.resolve(o.results)}}}(),C3.forEach((function(t){t()}))}var M3=t0();function T3(){P3(),M3=t0(),requestIdleCallback(T3)}function S3(){if(G0.requestIdleCallback){var t=$$.idleForceTimeThreshold,e=$$.idleLog;t0()-M3>t&&(P3(!0),M3=t0(),e&&console.warn("did not apply for availability, forced run idle"))}else P3();Y0(S3)}var I3=!1;function E3(){I3||(I3=!0,G0.requestIdleCallback&&requestIdleCallback(T3),Y0(S3))}var O3,R3="function"==typeof Map,D3=function(){},k3=function(){function t(t,e){this.max=t,this.onRemove=e||D3,this.reset()}return t.prototype.reset=function(){for(var t in this.data)this.onRemove(this.data[t]);return this.data={},this.order=[],this},t.prototype.clear=function(){this.reset(),delete this.onRemove},t.prototype.add=function(t,e){if(this.has(t))this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t);else if(this.data[t]=e,this.order.push(t),this.order.length>this.max){var n=this.getAndRemove(this.order[0]);n&&this.onRemove(n)}return this},t.prototype.has=function(t){return t in this.data},t.prototype.keys=function(){return this.order},t.prototype.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e},t.prototype.get=function(t){return this.has(t)?this.data[t]:null},t.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data[t];return delete this.data[t],this.onRemove(e),this.order.splice(this.order.indexOf(t),1),this},t.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this.getAndRemove(this.order[0]);e&&this.onRemove(e)}return this},t}();R3&&(O3=function(){function t(t,e){this.max=t,this.onRemove=e||D3,this.reset()}return t.prototype.reset=function(){var t,e;if(this.data){var n=this.data.values();try{for(var i=Z0(n),r=i.next();!r.done;r=i.next())this.onRemove(r.value)}catch(o){t={error:o}}finally{try{r&&!r.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}}return this.data=new Map,this},t.prototype.clear=function(){this.reset(),delete this.onRemove},t.prototype.add=function(t,e){return e?(this.has(t)?(this.data.delete(t),this.data.set(t,e)):this.data.set(t,e),this):this},t.prototype.keys=function(){var t,e,n=new Array(this.data.size),i=0,r=this.data.keys();try{for(var o=Z0(r),s=o.next();!s.done;s=o.next())n[i++]=s.value}catch(a){t={error:a}}finally{try{s&&!s.done&&(e=o.return)&&e.call(o)}finally{if(t)throw t.error}}return n},t.prototype.shrink=function(){for(var t=this.data.keys(),e=t.next();this.data.size>this.max;){var n=this.getAndRemove(e.value);n&&this.onRemove(n),e=t.next()}},t.prototype.has=function(t){return this.data.has(t)},t.prototype.getAndRemove=function(t){if(!this.has(t))return null;var e=this.data.get(t);return this.data.delete(t),e},t.prototype.get=function(t){return this.has(t)?this.data.get(t):null},t.prototype.remove=function(t){if(!this.has(t))return this;var e=this.data.get(t);return this.data.delete(t),this.onRemove(e),this},t.prototype.setMaxSize=function(t){return this.max=t,this.data.size>this.max&&this.shrink(),this},t}());var L3=R3?O3:k3,F3="#000",N3=!1,z3=null,B3=Math.PI/180;function H3(t,e,n,i,r,o,s,a,h,l){var u,c,A,f,d,p,g,m,y,v,_,x,b,w,C,P,M=(t+n)/2,T=(e+i)/2,S=(n+r)/2,I=(i+o)/2,E=(r+s)/2,O=(o+a)/2,R=Math.sqrt((n-t)*(n-t)+(i-e)*(i-e)),D=Math.sqrt((r-n)*(r-n)+(o-i)*(o-i)),k=R/(R+D),L=D/(D+Math.sqrt((s-r)*(s-r)+(a-o)*(a-o))),F=M+(S-M)*k,N=T+(I-T)*k,z=S+(E-S)*L,B=I+(O-I)*L,H=F+(S-F)*h+n-F,j=N+(I-N)*h+i-N,U=z+(S-z)*h+r-z,G=B+(I-B)*h+o-B;return l<1?[((A=n)*(_=1-(u=0))*_+2*(d=H)*u*_+(g=U)*u*u)*(x=1-(c=l))+(d*_*_+2*g*u*_+(y=r)*u*u)*c,((f=i)*_*_+2*(p=j)*u*_+(m=G)*u*u)*x+(p*_*_+2*m*u*_+(v=o)*u*u)*c,(b=A*x*x+2*d*c*x+g*c*c)*_+(w=d*x*x+2*g*c*x+y*c*c)*u,(C=f*x*x+2*p*c*x+m*c*c)*_+(P=p*x*x+2*m*c*x+v*c*c)*u,b*x+w*c,C*x+P*c]:[H,j,U,G]}var j3={getCanvas2DContext:function(t){return t.getContext("2d",{willReadFrequently:!0})},setHitTesting:function(t){N3=t},createCanvas:function(t,e,n){var i;return K$?i=new n(t,e):((i=a2("canvas")).width=t,i.height=e),i},prepareCanvasFont:function(t,e){"top"!==t.textBaseline&&(t.textBaseline="top");var n=t2(e);t.font!==n&&(t.font=n);var i=e.textFill;i||(i="#000");var r=j3.getRgba(i,e.textOpacity);t.fillStyle!==r&&(t.fillStyle=r)},prepareCanvas:function(t,e,n,i){if(e){var r=e.lineWidth;n0(r)||t.lineWidth===r||(t.lineWidth=r);var o=e.linePatternFile,s=e.lineColor||F3;if(i)t.strokeStyle="#000";else if(o&&n){var a=void 0;(e.linePatternDx||e.linePatternDy)&&(a=[e.linePatternDx,e.linePatternDy]),j3._setStrokePattern(t,o,r,a,n),e.lineDasharray=[]}else C5(s)?t.strokeStyle=e.lineGradientExtent?j3._createGradient(t,s,e.lineGradientExtent):F3:(Array.isArray(s)&&(s=j3.normalizeColorToRGBA(s)),t.strokeStyle=s);e.lineJoin&&(t.lineJoin=e.lineJoin),e.lineCap&&(t.lineCap=e.lineCap),t.setLineDash&&d1(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var h=e.polygonPatternFile,l=e.polygonFill||"rgba(255,255,255,0)";if(i)t.fillStyle="#000";else if(h&&n){var u=V3(h),c=n.getImage([u,null,null]);if(c||(c=n.getImage([u+"-texture",null,r])),t1(u)&&c instanceof Image&&(G0.edge||G0.ie)){var A=c.width||20,f=c.height||20,d=j3.createCanvas(A,f);j3.image(d.getContext("2d"),c,0,0,A,f),c=d}c?(t.fillStyle=t.createPattern(c,"repeat"),(e.polygonPatternDx||e.polygonPatternDy)&&(t.fillStyle.polygonPatternOffset=[e.polygonPatternDx,e.polygonPatternDy])):"undefined"!=typeof console&&console.warn("img not found for",u)}else C5(l)?t.fillStyle=e.polygonGradientExtent?j3._createGradient(t,l,e.polygonGradientExtent):"rgba(255,255,255,0)":(Array.isArray(l)&&(l=j3.normalizeColorToRGBA(l)),t.fillStyle=l)}},_createGradient:function(t,e,n){var i=null,r=e.places,o=n.getMin(),s=n.getMax(),a=n.getWidth(),h=n.getHeight();if(e.type&&"linear"!==e.type){if("radial"===e.type){if(r){if(6!==r.length)throw new Error("A radial gradient's places should have 6 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,a*r[2],o.x+r[3]*a,o.y+r[4]*h,a*r[5]]}else{var l=n.getCenter()._round();r=[l.x,l.y,Math.abs(l.x-o.x),l.x,l.y,0]}i=t.createRadialGradient.apply(t,r)}}else{if(r){if(4!==r.length)throw new Error("A linear gradient's places should have 4 numbers.");r=[o.x+r[0]*a,o.y+r[1]*h,o.x+r[2]*a,o.y+r[3]*h]}else r=[o.x,o.y,s.x,o.y];i=t.createLinearGradient.apply(t,r)}return e.colorStops.forEach((function(t){i.addColorStop.apply(i,t)})),i},_setStrokePattern:function(t,e,n,i,r){var o,s=V3(e);if(K$)o=r.getImage([s,null,n]);else{var a=s+"-texture-"+n;if(!(o=r.getImage(a))){var h=r.getImage([s,null,null]);if(h){var l=void 0;l=h.width&&h.height?Math.round(h.width*n/h.height):n;var u=j3.createCanvas(l,n,t.canvas.constructor);j3.image(u.getContext("2d"),h,0,0,l,n),r.addResource([a,null,n],u),o=u}}}o?(t.strokeStyle=t.createPattern(o,"repeat"),t.strokeStyle.linePatternOffset=i):"undefined"!=typeof console&&console.warn("img not found for",s)},clearRect:function(t,e,n,i,r){t.canvas._drawn=!1,t.clearRect(e,n,i,r)},fillCanvas:function(t,e,n,i){if(N3&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=j3._isPattern(t.fillStyle),s=t.fillStyle&&t.fillStyle.polygonPatternOffset,a=s?s[0]:0,h=s?s[1]:0;n0(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),o&&t.translate((n=n||0)+a,(i=i||0)+h),t.fill(),o&&t.translate(-n-a,-i-h),e<1&&(t.globalAlpha=r)}},getRgba:function(t,e){return n0(e)&&(e=1),"#"!==t[0]?(Array.isArray(t)&&(t=j3.normalizeColorToRGBA(t,e)),t):(7===t.length?(n=parseInt(t.substring(1,3),16),i=parseInt(t.substring(3,5),16),r=parseInt(t.substring(5,7),16)):(n=17*parseInt(t.substring(1,2),16),i=17*parseInt(t.substring(2,3),16),r=17*parseInt(t.substring(3,4),16)),"rgba("+n+","+i+","+r+","+e+")");var n,i,r},normalizeColorToRGBA:function(t,e){return void 0===e&&(e=1),"rgba(".concat(255*t[0],",").concat(255*t[1],",").concat(255*t[2],",").concat((4===t.length?t[3]:1)*e,")")},image:function(t,e,n,i,r,o){t.canvas._drawn=!0;try{i0(r)&&i0(o)?t.drawImage(e,n,i,r,o):t.drawImage(e,n,i)}catch(s){console&&(console.warn("error when drawing image on canvas:",s),console.warn(e))}},text:function(t,e,n,i,r){return j3._textOnMultiRow(t,r.rows,i,n,r.size,r.rawSize)},_textOnMultiRow:function(t,e,n,i,r,o){var s,a,h=J1(r,n.textHorizontalAlignment,n.textVerticalAlignment),l=o.height+n.textLineSpacing,u=i.add(0,h.y),c=n.textMaxHeight,A=0;K5(J5);for(var f=0,d=e.length;f<d;f++){s=e[f].text,a=J1(e[f].size,n.textHorizontalAlignment,n.textVerticalAlignment);var p=u.add(a.x,f*l);j3._textOnLine(t,s,p,n.textHaloRadius,n.textHaloFill,n.textHaloOpacity);var g=e[f].size,m=p.x,y=p.y;if(t3(J5,m,y,m+g.width,y+g.height),c>0&&(A+=l)+g.height>=c)break}return J5},_textOnLine:function(t,e,n,i,r,o){N3&&(o=1);var s,a,h=0!==o&&0!==i;t.textBaseline="top";var l=t.shadowBlur,u=t.shadowOffsetX,c=t.shadowOffsetY;if(h){var A=t.globalAlpha;t.globalAlpha*=o,t.miterLimit=2,t.lineJoin="round",t.lineCap="round",t.lineWidth=2*i,Array.isArray(r)&&(r=j3.normalizeColorToRGBA(r)),t.strokeStyle=r,t.strokeText(e,n.x,n.y+1),t.miterLimit=10,t.globalAlpha=A,s=t.globalCompositeOperation,t.globalCompositeOperation="destination-out",a=t.fillStyle,t.fillStyle="#000"}l&&h&&(t.shadowBlur=t.shadowOffsetX=t.shadowOffsetY=0),j3.fillText(t,e,n),s&&(t.globalCompositeOperation=s,j3.fillText(t,e,n,a),l&&(t.shadowBlur=l,t.shadowOffsetX=u,t.shadowOffsetY=c))},fillText:function(t,e,n,i){t.canvas._drawn=!0,i&&(t.fillStyle=i),t.fillText(e,n.x,n.y+1)},_stroke:function(t,e,n,i){if(N3&&(e=1),t.canvas._drawn=!0,0!==e){var r,o=t.strokeStyle&&t.strokeStyle.linePatternOffset,s=o?o[0]:0,a=o?o[1]:0,h=j3._isPattern(t.strokeStyle)&&(!n0(n)&&!n0(i)||!n0(s)&&!n0(a));n0(e)&&(e=1),e<1&&(r=t.globalAlpha,t.globalAlpha*=e),h&&t.translate((n=n||0)+s,(i=i||0)+a),t.stroke(),h&&t.translate(-n-s,-i-a),e<1&&(t.globalAlpha=r)}},_path:function(t,e,n,i,r){if(d1(e))for(var o,s=d1(n),a=!0!==r&&j3._isPattern(t.strokeStyle),h=0,l=e.length;h<l;h++)if(o=e[h],!s||t.setLineDash)t.lineTo(o.x,o.y),a&&h>0&&(u(e[h-1],o),t.beginPath(),t.moveTo(o.x,o.y));else if(s){if(h===l-1)break;U3(t,o,e[h+1],n)}function u(e,n){var r=_1(e.x,e.y,n.x,n.y);t.save();var o=Math.cos(r);Math.abs(o)<1e-7?t.translate(e.x-t.lineWidth/2,e.y):t.translate(e.x,e.y-t.lineWidth/2/o),t.rotate(r),j3._stroke(t,i),t.restore()}},path:function(t,e,n,i,r){d1(e)&&(t.beginPath(),t.moveTo(e[0].x,e[0].y),j3._path(t,e,r,n),j3._stroke(t,n))},_multiClip:function(t,e){e&&0!==e.length&&e.forEach((function(e){for(var n=0,i=e.length;n<i;n++){var r=e[n],o=r.x,s=r.y;0===n?t.moveTo(o,s):t.lineTo(o,s),n===i-1&&t.lineTo(o=e[0].x,s=e[0].y)}}))},polygon:function(t,e,n,i,r,o){if(t.isMultiClip)j3._multiClip(t,e);else if(t.isClip)j3._multiClip(t,Array.isArray(e[0])?e:[e]);else if(d1(e)){var s=j3._isPattern(t.strokeStyle),a=d1(r)&&!t.setLineDash||s&&!o;d1(e[0])||(e=[e]);var h,l,u,c=t,A=t.dpr||1,f=1!==A;if(e.length>1&&!K$&&(z3||(z3=j3.createCanvas(1,1)),t.canvas._drawn=!1,z3.width=t.canvas.width,z3.height=t.canvas.height,q3(t=z3.getContext("2d"),[]),q3(t,r),W3(t,c),f&&t.scale(A,A)),a){for(t.save(),l=0,u=e.length;l<u;l++)d1(e[l])&&(j3._ring(t,e[l],null,0,!0),h=i,l>0&&(t.globalCompositeOperation="destination-out",h=1),j3.fillCanvas(t,h,e[l][0].x,e[l][0].y),l>0?t.globalCompositeOperation="source-over":u>1&&(t.fillStyle="#fff"),j3._stroke(t,0));t.restore()}var d=t.fillStyle;for(l=0,u=e.length;l<u;l++)d1(e[l])&&(o?(j3.paintSmoothLine(t,e[l],n,o,!0),t.closePath()):j3._ring(t,e[l],r,n),a||(h=i,l>0&&(t.globalCompositeOperation="destination-out",h=1),j3.fillCanvas(t,h,e[l][0].x,e[l][0].y),l>0?t.globalCompositeOperation="source-over":u>1&&(t.fillStyle="#fff")),j3._stroke(t,n));if(t.fillStyle!==d&&(t.fillStyle=d),e.length>1&&!K$){if(f){var p=1/A;c.scale(p,p)}c.drawImage(z3,0,0),f&&c.scale(A,A),c.canvas._drawn=t.canvas._drawn,W3(c,t)}}},_ring:function(t,e,n,i,r){var o=j3._isPattern(t.strokeStyle);r||!o||e[0].equals(e[e.length-1])||(e=e.concat([e[0]])),t.beginPath(),t.moveTo(e[0].x,e[0].y),j3._path(t,e,n,i,r),o||t.closePath()},paintSmoothLine_bak:function(t,e,n,i,r,o,s){if(e)if(e.length<=2||!i)j3.path(t,e,n);else{var a,h=e.length,l=r?h:h-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==s&&(l-=Math.max(l-o-1,0));for(var u=0;u<l;u++){var c=void 0,A=void 0,f=void 0,d=void 0,p=void 0,g=void 0;u-1<0?r?(c=e[l-1].x,A=e[l-1].y):(c=e[u+1].x,A=e[u+1].y):(c=e[u-1].x,A=e[u-1].y),u+1<h?(f=e[u+1].x,d=e[u+1].y):(f=e[u+1-h].x,d=e[u+1-h].y),u+2<h?(p=e[u+2].x,g=e[u+2].y):r?(p=e[u+2-h].x,g=e[u+2-h].y):(p=e[u].x,g=e[u].y);var m=H3(c,A,e[u].x,e[u].y,f,d,p,g,i,u===l-1?s:1);if(u===l-1&&s>=0&&s<1){t.bezierCurveTo(m[0],m[1],m[2],m[3],m[4],m[5]),e.splice(l-1,h-(l-1)-1);var y=new $0(m[4],m[5]);y.prevCtrlPoint=new $0(m[2],m[3]),e.push(y),h=e.length}else t.bezierCurveTo(m[0],m[1],m[2],m[3],f,d);e[u].nextCtrlPoint=m.slice(0,2),e[u].prevCtrlPoint=a?a.slice(2):null,a=m}!r&&e[1].prevCtrlPoint&&(e[0].nextCtrlPoint=e[1].prevCtrlPoint,delete e[0].prevCtrlPoint),e[h-1].prevCtrlPoint||(e[h-1].prevCtrlPoint=e[h-2].nextCtrlPoint),j3._stroke(t,n)}},paintSmoothLine:function(t,e,n,i,r,o,s){if(e)if(e.length<=2||!i)j3.path(t,e,n);else{var a,h,l=e.length,u=r?l:l-1;t.beginPath(),t.moveTo(e[0].x,e[0].y),void 0!==s&&(u-=Math.max(u-o-1,0));for(var c=0;c<u;c++){var A=void 0,f=void 0,d=void 0,p=void 0,g=void 0,m=void 0;c-1<0?r?(A=e[u-1].x,f=e[u-1].y):(A=e[c+1].x,f=e[c+1].y):(A=e[c-1].x,f=e[c-1].y),c+1<l?(d=e[c+1].x,p=e[c+1].y):(d=e[c+1-l].x,p=e[c+1-l].y),c+2<l?(g=e[c+2].x,m=e[c+2].y):r?(g=e[c+2-l].x,m=e[c+2-l].y):(g=e[c].x,m=e[c].y);var y=e[c],v=H3(A,f,e[c].x,e[c].y,d,p,g,m,i,c===u-1?s:1);if(c===u-1&&s>=0&&s<1){t.bezierCurveTo(v[0],v[1],v[2],v[3],v[4],v[5]),e.splice(u-1,l-(u-1)-1);var _=new $0(v[4],v[5]);e.push(_),l=e.length}else t.bezierCurveTo(v[0],v[1],v[2],v[3],d,p);0===c?(y.arrowNextPoint=y.arrowNextPoint||new $0(0,0),h=v[3],y.arrowNextPoint.x=a=v[2],y.arrowNextPoint.y=h):(y.arrowPrePoint=y.arrowPrePoint||new $0(0,0),y.arrowPrePoint.x=a,y.arrowPrePoint.y=h,a=v[2],h=v[3],c===u-1&&e[c+1]&&(e[c+1].arrowPrePoint=e[c+1].arrowPrePoint||new $0(0,0),e[c+1].arrowPrePoint.x=v[0],e[c+1].arrowPrePoint.y=v[1]))}j3._stroke(t,n)}},_arcBetween:function(t,e,n,i){var r=Math.abs(i),o=e.distanceTo(n),s=Math.abs(o/2/Math.sin(r/2)),a=Math.asin((n.y-e.y)/o);e.x>n.x&&(a=Math.PI-a);var h=a-(90*B3-r/2),l=Math.cos(h)*s,u=Math.sin(h)*s,c=e.x+l,A=e.y+u,f=Math.asin((n.y-A)/s);c>n.x&&(f=Math.PI-f);var d=f+r;if(i<0){f+=Math.PI,d+=Math.PI;var p=(e.x+n.x)/2,g=(e.y+n.y)/2;c=p-(c-p),A=g-(A-g)}t.beginPath(),t.arc(c,A,s,f,d);var m=(d-f)/100,y=Math.cos(f+m)*s+c,v=Math.sin(f+m)*s+A,_=Math.cos(d-m)*s+c,x=Math.sin(d-m)*s+A;return e.arrowNextPoint=e.arrowNextPoint||new $0(0,0),n.arrowPrePoint=n.arrowPrePoint||new $0(0,0),i<0?(e.arrowNextPoint.x=y,e.arrowNextPoint.y=v,n.arrowPrePoint.x=_,n.arrowPrePoint.y=x):(e.arrowNextPoint.x=_,e.arrowNextPoint.y=x,n.arrowPrePoint.x=y,n.arrowPrePoint.y=v),[c,A]},_lineTo:function(t,e){t.lineTo(e.x,e.y)},bezierCurveAndFill:function(t,e,n,i){t.beginPath();var r=e[0];t.moveTo(r.x,r.y);var o=[t];o.push.apply(o,e.splice(1)),j3._bezierCurveTo.apply(j3,o),j3.fillCanvas(t,i),j3._stroke(t,n)},_bezierCurveTo:function(t,e,n,i){t.bezierCurveTo(e.x,e.y,n.x,n.y,i.x,i.y)},ellipse:function(t,e,n,i,r,o,s){var a,h,l,u,c,A,f,d,p;t.beginPath(),n===i&&n===r?t.arc(e.x,e.y,n,0,2*Math.PI):t.ellipse?i!==r?(t.ellipse(e.x,e.y,n,i,0,180*B3,360*B3,!1),t.ellipse(e.x,e.y,n,r,0,0,180*B3,!1)):t.ellipse(e.x,e.y,n,i,0,0,360*B3,!1):(a=e.x,h=e.y,f=(l=n)*(A=.5522848),d=(u=i)*A,p=(c=r)*A,t.moveTo(a-l,h),t.bezierCurveTo(a-l,h-d,a-f,h-u,a,h-u),t.bezierCurveTo(a+f,h-u,a+l,h-d,a+l,h),t.bezierCurveTo(a+l,h+p,a+f,h+c,a,h+c),t.bezierCurveTo(a-f,h+c,a-l,h+p,a-l,h),t.closePath()),j3.fillCanvas(t,s,e.x-n,e.y-i),j3._stroke(t,o,e.x-n,e.y-i)},rectangle:function(t,e,n,i,r){var o=e.x,s=e.y;t.beginPath(),t.rect(o,s,n.width,n.height),j3.fillCanvas(t,r,o,s),j3._stroke(t,i,o,s)},sector:function(t,e,n,i,r,o){var s,a,h,l,u,c,A,f,d=B3;s=t,a=e.x,h=e.y,l=n,u=i[0],c=i[1],A=d*-c,f=d*-u,s.beginPath(),s.moveTo(a,h),s.arc(a,h,l,A,f),s.lineTo(a,h),j3.fillCanvas(s,o,a-l,h-l),j3._stroke(s,r,a-l,h-l)},_isPattern:function(t){return!s0(t)&&!("addColorStop"in t)},drawCross:function(t,e,n,i,r){t.canvas._drawn=!0,t.strokeStyle=r,t.lineWidth=i,t.beginPath(),t.moveTo(e-5,n),t.lineTo(e+5,n),t.moveTo(e,n-5),t.lineTo(e,n+5),t.stroke()},copy:function(t,e){var n=e||a2("canvas");return n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(t,0,0),n},pixelRect:function(t,e,n,i){var r=t.globalAlpha,o=!1;if(t.lineWidth>0&&n>0)o=!0,n<1&&(t.globalAlpha*=n);else{if(!(i>0))return;i<1&&(t.globalAlpha*=i)}t.canvas._drawn=!0,o?t.strokeRect(e[0],e[1],1,1):t.fillRect(e[0],e[1],1,1),t.globalAlpha!==r&&(t.globalAlpha=r)}};function U3(t,e,n,i){var r=e.x,o=e.y,s=n.x,a=n.y,h=i,l=function(t,e){return t<=e},u=function(t,e){return t>=e},c=function(t,e){return Math.min(t,e)},A=function(t,e){return Math.max(t,e)},f={thereYet:u,cap:c},d={thereYet:u,cap:c};o-a>0&&(d.thereYet=l,d.cap=A),r-s>0&&(f.thereYet=l,f.cap=A),t.moveTo(r,o);for(var p,g,m=r,y=o,v=0,_=!0;!f.thereYet(m,s)||!d.thereYet(y,a);)p=Math.atan2(a-o,s-r),g=h[v],m=f.cap(s,m+Math.cos(p)*g),y=d.cap(a,y+Math.sin(p)*g),_?t.lineTo(m,y):t.moveTo(m,y),v=(v+1)%h.length,_=!_}var G3="data:image/";function V3(t){return t.substring(0,G3.length)===G3?t:y1(t)}function W3(t,e){t.filter=e.filter,t.fillStyle=e.fillStyle,t.globalAlpha=e.globalAlpha,t.lineCap=e.lineCap,t.lineDashOffset=e.lineDashOffset,t.lineJoin=e.lineJoin,t.lineWidth=e.lineWidth,t.shadowBlur=e.shadowBlur,t.shadowColor=e.shadowColor,t.shadowOffsetX=e.shadowOffsetX,t.shadowOffsetY=e.shadowOffsetY,t.strokeStyle=e.strokeStyle}function q3(t,e){e&&t.setLineDash&&Array.isArray(e)&&t.setLineDash(e)}function Z3(t){return"Z__"+t}function Q3(t){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.on=function(t,e,n){if(!t)return this;if(!s0(t))return this._switch("on",t,e);if(!e)return this;this._eventMap||(this._eventMap={});var i,r=t.toLowerCase().split(" ");n||(n=this);var o,s=i0(e._id);e._id=i1();for(var a=0,h=r.length;a<h;a++){var l=Z3(i=r[a]);if(e[l]&&(e[l]._id=e._id),(o=this._eventMap[i])||(this._eventMap[i]=o=[]),s){var u=o.length;if(u>0)for(var c=0;c<u;c++)if(e===o[c].handler&&o[c].context===n)return console.warn(this,"find '".concat(t,"' handler:"),e," The old listener function will be removed"),this;o.push({handler:e,context:n})}else o.push({handler:e,context:n})}return this},e.prototype.addEventListener=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=this.on).call.apply(t,X0([this],Q0(e),!1))},e.prototype.once=function(t,e,n){if(!s0(t)){var i={};for(var r in t)t.hasOwnProperty(r)&&(i[r]=this._wrapOnceHandler(r,t[r],e));return this._switch("on",i)}for(var o=t.split(" "),s=0,a=o.length;s<a;s++)this.on(o[s],this._wrapOnceHandler(o[s],e,n));return this},e.prototype.off=function(t,e,n){if(!this._eventMap||!t)return this;if(!s0(t))return this._switch("off",t,e);if(!e)return this;if(!i0(e._id))return this;var i,r,o,s=t.split(" ");n||(n=this);for(var a=0,h=s.length;a<h;a++)if(o=Z3(i=s[a].toLowerCase()),r=this._eventMap[i]){for(var l=r.length-1;l>=0;l--){var u=r[l];e!==u.handler&&e!==u.handler[o]||u.context!==n||(delete u.handler[o],r.splice(l,1))}r.length||delete this._eventMap[i]}return this},e.prototype.removeEventListener=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return(t=this.off).call.apply(t,X0([this],Q0(e),!1))},e.prototype.listens=function(t,e,n){if(!this._eventMap||!s0(t))return 0;var i=this._eventMap[t.toLowerCase()];if(!i||!i.length)return 0;if(!e)return i.length;for(var r=0,o=i.length;r<o;r++)if(e===i[r].handler&&(n0(n)||i[r].context===n))return 1;return 0},e.prototype.getListeningEvents=function(){return this._eventMap?Object.keys(this._eventMap):[]},e.prototype.copyEventListeners=function(t){var e,n=t._eventMap;if(!n)return this;for(var i in n)for(var r=0,o=(e=n[i]).length;r<o;r++)this.on(i,e[r].handler,e[r].context);return this},e.prototype.fire=function(t,e){return this._eventParent?this._eventParent.fire.call(this._eventParent,t,e):this._fire.call(this,t,e)},e.prototype._wrapOnceHandler=function(t,e,n){var i=Z3(t),r=!1,o=function t(){for(var s=[],a=0;a<arguments.length;a++)s[a]=arguments[a];r||(delete o[i],r=!0,e.call.apply(e,X0(n?[n]:[this],Q0(s),!1)),t._called=!0)};return o[i]=e,o},e.prototype._switch=function(t,e,n){for(var i in e)e.hasOwnProperty(i)&&this[t](i,e[i],n);return this},e.prototype._clearListeners=function(t){this._eventMap&&s0(t)&&this._eventMap[t.toLowerCase()]&&(this._eventMap[t]=null)},e.prototype._clearAllListeners=function(){this._eventMap=null},e.prototype._setEventParent=function(t){return this._eventParent=t,this},e.prototype._setEventTarget=function(t){return this._eventTarget=t,this},e.prototype._fire=function(t,e){if(!this._eventMap)return this;t=t.toLowerCase();var n=this._eventMap[t];if(!n)return this;e||(e={type:t,target:this._eventTarget||this}),e.type=t,e.target=this._eventTarget||this;for(var i,r,o=n.slice(0),s=0,a=o.length;s<a;s++)o[s]&&(o[s].handler._called||(i=o[s].context,r=e0({},e),!1===(i?o[s].handler.call(i,r):o[s].handler(r))&&e.domEvent&&d2(e.domEvent)));var h=this._eventMap[t];if(h){var l=[];for(s=0,a=h.length;s<a;s++)h[s].handler._called||l.push(h[s]);this._eventMap[t]=l}return this},e}(t)}var X3=function(t){function e(e){var n=t.call(this)||this;return n._enabled=!1,n.target=e,n}return W0(e,t),e.prototype.enable=function(){return this._enabled||(this._enabled=!0,this.addHooks()),this},e.prototype.disable=function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},e.prototype.enabled=function(){return!!this._enabled},e.prototype.remove=function(){this.disable(),delete this.target,delete this.dom},e}(Q3((function(){}))),Y3=function(){function t(t){if(!this||!this.setOptions)throw new Error('Class instance is being created without "new" operator.');this.setOptions(t),this.callInitHooks(),this._isUpdatingOptions=!1}return t.prototype.proxyOptions=function(){var t=this;return G0.proxy?(this.options=new Proxy(this.options,{set:function(e,n,i){if(e[n]===i)return!0;if(e[n]=i,t._isUpdatingOptions)return!0;var r={};return r[n]=i,t.config(r),!0}}),this):this},t.prototype.callInitHooks=function(){var t=Object.getPrototypeOf(this);return this._visitInitHooks(t),this},t.prototype.setOptions=function(t){if(this.hasOwnProperty("options")||(this.options=this.options?Object.create(this.options):{}),!t)return this;for(var e in t)this.options[e]=t[e];return this},t.prototype.config=function(t,e){if(this._isUpdatingOptions=!0,!t){var n={};for(var i in this.options)this.options.hasOwnProperty(i)&&(n[i]=this.options[i]);return this._isUpdatingOptions=!1,n}if(2===arguments.length&&"string"==typeof t){var r={};r[t]=e,t=r}for(var o in t)this.options[o]=t[o],this[o]&&this[o]instanceof X3&&(t[o]?this[o].enable():this[o].disable());return this.onConfig(t),this._isUpdatingOptions=!1,this},t.prototype.onConfig=function(t){},t.prototype._visitInitHooks=function(t){if(!this._initHooksCalled){var e=Object.getPrototypeOf(t);e._visitInitHooks&&e._visitInitHooks.call(this,e),this._initHooksCalled=!0;var n=t._initHooks;if(n&&n!==e._initHooks)for(var i=0;i<n.length;i++)n[i].call(this)}},t.addInitHook=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i="function"==typeof t?t:function(){var n;(n=this[t]).call.apply(n,X0([this],Q0(e),!1))},r=this.prototype,o=Object.getPrototypeOf(r);return r._initHooks&&r._initHooks!==o._initHooks||(r._initHooks=[]),r._initHooks.push(i),this},t.include=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;n++)e0(this.prototype,t[n]);return this},t.mergeOptions=function(t){var e=this.prototype,n=Object.getPrototypeOf(e);return e.options&&e.options!==n.options||(e.options=e.options?Object.create(e.options):{}),e0(e.options,t),this},t}(),J3=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e}(Q3((function(){}))),K3=new J3,$3="dprchange",t4="docvisibilitychange",e4="dragstart",n4="dragend";if("undefined"!=typeof window&&window.matchMedia)for(var i4=1;i4<500;i4++){var r4=(.01*i4).toFixed(2),o4=window.matchMedia("screen and (resolution: ".concat(r4,"dppx)"));o4&&(o4.addEventListener?o4.addEventListener("change",G0.checkDevicePixelRatio):o4.addListener&&o4.addListener(G0.checkDevicePixelRatio))}if(G0.devicePixelRatio){var s4=G0.devicePixelRatio;Object.defineProperty(G0,"devicePixelRatio",{get:function(){return s4},set:function(t){t!==s4&&(s4=t,G0.monitorDPRChange&&K3.fire($3,{devicePixelRatio:t}))}})}G0.webgl&&"undefined"!=typeof document&&(u2(document,"visibilitychange",(function(){K3.fire(t4,{visibilityState:document.visibilityState})})),u2(document,"dragstart",(function(){K3.fire(e4)})),u2(document,"dragend",(function(){K3.fire(n4)})));var a4={};function h4(t){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.registerJSONType=function(t){t&&(a4[t]?console.error("".concat(t," has register. please use Different name for:"),this):a4[t]=this)},e.getJSONClass=function(t){return t?a4[t]:null},e.prototype.getJSONType=function(){if(void 0===this._jsonType){var t=Object.getPrototypeOf(this).constructor;for(var e in a4)if(a4[e]===t){this._jsonType=e;break}}if(!this._jsonType)throw new Error("Found an unregistered Layer/Geometry class!");return this._jsonType},e}(t)}var l4={exports:{}},u4={exports:{}};!function(t){t.exports=function(){function t(t,n,r,o,s){e(t,n,r||0,o||t.length-1,s||i)}function e(t,i,r,o,s){for(;o>r;){if(o-r>600){var a=o-r+1,h=i-r+1,l=Math.log(a),u=.5*Math.exp(2*l/3),c=.5*Math.sqrt(l*u*(a-u)/a)*(h-a/2<0?-1:1);e(t,i,Math.max(r,Math.floor(i-h*u/a+c)),Math.min(o,Math.floor(i+(a-h)*u/a+c)),s)}var A=t[i],f=r,d=o;for(n(t,r,i),s(t[o],A)>0&&n(t,r,o);f<d;){for(n(t,f,d),f++,d--;s(t[f],A)<0;)f++;for(;s(t[d],A)>0;)d--}0===s(t[r],A)?n(t,r,d):n(t,++d,o),d<=i&&(r=d+1),i<=d&&(o=d-1)}}function n(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function i(t,e){return t<e?-1:t>e?1:0}return t}()}(u4);var c4=u4.exports;l4.exports=f4,l4.exports.default=f4;var A4=c4;function f4(t,e){if(!(this instanceof f4))return new f4(t,e);this._maxEntries=Math.max(4,t||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),e&&this._initFormat(e),this.clear()}function d4(t,e,n){if(!n)return e.indexOf(t);for(var i=0;i<e.length;i++)if(n(t,e[i]))return i;return-1}function p4(t,e){g4(t,0,t.children.length,e,t)}function g4(t,e,n,i,r){r||(r=M4(null)),r.minX=1/0,r.minY=1/0,r.maxX=-1/0,r.maxY=-1/0;for(var o,s=e;s<n;s++)o=t.children[s],m4(r,t.leaf?i(o):o);return r}function m4(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function y4(t,e){return t.minX-e.minX}function v4(t,e){return t.minY-e.minY}function _4(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function x4(t){return t.maxX-t.minX+(t.maxY-t.minY)}function b4(t,e){return(Math.max(e.maxX,t.maxX)-Math.min(e.minX,t.minX))*(Math.max(e.maxY,t.maxY)-Math.min(e.minY,t.minY))}function w4(t,e){var n=Math.max(t.minX,e.minX),i=Math.max(t.minY,e.minY),r=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,r-n)*Math.max(0,o-i)}function C4(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function P4(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function M4(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function T4(t,e,n,i,r){for(var o,s=[e,n];s.length;)(n=s.pop())-(e=s.pop())<=i||(o=e+Math.ceil((n-e)/i/2)*i,A4(t,o,e,n,r),s.push(e,o,o,n))}f4.prototype={all:function(){return this._all(this.data,[])},search:function(t){var e=this.data,n=[],i=this.toBBox;if(!P4(t,e))return n;for(var r,o,s,a,h=[];e;){for(r=0,o=e.children.length;r<o;r++)s=e.children[r],P4(t,a=e.leaf?i(s):s)&&(e.leaf?n.push(s):C4(t,a)?this._all(s,n):h.push(s));e=h.pop()}return n},collides:function(t){var e=this.data,n=this.toBBox;if(!P4(t,e))return!1;for(var i,r,o,s,a=[];e;){for(i=0,r=e.children.length;i<r;i++)if(o=e.children[i],P4(t,s=e.leaf?n(o):o)){if(e.leaf||C4(t,s))return!0;a.push(o)}e=a.pop()}return!1},load:function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0,n=t.length;e<n;e++)this.insert(t[e]);return this}var i=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===i.height)this._splitRoot(this.data,i);else{if(this.data.height<i.height){var r=this.data;this.data=i,i=r}this._insert(i,this.data.height-i.height-1,!0)}else this.data=i;return this},insert:function(t){return t&&this._insert(t,this.data.height-1),this},clear:function(){return this.data=M4([]),this},remove:function(t,e){if(!t)return this;for(var n,i,r,o,s=this.data,a=this.toBBox(t),h=[],l=[];s||h.length;){if(s||(s=h.pop(),i=h[h.length-1],n=l.pop(),o=!0),s.leaf&&-1!==(r=d4(t,s.children,e)))return s.children.splice(r,1),h.push(s),this._condense(h),this;o||s.leaf||!C4(s,a)?i?(n++,s=i.children[n],o=!1):s=null:(h.push(s),l.push(n),n=0,i=s,s=s.children[0])}return this},toBBox:function(t){return t},compareMinX:y4,compareMinY:v4,toJSON:function(){return this.data},fromJSON:function(t){return this.data=t,this},_all:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,t.children):n.push.apply(n,t.children),t=n.pop();return e},_build:function(t,e,n,i){var r,o=n-e+1,s=this._maxEntries;if(o<=s)return p4(r=M4(t.slice(e,n+1)),this.toBBox),r;i||(i=Math.ceil(Math.log(o)/Math.log(s)),s=Math.ceil(o/Math.pow(s,i-1))),(r=M4([])).leaf=!1,r.height=i;var a,h,l,u,c=Math.ceil(o/s),A=c*Math.ceil(Math.sqrt(s));for(T4(t,e,n,A,this.compareMinX),a=e;a<=n;a+=A)for(T4(t,a,l=Math.min(a+A-1,n),c,this.compareMinY),h=a;h<=l;h+=c)u=Math.min(h+c-1,l),r.children.push(this._build(t,h,u,i-1));return p4(r,this.toBBox),r},_chooseSubtree:function(t,e,n,i){for(var r,o,s,a,h,l,u,c;i.push(e),!e.leaf&&i.length-1!==n;){for(u=c=1/0,r=0,o=e.children.length;r<o;r++)h=_4(s=e.children[r]),(l=b4(t,s)-h)<c?(c=l,u=h<u?h:u,a=s):l===c&&h<u&&(u=h,a=s);e=a||e.children[0]}return e},_insert:function(t,e,n){var i=n?t:(0,this.toBBox)(t),r=[],o=this._chooseSubtree(i,this.data,e,r);for(o.children.push(t),m4(o,i);e>=0&&r[e].children.length>this._maxEntries;)this._split(r,e),e--;this._adjustParentBBoxes(i,r,e)},_split:function(t,e){var n=t[e],i=n.children.length,r=this._minEntries;this._chooseSplitAxis(n,r,i);var o=this._chooseSplitIndex(n,r,i),s=M4(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,p4(n,this.toBBox),p4(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)},_splitRoot:function(t,e){this.data=M4([t,e]),this.data.height=t.height+1,this.data.leaf=!1,p4(this.data,this.toBBox)},_chooseSplitIndex:function(t,e,n){var i,r,o,s,a,h,l,u;for(h=l=1/0,i=e;i<=n-e;i++)s=w4(r=g4(t,0,i,this.toBBox),o=g4(t,i,n,this.toBBox)),a=_4(r)+_4(o),s<h?(h=s,u=i,l=a<l?a:l):s===h&&a<l&&(l=a,u=i);return u},_chooseSplitAxis:function(t,e,n){var i=t.leaf?this.compareMinX:y4,r=t.leaf?this.compareMinY:v4;this._allDistMargin(t,e,n,i)<this._allDistMargin(t,e,n,r)&&t.children.sort(i)},_allDistMargin:function(t,e,n,i){t.children.sort(i);var r,o,s=this.toBBox,a=g4(t,0,e,s),h=g4(t,n-e,n,s),l=x4(a)+x4(h);for(r=e;r<n-e;r++)o=t.children[r],m4(a,t.leaf?s(o):o),l+=x4(a);for(r=n-e-1;r>=e;r--)o=t.children[r],m4(h,t.leaf?s(o):o),l+=x4(h);return l},_adjustParentBBoxes:function(t,e,n){for(var i=n;i>=0;i--)m4(e[i],t)},_condense:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children).splice(e.indexOf(t[n]),1):this.clear():p4(t[n],this.toBBox)},_initFormat:function(t){var e=["return a"," - b",";"];this.compareMinX=new Function("a","b",e.join(t[0])),this.compareMinY=new Function("a","b",e.join(t[1])),this.toBBox=new Function("a","return {minX: a"+t[0]+", minY: a"+t[1]+", maxX: a"+t[2]+", maxY: a"+t[3]+"};")}};var S4=H5(l4.exports),I4={},E4=function(){function t(){this._tree=S4(9,["[0]","[1]","[2]","[3]"])}return t.prototype.collides=function(t){var e;return e=Q0(t,4),I4.minX=e[0],I4.minY=e[1],I4.maxX=e[2],I4.maxY=e[3],this._tree.collides(I4)},t.prototype.insertBox=function(t){return this._tree.insert(t),this},t.prototype.bulkInsertBox=function(t){return this._tree.load(t),this},t.prototype.clear=function(){return this._tree.clear(),this},t}();function O4(t){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.addHandler=function(t,e){if(!e)return this;if(this._handlers||(this._handlers=[]),this[t])return this[t].enable(),this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},e.prototype.removeHandler=function(t){if(!t)return this;var e=this[t];if(e){var n=this._handlers.indexOf(e);n>=0&&this._handlers.splice(n,1),this[t].remove(),delete this[t]}return this},e.prototype._clearHandlers=function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].remove();this._handlers=[]},e}(t)}var R4="touchstart mousedown",D4={mousedown:"mousemove",touchstart:"touchmove",pointerdown:"touchmove",MSPointerDown:"touchmove"},k4={mousedown:"mouseup",touchstart:"touchend",pointerdown:"touchend",MSPointerDown:"touchend"},L4=function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,null)||this;return i.dom=e,i.options=n,i}return W0(e,t),e.prototype.addHooks=function(){},e.prototype.removeHooks=function(){},e.prototype.enable=function(){return this.dom?(this._onMouseDown=function(t){return this.onMouseDown(t)},P2(this.dom,R4,this._onMouseDown,this),this):this},e.prototype.disable=function(){return this.dom?(this._offEvents(),M2(this.dom,R4,this._onMouseDown),delete this._onMouseDown,this):this},e.prototype.onMouseDown=function(t){if(this.options.rightclick||2!==t.button){var e=t;if(!(e.touches&&e.touches.length>1||this.options.cancelOn&&!0===this.options.cancelOn(t))){var n=this.dom;n.setCapture?n.setCapture():window.captureEvents&&window.captureEvents(),n.ondragstart=function(){return!1},delete this.moved;var i=e.touches?e.touches[0]:t;this.startPos=new $0(i.clientX,i.clientY),M2(document,D4[t.type],this.onMouseMove),M2(document,k4[t.type],this.onMouseUp),P2(document,D4[t.type],this.onMouseMove,this),P2(document,k4[t.type],this.onMouseUp,this),this.options.ignoreMouseleave||(M2(this.dom,"mouseleave",this.onMouseUp),P2(this.dom,"mouseleave",this.onMouseUp,this)),this.fire("mousedown",{domEvent:t,mousePos:new $0(i.clientX,i.clientY)})}}},e.prototype.onMouseMove=function(t){var e=t;if(e.touches&&e.touches.length>1)this.moved&&(this.interupted=!0,this.onMouseUp(t));else{var n=e.touches?e.touches[0]:t,i=new $0(n.clientX,n.clientY).sub(this.startPos);(i.x||i.y)&&(this.moved?this.fire("dragging",{domEvent:t,mousePos:new $0(n.clientX,n.clientY)}):(this.fire("dragstart",{domEvent:t,mousePos:this.startPos.copy()}),this.moved=!0))}},e.prototype.onMouseUp=function(t){var e=t.changedTouches?t.changedTouches[0]:t;this._offEvents();var n={domEvent:t};i0(e.clientX)&&(n.mousePos=new $0(parseInt(e.clientX+"",0),parseInt(e.clientY+"",0))),this.moved&&(n.interupted=this.interupted,this.fire("dragend",n),delete this.interupted,delete this.moved),this.fire("mouseup",n)},e.prototype._offEvents=function(){var t=this.dom;if(M2(t,"mouseleave",this.onMouseUp),"undefined"!=typeof document&&"undefined"!=typeof window){for(var e in D4)M2(document,D4[e],this.onMouseMove),M2(document,k4[e],this.onMouseUp);t.releaseCapture?t.releaseCapture():window.captureEvents&&window.captureEvents()}},e}(X3),F4=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.toNumberArrays=function(t){return Array.isArray(t)?h1(t,(function(t){return t.toArray()})):t.toArray()},e.toCoordinates=function(t){if(i0(t[0])&&i0(t[1]))return new e(t);if(t instanceof e)return t;for(var n=[],i=0,r=t.length;i<r;i++){var o=t[i];Array.isArray(o)?i0(o[0])?n.push(new e(o)):n.push(e.toCoordinates(o)):n.push(o instanceof e?o:new e(o))}return n},e.prototype.closeTo=function(t,e){return e||(e=0),this.x>=t.x-e&&this.x<=t.x+e&&this.y>=t.y-e&&this.y<=t.y+e},e.prototype.abs=function(){return new e(Math.abs(this.x),Math.abs(this.y))},e.prototype.round=function(){return new e(Math.round(this.x),Math.round(this.y))},e.prototype.ceil=function(){return new e(Math.ceil(this.x),Math.ceil(this.y))},e.prototype.floor=function(){return new e(Math.floor(this.x),Math.floor(this.y))},e.prototype.copy=function(){return new e(this.x,this.y,this.z)},e.prototype.toFixed=function(t){return new e(this.x.toFixed(t),this.y.toFixed(t),i0(this.z)?this.z.toFixed(t):void 0)},e.prototype.add=function(t,n){var i,r;return n0(t.x)?n0(t[0])?(i=this.x+t,r=this.y+n):(i=this.x+t[0],r=this.y+t[1]):(i=this.x+t.x,r=this.y+t.y),new e(i,r)},e.prototype.sub=function(t,n){var i,r;return n0(t.x)?n0(t[0])?(i=this.x-t,r=this.y-n):(i=this.x-t[0],r=this.y-t[1]):(i=this.x-t.x,r=this.y-t.y),new e(i,r)},e.prototype.multi=function(t){return new e(this.x*t,this.y*t)},e.prototype.equals=function(t){return t instanceof this.constructor&&this.x===t.x&&this.y===t.y&&this.z===t.z},e}(K0);!function(){function t(t,e){this.type=t,this.properties=e}t.createProj4=function(e){return new t("proj4",{proj:e})},t.fromProjectionCode=function(e){return e&&t[e=e.toUpperCase().replace(":","")]||null},t.WGS84=t.createProj4("+proj=longlat +datum=WGS84 +no_defs"),t.EPSG3857=t.createProj4("+proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext  +no_defs"),t.IDENTITY=t.createProj4("+proj=identity +no_defs"),t.CGCS2000=t.createProj4("+proj=longlat +datum=CGCS2000"),t.EPSG4490=t.CGCS2000,t.BD09LL=t.createProj4("+proj=longlat +datum=BD09"),t.GCJ02=t.createProj4("+proj=longlat +datum=GCJ02")}();var N4,z4=new $0(0,0),B4=new F4(0,0),H4=new F4(0,0),j4=new F4(0,0),U4=new F4(0,0),G4=new F4(0,0),V4=new F4(0,0),W4=new F4(0,0),q4=new F4(0,0),Z4=[],Q4=[],X4=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._clazz=F4;var n=t.length,i=n>0?t[n-1]:null;i&&i.unproject&&(this.projection=t[n-1]),this._dirty=!0,this.antiMeridian=!1,this._initialize(t[0],t[1],t[2],t[3])}return t.prototype._initialize=function(t,e,n,i){if(this.xmin=null,this.xmax=null,this.ymin=null,this.ymax=null,!n0(t)){var r=this.projection;if(i0(t)&&i0(e)&&i0(n)&&i0(i))r?this.set(t,e,n,i):this.set(Math.min(t,n),Math.min(e,i),Math.max(t,n),Math.max(e,i));else if(Array.isArray(t))r?this.set(t[0],t[1],t[2],t[3]):this.set(Math.min(t[0],t[2]),Math.min(t[1],t[3]),Math.max(t[0],t[2]),Math.max(t[1],t[3]));else if(i0(t.x)&&i0(e.x)&&i0(t.y)&&i0(e.y)){var o=t,s=e;r?this.set(o.x,o.y,s.x,s.y):(o.x>s.x?(this.xmin=s.x,this.xmax=o.x):(this.xmin=o.x,this.xmax=s.x),o.y>s.y?(this.ymin=s.y,this.ymax=o.y):(this.ymin=o.y,this.ymax=s.y))}else i0(t.xmin)&&i0(t.xmax)&&i0(t.ymin)&&i0(t.ymax)&&this.set(t.xmin,t.ymin,t.xmax,t.ymax)}},t.prototype._add=function(t){return this._dirty=!0,n0(t.x)?n0(t.xmin)?n0(t[0])||(this.xmin+=t[0],this.ymin+=t[1],this.xmax+=t[0],this.ymax+=t[1]):(this.xmin+=t.xmin,this.ymin+=t.ymin,this.xmax+=t.xmax,this.ymax+=t.ymax):(this.xmin+=t.x,this.ymin+=t.y,this.xmax+=t.x,this.ymax+=t.y),this},t.prototype.add=function(t){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)._add(t)},t.prototype._scale=function(t){return this._dirty=!0,this.xmin*=t,this.ymin*=t,this.xmax*=t,this.ymax*=t,this},t.prototype._sub=function(t){return this._dirty=!0,n0(t.x)?n0(t.xmin)?n0(t[0])||(this.xmin-=t[0],this.ymin-=t[1],this.xmax-=t[0],this.ymax-=t[1]):(this.xmin-=t.xmin,this.ymin-=t.ymin,this.xmax-=t.xmax,this.ymax-=t.ymax):(this.xmin-=t.x,this.ymin-=t.y,this.xmax-=t.x,this.ymax-=t.y),this},t.prototype._substract=function(t){return this._sub(t)},t.prototype.sub=function(t){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)._sub(t)},t.prototype.substract=function(t){return this.sub(t)},t.prototype.round=function(){return new this.constructor(Math.round(this.xmin),Math.round(this.ymin),Math.round(this.xmax),Math.round(this.ymax),this.projection)},t.prototype._round=function(){return this._dirty=!0,this.xmin=Math.round(this.xmin),this.ymin=Math.round(this.ymin),this.xmax=Math.round(this.xmax),this.ymax=Math.round(this.ymax),this},t.prototype.getMin=function(t){return t?(t.set(this.xmin,this.ymin),t):new this._clazz(this.xmin,this.ymin)},t.prototype.getMax=function(t){return t?(t.set(this.xmax,this.ymax),t):new this._clazz(this.xmax,this.ymax)},t.prototype.getCenter=function(t){var e=(this.xmin+this.xmax)/2,n=(this.ymin+this.ymax)/2;return t?(t.set(e,n),t):new this._clazz(e,n)},t.prototype.isValid=function(){return!(n0(this.xmin)||n0(this.ymin)||n0(this.xmax)||n0(this.ymax))},t.prototype.equals=function(t){return this.xmin===t.xmin&&this.xmax===t.xmax&&this.ymin===t.ymin&&this.ymax===t.ymax},t.prototype.intersects=function(t){this._project(this),this._project(t);var e=Math.max(this.pxmin,t.pxmin),n=Math.max(this.pymin,t.pymin),i=Math.min(this.pxmax,t.pxmax),r=Math.min(this.pymax,t.pymax);return!(e>i||n>r)},t.prototype.within=function(t){return this._project(this),this._project(t),this.pxmin>=t.pxmin&&this.pxmax<=t.pxmax&&this.pymin>=t.pymin&&this.pymax<=t.pymax},t.prototype.contains=function(t){if(!t)return!1;this._project(this);var e=this.projection;if(e){var n=B4;Array.isArray(t)?(n.x=t[0],n.y=t[1],t=e.project(n,n)):void 0!==t.x?(n.x=t.x,n.y=t.y,t=e.project(n,n)):void 0!==t.xmin&&this._project(t)}return(t.x||t.pxmin||0)>=this.pxmin&&(t.x||t.pxmax||0)<=this.pxmax&&(t.y||t.pymin||0)>=this.pymin&&(t.y||t.pymax||0)<=this.pymax},t.prototype.getWidth=function(){return Math.abs(this.xmax-this.xmin)},t.prototype.getHeight=function(){return Math.abs(this.ymax-this.ymin)},t.prototype.getSize=function(){return new z1(this.getWidth(),this.getHeight())},t.prototype.set=function(t,e,n,i){return this.xmin=t,this.ymin=e,this.xmax=n,this.ymax=i,this._dirty=!0,this},t.prototype.__combine=function(t){var e,n,i,r;void 0!==t.x&&(N4.xmin=N4.xmax=t.x,N4.ymin=N4.ymax=t.y,t=N4),this._project(t),this._project(this),i0(this.pxmin)?(e=Math.min(this.pxmin,t.pxmin),n=Math.min(this.pymin,t.pymin),i=Math.max(this.pxmax,t.pxmax),r=Math.max(this.pymax,t.pymax)):(e=t.pxmin,n=t.pymin,i=t.pxmax,r=t.pymax);var o=this.projection;if(o){H4.set(e,n),j4.set(i,r);var s=o.unproject(H4,H4),a=o.unproject(j4,j4);e=s.x,n=s.y,i=a.x,r=a.y}return Q4[0]=e,Q4[1]=n,Q4[2]=i,Q4[3]=r,Q4},t.prototype._combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return this.set(e[0],e[1],e[2],e[3]),this._dirty=!0,this},t.prototype.combine=function(t){if(!t||t.isValid&&!t.isValid())return this;var e=this.__combine(t);return new this.constructor(e[0],e[1],e[2],e[3],this.projection)},t.prototype.intersection=function(t){if(!this.intersects(t))return null;U4.x=Math.max(this.pxmin,t.pxmin),U4.y=Math.max(this.pymin,t.pymin),G4.x=Math.min(this.pxmax,t.pxmax),G4.y=Math.min(this.pymax,t.pymax);var e=U4,n=G4,i=this.projection;return i&&(e=i.unproject(e,e),n=i.unproject(n,n)),new this.constructor(e,n,i)},t.prototype.expand=function(t){var e,n;return i0(t)?e=n=t:(e=t.width||t.x||t[0]||0,n=t.height||t.y||t[1]||0),new this.constructor(this.xmin-e,this.ymin-n,this.xmax+e,this.ymax+n,this.projection)},t.prototype._expand=function(t){var e,n;return i0(t)?e=n=t:(e=t.width||t.x||t[0]||0,n=t.height||t.y||t[1]||0),this.xmin-=e,this.ymin-=n,this.xmax+=e,this.ymax+=n,this._dirty=!0,this},t.prototype.toJSON=function(){return{xmin:this.xmin,ymin:this.ymin,xmax:this.xmax,ymax:this.ymax}},t.prototype.toArray=function(t){var e=this.xmin,n=this.ymin,i=this.xmax,r=this.ymax;return t?(t[0].x=e,t[0].y=r,t[1].x=i,t[1].y=r,t[2].x=i,t[2].y=n,t[3].x=e,t[3].y=n,t[4].x=e,t[4].y=r,t):[new this._clazz([e,r]),new this._clazz([i,r]),new this._clazz([i,n]),new this._clazz([e,n]),new this._clazz([e,r])]},t.prototype.toString=function(){return"".concat(this.xmin,",").concat(this.ymin,",").concat(this.xmax,",").concat(this.ymax)},t.prototype.copy=function(){return new this.constructor(this.xmin,this.ymin,this.xmax,this.ymax,this.projection)},t.prototype.convertTo=function(t,e){if(!this.isValid())return null;var n,i=e||new this.constructor;return e&&i.set(null,null,null,null),this._clazz===F4?n=V4:this._clazz===$0&&(n=z4),n.x=this.xmin,n.y=this.ymax,i._combine(t(n)),n.x=this.xmax,i._combine(t(n)),n.y=this.ymin,i._combine(t(n)),n.x=this.xmin,i._combine(t(n)),i},t.prototype._project=function(t){if(t&&t.isValid()){var e=this.projection;if(e){if(t._dirty){W4.set(t.xmin,t.ymin),q4.set(t.xmax,t.ymax),Z4[0]=W4,Z4[1]=q4;var n=e.projectCoords(Z4,this.antiMeridian),i=n[0],r=n[1];t.pxmin=Math.min(i.x,r.x),t.pymin=Math.min(i.y,r.y),t.pxmax=Math.max(i.x,r.x),t.pymax=Math.max(i.y,r.y)}delete t._dirty}else t.pxmin=t.xmin,t.pxmax=t.xmax,t.pymin=t.ymin,t.pymax=t.ymax}else t&&(t.pxmin=t.pxmax=t.pymin=t.pymax=null)},t}();N4=new X4(0,0,0,0);var Y4=function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var i=t.apply(this,X0([],Q0(e),!1))||this;return i._clazz=$0,i}return W0(e,t),e}(X4),J4=function(){function t(t){this.matrix=t}return t.prototype.transform=function(t,e,n){var i=this.matrix[0]*(t.x-this.matrix[2])/e,r=-this.matrix[1]*(t.y-this.matrix[3])/e;return n?(n.x=i,n.y=r,n):new $0(i,r)},t.prototype.untransform=function(t,e,n){var i=t.x*e/this.matrix[0]+this.matrix[2],r=t.y*e/-this.matrix[1]+this.matrix[3];return n?(n.x=i,n.y=r,n):new F4(i,r)},t}(),K4={code:"",is:function(t){if(this.code===t)return!0;if(!this.aliases)return!1;for(var e=0;e<this.aliases.length;e++)if(this.aliases[e]===t)return!0;return!1},project:function(t){return t},unproject:function(t){return t},projectCoords:function(t,e){var n=this;if(!t)return[];if(!Array.isArray(t))return this.project(t);if(0===t.length)return[];if(!this.isSphere())return h1(t,this.project,this);if(Array.isArray(t[0]))return t.map((function(t){return n.projectCoords(t,e)}));for(var i=e,r=this.getCircum(),o=this.getSphereExtent().sy,s=void 0,a=t[0],h=void 0,l=void 0,u=void 0,c=void 0,A=[this.project(a)],f=1,d=t.length;f<d;f++){l=(h=t[f]).x-a.x,u=h.y-a.y,c=this.project(h);var p=!1;Math.abs(l)>180&&i&&(h.x=l<0?360-Math.abs(h.x):-180-(180-Math.abs(h.x)),p=!0),Math.abs(u)>90&&i&&(void 0===s&&(s=h.y<a.y),s&&(c._add(0,-r.y*u1(u)*o),h._add(0,-180*u1(u)))),p&&(c=this.project(h)),a=h,A.push(c)}return A},unprojectCoords:function(t){return t?Array.isArray(t)?h1(t,this.unproject,this):this.unproject(t):[]},isSphere:function(){return!!this.sphere},isOutSphere:function(t){return!!this.isSphere()&&!this.getSphereExtent().contains(t)},wrapCoord:function(t){if(!this.isSphere())return t;var e=this.getSphereExtent(),n=new F4(t);return e.contains(n)||(n.x=A1(t.x,e.xmin,e.xmax),n.y=A1(t.y,e.ymin,e.ymax)),n},getCircum:function(){if(!this.circum&&this.isSphere()){var t=this.getSphereExtent();this.circum={x:t.getWidth(),y:t.getHeight()}}return this.circum},getSphereExtent:function(){if(!this.extent&&this.isSphere()){var t=this.project(new F4(180,90)),e=this.project(new F4(-180,-90));this.extent=new X4(e,t,this),this.extent.sx=t.x>e.x?1:-1,this.extent.sy=t.y>e.y?1:-1}return this.extent}},$4={measureLength:function(t,e){if(!Array.isArray(t))return this.measureLenBetween(t,e);for(var n=0,i=0,r=t.length;i<r-1;i++)n+=this.measureLenBetween(t[i],t[i+1]);return n}},t8=e0({measure:"IDENTITY",measureLenBetween:function(t,e){if(!t||!e)return 0;try{return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}catch(n){return 0}},measureArea:function(t){if(!Array.isArray(t))return 0;for(var e=0,n=0,i=t.length;n<i;n++){var r=t[n],o=null;e+=r.x*(o=n===i-1?t[0]:t[n+1]).y-r.y*o.x}return Math.abs(e/2)},locate:function(t,e,n,i){return(i=i||new F4(0,0)).set(t.x,t.y),this._locate(i,e,n)},_locate:function(t,e,n){return t?(e||(e=0),n||(n=0),e||n?(t.x=t.x+e,t.y=t.y+n,t):t):null},rotate:function(t,e,n){return t=new F4(t.x,t.y),this._rotate(t,e,n)},_rotate:function(){var t=new $0(0,0);return function(e,n,i){return t.x=e.x-n.x,t.y=e.y-n.y,t._rotate(i*Math.PI/180),e.x=n.x+t.x,e.y=n.y+t.y,e}}()},$4),e8=function(){function t(t){this.radius=t}return t.prototype.measureLenBetween=function(t,e){if(!t||!e)return 0;var n=c0(t.y),i=c0(e.y),r=n-i,o=c0(t.x)-c0(e.x);return(n=2*Math.asin(Math.sqrt(Math.pow(Math.sin(r/2),2)+Math.cos(n)*Math.cos(i)*Math.pow(Math.sin(o/2),2))))*this.radius},t.prototype.measureArea=function(t){var e,n=c0(this.radius),i=0,r=t,o=r.length;if(o<3)return 0;for(e=0;e<o-1;e++){var s=r[e],a=r[e+1];i+=s.x*n*Math.cos(c0(s.y))*a.y*n-a.x*n*Math.cos(c0(a.y))*s.y*n}var h=r[e],l=r[0];return i+=h.x*n*Math.cos(c0(h.y))*l.y*n-l.x*n*Math.cos(c0(l.y))*h.y*n,.5*Math.abs(i)},t.prototype.locate=function(t,e,n,i){return(i=i||new F4(0,0)).set(t.x,t.y),this._locate(i,e,n)},t.prototype._locate=function(t,e,n){if(!t)return null;if(e||(e=0),n||(n=0),!e&&!n)return t;var i,r,o=c0(t.y);if(0!==n){var s=Math.abs(n);r=A1(180*(o+=2*Math.sin(s/(2*this.radius))*(n>0?1:-1))/Math.PI,-90,90)}else r=t.y;if(0!==e){var a=Math.abs(e),h=c0(t.x);i=A1(180*(h+=2*Math.sqrt(Math.pow(Math.sin(a/(2*this.radius)),2)/Math.pow(Math.cos(o),2))*(e>0?1:-1))/Math.PI,-180,180)}else i=t.x;return t.x=i,t.y=r,t},t.prototype.rotate=function(t,e,n){var i=new F4(t);return this._rotate(i,e,n)},t.prototype._rotate=function(t,e,n){var i,r,o,s,a=(i=e,r=t,void 0===o&&(o={}),((s=o.final?n8(r,i):n8(i,r))>180?-(360-s):s)-n),h=this.measureLenBetween(e,t);return t.x=e.x,t.y=e.y,function(t,e,n,i){var r=e/i,o=t.x*Math.PI/180,s=c0(t.y),a=c0(n),h=r*Math.cos(a),l=s+h;Math.abs(l)>Math.PI/2&&(l=l>0?Math.PI-l:-Math.PI-l);var u=Math.log(Math.tan(l/2+Math.PI/4)/Math.tan(s/2+Math.PI/4)),c=Math.abs(u)>1e-11?h/u:Math.cos(s),A=r*Math.sin(a)/c;return t.x=(180*(o+A)/Math.PI+540)%360-180,t.y=180*l/Math.PI,t}(t,h,a,this.radius)},t}();function n8(t,e){var n=c0(t.y),i=c0(e.y),r=c0(e.x-t.x);r>Math.PI&&(r-=2*Math.PI),r<-Math.PI&&(r+=2*Math.PI);var o=Math.log(Math.tan(i/2+Math.PI/4)/Math.tan(n/2+Math.PI/4));return(A0(Math.atan2(r,o))+360)%360}var i8=e0({measure:"EPSG:4326",sphere:new e8(6378137),measureLenBetween:function(t,e){return this.sphere.measureLenBetween(t,e)},measureArea:function(t){return this.sphere.measureArea.call(this.sphere,t)},_locate:function(t,e,n){return this.sphere._locate.call(this.sphere,t,e,n)},locate:function(t,e,n,i){return this.sphere.locate.call(this.sphere,t,e,n,i)},_rotate:function(t,e,n){return this.sphere._rotate.call(this.sphere,t,e,n)},rotate:function(t,e,n){return this.sphere.rotate.call(this.sphere,t,e,n)}},$4),r8=e0({measure:"BAIDU",sphere:new e8(6370996.81),measureLenBetween:function(t,e){return this.sphere.measureLenBetween.call(this.sphere,t,e)},measureArea:function(t){return this.sphere.measureArea.call(this.sphere,t)},_locate:function(t,e,n){return this.sphere._locate.call(this.sphere,t,e,n)},locate:function(t,e,n,i){return this.sphere.locate.call(this.sphere,t,e,n,i)},_rotate:function(t,e,n){return this.sphere._rotate.call(this.sphere,t,e,n)},rotate:function(t,e,n){return this.sphere.rotate.call(this.sphere,t,e,n)}},$4),o8=i8,s8={};function a8(t){s8[t.measure]=t}a8(t8),a8(i8),a8(r8);var h8=function(t){if(!t)return o8;for(var e in s8)if(l0(s8,e)){var n=s8[e].measure;if(!n)continue;if(t.toLowerCase()===n.toLowerCase())return s8[e]}return null},l8={code:"EPSG:3857",rad:Math.PI/180,metersPerDegree:6378137*Math.PI/180,maxLatitude:85.0511287798,project:function(t,e){var n=this.rad,i=this.metersPerDegree,r=this.maxLatitude,o=t.x,s=Math.max(Math.min(r,t.y),-r),a=o*i,h=(0===s?0:Math.log(Math.tan((90+s)*n/2))/n)*i;return e?(e.x=a,e.y=h,e):new F4(a,h)},unproject:function(t,e){var n,i=this.rad,r=this.metersPerDegree,o=t.x/r,s=t.y;0===s?n=0:(n=s/r,n=(2*Math.atan(Math.exp(n*i))-Math.PI/2)/i),Math.abs(Math.abs(o)-180)<1e-7&&(o=180*u1(o)),Math.abs(Math.abs(n)-this.maxLatitude)<1e-7&&(n=u1(n)*this.maxLatitude);var a=o,h=n;return e?(e.x=a,e.y=h,e):new F4(a,h)}},u8=e0({},K4,l8,i8),c8=e0({},K4,{code:"EPSG:4326",aliases:["EPSG:4490"],project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new F4(t)},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):new F4(t)}},i8),A8=Math.abs,f8=Math.sin,d8=Math.cos,p8=Math.tan,g8=Math.atan,m8=Math.atan2,y8=Math.sqrt,v8=Math.log,_8=Math.hypot,x8=Math.sinh,b8=Math.cosh,w8=1/0;function C8(t){var e,n,i,r,o,s,a=[],h=[],l=[],u=[];function c(t,e){for(var n,i=2*d8(2*e),r=t.length-1,o=t[r],s=0;--r>=0;)n=i*o-s+t[r],s=o,o=n;return e+n*f8(2*e)}function A(t,e,n){for(var i,r,o=f8(e),s=d8(e),a=x8(n),h=b8(n),l=2*s*h,u=-2*o*a,c=t.length-1,A=t[c],f=0,d=0,p=0;--c>=0;)i=d,r=f,A=l*(d=A)-i-u*(f=p)+t[c],p=u*d-r+l*f;return[(l=o*h)*A-(u=s*a)*p,l*p+u*A]}o=r=(i=t.es/(1+y8(1-t.es)))/(2-i),a[0]=r*(2+r*(-2/3+r*(r*(116/45+r*(26/45+r*(-2854/675)))-2))),h[0]=r*(r*(2/3+r*(4/3+r*(-82/45+r*(32/45+r*(4642/4725)))))-2),a[1]=(o*=r)*(7/3+r*(r*(-227/45+r*(2704/315+r*(2323/945)))-1.6)),h[1]=o*(5/3+r*(-16/15+r*(-13/9+r*(904/315+r*(-1522/945))))),a[2]=(o*=r)*(56/15+r*(-136/35+r*(-1262/105+r*(73814/2835)))),h[2]=o*(-26/15+r*(34/21+r*(1.6+r*(-12686/2835)))),a[3]=(o*=r)*(4279/630+r*(-332/35+r*(-399572/14175))),h[3]=o*(1237/630+r*(r*(-24832/14175)-2.4)),a[4]=(o*=r)*(4174/315+r*(-144838/6237)),h[4]=o*(-734/315+r*(109598/31185)),a[5]=(o*=r)*(601676/22275),h[5]=o*(444337/155925),e=t.k0/(1+r)*(1+(o=r*r)*(1/4+o*(1/64+o/256))),l[0]=r*(r*(2/3+r*(-37/96+r*(1/360+r*(81/512+r*(-96199/604800)))))-.5),u[0]=r*(.5+r*(-2/3+r*(5/16+r*(41/180+r*(-127/288+r*(7891/37800)))))),l[1]=o*(-1/48+r*(-1/15+r*(437/1440+r*(-46/105+r*(1118711/3870720))))),u[1]=o*(13/48+r*(r*(557/1440+r*(281/630+r*(-1983433/1935360)))-.6)),l[2]=(o*=r)*(-17/480+r*(37/840+r*(209/4480+r*(-5569/90720)))),u[2]=o*(61/240+r*(-103/140+r*(15061/26880+r*(167603/181440)))),l[3]=(o*=r)*(-4397/161280+r*(11/504+r*(830251/7257600))),u[3]=o*(49561/161280+r*(-179/168+r*(6601661/7257600))),l[4]=(o*=r)*(-4583/161280+r*(108847/3991680)),u[4]=o*(34729/80640+r*(-3418889/1995840)),l[5]=(o*=r)*(-20648693/638668800),u[5]=.6650675310896665*o,s=c(h,t.phi0),n=-e*(s+function(t,e){for(var n,i=2*d8(e),r=t.length-1,o=t[r],s=0;--r>=0;)n=i*o-s+t[r],s=o,o=n;return f8(e)*n}(u,2*s)),t.fwd=function(t,i){var r,o,s,a,l,f,d,p,g,m,y=t.phi,v=t.lam;y=c(h,y),r=f8(y),o=d8(y),a=f8(v),s=d8(v),y=m8(r,s*o),v=m8(a*o,_8(r,o*s)),f=p8(v),m=A8(f),d=m*(1+m/(_8(1,m)+1)),m=0==(g=(p=1+d)-1)?d:d*v8(p)/g,y+=(l=A(u,2*y,2*(v=f<0?-m:m)))[0],v+=l[1],A8(v)<=2.623395162778?(i.y=e*y+n,i.x=e*v):i.x=i.y=w8},t.inv=function(t,i){var r,o,s,h,u,f=t.y,d=t.x;f=(f-n)/e,A8(d/=e)<=2.623395162778?(f+=(u=A(l,2*f,2*d))[0],d=g8(x8(d+=u[1])),r=f8(f),o=d8(f),h=f8(d),s=d8(d),d=m8(h,s*o),f=m8(r*s,_8(h,s*o)),i.phi=c(a,f),i.lam=d):i.phi=i.lam=w8}}var P8=57.29577951308232,M8=.017453292519943295,T8=["Traverse_Mercator"],S8={code:"EPSG:9807",aliases:T8,centralMeridian:0,create:function(t){var e={a:6378137,es:.0066943799901413165,x0:n0(t.falseEasting)?5e5:t.falseEasting,y0:n0(t.falseNorthing)?0:t.falseNorthing,k0:t.scaleFactor||.9996,lam0:(t.centralMeridian||0)*M8,phi0:(t.latitudeOfOrigin||0)*M8,originLam0:t.startLongtitude||0,originPhi0:t.startLatitude||0};C8(e);var n={lam:0,phi:0},i={},r=0,o=0;(e.originLam0||e.originPhi0)&&(n.lam=e.originLam0*M8-e.lam0,n.phi=e.originPhi0*M8,e.fwd(n,i),r=e.a*i.x+e.x0,o=e.a*i.y+e.y0);var s={code:"EPSG:9807",aliases:T8,centralMeridian:t.centralMeridian,project:function(t,s){n.lam=t.x*M8-e.lam0,n.phi=t.y*M8,e.fwd(n,i);var a=e.a*i.x+e.x0-r,h=e.a*i.y+e.y0-o;return s?(s.x=a,s.y=h,s):new F4(a,h)},unproject:function(t,s){i.x=(t.x-e.x0+r)/e.a,i.y=(t.y-e.y0+o)/e.a,e.inv(i,n);var a=(n.lam+e.lam0)*P8,h=n.phi*P8;return s?(s.x=a,s.y=h,s):new F4(a,h)}};return e0({},K4,s,i8)}},I8=e0({},K4,S8),E8={code:"utm",aliases:[],create:function(t){var e={},n=parseInt(t.zone);if(e.falseNorthing=t.south?1e7:0,e.falseEasting=5e5,!(n>0&&n<=60))throw new Error("zone must be > 0 and <= 60.");return n--,e.centralMeridian=6*(n+.5)-180,e.scaleFactor=.9996,I8.create(e)}},O8=e0({},I8,E8),R8=e0({},K4,{code:"BAIDU",project:function(t,e){return this.convertLL2MC(t,e)},unproject:function(t,e){return this.convertMC2LL(t,e)}},r8,{EARTHRADIUS:6370996.81,MCBAND:[12890594.86,8362377.87,5591021,3481989.83,1678043.12,0],LLBAND:[75,60,45,30,15,0],MC2LL:[[1.410526172116255e-8,898305509648872e-20,-1.9939833816331,200.9824383106796,-187.2403703815547,91.6087516669843,-23.38765649603339,2.57121317296198,-.03801003308653,17337981.2],[-7.435856389565537e-9,8983055097726239e-21,-.78625201886289,96.32687599759846,-1.85204757529826,-59.36935905485877,47.40033549296737,-16.50741931063887,2.28786674699375,10260144.86],[-3.030883460898826e-8,898305509983578e-20,.30071316287616,59.74293618442277,7.357984074871,-25.38371002664745,13.45380521110908,-3.29883767235584,.32710905363475,6856817.37],[-1.981981304930552e-8,8983055099779535e-21,.03278182852591,40.31678527705744,.65659298677277,-4.44255534477492,.85341911805263,.12923347998204,-.04625736007561,4482777.06],[3.09191371068437e-9,8983055096812155e-21,6995724062e-14,23.10934304144901,-.00023663490511,-.6321817810242,-.00663494467273,.03430082397953,-.00466043876332,2555164.4],[2.890871144776878e-9,8983055095805407e-21,-3.068298e-8,7.47137025468032,-353937994e-14,-.02145144861037,-1234426596e-14,.00010322952773,-323890364e-14,826088.5]],LL2MC:[[-.0015702102444,111320.7020616939,0x60e374c3105a3,-0x24bb4115e2e164,0x5cc55543bb0ae8,-0x7ce070193f3784,0x5e7ca61ddf8150,-0x261a578d8b24d0,0x665d60f3742ca,82.5],[.0008277824516172526,111320.7020463578,647795574.6671607,-4082003173.641316,10774905663.51142,-15171875531.51559,12053065338.62167,-5124939663.577472,913311935.9512032,67.5],[.00337398766765,111320.7020202162,4481351.045890365,-23393751.19931662,79682215.47186455,-115964993.2797253,97236711.15602145,-43661946.33752821,8477230.501135234,52.5],[.00220636496208,111320.7020209128,51751.86112841131,3796837.749470245,992013.7397791013,-1221952.21711287,1340652.697009075,-620943.6990984312,144416.9293806241,37.5],[-.0003441963504368392,111320.7020576856,278.2353980772752,2485758.690035394,6070.750963243378,54821.18345352118,9540.606633304236,-2710.55326746645,1405.483844121726,22.5],[-.0003218135878613132,111320.7020701615,.00369383431289,823725.6402795718,.46104986909093,2351.343141331292,1.58060784298199,8.77738589078284,.37238884252424,7.45]],convertMC2LL:function(t,e){for(var n,i=0,r=this.MCBAND.length;i<r;i++)if(Math.abs(t.y)>=this.MCBAND[i]){n=this.MC2LL[i];break}return this.convertor(t,n,e)},convertLL2MC:function(t,e){var n,i,r;t.x=this.getLoop(t.x,-180,180),t.y=this.getRange(t.y,-74,74);var o=new F4(t.x,t.y);for(i=0,r=this.LLBAND.length;i<r;i++)if(o.y>=this.LLBAND[i]){n=this.LL2MC[i];break}if(!n)for(i=this.LLBAND.length-1;i>=0;i--)if(o.y<=-this.LLBAND[i]){n=this.LL2MC[i];break}return this.convertor(t,n,e)},convertor:function(t,e,n){if(!t||!e)return null;var i=e[0]+e[1]*Math.abs(t.x),r=Math.abs(t.y)/e[9],o=e[2]+e[3]*r+e[4]*r*r+e[5]*r*r*r+e[6]*r*r*r*r+e[7]*r*r*r*r*r+e[8]*r*r*r*r*r*r;return i*=t.x<0?-1:1,o*=t.y<0?-1:1,n?(n.x=i,n.y=o,n):new F4(i,o)},toRadians:function(t){return Math.PI*t/180},toDegrees:function(t){return 180*t/Math.PI},getRange:function(t,e,n){return null!=e&&(t=Math.max(t,e)),null!=n&&(t=Math.min(t,n)),t},getLoop:function(t,e,n){if(t===1/0)return n;if(t===-1/0)return e;for(;t>n;)t-=n-e;for(;t<e;)t+=n-e;return t}}),D8=e0({},K4,{code:"IDENTITY",project:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()},unproject:function(t,e){return e?(e.x=t.x,e.y=t.y,e):t.copy()}},t8),k8=u8,L8=Object.freeze({__proto__:null,BAIDU:R8,Common:K4,DEFAULT:k8,EPSG3857:u8,EPSG4326:c8,EPSG9807:I8,IDENTITY:D8,UTM:O8});function F8(t){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.registerRenderer=function(t,e){var n=this.prototype,i=Object.getPrototypeOf(n);return n._rendererClasses&&n._rendererClasses!==i._rendererClasses||(n._rendererClasses=n._rendererClasses?Object.create(n._rendererClasses):{}),n._rendererClasses[t.toLowerCase()]=e,this},e.getRendererClass=function(t){var e=this.prototype;return e._rendererClasses?e._rendererClasses[t.toLowerCase()]:null},e}(t)}var N8="check_browser_max_fps";c3(N8,(function(){return"function (exports) {\n    exports.initialize = function () {};\n    function now(){\n        return  new Date().getTime();\n    }\n    function checkFPS(cb) {\n        if (!requestAnimationFrame) {\n            cb(-1);\n            return;\n        }\n        const count = 100;\n        let idx = 0;\n        let id;\n        let startTime;\n        function loop() {\n            idx++;\n            if (idx === count) {\n                cancelAnimationFrame(id);\n                const endTime = now();\n                const timePerFPS = (endTime - startTime) / count;\n                const fps = Math.floor(1000 / timePerFPS);\n                cb(fps);\n            } else {\n                id = requestAnimationFrame(loop);\n            }\n        }\n        startTime = now();\n        id = requestAnimationFrame(loop);\n    }\n    //recive message\n    exports.onmessage = function (msg, postResponse) {\n        checkFPS((fps) => {\n            if (fps < -1) {\n                postResponse('check fps fail');\n            } else {\n                postResponse(null, { fps });\n            }\n        })\n    }\n}"}));var z8,B8,H8=0,j8=[],U8=function(){function t(t){var e=this;E3(),this._delayMessages=[],this.initializing=!1;var n=h3(t);s3&&!n&&(this.initializing=!0,"Injecting codes in worker with worker key: :".concat(t),g3(t,(function(){e.initializing=!1,e.created()}))),this.workerKey=t,this.workerPool=b3(),this.currentActor=0,this.actorId=i1(),this.workers=this.workerPool.acquire(this.actorId),this.callbacks={},this.callbackID=0,this.receiveFn=this.receive.bind(this),this.workers.forEach((function(t){t.addEventListener("message",e.receiveFn,!1)})),l3(t)}return t.prototype.created=function(){var t=this;this._delayMessages.forEach((function(e){t[e.command](e.data,e.buffers,e.cb,e.workerId)})),this._delayMessages=[]},t.prototype.isActive=function(){return!!this.workers},t.prototype.broadcast=function(t,e,n){var i=this;return this.initializing?(this._delayMessages.push({command:"broadcast",data:t,buffers:e,cb:n}),this):(function(t,e,n){t.length||n(null,[]);var i=t.length,r=new Array(t.length),o=null;t.forEach((function(t,s){e(t,(function(t,e){t&&(o=t),r[s]=e,0==--i&&n(o,r)}))}))}(this.workers,(function(n,r){i.send(t,e,r,n.id)}),n=n||function(){}),this)},t.prototype.send=function(t,e,n,i){if(this.initializing)return this._delayMessages.push({command:"send",data:t,buffers:e,cb:n,workerId:i}),this;var r=n?"".concat(this.actorId,":").concat(this.callbackID++):null;return n&&(this.callbacks[r]=n),this.post({data:t,callback:String(r)},e,i),this},t.prototype.receive=function(t){var e=this,n=t.data,i=n.callback,r=this.callbacks[i];delete this.callbacks[i],"<request>"===n.type?this.actorId===n.actorId&&this[n.command](n.params,(function(t,i,r){var o={type:"<response>",callback:n.callback};t?o.error=t.message:o.data=i,e.post(o,r||j8,n.workerId)})):r&&n.error?r(n.error):r&&r(null,n.data)},t.prototype.remove=function(){var t=this;this.workers.forEach((function(e){e.removeEventListener("message",t.receiveFn,!1)})),delete this.receiveFn,delete this.workers,delete this.callbacks,delete this.workerPool},t.prototype.post=function(t,e,n){return("number"!=typeof n||isNaN(n))&&(n=this.currentActor=(this.currentActor+1)%this.workerPool.workerCount),t.workerId=n,t.workerKey=this.workerKey,t.actorId=this.actorId,this.workerPool.addMessage(n,t,e||j8),n},t.prototype.getDedicatedWorker=function(){return H8=(H8+1)%this.workerPool.workerCount},t}(),G8=function(t){function e(){return t.call(this,N8)||this}return W0(e,t),e}(U8),V8=!1;C3.indexOf(B8=function(){var t;V8||$$.maxFPS<=0&&(V8=!0,t=function(t){i0(t)&&t>0&&$$.maxFPS<=0&&($$.maxFPS=t),V8=!1},z8||(z8=new G8),z8.send({},[],(function(e,n){e?(console.error(e),t()):t(n.fps)})))})>-1||a0(B8)&&C3.push(B8);var W8=[],q8=function(t){function e(){return t.call(this,o3)||this}return W0(e,t),e.prototype.fetchImage=function(t,e){this.send({url:t},W8,e)},e}(U8),Z8=function(t){function e(e){var n=t.call(this)||this;return n.layer=e,n._painted=!1,n._drawTime=0,!G0.decodeImageInWorker||G0.safari||G0.iosWeixin||(n._resWorkerConn=new q8),n.setToRedraw(),n}return W0(e,t),e.prototype.render=function(t){this.prepareRender(),this.getMap()&&this.layer.isVisible()&&(this.resources||(this.resources=new Q8),this.checkAndDraw(this._tryToDraw,t),this._frameTime=t)},e.prototype.getFrameTimestamp=function(){return this._frameTime||0},e.prototype.checkAndDraw=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];if(this._toRedraw=!1,this.checkResources){var r=this.checkResources();r.length>0?(this._loadingResource=!0,this.loadResources(r).then((function(){if(e._loadingResource=!1,e.layer){e.layer.fire("resourceload");var t=e.layer.getMap();e.setToRedraw(),t.getRenderer().callInNextFrame((function(){e.setToRedraw()}))}}))):t.call.apply(t,X0([this],Q0(n),!1))}else t.call.apply(t,X0([this],Q0(n),!1))},e.prototype.testIfNeedRedraw=function(){var t=this.getMap();return!(this._loadingResource||!this._toRedraw&&(t.isInteracting()&&!this.drawOnInteracting||!this.needToRedraw()))},e.prototype.needToRedraw=function(){var t=this.getMap();return!(!t.isInteracting()&&!t.getRenderer().isViewChanged()||!t.getPitch()&&t.isMoving()&&!t.isZooming()&&!t.isRotating()&&!this.layer.options.forceRenderOnMoving)},e.prototype.onSkipDrawOnInteracting=function(){},e.prototype.isLoadingResource=function(){return this._loadingResource},e.prototype.isRenderComplete=function(){return!!this._renderComplete},e.prototype.mustRenderOnInteracting=function(){return!this._painted},e.prototype.setToRedraw=function(){return this._toRedraw=!0,this},e.prototype.setCanvasUpdated=function(){return this._canvasUpdated=!0,this},e.prototype.isCanvasUpdated=function(){return!!this._canvasUpdated},e.prototype.remove=function(){this.onRemove(),delete this._loadingResource,delete this.middleWest,delete this.canvas,delete this.context,delete this.canvasExtent2D,delete this._extent2D,this.resources&&this.resources.remove(),delete this.resources,this._resWorkerConn&&(this._resWorkerConn.remove(),delete this._resWorkerConn),delete this.layer},e.prototype.onRemove=function(){},e.prototype.onAdd=function(){},e.prototype.getMap=function(){return this.layer?this.layer.getMap():null},e.prototype.getCanvasImage=function(){var t=this.getMap();if(this._canvasUpdated=!1,this._renderZoom!==t.getZoom()||!this.canvas||!this._extent2D)return null;if(this.isBlank())return null;if(this.layer.isEmpty&&this.layer.isEmpty())return null;var e=t._pointToContainerPoint(this.middleWest)._add(0,-t.height/2);return{image:this.canvas,layer:this.layer,point:e}},e.prototype.clear=function(){this.clearCanvas()},e.prototype.isBlank=function(){return!this._painted},e.prototype.show=function(){this.setToRedraw()},e.prototype.hide=function(){this.clear(),this.setToRedraw()},e.prototype.setZIndex=function(t){this.setToRedraw()},e.prototype.hitDetect=function(t){if(!this.context||this.layer.isEmpty&&this.layer.isEmpty()||this.isBlank()||this._errorThrown||this.layer.isVisible&&!this.layer.isVisible())return!1;var e=this.getMap(),n=e.getDevicePixelRatio(),i=e.getSize();if(t.x<0||t.x>i.width*n||t.y<0||t.y>i.height*n)return!1;var r=this.getImageData&&this.getImageData();if(r){var o=Math.round(n*t.x),s=Math.round(n*t.y);return r.data[s*r.width*4+4*o+3]>0}try{if(this.context.getImageData(n*t.x,n*t.y,1,1).data[3]>0)return!0}catch(a){return this._errorThrown||(console&&console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",a),this._errorThrown=!0),!1}return!1},e.prototype.loadResources=function(t){this.resources||(this.resources=new Q8);var e=this.resources,n=[];if(d1(t))for(var i={},r=t.length-1;r>=0;r--){var o=t[r];o&&o.length&&!i[o.join("-")]&&(i[o.join("-")]=1,e.isResourceLoaded(o,!0)||n.push(new Promise(this._promiseResource(o))))}return Promise.all(n)},e.prototype.prepareRender=function(){delete this._renderComplete;var t=this.getMap();this._renderZoom=t.getZoom(),this.canvasExtent2D=this._extent2D=t.get2DExtent(),this.middleWest=t._containerPointToPoint(new $0(0,t.height/2))},e.prototype.createCanvas=function(){if(!this.canvas){var t=this.getMap(),e=t.getSize(),n=t.getDevicePixelRatio(),i=Math.round(n*e.width),r=Math.round(n*e.height);if(this.layer._canvas){var o=this.layer._canvas;o.width=i,o.height=r,o.style&&(o.style.width=e.width+"px",o.style.height=e.height+"px"),this.canvas=this.layer._canvas}else this.canvas=j3.createCanvas(i,r,t.CanvasClass);this.onCanvasCreate()}},e.prototype.onCanvasCreate=function(){},e.prototype._canvasContextScale=function(t,e){return t.scale(e,e),t.dpr=e,this},e.prototype.createContext=function(){if(!(this.gl&&this.gl.canvas===this.canvas||this.context)&&(this.context=j3.getCanvas2DContext(this.canvas),this.context)){this.context.dpr=1,this.layer.options.globalCompositeOperation&&(this.context.globalCompositeOperation=this.layer.options.globalCompositeOperation);var t=this.getMap().getDevicePixelRatio();1!==t&&this._canvasContextScale(this.context,t)}},e.prototype.resetCanvasTransform=function(){if(this.context){var t=this.getMap().getDevicePixelRatio();this.context.setTransform(t,0,0,t,0,0)}},e.prototype.resizeCanvas=function(t){var e=this.canvas;if(e){var n=t||this.getMap().getSize(),i=this.getMap().getDevicePixelRatio(),r=I1(n,i),o=r.width,s=r.height,a=r.cssWidth,h=r.cssHeight;!this.layer._canvas||e.style.width===a&&e.style.height===h||(e.style.width=a,e.style.height=h),e.width===o&&e.height===s||(e.height=s,e.width=o,this.context&&(this.context.dpr=1),1!==i&&this.context&&this._canvasContextScale(this.context,i))}},e.prototype.clearCanvas=function(){if(this.context&&this.getMap()){var t=1/this.getMap().getDevicePixelRatio(),e=this.canvas.height*t;j3.clearRect(this.context,0,0,Math.max(this.canvas.width*t,this.canvas.width),Math.max(e,this.canvas.height))}},e.prototype.prepareCanvas=function(){this.canvas?(this.resetCanvasTransform(),this.clearCanvas(),this.resizeCanvas()):(this.createCanvas(),this.createContext(),this.layer.onCanvasCreate(),this.layer.fire("canvascreate",{context:this.context,gl:this.gl})),delete this._maskExtent;var t=this.layer.getMask();if(!t)return this.layer.fire("renderstart",{context:this.context,gl:this.gl}),null;var e=this._maskExtent=t._getMaskPainter().get2DExtent();return e&&this._extent2D&&e.intersects(this._extent2D),this.layer.fire("renderstart",{context:this.context,gl:this.gl}),e},e.prototype.clipCanvas=function(t){var e=this.layer.getMask();if(!e)return!1;if(!this.layer.options.maskClip)return!1;var n=this.middleWest,i=this.getMap();this.middleWest=i._containerPointToPoint(new $0(0,i.height/2)),t.save();var r=i.getDevicePixelRatio();if(1!==r&&(t.save(),this._canvasContextScale(t,r)),e.getGeometries){t.isMultiClip=!0;var o=e.getGeometries()||[];t.beginPath(),o.forEach((function(e){e._getMaskPainter().paint(null,t)})),t.stroke(),t.isMultiClip=!1}else t.isClip=!0,t.beginPath(),e._getMaskPainter().paint(null,t),t.isClip=!1;1!==r&&t.restore();try{t.clip("evenodd")}catch(s){console.error(s)}return this.middleWest=n,!0},e.prototype.getViewExtent=function(){return{extent:this._extent2D,maskExtent:this._maskExtent,zoom:this._renderZoom,middleWest:this.middleWest}},e.prototype.completeRender=function(){this.getMap()&&(this._renderComplete=!0,this.layer.fire("renderend",{context:this.context,gl:this.gl}),this.setCanvasUpdated())},e.prototype.getEvents=function(){return{_zoomstart:this.onZoomStart,_zooming:this.onZooming,_zoomend:this.onZoomEnd,_resize:this.onResize,_movestart:this.onMoveStart,_moving:this.onMoving,_moveend:this.onMoveEnd,_dragrotatestart:this.onDragRotateStart,_dragrotating:this.onDragRotating,_dragrotateend:this.onDragRotateEnd,_spatialreferencechange:this.onSpatialReferenceChange}},e.prototype.onZoomStart=function(t){},e.prototype.onZoomEnd=function(t){this.setToRedraw()},e.prototype.onZooming=function(t){},e.prototype.onMoveStart=function(t){},e.prototype.onMoving=function(t){},e.prototype.onMoveEnd=function(t){this.setToRedraw()},e.prototype.onResize=function(t){delete this._extent2D,this.resizeCanvas(),this.setToRedraw()},e.prototype.onDragRotateStart=function(t){},e.prototype.onDragRotating=function(t){},e.prototype.onDragRotateEnd=function(t){this.setToRedraw()},e.prototype.onSpatialReferenceChange=function(t){},e.prototype.getDrawTime=function(){return this._drawTime},e.prototype._tryToDraw=function(t){this._toRedraw=!1,!this.canvas&&this.layer.isEmpty&&this.layer.isEmpty()?this._renderComplete=!0:this._drawAndRecord(t)},e.prototype._drawAndRecord=function(t){if(this.getMap()){var e=this._painted;this._painted=!0;var n=t0();this.draw(t),n=t0()-n,this._drawTime=e?n:n/2,e&&this.layer&&this.layer.options.logDrawTime&&(this.layer.getId(),this._drawTime)}},e.prototype._promiseResource=function(t){var e=this,n=this.layer,i=this.resources,r=n.options.crossOrigin,o=n.options.renderer||"";return function(s){if(i.isResourceLoaded(t,!0))s(t);else{var a,h=k2(t[0]);if((a=h)&&G0.decodeImageInWorker&&a instanceof ImageBitmap)createImageBitmap(h).then((function(n){e._cacheResource(t,n),s(t)})).catch((function(e){console.error(e),s(t)}));else if(t1(t[0])||!e._resWorkerConn||"canvas"===n.options.renderer&&!n.options.decodeImageInWorker){var l=new Image;n0(r)?"canvas"!==o&&(l.crossOrigin=""):l.crossOrigin=r,t1(t[0])&&!K$&&(t[1]&&(t[1]*=2),t[2]&&(t[2]*=2)),l.onload=function(){e._cacheResource(t,l),s(t)},l.onabort=function(e){console&&console.warn("image loading aborted: "+t[0]),e&&console&&console.warn(e),s(t)},l.onerror=function(e){e&&"undefined"!=typeof console&&console.warn(e),i.markErrorResource(t),s(t)},e1(l,[h])}else e._resWorkerConn.fetchImage(h,(function(n,i){if(n)return n&&"undefined"!=typeof console&&console.warn(n),void s(t);M1(i,(function(n){e._cacheResource(t,n),s(t)}))}))}}},e.prototype._cacheResource=function(t,e){if(this.layer&&this.resources){var n=t[1],i=t[2];if(this.layer.options.cacheSvgOnCanvas&&1===t1(t[0])&&(G0.edge||G0.ie)){n0(n)&&(n=e.width||this.layer.options.defaultIconSize[0]),n0(i)&&(i=e.height||this.layer.options.defaultIconSize[1]);var r=j3.createCanvas(n,i);j3.image(r.getContext("2d"),e,0,0,n,i),e=r}this.resources.addResource(t,e)}},e}(Y3),Q8=function(){function t(){this.resources={},this._errors={}}return t.prototype.addResource=function(t,e){var n=this;if(this.resources[t[0]]={image:e,width:+t[1],height:+t[2],refCnt:0},e&&e.width&&e.height&&!e.close&&G0.imageBitMap&&!G0.safari&&!G0.iosWeixin){if(e.src&&t1(e.src))return;createImageBitmap(e).then((function(e){n.resources[t[0]]&&(n.resources[t[0]].image=e)}))}},t.prototype.isResourceLoaded=function(t,e){if(!t)return!1;var n=this._getImgUrl(t);if(this._errors[n])return!0;var i=this.resources[n];return!(!i||e&&t1(t[0])&&(+t[1]>i.width||+t[2]>i.height))},t.prototype.login=function(t){var e=this.resources[t];e&&e.refCnt++},t.prototype.logout=function(t){var e=this.resources[t];e&&e.refCnt--<=0&&(e.image&&e.image.close&&e.image.close(),delete this.resources[t])},t.prototype.getImage=function(t){var e=this._getImgUrl(t);return!this.isResourceLoaded(t)||this._errors[e]?null:this.resources[e].image},t.prototype.markErrorResource=function(t){this._errors[this._getImgUrl(t)]=1},t.prototype.merge=function(t){if(!t)return this;for(var e in t.resources){var n=t.resources[e];this.addResource([e,n.width,n.height],n.image)}return this},t.prototype.forEach=function(t){if(!this.resources)return this;for(var e in this.resources)l0(this.resources,e)&&t(e,this.resources[e]);return this},t.prototype._getImgUrl=function(t){return Array.isArray(t)?t[0]:t},t.prototype.remove=function(){for(var t in this.resources){var e=this.resources[t];e&&e.image&&e.image.close&&e.image.close()}this.resources={}},t}();G0.decodeImageInWorker&&c3(o3,(function(){return"\nfunction (exports) {\n    exports.onmessage = function (msg, postResponse) {\n        var url = msg.data.url;\n        var fetchOptions = msg.data.fetchOptions;\n        requestImageOffscreen(url, function (err, data) {\n            var buffers = [];\n            if (data && data.data) {\n                buffers.push(data.data);\n            }\n            postResponse(err, data, buffers);\n        }, fetchOptions);\n    };\n\n    function requestImageOffscreen(url, cb, fetchOptions) {\n        fetch(url, fetchOptions ? fetchOptions : {})\n            .then(response => response.arrayBuffer())\n            .then(arrayBuffer => {\n                const blob=new Blob([arrayBuffer]);\n                return createImageBitmap(blob);\n            })\n            .then(bitmap => {\n                cb(null, {data:bitmap});\n            }).catch(err => {\n                console.warn('error when loading tile:', url);\n                console.warn(err);\n                cb(err);\n            });\n    }\n}"}));var X8={markerWidth:10,markerHeight:10,markerLineWidth:1},Y8=new $0(0,0);function J8(t,e,n,i,r,o){var s=r.x+o.x,a=r.y+o.y;Y8.x=s,Y8.y=a;var h=function(t){if(!t)return 0;var e=t.x,n=t.y;if(0===e&&0===n)return 0;if(0===e||!e){if(n<0)return-Math.PI/2;if(n>0)return Math.PI/2}var i=n/e;return n<0&&e<0?Math.atan(i)-Math.PI:n>0&&e<0?Math.atan(i)+Math.PI:Math.atan(i)}(Y8),l=Math.sqrt(s*s+a*a),u=0,c=0;u+=Math.cos(e+h)*l,c+=Math.sin(e+h)*l;var A,f,d,p,g,m,y,v,_,x,b,w,C,P,M,T,S,I=Q0((A=n,f=i,d=e,p=Math.PI/2+d,g=Math.PI/4+d,m=d,y=f,v=Math.sqrt(A*A+f*f),_=A,x=Math.cos(p)*y,b=Math.sin(p)*y,w=Math.cos(g)*v,C=Math.sin(g)*v,P=Math.cos(m)*_,M=Math.sin(m)*_,T=Math.min(x,w,P,0),S=Math.min(b,C,M,0),[T,S,Math.max(x,w,P,0)-T,Math.max(b,C,M,0)-S]),4),E=I[3];c+=I[1];var O=(u+=I[0])+Math.max(n,I[2]),R=c+Math.max(i,E);return t.set(u,c,O,R),t}var K8=new $0(0,0);function $8(t,e,n,i,r,o,s){var a=K8.set(e,n);if(i)return J8(t,i,o,s,a,r);var h,l,u=t.set(a.x,a.y,a.x+o,a.y+s);return u._add(r),i&&(h=u,l=i,a6.set(h.xmin,h.ymin,h.xmax,h.ymax),a6.convertTo((function(t){return t._rotate(l)}),h)),u}var t6=[];function e6(t,e,n){if((n=n||s6(t6,e))&&(0===n[0]||0===n[1]))return _6(t),t;var i=o6(e,n[0],n[1]);return $8(t,e.markerDx||0,e.markerDy||0,h6(e),i,n[0],n[1])}function n6(t){return"rectangle"===t?"right":"middle"}function i6(t){return"bar"===t||"pie"===t||"pin"===t?"top":"rectangle"===t?"bottom":"middle"}var r6=new z1(0,0);function o6(t,e,n){var i=2*(t.shadowBlur||0)+.5;r6.width=e,r6.height=n;var r=t.markerType,o=J1(r6,t.markerHorizontalAlignment||n6(r),t.markerVerticalAlignment||i6(r));return o.x!==-e/2&&(o.x-=u1(o.x+e/2)*i),o.y!==-n/2&&(o.y-=u1(o.y+n/2)*i),o}function s6(t,e){var n=l1(e.markerWidth,X8.markerWidth),i=l1(e.markerHeight,X8.markerHeight);if(0===n||0===i)return t[0]=0,t[1]=0,t;var r=l1(e.markerLineWidth,X8.markerLineWidth),o=2*((e.shadowBlur||0)+Math.max(Math.abs(e.shadowOffsetX||0)+Math.abs(e.shadowOffsetY||0))),s=Math.round(n+r+o+1),a=Math.round(i+r+o+1);return t[0]=s,t[1]=a,t}var a6=new Y4;function h6(t,e){void 0===e&&(e="markerRotation");var n=t[e];return i0(n)?-n*Math.PI/180:0}function l6(t,e,n){var i=n?n.getImage(e.markerFile):null,r=e.markerWidth||(i?i.width:0),o=e.markerHeight||(i?i.height:0);if(r6.width=r,r6.height=o,0===e.markerWidth||0===e.markerHeight)return _6(t),t;var s=J1(r6,e.markerHorizontalAlignment||"middle",e.markerVerticalAlignment||"top");return $8(t,e.markerDx||0,e.markerDy||0,h6(e),s,r,o)}function u6(t,e,n){var i=n.size;if(i&&(0===i.width||0===i.height))return _6(t),t;var r=J1(i,e.textHorizontalAlignment,e.textVerticalAlignment),o=e.textHaloRadius||0,s=$8(t,e.textDx||0,e.textDy||0,h6(e,"textRotation"),r,i.width,i.height);return s.xmin-=o,s.xmax+=o,s.ymin-=o,s.ymax+=o,s}var c6=new Y4;function A6(t,e,n,i){var r=t||new Y4;if(Array.isArray(e)){for(var o=e,s=0;s<o.length;s++)A6(r,o[s],n,i[s]);return r}return f6(e)&&r._combine(u6(c6,e,i)),d6(e)&&r._combine(l6(c6,e,n)),p6(e)&&r._combine(e6(c6,e)),g6(e)&&r._combine(l6(c6,e)),r}function f6(t){return!!t&&!n0(t.textName)}function d6(t){return!!t&&!n0(t.markerFile)}function p6(t){return!!t&&!(!n0(t.markerFile)||n0(t.markerType)||"path"===t.markerType)}function g6(t){return!!t&&!(!n0(t.markerFile)||"path"!==t.markerType)}var m6,y6=["markerWidth","markerHeight","markerHorizontalAlignment","markerVerticalAlignment","markerDx","markerDy","markerRotation","textName","textSize","textDx","textDy","textVerticalAlignment","textHorizontalAlignment","textRotation","textWrapWidth"],v6=["textName","markerType","markerFile","textHaloRadius","shadowBlur","shadowOffsetX","shadowOffsetY","textWrapWidth"];function _6(t){t&&(t.xmin=1/0,t.ymin=1/0,t.xmax=-1/0,t.ymax=-1/0)}function x6(t,e,n,i){for(var r,o=[],s=0,a=0,h=t.length;a<h-1;a++)(r=b6(t[a],t[a+1],e,a,n,i))&&(o[s]=o[s]||[],o[s].push({point:r[0],index:a}),r[1]===t[a+1]&&a!==h-2||(o[s].push({point:r[1],index:a+1}),s++));return o}function b6(t,e,n,i,r,o){var s,a,h,l=i?m6:P6(t,n),u=P6(e,n);for(m6=u;;){if(!(l|u))return[t,e];if(l&u)return!1;if(o)return[t,e];h=P6(a=C6(t,e,s=l||u,n,r),n),s===l?(t=a,l=h):(e=a,u=h)}}function w6(t,e,n){var i,r,o,s,a,h,l,u,c,A=[1,4,2,8];for(r=0,l=t.length;r<l;r++)t[r]._code=P6(t[r],e);for(s=0;s<4;s++){for(u=A[s],i=[],r=0,o=(l=t.length)-1;r<l;o=r++)h=t[o],(a=t[r])._code&u?h._code&u||((c=C6(h,a,u,e,n))._code=P6(c,e),i.push(c)):(h._code&u&&((c=C6(h,a,u,e,n))._code=P6(c,e),i.push(c)),i.push(a));t=i}return t}function C6(t,e,n,i,r){var o,s,a=e.x-t.x,h=e.y-t.y,l=i.getMin(),u=i.getMax();8&n?(o=t.x+a*(u.y-t.y)/h,s=u.y):4&n?(o=t.x+a*(l.y-t.y)/h,s=l.y):2&n?(o=u.x,s=t.y+h*(u.x-t.x)/a):1&n&&(o=l.x,s=t.y+h*(l.x-t.x)/a);var c=new $0(o,s);return r&&c._round(),c}function P6(t,e){var n=0;return t.x<e.getMin().x?n|=1:t.x>e.getMax().x&&(n|=2),t.y<e.getMin().y?n|=4:t.y>e.getMax().y&&(n|=8),n}function M6(t,e,n,i){t=new $0(t);var r,o,s,a=Math.abs(n.x-e.x),h=Math.abs(n.y-e.y),l=Math.sqrt(Math.abs(a*a-h*h));return a>=h?(r=new $0(e.x-l,e.y),o=new $0(e.x+l,e.y),s=2*a):(r=new $0(e.x,e.y-l),o=new $0(e.x,e.y+l),s=2*h),t.distanceTo(r)+t.distanceTo(o)<=s+2*i}function T6(t){if(!t)return[0,0];var e=1/0,n=-1/0;if(i0(t))return[e=n=t,n];var i=function(t){for(var i=0,r=t.length;i<r;i++){var o=t[i];e=Math.min(e,o),n=Math.max(n,o)}};if(!Array.isArray(t[0]))return i(t),[e,n];for(var r=0,o=t.length;r<o;r++)i(t[r]);return[e,n]}var S6=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype._prepareContext=function(t){if(J2(this.symbol.opacity)?this._opacityFn||(this._opacityFn=$2(this.symbol.opacity)):delete this._opacityFn,i0(this.symbol.opacity))t.globalAlpha!==this.symbol.opacity&&(t.globalAlpha=this.symbol.opacity);else if(this._opacityFn){var e=this.getMap();t.globalAlpha=this._opacityFn(e.getZoom())}else 1!==t.globalAlpha&&(t.globalAlpha=1)},e.prototype.prepareCanvas=function(t,e,n){t.setLineDash&&d1(e.lineDasharray)&&t.setLineDash(e.lineDasharray);var i=this.getPainter().isHitTesting();j3.prepareCanvas(t,e,n,i)},e.prototype.remove=function(){},e.prototype.setZIndex=function(){},e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype._defineStyle=function(t){return this.symbol&&(t.visible=this.symbol.visible,t.opacity=this.symbol.opacity),v5(t,this.geometry)},e}(function(){function t(){this.bbox=Y5()}return t.prototype._setBBOX=function(t,e,n,i,r){return t.isHitTesting||t3(this.bbox,e,n,i,r),this},t.prototype._bufferBBOX=function(t,e){return t.isHitTesting||n3(this.bbox,e),this},t.prototype.getMap=function(){return this.geometry.getMap()},t.prototype.getPainter=function(){return this.painter},t.prototype.isDynamicSize=function(){return!1},t.prototype.isVisible=function(){if(!this.style)return!0;var t=this.style.visible;return!1!==t&&0!==t&&!(this.style.opacity<=0)},t.testColor=function(t){return!(!t||!s0(t))&&F1.indexOf(t)>=0},t}());function I6(t,e,n,i){var r,o,s,a,h=E6(n),l=n,u=l.markerType.toLowerCase(),c=O6(u,l.markerWidth,l.markerHeight),A=h.lineOpacity,f=h.polygonOpacity;if(C5(h.polygonFill)){var d=void 0;C5(h.polygonFill)&&(d||(r=e,o=l.markerWidth,s=l.markerHeight,(a=new Y4)._combine(r),a.xmin+=-o/2,a.ymin+=-s/2,a.xmax+=o/2,a.ymax+=s/2,d=a),h.polygonGradientExtent=d)}j3.prepareCanvas(t,h,i);var p=l.markerWidth,g=l.markerHeight,m=l.markerLineWidth/2;if("ellipse"===u)j3.ellipse(t,e,p/2,g/2,g/2,A,f);else if("cross"===u||"x"===u){for(var y=c.length-1;y>=0;y--)c[y]._add(e);j3.path(t,c.slice(0,2),A),j3.path(t,c.slice(2,4),A)}else if("diamond"===u||"bar"===u||"square"===u||"rectangle"===u||"triangle"===u){for("bar"===u?e=e.add(0,-m):"rectangle"===u&&(e=e.add(m,m)),y=c.length-1;y>=0;y--)c[y]._add(e);j3.polygon(t,c,A,f)}else if("pin"===u){for(e=e.add(0,-m),y=c.length-1;y>=0;y--)c[y]._add(e);var v=t.lineCap;t.lineCap="round",j3.bezierCurveAndFill(t,c,A,f),t.lineCap=v}else{if("pie"!==u)throw new Error("unsupported markerType: "+u);e=e.add(0,-m);var _=180*Math.atan(p/2/g)/Math.PI;v=t.lineCap,t.lineCap="round",j3.sector(t,e,g,[90-_,90+_],A,f),t.lineCap=v}return t.canvas}function E6(t){var e={lineColor:t.markerLineColor,linePatternFile:t.markerLinePatternFile,lineWidth:t.markerLineWidth,lineOpacity:t.markerLineOpacity,lineDasharray:t.markerLineDasharray,lineCap:"butt",lineJoin:"round",polygonFill:t.markerFill,polygonPatternFile:t.markerFillPatternFile,polygonOpacity:t.markerFillOpacity};return 0===e.lineWidth&&(e.lineOpacity=0),e}function O6(t,e,n){var i,r,o,s,a=n/2,h=e/2;if("triangle"===t)return[i=new $0(0,0-a),r=new $0(0-h,0+a),o=new $0(0+h,0+a)];if("cross"===t)return[i=new $0(0-h,0),r=new $0(0+h,0),o=new $0(0,0-a),s=new $0(0,0+a)];if("diamond"===t)return[i=new $0(0-h,0),r=new $0(0,0-a),o=new $0(0+h,0),s=new $0(0,0+a)];if("square"===t)return[i=new $0(0-h,0+a),r=new $0(0+h,0+a),o=new $0(0+h,0-a),s=new $0(0-h,0-a)];if("rectangle"===t)return r=(i=new $0(0,0)).add(e,0),o=i.add(e,n),s=i.add(0,n),[i,r,o,s];if("x"===t)return[i=new $0(0-h,0+a),r=new $0(0+h,0-a),o=new $0(0+h,0+a),s=new $0(0-h,0-a)];if("bar"===t)return[i=new $0(0-h,0-n),r=new $0(0+h,0-n),o=new $0(0+h,0),s=new $0(0-h,0)];if("pin"===t||"pie"===t){var l=n*Math.atan(h/a);return[i=new $0(0,0),r=new $0(0-l,0-n),o=new $0(0+l,0-n),s=new $0(0,0)]}return[]}var R6,D6=new $0(0,0),k6=new $0(0,0),L6=new $0(0,0),F6=new $0(0,0),N6=function(t){function e(e,n,i){var r=t.call(this)||this;return r.symbol=e,r.geometry=n,r.painter=i,r}return W0(e,t),e.prototype.get2DExtent=function(){for(var t=this.getMap(),e=t.getGLRes(),n=new Y4,i=this._getRenderPoints()[0],r=i.length-1;r>=0;r--)i[r]&&n._combine(t._pointAtResToPoint(i[r],e));return n},e.prototype.isDynamicSize=function(){var t=this.symbol;return J2(t.markerWidth)||J2(t.markerHeight)||J2(t.textSize)},e.prototype._rotateExtent=function(t,e){return t.convertTo((function(t){return t._rotate(e)}))},e.prototype._getRenderPoints=function(){var t=this.getPainter().isSpriting()?"center":this.getPlacement();return this.getPainter().getRenderPoints(t)},e.prototype._getRenderContainerPoints=function(t){var e=this.getPainter();if(e.isSpriting())return this._getRenderPoints()[0];var n,i=this.geometry,r=this.getDxDy();if(i._cPoint&&!t){var o=t?L6:F6;o.set(i._cPoint.x,i._cPoint.y),o._sub(e.containerOffset);var s=r.x,a=r.y;(s||a)&&o._add(s||0,a||0),n=[o]}else{var h=this._getRenderPoints()[0];n=this.painter._pointContainerPoints(h,r.x,r.y,t,!0,this.getPlacement())}if(!n||!Array.isArray(n[0]))return n;for(var l=[],u=0,c=n.length;u<c;u++)for(var A=0,f=n[u].length;A<f;A++)l.push(n[u][A]);return l},e.prototype.getPlacement=function(){return this.symbol.markerPlacement},e.prototype.getRotation=function(){return h6(this.style)},e.prototype.getDxDy=function(){var t=this.style;return new $0(t.markerDx,t.markerDy)},e.prototype._getRotationAt=function(t){var e=this.getRotation();e||(e=0);var n=this._getRenderPoints()[1];if(!n||!n[t])return e;var i=this.getMap(),r=n[t][0],o=n[t][1];if(i.isTransforming()){var s=i.getGLRes();return r=i._pointAtResToContainerPoint(n[t][0],s,0,D6),o=i._pointAtResToContainerPoint(n[t][1],s,0,k6),e+_1(r.x,r.y,o.x,o.y)}return e+-_1(r.x,r.y,o.x,o.y)},e.prototype._rotate=function(t,e,n){if(n){var i=this.getDxDy(),r=e.sub(i);return t.save(),t.translate(r.x,r.y),t.rotate(n),i}return null},e}(S6),z6=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.getPlacement=function(){return"point"},e.prototype.getDxDy=function(){return new $0(0,0)},e.prototype.symbolize=function(t){var e=this.geometry,n=e.getLayer();if(e.options.debug||!n||n.options.debug){var i=this.getMap();if(i&&!i.isZooming()){var r=n.options.debugOutline;t.strokeStyle=r,t.fillStyle=r,t.lineWidth=1,t.font="18px  serif";var o=e.getContainerExtent().toArray();j3.polygon(t,[o],1,0);for(var s=this._getRenderContainerPoints(),a=this.geometry.getId(),h=O6("cross",10,10),l=0;l<s.length;l++){var u=s[l];n0(a)||j3.fillText(t,a,u.add(8,-4),r);for(var c=[],A=0;A<h.length;A++)c.push(h[A].add(u));j3.path(t,c.slice(0,2),1),j3.path(t,c.slice(2,4),1)}}}},e}(N6),B6=new z1(1,1),H6=new Y4,j6=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.style=r._defineStyle(r.translate()),r}return W0(e,t),e.test=function(t){return d6(t)},e.prototype.symbolize=function(t,e){if(this.isVisible()){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&0!==n.markerOpacity){var i=this._getRenderContainerPoints();if(d1(i)){var r=this._getImage(e);if(r){this._prepareContext(t);var o,s=n.markerWidth,a=n.markerHeight;if(!i0(s)||!i0(a)){a=r.height,n.markerWidth=s=r.width,n.markerHeight=a;var h=n.markerFile;e.isResourceLoaded(h)||e.addResource(h,r);var l=this.getPainter();l.isSpriting()||l.removeCache()}"path"!==this.symbol.markerType&&i0(n.markerOpacity)&&n.markerOpacity<1&&(o=t.globalAlpha,t.globalAlpha*=n.markerOpacity),B6.width=s,B6.height=a;for(var u=J1(B6,n.markerHorizontalAlignment,n.markerVerticalAlignment),c=0,A=i.length;c<A;c++){var f=i[c],d=this.getRotation()?this._rotate(t,f,this._getRotationAt(c)):null,p=void 0;if(d){var g=f.sub(d);f=d;var m=this._getRotationAt(c);(p=J8(H6,m,s,a,f,u))._add(g)}var y=f.x+u.x,v=f.y+u.y;j3.image(t,r,y,v,s,a),d&&t.restore(),d?this._setBBOX(t,p.xmin,p.ymin,p.xmax,p.ymax):this._setBBOX(t,y,v,y+s,v+a)}void 0!==o&&(t.globalAlpha=o)}else"undefined"!=typeof console&&console.warn("no img found for "+(this.style.markerFile||this._url[0]))}}}},e.prototype._getImage=function(t){return e=t,n=this.style.markerFile,e&&e.getImage(n)||null;var e,n},e.prototype.getFixedExtent=function(t){return this._fixedExtent=this._fixedExtent||new Y4,l6(this._fixedExtent,this.style,t)},e.prototype.translate=function(){var t=this.symbol;return{markerFile:t.markerFile,markerOpacity:l1(t.markerOpacity,1),markerWidth:l1(t.markerWidth,null),markerHeight:l1(t.markerHeight,null),markerRotation:l1(t.markerRotation,0),markerDx:l1(t.markerDx,0),markerDy:l1(t.markerDy,0),markerHorizontalAlignment:l1(t.markerHorizontalAlignment,"middle"),markerVerticalAlignment:l1(t.markerVerticalAlignment,"top")}},e}(N6),U6=new F4(0,0),G6=new F4(0,0),V6=function(t){function e(e,n,i){var r=t.call(this)||this;return r.symbol=e,r.geometry=n,r.painter=i,n.isPoint||(r.style=r._defineStyle(r.translate())),r}return W0(e,t),e.test=function(t,e){if(!t)return!1;if(e&&e.isPoint)return!1;for(var n in t){var i=n.slice(0,4);if("line"===i||"poly"===i)return!0}return!1},e.prototype.symbolize=function(t,e){var n,i;if(this.isVisible()){var r=this.style;if(0!==r.polygonOpacity||0!==r.lineOpacity||this.painter.isHitTesting()){var o=this._getPaintParams();if(o){this._prepareContext(t);var s=C5(r.lineColor),a="Polygon"===this.geometry.getJSONType()||"LineString"===this.geometry.type;!s||!r.lineColor.places&&a||(r.lineGradientExtent=this.geometry.getContainerExtent()._expand(r.lineWidth)),C5(r.polygonFill)&&(r.polygonGradientExtent=this.geometry.getContainerExtent());var h=this.geometry.getLayer().options.geometryEventTolerance||0,l=this.geometry._hitTestTolerance()+h,u=o[0];if("Polygon"===this.geometry.getJSONType()&&u.length>0&&Array.isArray(u[0][0])||"LineString"===this.geometry.type&&u.length>0&&Array.isArray(u[0]))for(var c=0;c<u.length;c++){this.prepareCanvas(t,r,e),s&&a&&!r.lineColor.places&&this._createGradient(t,u[c],r.lineColor);var A=[t,u[c]];o.length>1&&A.push.apply(A,X0([],Q0(o.slice(1)),!1)),A.push(r.lineOpacity,r.polygonOpacity,r.lineDasharray);var f=(n=this.geometry)._paintOn.apply(n,X0([],Q0(A),!1));this._setBBOX(t,f),this._bufferBBOX(t,l)}else this.prepareCanvas(t,r,e),s&&a&&!r.lineColor.places&&this._createGradient(t,u,r.lineColor),(A=[t]).push.apply(A,X0([],Q0(o),!1)),A.push(r.lineOpacity,r.polygonOpacity,r.lineDasharray),f=(i=this.geometry)._paintOn.apply(i,X0([],Q0(A),!1)),this._setBBOX(t,f),this._bufferBBOX(t,l);t.setLineDash&&Array.isArray(r.lineDasharray)&&t.setLineDash([])}}}},e.prototype.get2DExtent=function(){var t=this.getMap(),e=this.geometry._getPrjExtent();if(!e)return null;this._extMin&&this._extMax||(this._extMin=new F4(0,0),this._extMax=new F4(0,0)),this._extMin.x=e.xmin,this._extMin.y=e.ymin,this._extMax.x=e.xmax,this._extMax.y=e.ymax;var n=t._prjToPoint(this._extMin,void 0,U6),i=t._prjToPoint(this._extMax,void 0,G6);return this._pxExtent?this._pxExtent.set(Math.min(n.x,i.x),Math.min(n.y,i.y),Math.max(n.x,i.x),Math.max(n.y,i.y)):this._pxExtent=new Y4(n,i),this._pxExtent},e.prototype.getFixedExtent=function(){var t=this.style.lineWidth/2;return new Y4(-t,-t,t,t)},e.prototype._getPaintParams=function(){return this.getPainter().getPaintParams(this.style.lineDx,this.style.lineDy)},e.prototype.translate=function(){var t=this.symbol,e={lineColor:l1(t.lineColor,"#000"),lineWidth:l1(t.lineWidth,2),lineOpacity:l1(t.lineOpacity,1),lineDasharray:l1(t.lineDasharray,[]),lineCap:l1(t.lineCap,"butt"),lineJoin:l1(t.lineJoin,"miter"),linePatternFile:l1(t.linePatternFile,null),lineDx:l1(t.lineDx,0),lineDy:l1(t.lineDy,0),polygonFill:l1(t.polygonFill,null),polygonOpacity:l1(t.polygonOpacity,1),polygonPatternFile:l1(t.polygonPatternFile,null),polygonPatternDx:l1(t.polygonPatternDx,0),polygonPatternDy:l1(t.polygonPatternDy,0),linePatternDx:l1(t.linePatternDx,0),linePatternDy:l1(t.linePatternDy,0)};return 0===e.lineWidth&&(e.lineOpacity=0),"LineString"!==this.geometry.type||e.polygonFill||(e.polygonFill=e.lineColor),e},e.prototype._createGradient=function(t,e,n){if(Array.isArray(e)&&e.length){var i=Q0(function(t){var e,n=!0;Array.isArray(t[0])?(e=t[0],n=!1):e=t;var i=e.length;if(n)return[e[0],e[i-1]];for(var r,o=e[0],s=0,a=1;a<i;a++){var h=e[a],l=o.distanceTo(h);l>s&&(s=l,r=h)}return[o,r]}(e),2),r=i[0],o=i[1];if(r&&o){var s=t.createLinearGradient(r.x,r.y,o.x,o.y);n.colorStops.forEach((function(t){s.addColorStop.apply(s,X0([],Q0(t),!1))})),t.strokeStyle=s}else console.error("unable create canvas LinearGradient,error data:",e)}},e}(S6),W6=new Y4,q6=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this,o=r.translate();return r._dynamic=K2(o),r.style=r._defineStyle(o),0===r.style.textWrapWidth||(r.strokeAndFill=r._defineStyle(r.translateLineAndFill(r.style))),r}return W0(e,t),e.test=function(t){return f6(t)},e.prototype.symbolize=function(t,e){if(this.isVisible()&&(this.painter.isHitTesting()||0!==this.style.textSize&&(this.style.textOpacity||this.style.textHaloRadius&&this.style.textHaloOpacity)&&0!==this.style.textWrapWidth)){var n=this._getRenderContainerPoints();if(d1(n)){var i=this.style,r=this.strokeAndFill,o=X1(this.style.textName,this.geometry.getProperties());this._dynamic&&delete this._textDesc;var s=this._textDesc=this._textDesc||Y1(o,this.style);this._prepareContext(t),this.prepareCanvas(t,r,e),j3.prepareCanvasFont(t,i);for(var a=i.textHaloRadius||0,h=0,l=n.length;h<l;h++){var u=n[h],c=this.getRotation()?this._rotate(t,u,this._getRotationAt(h)):null,A=void 0;if(c){var f=u.sub(c);u=c;var d=this._getRotationAt(h),p=s.size||{width:0,height:0},g=p.width,m=p.height,y=J1(s.size,i.textHorizontalAlignment,i.textVerticalAlignment);(A=J8(W6,d,g,m,u,y))._add(f)}var v=j3.text(t,o,u,i,s);c?(this._setBBOX(t,A.xmin,A.ymin,A.xmax,A.ymax),t.restore()):this._setBBOX(t,v),this._bufferBBOX(t,a)}}}},e.prototype.getPlacement=function(){return this.symbol.textPlacement},e.prototype.getRotation=function(){var t=this.style.textRotation;return i0(t)?-t*Math.PI/180:null},e.prototype.getDxDy=function(){var t=this.style;return new $0(t.textDx,t.textDy)},e.prototype.getFixedExtent=function(){var t=this.geometry.getTextDesc();return Array.isArray(t)&&(t=t[this._index]),this._fixedExtent=this._fixedExtent||new Y4,t?u6(this._fixedExtent,this.style,t):this._fixedExtent},e.prototype.translate=function(){var t=this.symbol,e={textName:t.textName,textFaceName:l1(t.textFaceName,"monospace"),textWeight:l1(t.textWeight,"normal"),textStyle:l1(t.textStyle,"normal"),textSize:l1(t.textSize,N1),textFont:l1(t.textFont,null),textFill:l1(t.textFill,"#000"),textOpacity:l1(t.textOpacity,1),textHaloFill:l1(t.textHaloFill,"#ffffff"),textHaloRadius:l1(t.textHaloRadius,0),textHaloOpacity:l1(t.textHaloOpacity,1),textWrapWidth:l1(t.textWrapWidth,null),textWrapCharacter:l1(t.textWrapCharacter,"\n"),textLineSpacing:l1(t.textLineSpacing,0),textDx:l1(t.textDx,0),textDy:l1(t.textDy,0),textHorizontalAlignment:l1(t.textHorizontalAlignment,"middle"),textVerticalAlignment:l1(t.textVerticalAlignment,"middle"),textAlign:l1(t.textAlign,"center"),textRotation:l1(t.textRotation,0),textMaxWidth:l1(t.textMaxWidth,0),textMaxHeight:l1(t.textMaxHeight,0)};return e.textMaxWidth>0&&(!e.textWrapWidth||e.textWrapWidth>e.textMaxWidth)&&(e.textWrapWidth||(e.textMaxHeight=1),e.textWrapWidth=e.textMaxWidth),e},e.prototype.translateLineAndFill=function(t){return{lineColor:t.textHaloRadius?t.textHaloFill:t.textFill,lineWidth:t.textHaloRadius,lineOpacity:t.textOpacity,lineDasharray:null,lineCap:"butt",lineJoin:"round",polygonFill:t.textFill,polygonOpacity:t.textOpacity}},e}(N6),Z6=[0,0],Q6=new Y4,X6=new $0(0,0),Y6=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this,o=r.translate();return r._dynamic=K2(o),r.style=r._defineStyle(o),r.strokeAndFill=r._defineStyle(E6(r.style)),r.padding=0,r}return W0(e,t),e.test=function(t){return p6(t)},e.prototype.symbolize=function(t,e){if(this.isVisible()){var n=this.style;if(this.painter.isHitTesting()||0!==n.markerWidth&&0!==n.markerHeight&&(0!==n.polygonOpacity||0!==n.lineOpacity)){var i=this._getRenderContainerPoints();d1(i)&&(this._prepareContext(t),this.getPainter().isSpriting()||this.geometry.getLayer().getMask()===this.geometry||this._dynamic||!1===this.geometry.getLayer().options.cacheVectorOnCanvas?this._drawMarkers(t,i,e):this._drawMarkersWithCache(t,i,e))}}},e.prototype._drawMarkers=function(t,e,n){for(var i=e.length-1;i>=0;i--){var r=e[i],o=Q0(s6(Z6,this.style),2),s=o[0],a=o[1],h=void 0,l=this.getRotation()?this._rotate(t,r,this._getRotationAt(i)):null;if(l){var u=r.sub(l);r=l;var c=this._getRotationAt(i);(h=J8(Q6,c,s,a,r,X6))._add(u)}if(this._drawVectorMarker(t,r,n),l)t.restore(),this._setBBOX(t,h.xmin,h.ymin,h.xmax,h.ymax);else{var A=r.x,f=r.y;this._setBBOX(t,A,f,A+s,f+a)}}},e.prototype._drawMarkersWithCache=function(t,e,n){var i=this._stampSymbol(),r=n.getImage(i);r||(r=this._createMarkerImage(t,n),n.addResource([i,r.width,r.height],r));for(var o=o6(this.style,r.width,r.height),s=e.length-1;s>=0;s--){var a=e[s],h=this.getRotation()?this._rotate(t,a,this._getRotationAt(s)):null,l=void 0;if(h){var u=a.sub(h);a=h;var c=this._getRotationAt(s);(l=J8(Q6,c,r.width,r.height,a,o))._add(u)}var A=a.x+o.x,f=a.y+o.y;j3.image(t,r,A,f),h?(t.restore(),this._setBBOX(t,l.xmin,l.ymin,l.xmax,l.ymax)):this._setBBOX(t,A,f,A+r.width,f+r.height)}},e.prototype._createMarkerImage=function(t,e){var n=t.canvas.constructor,i=s6(Z6,this.style),r=j3.createCanvas(i[0],i[1],n),o=this._getCacheImageAnchor(i[0],i[1]),s=r.getContext("2d");return this._drawVectorMarker(s,o,e),r},e.prototype._stampSymbol=function(){return this._stamp||(this._stamp=n2([this.style.markerType,C5(this.style.markerFill)?P5(this.style.markerFill):this.style.markerFill,this.style.markerFillOpacity,this.style.markerFillPatternFile,C5(this.style.markerLineColor)?P5(this.style.markerLineColor):this.style.markerLineColor,this.style.markerLineWidth,this.style.markerLineOpacity,this.style.markerLineDasharray?this.style.markerLineDasharray.join(","):"",this.style.markerLinePatternFile,this.style.markerWidth,this.style.markerHeight,this.style.markerHorizontalAlignment,this.style.markerVerticalAlignment].join("_"))),this._stamp},e.prototype._getCacheImageAnchor=function(t,e){var n=2*(this.symbol.shadowBlur||0)+this.padding,i=this.style.markerType;return"bar"===i||"pie"===i||"pin"===i?new $0(t/2,e-n):"rectangle"===i?new $0(n,n):new $0(t/2,e/2)},e.prototype._getGraidentExtent=function(t){var e=new Y4,n=this.getDxDy(),i=this.getFixedExtent();if(Array.isArray(t))for(var r=t.length-1;r>=0;r--)e._combine(t[r]);else e._combine(t);return e.xmin+=i.xmin-n.x,e.ymin+=i.ymin-n.y,e.xmax+=i.xmax-n.x,e.ymax+=i.ymax-n.y,e},e.prototype._drawVectorMarker=function(t,e,n){I6(t,e,this.style,n)},e.prototype.getFixedExtent=function(){var t=this.isDynamicSize(),e=this.style.markerWidth,n=this.style.markerHeight;return this._fixedExtent=this._fixedExtent||new Y4,e6(this._fixedExtent,this.style,t?[128,128*(0===e?1:n/e)]:null)},e.prototype.translate=function(){var t=this.symbol,e={markerType:l1(t.markerType,"ellipse"),markerFill:l1(t.markerFill,"#00f"),markerFillOpacity:l1(t.markerFillOpacity,1),markerFillPatternFile:l1(t.markerFillPatternFile,null),markerLineColor:l1(t.markerLineColor,"#000"),markerLineWidth:l1(t.markerLineWidth,X8.markerLineWidth),markerLineOpacity:l1(t.markerLineOpacity,1),markerLineDasharray:l1(t.markerLineDasharray,[]),markerLinePatternFile:l1(t.markerLinePatternFile,null),markerDx:l1(t.markerDx,0),markerDy:l1(t.markerDy,0),markerWidth:l1(t.markerWidth,X8.markerWidth),markerHeight:l1(t.markerHeight,X8.markerHeight),markerRotation:l1(t.markerRotation,0),shadowBlur:l1(t.shadowBlur,0),shadowOffsetX:l1(t.shadowOffsetX,0),shadowOffsetY:l1(t.shadowOffsetY,0)},n=e.markerType,i=n6(n),r=i6(n);return e.markerHorizontalAlignment=l1(t.markerHorizontalAlignment,i),e.markerVerticalAlignment=l1(t.markerVerticalAlignment,r),i0(t.markerOpacity)&&(i0(t.markerFillOpacity)&&(e.markerFillOpacity*=t.markerOpacity),i0(t.markerLineOpacity)&&(e.markerLineOpacity*=t.markerOpacity)),e},e}(N6),J6=function(t){function e(e,n,i){var r=this;n0(e.markerWidth)&&(e.markerWidth=80),n0(e.markerHeight)&&(e.markerHeight=80),e=e0({},e,(r=t.call(this,e,n,i)||this).translate());var o=r.style=r._defineStyle(e);return r._url=G0.gecko?[_5(o,o.markerWidth,o.markerHeight),o.markerWidth,o.markerHeight]:[_5(o),o.markerWidth,o.markerHeight],r}return W0(e,t),e.test=function(t){return g6(t)},e.prototype._prepareContext=function(){},e.prototype._getImage=function(t){var e=this;if(t&&t.isResourceLoaded(this._url))return t.getImage(this._url);var n=this.painter,i=new Image;return i.onload=function(){var t=n.getLayer()&&n.getLayer().getRenderer();t&&t.setToRedraw()},i.onerror=function(n){n&&"undefined"!=typeof console&&console.warn(n),t.markErrorResource(e._url)},i.src=this._url[0],t&&t.addResource(this._url,i),i},e}(j6),K6={lineWidth:1,polygonFill:"#fff",polygonOpacity:.5},$6=[function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.style=n.getLayer().options.drawAltitude,r.style&&o0(r.style)||(r.style={lineWidth:2}),r.style.lineWidth||(r.style.lineWidth=0),r.dxdy=r._defineStyle({dx:e.textDx||e.markerDx,dy:e.textDy||e.markerDy}),r}return W0(e,t),e.test=function(t,e){if(!e.getLayer())return!1;var n=e.getJSONType();return"Marker"===n||"LineString"===n},e.prototype.symbolize=function(t){if(this.geometry.getLayer().options.drawAltitude&&this.geometry.hasAltitude()){var e=this._getStyle();if(this._prepareContext(t),"LineString"===this.geometry.type){var n=this._getPaintParams(e.lineDx,e.lineDy);if(!n)return;var i=this.getPainter().getPaintParams(e.lineDx,e.lineDy,!0,!0,"_groundpt")[0];this._drawLineAltitude(t,n[0],i)}else{var r=this._getRenderContainerPoints(),o=this._getRenderContainerPoints(!0);if(!r||0===r.length)return;this._drawMarkerAltitude(t,r[0],o[0])}}},e.prototype.getDxDy=function(){var t=this.dxdy;return new $0(t.dx||0,t.dy||0)},e.prototype.get2DExtent=function(){return"LineString"===this.geometry.type?V6.prototype.get2DExtent.apply(this):t.prototype.get2DExtent.call(this)},e.prototype.getPlacement=function(){return"point"},e.prototype._getPaintParams=function(t,e){return this.getPainter().getPaintParams(t||0,e||0,null,!0,"_altpt")},e.prototype._drawMarkerAltitude=function(t,e,n){var i=this._getStyle();this.prepareCanvas(t,i),j3.path(t,[e,n],i.lineOpacity,null,i.lineDasharray)},e.prototype._drawLineAltitude=function(t,e,n){var i=this._getStyle();if(e.length>0&&Array.isArray(e[0]))for(var r=0;r<e.length;r++)this._drawLine(t,e[r],n[r]);else this._drawLine(t,e,n);t.setLineDash&&Array.isArray(i.lineDasharray)&&t.setLineDash([])},e.prototype._drawLine=function(t,e,n){var i=this._getStyle();this.prepareCanvas(t,i);for(var r=0,o=e.length-1;r<o;r++)j3.polygon(t,[e[r],e[r+1],n[r+1],n[r]],i.lineOpacity,i.polygonOpacity,i.lineDasharray)},e.prototype._getStyle=function(){var t=this.geometry.getLayer(),e=t.options.drawAltitude;if(Array.isArray(e)){var n=(t.getGeometries()||[]).indexOf(this.geometry);n>=0&&(e=e[n]||K6)}return o0(e)||(e=K6),e.lineWidth||(e.lineWidth=0,e.lineOpacity=0),e},e}(N6),V6,j6,J6,Y6,q6],t9=new $0(0,0),e9=new Y4,n9=new Y4,i9=new Y4,r9=new Y4,o9=new Y4,s9={code:void 0},a9={minx:1/0,miny:1/0,maxx:-1/0,maxy:-1/0},h9=function(t){function e(e){var n=t.call(this)||this;return n.geometry=e,n.symbolizers=n._createSymbolizers(),n._altAtGL=n._getGeometryAltitude(),n.bbox=Y5(),n._drawTime=0,n}return W0(e,t),e.prototype._setDrawTime=function(t){return this._drawTime=t,this},e.prototype.getRenderBBOX=function(){var t=this.getLayer();if(t&&t._drawTime!==this._drawTime)return null;K5(this.bbox);for(var e=this.symbolizers.length-1;e>=0;e--){var n=this.symbolizers[e].bbox;e3(n)&&t3(this.bbox,n)}return e3(this.bbox)?this.bbox:null},e.prototype.getMap=function(){return this.geometry.getMap()},e.prototype.getLayer=function(){return this.geometry&&this.geometry.getLayer()},e.prototype._createSymbolizers=function(){var t=this.getSymbol(),e=[],n=$6,i=t;Array.isArray(t)||(i=[t]);for(var r=i.length-1;r>=0;r--)for(var o=i[r],s=n.length-1;s>=0;s--)if(n[s].test(o,this.geometry)){var a=new n[s](o,this.geometry,this);a._index=r,e.push(a),a instanceof N6&&(this._hasPoint=!0)}if(!e.length&&console){var h=this.geometry.getId();console.warn("invalid symbol for geometry("+(this.geometry?this.geometry.getType()+(h?":"+h:""):"")+") to draw : "+JSON.stringify(t))}return this._debugSymbolizer=new z6(t,this.geometry,this),e},e.prototype.hasPoint=function(){return!!this._hasPoint},e.prototype.getRenderPoints=function(t){return this._verifyProjection(),this._renderPoints||(this._renderPoints={}),t||(t="center"),this._renderPoints[t]||(this._renderPoints[t]=this.geometry._getRenderPoints(t)),this._renderPoints[t]},e.prototype.getPaintParams=function(t,e,n,i,r){void 0===r&&(r="_pt");var o,s,a,h,l,u=this.getLayer()._getRenderer().mapStateCache,c=this.getMap();u&&!this._hitPoint?(o=u.resolution,s=u.pitch,a=u.bearing,h=u.glScale,l=u.containerExtent):(o=c.getResolution(),s=c.getPitch(),a=c.getBearing(),h=c.getGLScale(),l=c.getContainerExtent());var A=this.geometry,f=o,d=0!==s,p=0!==a,g=this._cachedParams,m=A._paintAsPath&&A._paintAsPath();if(m&&this._unsimpledParams&&f<=this._unsimpledParams._res)g=this._unsimpledParams;else if(!g||g._res!==o||this._pitched!==d&&A._redrawWhenPitch()||this._rotated!==p&&A._redrawWhenRotate()){if(!(g=A._getPaintParams()))return null;g._res=f,!A._simplified&&m&&(this._unsimpledParams||(this._unsimpledParams=g),f>this._unsimpledParams._res&&(this._unsimpledParams._res=f)),this._cachedParams=g}if(!g)return null;this._pitched=d,this._rotated=p;var y=h,v=[],_=this._pointContainerPoints(g[0],t,e,n,i||this._hitPoint&&!l.contains(this._hitPoint),null,r);if(!_)return null;v.push(_);for(var x=1,b=g.length;x<b;x++)i0(g[x])||g[x]instanceof z1?i0(g[x])?v.push(g[x]/y):v.push(g[x].multi(1/y)):v.push(g[x]);return v},e.prototype._pointContainerPoints=function(t,e,n,i,r,o,s){if(void 0===s&&(s="_pt"),this._aboveCamera())return null;var a,h,l,u=this.getLayer()._getRenderer(),c=u.mapStateCache,A=this.getMap(),f=this.geometry,d=this.containerOffset;c?(a=c.glRes,h=c.containerExtent):(a=A.getGLRes(),h=A.getContainerExtent());var p=this.getLayer().options.roundPoint,g=1/0,m=1/0,y=-1/0,v=-1/0,_=!r,x=u.layer.options.clipBBoxBufferSize||3,b=this.symbolizers,w=f.options.enableClip;function C(t,i){void 0===t&&(t=[]),void 0===i&&(i=[]);for(var r=P1(t,s),o=0,l=(r=A._pointsAtResToContainerPoints(t,a,i,r)).length;o<l;o++){var u=r[o];u._sub(d),(e||n)&&u._add(e||0,n||0),p&&(u.x=Math.ceil(u.x),u.y=Math.ceil(u.y)),g=Math.min(u.x,g),m=Math.min(u.y,m),y=Math.max(u.x,y),v=Math.max(u.y,v)}if(w&&_&&function(t){void 0===t&&(t=[]),Array.isArray(t)||(t=[t]);for(var e=t.length,n=0;n<e;n++){var i=t[n];if(i.style){var r=i.style,o=r.lineDasharray,s=r.lineWidth;if(s&&i0(s)&&s>0&&o&&Array.isArray(o)&&o.length)return!0}}return!1}(b)){if(o9.ymin=h.ymin,o9.ymin<x&&(o9.ymin=h.ymin-x),o9.xmin=h.xmin-x,o9.xmax=h.xmax+x,o9.ymax=h.ymax+x,f.getShell&&f.getHoles)return w6(r,o9);var c=x6(r,o9,!1);if(c.length){var C=[];return c.forEach((function(t){for(var e=0,n=t.length;e<n;e++)C.push(t[e].point)})),C}}return r}var P=this.getAltitude();if(Array.isArray(t)){var M=void 0;!r&&this.geometry.options.enableClip?(M=this._clip(t,P)).inView&&(_=!1):M={points:t,altitude:P};var T=M.points;P=M.altitude,i&&(P=0);var S=P;l=[];for(var I=[],E=i0(P),O=0,R=T.length;O<R;O++){var D=T[O];if(Array.isArray(D)){if(E){var k=C(D,P);l.push(k);continue}for(var L=[],F=0,N=D.length;F<N;F++)Array.isArray(P)&&(S=P[O]?P[O][F]:0),L.push(S);var z=C(D,L);l.push(z)}else Array.isArray(P)&&(S="vertex-last"===o?P[P.length-1-O]:"line"===o?(P[O]+P[O+1])/2:P[O]),I.push(S)}I.length&&(l=C(T,I))}else t instanceof $0&&(i&&(P=0),l=A._pointAtResToContainerPoint(t,a,P)._sub(d),(e||n)&&l._add(e,n));return a9.minx=g,a9.miny=m,a9.maxx=y,a9.maxy=v,this._containerBbox=a9,l},e.prototype._clip=function(t,e){if(i0(e)&&0!==e)return{points:t,altitude:e};if(Array.isArray(e)){for(var n=!1,i=0,r=e.length;i<r;i++)if(0!==e[i]){n=!0;break}if(n)return{points:t,altitude:e}}var o=this.getMap(),s=this.geometry,a=this.getSymbol().lineWidth;i0(a)||(a=4);var h,l,u,c=this.getLayer()._getRenderer().mapStateCache;c?(h=c._2DExtent,l=c.glExtent,u=c.pitch):(h=o.get2DExtent(),l=o.get2DExtentAtRes(o.getGLRes()),u=o.getPitch());var A=h._expand(a);if(u>0&&e){var f=o.cameraLookAt,d=o.cameraPosition;t9.set(d[0],d[1]),A=A._combine(t9._add(u1(f[0]-d[0]),u1(f[1]-d[1])))}var p=t;if(this.get2DExtent(null,r9).within(A))return{points:p,altitude:e,inView:!0};var g=l._expand(a*o.getGLScale());i9.xmin=g.xmin,i9.xmax=g.xmax,i9.ymin=g.ymin,i9.ymax=g.ymax;var m=s.options.smoothness;if(s.getShell&&this.geometry.getHoles&&!m){var y=g.ymin,v=g.ymax,_=Math.abs(g.xmax-g.xmin),x=Math.abs(v-y),b=Math.sqrt(_*_+x*x),w=(b-_)/2,C=(b-x)/2;if(i9.xmin=g.xmin-w,i9.xmax=g.xmax+w,i9.ymin=g.ymin-C,i9.ymax=g.ymax+C,Array.isArray(t[0]))for(p=[],i=0;i<t.length;i++){var P=w6(t[i],i9);P.length&&p.push(P)}else p=w6(t,i9)}else if("LineString"===s.getJSONType()&&!m){if(Array.isArray(t[0]))for(p=[],i=0;i<t.length;i++)s1(p,x6(t[i],i9,!1,!!m));else p=x6(t,i9,!1,!!m);return this._interpolateSegAlt(p,t,e)}return{points:p,altitude:e}},e.prototype._interpolateSegAlt=function(t,e,n){if(!Array.isArray(n)){var i=function(t){return t.point};return{points:t.map((function(t){return Array.isArray(t)?t.map(i):t.point})),altitude:n}}var r=l9(t,e,n);return n=[],{points:r.map((function(t){if(Array.isArray(t)){var e=[],i=t.map((function(t){return e.push(t.altitude),t.point}));return n.push(e),i}return n.push(t.altitude),t.point})),altitude:n}},e.prototype.getSymbol=function(){return this.geometry._getInternalSymbol()},e.prototype._resetSymbolizersBBOX=function(){for(var t=this.symbolizers.length-1;t>=0;t--)K5(this.symbolizers[t].bbox);return this},e.prototype.paint=function(t,e,n){var i;if(this.symbolizers){var r=this.getLayer(),o=r._getRenderer();if(o&&(o.context||e)){var s=o.mapStateCache||{offset:void 0};if(this.geometry._isCheck||!t||t.intersects(this.get2DExtent(o.resources,e9))){var a=this.getMap();if(!this._aboveCamera()){this.containerOffset=n||s.offset||a._pointToContainerPoint(o.middleWest)._add(0,-a.height/2),this._beforePaint();var h=e||o.context;h.isHitTesting||this._resetSymbolizersBBOX();for(var l=[h,o.resources],u=this.symbolizers.length-1;u>=0;u--)(h.shadowBlur||this.symbolizers[u].symbol.shadowBlur)&&this._prepareShadow(h,this.symbolizers[u].symbol),(i=this.symbolizers[u]).symbolize.apply(i,X0([],Q0(l),!1));this._afterPaint(),this._painted=!0,(this.geometry.options.debug||r.options.debug)&&this._debugSymbolizer.symbolize(h)}}}}},e.prototype.getSprite=function(t,e){var n;if(!this.geometry.isPoint)return null;if(this._spriting=!0,!this._sprite&&this.symbolizers.length>0){var i=new Y4;this.symbolizers.forEach((function(e){var n=e.getFixedExtent(t);i._combine(n)}));var r=i.getMin().multi(-1),o=e||(this.getMap()?this.getMap().CanvasClass:null),s=j3.createCanvas(i.getWidth(),i.getHeight(),o),a=void 0;this._renderPoints&&(a=this._renderPoints);for(var h=s.getContext("2d"),l=[h,t],u=this.symbolizers.length-1;u>=0;u--){var c=this.symbolizers[u].getDxDy();this._renderPoints={center:[[r.add(c)]]},this._prepareShadow(h,this.symbolizers[u].symbol),(n=this.symbolizers[u]).symbolize.apply(n,X0([],Q0(l),!1))}a&&(this._renderPoints=a),this._sprite={canvas:s,offset:i.getCenter()}}return this._spriting=!1,this._sprite},e.prototype.isSpriting=function(){return!!this._spriting},e.prototype.hitTest=function(t,e){if((!e||e<.5)&&(e=.5),this._hitPoint=t.sub(e,e),!R6){var n=this.getMap()?this.getMap().CanvasClass:null;R6=j3.createCanvas(1,1,n)}j3.setHitTesting(!0),R6.width=R6.height=2*e;var i=j3.getCanvas2DContext(R6);i.isHitTesting=!0;try{this.paint(null,i,this._hitPoint)}finally{j3.setHitTesting(!1)}delete this._hitPoint;for(var r=i.getImageData(0,0,R6.width,R6.height).data,o=3,s=r.length;o<s;o+=4)if(r[o]>0)return!0;return!1},e.prototype.isHitTesting=function(){return!!this._hitPoint},e.prototype._prepareShadow=function(t,e){e.shadowBlur?(t.shadowBlur=this.isHitTesting()?0:e.shadowBlur,t.shadowColor=e.shadowColor||"#000",t.shadowOffsetX=e.shadowOffsetX||0,t.shadowOffsetY=e.shadowOffsetY||0):t.shadowBlur&&(t.shadowBlur=null,t.shadowColor=null,t.shadowOffsetX=null,t.shadowOffsetY=null)},e.prototype._eachSymbolizer=function(t,e){if(this.symbolizers){e||(e=this);for(var n=this.symbolizers.length-1;n>=0;n--)t.apply(e,[this.symbolizers[n]])}},e.prototype.get2DExtent=function(t,e){this._verifyProjection();var n=this.getMap();t=t||this.getLayer()._getRenderer().resources;var i=n.getZoom(),r=this._isDynamicSize();if(this._extent2D&&this._extent2D._zoom===i&&this._fixedExtent||(this._extent2D&&this._extent2D._zoom!==i&&delete this._extent2D,this.symbolizers&&(this._extent2D||(this._extent2D=this._computeExtent2D(new Y4),this._extent2D._zoom=i),this._fixedExtent||(this._fixedExtent=this._computeFixedExtent(t,new Y4)))),!this._extent2D)return r&&delete this._fixedExtent,null;var o=this._fixedExtent,s=o.xmin,a=o.ymin,h=o.xmax,l=o.ymax;return r&&delete this._fixedExtent,n9.set(s,-l,h,-a),e?(e.set(this._extent2D.xmin,this._extent2D.ymin,this._extent2D.xmax,this._extent2D.ymax),e._add(n9),e):this._extent2D.add(n9)},e.prototype._computeExtent2D=function(t){for(var e=this.symbolizers.length-1;e>=0;e--)t._combine(this.symbolizers[e].get2DExtent());return t},e.prototype._computeFixedExtent=function(t,e){for(var n=this.symbolizers.length-1;n>=0;n--){var i=this.symbolizers[n];i.getFixedExtent&&e._combine(i.getFixedExtent(t))}return e},e.prototype._isDynamicSize=function(){for(var t=this.symbolizers.length-1;t>=0;t--)if(this.symbolizers[t].isDynamicSize())return!0;return!1},e.prototype._aboveCamera=function(){var t=this.getMinAltitude(),e=this.getMap(),n=e.getGLRes();t=e.altitudeToPoint(t,n)*u1(t);var i=e.getFrustumAltitude();return t&&i&&i<t},e.prototype.getFixedExtent=function(){var t=this.getMap().getZoom();return this._isDynamicSize()?this._computeFixedExtent(null,new Y4):(this._extent2D&&this._extent2D._zoom===t||this.get2DExtent(null,n9),this._fixedExtent)},e.prototype.setZIndex=function(t){this._eachSymbolizer((function(e){e.setZIndex(t)}))},e.prototype.show=function(){this._painted?(this.removeCache(),this._eachSymbolizer((function(t){t.show()}))):this.getLayer().isCanvasRender()||this.paint()},e.prototype.hide=function(){this._eachSymbolizer((function(t){t.hide()}))},e.prototype.repaint=function(){this._altAtGL=this._getGeometryAltitude(),this.removeCache();var t=this.getLayer();if(t){var e=t.getRenderer();e&&e.setToRedraw()&&e.setToRedraw()}},e.prototype.refreshSymbol=function(){this.removeCache(),this._removeSymbolizers(),this.symbolizers=this._createSymbolizers()},e.prototype.remove=function(){this.removeCache(),this._removeSymbolizers()},e.prototype._removeSymbolizers=function(){this._eachSymbolizer((function(t){delete t.painter,t.remove()})),delete this.symbolizers},e.prototype.removeCache=function(){delete this._renderPoints,delete this._paintParams,delete this._sprite,delete this._extent2D,delete this._fixedExtent,delete this._cachedParams,delete this._unsimpledParams},e.prototype.getAltitude=function(){return this.geometry._getAltitude()!==this._propAlt&&(this._altAtGL=this._getGeometryAltitude()),this._altAtGL?this._altAtGL:0},e.prototype.getMinAltitude=function(){return this.minAltitude?this.minAltitude:0},e.prototype.getMaxAltitude=function(){return this.maxAltitude?this.maxAltitude:0},e.prototype._getGeometryAltitude=function(){if(!this.getMap())return 0;var t=this.geometry._getAltitude();this._propAlt=t;var e=Q0(T6(t),2),n=e[1];return this.minAltitude=e[0],this.maxAltitude=n,t&&this.geometry.getCenter()?t:0},e.prototype._verifyProjection=function(){var t=this.geometry._getProjection()||s9;this._projCode&&this._projCode!==t.code&&this.removeCache(),this._projCode=t.code},e.prototype._beforePaint=function(){},e.prototype._afterPaint=function(){},e}(Y3);function l9(t,e,n){if(!Array.isArray(n))return t;for(var i=[],r=0,o=t.length;r<o;r++)if(Array.isArray(t[r]))i.push(l9(t[r],e,n));else{var s=t[r];if(s.point.equals(e[s.index]))s.altitude=n[s.index],i.push(s);else{var a=void 0,h=void 0;0===s.index?(a=s.index,h=s.index+1):(a=s.index-1,h=s.index);var l=s.point.distanceTo(e[h]),u=l/(l+e[a].distanceTo(s.point)),c=c1(n[a],n[h],1-u);s.altitude=c,i.push(s)}}return i}var u9=new Y4,c9=function(t){function e(e,n){var i=t.call(this)||this;return i.geometry=e,i.isMask=n,i.bbox=Y5(),i._drawTime=0,i}return W0(e,t),e.prototype._setDrawTime=function(t){return this._drawTime=t,this._eachPainter((function(e){e._setDrawTime(t)})),this},e.prototype.getRenderBBOX=function(){var t=this,e=this.getLayer();return e&&e._drawTime!==this._drawTime?null:(K5(this.bbox),this._eachPainter((function(e){var n=e.getRenderBBOX();e3(n)&&t3(t.bbox,n)})),e3(this.bbox)?this.bbox:null)},e.prototype._eachPainter=function(t){for(var e,n=this.geometry.getGeometries(),i=0,r=n.length;i<r&&(!(e=this.isMask?n[i]._getMaskPainter():n[i]._getPainter())||!e||!1!==t.call(this,e));i++);},e.prototype.getLayer=function(){return this.geometry&&this.geometry.getLayer()},e.prototype.paint=function(t){this.geometry&&this._eachPainter((function(e){e.paint(t)}))},e.prototype.get2DExtent=function(t,e){e&&e.set(null,null,null,null);var n=e||new Y4;return this._eachPainter((function(e){n=n._combine(e.get2DExtent(t,u9))})),n},e.prototype.remove=function(){this._eachPainter((function(t){t.remove()}))},e.prototype.setZIndex=function(t){this._eachPainter((function(e){e.setZIndex(t)}))},e.prototype.show=function(){this._eachPainter((function(t){t.show()}))},e.prototype.hide=function(){this._eachPainter((function(t){t.hide()}))},e.prototype.repaint=function(){this._eachPainter((function(t){t.repaint()}))},e.prototype.refreshSymbol=function(){this._eachPainter((function(t){t.refreshSymbol()}))},e.prototype.hasPoint=function(){var t=!1;return this._eachPainter((function(e){return!e.hasPoint()||(t=!0,!1)})),t},e.prototype.getMinAltitude=function(){var t=!0,e=0;return this._eachPainter((function(n){var i=n.getMinAltitude();(t||i<e)&&(t=!1,e=i)})),e},e.prototype.getMaxAltitude=function(){var t=0;return this._eachPainter((function(e){var n=e.getMaxAltitude();n>t&&(t=n)})),t},e}(Y3);function A9(t,e){return void 0===e&&(e=[]),e.forEach((function(e){var n=Q0(e,2);t=t.replace(n[0],n[1])})),t}function f9(t){var e=t.projection,n=t.isArcgis,i=t.isGeoServer,r=t.isSuperMap,o=.0002645833333333333;return(n||i||r)&&(o=28e-5),e&&e.indexOf("4326")>-1&&(o=2.3767925226029154e-9,(n||r)&&(o=2.518101729011901e-9),i&&(o=2.51528279553466e-9)),o}var d9="wmts";function p9(t,e){var n=t.getElementsByTagName(e);return n&&n.length?n:t.getElementsByTagName(d9+":"+e)}function g9(t,e){for(var n=0;n<t.length;n++){var i=t[n];if((i=i.getElementsByTagName("ows:Identifier")[0])&&i.textContent===e)return t[n]}return null}function m9(t,e){void 0===e&&(e={});var n,i,r,o,s=p9(t,"TileMatrix"),a=[],h=[],l=[],u=!1;if(!n){var c=t.getElementsByTagName("ows:SupportedCRS")[0];c&&(n=function(t){for(var e="",n=t.split(""),i=n.length-1;i>=0&&!isNaN(n[i]);i--)e=n[i]+e;return e}(n=(n=c.textContent).split("EPSG")[1]),n=A9((o=n).indexOf("EPSG")>-1?o:"EPSG:"+o,[["4490","4326"],["102100","3857"],["900913","3857"]]))}i||(i=t.getElementsByTagName("ows:Identifier")[0])&&(i=i.textContent),e.projection=n;for(var A=1/0,f=0;f<s.length;f++){var d=s[f],p=d.getElementsByTagName("ows:Identifier")[0].textContent;isNaN(parseInt(p))?(r=p.substr(0,p.lastIndexOf(":")),p=(p=p.split(":"))[p.length-1],p=parseInt(p),u=!0,e.isGeoServer=!0):p=parseInt(p),A=Math.min(A,p);var g=p9(d,"ScaleDenominator")[0].textContent,m=p9(d,"TopLeftCorner")[0].textContent,y=p9(d,"TileWidth")[0].textContent,v=p9(d,"TileHeight")[0].textContent;if(0===l.length&&l.push(parseInt(y),parseInt(v)),0===h.length){var _=Q0(m.split(" ").filter((function(t){return""!==t})).map((function(t){return parseFloat(t)})),2),x=_[0],b=_[1];x>0?h.push(1,-1,b,x):h.push(1,-1,x,b)}var w=f9(e),C=parseFloat(g)*w;a.push(C)}if(A>0){C=a[0];for(var P=A-1;P>=0;P--)a.splice(0,0,C*=2)}return{resolutions:a,tileSize:l,tileSystem:h,projection:n,TileMatrixSet:i,isGeoServer:u,levelStr:r}}var y9=function(t,e,n){void 0===n&&(n={jsonp:!0}),s0(t)&&I2.get(t,(function(i,r){if(i)e(i);else{var o=function(t,e,n){["isArcgis","isSuperMap","isGeoServer"].every((function(t){return null==n[t]}))&&console.warn("Please specify the server type, such as isArcgis, isSuperMap, isGeoServer, Otherwise, the system will determine by itself"),null==n.isArcgis&&(n.isArcgis=["arcgis","geoscene"].some((function(e){return t.indexOf(e)>-1}))),null==n.isSuperMap&&(n.isSuperMap=t.indexOf("supermap")>-1);var i=(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("Contents")[0];if(!i)return[];var r=p9(i,"Layer");if(!r.length)return[];for(var o=[],s=0,a=i.childNodes.length;s<a;s++)"TileMatrixSet"===i.childNodes[s].localName&&o.push(i.childNodes[s]);if(!o.length)return[];var h=[];for(s=0,a=r.length;s<a;s++){var l=r[s],u=l.querySelectorAll("Style")[0];u&&(u=u.getElementsByTagName("ows:Identifier")[0])&&(u=u.textContent);var c=l.getElementsByTagName("ows:Identifier")[0];c&&(c=c.textContent);var A=p9(l,"TileMatrixSetLink");if(0!==A.length)for(var f=0,d=A.length;f<d;f++){var p=A[f];(p=p9(p,"TileMatrixSet")[0])&&(p=p.textContent);var g=g9(o,p);if(g){var m=l.querySelectorAll("ResourceURL")[0],y="";m&&(y=m.attributes.template.value);var v=m9(g,n),_=v.resolutions,x=v.tileSize,b=v.tileSystem,w=v.projection,C=v.TileMatrixSet,P=v.isGeoServer,M=v.levelStr;y.length||(y=e.substr(0,e.lastIndexOf("?")),y+="?SERVICE=WMTS&REQUEST=GetTile&VERSION=1.0.0&LAYER={LAYER}&STYLE={Style}&TILEMATRIXSET={TileMatrixSet}&FORMAT={tiles}&TILEMATRIX={TileMatrix}&TILEROW={TileRow}&TILECOL={TileCol}");var T=A9(y,[["{LAYER}",c],["{Layer}",c],["{layer}",c],["{STYLE}",u],["{Style}",u],["{style}",u],["{TileMatrixSet}",C],["{TileMatrix}",P?"".concat(M,":{z}"):"{z}"],["{TileRow}","{y}"],["{TileCol}","{x}"],["{tiles}",P?"image/png":"tiles"]]);h.push({tileSize:x,tileSystem:b,spatialReference:{resolutions:_,projection:w},urlTemplate:T,info:{layerName:c,TileMatrixSet:C,style:u,tileSize:x,tileSystem:b,resolutions:_,projection:w,urlTemplate:T}})}}}return h}(r,t,n);e(null,o)}}),n)};function v9(t){for(var e=t.tileInfo,n=[e.cols,e.rows],i=[],r=e.lods,o=0,s=r.length;o<s;o++)i.push(r[o].resolution);var a=t.fullExtent,h=e.origin,l=[1,-1,h.x,h.y];return delete a.spatialReference,{spatialReference:{resolutions:i,fullExtent:a},tileSystem:l,tileSize:n}}var _9=23,x9={"EPSG:3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=12756274*Math.PI,n=0;n<_9;n++)t[n]=e/(256*Math.pow(2,n));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"EPSG:4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<_9;e++)t[e]=180/(128*Math.pow(2,e));return t}()},BAIDU:{projection:"baidu",resolutions:function(){for(var t=Math.pow(2,18),e=[],n=0;n<_9;n++)e[n]=t,t*=.5;return e}(),fullExtent:{top:33554432,left:-33554432,bottom:-33554432,right:33554432}},IDENTITY:{projection:"identity",resolutions:function(){for(var t=Math.pow(2,8),e=[],n=0;n<_9;n++)e[n]=t,t*=.5;return e}(),fullExtent:{top:2e5,left:-2e5,bottom:-2e5,right:2e5}},"PRESET-VT-3857":{projection:"EPSG:3857",resolutions:function(){for(var t=[],e=6378137*Math.PI,n=0;n<_9;n++)t[n]=e/(256*Math.pow(2,n));return t}(),fullExtent:{top:6378137*Math.PI,left:-6378137*Math.PI,bottom:-6378137*Math.PI,right:6378137*Math.PI}},"PRESET-VT-4326":{projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){for(var t=[],e=0;e<_9;e++)t[e]=45/(128*Math.pow(2,e));return t}()}};x9["EPSG:4490"]=x9["EPSG:4326"],x9["PRESET-3857-512"]=x9["PRESET-VT-3857"],x9["PRESET-4326-512"]=x9["PRESET-VT-4326"],x9["PRESET-4490-512"]=x9["PRESET-VT-4326"];var b9=function(){function t(t){void 0===t&&(t={}),this.options=t,this._initSpatialRef()}return t.registerPreset=function(t,e){t=t&&t.toUpperCase(),x9[t]&&console.warn("Spatial reference ".concat(t," already registered.")),x9[t]=e},t.getPreset=function(t){return x9[t.toUpperCase()]},t.getAllPresets=function(){return Object.keys(x9)},t.loadArcgis=function(t,e,n){return function(t,e,n){if(void 0===n&&(n={jsonp:!0}),s0(t)&&"{"!==t.substring(0,1))I2.getJSON(t,(function(t,n){if(t)e(t);else{var i=v9(n);e(null,i)}}),n);else{s0(t)&&(t=o1(t));var i=v9(t);e(null,i)}}(t,e,n),this},t.loadWMTS=function(t,e,n){return y9(t,e,n),this},t.getProjectionInstance=function(t){var e;if(!t)return null;if((e=s0(t)?{code:t}:t).project)return e.locate||(e=e0({},e),e0(e,h8("identity"===e.measure?"IDENTITY":"EPSG:4326"))),e;var n=(e.code+"").toLowerCase();for(var i in L8)if(l0(L8,i)){var r=L8[i].aliases||[],o=L8[i].code;o&&r.push(o);for(var s=0;s<r.length;s++){var a;if(r[s].toLowerCase()===n)return L8[i].create?((a=L8[i].create(t)).code=r[s],a):L8[i].code===r[s]?L8[i]:((a=e0({},L8[i])).code=r[s],a)}}return null},t.equals=function(t,e){if(s0(t)||s0(e))return t===e;if(!t&&!e)return!0;if(!t||!e)return!1;if(t.projection!==e.projection)return!1;var n=t.fullExtent,i=e.fullExtent;if(n&&!i||!n&&i)return!1;if(n&&i&&(n.top!==i.top||n.bottom!==i.bottom||n.left!==i.left||n.right!==i.right))return!1;var r=t.resolutions,o=e.resolutions;if(r&&o){if(r.length!==o.length)return!1;for(var s=0;s<r.length;s++)if(r[s]!==o[s])return!1}else if(r||o)return!1;return!0},t.prototype._initSpatialRef=function(){var e;if(!(e=this.options.projection?t.getProjectionInstance(this.options.projection):k8))throw new Error("must provide a valid projection in map's spatial reference.");(e=e0({},K4,e)).measureLength||e0(e,o8),this._projection=e;var n,i=this.options.resolutions;if(!i&&(e.code&&(n=x9[e.code.toUpperCase()])&&(i=n.resolutions,this.isEPSG="IDENTITY"!==e.code),!i))throw new Error("must provide valid resolutions in map's spatial reference.");if(this._resolutions=i,this._pyramid=!0,this._pyramid)for(var r=0;r<i.length;r++)if(i[r]&&i[r-1]&&Math.round(i[r-1]/i[r]*1e4)/1e4!=2){this._pyramid=!1;break}var o=this.options.fullExtent;if(!o&&(e.code&&(n=x9[e.code.toUpperCase()])&&(o=n.fullExtent),!o))throw new Error("must provide a valid fullExtent in map's spatial reference.");if(n0(o.left)?(this._fullExtent=new X4(o),o.left=o.xmin,o.right=o.xmax,o.top=o.ymax,o.bottom=o.ymin):this._fullExtent=new X4(new F4(o.left,o.top),new F4(o.right,o.bottom)),n0(o.top)||n0(o.bottom)||n0(o.left)||n0(o.right))throw new Error("must provide valid top/bottom/left/right in fullExtent.");e0(this._fullExtent,o),this._projection.fullExtent=o,this._transformation=new J4([o.right>=o.left?1:-1,o.top>=o.bottom?-1:1,0,0])},t.prototype.getResolutions=function(){return this._resolutions||[]},t.prototype.getResolution=function(t){var e=0|t;e<0?e=0:e>this._resolutions.length-1&&(e=this._resolutions.length-1);var n=this._resolutions[e];return e!==t&&t>0&&e<this._resolutions.length-1?n+(this._resolutions[e+1]-n)*(t-e):n},t.prototype.getProjection=function(){return this._projection},t.prototype.getFullExtent=function(){return this._fullExtent},t.prototype.getTransformation=function(){return this._transformation},t.prototype.getMinZoom=function(){for(var t=0;t<this._resolutions.length;t++)if(!n0(this._resolutions[t]))return t;return 0},t.prototype.getMaxZoom=function(){for(var t=this._resolutions.length-1;t>=0;t--)if(!n0(this._resolutions[t]))return t;return this._resolutions.length-1},t.prototype.getZoomDirection=function(){return u1(this._resolutions[this.getMinZoom()]-this._resolutions[this.getMaxZoom()])},t.prototype.toJSON=function(){return this.json||(this.json={resolutions:this._resolutions,fullExtent:{top:this._fullExtent.top,left:this._fullExtent.left,bottom:this._fullExtent.bottom,right:this._fullExtent.right},projection:this._projection.code}),this.json},t.prototype.isPyramid=function(){return this._pyramid},t}(),w9=new $0(0,0),C9=new Y4,P9={},M9=function(t){function e(e){var n=this,i=e0({},e),r=i.symbol,o=i.properties,s=i.id;return delete i.symbol,delete i.id,delete i.properties,n=t.call(this,i)||this,r?n.setSymbol(r):n._genSizeSymbol(),o&&n.setProperties(o),n0(s)||n.setId(s),e&&i0(e.rotateAngle)&&(n._dirtyRotate=!0),n}return W0(e,t),e.fromJSON=function(t){return t},e.prototype.getFirstCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[0].getFirstCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[0]}while(Array.isArray(e)&&e.length>0);return e},e.prototype.getLastCoordinate=function(){if("GeometryCollection"===this.type){var t=this.getGeometries();return t.length?t[t.length-1].getLastCoordinate():null}var e=this.getCoordinates();if(!Array.isArray(e))return e;do{e=e[e.length-1]}while(Array.isArray(e)&&e.length>0);return e},e.prototype.addTo=function(t,e){return t.addGeometry(this,e),this},e.prototype.getLayer=function(){return this._layer?this._layer:null},e.prototype.getMap=function(){return this._layer?this._layer.getMap():null},e.prototype.getId=function(){return this._id},e.prototype.setId=function(t){var e=this.getId();return this._id=t,this._fireEvent("idchange",{old:e,new:t}),this},e.prototype.getProperties=function(){return this.properties?this.properties:this._getParent()?this._getParent().getProperties():null},e.prototype.setProperties=function(t){var e=this.properties;return this.properties=o0(t)?e0({},t):t,this._clearAltitudeCache(),this._repaint(),this._fireEvent("propertieschange",{old:e,new:t}),this},e.prototype.getType=function(){return this.type},e.prototype.getSymbol=function(){var t=this._symbol;return t?Array.isArray(t)?S5(t):e0({},t):null},e.prototype.setSymbol=function(t){return this._symbolUpdated=t,this._symbol=this._prepareSymbol(t),this.onSymbolChanged(),delete this._compiledSymbol,delete this._symbolHash,this},e.prototype.getSymbolHash=function(){return this._symbolHash||(this._symbolHash=M5(this._symbolUpdated)),this._symbolHash},e.prototype.updateSymbol=function(t){if(!t)return this;var e=this._getSymbol();if(Array.isArray(e)){if(!Array.isArray(t))throw new Error("Parameter of updateSymbol is not an array.");for(var n=0;n<t.length;n++)f6(t[n])&&delete this._textDesc,e[n]&&t[n]&&(e[n]=S5(e[n],t[n]))}else{if(Array.isArray(t))throw new Error("Geometry's symbol is not an array to update.");f6(e)&&delete this._textDesc,e=S5(e||this._getInternalSymbol(),t)}return this._eventSymbolProperties=t,delete this._compiledSymbol,this.setSymbol(e)},e.prototype.getTextContent=function(){var t=this._getInternalSymbol();if(Array.isArray(t)){for(var e=[],n=!1,i=0;i<t.length;i++)e[i]=X1(t[i]&&t[i].textName,this.getProperties()),n0(e[i])||(n=!0);return n?e:null}return X1(t&&t.textName,this.getProperties())},e.prototype.getTextDesc=function(){if(!this._textDesc){var t=this.getTextContent(),e=this._sizeSymbol,n=Array.isArray(t);this._textDesc=Array.isArray(e)?e.map((function(e,i){return Y1(n?t[i]:"",e)})):Y1(t,e)}return this._textDesc},e.prototype.getCenter=function(){return this._computeCenter(this._getMeasurer())},e.prototype.getExtent=function(){var t=this._getPrjExtent(),e=this._getProjection();if(t&&e){var n=e.unproject(new F4(t.xmin,t.ymin)),i=e.unproject(new F4(t.xmax,t.ymax));return new X4(n,i,e)}return this._computeExtent(this._getMeasurer())},e.prototype.getContainerExtent=function(t){var e=this.get2DExtent();if(!e||!e.isValid())return null;var n=this.getMap(),i=n.getGLRes(),r=this.getMinAltitude(),o=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,r,w9)}),t),s=this.getMaxAltitude();if(s!==r){var a=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,s,w9)}),C9);o._combine(a)}var h,l=this.getLayer();if(l&&"LineString"===this.type&&s&&l.options.drawAltitude){var u=e.convertTo((function(t){return n._pointAtResToContainerPoint(t,i,0,w9)}),C9);o._combine(u)}if(o){var c=this._getFixedExtent();(h=c)&&h.xmax-h.xmin>0&&h.ymax-h.ymin>0&&o._add(c)}return this.options.smoothness&&o._expand(.15*o.getWidth()),o},e.prototype._getFixedExtent=function(){this._fixedExtent||(this._fixedExtent=new Y4);var t=this._sizeSymbol,e=(t&&t.lineWidth||1)/2;return this._fixedExtent.set(-e,-e,e,e),this._fixedExtent._add([t&&t.lineDx||0,0]),this._fixedExtent._add([0,t&&t.lineDy||0]),this._fixedExtent},e.prototype.get2DExtent=function(){var t=this.getMap();if(!t)return null;if(this._extent2d)return this._extent2d;var e=this._getPrjExtent();if(!e||!e.isValid())return null;var n=e.getMin(),i=e.getMax(),r=t.getGLRes();return t._prjToPointAtRes(n,r,n),t._prjToPointAtRes(i,r,i),this._extent2d=new Y4(n,i),this._extent2d.z=t.getZoom(),this._extent2d},e.prototype.getSize=function(){var t=this.getContainerExtent();return t?t.getSize():null},e.prototype.containsPoint=function(t,e){if(!this.getMap())throw new Error('The geometry is required to be added on a map to perform "containsPoint".');return t instanceof F4&&(t=this.getMap().coordToContainerPoint(t)),this._containsPoint(t,e)},e.prototype._containsPoint=function(t,e){var n=this._getPainter();return!!n&&(e=e||0,this._hitTestTolerance&&(e+=this._hitTestTolerance()),n.hitTest(t,e))},e.prototype.show=function(){if(this.options.visible=!0,this.getMap()){var t=this._getPainter();t&&t.show(),this._fireEvent("show")}return this},e.prototype.hide=function(){if(this.options.visible=!1,this.getMap()){this.onHide();var t=this._getPainter();t&&t.hide(),this._fireEvent("hide")}return this},e.prototype.isVisible=function(){if(!this.options.visible)return!1;var t=this._getInternalSymbol();if(!t)return!0;if(!this.symbolIsVisible())return!1;if(Array.isArray(t)){if(!t.length)return!0;for(var e=0,n=t.length;e<n;e++)if(n0(t[e].opacity)||t[e].opacity>0)return!0;return!1}return n0(t.opacity)||o0(t.opacity)||i0(t.opacity)&&t.opacity>0},e.prototype.symbolIsVisible=function(){var t=this._getCompiledSymbol();if(!t)return!0;Array.isArray(t)||(t=[t]);for(var e=0,n=t.length;e<n;e++){var i=t[e];if(i){var r=i.visible;if(!1!==r&&0!==r)return!0}}return!1},e.prototype.getZIndex=function(){return this.options.zIndex||0},e.prototype.setZIndex=function(t){var e=this.options.zIndex;return this.options.zIndex=t,this._fireEvent("zindexchange",{old:e,new:t}),this},e.prototype.setZIndexSilently=function(t){return this.options.zIndex=t,this},e.prototype.bringToFront=function(){var t=this.getLayer();if(!t||!t.getGeoMaxZIndex)return this;var e=t.getGeoMaxZIndex();return this.setZIndex(e+1),this},e.prototype.bringToBack=function(){var t=this.getLayer();if(!t||!t.getGeoMinZIndex)return this;var e=t.getGeoMinZIndex();return this.setZIndex(e-1),this},e.prototype.translate=function(t,e){if(n0(t))return this;var n=new F4(t,e);if(0===n.x&&0===n.y)return this;var i=this.getCoordinates();if(this._silence=!0,i)if(Array.isArray(i)){var r=h1(i,(function(t){return t.add(n)}));this.setCoordinates(r)}else this.setCoordinates(i.add(n));return this._silence=!1,this._fireEvent("positionchange"),this},e.prototype._translateRotatePivot=function(t){if(!this._pivot||!t)return this;if(this.options.rotatePivot){var e=this.getCoordinates();if(!e)return this;t instanceof F4||(t=new F4(t));var n=t.sub(e);if(0===n.x&&0===n.y)return this;this._pivot._add(n),this.options.rotatePivot=this._pivot.toArray()}return this},e.prototype.flash=function(t,e,n,i){return C1.call(this,t,e,n,i)},e.prototype.copy=function(){var t=this.toJSON(),n=e.fromJSON(t);return n.options.visible=!0,n},e.prototype.remove=function(){return this.getLayer()?(this._fireEvent("removestart"),this._unbind(),this._fireEvent("removeend"),this._fireEvent("remove"),this):this},e.prototype.toGeoJSONGeometry=function(){return this._exportGeoJSONGeometry()},e.prototype.toGeoJSON=function(t){t||(t={});var e={type:"Feature",geometry:null};if(n0(t.geometry)||t.geometry){var n=this._exportGeoJSONGeometry();e.geometry=n}var i,r=this.getId();return n0(r)||(e.id=r),(n0(t.properties)||t.properties)&&(i=this._exportProperties()),e.properties=i,e},e.prototype.toJSON=function(t){t||(t={});var e=this._toJSON(t);return e0(e,this._exportGraphicOptions(t)),e},e.prototype.getLength=function(){return this._computeGeodesicLength(this._getMeasurer())},e.prototype.getArea=function(){return this._computeGeodesicArea(this._getMeasurer())},e.prototype.rotate=function(t,e){if(!i0(t))return console.error("angle:".concat(t," is not number")),this;if(this._painter||(this._dirtyRotate=!0),"GeometryCollection"===this.type)return this.getGeometries().forEach((function(n){return n.rotate(t,e)})),this;e=e?new F4(e):this.getCenter(),this._angle=t,this._pivot=e;var n=this._getMeasurer(),i=this.getCoordinates();if(!Array.isArray(i)){if(e.x===i.x&&e.y===i.y||this.getShell)this.onPositionChanged();else{var r=n._rotate(i,e,t);this.setCoordinates(r)}return this.getShell&&(this.options.rotateAngle=t,this.options.rotatePivot=e.toArray()),this}return h1(i,(function(i){return n._rotate(i,e,t)})),this.setCoordinates(i),this},e.prototype._rotatePrjCoordinates=function(t){if(!t||0===this._angle||!this._pivot)return t;var e=this._getProjection();if(!e)return t;var n,i,r=0,o=Array.isArray(t),s=o?t:[t],a=[];if(this.getRotateOffsetAngle){r=this.getRotateOffsetAngle();var h=s[s.length-1];n=h.x,i=h.y}else{var l=Y5();$5(s,l);var u=Q0(l,4);n=(u[0]+u[2])/2,i=(u[1]+u[3])/2}for(var c=0,A=s.length;c<A;c++){var f=(P=s[c]).x,d=P.y,p=f-n,g=d-i,m=Math.sqrt(p*p+g*g),y=(R9(n,i,f,d)-this._angle+r)/180*Math.PI,v=Math.cos(y)*m,_=Math.sin(y)*m,x=new F4(n+v,i+_);a.push(x)}var b=e.project(this._pivot),w=n-b.x,C=i-b.y;for(c=0,A=a.length;c<A;c++){var P;(P=a[c]).x-=w,P.y-=C}return o?a:a[0]},e.prototype.isRotated=function(){return!(!i0(this._angle)||!this._pivot)},e.prototype._getConnectPoints=function(){return[this.getCenter()]},e.prototype._initOptions=function(t){var e=e0({},t),n=e.symbol,i=e.properties,r=e.id;delete e.symbol,delete e.id,delete e.properties,this.setOptions(e),n&&this.setSymbol(n),i&&this.setProperties(i),n0(r)||this.setId(r)},e.prototype._bindLayer=function(t){if(t!==this.getLayer()){if(this.getLayer())throw new Error("Geometry cannot be added to two or more layers at the same time.");this._layer=t,this._clearCache(),this._bindInfoWindow(),this._bindMenu()}},e.prototype._prepareSymbol=function(t){if(Array.isArray(t)){for(var e=[],n=0;n<t.length;n++)e.push(b5(this._checkAndCopySymbol(t[n])));return e}return t?b5(t=this._checkAndCopySymbol(t)):null},e.prototype._checkAndCopySymbol=function(t){var e={};for(var n in t)e[n]=L1[n]&&s0(t[n])?+t[n]:t[n];return e},e.prototype._getSymbol=function(){return this._symbol},e.prototype._setExternSymbol=function(t){return this._eventSymbolProperties=t,this._symbol||delete this._textDesc,this._externSymbol=this._prepareSymbol(t),this.onSymbolChanged(),this},e.prototype._getInternalSymbol=function(){return this._symbol?this._symbol:this._externSymbol?this._externSymbol:this.options.symbol?this.options.symbol:null},e.prototype._getPrjExtent=function(){var t=this._getProjection();return this._verifyProjection(),!this._extent&&t&&(this._extent=this._computePrjExtent(t)),this._extent},e.prototype._unbind=function(){var t=this.getLayer();t&&(this._animPlayer&&this._animPlayer.finish(),this._unbindMenu(),this._unbindInfoWindow(),this.isEditing()&&this.endEdit(),this._removePainter(),this.onRemove&&this.onRemove(),t.onRemoveGeometry&&t.onRemoveGeometry(this),delete this._layer,delete this._internalId,delete this._extent)},e.prototype._getInternalId=function(){return this._internalId},e.prototype._setInternalId=function(t){this._internalId=t},e.prototype._getMeasurer=function(){return this._getProjection()?this._getProjection():b9.getProjectionInstance(this.options.defaultProjection)},e.prototype._getProjection=function(){var t=this.getMap();return t?t.getProjection():null},e.prototype._verifyProjection=function(){var t=this._getProjection();this._projCode&&t&&this._projCode!==t.code&&this._clearProjection(),this._projCode=t?t.code:this._projCode},e.prototype._getExternalResources=function(){return x5(this._getInternalSymbol())},e.prototype._getPainter=function(){if(this._painter)return this._painter;var t=this.getLayer();if(!this._painter&&t)if(-1!==O1.indexOf(this.type))t.constructor.getCollectionPainterClass&&(e=t.constructor.getCollectionPainterClass())&&(this._painter=new e(this));else if(t.constructor.getPainterClass){var e;(e=t.constructor.getPainterClass())&&(this._painter=new e(this))}return this._painter},e.prototype._getMaskPainter=function(){return this._maskPainter||(this._maskPainter=this.getGeometries&&this.getGeometries()?new c9(this,!0):new h9(this)),this._maskPainter},e.prototype._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter},e.prototype._paint=function(t){if(this.symbolIsVisible()&&this._painter){if(this._dirtyCoords){delete this._dirtyCoords;var e=this._getProjection();e&&(this._pcenter=e.project(this._coordinates),this._clearCache())}this._dirtyRotate&&i0(this.options.rotateAngle)&&this.rotate(this.options.rotateAngle,this.options.rotatePivot),this._dirtyRotate=!1,this._painter.paint(t)}},e.prototype._clearCache=function(){delete this._extent,delete this._extent2d,this._clearAltitudeCache()},e.prototype._clearProjection=function(){delete this._extent,delete this._extent2d},e.prototype._repaint=function(){this._painter&&this._painter.repaint()},e.prototype.onHide=function(){this.closeMenu(),this.closeInfoWindow()},e.prototype.onShapeChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("shapechange")},e.prototype.onPositionChanged=function(){this._clearCache(),this._repaint(),this._fireEvent("positionchange")},e.prototype.onSymbolChanged=function(){this._painter&&this._painter.refreshSymbol();var t={};this._eventSymbolProperties?(t.properties=JSON.parse(JSON.stringify(this._eventSymbolProperties)),delete this._eventSymbolProperties):delete this._textDesc,this._genSizeSymbol(),this._fireEvent("symbolchange",t)},e.prototype._genSizeSymbol=function(){var t=this._getInternalSymbol();if(t)if(Array.isArray(t)){this._sizeSymbol=[];for(var e=!1,n=0;n<t.length;n++){var i=this._sizeSymbol[n]=this._getSizeSymbol(t[n]);!e&&i&&i._dynamic&&(e=!0)}this._sizeSymbol._dynamic=e}else this._sizeSymbol=this._getSizeSymbol(t);else delete this._sizeSymbol},e.prototype._getSizeSymbol=function(t){var e=v5({lineWidth:t.lineWidth,lineDx:t.lineDx,lineDy:t.lineDy},this);return(J2(t.lineWidth)||J2(t.lineDx)||J2(t.lineDy))&&(e._dynamic=!0),e},e.prototype._getCompiledSymbol=function(){return this._compiledSymbol||(this._compiledSymbol=v5(this._getInternalSymbol(),this)),this._compiledSymbol},e.prototype.onConfig=function(t){var e;t.properties&&(e=t.properties,delete t.properties);var n=!1;for(var i in t)if(t.hasOwnProperty(i)){var r=i.slice(0,5);if("arrow"===r||"smoot"===r){n=!0;break}}e?(this.setProperties(e),this._repaint()):n&&this._repaint()},e.prototype._setParent=function(t){t&&(this._parent=t)},e.prototype._getParent=function(){return this._parent},e.prototype._fireEvent=function(t,e){this._silence||(this.getLayer()&&this.getLayer()._onGeometryEvent&&(e||(e={}),e.type=t,e.target=this,this.getLayer()._onGeometryEvent(e)),this.fire(t,e))},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t)}},e.prototype._recordVisible=function(){var t=this.options.visible;n0(t)&&(t=!0),this._savedVisible=t},e.prototype._recoveryVisible=function(){delete this._savedVisible},e.prototype._exportGraphicOptions=function(t){var e={};return(n0(t.options)||t.options)&&(e.options=this.config()),e.options&&this.isEditing&&this.isEditing()&&(e.options.visible=this._savedVisible),(n0(t.symbol)||t.symbol)&&(e.symbol=this.getSymbol()),(n0(t.infoWindow)||t.infoWindow)&&this._infoWinOptions&&(e.infoWindow=this._infoWinOptions),e},e.prototype._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=F4.toNumberArrays(t);return{type:this.getType(),coordinates:e}},e.prototype._exportProperties=function(){var t=null,e=this.getProperties();return n0(e)||(t=o0(e)?e0({},e):e),t},e.prototype._hitTestTolerance=function(){return 0},e.prototype._getAltitude=function(){var t=this.getLayer();if(!t)return 0;var e=t.options,n=t.getAltitude?t.getAltitude():0,i=e.enableAltitude;if(!i&&t.isVectorLayer)return n;var r=T9(t),o=(this.properties||P9)[r];if(n0(o)){var s=S9(this,n,i);return n0(s)?n:s}return Array.isArray(o)?o.map((function(t){return t+n})):o+n},e.prototype.getAltitude=function(){var t=T9(this.getLayer()),e=(this.properties||P9)[t];if(!n0(e))return e;var n=S9(this,0,!1);return n0(n)?0:n},e.prototype.hasAltitude=function(){return this._genMinMaxAlt(),!!this._minAlt||!!this._maxAlt},e.prototype.setAltitude=function(t){if(!i0(t))return this;var e=this.getLayer(),n=T9(e),i=this.properties||P9,r=i[n];if(!n0(r))if(Array.isArray(r))for(var o=0,s=r.length;o<s;o++)r[o]=t;else i[n]=t;var a=this.getCoordinates?this.getCoordinates():null;if(!a)return this;if(I9(a,t),e){var h=e.getRenderer();h&&h.gl?this.setCoordinates(a):h&&this._repaint()}return this._clearAltitudeCache(),this.onPositionChanged(),this},e.prototype._genMinMaxAlt=function(){if(void 0===this._minAlt||void 0===this._maxAlt){var t=Q0(T6(this._getAltitude()),2),e=t[1];this._minAlt=t[0],this._maxAlt=e}},e.prototype.getMinAltitude=function(){return this._genMinMaxAlt(),this._minAlt},e.prototype.getMaxAltitude=function(){return this._genMinMaxAlt(),this._maxAlt},e.prototype._clearAltitudeCache=function(){return this._minAlt=void 0,this._maxAlt=void 0,this},e}(h4(Q3(O4(Y3))));function T9(t){var e="altitude";if(t){if(!t.isVectorLayer)return null;e=t.options.altitudeProperty}return e}function S9(t,e,n){var i=t.getCoordinates?t.getCoordinates():null;if(i){var r=[];if(E9(i,r),r.length)return O9(i,e,n)}return null}function I9(t,e){if(Array.isArray(t))for(var n=0,i=t.length;n<i;n++)I9(t[n],e);else t.z=e}function E9(t,e){if(!e.length)if(Array.isArray(t))for(var n=0,i=t.length;n<i;n++)E9(t[n],e);else i0(t.z)&&e.push(t.z)}function O9(t,e,n){if(Array.isArray(t)){for(var i=[],r=0,o=t.length;r<o;r++)i.push(O9(t[r],e,n));return i}return i0(t.z)?n?e+t.z:t.z:n?e:0}function R9(t,e,n,i){return t===n?i>e?-90:90:(n-=t,i=-(i-=e),Math.atan2(i,n)/Math.PI*180)}M9.mergeOptions({id:null,visible:!0,interactive:!0,editable:!0,cursor:null,antiMeridian:!1,defaultProjection:"EPSG:4326"});var D9={attribution:null,minZoom:null,maxZoom:null,visible:!0,opacity:1,globalCompositeOperation:null,renderer:"canvas",debugOutline:"#0f0",cssFilter:null,forceRenderOnMoving:!1,forceRenderOnZooming:!1,forceRenderOnRotating:!1,collision:!1,collisionScope:"layer",hitDetect:!G0.mobile,maskClip:!0},k9=function(t){function e(e,n){var i,r=this;return n&&(i=n.canvas,delete n.canvas),(r=t.call(this,n)||this)._canvas=i,r.setId(e),n&&(r.setZIndex(n.zIndex),n.mask&&r.setMask(M9.fromJSON(n.mask))),r.proxyOptions(),r}return W0(e,t),e.prototype.load=function(){if(!this.getMap())return this;if(this.onLoad()){this._initRenderer();var t=this.getZIndex();n0(t)||(this._renderer.setZIndex(t),this.isCanvasRender()||this._renderer.render()),this.onLoadEnd()}return this},e.prototype.getId=function(){return this._id},e.prototype.setId=function(t){var e=this._id;return n0(t)||(t+=""),this._id=t,this.fire("idchange",{type:"idchange",target:this,old:e,new:t}),this},e.prototype.addTo=function(t){return t.addLayer(this),this},e.prototype.setZIndex=function(t){return this._zIndex=t,n0(t)?delete this.options.zIndex:this.options.zIndex=t,this.map&&this.map._sortLayersByZIndex(),this._renderer&&this._renderer.setZIndex(t),this.fire("setzindex",{type:"setzindex",target:this,zIndex:t}),this},e.prototype.getZIndex=function(){return this._zIndex||0},e.prototype.getMinZoom=function(){var t=this.getMap(),e=this.options.minZoom;return t?Math.max(t.getMinZoom(),e||0):e},e.prototype.getMaxZoom=function(){var t=this.getMap(),e=this.options.maxZoom;return t?Math.min(t.getMaxZoom(),n0(e)?1/0:e):e},e.prototype.getOpacity=function(){return this.options.opacity},e.prototype.setOpacity=function(t){return this.config("opacity",t),this.fire("setopacity",{type:"setopacity",target:this,opacity:t}),this},e.prototype.isCanvasRender=function(){var t=this._getRenderer();return t&&t instanceof Z8},e.prototype.getMap=function(){return this.map?this.map:null},e.prototype.getProjection=function(){var t=this.getMap();return t?t.getProjection():null},e.prototype.bringToFront=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[t.length-1];if(1===t.length||e===this)return this;var n=e.getZIndex();return this.setZIndex(n+1),this},e.prototype.bringToBack=function(){var t=this._getLayerList();if(!t.length)return this;var e=t[0];if(1===t.length||e===this)return this;var n=e.getZIndex();return this.setZIndex(n-1),this},e.prototype.show=function(){var t=this;if(!this.options.visible){this.options.visible=!0;var e=this.getRenderer();e&&e.show();var n=this.getMap();e&&n?n.once("renderend",(function(){t.fire("show")})):this.fire("show")}return this},e.prototype.hide=function(){var t=this;if(this.options.visible){this.options.visible=!1;var e=this.getRenderer();e&&e.hide();var n=this.getMap();e&&n?n.once("renderend",(function(){t.fire("hide")})):this.fire("hide")}return this},e.prototype.isVisible=function(){if(i0(this.options.opacity)&&this.options.opacity<=0)return!1;var t=this.getMap();if(t){var e=t.getZoom();if(!n0(this.options.maxZoom)&&this.options.maxZoom<e||!n0(this.options.minZoom)&&this.options.minZoom>e)return!1}return n0(this.options.visible)&&(this.options.visible=!0),this.options.visible},e.prototype.remove=function(){if(this.map){var t=this.map.getRenderer();this.map.removeLayer(this),t&&t.setToRedraw()}else this.fire("remove");return this},e.prototype.getMask=function(){return this._mask},e.prototype.setMask=function(t){if(!("Point"===t.type&&t._isVectorMarker()||"Polygon"===t.type||"MultiPolygon"===t.type))throw new Error("Mask for a layer must be a marker with vector marker symbol or a Polygon(MultiPolygon).");if(t._bindLayer(this),"Point"===t.type?t.updateSymbol({markerLineColor:"rgba(0, 0, 0, 0)",markerFillOpacity:0}):t.setSymbol({lineColor:"rgba(0, 0, 0, 0)",polygonOpacity:0}),this._mask=t,t&&t.toGeoJSON)try{this._maskGeoJSON=t.toGeoJSON()}catch(n){delete this._maskGeoJSON,console.error(n)}if(this.options.mask=t.toJSON(),!this.getMap()||this.getMap().isZooming())return this;var e=this._getRenderer();return e&&e.setToRedraw&&this._getRenderer().setToRedraw(),this},e.prototype.removeMask=function(){if(delete this._mask,delete this._maskGeoJSON,delete this.options.mask,!this.getMap()||this.getMap().isZooming())return this;var t=this._getRenderer();return t&&t.setToRedraw&&this._getRenderer().setToRedraw(),this},e.prototype.onLoad=function(){return!0},e.prototype.onLoadEnd=function(){},e.prototype.isLoaded=function(){return!!this._loaded},e.prototype.getCollisionIndex=function(){if("layer"===this.options.collisionScope)return this._collisionIndex||(this._collisionIndex=new E4),this._collisionIndex;var t=this.getMap();return t?t.getCollisionIndex():null},e.prototype.clearCollisionIndex=function(){return"layer"===this.options.collisionScope&&this._collisionIndex&&this._collisionIndex.clear(),this},e.prototype.getRenderer=function(){return this._getRenderer()},e.prototype.onConfig=function(t){if(t&&Object.keys&&Object.keys(t).length>0&&n0(t.animation)){if(this._optionsHook&&a0(this._optionsHook)&&this._optionsHook(t),this._silentConfig)return;var e=this.getRenderer();e&&e.setToRedraw&&e.setToRedraw()}},e.prototype.onAdd=function(){},e.prototype.onRendererCreate=function(){},e.prototype.onCanvasCreate=function(){},e.prototype.onRemove=function(){},e.prototype._bindMap=function(t,e){t&&(this.map=t,n0(e)||this.setZIndex(e),this._switchEvents("on",this),this.onAdd(),this.fire("add"))},e.prototype._initRenderer=function(){var t=this.options.renderer;if(this.constructor.getRendererClass){var e=this.constructor.getRendererClass(t);if(!e)throw new Error("Invalid renderer for Layer("+this.getId()+"):"+t);this._renderer=new e(this),this._renderer.layer=this,this._renderer.setZIndex(this.getZIndex()),this._switchEvents("on",this._renderer),this._renderer.onAdd&&this._renderer.onAdd(),this.onRendererCreate(),this.fire("renderercreate",{type:"renderercreate",target:this,renderer:this._renderer})}},e.prototype._doRemove=function(){this._loaded=!1,this._switchEvents("off",this),this.onRemove(),this._renderer&&(this._switchEvents("off",this._renderer),this._renderer.remove(),delete this._renderer),delete this.map,delete this._collisionIndex},e.prototype._switchEvents=function(t,e){e&&e.getEvents&&this.getMap()&&this.getMap()[t](e.getEvents(),e)},e.prototype._getRenderer=function(){return this._renderer},e.prototype._getLayerList=function(){if(!this.map)return[];var t=+!!this.map.getBaseLayer();return this.map.getLayers().slice(t)},e.prototype._getMask2DExtent=function(){if(!this._mask||!this.getMap())return null;var t=this._mask._getMaskPainter();return t?t.get2DExtent():null},e.prototype.toJSON=function(t){return{type:"Layer",id:this.getId(),options:t||this.config()}},e.fromJSON=function(t){if(!t)return null;var n=t.type,i=e.getJSONClass(n);if(!i||!i.fromJSON)throw new Error("unsupported layer type:"+n);return i.fromJSON(t)},e}(h4(Q3(F8(Y3))));k9.mergeOptions(D9);var L9=k9.prototype.fire;k9.prototype.fire=function(t,e){return"layerload"===t&&(this._loaded=!0),this.map&&(e||(e={type:null,target:null}),e.type=t,e.target=this,this.map._onLayerEvent(e)),L9.apply(this,arguments),["show","hide"].indexOf(t)>-1&&this.fire("visiblechange",Object.assign({},e,{visible:this.options.visible})),this};var F9=new F4(0,0),N9=new $0(0,0),z9=["centerCross","fog","fogColor","debugSky"],B9={maxVisualPitch:70,maxPitch:80,centerCross:!1,zoomInCenter:!1,zoomOrigin:null,zoomAnimation:!K$,zoomAnimationDuration:330,panAnimation:!K$,panAnimationDuration:600,rotateAnimation:!K$,zoomable:!0,enableInfoWindow:!0,hitDetect:!G0.mobile,hitDetectLimit:5,fpsOnInteracting:25,layerCanvasLimitOnInteracting:-1,maxZoom:null,minZoom:null,maxExtent:null,limitExtentOnMaxExtent:!1,fixCenterOnResize:!0,checkSize:!0,checkSizeInterval:1e3,renderer:"canvas",cascadePitches:[10,60],renderable:!0,clickTimeThreshold:280,stopRenderOnOffscreen:!0,preventWheelScroll:!0,preventTouch:!0,supportPluginEvent:!0,switchDragButton:!1,mousemoveThrottleTime:48,maxFPS:0,debug:!1,cameraFarUndergroundInMeter:2e3},H9=function(t){function e(n,i){var r=this;if(!i)throw new Error("Invalid options when creating map.");if(!i.center)throw new Error("Invalid center when creating map.");var o=e0({},i),s=o.zoom;delete o.zoom;var a=new F4(o.center);delete o.center;var h=o.baseLayer;delete o.baseLayer;var l=o.layers;return delete o.layers,(r=t.call(this,o)||this).VERSION=e.VERSION,Object.defineProperty(r,"id",{value:i1(),writable:!1}),r._loaded=!1,r._initContainer(n),r._panels={},r._baseLayer=null,r._layers=[],r._zoomLevel=s,r._center=a,r._centerZ=a.z,r.setSpatialReference(o.spatialReference||o.view),r._mapViewPoint=new $0(0,0),r._initRenderer(),r._updateMapSize(r._getContainerDomSize()),h&&r.setBaseLayer(h),l&&r.addLayer(l),r.setMaxExtent(o.maxExtent),r._Load(),r.proxyOptions(),r.isMap=!0,r}return W0(e,t),e.addOnLoadHook=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i="function"==typeof t?t:function(){var n;(n=this[t]).call.apply(n,X0([this],Q0(e),!1))};return this.prototype._onLoadHooks=this.prototype._onLoadHooks||[],this.prototype._onLoadHooks.push(i),this},e.prototype.isLoaded=function(){return!!this._loaded},e.prototype.getContainer=function(){return this._containerDOM},e.prototype.getSpatialReference=function(){return this._spatialReference},e.prototype.setSpatialReference=function(t){var e=this.options.spatialReference;return this._loaded&&b9.equals(e,t)||this._updateSpatialReference(t,e),this},e.prototype._updateSpatialReference=function(t,e){s0(t)&&(t=b9.getPreset(t)),t=e0({},t),this._center=this.getCenter(),this.options.spatialReference=t,this._spatialReference=new b9(t);var n=this._spatialReference.getProjection();return this.options.spatialReference&&a0(this.options.spatialReference.projection)&&(this.options.spatialReference.projection=n.code),this._resetMapStatus(),I8.is(n.code)&&(this._originLng=n.centralMeridian,this._altitudeOriginDirty=!0),this._fireEvent("spatialreferencechange",{old:e,new:e0({},this.options.spatialReference)}),this},e.prototype.onConfig=function(t){var e=t.spatialReference||t.view;n0(e)||this._updateSpatialReference(e,null);for(var n=!1,i=0,r=z9.length;i<r;i++)if(!n0(t[z9[i]])){n=!0;break}if(!n)return this;var o=this.getRenderer();return o&&o.setToRedraw(),this},e.prototype.getProjection=function(){return this._spatialReference?this._spatialReference.getProjection():null},e.prototype.getFullExtent=function(){return this._spatialReference?this._spatialReference.getFullExtent():null},e.prototype.setCursor=function(t){return delete this._cursor,this._trySetCursor(t),this._cursor=t,this},e.prototype.resetCursor=function(){return this.setCursor(null)},e.prototype.getCenter=function(){if(!this._loaded||!this._prjCenter)return this._center;var t=this.getProjection().unproject(this._prjCenter);return t.x=Math.round(1e8*t.x)/1e8,t.y=Math.round(1e8*t.y)/1e8,t.z=this._centerZ,this.centerAltitude&&(t.z=this.centerAltitude),t},e.prototype.setCenter=function(t,e){if(!t)return this;t=new F4(t),e&&(t=this._getCenterByPadding(t,this.getZoom(),e));var n=this.getProjection().project(t);return this._verifyExtent(n)||this.options.limitExtentOnMaxExtent?this._loaded?(this._centerZ=t.z,this.onMoveStart(),this._setPrjCenter(n),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this):(this._center=t,this):this},e.prototype.getSize=function(){return n0(this.width)||n0(this.height)?this._getContainerDomSize():new z1(this.width,this.height)},e.prototype.getContainerExtent=function(){var t=this.height,e=this.getPitch(),n=this.options.maxVisualPitch;return n&&e>n&&(t=this._getVisualHeight(n)),new Y4(0,this.height-t,this.width,this.height)},e.prototype._getVisualHeight=function(t){t=t||.01;var e=(90-this.getPitch())*Math.PI/180,n=this.getFov()*Math.PI/180;t*=Math.PI/180;var i=this.cameraCenterDistance/this.getGLScale(),r=Math.tan(n/2),o=i*r/(1/Math.tan(t)-r)/Math.sin(t),s=i*(Math.sin(e)*o/(i+Math.cos(e)*o));return this.height/2+s},e.prototype.getExtent=function(){return this.pointToExtent(this.get2DExtent())},e.prototype.getProjExtent=function(){var t=this.get2DExtent();return new X4(this._pointToPrj(t.getMin()),this._pointToPrj(t.getMax()))},e.prototype.getPrjExtent=function(){return this.getProjExtent()},e.prototype.getMaxExtent=function(){return this.options.maxExtent?new X4(this.options.maxExtent,this.getProjection()):null},e.prototype.setMaxExtent=function(t){if(t){var e=new X4(t,this.getProjection());this.options.maxExtent=e;var n=this.getProjection();this._prjMaxExtent=e.convertTo((function(t){return n.project(t)})),this._verifyExtent(this._getPrjCenter())||(this._loaded?this._panTo(this._prjMaxExtent.getCenter()):this._center=n.unproject(this._prjMaxExtent.getCenter()))}else delete this.options.maxExtent,delete this._prjMaxExtent;return this},e.prototype.getZoom=function(){return this._zoomLevel},e.prototype.getZoomForScale=function(t,e,n){var i=this.getZoom();if(n0(e)&&(e=i),1===t&&e===i)return i;var r=this._getResolution(e),o=this.getZoomFromRes(r/t);if(n)return o;var s=1e-6;return this.getSpatialReference().getZoomDirection()<0?Math.ceil(o-s):Math.floor(o+s)},e.prototype.getZoomFromRes=function(t){var e=this._getResolutions(),n=this._getResolution(this.getMinZoom()),i=this._getResolution(this.getMaxZoom());if(n<=i){if(t<=n)return this.getMinZoom();if(t>=i)return this.getMaxZoom()}else{if(t>=n)return this.getMinZoom();if(t<=i)return this.getMaxZoom()}for(var r=e.length,o=0;o<r-1;o++)if(e[o]){var s=e[o+1]-e[o],a=t-e[o];if(u1(s)===u1(a)&&Math.abs(s)>=Math.abs(a))return o+a/s}return r-1},e.prototype.setZoom=function(t,e){return void 0===e&&(e={animation:!0}),isNaN(t)||n0(t)||(t=+t,this._loaded&&this.options.zoomAnimation&&e.animation?this._zoomAnimation(t):this._zoom(t)),this},e.prototype.getMaxZoom=function(){return n0(this.options.maxZoom)?this.getMaxNativeZoom():this.options.maxZoom},e.prototype.setMaxZoom=function(t){var e=this.getMaxNativeZoom();return t>e&&(t=e),null!==t&&t<this._zoomLevel&&(this.setZoom(t),t=+t),this.options.maxZoom=t,this},e.prototype.getMinZoom=function(){return n0(this.options.minZoom)?this._spatialReference.getMinZoom():this.options.minZoom},e.prototype.setMinZoom=function(t){if(null!==t){t=+t;var e=this._spatialReference.getMinZoom();t<e&&(t=e),t>this._zoomLevel&&this.setZoom(t)}return this.options.minZoom=t,this},e.prototype.getMaxNativeZoom=function(){var t=this.getSpatialReference();return t?t.getMaxZoom():null},e.prototype.getGLRes=function(){if(this._glRes)return this._glRes;var t=this.getSpatialReference().getFullExtent();return this._glRes=(t.right-t.left)/Math.pow(2,19),this._glRes},e.prototype.getGLScale=function(t){return n0(t)&&(t=this.getZoom()),this._getResolution(t)/this.getGLRes()},e.prototype.zoomIn=function(){return this.setZoom(this.getZoom()+1)},e.prototype.zoomOut=function(){return this.setZoom(this.getZoom()-1)},e.prototype.isZooming=function(){return!!this._zooming},e.prototype.isInteracting=function(){return this.isZooming()||this.isMoving()||this.isRotating()},e.prototype.setCenterAndZoom=function(t,e){return n0(e)||this._zoomLevel===e?this.setCenter(t):(this.setCenter(t),this.setZoom(e,{animation:!1})),this},e.prototype._getPaddingSize=function(t){return void 0===t&&(t={}),t.paddingLeft||t.paddingTop||t.paddingRight||t.paddingBottom?{width:(t.paddingLeft||0)+(t.paddingRight||0),height:(t.paddingTop||0)+(t.paddingBottom||0)}:null},e.prototype.getFitZoom=function(t,e,n){var i=this;if(!(t&&t instanceof X4))return this._zoomLevel;if(t.xmin===t.xmax&&t.ymin===t.ymax)return this.getMaxZoom();var r=this.getSize(),o=this._getPaddingSize(n);if(o){var s={width:r.width-(o.width||0),height:r.height-(o.height||0)};r=new z1(s.width,s.height)}var a=t.convertTo((function(t){return i.coordToPoint(t)})),h=a.getWidth(),l=a.getHeight(),u=r.width/h,c=r.height/l,A=this.getSpatialReference().getZoomDirection()<0?Math.max(u,c):Math.min(u,c);return this.getZoomForScale(A,null,e)},e.prototype.getView=function(){return{center:this.getCenter().toArray(),zoom:this.getZoom(),pitch:this.getPitch(),bearing:this.getBearing()}},e.prototype._validateView=function(t){if(t&&o0(t)){i0(t.bearing)&&(t.bearing=Math.max(-180,t.bearing),t.bearing=Math.min(180,t.bearing)),i0(t.pitch)&&(t.pitch=Math.max(0,t.pitch),t.pitch=Math.min(this.options.maxPitch,t.pitch));var e=this.getMaxZoom();i0(t.zoom)&&(t.zoom=Math.max(0,t.zoom),t.zoom=Math.min(e,t.zoom))}},e.prototype.setView=function(t){return t?(this._validateView(t),t.center&&this.setCenter(t.center),null===t.zoom||isNaN(+t.zoom)||this.setZoom(+t.zoom,{animation:!1}),null===t.pitch||isNaN(+t.pitch)||this.setPitch(+t.pitch),null===t.bearing||isNaN(+t.bearing)||this.setBearing(+t.bearing),this):this},e.prototype.getResolution=function(t){return this._getResolution(t)},e.prototype.getScale=function(t){var e=n0(t)?this.getZoom():t,n=this._getResolution(this.getMaxNativeZoom());return this._getResolution(e)/n},e.prototype._getCenterByPadding=function(t,e,n){var i=this.coordinateToPoint(t,e),r=n||{},o=r.paddingLeft,s=void 0===o?0:o,a=r.paddingRight,h=void 0===a?0:a,l=r.paddingTop,u=void 0===l?0:l,c=r.paddingBottom,A=void 0===c?0:c,f=0,d=0;(s||h)&&(f=(h-s)/2),(u||A)&&(d=(u-A)/2);var p=new $0({x:i.x+f,y:i.y+d});return this.pointToCoordinate(p,e)},e.prototype.fitExtent=function(t,e,n,i){if(n=n||{},!t)return this;t=new X4(t,this.getProjection());var r=this.getFitZoom(t,n.isFraction||!1,n)+(e||0),o=t.getCenter();return this._getPaddingSize(n)&&(o=this._getCenterByPadding(o,r,n)),void 0===n.animation||n.animation?this._animateTo({center:o,zoom:r},{duration:n.duration||this.options.zoomAnimationDuration,easing:n.easing||"out"},i):this.setCenterAndZoom(o,r)},e.prototype.getBaseLayer=function(){return this._baseLayer},e.prototype.setBaseLayer=function(t){var e=!1;return this._baseLayer&&(e=!0,this._fireEvent("baselayerchangestart"),this._baseLayer.remove()),t?(this._baseLayer=t,t._bindMap(this,-1),this._baseLayer.on("layerload",(function(){this._fireEvent("baselayerload"),e&&(e=!1,this._fireEvent("baselayerchangeend"))}),this),this._loaded&&this._baseLayer.load(),this._fireEvent("setbaselayer"),this):(delete this._baseLayer,this._fireEvent("baselayerchangeend"),this._fireEvent("setbaselayer"),this)},e.prototype.removeBaseLayer=function(){return this._baseLayer&&(this._baseLayer.remove(),delete this._baseLayer,this._fireEvent("baselayerremove")),this},e.prototype.getLayers=function(t){return this._getLayers((function(e){return!(e===this._baseLayer||e.getId().indexOf(E1)>=0)&&(!t||t(e))}))},e.prototype.getLayer=function(t){if(!t)return null;var e=this._layerCache?this._layerCache[t]:null;if(e)return e;var n=this.getBaseLayer();return n&&n.getId()===t?n:null},e.prototype.addLayer=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!t)return this;Array.isArray(t)||(t=[t]),e&&e.length&&(t=t.concat(e)),this._layerCache||(this._layerCache={});for(var i=this._layers,r=0,o=t.length;r<o;r++){var s=t[r],a=s.getId();if(n0(a))throw new Error("Invalid id for the layer: "+a);if(s.getMap()!==this){if(this._layerCache[a])throw new Error("Duplicate layer id in the map: "+a);this._layerCache[a]=s,s._bindMap(this),i.push(s),this._loaded&&s.load()}}return this._sortLayersByZIndex(),this._fireEvent("addlayer",{layers:t}),this},e.prototype.removeLayer=function(t){if(!t)return this;if(!Array.isArray(t))return this.removeLayer([t]);for(var e=[],n=0,i=t.length;n<i;n++){var r=t[n];if(r instanceof k9||(r=this.getLayer(r)),r){var o=r.getMap();if(o&&o===this){e.push(r),this._removeLayer(r,this._layers),this._loaded&&r._doRemove();var s=r.getId();this._layerCache&&delete this._layerCache[s]}}}if(e.length>0){var a=this.getRenderer();a&&a.setLayerCanvasUpdated(),this.once("frameend",(function(){e.forEach((function(t){t.fire("remove")}))}))}return this._fireEvent("removelayer",{layers:t}),this},e.prototype.sortLayers=function(t){if(!t||!Array.isArray(t))return this;for(var e=[],n=Number.MAX_VALUE,i=0,r=t.length;i<r;i++){var o=t[i];if(s0(t[i])&&(o=this.getLayer(o)),!(o instanceof k9&&o.getMap()&&o.getMap()===this))throw new Error("It must be a layer added to this map to order.");o.getZIndex()<n&&(n=o.getZIndex()),e.push(o)}for(i=0,r=e.length;i<r;i++)e[i].setZIndex(n+i);return this},e.prototype.toDataURL=function(t){t||(t={});var e=t.mimeType;e||(e="image/png");var n=t.save,i=this._getRenderer();if(i&&i.toDataURL){var r=t.fileName;r||(r="export");var o=i.toDataURL(e,t.quality||.92);if(n&&o){var s=void 0;if("undefined"!=typeof Blob&&"undefined"!=typeof atob){var a=function(t,e){for(var n=atob(t),i=new ArrayBuffer(n.length),r=new Uint8Array(i),o=0;o<n.length;o++)r[o]=255&n.charCodeAt(o);return new Blob([i],{type:e})}(o.replace(/^data:image\/(png|jpeg|jpg|webp);base64,/,""),e);s=URL.createObjectURL(a)}else s=o;var h=document.createElement("a");h.download=r,h.href=s,document.body.appendChild(h),h.click(),document.body.removeChild(h)}return o}return null},e.prototype.coordToPoint=function(t,e,n){return this.coordinateToPoint(t,e,n)},e.prototype.coordToPointAtRes=function(t,e,n){return this.coordinateToPointAtRes(t,e,n)},e.prototype.pointToCoord=function(t,e,n){return this.pointToCoordinate(t,e,n)},e.prototype.pointAtResToCoord=function(t,e,n){return this.pointAtResToCoordinate(t,e,n)},e.prototype.coordToViewPoint=function(t,e,n){return this.coordinateToViewPoint(t,e,n)},e.prototype.viewPointToCoord=function(t,e){return this.viewPointToCoordinate(t,e)},e.prototype.coordToContainerPoint=function(t,e,n){return this.coordinateToContainerPoint(t,e,n)},e.prototype.containerPointToCoord=function(t,e){return this.containerPointToCoordinate(t,e)},e.prototype.containerPointToViewPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._sub(this.getViewPoint())},e.prototype.viewPointToContainerPoint=function(t,e){return e?e.set(t.x,t.y):e=t.copy(),e._add(this.getViewPoint())},e.prototype.checkSize=function(t){var e=t0()-this._initTime<1500&&0===this.width||0===this.height,n=this._getContainerDomSize(),i=this.height,r=this.width;if(!t&&n.width===r&&n.height===i)return this;g2(this._containerDOM);var o=this.getCenter();if(this.options.fixCenterOnResize)this._updateMapSize(n);else{var s=this._getVisualHeight(this.getPitch()),a=new $0(0,this.height-s),h=this._containerPointToPrj(a);this._updateMapSize(n);var l=this._getVisualHeight(this.getPitch()),u=new $0(0,this.height-l);this._setPrjCoordAtContainerPoint(h,u),this._mapViewCoord=this._getPrjCenter()}return(e||0===n.width||0===n.height||0===r||0===i)&&(this._eventSilence=!0,this.setCenter(o),delete this._eventSilence),this._fireEvent("resize"),this},e.prototype.locate=function(t,e,n){return this.getProjection()._locate(new F4(t),e,n)},e.prototype.getMainPanel=function(){var t=this._getRenderer();return t?t.getMainPanel():null},e.prototype.getPanels=function(){return this._panels},e.prototype.remove=function(){var t=this;if(this.isRemoved())return this;this._fireEvent("removestart"),this._removeDomEvents(),this._clearHandlers(),this.removeBaseLayer();for(var e=this.getLayers(),n=0;n<e.length;n++)e[n].remove();return this._getRenderer()&&this._getRenderer().remove(),this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&Array.prototype.slice.call(this._containerDOM.childNodes,0).filter((function(t){return"maptalks-wrapper"===t.className})).forEach((function(e){return t._containerDOM.removeChild(e)})),delete this._panels,delete this._containerDOM,delete this._renderer,this._fireEvent("removeend"),this._clearAllListeners(),this},e.prototype.isRemoved=function(){return!this._containerDOM},e.prototype.isMoving=function(){return!!this._moving},e.prototype.onMoveStart=function(t){this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer);var e=this._getPrjCenter();this._originCenter&&!this._verifyExtent(e)||(this._originCenter=e),this._moving=!0,this._trySetCursor("move"),this._fireEvent("movestart",this._parseEvent(t?t.domEvent:null,"movestart"))},e.prototype.onMoving=function(t){this._fireEvent("moving",this._parseEvent(t?t.domEvent:null,"moving")),this._limitMaxExtent()},e.prototype.onMoveEnd=function(t){this._moving=!1,this._suppressRecenter||this._recenterOnTerrain(),this._trySetCursor("default"),this._fireEvent("moveend",t&&t.domEvent?this._parseEvent(t.domEvent,"moveend"):t),this._verifyExtent(this._getPrjCenter())||!this._originCenter||this.options.limitExtentOnMaxExtent||this._panTo(this._originCenter),this._limitMaxExtent()},e.prototype.onDragRotateStart=function(t){this._dragRotating=!0,this._fireEvent("dragrotatestart",this._parseEvent(t?t.domEvent:null,"dragrotatestart"))},e.prototype.onDragRotating=function(t){this._fireEvent("dragrotating",this._parseEvent(t?t.domEvent:null,"dragrotating"))},e.prototype.onDragRotateEnd=function(t){this._dragRotating=!1,this._fireEvent("dragrotateend",this._parseEvent(t?t.domEvent:null,"dragrotateend"))},e.prototype.isDragRotating=function(){return!!this._dragRotating},e.prototype.isOffscreen=function(t,e){var n;void 0===e&&(e=0);var i=this.width+e,r=this.height+e,o=t.xmin,s=t.ymin,a=t.xmax,h=t.ymax;return Array.isArray(t)&&(o=(n=Q0(t,4))[0],s=n[1],a=n[2],h=n[3]),a<e||o>=i||h<e||s>r},e.prototype.getRenderer=function(){return this._getRenderer()},e.prototype.getDevicePixelRatio=function(){return this.options.devicePixelRatio||G0.devicePixelRatio||1},e.prototype.setDevicePixelRatio=function(t){return i0(t)&&t>0&&t!==this.options.devicePixelRatio&&(this.options.devicePixelRatio=t,this.checkSize(!0)),this},e.prototype._initContainer=function(t){if(s0(t)){if(this._containerDOM=document.getElementById(t),!this._containerDOM)throw new Error("Invalid container when creating map: '"+t+"'")}else this._containerDOM=t,K$&&(this.CanvasClass=this._containerDOM.constructor);if(this._containerDOM.childNodes&&this._containerDOM.childNodes.length>0&&"maptalks-wrapper"===this._containerDOM.childNodes[0].className)throw new Error("Container is already loaded with another map instance, use map.remove() to clear it.")},e.prototype._trySetCursor=function(t){return this._cursor||this._priorityCursor||(t||(t="default"),this._setCursorToPanel(t)),this},e.prototype._setPriorityCursor=function(t){if(t)this._priorityCursor=t,this._setCursorToPanel(t);else{var e=!1;this._priorityCursor&&(e=!0),delete this._priorityCursor,e&&this.setCursor(this._cursor)}return this},e.prototype._setCursorToPanel=function(t){var e=this.getMainPanel();e&&e.style&&e.style.cursor!==t&&(e.style.cursor=t)},e.prototype._removeLayer=function(t,e){if(t&&e){var n=e.indexOf(t);n>-1&&e.splice(n,1)}},e.prototype._sortLayersByZIndex=function(){if(this._layers){for(var t=0,e=this._layers.length;t<e;t++){var n=this._layers[t];n._order=t,n.sortLayersByZIndex&&n.sortLayersByZIndex()}this._layers.sort((function(t,e){var n=t.getZIndex()-e.getZIndex();return 0===n?t._order-e._order:n}))}},e.prototype._fireEvent=function(t,e){this._eventSilence||("_"!==t[0]&&this.fire("_"+t,e),this.fire(t,e))},e.prototype._Load=function(){this._resetMapStatus(),this.options.pitch&&(this.setPitch(this.options.pitch),delete this.options.pitch),this.options.bearing&&(this.setBearing(this.options.bearing),delete this.options.bearing),delete this._glRes,this._loadAllLayers(),this._getRenderer().onLoad(),this._loaded=!0,this._callOnLoadHooks(),this._initTime=t0()},e.prototype._initRenderer=function(){var t=e.getRendererClass(this.options.renderer);this._renderer=new t(this),this._renderer.load()},e.prototype._getRenderer=function(){return this._renderer},e.prototype._loadAllLayers=function(){this._baseLayer&&this._baseLayer.load(),this._eachLayer((function(t){t&&t.load()}),this.getLayers())},e.prototype._getLayers=function(t){for(var e=this._baseLayer?[this._baseLayer].concat(this._layers):this._layers,n=[],i=0;i<e.length;i++)t&&!t.call(this,e[i])||n.push(e[i]);return n},e.prototype._eachLayer=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!(arguments.length<2)){e&&!Array.isArray(e)&&(e=[e]);for(var i=[],r=0,o=e.length;r<o;r++)i=i.concat(e[r]);for(var s=0,a=i.length;s<a;s++)t.call(t,i[s])}},e.prototype._onLayerEvent=function(t){t&&"idchange"===t.type&&(delete this._layerCache[t.old],this._layerCache[t.new]=t.target)},e.prototype._resetMapStatus=function(){var t=this.getMaxZoom(),e=this.getMinZoom(),n=this._spatialReference.getMaxZoom(),i=this._spatialReference.getMinZoom();(n0(t)||-1===t||t>n)&&this.setMaxZoom(n),(n0(e)||-1===e||e<i)&&this.setMinZoom(i),(t=this.getMaxZoom())<(e=this.getMinZoom())&&this.setMaxZoom(e),(n0(this._zoomLevel)||this._zoomLevel>t)&&(this._zoomLevel=t),this._zoomLevel<e&&(this._zoomLevel=e),delete this._prjCenter,delete this._glRes;var r=this.getProjection();this._prjCenter=r.project(this._center),this._prjCenter.z=this._center.z,this._calcMatrices();var o=this._getRenderer();o&&o.resetContainer()},e.prototype.setContainerDomRect=function(t){this._containerDomContentRect=t},e.prototype._getContainerDomSize=function(){if(!this._containerDOM)return null;var t,e,n=this._containerDOM;if(this._containerDomContentRect)return new z1(t=this._containerDomContentRect.width,e=this._containerDomContentRect.height);var i=n;if(n0(i.width)||n0(i.height)){if(n0(n.clientWidth)||n0(n.clientHeight))throw new Error("can not get size of container");t=parseInt(n.clientWidth+"",0),e=parseInt(n.clientHeight+"",0)}else{t=i.width,e=i.height;var r=this.getDevicePixelRatio();1!==r&&n.layer&&(t/=r,e/=r)}return new z1(t,e)},e.prototype._updateMapSize=function(t){return this.width=t.width,this.height=t.height,this._getRenderer().updateMapSize(t),this._calcMatrices(),this},e.prototype._getPrjCenter=function(){return this._prjCenter},e.prototype._setPrjCenter=function(t){this._prjCenter=t,this.isInteracting()&&!this.isMoving()&&(this._mapViewCoord=t),this._calcMatrices()},e.prototype._setPrjCoordAtContainerPoint=function(t,e){if(!this.centerAltitude&&e.x===this.width/2&&e.y===this.height/2)return this;var n=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter())),i=this._pointToPrj(this._prjToPoint(t)._sub(n));return this._setPrjCenter(i),this},e.prototype._setPrjCoordAtOffsetToCenter=function(t,e){var n=this._pointToPrj(this._prjToPoint(t)._sub(e));return this._setPrjCenter(n),this},e.prototype._verifyExtent=function(t){if(!t)return!1;var e=this._prjMaxExtent;return!e||e.contains(t)},e.prototype._limitMaxExtent=function(){var t=this;if(this._limitMaxExtenting||!this.options.limitExtentOnMaxExtent)return this;var e=this._prjMaxExtent,n=this.getMaxExtent();if(!e||!n)return this;var i=e.toArray().map((function(e){return t.prjToContainerPoint(e)})),r=Y5();$5(i,r);var o=this.getSize(),s=o.width,a=o.height,h=[0,0,s,a];if(i3(h,r))return this;if(i3(r,h))return this;var l=0,u=0,c=0,A=0,f=0,d=0,p=Math.abs,g=Q0(r,4),m=g[0],y=g[1],v=g[2],_=g[3];if(m>0&&v>s&&(l=c=p(m)),m<0&&v<s&&(l=c=-p(m)),m<0&&v<s&&(l=A=-p(s-v)),m>0&&v>s&&(l=A=p(s-v)),y>0&&_>a&&(u=f=p(y)),y<0&&_<a&&(u=f=-p(y)),y<0&&_<a&&(u=d=-p(a-_)),y>0&&_>a&&(u=d=p(a-_)),0!==c&&0!==A&&(l=c,p(A)<p(c)&&(l=A)),0!==f&&0!==d&&(u=f,p(d)<p(f)&&(u=d)),0!==l||0!==u){var x=new $0(s/2+l,a/2+u),b=this.containerPointToCoord(x);this._limitMaxExtenting=!0,this.setCenter(b),this._limitMaxExtenting=!1}return this},e.prototype._offsetCenterByPixel=function(t){var e=N9.set(this.width/2-t.x,this.height/2-t.y),n=this._containerPointToPrj(e,F9),i=N9.set(this.width/2,this.height/2);this._setPrjCoordAtContainerPoint(n,i)},e.prototype.offsetPlatform=function(t){return t?(this._getRenderer().offsetPlatform(t),this._mapViewCoord=this._getPrjCenter(),this._mapViewPoint=this._mapViewPoint.add(t),this._mapViewPoint):this._mapViewPoint},e.prototype.getViewPoint=function(){var t=this.getViewPointFrameOffset(),e=this.offsetPlatform();return t&&(e=e.add(t)),e},e.prototype._resetMapViewPoint=function(){this._mapViewPoint=new $0(0,0),this._mapViewCoord=this._getPrjCenter()},e.prototype._getResolution=function(t){return void 0!==t&&t!==this._zoomLevel||void 0===this._mapRes?(n0(t)&&(t=this._zoomLevel),this._spatialReference.getResolution(t)):this._mapRes},e.prototype._getResolutions=function(){return this._spatialReference.getResolutions()},e.prototype._prjToPoint=function(t,e,n){e=n0(e)?this.getZoom():e;var i=this._getResolution(e);return this._prjToPointAtRes(t,i,n)},e.prototype._prjToPointAtRes=function(t,e,n){return this._spatialReference.getTransformation().transform(t,e,n)},e.prototype._prjsToPointsAtRes=function(t,e,n){void 0===n&&(n=[]);for(var i=this._spatialReference.getTransformation(),r=[],o=0,s=t.length;o<s;o++){var a=i.transform(t[o],e,n[o]);r.push(a)}return r},e.prototype._pointToPrj=function(t,e,n){e=n0(e)?this.getZoom():e;var i=this._getResolution(e);return this._pointToPrjAtRes(t,i,n)},e.prototype._pointToPrjAtRes=function(t,e,n){return this._spatialReference.getTransformation().untransform(t,e,n)},e.prototype._pointToPoint=function(t,e,n){return n0(e)?(n?(n.x=t.x,n.y=t.y):n=t.copy(),n):this._pointAtResToPoint(t,this._getResolution(e),n)},e.prototype._pointAtResToPoint=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(e/this._getResolution())},e.prototype._pointToPointAtRes=function(t,e,n){return n?(n.x=t.x,n.y=t.y):n=t.copy(),n._multi(this._getResolution()/e)},e.prototype._containerPointToPrj=function(t,e){return this._pointToPrj(this._containerPointToPoint(t,void 0,e),void 0,e)},e.prototype._callOnLoadHooks=function(){var t=e.prototype;if(t._onLoadHooks)for(var n=0,i=t._onLoadHooks.length;n<i;n++)t._onLoadHooks[n].call(this)},e.prototype._fixPrjOnWorldWide=function(t){var e=this.getProjection();if(e&&e.fullExtent&&t){var n=e.fullExtent||{},i=n.left,r=n.bottom,o=n.top,s=n.right;i0(i)&&(t.x=Math.max(i,t.x)),i0(s)&&(t.x=Math.min(s,t.x)),i0(r)&&(t.y=Math.max(r,t.y)),i0(o)&&(t.y=Math.min(o,t.y))}return this},e.prototype.toJSON=function(t){t||(t={});var e={jsonVersion:this.JSON_VERSION,version:this.VERSION,extent:this.getExtent().toJSON()};e.options=this.config(),e.options.center=this.getCenter(),e.options.zoom=this.getZoom(),e.options.bearing=this.getBearing(),e.options.pitch=this.getPitch();var n=this.getBaseLayer();(n0(t.baseLayer)||t.baseLayer)&&n&&(e.baseLayer=n.toJSON(t.baseLayer));var i={};t.clipExtent&&(i.clipExtent=!0===t.clipExtent?this.getExtent():t.clipExtent);var r=[];if(n0(t.layers)||t.layers&&!Array.isArray(t.layers)){for(var o=0,s=(h=this.getLayers()).length;o<s;o++)if(h[o].toJSON){var a=e0({},o0(t.layers)?t.layers:{},i);r.push(h[o].toJSON(a))}e.layers=r}else if(d1(t.layers)){var h=t.layers;for(o=0;o<h.length;o++){var l=h[o],u=this.getLayer(l.id);u.toJSON&&(a=e0({},l.options,i),r.push(u.toJSON(a)))}e.layers=r}else e.layers=[];return e},e.fromJSON=function(t,n,i){if(!t||!n)return null;i||(i={});var r=new e(t,n.options);if(n0(i.baseLayer)||i.baseLayer){var o=k9.fromJSON(n.baseLayer);o&&r.setBaseLayer(o)}if(n0(i.layers)||i.layers){for(var s=[],a=n.layers,h=0;h<a.length;h++){var l=k9.fromJSON(a[h]);s.push(l)}r.addLayer(s)}return r},e}(O4(Q3(F8(Y3))));H9.mergeOptions(B9);var j9=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.addHooks=function(){this.target&&this.target.on("_dblclick",this._onDoubleClick,this)},e.prototype.removeHooks=function(){this.target&&this.target.off("_dblclick",this._onDoubleClick,this)},e.prototype._onDoubleClick=function(t){var e=this.target;if(e.options.doubleClickZoom){var n=e.getZoom(),i=t.domEvent.shiftKey?Math.ceil(n)-1:Math.floor(n)+1;e._zoomAnimation(i,t.containerPoint)}},e}(X3);H9.mergeOptions({doubleClickZoom:!0}),H9.addOnLoadHook("addHandler","doubleClickZoom",j9);var U9=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.addHooks=function(){var t=this.target;if(t){var e=t.getPanels().mapWrapper||t.getContainer();this._dragHandler=new L4(e,{cancelOn:this._cancelOn.bind(this),rightclick:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this).on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this).enable()}},e.prototype.removeHooks=function(){this._dragHandler.off("mousedown",this._onMouseDown,this).off("dragstart",this._onDragStart,this).off("dragging",this._onDragging,this).off("dragend",this._onDragEnd,this),this._dragHandler.remove(),delete this._dragHandler},e.prototype._cancelOn=function(t){return!(!this.target.isZooming()&&!this._ignore(t))},e.prototype._ignore=function(t){return!!t&&(t.domEvent&&(t=t.domEvent),this.target._ignoreEvent(t)||this.target._isEventOutMap(t))},e.prototype._onMouseDown=function(t){delete this.startDragTime,delete this._mode;var e=this.target.options.switchDragButton;e&&"touchstart"===t.domEvent.type||t.domEvent.button===(e?0:2)||t.domEvent.ctrlKey?(this.target.options.dragRotate||this.target.options.dragPitch)&&(this._mode="rotatePitch"):this.target.options.dragPan&&(this._mode="move"),this.target._stopAnim(this.target._mapAnimPlayer),f2(t.domEvent)},e.prototype._onDragStart=function(t){this.startDragTime=t0(),"move"===this._mode?this._moveStart(t):"rotatePitch"===this._mode&&this._rotateStart(t)},e.prototype._onDragging=function(t){this.target._isEventOutMap(t.domEvent)||("move"===this._mode?this._moving(t):"rotatePitch"===this._mode&&this._rotating(t))},e.prototype._onDragEnd=function(t){"move"===this._mode?this._moveEnd(t):"rotatePitch"===this._mode&&this._rotateEnd(t),delete this.startDragTime,delete this.startBearing},e.prototype._start=function(t){this.preX=t.mousePos.x,this.preY=t.mousePos.y,this.startX=this.preX,this.startY=this.preY,this._startPrjCenter=this.target._getPrjCenter().copy()},e.prototype._moveStart=function(t){this._start(t);var e=this.target;e.onMoveStart(t);var n=m2(e._getActualEvent(t.domEvent),e.getContainer());this.startPrjCoord=this._containerPointToPrj(n)},e.prototype._moving=function(t){if(this.startDragTime){var e=this.target,n=m2(e._getActualEvent(t.domEvent),e.getContainer()),i=e._containerPointToPoint(n,void 0,void 0,this.startPrjCoord.z),r=e._prjToPoint(e._pointToPrj(i))._sub(e._prjToPoint(e._getPrjCenter()));e._setPrjCoordAtOffsetToCenter(this.startPrjCoord,r),e.onMoving(t)}},e.prototype._containerPointToPrj=function(t){var e=this.target,n=e._queryTerrainInfo(t);if(n){var i=e.getProjection().project(n.coordinate);return i.z=n.altitude,i}return e._containerPointToPrj(t)},e.prototype._moveEnd=function(t){if(this.startDragTime){var e="touchend"===t.domEvent.type,n=this.target,i=t0()-this.startDragTime,r=t.mousePos.x-this.startX,o=t.mousePos.y-this.startY,s=n._getPrjCenter(),a=s.sub(this._startPrjCenter);if(this._clear(),n.options.panAnimation&&!t.interupted&&n._verifyExtent(n._getPrjCenter())&&i<280&&Math.abs(o)+Math.abs(r)>5){i*=5;var h=s.add(a._multi(e?5:2.8));n._panTo(h,{duration:e?3*i:2*i,easing:"outExpo"})}else n.onMoveEnd(t)}},e.prototype._rotateStart=function(t){this._start(t),delete this._rotateMode,this.startBearing=this.target.getBearing(),this.target.onDragRotateStart(t),this._db=0},e.prototype._rotating=function(t){var e=this.target,n=t.mousePos.x,i=t.mousePos.y,r=e.getPitch(),o=e.getBearing(),s=Math.abs(n-this.preX),a=Math.abs(i-this.preY);if(this._rotateMode||(this._rotateMode=e.options.dragRotatePitch?"rotate_pitch":s>a?"rotate":s<a?"pitch":"rotate"),!("pitch"===this._rotateMode&&0===r&&a<10)){if(this._rotateMode.indexOf("rotate")>=0&&e.options.dragRotate){var h=.15,l=0;l=e.options.dragPitch||s>a?-.15*(this.preX-n):n>e.width/2?h*(this.preY-i):-.15*(this.preY-i);var u=e.getBearing()+l;this._db=this._db||0,this._db+=l,e._setBearing(u)}this._rotateMode.indexOf("pitch")>=0&&e.options.dragPitch&&e._setPitch(e.getPitch()+.15*(this.preY-i)),this.preX=n,this.preY=i,e.getBearing()===o&&e.getPitch()===r||e.onDragRotating(t)}},e.prototype._rotateEnd=function(t){var e=this.target,n=e.getBearing();this._clear();var i=t0()-this.startDragTime;if(e.onDragRotateEnd(t),e.options.rotateAnimation&&Math.abs(n-this.startBearing)>20&&("rotate"===this._rotateMode||"rotate_pitch"===this._rotateMode)&&!t.interupted&&i<400){var r=e.getBearing();e._animateTo({bearing:r+this._db/1.5},{easing:"outQuint",duration:1600})}},e.prototype._clear=function(){delete this.startPrjCoord,delete this.preX,delete this.preY,delete this.startX,delete this.startY},e}(X3);H9.mergeOptions({draggable:!0,dragPan:!0,dragRotatePitch:!0,dragRotate:!0,dragPitch:!0}),H9.addOnLoadHook("addHandler","draggable",U9);var G9="mousedown mouseup mousemove click dblclick contextmenu touchstart touchmove touchend mouseout",V9={mousemove:["mousemove","mouseover","mouseout","mouseenter"],touchend:["touchend","click"]},W9=function(t){return t&&t.getLayer&&t.on&&t.fire},q9=function(t){return t._getInternalId?t._getInternalId():t.getId?t.getId():null},Z9=function(t,e,n){if(t._onEvent)return t._onEvent(e,n);var i=t.getLayer();return i&&i.fireGeoEvent?i.fireGeoEvent(t,e,n):null},Q9=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.addHooks=function(){var t=this.target,e=t.getPanels().allLayers||t.getContainer();P2(e,G9,this._identifyGeometryEvents,this)},e.prototype.removeHooks=function(){var t=this.target,e=t.getPanels().allLayers||t.getContainer();M2(e,G9,this._identifyGeometryEvents)},e.prototype._identifyGeometryEvents=function(t,e){var n=this.target;if(!n.isInteracting()&&!n._ignoreEvent(t)){var i=null,r=e||t.type;if(T2(r)&&!$$.isTest&&S2(this,n.options.mousemoveThrottleTime))d2(t);else{var o="mousedown"===r||"touchstart"===r&&t.touches&&1===t.touches.length;if(o)this._mouseDownTime=t0();else if(("click"===r||"touchend"===r)&&this._mouseDownTime){var s=this._mouseDownTime;if(delete this._mouseDownTime,t0()-s>300){if("click"===r)return}else"touchend"===r&&(i="click")}var a=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(a){var h=m2(a,n.getContainer());"touchstart"===r&&n.options.preventTouch&&f2(t);for(var l=null,u=this.target.getRenderer().getTopElements(),c=o&&2!==t.button,A=0;A<u.length;A++)if(u[A].hitTest(h)){var f=u[A].options.cursor;if(f&&(l=f),c||u[A].events&&u[A].events.indexOf(r)>=0){var d={target:n,type:r,domEvent:t,containerPoint:h};if(c)return n._setPriorityCursor(l),void u[A].mousedown(d);u[A].onEvent(d)}}var p=n._getLayers((function(t){return!(!t.identify||!t.options.geometryEvents)}));if(p.length){var g={includeInternals:!0,filter:function(e){if(e instanceof M9){var n=e._getEventTypeToFire(t);return"mousemove"===r?(!l&&e.options.cursor&&(l=e.options.cursor),!0):!(!e.listens(n)&&!e.listens(i))}return!!W9(e)},count:1,onlyVisible:n.options.onlyVisibleGeometryEvents,containerPoint:h,layers:p,eventTypes:V9[r]||[r],domEvent:t},m=function(e){var o=this,s=!0,a=function(){return o._prevOverGeos&&o._prevOverGeos.geos||[]},h=function(e,n){if(void 0===e&&(e=[]),void 0===n&&(n={}),e&&e.length>0)for(var i=e.length-1;i>=0;i--){var r=e[i];W9(r)&&(n[q9(e[i])]||(s=Z9(r,t,"mouseout")))}};if("mouseout"===r){var u=a();this._prevOverGeos={geos:[],geomap:{}},h(u,{})}else if("mousemove"===r){var c={};if(e.length>0)for(var A=e.length-1;A>=0;A--){var f=e[A];if(W9(f)){var d=q9(f);c[d]=f,Z9(f,t),this._prevOverGeos&&this._prevOverGeos.geomap[d]||Z9(f,t,"mouseenter"),s=Z9(f,t,"mouseover")}}n._setPriorityCursor(l),u=a(),this._prevOverGeos={geos:e,geomap:c},h(u,c)}else{if(!e||!e.length)return;for(A=e.length-1;A>=0;A--)if(W9(e[A])){s=Z9(e[A],t),i&&Z9(e[A],t,i);break}}!1===s&&d2(t)}.bind(this);T2(r)?this._queryIdentifyTimeout=n.getRenderer().callInNextFrame((function(){n.isInteracting()||n.identifyAtPoint(g,m)})):n.identifyAtPoint(g,m)}}}}},e}(X3);H9.mergeOptions({geometryEvents:!0,onlyVisibleGeometryEvents:!0}),H9.addOnLoadHook("addHandler","geometryEvents",Q9);var X9=4.000244140625,Y9=1/450,J9=function(t){function e(e){var n=t.call(this,e)||this;return n._thisScrollZoom=n._scrollZoom.bind(n),n._thisCheckIfEndZoom=n._checkIfEndZoom.bind(n),n._wheelZoomRate=Y9,n._defaultZoomRate=.01,n._delta=0,n}return W0(e,t),e.prototype.addHooks=function(){u2(this.target._containerDOM,"wheel",this._onWheelScroll,this)},e.prototype.removeHooks=function(){c2(this.target._containerDOM,"wheel",this._onWheelScroll)},e.prototype._onWheelScroll=function(t){var e=this.target;if(e.options.preventWheelScroll&&(f2(t),d2(t)),e._ignoreEvent(t)||e._isEventOutMap(t)||!e.options.zoomable)return!1;var n=e.getContainer(),i=e._checkZoomOrigin(m2(t,n));return e.options.seamlessZoom?(this._zooming||(this._trackPadSuspect=0,this._ensureTrackpad=!1),this._seamless(t,i)):this._interval(t,i)},e.prototype._seamless=function(t,e){var n=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?60*t.deltaY:t.deltaY;if(n%X9!=0&&(this._ensureTrackpad||(Math.abs(n)<60?this._trackPadSuspect++:this._trackPadSuspect=0,this._trackPadSuspect>=2&&(this._ensureTrackpad=!0)),this._ensureTrackpad&&(n*=14)),t.shiftKey&&n&&(n/=4),this._lastWheelEvent=t,n0(this._delta)&&(this._delta=0),this._delta-=n,!this._zooming&&this._delta){var i=this.target;this._zoomOrigin=e,i.onZoomStart(null,e)}this._start()},e.prototype._start=function(){this._delta&&(this._zooming=!0,this._active||(this.target.getRenderer().callInNextFrame(this._thisScrollZoom),this._active=!0))},e.prototype._scrollZoom=function(){if(this._active=!1,this._delta){var t=Math.abs(this._delta)>X9?this._wheelZoomRate:this._defaultZoomRate,e=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==e&&(e=1/e);var n=this.target,i=n.getZoom(),r=n.getZoomForScale(e,i,!0);this._delta=0,n.onZooming(r,this._zoomOrigin),this._scrollTime=performance.now(),n.getRenderer().callInNextFrame(this._thisCheckIfEndZoom)}},e.prototype._checkIfEndZoom=function(){if(this._zooming){var t=this.target;performance.now()-this._scrollTime>210?(this._zooming=!1,t.onZoomEnd(t.getZoom(),this._zoomOrigin)):t.getRenderer().callInNextFrame(this._thisCheckIfEndZoom)}},e.prototype._interval=function(t,e){var n=this,i=this.target;if(this._zooming)return this._requesting++,!1;this._requesting=0;var r=(t.deltaY?-1*t.deltaY:t.wheelDelta?t.wheelDelta:t.detail)>0?1:-1;t.detail&&(r*=-1);var o=i.getZoom(),s=o+r;return(s=i._checkZoom(r>0?Math.ceil(s):Math.floor(s)))===o||(this._zooming=!0,this._delta||(i.onZoomStart(null,e),this._origin=e,this._delta=r,this._startZoom=i.getZoom()),i._animateTo({zoom:s-1*this._delta/2,around:this._origin},{continueOnViewChanged:!0,easing:"linear",duration:90,wheelZoom:!0},(function(e){"finished"===e.state.playState?n._requesting<1||Math.abs(s-n._startZoom)>2||s===i.getMaxZoom()||s===i.getMinZoom()?(i._animateTo({zoom:s,around:n._origin},{continueOnViewChanged:!0,duration:100},(function(t){"running"!==t.state.playState&&(delete n._zooming,delete n._requesting)})),delete n._startZoom,delete n._origin,delete n._delta,n._requesting=0):n0(n._requesting)||(delete n._zooming,n._onWheelScroll(t)):"running"!==e.state.playState&&(delete n._zooming,delete n._requesting)}))),!1},e}(X3);H9.mergeOptions({scrollWheelZoom:!0,seamlessZoom:!0}),H9.addOnLoadHook("addHandler","scrollWheelZoom",J9);var K9=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.addHooks=function(){u2(this.target.getContainer(),"touchstart",this._onTouchStart,this)},e.prototype.removeHooks=function(){c2(this.target.getContainer(),"touchstart",this._onTouchStart)},e.prototype._onTouchStart=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var n=e.getContainer(),i=m2(t.touches[0],n),r=m2(t.touches[1],n);this.preY=i.y,this._startP1=i,this._startP2=r,this._startDist=i.distanceTo(r),this._startVector=i.sub(r),this._startZoom=e.getZoom(),this._startBearing=e.getBearing(),M2(document,"touchmove",this._onTouchMove),M2(document,"touchend",this._onTouchEnd),u2(document,"touchmove",this._onTouchMove,this),u2(document,"touchend",this._onTouchEnd,this),e.options.preventTouch&&f2(t),e._fireEvent("touchactstart")}},e.prototype._onTouchMove=function(t){var e=this.target;if(t.touches&&!(t.touches.length<2)){var n=e.getContainer(),i=m2(t.touches[0],n),r=m2(t.touches[1],n),o=i.sub(this._startP1),s=r.sub(this._startP2),a=i.sub(r),h=i.distanceTo(r)/this._startDist,l=180*a.angleWith(this._startVector)/Math.PI,u=.4*((this.preY||i.y)-i.y);this.preY=i.y;var c={domEvent:t,mousePos:[i,r]};if(this.mode||(e.options.touchRotate&&Math.abs(l)>8?this.mode=e.options.touchZoomRotate?"rotate_zoom":"rotate":e.options.touchPitch&&o.y*s.y>0&&Math.abs(o.y)>10&&Math.abs(s.y)>10?this.mode="pitch":e.options.zoomable&&e.options.touchZoom&&Math.abs(1-h)>.15&&(this.mode=e.options.touchZoomRotate&&e.options.touchRotate?"rotate_zoom":"zoom"),this._startTouching(c)),"zoom"===this.mode||"rotate_zoom"===this.mode){this._scale=h;var A=e._getResolution(this._startZoom)/h,f=e.getZoomFromRes(A);e.onZooming(f,this._Origin)}"rotate"===this.mode||"rotate_zoom"===this.mode?(e._setBearing(this._startBearing+l),e.onDragRotating(c)):"pitch"===this.mode&&(e._setPitch(e.getPitch()+u),e.onDragRotating(c)),e._fireEvent("touchactinging")}},e.prototype._startTouching=function(t){var e=this.target;if("zoom"===this.mode||"rotate_zoom"===this.mode){var n=e.getSize();this._Origin=new $0(n.width/2,n.height/2),e.onZoomStart(null,this._Origin)}"rotate"!==this.mode&&"pitch"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateStart(t)},e.prototype._onTouchEnd=function(t){delete this.preY;var e=this.target;if(M2(document,"touchmove",this._onTouchMove),M2(document,"touchend",this._onTouchEnd),"zoom"===this.mode||"rotate_zoom"===this.mode){var n=this._scale,i=e._getResolution(this._startZoom)/n,r=e.getZoomFromRes(i);e.onZoomEnd(r,this._Origin)}"pitch"!==this.mode&&"rotate"!==this.mode&&"rotate_zoom"!==this.mode||e.onDragRotateEnd({domEvent:t}),delete this.mode,e._fireEvent("touchactend")},e}(X3);H9.mergeOptions({touchGesture:!0,touchZoom:!0,touchPitch:!0,touchRotate:!0,touchZoomRotate:!1}),H9.addOnLoadHook("addHandler","touchGesture",K9);var $9="__anim_player",t7={outExpo:function(t){return 1===t?1:1-Math.pow(2,-10*t)},outQuint:function(t){return 1-Math.pow(1-t,5)},in:function(t){return Math.pow(t,2)},out:function(t){return 1-t7.in(1-t)},inAndOut:function(t){return 3*t*t-2*t*t*t},linear:function(t){return t},upAndDown:function(t){return t<.5?t7.inAndOut(2*t):1-t7.inAndOut(2*(t-.5))}},e7=function(){function t(t,e){this.state=t,this.styles=e}return Object.defineProperty(t.prototype,"playState",{get:function(){return this.state.playState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"symbol",{get:function(){return this.styles.symbol},enumerable:!1,configurable:!0}),t}(),n7=function(){function t(t,e,n,i){this._animation=t,this.options=e,this._onFrame=n,this.playState="idle",this.ready=!0,this.finished=!1,this.target=i}return t.prototype._prepare=function(){var t=this.options,e=t.speed||t.duration;s0(e)&&((e=i7.speed[e])||(e=+e)),e||(e=i7.speed.normal),this.duration=e,this._framer=t.framer||i7._requestAnimFrame.bind(i7)},t.prototype.play=function(){if("idle"!==this.playState&&"paused"!==this.playState||this.target&&this.target[$9])return this;this.target&&(this.target[$9]=1),"idle"===this.playState&&(this.currentTime=0,this._prepare());var t=t0();if(!this.startTime){var e=this.options;this.startTime=e.startTime?e.startTime:t}return this._playStartTime=Math.max(t,this.startTime),"paused"===this.playState&&(this._playStartTime-=this.currentTime),this.playState="running",this._run(),this},t.prototype.pause=function(){return"paused"===this.playState||(this.playState="paused",this._run()),this},t.prototype.cancel=function(){return"idle"===this.playState||(this.playState="idle",this.finished=!1,this._run()),this},t.prototype.finish=function(){return"finished"===this.playState||(this.playState="finished",this.finished=!0,this._run()),this},t.prototype.reverse=function(){},t.prototype._run=function(){var t=this,e=this._onFrame,n=t0(),i=n-this._playStartTime;if(this.options.repeat&&i>=this.duration&&(this._playStartTime=n,i=0),"running"===this.playState){var r=this._animation(i,this.duration);this.playState=r.state.playState,"running"!==this.playState&&this.target&&delete this.target[$9],"idle"===this.playState?this.startTime>n&&setTimeout(this._run.bind(this),this.startTime-n):"running"===this.playState?this._framer((function(){"running"===t.playState&&(t.currentTime=i,e&&e(r),t._run())})):"finished"===this.playState&&(this.finished=!0,e&&e(r))}else if(this.target&&delete this.target[$9],e){"finished"===this.playState?i=this.duration:"idle"===this.playState&&(i=0);var o=this._animation(i,this.duration);o.state.playState=this.playState,e(o)}},t}(),i7={speed:{slow:2e3,normal:1e3,fast:500},_resolveStyles:function(t){if(!t)return null;function e(t){if(!Array.isArray(t))return i7._resolveStyles(t);for(var e=[],n=[],i=[],r=0;r<t.length;r++){var o=i7._resolveStyles(t[r]);o&&(e.push(o[0]),n.push(o[1]),i.push(o[2]))}return e.length?[e,n,i]:null}function n(t){var e,n=t;Array.isArray(t)||(n=i0(t)?[0,t]:t instanceof $0||t instanceof F4?[new(e=t.constructor)(0,0),t]:[t,t]);var i=n[0],r=n[1];return i0(i)&&i0(r)?i===r?null:[i,r-i,r]:Array.isArray(i)&&i0(i[0])||i instanceof F4||i instanceof $0?(Array.isArray(i)?(i=new F4(i),r=new F4(r)):(i=new(e=i.constructor)(i),r=new e(r)),i.equals(r)?null:[i,r.sub(i),r]):[i,r,r]}var i,r={},o={},s={};for(var a in t)if(t.hasOwnProperty(a)){var h=t[a];if(!h)continue;if(Array.isArray(h)&&(n0(h[0])||n0(h[1])))continue;var l=void 0;i=h,(l=!Array.isArray(i)&&i.constructor===Object||Array.isArray(i)&&i[0].constructor===Object?e(h):n(h))&&(o[a]=l[0],r[a]=l[1],s[a]=l[2])}return[o,r,s]},framing:function(t,e){e||(e={});var n,i,r,o=e.easing?t7[e.easing]:t7.linear;o||(o=t7.linear),(t=i7._resolveStyles(t))&&(i=t[0],n=t[1],r=t[2]);var s=function(t,e,n){if(!e||!n)return null;var i={};for(var o in n)if(n.hasOwnProperty(o)){if(e[o]===r[o]){i[o]=e[o];continue}var a=e[o],h=n[o];if(i0(h))i[o]=a+t*h;else if(Array.isArray(h)){for(var l=[],u=0;u<h.length;u++)l.push(s(t,a[u],h[u]));i[o]=l}else i[o]=h.constructor===Object?s(t,a,h):a instanceof $0||a instanceof F4?a.add(h.multi(t)):h}return i};return function(t,e){var a,h;if(t<0)a={playState:"idle",delta:0},h=i;else if(t<e){var l=o(t/e);a={playState:"running",delta:l},h=s(l,i,n)}else a={playState:"finished",delta:1},h=r;return a.startStyles=i,a.destStyles=r,a.progress=t,a.remainingMs=e-t,new e7(a,h)}},_requestAnimFrame:function(t){this._frameQueue||(this._frameQueue=[]),this._frameQueue.push(t),this._a()},_a:function(){this._animationFrameId||(this._animationFrameId=Y0(i7._frameFn))},_run:function(){if(this._frameQueue.length){var t=this._frameQueue;this._frameQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]();this._frameQueue.length?this._animationFrameId=Y0(i7._frameFn):delete this._animationFrameId}},animate:function(t,e,n,i){e||(e={});var r=i7.framing(t,e);return new n7(r,e,n,i)},_frameFn:function(){}};i7._frameFn=i7._run.bind(i7);var r7={exports:{}};!function(t){!function(){function e(t,e,n){var i=e.x,r=e.y,o=n.x-i,s=n.y-r;if(0!==o||0!==s){var a=((t.x-i)*o+(t.y-r)*s)/(o*o+s*s);a>1?(i=n.x,r=n.y):a>0&&(i+=o*a,r+=s*a)}return(o=t.x-i)*o+(s=t.y-r)*s}function n(t,i,r,o,s){for(var a,h=o,l=i+1;l<r;l++){var u=e(t[l],t[i],t[r]);u>h&&(a=l,h=u)}h>o&&(a-i>1&&n(t,i,a,o,s),s.push(t[a]),r-a>1&&n(t,a,r,o,s))}function i(t,e){var i=t.length-1,r=[t[0]];return n(t,0,i,e,r),r.push(t[i]),r}function r(t,e,n){if(t.length<=2)return t;var r=void 0!==e?e*e:1;return i(t=n?t:function(t,e){for(var n,i,r,o,s,a=t[0],h=[a],l=1,u=t.length;l<u;l++)o=void 0,s=void 0,(o=(i=n=t[l]).x-(r=a).x)*o+(s=i.y-r.y)*s>e&&(h.push(n),a=n);return a!==n&&h.push(n),h}(t,r),r)}t.exports=r,t.exports.default=r}()}(r7);var o7=H5(r7.exports),s7="not find Geometry' Projection. please add Geometry to Layer and add Layer to Map",a7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.animateShow=function(t,e){var n=this;void 0===t&&(t={}),this._showPlayer&&this._showPlayer.finish(),a0(t)&&(e=t={});var i=this.getCoordinates();if(0!==i.length){this._animIdx=0,this._animLenSoFar=0,this.show();var r=this.getShell?this.getShell().concat(this.getShell()[0]):i,o=this._getProjection();if(o){var s=o.projectCoords(r,this.options.antiMeridian);this._prjAniShowCenter=this._getPrjExtent().getCenter(),this._aniShowCenter=o.unproject(this._prjAniShowCenter);var a=t.duration||1e3,h=t.easing||"out";this.setCoordinates([]);var l=0;s.length&&(s[0]._distance=0);for(var u=1;u<s.length;u++){var c=s[u].distanceTo(s[u-1]);s[u]._distance=c,l+=c}this._tempCoord=new F4(0,0),this._tempPrjCoord=new $0(0,0);var A=this._showPlayer=i7.animate({t:a},{duration:a,easing:h},(function(t){if(n.getMap()){var o=n._drawAnimShowFrame(t.styles.t,a,l,r,s);"finished"===t.state.playState&&(delete n._showPlayer,delete n._aniShowCenter,delete n._prjAniShowCenter,delete n._animIdx,delete n._animLenSoFar,delete n._animTailRatio,delete n._tempCoord,delete n._tempPrjCoord,n.setCoordinates(i)),e&&e(t,o)}else if("finished"!==A.playState&&(A.finish(),e)){var h=n.getCoordinates();e(t,h[h.length-1])}}),this);return A.play(),A}console.error(s7)}},e.prototype._drawAnimShowFrame=function(t,e,n,i,r){if(0===t)return i[0];var o,s,a=t/e*n,h=0;for(o=this._animIdx+1,s=r.length;o<s&&!(this._animLenSoFar+(h=r[o]._distance)>a);o++)this._animLenSoFar+=h;if(this._animIdx=o-1,this._animIdx>=s-1)return this.setCoordinates(i),i[i.length-1];var l=this._animIdx,u=r[l],c=r[l+1],A=(a-this._animLenSoFar)/h;this._animTailRatio=A;var f=u.y+(c.y-u.y)*A;this._tempPrjCoord.x=u.x+(c.x-u.x)*A,this._tempPrjCoord.y=f;var d=this._tempPrjCoord,p=i[l],g=i[l+1],m=p.y+(g.y-p.y)*A;this._tempCoord.x=p.x+(g.x-p.x)*A,this._tempCoord.y=m;var y=this._tempCoord,v=!!this.getShell;if(!v&&this.options.smoothness>0){for(var _=[],x=[],b=0;b<=this._animIdx;b++)_.push(i[b]),x.push(r[b]);_.push(y,y),x.push(d,d),this.setCoordinates(_),this._setPrjCoordinates(x)}else(_=i.slice(0,this._animIdx+1)).push(y),(x=r.slice(0,this._animIdx+1)).push(d),v?(this.setCoordinates([this._aniShowCenter].concat(_)),this._setPrjCoordinates([this._prjAniShowCenter].concat(x))):(this.setCoordinates(_),this._setPrjCoordinates(x));return y},e.prototype._getCenterInExtent=function(t,e,n){var i=this.getExtent();if(!t.intersects(i))return null;var r=n(e,t);if(0===r.length)return null;var o=Q0([0,0,0],3),s=o[0],a=o[1],h=o[2];r.forEach((function(t){Array.isArray(t)?t.forEach((function(t){t.point&&(t=t.point),s+=t.x,a+=t.y,h++})):(t.point&&(t=t.point),s+=t.x,a+=t.y,h++)}));var l=new F4(s,a)._multi(1/h);return l.count=h,l},e.prototype._getPath2DPoints=function(t,e,n){if(!d1(t))return[];var i=this.getMap(),r=!e&&this._shouldSimplify(),o=this.options.simplifyTolerance*i._getResolution(),s=Array.isArray(t[0]);if(delete this._simplified,r&&!s){var a=t.length;t=o7(t,o,!1),this._simplified=t.length<a}if(n||(n=i._getResolution()),Array.isArray(t)){var h=[],l="_glPt";if(!Array.isArray(t[0]))return h=P1(t,l),i._prjsToPointsAtRes(t,n,h);for(var u=[],c=0,A=t.length;c<A;c++){var f=t[c];h=P1(f,l);var d=i._prjsToPointsAtRes(f,n,h);u.push(d)}return u}return i._prjToPointAtRes(t,n)},e.prototype._shouldSimplify=function(){var t=this.getLayer();return t&&t.options.enableSimplify&&!t.options.enableAltitude&&this.options.enableSimplify&&!this._showPlayer},e.prototype._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},e.prototype._getPrjCoordinates=function(){return this._verifyProjection(),!this._prjCoords&&this._getProjection()&&(this._prjCoords=this._projectCoords(this._coordinates)),this._prjCoords},e.prototype._updateCache=function(){this._clearCache(),this._getProjection()&&this._prjCoords&&(this._coordinates=this._unprojectCoords(this._getPrjCoordinates()))},e.prototype._clearProjection=function(){this._prjCoords=null,t.prototype._clearProjection.call(this)},e.prototype._projectCoords=function(t){var e=this._getProjection();return e?e.projectCoords(t,this.options.antiMeridian):[]},e.prototype._unprojectCoords=function(t){var e=this._getProjection();return e?e.unprojectCoords(t):[]},e.prototype._computeCenter=function(){var t=this._coordinates;if(!d1(t))return null;for(var e=0,n=0,i=0,r=t.length,o=0;o<r;o++)t[o]&&i0(t[o].x)&&i0(t[o].y)&&(e+=t[o].x,n+=t[o].y,i++);return new F4(e/i,n/i)},e.prototype._computeExtent=function(t){var e,n=this._coordinates;if(!d1(n))return null;var i=[n];return this.hasHoles&&this.hasHoles()&&(e=i.push).call.apply(e,X0([i],Q0(this.getHoles()),!1)),this._coords2Extent(i,this._getProjection())},e.prototype._computePrjExtent=function(t){var e,n=[this._getPrjCoordinates()];return this.hasHoles&&this.hasHoles()&&(e=n.push).call.apply(e,X0([n],Q0(this._getPrjHoles()),!1)),this._coords2Extent(n)},e.prototype._get2DLength=function(){for(var t=this._getPath2DPoints(this._getPrjCoordinates(),!0),e=0,n=1,i=t.length;n<i;n++)e+=t[n].distanceTo(t[n-1]);return e},e.prototype._hitTestTolerance=function(){var e,n=this._getInternalSymbol();if(Array.isArray(n)){e=0;for(var i=0;i<n.length;i++)i0(n[i].lineWidth)&&n[i].lineWidth>e&&(e=n[i].lineWidth)}else e=n.lineWidth;return t.prototype._hitTestTolerance.call(this)+(i0(e)?e/2:1.5)},e.prototype._coords2Extent=function(t,e){if(!t||0===t.length||Array.isArray(t[0])&&0===t[0].length)return null;for(var n=new X4(e),i=0,r=t.length;i<r;i++)for(var o=0,s=t[i].length;o<s;o++)n._combine(t[i][o]);return n},e}(M9);a7.mergeOptions({smoothness:!1,enableClip:!0,enableSimplify:!0,simplifyTolerance:2,symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:1,opacity:1}});var h7="Polygon",l7=function(t){function e(e,n){var i=t.call(this,n)||this;return i.type="Polygon",e&&i.setCoordinates(e),i}return W0(e,t),e.prototype.getOutline=function(){return this._getPainter()?new e(this.getExtent().toArray(),{symbol:{lineWidth:1,lineColor:"6b707b"}}):null},e.prototype.setCoordinates=function(t){if(!t)return this._coordinates=null,this._holes=null,this._projectRings(),this;var e=F4.toCoordinates(t),n=e.length;if(Array.isArray(e[0]))if(this._coordinates=this._trimRing(e[0]),n>1){for(var i=[],r=1;r<n;r++)e[r]&&i.push(this._trimRing(e[r]));this._holes=i}else this._holes=null;else this._coordinates=this._trimRing(e);return this._projectRings(),this},e.prototype.getCoordinates=function(){if(!this._coordinates)return[];for(var t=this.getHoles(),e=[this._copyAndCloseRing(this._coordinates)],n=0,i=t.length;n<i;n++)e.push(this._copyAndCloseRing(t[n]));return e},e.prototype.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getShell(),w6)},e.prototype.getShell=function(){return this._coordinates||[]},e.prototype.getHoles=function(){return this._holes||[]},e.prototype.hasHoles=function(){return this.getHoles().length>0},e.prototype._projectRings=function(){this.getMap()?(this._prjCoords=this._projectCoords(this._coordinates),this._prjHoles=this._projectCoords(this._holes),this.onShapeChanged()):this.onShapeChanged()},e.prototype._setPrjCoordinates=function(t){this._prjCoords=t,this.onShapeChanged()},e.prototype._cleanRing=function(t){for(var e=t.length-1;e>=0;e--)t[e]||t.splice(e,1)},e.prototype._checkRing=function(t){if(this._cleanRing(t),!t||!d1(t))return!1;var e=t[t.length-1],n=!0;return t[0].x===e.x&&t[0].y===e.y||(n=!1),n},e.prototype._trimRing=function(t){var e=this._checkRing(t);return d1(t)&&e&&t.splice(t.length-1,1),t},e.prototype._copyAndCloseRing=function(t){t=t.slice(0);var e=this._checkRing(t);return d1(t)&&!e?(t.push(t[0].copy()),t):t},e.prototype._getPrjShell=function(){return this.getJSONType()===h7?this._getPrjCoordinates():(this._verifyProjection(),this._getProjection()&&!this._prjShell&&(this._prjShell=this._projectCoords(this._getShell?this._getShell():this.getShell())),this._prjShell)},e.prototype._getPrjHoles=function(){var t=this._getProjection();return this._verifyProjection(),t&&!this._prjHoles&&(this._prjHoles=this._projectCoords(this.getHoles())),this._prjHoles},e.prototype._computeGeodesicLength=function(t){var e=this.getCoordinates();if(!d1(e))return 0;for(var n=0,i=0,r=e.length;i<r;i++)n+=t.measureLength(e[i]);return n},e.prototype._computeGeodesicArea=function(t){var e=this.getCoordinates();if(!d1(e))return 0;for(var n=t.measureArea(e[0]),i=1,r=e.length;i<r;i++)n-=t.measureArea(e[i]);return n},e.prototype._updateCache=function(){t.prototype._updateCache.call(this),this._prjHoles&&(this._holes=this._unprojectCoords(this._getPrjHoles()))},e.prototype._clearCache=function(){return delete this._prjShell,t.prototype._clearCache.call(this)},e.prototype._clearProjection=function(){this._prjHoles&&(this._prjHoles=null),this._prjShell&&(this._prjShell=null),t.prototype._clearProjection.call(this)},e}(a7);function u7(t){return function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.getCoordinates=function(){return this._coordinates},e.prototype.setCoordinates=function(t){var e=t instanceof F4?t:new F4(t);if(this._translateRotatePivot(e),this._coordinates=e,!this.getMap())return this._dirtyCoords=!0,this.onPositionChanged(),this;var n=this._getProjection();return this._setPrjCoordinates(n.project(this._coordinates)),this},e.prototype._getCenter2DPoint=function(t){var e=this.getMap();if(!e)return null;var n=this._getPrjCoordinates();return n?(t||(t=e._getResolution()),e._prjToPointAtRes(n,t)):null},e.prototype._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pcenter&&t&&this._coordinates&&(this._pcenter=t.project(this._coordinates)),this._pcenter},e.prototype._setPrjCoordinates=function(t){this._pcenter=t,this.onPositionChanged()},e.prototype._updateCache=function(){this._clearCache();var t=this._getProjection();this._pcenter&&t&&(this._coordinates=t.unproject(this._pcenter))},e.prototype._clearProjection=function(){this._pcenter=null,t.prototype._clearProjection.call(this)},e.prototype._computeCenter=function(){return this._coordinates?this._coordinates.copy():null},e}(t)}l7.registerJSONType(h7);var c7=new Y4,A7=function(t){function e(e,n){var i=t.call(this,n)||this;return i.type="Point",i.isPoint=!0,e&&i.setCoordinates(e),i}return W0(e,t),e.prototype.getOutline=function(){var t=this.getCoordinates(),n=this.getContainerExtent(),i=this.getMap().coordToContainerPoint(t);return new e(t,{symbol:{markerType:"square",markerWidth:n.getWidth(),markerHeight:n.getHeight(),markerLineWidth:1,markerLineColor:"6b707b",markerFill:"rgba(0, 0, 0, 0)",markerDx:n.xmin-(i.x-n.getWidth()/2),markerDy:n.ymin-(i.y-n.getHeight()/2)}})},e.prototype.setSymbol=function(e){return delete this._fixedExtent,t.prototype.setSymbol.call(this,e)},e.prototype._getSizeSymbol=function(t){for(var e,n={},i=!1,r=!1,o=0;o<y6.length;o++)n0(s=t[y6[o]])||(!i&&J2(s)&&(i=!0,r=!0),n[y6[o]]=s);for(o=0;o<v6.length;o++){var s;n0(s=t[v6[o]])||(!i&&J2(s)&&(i=!0),n[v6[o]]=s)}return i?(e=v5(n,this),r&&(e._dynamic=!0)):e=n,e},e.prototype._setExternSymbol=function(e){return this._symbol||delete this._fixedExtent,t.prototype._setExternSymbol.call(this,e)},e.prototype._isDynamicSize=function(){return this._sizeSymbol&&this._sizeSymbol._dynamic},e.prototype._getFixedExtent=function(){if(this._fixedExtent&&!this._isDynamicSize())return this._fixedExtent;this._fixedExtent=this._fixedExtent||new Y4,this._fixedExtent.set(null,null,null,null);var t=this._sizeSymbol;if(!t)return this._fixedExtent;var e=this.getLayer()&&this.getLayer().getRenderer(),n=e&&e.resources,i=this.getTextDesc();if(Array.isArray(t)){c7.set(1/0,1/0,-1/0,-1/0);for(var r=0;r<t.length;r++)t[r]&&this._fixedExtent._combine(A6(c7,t[r],n,i&&i[r]))}else this._fixedExtent=A6(this._fixedExtent,t,n,i);return this._fixedExtent},e.prototype._isVectorMarker=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&p6(t)},e.prototype._canEdit=function(){var t=this._getInternalSymbol();return!Array.isArray(t)&&(p6(t)||g6(t)||d6(t))},e.prototype._containsPoint=function(e,n){var i=this.getContainerExtent();return n&&(i=i.expand(n)),!!i.contains(e)&&(!this.options.hitTestForEvent||t.prototype._containsPoint.call(this,e,n))},e.prototype._computeExtent=function(){return f7.call(this,"getCenter")},e.prototype._computePrjExtent=function(){return f7.call(this,"_getPrjCoordinates")},e.prototype._computeGeodesicLength=function(){return 0},e.prototype._computeGeodesicArea=function(){return 0},e.prototype._getSprite=function(t,e){return this._getPainter()?this._getPainter().getSprite(t,e):new h9(this).getSprite(t,e)},e}(u7(M9));function f7(t){var e=this[t]();return e?new X4(e,e,this._getProjection()):null}A7.mergeOptions({symbol:{markerType:"path",markerPath:[{path:"M8 23l0 0 0 0 0 0 0 0 0 0c-4,-5 -8,-10 -8,-14 0,-5 4,-9 8,-9l0 0 0 0c4,0 8,4 8,9 0,4 -4,9 -8,14z M3,9 a5,5 0,1,0,0,-0.9Z",fill:"#DE3333"}],markerPathWidth:16,markerPathHeight:23,markerWidth:24,markerHeight:34},hitTestForEvent:!1,collision:!0}),A7.registerJSONType("Marker");var d7=function(t){function e(e,n){var i=t.call(this,n)||this;return i.type="LineString",e&&i.setCoordinates(e),i}return W0(e,t),e.prototype.getOutline=function(){return l7.prototype.getOutline.call(this)},e.prototype.setCoordinates=function(t){return t?(this._coordinates=F4.toCoordinates(t),this.getMap()?this._setPrjCoordinates(this._projectCoords(this._coordinates)):this.onShapeChanged(),this):(this._coordinates=null,this._setPrjCoordinates(null),this)},e.prototype.getCoordinates=function(){return this._coordinates||[]},e.prototype.getCenterInExtent=function(t){return this._getCenterInExtent(t,this.getCoordinates(),x6)},e.prototype._computeGeodesicLength=function(t){return t.measureLength(this.getCoordinates())},e.prototype._computeGeodesicArea=function(){return 0},e}(a7);d7.mergeOptions({arrowStyle:null,arrowPlacement:"vertex-last"}),d7.registerJSONType("LineString");var p7=new Y4,g7=function(t){function e(e,n){var i=t.call(this,n)||this;return i.type="GeometryCollection",i.setGeometries(e),i}return W0(e,t),e.prototype.getContainerExtent=function(t){var e=t||new Y4;return this.forEach((function(t){e._combine(t.getContainerExtent(p7))})),e},e.prototype.setGeometries=function(t){for(var e=this._checkGeometries(t||[]),n=this._getSymbol(),i=this.config(),r=this.getProperties(),o=e.length-1;o>=0;o--)e[o]._initOptions(i),e[o]._setParent(this),e[o]._setEventParent(this),n&&e[o].setSymbol(n),r&&e[o].setProperties(r);return this._geometries=e,this.getLayer()&&(this._bindGeometriesToLayer(),this.onShapeChanged()),this},e.prototype.getGeometries=function(){return this._geometries||[]},e.prototype.forEach=function(t,e){for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i]&&(e?t.call(e,n[i],i):t(n[i],i));return this},e.prototype.filter=function(t,n){if(!t)return new e;var i=[],r=a0(t),o=r?t:r5(t);return this.forEach((function(t){var e=r?t:d5(t);(n?o.call(n,e):o(e))&&i.push(t)}),this),new e(i)},e.prototype.translate=function(t){if(!t)return this;if(this.isEmpty())return this;var e=arguments;return this.forEach((function(t){t&&t.translate&&t.translate.apply(t,e)})),this},e.prototype.isEmpty=function(){return!d1(this.getGeometries())},e.prototype.remove=function(){return this.forEach((function(t){t._unbind()})),M9.prototype.remove.apply(this,arguments)},e.prototype.show=function(){return this.options.visible=!0,this.forEach((function(t){t.show()})),this},e.prototype.hide=function(){return this.options.visible=!1,this.forEach((function(t){t.hide()})),this},e.prototype.onConfig=function(t){this.forEach((function(e){e.config(t)}))},e.prototype.getSymbol=function(){var e=t.prototype.getSymbol.call(this);if(!e){var n=[],i=!1;this.forEach((function(t){t.getSymbol()&&!i&&(i=!0),n.push(t.getSymbol())})),i&&(e={children:n})}return e},e.prototype.setSymbol=function(t){var e=this;if(t&&t.children)this._symbol=null,this.forEach((function(n,i){n._eventSymbolProperties=e._eventSymbolProperties,n.setSymbol(t.children[i])}));else{var n=this._prepareSymbol(t);this._symbol=n,this.forEach((function(t){t._eventSymbolProperties=e._eventSymbolProperties,t.setSymbol(n)}))}return this.onSymbolChanged(),this},e.prototype._setExternSymbol=function(t){return t=this._prepareSymbol(t),this._externSymbol=t,this.forEach((function(e){e._setExternSymbol(t)})),this.onSymbolChanged(),this},e.prototype._bindLayer=function(){t.prototype._bindLayer.apply(this,arguments),this._bindGeometriesToLayer()},e.prototype._bindGeometriesToLayer=function(){var t=this.getLayer();this.forEach((function(e){e._bindLayer(t)}))},e.prototype._checkGeometries=function(t){for(var e=[],n=0,i=(t=Array.isArray(t)?t:[t]).length;n<i;n++){var r=t[n];r&&(this._checkGeo(r)?y7(r)?console.error(r," is GeometryCollection sub class,it Cannot be placed in GeometryCollection"):e.push(r):console.error("The geometry added to collection is invalid. Index: "+n))}return e},e.prototype._checkGeo=function(t){return t instanceof M9},e.prototype._updateCache=function(){this._clearCache(),this.isEmpty()||this.forEach((function(t){t&&t._updateCache&&t._updateCache()}))},e.prototype._removePainter=function(){this._painter&&this._painter.remove(),delete this._painter,this.forEach((function(t){t._removePainter()}))},e.prototype._computeCenter=function(t){if(!t||this.isEmpty())return null;for(var e=0,n=0,i=0,r=this.getGeometries(),o=0,s=r.length;o<s;o++)if(r[o]){var a=r[o]._computeCenter(t);a&&(e+=a.x,n+=a.y,i++)}return 0===i?null:new F4(e/i,n/i)},e.prototype._containsPoint=function(t,e){if(this.isEmpty())return!1;delete this._pickGeometryIndex;for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)if(n[i]._containsPoint(t,e))return this._pickGeometryIndex=i,!0;return!1},e.prototype._hitTestTolerance=function(){for(var t=this.getGeometries(),e=0,n=0,i=t.length;n<i;n++){var r=t[n]._hitTestTolerance();e=Math.max(e,r)}return e},e.prototype._computeExtent=function(t){return m7.call(this,t,"_computeExtent")},e.prototype._computePrjExtent=function(t){return m7.call(this,t,"_computePrjExtent")},e.prototype._computeGeodesicLength=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,i=0,r=e.length;i<r;i++)e[i]&&(n+=e[i]._computeGeodesicLength(t));return n},e.prototype._computeGeodesicArea=function(t){if(!t||this.isEmpty())return 0;for(var e=this.getGeometries(),n=0,i=0,r=e.length;i<r;i++)e[i]&&(n+=e[i]._computeGeodesicArea(t));return n},e.prototype._exportGeoJSONGeometry=function(){var t=[];if(!this.isEmpty())for(var e=this.getGeometries(),n=0,i=e.length;n<i;n++)e[n]&&t.push(e[n]._exportGeoJSONGeometry());return{type:"GeometryCollection",geometries:t}},e.prototype._toJSON=function(t){t=e0({},t);var e,n={type:"Feature",geometry:{type:"GeometryCollection",geometries:this.getGeometries().filter((function(t){return t&&t._toJSON})).map((function(t){var e=t._toJSON();return e.subType?e:t._exportGeoJSONGeometry()}))}},i=this.getId();return n0(i)||(n.id=i),(n0(t.properties)||t.properties)&&(e=this._exportProperties()),n.properties=e,t.feature=n,t},e.prototype._clearProjection=function(){if(!this.isEmpty())for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e]&&t[e]._clearProjection()},e.prototype._getConnectPoints=function(){var t=this.getExtent();return[new F4(t.xmin,t.ymax),new F4(t.xmax,t.ymin),new F4(t.xmin,t.ymin),new F4(t.xmax,t.ymax)]},e.prototype._getExternalResources=function(){if(this.isEmpty())return[];for(var t,e,n=this.getGeometries(),i=[],r={},o=0,s=n.length;o<s;o++)if(n[o])for(var a=0,h=(t=x5(n[o]._getInternalSymbol())).length;a<h;a++)r[e=t[a].join()]||(i.push(t[a]),r[e]=1);return i},e.prototype.startEdit=function(t){var e=this;if(this.isEmpty())return this;t||(t={}),t.symbol&&(this._originalSymbol=this.getSymbol(),this.setSymbol(t.symbol)),this._draggbleBeforeEdit=this.options.draggable,this.config("draggable",!1),this._recordVisible();for(var n=this.getGeometries(),i=0,r=n.length;i<r;i++)n[i].startEdit(t);this._editing=!0;var o=this.getLayer();return o&&"canvas"===o.options.renderer&&this.hide(),setTimeout((function(){e.fire("editstart")}),1),this},e.prototype.endEdit=function(){if(this.isEmpty())return this;this._recoveryVisible();for(var t=this.getGeometries(),e=0,n=t.length;e<n;e++)t[e].endEdit();return this._originalSymbol&&(this.setSymbol(this._originalSymbol),delete this._originalSymbol),this._editing=!1,this.show(),this.config("draggable",this._draggbleBeforeEdit),this.fire("editend"),this},e.prototype.isEditing=function(){return!!this._editing},e}(M9);function m7(t,e){if(this.isEmpty())return null;for(var n=new X4,i=this.getGeometries(),r=0,o=i.length;r<o;r++)if(i[r]){var s=i[r][e](t);s&&n._combine(s)}return n}function y7(t){return t instanceof g7}g7.registerJSONType("GeometryCollection");var v7=function(t){function e(e,n,i,r){var o=t.call(this,null,r)||this;return o.GeometryType=e,o.type=n,o._initData(i),o}return W0(e,t),e.prototype.getCoordinates=function(){for(var t=[],e=this.getGeometries(),n=0,i=e.length;n<i;n++){var r=e[n];t.push(r.getShell&&"Polygon"!==r.getJSONType()?[r.getShell()]:r.getCoordinates())}return t},e.prototype.setCoordinates=function(t){for(var e=[],n=0,i=(t=t||[]).length;n<i;n++){var r=new this.GeometryType(t[n],this.config());e.push(r)}return this.setGeometries(e),this},e.prototype._initData=function(t){(t=t||[]).length&&(t[0]instanceof this.GeometryType?this.setGeometries(t):this.setCoordinates(t))},e.prototype._checkGeo=function(t){return t instanceof this.GeometryType},e.prototype._exportGeoJSONGeometry=function(){var t=this.getCoordinates(),e=F4.toNumberArrays(t);return{type:this.getType(),coordinates:e}},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t)}},e}(g7),_7=function(t){function e(e,n){return t.call(this,A7,"MultiPoint",e,n)||this}return W0(e,t),e.prototype.findClosest=function(t){if(!t)return null;var e=this.getCoordinates(),n=null,i=1/0;return e.forEach((function(e){var r,o,s,a,h=(r=e,s=(o=t).x-r.x,a=o.y-r.y,Math.sqrt(s*s+a*a));h<i&&(n=e,i=h)})),n},e}(v7);_7.registerJSONType("MultiPoint");var x7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.getCenterInExtent=function(t){var e=this.getGeometries(),n=Q0([0,0,0],3),i=n[0],r=n[1],o=n[2];return e.forEach((function(e){var n=e.getCenterInExtent(t);n&&(i+=n.x*n.count,r+=n.y*n.count,o+=n.count)})),0===o?null:new F4(i,r)._multi(1/o)},e}(v7),b7=function(t){function e(e,n){return t.call(this,d7,"MultiLineString",e,n)||this}return W0(e,t),e}(x7);b7.registerJSONType("MultiLineString");var w7=function(t){function e(e,n){return t.call(this,l7,"MultiPolygon",e,n)||this}return W0(e,t),e}(x7);w7.registerJSONType("MultiPolygon");var C7,P7={Marker:A7,LineString:d7,Polygon:l7,MultiPoint:_7,MultiLineString:b7,MultiPolygon:w7},M7="geojson-fetch-worker-page-async",T7=function(t){function e(){return t.call(this,M7)||this}return W0(e,t),e.prototype._sendMsg=function(t,e,n){var i=this;this.send(t,[],(function(r,o){r?n(r):i._pageFeatures(t,o,e,n)}),t.workerId)},e.prototype._fetchGeoJSON=function(t,e,n,i){void 0===n&&(n=[]);var r=e0({},e);r.type="fetchdata",r.url=t,this._sendMsg(r,n,i)},e.prototype._pageFeatures=function(t,e,n,i){if(n.push(e),0!==e.length){var r=e0({},t);r.type="pagefeatures",this._sendMsg(r,n,i)}else i(null,n)},e}(U8);c3(M7,(function(){return"\nfunction (exports) {\n    const resultMap = {};\n\n    function handleResult(msg, postResponse) {\n        const data = msg.data || {};\n        const { taskId } = data;\n        const features = resultMap[taskId];\n        if (!features) {\n            postResponse('not find geojson dataset the taskId:' + taskId);\n            return;\n        }\n        if (features.length === 0) {\n            delete resultMap[taskId];\n            postResponse(null, []);\n            return;\n        }\n        const pageSize = data.pageSize || 2000;\n        const pageFeatures = features.slice(0, pageSize);\n        resultMap[taskId] = features.slice(pageSize, Infinity);\n        postResponse(null, pageFeatures);\n    }\n    //worker init\n    exports.initialize = function () {\n        // console.log(\"geojson fetch init\");\n    };\n    //recive message\n    exports.onmessage = function (msg, postResponse) {\n        const { taskId, type, url } = msg.data || {};\n        if (!taskId) {\n            postResponse('not find task id for get geojson dataset,taskId=' + taskId);\n            return;\n        }\n        if (type === 'fetchdata') {\n            if (!url) {\n                postResponse('url is null,url=' + url);\n                return;\n            }\n            fetch(url).then(res => res.json()).then(geojson => {\n                let features;\n                if (Array.isArray(geojson)) {\n                    features = geojson;\n                } else if (geojson.features) {\n                    features = geojson.features;\n                } else {\n                    features = [geojson];\n                }\n                resultMap[taskId] = features;\n                handleResult(msg, postResponse);\n            }).catch(errror => {\n                postResponse(errror.message);\n            });\n        } else if (type === 'pagefeatures') {\n            handleResult(msg, postResponse);\n        } else {\n            postResponse('not support task type:' + type);\n        }\n    };\n}"}));var S7={toGeometry:function(t,e){if(s0(t)&&(t=o1(t)),Array.isArray(t)){for(var n=[],i=0,r=t.length;i<r;i++){var o=S7._convert(t[i],e);Array.isArray(o)?s1(n,o):n.push(o)}return n}return S7._convert(t,e)},toGeometryAsync:function(t,e,n){return void 0===n&&(n=2e3),s0(t)&&(t=o1(t)),new Promise((function(i){var r,o=[];if(t&&(Array.isArray(t)||Array.isArray(t.features))){var s=i0(n)?Math.round(n):2e3,a=t.features||t,h=Math.ceil(a.length/s),l=1;(r={count:h,run:function(){var t=a.slice((l-1)*s,l*s),n=S7.toGeometry(t,e);return l++,n}},E3(),new Promise((function(t,e){if(r)if(a0(r)&&(r={count:1,run:r}),r.run)if(n0(r.count)&&(r.count=1),r.count=Math.ceil(r.count),i0(r.count)){var n=r;n.results=[],w3.push(n),n.resolve=t}else e(new Error("task.count is not number"));else e(new Error("task.run is null"));else e(new Error("task is null"))}))).then((function(t){for(var e=0,n=t.length;e<n;e++){var r=t[e];r&&(Array.isArray(r)?s1(o,r):o.push(r))}i(o)}))}else{var u=S7.toGeometry(t,e);i(u)}}))},_convert:function(t,e){if(!t||n0(t.type))return null;var n=t.type;if("Feature"===n){var i=S7._convert(t.geometry);return i?(i.setId(t.id),i.setProperties(t.properties),e&&e(i),i):null}if("FeatureCollection"===n){var r=t.features;return r?S7.toGeometry(r,e):null}if(["Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"].indexOf(n)>=0){var o=new P7["Point"===n?"Marker":n](t.coordinates);return e&&e(o),o}if("GeometryCollection"===n){var s=t.geometries;if(!d1(s)){var a=new g7;return e&&e(a),a}for(var h=[],l=s.length,u=0;u<l;u++)h.push(s[u].subType?M9.getJSONClass(s[u].subType).fromJSON(s[u]):S7._convert(s[u]));return o=new g7(h),e&&e(o),o}return null},_isGeoJSON:function(t){if(!t)return!1;if(t=t||{},Array.isArray(t)&&t.length)return S7.isGeoJSON(t[0]);var e=t.type;if(!e)return!1;if(-1===R1.indexOf(e))return!1;var n=t.features,i=t.geometries,r=t.geometry,o=t.coordinates;if(o&&Array.isArray(o))return!0;if(Array.isArray(i))return!0;if(Array.isArray(n))return!0;if(r){var s=r.coordinates;if(s&&Array.isArray(s))return!0}return!1},fetch:function(t,e){return void 0===e&&(e=2e3),new Promise((function(n,i){if(t&&s0(t)){var r=e0({pageSize:2e3},{pageSize:e});t=T1(t),C7||(C7=new T7);var o=C7.workers.length,s=Math.floor(Math.random()*o);s=Math.min(o-1,s),r.workerId=s,r.taskId=r1(),C7._fetchGeoJSON(t,r,[],(function(t,e){if(t)i(t);else{var r=[];e.forEach((function(t){for(var e=0,n=t.length;e<n;e++)r.push(t[e])})),n({type:"FeatureCollection",features:r})}}))}else i("url is error,It should be string")}))}},I7=function(t){function e(e,n,i){var r=t.call(this,null,i)||this;return e&&r.setCoordinates(e),r._radius=n,r}return W0(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.radius,t.options);return i.setProperties(n.properties),i},e.prototype.getRadius=function(){return this._radius},e.prototype.setRadius=function(t){return this._radius=t,this.onShapeChanged(),this},e.prototype.getShell=function(){for(var t,e,n,i=this._getMeasurer(),r=this.getCoordinates(),o=this.options.numberOfShellPoints,s=this.getRadius(),a=[],h=0,l=o-1;h<l;h++){t=360*h/l*Math.PI/180,e=s*Math.cos(t),n=s*Math.sin(t);var u=i.locate(r,e,n);u.z=r.z,a.push(u)}return a.push(a[0]),a},e.prototype.getHoles=function(){return[]},e.prototype.animateShow=function(){return this.show()},e.prototype._containsPoint=function(e,n){var i=this.getMap();if(i.getPitch())return t.prototype._containsPoint.call(this,e,n);var r=i._pointToContainerPoint(this._getCenter2DPoint()),o=this.getSize(),s=this._hitTestTolerance()+(n||0),a=r.add(o.width/2,o.height/2);return M6(e,r,a,s)},e.prototype._computePrjExtent=function(t){var e=this._getMinMax(t);if(!e)return null;var n=this._getPrjCoordinates(),i=e.map((function(e){return t.project(e)})),r=i[1].x-n.x,o=i[3].y-n.y;return new X4(n.add(i[0].x-n.x,i[2].y-n.y),n.add(r,o))},e.prototype._computeExtent=function(t){var e=this._getMinMax(t);return e?new X4(e[0].x,e[2].y,e[1].x,e[3].y,this._getProjection()):null},e.prototype._getMinMax=function(t){if(!t||!this._coordinates||n0(this._radius))return null;var e=this._radius;return[t.locate(this._coordinates,-e,0),t.locate(this._coordinates,e,0),t.locate(this._coordinates,0,e),t.locate(this._coordinates,0,-e)]},e.prototype._computeGeodesicLength=function(){return n0(this._radius)?0:2*Math.PI*this._radius},e.prototype._computeGeodesicArea=function(){return n0(this._radius)?0:Math.PI*Math.pow(this._radius,2)},e.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:F4.toNumberArrays([this.getShell()])}},e.prototype._toJSON=function(t){var e=this.getCenter(),n=e0({},t);n.geometry=!1;var i=this.toGeoJSON(n);return i.geometry={type:"Polygon"},{feature:i,subType:"Circle",coordinates:[e.x,e.y],radius:this.getRadius()}},e}(u7(l7));function E7(t){return t*t*t*t}I7.mergeOptions({numberOfShellPoints:60}),I7.registerJSONType("Circle");var O7=function(t){function e(e,n,i,r){var o=t.call(this,null,r)||this;return e&&o.setCoordinates(e),o.width=n,o.height=i,o}return W0(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i},e.prototype.getWidth=function(){return this.width},e.prototype.setWidth=function(t){return this.width=t,this.onShapeChanged(),this},e.prototype.getHeight=function(){return this.height},e.prototype.setHeight=function(t){return this.height=t,this.onShapeChanged(),this},e.prototype.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},e.prototype._getShell=function(){var t,e,n,i,r=this._getMeasurer(),o=this.getCoordinates(),s=this.options.numberOfShellPoints-1,a=this.getWidth(),h=this.getHeight(),l=[],u=Math.pow(a/2,2)*Math.pow(h/2,2),c=Math.pow(a/2,2),A=Math.pow(h/2,2),f=[];if(Math.max(a/h,h/a)>2){var d=function(t){for(var e=[],n=[],i=0;i<t;i++)n.push(E7(i/t));var r=n.map((function(t){return t})).reverse(),o=[];s1(o,n,r,n,r);for(var s=0,a=(i=0,o.length);i<a;i+=4)e.push(o[i]),s+=o[i];return{fs:e,sum:s}}(s),p=d.fs,g=360/d.sum,m=0;h>a&&(m=90);for(var y=0,v=0,_=p.length;v<_;v++)f.push((y+=g*p[v])+m)}else for(v=0;v<s;v++)f.push(y=360*v/s);for(this.options.debug,v=0;v<f.length;v++){e=(t=f[v])*Math.PI/180,n=Math.sqrt(u/(c*Math.pow(Math.tan(e),2)+A)),i=Math.sqrt(u/(A*Math.pow(1/Math.tan(e),2)+c)),t>90&&t<270&&(n*=-1),t>180&&t<360&&(i*=-1);var x=r.locate(o,n,i);x.z=o.z,l.push(x)}return l.push(l[0].copy()),l},e.prototype._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(e)},e.prototype.getHoles=function(){return[]},e.prototype.animateShow=function(){return this.show()},e.prototype._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=i.getProjection(),o=this._hitTestTolerance()+(n||0),s=r.projectCoords([this._coordinates,i.locate(this._coordinates,this.getWidth()/2,this.getHeight()/2)],this.options.antiMeridian);return M6(e,i.prjToContainerPoint(s[0]),i.prjToContainerPoint(s[1]),o)},e.prototype._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():I7.prototype._computePrjExtent.apply(this,arguments)},e.prototype._computeExtent=function(){return I7.prototype._computeExtent.apply(this,arguments)},e.prototype._getMinMax=function(t){if(!t||!this._coordinates||n0(this.width)||n0(this.height))return null;var e=this.getWidth(),n=this.getHeight();return[t.locate(this._coordinates,-e/2,0),t.locate(this._coordinates,e/2,0),t.locate(this._coordinates,0,-n/2),t.locate(this._coordinates,0,n/2)]},e.prototype._computeGeodesicLength=function(){return n0(this.width)||n0(this.height)?0:2*Math.PI*(this.width>this.height?this.width:this.height)/2-4*Math.abs(this.width-this.height)},e.prototype._computeGeodesicArea=function(){return n0(this.width)||n0(this.height)?0:Math.PI*this.width*this.height/4},e.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:F4.toNumberArrays([this.getShell()])}},e.prototype._toJSON=function(t){var e=e0({},t),n=this.getCenter();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Ellipse",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},e}(u7(l7));O7.mergeOptions({numberOfShellPoints:81}),O7.registerJSONType("Ellipse");var R7=function(t){function e(e,n,i,r){var o=t.call(this,null,r)||this;return e&&o.setCoordinates(e),o._width=n,o._height=i,o}return W0(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i},e.prototype.getCoordinates=function(){return this._coordinates},e.prototype.setCoordinates=function(t){var e=t instanceof F4?t:new F4(t);if(this._translateRotatePivot(e),this._coordinates=e,!this._coordinates||!this.getMap())return this.onPositionChanged(),this;var n=this._getProjection();return this._setPrjCoordinates(n.project(this._coordinates)),this},e.prototype.getWidth=function(){return this._width},e.prototype.setWidth=function(t){return this._width=t,this.onShapeChanged(),this},e.prototype.getHeight=function(){return this._height},e.prototype.setHeight=function(t){return this._height=t,this.onShapeChanged(),this},e.prototype.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},e.prototype._getShell=function(){var t=this._getMeasurer(),e=this._coordinates,n=this.getMap(),i=1,r=-1;if(n){var o=n.getFullExtent();o.left>o.right&&(i=-1),o.bottom>o.top&&(r=1)}var s=[];s.push(e);var a=t.locate(e,i*this._width,0);a.z=e.z,s.push(a);var h=t.locate(e,i*this._width,r*this._height);h.z=e.z,s.push(h);var l=t.locate(e,0,r*this._height);return s.push(l),l.z=e.z,s.push(e),s},e.prototype.getHoles=function(){return[]},e.prototype.animateShow=function(){return this.show()},e.prototype._getPrjCoordinates=function(){var t=this._getProjection();return this._verifyProjection(),!this._pnw&&t&&this._coordinates&&(this._pnw=t.project(this._coordinates)),this._pnw},e.prototype._setPrjCoordinates=function(t){this._pnw=t,this.onPositionChanged()},e.prototype._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this),n=this._getProjection();if(!n.isSphere())return this._rotatePrjCoordinates(e);for(var i=n.getSphereExtent(),r=i.sx,o=i.sy,s=this._getProjection().getCircum(),a=e[0],h=1,l=e.length;h<l;h++){var u=e[h],c=0,A=0;r*(a.x-u.x)>0&&(c=s.x*r),o*(a.y-u.y)<0&&(A=s.y*o),e[h]._add(c,A)}return this._rotatePrjCoordinates(e)},e.prototype._updateCache=function(){this._clearCache();var t=this._getProjection();this._pnw&&t&&(this._coordinates=t.unproject(this._pnw))},e.prototype._clearProjection=function(){this._pnw=null,t.prototype._clearProjection.call(this)},e.prototype._computeCenter=function(t){return t.locate(this._coordinates,this._width/2,-this._height/2)},e.prototype._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=n0(n)?this._hitTestTolerance():n,o=i._getResolution()*r,s=this._getPrjExtent().expand(o),a=i._containerPointToPrj(e);return s.contains(a)},e.prototype._computePrjExtent=function(t){if(this.isRotated())return this._computeRotatedPrjExtent();var e=this._getSouthEast(t);if(!e)return null;var n=t.projectCoords([new F4(this._coordinates.x,e.y),new F4(e.x,this._coordinates.y)],this.options.antiMeridian);return new X4(n[0],n[1])},e.prototype._computeExtent=function(t){var e=this._getSouthEast(t);return e?new X4(this._coordinates,e,this._getProjection()):null},e.prototype._getSouthEast=function(t){if(!t||!this._coordinates||n0(this._width)||n0(this._height))return null;var e=this.getWidth(),n=-this.getHeight();if(t.fullExtent){var i=t.fullExtent;e*=i.right>i.left?1:-1,n*=i.top>i.bottom?1:-1}var r=t.locate(this._coordinates,e,0),o=t.locate(this._coordinates,0,n);return r.y=o.y,r},e.prototype._computeGeodesicLength=function(){return n0(this._width)||n0(this._height)?0:2*(this._width+this._height)},e.prototype._computeGeodesicArea=function(){return n0(this._width)||n0(this._height)?0:this._width*this._height},e.prototype._exportGeoJSONGeometry=function(){return{type:"Polygon",coordinates:F4.toNumberArrays([this.getShell()])}},e.prototype._toJSON=function(t){var e=e0({},t),n=this.getCoordinates();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Rectangle",coordinates:[n.x,n.y],width:this.getWidth(),height:this.getHeight()}},e}(l7);R7.registerJSONType("Rectangle");var D7=function(t){function e(e,n,i,r,o){var s=t.call(this,e,n,o)||this;return s.startAngle=i,s.endAngle=r,s}return W0(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(t.coordinates,t.radius,t.startAngle,t.endAngle,t.options);return i.setProperties(n.properties),i},e.prototype.getStartAngle=function(){return this.startAngle},e.prototype.setStartAngle=function(t){return this.startAngle=t,this.onShapeChanged(),this},e.prototype.getEndAngle=function(){return this.endAngle},e.prototype.setEndAngle=function(t){return this.endAngle=t,this.onShapeChanged(),this},e.prototype._correctAngles=function(){var t=this.getStartAngle(),e=this.getEndAngle();return e<t?(console.error("The ending angle should be greater than the starting angle ",t,e),[0,0]):e-t>360?(console.error("The difference between the end angle and the start angle is greater than 360 degrees ",t,e),[0,0]):(t<0&&(t+=360,e+=360),[t,e])},e.prototype.getShell=function(){return this.isRotated()?this.getRotatedShell():this._getShell()},e.prototype._getShell=function(){for(var t,e,n,i=Q0(this._correctAngles(),2),r=i[0],o=i[1],s=this._getMeasurer(),a=this.getCoordinates(),h=this.options.numberOfShellPoints-2,l=this.getRadius(),u=[a.copy()],c=o-r,A=0;A<h;A++){t=(c*A/(h-1)+r)*Math.PI/180,e=l*Math.cos(t),n=l*Math.sin(t);var f=s.locate(a,e,n);f.z=a.z,u.push(f)}return u.push(a.copy()),u},e.prototype.getRotateOffsetAngle=function(){return 90},e.prototype._getPrjShell=function(){var e=t.prototype._getPrjShell.call(this);return this._rotatePrjCoordinates(e)},e.prototype._computePrjExtent=function(){return this.isRotated()?this._computeRotatedPrjExtent():I7.prototype._computePrjExtent.apply(this,arguments)},e.prototype._containsPoint=function(e,n){var i=this.getMap();if(i.isTransforming())return t.prototype._containsPoint.call(this,e,n);var r=i._pointToContainerPoint(this._getCenter2DPoint()),o=this._hitTestTolerance()+(n||0),s=this.getSize(),a=r,h=e,l=Math.atan2(a.y-h.y,h.x-a.x),u=l<0?360*(l+2*Math.PI)/(2*Math.PI):360*l/(2*Math.PI),c=Q0(this._correctAngles(),2),A=c[0]%360,f=c[1]%360,d=!1;return d=A>f?!(u>f&&u<A):u>=A&&u<=f,h.distanceTo(a)<=s.width/2+o&&d},e.prototype._computeGeodesicLength=function(){if(n0(this._radius))return 0;var t=Q0(this._correctAngles(),2);return 2*Math.PI*this._radius*Math.abs(t[0]-t[1])/360+2*this._radius},e.prototype._computeGeodesicArea=function(){if(n0(this._radius))return 0;var t=Q0(this._correctAngles(),2),e=t[0],n=t[1];return Math.PI*Math.pow(this._radius,2)*Math.abs(e-n)/360},e.prototype._toJSON=function(t){var e=e0({},t),n=this.getCenter();e.geometry=!1;var i=this.toGeoJSON(e);return i.geometry={type:"Polygon"},{feature:i,subType:"Sector",coordinates:[n.x,n.y],radius:this.getRadius(),startAngle:this.getStartAngle(),endAngle:this.getEndAngle()}},e}(I7);D7.mergeOptions({numberOfShellPoints:60}),D7.registerJSONType("Sector");var k7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype._arc=function(t,e,n){var i=this.options.arcDegree;0===i&&(i=1);for(var r=i*Math.PI/180,o=1,s=e.length;o<s;o++)j3._arcBetween(t,e[o-1],e[o],r),j3._stroke(t,n)},e.prototype._quadraticCurve=function(t,e){if(e.length<=2)j3._path(t,e);else{var n,i;for(n=2,i=e.length;n<i;n+=2)t.quadraticCurveTo(e[n-1].x,e[n-1].y,e[n].x,e[n].y);if((n-=1)<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},e.prototype._bezierCurve=function(t,e){if(e.length<=3)j3._path(t,e);else{var n,i;for(n=1,i=e.length;n+2<i;n+=3)t.bezierCurveTo(e[n].x,e[n].y,e[n+1].x,e[n+1].y,e[n+2].x,e[n+2].y);if(n<i)for(;n<i;n++)t.lineTo(e[n].x,e[n].y)}},e.prototype._getCurveArrowPoints=function(t,e,n,i,r,o){var s,a=e.length;for(s=o;s<a;s+=o)(h=this._getArrowShape(e[s-1],e[s],n,i,r))&&t.push(h);if((s-=o)<a-1)for(s+=1;s<a;s++){var h;(h=this._getArrowShape(e[s-1],e[s],n,i,r))&&t.push(h)}},e}(d7);k7.mergeOptions({enableSimplify:!1,enableClip:!1});var L7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"ArcCurve"}},e.prototype._paintOn=function(t,e,n){t.beginPath(),this._arc(t,e,n),j3._stroke(t,n),this._paintArrow(t,e,n)},e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i},e}(k7);L7.registerJSONType("ArcCurve"),L7.mergeOptions({arcDegree:90});var F7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"CubicBezierCurve"}},e.prototype._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._bezierCurve(t,e),j3._stroke(t,n),this._paintArrow(t,e,n)},e.prototype._getArrowPoints=function(t,e,n,i,r){return this._getCurveArrowPoints(t,e,n,i,r,3)},e}(k7);F7.registerJSONType("CubicBezierCurve");var N7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.fromJSON=function(t){var n=t.feature,i=new e(n.geometry.coordinates,t.options);return i.setProperties(n.properties),i},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"QuadBezierCurve"}},e.prototype._paintOn=function(t,e,n){t.beginPath(),t.moveTo(e[0].x,e[0].y),this._quadraticCurve(t,e,n),j3._stroke(t,n),this._paintArrow(t,e,n)},e.prototype._getArrowPoints=function(t,e,n,i,r){return this._getCurveArrowPoints(t,e,n,i,r,2)},e}(k7);N7.registerJSONType("QuadBezierCurve");var z7={textFaceName:"monospace",textSize:12,textLineSpacing:8,textWrapCharacter:"\n",textHorizontalAlignment:"middle",textVerticalAlignment:"middle"},B7={markerType:"square",markerLineColor:"#000",markerLineWidth:2,markerLineOpacity:1,markerFill:"#fff",markerOpacity:1},H7=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.getContent=function(){return this._content},e.prototype.setContent=function(t){var e=this._content;return this._content=G1(t),this._refresh(),this._fireEvent("contentchange",{old:e,new:t}),this},e.prototype.onAdd=function(){this._refresh()},e.prototype.toJSON=function(){var e=t.prototype.toJSON.call(this);return delete e.symbol,e},e.prototype.setSymbol=function(e){if(this._refreshing||!e)return t.prototype.setSymbol.call(this,e);var n,i=this._parseSymbol(e);return this.setTextStyle?((n=this.getTextStyle()||{}).symbol=i[0],this.setTextStyle(n)):this.setTextSymbol&&this.setTextSymbol(i[0]),this.setBoxStyle?((n=this.getBoxStyle()||{}).symbol=i[1],this.setBoxStyle(n)):this.setBoxSymbol&&this.setBoxSymbol(i[1]),this},e.prototype._parseSymbol=function(t){var e={},n={};for(var i in t)l0(t,i)&&(0===i.indexOf("text")?e[i]=t[i]:n[i]=t[i]);return[e,n]},e.prototype._getTextSize=function(t){return e2(this._content,t).size},e.prototype._getInternalSymbol=function(){return this._symbol},e.prototype._getDefaultTextSymbol=function(){return e0({},z7)},e.prototype._getDefaultBoxSymbol=function(){return e0({},B7)},e.prototype._getDefaultPadding=function(){return[12,8]},e}(A7),j7=function(t){function e(e,n,i,r,o){void 0===o&&(o={});var s=t.call(this,n,o)||this;return s._content=G1(e),s._width=n0(i)?100:i,s._height=n0(r)?40:r,o.boxSymbol&&s.setBoxSymbol(o.boxSymbol),o.textStyle&&s.setTextStyle(o.textStyle),s._refresh(),s}return W0(e,t),e.prototype.getWidth=function(){return this._width},e.prototype.setWidth=function(t){return this._width=t,this._refresh(),this},e.prototype.getHeight=function(){return this._height},e.prototype.setHeight=function(t){return this._height=t,this._refresh(),this},e.prototype.getBoxSymbol=function(){return e0({},this.options.boxSymbol)},e.prototype.setBoxSymbol=function(t){return this.options.boxSymbol=t?e0({},t):t,this.getSymbol()&&this._refresh(),this},e.prototype.getTextStyle=function(){return this.options.textStyle?e0({},this.options.textStyle):null},e.prototype.setTextStyle=function(t){return this.options.textStyle=t?e0({},t):t,this.getSymbol()&&this._refresh(),this},e.fromJSON=function(t){var n=t.feature,i=new e(t.content,n.geometry.coordinates,t.width,t.height,t.options);return i.setProperties(n.properties),i.setId(n.id),t.symbol&&i.setSymbol(t.symbol),i},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),width:this.getWidth(),height:this.getHeight(),subType:"TextBox",content:this._content}},e.prototype._refresh=function(){var t,e,n=this.getTextStyle()||{},i=n.padding||[12,8];if(J2(this._width)){if(l=(t=JSON.parse(JSON.stringify(this._width))).stops)for(var r=0;r<l.length;r++)l[r][1]=l[r][1]-2*i[0]}else t=this._width-2*i[0];if(J2(this._height)){if(l=(e=JSON.parse(JSON.stringify(this._height))).stops)for(r=0;r<l.length;r++)l[r][1]=l[r][1]-2*i[1]}else e=this._height-2*i[1];var o=e0({},n.symbol||this._getDefaultTextSymbol(),this.options.boxSymbol||this._getDefaultBoxSymbol(),{textName:this._content,markerWidth:this._width,markerHeight:this._height,textHorizontalAlignment:"middle",textVerticalAlignment:"middle",textMaxWidth:t,textMaxHeight:e});n.wrap&&!o.textWrapWidth&&(o.textWrapWidth=t);var s,a=n.horizontalAlignment;if(o.textDx=o.markerDx||0,J2(this._width)){if(l=(s=JSON.parse(JSON.stringify(this._width))).stops)for(r=0;r<l.length;r++)l[r][1]=l[r][1]/2-i[0],"left"===a&&(l[r][1]*=-1)}else s=o.markerWidth/2-i[0],"left"===a&&(s*=-1);"left"===a?(o.textHorizontalAlignment="right",o.textDx=s):"right"===a&&(o.textHorizontalAlignment="left",o.textDx=s);var h,l,u=n.verticalAlignment;if(o.textDy=o.markerDy||0,J2(this._height)){if(l=(h=JSON.parse(JSON.stringify(this._height))).stops)for(r=0;r<l.length;r++)l[r][1]=l[r][1]/2-i[1],"top"===u&&(l[r][1]*=-1)}else h=o.markerHeight/2-i[1],"top"===u&&(h*=-1);"top"===u?(o.textVerticalAlignment="bottom",o.textDy=h):"bottom"===u&&(o.textVerticalAlignment="top",o.textDy=h),this._refreshing=!0,this.updateSymbol(o),delete this._refreshing},e.prototype.startEdit=function(e){var n=this._getCompiledSymbol();if(J2(this._width)){var i=n.markerWidth;this._oldWidth=this._width,this.setWidth(i)}if(J2(this._height)){var r=n.markerHeight;this._oldHeight=this._height,this.setHeight(r)}return t.prototype.startEdit.call(this,e)},e.prototype.endEdit=function(){var e=this.getMap(),n=e&&e.getZoom();if(this._oldWidth){for(var i=this._width/$2(this._oldWidth)(n),r=this._oldWidth.stops,o=0;o<r.length;o++)r[o][1]*=i;this.setWidth(this._oldWidth),delete this._oldWidth}if(this._oldHeight){for(i=this._height/$2(this._oldHeight)(n),r=this._oldHeight.stops,o=0;o<r.length;o++)r[o][1]*=i;this.setHeight(this._oldHeight),delete this._oldHeight}return t.prototype.endEdit.call(this)},e}(H7);j7.mergeOptions({textStyle:{wrap:!0,padding:[12,8],verticalAlignment:"middle",horizontalAlignment:"middle"},boxSymbol:null}),j7.registerJSONType("TextBox");var U7=function(t){function e(e,n,i){void 0===i&&(i={});var r=t.call(this,n,i)||this;return i.textSymbol&&r.setTextSymbol(i.textSymbol),i.boxStyle&&r.setBoxStyle(i.boxStyle),r._content=G1(e),r._refresh(),r}return W0(e,t),e.prototype.getBoxStyle=function(){return this.options.boxStyle?e0({},this.options.boxStyle):null},e.prototype.setBoxStyle=function(t){return this.options.boxStyle=t?e0({},t):t,this._refresh(),this},e.prototype.getTextSymbol=function(){return e0({},this._getDefaultTextSymbol(),this.options.textSymbol)},e.prototype.setTextSymbol=function(t){return this.options.textSymbol=t?e0({},t):t,this._refresh(),this},e.fromJSON=function(t){var n=t.feature,i=new e(t.content,n.geometry.coordinates,t.options);return i.setProperties(n.properties),i.setId(n.id),t.symbol&&i.setSymbol(t.symbol),i},e.prototype._canEdit=function(){return!1},e.prototype._toJSON=function(t){return{feature:this.toGeoJSON(t),subType:"Label",content:this._content}},e.prototype._refresh=function(){var t=e0({},this.getTextSymbol(),{textName:this._content}),e=this.getBoxStyle();if(e){e0(t,e.symbol);var n=this._getBoxSize(t),i=n[1],r=e.padding||this._getDefaultPadding(),o=n[0];t.markerWidth=o.width,t.markerHeight=o.height;var s=t.textDx||0,a=t.textDy||0,h=J1(i,t.textHorizontalAlignment,t.textVerticalAlignment)._add(s,a),l=e.horizontalAlignment||"middle";t.markerDx=h.x,"left"===l?t.markerDx+=t.markerWidth/2-r[0]:"right"===l?t.markerDx-=t.markerWidth/2-i.width-r[0]:t.markerDx+=i.width/2;var u=e.verticalAlignment||"middle";t.markerDy=h.y,"top"===u?t.markerDy+=t.markerHeight/2-r[1]:"bottom"===u?t.markerDy-=t.markerHeight/2-i.height-r[1]:t.markerDy+=i.height/2}this._refreshing=!0,this.updateSymbol(t),delete this._refreshing},e.prototype._getBoxSize=function(t){t.markerType||(t.markerType="square");var e,n,i=this.getBoxStyle(),r=this._getTextSize(t),o=i.padding||this._getDefaultPadding();return e=r.width+2*o[0],n=r.height+2*o[1],i.minWidth&&(!e||e<i.minWidth)&&(e=i.minWidth),i.minHeight&&(!n||n<i.minHeight)&&(n=i.minHeight),[new z1(e,n),r]},e}(H7);U7.mergeOptions({boxStyle:null,textSymbol:null}),U7.registerJSONType("Label");var G7=function(t){return function(t){function e(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return t.apply(this,X0([],Q0(e),!1))||this}return W0(e,t),e._hasConnectors=function(t){return!n0(t.__connectors)&&t.__connectors.length>0},e._getConnectors=function(t){return t.__connectors},e.prototype.getConnectSource=function(){return this._connSource},e.prototype.setConnectSource=function(t){var e=this._connTarget;return this.onRemove(),this._connSource=t,this._connTarget=e,this.onAdd(),this},e.prototype.getConnectTarget=function(){return this._connTarget},e.prototype.setConnectTarget=function(t){var e=this._connSource;return this.onRemove(),this._connSource=e,this._connTarget=t,this._updateCoordinates(),this._registerEvents(),this},e.prototype._updateCoordinates=function(){var t=this.getMap();if(!t&&this._connSource&&(t=this._connSource.getMap()),!t&&this._connTarget&&(t=this._connTarget.getMap()),t&&this._connSource&&this._connTarget){for(var e,n,i=this._connSource._getConnectPoints(),r=this._connTarget._getConnectPoints(),o=0,s=this.getCoordinates(),a=0,h=i.length;a<h;a++)for(var l=i[a],u=0,c=r.length;u<c;u++){var A=r[u],f=t.computeLength(l,A);0===a&&0===u?(e=l,n=A,o=f):f<o&&(e=l,n=A)}d1(s)&&s[0].equals(e)&&s[1].equals(n)||this.setCoordinates([e,n])}},e.prototype.onAdd=function(){this._registerEvents(),this._updateCoordinates()},e.prototype.onRemove=function(){if(this._connSource&&(this._connSource.__connectors&&a1(this,this._connSource.__connectors),this._connSource.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connSource.off("dragstart mousedown mouseover",this._showConnect,this),this._connSource.off("dragend mouseup mouseout",this.hide,this),this._connSource.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connSource),this._connTarget&&(a1(this,this._connTarget.__connectors),this._connTarget.off("dragging positionchange",this._updateCoordinates,this).off("remove",this.onRemove,this),this._connTarget.off("show",this._showConnect,this).off("hide",this.hide,this),delete this._connTarget),!(this._connSource instanceof M9&&this._connTarget instanceof M9)){var t=this.getMap();t&&t.off("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}},e.prototype._showConnect=function(){this._connSource&&this._connTarget&&this._connSource.isVisible()&&this._connTarget.isVisible()&&(this._updateCoordinates(),this.show())},e.prototype._registerEvents=function(){if(this._connSource&&this._connTarget){this._connSource.__connectors||(this._connSource.__connectors=[]),this._connTarget.__connectors||(this._connTarget.__connectors=[]),this._connSource.__connectors.push(this),this._connTarget.__connectors.push(this),this._connSource.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connTarget.on("dragging positionchange",this._updateCoordinates,this).on("remove",this.remove,this),this._connSource.on("show",this._showConnect,this).on("hide",this.hide,this),this._connTarget.on("show",this._showConnect,this).on("hide",this.hide,this);var t=this.options.showOn;if(this.hide(),"moving"===t?(this._connSource.on("dragstart",this._showConnect,this).on("dragend",this.hide,this),this._connTarget.on("dragstart",this._showConnect,this).on("dragend",this.hide,this)):"click"===t?(this._connSource.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this),this._connTarget.on("mousedown",this._showConnect,this).on("mouseup",this.hide,this)):"mouseover"===t?(this._connSource.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this),this._connTarget.on("mouseover",this._showConnect,this).on("mouseout",this.hide,this)):this._showConnect(),!(this._connSource instanceof M9&&this._connTarget instanceof M9)){var e=this.getMap();e&&e.on("movestart moving moveend zoomstart zooming zoomend rotate pitch fovchange spatialreferencechange",this._updateCoordinates,this)}}},e}(t)},V7={showOn:"always"},W7=function(t){function e(e,n,i){var r=t.call(this,null,i)||this;return 1===arguments.length&&(i=e,e=null,n=null),r._connSource=e,r._connTarget=n,r}return W0(e,t),e}(G7(d7));W7.mergeOptions(V7),W7.registerJSONType("ConnectorLine");var q7=function(t){function e(e,n,i){var r=t.call(this,null,i)||this;return 1===arguments.length&&(i=e,e=null,n=null),r._connSource=e,r._connTarget=n,r}return W0(e,t),e}(G7(L7));function Z7(t){return t&&t instanceof M9}q7.mergeOptions(V7),q7.registerJSONType("ArcConnectorLine");var Q7=[],X7=function(t){function e(e,n,i){var r=this;n&&!Z7(n)&&!Array.isArray(n)&&R1.indexOf(n.type)<0&&(i=n,n=null),(r=t.call(this,e,i)||this)._maxZIndex=0,r._minZIndex=0,r._initCache(),n&&r.addGeometry(n);var o=r.options.style;return o&&r.setStyle(o),r}return W0(e,t),e.prototype.getAltitude=function(){return 0},e.prototype.getGeometryById=function(t){return n0(t)||""===t?null:this._geoMap[t]?this._geoMap[t]:null},e.prototype.getGeometries=function(t,e){if(!t)return this._geoList.slice(0);for(var n,i=[],r=0,o=this._geoList.length;r<o;r++)n=this._geoList[r],(e?t.call(e,n):t(n))&&i.push(n);return i},e.prototype.getFirstGeometry=function(){return this._geoList.length?this._geoList[0]:null},e.prototype.getLastGeometry=function(){var t=this._geoList.length;return 0===t?null:this._geoList[t-1]},e.prototype.getCount=function(){return this._geoList.length},e.prototype.getExtent=function(){if(0===this.getCount())return null;var t=new X4(this.getProjection());return this.forEach((function(e){t._combine(e.getExtent())})),t},e.prototype.forEach=function(t,e){for(var n=this._geoList.slice(0),i=0,r=n.length;i<r;i++)e?t.call(e,n[i],i):t(n[i],i);return this},e.prototype.filter=function(t,e){var n=[],i=a0(t),r=i?t:r5(t);return this.forEach((function(t){var o=i?t:d5(t);(e?r.call(e,o):r(o))&&n.push(t)}),this),n},e.prototype.isEmpty=function(){return!this._geoList.length},e.prototype.addGeometry=function(t,e){if(!t)return this;if("FeatureCollection"===t.type)return this.addGeometry(S7.toGeometry(t),e);if(!Array.isArray(t)){var n=arguments.length,i=arguments[n-1];return t=Array.prototype.slice.call(arguments,0,n-1),e=i,i&&o0(i)&&("type"in i||Z7(i))&&(t.push(i),e=!1),this.addGeometry(t,e)}if(0===t.length)return this;var r;this._initCache(),e&&(r=new X4),this._toSort=this._maxZIndex>0;for(var o=[],s=0,a=t.length;s<a;s++){var h=t[s];if(!h||!S7._isGeoJSON(h)&&!Z7(h))throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+s);if(!h.getLayer||h.getLayer()!==this){if(!Z7(h)&&(h=M9.fromJSON(h),Array.isArray(h)))for(var l=0,u=h.length;l<u;l++)this._add(h[l],r,s),o.push(h[l]);if(!h)throw new Error("Invalid geometry to add to layer("+this.getId()+") at index:"+s);Array.isArray(h)||(this._add(h,r,s),o.push(h))}}var c=this.getMap();if(c&&(this._getRenderer().onGeometryAdd(o),r&&!n0(r.xmin))){var A=r.getCenter(),f=c.getFitZoom(r);if(o0(e)){var d=a0(e.step)?e.step:function(){};c.animateTo({center:A,zoom:f},e0({duration:c.options.zoomAnimationDuration,easing:"out"},e),d)}else!0===e&&c.setCenterAndZoom(A,f)}return this.fire("addgeo",{type:"addgeo",target:this,geometries:t}),this},e.prototype.getGeoMinZIndex=function(){return this._minZIndex},e.prototype.getGeoMaxZIndex=function(){return this._maxZIndex},e.prototype._add=function(t,e,n){this._toSort||(this._toSort=0!==t.getZIndex()),this._updateZIndex(t.getZIndex());var i=t.getId();if(!n0(i)){if(!n0(this._geoMap[i]))throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+i+", at index:"+n);this._geoMap[i]=t}var r=i1();t._setInternalId(r),this._geoList.push(t),this.onAddGeometry(t),t._bindLayer(this),t.onAdd&&t.onAdd(),e&&e._combine(t.getExtent()),t._fireEvent("add",{layer:this}),this._cookedStyles&&this._styleGeometry(t)},e.prototype.removeGeometry=function(t){if(!Array.isArray(t))return this.removeGeometry([t]);for(var e=t.length-1;e>=0;e--)t[e]instanceof M9||(t[e]=this.getGeometryById(t[e])),t[e]&&this===t[e].getLayer()&&t[e].remove();return this.fire("removegeo",{type:"removegeo",target:this,geometries:t}),this},e.prototype.clear=function(){this._clearing=!0,this.forEach((function(t){t.remove()})),this._geoMap={};var t=this._geoList;this._geoList=[];var e=this._getRenderer();return e&&(e.onGeometryRemove(t),e.clearImageData&&(e.clearImageData(),delete e._lastGeosToDraw)),this._clearing=!1,this.fire("clear"),this},e.prototype.onRemoveGeometry=function(t){if(t&&!this._clearing&&this===t.getLayer()&&!n0(t._getInternalId())){var e=t.getId();n0(e)||delete this._geoMap[e];var n=this._findInList(t);n>=0&&this._geoList.splice(n,1),this._getRenderer()&&this._getRenderer().onGeometryRemove([t])}},e.prototype.getStyle=function(){return this.options.style?this.options.style:null},e.prototype.setStyle=function(t){return this.options.style=t,t=I5(t),this._cookedStyles=p5(t),this.forEach((function(t){this._styleGeometry(t)}),this),this.fire("setstyle",{type:"setstyle",target:this,style:t}),this},e.prototype._styleGeometry=function(t){if(!this._cookedStyles)return!1;for(var e=d5(t),n=0,i=this._cookedStyles.length;n<i;n++)if(!0===this._cookedStyles[n].filter(e))return t._setExternSymbol(this._cookedStyles[n].symbol),!0;return!1},e.prototype.removeStyle=function(){return this.options.style?(delete this.options.style,delete this._cookedStyles,this.forEach((function(t){t._setExternSymbol(null)}),this),this.fire("removestyle"),this):this},e.prototype.onAddGeometry=function(t){this.getStyle()&&this._styleGeometry(t)},e.prototype.hide=function(){for(var t=0,e=this._geoList.length;t<e;t++)this._geoList[t].onHide();return k9.prototype.hide.call(this)},e.prototype._initCache=function(){this._geoList||(this._geoList=[],this._geoMap={})},e.prototype._updateZIndex=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._maxZIndex=Math.max(this._maxZIndex,Math.max.apply(Math,X0([],Q0(t),!1))),this._minZIndex=Math.min(this._minZIndex,Math.min.apply(Math,X0([],Q0(t),!1)))},e.prototype._sortGeometries=function(){var t=this;this._toSort&&(this._maxZIndex=0,this._minZIndex=0,this._geoList.sort((function(e,n){return t._updateZIndex(e.getZIndex(),n.getZIndex()),t._compare(e,n)})),this._toSort=!1)},e.prototype._compare=function(t,e){return t.getZIndex()===e.getZIndex()?t._getInternalId()-e._getInternalId():t.getZIndex()-e.getZIndex()},e.prototype._findInList=function(t){var e=this._geoList.length;if(0===e)return-1;this._sortGeometries();for(var n,i=0,r=e-1;i<=r;){if(n=Math.floor((i+r)/2),this._geoList[n]===t)return n;this._compare(this._geoList[n],t)>0?r=n-1:i=n+1}return-1},e.prototype.onGeometryEvent=function(t){return this._onGeometryEvent(t)},e.prototype._onGeometryEvent=function(t){if(t&&t.target){var e=t.type;"idchange"===e?this._onGeometryIdChange(t):"zindexchange"===e?this._onGeometryZIndexChange(t):"positionchange"===e?this._onGeometryPositionChange(t):"shapechange"===e?this._onGeometryShapeChange(t):"symbolchange"===e?this._onGeometrySymbolChange(t):"show"===e?this._onGeometryShow(t):"hide"===e?this._onGeometryHide(t):"propertieschange"===e&&this._onGeometryPropertiesChange(t)}},e.prototype._onGeometryIdChange=function(t){if(t.new!==t.old||!this._geoMap[t.old]||this._geoMap[t.old]!==t.target){if(!n0(t.new)){if(this._geoMap[t.new])throw new Error("Duplicate geometry id in layer("+this.getId()+"):"+t.new);this._geoMap[t.new]=t.target}n0(t.old)||t.new===t.old||delete this._geoMap[t.old]}},e.prototype._onGeometryZIndexChange=function(t){t.old!==t.new&&(this._updateZIndex(t.new),this._toSort=!0,this._getRenderer()&&this._getRenderer().onGeometryZIndexChange(t))},e.prototype._onGeometryPositionChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPositionChange(t)},e.prototype._onGeometryShapeChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryShapeChange(t)},e.prototype._onGeometrySymbolChange=function(t){this._getRenderer()&&this._getRenderer().onGeometrySymbolChange(t)},e.prototype._onGeometryShow=function(t){this._getRenderer()&&this._getRenderer().onGeometryShow(t)},e.prototype._onGeometryHide=function(t){this._getRenderer()&&this._getRenderer().onGeometryHide(t)},e.prototype._onGeometryPropertiesChange=function(t){this._getRenderer()&&this._getRenderer().onGeometryPropertiesChange(t)},e.prototype._hasGeoListeners=function(t){if(!t)return!1;Array.isArray(t)||(Q7[0]=t,t=Q7);for(var e=this.getGeometries()||[],n=0,i=e.length;n<i;n++){var r=e[n];if(r){if(r.options.cursor)return!0;for(var o=0,s=t.length;o<s;o++)if(r.listens(t[o])>0)return!0}}return!1},e.prototype._getRenderer=function(){return t.prototype._getRenderer.call(this)},e}(k9);X7.mergeOptions({drawImmediate:!1,geometryEvents:!0,geometryEventTolerance:1});var Y7=new Y4,J7={debug:!1,enableSimplify:!0,defaultIconSize:[20,20],cacheVectorOnCanvas:!0,cacheSvgOnCanvas:G0.gecko,enableAltitude:!1,altitudeProperty:"altitude",drawAltitude:!1,sortByDistanceToCamera:!1,roundPoint:!1,altitude:0,clipBBoxBufferSize:3,collision:!1,collisionBufferSize:2,collisionDelay:250,collisionScope:"layer",progressiveRender:!1,progressiveRenderCount:1e3,progressiveRenderDebug:!1},K7=function(t){function e(e,n,i){var r=t.call(this,e,n,i)||this;return r.isVectorLayer=!0,r}return W0(e,t),e.prototype.onConfig=function(e){if(t.prototype.onConfig.call(this,e),!n0(e.enableAltitude))for(var n=this.getGeometries()||[],i=0,r=n.length;i<r;i++){var o=n[i];o&&(o._clearAltitudeCache(),o.fire("positionchange"))}if(e.enableAltitude||e.drawAltitude||e.altitudeProperty){var s=this.getRenderer();s&&s.setToRedraw&&s.setToRedraw()}},e.prototype.identify=function(t,e){e=e||{};var n=this.getRenderer();t instanceof F4||(t=new F4(t));var i=this.getMap().coordToContainerPoint(t);return e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(i,e):this._hitGeos(this._geoList,i,e)},e.prototype.identifyAtPoint=function(t,e){e=e||{};var n=this.getRenderer();return t instanceof $0||(t=new $0(t)),e.onlyVisible&&n&&n.identifyAtPoint?n.identifyAtPoint(t,e):this._hitGeos(this._geoList,t,e)},e.prototype._hitGeos=function(t,e,n){if(!t||!t.length)return[];var i=n.filter,r=[],o=n.tolerance,s=this.getMap(),a=this.getRenderer(),h=a&&a.getImageData&&a.getImageData();if(h){var l=0,u=a.maxTolerance;if(i0(u))l=u;else for(var c=t.length-1;c>=0;c--){var A=t[c]._hitTestTolerance()+(o||0);A>l&&(l=A)}var f=s.getDevicePixelRatio();h.r=f;var d=!1,p=e.x-l,g=e.y-l;for(c=-l;c<=l;c++){for(var m=-l;m<=l;m++){var y=Math.round((p+c)*f),v=Math.round((g+m)*f);if(h.data[v*h.width*4+4*y+3]>0){d=!0;break}}if(d)break}if(!d)return r}var _=n.onlyVisible;for(c=t.length-1;c>=0;c--){var x=t[c];if(x&&x.options.interactive&&(_||x.isVisible())){var b=x._getPainter();if(b){var w=b.getRenderBBOX&&b.getRenderBBOX();if(w&&(v=e.y,(y=e.x)<w[0]||v<w[1]||y>w[2]||v>w[3]))continue;if(!(x instanceof d7&&(x._getArrowStyle()||x instanceof k7))){var C=x.getContainerExtent(Y7);if(o&&(C=C._expand(o)),!C||!C.contains(e))continue}if(x._containsPoint(e,o)&&(!i||i(x))&&(r.push(x),n.count&&r.length>=n.count))break}}}return r},e.prototype.getAltitude=function(){return this.options.altitude||0},e.prototype.toJSON=function(t){t||(t={clipExtent:null,geometries:null});var e={type:this.getJSONType(),id:this.getId(),options:this.config()};if(n0(t.geometries)||t.geometries){var n=void 0;if(t.clipExtent){var i=this.getMap(),r=i?i.getProjection():null;n=new X4(t.clipExtent,r)}for(var o=[],s=this.getGeometries(),a=0,h=s.length;a<h;a++){var l=s[a],u=l.getExtent();if(u&&(!n||n.intersects(u))){var c=l.toJSON(t.geometries);o.push(c)}}e.geometries=o}return e},e.prototype.getRenderer=function(){return t.prototype.getRenderer.call(this)},e.fromJSON=function(t){if(!t||"VectorLayer"!==t.type)return null;for(var n=new e(t.id,t.options),i=t.geometries,r=[],o=0;o<i.length;o++){var s=M9.fromJSON(i[o]);s&&r.push(s)}return n.addGeometry(r),n},e.getPainterClass=function(){return h9},e.getCollectionPainterClass=function(){return c9},e}(X7);K7.mergeOptions(J7),K7.registerJSONType("VectorLayer");var $7="_map_tool",ttt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.addTo=function(t){return t?(this._map=t,t[$7]&&t[$7].disable(),this.onAdd&&this.onAdd(),this.enable(),t[$7]=this,this._fireEvent("add"),this):this},e.prototype.getMap=function(){return this._map},e.prototype.enable=function(){return!this._map||this._enabled||(this._enabled=!0,this._switchEvents("off"),this._registerEvents(),this.onEnable&&this.onEnable(),this._fireEvent("enable")),this},e.prototype.disable=function(){return this._enabled&&this._map?(this._enabled=!1,this._switchEvents("off"),this.onDisable&&this.onDisable(),this._fireEvent("disable"),this):this},e.prototype.isEnabled=function(){return!!this._enabled},e.prototype.remove=function(){return this._map?(this.disable(),this._map&&(delete this._map[$7],delete this._map),this._fireEvent("remove"),this):this},e.prototype._registerEvents=function(){this._switchEvents("on")},e.prototype._switchEvents=function(t){var e=this.getEvents();e&&this._map[t](e,this)},e.prototype._fireEvent=function(t,e){e||(e={}),this.fire(t,e)},e}(Q3(Y3)),ett={symbol:{lineColor:"#000",lineWidth:2,lineOpacity:1,polygonFill:"#fff",polygonOpacity:.3},doubleClickZoom:!1,mode:null,once:!1,autoPanAtEdge:!1,ignoreMouseleave:!0,blockGeometryEvents:!1,zIndex:Number.MAX_VALUE,enableAltitude:!0,interactive:!0,transformCoordinate:null},ntt={},itt=function(t){function e(e){var n=t.call(this,e)||this;return n._checkMode(),n._events={click:n._clickHandler,"mousemove touchmove":n._mouseMoveHandler,dblclick:n._doubleClickHandler,"mousedown touchstart":n._mouseDownHandler,"mouseup touchend":n._mouseUpHandler,mousemove:n._mouseMoveHandler,mousedown:n._mouseDownHandler,mouseup:n._mouseUpHandler},n}return W0(e,t),e.registerMode=function(t,e){ntt[t.toLowerCase()]=e},e.getRegisterMode=function(t){return ntt[t.toLowerCase()]},e.prototype.getMode=function(){return this.options.mode?this.options.mode.toLowerCase():null},e.prototype.setMode=function(t){return this._geometry&&(this._geometry.remove(),delete this._geometry),this._clearStage(),this._switchEvents("off"),this.options.mode=t,this._checkMode(),this.isEnabled()&&(this._switchEvents("on"),this._restoreMapCfg(),this._saveMapCfg()),this},e.prototype.getSymbol=function(){return S5(this.options.symbol||this.options.symbol)},e.prototype.setSymbol=function(t){return t?(this.options.symbol=t,this._geometry&&this._geometry.setSymbol(t),this):this},e.prototype.getCurrentGeometry=function(){return this._geometry},e.prototype.onAdd=function(){this._checkMode()},e.prototype.onEnable=function(){this._saveMapCfg(),this._drawToolLayer=this._getDrawLayer(),this._clearStage(),this._loadResources();var t=this.getMap();return this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge=t.options.autoPanAtEdge,this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!0})),this._geometryEvents=t.options.geometryEvents,this.options.blockGeometryEvents&&t.config("geometryEvents",!1),this},e.prototype.onDisable=function(){var t=this.getMap();return this._restoreMapCfg(),this.endDraw({ignoreEndEvent:!0}),this._map&&(t.removeLayer(this._getDrawLayer()),this.options.autoPanAtEdge&&(this._mapAutoPanAtEdge||t.config({autoPanAtEdge:!1}))),this.options.blockGeometryEvents&&t.config("geometryEvents",this._geometryEvents),this},e.prototype.undo=function(){var t=this._getRegisterMode();if(!this._shouldRecordHistory(t.action)||!this._historyPointer)return this;var e=this._clickCoords.slice(0,--this._historyPointer);return t.update(this.getMap().getProjection(),e,this._geometry),this},e.prototype.redo=function(){var t=this._getRegisterMode();if(!this._shouldRecordHistory(t.action)||n0(this._historyPointer)||this._historyPointer===this._clickCoords.length)return this;var e=this._clickCoords.slice(0,++this._historyPointer);return t.update(this.getMap().getProjection(),e,this._geometry),this},e.prototype._shouldRecordHistory=function(t){return Array.isArray(t)&&"click"===t[0]&&"mousemove"===t[1]&&"dblclick"===t[2]},e.prototype._checkMode=function(){this._getRegisterMode()},e.prototype._saveMapCfg=function(){var t=this.getMap();this._mapDoubleClickZoom=t.options.doubleClickZoom,t.config({doubleClickZoom:this.options.doubleClickZoom});for(var e=this._getRegisterMode().action,n=!1,i=0;i<e.length;i++)if(e[i].indexOf("mousedown")>=0||e[i].indexOf("touchstart")>=0){n=!0;break}if(n){var r=this.getMap();this._mapDraggable=r.options.draggable,r.config({draggable:!1})}},e.prototype._restoreMapCfg=function(){var t=this.getMap();t.config({doubleClickZoom:this._mapDoubleClickZoom}),n0(this._mapDraggable)||t.config("draggable",this._mapDraggable),delete this._mapDraggable,delete this._mapDoubleClickZoom},e.prototype._loadResources=function(){var t=x5(this.getSymbol());t.length>0&&this._drawToolLayer._getRenderer().loadResources(t)},e.prototype._getProjection=function(){return this._map.getProjection()},e.prototype._getRegisterMode=function(){var t=this.getMode(),n=e.getRegisterMode(t);if(!n)throw new Error(t+" is not a valid mode of DrawTool.");return n},e.prototype.getEvents=function(){var t=this._getRegisterMode().action,e={};if(Array.isArray(t)){for(var n=0;n<t.length;n++)e[t[n]]=this._events[t[n]];return e}return null},e.prototype._mouseDownHandler=function(t){this._createGeometry(t)},e.prototype._mouseUpHandler=function(t){this.endDraw(t)},e.prototype._clickHandler=function(t){if(!this.options.interactive)return this;t.enableAltitude=this.options.enableAltitude;var e=this.getMap(),n=this._getRegisterMode();if(this._clickCoords&&this._clickCoords.length){var i=this._clickCoords.length,r=e._pointToPrj(t.point2d);if(this._clickCoords[i-1].equals(r))return}if(this._geometry){r=e._pointToPrj(t.point2d),n0(this._historyPointer)||(this._clickCoords=this._clickCoords.slice(0,this._historyPointer));var o=this._geometry.snapTo;if(o&&a0(o)){var s=this._getSnapResult(o,t.containerPoint);if(r=s.prjCoord,this._clickCoords=this._clickCoords.concat(s.effectedVertex),this._clickCoords[this._clickCoords.length-1].equals(r))return}if(this._clickCoords.push(r),this._historyPointer=this._clickCoords.length,t.drawTool=this,n.update(e.getProjection(),this._clickCoords,this._geometry,t),"point"===this.getMode())return void this.endDraw(t);this._fireEvent(this._clickCoords.length<=1?"drawstart":"drawvertex",t),n.clickLimit&&n.clickLimit===this._historyPointer&&this.endDraw(t)}else this._createGeometry(t)},e.prototype._createGeometry=function(t){var e=this.getMode(),n=this.getMap(),i=this._getRegisterMode(),r=n._pointToPrj(t.point2d),o=this.getSymbol();if(!this._geometry){this._fireEvent("drawprepare",t),this._clickCoords=[r],t.drawTool=this,this._geometry=i.create(this.getMap().getProjection(),this._clickCoords,t),o&&"point"!==e?this._geometry.setSymbol(o):this.options.hasOwnProperty("symbol")&&this._geometry.setSymbol(this.options.symbol),this._addGeometryToStage(this._geometry),this._fireEvent("drawstart",t);var s=this._geometry.snapTo;if(s&&a0(s)){var a=this._getSnapResult(s,t.containerPoint),h=this.getMap();h&&a&&(this._clickCoords=[a.prjCoord],i.update(h.getProjection(),this._clickCoords,this._geometry,t))}}"point"===e&&"mousemove"!==t.type&&this.endDraw(t)},e.prototype._mouseMoveHandler=function(t){if(!this.options.interactive)return this;t.enableAltitude=this.options.enableAltitude;var e=this.getMap();if(e&&!e.isInteracting())if("point"!==this.getMode()||this._geometry){if(this._geometry){var n=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(n)){var i=e._pointToPrj(t.point2d),r=[],o=this._geometry.snapTo;if(o&&a0(o)){var s=this._getSnapResult(o,n);i=s.prjCoord,r=s.effectedVertex}var a=e.getProjection();t.drawTool=this;var h=this._getRegisterMode();if(this._shouldRecordHistory(h.action)){var l=this._clickCoords.slice(0,this._historyPointer);if(l&&l.length>0&&i.equals(l[l.length-1]))return;h.update(a,l.concat(r,[i]),this._geometry,t)}else h.update(a,i,this._geometry,t);this._fireEvent("mousemove",t)}}}else this._createGeometry(t)},e.prototype._doubleClickHandler=function(t){if(!this.options.interactive)return this;if(t.enableAltitude=this.options.enableAltitude,this._geometry){var e=this._getMouseContainerPoint(t);if(this._isValidContainerPoint(e)){var n=this._getRegisterMode(),i=this._clickCoords;if(i&&!(i.length<2)){var r=this.getMode();if(!(r&&r.indexOf("polygon")>-1&&i.length<3)){for(var o=this.getMap().getProjection(),s=[i[0]],a=1,h=i.length;a<h;a++)i[a].x===i[a-1].x&&i[a].y===i[a-1].y||s.push(i[a]);s.length<2||this._geometry&&this._geometry instanceof l7&&s.length<3||(t.drawTool=this,n.update(o,s,this._geometry,t),this.endDraw(t))}}}}},e.prototype._addGeometryToStage=function(t){this._getDrawLayer().addGeometry(t)},e.prototype.endDraw=function(t){if(!this._geometry||this._ending)return this;this._ending=!0;var e=this._geometry;return this._clearStage(),t=t||{},this._geometry=e,t.ignoreEndEvent||this._fireEvent("drawend",t),delete this._geometry,this.options.once&&this.disable(),delete this._ending,delete this._historyPointer,this._vertexes&&(this._vertexes=[]),this},e.prototype._clearStage=function(){this._getDrawLayer().clear(),delete this._geometry,delete this._clickCoords},e.prototype._getMouseContainerPoint=function(t){var e=this._getRegisterMode().action;return(e[0].indexOf("mousedown")>=0||e[0].indexOf("touchstart")>=0)&&d2(t.domEvent),t.containerPoint},e.prototype._isValidContainerPoint=function(t){var e=this._map.getSize();return!(t.x<0||t.y<0||t.x>e.width||t.y>e.height)},e.prototype._getSnapResult=function(t,e){var n=this.getMap(),i=[];if(this.options.edgeAutoComplete){i.push(n.prjToContainerPoint(this._clickCoords[(this._historyPointer||1)-1]));var r=this._clickCoords[(this._historyPointer||1)-2];r&&i.push(n.prjToContainerPoint(r))}var o=t(e,i),s=n._containerPointToPrj(e=(o.effectedVertex?o.point:o)||e);return o.effectedVertex&&(o.effectedVertex=o.effectedVertex.map((function(t){return n._containerPointToPrj(t)}))),{prjCoord:s,effectedVertex:o.effectedVertex||[]}},e.prototype._getDrawLayer=function(){var t=E1+"drawtool",e=this._map.getLayer(t);return e||(e=new K7(t,{enableSimplify:!1,enableAltitude:this.options.enableAltitude,zIndex:this.options.zIndex}),this._map.addLayer(e)),this._pushLayers(e),e},e.prototype._fireEvent=function(t,e){e||(e={}),e=e0({},e),this._geometry&&(e.geometry=this._getRegisterMode().generate(this._geometry,{drawTool:this}),e.tempGeometry=this._geometry),ttt.prototype._fireEvent.call(this,t,e)},e.prototype._pushLayers=function(t){var e=this;return t?(Array.isArray(t)||(t=[t]),this._layers=this._layers||[],t.forEach((function(t){-1===e._layers.indexOf(t)&&e._layers.push(t)})),this):this},e.prototype._outLayers=function(t){var e=this;return t?(Array.isArray(t)||(t=[t]),this._layers=this._layers||[],t.forEach((function(t){for(var n=0,i=e._layers.length;n<i;n++)if(t===e._layers[n]){e._layers.splice(n,1);break}})),this):this},e.prototype.setLayerZIndex=function(t){return i0(t)?(this.options.zIndex=t,this._layers=this._layers||[],this._layers.forEach((function(e){e&&e.setZIndex&&e.setZIndex(t)})),this):this},e.prototype.addCoordinate=function(t){if(!this.isEnabled())return this;var e=this.getMap();if(!e)return this;t=new F4(t);var n=e._parseEventFromCoord(t);return this._clickHandler(n),this},e.prototype.getTempGeometry=function(){return this._geometry},e}(ttt);itt.mergeOptions(ett);var rtt=function(t){function e(e){var n=t.call(this,e)||this;return n.drawTool=new itt({mode:"boxZoom",ignoreMouseleave:!1}),n}return W0(e,t),e.prototype.addHooks=function(){this.target.on("_mousedown",this._onMouseDown,this)},e.prototype.removeHooks=function(){this.target.off("_mousedown",this._onMouseDown,this),this.drawTool.isEnabled()&&this.drawTool.remove()},e.prototype._onMouseDown=function(t){this.target.options.boxZoom&&t.domEvent.shiftKey&&this.drawTool.setSymbol(this.target.options.boxZoomSymbol).on("drawend",this._boxZoom,this).addTo(this.target)},e.prototype._boxZoom=function(t){var e=this.target;this.drawTool.remove();var n=t.geometry,i=n.getCenter(),r=n.getSymbol(),o=new X4(i,e.locateByPoint(i,r.markerWidth,r.markerHeight),e.getProjection()),s=e.getFitZoom(o);e._animateTo({center:o.getCenter(),zoom:s})},e}(X3);H9.mergeOptions({boxZoom:!0,boxZoomSymbol:{markerType:"rectangle",markerLineWidth:3,markerLineColor:"#1bbc9b",markerLineDasharray:[10,5],markerFillOpacity:.1,markerFill:"#1bbc9b",markerWidth:1,markerHeight:1}}),H9.addOnLoadHook("addHandler","boxZoom",rtt);var ott=30,stt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.addHooks=function(){this.target&&this.target.on("_mousemove",this._onMouseMove,this)},e.prototype.removeHooks=function(){this.target&&this.target.off("_mousemove",this._onMouseMove,this)},e.prototype._onMouseMove=function(t){var e=this.target;if(e.options.autoPanAtEdge){var n=t.containerPoint,i=e.getContainerExtent();if(i){var r=n.x,o=n.y,s=i.xmax,a=i.ymax,h=void 0;r<ott&&(h=[Math.abs(r-ott),0]),o<ott&&(h=[0,Math.abs(o-ott)]),r+ott>s&&(h=[-Math.abs(r+ott-s),0]),o+ott>a&&(h=[0,-Math.abs(o+ott-a)]),h&&e.panBy(h,{duration:1})}}},e}(X3);function att(t,e,n){return t*(1-n)+e*n}function htt(t){t.stopPropagation(),t.preventDefault()}H9.mergeOptions({autoPanAtEdge:!1}),H9.addOnLoadHook("addHandler","autoPanAtEdge",stt),H9.include({animateTo:function(t,e,n){var i=this;void 0===e&&(e={}),t=e0({},this.getView(),t),this._validateView(t),a0(e)&&(n=e,e={});var r=this.getProjection(),o=this.getView(),s={},a=!0;for(var h in t)if(l0(t,h)&&!n0(t[h])&&("prjCenter"===h||!n0(o[h])))if(a=!1,"center"===h){var l=new F4(o[h]),u=new F4(t[h]);l.equals(u)||(s.center=[l,u])}else"prjCenter"===h?(l=new F4(this._getPrjCenter()),u=new F4(t[h]),l.equals(u)||(s.prjCenter=[l,u])):o[h]!==t[h]&&"around"!==h&&(s[h]=[o[h],t[h]]);if(a)return null;this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer)));var c=t.around||null,A=this._getRenderer(),f=this._animPlayer=i7.animate(s,{easing:e.easing||"out",duration:e.duration||this.options.zoomAnimationDuration,framer:function(t){A.callInNextFrame(t)},repeat:e.repeat},(function(t){i.isRemoved()?f.finish():("running"===f.playState?(t.styles.center?(i._setPrjCenter(r.project(t.styles.center)),i.onMoving(i._parseEventFromCoord(i.getCenter()))):t.styles.prjCenter&&(i._setPrjCenter(t.styles.prjCenter),i.onMoving(i._parseEventFromCoord(i.getCenter()))),n0(t.styles.zoom)||i.onZooming(t.styles.zoom,c),n0(t.styles.pitch)||i._setPitch(t.styles.pitch),n0(t.styles.bearing)||i._setBearing(t.styles.bearing),i._fireEvent("animating")):"paused"===f.playState&&f!==i._mapAnimPlayer||(f._interupted||(s.center?i._setPrjCenter(r.project(s.center[1])):s.prjCenter&&i._setPrjCenter(s.prjCenter[1]),n0(s.pitch)||i._setPitch(s.pitch[1]),n0(s.bearing)||i._setBearing(s.bearing[1])),i._endAnim(f,s,c,e)),n&&n(t))}),this);return this._startAnim(s,c),f},_animateTo:function(t,e,n){return void 0===e&&(e={}),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._isInternalAnimation=!0,this._mapAnimPlayer=this.animateTo(t,e,n),delete this._isInternalAnimation,this._mapAnimPlayer},flyTo:function(t,e,n){var i=this;void 0===e&&(e={}),t=e0({},this.getView(),t),this._validateView(t),this._animPlayer&&(this._isInternalAnimation?"running"===this._animPlayer.playState&&(this._animPlayer.pause(),this._prevAnimPlayer=this._animPlayer):(delete this._prevAnimPlayer,this._stopAnim(this._animPlayer))),a0(e)&&(n=e,e={}),e=e0({curve:1.42},e);var r=this;function o(t,e){return r.getResolution(e)/r.getResolution(t)}var s=t.around||new $0(this.width/2,this.height/2),a=this.getMinZoom(),h=this.getMaxZoom(),l=this.getProjection(),u=this.getView(),c=u.zoom,A=u.bearing,f=u.pitch,d="zoom"in t?f1(+t.zoom,a,h):c,p="bearing"in t?+t.bearing:A,g="pitch"in t?+t.pitch:f,m=l.project(t.center&&new F4(t.center)||this.getCenter()),y=o(d,c),v=l.project(this.getCenter()),_=m.sub(v),x=e.curve,b=Math.max(this.width,this.height),w=b/y,C=_.mag();if("minZoom"in e){var P=f1(Math.min(e.minZoom,c,d),a,h),M=b/o(P,c);x=Math.sqrt(M/C*2)}var T=x*x;function S(t){var e=(w*w-b*b+(t?-1:1)*T*T*C*C)/(2*(t?w:b)*T*C);return Math.log(Math.sqrt(e*e+1)-e)}function I(t){return(Math.exp(t)-Math.exp(-t))/2}function E(t){return(Math.exp(t)+Math.exp(-t))/2}var O=S(0),R=function(t){return E(O)/E(O+x*t)},D=function(t){return b*((E(O)*(I(e=O+x*t)/E(e))-I(O))/T)/C;var e},k=(S(1)-O)/x;if(Math.abs(C)<1e-6||!isFinite(k)){if(Math.abs(b-w)<1e-6)return this.animateTo(t,e,n);var L=w<b?-1:1;k=Math.abs(Math.log(w/b))/x,D=function(){return 0},R=function(t){return Math.exp(L*x*t)}}var F=this._getRenderer(),N=this._animPlayer=i7.animate({k:[0,1]},{easing:e.easing||"out",duration:e.duration||8,framer:function(t){F.callInNextFrame(t)}},(function(r){if(i.isRemoved())N.finish();else{var o=r.styles.k,a=o*k,h=1/R(a),l={};if(t.center){var u=1===o?m:v.add(_.multi(D(a)));l.prjCenter=[m,u]}if(c!==d){var y=1===o?d:i.getZoomForScale(h,c,!0);l.zoom=[c,y]}if(f!==g){var x=att(f,g,o);l.pitch=[g,x]}if(A!==p){var b=att(A,p,o);l.bearing=[p,b]}"running"===N.playState?(l.prjCenter&&(i._setPrjCenter(l.prjCenter[1]),i.onMoving(i._parseEventFromCoord(i.getCenter()))),l.zoom&&i.onZooming(l.zoom[1],s),l.pitch&&i._setPitch(l.pitch[1]),l.bearing&&i._setBearing(l.bearing[1]),i._fireEvent("animating")):"paused"===N.playState&&N!==i._mapAnimPlayer||(N._interupted||(l.prjCenter&&i._setPrjCenter(l.prjCenter[1]),l.pitch&&i._setPitch(l.pitch[1]),l.bearing&&i._setBearing(l.bearing[1])),i._endAnim(N,l,s,e)),n&&n(r)}}),{});return this._startAnim({center:t.center,zoom:t.zoom!==c,pitch:g!==f,bearing:p!==A},s),this},isAnimating:function(){return!!this._animPlayer},isRotating:function(){return this.isDragRotating()||!!this._animRotating},_endAnim:function(t,e,n,i){delete this._animRotating;var r=t._interupted?"animateinterrupted":"animateend";if(t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer,e.center){var o=void 0;o=t._interupted?this.getCenter():e.center[1],this.onMoveEnd(this._parseEventFromCoord(o))}else if(e.prjCenter){o=void 0,o=t._interupted?this._getPrjCenter():e.prjCenter[1];var s=this._parseEventFromCoord(this.getProjection().unproject(o));s.point2d=this._prjToPoint(o),this.onMoveEnd(s)}n0(e.zoom)||(t._interupted?this.onZoomEnd(this.getZoom()):i.wheelZoom?this.onZooming(e.zoom[1],n):this.onZoomEnd(e.zoom[1])),r&&this._fireEvent(r),n0(e.pitch)||this.getPitch()||this.getRenderer().setToRedraw(),i.wheelZoom||this._resumePrev(t)},_startAnim:function(t,e){this._animPlayer&&((t.center||t.prjCenter)&&this.onMoveStart(),t.zoom&&!this.isZooming()&&this.onZoomStart(t.zoom[1],e),(t.pitch||t.bearing)&&(this._animRotating=!0),this._fireEvent("animatestart"),this._animPlayer.play())},_stopAnim:function(t){t&&(delete this._animRotating,"finished"!==t.playState&&(t._interupted=!0,t.cancel()),t===this._animPlayer&&delete this._animPlayer,t===this._mapAnimPlayer&&delete this._mapAnimPlayer)},_resumePrev:function(t){if(this._prevAnimPlayer){var e=this._prevAnimPlayer;"paused"!==e.playState&&delete this._prevAnimPlayer,t!==e&&(this._animPlayer=e,e.play())}}});var ltt=["dragstart","dragenter","dragend","dragleave","dragover"].join(" ").toString(),utt="mousedown mouseup mouseover mouseout mouseenter mouseleave mousemove click dblclick contextmenu keypress touchstart touchmove touchend drop ";function ctt(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t}function Att(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function ftt(t){var e=t[0],n=t[1],i=t[2];return Math.sqrt(e*e+n*n+i*i)}function dtt(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o),t}function ptt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function gtt(t,e,n){var i=e[0],r=e[1],o=e[2],s=n[0],a=n[1],h=n[2];return t[0]=r*h-o*a,t[1]=o*s-i*h,t[2]=i*a-r*s,t}function mtt(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return Math.hypot?Math.hypot(n,i,r):function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,i=t.length;i--;)n+=t[i]*t[i];return Math.sqrt(n)}(n,i,r)}function ytt(t,e){dtt(t,t),dtt(e,e);var n=ptt(t,e);return n>1?0:n<-1?Math.PI:Math.acos(n)}function vtt(t,e,n){var i=e[0],r=e[1],o=e[2],s=1/(n[3]*i+n[7]*r+n[11]*o+n[15]);return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])*s,t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])*s,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])*s,t}H9.include({_registerDomEvents:function(){var t=this._panels.mapWrapper||this._containerDOM;u2(t,utt,this._handleDOMEvent,this),u2(t,ltt,htt,this)},_removeDomEvents:function(){var t=this._panels.mapWrapper||this._containerDOM;c2(t,utt,this._handleDOMEvent),c2(t,ltt,htt)},_handleDOMEvent:function(t){if(t&&"drop"===t.type){t.stopPropagation(),t.preventDefault();var e=this._parseEvent(t,t.type);return e=e0({},e,{dataTransfer:t.dataTransfer}),void this._fireEvent(t.type,e)}var n=this.options.clickTimeThreshold,i=t.type;if(!T2(i)||$$.isTest||!S2(this,this.options.mousemoveThrottleTime)){var r="mousedown"===i||"touchstart"===i&&(!t.touches||1===t.touches.length);r&&(this._domMouseDownTime=t0(),this._domMouseDownView=this.getView());var o="contextmenu"===i&&function(t){if(!t._domMouseDownView)return!0;var e=t.getView(),n=t._domMouseDownView;return e.bearing!==n.bearing||e.pitch!==n.pitch}(this);if("contextmenu"===i){f2(t);var s=this._domMouseDownTime;t0()-s<=n&&!o&&this._fireDOMEvent(this,t,"dom:"+t.type)}else this._fireDOMEvent(this,t,"dom:"+t.type);if(!this._ignoreEvent(t)&&!this._isEventOutMap(t)){var a,h=!1;if(r)this._mouseDownTime=t0();else if("click"===i||"touchend"===i||"contextmenu"===i){if(!this._mouseDownTime)return;if(s=this._mouseDownTime,delete this._mouseDownTime,t0()-s>n){if("click"===i||"contextmenu"===i)return}else if("contextmenu"===i){if(o)return}else"touchend"===i&&(h=!0)}h&&(this._clickTime&&t0()-this._clickTime<=n?(delete this._clickTime,a="dblclick",this._fireDOMEvent(this,t,"dom:dblclick")):(this._clickTime=t0(),a="click",this._fireDOMEvent(this,t,"dom:click"))),this._ignoreEvent(t)||this._isEventOutMap(t)||(this._fireDOMEvent(this,t,i),a&&this._fireDOMEvent(this,t,a))}}},_ignoreEvent:function(t){if(!t||!this._panels.control)return!1;var e,n=t.srcElement||t.target;if(n)for(;n&&n!==this._containerDOM;){if(n.className&&n.className.indexOf&&(n.className.indexOf("maptalks-control")>=0||n.className.indexOf("maptalks-ui")>=0&&e&&!e.eventsPropagation))return!0;e=n,n=n.parentNode}return!1},_isEventOutMap:function(t){if(this.getPitch()>this.options.maxVisualPitch){var e=m2(this._getActualEvent(t),this._containerDOM);if(!this.getContainerExtent().contains(e))return!0}return!1},_wrapTerrainData:function(t){t.containerPoint&&!t.terrain&&(t.terrain=this._queryTerrainInfo(t.containerPoint))},_parseEvent:function(t,e){if(!t)return null;var n={domEvent:t};if("keypress"!==e){var i=this._getActualEvent(t);if(i&&void 0!==i.clientX){var r=m2(i,this._containerDOM);n=e0(n,{containerPoint:r,viewPoint:this.containerPointToViewPoint(r)});var o=this.options.maxVisualPitch;(this.getPitch()<=o||r.y>=this.height-this._getVisualHeight(o))&&(n=e0(n,{coordinate:this.containerPointToCoord(r),point2d:this._containerPointToPoint(r)}))}}return this._wrapTerrainData(n),n},_parseEventFromCoord:function(t){var e=this.coordToContainerPoint(t);return{coordinate:t,containerPoint:e,viewPoint:this.containerPointToViewPoint(e),point2d:this.coordToPoint(t)}},_getActualEvent:function(t){return t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t},_fireDOMEvent:function(t,e,n){var i=this;if(!this.isRemoved()){var r=this._parseEvent(e,n);this._wrapTerrainData(r),T2(n)?this.getRenderer().callInNextFrame((function(){i._fireEvent(r.domEvent&&r.domEvent._cancelBubble?"_"+n:n,r)})):this._fireEvent(n,r)}},_getEventParams:function(t){var e=this,n={domEvent:t},i=t.touches&&t.touches.length>0?t.touches[0]:t.changedTouches&&t.changedTouches.length>0?t.changedTouches[0]:t;if(i){var r=m2(i,e.getContainer());n.coordinate=e.containerPointToCoordinate(r),n.containerPoint=r,n.viewPoint=e.containerPointToViewPoint(r),n.point2d=e._containerPointToPoint(r)}return this._wrapTerrainData(n),n}}),H9.addOnLoadHook("_registerDomEvents"),H9.include({isFullScreen:function(){var t=document;return!!(t.webkitIsFullScreen||t.mozFullScreen||t.msFullscreenElement||t.fullscreenElement)},requestFullScreen:function(t){return this._fireEvent("fullscreenstart"),this._requestFullScreen(t||this._containerDOM),this._fireEvent("fullscreenend"),this},cancelFullScreen:function(){return this._cancelFullScreen(),this._fireEvent("cancelfullscreen"),this},_requestFullScreen:function(t){if(t.requestFullscreen)t.requestFullscreen();else if(t.mozRequestFullScreen)t.mozRequestFullScreen();else if(t.webkitRequestFullScreen)t.webkitRequestFullScreen();else if(t.msRequestFullScreen)t.msRequestFullScreen();else{var e="fullscreen=1,status=no,resizable=yes,top=0,left=0,scrollbars=no,titlebar=no,menubar=no,location=no,toolbar=no,z-look=yes,width="+(screen.availWidth-8)+",height="+(screen.availHeight-45);null!==window.open(location.href,"_blank",e)&&(window.opener=null,window.close())}},_cancelFullScreen:function(){var t=document;document.exitFullscreen?document.exitFullscreen():t.mozCancelFullScreen?t.mozCancelFullScreen():t.webkitCancelFullScreen?t.webkitCancelFullScreen():null!==window.open(location.href,"_blank","fullscreen=no,status=yes,resizable=yes,scrollbars=no,titlebar=no,menubar=yes,location=yes,toolbar=yes,z-look=yes")&&(window.opener=null,window.close())}}),H9.include({panTo:function(t,e,n){if(void 0===e&&(e={}),!t)return this;if(a0(e)&&(n=e,e={}),t=new F4(t),void 0===e.animation||e.animation){var i=this.getProjection().project(t);return this._panAnimation(i,e.duration,n)}return this.setCenter(t),this},_panTo:function(t,e){return void 0===e&&(e={}),void 0===e.animation||e.animation?this._panAnimation(t,e.duration):(this.onMoveStart(),this._setPrjCenter(t),this.onMoveEnd(this._parseEventFromCoord(this.getCenter())),this)},panBy:function(t,e,n){if(void 0===e&&(e={}),!t)return this;if(a0(e)&&(n=e,e={}),t=new $0(t),this.getContainerExtent().ymin>0&&t.y>30){var i=t.y;t.y=30,t.x=30*t.x/i,console.warn("offset is limited to panBy when pitch is above maxPitch")}if(void 0===e.animation||e.animation){t=t.multi(-1);var r=this._containerPointToPrj(new $0(this.width/2+t.x,this.height/2+t.y));this._panAnimation(r,e.duration,n)}else{this.onMoveStart(),this._offsetCenterByPixel(t);var o=this.containerPointToCoord(new $0(this.width/2,this.height/2));this.onMoveEnd(this._parseEventFromCoord(o))}return this},_panAnimation:function(t,e,n){return this._animateTo({prjCenter:t},{duration:e||this.options.panAnimationDuration},n)}}),H9.include({computeLength:function(t,e){if(!this.getProjection())return null;var n=new F4(t),i=new F4(e);return n.equals(i)?0:this.getProjection().measureLength(n,i)},computeGeometryLength:function(t){return t._computeGeodesicLength(this.getProjection())},computeGeometryArea:function(t){return t._computeGeodesicArea(this.getProjection())},identify:function(t,e){var n=new F4((t=t||{}).coordinate);return this._identify(t,e,(function(e){return e.identify(n,t)}))},identifyAtPoint:function(t,e){var n=t.includeInternals,i=t.tolerance,r=new $0((t=t||{}).containerPoint),o=this.containerPointToCoord(r);return this._identify(t,e,(function(e){var r,s=t.containerPoint;return n&&!n0(e.options.geometryEventTolerance)&&(t.tolerance=t.tolerance||0,t.tolerance+=e.options.geometryEventTolerance),e._hasGeoListeners&&n&&t.eventTypes.indexOf("mousemove")>=0&&!e._hasGeoListeners(t.eventTypes)?[]:(r=e.identifyAtPoint?e.identifyAtPoint(s,t):o&&e.identify?e.identify(o,t):[],n&&(n0(i)?delete t.tolerance:t.tolerance=i),r&&r.length||(e.fire("identifyempty",t),e.getLayers&&a0(e.getLayers)&&(e.getLayers()||[]).filter((function(t){return t})).forEach((function(e){e.fire("identifyempty",t)}))),r)}))},_identify:function(t,e,n){var i=t.layers;if(!d1(i))return this;for(var r=t.eventTypes,o=[],s=0,a=i.length;s<a;s++)s0(i[s])?o.push(this.getLayer(i[s])):o.push(i[s]);r&&(o=o.filter((function(t){return!t._hasGeoListeners||t._hasGeoListeners(r)})));var h=[];for(s=o.length-1;s>=0&&!(t.count&&h.length>=t.count);s--){var l=o[s];if(l&&l.getMap()&&(t.includeInvisible||l.isVisible())&&(t.includeInternals||!(l.getId().indexOf(E1)>=0))){var u=n(l),c=l.getId();if(u)if(Array.isArray(u)){for(var A=0;A<u.length;A++)u[A]&&!u[A].getLayer&&n0(u[A].layer)&&(u[A].layer=c);s1(h,u)}else!u.getLayer&&n0(u.layer)&&(u.layer=c),h.push(u)}}return e.call(this,h),this}}),H9.include({_zoom:function(t,e){this.options.zoomable&&!this.isZooming()&&(e=this._checkZoomOrigin(e),t=this._checkZoom(t),this.onZoomStart(t,e),this._frameZoom=this.getZoom(),this.onZoomEnd(t,e))},_zoomAnimation:function(t,e,n){this.options.zoomable&&!this.isZooming()&&(t=this._checkZoom(t),this.getZoom()!==t&&(e=this._checkZoomOrigin(e),this._startZoomAnim(t,e,n)))},_checkZoomOrigin:function(t){return t&&!this.options.zoomInCenter||(t=new $0(this.width/2,this.height/2)),this.options.zoomOrigin&&(t=new $0(this.options.zoomOrigin)),t},_startZoomAnim:function(t,e,n){n0(n)&&(n=1);var i=this._getResolution(this._startZoomVal)/this._getResolution(t),r=this.options.zoomAnimationDuration*Math.abs(i-n)/Math.abs(i-1);this._frameZoom=this._startZoomVal,this._animateTo({zoom:t,around:e},{continueOnViewChanged:!0,duration:r})},onZoomStart:function(t,e){this.options.zoomable&&!this.isZooming()&&(this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),delete this.cameraZenithDistance,this._zooming=!0,this._startZoomVal=this.getZoom(),this._startZoomCoord=e&&this._containerPointToPrj(e),this._fireEvent("zoomstart",{from:this._startZoomVal,to:t}))},onZooming:function(t,e,n){if(this.options.zoomable&&this._frameZoom!==t){n0(n)&&(n=1),this._zoomTo(t,e);var i=this.getResolution(t),r=this.getResolution(this._startZoomVal)/i/n,o=this._startZoomCoord&&this.prjToContainerPoint(this._startZoomCoord,this._startZoomVal),s=this.getViewPoint();if(!this.isRotating()&&o&&!o.equals(e)&&1!==r){var a=this.getPitch(),h=o._sub(e)._multi(1/(1-r));a&&(h.y/=Math.cos(a*Math.PI/180)),e=e.add(h)}var l=e&&e.x||this.width/2,u=e&&e.y||this.height/2,c={view:[r,0,0,r,(l-s.x)*(1-r),(u-s.y)*(1-r)]},A=this.getDevicePixelRatio();c.container=[r,0,0,r,l*A*(1-r),u*A*(1-r)],this._fireEvent("zooming",{from:this._startZoomVal,to:t,origin:new $0(l,u),matrix:c}),this._frameZoom=t}},onZoomEnd:function(t,e){if(this.options.zoomable){var n=this._startZoomVal;this._zoomTo(t,e),this._zooming=!1,this._getRenderer().onZoomEnd(),this._suppressRecenter||this._recenterOnTerrain(),this._fireEvent("zoomend",{from:n,to:t}),this._verifyExtent(this._getPrjCenter())||this.options.limitExtentOnMaxExtent||this._panTo(this._prjMaxExtent.getCenter())}},_zoomTo:function(t,e){if(this._zoomLevel=t,this._calcMatrices(),e&&this._startZoomCoord){var n=this._containerPointToPoint(e)._sub(this._prjToPoint(this._getPrjCenter()));this._setPrjCoordAtOffsetToCenter(this._startZoomCoord,n)}},_checkZoom:function(t){var e=this.getMaxZoom(),n=this.getMinZoom();return t<n&&(t=n),t>e&&(t=e),t}});var _tt=Math.PI/180,xtt=new F4(0,0),btt=new $0(0,0),wtt=[0,-1,0],Ctt=[];function Ptt(){return z5(new Array(16))}H9.include({getFov:function(){return this._fov||(this._fov=.6435011087932844),this._fov/_tt},setFov:function(t){if(this.isZooming())return this;if(t=Math.max(.01,Math.min(60,t)),this._fov===t)return this;var e=this.getFov();return this._fov=t*_tt,this._calcMatrices(),this._renderLayers(),this._fireEvent("fovchange",{from:e,to:this.getFov()}),this},getBearing:function(){return this._angle?-this._angle/_tt:0},setBearing:function(t){var e={bearing:t};return this._validateView(e),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setBearing(e.bearing)},_setBearing:function(t){if(G0.ie9)throw new Error("map can't rotate in IE9.");var e=-A1(t,-180,180)*_tt;if(this._angle===e)return this;var n=this.getBearing();return this._fireEvent("rotatestart",{from:n,to:e}),this._angle=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("rotate",{from:n,to:e}),this._fireEvent("rotateend",{from:n,to:e}),this},getPitch:function(){return this._pitch?this._pitch/Math.PI*180:0},setPitch:function(t){var e={pitch:t};return this._validateView(e),this._mapAnimPlayer&&this._stopAnim(this._mapAnimPlayer),this._setPitch(e.pitch)},_setPitch:function(t){if(G0.ie9)throw new Error("map can't tilt in IE9.");var e=f1(t,0,this.options.maxPitch)*_tt;if(this._pitch===e)return this;var n=this.getPitch();return this._fireEvent("pitchstart",{from:n,to:e}),this._pitch=e,this._calcMatrices(),this._renderLayers(),this._fireEvent("pitch",{from:n,to:e}),this._fireEvent("pitchend",{from:n,to:e}),this},setCameraMovements:function(t,e){var n=this;if(!Array.isArray(t)||!t.length)return this;if(t.forEach((function(t){n._validateView(t)})),this.setView({center:t[0].center,zoom:t[0].zoom,pitch:t[0].pitch,bearing:t[0].bearing}),1===t.length)return this;var i=1,r=function(o){if("finished"===o.state.playState){++i==t.length-1&&(r=null);var s=t[i];s.duration=s.timestamp-t[i-1].timestamp,e&&e.autoRotate&&(s.bearing=(a=t[i-1].center,h=s.center,l=c0(a[0]),u=c0(h[0]),c=c0(a[1]),A=c0(h[1]),f=Math.sin(u-l)*Math.cos(A),d=Math.cos(c)*Math.sin(A)-Math.sin(c)*Math.cos(A)*Math.cos(u-l),A0(Math.atan2(f,d)))),n._setCameraMovement(s,r)}var a,h,l,u,c,A,f,d};2===t.length&&(r=null);var o=this.getBearing();return this._setCameraMovement(q0({bearing:o,duration:t[i].timestamp-t[i-1].timestamp},t[i]),r),{play:function(){n._animPlayer.play()},pause:function(){n._animPlayer.pause()},cancel:function(){n._animPlayer.cancel()},finish:function(){n._animPlayer.finish()},reverse:function(){n._animPlayer.reverse()}}},_setCameraMovement:function(t,e){this.animateTo({zoom:t.zoom,center:t.center,pitch:t.pitch,bearing:t.bearing},{duration:t.duration,easing:"out"},e)},setCameraOrientation:function(t){var e=t.position,n=t.pitch,i=t.bearing;this._validateView(t),i=i||0;var r=this.getFitZoomForCamera(e,n=n||0),o=r.zoom,s=r.cameraToGroundDistance,a=Math.sin(n*_tt)*s,h=A1(i,-180,180)*_tt,l=this.getGLRes(),u=new F4(e[0],e[1]),c=this.coordToPointAtRes(u,l),A=new $0(0,0);A.x=c.x+a*Math.sin(h),A.y=c.y+a*Math.cos(h);var f=this._pointToPrjAtRes(A,this.getGLRes());return this._setPrjCenter(f),this.setView({bearing:i,pitch:n,zoom:o}),this},setCameraPosition:function(t){var e=this.getGLRes(),n=this.coordToPointAtRes(t,e);n.z=this.altitudeToPoint(t.z||0,e);var i=this.getCenter(),r=this.coordToPointAtRes(i,e);r.z=this.altitudeToPoint(i.z,e);var o=Att([],n.toArray(),r.toArray());ctt(this.cameraUp||[0,0,0],0,0,1),this._pitch=ytt(o,this.cameraUp),ctt(Ctt,o[0],o[1],0),this._angle=-ytt(Ctt,wtt),this._zoomLevel=this.getFitZoomForCamera(t,this._pitch).zoom,this._calcMatrices()},getFitZoomForCamera:function(t,e){var n=Array.isArray(t)?t[2]:t.z,i=(this.centerAltitude||0)*this._meterToGLPoint,r=(n*this._meterToGLPoint-i)/Math.cos(e*_tt);return{zoom:this.getFitZoomForAltitude(r+i),cameraToGroundDistance:r}},getFitZoomForAltitude:function(t){for(var e=t*this._getFovRatio()*2/(this.height||1)*this.getGLRes(),n=this._getResolutions(),i=0;i<n.length-1;i++){if(n[i]===e)return i;if(n[i+1]===e)return i+1;if(e<n[i]&&e>n[i+1])return(i=(e-n[i])/(n[i+1]-n[i])+i)-1}return i},isTransforming:function(){return!(!this._pitch&&!this._angle)},getFrustumAltitude:function(){return this._frustumAltitude},_calcFrustumAltitude:function(){var t=90-this.getPitch(),e=this.getFov()/2,n=this.cameraPosition?this.cameraPosition[2]:0;if(e<=t)return n;e=Math.PI*e/180;var i=new $0(this.cameraPosition).distanceTo(new $0(this.cameraLookAt)),r=n*Math.tan(2*e);return n+Math.tan(e)*(i+r)},_pointToContainerPoint:function(t,e,n,i){void 0===n&&(n=0);var r=this._getResolution(e);return this._pointAtResToContainerPoint(t,r,n,i)},_pointAtResToContainerPoint:function(t,e,n,i){void 0===n&&(n=0),i||(i=new $0(0,0)),t=this._pointAtResToPoint(t,e,i);var r,o=this.isTransforming();return o||n||(r=this._prjToPoint(this._getPrjCenter(),void 0,xtt)),this._toContainerPoint(i,o,n,r),i},_pointsAtResToContainerPoints:function(t,e,n,i){void 0===n&&(n=[]),void 0===i&&(i=[]);var r=this.getPitch(),o=this.getBearing(),s=e/this._getResolution();if(0===r&&0===o&&!function(t){if(i0(t))return 0!==t;if(Array.isArray(t)&&t.length>0)for(var e=0,n=t.length;e<n;e++)if(i0(t[e])&&0!==t[e])return!0;return!1}(n)){var a=this.get2DExtent(),h=a.xmin,l=a.ymin,u=a.xmax,c=a.ymax;if(u>h&&c>l){for(var A=this.getSize(),f=A.height,d=(u-h)/A.width,p=(c-l)/f,g=0,m=t.length;g<m;g++)t[g]?((x=i[g]).x=t[g].x,x.y=t[g].y,x._multi(s),x.x=(x.x-h)*d,x.y=f-(x.y-l)*p):i[g]=null;return i}}var y=Array.isArray(n),v=this.isTransforming(),_=this._prjToPoint(this._getPrjCenter(),void 0,xtt);for(g=0,m=t.length;g<m;g++){var x;t[g]?((x=i[g]).x=t[g].x,x.y=t[g].y,x._multi(s),this._toContainerPoint(x,v,y?n[g]||0:n,_)):i[g]=null}return i},_toContainerPoint:function(){var t=[0,0,0];return function(e,n,i,r){var o=this.width/2,s=this.height/2;if(n||i){this._altitudeScale||(this._altitudeScale=this.altitudeToPoint(100,this.getGLRes())/100);var a=this._glScale;ctt(t,e.x*a,e.y*a,i*this._altitudeScale);var h=this._projIfBehindCamera(t,this.cameraPosition,this.cameraForward);vtt(h,h,this.projViewMatrix),e.x=h[0]*o+o,e.y=-h[1]*s+s}else e._sub(r.x,r.y),e.set(e.x,-e.y),e._add(o,s)}}(),_projIfBehindCamera:function(){var t=new Array(3),e=new Array(3),n=new Array(3);return function(i,r,o){Att(t,i,r);var s,a,h,l=ptt(o,t);return l<=0&&(a=o,h=1.01*l,(s=e)[0]=a[0]*h,s[1]=a[1]*h,s[2]=a[2]*h,function(t,e,n){t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2]}(i,r,Att(n,t,e))),i}}(),_containerPointToPoint:function(t,e,n,i){var r=this._getResolution(e);return this._containerPointToPointAtRes(t,r,n,i)},_containerPointToPointAtRes:function(){var t=[0,0,0],e=[0,0,0,1],n=[0,0,0,1];return function(i,r,o,s){if(this.isTransforming()){var a=this.width/2||1,h=this.height/2||1;ctt(t,(i.x-a)/a,(h-i.y)/h,0),ctt(e,t[0],t[1],0),ctt(n,t[0],t[1],1),e[3]=n[3]=1,vtt(e,e,this.projViewMatrixInverse),vtt(n,n,this.projViewMatrixInverse);var l=e[0],u=n[0],c=e[1],A=n[1],f=e[2],d=n[2],p=s?this.altitudeToPoint(s,r)*this._glScale:0,g=f===d?p:(p-f)/(d-f),m=c1(l,u,g),y=c1(c,A,g);return o?(o.x=m,o.y=y):o=new $0(m,y),o._multi(1/this._glScale),this._getResolution()===r?o:this._pointToPointAtRes(o,r,o)}var v=this._prjToPointAtRes(this._getPrjCenter(),r,o),_=this._getResolution()/r;return v._add(_*(i.x-this.width/2),-_*(i.y-this.height/2))}}(),_calcMatrices:function(){var t=Ptt();return function(){delete this._mapRes,delete this._mapGlRes,delete this._mapExtent2D,delete this._mapGlExtent2D;var e=this.getSize(),n=e.width||1,i=e.height||1;this._glScale=this.getGLScale();var r=this._getCameraWorldMatrix(),o=this.getFov()*Math.PI/180,s=this._getCameraFar(o,this.getPitch());this.cameraFar=s,this.cameraNear=this.cameraCenterDistance/20;var a=this.projMatrix||Ptt();D5(a,o,n/i,this.cameraNear,s),this.projMatrix=a,this.viewMatrix=N5(this.viewMatrix||Ptt(),r),this.projViewMatrix=F5(this.projViewMatrix||Ptt(),a,this.viewMatrix),this._calcCascadeMatrixes(),this.projViewMatrixInverse=F5(this.projViewMatrixInverse||Ptt(),r,N5(t,a)),this.domCssMatrix=this._calcDomMatrix(),this._frustumAltitude=this._calcFrustumAltitude(),this._mapRes=this._getResolution(),this._mapGlRes=this.getGLRes(),this._mapExtent2D=this.get2DExtent(),this._mapGlExtent2D=this.get2DExtentAtRes(this._mapGlRes)}}(),_getCameraFar:function(t,e){var n=this.cameraCenterDistance=mtt(this.cameraPosition,this.cameraLookAt);e=e*Math.PI/180;var i=n/this._meterToGLPoint+this.options.cameraFarUndergroundInMeter/Math.cos(e);return Math.max(i*this._meterToGLPoint,5*n)},_calcCascadeMatrixes:function(){var t=Ptt();function e(e,n,i){var r=this.width,o=this.height,s=this.getFov()*Math.PI/180,a=this._getCameraFar(s,n),h=this.cameraCenterDistance;return a=h+(a-h)/Math.cos((90-n)*Math.PI/180)*Math.cos((90-e)*Math.PI/180),D5(t,s,r/o,.1,a),F5(i,t,this.viewMatrix)}return function(){var t=this.getPitch(),n=this.options.cascadePitches[0],i=this.options.cascadePitches[1],r=this.cascadeFrustumMatrix0=this.cascadeFrustumMatrix0||Ptt(),o=this.cascadeFrustumMatrix1=this.cascadeFrustumMatrix1||Ptt();t>n?e.call(this,t,n,r):B5(this.cascadeFrustumMatrix0,this.projViewMatrix),t>i?e.call(this,t,i,o):B5(this.cascadeFrustumMatrix1,this.cascadeFrustumMatrix0)}}(),_calcDomMatrix:function(){var t=Ptt(),e=Ptt(),n=[1,-1,1],i=[0,0,0];return function(){var r,o,s,a,h,l,u,c,A,f,d,p,g,m=this.width||1,y=this.height||1,v=.5/Math.tan(this._fov/2)*y;return L5(t,this.projMatrix,n),k5(t,t,ctt(i,0,0,-v)),this._pitch&&(r=t,o=t,s=this._pitch,a=Math.sin(s),h=Math.cos(s),l=o[4],u=o[5],c=o[6],A=o[7],f=o[8],d=o[9],p=o[10],g=o[11],o!==r&&(r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15]),r[4]=l*h+f*a,r[5]=u*h+d*a,r[6]=c*h+p*a,r[7]=A*h+g*a,r[8]=f*h-l*a,r[9]=d*h-u*a,r[10]=p*h-c*a,r[11]=g*h-A*a),this._angle&&function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],s=e[1],a=e[2],h=e[3],l=e[4],u=e[5],c=e[6],A=e[7];e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+l*i,t[1]=s*r+u*i,t[2]=a*r+c*i,t[3]=h*r+A*i,t[4]=l*r-o*i,t[5]=u*r-s*i,t[6]=c*r-a*i,t[7]=A*r-h*i}(t,t,this._angle),z5(e),L5(e,e,ctt(i,m/2,-y/2,1)),F5(this.domCssMatrix||Ptt(),e,t)}}(),_getFovZ:function(t){var e=this.getGLScale(t),n=this._getFovRatio();return e*(this.height||1)/2/n},_getCameraWorldMatrix:function(){var t={};return function(){var e=this.getGLRes();this._meterToGLPoint||(this._meterToGLPoint=this.distanceToPointAtRes(100,0,e).x/100);var n=this._prjToPointAtRes(this._prjCenter,e,btt),i=this.getCenter().z,r=(void 0!==i?i:this.centerAltitude||0)*this._meterToGLPoint;this.cameraLookAt=ctt(this.cameraLookAt||[0,0,0],n.x,n.y,r);var o=this.getPitch()*_tt,s=this.getBearing()*_tt,a=this._getFovZ(),h=(void 0===this.cameraZenithDistance?a:this.cameraZenithDistance)-r,l=h*Math.cos(o),u=Math.sin(o)*h,c=n.x-u*Math.sin(s),A=n.y-u*Math.cos(s);this.cameraPosition=ctt(this.cameraPosition||[0,0,0],c,A,l+r),this.cameraToCenterDistance=a;var f=u||1;this.cameraUp=this.cameraUp||[0,0,0];var d,p,g,m,y,v,_,x=this.cameraUp=ctt(this.cameraUp,Math.sin(s)*f,Math.cos(s)*f,Math.sin(o)*f),b=this.cameraWorldMatrix=this.cameraWorldMatrix||Ptt();d=b,p=this.cameraPosition,g=this.cameraLookAt,m=x,y=[0,0,0],v=[0,0,0],Att(_=[0,0,0],p,g),0===ftt(_)&&(_[2]=1),dtt(_,_),gtt(y,m,_),0===ftt(_)&&(1===Math.abs(m[2])?_[0]+=1e-4:_[2]+=1e-4,dtt(_,_),gtt(y,m,_)),dtt(y,y),gtt(v,_,y),d[0]=y[0],d[4]=v[0],d[8]=_[0],d[1]=y[1],d[5]=v[1],d[9]=_[1],d[2]=y[2],d[6]=v[2],d[10]=_[2];var w=this.cameraForward||[0,0,0];return Att(w,this.cameraLookAt,this.cameraPosition),this.cameraForward=dtt(w,w),function(t,e){var n,i=e[0],r=e[4],o=e[8],s=e[1],a=e[5],h=e[9],l=e[2],u=e[6],c=e[10],A=i+a+c;A>0?(n=.5/Math.sqrt(A+1),t.w=.25/n,t.x=(u-h)*n,t.y=(o-l)*n,t.z=(s-r)*n):i>a&&i>c?(n=2*Math.sqrt(1+i-a-c),t.w=(u-h)/n,t.x=.25*n,t.y=(r+s)/n,t.z=(o+l)/n):a>c?(n=2*Math.sqrt(1+a-i-c),t.w=(o-l)/n,t.x=(r+s)/n,t.y=.25*n,t.z=(h+u)/n):(n=2*Math.sqrt(1+c-i-a),t.w=(s-r)/n,t.x=(o+l)/n,t.y=(h+u)/n,t.z=.25*n)}(t,b),function(t,e){var n=t,i=e.x,r=e.y,o=e.z,s=e.w,a=i+i,h=r+r,l=o+o,u=i*a,c=i*h,A=i*l,f=r*h,d=r*l,p=o*l,g=s*a,m=s*h,y=s*l;n[0]=1-(f+p),n[4]=c-y,n[8]=A+m,n[1]=c+y,n[5]=1-(u+p),n[9]=d-g,n[2]=A-m,n[6]=d+g,n[10]=1-(u+f),n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1}(b,t),function(t,e){var n=t;n[12]=e[0],n[13]=e[1],n[14]=e[2]}(b,this.cameraPosition),b}}(),updateCenterAltitude:function(){this.getRenderer().setToRedraw(),!this.centerAltitude&&this._hasAltitudeLayer()&&(this.centerAltitude=0),this._recenterOnTerrain()},_recenterOnTerrain:function(){if(void 0!==this.centerAltitude&&void 0===this._centerZ){var t=this._queryTerrainByProjCoord(this._prjCenter);n0(t)&&this._hasAltitudeLayer()&&(t=this.centerAltitude);var e=t||0,n=this.getPitch()*_tt,i=this.getBearing()*_tt,r=(e-this.centerAltitude)*this._meterToGLPoint,o=this._getFovZ(),s=(void 0===this.cameraZenithDistance?o:this.cameraZenithDistance)-this.centerAltitude*this._meterToGLPoint-r/Math.cos(n),a=this.cameraPosition,h=Math.sin(n)*s,l=btt;l.x=a[0]+h*Math.sin(i),l.y=a[1]+h*Math.cos(i);var u=e*this._meterToGLPoint;this.cameraZenithDistance=(a[2]-u)/Math.cos(n)+u,this.centerAltitude=e;var c=this.pointAtResToCoordinate(l,this.getGLRes(),xtt);this._eventSilence=!0,this._suppressRecenter=!0,this.setCenter(c),delete this._suppressRecenter,delete this._eventSilence,n0(t)&&delete this.centerAltitude}},_queryTerrainByProjCoord:function(t){for(var e=this._getLayers(),n=0;n<e.length;n++)if(e[n].queryTerrainByProjCoord)return e[n].queryTerrainByProjCoord(t)[0];return 0},_hasAltitudeLayer:function(){for(var t=this._getLayers(),e=0;e<t.length;e++)if(t[e].getTerrainLayer&&t[e].getTerrainLayer())return!0;return!1},_queryTerrainInfo:function(t){for(var e=this._getLayers()||[],n=0;n<e.length;n++){var i=e[n];if(t&&i&&i.queryTerrainAtPoint&&i.getTerrainLayer&&i.getTerrainLayer()){var r=i.queryTerrainAtPoint(t);if(r)return{coordinate:r,altitude:r.z};break}}return null},_getFovRatio:function(){var t=this.getFov();return Math.tan(t/2*_tt)},_renderLayers:function(){this.isInteracting()||this._getLayers().forEach((function(t){if(t){var e=t._getRenderer();e&&e.setToRedraw&&e.setToRedraw()}}))}}),H9.include({_onViewChange:function(t){this._viewHistory||(this._viewHistory=[],this._viewHistoryPointer=0);for(var e=this._getCurrentView(),n=this._viewHistory.length-1;n>=0;n--)if(b1(t,this._viewHistory[n]))return this._viewHistoryPointer=n,void this._fireViewChange(e,t);this._viewHistoryPointer<this._viewHistory.length-1&&this._viewHistory.splice(this._viewHistoryPointer+1),this._viewHistory.push(t);var i=this.options.viewHistoryCount;i>0&&this._viewHistory.length>i&&this._viewHistory.splice(0,this._viewHistory.length-i),this._viewHistoryPointer=this._viewHistory.length-1,this._fireViewChange(e,t)},zoomToPreviousView:function(t){if(void 0===t&&(t={}),!this.hasPreviousView())return null;var e=this._viewHistory[--this._viewHistoryPointer];return this._zoomToView(e,t),e},hasPreviousView:function(){return!(!this._viewHistory||0===this._viewHistoryPointer)},zoomToNextView:function(t){if(void 0===t&&(t={}),!this.hasNextView())return null;var e=this._viewHistory[++this._viewHistoryPointer];return this._zoomToView(e,t),e},hasNextView:function(){return!(!this._viewHistory||this._viewHistoryPointer===this._viewHistory.length-1)},_zoomToView:function(t,e){var n=this,i=this.getView();e.animation?this._animateTo(t,{duration:e.duration},(function(e){"finished"===e.state.playState&&n._fireViewChange(i,t)})):(this.setView(t),this._fireViewChange(i,t))},getViewHistory:function(){return this._viewHistory},_fireViewChange:function(t,e){this._fireEvent("viewchange",{old:t,new:e}),this._insertUICollidesQueue()},_getCurrentView:function(){return this._viewHistory?this._viewHistory[this._viewHistoryPointer]:null}}),H9.mergeOptions({viewHistory:!0,viewHistoryCount:10});var Mtt=new E4;H9.include({getCollisionIndex:function(){return this._collisionIndex||this.createCollisionIndex(),this._collisionIndex||this.createCollisionIndex()},createCollisionIndex:function(){return this.clearCollisionIndex(),this._collisionIndex=new E4,this._collisionIndex},clearCollisionIndex:function(){return this.collisionFrameTime=0,this._collisionIndex&&this._collisionIndex.clear(),this},_insertUICollidesQueue:function(){return this._uiCollidesQueue||(this._uiCollidesQueue=[]),this._uiCollidesQueue.push(1),this},uiCollides:function(){if(!this.uiList||0===this.uiList.length||!this._uiCollidesQueue||0===this._uiCollidesQueue.length)return this;var t=Mtt;t.clear();for(var e=this.uiList,n=0,i=e.length;n<i;n++){var r=e[n],o=r.options,s=o.collisionBufferSize;if(o.collision){var a=r.getDOM();if(r.isVisible()&&a&&a.getBoundingClientRect){r.bbox||(r.bbox=[0,0,0,0]);var h=a.getBoundingClientRect(),l=h.x,u=h.y,c=h.width,A=h.height;if(0===c||0===A){var f=r.getSize();f&&(c=f.width,A=f.height)}var d=l+c+s,p=u-s,g=u+A+s;r.bbox[0]=l-s,r.bbox[1]=p,r.bbox[2]=d,r.bbox[3]=g,t.collides(r.bbox)?r._collidesEffect(!1):(t.insertBox(r.bbox),r._collidesEffect(!0))}}}return this._uiCollidesQueue=[],this},_addUI:function(t){return this.uiList||(this.uiList=[]),this.uiList.indexOf(t)>-1||(this.uiList.push(t),this.uiList=this.uiList.sort((function(t,e){return e.options.collisionWeight-t.options.collisionWeight}))),this},_removeUI:function(t){if(!this.uiList)return-1;var e=this.uiList.indexOf(t);return e<0||this.uiList.splice(e,1),e}});var Ttt=new F4(0,0);H9.include({coordinateToPoint:function(t,e,n){var i=this._getResolution(e);return this.coordinateToPointAtRes(t,i,n)},coordinateToPointAtRes:function(){var t=new F4(0,0);return function(e,n,i){var r=this.getProjection().project(e,t);return this._prjToPointAtRes(r,n,i)}}(),pointToCoordinate:function(){var t=new F4(0,0);return function(e,n,i){var r=this._pointToPrj(e,n,t);return this.getProjection().unproject(r,i)}}(),pointAtResToCoordinate:function(){var t=new F4(0,0);return function(e,n,i){var r=this._pointToPrjAtRes(e,n,t);return this.getProjection().unproject(r,i)}}(),coordinateToViewPoint:function(){var t=new F4(0,0);return function(e,n,i){return this._prjToViewPoint(this.getProjection().project(e,t),n,i)}}(),viewPointToCoordinate:function(){var t=new F4(0,0);return function(e,n){return this.getProjection().unproject(this._viewPointToPrj(e,t),n)}}(),coordinateToContainerPoint:function(t,e,n){var i=this._getResolution(e);return this.coordinateToContainerPointAtRes(t,i,n)},coordinateToContainerPointAtRes:function(){var t=new F4(0,0);return function(e,n,i){var r=this.getProjection().project(e,t);return this._prjToContainerPointAtRes(r,n,i)}}(),coordinatesToContainerPoints:function(t,e){var n=this._getResolution(e);return this.coordinatesToContainerPointsAtRes(t,n)},coordinatesToContainerPointsAtRes:function(t,e){for(var n=[],i=this._spatialReference.getTransformation(),r=e/this._getResolution(),o=this.getProjection(),s=new F4(0,0),a=this.isTransforming(),h=this._prjToPoint(this._getPrjCenter(),void 0,Ttt),l=0,u=t.length;l<u;l++){var c=o.project(t[l],s),A=i.transform(c,e);A=A._multi(r),this._toContainerPoint(A,a,t[l].z,h),n.push(A)}return n},containerPointToCoordinate:function(){var t=new F4(0,0);return function(e,n){var i=this._containerPointToPrj(e,t);return this.getProjection().unproject(i,n)}}(),containerToExtent:function(){var t=new $0(0,0),e=new $0(0,0);return function(n){var i=new Y4(this._containerPointToPoint(n.getMin(t),void 0,t),this._containerPointToPoint(n.getMax(e),void 0,e));return this._pointToExtent(i)}}(),distanceToPixel:function(){var t=new $0(0,0),e=new $0(0,0);return function(n,i,r){var o=this.getProjection();if(!o)return null;var s=this.getScale()/this.getScale(r),a=this.getCenter(),h=o.locate(a,n,i),l=this.coordToContainerPoint(a,void 0,t),u=this.coordToContainerPoint(h,void 0,e);return u._sub(l)._multi(s)._abs(),new z1(u.x,u.y)}}(),distanceToPoint:function(t,e,n,i){var r=this._getResolution(n);return this.distanceToPointAtRes(t,e,r,i)},distanceToPointAtRes:function(){var t=new $0(0,0),e=new F4(0,0);return function(n,i,r,o,s){var a=this.getProjection();if(!a)return null;var h=o||this.getCenter(),l=a.locate(h,n,i,e),u=this.coordToPointAtRes(h,r,t),c=this.coordToPointAtRes(l,r,s);return c._sub(u)._abs(),c}}(),altitudeToPoint:function(){var t=new F4(0,40),e=new $0(0,0);return function(n,i,r){void 0===n&&(n=0),this._altitudeOriginDirty&&(t.x=this._originLng,this._altitudeOriginDirty=!1);var o=this.distanceToPointAtRes(n,n,i,r||t,e);n<0&&o.x>0&&(o.x=-o.x);var s=this.options.heightFactor;return s&&1!==s&&(o.x*=s,o.y*=s),o.x}}(),pointAtResToAltitude:function(){var t=new F4(0,40);return function(e,n,i){return void 0===e&&(e=0),this.pointAtResToDistance(e,0,n,i||t)}}(),pixelToDistance:function(){var t=new F4(0,0),e=new F4(0,0),n=new F4(0,0),i=new F4(0,0);return function(r,o){var s=this.getProjection();if(!s)return null;var a=this.getFullExtent(),h=a.top>a.bottom?-1:1,l=t.set(this.width/2,this.height/2),u=e.set(this.width/2+r,this.height/2+h*o),c=this.containerPointToCoord(l,n),A=this.containerPointToCoord(u,i);return s.measureLength(c,A)}}(),pointToDistance:function(t,e,n){var i=this.getResolution(n);return this.pointAtResToDistance(t,e,i)},pointAtResToDistance:function(){var t=new $0(0,0),e=new F4(0,0),n=new F4(0,0),i=new F4(0,0);return function(r,o,s,a){var h=this.getProjection();if(!h)return null;var l=a?h.project(a,e):this._getPrjCenter(),u=this._prjToPointAtRes(l,s,t);u._add(r,o);var c=this.pointAtResToCoord(u,s,n),A=a||h.unproject(l,i);return h.measureLength(A,c)}}(),locateByPoint:function(){var t=new $0(0,0);return function(e,n,i){var r=this.coordToContainerPoint(e,void 0,t);return this.containerPointToCoord(r._add(n,i))}}(),_get2DExtent:function(t,e){var n;if(void 0!==t&&t!==this._zoomLevel||!this._mapExtent2D||(n=this._mapExtent2D),n)return e?(e.set(n.xmin,n.ymin,n.xmax,n.ymax),e):n.copy();var i=this._getResolution(t);return this._get2DExtentAtRes(i,e)},get2DExtent:function(t,e){return this._get2DExtent(t,e)},_get2DExtentAtRes:function(){var t=new $0(0,0);return function(e,n){var i=this;return e===this._mapGlRes&&this._mapGlExtent2D?this._mapGlExtent2D:this.getContainerExtent().convertTo((function(n){return i._containerPointToPointAtRes(n,e,t)}),n)}}(),get2DExtentAtRes:function(t,e){return this._get2DExtentAtRes(t,e)},pointToExtent:function(t){return this._pointToExtent(t)},_pointToExtent:function(){var t=new F4(0,0),e=new F4(0,0);return function(n){var i=n.getMin(),r=n.getMax(),o=this.getFullExtent(),s=Q0(!o||o.left<=o.right?[i.x,r.x]:[r.x,i.x],2),a=s[0],h=s[1],l=Q0(!o||o.top>o.bottom?[r.y,i.y]:[i.y,r.y],2),u=l[0],c=i.set(a,l[1]),A=r.set(h,u);return new X4(this.pointToCoord(c,void 0,t),this.pointToCoord(A,void 0,e),this.getProjection())}}(),getViewPointFrameOffset:function(){var t=new $0(0,0);return function(){if(this.isZooming())return null;var e=this._getPrjCenter();return this._mapViewCoord&&!this._mapViewCoord.equals(e)?this._prjToContainerPoint(this._mapViewCoord)._sub(this._prjToContainerPoint(e,void 0,t)):null}}(),_viewPointToPrj:function(){var t=new $0(0,0);return function(e,n){return this._containerPointToPrj(this.viewPointToContainerPoint(e,t),n)}}(),viewPointToPrj:function(t,e){return this._viewPointToPrj(t,e)},_prjToContainerPoint:function(t,e,n,i){var r=this._getResolution(e);return this._prjToContainerPointAtRes(t,r,n,i)},prjToContainerPoint:function(t,e,n,i){return this._prjToContainerPoint(t,e,n,i)},_prjToContainerPointAtRes:function(){var t=new $0(0,0);return function(e,n,i,r){return this._pointAtResToContainerPoint(this._prjToPointAtRes(e,n,t),n,r||0,i)}}(),prjToContainerPointAtRes:function(t,e,n,i){return this.prjToContainerPointAtRes(t,e,n,i)},_prjToViewPoint:function(){var t=new $0(0,0);return function(e,n,i){var r=this._prjToContainerPoint(e,void 0,t,i);return this.containerPointToViewPoint(r,n)}}(),prjToViewPoint:function(t,e,n){return this._prjToViewPoint(t,e,n)},_viewPointToPoint:function(){var t=new $0(0,0);return function(e,n,i){return this._containerPointToPoint(this.viewPointToContainerPoint(e,t),n,i)}}(),viewPointToPoint:function(t,e,n){return this._viewPointToPoint(t,e,n)},_pointToViewPoint:function(){var t=new F4(0,0);return function(e,n,i){return this._prjToViewPoint(this._pointToPrj(e,n,t),i)}}(),pointToViewPoint:function(t,e,n){return this._pointToViewPoint(t,e,n)}});var Stt={distancetool:{start:"起点",units:{mile:" 英里",feet:" 英尺",kilometer:" 公里",meter:" 米"}},areatool:{units:{mile:" 平方英里",feet:" 平方英尺",kilometer:" 平方公里",meter:" 平方米"}}},Itt={distancetool:{start:"Inicio",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},areatool:{units:{mile:" mi²",feet:" ft²",kilometer:" km²",meter:" m²"}}},Ett={distancetool:{start:"Start",units:{mile:" mi",feet:" ft",kilometer:" km",meter:" m"}},areatool:{units:{mile:" mi²",feet:" ft²",kilometer:" km²",meter:" m²"}}},Ott=function(t){function e(e){var n=t.call(this,"Translator: "+e)||this;return n.name="TranslatorError",n}return W0(e,t),e}(Error),Rtt=function(t){function e(e){var n=t.call(this)||this;return n.languages={"zh-CN":Stt,"es-MX":Itt,"en-US":Ett},n.setLang(e||"zh-CN"),n}return W0(e,t),e.prototype.setLang=function(t){var e=this.languages[t];if(!e)throw new Ott("Setted Lang does not exist");this.nodes=e},e.prototype._validateNestedProps=function(t){t.forEach((function(t){if(""===t)throw new Ott('Any of sides of a dot "." cannot be empty')}))},e.prototype.translate=function(t){if(void 0===t&&(t=null),null==t)throw new Ott("Missing parameter textNode");if("string"!=typeof t)throw new Ott("Param passed has to be a String");if(!t.includes("."))return this.nodes[t];var e=t.split(".");if(e.length>3)throw new Ott("Translate function can only access through 3 nested properties, trying to access -> ".concat(e.length));this._validateNestedProps(e);try{var n=null;switch(e.length){case 2:n=this.nodes[e[0]][e[1]];break;case 3:n=this.nodes[e[0]][e[1]][e[2]]}return n}catch(i){throw new Ott("Unable to find the text translated in lang json"+i.message)}},e}(Y3),Dtt=function(t){function e(e){var n=t.call(this,e)||this;return n.on("enable",n._afterEnable,n).on("disable",n._afterDisable,n),n._measureLayers=[],n.translator=new Rtt(n.options.language),n}return W0(e,t),e.prototype.clear=function(){if(d1(this._measureLayers))for(var t=0;t<this._measureLayers.length;t++)this._measureLayers[t].remove();return delete this._lastMeasure,delete this._lastVertex,this._outLayers(this._measureLayers),this._measureLayers=[],this},e.prototype.getMeasureLayers=function(){return this._measureLayers},e.prototype.getLastMeasure=function(){return this._lastMeasure?this._lastMeasure:0},e.prototype.undo=function(){t.prototype.undo.call(this);var e=this._historyPointer;if(e!==this._vertexes.length)for(var n=e;n<this._vertexes.length;n++)this._vertexes[n].label&&this._vertexes[n].label.remove(),this._vertexes[n].marker.remove();return this},e.prototype.redo=function(){t.prototype.redo.call(this);var e=this._historyPointer-1;return this._vertexes[e]&&(this._vertexes[e].marker.getLayer()||(this._vertexes[e].label&&this._vertexes[e].label.addTo(this._measureMarkerLayer),this._vertexes[e].marker.addTo(this._measureMarkerLayer))),this},e.prototype._formatLabelContent=function(t){var e=this.options.formatLabelContent;return e&&a0(e)?e.call(this,t)+"":null},e.prototype._measure=function(t){var e,n=this.getMap();t instanceof M9?e=n.computeGeometryLength(t):Array.isArray(t)&&(e=n.getProjection().measureLength(t)),this._lastMeasure=e;var i=this._formatLabelContent(e);if(i)return i;var r=[this.translator.translate("distancetool.units.meter"),this.translator.translate("distancetool.units.kilometer"),this.translator.translate("distancetool.units.feet"),this.translator.translate("distancetool.units.mile")],o="",s=this.options.decimalPlaces;return this.options.metric&&(o+=e<1e3?e.toFixed(s)+r[0]:(e/1e3).toFixed(s)+r[1]),this.options.imperial&&(o.length>0&&(o+="\n"),o+=(e*=3.2808399)<5280?e.toFixed(s)+r[2]:(e/5280).toFixed(s)+r[3]),o},e.prototype._registerMeasureEvents=function(){this.on("drawstart",this._msOnDrawStart,this).on("drawvertex",this._msOnDrawVertex,this).on("mousemove",this._msOnMouseMove,this).on("drawend",this._msOnDrawEnd,this)},e.prototype._afterEnable=function(){this._registerMeasureEvents()},e.prototype._afterDisable=function(){this.off("drawstart",this._msOnDrawStart,this).off("drawvertex",this._msOnDrawVertex,this).off("mousemove",this._msOnMouseMove,this).off("drawend",this._msOnDrawEnd,this)},e.prototype._msOnDrawStart=function(t){var e=this.getMap(),n=i1(),i="distancetool_"+n,r="distancetool_markers_"+n,o=this.options.zIndex,s=this.options.enableAltitude;e.getLayer(i)?(this._measureLineLayer=e.getLayer(i),this._measureMarkerLayer=e.getLayer(r)):(this._measureLineLayer=new K7(i,{zIndex:o,enableAltitude:s}).addTo(e),this._measureMarkerLayer=new K7(r,{zIndex:o,enableAltitude:s}).addTo(e)),this._measureLayers.push(this._measureLineLayer),this._measureLayers.push(this._measureMarkerLayer),this._pushLayers([this._measureLineLayer,this._measureMarkerLayer]);var a=this._getFirstCoordinate()||t.coordinate,h=new A7(a.copy(),{symbol:this.options.vertexSymbol}),l=this.translator.translate("distancetool.start"),u=new U7(l,a.copy(),this.options.labelOptions);this._lastVertex=u,this._addVertexMarker(h,u)},e.prototype._msOnMouseMove=function(t){var e=this._measure(this._msGetCoordsToMeasure(t));if(!this._tailMarker){var n=S5(this.options.vertexSymbol);n.markerWidth/=2,n.markerHeight/=2,this._tailMarker=new A7(t.coordinate,{symbol:n}).addTo(this._measureMarkerLayer),this._tailLabel=new U7(e,t.coordinate,this.options.labelOptions).addTo(this._measureMarkerLayer)}var i=this._getLasttCoordinate()||t.coordinate;this._tailMarker.setCoordinates(i.copy()),this._tailLabel.setContent(e),this._tailLabel.setCoordinates(i.copy())},e.prototype._msGetCoordsToMeasure=function(t){return t.geometry.getCoordinates().concat([t.coordinate])},e.prototype._msOnDrawVertex=function(t){var e=this._getLasttCoordinate()||t.coordinate,n=t.geometry,i=new A7(e.copy(),{symbol:this.options.vertexSymbol}),r=this._measure(n),o=new U7(r,e.copy(),this.options.labelOptions);this._addVertexMarker(i,o),this._lastVertex=o},e.prototype._addVertexMarker=function(t,e){this._vertexes||(this._vertexes=[]),void 0!==this._historyPointer&&this._vertexes.length>this._historyPointer-1&&(this._vertexes.length=this._historyPointer-1),this._vertexes.push({label:e,marker:t}),this._measureMarkerLayer.addGeometry(t),e&&this._measureMarkerLayer.addGeometry(e)},e.prototype._msOnDrawEnd=function(t){if(this._clearTailMarker(),t.geometry.getCoordinates().length<2)return this._lastMeasure=0,void this._clearMeasureLayers();var e=this._lastVertex.getSize();e||(e=new z1(10,10)),this._addClearMarker(this._lastVertex.getCoordinates(),this._lastVertex._getPrjCoordinates(),e.width);var n=t.geometry.copy();n.setCoordinates(t.geometry.getCoordinates()),n.addTo(this._measureLineLayer),this._lastMeasure=n.getLength()},e.prototype._addClearMarker=function(t,e,n){var i=this.options.clearButtonSymbol,r={markerDx:(i.markerDx||0)+n,textDx:(i.textDx||0)+n};Array.isArray(i)&&(r=i.map((function(t){return t?{markerDx:(t.markerDx||0)+n,textDx:(t.textDx||0)+n}:null}))),i=S5(i,r);var o=new A7(t,{symbol:i}),s=this._measureLineLayer,a=this._measureMarkerLayer;o.on("click",(function(){return s.remove(),a.remove(),!1}),this),o.addTo(this._measureMarkerLayer)},e.prototype._clearTailMarker=function(){this._tailMarker&&(this._tailMarker.remove(),delete this._tailMarker),this._tailLabel&&(this._tailLabel.remove(),delete this._tailLabel)},e.prototype._clearMeasureLayers=function(){this._measureLineLayer.remove(),this._measureMarkerLayer.remove()},e.prototype._getFirstCoordinate=function(){return this._geometry?(this._geometry.getCoordinates()||[])[0]:null},e.prototype._getLasttCoordinate=function(){if(!this._geometry)return null;var t=this._geometry.getCoordinates()||[];return t[t.length-1]},e}(itt);function ktt(t,e,n){var i,r,o=Array.isArray(e);if(o||(e=[e]),n&&n.drawTool&&n.drawTool.options&&(r=n.drawTool.options.transformCoordinate),r&&a0(r))i=(i=e.map((function(e){return t.unproject(e)}))).map((function(t){return r(t,n)||t}));else{if(!n||!n.target||!n.target._queryTerrainInfo)return i=e.map((function(e){return t.unproject(e)})),o?i:i[0];var s=n.target,a=n.enableAltitude;i=e.map((function(e){if(a){var n=s.prjToContainerPoint(e),i=s._queryTerrainInfo(n);if(i&&i.coordinate)return i.coordinate}return t.unproject(e)}))}return o?i:i[0]}Dtt.mergeOptions({formatLabelContent:null,decimalPlaces:2,mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,symbol:{lineColor:"#000",lineWidth:3,lineOpacity:1},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#000",markerLineWidth:3,markerWidth:11,markerHeight:11},labelOptions:{textSymbol:{textFaceName:"monospace",textLineSpacing:1,textHorizontalAlignment:"right",textDx:15},boxStyle:{padding:[6,2],symbol:{markerType:"square",markerFill:"#fff",markerFillOpacity:.9,markerLineColor:"#b4b3b3"}}},clearButtonSymbol:[{markerType:"square",markerFill:"#fff",markerLineColor:"#b4b3b3",markerLineWidth:2,markerWidth:15,markerHeight:15,markerDx:20},{markerType:"x",markerWidth:10,markerHeight:10,markerDx:20}]}),function(t){function e(e){var n=t.call(this,e)||this;return n.translator=new Rtt(n.options.language),n._measureLayers=[],n}return W0(e,t),e.prototype._measure=function(t){var e,n=this.getMap();t instanceof M9?e=n.computeGeometryArea(t):Array.isArray(t)&&(e=n.getProjection().measureArea(t)),this._lastMeasure=e;var i=this._formatLabelContent(e);if(i)return i;var r=[this.translator.translate("areatool.units.meter"),this.translator.translate("areatool.units.kilometer"),this.translator.translate("areatool.units.feet"),this.translator.translate("areatool.units.mile")],o="",s=this.options.decimalPlaces;if(this.options.metric&&(o+=e<1e6?e.toFixed(s)+r[0]:(e/1e6).toFixed(s)+r[1]),this.options.imperial){e*=Math.pow(3.2808399,2),o.length>0&&(o+="\n");var a=27878400;o+=e<a?e.toFixed(s)+r[2]:(e/a).toFixed(s)+r[3]}return o},e.prototype._msGetCoordsToMeasure=function(t){return t.geometry.getShell().concat([t.coordinate])},e.prototype._msOnDrawVertex=function(t){var e=this._getLasttCoordinate()||t.coordinate,n=new A7(e.copy(),{symbol:this.options.vertexSymbol});this._measure(t.geometry),this._lastVertex=n,this._addVertexMarker(n)},e.prototype._msOnDrawEnd=function(t){var e;this._clearTailMarker();var n=this.getMap();if(t.point2d)e=n._pointToPrj(t.point2d);else{var i=t.geometry._getPrjCoordinates()||[];e=(i=i.slice(0,i.length-1))[i.length-1]}if(t.geometry.getShell().length<3)return this._lastMeasure=0,void this._clearMeasureLayers();var r=this._measure(t.geometry),o=this._getLasttCoordinate(),s=new U7(r,o.copy(),this.options.labelOptions).addTo(this._measureMarkerLayer).getSize();s||(s=new z1(10,10)),this._addClearMarker(o.copy(),e,s.width);var a=t.geometry.copy();a.setCoordinates(t.geometry.getCoordinates()),a.addTo(this._measureLineLayer),this._lastMeasure=a.getArea()},e}(Dtt).mergeOptions({mode:"Polygon",symbol:{lineColor:"#000000",lineWidth:2,lineOpacity:1,lineDasharray:"",polygonFill:"#ffffff",polygonOpacity:.5},language:"zh-CN"});var Ltt={create:function(t,e,n){var i=ktt(t,e[0],n);return new I7(i,0)},update:function(t,e,n,i){var r=n.getMap(),o=ktt(t,Array.isArray(e)?e[e.length-1]:e,i),s=r.computeLength(n.getCenter(),o);n.setRadius(s)},generate:function(t){return t}};itt.registerMode("circle",e0({clickLimit:2,action:["click","mousemove","click"]},Ltt)),itt.registerMode("freeHandCircle",e0({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Ltt));var Ftt={create:function(t,e,n){var i=ktt(t,e[0],n);return new O7(i,0,0)},update:function(t,e,n,i){var r=n.getMap(),o=n.getCenter(),s=ktt(t,Array.isArray(e)?e[e.length-1]:e,i),a=r.computeLength(o,new F4({x:s.x,y:o.y})),h=r.computeLength(o,new F4({x:o.x,y:s.y}));n.setWidth(2*a),n.setHeight(2*h)},generate:function(t){return t}};itt.registerMode("ellipse",e0({clickLimit:2,action:["click","mousemove","click"]},Ftt)),itt.registerMode("freeHandEllipse",e0({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Ftt));var Ntt={create:function(t,e){var n=new l7([]);return n._firstClick=e[0],n},update:function(t,e,n,i){var r=n.getMap(),o=i.containerPoint,s=r.prjToContainerPoint(n._firstClick),a=ktt(t,[[s.x,s.y],[o.x,s.y],[o.x,o.y],[s.x,o.y]].map((function(t){return r._containerPointToPrj(new $0(t))})),i);n.setCoordinates(a)},generate:function(t){return t}};itt.registerMode("rectangle",e0({clickLimit:2,action:["click","mousemove","click"]},Ntt)),itt.registerMode("freeHandRectangle",e0({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Ntt)),itt.registerMode("point",{clickLimit:1,action:["click","mousemove"],create:function(t,e,n){var i=ktt(t,e[0],n);return new A7(i)},generate:function(t){return t},update:function(t,e,n,i){if(Array.isArray(e)&&(e=e[e.length-1]),!e)return n;var r=ktt(t,e,i);return n.setCoordinates(r),n}});var ztt={create:function(t,e,n){var i=ktt(t,e,n),r=new d7(i);return r.setCoordinates(i),r},update:function(t,e,n,i){var r,o=n.getSymbol();Array.isArray(e)?r=e:(r=n._drawPrjs||[]).push(e),n._drawPrjs=r;var s=ktt(t,r,i);n.setCoordinates(s);var a=n.getLayer();if(a){var h=a.getGeometryById("polygon");if(!h&&r.length>=3){if(h=new l7([s],{id:"polygon",zIndex:-1}),o){var l=S5(o,{lineOpacity:0});h.setSymbol(l)}h.addTo(a)}h&&h.setCoordinates([s])}},generate:function(t){var e=new l7(t.getCoordinates(),{symbol:t.getSymbol(),properties:t.getProperties()});return e._projCode=t._projCode,e}};itt.registerMode("polygon",e0({action:["click","mousemove","dblclick"]},ztt)),itt.registerMode("freeHandPolygon",e0({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},ztt));var Btt={create:function(t,e,n){var i=ktt(t,e,n),r=new d7(i);return r.setCoordinates(i),r},update:function(t,e,n,i){var r;Array.isArray(e)?r=e:(r=n._drawPrjs||[]).push(e),n._drawPrjs=r;var o=ktt(t,r,i);n.setCoordinates(o)},generate:function(t){return t}};itt.registerMode("linestring",e0({action:["click","mousemove","dblclick"]},Btt)),itt.registerMode("freeHandLinestring",e0({action:["mousedown touchstart","mousemove touchmove","mouseup touchend"]},Btt)),itt.registerMode("arccurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new L7(n);return i._setPrjCoordinates(e),i},update:Btt.update,generate:function(t){return t}}),itt.registerMode("quadbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new N7(n);return i._setPrjCoordinates(e),i},update:Btt.update,generate:function(t){return t}}),itt.registerMode("cubicbeziercurve",{action:["click","mousemove","dblclick"],create:function(t,e){var n=e.map((function(e){return t.unproject(e)})),i=new F7(n);return i._setPrjCoordinates(e),i},update:Btt.update,generate:function(t){return t}}),itt.registerMode("boxZoom",{action:["mousedown","mousemove","mouseup"],create:function(t,e){var n=t.unproject(e=e[0]),i=new A7(n);return i._firstClick=e,i},update:function(t,e,n,i){var r=n.getMap(),o=r.prjToContainerPoint(n._firstClick),s=i.containerPoint;e=r._containerPointToPrj(new F4(Math.min(o.x,s.x),Math.min(o.y,s.y)));var a=t.unproject(e);n.setCoordinates(a)._setPrjCoordinates(e),n.updateSymbol({markerWidth:Math.abs(o.x-s.x),markerHeight:Math.abs(o.y-s.y)})},generate:function(t){return t}});var Htt=function(t){function e(e){var n=t.call(this,e)||this;return n.proxyOptions(),n}return W0(e,t),e.prototype._appendCustomClass=function(t){if(!t)return console.warn("dom is null:",t),this;if(this.options.cssName){var e=this.options.cssName;Array.isArray(e)||(e=[e]),e.forEach((function(e){t.classList.add(e)}))}return this},e.prototype.onAdd=function(){},e.prototype.onRemove=function(){},e.prototype.onDomRemove=function(){},e.prototype.getEvents=function(){return{}},e.prototype.getOwnerEvents=function(){return{}},e.prototype.buildOn=function(){return null},e.prototype.addTo=function(t){return this._owner=t,this._switchEvents("on"),this.onAdd&&this.onAdd(),this.fire("add"),this},e.prototype.getMap=function(){return this._owner?this._owner.getBaseLayer?this._owner:this._owner.getMap():null},e.prototype._collides=function(){var t=this.getMap();return t?(t._addUI(this),t._insertUICollidesQueue(),this):this},e.prototype._collidesEffect=function(t){var e=this.getDOM();if(!e)return this;if(e.style.visibility=t?"visible":"hidden",!e.classList||!e.classList.add)return this;if(!this.options.collisionFadeIn)return this;var n="mtk-ui-fadein",i=e.classList.contains(n);return t&&!i?e.classList.add(n):!t&&i&&e.classList.remove(n),this},e.prototype.show=function(t){var e=this,n=this.getMap();if(!n)return this;this.options.visible=!0,(t=t||this._coordinate||this._owner.getCenter())instanceof F4||(t=new F4(t));var i=this.isVisible();this._showBySymbolChange||this.fire("showstart");var r=this._getUIContainer();this._coordinate=t,this._removePrevDOM(),this._mapEventsOn||this._switchMapEvents("on");var o=this.__uiDOM=this.buildOn();o.eventsPropagation=this.options.eventsPropagation,this._observerDomSize(o);var s=this.options.zIndex;if(!o)return this._showBySymbolChange||this.fire("showend"),this._collides(),this.setZIndex(s),this;this._measureSize(o),this._singleton()&&(o._uiComponent=this,n[this._uiDomKey()]=o),this._setPosition(),o.style[s2]=null,r.appendChild(o);var a=this._getAnimation();if(i&&(a.ok=!1),a.ok&&(a.fade&&(o.style.opacity="0"),a.scale)){if(this.getTransformOrigin){var h=this.getTransformOrigin();o.style[o2]=h}o.style[r2]=this._toCSSTranslate(this._pos)+" scale(0)"}this.isSupportZoomFilter()||(o.style.display=""),this.options.eventsToStop&&P2(o,this.options.eventsToStop,d2);var l=a.transition;return a.ok&&l&&(l&&(o.style[s2]=l),a.fade&&(o.style.opacity="1"),a.scale&&(o.style[r2]=this._toCSSTranslate(this._pos)+" scale(1)")),this._showBySymbolChange||this.fire("showend"),this._collides(),clearTimeout(this._autoPanId),this.options.autoPan&&(this._autoPanId=setTimeout((function(){e._autoPan()}),32)),this.setZIndex(s),this},e.prototype.hide=function(){var t=this;if(!this.getDOM())return this;this._onDomMouseout&&this._onDomMouseout(),this.options.visible=!1;var e=this._getAnimation(),n=this.getDOM();return this.options.animationOnHide||(e.ok=!1),e.ok?(n.style[s2]=e.transition,setTimeout((function(){n.style.display="none",t.fire("hide")}),this.options.animationDuration)):(n.style.display="none",this.fire("hide")),e.fade&&(n.style.opacity="0"),e.scale&&(n.style[r2]=this._toCSSTranslate(this._pos)+" scale(0)"),this._switchMapEvents("off"),this._collides(),this},e.prototype.isVisible=function(){if(!this.options.visible)return!1;var t=this.getDOM();return this.getMap()&&t&&t.parentNode&&"none"!==t.style.display},e.prototype.remove=function(){if(delete this._mapEventsOn,!this._owner)return this;var t=this.getMap();return t&&t._removeUI(this),this.hide(),this._switchEvents("off"),this.onRemove&&this.onRemove(),!this._singleton()&&this.__uiDOM&&this._removePrevDOM(),delete this._owner,this.fire("remove"),this._collides(),this},e.prototype.getSize=function(){return this._domContentRect&&this._size&&(this._size.width=this._domContentRect.width,this._size.height=this._domContentRect.height),this._size?this._size.copy():null},e.prototype.getOwner=function(){return this._owner},e.prototype.getDOM=function(){return this.__uiDOM},e.prototype.setZIndex=function(t){if(!i0(t))return this;var e=this.getDOM();return e?(e.style.zIndex=t+"",t!==this.options.zIndex&&(this.options.zIndex=t),this):this},e.prototype._roundPoint=function(t){return this.options.roundPoint&&(t=t._round()),t},e.prototype.getPosition=function(){if(!this.getMap())return null;var t=this._roundPoint(this._getViewPoint());if(this.getOffset){var e=this._roundPoint(this.getOffset());e&&t._add(e)}return t},e.prototype._getAnimation=function(){for(var t={fade:!1,scale:!1,ok:!1,transition:""},e=this.options.animation?this.options.animation.split(","):[],n=0;n<e.length;n++){var i=H1(e[n]);"fade"===i?t.fade=!0:"scale"===i&&(t.scale=!0)}var r=null;return t.fade&&(r="opacity "+this.options.animationDuration+"ms"),t.scale&&(r=r?r+",":"",r+=r2+" "+this.options.animationDuration+"ms"),t.transition=r,t.ok=null!==r,t},e.prototype._getViewPoint=function(){var t=0,e=this._coordinate||{};if(i0(e.z)?t=e.z:this._owner&&this._owner.getAltitude&&(i0(t=this._owner.getAltitude()||0)||(t=0)),this._owner.getLayer){var n=this._owner.getLayer();n&&n.isVectorLayer&&(i0(t=this._owner._getAltitude()||0)||(t=0))}var i=this._meterToPoint(this._coordinate,t);return this.getMap().coordToViewPoint(this._coordinate,void 0,i)._add(this.options.dx,this.options.dy)},e.prototype._meterToPoint=function(t,e){return e},e.prototype._autoPan=function(){var t=this.getMap(),e=this.getDOM();if(e&&t&&!t.isMoving()){var n=this._getViewPoint()._round(),i=t.width,r=t.height,o=t.getContainer();if(e&&o&&e.getBoundingClientRect){var s=o.getBoundingClientRect(),a=s.left,h=s.top,l=50,u=e.getBoundingClientRect(),c=0,A=0,f=u.left,d=u.right,p=u.top,g=u.bottom;if(f-=a,d-=a,p-=h,g-=h,u.width>0&&u.height>0)return f<l&&(c=l-f),0===c&&d+l>i&&(c=-(d+l-i)),p<l&&(A=l-p),0===A&&g+l>r&&(A=-(g+l-r)),void((0!==c||0!==A)&&(t.getPitch()>40&&0!==A&&this._coordinate?t.animateTo({center:this._coordinate},{duration:t.options.panAnimationDuration}):t.panBy([Math.ceil(c),Math.ceil(A)])))}var m=t.viewPointToContainerPoint(n),y=this.getOffset(),v=m.add(y),_=t.viewPointToPrj(n),x=parseInt(e.clientWidth+""),b=parseInt(e.clientHeight+""),w=0,C=0;if(v.x<0?w=50-v.x:v.x+x>i&&(w=-(v.x+x-i)-50),v.y-b<0?C=Math.abs(v.y-b)+50:v.y+b>r&&(C=r-(v.y+b)-50),x>=i&&(w=i/2-m.x),0!==C||0!==w){var P=m.add(w,C),M=t._containerPointToPoint(P)._sub(t._prjToPoint(t._getPrjCenter())),T=t._pointToPrj(t._prjToPoint(_).sub(M));t._panAnimation(T)}}},e.prototype._measureSize=function(t){var e=this._getUIContainer();t.style.position="absolute";var n=t.style.bottom?"bottom":"top";if(t.style.display="",e.appendChild(t),t.getBoundingClientRect){var i=t.getBoundingClientRect();this._size=new z1(i.width,i.height)}else this._size=new z1(t.clientWidth,t.clientHeight);return t.style.display="none",t.style.left="0px",t.style[n]="0px",this._size},e.prototype._removePrevDOM=function(){this.onDomRemove&&this.onDomRemove();var t=this.options.eventsToStop;if(this._singleton()){var e=this.getMap(),n=this._uiDomKey();if(e[n]){t&&M2(e[n],t,d2);var i=e[n]._uiComponent;i&&i!==this&&i.isVisible()&&i.fire("hide"),l2(e[n]),i&&!this.hideDom&&i._switchMapEvents("off"),delete e[n]}delete this.__uiDOM}else this.__uiDOM&&(t&&M2(this.__uiDOM,t,d2),l2(this.__uiDOM),delete this.__uiDOM);this._resizeObserver&&(this._resizeObserver.disconnect(),delete this._resizeObserver,delete this._domContentRect)},e.prototype._uiDomKey=function(){return"__ui_"+this._getClassName()},e.prototype._singleton=function(){return this.options.single},e.prototype._getUIContainer=function(){return this.getMap().getPanels().ui},e.prototype._getClassName=function(){return"UIComponent"},e.prototype._switchMapEvents=function(t){var e=this.getMap();if(e){this._mapEventsOn="on"===t;var n=this._getDefaultEvents();if(this.getEvents&&e0(n,this.getEvents()),n)for(var i in n)n.hasOwnProperty(i)&&e[t](i,n[i],this)}},e.prototype._switchEvents=function(t){var e=this._getOwnerEvents();if(this._owner)for(var n in e)e.hasOwnProperty(n)&&this._owner[t](n,e[n],this)},e.prototype._getDefaultEvents=function(){return{"zooming rotate pitch":this.onEvent,zoomend:this.onZoomEnd,moving:this.onMoving,moveend:this.onMoving,resize:this.onResize}},e.prototype._getOwnerEvents=function(){var t={};return this._owner&&this._owner instanceof M9&&(t.positionchange=this.onGeometryPositionChange,t.symbolchange=this._updatePosition),this.getOwnerEvents&&e0(t,this.getOwnerEvents()),t},e.prototype.onGeometryPositionChange=function(t){if(this._owner&&this.isVisible()){this._showBySymbolChange=!0;var e=t.target,n=e.getCenter();if(e._getAltitude){var i=e._getAltitude();i0(i)&&(n.z=i)}this.show(n),delete this._showBySymbolChange}},e.prototype.onMoving=function(){this.isVisible()&&this.getMap().isTransforming()&&this._updatePosition()},e.prototype.onEvent=function(){this.isVisible()&&this._updatePosition()},e.prototype.onZoomEnd=function(){this.isVisible()&&this._setPosition()},e.prototype.onResize=function(){this.isVisible()&&this._setPosition()},e.prototype.onDomSizeChange=function(){this.isVisible()&&(this._setPosition(),this._collides())},e.prototype._updatePosition=function(){return this.getMap()?(this.getMap()._getRenderer().callInNextFrame(this._setPosition.bind(this)),this):this},e.prototype._setPosition=function(){var t=this.getDOM();if(t){t.style[s2]=null;var e=this.getPosition();this._pos=e,t.style[r2]=this._toCSSTranslate(e)+" scale(1)"}},e.prototype._toCSSTranslate=function(t){if(!t)return"";if(G0.any3d){var e=this.getMap(),n=e?e.getBearing():0,i=e?e.getPitch():0,r="";return this.options.pitchWithMap&&i&&(r+=" rotateX(".concat(Math.round(i),"deg)")),this.options.rotateWithMap&&n&&(r+=" rotateZ(".concat(Math.round(-n),"deg)")),"translate3d("+Math.fround(t.x)+"px,"+Math.fround(t.y)+"px, 0px)"+r}return"translate("+Math.fround(t.x)+"px,"+Math.fround(t.y)+"px)"},e.prototype._observerDomSize=function(t){var e=this;return t&&G0.resizeObserver&&!this._resizeObserver?(this._resizeObserver=new ResizeObserver((function(t){if(t.length){var n=t[0].borderBoxSize;e._domContentRect=n&&n.length?{width:n[0].inlineSize,height:n[0].blockSize}:t[0].contentRect}else delete e._domContentRect;e.onDomSizeChange&&e.onDomSizeChange()})),this._resizeObserver.observe(t),this):this},e.prototype.isSupportZoomFilter=function(){return!1},e.prototype.onConfig=function(){return this._updatePosition(),this},e.isSupport=function(t){return!!(t&&a0(t.on)&&a0(t.off)&&a0(t.getCenter))},e.prototype._bindDomEvents=function(t,e){if(t){var n=this._getDomEvents()||{},i="on"===e?P2:M2;for(var r in n)"on"===e&&M2(t,r,n[r]),i(t,r,n[r],this)}},e.prototype._getDomEvents=function(){return{mouseover:this._onDomMouseover,mouseout:this._onDomMouseout}},e.prototype._configMapPreventWheelScroll=function(t){var e=this.getMap();e&&(this.options.eventsPropagation||(e.options.preventWheelScroll=t))},e.prototype._onDomMouseover=function(){this._configMapPreventWheelScroll(!1)},e.prototype._onDomMouseout=function(){this._configMapPreventWheelScroll(!0)},e}(Q3(Y3));Htt.mergeOptions({eventsPropagation:!1,eventsToStop:null,dx:0,dy:0,autoPan:!1,autoPanDuration:600,single:!0,animation:"scale",animationOnHide:!1,animationDuration:500,pitchWithMap:!1,rotateWithMap:!1,visible:!0,roundPoint:!1,collision:!1,collisionBufferSize:2,collisionWeight:0,collisionFadeIn:!1,zIndex:0});var jtt="mousedown mouseup mouseenter mouseover mouseout mousemove click dblclick contextmenu keypress touchstart touchmove touchend",Utt=function(t){function e(e,n){var i=t.call(this,n)||this;return i._markerCoord=new F4(e),i}return W0(e,t),e.prototype._getClassName=function(){return"UIMarker"},e.prototype.setCoordinates=function(t){return this._markerCoord=t,this.fire("positionchange"),this.isVisible()&&(this._coordinate=this._markerCoord,this._setPosition(),this._collides()),this},e.prototype.getCoordinates=function(){return this._markerCoord},e.prototype.getCenter=function(){return this.getCoordinates()},e.prototype.getAltitude=function(){var t=this.getCoordinates()||{};return i0(t.z)?t.z:this.options.altitude||0},e.prototype.setAltitude=function(t){return i0(t)&&this._markerCoord&&(this._markerCoord.z=t,this._updatePosition&&(this._updatePosition(),this._collides())),this},e.prototype.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(),this},e.prototype.getContent=function(){return this.options.content},e.prototype.onAdd=function(){if(this._owner&&!this._owner.isMap){var t=this._owner;throw new Error("UIMarker Can only be added to the map, but owner is:"+t.getJSONType&&t.getJSONType())}return this.show(),this},e.prototype.show=function(){return t.prototype.show.call(this,this._markerCoord)},e.prototype.flash=function(t,e,n,i){return C1.call(this,t,e,n,i)},e.prototype.buildOn=function(){var t,e=this.getDOM();this._bindDomEvents(e,"off");var n=this.options.content,i=s0(n);return i||a0(n)?(t=a2("div"),i?t.innerHTML=this.options.content:n.bind(this)(t)):t=this.options.content,this.options.containerClass&&(t.className=this.options.containerClass),this._registerDOMEvents(t),this._bindDomEvents(t,"on"),this._appendCustomClass(t),t},e.prototype.getOffset=function(){var t=this.getSize(),e=-t.width/2,n=-t.height/2,i=this.options,r=i.horizontalAlignment,o=i.verticalAlignment;return"left"===r?e=-t.width:"right"===r&&(e=0),"top"===o?n=-t.height:"bottom"===o&&(n=0),new $0(e,n)},e.prototype.getTransformOrigin=function(){return"center center"},e.prototype.onDomRemove=function(){var t=this.getDOM();this._removeDOMEvents(t)},e.prototype.isDragging=function(){return!!this.draggable&&this.draggable.isDragging()},e.prototype._registerDOMEvents=function(t){P2(t,jtt,this._onDomEvents,this)},e.prototype._onDomEvents=function(t,e){var n=this.getMap()._parseEvent(t,t.type);if("mousedown"===(e=e||t.type)&&(this._mousedownEvent=t),"mouseup"===e&&(this._mouseupEvent=t),("click"!==e||!this._mouseClickPositionIsChange())&&("touchstart"===e&&(this._touchstartTime=t0()),this.fire(e,n),"touchend"===e&&G0.touch)){var i=this.getMap().options.clickTimeThreshold||280;t0()-this._touchstartTime<i&&this._onDomEvents(t,"click")}},e.prototype._removeDOMEvents=function(t){M2(t,jtt,this._onDomEvents)},e.prototype._mouseClickPositionIsChange=function(){var t=this._mousedownEvent||{},e=this._mouseupEvent||{};return t.x!==e.x||t.y!==e.y},e.prototype._getConnectPoints=function(){var t=this.getMap(),e=t.coordToContainerPoint(this.getCoordinates()),n=this.getSize(),i=n.width,r=n.height;return[t.containerPointToCoordinate(e.add(-i/2,0)),t.containerPointToCoordinate(e.add(i/2,0)),t.containerPointToCoordinate(e.add(0,r/2)),t.containerPointToCoordinate(e.add(0,-r/2))]},e.prototype._getViewPoint=function(){var t=0;if(this._owner){var e=this.getAltitude();e>0&&(t=this._meterToPoint(this._coordinate,e))}return this.getMap().coordToViewPoint(this._coordinate,void 0,t)._add(this.options.dx,this.options.dy)},e.prototype._getDefaultEvents=function(){return e0({},t.prototype._getDefaultEvents.call(this),{"zooming zoomend":this.onZoomFilter})},e.prototype._setPosition=function(){this.onZoomFilter(),t.prototype._setPosition.call(this)},e.prototype.onZoomFilter=function(){var t=this.getDOM();t&&(this.isVisible()||"none"===t.style.display?this.isVisible()&&"none"===t.style.display&&(t.style.display=""):t.style.display="none")},e.prototype.isVisible=function(){var t=this.getMap();if(!t)return!1;if(!this.options.visible)return!1;var e=t.getZoom(),n=this.options,i=n.minZoom,r=n.maxZoom;return!(!n0(i)&&e<i||!n0(r)&&e>r)&&this.getDOM()&&!0},e.prototype.isSupportZoomFilter=function(){return!0},e}(O4(Htt));Utt.mergeOptions({containerClass:null,eventsPropagation:!0,draggable:!1,single:!1,content:null,altitude:0,minZoom:0,maxZoom:null,horizontalAlignment:"middle",verticalAlignment:"middle"});var Gtt=G0.touch?"touchstart mousedown":"mousedown",Vtt=function(t){function e(e){return t.call(this,e)||this}return W0(e,t),e.prototype.addHooks=function(){this.target.on(Gtt,this._startDrag,this)},e.prototype.removeHooks=function(){this.target.off(Gtt,this._startDrag,this)},e.prototype._startDrag=function(t){var e=t.domEvent;e.touches&&e.touches.length>1||2===e.button||this.isDragging()||(this.target.on("click",this._endDrag,this),this._lastCoord=t.coordinate,this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),this.target.fire("dragstart",t))},e.prototype._prepareDragHandler=function(){this._dragHandler=new L4(this.target.getDOM(),{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this._dragHandler.on("mousedown",this._onMouseDown,this),this._dragHandler.on("dragging",this._dragging,this),this._dragHandler.on("mouseup",this._endDrag,this),this._dragHandler.enable()},e.prototype._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},e.prototype._onMouseDown=function(t){d2(t.domEvent)},e.prototype._dragging=function(t){var e=this.target,n=e.getMap()._parseEvent(t.domEvent),i=n.domEvent;if(!(i.touches&&i.touches.length>1))if(this._isDragging){var r=n.coordinate,o=n.containerPoint;this._lastCoord||(this._lastCoord=r),this._lastPoint||(this._lastPoint=o);var s=r.sub(this._lastCoord),a=o.sub(this._lastPoint);this._lastCoord=r,this._lastPoint=o,this.target.setCoordinates(this.target.getCoordinates().add(s)),n.coordOffset=s,n.pointOffset=a,e.fire("dragging",n)}else this._isDragging=!0},e.prototype._endDrag=function(t){var e=this.target,n=e.getMap();if(this._dragHandler&&(e.off("click",this._endDrag,this),this._dragHandler.disable(),delete this._dragHandler),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1,n){var i=n._parseEvent(t.domEvent);e&&e._mouseClickPositionIsChange&&e._mouseClickPositionIsChange()&&e.fire("dragend",i)}},e.prototype.isDragging=function(){return!!this._isDragging},e}(X3);Utt.addInitHook("addHandler","draggable",Vtt);var Wtt=/\{ *([\w_]+) *\}/g,qtt={containerClass:"maptalks-msgBox",autoPan:!0,autoCloseOn:null,autoOpenOn:"click",width:"auto",minHeight:120,custom:!1,title:null,content:null,enableTemplate:!1},Ztt=new z1(0,0),Qtt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype._getClassName=function(){return"InfoWindow"},e.prototype.addTo=function(e){return e instanceof M9&&(e.getInfoWindow()&&e.getInfoWindow()!==this&&e.removeInfoWindow(),e._infoWindow=this),t.prototype.addTo.call(this,e)},e.prototype.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},e.prototype.getContent=function(){return this.options.content},e.prototype.setTitle=function(t){var e=t;return this.options.title=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.show(this._coordinate),this},e.prototype.getTitle=function(){return this.options.title},e.prototype.buildOn=function(){var t=this,e=a0(this.options.content),n=s0(this.options.content);if(this.options.custom){var i=this.getDOM(),r=void 0;if(this._bindDomEvents(i,"off"),n||e){var o=a2("div");n?(o.innerHTML=this.options.content,this._replaceTemplate(o)):this.options.content.bind(this)(o),r=o}else this._replaceTemplate(this.options.content),r=this.options.content;return this._bindDomEvents(r,"on"),this._appendCustomClass(r),r}this._bindDomEvents(this.getDOM(),"off");var s=a2("div");this.options.containerClass&&(s.className=this.options.containerClass);var a=this._getWindowWidth();s.style.width=i0(a)?a+"px":"auto",s.style.bottom="0px";var h='<em class="maptalks-ico"></em>';this.options.title&&(h+="<h2>"+this.options.title+"</h2>"),s.innerHTML=h+='<a href="javascript:void(0);" class="maptalks-close">×</a><div class="maptalks-msgContent"></div>',this._replaceTemplate(s);var l=s.querySelector(".maptalks-msgContent");return n||e?n?l.innerHTML=this.options.content:this.options.content.bind(this)(l):l.appendChild(this.options.content),this._onCloseBtnClick=function(e){t.options.eventsPropagation||(f2(e),d2(e)),t.hide()},u2(s.querySelector(".maptalks-close"),"click touchend",this._onCloseBtnClick),e||this._replaceTemplate(l),this._bindDomEvents(s,"on"),this._appendCustomClass(s),s},e.prototype._replaceTemplate=function(t){var e=this._owner;if(this.options.enableTemplate&&e&&e.getProperties&&t&&t.innerHTML){var n=e.getProperties()||{};o0(n)&&(t.innerHTML=t.innerHTML.replace(Wtt,(function(t,e){return n[e]})))}return this},e.prototype.getTransformOrigin=function(){return this.getSize().width/2+"px bottom"},e.prototype.getOffset=function(){var t=this.getSize(),e=new $0(-t.width/2,0);this.options.custom?e._sub(0,t.height):e._sub(4,12);var n=this.getOwner();if(n instanceof A7||n instanceof _7){var i=void 0,r=void 0;if(n instanceof A7)i=n._getPainter(),r=n.getSize();else{var o=n.getGeometries();if(!o||!o.length)return e;i=o[0]._getPainter(),r=o[0].getSize()}if(r||(r=Ztt),i){var s=i.getFixedExtent();e._add(s.xmax-r.width/2,s.ymin)}else e._add(0,-r.height)}return e},e.prototype.show=function(e){return this.getMap()&&this.getMap().options.enableInfoWindow?t.prototype.show.call(this,e):this},e.prototype.getEvents=function(){if(!this.options.autoCloseOn)return null;var t={};return t[this.options.autoCloseOn]=this.hide,t},e.prototype.getOwnerEvents=function(){var t=this.getOwner();if(!this.options.autoOpenOn||!t)return null;var e={};return e[this.options.autoOpenOn]=this._onAutoOpen,e},e.prototype.onRemove=function(){this._onDomMouseout(),this.onDomRemove()},e.prototype.onDomRemove=function(){this._onCloseBtnClick&&(c2(this.getDOM().childNodes[2],"click touchend",this._onCloseBtnClick),delete this._onCloseBtnClick)},e.prototype._onAutoOpen=function(t){var e=this,n=this.getOwner();setTimeout((function(){n instanceof A7||n instanceof Htt?e.show(n.getCoordinates()):n instanceof _7?e.show(n.findClosest(t.coordinate)):n instanceof d7||n instanceof b7?(e.getMap().getScale()>=8&&(t.coordinate=e._rectifyMouseCoordinte(n,t.coordinate)),e.show(t.coordinate)):e.show(t.coordinate)}),1)},e.prototype._rectifyMouseCoordinte=function(t,e){var n=this;return t instanceof d7?this._rectifyLineStringMouseCoordinate(t,e).coordinate:t instanceof b7?t.getGeometries().map((function(t){return n._rectifyLineStringMouseCoordinate(t,e)})).sort((function(t,e){return t.dis-e.dis}))[0].coordinate:e},e.prototype._rectifyLineStringMouseCoordinate=function(t,e){for(var n=this.getMap(),i=t.getCoordinates()||[],r=n.getGLRes(),o=i.map((function(t){var e=n.coordToPointAtRes(t,r);return n._pointAtResToContainerPoint(e,r,t.z||0)})),s=n.coordToContainerPoint(e),a=1/0,h=-1,l=0,u=o.length;l<u;l++)(O=s.distanceTo(o[l]))<a&&(a=O,h=l);var c=[h-1,h,h+1].filter((function(t){return t>=0&&t<=o.length-1})),A=c.map((function(t){return o[t]})),f=[],d=n.getSize(),p=d.width,g=d.height;for(l=0,u=A.length-1;l<u;l++){var m=l,y=A[l],v=A[l+1];if(y.x===v.x)for(var _=Math.max(0,Math.min(y.y,v.y)),x=Math.min(g,Math.max(y.y,v.y)),b=_;b<=x;b++)f.push({point:new $0(y.x,b),coordinateIndex:m});else for(var w=(v.y-y.y)/(v.x-y.x),C=Math.max(0,Math.min(y.x,v.x)),P=Math.min(p,Math.max(y.x,v.x)),M=C;M<=P;M++)f.push({point:new $0(M,w*(M-y.x)+y.y),coordinateIndex:m})}var T,S=1/0,I=-1,E=-1;for(l=0,u=f.length;l<u;l++){var O,R=f[l],D=R.point,k=R.coordinateIndex;(O=s.distanceTo(D))<S&&(S=O,I=l,E=k,T=D)}if(I<0)return{dis:S,coordinate:e};var L=A[E],F=L.distanceTo(A[E+1]),N=T.distanceTo(L)/F,z=c.map((function(t){return i[t]})),B=z[E],H=z[E+1],j=B.x,U=B.y,G=B.z||0;return{dis:S,coordinate:new F4(j+(H.x-j)*N,U+(H.y-U)*N,G+((H.z||0)-G)*N)}},e.prototype._getWindowWidth=function(){var t=this.options.width;return t||(t=qtt.width),t},e}(Htt);Qtt.mergeOptions(qtt);var Xtt="remove hide shapechange positionchange dragend animatestart";(function(t){function e(e,n){void 0===n&&(n={});var i=t.call(this,n)||this;return i._content=e,i}return W0(e,t),e.prototype._getClassName=function(){return"ToolTip"},e.prototype.addTo=function(n){if(e.isSupport(n))return n.on("mousemove",this.onMouseMove,this),n.on("mouseout",this.onMouseOut,this),n.on(Xtt,this.hideDom,this),t.prototype.addTo.call(this,n);throw new Error("Invalid geometry or UIMarker the tooltip is added to.")},e.prototype.setStyle=function(t){return this.options.containerClass=t,this},e.prototype.getStyle=function(){return this.options.containerClass},e.prototype.getContent=function(){return this._content},e.prototype.buildOn=function(){var t=a2("div"),e=this.options||{};e.height&&(t.style.height=e.height+"px"),e.width&&(t.style.width=e.width+"px");var n=e.containerClass||e.cssName;return!n&&e.height&&(t.style.lineHeight=e.height+"px"),a0(this._content)?this._content.bind(this)(t):t.innerHTML='<div class="'.concat(n,'">').concat(this._content,"</div>"),this._appendCustomClass(t),t},e.prototype.onMouseOut=function(){clearTimeout(this._timeout),this.isVisible()&&this._removePrevDOM(),this._switchMapEvents("off")},e.prototype.onMouseMove=function(t){var e=this;clearTimeout(this._timeout);var n=this.getMap();if(n){var i=n.locateByPoint(t.coordinate,-5,25);0===this.options.showTimeout?this.show(i):this._timeout=setTimeout((function(){n&&e.show(i)}),this.options.showTimeout)}},e.prototype.onRemove=function(){clearTimeout(this._timeout),this._owner&&(this._owner.off("mousemove",this.onMouseMove,this),this._owner.off("mouseout",this.onMouseOut,this),this._owner.off(Xtt,this.hideDom,this))},e.prototype.hideDom=function(){this.hide()},e.prototype.onEvent=function(){return t.prototype.onEvent.call(this),this.hideDom(),this},e.prototype._getViewPoint=function(){return this.getMap().coordToViewPoint(this._coordinate,void 0,0)._add(this.options.dx,this.options.dy)},e})(Htt).mergeOptions({width:0,height:0,animation:"fade",containerClass:"maptalks-tooltip",showTimeout:400});var Ytt=function(t){function e(e){return t.call(this,e)||this}return W0(e,t),e.prototype._getClassName=function(){return"Menu"},e.prototype.addTo=function(t){return t._menu&&t._menu!==this&&t.removeMenu(),t._menu=this,this._owner=t,Htt.prototype.addTo.apply(this,[t])},e.prototype.setItems=function(t){return this.options.items=t,this},e.prototype.getItems=function(){return this.options.items||[]},e.prototype.buildOn=function(){var t;if(this.options.custom)if(s0(this.options.items)){var e=a2("div");e.innerHTML=this.options.items,this._appendCustomClass(e),t=e}else t=this.options.items;else{t=a2("div"),this.options.containerClass&&_2(t,this.options.containerClass),t.style.width=this._getMenuWidth()+"px";var n=this._createMenuItemDom();t.appendChild(n),P2(t,"contextmenu",f2),this._appendCustomClass(t)}return t&&(this._bindDomEvents(t,"off"),this._bindDomEvents(t,"on")),t},e.prototype.getOffset=function(){if(!this.getMap())return null;var t=this.getMap().getSize(),e=this.getMap().viewPointToContainerPoint(this._getViewPoint()),n=this.getSize(),i=0,r=0;return e.x+n.width>t.width&&(i=-n.width),e.y+n.height>t.height&&(r=-n.height),new $0(i,r)},e.prototype.getTransformOrigin=function(){var t=this.getOffset()._multi(-1);return t.x+"px "+t.y+"px"},e.prototype.getEvents=function(){return{"_zoomstart _zoomend _movestart _dblclick _click":this._removePrevDOM}},e.prototype._createMenuItemDom=function(){var t=this,e=this.getMap(),n=a2("ul");_2(n,"maptalks-menu-items");var i,r,o=this.getItems();function s(n){return function(i){var r=e._parseEvent(i,"click");r.target=t,r.owner=t._owner,r.index=n,!1!==this._callback(r)&&(t.hide(),t._owner&&t._owner.fire("closemenu"))}}for(var a=0,h=o.length;a<h;a++){if("-"===(i=o[a])||"_"===i)_2(r=a2("li"),"maptalks-menu-splitter");else{r=a2("li");var l=i.item;a0(l)&&(l=l({owner:this._owner,index:a})),r.innerHTML=l,r._callback=i.click,P2(r,"click",s(a))}n.appendChild(r)}var u=this.options.maxHeight||0;return u>0&&y2(n,"max-height: "+u+"px; overflow-y: auto;"),n},e.prototype._getMenuWidth=function(){return this.options.width||160},e}(Htt);Ytt.mergeOptions({containerClass:"maptalks-menu",animation:null,animationDelay:10,animationOnHide:!1,autoPan:!1,width:160,maxHeight:0,custom:!1,items:[]});var Jtt={setMenu:function(t){return this._menuOptions=t,this._menu?this._menu.setOptions(t):this.on("contextmenu",this._defaultOpenMenu,this),this},getMenu:function(){return this._menu},openMenu:function(t){var e=this instanceof H9?this:this.getMap();return t||(t=this.getCenter()),this._menu?this._menu.show(t):this._menuOptions&&e&&(this._bindMenu(),this._menu.show(t)),this.fire("openmenu",{coordinate:t}),this},setMenuItems:function(t){return this._menuOptions||(this._menuOptions={}),Array.isArray(t)&&(this._menuOptions.custom=!1),this._menuOptions.items=t,this.setMenu(this._menuOptions),this},getMenuItems:function(){return this._menu?this._menu.getItems():this._menuOptions&&this._menuOptions.items||[]},closeMenu:function(){return this._menu&&this._menu.hide(),this.fire("closemenu",{}),this},removeMenu:function(){return this.off("contextmenu",this._defaultOpenMenu,this),this._unbindMenu(),delete this._menuOptions,this.fire("removemenu",{}),this},_bindMenu:function(){return this._menuOptions?(this._menu=new Ytt(this._menuOptions),this._menu.addTo(this),this):this},_unbindMenu:function(){return this._menu&&(this.closeMenu(),this._menu.remove(),delete this._menu),this},_defaultOpenMenu:function(t){return this.openMenu(t.coordinate),!1}};H9.include(Jtt),M9.include(Jtt);var Ktt=function(t){function e(e){return e&&e.position&&!s0(e.position)&&(e.position=e0({},e.position)),t.call(this,e)||this}return W0(e,t),e.prototype._appendCustomClass=function(t){if(!t)return console.warn("dom is null:",t),this;if(this.options.cssName){var e=this.options.cssName;Array.isArray(e)||(e=[e]),e.forEach((function(e){t.classList.add(e)}))}return this},e.prototype.onAdd=function(){},e.prototype.onRemove=function(){},e.prototype.addTo=function(t){if(this.remove(),!t.options.control)return this;this._map=t;var e=t.getPanels().control;return this.__ctrlContainer=a2("div"),y2(this.__ctrlContainer,"position:absolute;overflow:visible;"),this.update(),e.appendChild(this.__ctrlContainer),this.onAdd&&this.onAdd(),this.fire("add",{dom:e}),this},e.prototype.update=function(){return this.__ctrlContainer.innerHTML="",this._controlDom=this.buildOn(this.getMap()),this._controlDom&&(this._updatePosition(),this.__ctrlContainer.appendChild(this._controlDom)),this},e.prototype.getMap=function(){return this._map},e.prototype.getPosition=function(){return e0({},this._parse(this.options.position))},e.prototype.setPosition=function(t){return this.options.position=s0(t)?t:e0({},t),this._updatePosition(),this},e.prototype.getContainerPoint=function(){var t,e,n=this.getPosition(),i=this.getMap().getSize();return n0(n.left)?n0(n.right)||(t=i.width-parseInt(n.right+"")):t=parseInt(n.left+""),n0(n.top)?n0(n.bottom)||(e=i.height-parseInt(n.bottom+"")):e=parseInt(n.top+""),new $0(t,e)},e.prototype.getContainer=function(){return this.__ctrlContainer},e.prototype.getDOM=function(){return this._controlDom},e.prototype.show=function(){return this.__ctrlContainer.style.display="",this},e.prototype.hide=function(){return this.__ctrlContainer.style.display="none",this},e.prototype.isVisible=function(){return this.__ctrlContainer&&""===this.__ctrlContainer.style.display},e.prototype.remove=function(){return this._map?(l2(this.__ctrlContainer),this.onRemove&&this.onRemove(),delete this._map,delete this.__ctrlContainer,delete this._controlDom,this.fire("remove"),this):this},e.prototype._parse=function(t){var n=t;return s0(t)&&(n=e.positions[n]),n},e.prototype._updatePosition=function(){var t=this.getPosition();for(var e in t||(t={top:20,left:20}),t)if(t.hasOwnProperty(e)){var n=t[e]||0;i0(n)&&(n+="px"),this.__ctrlContainer.style[e]=n}this.fire("positionchange",{position:e0({},t)})},e}(Q3(Y3));Ktt.positions={"top-left":{top:20,left:20},"top-right":{top:20,right:20},"bottom-left":{bottom:20,left:20},"bottom-right":{bottom:20,right:20}},H9.mergeOptions({control:!0}),H9.include({addControl:function(t){return this._containerDOM.getContext||t.addTo(this),this},removeControl:function(t){return t&&t.getMap()===this?(t.remove(),this):this}});var $tt="addlayer removelayer setbaselayer baselayerremove",tet=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(){return this._attributionContainer=a2("div"),this._attributionContainer.className="maptalks-attribution",this._appendCustomClass(this._attributionContainer),this._update(),this._attributionContainer},e.prototype.onAdd=function(){this.getMap().on($tt,this._update,this)},e.prototype.onRemove=function(){this.getMap().off($tt,this._update,this)},e.prototype._update=function(){var t=this.getMap();if(t){var e=t._getLayers((function(t){return!!t.options.attribution})).reverse().map((function(t){return t.options.attribution})),n=this.options.content+(e.length>0?" - "+e.join(", "):"");this._attributionContainer.innerHTML='<span style="padding:0px 4px">'+n+"</span>"}},e}(Ktt);tet.mergeOptions({position:{bottom:0,left:0},content:'<a href="http://maptalks.org" target="_blank">maptalks</a>'}),H9.mergeOptions({attribution:!0}),H9.addOnLoadHook((function(){var t=this.options.attribution||this.options.attributionControl;t&&(this.attributionControl=new tet(t),this.addControl(this.attributionControl))}));var eet=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(t){var e=this._getCompass();return this._appendCustomClass(e),this._compass=e,this._registerDomEvents(),t.on("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),e},e.prototype.onAdd=function(){this._rotateCompass()},e.prototype._getCompass=function(){return a2("div","maptalks-compass")},e.prototype._registerDomEvents=function(){P2(this._compass,"click",this._resetView,this)},e.prototype._rotateCompass=function(){var t=this.getMap().getBearing().toFixed(1),e=parseFloat(t);e<=180&&(e*=-1),e!==this._bearing&&(this._bearing=e,y2(this._compass,"transform: rotate(".concat(this._bearing,"deg);")))},e.prototype.onRemove=function(){this.getMap().off("resize moving moveend zooming zoomend rotate rotateend dragrotating dragrotateend viewchange",this._rotateCompass,this),delete this._compass,delete this._bearing},e.prototype._resetView=function(){this.getMap().animateTo({bearing:0})},e}(Ktt);eet.mergeOptions({position:{top:120,left:20}}),H9.mergeOptions({compassControl:!1}),H9.addOnLoadHook((function(){this.options.compassControl&&(this.compassControl=new eet(this.options.compassControl),this.addControl(this.compassControl))}));var net=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(){var t=this.container=a2("div",this.options.containerClass),e=this.panel=a2("div","panel"),n=this.button=a2("button");return t.appendChild(n),t.appendChild(e),this._appendCustomClass(t),t},e.prototype.onAdd=function(){P2(this.button,"mouseover",this._show,this),P2(this.panel,"mouseleave",this._hide,this)},e.prototype.onRemove=function(){this.panel&&(M2(this.button,"mouseover",this._show),M2(this.panel,"mouseleave",this._hide),l2(this.panel),l2(this.button),delete this.panel,delete this.button,delete this.container)},e.prototype._show=function(){v2(this.container,"shown")||(_2(this.container,"shown"),this._createPanel())},e.prototype._hide=function(t){this.panel.contains(t.toElement||t.relatedTarget)||x2(this.container,this.options.containerClass)},e.prototype._createPanel=function(){this.panel.innerHTML="";var t=a2("ul");this.panel.appendChild(t),this._renderLayers(this.getMap(),t)},e.prototype._renderLayers=function(t,e){var n=this,i=t.getBaseLayer(),r=t.getLayers(),o=r.length;if(i){var s=i.layers||[i],a=a2("li","group"),h=a2("ul");(c=a2("label")).innerHTML=this.options.baseTitle,a.appendChild(c);for(var l=0,u=s.length;l<u;l++)this._isExcluded(s[l])&&(h.appendChild(this._renderLayer(s[l],!0)),a.appendChild(h),e.appendChild(a))}if(o){a=a2("li","group"),h=a2("ul");var c=a2("label"),A=a2("input");A.type="checkbox",A.checked=!0,c.innerHTML=this.options.overlayTitle,a.appendChild(A),a.appendChild(c);var f=function(t){var e=t.target.checked,n=t.target.parentNode;if(n){var i=n.getElementsByTagName("ul")[0];if(i){var r=function(t){var n=t._layer;n&&n[e?"show":"hide"]()},o=function(t){var n=t._layer,i=t.childNodes[0];i&&(i.checked=e),n&&n[e?"show":"hide"]()};r(n),i.childNodes.forEach((function(t){o(t);var e=t.getElementsByTagName("ul")[0];e&&(r(t),e.childNodes.forEach((function(t){o(t)})))}))}}},d=function(t){var e=r[t];if(p._isExcluded(e)){if(e.getLayers){var i=a2("li","group"),o=a2("ul"),s=a2("label"),a=a2("input");s.innerHTML=e.getId(),a.type="checkbox",a.checked=e.isVisible(),a.onchange=f,i.appendChild(a),i.appendChild(s),i.appendChild(o),i._layer=e,h.appendChild(i),(e.getLayers()||[]).forEach((function(t){o.appendChild(n._renderLayer(t,!1,a.checked))}))}else h.appendChild(p._renderLayer(e));e&&!e.isVisible()&&(A.checked=!1)}},p=this;for(l=0;l<o;l++)d(l);a.appendChild(h),e.appendChild(a),A.onchange=f}},e.prototype._isExcluded=function(t){var e=t.getId(),n=this.options.excludeLayers;return!(n.length&&n.indexOf(e)>=0)},e.prototype._renderLayer=function(t,e,n){var i=this;void 0===n&&(n=!0);var r=a2("li","layer"),o=a2("label"),s=a2("input"),a=this.getMap(),h=t.options.visible;t.options.visible=!0;var l=t.isVisible();t.options.visible=h,r.className="layer";var u=s;return e?(u.type="radio",u.name="base"):u.type="checkbox",u.checked=h&&l,n||(u.checked=!1),l||u.setAttribute("disabled","disabled"),u.onchange=function(e){if("radio"===e.target.type){var n=a.getBaseLayer(),r=n.layers;if(r)for(var o=0,s=r.length;o<s;o++){var h=r[o];h[h===t?"show":"hide"]()}else n.isVisible()||n.show();a._fireEvent("setbaselayer")}else t[e.target.checked?"show":"hide"]();i.fire("layerchange",{target:t})},r.appendChild(s),o.innerHTML=t.getId(),r.appendChild(o),r._layer=t,r},e}(Ktt);net.mergeOptions({position:"top-right",baseTitle:"Base Layers",overlayTitle:"Layers",excludeLayers:[],containerClass:"maptalks-layer-switcher"}),H9.mergeOptions({layerSwitcherControl:!1}),H9.addOnLoadHook((function(){this.options.layerSwitcherControl&&(this.layerSwitcherControl=new net(this.options.layerSwitcherControl),this.addControl(this.layerSwitcherControl))}));var iet=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(){var t=this.options.size;this.options.maximize||(t=[0,0]);var e=a2("div");this._appendCustomClass(e);var n=this.mapContainer=a2("div");n.style.width=t[0]+"px",n.style.height=t[1]+"px",n.className=this.options.containerClass;var i=this.button=a2("div");return i.className=this.options.buttonClass,e.appendChild(n),e.appendChild(i),e},e.prototype.onAdd=function(){this.options.maximize&&this._createOverview(),this.getMap().on("resize moving zooming rotate dragrotating viewchange",this._update,this).on("setbaselayer",this._updateBaseLayer,this).on("spatialreferencechange",this._updateSpatialReference,this),P2(this.button,"click",this._onButtonClick,this),this._updateButtonText()},e.prototype.onRemove=function(){this.getMap().off("resize moving zooming rotate dragrotating viewchange",this._update,this).off("setbaselayer",this._updateBaseLayer,this).off("spatialreferencechange",this._updateSpatialReference,this),this._overview&&(this._overview.remove(),delete this._overview,delete this._perspective),M2(this.button,"click",this._onButtonClick)},e.prototype.maxmize=function(){var t=this.options.size,e=this.mapContainer;return e.style.width=t[0]+"px",e.style.height=t[1]+"px",this._createOverview(),this},e.prototype.minimize=function(){this._overview&&this._overview.remove(),delete this._overview,delete this._perspective;var t=this.mapContainer;return t.style.width="0px",t.style.height="0px",this},e.prototype.getOverviewMap=function(){return this._overview},e.prototype._onButtonClick=function(){this._overview?this.minimize():this.maxmize(),this._updateButtonText()},e.prototype._updateButtonText=function(){this.button.innerHTML=this._overview?"-":"+"},e.prototype._createOverview=function(){var t=this.getMap(),e=this.mapContainer,n=t.config();e0(n,{center:t.getCenter(),zoom:this._getOverviewZoom(),zoomAnimationDuration:150,pitch:0,bearing:0,scrollWheelZoom:!1,checkSize:!1,doubleClickZoom:!1,touchZoom:!1,control:!1,draggable:!1,maxExtent:null}),this._overview=new H9(e,n),this._updateBaseLayer(),this._perspective=new l7(this._getPerspectiveCoords(),{draggable:!0,cursor:"move",symbol:this.options.symbol}).on("dragend",this._onDragEnd,this),new K7("perspective_layer",this._perspective).addTo(this._overview),this.fire("load")},e.prototype._getOverviewZoom=function(){var t=this.getMap(),e=t.getZoom(),n=t.getMinZoom(),i=this.options.level;if(i>0){for(var r=i;r>0;r--)if(e-r>=n)return e-r}else for(r=i;r<0;r++)if(e-r>=n)return e-r;return e},e.prototype._onDragEnd=function(){var t=this._perspective.getCenter();this._overview.setCenter(t),this.getMap().panTo(t)},e.prototype._getPerspectiveCoords=function(){var t=this.getMap(),e=t.getProjection();return t.getContainerExtent().toArray().map((function(n){if(e){var i=t._containerPointToPrj(n);return t._fixPrjOnWorldWide(i),e.unproject(i)}return t.containerPointToCoordinate(n)}))},e.prototype._update=function(){if(this._overview){g2(this._overview.getContainer());var t=this._getPerspectiveCoords();this._perspective.setCoordinates(t),this._overview.setCenterAndZoom(this.getMap().getCenter(),this._getOverviewZoom())}},e.prototype._updateSpatialReference=function(){if(this._overview){var t=this.getMap();this._overview.setSpatialReference(t.options.spatialReference)}},e.prototype._updateBaseLayer=function(){if(this._overview){var t=this.getMap().getBaseLayer();if(t){var e=t.layers,n=0;if(e)for(var i=0,r=e.length;i<r;i++)if(e[i].isVisible()){n=i;break}var o=t.toJSON(),s=null;e?(s=o.layers[n].options).visible=!0:s=o.options,this._overview.setMinZoom(s.minZoom||null).setMaxZoom(s.maxZoom||null),delete s.minZoom,delete s.maxZoom,delete o.options.canvas,o.options.visible=!0,o.options.renderer="canvas";var a=k9.fromJSON(o);for(var h in t)a0(t[h])&&t.hasOwnProperty(h)&&t[h]!==t.constructor.prototype[h]&&(a[h]=t[h]);this._overview.setBaseLayer(a)}else this._overview.setBaseLayer(null)}},e}(Ktt);iet.mergeOptions({level:4,position:{right:1,bottom:1},size:[300,200],maximize:!0,symbol:{lineWidth:3,lineColor:"#1bbc9b",polygonFill:"#1bbc9b",polygonOpacity:.4},containerClass:"maptalks-overview",buttonClass:"maptalks-overview-button"}),H9.mergeOptions({overviewControl:!1}),H9.addOnLoadHook((function(){this.options.overviewControl&&(this.overviewControl=new iet(this.options.overviewControl),this.addControl(this.overviewControl))}));var ret=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(){var t,e=this;if(this.options.custom)s0(this.options.content)?((t=a2("div")).innerHTML=this.options.content,this._appendCustomClass(t)):t=this.options.content;else{if(t=a2("div","maptalks-panel"),this._appendCustomClass(t),this.options.closeButton){var n=a2("a","maptalks-close");n.innerText="×",n.href="javascript:;",n.onclick=function(){t.style.display="none",e.fire("close")},t.appendChild(n)}var i=a2("div","maptalks-panel-content");s0(this.options.content)?i.innerHTML=this.options.content:i.appendChild(this.options.content),t.appendChild(i)}return this.draggable=new L4(t,{cancelOn:this._cancelOn.bind(this),ignoreMouseleave:!0}),this.draggable.on("dragstart",this._onDragStart,this).on("dragging",this._onDragging,this).on("dragend",this._onDragEnd,this),this.options.draggable&&this.draggable.enable(),t},e.prototype.update=function(){return this.draggable&&(this.draggable.disable(),delete this.draggable),Ktt.prototype.update.call(this)},e.prototype.setContent=function(t){var e=this.options.content;return this.options.content=t,this.fire("contentchange",{old:e,new:t}),this.isVisible()&&this.update(),this},e.prototype.getContent=function(){return this.options.content},e.prototype._cancelOn=function(t){var e=(t.srcElement||t.target).tagName.toLowerCase();return"button"===e||"input"===e||"select"===e||"option"===e||"textarea"===e},e.prototype._onDragStart=function(t){this._startPos=t.mousePos,this._startPosition=e0({},this.getPosition()),this.fire("dragstart",t)},e.prototype._onDragging=function(t){var e=t.mousePos.sub(this._startPos),n=this._startPosition,i=this.getPosition();n0(i.top)||(i.top=parseInt(n.top)+e.y),n0(i.bottom)||(i.bottom=parseInt(n.bottom)-e.y),n0(i.left)||(i.left=parseInt(n.left)+e.x),n0(i.right)||(i.right=parseInt(n.right)-e.x),this.setPosition(i),this.fire("dragging",t)},e.prototype._onDragEnd=function(t){delete this._startPos,delete this._startPosition,this.fire("dragend",t)},e.prototype._getConnectPoints=function(){var t=this.getMap(),e=this.getContainerPoint(),n=this.getDOM(),i=parseInt(n.clientWidth+""),r=parseInt(n.clientHeight+"");return[t.containerPointToCoordinate(e.add(i/2,0)),t.containerPointToCoordinate(e.add(i,r/2)),t.containerPointToCoordinate(e.add(i/2,r)),t.containerPointToCoordinate(e.add(0,r/2))]},e}(Ktt);ret.mergeOptions({position:"top-right",draggable:!0,custom:!1,content:"",closeButton:!0});var oet=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(){var t=this._getReset();return this._appendCustomClass(t),this._reset=t,this._registerDomEvents(),t},e.prototype.onAdd=function(){this._view=this.options.view?this.options.view:this.getMap().getView()},e.prototype.setView=function(t){this._view=t},e.prototype._getReset=function(){return a2("div","maptalks-reset")},e.prototype._registerDomEvents=function(){P2(this._reset,"click",this._resetView,this)},e.prototype.onRemove=function(){delete this._reset,delete this._view},e.prototype._resetView=function(){this.getMap().setView(this._view)},e}(Ktt);oet.mergeOptions({position:{top:156,left:20},view:null}),H9.mergeOptions({resetControl:!1}),H9.addOnLoadHook((function(){this.options.resetControl&&(this.resetControl=new oet(this.options.resetControl),this.addControl(this.resetControl))}));var set="zoomend moving moveend",aet=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(t){return this._map=t,this._scaleContainer=a2("div",this.options.containerClass),this._addScales(),t.on(set,this._update,this),this._map.isLoaded()&&this._update(),this._appendCustomClass(this._scaleContainer),this._scaleContainer},e.prototype.onRemove=function(){this.getMap().off(set,this._update,this)},e.prototype._addScales=function(){var t="border: 2px solid #000000;border-top: none;line-height: 1.1;padding: 0px;color: #000000;font-size: 11px;text-align:center;white-space: nowrap;overflow: hidden;-moz-box-sizing: content-box;box-sizing: content-box;background: #fff; background: rgba(255, 255, 255, 0);";this.options.metric&&(this._mScale=h2("div",this.options.containerClass?null:t,this._scaleContainer)),this.options.imperial&&(this._iScale=h2("div",this.options.containerClass?null:t,this._scaleContainer))},e.prototype._update=function(){var t=this._map.pixelToDistance(this.options.maxWidth,0);this._updateScales(t)},e.prototype._updateScales=function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},e.prototype._updateMetric=function(t){var e=this._getRoundNum(t);this._updateScale(this._mScale,e<1e3?e+" m":e/1e3+" km",e/t)},e.prototype._updateImperial=function(t){var e,n,i,r=3.2808399*t;r>5280?(n=this._getRoundNum(e=r/5280),this._updateScale(this._iScale,n+" mile",n/e)):(i=this._getRoundNum(r),this._updateScale(this._iScale,i+" feet",i/r))},e.prototype._updateScale=function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},e.prototype._getRoundNum=function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return e*(n>=10?10:n>=5?5:n>=3?3:n>=2?2:1)},e}(Ktt);aet.mergeOptions({position:"bottom-left",maxWidth:100,metric:!0,imperial:!1,containerClass:null}),H9.mergeOptions({scaleControl:!1}),H9.addOnLoadHook((function(){this.options.scaleControl&&(this.scaleControl=new aet(this.options.scaleControl),this.addControl(this.scaleControl))}));var het=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(t){this._map=t;var e=a2("div"),n=a2("ul","maptalks-toolbar-hx");e.appendChild(n),_2(e,this.options.vertical?"maptalks-toolbar-vertical":"maptalks-toolbar-horizonal");var i=this;function r(t,e,n,r){var o=i._getItems()[e];return function(i){return d2(i),t({target:o,index:e,childIndex:n,dom:r})}}var o=this.options.items;if(d1(o))for(var s=0,a=o.length;s<a;s++){var h=o[s],l=a2("li");if(28!==this.options.height&&(l.style.lineHeight=this.options.height+"px"),l.style.height=this.options.height+"px",l.style.cursor="pointer",w2(h.item)){l.style.textAlign="center";var u=C2("div",h.item);l.innerHTML='<div style="margin-top:'+(this.options.height-u.height)/2+'px;">'+h.item+"</div>"}else l.innerHTML=h.item;if(h.click&&P2(l,"click",r(h.click,s,null,l)),d1(h.children)){var c=this._createDropMenu(s);l.appendChild(c),l._menu=c,P2(l,"mouseover",(function(){this._menu.style.display=""})),P2(l,"mouseout",(function(){this._menu.style.display="none"}))}n.appendChild(l)}return this._appendCustomClass(e),e},e.prototype._createDropMenu=function(t){var e=this;function n(t,n,i){var r=e._getItems()[n].children[i];return function(e){return d2(e),t({target:r,index:n,childIndex:i})}}var i=a2("div","maptalks-dropMenu"),r=this._getItems(),o=r.length,s=a2("ul"),a=r[t].children;t===o-1&&a&&(i.style.cssText="right: 0px;",s.style.cssText="right: 0px;position: absolute;",this.options.reverseMenu&&(s.style.bottom="0")),i.appendChild(a2("em","maptalks-ico"));for(var h=0,l=0,u=a.length;l<u;l++){var c=q1(a[l].item,"12px");c.width>h&&(h=c.width)}for(l=0,u=a.length;l<u;l++){var A=a[l],f=a2("li");f.innerHTML='<a href="javascript:;">'+A.item+"</a>",f.style.cursor="pointer",f.style.width=h+24+"px",P2(f.childNodes[0],"click",n(A.click,t,l)),s.appendChild(f)}if(this.options.vertical){var d=h<95?95:h;this.options.reverseMenu?i.style.right=-(d+20+2)+"px":i.style.left=-(d+20+2)+"px"}else this.options.reverseMenu?i.style.bottom="28px":i.style.top="29px";return i.appendChild(s),i.style.display="none",i},e.prototype._getItems=function(){return this.options.items||[]},e}(Ktt);het.mergeOptions({height:28,vertical:!1,position:"top-right",reverseMenu:!1,items:[]});var uet=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.buildOn=function(t){var e=this.options,n=a2("div","maptalks-zoom");if(this._appendCustomClass(n),e.zoomLevel){var i=a2("span","maptalks-zoom-zoomlevel"),r=a2("span","maptalks-zoom-zoomlevel-text");i.appendChild(r),n.appendChild(i),this._levelDOM=r}var o=a2("div","maptalks-zoom-slider"),s=a2("a","maptalks-zoom-zoomin");s.href="javascript:;",o.appendChild(s),this._zoomInButton=s;var a=a2("a","maptalks-zoom-zoomout");return a.href="javascript:;",o.appendChild(a),this._zoomOutButton=a,n.appendChild(o),t.on("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this),this._update(),this._registerDomEvents(),n},e.prototype.onRemove=function(){this.getMap().off("_zoomend _zooming _zoomstart _spatialreferencechange",this._update,this)},e.prototype._update=function(){this._updateText()},e.prototype._updateText=function(){if(this._levelDOM){var t=this.getMap().getZoom();r0(t)||(t=Math.floor(10*t)/10),this._levelDOM.innerHTML=t+""}},e.prototype._registerDomEvents=function(){this._zoomInButton&&P2(this._zoomInButton,"click",this._onZoomInClick,this),this._zoomOutButton&&P2(this._zoomOutButton,"click",this._onZoomOutClick,this)},e.prototype._onZoomInClick=function(t){f2(t),this.getMap().zoomIn()},e.prototype._onZoomOutClick=function(t){f2(t),this.getMap().zoomOut()},e}(Ktt);uet.mergeOptions({position:"top-left",zoomLevel:!0,seamless:!1}),H9.mergeOptions({zoomControl:!1}),H9.addOnLoadHook((function(){this.options.zoomControl&&(this.zoomControl=new uet(this.options.zoomControl),this.addControl(this.zoomControl))}));var cet=function(){function t(t,e,n,i){Array.isArray(t)?(this.scale={x:t[0],y:t[1]},this.origin={x:t[2],y:t[3]}):(this.scale={x:t,y:e},this.origin={x:n,y:i})}return t.getDefault=function(t){var e=t.code.toLowerCase();return"baidu"===e?"baidu":e==="EPSG:4326".toLowerCase()||e==="EPSG:4490".toLowerCase()?"tms-global-geodetic":"identity"===e?[1,-1,0,0]:"web-mercator"},t}(),Aet=6378137*Math.PI;e0(cet,{"web-mercator":new cet([1,-1,-Aet,Aet]),"tms-global-mercator":new cet([1,1,-Aet,-Aet]),"tms-global-geodetic":new cet([1,1,-180,-90]),baidu:new cet([1,1,0,0])});for(var fet=function(){function t(t,e,n,i){this.map=t,this.tileSize=i,this.fullExtent=n,this.prepareTileInfo(e,n),this._xScale=n.right>=n.left?1:-1,this._yScale=n.top>=n.bottom?1:-1;var r=t.getGLRes();this._pointOrigin=t._prjToPointAtRes(new $0(this.tileSystem.origin),r),this._glRes=r}return t.prototype.prepareTileInfo=function(t,e){if(s0(t)?t=cet[t.toLowerCase()]:Array.isArray(t)&&(t=new cet(t)),!t)throw new Error("Invalid TileSystem");this.tileSystem=t,this.transformation=new J4([e.right>e.left?1:-1,e.top>e.bottom?-1:1,t.origin.x,t.origin.y])},t.prototype._getTileNum=function(t,e){var n=this.tileSystem,i=this.tileSize,r=Math.floor(1e-7*n.scale.x+t.x/(i.width*e)),o=Math.ceil(1e-7*n.scale.y+t.y/(i.height*e));return{x:n.scale.x*r,y:n.scale.y*o}},t.prototype.getTileIndex=function(t,e,n){var i=this.tileSystem,r=this.transformation.transform(t,1),o=this._getTileNum(r,e);return i.scale.x<0&&(o.x-=1),i.scale.y>0&&(o.y-=1),this.getNeighorTileIndex(o.x,o.y,0,0,e,n)},t.prototype.getNeighorTileIndex=function(t,e,n,i,r,o){var s=this.tileSystem,a=t+s.scale.x*n,h=e-s.scale.y*i,l=!1,u=a,c=h,A=this._getTileFullIndex(r);return o&&(!0!==o&&"x"!==o||(A.xmax===A.xmin?a=A.xmin:a<A.xmin?(a=A.xmax-(A.xmin-a)%(A.xmax-A.xmin))===A.xmax&&(a=A.xmin):a>=A.xmax&&(a=A.xmin+(a-A.xmin)%(A.xmax-A.xmin))),!0!==o&&"y"!==o||(A.ymax===A.ymin?h=A.ymin:h>=A.ymax?h=A.ymin+(h-A.ymin)%(A.ymax-A.ymin):h<A.ymin&&(h=A.ymax-(A.ymin-h)%(A.ymax-A.ymin))===A.ymax&&(h=A.ymin))),(a<A.xmin||a>A.xmax||h>A.ymax||h<A.ymin)&&(l=!0),{x:a,y:h,idx:u,idy:c,out:l}},t.prototype._getTileFullIndex=function(t){if(this._tileFullIndex||(this._tileFullIndex={}),this._tileFullIndex[t])return this._tileFullIndex[t];var e=this.fullExtent,n=this.transformation,i=this._getTileNum(n.transform(new F4(e.left,e.top),1),t),r=this._getTileNum(n.transform(new F4(e.right,e.bottom),1),t),o=this.tileSystem;return o.scale.x<0&&(i.x-=1,r.x-=1),o.scale.y>0&&(i.y-=1,r.y-=1),this._tileFullIndex[t]=new X4(i,r,null),this._tileFullIndex[t]},t.prototype.getTilePrjNW=function(t,e,n,i){var r=this.tileSystem,o=this.tileSize,s=r.origin.y+this._yScale*r.scale.y*(e+(1===r.scale.y?1:0))*n*o.height,a=r.origin.x+this._xScale*r.scale.x*(t+(1===r.scale.x?0:1))*n*o.width;return i?(i.set(a,s),i):new F4(a,s)},t.prototype.getTilePointNW=function(t,e,n,i){var r=this._glRes/n,o=this.tileSystem,s=this.tileSize,a=this._pointOrigin.y*r+this._yScale*o.scale.y*(e+(1===o.scale.y?1:0))*s.height,h=this._pointOrigin.x*r+this._xScale*o.scale.x*(t+(1===o.scale.x?0:1))*s.width;return i?(i.set(h,a),i):new $0(h,a)},t.prototype.getTilePrjSE=function(t,e,n,i){var r=this.tileSystem,o=this.tileSize,s=r.origin.y+this._yScale*r.scale.y*(e+(1===r.scale.y?0:1))*n*o.height,a=r.origin.x+this._xScale*r.scale.x*(t+(1===r.scale.x?1:0))*n*o.width;return i?(i.set(a,s),i):new F4(a,s)},t.prototype.getTilePointSE=function(t,e,n,i){var r=this._glRes/n,o=this.tileSystem,s=this.tileSize,a=this._pointOrigin.y*r+this._yScale*o.scale.y*(e+(1===o.scale.y?0:1))*s.height,h=this._pointOrigin.x*r+this._xScale*o.scale.x*(t+(1===o.scale.x?1:0))*s.width;return i?(i.set(h,a),i):new $0(h,a)},t.prototype.getTilePrjExtent=function(t,e,n){var i=this.getTilePrjNW(t,e,n),r=this.getTilePrjSE(t,e,n);return new X4(i,r)},t}(),det=[],pet=0;pet<6;pet++)det[pet]=[];var get=[];function met(t,e,n){var i,r,o,s,a,h,l,u,c,A,f,d,p,g,m,y,v;r=(i=t)[0],o=i[1],s=i[2],a=i[3],h=i[4],l=i[5],u=i[6],c=i[7],A=i[8],f=i[9],d=i[10],p=i[11],g=i[12],m=i[13],y=i[14],v=i[15],vet(det[0],a-r,c-h,p-A,v-g),vet(det[1],a+r,c+h,p+A,v+g),vet(det[2],a+o,c+l,p+f,v+m),vet(det[3],a-o,c-l,p-f,v-m),vet(det[4],a-s,c-u,p-d,v-y),vet(det[5],a+s,c+u,p+d,v+y);for(var _=0;_<6;_++){var x=det[_];if(get[0]=x[0]>0?e[1][0]:e[0][0],get[1]=x[1]>0?e[1][1]:e[0][1],get[2]=x[2]>0?e[1][2]:e[0][2],_et(x,get)<0)return!1}return!0}var yet=1/6;function vet(t,e,n,i,r){return t[0]=e*yet,t[1]=n*yet,t[2]=i*yet,t[3]=r*yet,t}function _et(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}var xet=new $0(0,0),bet="undefined"!=typeof Set,wet=function(){function t(){this._table=bet?new Set:{}}return t.prototype.add=function(t){bet?this._table.add(t):this._table[t]=!0},t.prototype.has=function(t){return bet?this._table.has(t):this._table[t]},t.prototype.reset=function(){bet?this._table.clear():this._table={}},t}(),Cet={urlTemplate:null,subdomains:null,errorUrl:null,repeatWorld:!0,background:!0,loadingLimitOnInteracting:3,loadingLimit:0,tileRetryCount:0,placeholder:!1,crossOrigin:null,tileSize:[256,256],offset:[0,0],tileSystem:null,fadeAnimation:!K$,fadeDuration:1e3/60*10,debug:!1,spatialReference:null,maxCacheSize:256,renderer:G0.webgl?"gl":"canvas",clipByPitch:!0,maxAvailableZoom:null,cascadeTiles:!0,zoomOffset:0,pyramidMode:1,decodeImageInWorker:!1,tileLimitPerFrame:0,tileStackStartDepth:7,tileStackDepth:6,awareOfTerrain:!0,bufferPixel:.5,mipmapTexture:!0,depthMask:!0,currentTilesFirst:!0,forceRenderOnMoving:!0},Pet=/\{ *([\w_]+) *\}/g,Met=new $0(0,0),Tet=new $0(0,0),Iet=new $0(0,0),Eet=new $0(0,0),Oet=new $0(0,0),Ret=new $0(0,0),Det=[[0,0,0],[0,0,0]],ket=[0,0,0],Let=[0,0,0],Fet=[0,0,0],Net=function(t){function e(e,n){return t.call(this,e,n)||this}return W0(e,t),e.fromJSON=function(t){return t&&"TileLayer"===t.type?new e(t.id,t.options):null},e.prototype.forceReload=function(){return this.fire("forcereloadstart"),this.clear(),this.load(),this.fire("forcereloadend"),this},e.prototype.getTileSize=function(t){if(this._tileSize)return this._tileSize;var e=this.options.tileSize;return i0(e)&&(e=[e,e]),this._tileSize=new z1(e),this._tileSize},e.prototype.getTiles=function(t,e){var n,i=this;if(this._coordCache={},n=this._isPyramidMode()?this._getPyramidTiles(t,e):this._getCascadeTiles(t,e),!this._maskGeoJSON)return n;var r=0;return(n.tileGrids||[]).forEach((function(t){t.tiles=(t.tiles||[]).filter((function(t){return i._tileInMask(t)})),r+=t.tiles.length;var e=t.tiles.map((function(t){return t.parent}));t.parents=t.parents.filter((function(t){return e.indexOf(t.id)>-1}))})),n.count=r,n},e.prototype._isPyramidMode=function(){var t=this.getSpatialReference();return!this._disablePyramid&&!this._hasOwnSR&&this.options.pyramidMode&&t&&t.isPyramid()},e.prototype._getTileFullExtent=function(){if(this._tileFullExtent)return this._tileFullExtent;var t=this.getSpatialReference(),e=t.getFullExtent(),n=t.getResolution(0),i=this.getMap();return this._tileFullExtent=e.convertTo((function(t){return i._prjToPointAtRes(t,n,xet)})),this._tileFullExtent},e.prototype._getRootNodes=function(t){var e=this.getMap();if(this._rootNodes){var n=this._rootNodes,i=n.tiles;if(e.width!==n.mapWidth||e.height!==n.mapHeight){for(var r=this._getRootError(),o=0;o<i.length;o++)i[o].error=r;this._rootNodes.mapWidth=e.width,this._rootNodes.mapHeight=e.height}for(o=0;o<i.length;o++)i[o].offset[0]=t[0],i[o].offset[1]=t[1];return this._rootNodes}var s=this.getSpatialReference(),a=s.getResolution(0),h=this._getTileConfig(),l=s.getFullExtent(),u=h.tileSystem,c=u.origin,A=u.scale,f=h.getTilePrjExtent(0,0,a),d=f.getWidth(),p=f.getHeight(),g=1e-5,m=Math.abs((c.x-l.left)/d);m=Math.ceil(m-g);var y=Math.abs((l.right-c.x)/d);y=Math.ceil(y-g);var v=Math.ceil(Math.abs(l.top-c.y)/p);v=Math.ceil(v-g);var _=Math.ceil(Math.abs(l.bottom-c.y)/p);if((y+m)*((_=Math.ceil(_-g))+v)>32)return{status:0,error:"Too many root nodes"};var x=this._getRootError(),b=[];for(o=-m;o<y;o++)for(var w=-v;w<_;w++){var C=A.y<0?w:-(w+1);b.push(this.createTileNode(o,C,0,o,C,a,x))}return this._rootNodes={status:1,tiles:b,mapWidth:e.width,mapHeight:e.height},this._getRootNodes(t)},e.prototype.createTileNode=function(t,e,n,i,r,o,s,a,h,l){var u=this.getMap(),c=this.options.zoomOffset;h||(h=this._getTileConfig().getTilePrjExtent(t,e,o).convertTo((function(t){return u._prjToPointAtRes(t,o,xet)})));var A=this._getTileOffset(n),f=this.getTileUrl(t,e,n+c);return{parent:a,layer:this.getId(),x:t,y:e,z:n,idx:i,idy:r,res:o,extent2d:h,id:l||this._getTileId(t,e,n),url:k2(f),offset:A,error:s,children:[]}},e.prototype._getRootError=function(){var t=this.getMap(),e=c0(t.getFov()),n=t.width/t.height,i=t.cameraPosition[2],r=i*Math.tan(.5*e),o=r*n,s=Math.sqrt(i*i+r*r+o*o);return t._getFovZ(0)*(s/i)*this.getSpatialReference().getResolution(0)/t.getResolution(0)},e.prototype._getPyramidTiles=function(t,e){var n=this.getMap();isNaN(+t)&&(t=this._getTileZoom(n.getZoom()));var i,r=this.getSpatialReference(),o=Math.min(t,this.getMaxZoom(),this.getMaxAvailableZoom()||1/0),s=n.projViewMatrix,a=this._getTileFullExtent(),h=this._getTileOffset(0);if(this.options.repeatWorld){var l=n.getContainerExtent(),u=this._convertToExtent2d(l),c=r.getResolution(0)/n.getResolution();if(u.within(a.copy()._scale(c))){if(1!==(y=this._getRootNodes(h)).status)return console.warn(y.error),this._disablePyramid=!0,this.getTiles(t,e);i=X0([],Q0(y.tiles),!1)}else{var A=n.getPitch(),f=n.options.cascadePitches[1],d=Math.floor(n._getVisualHeight(f)),p=A<=f?l:new Y4(0,n.height-d,n.width,n.height);this._visitedTiles=new wet;var g=this._getTiles(0-this.options.zoomOffset,p,2,e&&e.getRenderer(),!0),m=this._getRootError()*Math.pow(2,this.options.zoomOffset);g.tiles.forEach((function(t){t.error=m})),i=g.tiles}}else{var y;if(1!==(y=this._getRootNodes(h)).status)return console.warn(y.error),this._disablePyramid=!0,this.getTiles(t,e);i=X0([],Q0(y.tiles),!1)}for(var v=n.getGLRes(),_={0:h},x=new Y4,b=[],w=[];i.length>0;){var C=i.pop();C.z!==o?(_[C.z+1]||(_[C.z+1]=this._getTileOffset(C.z+1)),this._splitNode(C,s,i,b,x,o,_[C.z+1],e&&e.getRenderer(),v),this.isParentTile(t,o,C)&&w.push(C)):(x._combine(C.extent2d),b.push(C))}return w.sort(zet),{tileGrids:[{extent:x,count:b.length,tiles:b,parents:w,offset:[0,0],zoom:t}],count:b.length}},e.prototype.isParentTile=function(t,e,n){var i=Math.max(this.getMinZoom(),t-this.options.tileStackStartDepth),r=Math.min(e,i+this.options.tileStackDepth);return n.z>=i&&n.z<r},e.prototype._splitNode=function(t,e,n,i,r,o,s,a,h){for(var l=t.z+1,u=this.getSpatialReference(),c=t.idx,A=t.idy,f=a||this.getRenderer(),d=!1,p=[],g=u.getResolution(l)/h,m=0;m<4;m++){var y=m%2,v=m>>1,_=(c<<1)+y,x=(A<<1)+v;t.children||(t.children=[]);var b=t.children[m];b||(b=this._getTileId(_,x,l),t.children[m]=b);var w=f.isTileCachedOrLoading(b),C=w&&w.info;C||(this.tileInfoCache||(this.tileInfoCache=new L3(4*this.options.maxCacheSize)),(C=this.tileInfoCache.get(b))||(C=this._createChildNode(t,y,v,s,b))),C.error=t.error/2,C.offset[0]=s[0],C.offset[1]=s[1];var P=this._isTileVisible(C,e,g,o,s);if(1===P)d=!0;else{if(-1===P)continue;if(0===P&&l!==o)return i.push(t),void r._combine(t.extent2d)}p.push(C)}l===o?d?n.push.apply(n,X0([],Q0(p),!1)):(i.push(t),r._combine(t.extent2d)):n.push.apply(n,X0([],Q0(p),!1))},e.prototype._createChildNode=function(t,e,n,i,r){var o,s=t.extent2d,a=t.z+1,h=(t.x<<1)+e,l=(t.y<<1)+n,u=(t.idx<<1)+e,c=(t.idy<<1)+n,A=s.getWidth()/2*2,f=s.getHeight()/2*2,d=2*s.xmin,p=2*s.ymax,g=2*s.ymin,m=this._getTileConfig().tileSystem.scale.y;if(r=r||this._getTileId(u,c,a),m<0){var y=d+e*A,v=p-n*f;o=new Y4(y,v-f,y+A,v)}else{var _=d+e*A,x=g+n*f;o=new Y4(_,x,_+A,x+f)}var b=this.createTileNode(h,l,a,u,c,t.res/2,t.error/2,t.id,o,r);return this.tileInfoCache.add(r,b),b},e.prototype._isTileVisible=function(t,e,n,i,r){if(0===t.z)return 1;if(!this._isTileInFrustum(t,e,n,r))return-1;var o=this.options.maxError;return n0(o)&&(o=1),this._getScreenSpaceError(t,n,i,r)>=o?1:0},e.prototype._isTileInFrustum=function(t,e,n,i){if(!this._zScale){var r=this.getMap(),o=r.getGLRes();this._zScale=r.altitudeToPoint(100,o)/100}var s=this.getRenderer(),a=t.extent2d,h=a.xmin,l=a.ymin,u=a.xmax,c=a.ymax;if(t.offset&&!a0(this.options.offset)){var A=Q0(t.offset,2),f=A[0],d=A[1];h+=f,u+=f,l+=d,c+=d}return Det[0][0]=(h-i[0])*n,Det[0][1]=(l-i[1])*n,Det[0][2]=(t.minAltitude||s&&s.avgMinAltitude||0)*this._zScale,Det[1][0]=(u-i[0])*n,Det[1][1]=(c-i[1])*n,Det[1][2]=(t.maxAltitude||s&&s.avgMaxAltitude||0)*this._zScale,met(e,Det)},e.prototype._getScreenSpaceError=function(t,e,n,i){var r=t.error,o=this.getMap(),s=t.extent2d,a=s.ymin,h=s.xmax,l=s.ymax;ket[0]=(s.xmin-i[0])*e,ket[1]=(a-i[1])*e,Let[0]=(h-i[0])*e,Let[1]=(l-i[1])*e;var u,c,A,f,d,p,g=(u=ket,c=Let,A=o.cameraPosition,f=Math.max(u[0]-A[0],0,A[0]-c[0]),d=Math.max(u[1]-A[1],0,A[1]-c[1]),p=Math.max(u[2]-A[2],0,A[2]-c[2]),Math.sqrt(f*f+d*d+p*p)),m=Math.max(Math.abs(g),1e-7),y=Math.abs(t.z-n),v=r*(o.height<1e3||y<=1?1:y<=2?.7:.605)/m;return this.getMap().getPitch()<=60?1.45*v:v},e.prototype._getCascadeTiles=function(t,e){var n=this.getMap(),i=n.getPitch(),r=e&&e.getRenderer(),o=n.getContainerExtent(),s=[],a=0,h=this.getMinZoom(),l=n.options.cascadePitches[0],u=n.options.cascadePitches[1],c=Math.floor(n._getVisualHeight(u)),A=n0(t)?this._getTileZoom(n.getZoom()):t;if(this._visitedTiles=new wet,!n0(t)||!this.options.cascadeTiles||i<=l||!n0(h)&&A<=h){var f=i<=u?o:new Y4(0,n.height-c,n.width,n.height),d=this._getTiles(A,f,2,r);return d&&(a+=d.tiles.length,s.push(d)),{tileGrids:s,count:a}}var p=Math.floor(n._getVisualHeight(l)),g=new Y4(0,n.height-p,n.width,n.height),m=this._getTiles(A,g,0,r);a+=m?m.tiles.length:0,s.push(m);var y,v,_=g.ymin,x=n.getSpatialReference().getZoomDirection(),b=x;if(i>u){A-b<=h&&(b=0);var w=new Y4(0,n.height-c,n.width,_);a+=(y=this._getTiles(A-b,w,1,r))?y.tiles.length:0,_=w.ymin,b+=4*x,s.push(y)}if(A-b>=h){var C=new Y4(0,o.ymin,n.width,_);a+=(v=this._getTiles(A-b,C,2,r))?v.tiles.length:0,s.push(v)}return y&&v&&(s[1]=v,s[2]=y),{tileGrids:s,count:a}},e.prototype.getTileUrl=function(t,e,n){var i=this.options.urlTemplate,r="";if(this.options.subdomains){var o=this.options.subdomains;if(d1(o)){var s=(t+e)%o.length;s<0&&(s=0),r=o[s]}}if(a0(i))return i(t,e,n,r);var a={x:t,y:e,z:n,s:r};return this.options.token&&(a.token=this.options.token),this.options.customTags&&e0(a,this.options.customTags),i.replace(Pet,(function(t,e){var n=a[e];if(void 0===n)throw new Error("No value provided for variable "+t);return"function"==typeof n&&(n=n(a)),n}))},e.prototype.clear=function(){return this._renderer&&this._renderer.clear(),this.tileInfoCache&&this.tileInfoCache.reset(),this.fire("clear"),this},e.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}},e.prototype.getSpatialReference=function(){var t=this.getMap();if(t&&(!this.options.spatialReference||b9.equals(this.options.spatialReference,t.options.spatialReference)))return t.getSpatialReference();if(this._sr)return this._sr;var e=this.options.spatialReference;if(s0(e)&&!(e=b9.getPreset(e)))throw new Error("Unsupported spatial reference: ".concat(this.options.spatialReference,", possible values: ").concat(b9.getAllPresets().join()));return this._sr=new b9(e),this._srMinZoom=this._sr.getMinZoom(),this._srMaxZoom=this._sr.getMaxZoom(),this._hasOwnSR=this._sr.toJSON().projection!==t.getSpatialReference().toJSON().projection,this._sr},e.prototype.getMinZoom=function(){var t=this.options.minZoom||0;return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.max(t,this._srMinZoom):t},e.prototype.getMaxZoom=function(){return this.getSpatialReference()!==this.getMap().getSpatialReference()?Math.min(t.prototype.getMaxZoom.call(this),this._srMaxZoom):t.prototype.getMaxZoom.call(this)},e.prototype._getTileZoom=function(t){if(!this._hasOwnSR){var e=this.getMap().getResolution(t),n=this.getSpatialReference().getResolution(t);t+=Math.log(n/e)*Math.LOG2E}var i=this.getMaxAvailableZoom();return!n0(i)&&t>i&&(t=i),r0(t)||(t=Math.round(t)),Math.max(0,t)},e.prototype.getMaxAvailableZoom=function(){var t=this.getSpatialReference();return this.options.maxAvailableZoom||t&&t.getMaxZoom()},e.prototype._getTiles=function(t,e,n,i,r){var o=this.getMap(),s=t,a=o.projViewMatrix,h=o.getResolution(t)/o.getResolution(t-1)==.5;n<2&&(0===n&&h&&(s-=1),a=0===n?o.cascadeFrustumMatrix0:1===n?o.cascadeFrustumMatrix1:o.projViewMatrix);var l=s+this.options.zoomOffset,u=this._getTileOffset(s),c=u[0]||u[1],A={zoom:s,extent:null,offset:u,tiles:[]};if(l<0)return A;if(!(o&&this.isVisible()&&o.width&&o.height))return A;if(!r){var f=this.getMinZoom(),d=this.getMaxZoom();if(!n0(f)&&s<f||!n0(d)&&s>d)return A}var p=this._getTileConfig();if(!p)return A;var g,m={zoom:u},y=this.getSpatialReference().getResolution(s);g=this._hasOwnSR?o.getGLScale(s):y/o.getGLRes();var v=!this._hasOwnSR&&this.options.repeatWorld,_=this._convertToExtent2d(e),x=this._getMask2DExtent();if(x){var b=x.intersection(_);if(!b)return A;e=b.convertTo((function(t){return o._pointToContainerPoint(t,void 0,0,xet)}))}var w,C=o._containerPointToPrj(e.getCenter(),Met),P=o._prjToPoint(C,s,Tet);w=this._project(c?o._pointToPrj(P._add(u),s,Tet):C,Tet);var M=o.getGLScale()/o.getGLScale(s);Iet.x=_.xmin*M,Iet.y=_.ymax*M,Eet.x=_.xmax*M,Eet.y=_.ymin*M;for(var T=this._project(o._pointToPrj(Iet._add(u),s,Iet),Iet),S=this._project(o._pointToPrj(Eet._add(u),s,Eet),Eet),I=p.getTileIndex(w,y,v),E=p.getTileIndex(T,y,v),O=p.getTileIndex(S,y,v),R=Math.ceil(Math.abs(I.idy-E.idy)),D=Math.ceil(Math.abs(I.idx-E.idx)),k=Math.ceil(Math.abs(I.idy-O.idy)),L=Math.ceil(Math.abs(I.idx-O.idx)),F=(R+k+1)*(D+L+1),N=this.getTileSize(),z=this.getRenderer()||i,B=this._getTileConfig().tileSystem.scale,H=[],j=new Y4,U=new $0(0,0),G=-R;G<=k;G++)for(var V=-D,W=-1/0,q=!1;V>=W&&V<=L;){var Z=p.getNeighorTileIndex(I.idx,I.idy,V,G,y,v);W===-1/0?V++:V--;var Q=this._getTileId(Z.idx,Z.idy,s);if(!(Z.out||this._visitedTiles&&this._visitedTiles.has(Q))){var X=z&&z.isTileCachedOrLoading(Q);X&&(X=X.info);var Y=void 0;if(X){var J=X.extent2d;U.set(J.xmin,J.ymax),Y=U}else if(this._hasOwnSR){var K=p.getTilePrjNW(Z.x,Z.y,y);Y=o._prjToPoint(this._unproject(K,Eet),s)}else Y=p.getTilePointNW(Z.x,Z.y,y);var $=void 0,tt=void 0;if(this._hasOwnSR){var et=void 0;if(this._hasOwnSR){var nt=p.getTilePrjSE(Z.x,Z.y,y);et=o._prjToPoint(this._unproject(nt,Eet),s,Eet)}else et=p.getTilePointSE(Z.x,Z.y,y);$=Math.ceil(Math.abs(et.x-Y.x)),tt=Math.ceil(Math.abs(et.y-Y.y))}else $=N.width,tt=N.height;var it=B.x*(Z.idx-Z.x)*$,rt=B.y*(Z.idy-Z.y)*tt;X||!it&&!rt||Y._add(it,rt);var ot=X&&X.extent2d||new Y4(Y.x,Y.y-tt,Y.x+$,Y.y);if(F<=4||q||this._isTileInExtent(a,ot,u,g)){var st=this._hasOwnSR?o._getResolution(s):y;this._visitedTiles&&0===n&&this._visitedTiles.add(Q),h&&0===n?(this._splitTiles(a,H,z,Z,s+1,st,ot,it,rt,m),j._combine(ot)):(X?(X.offset[0]=u[0],X.offset[1]=u[1]):X=this.createTileNode(Z.x,Z.y,s,Z.idx,Z.idy,st,0,null,ot,Q),H.push(X),j._combine(ot)),W===-1/0?(W=V,V=L):q||(q=!0)}}}if(H.length){var at=o._containerPointToPoint(e.getCenter(),s,xet)._add(u),ht=new $0(0,0),lt=new $0(0,0);H.sort((function(t,e){return ht.set((t.extent2d.xmin+t.extent2d.xmax)/2,(t.extent2d.ymin+t.extent2d.ymax)/2),lt.set((e.extent2d.xmin+e.extent2d.xmax)/2,(e.extent2d.ymin+e.extent2d.ymax)/2),ht.distanceTo(at)-lt.distanceTo(at)}))}return{offset:u,zoom:t,extent:j,tiles:H}},e.prototype._convertToExtent2d=function(t){var e=this,n=this.getMap();return t.convertTo((function(t){if(t.y>0&&t.y<n.height){var i=(0===t.x?0:1)+t.y;e._coordCache[i]||(e._coordCache[i]=n._containerPointToPoint(t)),e._coordCache[i]}return n._containerPointToPoint(t,void 0,xet)}))},e.prototype._splitTiles=function(t,e,n,i,r,o,s,a,h,l){var u=this._getTileConfig().tileSystem.scale.y,c=this.getMap().getGLScale(r),A=Oet.set(2*s.xmin,u<0?2*s.ymax:2*s.ymin),f=s.getWidth(),d=s.getHeight(),p=2*i.idx,g=2*i.idy,m=2*i.x,y=2*i.y,v=this._checkAndAddTile(t,n,p,g,m,y,r,o,0,0,f,d,A,c,l);v&&e.push(v),(v=this._checkAndAddTile(t,n,p,g,m,y,r,o,0,1,f,d,A,c,l))&&e.push(v),(v=this._checkAndAddTile(t,n,p,g,m,y,r,o,1,0,f,d,A,c,l))&&e.push(v),(v=this._checkAndAddTile(t,n,p,g,m,y,r,o,1,1,f,d,A,c,l))&&e.push(v)},e.prototype._checkAndAddTile=function(t,e,n,i,r,o,s,a,h,l,u,c,A,f,d){var p=this._getTileId(n+h,i+l,s);if(this._visitedTiles&&this._visitedTiles.has(p))return null;var g=d[s];g||(g=d[s]=this._getTileOffset(s));var m=this._getTileConfig().tileSystem.scale.y,y=new Y4(A.x+h*u,A.y+m*l*c,A.x+(h+1)*u,A.y+m*(l+1)*c);if(
/*!rightVisitEnd && */
!this._isSplittedTileInExtent(t,y,g,f))return null;var v=a/2,_=e&&e.isTileCachedOrLoading(p);return _?_.info:this.createTileNode(r+h,o+l,s,n+h,n+o,v,0,null,y,p)},e.prototype._getTileOffset=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.options.offset;return a0(n)&&(n=n.call.apply(n,X0([this],Q0(t),!1))),i0(n)&&(n=[n,n]),n||[0,0]},e.prototype.getTileId=function(t,e,n,i){return this._getTileId(t,e,n,i)},e.prototype._getTileId=function(t,e,n,i){return"".concat(i||this.getId(),"_").concat(t,"_").concat(e,"_").concat(n)},e.prototype._project=function(t,e){if(this._hasOwnSR){var n=this.getMap().getProjection();return this.getSpatialReference().getProjection().project(n.unproject(t,e),e)}return t},e.prototype._unproject=function(t,e){if(this._hasOwnSR){var n=this.getMap(),i=this.getSpatialReference(),r=n.getProjection(),o=i.getProjection();return r.project(o.unproject(t,e),e)}return t},e.prototype._initTileConfig=function(){var t=this.getMap(),e=this.getTileSize(),n=this.getSpatialReference(),i=n.getProjection(),r=n.getFullExtent();this._defaultTileConfig=new fet(t,cet.getDefault(i),r,e),this.options.hasOwnProperty("tileSystem")&&(this._tileConfig=new fet(t,this.options.tileSystem,r,e)),delete this._rootNodes,delete this._tileFullExtent,delete this._disablePyramid},e.prototype._getTileConfig=function(){return this._defaultTileConfig||this._initTileConfig(),this._tileConfig||this._defaultTileConfig},e.prototype._bindMap=function(e){return this._onSpatialReferenceChange(),t.prototype._bindMap.apply(this,arguments)},e.prototype._isTileInExtent=function(t,e,n,i){var r,o,s,a,h,l,u,c,A=this.getMap();if(t!==A.projViewMatrix){var f=e.getCenter(Ret)._sub(n[0],n[1])._multi(i);ctt(Fet,f.x,f.y,0),r=(o=Fet,s=Fet,a=A.projViewMatrix,h=s[0],l=s[1],u=s[2],c=a[3]*h+a[7]*l+a[11]*u+a[15],o[0]=(a[0]*h+a[4]*l+a[8]*u+a[12])/(c=c||1),o[1]=(a[1]*h+a[5]*l+a[9]*u+a[13])/c,o[2]=(a[2]*h+a[6]*l+a[10]*u+a[14])/c,o)[1]<0?A.projViewMatrix:t}else r=A.projViewMatrix;return Det[0][0]=(e.xmin-n[0])*i,Det[0][1]=(e.ymin-n[1])*i,Det[1][0]=(e.xmax-n[0])*i,Det[1][1]=(e.ymax-n[1])*i,met(r,Det)},e.prototype._isSplittedTileInExtent=function(t,e,n,i){var r=this.getMap();return Det[0][0]=(e.xmin-n[0])*i,Det[0][1]=(e.ymin-n[1])*i,Det[1][0]=(e.xmax-n[0])*i,Det[1][1]=(e.ymax-n[1])*i,met(r.projViewMatrix,Det)},e.prototype.getEvents=function(){return{spatialreferencechange:this._onSpatialReferenceChange}},e.prototype._onSpatialReferenceChange=function(){delete this._tileConfig,delete this._defaultTileConfig,delete this._sr,delete this._srMinZoom,delete this._hasOwnSR,delete this._rootNodes,this.tileInfoCache&&this.tileInfoCache.reset();var t=this.getRenderer();t&&t.clear()},e.prototype.getPolygonOffsetCount=function(){return 2},e.prototype.getPolygonOffset=function(){return this._polygonOffset||0},e.prototype.setPolygonOffset=function(t){return this._polygonOffset=t,this},e.prototype.getRenderer=function(){return t.prototype.getRenderer.call(this)},e.prototype._getTileBBox=function(t){var e=this.getMap();if(e){var n=t.extent2d;if(n){var i=t.res,r=n.xmax,o=n.ymax,s=new $0(n.xmin,n.ymin),a=new $0(r,o),h=e.pointAtResToCoordinate(s,i,Met),l=e.pointAtResToCoordinate(a,i,Tet);return[h.x,h.y,l.x,l.y]}}},e.prototype._tileInMask=function(t){var e=this.getMask();if(!e)return!0;var n=e.type;if(!n||-1===n.indexOf("Polygon"))return!0;var i=this._maskGeoJSON;if(!i||!i.geometry)return!0;var r=i.geometry,o=r.type;if(!r.coordinates||!o)return!0;if(-1===o.indexOf("Polygon"))return!0;if(!i.bbox){var s=e.getExtent();if(!s)return!0;i.bbox=[s.xmin,s.ymin,s.xmax,s.ymax]}var a=this._getTileBBox(t);return!a||function(t,e){var n=e.bbox;if(!n)return console.error("maskGeoJSON bbox is null:",e),!1;if((r=n)[2]<(o=t)[0]||r[1]>o[3]||r[0]>o[2]||r[3]<o[1])return!1;var i=e.geometry;if(!i)return console.error("maskGeoJSON is error,not find geometry.",e),!1;var r,o,s=i.coordinates;"Polygon"===i.type&&(s=[s]);for(var a=0,h=s.length;a<h;a++){var l=W5.polygon(s[a][0],t);if(l.length>0){for(var u=1/0,c=-1/0,A=1/0,f=-1/0,d=0,p=l.length;d<p;d++){var g=Q0(l[d],2),m=g[0],y=g[1];u=Math.min(m,u),A=Math.min(y,A),c=Math.max(m,c),f=Math.max(y,f)}if(u!==c&&A!==f)return!0}}return!1}(a,this._maskGeoJSON)},e}(k9);function zet(t,e){return t.z-e.z}Net.registerJSONType("TileLayer"),Net.mergeOptions(Cet);var Bet=new z1(256,256),Het="show hide remove setzindex forcereloadstart";function jet(t){return Array.isArray(t)||(t=[t]),t}var Uet=function(t){function e(e,n,i){var r=t.call(this,e,i)||this;return r.layers=n||[],r._checkChildren(),r.layerMap={},r._groupChildren=[],r}return W0(e,t),e.fromJSON=function(t){if(!t||"GroupTileLayer"!==t.type)return null;var n=t.layers.map((function(t){return k9.fromJSON(t)}));return new e(t.id,n,t.options)},e.prototype.getLayers=function(){return this.layers},e.prototype.addLayer=function(t){var e=this;void 0===t&&(t=[]),t=jet(t);var n=this.layers.length;return t.forEach((function(t){t instanceof Net&&(-1!==e.layers.indexOf(t)||e.layerMap[t.getId()]||e.layers.push(t))})),n!==this.layers.length&&(this._sortLayers(),this._refresh(),this._renderLayers()),this},e.prototype.removeLayer=function(t){var e=this;void 0===t&&(t=[]),t=jet(t);var n=this.layers.length;return t.forEach((function(t){if(t instanceof Net||(t=e.layerMap[t]),t instanceof Net){var n=e.layers.indexOf(t);n>=0&&(e.layers.splice(n,1),t._doRemove(),t.off(Het,e._onLayerShowHide,e))}})),n!==this.layers.length&&(this._refresh(),this._renderLayers()),this},e.prototype.clearLayers=function(){var t=this;return this.layers.forEach((function(e){e._doRemove(),e.off(Het,t._onLayerShowHide,t)})),this.layers=[],this._refresh(),this._renderLayers(),this},e.prototype.toJSON=function(){return{type:this.getJSONType(),id:this.getId(),layers:this.layers.map((function(t){return t.toJSON()})),options:this.config()}},e.prototype.getTileSize=function(t){var e=this.getLayer(t);return e?e.getTileSize():Bet},e.prototype.getTiles=function(t,e){for(var n=this.layers,i=[],r=0,o=0,s=n.length;o<s;o++){var a=n[o];if(a&&a.options.visible&&a.isVisible()&&a.getMap()){var h=a.getTiles(t,e||this);h&&0!==h.count&&(r+=h.count,s1(i,h.tileGrids))}}return{count:r,tileGrids:i}},e.prototype.onAdd=function(){this._sortLayers(),this._refresh(),t.prototype.onAdd.call(this)},e.prototype.onRemove=function(){var e=this;this.layers.forEach((function(t){t._doRemove(),t.off(Het,e._onLayerShowHide,e)})),this.layerMap={},this._groupChildren=[],t.prototype.onRemove.call(this)},e.prototype.getLayer=function(t){return this.getChildLayer(t)},e.prototype.getChildLayer=function(t){var e=this.layerMap[t];if(e)return e;for(var n=0;n<this._groupChildren.length;n++){var i=this._groupChildren[n].getChildLayer(t);if(i)return i}return null},e.prototype._removeChildTileCache=function(t){if(!t)return this;var e,n=this.getRenderer();if(!n)return this;var i=t.getId(),r=function(){return e&&e.info&&e.info.layer===i};n.tileCache&&n.tileCache.keys().forEach((function(t){e=n.tileCache.get(t),r()&&n.tileCache.remove(t)}));var o=n.tilesInView||{};for(var s in o)e=o[s],r()&&delete o[s];var a=n.tilesLoading||{};for(var s in a)e=a[s],r()&&n.abortTileLoading(e.image,e.info);return this},e.prototype._onLayerShowHide=function(t){var e=t||{},n=e.type,i=e.target;"remove"===n&&i?(this.layers.splice(this.layers.indexOf(i),1),i._doRemove(),i.off(Het,this._onLayerShowHide,this),this._refresh()):"setzindex"===n?this._sortLayers():"forcereloadstart"===n&&this._removeChildTileCache(i),this._renderLayers()},e.prototype._renderLayers=function(){var t=this.getRenderer();return t&&t.setToRedraw(),this},e.prototype._refresh=function(){var t=this,e=this.getMap();return this._groupChildren=[],this.layerMap={},this.layers.forEach((function(n){t.layerMap[n.getId()]=n,n.getChildLayer&&t._groupChildren.push(n),n.getMap()||n._bindMap(e),n.off(Het,t._onLayerShowHide,t),n.on(Het,t._onLayerShowHide,t)})),this},e.prototype.isVisible=function(){if(!t.prototype.isVisible.call(this))return!1;for(var e=this.layers,n=0,i=e.length;n<i;n++)if(e[n].isVisible())return!0;return!1},e.prototype._checkChildren=function(){var t=this,e={};this.layers.forEach((function(n){var i=n.getId();if(e[i])throw new Error("Duplicate child layer id (".concat(i,") in the GroupTileLayer (").concat(t.getId(),")"));e[i]=1}))},e.prototype._sortLayers=function(){this.layers.sort((function(t,e){return t.options.zIndex-e.options.zIndex}))},e}(Net);Uet.registerJSONType("GroupTileLayer"),Uet.mergeOptions({urlTemplate:"",maxCacheSize:1024});var Get,Vet={urlTemplate:"",crs:null,uppercase:!1,detectRetina:!1},Wet={service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},qet=function(t){function e(e,n){var i=t.call(this,e)||this;return Get||(Get=e0({},i.options)),i.wmsParams=e0({},Wet),i.setOptions(n),i.setZIndex(n.zIndex),G0.proxy||i._optionsHook(n),i}return W0(e,t),e.prototype._optionsHook=function(t){for(var e in void 0===t&&(t={}),t)"tileSize"===e&&(this._tileSize=null),e in Get||(this.wmsParams[e]=t[e]);var n=this.getTileSize();return this.wmsParams.width=n.width,this.wmsParams.height=n.height,this._wmsVersion=parseFloat(this.wmsParams.version),this},e.prototype.onAdd=function(){var e=this.getMap().getDevicePixelRatio(),n=Vet.detectRetina?e:1;this.wmsParams.width*=n,this.wmsParams.height*=n;var i=this.options.crs||this.getMap().getProjection().code;this.wmsParams[this._wmsVersion>=1.3?"crs":"srs"]=i,t.prototype.onAdd.call(this)},e.prototype.getTileUrl=function(e,n,i){var r=this.getSpatialReference().getResolution(i),o=this._getTileConfig().getTilePrjExtent(e,n,r),s=o.getMax(),a=o.getMin(),h=(this._wmsVersion>=1.3&&("EPSG:4326"===this.wmsParams.crs||"EPSG:4490"===this.wmsParams.crs)?[a.y,a.x,s.y,s.x]:[a.x,a.y,s.x,s.y]).join(","),l=t.prototype.getTileUrl.call(this,e,n,i);return l+function(t,e,n){var i=[];for(var r in t)i.push(encodeURIComponent(n?r.toUpperCase():r)+"="+encodeURIComponent(t[r]));return(e&&-1!==e.indexOf("?")?"&":"?")+i.join("&")}(this.wmsParams,l,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+h},e.prototype.toJSON=function(){return{type:"WMSTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"WMSTileLayer"===t.type?new e(t.id,t.options):null},e}(Net);qet.registerJSONType("WMSTileLayer"),qet.mergeOptions(Vet);var Zet=function(t){function e(e,n){var i=t.call(this,e,n)||this;return i.options.hasOwnProperty("forceRenderOnMoving")||(i.options.forceRenderOnMoving=!1),i}return W0(e,t),e.prototype.drawTile=function(){},e.prototype.toJSON=function(){return{type:"CanvasTileLayer",id:this.getId(),options:this.config()}},e.fromJSON=function(t){return t&&"CanvasTileLayer"===t.type?new e(t.id,t.options):null},e}(Net);function Qet(t,e,n){var i=t.createShader(e);if(t.shaderSource(i,n),t.compileShader(i),!t.getShaderParameter(i,t.COMPILE_STATUS)){var r=t.getShaderInfoLog(i);throw t.deleteShader(i),new Error("Failed to compile shader: "+r)}return i}function Xet(t,e,n){var i=Qet(t,t.VERTEX_SHADER,e),r=Qet(t,t.FRAGMENT_SHADER,n);if(!i||!r)return null;var o=t.createProgram();return o?(t.attachShader(o,i),t.attachShader(o,r),t.linkProgram(o),{program:o,vertexShader:i,fragmentShader:r}):null}function Yet(t,e,n){if(Array.isArray(n[0])){for(var i=Float32Array.BYTES_PER_ELEMENT,r=0,o=0;o<n.length;o++)r+=n[o][1]||0;var s=0;for(o=0;o<n.length;o++){if((a=t.getAttribLocation(e,n[o][0]))<0)throw new Error("Failed to get the storage location of "+n[o][0]);t.vertexAttribPointer(a,n[o][1],t[n[o][2]||"FLOAT"],!1,i*r,i*s),s+=n[o][1]||0,t.enableVertexAttribArray(a)}}else{var a=t.getAttribLocation(e,n[0]);t.vertexAttribPointer(a,n[1],t[n[2]||"FLOAT"],!1,0,0),t.enableVertexAttribArray(a)}}Zet.registerJSONType("CanvasTileLayer");var Jet={never:512,"<":513,"=":514,"<=":515,">":516,"!=":517,">=":518,always:519},Ket=[1,1,1,1],$et=new Float32Array(8),tnt=new Int16Array(8),ent="\n        attribute vec2 a_position;\n\n        attribute vec2 a_texCoord;\n\n        uniform mat4 u_matrix;\n\n        varying vec2 v_texCoord;\n\n        void main() {\n            gl_Position = u_matrix * vec4(a_position, 0., 1.);\n\n            v_texCoord = a_texCoord;\n        }\n    ",nnt="\n        precision mediump float;\n\n        uniform sampler2D u_image;\n\n        uniform float u_opacity;\n        uniform float u_debug_line;\n        uniform vec4 u_base_color;\n        uniform float u_alpha_test;\n        varying vec2 v_texCoord;\n\n        void main() {\n            if (u_debug_line == 1.) {\n                gl_FragColor = vec4(0., 1., 0., 1.);\n            } else {\n                gl_FragColor = texture2D(u_image, v_texCoord) * u_opacity;\n            }\n            gl_FragColor *= u_base_color;\n            if (gl_FragColor.a < u_alpha_test) {\n                discard;\n            }\n        }\n    ",int=["",0],rnt=[0,0,0],ont=new Array(16),snt=new $0(20,20),ant=function(t){var e=function(t){function e(){var e=t.apply(this,X0([],Q0(arguments),!1))||this;return e._layerAlt=0,e._layerAltitude=0,e}return W0(e,t),e.prototype.drawGLImage=function(t,e,n,i,r,o,s,a,h){this.gl.program!==this.program&&this.useProgram(this.program);var l=this.gl;if(this.loadTexture(t),this.canvas.gl&&this.canvas.gl.wrap){var u=this.layer&&this.layer.options.opacity;n0(u)&&(u=1),s*=u}rnt[0]=e||0,rnt[1]=n||0,rnt[2]=0;var c=this.layer;if(c){var A=c.options.altitude,f=i0(A);if(f||(this._layerAlt=0),this._layerAltitude!==A&&f){var d=c.getMap();if(d){var p=d.altitudeToPoint(A,d.getGLRes());this._layerAltitude=A,this._layerAlt=p}}}rnt[2]=this._layerAlt||0;var g=z5(ont);k5(g,g,rnt),L5(g,g,[o,o,1]),F5(g,this.getMap().projViewMatrix,g),l.uniformMatrix4fv(this.program.u_matrix,!1,g),l.uniform1f(this.program.u_opacity,s),l.uniform1f(this.program.u_debug_line,0),l.uniform4fv(this.program.u_base_color,h||Ket),l.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0);var m=t.glBuffer;!m||m.width===i&&m.height===r||(this.saveImageBuffer(m),delete t.glBuffer),t.glBuffer?l.bindBuffer(l.ARRAY_BUFFER,m):t.glBuffer=this.bufferTileData(0,0,i,r),int[0]="a_position",int[1]=2,int[2]=t.glBuffer.type,this.enableVertexAttrib(int),l.bindBuffer(l.ARRAY_BUFFER,this.texBuffer),int[0]="a_texCoord",int[1]=2,int[2]="UNSIGNED_BYTE",this.enableVertexAttrib(int),l.drawArrays(l.TRIANGLE_STRIP,0,4),a&&this.drawDebug(g,0,0,i,r,a)},e.prototype.drawDebug=function(t,e,n,i,r,o){var s=this.gl;s.disable(s.DEPTH_TEST),s.bindBuffer(s.ARRAY_BUFFER,this._debugBuffer),this.enableVertexAttrib(["a_position",2,"FLOAT"]),s.bufferData(s.ARRAY_BUFFER,new Float32Array([e,n,e+i,n,e+i,n-r,e,n-r,e,n]),s.DYNAMIC_DRAW),s.uniformMatrix4fv(this.program.u_matrix,!1,t),s.uniform1f(this.program.u_opacity,1),s.uniform1f(this.program.u_debug_line,1),s.uniform4fv(this.program.u_base_color,Ket),s.uniform1f(this.program.u_alpha_test,this.layer.options.alphaTest||0),s.drawArrays(s.LINE_STRIP,0,5);var a=this._debugInfoCanvas;if(!a){var h=this.getMap().getDevicePixelRatio()>1?2:1;(a=this._debugInfoCanvas=document.createElement("canvas")).width=256*h,a.height=32*h;var l=a.getContext("2d");l.font="20px monospace",l.scale(h,h)}var u=a.getContext("2d");u.clearRect(0,0,a.width,a.height),j3.fillText(u,o,snt,this.layer.options.debugOutline),this.loadTexture(a),s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,a);var c=e+(i=256),A=n-r+32,f=n-r;s.bufferData(s.ARRAY_BUFFER,this.set8(e,A,e,f,c,A,c,f),s.DYNAMIC_DRAW),s.uniform1f(this.program.u_debug_line,0),s.bindBuffer(s.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),s.drawArrays(s.TRIANGLE_STRIP,0,4),s.enable(s.DEPTH_TEST)},e.prototype.bufferTileData=function(t,e,n,i,r){var o,s=t,a=t+n,h=e,l=e-i;o=r0(s)&&r0(a)&&r0(h)&&r0(l)?this.set8Int(s,h,s,l,a,h,a,l):this.set8(s,h,s,l,a,h,a,l);var u=this.loadImageBuffer(o,r);return u.width=n,u.height=i,u.type=o instanceof Int16Array?"SHORT":"FLOAT",u},e.prototype.createCanvas2=function(){this.canvas2=j3.createCanvas(this.canvas.width,this.canvas.height)},e.prototype.createGLContext=function(){this.gl=this.canvas.gl&&this.canvas.gl.wrap?this.canvas.gl.wrap():function(t,e){for(var n={alpha:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:!1},i=["webgl","experimental-webgl"],r=null,o=0;o<i.length;++o){try{r=t.getContext(i[o],e||n)}catch(s){}if(r)break}return r}(this.canvas2||this.canvas,this.layer.options.glOptions);var t=this.gl;t.clearColor(0,0,0,0),t.enable(t.DEPTH_TEST),t.enable(t.STENCIL_TEST),t.enable(t.BLEND),t.blendFunc(t.ONE,t.ONE_MINUS_SRC_ALPHA),this.program=this.createProgram(ent,this.layer.options.fragmentShader||nnt),this._debugBuffer=this.createBuffer(),this.useProgram(this.program),this.texBuffer=this.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.texBuffer),this.enableVertexAttrib(["a_texCoord",2,"UNSIGNED_BYTE"]),t.bufferData(t.ARRAY_BUFFER,new Uint8Array([0,0,0,1,1,0,1,1]),t.STATIC_DRAW),this.enableSampler("u_image"),t.activeTexture(t.TEXTURE0),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0)},e.prototype.resizeGLCanvas=function(){this.gl&&this.gl.viewport(0,0,this.canvas.width,this.canvas.height),this.canvas2&&(this.canvas2.width===this.canvas.width&&this.canvas2.height===this.canvas.height||(this.canvas2.width=this.canvas.width,this.canvas2.height=this.canvas.height))},e.prototype.clearGLCanvas=function(){this.gl&&(this.gl.clearStencil(255),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.STENCIL_BUFFER_BIT)),this.gl.wrap||this.gl.clear(this.gl.DEPTH_BUFFER_BIT)},e.prototype.disposeImage=function(t){t&&(t.texture&&this.saveTexture(t.texture),t.glBuffer&&this.saveImageBuffer(t.glBuffer),delete t.texture,delete t.glBuffer)},e.prototype._createTexture=function(t){var e=this.gl,n=this.getTexture()||e.createTexture();e.bindTexture(e.TEXTURE_2D,n),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE);var i=this.layer.options.mipmapTexture;return!i||hnt(t.width)&&hnt(t.height)||(t=function(t){if(hnt(t.width)&&hnt(t.height))return t;var e=t.width,n=t.height;hnt(e)||(e=lnt(e)),hnt(n)||(n=lnt(n));var i=document.createElement("canvas");i.width=e,i.height=n;var r=i.getContext("2d");return r.imageSmoothingEnabled=!1,r.drawImage(t,0,0,e,n),i}(t)),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,t),i&&e.generateMipmap(e.TEXTURE_2D),n},e.prototype.getTexture=function(){this._textures||(this._textures=[]);var t=this._textures;return t&&t.length>0?t.pop():null},e.prototype.saveTexture=function(t){this._textures.push(t)},e.prototype.loadTexture=function(t){var e=this.getMap(),n=this.gl,i=t.texture;return i||(i=this._createTexture(t),t.texture=i),n.bindTexture(n.TEXTURE_2D,i),this.layer.options.mipmapTexture&&(e.isMoving()&&e.getRenderer().isViewChanged()?n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR_MIPMAP_LINEAR):n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.LINEAR)),i},e.prototype.getImageBuffer=function(){this._imageBuffers||(this._imageBuffers=[]);var t=this._imageBuffers;return t&&t.length>0?t.pop():null},e.prototype.saveImageBuffer=function(t){this._imageBuffers||(this._imageBuffers=[]),this._imageBuffers.push(t)},e.prototype.loadImageBuffer=function(t,e){var n=this.gl,i=e||this.createImageBuffer();return n.bindBuffer(n.ARRAY_BUFFER,i),n.bufferData(n.ARRAY_BUFFER,t,n.STATIC_DRAW),i},e.prototype.createImageBuffer=function(){return this.getImageBuffer()||this.createBuffer()},e.prototype.removeGLCanvas=function(){var t=this.gl;if(t){if(this._debugBuffer&&(t.deleteBuffer(this._debugBuffer),delete this._debugBuffer),this._buffers&&(this._buffers.forEach((function(e){t.deleteBuffer(e)})),delete this._buffers),this._textures&&(this._textures.forEach((function(e){return t.deleteTexture(e)})),delete this._textures),this._debugInfoCanvas){var e=this._debugInfoCanvas.texture;e&&t.deleteTexture(e),delete this._debugInfoCanvas.texture,delete this._debugInfoCanvas}var n=t.program;t.deleteShader(n.fragmentShader),t.deleteShader(n.vertexShader),t.deleteProgram(n),delete this.gl,delete this.canvas2}},e.prototype.createBuffer=function(){var t=this.gl.createBuffer();if(!t)throw new Error("Failed to create the buffer object");return this._buffers||(this._buffers=[]),this._buffers.push(t),t},e.prototype.enableVertexAttrib=function(t){Yet(this.gl,this.gl.program,t)},e.prototype.createProgram=function(t,e){for(var n=this.gl,i=Xet(n,t,e),r=i.program,o=i.vertexShader,s=i.fragmentShader,a=n.getProgramParameter(r,35718),h=[],l=0;l<a;++l){var u=n.getActiveUniform(r,l);h.push(u.name)}return r.vertexShader=o,r.fragmentShader=s,this._initUniforms(r,h),r},e.prototype.useProgram=function(t){var e=this.gl;return e.useProgram(t),e.program=t,this},e.prototype.enableSampler=function(t,e){var n=this.gl,i=this._getUniform(n.program,t);return e||(e=0),n.uniform1i(i,e),i},e.prototype._initUniforms=function(t,e){for(var n=0;n<e.length;n++){var i=e[n],r=e[n],o=i.indexOf("[");o>=0&&(i=i.substring(0,o),K$||(r=r.substring(0,o))),t[i]=this._getUniform(t,r)}},e.prototype._getUniform=function(t,e){var n=this.gl.getUniformLocation(t,e);if(!n)throw new Error("Failed to get the storage location of "+e);return n},e.prototype.set8=function(t,e,n,i,r,o,s,a){var h=$et;return h[0]=t,h[1]=e,h[2]=n,h[3]=i,h[4]=r,h[5]=o,h[6]=s,h[7]=a,h},e.prototype.set8Int=function(t,e,n,i,r,o,s,a){var h=tnt;return h[0]=t,h[1]=e,h[2]=n,h[3]=i,h[4]=r,h[5]=o,h[6]=s,h[7]=a,h},e}(t);return e};function hnt(t){return!(t&t-1)&&0!==t}function lnt(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}var unt={renderer:G0.webgl?"gl":"canvas",crossOrigin:null,alphaTest:!1,depthMask:!0,depthFunc:"<="},cnt=new $0(0,0),Ant=function(t){function e(e,n,i){var r=this;return!n||Array.isArray(n)||n.url||(i=n,n=null),(r=t.call(this,e,i)||this)._images=n,r}return W0(e,t),e.prototype.onAdd=function(){this._prepareImages(this._images)},e.prototype.setImages=function(t){return this._images=t,this._prepareImages(t),this},e.prototype.getImages=function(){return this._images},e.prototype._prepareImages=function(t){t=t||[],Array.isArray(t)||(t=[t]);var e=this.getMap(),n=e.getGLRes();this._imageData=t.map((function(t){var i=new X4(t.extent);return e0({},t,{extent:i,extent2d:i.convertTo((function(t){return e.coordToPointAtRes(t,n)}))})})),this._images=t;var i=this.getRenderer();i&&i.refreshImages()},e.prototype.getRenderer=function(){return t.prototype.getRenderer.call(this)},e}(k9);Ant.mergeOptions(unt);var fnt,dnt=[],pnt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("ImageLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),!1)},e.prototype.checkResources=function(){var t=this;if(this._imageLoaded)return dnt;var e=this.layer._imageData.map((function(t){return[t.url,null,null]}));if(this.resources){var n=[],i=new Q8;e.forEach((function(e){if(t.resources.isResourceLoaded(e)){var r=t.resources.getImage(e);i.addResource(e,r)}else n.push(e)})),this.resources.forEach((function(e,n){i.isResourceLoaded(e)||t.retireImage(n.image)})),this.resources=i,e=n}return this._imageLoaded=!0,e},e.prototype.retireImage=function(t){t.close&&t.close()},e.prototype.refreshImages=function(){this._imageLoaded=!1,this.setToRedraw()},e.prototype.draw=function(t,e){this.isDrawable()&&(this.prepareCanvas(),this._painted=!1,this._drawImages(t,e),this.completeRender())},e.prototype._drawImages=function(t,e){var n=this.layer._imageData,i=this.getMap(),r=i.get2DExtentAtRes(i.getGLRes());if(n&&n.length)for(var o=0;o<n.length;o++){var s=n[o].extent2d,a=this.resources&&this.resources.getImage(n[o].url);a&&r.intersects(s)&&(this._painted=!0,this._drawImage(a,s,n[o].opacity||1))}},e.prototype._drawImage=function(t,e,n){var i=0,r=this.context;n<1&&(i=r.globalAlpha,r.globalAlpha=n);var o=this.getMap(),s=cnt.set(e.xmin,e.ymax),a=o._pointAtResToContainerPoint(s,o.getGLRes()),h=a.x,l=a.y,u=o.getBearing();u&&(r.save(),r.translate(h,l),u&&r.rotate(-u*Math.PI/180),h=l=0);var c=o.getGLScale();r.drawImage(t,h,l,e.getWidth()/c,e.getHeight()/c),u&&r.restore(),i&&(r.globalAlpha=i)},e.prototype.drawOnInteracting=function(t,e,n){this.draw()},e}(Z8),gnt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.drawOnInteracting=function(t,e,n){this.draw(e,n)},e.prototype._prepareGLContext=function(){var t,e=this.gl;e&&(e.disable(e.STENCIL_TEST),e.disable(e.POLYGON_OFFSET_FILL),e.enable(e.DEPTH_TEST),e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.depthFunc((t=this.layer.options.depthFunc,Jet[t])),e.depthMask(!!this.layer.options.depthMask))},e.prototype._drawImages=function(e,n){var i,r=this.gl;if(n&&n.renderTarget&&(i=n.renderTarget.fbo)){var o=n.renderTarget.getFramebuffer(i);r.bindFramebuffer(r.FRAMEBUFFER,o)}this._prepareGLContext(),t.prototype._drawImages.call(this),n&&n.renderTarget&&(i=n.renderTarget.fbo)&&r.bindFramebuffer(r.FRAMEBUFFER,null)},e.prototype.isDrawable=function(){return!0},e.prototype._drawImage=function(t,e,n){this.drawGLImage(t,e.xmin,e.ymax,e.getWidth(),e.getHeight(),1,n)},e.prototype.createContext=function(){this.createGLContext()},e.prototype.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},e.prototype.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},e.prototype.retireImage=function(t){t.close&&t.close(),this.disposeImage(t)},e.prototype.onRemove=function(){this.removeGLCanvas(),t.prototype.onRemove.call(this)},e}(ant(pnt));Ant.registerRenderer("canvas",pnt),Ant.registerRenderer("gl",gnt),function(t){t[t.never=0]="never",t[t["<"]=1]="<",t[t["="]=2]="=",t[t["<="]=3]="<=",t[t[" >"]=4]=" >",t[t["!="]=5]="!=",t[t[">="]=6]=">=",t[t.always=7]="always"}(fnt||(fnt={}));var mnt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.getPrepareParams=function(){return[]},e.prototype.getDrawParams=function(){return[]},e.prototype.onCanvasCreate=function(){this.canvas&&this.layer.options.doubleBuffer&&(this.buffer=j3.createCanvas(this.canvas.width,this.canvas.height,this.getMap().CanvasClass))},e.prototype.needToRedraw=function(){return!!this.layer.options.animation||!(this.getMap().isInteracting()&&!this.layer.drawOnInteracting)&&t.prototype.needToRedraw.call(this)},e.prototype.draw=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this.prepareCanvas(),this.prepareDrawContext(),this._drawLayer.apply(this,X0([],Q0(t),!1))},e.prototype.drawOnInteracting=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._drawLayerOnInteracting.apply(this,X0([],Q0(t),!1))},e.prototype.getCanvasImage=function(){var e=t.prototype.getCanvasImage.call(this);if(e&&e.image&&this.layer.options.doubleBuffer){var n=e.image;this.buffer.width===n.width&&this.buffer.height===n.height||(this.buffer.width=n.width,this.buffer.height=n.height);var i=this.buffer.getContext("2d"),r=this.layer.doubleBuffer(i,this.context);(void 0===r||r)&&(j3.image(i,n,0,0),e.image=this.buffer)}return e},e.prototype.remove=function(){return delete this._drawContext,t.prototype.remove.call(this)},e.prototype.onZoomStart=function(e){this.layer.onZoomStart(e),t.prototype.onZoomStart.call(this,e)},e.prototype.onZooming=function(e){this.layer.onZooming(e),t.prototype.onZooming.call(this,e)},e.prototype.onZoomEnd=function(e){this.layer.onZoomEnd(e),t.prototype.onZoomEnd.call(this,e)},e.prototype.onMoveStart=function(e){this.layer.onMoveStart(e),t.prototype.onMoveStart.call(this,e)},e.prototype.onMoving=function(e){this.layer.onMoving(e),t.prototype.onMoving.call(this,e)},e.prototype.onMoveEnd=function(e){this.layer.onMoveEnd(e),t.prototype.onMoveEnd.call(this,e)},e.prototype.onResize=function(e){this.layer.onResize(e),t.prototype.onResize.call(this,e)},e.prototype.prepareDrawContext=function(){var t;if(!this._predrawed){var e=ynt(this.getPrepareParams());this._drawContext=(t=this.layer).prepareToDraw.apply(t,X0([this.context],Q0(e),!1)),this._drawContext||(this._drawContext=[]),Array.isArray(this._drawContext)||(this._drawContext=[this._drawContext]),this._predrawed=!0}},e.prototype._prepareDrawParams=function(){if(!this.getMap())return null;var t=this.getViewExtent();if(t.maskExtent&&!t.extent.intersects(t.maskExtent))return this.completeRender(),null;var e=[this.context,t],n=ynt(this.getDrawParams());return X0(X0(X0([],Q0(e),!1),Q0(n),!1),Q0(this._drawContext),!1)},e.prototype._drawLayer=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._prepareDrawParams();n&&(this.layer.draw.apply(this.layer,n.concat(t)),this.completeRender())},e.prototype._drawLayerOnInteracting=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(this.layer.drawOnInteracting){var i=this._prepareDrawParams();i&&((t=this.layer).drawOnInteracting.apply(t,X0(X0([],Q0(i),!1),Q0(e),!1)),this.completeRender())}},e}(Z8);function ynt(t){return t||(t=[]),Array.isArray(t)||(t=[t]),t}var vnt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.isCanvasRender=function(){return!0},e.prototype.prepareToDraw=function(){},e.prototype.draw=function(){},e.prototype.redraw=function(){return this._getRenderer()&&this._getRenderer().setToRedraw(),this},e.prototype.play=function(){return this.config("animation",!0),this},e.prototype.pause=function(){return this.config("animation",!1),this},e.prototype.isPlaying=function(){return this.options.animation},e.prototype.clearCanvas=function(){return this._getRenderer()&&this._getRenderer().clearCanvas(),this},e.prototype.requestMapToRender=function(){var t=this._getRenderer();return t&&t.requestMapToRender&&t.requestMapToRender(),this},e.prototype.completeRender=function(){return this._getRenderer()&&this._getRenderer().completeRender(),this},e.prototype.onCanvasCreate=function(){return this},e.prototype.onZoomStart=function(){},e.prototype.onZooming=function(){},e.prototype.onZoomEnd=function(){},e.prototype.onMoveStart=function(){},e.prototype.onMoving=function(){},e.prototype.onMoveEnd=function(){},e.prototype.onResize=function(){},e.prototype.doubleBuffer=function(t){return t.clearRect(0,0,t.canvas.width,t.canvas.height),this},e.prototype._getRenderer=function(){return t.prototype._getRenderer.call(this)},e}(k9);vnt.mergeOptions({doubleBuffer:!1,animation:!1}),vnt.registerRenderer("canvas",mnt);var _nt=new $0(0,0),xnt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.getParticles=function(t){},e.prototype.draw=function(t,e){var n=this.getParticles(t0());if(n&&0!==n.length){var i=this.getMap(),r=e.extent;e.maskExtent&&(r=e.extent.intersection(e.maskExtent)),r=r.convertTo((function(t){return i._pointToContainerPoint(t,void 0,0,_nt)}));for(var o=2*Math.PI,s=0,a=n.length;s<a;s++){var h=n[s].point;if(r.contains(h)){var l=n[s].color||this.options.lineColor||"#fff",u=n[s].r;t.fillStyle!==l&&(t.fillStyle=l),u<=2?t.fillRect(h.x-u/2,h.y-u/2,u,u):(t.beginPath(),t.arc(h.x,h.y,u/2,0,o),t.fill())}}this._fillCanvas(t)}else this._getRenderer()&&(this._getRenderer()._shouldClear=!0)},e.prototype._fillCanvas=function(t){var e=t.globalCompositeOperation;t.globalCompositeOperation="destination-out",t.fillStyle="rgba(0, 0, 0, "+1/(this.options.trail||30)+")",t.fillRect(0,0,t.canvas.width,t.canvas.height),t.globalCompositeOperation=e},e}(vnt);xnt.mergeOptions({animation:!0}),xnt.registerRenderer("canvas",function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.draw=function(){this.canvas&&this.layer.options.animation&&!this._shouldClear||(this.prepareCanvas(),this._shouldClear=!1),this.prepareDrawContext(),this._drawLayer()},e.prototype.drawOnInteracting=function(){this.draw(),this._shouldClear=!1},e.prototype.onSkipDrawOnInteracting=function(){this._shouldClear=!0},e}(mnt));var bnt,wnt,Cnt=new Q8,Pnt=function(t){function e(e,n,i){var r=t.call(this,i)||this;r.target=e,e.once("remove",r.delete,r);var o=r.options.symbol,s=o.markerLineWidth||1;return r.w=o.markerWidth+s,r.h=o.markerHeight+s,r.opacity=n0(o.opacity)?1:o.opacity,r.map=n,r.events=i.events,r._fetchImage(),r.addTo(n),r}return W0(e,t),e.prototype.getCursor=function(){return this.options.cursor||"default"},e.prototype._fetchImage=function(){var t=this.map,e=this.options.symbol,n=e.markerFile;this.url=n||M5(e);var i=Cnt.getImage(this.url);if(!i){var r=this.w,o=this.h;if(n)(i=new Image).onload=function(){var e=t.getRenderer();e&&e.setToRedraw()},i.src=this.url;else{var s=document.createElement("canvas");s.width=r,s.height=o,i=I6(s.getContext("2d"),{x:r/2,y:o/2},e,Cnt)}Cnt.addResource([this.url,r,o],i)}Cnt.login(this.url),this._img=i},e.prototype.setContainerPoint=function(t){this._point=t,this._point._sub(this.w/2,this.h/2)},e.prototype.getContainerPoint=function(){return this._point.add(this.w/2,this.h/2)},e.prototype.offset=function(t){this._point._add(t)},e.prototype.render=function(t){if(!this._img)return!1;var e=this.options.symbol,n=e.markerDx||0,i=e.markerDy||0,r=this.map,o=this._point,s=o.x,a=o.y,h=this.w,l=this.h;if(s+h>0&&s<r.width&&a+l>0&&a<r.height){var u=r.getDevicePixelRatio();return t.globalAlpha=this.opacity,t.drawImage(this._img,Math.round((s+n)*u),Math.round((a+i)*u),Math.round(h*u),Math.round(l*u)),!0}return!1},e.prototype.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}Cnt.logout(this.url),this._dragger&&(this._dragger.disable(),delete this._dragger),delete this.map},e.prototype.hitTest=function(t){var e=this.options.symbol,n=this._point.x+(e.markerDx||0),i=this._point.y+(e.markerDy||0);return t.x>=n&&t.x<=n+this.w&&t.y>=i&&t.y<=i+this.h},e.prototype.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},e.prototype.onEvent=function(t){this.fire(t.type,t)},e.prototype.mousedown=function(t){var e=this.options.cursor;e&&t.target.setCursor(e),this.onDragstart(t)},e.prototype.onDragstart=function(t){var e=t.containerPoint,n=t.target,i=n.getPanels().mapWrapper||n.getContainer(),r=this._dragger=new L4(i);r.on("dragging",this.onDragging,this).on("mouseup",this.onDragend,this).enable(),r.onMouseDown(t.domEvent),bnt=e.x,wnt=e.y,this.fire("dragstart",{containerPoint:e})},e.prototype.onDragging=function(t){if(this._dragger){var e=this.map,n=m2(t.domEvent,e.getContainer()),i={x:n.x-bnt,y:n.y-wnt},r=e.containerPointToCoord(new $0(bnt,wnt)),o=e.containerPointToCoord(n);bnt=n.x,wnt=n.y,this.offset(i),this.fire("dragging",{containerPoint:n,coordOffset:o._sub(r)})}},e.prototype.onDragend=function(t){if(this._dragger){var e=this.map;e.resetCursor();var n=m2(t.domEvent,e.getContainer());this.offset({x:n.x-bnt,y:n.y-wnt}),this._dragger.disable(),delete this._dragger,this.fire("dragend",{containerPoint:n})}},e.prototype.needCollision=function(){var t=this.target;return t&&t.options&&t.options.collision},e.prototype.getRenderBBOX=function(t){var e=this.target,n=this.map;if(!e||!e.options||!n)return null;var i=this.options.symbol,r=i.markerDx||0,o=i.markerDy||0,s=this._point,a=s.x,h=s.y,l=this.w,u=this.h;t=t||n.getDevicePixelRatio(),this.bbox=this.bbox||Y5();var c=Math.round((a+r)*t),A=Math.round((h+o)*t),f=Math.round(l*t),d=Math.round(u*t);return this.bbox[0]=c,this.bbox[1]=A,this.bbox[2]=c+f,this.bbox[3]=A+d,n3(this.bbox,e.options.collisionBufferSize||0),this.bbox},e.prototype.setZIndex=function(t){this.options.zIndex=t},e}(Q3(Y3)),Mnt=function(){function t(t,e,n){this.target=t,t.once("remove",this.delete,this),this.map=e,this.options=n,this.addTo(e)}return t.prototype.setPoints=function(t){this.points=t;var e=t.map((function(t){return t.x})),n=t.map((function(t){return t.y}));this.xmin=Math.min.apply(Math,X0([],Q0(e),!1)),this.xmax=Math.max.apply(Math,X0([],Q0(e),!1)),this.ymin=Math.min.apply(Math,X0([],Q0(n),!1)),this.ymax=Math.max.apply(Math,X0([],Q0(n),!1))},t.prototype.hitTest=function(){return!1},t.prototype.render=function(t){var e=this.map;if(!(this.xmax<=0||this.xmin>=e.width||this.ymax<=0||this.ymin>=e.height)){var n=e.getDevicePixelRatio();t.lineWidth=1,t.strokeStyle="#000",t.globalAlpha=1,t.beginPath();var i=this.points;t.moveTo(o(i[0].x),o(i[0].y));for(var r=1;r<this.points.length;r++)t.lineTo(o(i[r].x),o(i[r].y));t.closePath(),t.stroke()}function o(t){return Math.round(t)*n+.5}},t.prototype.addTo=function(t){this.map=t,t.getRenderer().addTopElement(this)},t.prototype.delete=function(){if(this.map){var t=this.map.getRenderer();t&&t.removeTopElement(this)}},t}(),Tnt=E1+"_edit_stage_";function Snt(t,e){return{markerType:t,markerFill:"#fff",markerLineColor:"#000",markerLineWidth:2,markerWidth:10,markerHeight:10,opacity:e}}var Int={fixAspectRatio:!1,symbol:null,removeVertexOn:"contextmenu",centerHandleSymbol:Snt("ellipse",1),vertexHandleSymbol:Snt("square",1),newVertexHandleSymbol:Snt("square",.4),collision:!1,collisionBufferSize:0,vertexZIndex:0,newVertexZIndex:0},Ent=function(t){function e(e,n){var i=t.call(this,n)||this;return i._geometry=e,i}return W0(e,t),e.prototype.getMap=function(){return this._geometry.getMap()},e.prototype.prepare=function(){var t=this.getMap();t&&(t.on("drawtopstart",this._refresh,this),this.options.symbol&&(this._originalSymbol=this._geometry.getSymbol(),this._geometry.setSymbol(this.options.symbol)),this._prepareEditStageLayer())},e.prototype._prepareEditStageLayer=function(){var t=this._geometry.getLayer();if("canvas"===t.options.renderer){var e=this.getMap(),n=i1(),i=Tnt+n+"_shadow";this._shadowLayer=e.getLayer(i),this._shadowLayer||(this._shadowLayer=new t.constructor(i),e.addLayer(this._shadowLayer))}},e.prototype.start=function(){if(this._geometry&&this._geometry.getMap()&&!this._geometry.editing){this.editing=!0,this.prepare();var t,e=this._geometry,n="canvas"===this._geometry.getLayer().options.renderer;this._geometryDraggble=e.options.draggable,n?(e.config("draggable",!1),(t=e.copy()).setSymbol(e._getInternalSymbol()),t.copyEventListeners(e),e._getParent()&&t.copyEventListeners(e._getParent()),t._setEventTarget(e),t.setId(null).config({draggable:!1}),this._shadow=t,e.hide()):e instanceof A7&&e.config("draggable",!0),this._switchGeometryEvents("on"),(e instanceof A7||e instanceof I7||e instanceof R7||e instanceof O7)&&this._createOrRefreshOutline(),this._shadowLayer&&this._shadowLayer.bringToFront().addGeometry(t),e instanceof A7?t&&(t.config("draggable",!0),t.on("dragend",this._onMarkerDragEnd,this)):this._createCenterHandle(),e instanceof A7&&!1!==this.options.resize?this.createMarkerEditor():e instanceof I7?this.createCircleEditor():e instanceof R7||e instanceof O7?this.createEllipseOrRectEditor():e instanceof D7||(e instanceof l7||e instanceof d7)&&this.createPolygonEditor()}},e.prototype.stop=function(){delete this._history,delete this._historyPointer,delete this._editOutline,this._switchGeometryEvents("off"),this.getMap()?(this._geometry.config("draggable",this._geometryDraggble),this._shadow&&(delete this._shadow,delete this._geometryDraggble,this._geometry.show()),this._shadowLayer&&(this._shadowLayer.remove(),delete this._shadowLayer),this._refreshHooks=[],this.options.symbol&&(this._geometry.setSymbol(this._originalSymbol),delete this._originalSymbol),this.editing=!1,this.fire("remove")):this.fire("remove")},e.prototype.isEditing=function(){return!n0(this.editing)&&this.editing},e.prototype._getGeometryEvents=function(){return{symbolchange:this._onGeoSymbolChange,dragstart:this._onDragStart,dragend:this._onDragEnd,"positionchange shapechange":this._exeAndReset}},e.prototype._switchGeometryEvents=function(t){if(this._geometry){var e=this._getGeometryEvents();for(var n in e)this._geometry[t](n,e[n],this)}},e.prototype._onGeoSymbolChange=function(t){this._shadow&&this._shadow.setSymbol(t.target._getInternalSymbol())},e.prototype._onMarkerDragEnd=function(){this._update("setCoordinates",this._shadow.getCoordinates().toArray())},e.prototype._createOrRefreshOutline=function(){var t=this._geometry,e=this._editOutline;e||(this._editOutline=new Mnt(this,this.getMap()),this._addRefreshHook(this._createOrRefreshOutline));var n=this._editOutline.points;if(t instanceof A7)this._editOutline.setPoints(t.getContainerExtent().toArray(n));else{var i=this.getMap();(n=t._getPrjExtent().toArray(n)).forEach((function(t){return i.prjToContainerPoint(t,null,t)})),this._editOutline.setPoints(n)}return e},e.prototype._createCenterHandle=function(){var t,e=this,n=this.getMap(),i=this.options.centerHandleSymbol,r=n.coordToContainerPoint(this._geometry.getCenter()),o=this.createHandle(r,{symbol:i,cursor:"move",onDown:function(){if(e._shadow){var n=T5((t=e._shadow.copy())._getInternalSymbol(),.5);t.setSymbol(n).addTo(e._geometry.getLayer())}},onMove:function(n){var i=n.coordOffset;t?t.translate(i):e._geometry.translate(i)},onUp:function(){if(t){var n=t.getFirstCoordinate(),i=e._geometry.getFirstCoordinate(),r=n.sub(i);e._update("translate",r),t.remove()}}});this._addRefreshHook((function(){var t=e._geometry.getCenter();o.setContainerPoint(n.coordToContainerPoint(t))}))},e.prototype._createHandleInstance=function(t,e){var n=this.getMap(),i=t5(e.symbol,(function(){return[n.getZoom(),{"{bearing}":n.getBearing(),"{pitch}":n.getPitch(),"{zoom}":n.getZoom()}]})),r=new Pnt(this,n,{symbol:i,cursor:e.cursor,events:this.options.removeVertexOn});return r.setContainerPoint(t),r},e.prototype.createHandle=function(t,e){e||(e={});var n=this._createHandleInstance(t,e),i=this;return n.on("dragstart",(function(t){return this._updating=!0,e.onDown&&(e.onDown.call(i,t.containerPoint,t),this._geometry.fire("handledragstart")),!1}),this),n.on("dragging",(function(t){return i._hideContext(),e.onMove&&(e.onMove.call(i,t),this._geometry.fire("handledragging")),!1}),this),n.on("dragend",(function(t){return e.onUp&&(e.onUp.call(i,t),this._geometry.fire("handledragend")),this._updating=!1,!1}),this),e.onRefresh&&(n.refresh=e.onRefresh),n},e.prototype._createResizeHandles=function(t,e,n){var i=this,r=["nw-resize","n-resize","ne-resize","w-resize","e-resize","sw-resize","s-resize","se-resize"],o=[null,"y",null,"x","x",null,"y",null],s=this._geometry,a=s instanceof A7;t||(t=[]);var h=this,l=[],u={},c=this.getMap(),A=this.options.vertexHandleSymbol,f=function(){for(var f=function(){if(a){var t=s.getContainerExtent();return[new $0(t.xmin,t.ymin),new $0((t.xmax+t.xmin)/2,t.ymin),new $0(t.xmax,t.ymin),new $0(t.xmin,(t.ymin+t.ymax)/2),new $0(t.xmax,(t.ymin+t.ymax)/2),new $0(t.xmin,t.ymax),new $0((t.xmax+t.xmin)/2,t.ymax),new $0(t.xmax,t.ymax)]}var e=s._getPrjExtent();return[new $0(e.xmin,e.ymax),new $0((e.xmax+e.xmin)/2,e.ymax),new $0(e.xmax,e.ymax),new $0(e.xmin,(e.ymax+e.ymin)/2),new $0(e.xmax,(e.ymax+e.ymin)/2),new $0(e.xmin,e.ymin),new $0((e.xmax+e.xmin)/2,e.ymin),new $0(e.xmax,e.ymin)]}(),d=function(d){if(Array.isArray(t)&&t.some((function(t){return t===d})))return"continue";var p,g=f[d],m=a?g:c.prjToContainerPoint(g);if(l.length<f.length-t.length){var y=i.createHandle(m,{symbol:A,cursor:r[d],axis:o[d],onMove:(p=d,function(t){h._updating=!0,e(t.containerPoint,p),s.fire("resizing")}),onUp:function(){h._updating=!1,n()}});u[d]=l.length,l.push(y)}else l[u[d]].setContainerPoint(m)},p=0;p<f.length;p++)d(p)};return f(),this._addRefreshHook(f),l},e.prototype.createMarkerEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();if(e._canEdit()){this._history||this._recordHistory(f());var i=e._getInternalSymbol(),r=new $0(0,0);i0(i.markerDx)&&(r.x=i.markerDx),i0(i.markerDy)&&(r.y=i.markerDy);var o=null,s="middle",a="middle";if(Y6.test(i)){var h=i.markerType;"pin"===h||"pie"===h||"bar"===h?(o=[5,6,7],s="bottom"):"rectangle"===h&&(o=[0,1,2,3,5],s="top",a="left")}else(j6.test(i)||J6.test(i))&&(s="bottom",o=[5,6,7]);var l,u=[2,1,2,0,0,2,1,2];if(this.options.fixAspectRatio){var c=e.getSize();l=c.width/c.height}var A=this._createResizeHandles(o,(function(i,h){if(o&&o.indexOf(h)>=0){var c=n.containerPointToCoordinate(i.sub(r)),f=e.getCoordinates();c.x=f.x,e.setCoordinates(c),t._updateCoordFromShadow(!0),i=A[A.length-1-h].getContainerPoint()}var d=n.coordToContainerPoint(e.getCoordinates()).add(r),p=e._getInternalSymbol(),g=i.sub(d);"bottom"===s&&i.y>d.y&&(g.y=0);var m="middle"===s?2:1,y="left"===a?1:2,v=Math.abs(g.x)*y,_=Math.abs(g.y)*m;l&&(_=(v=Math.max(v,_*l))/l);var x=u[h];e instanceof j7?((l||0===x||2===x)&&(e.setWidth(v),e!==t._geometry&&t._geometry.setWidth(v)),(l||1===x||2===x)&&(e.setHeight(_),e!==t._geometry&&t._geometry.setHeight(_))):((l||0===x||2===x)&&(p.markerWidth=Math.min(v,t._geometry.options.maxMarkerWidth||1/0)),(l||1===x||2===x)&&(p.markerHeight=Math.min(_,t._geometry.options.maxMarkerHeight||1/0)),e.setSymbol(p),e!==t._geometry&&t._geometry.setSymbol(p))}),(function(){t._update(f())}))}else console&&console.warn("A marker can't be resized with symbol:",e.getSymbol());function f(){var t=[["setCoordinates",e.getCoordinates().toArray()]];return e instanceof j7?(t.push(["setWidth",e.getWidth()]),t.push(["setHeight",e.getHeight()])):t.push(["setSymbol",e.getSymbol()]),t}},e.prototype.createCircleEditor=function(){var t=this,e=this._shadow||this._geometry,n=this.getMap();this._history||this._recordHistory([["setCoordinates",e.getCoordinates().toArray()],["setRadius",e.getRadius()]]),this._createResizeHandles(null,(function(i){var r=e.getCenter(),o=n.containerPointToCoord(i),s=new d7([[r.x,r.y],[o.x,r.y]]),a=new d7([[r.x,r.y],[r.x,o.y]]),h=Math.max(n.computeGeometryLength(s),n.computeGeometryLength(a));e.setRadius(h),e!==t._geometry&&t._geometry.setRadius(h)}),(function(){t._update("setRadius",e.getRadius())}))},e.prototype.createEllipseOrRectEditor=function(){var t=this,e=[2,1,2,0,0,2,1,2],n=this._shadow||this._geometry;this._history||this._recordHistory(a());var i,r=this.getMap(),o=this._geometry instanceof R7;this.options.fixAspectRatio&&(i=n.getWidth()/n.getHeight());var s=this._createResizeHandles(null,(function(a,h){var l,u,c,A=o?1:2,f=s[h].getContainerPoint(),d=e[h];if(o){var p=s[7-h].getContainerPoint(),g=(l=f.sub(p)).abs();u=r.pixelToDistance(g.x,0),c=r.pixelToDistance(0,g.y);var m=n.getSize(),y=n.getCoordinates(),v=n.getWidth(),_=n.getHeight(),x=r.containerPointToCoord(a),b=r.containerPointToCoord(p),w=new d7([[b.x,b.y],[x.x,b.y]]),C=new d7([[b.x,b.y],[b.x,x.y]]);if(u=r.computeGeometryLength(w),c=r.computeGeometryLength(C),0===d)if(i&&(g.y=g.x/i,m.height=Math.abs(g.y),c=u/i),f.y=p.y-m.height/2,x.y=y.y,4===h)x.x=Math.min(x.x,y.x);else{var P=r.locate(y,v,0);x.x=r.locate(new F4(P.x,x.y),-u,0).x}else 1===d?(i&&(g.x=g.y*i,m.width=Math.abs(g.x),u=c*i),f.x=p.x-m.width/2,x.x=y.x,x.y=Math.max(x.y,b.y)):(i&&(u>c*i?(c=u/i,f.y=p.y+g.x*u1(l.y)/i):(u=c*i,f.x=p.x+g.y*u1(l.x)*i)),0===h||5===h?(P=r.locate(y,v,0===h?0:-_),x.x=r.locate(new F4(P.x,x.y),-u,0).x):x.x=Math.min(x.x,b.x),x.y=Math.max(x.y,b.y));n.setCoordinates(x),t._updateCoordFromShadow(!0)}else{var M=n.getCenter();x=r.containerPointToCoord(f),w=new d7([[M.x,M.y],[x.x,M.y]]),C=new d7([[M.x,M.y],[M.x,x.y]]),u=r.computeGeometryLength(w),c=r.computeGeometryLength(C),i&&(c=(u=Math.max(u,c*i))/i)}(i||0===d||2===d)&&(n.setWidth(u*A),n!==t._geometry&&t._geometry.setWidth(u*A)),(i||1===d||2===d)&&(n.setHeight(c*A),n!==t._geometry&&t._geometry.setHeight(c*A))}),(function(){t._update(a())}));function a(){return[["setCoordinates",n.getCoordinates().toArray()],["setWidth",n.getWidth()],["setHeight",n.getHeight()]]}},e.prototype.createPolygonEditor=function(){var t=this.getMap(),e=this._shadow||this._geometry,n=this;this._history||this._recordHistory("setCoordinates",F4.toNumberArrays(e.getCoordinates()));var i=e instanceof l7?3:2,r="maptalks--editor-vertex-index",o=this.options,s=o.vertexZIndex,a=o.newVertexZIndex,h={0:[]},l={0:[]};function u(t){if(void 0===t&&(t=0),e instanceof l7){var n=e.getCoordinates()[t]||[];return n.slice(0,n.length-1)}return e.getCoordinates()}function c(t){return void 0===t&&(t=0),0===t?e._getPrjCoordinates():e._getPrjHoles()[t-1]}function A(){for(var t in h){for(var e=h[t].length-1;e>=0;e--)h[t][e][r]=e;for(e=l[t].length-1;e>=0;e--)l[t][e][r]=e}n._updateCoordFromShadow()}function f(o){n._updating=!0;var s=o.target,a=s[r],u=i0(s._ringIndex)?s._ringIndex:0,f=c(u);if(!(f.length<=i)){var d,p=e instanceof d7&&(0===a||a===f.length-1);if(f.splice(a,1),u>0?e._prjHoles[u-1]=f:e._setPrjCoordinates(f),e._updateCache(),h[u].splice(a,1)[0].delete(),a<l[u].length&&l[u].splice(a,1)[0].delete(),l[u].splice(d=0===a?l[u].length-1:a-1,1)[0].delete(),p||l[u].splice(d,0,v.call(n,d,u)),u>0){var g=e.getCoordinates(),m=g[u];m&&Array.isArray(m)&&m.length>1&&(m.splice(a,1),e!==this._geometry&&e.setCoordinates(g))}A(),n._updating=!1,n._geometry.fire("handleremove",Object.assign({},o,{coordinate:t.containerPointToCoordinate(o.containerPoint),vertex:o.target}))}}function d(i,r,o){void 0===o&&(o=0);var s=n._geometry.snapTo;s&&a0(s)&&(i=n._geometry.snapTo(i)||i);var a,h=c(o),u=t._containerPointToPrj(i.sub(g())),A=h[r];A.x=u.x,A.y=u.y,e._updateCache(),e.onShapeChanged(),n._updateCoordFromShadow(!0),a=0===r?l[o].length-1:r-1,l[o][r]&&l[o][r].refresh(),l[o][a]&&l[o][a].refresh()}var p=new $0(0,0);function g(){var t=e._getCompiledSymbol();return p.x=t.lineDx||0,p.y=t.lineDy||0,p}function m(e,i,o){void 0===i&&(i=0);var a=(o||u(i))[e],h=n.createHandle(t.coordToContainerPoint(a)._add(g()),{symbol:n.options.vertexHandleSymbol,cursor:"pointer",axis:null,onMove:function(){d(h.getContainerPoint(),h[r],i)},onRefresh:function(e,n){a=(n||u(i))[h[r]];var o=t.coordToContainerPoint(a);h.setContainerPoint(o._add(g()))},onUp:function(){n._updateCoordFromShadow()},onDown:function(t,e){}});return h[r]=e,h._ringIndex=i,h.on(n.options.removeVertexOn,f),h.setZIndex(s),h}var y=!1;function v(i,o,s){void 0===o&&(o=0);var f=s||u(o),p=f[i].add(i+1>=f.length?f[0]:f[i+1]).multi(.5),_=n.createHandle(p,{symbol:n.options.newVertexHandleSymbol,cursor:"pointer",axis:null,onDown:function(i,s){if(!s||!s.domEvent||2!==s.domEvent.button){var a=c(o),h=_[r],u=_.getContainerPoint(),A=t._containerPointToPrj(u);a.splice(h+1,0,A),o>0?e._prjHoles[o-1]=a:e._setPrjCoordinates(a),e._updateCache(),_.opacity=1,l[o].splice(h,0,v.call(n,h,o),v.call(n,h+1,o)),y=!0}},onMove:function(){d(_.getContainerPoint(),_[r]+1,o)},onUp:function(t){if(t&&t.domEvent&&2===t.domEvent.button)y=!1;else{var e=_[r];a1(_,l[o]),_.delete(),h[o].splice(e+1,0,m.call(n,e+1,o)),A(),n._updateCoordFromShadow(),y=!1}},onRefresh:function(e,n){f=n||u(e);var i=_[r],o=f[i].add(f[i===f.length-1?0:i+1]).multi(.5),s=t.coordToContainerPoint(o);_.setContainerPoint(s._add(g()))}});return _[r]=i,_.setZIndex(a),_}if(e instanceof l7)for(var _=e.getHoles().length+1,x=0;x<_;x++){h[x]=[],l[x]=[];for(var b=0,w=(C=u(x)).length;b<w;b++)h[x].push(m.call(this,b,x,C)),b<w-1&&l[x].push(v.call(this,b,x,C));l[x].push(v.call(this,C.length-1,x,C))}else{var C;for(b=0,w=(C=u(x=0)).length;b<w;b++)h[x].push(m.call(this,b,x,C)),b<w-1&&l[x].push(v.call(this,b,x,C));l[x].length&&2===e.getCoordinates().length&&(l[x][0].options.symbol.markerDx=12)}var P=t.getRenderer();P&&P.sortTopElements(),this._addRefreshHook((function(){if(!y){for(var t in l)for(var n=u(t),i=l[t].length-1;i>=0;i--)l[t][i].refresh(t,n);for(var t in l[0].length&&e instanceof d7&&(2===e.getCoordinates().length?l[0][0].options.symbol.markerDx=12:e.getCoordinates().length>2&&(l[0][0].options.symbol.markerDx=0)),h)for(n=u(t),i=h[t].length-1;i>=0;i--)h[t][i].refresh(t,n)}}))},e.prototype._refresh=function(){if(this._refreshHooks)for(var t=this._refreshHooks.length-1;t>=0;t--)this._refreshHooks[t].call(this)},e.prototype._hideContext=function(){this._geometry&&(this._geometry.closeMenu(),this._geometry.closeInfoWindow())},e.prototype._addRefreshHook=function(t){t&&(this._refreshHooks||(this._refreshHooks=[]),this._refreshHooks.push(t))},e.prototype._update=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];this._exeHistory([t,e]),this._recordHistory.apply(this,X0([t],Q0(e),!1))},e.prototype._updateCoordFromShadow=function(t){var e=(this._shadow||this._geometry).getCoordinates(),n=this._geometry,i=this._updating;this._updating=!0,n.setCoordinates(e),t||this._recordHistory("setCoordinates",F4.toNumberArrays(n.getCoordinates())),this._updating=i},e.prototype._recordHistory=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(this._history||(this._history=[],this._historyPointer=0),this._history.length){var i=this._history[this._history.length-1];if(i[0]===t&&JSON.stringify(i[1])===JSON.stringify(e))return}this._historyPointer<this._history.length-1&&this._history.splice(this._historyPointer+1),this._history.push([t,e]),this._historyPointer=this._history.length-1,this._geometry.fire("editrecord")},e.prototype.cancel=function(){return this._history&&0!==this._historyPointer?(this._historyPointer=0,this._exeAndReset(this._history[0]),this):this},e.prototype.undo=function(){if(!this._history||0===this._historyPointer)return this;var t=this._history[--this._historyPointer];return this._exeAndReset(t),this},e.prototype.redo=function(){if(!this._history||this._historyPointer===this._history.length-1)return this;var t=this._history[++this._historyPointer];return this._exeAndReset(t),this},e.prototype._exeAndReset=function(t){if(!this._updating){this._exeHistory(t);var e=this._history,n=this._historyPointer;this.stop(),this._history=e,this._historyPointer=n,this.start()}},e.prototype._onDragStart=function(){this._updating=!0},e.prototype._onDragEnd=function(){this._updating=!1},e.prototype._exeHistory=function(t){var e,n;if(Array.isArray(t)){var i=this._updating;this._updating=!0;var r=this._shadow||this._geometry,o=this._geometry;Array.isArray(t[0])?t[0].forEach((function(t){var e,n,i=t[0],s=t.slice(1);(e=r[i]).call.apply(e,X0([r],Q0(s),!1)),r!==o&&(n=o[i]).call.apply(n,X0([o],Q0(s),!1))})):((e=r[t[0]]).call.apply(e,X0([r],Q0(t[1]),!1)),r!==o&&(n=o[t[0]]).call.apply(n,X0([o],Q0(t[1]),!1))),this._updating=i}},e}(Q3(Y3));Ent.mergeOptions(Int),H7.include({startEditText:function(){return this.getMap()?(this._recordVisible(),this.hide(),this.endEditText(),this._prepareEditor(),this._fireEvent("edittextstart"),this):this},endEditText:function(){if(this._textEditor){var t=this._textEditor.innerHTML;t=t.replace(/<p>/gi,"").replace(/<\/p>/gi,"<br/>"),this._textEditor.innerHTML=t;var e=this._textEditor.innerText.replace(/[\r\n]+$/gi,"");this.setContent(e),M2(this._textEditor,"mousedown dblclick",d2),this.getMap().off("mousedown",this.endEditText,this),this._editUIMarker.remove(),delete this._editUIMarker,this._textEditor.onkeyup=null,delete this._textEditor,this._recoveryVisible(),this.show(),this._fireEvent("edittextend")}return this},isEditingText:function(){return!!this._textEditor},getTextEditor:function(){return this._editUIMarker},_prepareEditor:function(){var t=this.getMap(),e=this._createEditor();this._textEditor=e,t.on("mousedown",this.endEditText,this);var n=this._getEditorOffset();this._editUIMarker=new Utt(this.getCoordinates(),{animation:null,content:e,dx:n.dx,dy:n.dy}).addTo(t),this._setCursorToLast(this._textEditor)},_getEditorOffset:function(){var t=this._getInternalSymbol()||{},e=0,n=0,i=t.textHorizontalAlignment;return"middle"===i||n0(i)?(e=(t.textDx||0)-2,n=(t.textDy||0)-2):(e=(t.markerDx||0)-2,n=(t.markerDy||0)-2),{dx:e,dy:n}},_createEditor:function(){var t=this.getContent(),e=this.getSize(),n=this._getInternalSymbol()||{},i=e.width,r=n.textFill||"#000000",o=n.textSize||12,s=e.height,a=n.markerLineColor||"#000",h=n.markerFill||"#3398CC",l=n.textLineSpacing||0,u=a2("div");return u.contentEditable=!0,u.style.cssText="background:".concat(h,"; border:1px solid ").concat(a,";\n            color:").concat(r,";font-size:").concat(o,"px;width:").concat(i-2,"px;height:").concat(s-2,"px;margin: auto;\n            line-height:").concat(o+l,"px;outline: 0; padding:0; margin:0;word-wrap: break-word;\n            overflow: hidden;-webkit-user-modify: read-write-plaintext-only;"),u.innerText=t,P2(u,"mousedown dblclick",d2),u.onkeyup=function(t){13===t.keyCode&&(u.style.height=parseInt(u.style.height||0)+o/2+"px")},u},_setCursorToLast:function(t){var e;window.getSelection?(t.focus(),(e=window.getSelection()).selectAllChildren(t),e.collapseToEnd()):document.selection&&((e=document.selection.createRange()).moveToElementText(t),e.collapse(!1),e.select())}}),M9.include({animate:function(t,e,n){var i=this;this._animPlayer&&this._animPlayer.finish(),a0(e)&&(n=e),e||(e={});var r,o=this.getMap(),s=this._getProjection(),a=this._prepareAnimationStyles(t),h=e.focus;if(delete this._animationStarted,o){var l=o._getRenderer();e.framer=function(t){l.callInNextFrame(t)}}if(s||!h){var u=i7.animate(a,e,(function(t){if(o&&o.isRemoved())u.finish();else{o&&!i._animationStarted&&h&&o.onMoveStart();var e=t.styles;for(var a in e)if("symbol"!==a&&"translate"!==a&&e.hasOwnProperty(a)){var l="set"+a[0].toUpperCase()+a.slice(1);i[l](e[a])}var c=e.translate;if(c){var A=c;r&&(A=c.sub(r)),r=c,i.translate(A)}var f=e.symbol;if(f){var d=i.getSymbol()||{};i.setSymbol(S5(d,f))}if(o&&h){var p=s.project(i.getCenter());o._setPrjCenter(p);var g=o._parseEventFromCoord(s.unproject(p));"running"!==u.playState?o.onMoveEnd(g):o.onMoving(g)}i._fireAnimateEvent(u.playState),n&&n(t)}}),this);return this._animPlayer=u,this._animPlayer.play()}console.error(s7)},_prepareAnimationStyles:function(t){var e=this._getInternalSymbol(),n={};for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];if("translate"!==i&&"symbol"!==i){var o=this["get"+i[0].toUpperCase()+i.substring(1)]();n[i]=[o,r]}else if("symbol"===i){var s=void 0;if(Array.isArray(t.symbol)){if(!Array.isArray(e))throw new Error("geometry'symbol isn't a composite symbol, while the symbol in styles is.");s=[];for(var a=t.symbol,h=0;h<a.length;h++)if(a[h]){var l={};for(var u in a[h])a[h].hasOwnProperty(u)&&(l[u]=[e[h][u],a[h][u]]);s.push(l)}else s.push(null)}else{if(Array.isArray(e))throw new Error("geometry'symbol is a composite symbol, while the symbol in styles isn't.");for(var u in s={},r)r.hasOwnProperty(u)&&(s[u]=[e[u],r[u]])}n.symbol=s}else"translate"===i&&(n.translate=new F4(r))}return n},_fireAnimateEvent:function(t){"finished"===t?(delete this._animationStarted,this._fireEvent("animateend")):"running"===t&&(this._animationStarted?this._fireEvent("animating"):(this._fireEvent("animatestart"),this._animationStarted=!0))}});var Ont=E1+"_drag_stage",Rnt=G0.touch?"touchstart mousedown":"mousedown",Dnt=function(t){function e(e){return t.call(this,e)||this}return W0(e,t),e.prototype.addHooks=function(){this.target.on(Rnt,this._startDrag,this)},e.prototype.removeHooks=function(){this._endDrag(),this.target.off(Rnt,this._startDrag,this),delete this.container},e.prototype._prepareDragHandler=function(){this._dragHandler=new L4(this.container),this._dragHandler.on("dragging",this._dragging,this).on("mouseup",this._endDrag,this).enable()},e.prototype._prepareShadow=function(){var t=this,e=this.target;if("canvas"===e.getLayer().options.renderer&&e.options.dragShadow){this._prepareDragStageLayer(),this._shadow&&this._shadow.remove();var n=this._shadow=e.copy();if(n.getGeometries){var i=n.getGeometries(),r=e.getGeometries();i.forEach((function(e,n){t._updateShadowSymbol(e,r[n])}))}else this._updateShadowSymbol(n,e);n.setId(null),this._prepareShadowConnectors()}},e.prototype._updateShadowSymbol=function(t,e){if(t.setSymbol(e._getInternalSymbol()),e.options.dragShadow){var n=T5(t._getInternalSymbol(),.5);t.setSymbol(n)}},e.prototype._prepareShadowConnectors=function(){var t=this.target,e=this._shadow,n=this._dragStageLayer._getRenderer().resources,i=[];if(W7._hasConnectors(t))for(var r=W7._getConnectors(t),o=0,s=r.length;o<s;o++){var a=r[o],h=a.config(),l=a._getInternalSymbol();h.symbol=T5(l,.5);var u=void 0;u=a.getConnectSource()===t?new a.constructor(e,a.getConnectTarget(),h):new a.constructor(a.getConnectSource(),e,h),i.push(u),a.getLayer()&&a.getLayer()._getRenderer()&&n.merge(a.getLayer()._getRenderer().resources)}this._shadowConnectors=i,i.push(e),this._dragStageLayer.bringToFront().addGeometry(i)},e.prototype._onTargetUpdated=function(){this._shadow&&this._shadow.setSymbol(this.target._getSymbol())},e.prototype._prepareDragStageLayer=function(){var t=this.target.getMap(),e=this.target.getLayer();this._dragStageLayer=t.getLayer(Ont),this._dragStageLayer||(this._dragStageLayer=new K7(Ont,{enableAltitude:e.options.enableAltitude,altitudeProperty:e.options.altitudeProperty}),t.addLayer(this._dragStageLayer));var n=new Q8;n.merge(e._getRenderer().resources),this._dragStageLayer._getRenderer().resources=n},e.prototype._startDrag=function(t){var e=this.target.getMap();if(e&&!this.target._getParent()&&!this.isDragging()){var n=t.domEvent;n.touches&&n.touches.length>1||2===n.button||(this.container=e.getPanels().mapWrapper||e.getContainer(),this.target.on("click",this._endDrag,this),this._lastCoord=this._correctCoord(t.coordinate),this._lastPoint=t.containerPoint,this._prepareDragHandler(),this._dragHandler.onMouseDown(t.domEvent),P2(this.container,"mouseleave",this._endDrag,this),this._startParam=t,this._moved=!1)}},e.prototype._dragging=function(t){var e=this.target,n=e.getMap();if(!n._isEventOutMap(t.domEvent)){var i=n._parseEvent(t.domEvent),r=i.domEvent;if(!(r.touches&&r.touches.length>1)){var o=n._getVisualHeight(n.options.maxVisualPitch);if(!(i.containerPoint.y<n.height-o)){if(!this._moved)return this._moved=!0,e.on("symbolchange",this._onTargetUpdated,this),this._isDragging=!0,this._prepareShadow(),this._shadow&&(e.options.dragShadow||e.hide(),this._shadow._fireEvent("dragstart",i)),this.target._fireEvent("dragstart",this._startParam||i),void delete this._startParam;var s=this._shadow||e,a=s.options.dragOnAxis,h=s.options.dragOnScreenAxis,l=i.containerPoint,u=i.coordinate;this._lastPoint=this._lastPoint||l,this._lastCoord=this._lastCoord||u,h?("x"===a?l.y=this._lastPoint.y:"y"===a&&(l.x=this._lastPoint.x),u=n.containerPointToCoord(l)):u=this._correctCoord(u);var c=l.sub(this._lastPoint),A=u.sub(this._lastCoord);h||("x"===a?c.y=A.y=0:"y"===a&&(c.x=A.x=0)),this._lastPoint=l,this._lastCoord=u;var f=!s.getGeometries&&s.isPoint;f?s.setCoordinates(u):s.translate(A),s===e||e.options.dragShadow||(f?e.setCoordinates(u):e.translate(A)),i.coordOffset=A,i.pointOffset=c,s._fireEvent("dragging",i),s!==e&&e._fireEvent("dragging",i)}}}},e.prototype._endDrag=function(t){if(this._dragHandler&&(this._dragHandler.disable(),delete this._dragHandler),this.container&&M2(this.container,"mouseleave",this._endDrag),this.target){var e=this.target;e.off("click",this._endDrag,this),e.off("symbolchange",this._onTargetUpdated,this),delete this._lastCoord,delete this._lastPoint,this._isDragging=!1;var n=e.getMap();if(this.enabled()&&n){var i=n._parseEvent(t?t.domEvent:null);this._updateTargetAndRemoveShadow(i),this._moved&&e._fireEvent("dragend",i)}}},e.prototype.isDragging=function(){return!!this._isDragging},e.prototype._updateTargetAndRemoveShadow=function(t){if(this._shadow){var e=this.target,n=e.getMap();e.options.dragShadow||e.show();var i=this._shadow;if(i){if(e.options.dragShadow){var r=i.getFirstCoordinate(),o=e.getFirstCoordinate(),s=r.sub(o);e.translate(s)}i._fireEvent("dragend",t),i.remove(),delete this._shadow}this._shadowConnectors&&(n.getLayer(Ont).removeGeometry(this._shadowConnectors),delete this._shadowConnectors),this._dragStageLayer&&(this._dragStageLayer._getRenderer().resources=new Q8,this._dragStageLayer.remove())}},e.prototype._correctCoord=function(t){var e=this.target.getMap();if(!e.getPitch())return t;var n=this.target;if(!n.getMinAltitude())return t;var i=(n.getMinAltitude()+n.getMaxAltitude())/2;return e.locateByPoint(t,0,-i)},e}(X3);M9.mergeOptions({draggable:!1,dragShadow:!0,dragOnAxis:null,dragOnScreenAxis:!1}),M9.addInitHook("addHandler","draggable",Dnt),M9.include({isDragging:function(){return this._getParent()?this._getParent().isDragging():!!this.draggable&&this.draggable.isDragging()}}),M9.include({startEdit:function(t){var e=this.getMap();return e&&this.options.editable?(this._editor&&this.endEdit(),this._recordVisible(),this._editor=new Ent(this,t),this._editor.start(),this._getParent()||this.fire("editstart"),e.getRenderer().setToRedraw(),this):this},endEdit:function(){if(this._editor){this._editor.stop(),delete this._editor,this._recoveryVisible(),this._getParent()||this.fire("editend");var t=this.getMap();t&&t.getRenderer().setToRedraw()}return this},redoEdit:function(){return this.isEditing()?(this._editor.redo(),this._getParent()||this.fire("redoedit"),this):this},undoEdit:function(){return this.isEditing()?(this._editor.undo(),this._getParent()||this.fire("undoedit"),this):this},cancelEdit:function(){return this.isEditing()?(this._recoveryVisible(),this._editor.cancel(),this._getParent()||this.fire("canceledit"),this):this},isEditing:function(){return!!this._editor&&this._editor.isEditing()}}),M9.include({_onEvent:function(t,e){var n=this.getMap();if(n){var i=e||this._getEventTypeToFire(t);"contextmenu"===i&&this.listens("contextmenu")&&(d2(t),f2(t));var r=n._getEventParams(t);i0(this._pickGeometryIndex)&&(r.pickGeometryIndex=this._pickGeometryIndex),this._fireEvent(i,r)}},_getEventTypeToFire:function(t){return t.type}}),M9.include({setInfoWindow:function(t){return this.removeInfoWindow(),t instanceof Qtt?(this._infoWindow=t,this._infoWinOptions=e0({},this._infoWindow.options),this._infoWindow.addTo(this),this):(this._infoWinOptions=e0({},t),this._infoWindow?this._infoWindow.setOptions(t):this.getMap()&&this._bindInfoWindow(),this)},getInfoWindow:function(){return this._infoWindow?this._infoWindow:null},openInfoWindow:function(t){return this.getMap()?(t||(t=this.getCenter()),this._infoWindow?this._infoWindow.show(t):this._infoWinOptions&&this.getMap()&&(this._bindInfoWindow(),this._infoWindow.show(t)),this):this},closeInfoWindow:function(){return this._infoWindow&&this._infoWindow.hide(),this},removeInfoWindow:function(){return this._unbindInfoWindow(),delete this._infoWinOptions,delete this._infoWindow,this},_bindInfoWindow:function(){var t=this._infoWinOptions;return t?(this._infoWindow=new Qtt(t),this._infoWindow.addTo(this),this):this},_unbindInfoWindow:function(){return this._infoWindow&&(this.closeInfoWindow(),this._infoWindow.remove(),delete this._infoWindow),this}}),M9.fromJSON=function(t){if(Array.isArray(t)){for(var e=[],n=0,i=t.length;n<i;n++){var r=M9.fromJSON(t[n]);Array.isArray(t)?e=e.concat(r):e.push(r)}return e}return t&&!t.feature?S7.toGeometry(t):(t.subType?(o=M9.getJSONClass(t.subType).fromJSON(t),n0(t.feature.id)||o.setId(t.feature.id)):(o=S7.toGeometry(t.feature),t.options&&o.config(t.options)),t.symbol&&o.setSymbol(t.symbol),t.infoWindow&&o.setInfoWindow(t.infoWindow),o);var o};var knt=new $0(0,0),Lnt=new $0(0,0),Fnt=new $0(0,0),Nnt=new $0(0,0),znt=[],Bnt=function(t){function e(){return t.call(this,o3)||this}return W0(e,t),e.prototype.checkUrl=function(t){return t&&s0(t)?T1(t):t},e.prototype.fetchImage=function(t,e,n,i){t=this.checkUrl(t),this.send({url:t,fetchOptions:i},znt,n,e)},e}(U8),Hnt=function(t){function e(e){var n=t.call(this,e)||this;n.tilesInView={},n.tilesLoading={},n._parentTiles=[],n._childTiles=[],n._tileQueue=[],n._tileQueueIds=new Set;var i=e.getTileSize().width;return n.tileCache=new L3(e.options.maxCacheSize*i/512*i/512,(function(t){n.deleteTile(t)})),G0.decodeImageInWorker&&n.layer.options.decodeImageInWorker&&("gl"===e.options.renderer||!G0.safari&&!G0.iosWeixin)&&(n._tileImageWorkerConn=new Bnt),n._compareTiles=Unt.bind(n),n}return W0(e,t),e.prototype.getCurrentTileZoom=function(){return this._tileZoom},e.prototype.draw=function(t,e){var n=this.getMap();if(this.isDrawable()){var i=this.prepareCanvas();if(!i||i.intersects(this.canvasExtent2D)){var r;this._renderTimestamp!==t&&(this._consumeTileQueue(),this._computeAvgTileAltitude(),this._renderTimestamp=t);var o=!1,s=this._frameTiles;if(s&&t===s.timestamp){if(s.empty)return;r=s}else{if(!(r=this._getTilesInCurrentFrame()))return this._frameTiles={empty:!0,timestamp:t},void this.completeRender();o=!0,this._frameTiles=r,this._frameTiles.timestamp=t,r.loadingCount&&this.loadTileQueue(r.tileQueue)}var a=r.loading,h=r.loadingCount;this._drawTiles(r.tiles,r.parentTiles,r.childTiles,r.placeholders,e,r.missedTiles,r.incompleteTiles),h||a||(n.isAnimating()||!this._parentTiles.length&&!this._childTiles.length||(this._parentTiles=[],this._childTiles=[],this.setToRedraw()),this.completeRender()),o&&this.retireTiles()}else this.completeRender()}},e.prototype.getTileGridsInCurrentFrame=function(){return this._frameTileGrids},e.prototype.getCurrentTimestamp=function(){return this._renderTimestamp||0},e.prototype._getTilesInCurrentFrame=function(){var t=this.getMap(),e=this.layer,n=e._isPyramidMode()&&e.options.terrainTileMode,i=e.getTiles();if(this._frameTileGrids=i,!(i=i.tileGrids)||!i.length)return null;var r=i.reduce((function(t,e){return t+(e&&e.tiles&&e.tiles.length||0)}),0);r>=this.tileCache.max/2&&this.tileCache.setMaxSize(2*r+1);var o=0,s=!1,a={},h=[],l=[],u={},c=[],A={},f=[],d={},p={},g=this.markTiles(),m=this._getLoadLimit(),y=i.length,v=void 0===this._tileZoom&&e.options.currentTilesFirst&&!this._terrainHelper;this._tileZoom=i[0].zoom;var _=null,x=null;n&&(_=[],x=new Map);for(var b=0;b<y;b++){var w=i[b],C=w.tiles,P=w.parents||znt,M=P.length,T=v?C:P.concat(C),S=void 0;T.length&&(S=this._generatePlaceHolder(T[0].res));for(var I=0,E=T.length;I<E;I++){var O=(H=T[I]).id,R=I<M,D=!1,k=h.length;if(this._isLoadingTile(O))D=s=!0,this.markCurrent(this.tilesLoading[O],!0);else{var L=this.getCachedTile(H,R);if(L)R||(L.image&&this.isTileFadingIn(L.image)&&(D=s=!0,this.setToRedraw()),this.isTileComplete(L)?h.push(L):(D=!0,n&&x.set(O,L)));else{D=s=!0;var F=m&&o+g[0]>m;this._tileQueueIds.has(H.id)||F||t.isInteracting()&&!t.isMoving()&&!t.isRotating()||(o++,p[O]=H)}}if(n&&!R&&(h.length===k?_.push(H):a[H.id]=1),!n&&!R&&D&&!a[O]&&(a[O]=1,S&&!d[O]&&(H.cache=!1,f.push({image:S,info:H}),d[O]=1),(j=this._findChildTiles(H)).length&&j.forEach((function(t){A[t.info.id]||(c.push(t),A[t.info.id]=1)})),!j.length||4!==j.length)){var N=this._findParentTile(H);if(N){var z=N.info.id;void 0===u[z]&&(u[z]=l.length,l.push(N))}}}}var B=[];if(n)for(b=0;b<_.length;b++){var H;if((H=_[b].info?_[b].info:_[b]).parent&&!a[H.id]){var j,U=this._findChildTiles(H),G=U.missedTiles;(j=U.tiles).length?(s1(h,j),s1(B,G)):x.has(H.id)?(h.push(x.get(H.id)),x.delete(H.id)):(a[H.id]=1,B.push(H))}}return this.tileCache.shrink(),{childTiles:c,missedTiles:B,parentTiles:l,tiles:h,incompleteTiles:x&&Array.from(x.values()),placeholders:f,loading:s,loadingCount:o,tileQueue:p}},e.prototype.removeTileCache=function(t){delete this.tilesInView[t],this.tileCache.remove(t)},e.prototype.isTileCachedOrLoading=function(t){return this.tileCache.get(t)||this.tilesInView[t]||this.tilesLoading[t]},e.prototype.isTileCached=function(t){return!(!this.tileCache.get(t)&&!this.tilesInView[t])},e.prototype.isTileFadingIn=function(t){return this._getTileFadingOpacity(t)<1},e.prototype._drawTiles=function(t,e,n,i,r,o,s){var a=this;e.length&&(e.sort(this._compareTiles),this._parentTiles=e),n.length&&(this._childTiles=n,this._childTiles.sort(this._compareTiles));var h=!0;this.layer.constructor!==Net&&this.layer.constructor!==qet||(this._renderTimestamp===this.canvas._parentTileTimestamp?h=!1:this.canvas._parentTileTimestamp=this._renderTimestamp);var l="gl"===this.layer.options.renderer&&(!this.isGL||this.isGL()),u={tiles:t,parentTiles:this._parentTiles,childTiles:this._childTiles,parentContext:r};if(this.onDrawTileStart(u,r),h&&1===this.layer.options.opacity){this.layer._silentConfig=!0;var c=this.layer.options.fadeAnimation;this.layer.options.fadeAnimation=!1,l?(this._drawChildTiles(n,r),this._drawParentTiles(this._parentTiles,r)):(this._drawParentTiles(this._parentTiles,r),this._drawChildTiles(n,r)),this.layer.options.fadeAnimation=c,this.layer._silentConfig=!1}this.drawingCurrentTiles=!0,t.sort(this._compareTiles);for(var A=0,f=t.length;A<f;A++)this._drawTileAndCache(t[A],r);delete this.drawingCurrentTiles,h&&this.layer.options.opacity<1&&(this.layer._silentConfig=!0,c=this.layer.options.fadeAnimation,this.layer.options.fadeAnimation=!1,l?(this._drawChildTiles(n,r),this._drawParentTiles(this._parentTiles,r)):(this._drawParentTiles(this._parentTiles,r),this._drawChildTiles(n,r)),this.layer.options.fadeAnimation=c,this.layer._silentConfig=!1),i.forEach((function(t){return a._drawTile(t.info,t.image,r)})),this.onDrawTileEnd(u,r)},e.prototype._drawChildTiles=function(t,e){var n=this;this.drawingChildTiles=!0,t.forEach((function(t){return n._drawTile(t.info,t.image,e)})),delete this.drawingChildTiles},e.prototype._drawParentTiles=function(t,e){var n=this;this.drawingParentTiles=!0,this._parentTiles.forEach((function(t){return n._drawTile(t.info,t.image,e)})),delete this.drawingParentTiles},e.prototype.onDrawTileStart=function(t,e){},e.prototype.onDrawTileEnd=function(t,e){},e.prototype._drawTile=function(t,e,n){e&&this.drawTile(t,e,n)},e.prototype._drawTileAndCache=function(t,e){this.isValidCachedTile(t)&&(this.tilesInView[t.info.id]=t),this._drawTile(t.info,t.image,e)},e.prototype.drawOnInteracting=function(t,e,n){this.draw(e,n)},e.prototype.needToRedraw=function(){var e=this.getMap();return!!this._tileQueue.length||(e.getPitch()?t.prototype.needToRedraw.call(this):!(!e.isRotating()&&!e.isZooming())||(e.isMoving()?!!this.layer.options.forceRenderOnMoving:t.prototype.needToRedraw.call(this)))},e.prototype.hitDetect=function(){return!1},e.prototype._getLoadLimit=function(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit||0},e.prototype.isDrawable=function(){return!this.getMap().getPitch()||(console&&console.warn("TileLayer with canvas renderer can't be pitched, use gl renderer ('renderer' : 'gl') instead."),this.clear(),!1)},e.prototype.clear=function(){this.retireTiles(!0),this.tileCache.reset(),this.tilesInView={},this.tilesLoading={},this._tileQueue=[],this._tileQueueIds.clear(),this._parentTiles=[],this._childTiles=[],t.prototype.clear.call(this)},e.prototype._isLoadingTile=function(t){return!!this.tilesLoading[t]},e.prototype.clipCanvas=function(e){return t.prototype.clipCanvas.call(this,e)},e.prototype._clipByPitch=function(t){var e=this.getMap();if(e.getPitch()<=e.options.maxVisualPitch)return!1;if(!this.layer.options.clipByPitch)return!1;var n=e.getContainerExtent(),i=e.getDevicePixelRatio();return t.save(),t.strokeStyle="rgba(0, 0, 0, 0)",t.beginPath(),t.rect(0,Math.ceil(n.ymin)*i,Math.ceil(n.getWidth())*i,Math.ceil(n.getHeight())*i),t.stroke(),t.clip(),!0},e.prototype.loadTileQueue=function(t){for(var e in t)if(t.hasOwnProperty(e)){var n=t[e],i=this.loadTile(n);void 0===i.loadTime&&(this.tilesLoading[n.id]={image:i,current:!0,info:n})}},e.prototype.loadTile=function(t){var e=this,n={};if(this.loadTileBitmap)this.loadTileBitmap(t.url,t,(function(n){e.onTileLoad(n,t)}),(function(n,i){e.onTileError(i,t,n)}));else if(this._tileImageWorkerConn&&this.loadTileImage===this.constructor.prototype.loadTileImage)this._fetchImage(n,t);else{var i=this.layer.getTileSize(t.layer);(n=new Image).width=i.width,n.height=i.height,n.onload=this.onTileLoad.bind(this,n,t),n.onerror=this.onTileError.bind(this,n,t),this.loadTileImage(n,t.url)}return n},e.prototype._fetchImage=function(t,e){var n=this;if(t instanceof Image)t.src=e.url;else{var i=Math.abs(e.x+e.y)%this._tileImageWorkerConn.workers.length;this._tileImageWorkerConn.fetchImage(e.url,i,(function(i,r){i?n.onTileError(t,e,i):M1(r,(function(t){n.onTileLoad(t,e)}))}),this.layer.options.fetchOptions||{referrer:document.location.href,headers:{accept:"image/webp,image/apng,image/svg+xml,image/*,*/*;q=0.8"}})}},e.prototype.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;return n0(n)||(t.crossOrigin=n),e1(t,[e])},e.prototype.abortTileLoading=function(t,e){e&&void 0!==e.id&&this.removeTileLoading(e),t&&t instanceof Image&&(t.onload=jnt,t.onerror=jnt,t.src=x1)},e.prototype.onTileLoad=function(t,e){this.removeTileLoading(e),this._tileQueue.push({tileInfo:e,tileData:t}),this._tileQueueIds.add(e.id),this.setToRedraw()},e.prototype.removeTileLoading=function(t){delete this.tilesLoading[t.id],this.setToRedraw()},e.prototype._consumeTileQueue=function(){for(var t=0,e=this.layer.options.tileLimitPerFrame,n=this._tileQueue;n.length&&(e<=0||t<e);){var i=n.shift(),r=i.tileData,o=i.tileInfo;this._tileQueueIds.has(o.id)&&(this._tileQueueIds.delete(o.id),this.checkTileInQueue(r,o)&&(this.consumeTile(r,o),t++))}},e.prototype._computeAvgTileAltitude=function(){var t=0,e=0,n=0;for(var i in this.tilesInView){var r=this.tilesInView[i]&&this.tilesInView[i].info;r&&(t+=r.minAltitude||0,e+=r.maxAltitude||0,n++)}this.avgMinAltitude=t/n,this.avgMaxAltitude=e/n},e.prototype.checkTileInQueue=function(t,e){return!0},e.prototype.consumeTile=function(t,e){if(this.layer&&this.tilesInView){var n={tile:e,tileImage:t};this.resetTileLoadTime(t=n.tileImage),this.removeTileLoading(e),this._addTileToCache(e,t),this.layer.fire("tileload",n),this.setToRedraw()}},e.prototype.resetTileLoadTime=function(t){0!==t.loadTime&&(t.loadTime=t0())},e.prototype.onTileError=function(t,e,n){if(this.layer){if(t.onerrorTick=t.onerrorTick||0,this.layer.options.tileRetryCount>t.onerrorTick)return t.onerrorTick++,this._fetchImage(t,e),void this.removeTileLoading(e);var i=this.layer.options.errorUrl;if(i){if(t instanceof Image&&t.src!==i)return t.src=i,void this.removeTileLoading(e);(t=new Image).src=i}this.abortTileLoading(t,e),t.loadTime=0,this.removeTileLoading(e),this._addTileToCache(e,t),this.setToRedraw(),this.layer.fire("tileerror",{tile:e})}},e.prototype.drawTile=function(t,e,n){if(e&&this.getMap()){var i=t.extent2d,r=t.offset,o=knt.set(i.xmin-r[0],i.ymax-r[1]),s=t.z,a=t.id,h=this.getMap(),l=h.getZoom(),u=this.context,c=h._pointAtResToContainerPoint(o,t.res,0,Lnt),A=h.getBearing(),f=A||l!==s,d=this.getTileOpacity(e,t),p=u.globalAlpha;d<1&&(u.globalAlpha=d),f||c._round();var g=c.x,m=c.y,y=t.extent2d.xmax-t.extent2d.xmin,v=t.extent2d.ymax-t.extent2d.ymin,_=this.layer,x=_?_.options.bufferPixel:0;if(f){u.save(),u.translate(g,m),A&&u.rotate(-A*Math.PI/180),y+=x,v+=x;var b=h._getResolution();if(b!==t.res){var w=t.res/b;u.scale(w,w)}g=m=0}if(j3.image(u,e,g,m,y,v),this.layer.options.debug){var C=this.layer.options.debugOutline;u.save(),u.strokeStyle=C,u.fillStyle=C,u.font="20px monospace";var P=new $0(g,m);j3.rectangle(u,P,{width:y,height:v},1,0),j3.fillText(u,this.getDebugInfo(a),P._add(32,v-14),C),j3.drawCross(u,g+y/2,m+v/2,2,C),u.restore()}f&&u.restore(),u.globalAlpha!==p&&(u.globalAlpha=p),this.setCanvasUpdated()}},e.prototype.getDebugInfo=function(t){var e=t.split("_"),n=e.length;return e[n-3]+"/"+e[n-2]+"/"+e[n-1]},e.prototype.findChildTiles=function(t){return this._findChildTiles(t)},e.prototype._findChildTiles=function(t){var e=this._getLayerOfTile(t.layer),n=e&&e.options.terrainTileMode&&e._isPyramidMode();if(!e||!e.options.background&&!n||t.z>this.layer.getMaxZoom())return znt;var i=this.getMap(),r=[];if(e._isPyramidMode()){if(!n){for(var o=this._getLayerOfTile(t.layer),s=2*t.x,a=2*t.y,h=t.z+1,l=[],u=0;u<2;u++)for(var c=0;c<2;c++)l.push(s+u,a+c,h);for(;l.length;){var A=l.pop(),f=l.pop(),d=l.pop(),p=o._getTileId(d,f,A,t.layer),g=A+1<=t.z+2;if(C=this.tileCache.getAndRemove(p)){if(this.isValidCachedTile(C))r.push(C),this.tileCache.add(p,C);else if(g)for(u=0;u<2;u++)for(c=0;c<2;c++)l.push(2*d+u,2*f+c,A+1)}else if(g)for(u=0;u<2;u++)for(c=0;c<2;c++)l.push(2*d+u,2*f+c,A+1)}return r}var m=void 0;n&&(m=[]);for(var y=2*t.x,v=2*t.y,_=t.z+1,x=[],b=0;b<2;b++)for(var w=0;w<2;w++){var C;p=e._getTileId(d=y+b,f=v+w,A=_,t.layer),(C=this.tileCache.getAndRemove(p))&&this.isValidCachedTile(C)?(r.push(C),this.tileCache.add(p,C),x.push(null)):x.push(p)}if(r.length<4){var P=0;for(b=0;b<2;b++)for(w=0;w<2;w++)if(p=x[P++]){d=y+b,f=v+w,A=_;var M=r.length,T=[];for(u=0;u<2;u++)for(c=0;c<2;c++){var S=e._getTileId(2*d+u,2*f+c,A+1,t.layer),I=this.tileCache.getAndRemove(S);I&&this.isValidCachedTile(I)?(r.push(I),this.tileCache.add(S,I),T.push(null)):T.push(S)}if(n&&r.length-M<4){var E=e.tileInfoCache.get(p)||e._createChildNode(t,b,w,[0,0],p);if(r.length-M==0)m.push(E);else{var O=0;for(u=0;u<2;u++)for(c=0;c<2;c++){var R=T[O++];if(R){var D=this.layer.tileInfoCache.get(R)||e._createChildNode(E,u,c,[0,0],R);m.push(D)}}}}}}return n?{tiles:r,missedTiles:m}:r}var k=t.res,L=t.extent2d.getMin(),F=t.extent2d.getMax(),N=e._project(i._pointToPrjAtRes(L,k,Fnt),Fnt),z=e._project(i._pointToPrjAtRes(F,k,Nnt),Nnt);for(b=1;b<1;b++)this._findChildTilesAt(r,N,z,e,t.z+b);return r},e.prototype._findChildTilesAt=function(t,e,n,i,r){var o=i.getId(),s=i.getSpatialReference().getResolution(r);if(s)for(var a,h,l=i._getTileConfig().getTileIndex(e,s),u=i._getTileConfig().getTileIndex(n,s),c=Math.min(l.idx,u.idx),A=Math.max(l.idx,u.idx),f=Math.min(l.idy,u.idy),d=Math.max(l.idy,u.idy),p=c;p<A;p++)for(var g=f;g<d;g++)a=i._getTileId(p,g,r,o),(h=this.tileCache.getAndRemove(a))&&this.isValidCachedTile(h)&&(t.push(h),this.tileCache.add(a,h))},e.prototype.findParentTile=function(t,e){return this._findParentTile(t,e)},e.prototype._findParentTile=function(t,e){var n=this.getMap(),i=this._getLayerOfTile(t.layer);if(!i||!i.options.background&&!i.options.terrainTileMode)return null;var r=i.getMinZoom(),o=e||t.z-r;if(i._isPyramidMode()){for(var s=t.z-o,a=t.z-1;a>=s;a--){var h=t.z-a,l=Math.pow(2,h),u=Math.floor(t.x/l),c=Math.floor(t.y/l),A=void 0;if(A=a===t.z-1?t.parent:i._getTileId(u,c,a,t.layer),(v=this.tileCache.getAndRemove(A))&&this.isValidCachedTile(v))return this.tileCache.add(A,v),v}return null}var f=i.getSpatialReference(),d=f.getZoomDirection(),p=t.res,g=t.extent2d.getCenter(),m=i._project(n._pointToPrjAtRes(g,p));for(h=1;h<=o;h++){var y=f.getResolution(a=t.z-d*h);if(y){var v,_=i._getTileConfig().getTileIndex(m,y);if(A=i._getTileId(_.x,_.y,a,t.layer),v=this.tileCache.getAndRemove(A))return this.tileCache.add(A,v),v}}return null},e.prototype.isValidCachedTile=function(t){return!!t.image},e.prototype.isTileComplete=function(t){return!0},e.prototype._getLayerOfTile=function(t){return this.layer.getChildLayer?this.layer.getChildLayer(t):this.layer},e.prototype.getCachedTile=function(t,e){var n=t.id,i=this.tilesInView,r=this.tileCache.getAndRemove(n);if(r){e||(i[n]=r);var o=this.tilesLoading;if(o&&o[n]){this.markCurrent(o[n],!1);var s=o[n];this.abortTileLoading(s.image,s.info),delete o[n]}}else r=i[n];return r&&(r.current=!0,this.isValidCachedTile(r)&&this.tileCache.add(n,r)),r},e.prototype._addTileToCache=function(t,e){this.isValidCachedTile({info:t,image:e})&&this.tileCache.add(t.id,{image:e,info:t})},e.prototype.getTileOpacity=function(t,e){var n=this._getTileFadingOpacity(t);if(this.layer.getChildLayer){var i=this.layer.getLayer(e.layer);i&&(n*=i.options.opacity)}return n},e.prototype._getTileFadingOpacity=function(t){return this.layer.options.fadeAnimation&&t.loadTime?Math.min(1,(t0()-t.loadTime)/this.layer.options.fadeDuration):1},e.prototype.onRemove=function(){this.clear(),delete this.tileCache,delete this._tilePlaceHolder,delete this._tileZoom,t.prototype.onRemove.call(this)},e.prototype.markCurrent=function(t,e){t.current=e},e.prototype.markTiles=function(){var t=0,e=0;if(this.tilesLoading)for(var n in this.tilesLoading)this.markCurrent(this.tilesLoading[n],!1),t++;if(this.tilesInView)for(var n in this.tilesInView)this.markCurrent(this.tilesInView[n],!1),e++;return[t,e]},e.prototype.retireTiles=function(t){for(var e in this.tilesLoading){var n=this.tilesLoading[e];!t&&n.current||(n.image&&this.abortTileLoading(n.image,n.info),this.deleteTile(n),this.removeTileLoading(n.info))}for(var e in this.tilesInView)(n=this.tilesInView[e]).current||(delete this.tilesInView[e],this.tileCache.has(e)||this.deleteTile(n))},e.prototype.deleteTile=function(t){if(t&&t.image){var e=t.info.id;this._tileQueueIds.has(e)&&this._tileQueueIds.delete(e),t.image.close&&t.image.close(),t.image instanceof Image&&(t.image.onload=null,t.image.onerror=null)}},e.prototype._generatePlaceHolder=function(t){var e=this.getMap(),n=this.layer.options.placeholder;if(!n||e.getPitch())return null;var i=this.layer.getTileSize(),r=t/e._getResolution(),o=this._tilePlaceHolder=this._tilePlaceHolder||j3.createCanvas(1,1,e.CanvasClass);return o.width=i.width*r,o.height=i.height*r,a0(n)?n(o):function(t){var e=t.getContext("2d"),n=t.width,i=t.height,r=n/16,o=i/16;e.beginPath();for(var s=0;s<16;s++)e.moveTo(0,s*o),e.lineTo(n,s*o),e.moveTo(s*r,0),e.lineTo(s*r,i);e.strokeStyle="rgba(180, 180, 180, 0.1)",e.lineWidth=1,e.stroke(),e.beginPath();var a=[[0,0],[n,0],[0,i],[n,i],[0,0],[0,i],[n,0],[n,i],[0,i/2],[n,i/2],[n/2,0],[n/2,i]];for(s=1;s<a.length;s+=2)e.moveTo(a[s-1][0],a[s-1][1]),e.lineTo(a[s][0],a[s][1]);e.lineWidth=4,e.stroke()}(o),o},e.prototype.setTerrainHelper=function(t){this._terrainHelper=t},e}(Z8);function jnt(){return!1}function Unt(t,e){return Math.abs(this._tileZoom-t.info.z)-Math.abs(this._tileZoom-e.info.z)}Net.registerRenderer("canvas",Hnt);var Gnt=new $0(0,0),Vnt={properties:{}},Wnt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.isDrawable=function(){return!0},e.prototype.needToRedraw=function(){var e=this.getMap();return!(!this.isGL()||e.getPitch()||!e.isZooming()||e.isMoving()||e.isRotating())||t.prototype.needToRedraw.call(this)},e.prototype.onDrawTileStart=function(t,e){var n=this.gl;if(n.enable(n.DEPTH_TEST),n.depthFunc(n.LEQUAL),n.enable(n.POLYGON_OFFSET_FILL),n.enable(n.STENCIL_TEST),n.stencilOp(n.KEEP,n.KEEP,n.REPLACE),n.depthMask(!!this.layer.options.depthMask),e&&e.renderTarget){var i=e.renderTarget.fbo;if(i){var r=e.renderTarget.getFramebuffer(i);n.bindFramebuffer(n.FRAMEBUFFER,r)}}},e.prototype.onDrawTileEnd=function(t,e){var n=this.gl;e&&e.renderTarget&&e.renderTarget.fbo&&n.bindFramebuffer(n.FRAMEBUFFER,null)},e.prototype.drawTile=function(e,n,i){if(!i||!i.sceneFilter||i.sceneFilter(Vnt)){var r=this.getMap();if(e&&r&&n){var o=e._glScale=e._glScale||e.res/r.getGLRes(),s=e.extent2d.xmax-e.extent2d.xmin,a=e.extent2d.ymax-e.extent2d.ymin;if(!1!==e.cache&&this._bindGLBuffer(n,s,a),this.isGL()){var h=e.offset,l=Gnt.set(e.extent2d.xmin-h[0],e.extent2d.ymax-h[1]),u=l.x*o,c=l.y*o,A=this.getTileOpacity(n,e),f=null;this.layer.options.debug&&(f=this.getDebugInfo(e.id));var d=this.gl;d.stencilFunc(d.LEQUAL,Math.abs(this.getCurrentTileZoom()-e.z),255);var p=this.layer.getPolygonOffset(),g=this.drawingCurrentTiles?p:p+1;d.polygonOffset(g,g),this.drawGLImage(n,u,c,s,a,o,A,f),this._getTileFadingOpacity(n)<1?this.setToRedraw():this.setCanvasUpdated()}else t.prototype.drawTile.call(this,e,n)}}},e.prototype._bindGLBuffer=function(t,e,n){t.glBuffer||(t.glBuffer=this.bufferTileData(0,0,e,n))},e.prototype.loadTileImage=function(t,e){var n=this.layer.options.crossOrigin;t.crossOrigin=null!==n?n:"",t.src=e},e.prototype.onCanvasCreate=function(){this.canvas.gl&&this.canvas.gl.wrap||this.createCanvas2()},e.prototype.createContext=function(){t.prototype.createContext.call(this),this.createGLContext()},e.prototype.resizeCanvas=function(e){this.canvas&&(t.prototype.resizeCanvas.call(this,e),this.resizeGLCanvas())},e.prototype.clearCanvas=function(){this.canvas&&(t.prototype.clearCanvas.call(this),this.clearGLCanvas())},e.prototype.getCanvasImage=function(){if(!this.isGL()||!this.canvas2)return t.prototype.getCanvasImage.call(this);var e=t.prototype.getCanvasImage.call(this);return e&&(e.image=this.canvas2),e},e.prototype.isGL=function(){if(this.canvas.gl&&this.canvas.gl.wrap)return!0;var t=this.getMap();return t&&(t.getPitch()||t.getBearing())||this.layer&&!!this.layer.options.fragmentShader},e.prototype.deleteTile=function(e){t.prototype.deleteTile.call(this,e),e&&e.image&&this.disposeImage(e.image),delete e.image},e.prototype.onRemove=function(){t.prototype.onRemove.call(this),this.removeGLCanvas()},e}(ant(Hnt));function qnt(t){var e=this,n=this.layer.getTileSize(),i=this.canvas.constructor,r=this.getMap(),o=r.getDevicePixelRatio(),s=j3.createCanvas(n.width*o,n.height*o,i);s.layer=this.layer;var a=new $0(t.extent2d.xmin,t.extent2d.ymax),h=new X4(r.pointToCoordinate(a),r.pointToCoordinate(a.add(n.width,n.height)),r.getProjection());return this.layer.drawTile(s,{url:t.url,point:a,center:r.pointToCoordinate(a.add(n.width/2,n.height/2)),extent:h,z:t.z,x:t.x,y:t.y},(function(n){n?e.onTileError(s,t):e.onTileLoad(s,t)})),s}Net.registerRenderer("gl",Wnt);var Znt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.loadTile=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return qnt.apply(this,t)},e}(Hnt),Qnt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.loadTile=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return qnt.apply(this,t)},e}(Wnt);Zet.registerRenderer("canvas",Znt),Zet.registerRenderer("gl",Qnt);var Xnt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.checkResources=function(){var t=this._geosToCheck||[];if(!this._resourceChecked&&this.layer._geoList&&s1(t,this.layer._geoList),!d1(t))return[];for(var e=[],n={},i=t.length-1;i>=0;i--){var r=t[i]._getExternalResources();if(r.length)if(this.resources)for(var o=0;o<r.length;o++){var s=r[o][0];this.resources.isResourceLoaded(r[o])||n[s]||(e.push(r[o]),n[s]=1)}else e.push.apply(e,X0([],Q0(r),!1))}return this._resourceChecked=!0,delete this._geosToCheck,e},e.prototype.render=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return this.layer._sortGeometries(),t.prototype.render.apply(this,e)},e.prototype._addGeoToCheckRes=function(t){t&&(Array.isArray(t)||(t=[t]),this._geosToCheck||(this._geosToCheck=[]),s1(this._geosToCheck,t))},e.prototype.onGeometryAdd=function(t){this._addGeoToCheckRes(t),Ynt(this)},e.prototype.onGeometryRemove=function(t){Ynt(this)},e.prototype.onGeometrySymbolChange=function(t){this._addGeoToCheckRes(t.target),Ynt(this)},e.prototype.onGeometryShapeChange=function(t){Ynt(this)},e.prototype.onGeometryPositionChange=function(t){Ynt(this)},e.prototype.onGeometryZIndexChange=function(t){Ynt(this)},e.prototype.onGeometryShow=function(t){Ynt(this)},e.prototype.onGeometryHide=function(t){Ynt(this)},e.prototype.onGeometryPropertiesChange=function(t){Ynt(this)},e}(Z8);function Ynt(t){t.layer.options.drawImmediate&&t.render(),t.setToRedraw()}var Jnt=new Y4,Knt=[],$nt=new Y4,tit=new E4;function eit(t){if(!t)return null;var e=t.getContext("2d");return e.clearRect(0,0,t.width,t.height),e}function nit(t){return t&&t.options.progressiveRender&&t.options.progressiveRenderDebug}var iit=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return W0(e,t),e.prototype.setToRedraw=function(){return t.prototype.setToRedraw.call(this),this._resetProgressiveRender(),this},e.prototype._geoIsCollision=function(t,e){if(!t)return!1;if(!t.options.collision)return!1;if(t.isPoint&&t.getContainerExtent){t.bbox||(t.bbox=[0,0,0,0]);var n=this.layer.options.collisionBufferSize,i=t.getContainerExtent();if(!i)return!1;if(t.bbox[0]=i.xmin-n,t.bbox[1]=i.ymin-n,t.bbox[2]=i.xmax+n,t.bbox[3]=i.ymax+n,e.collides(t.bbox))return!0;e.insertBox(t.bbox)}return!1},e.prototype.getImageData=function(){if(!this._lastRenderTime||t0()-this._lastRenderTime<32)return null;if(!this.context||!this.context.canvas)return null;if(!this._imageData){var t=this.context.canvas,e=t.width,n=t.height;try{this._imageData=this.context.getImageData(0,0,e,n)}catch(i){console.warn("hit detect failed with tainted canvas, some geometries have external resources in another domain:\n",i)}}return this._imageData},e.prototype.clearImageData=function(){this._imageData=null,delete this._imageData,this._lastRenderTime=t0()},e.prototype.checkResources=function(){for(var e=this,n=[],i=0;i<arguments.length;i++)n[i]=arguments[i];var r=t.prototype.checkResources.apply(this,n),o=this.layer.getStyle();return o&&(Array.isArray(o)||(o=[o]),o.forEach((function(t){for(var n=x5(t.symbol,!0),i=0,o=n.length;i<o;i++)e.resources.isResourceLoaded(n[i])||r.push(n[i])}))),r},e.prototype.needToRedraw=function(){if(this.isProgressiveRender()&&!this.renderEnd)return!0;var e=this.getMap();return!(!e.isInteracting()||!this.layer.options.enableAltitude)||!(e.isZooming()&&!e.isRotating()&&!e.getPitch()&&!this._hasPoint&&this.layer.constructor===K7)&&t.prototype.needToRedraw.call(this)},e.prototype.draw=function(){if(this.getMap()){if(!this.layer.isVisible()||this.layer.isEmpty())return this.clearCanvas(),void this.completeRender();this.prepareCanvas(),this.drawGeos(),this.completeRender()}},e.prototype.isBlank=function(){return!!this.context&&!this.isProgressiveRender()&&!this.context.canvas._drawn},e.prototype.drawOnInteracting=function(){if(this._geosToDraw){this._updateMapStateCache(),this._updateDisplayExtent();var t=this.getMap(),e=this.layer.getCount(),n=this.mapStateCache.resolution;(t.isZooming()&&t.options.seamlessZoom&&void 0!==this._drawnRes&&n>1.5*this._drawnRes&&this._geosToDraw.length<e||t.isMoving()||t.isInteracting())&&(this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._drawnRes=n),this._sortByDistanceToCamera(t.cameraPosition);var i=this.layer.options,r=i.collisionDelay;if(i.collision){var o=t0();this._lastCollisionTime||(this._lastCollisionTime=o),o-this._lastCollisionTime<=r?this._geosToDraw=this._lastGeosToDraw||this._geosToDraw:(this._collidesGeos(),this._lastCollisionTime=o)}for(var s=0,a=this._geosToDraw.length;s<a;s++){var h=this._geosToDraw[s];h._isCheck||h.isVisible()?(h._paint(this._displayExtent),this._geosToDraw[s]._cPoint=void 0,this._geosToDraw[s]._inCurrentView=void 0):(delete h._cPoint,delete h._inCurrentView)}this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,nit(this.layer)&&this.page}},e.prototype.show=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];this.layer.forEach((function(t){t._repaint()})),t.prototype.show.apply(this,e)},e.prototype.forEachGeo=function(t,e){this.layer.forEach(t,e)},e.prototype._checkGeos=function(){for(var t=this._getCurrentNeedRenderGeos(),e=0,n=t.length;e<n;e++)this.checkGeo(t[e]);return this},e.prototype.drawGeos=function(){this._drawSnapshot(),this._updateMapStateCache(),this._drawnRes=this.mapStateCache.resolution,this._updateDisplayExtent(),this.prepareToDraw(),this._batchConversionMarkers(this.mapStateCache.glRes),this._onlyHasPoint||this._checkGeos(),this._sortByDistanceToCamera(this.getMap().cameraPosition),this._collidesGeos();for(var t=0,e=this._geosToDraw.length;t<e;t++)this._geosToDraw[t]._paint(),this._geosToDraw[t]._cPoint=void 0,this._geosToDraw[t]._inCurrentView=void 0;this.clearImageData(),this._lastGeosToDraw=this._geosToDraw,nit(this.layer)&&this.page,this._snapshot(),this._setDrawGeosDrawTime()},e.prototype.prepareToDraw=function(){return this.layer._drawTime=t0(),this._hasPoint=!1,this._geosToDraw=[],this},e.prototype._setDrawGeosDrawTime=function(){t0();for(var t=this.layer._drawTime,e=this.getGeoPainterList(),n=0,i=e.length;n<i;n++){var r=e[n];r&&r._setDrawTime&&r._setDrawTime(t)}return nit(this.layer)&&t0(),this},e.prototype.checkGeo=function(t){if(t.isPoint&&void 0!==this._onlyHasPoint)(t._inCurrentView||t.hasAltitude())&&(this._hasPoint=!0,t._isCheck=!0,this._geosToDraw.push(t));else if(t._isCheck=!1,t&&t.isVisible()&&t.getMap()&&t.getLayer()&&t.getLayer().isCanvasRender()){var e=t._getPainter(),n=!0;if(t._inCurrentView||!n0(t.options.arcDegree)||t.hasAltitude())n=!0;else if(!1===t._inCurrentView)n=!1;else{var i=e.get2DExtent(this.resources,Jnt);i&&i.intersects(this._displayExtent)||(n=!1)}n&&(e.hasPoint()&&(this._hasPoint=!0),t._isCheck=!0,this._geosToDraw.push(t))}},e.prototype._collidesGeos=function(){if(!this.layer.options.collision)return this;var t=this.layer.options.collisionScope,e=this.layer.getMap(),n="map"===t?e.getCollisionIndex():tit;n===tit&&n.clear();var i=this._geosToDraw;this._geosToDraw=[];for(var r=0,o=i.length;r<o;r++)this._geoIsCollision(i[r],n)||this._geosToDraw.push(i[r]);return this},e.prototype.onZoomEnd=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];delete this.canvasExtent2D,t.prototype.onZoomEnd.apply(this,e)},e.prototype.onRemove=function(){this.forEachGeo((function(t){t.onHide()})),delete this._geosToDraw,delete this.snapshotCanvas,delete this.pageGeos,delete this.geoPainterList},e.prototype.onGeometryPropertiesChange=function(e){e&&this.layer._styleGeometry(e.target),t.prototype.onGeometryPropertiesChange.call(this,e)},e.prototype._updateDisplayExtent=function(){var t=this.canvasExtent2D;if(this._maskExtent){if(!this._maskExtent.intersects(t))return void this.completeRender();t=t.intersection(this._maskExtent)}this._displayExtent=t},e.prototype.identifyAtPoint=function(t,e){void 0===e&&(e={});var n=this.getGeosForIdentify();return n?this.layer._hitGeos(n,t,e):[]},e.prototype._updateMapStateCache=function(){var t=this.getMap(),e=t._pointToContainerPoint(this.middleWest)._add(0,-t.height/2),n=t.getResolution(),i=t.getPitch(),r=t.getBearing(),o=t.getGLScale(),s=t.getGLRes(),a=t.getContainerExtent(),h=t.get2DExtent(),l=t.get2DExtentAtRes(s);return this.mapStateCache={resolution:n,pitch:i,bearing:r,glScale:o,glRes:s,_2DExtent:h,glExtent:l,containerExtent:a,offset:e},this},e.prototype._batchConversionMarkers=function(t){if(this._onlyHasPoint=void 0,!this._constructorIsThis())return[];var e=[],n=[],i=[],r={},o=this.layer,s=o.options,a=o.getAltitude?o.getAltitude():0,h=o.isCanvasRender();this._onlyHasPoint=!0;for(var l=0,u=this._getCurrentNeedRenderGeos(),c=0,A=u.length;c<A;c++)if((C=u[c]).isPoint){var f=C._painter;f||(f=C._getPainter());var d=f.getRenderPoints("center")[0][0],p=s.enableAltitude?C._getAltitude():a;void 0===r[p]&&(r[p]=f.getAltitude()),e[l]=d,i[l]=r[p],n[l]=C,l++}else this._onlyHasPoint=!1;if(0===l)return[];var g=this.getMap(),m=P1(e,"_pt");m=g._pointsAtResToContainerPoints(e,t,i,m);var y=g.getContainerExtent(),v=y.xmax,_=y.ymax,x=y.xmin,b=y.ymin,w={};for(c=0,A=n.length;c<A;c++){var C;if((C=n[c])._cPoint=m[c],C._cPoint){var P=m[c],M=P.x,T=P.y;if(C._inCurrentView=M>=x&&T>=b&&M<=v&&T<=_||C.hasAltitude(),!C._inCurrentView){var S=C.getSymbolHash(),I=void 0;I=S?w[S]=w[S]||C._painter.getFixedExtent():C._painter.getFixedExtent(),$nt.set(I.xmin,I.ymin,I.xmax,I.ymax),$nt._add(m[c]),C._inCurrentView=$nt.intersects(y)}C._inCurrentView&&(C.isVisible()&&h||(C._inCurrentView=!1),this._onlyHasPoint&&C._inCurrentView&&(this._hasPoint=!0,C._isCheck=!0,this._geosToDraw.push(C)))}else C._inCurrentView=!1}return m},e.prototype._sortByDistanceToCamera=function(t){if(this.layer.options.sortByDistanceToCamera&&this._geosToDraw.length){var e=this.getMap(),n=e.distanceToPoint(1e3,0,e.getGLScale()).x/1e3,i="center";this._geosToDraw.sort((function(e,r){if(!e.isPoint||!r.isPoint)return 0;var o=e._painter,s=r._painter;if(!o||!s)return 0;var a=o.getRenderPoints(i)[0][0],h=s.getRenderPoints(i)[0][0],l=o.getAltitude()*n,u=s.getAltitude()*n;ctt(Knt,a.x,a.y,l);var c=mtt(Knt,t);return ctt(Knt,h.x,h.y,u),mtt(Knt,t)-c}))}},e.prototype._constructorIsThis=function(){return this.constructor===e},e.prototype.isProgressiveRender=function(){var t=this.layer;if(!t)return!1;var e=t.options||{};return!e.collision&&e.progressiveRender},e.prototype.getGeosForIdentify=function(){return this.isProgressiveRender()?this.pageGeos||[]:this._geosToDraw||[]},e.prototype.getGeoPainterList=function(){if(!this.isProgressiveRender()){for(var t=[],e=this._geosToDraw||[],n=0,i=e.length;n<i;n++)t.push(e[n]._painter);return t}return this.geoPainterList||[]},e.prototype._checkSnapshotCanvas=function(){if(!this.isProgressiveRender())return delete this.snapshotCanvas,null;var t=this.canvas;if(!t)return delete this.snapshotCanvas,null;this.snapshotCanvas||(this.snapshotCanvas=j3.createCanvas(1,1));var e=this.snapshotCanvas,n=t.width,i=t.height,r=t.style;return e.width===n&&e.height===i||(e.width=n,e.height=i),e.style.width===r.width&&e.style.height===r.height||(e.style.width=r.width,e.style.height=r.height),e},e.prototype._getCurrentNeedRenderGeos=function(){var t=this.layer._geoList||[];if(!this.isProgressiveRender())return t;var e=this.layer.options.progressiveRenderCount,n=this.page;return t.slice((n-1)*e,n*e)},e.prototype._resetProgressiveRender=function(){nit(this.layer),this.renderEnd=!1,this.page=1,this.pageGeos=[],this.geoPainterList=[],this.maxTolerance=0,this._clearSnapshotCanvas()},e.prototype._clearSnapshotCanvas=function(){var t=this._checkSnapshotCanvas();t&&eit(t)},e.prototype._snapshot=function(){for(var t=this.isProgressiveRender(),e=this._geosToDraw||[],n=0,i=e.length;n<i;n++){var r=e[n],o=r._hitTestTolerance()||0;this.maxTolerance=Math.max(this.maxTolerance,o),t&&(this.pageGeos.push(r),this.geoPainterList.push(r._painter))}if(!t)return this;t0();var s=this._checkSnapshotCanvas();s&&this.canvas&&eit(s).drawImage(this.canvas,0,0);var a=this.layer,h=Math.ceil((a._geoList||[]).length/a.options.progressiveRenderCount);return this.renderEnd=this.page>=h,this.renderEnd&&this._setDrawGeosDrawTime(),nit(this.layer)&&t0(),this.renderEnd||this.page++,this},e.prototype._drawSnapshot=function(){if(!this.isProgressiveRender())return this;var t=this.snapshotCanvas,e=this.context;if(!t||!e)return this;var n=this.getMap();if(!n)return this;var i=n.getDevicePixelRatio()||1;return this._canvasContextScale(e,1/i),e.drawImage(t,0,0),this._canvasContextScale(e,i),this},e}(Xnt);K7.registerRenderer("canvas",iit);var rit=function(t){function e(e){var n=t.call(this)||this;return n.map=e,n._handlerQueue=[],n._thisDocVisibilitychange=n._onDocVisibilitychange.bind(n),n._thisDocDragStart=n._onDocDragStart.bind(n),n._thisDocDragEnd=n._onDocDragEnd.bind(n),n._thisDocDPRChange=n._onDocDPRChange.bind(n),n}return W0(e,t),e.prototype.callInNextFrame=function(t){this._handlerQueue.push(t)},e.prototype.executeFrameCallbacks=function(){var t=this._handlerQueue;this._handlerQueue=[];for(var e=0,n=t.length;e<n;e++)t[e]()},e.prototype.offsetPlatform=function(t,e){if(!this.map.getPanels().front)return this;if(!e&&0===t.x&&0===t.y)return this;var n=this.map.getPanels(),i=this._frontCount=n.back.layerDOM.childElementCount,r=this._backCount=n.front.layerDOM.childElementCount,o=this._uiCount=n.front.uiDOM.childElementCount;if(i||r||o){var s=this.map.offsetPlatform();s=t?s.add(t)._round():s.round(),r&&p2(n.back,s),(i||o)&&p2(n.front,s)}return this},e.prototype.domChanged=function(){var t=this.map.getPanels();return!!t.front&&(void 0===this._frontCount||this._frontCount!==t.back.layerDOM.childElementCount||void 0===this._backCount||this._backCount!==t.front.layerDOM.childElementCount||void 0===this._uiCount||this._uiCount!==t.front.uiDOM.childElementCount)},e.prototype.resetContainer=function(){if(this.map&&(this.map._resetMapViewPoint(),this.map.getPanels().front)){var t=new $0(0,0);p2(this.map.getPanels().back,t),p2(this.map.getPanels().front,t)}},e.prototype.onZoomEnd=function(){this.resetContainer()},e.prototype.onLoad=function(){this._frameLoop()},e.prototype._onDocVisibilitychange=function(){"visible"===document.visibilityState&&this.setToRedraw()},e.prototype._getWrapPanel=function(){if(!this.map)return null;var t=this.map.getPanels();return t&&t.mapWrapper},e.prototype._onDocDragStart=function(){var t=this._getWrapPanel();t&&(t.style.overflow="visible")},e.prototype._onDocDragEnd=function(){var t=this._getWrapPanel();t&&(t.style.overflow="hidden")},e.prototype._onDocDPRChange=function(){var t=this.map;t&&t.options&&!t.options.devicePixelRatio&&t.checkSize&&t.getRenderer&&t.getRenderer()&&t.checkSize(!0)},e.prototype._containerIsOffscreen=function(){var t=this.map.getContainer();return!t||!t.style||"none"===t.style.display||Math.min(t.clientWidth,t.clientHeight)<=0},e}(Y3),oit=new E4,sit=function(t){function e(e){var n=t.call(this,e)||this;return n._containerIsCanvas=!!e.getContainer().getContext,n._registerEvents(),n._loopTime=0,n._resizeEventList=[],n._resizeTime=-1/0,n._frameCycleRenderCount=0,n}return W0(e,t),e.prototype.load=function(){this.initContainer()},e.prototype.renderFrame=function(t){var e=this.map;if(!e||!e.options.renderable)return!1;if(this._handleResizeEventList(t),e.options.stopRenderOnOffscreen&&this._containerIsOffscreen())return!0;this._updateDomPosition(t),delete this._isViewChanged,e._fireEvent("framestart"),this.updateMapDOM(),e.clearCollisionIndex();var n=this._getAllLayerToRender();return this.drawLayers(n,t),this.drawLayerCanvas(n)&&(this.drawTops(),this._drawCenterCross(),e.options.debugSky&&this._debugSky()),this._needClear=!1,e._fireEvent("frameend"),this._recordView(),this._mapview=this._getMapView(),delete this._spatialRefChanged,this._fireLayerLoadEvents(),this.executeFrameCallbacks(),this._canvasUpdated=!1,e.uiCollides(),!0},e.prototype.getFrameTimestamp=function(){return this._frameTimestamp||0},e.prototype.updateMapDOM=function(){var t=this.map;if(!t.isZooming()){var e=t.getViewPointFrameOffset();e?t.offsetPlatform(e):this.domChanged()&&this.offsetPlatform(null,!0)}},e.prototype._needRedrawAllLayers=function(t){var e=this;if(this.isSpatialReferenceChanged())return!0;var n=[];t.forEach((function(t){if(t&&(t._toRedraw=e._checkLayerRedraw(t))){n.push(t);var i=t.getLayers&&t.getLayers();i&&Array.isArray(i)&&s1(n,i)}}));for(var i=0,r=n.length;i<r;i++){var o=n[i],s=o&&o.options;if(s&&s.collision&&"map"===s.collisionScope)return!0}return!1},e.prototype.drawLayers=function(t,e){for(var n=this._needRedrawAllLayers(t),i=this.map,r=i.isInteracting(),o=[],s=[],a=i.options.fpsOnInteracting||0,h=0===a?0:1e3/a,l=this.map.options.layerCanvasLimitOnInteracting,u=t.length,c=i.getBaseLayer(),A=0,f=0;f<u;f++){var d=t[f];if(d.isVisible()){var p=d.isCanvasRender();p&&o.push(d.getId());var g=d._getRenderer();if(g){var m=n||d._toRedraw;p&&g.isCanvasUpdated()&&(m||s.push(d.getId()),this.setLayerCanvasUpdated());var y=g.__zoomTransformMatrix;if(delete g.__zoomTransformMatrix,m){if(r&&p){if(l>0&&u-1-f>l&&d!==c){d._getRenderer().clearCanvas();continue}A+=this._drawCanvasLayerOnInteracting(d,A,h,e)}else r&&g.drawOnInteracting?(g.prepareRender&&g.prepareRender(),g.checkAndDraw?g.checkAndDraw(g.drawOnInteracting,this._eventParam,e):g.drawOnInteracting(this._eventParam,e)):(g.render(e),p&&y&&g.isLoadingResource()&&(g.__zoomTransformMatrix=y));p&&(s.push(d.getId()),this.setLayerCanvasUpdated())}else p&&r&&(i.isZooming()&&!i.getPitch()?(g.prepareRender(),g.__zoomTransformMatrix=this._zoomMatrix):(i.getPitch()||i.isRotating())&&g.clearCanvas())}}}var v=this._canvasIds||[],_=this._updatedIds||[];if(this._canvasIds=o,this._updatedIds=s,!this.isLayerCanvasUpdated()){var x="---";v.join(x)===o.join(x)&&_.join(x)===s.join(x)||this.setLayerCanvasUpdated()}},e.prototype._checkLayerRedraw=function(t){if(this.isSpatialReferenceChanged())return!0;var e=this.map,n=t._getRenderer();return!!n&&(t.isCanvasRender()?n.testIfNeedRedraw():!(!n.needToRedraw||!n.needToRedraw())||e.isInteracting()||this.isViewChanged())},e.prototype._drawCanvasLayerOnInteracting=function(t,e,n,i){var r=this.map,o=t._getRenderer(),s=o.getDrawTime(),a=0===n||n>0&&e+s<=n;if(o.mustRenderOnInteracting&&o.mustRenderOnInteracting())o.render(i);else{if(o.drawOnInteracting&&(t===r.getBaseLayer()||a||r.isZooming()&&t.options.forceRenderOnZooming||r.isMoving()&&t.options.forceRenderOnMoving||r.isRotating()&&t.options.forceRenderOnRotating))return o.prepareRender(),o.prepareCanvas(),o.checkAndDraw?o.checkAndDraw(o.drawOnInteracting,this._eventParam,i):o.drawOnInteracting(this._eventParam,i),s;!r.isZooming()||r.getPitch()||r.isRotating()?(r.getPitch()||r.isRotating())&&o.clearCanvas():(o.prepareRender(),o.__zoomTransformMatrix=this._zoomMatrix)}return o.drawOnInteracting&&!a&&o.onSkipDrawOnInteracting(this._eventParam,i),0},e.prototype._fireLayerLoadEvents=function(){if(this._updatedIds&&this._updatedIds.length>0){var t=this.map;this._updatedIds.reverse().forEach((function(e){var n=t.getLayer(e);if(n){var i=n._getRenderer();i&&i.isRenderComplete()&&n.fire("layerload")}}))}},e.prototype.isLayerCanvasUpdated=function(){return this._canvasUpdated},e.prototype.setLayerCanvasUpdated=function(){this._canvasUpdated=!0},e.prototype.drawLayerCanvas=function(t){var e=this.map;if(!e)return!1;if(!this.isLayerCanvasUpdated()&&!this.isViewChanged()&&!1===this._needClear)return!1;this.canvas||this.createCanvas(),e._fireEvent("renderstart",{context:this.context}),this._updateCanvasSize()||this.clearCanvas();for(var n,i=e.isInteracting(),r=e.options.layerCanvasLimitOnInteracting,o=t.length,s=[],a=0;a<o;a++)if(t[a].isVisible()&&t[a].isCanvasRender()&&t[a]._getRenderer()){var h=this._getLayerImage(t[a]);h&&h.image&&(t[a]===e.getBaseLayer()?n=[t[a],h]:s.push([t[a],h]))}var l=this.canvas.width,u=this.canvas.height;for(n&&(this._drawLayerCanvasImage(n[0],n[1],l,u),this._drawFog()),o=s.length,a=i&&r>=0&&o>r?o-r:0;a<o;a++)this._drawLayerCanvasImage(s[a][0],s[a][1],l,u);return e._fireEvent("renderend",{context:this.context}),!0},e.prototype.setToRedraw=function(){var t=this._getAllLayerToRender();this._needClear=!0;for(var e=0,n=t.length;e<n;e++){var i=t[e].getRenderer();i&&i.canvas&&i.setToRedraw&&i.setToRedraw()}},e.prototype.updateMapSize=function(t){if(t&&!this._containerIsCanvas){var e=t.width+"px",n=t.height+"px",i=this.map.getPanels();i.mapWrapper.style.width=e,i.mapWrapper.style.height=n,this._updateCanvasSize()}},e.prototype.getMainPanel=function(){return this.map?this._containerIsCanvas?this.map.getContainer():this.map.getPanels()?this.map.getPanels().mapWrapper:null:null},e.prototype.toDataURL=function(t,e){return this.canvas?this.canvas.toDataURL(t,e):null},e.prototype.remove=function(){G0.webgl&&"undefined"!=typeof document&&(K3.off($3,this._thisDocDPRChange,this),K3.off(t4,this._thisDocVisibilitychange,this),K3.off(e4,this._thisDocDragStart,this),K3.off(n4,this._thisDocDragEnd,this)),this._resizeInterval&&clearInterval(this._resizeInterval),this._resizeObserver&&this._resizeObserver.disconnect(),delete this.context,delete this.canvas,delete this.map,delete this._spatialRefChanged,this._cancelFrameLoop()},e.prototype.hitDetect=function(t){var e=this.map;if(e&&e.options.hitDetect&&!e.isInteracting()){var n=e._getLayers(),i="default",r=e.options.hitDetectLimit||0,o=0;t&&t._round&&t._round();for(var s=n.length-1;s>=0;s--){var a=n[s];if(!(!a.options.hitDetect||a.isEmpty&&a.isEmpty())&&a.options.geometryEvents){var h=a._getRenderer();if(h&&h.hitDetect&&(!h.isBlank||!h.isBlank())){if("default"!==a.options.cursor&&h.hitDetect(t)){i=a.options.cursor||"pointer";break}if(o++,r>0&&o>r)break}}}e._trySetCursor(i)}},e.prototype._getLayerImage=function(t){var e=t._getRenderer();return e.getCanvasImage?e.getCanvasImage():null},e.prototype.initContainer=function(){var t=this.map.getPanels();function e(e,n,i,r){var o,s=a2("div",n);return i&&(s.style.cssText=i),t[e]=s,r||((o=s).onselectstart=function(){return!1},o.ondragstart=function(){return!1},o.setAttribute("unselectable","on")),s}var n=this.map.getContainer();if(!this._containerIsCanvas){n.innerHTML="";var i="position:absolute;top:0px;left:0px;",r=e("mapWrapper","maptalks-wrapper","position:absolute;overflow:hidden;",!0),o=e("allLayers","maptalks-all-layers",i+"padding:0px;margin:0px;z-index:0;overflow:visible;",!0),s=e("backStatic","maptalks-back-static",i+"z-index:0;",!0),a=e("back","maptalks-back",i+"z-index:1;"),h=e("backLayer","maptalks-back-layer",i),l=e("canvasContainer","maptalks-canvas-layer",i+"border:none;z-index:2;"),u=e("frontStatic","maptalks-front-static",i+"z-index:3;",!0),c=e("front","maptalks-front",i+"z-index:4;",!0),A=e("frontLayer","maptalks-front-layer",i+"z-index:0;"),f=e("ui","maptalks-ui",i+"border:none;z-index:1;",!0),d=e("control","maptalks-control","z-index:1",!0);n.appendChild(r),o.appendChild(s),a.appendChild(h),a.layerDOM=h,o.appendChild(a),o.appendChild(l),c.appendChild(A),c.layerDOM=A,c.uiDOM=f,o.appendChild(u),o.appendChild(c),c.appendChild(f),r.appendChild(o),r.appendChild(d),this.createCanvas(),this.resetContainer();var p=this.map._getContainerDomSize();this.updateMapSize(p)}},e.prototype.isViewChanged=function(){if(void 0!==this._isViewChanged)return this._isViewChanged;var t=this._mapview,e=this._getMapView();return this._isViewChanged=!t||!b1(t,e),this._isViewChanged},e.prototype._recordView=function(){var t=this.map;!t._onViewChange||t.isInteracting()||t.isAnimating()||b1(t.getView(),t._getCurrentView())||t._onViewChange(t.getView())},e.prototype.isSpatialReferenceChanged=function(){return this._spatialRefChanged},e.prototype._getMapView=function(){var t=this.map,e=t._getPrjCenter();return{x:e.x,y:e.y,zoom:t.getZoom(),pitch:t.getPitch(),bearing:t.getBearing(),width:t.width,height:t.height}},e.prototype._lockFrameRenderEnable=function(){var t=(this.map.options||{}).maxFPS;if(t<=0||$$.maxFPS<=t)return!0;var e=Math.ceil($$.maxFPS/t);return this._frameCycleRenderCount>=e},e.prototype._frameLoop=function(t){var e=this;this.map?(this._frameCycleRenderCount++,this._lockFrameRenderEnable()?(this._frameTimestamp=t=t||0,this._resizeCount=0,this.renderFrame(t),this._frameCycleRenderCount=0):this.map.options.debug&&this._frameCycleRenderCount,this._animationFrame=Y0((function(t){e._frameLoop(t)}))):this._cancelFrameLoop()},e.prototype._cancelFrameLoop=function(){this._animationFrame&&J0(this._animationFrame)},e.prototype._drawLayerCanvasImage=function(t,e,n,i){var r=this.context,o=e.point.round(),s=this.map.getDevicePixelRatio();1!==s&&o._multi(s);var a=e.image,h=a.width,l=a.height;if(!(o.x+h<=0||o.y+l<=0)){var u=t.options.opacity;if(i0(u)||(u=1),!(u<=0)){var c=e.opacity;if(i0(c)||(c=1),!(c<=0)){var A=r.globalAlpha;u<1&&(r.globalAlpha*=u),c<1&&(r.globalAlpha*=c),t.options.cssFilter&&(r.filter=t.options.cssFilter);var f=t.getRenderer(),d=f.__zoomTransformMatrix,p=f.clipCanvas(this.context);d&&(r.save(),r.setTransform.apply(r,X0([],Q0(d),!1))),r.drawImage(a,0,0,h,l,o.x,o.y,n,i),d&&r.restore(),p&&r.restore(),"none"!==r.filter&&(r.filter="none"),r.globalAlpha=A}}}},e.prototype._drawCenterCross=function(){var t=this.map.options.centerCross;if(t){var e=this.context,n=new $0(this.canvas.width/2,this.canvas.height/2);a0(t)?t(e,n):j3.drawCross(this.context,n.x,n.y,2,"#f00")}},e.prototype._drawContainerExtent=function(){var t=this.map.options.cascadePitches,e=this.map.height-this.map._getVisualHeight(t[0]),n=this.map.height-this.map._getVisualHeight(t[1]),i=this.map.getContainerExtent(),r=this.context;r.beginPath(),r.moveTo(0,i.ymin),r.lineTo(i.xmax,i.ymin),r.stroke(),r.beginPath(),r.moveTo(0,e),r.lineTo(i.xmax,e),r.stroke(),r.beginPath(),r.moveTo(0,n),r.lineTo(i.xmax,n),r.stroke()},e.prototype._drawFog=function(){var t=this.map;if(!(t.getPitch()<=t.options.maxVisualPitch)&&t.options.fog){var e=t.getDevicePixelRatio(),n=this.context,i=t.getContainerExtent(),r=(t.height-t._getVisualHeight(75))*e;r<0&&(r=0);var o=i.ymin*e,s=Math.ceil(o-r),a=t.options.fogColor.join(),h=n.createLinearGradient(0,r,0,o+30),l=1-30/(s+30);h.addColorStop(0,"rgba(".concat(a,", 0)")),h.addColorStop(.3,"rgba(".concat(a,", 0.3)")),h.addColorStop(l,"rgba(".concat(a,", 1)")),h.addColorStop(1,"rgba(".concat(a,", 0)")),n.beginPath(),n.fillStyle=h,n.fillRect(0,r,Math.ceil(i.getWidth())*e,Math.ceil(s+30))}},e.prototype._debugSky=function(){var t=this.map;if(!t)return this;var e=t.getContainerExtent().ymin;if(e<=0)return this;var n=this.context;return n.strokeStyle="red",n.strokeRect(0,0,t.width,e),this},e.prototype._getAllLayerToRender=function(){return this.map._getLayers()},e.prototype.clearCanvas=function(){this.canvas&&j3.clearRect(this.context,0,0,this.canvas.width,this.canvas.height)},e.prototype._updateCanvasSize=function(){if(!this.canvas||this._containerIsCanvas)return!1;var t=this.map,e=t.getSize(),n=this.canvas,i=I1(e,t.getDevicePixelRatio()),r=i.width,o=i.height,s=i.cssWidth,a=i.cssHeight;return!n.style||n.style.width===s&&n.style.height===a||(n.style.width=s,n.style.height=a),(r!==n.width||o!==n.height)&&(n.height=o,n.width=r,this.topLayer.width=n.width,this.topLayer.height=n.height,!0)},e.prototype.createCanvas=function(){this.topLayer=a2("canvas"),this.topCtx=this.topLayer.getContext("2d"),this._containerIsCanvas?this.canvas=this.map.getContainer():(this.canvas=a2("canvas"),this._updateCanvasSize(),this.map.getPanels().canvasContainer.appendChild(this.canvas)),this.context=this.canvas.getContext("2d")},e.prototype._updateDomPosition=function(t){return void 0===this._checkPositionTime&&(this._checkPositionTime=-1/0),Math.abs(t-this._checkPositionTime)>=500&&(g2(this.map.getContainer()),this._checkPositionTime=Math.min(t,this._checkPositionTime)),this},e.prototype._handleResizeEventList=function(t){if(!this._resizeEventList)return this;var e=this._resizeEventList.length;return 0===e||this._resizeTime&&t-this._resizeTime<60||(this.map.setContainerDomRect(this._resizeEventList[e-1].contentRect),this._resizeEventList=[],this._checkSize(),this._resizeCount=this._resizeCount||0,this.renderFrame((this._frameTimestamp||0)+ ++this._resizeCount/100),this._resizeTime=t),this},e.prototype._checkSize=function(){this.map&&this.map.checkSize()},e.prototype._setCheckSizeInterval=function(t){var e=this;G0.resizeObserver?(this._resizeObserver&&this._resizeObserver.disconnect(),this.map&&(this._resizeObserver=new ResizeObserver((function(t){!e.map||e.map.isRemoved()?e._resizeObserver.disconnect():t.length&&(e._resizeEventList=e._resizeEventList||[],e._resizeEventList.push(t[0]))})),this._resizeObserver.observe(this.map.getContainer()))):(clearInterval(this._resizeInterval),this._checkSizeInterval=t,this._resizeInterval=setInterval((function(){!e.map||e.map.isRemoved()?clearInterval(e._resizeInterval):e._checkSize()}),this._checkSizeInterval))},e.prototype._registerEvents=function(){var t=this,e=this.map;e.options.checkSize&&!K$&&"undefined"!=typeof window&&this._setCheckSizeInterval(e.options.checkSizeInterval),G0.mobile||e.on("_mousemove",this._onMapMouseMove,this),e.on("_dragrotatestart _dragrotating _dragrotateend _movestart _moving _moveend _zoomstart",(function(e){t._eventParam=e})),e.on("_zooming",(function(n){e.getPitch()||(t._zoomMatrix=n.matrix.container),t._eventParam=n})),e.on("_zoomend",(function(e){t._eventParam=e,delete t._zoomMatrix})),e.on("_spatialreferencechange",(function(){t._spatialRefChanged=!0})),G0.webgl&&"undefined"!=typeof document&&(K3.on($3,this._thisDocDPRChange,this),K3.on(t4,this._thisDocVisibilitychange,this),K3.on(e4,this._thisDocDragStart,this),K3.on(n4,this._thisDocDragEnd,this))},e.prototype._onMapMouseMove=function(t){var e=this,n=this.map;!n.isInteracting()&&n.options.hitDetect&&(this._hitDetectFrame&&J0(this._hitDetectFrame),this._hitDetectFrame=Y0((function(){e.hitDetect(t.containerPoint)})))},e.prototype._getCanvasLayers=function(){return this.map._getLayers((function(t){return t.isCanvasRender()}))},e.prototype.addTopElement=function(t){this._tops||(this._tops=[]),this._tops.push(t)},e.prototype.removeTopElement=function(t){if(this._tops){var e=this._tops.indexOf(t);e>=0&&this._tops.splice(e,1)}},e.prototype.getTopElements=function(){return this._tops||[]},e.prototype.sortTopElements=function(){this._tops=this._tops.sort((function(t,e){return(e.options.zIndex||0)-(t.options.zIndex||0)}))},e.prototype.drawTops=function(){this.topCtx.clearRect(0,0,this.topLayer.width,this.topLayer.height);var t=oit;t.clear(),this.map.fire("drawtopstart"),this.map.fire("drawtops");for(var e=this.getTopElements(),n=!1,i=this.map.getDevicePixelRatio(),r=[],o=0;o<e.length;o++){var s=e[o];if(s.needCollision&&s.needCollision()){var a=s.getRenderBBOX(i);if(a){if(t.collides(a)){var h=s.target&&s.target._geometry;h&&-1===r.indexOf(h)&&(r.push(h),h.fire("handlecollision"));continue}t.insertBox(a)}}s.render(this.topCtx)&&(n=!0)}n&&this.context.drawImage(this.topLayer,0,0),this.map.fire("drawtopsend")},e}(rit);H9.registerRenderer("canvas",sit),H9.mergeOptions({fog:!1,fogColor:[233,233,233]});var ait={_getRenderPoints:function(){return[[this._getCenter2DPoint(this.getMap().getGLRes())],null]}};A7.include(ait),O7.include(ait),I7.include(ait),D7.include(ait),R7.include({_getRenderPoints:function(t){var e=this.getMap(),n=e.getGLRes();if("vertex"===t){for(var i=this._trimRing(this.getShell()),r=[],o=0,s=i.length;o<s;o++)r.push(e.coordToPointAtRes(i[o],n));return[r,null]}return[[e.coordToPointAtRes(this.getCenter(),n)],null]}});var hit={_getRenderPoints:function(t){var e,n=this.getMap(),i=n.getGLRes(),r=null;if("point"===t)(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&e.length>0&&Array.isArray(e[0])&&(e=e[0].concat(e[1]));else if("vertex"===t)if(r=[],(e=this._getPath2DPoints(this._getPrjCoordinates(),!1,i))&&e.length>0&&Array.isArray(e[0])){for(var o=0,s=e.length;o<s;o++)for(var a=0,h=e[o].length;a<h;a++)r.push(0===a?[e[o][a],e[o][a+1]]:[e[o][a-1],e[o][a]]);e=e[0].concat(e[1])}else for(o=0,s=e.length;o<s;o++)r.push(0===o?[e[o],e[o+1]]:[e[o-1],e[o]]);else if("line"===t){e=[],r=[];var l=this._getPath2DPoints(this._getPrjCoordinates(),!1,i);if(l.length>0&&Array.isArray(l[0])){var u=void 0;for(o=1,s=l.length;o<s;o++)for(u=l[o],this instanceof l7&&u.length>0&&!u[0].equals(u[u.length-1])&&u.push(u[0]),a=1,h=u.length;a<h;a++)e.push(u[a].add(u[a-1])._multi(.5)),r.push([u[a-1],u[a]])}else for(this instanceof l7&&l.length>0&&!l[0].equals(l[l.length-1])&&l.push(l[0]),o=1,s=l.length;o<s;o++)e.push(l[o].add(l[o-1])._multi(.5)),r.push([l[o-1],l[o]])}else if("vertex-first"===t){var c=(s=(A=this._getPrjCoordinates()).length)?n._prjToPointAtRes(A[0],i):null;e=s?[c]:[],r=s?[[c,A[1]?n._prjToPointAtRes(A[1],i):c]]:[]}else if("vertex-last"===t){var A,f=(s=(A=this._getPrjCoordinates()).length)?n._prjToPointAtRes(A[s-1],i):null;e=s?[f]:[];var d=s>1?s-2:s-1;r=s?[[A[d]?n._prjToPointAtRes(A[d],i):f,f]]:[]}else{var p=this.getCenter();if(p){var g=this._getProjection().project(p);e=[n._prjToPointAtRes(g,i)]}else e=[]}return[e,r]}};d7.include(hit),l7.include(hit);var lit={within:!1,center:[0,0]};function uit(t){if(t&&t._containerBbox){lit.within=!1;var e=t._containerBbox,n=e.minx,i=e.miny,r=e.maxx,o=e.maxy,s=Math.abs(r-n),a=Math.abs(o-i);s<=1&&a<=1&&(lit.within=!0,lit.center[0]=(n+r)/2,lit.center[1]=(i+o)/2),delete t._containerBbox}else lit.within=!1;return lit}function cit(){var t=this._getPrjShell(),e=Y5();$5(t,e);var n=Q0(e,4);return new X4(n[0],n[1],n[2],n[3])}function Ait(){var t=this._getPrjShell();if(!t||!Array.isArray(t))return[];var e=this._getProjection(),n=this.getCoordinates()||{};return t.map((function(t){var i=e.unproject(t);return i.z=n.z||0,i}))}M9.include({_redrawWhenPitch:function(){return!1},_redrawWhenRotate:function(){return!1},_getRenderBBOX:function(t,e){return t.isHitTesting?null:(K5(J5),$5(e,J5),J5)}});var fit={_redrawWhenPitch:function(){return!0},_redrawWhenRotate:function(){return this instanceof O7||this instanceof D7},_computeRotatedPrjExtent:cit,getRotatedShell:Ait,_paintAsPath:function(){if(this.isRotated())return!0;var t=this.getMap();return this._getAltitude()>0||t.getPitch()||this instanceof O7&&t.getBearing()},_getPaintParams:function(){var t=this.getMap();if(this._paintAsPath())return l7.prototype._getPaintParams.call(this,!0);var e=this._getPrjCoordinates(),n=t._prjToPointAtRes(e,t.getGLRes());return X0([n],Q0(this._getRenderSize(n)),!1)},_paintOn:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._paintAsPath()?j3.polygon.apply(j3,X0([],Q0(t),!1)):j3.ellipse.apply(j3,X0([],Q0(t),!1))},_getRenderSize:function(t){var e=this.getMap(),n=e.getGLRes(),i=this._getPrjExtent(),r=e._prjToPointAtRes(i.getMin(),n),o=e._prjToPointAtRes(i.getMax(),n);return[Math.abs(o.x-r.x)/2,Math.abs(o.y-t.y),Math.abs(t.y-r.y)]}};O7.include(fit),I7.include(fit),R7.include({_getPaintParams:function(){var t=this.getMap(),e=this._getPrjShell();return[this._getPath2DPoints(e,!1,t.getGLRes())]},_paintOn:j3.polygon,_computeRotatedPrjExtent:cit,getRotatedShell:Ait});var dit={_redrawWhenPitch:function(){return!0},_getPaintParams:function(){if(this._paintAsPath())return l7.prototype._getPaintParams.call(this,!0);var t=this.getMap(),e=t._prjToPointAtRes(this._getPrjCoordinates(),t.getGLRes()),n=this._getRenderSize(e),i=Q0(this._correctAngles(),2);return[e,n[0],[i[0],i[1]]]},_paintOn:function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(this._paintAsPath())return j3.polygon.apply(j3,X0([],Q0(t),!1));var n=this.getMap().getBearing();return n&&(t[3]=t[3].slice(0),t[3][0]+=n,t[3][1]+=n),j3.sector.apply(j3,X0([],Q0(t),!1))}};D7.include(fit,dit),a7.include({_paintAsPath:function(){return!0}});var pit={arrowStyles:{classic:[3,4]},_getArrowShape:function(t,e,n,i,r){if(!t||!e||t.equals(e))return null;r||(r=0);var o,s=n*i[1]+r,a=n*i[0]/2+r;(o=e.sub(e.nextCtrlPoint||e.prevCtrlPoint?new $0(e.prevCtrlPoint?e.prevCtrlPoint:e.nextCtrlPoint):t))._unit();var h=e.sub(o.multi(s));o._perp();var l=h.add(o.multi(a));return o._multi(-1),[l,e,h.add(o.multi(a)),l]},_getPaintParams:function(){var t=this._getPrjCoordinates();return[this._getPath2DPoints(t,!1,this.getMap().getGLRes())]},_paintOn:function(t,e,n,i,r){var o=uit(this._painter);return o.within?j3.pixelRect(t,o.center,n,i):this.options.smoothness?j3.paintSmoothLine(t,e,n,this.options.smoothness,!1,this._animIdx,this._animTailRatio):j3.path(t,e,n,null,r),this._paintArrow(t,e,n),this._getRenderBBOX(t,e)},_getArrowPlacement:function(){return this.options.arrowPlacement},_getArrowStyle:function(){var t=this.options.arrowStyle;return t?Array.isArray(t)?t:this.arrowStyles[t]:null},_getArrows:function(t,e,n){var i=this,r=this._getArrowStyle();if(!r||t.length<2)return[];for(var o,s,a=t.length>0&&Array.isArray(t[0])?t:[t],h=this._getArrowPlacement(),l=[],u=function(){if(o&&s){var t=i._getArrowShape(o,s,e,r,n);t&&l.push(t)}},c=a.length-1;c>=0;c--){var A=a[c],f=A.length,d=A[0],p=A[f-1];"vertex-first"===h?(o=d.arrowNextPoint||A[1],s=d):"vertex-last"===h&&(o=p.arrowPrePoint||A[f-2],s=p),u(),"vertex-firstlast"===h&&(o=d.arrowNextPoint||A[1],s=d,u(),o=p.arrowPrePoint||A[f-2],s=p,u()),"point"===h&&this._getArrowPoints(l,A,e,r,n)}return l},_getArrowPoints:function(t,e,n,i,r){for(var o=0,s=e.length-1;o<s;o++){var a=e[o+1],h=this._getArrowShape(a.arrowPrePoint||e[o],a,n,i,r);h&&t.push(h)}},_paintArrow:function(t,e,n){var i=this._getInternalSymbol().lineWidth;(!i0(i)||i<3)&&(i=3);var r=this._getArrows(e,i);if(r.length){t.setLineDash&&t.setLineDash([]);for(var o=r.length-1;o>=0;o--)t.fillStyle=t.strokeStyle,j3.polygon(t,r[o],n,n)}}};d7.include(pit);var git={_getPaintParams:function(t){var e=this.getMap().getGLRes(),n=this._getPrjShell(),i=this._getPath2DPoints(n,t,e),r=i.length>0&&Array.isArray(i[0]);r&&(i=[[i[0]],[i[1]]]);var o=this._getPrjHoles(),s=[];if(o&&o.length>0){for(var a=this._simplified,h=0;h<o.length;h++){var l=this._getPath2DPoints(o[h],t,e);Array.isArray(l)&&r?Array.isArray(l[0])?(i[0].push(l[0]),i[1].push(l[1])):i[0].push(l):s.push(l)}a&&(this._simplified=a)}return r||s1(i=[i],s),[i]},_paintOn:function(t,e,n,i,r){var o=uit(this._painter);return o.within?j3.pixelRect(t,o.center,n,i):j3.polygon(t,e,n,i,r,this.options.smoothness),this._getRenderBBOX(t,e)}};l7.include(git),H9.VERSION="1.0.0-rc.35";const mit={yuanhuan:{accessors:[{name:"����С��_1_0_positions",componentType:5126,count:104,min:[-5.407599925994873,-5.404099941253662,0],max:[5.405200004577637,5.406300067901611,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"����С��_1_0_normals",componentType:5126,count:104,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"����С��_1_0_indices",componentType:5123,count:288,min:[0],max:[103],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"缩放圈-新",byteLength:3072,uri:"data:application/octet-stream;base64,KVyjQLbzPT4AAAAAZvesQLbzPT4AAAAAhsmqQC7/YT8AAAAAZ0ShQDC7Vz8AAAAA+u2lwGKhxr8AAAAArK2cwLpJvL8AAAAAEFihwB04V78AAAAAXdyqwE7RYb8AAAAAat6lQEaUxj8AAAAAApqcQG+BvD8AAAAAB18EQFOWlcAAAAAA+u0LQLBynsAAAAAARPoxQNSalMAAAAAAJzEoQIxKjMAAAAAAQBNVQFyPiMAAAAAAIEFJQMDsgMAAAAAA0950QK36dMAAAAAAejZnQFRSZ8AAAAAAXdyAQBBYScAAAAAA+n6IQI0oVcAAAAAAcoqUQAMJMsAAAAAAKjqMQIlBKMAAAAAAXdyAQFdbSUAAAAAA+n6IQDsBVUAAAAAA0950QBTQdEAAAAAAejZnQA5PZ0AAAAAA+n6IwI0oVcAAAAAAwOyAwBBYScAAAAAAXkuMwIlBKMAAAAAA0ZGUwAMJMsAAAAAA5j+8P9ejnMAAAAAAkDFXP65HocAAAAAA1JrGPz7opcAAAAAA/7I7PvhTo8AAAAAA/7I7PmPurMAAAAAAM8RhP/vLqsAAAAAADwutwLbzPT4AAAAA0m+jwLbzPT4AAAAAEFihwDC7Vz8AAAAAXdyqwC7/YT8AAAAArK2cwG+BvD8AAAAA+u2lwEaUxj8AAAAADXGewN/gC0AAAAAAa5qVwIV8BEAAAAAAXkuMwAFNKEAAAAAA0ZGUwD7oMUAAAAAAlIeVQIV8BEAAAAAAlWWeQN/gC0AAAAAAcoqUQD7oMUAAAAAAKjqMQAFNKEAAAAAAQBNVQBB6iEAAAAAAIEFJQKfogEAAAAAAW9N0wK36dMAAAAAAsVBnwFRSZ8AAAAAAlWWeQM/3C8AAAAAAlIeVQNxoBMAAAAAA+n6IwDsBVUAAAAAAwOyAwFdbSUAAAAAAsVBnwA5PZ0AAAAAAW9N0wBTQdEAAAAAAd74LwLBynsAAAAAAkxi8v9ejnMAAAAAAwFsEwFOWlcAAAAAARpRWv65HocAAAAAAayvGvz7opcAAAAAA2c43vvhTo8AAAAAA2c43vmPurMAAAAAAt9Fgv/vLqsAAAAAAt9Fgv7fRqkAAAAAAayvGvybkpUAAAAAAd74LwAponkAAAAAA2c43vv5lo0AAAAAA2c43vmkArUAAAAAARpRWvzxOoUAAAAAAkxi8v9ejnEAAAAAAOdYxwHKKlEAAAAAAwFsEwDqSlUAAAAAA+zoowNBEjEAAAAAAJlNJwKfogEAAAAAAUPxUwBB6iEAAAAAAat6lQGKhxr8AAAAAApqcQLpJvL8AAAAAhsmqQE7RYb8AAAAAZ0ShQB04V78AAAAAZvesQP+yO74AAAAAKVyjQP+yO74AAAAAM8RhP7fRqkAAAAAA/7I7PmkArUAAAAAA/7I7Pv5lo0AAAAAA+u0LQAponkAAAAAA1JrGPybkpUAAAAAAkDFXPzxOoUAAAAAA5j+8P9ejnEAAAAAARPoxQHKKlEAAAAAAB18EQDqSlUAAAAAAJzEoQNBEjEAAAAAA+zoowIxKjMAAAAAAOdYxwNSalMAAAAAAUPxUwFyPiMAAAAAAJlNJwMDsgMAAAAAAa5qVwNxoBMAAAAAADXGewM/3C8AAAAAA0m+jwP+yO74AAAAADwutwP+yO74AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMABAAFAAYABAAGAAcAAwACAAgAAwAIAAkACgALAAwACgAMAA0ADQAMAA4ADQAOAA8ADwAOABAADwAQABEAEgATABQAEgAUABUAFgAXABgAFgAYABkAGgAbABwAGgAcAB0AHgALAAoAHwALAB4AHwAgAAsAIQAgAB8AIgAjACAAIgAgACEAJAAlACYAJAAmACcAJwAmACgAJwAoACkAKgArACwAKgAsAC0ALgAvADAALgAwADEAGQAYADIAGQAyADMANAA1ABsANAAbABoAFQAUADYAFQA2ADcAOAA5ADoAOAA6ADsAPAA9AD4APAA/AD0AQAA/ADwAQABBAD8AQgBBAEAAQgBAAEMARABFAEYARABGAEcARABHAEgARgBJAEcARgBKAEkASwBKAEYASwBMAEoASwBNAEwACQAIAC8ACQAvAC4ALQAsADkALQA5ADgAOwA6AE4AOwBOAE8ATwBOAE0ATwBNAEsAKQAoACsAKQArACoANwA2AFAANwBQAFEAUQBQAFIAUQBSAFMAUwBSAFQAUwBUAFUAVgBXAFgAVgBYAFkAVgBZAFoAWwBZAFgAXABZAFsAXABdAFkAXgBdAFwAXwBdAF4APAA+AGAAPABgAGEAMQAwABcAMQAXABYAYgBjADUAYgA1ADQAYQBgAGMAYQBjAGIAMwAyAF0AMwBdAF8AHQAcAGQAHQBkAGUAZQBkAAUAZQAFAAQAZgBnAAcAZgAHAAYAEQAQABMAEQATABIA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:1248,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:1248,byteOffset:1248,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:576,byteOffset:2496,target:34963}],materials:[{name:"SVGMat_001",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"����С��_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"����С��",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan41:{accessors:[{name:"Բ��_1_0_positions",componentType:5126,count:39,min:[0,0,0],max:[5.489999771118164,0,5.488900184631348],type:"VEC3",bufferView:0,byteOffset:0},{name:"Բ��_1_0_normals",componentType:5126,count:39,min:[0,-.999939501285553,-1],max:[.13969914615154266,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Բ��_1_0_indices",componentType:5123,count:105,min:[0],max:[38],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yh41",byteLength:1148,uri:"data:application/octet-stream;base64,8tKXQAAAAACoNU09FK6vQAAAAAB1Ako/FK6vQAAAAAAAAACATfOAQAAAAAACmkg+K4dWQAAAAAAIrNw+WvUtQAAAAABbsT8/X5gIQAAAAACMSpI/OUWbQAAAAAD0/VQ/LbKHQAAAAAD0/XQ/W0JqQAAAAAC6SZQ/dLXNPwAAAACfq80/H4VHQAAAAAB0JLc/ZognQAAAAAA1XuI/YVSSPwAAAAAukAhABaMKQAAAAAB4nApABcU/PwAAAACF6y1Aw2TiPwAAAACRfidASS63PwAAAABKe0dAJLncPgAAAACze1ZAj1OUPwAAAADjNmpAAppIPgAAAADu64BAnRF1PwAAAAD8qYdAqDVNPQAAAADBypdAgQRVPwAAAAAIPZtAAAAAAAAAAAASpa9AAwlKPwAAAAASpa9AJJd/PAAAAAASpa9AAwlKPwAAAAASpa9AAAAAAAAAAAASpa9Asp1vPQAAAAASpa9AJLn8PQAAAAASpa9AqoJRPgAAAAASpa9ARwOYPgAAAAASpa9AHhbKPgAAAAASpa9A2hv8PgAAAAASpa9A5q4VPwAAAAASpa9A+n4qPwAAAAASpa9AQxw7PwAAAAASpa9AwhdGPwAAAAASpa9AAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAJ5X/OwL+fz8AAACAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIC/Kzs0PAn8f78AAACApLK/PA7uf78AAACAeJkZPefRfz8AAACA+ZldPQSgf78AAACA6XSTPelVfz8AAACALLO3PdT3fr8AAACAfkjZPR2Ofr8AAACANf32Paohfj8AAACAeUYHPqDBfT8AAACASw0PPlt9fb8AAACAAAABAAIAAwABAAAABAABAAMABQABAAQABgAHAAUABwABAAUABgAIAAcABgAJAAgACgAJAAYACgALAAkACgAMAAsADQAMAAoADQAOAAwADwAOAA0ADwAQAA4ADwARABAAEgARAA8AEgATABEAFAATABIAFAAVABMAFgAVABQAFgAXABUAGAAXABYAGAAZABcAGgAbABwAHQAbABoAHgAbAB0AHwAbAB4AIAAbAB8AIQAbACAAIgAbACEAIwAbACIAJAAbACMAJQAbACQAJgAbACUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:468,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:468,byteOffset:468,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:212,byteOffset:936,target:34963}],materials:[{name:"SVGMat_002",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Բ��_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Բ��",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan411:{accessors:[{name:"����СȦ_1_0_positions",componentType:5126,count:28,min:[.026000000536441803,-4.6834001541137695,0],max:[4.696700096130371,-.014800000004470348,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"����СȦ_1_0_normals",componentType:5126,count:28,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"����СȦ_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanhuan411",byteLength:828,uri:"data:application/octet-stream;base64,ufwXQLN7Mr8AAAAAObRAQLFQK78AAAAA1ediQMWP8b4AAAAAGQQ6QCv2174AAAAAqFdeQHUCWr4AAAAA7FGCQL6fmr0AAAAAHHyDQDLmrr4AAAAAXkuWQJf/kL4AAAAAXkuWQLN7crwAAAAAMCrxP2RdhL8AAAAA/BgDQJeQn78AAAAADeARQAg9i78AAAAAukkIQISeXb8AAAAAZaogQH/Zbb8AAAAA7Q3ePr4wOcAAAAAA5IMuP9/gP8AAAAAAJQZxPwrXH8AAAAAAPZs1P6UsF8AAAAAAdy2hP0VHAsAAAAAAb/CFP5eQ778AAAAA0ES4P32utr8AAAAAAprQPyL9zr8AAAAAi/1lPqqCXcAAAAAA9dv3PtcSYsAAAAAADi2yPZvmgcAAAAAAYTK1PssQg8AAAAAA9P3UPGrelcAAAAAA4liXPmrelcAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMAAwACAAQABQAGAAcABQAHAAgABAACAAYABAAGAAUACQAKAAsACQALAAwAAAANAAEADgAPABAADgAQABEAEQAQABIAEQASABMAFAAVAAoAFAAKAAkADAALAA0ADAANAAAAFgAXAA8AFgAPAA4AGAAZABcAGAAXABYAGgAZABgAGgAbABkAEwASABUAEwAVABQA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"����СȦ_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"����СȦ",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanpan:{accessors:[{name:"Circle001_1_0_positions",componentType:5126,count:28,min:[-1.9510999917984009,0,-1.9510999917984009],max:[1.9510999917984009,0,1.9510999917984009],type:"VEC3",bufferView:0,byteOffset:0},{name:"Circle001_1_0_normals",componentType:5126,count:28,min:[0,1,0],max:[0,1,0],type:"VEC3",bufferView:1,byteOffset:0},{name:"Circle001_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanpan",byteLength:828,uri:"data:application/octet-stream;base64,S+rkvgAAAADRIvM/AAAAAAAAAAClvfk/S+rkPgAAAADRIvM/0SLzvwAAAABL6uQ+MlXgvwAAAACsi1s/c9fCvwAAAACvJZw/pb35vwAAAAAAAAAA0SLzvwAAAABL6uS+MlXgvwAAAACsi1u/c9fCvwAAAACvJZy/ryWcvwAAAABz18K/rItbvwAAAAAyVeC/S+rkvgAAAADRIvO/AAAAgAAAAAClvfm/S+rkPgAAAADRIvO/rItbPwAAAAAyVeC/ryWcPwAAAABz18K/c9fCPwAAAACvJZy/MlXgPwAAAACsi1u/0SLzPwAAAABL6uS+pb35PwAAAAAAAACA0SLzPwAAAABL6uQ+MlXgPwAAAACsi1s/c9fCPwAAAACvJZw/ryWcvwAAAABz18I/ryWcPwAAAABz18I/rItbvwAAAAAyVeA/rItbPwAAAAAyVeA/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAABAAIAAwAEAAUABgADAAUABwAGAAUACAAHAAUACQAIAAUACgAJAAUACwAKAAUADAALAAUADQAMAAUADgANAAUADwAOAAUAEAAPAAUAEQAQAAUAEgARAAUAEwASAAUAFAATAAUAFQAUAAUAFgAVAAUAFwAWAAUAFwAFABgAGQAXABgAGQAYABoAGwAZABoAAgAbABoAAAACABoA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"wire_008110135",pbrMetallicRoughness:{baseColorFactor:[.0314,.4314,.5294,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Circle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Circle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},zzhou:{accessors:[{name:"Cube.001-Mesh_0_positions",componentType:5126,count:45,min:[-.2711470127105713,-5.473427772521973,-.2711470127105713],max:[.2711470127105713,.46298399567604065,.2711470127105713],type:"VEC3",bufferView:0,byteOffset:0},{name:"Cube.001-Mesh_0_normals",componentType:5126,count:45,min:[-1,-1,-1],max:[1,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Cube.001-Mesh_0_texcoords",componentType:5126,count:45,min:[.125,0],max:[.875,1],type:"VEC2",bufferView:2,byteOffset:0},{name:"Cube.001-Mesh_0_indices",componentType:5123,count:72,min:[0],max:[44],type:"SCALAR",bufferView:3,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"Z",byteLength:1584,uri:"data:application/octet-stream;base64,/waNvZMdK77/Bo09/waNPZMdK77/Bo09/waNPR4Kr8D/Bo09l+KKPVImr8D/Bo09/waNvVImr8D/Bo09yNOKPsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04o+yNOKvsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04q+yNOKvsjTir7I04q+yNOKPsjTir7I04q+yNOKPsjTir7I04o+yNOKvsjTir7I04o+yNOKPsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04o+yNOKvsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04q+/waNPZMdK77/Bo09/waNPZMdK77/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09/waNPR4Kr8D/Bo09/waNvZMdK77/Bo09/waNvVImr8D/Bo09/waNvVImr8D/Bo29/waNvZMdK77/Bo29/waNvZMdK77/Bo29/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPZMdK77/Bo29/waNPZMdK77/Bo09/waNvZMdK77/Bo09/waNvZMdK77/Bo29/waNPZMdK77/Bo29/waNvVImr8D/Bo09cooOO1Imr8BAMTI7/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09l+KKPVImr8D/Bo09/waNPVImr8D/Bo09AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/cCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAAAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAADAPgAAQD8AAMA+AACAP2L1Hz8AAIA/AAAgP3uDfz8AACA/AABAPwAAwD4AAIA+AAAgPwAAAAAAAMA+AAAAAAAAwD4AAIA/AAAgPwAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAAD8AAMA+AACAPgAAAD4AAIA+AADAPgAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAQD8AACA/AAAAPwAAwD4AAAA/AADAPgAAAD8AAMA+AABAPwAAID8AAEA/AAAgPwAAAD9i9R8/AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAgD4AACA/AACAPgAAID8AAAAAAADAPgAAAAAAAAA+AAAAPwAAwD4AAAA/AADAPgAAgD4AAAA+AACAPgAAID8AAAA/vAJBP/mGwj4AACA/AACAPgAAYD8AAIA+AAAgPwAAgD97g18/AAAAPwAAYD8AAAA/AAABAAIAAgADAAQAAgAEAAAABQAGAAcACAAJAAoACwAMAA0ACwANAA4ADwAQABEAEgATABQAFQAWABcAFwAYABkAFwAZABUAGgAbABwAGgAcAB0AHgAfACAAHgAgACEAIgAjACQAIgAkACUAJgAnACgAKAAnACkAAwACACoAKQAnACsAKQArACwAJwAmACsA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:540,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:540,byteOffset:540,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:360,byteOffset:1080,byteStride:8,target:34962},{name:"bufferView_3",buffer:0,byteLength:144,byteOffset:1440,target:34963}],materials:[{name:"Material.001",pbrMetallicRoughness:{baseColorFactor:[.8,.8,.8,1],metallicFactor:0,roughnessFactor:.676000006},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Cube.001-Mesh",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0,mode:4}]}],nodes:[{name:"Cube.001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},jiantou:{accessors:[{name:"��ͷ_1_0_positions",componentType:5126,count:7,min:[-.47690001130104065,-.8044000267982483,0],max:[.47780001163482666,0,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"��ͷ_1_0_normals",componentType:5126,count:7,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"��ͷ_1_0_indices",componentType:5123,count:15,min:[0],max:[6],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"jiantou",byteLength:200,uri:"data:application/octet-stream;base64,bxIDOintTb8AAAAAH/RsvsKGp74AAAAAPSz0vsKGp74AAAAANs17PsKGp74AAAAANKL0PsKGp74AAAAANs17PgAAAAAAAAAAH/RsvgAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAADAAEAAAAEAAMAAQAFAAYAAQADAAUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:84,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:84,byteOffset:84,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:32,byteOffset:168,target:34963}],materials:[{name:"SVGMat_003",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"��ͷ_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"��ͷ",mesh:0}],scene:0,scenes:[{nodes:[0]}]},xuanzhuan:{accessors:[{name:"��ת001_1_0_positions",componentType:5126,count:369,min:[-6.572299957275391,-7.298999786376953,0],max:[6.5742998123168945,7.298299789428711,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"��ת001_1_0_normals",componentType:5126,count:369,min:[0,-1,0],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"��ת001_1_0_indices",componentType:5123,count:1089,min:[0],max:[368],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"旋转-新",byteLength:11036,uri:"data:application/octet-stream;base64,1zQDwHql3kAAAAAA48e4vgMJ1kAAAAAAQmD1v6yL6UAAAAAA2qxqv1Fr0EAAAAAAVHSkvnuD1UAAAAAAF7eRvjXv1EAAAAAAyeV/vqVO1EAAAAAA5INevsuh00AAAAAAW7E/vpHt0kAAAAAAZogjvoMv0kAAAAAAAwkKvrpr0UAAAAAA+aDnvTSi0EAAAAAAXCDBvWfVz0AAAAAAqoLZv4NRy0AAAAAALv+hvfcGz0AAAAAAAwmKvVg5zkAAAAAA/Yd0vYtszUAAAAAAak1zvSBBzUAAAAAA1xJyveQUzUAAAAAAIEFxvTLmzEAAAAAARdhwvd21zEAAAAAARdhwvbaEzEAAAAAAIEFxvb1SzEAAAAAAs3tyvSEfzEAAAAAARrZzvYXry0AAAAAAayt2vRe3y0AAAAAAkKB4vQaBy0AAAAAASFB8vfVKy0AAAAAAhXwcwLRZw0AAAAAAbjSAveQUy0AAAAAA3EaDvcX+ykAAAAAAb/CFvTLmykAAAAAAcM6IvRTQykAAAAAAcayLvSS5ykAAAAAAcoqOvQWjykAAAAAA4XqUvWx4ykAAAAAAUI2XvSBjykAAAAAACD2bvQFNykAAAAAAUrievbU3ykAAAAAAeJyivTojykAAAAAA5x2nve0NykAAAAAAMCqpvaMBykAAAAAAVp+rvVr1yUAAAAAAexSuvbPqyUAAAAAAxSCwvTvfyUAAAAAA6pWyvfLSyUAAAAAAoda0vUvIyUAAAAAAx0u3vQK8yUAAAAAAWvW5vVuxyUAAAAAA7Z68vYenyUAAAAAA7ny/veCcyUAAAAAAgSbCvQyTyUAAAAAAgQTFvQmKyUAAAAAA1CvlvRUdyUAAAAAAXW0FviS5yEAAAAAALNQavjVeyEAAAAAADi0yvqYKyEAAAAAAlkNLvki/x0AAAAAA5q5lvhx8x0AAAAAAZaqAvqs+x0AAAAAA4L6OvsgHx0AAAAAAyAedvnPXxkAAAAAAlkOrvqytxkAAAAAAEFi5vs6IxkAAAAAAH4XLvpVlxkAAAAAAAwnKvjhnxkAAAAAA54zIvjhnxkAAAAAAsAPHvgpoxkAAAAAAOwHNvsNkxkAAAAAAO3DOvvFjxkAAAAAA0ETYvpJcxkAAAAAAV+zPvk5ixkAAAAAAV1vRvtlfxkAAAAAAWMrSvgdfxkAAAAAAWDnUvmRdxkAAAAAAIo7VvpJcxkAAAAAA6+LWvpJcxkAAAAAAiIXavgRWxkAAAAAAJLncvkhQxkAAAAAA2/nevl5LxkAAAAAAkzrhvhdIxkAAAAAASnvjvtBExkAAAAAAMzPzvoY4xkAAAAAAArzlvrhAxkAAAAAAufznvkI+xkAAAAAAcT3qvs07xkAAAAAAKH7svlg5xkAAAAAAxLHuvoY4xkAAAAAAfPLwvoY4xkAAAAAA9Gz2vsoyxkAAAAAAtab5vj0sxkAAAAAAduD8vlInxkAAAAAAqRMAvzojxkAAAAAApb0Bv08exkAAAAAAE2EDvzcaxkAAAAAAnREFv00VxkAAAAAAC7UGvzQRxkAAAAAAlWUIv0oMxkAAAAAAHhYKv18HxkAAAAAAGsALv6MBxkAAAAAADk8Pv7n8xUAAAAAAgEgPv7n8xUAAAAAApHANv7n8xUAAAAAAUwWrv90kwkAAAAAASS4Pv7n8xUAAAAAApHANv7n8xUAAAAAAgEgPv7n8xUAAAAAA9wYPv7n8xUAAAAAAidIOv7n8xUAAAAAAG54Ov7n8xUAAAAAAIGMOv7n8xUAAAAAAJCgOv7n8xUAAAAAAKe0Nv7n8xUAAAAAASL8Nv7n8xUAAAAAA9pcNv7n8xUAAAAAAv30Nv7n8xUAAAAAABoFJwDm0uEAAAAAAZvcEwJtVu0AAAAAAwcoxwOzAsUAAAAAARiUFQFdbu8AAAAAAdZMcQM9mw8AAAAAA9pdJQIPAuMAAAAAAtvMxQEvIscAAAAAA2IFzQISeq8AAAAAAjLlbQECkpcAAAAAAZveMQPkxnMAAAAAAPQqBQNEil8AAAAAA+zqeQJOpisAAAAAAdk+SQPd1hsAAAAAAA3ihQFafZ8AAAAAAnl6tQN5xbsAAAAAAsi66QCEfRMAAAAAASFCuQLTIPsAAAAAA4XrEQPW5FsAAAAAAHqe4QJ/NEsAAAAAA1xLMQJhMzb8AAAAA6UjAQFInyL8AAAAAnMTQQM4ZUb8AAAAAsAPFQKMBTL8AAAAAduCMwKMjWcAAAAAA9P1wwOauOcAAAAAA6GqDwG1WGcAAAAAA46WZwA5PM8AAAAAANKLGQBe30TkAAAAAqmDSQBe30TkAAAAAdQLMwEYlzT8AAAAALUPAwAAAyD8AAAAAvp+4wFK4EkAAAAAArWnEwAWjFkAAAAAAF0iuwGizPkAAAAAATx66wI4GREAAAAAAXW2hwAmKZ0AAAAAAPE6twEtZbkAAAAAAW0KSwFFrhkAAAAAAayuewO2eikAAAAAAUPyAwPwYl0AAAAAA1eeMwK8lnEAAAAAAyJhbwA+cpUAAAAAAoWdzwDqSq0AAAAAA6GqrP8cpwsAAAAAA+zoQP6MBxsAAAAAAbqPZPxNhy8AAAAAAYHYPPxsNxsAAAAAAukkMPzQRxsAAAAAA0gAOPxsNxsAAAAAARPoNPxsNxsAAAAAAexQOPxsNxsAAAAAAPzUOPxsNxsAAAAAAIGMOPxsNxsAAAAAAcooOPxsNxsAAAAAAUrgOPxsNxsAAAAAAMuYOPxsNxsAAAAAAoBoPPxsNxsAAAAAAZDsPPxsNxsAAAAAAKVwPPxsNxsAAAAAA0m8PPxsNxsAAAAAAMZkKP00VxsAAAAAAp+gIPzcaxsAAAAAAqz4HPyEfxsAAAAAAIo4FP90kxsAAAAAAmN0DP2srxsAAAAAADi0CPycxxsAAAAAAhXwAP+M2xsAAAAAA9pf9PnE9xsAAAAAA/kP6PltCxsAAAAAA6+L2PqJFxsAAAAAA2IHzPulIxsAAAAAAc2jxPl5LxsAAAAAADk/vPtNNxsAAAAAAqDXtPkhQxsAAAAAAKA/rPr1SxsAAAAAAjNvoPmFUxsAAAAAAC7XmPjJVxsAAAAAAVHTkPgRWxsAAAAAA003iPnlYxsAAAAAAGw3gPh1axsAAAAAAZMzdPpJcxsAAAAAArIvbPgdfxsAAAAAA9UrZPnxhxsAAAAAA2c7XPvFjxsAAAAAA2V/WPpVlxsAAAAAA2PDUPgpoxsAAAAAA847TPn9qxsAAAAAA8x/SPiJsxsAAAAAA8rDQPvRsxsAAAAAA8kHPPphuxsAAAAAAKe3NPg1xxsAAAAAAKH7MPt5xxsAAAAAADALLPlR0xsAAAAAADJPJPsl2xsAAAAAA8BbIPj55xsAAAAAA4za6PryWxsAAAAAATRWsPvW5xsAAAAAASL+dPuvixsAAAAAAYHaPPp0Rx8AAAAAA5WGBPgtGx8AAAAAAi2xnPtiBx8AAAAAAOwFNPtbFx8AAAAAA6gQ0PmIQyMAAAAAAP8YcPiBjyMAAAAAA3pMHPrG/yMAAAAAAZ0TpPdEiycAAAAAAg1HJPcWPycAAAAAAy6HFPQ+cycAAAAAA7lrCPYenycAAAAAAEhS/PdCzycAAAAAAowG8PRrAycAAAAAAEFi5PZLLycAAAAAAfa62PdzXycAAAAAA6gS0PVTjycAAAAAAxY+xPZ7vycAAAAAADk+vPef7ycAAAAAA6NmsPV8HysAAAAAAn82qPakTysAAAAAAeVioPfMfysAAAAAAwaikPT81ysAAAAAA5WGhPYxKysAAAAAACRuePapgysAAAAAACD2bPcl2ysAAAAAAB1+YPbmNysAAAAAAdLWVPamkysAAAAAAvJaQPVvTysAAAAAABFaOPRzrysAAAAAA3+CLPd4Cy8AAAAAAldSJPXEby8AAAAAAcF+HPTMzy8AAAAAA3bWEPc9my8AAAAAALNRqP1Z90MAAAAAAuECCPciYy8AAAAAA3GiAPZLLy8AAAAAAtvN9PS7/y8AAAAAASFB8PScxzMAAAAAA/kN6PSBjzMAAAAAAI9t5PUaUzMAAAAAAI9t5PRHHzMAAAAAAI9t5PTj4zMAAAAAA/kN6PV8pzcAAAAAAkX57PYZazcAAAAAAJLl8PQmKzcAAAAAAcoqOPdZWzsAAAAAAMEymPaMjz8AAAAAAXW3FPZ7vz8AAAAAAjLnrPfW50MAAAAAAqz4DQN213sAAAAAAgy8MPmN/0cAAAAAA5q4lPrhA0sAAAAAAE/JBPn/70sAAAAAAnMRgPhSu08AAAAAAJQaBPnlY1MAAAAAAPL2SPpT21MAAAAAAeHqlPgmK1cAAAAAAhxa5Pr8O1sAAAAAA63P1P2iR6cAAAAAApb1Bv4xKsEAAAAAAMlVAP4xKsEAAAAAAw2QquxDpsUAAAAAAMne9v/OOq0AAAAAA3bW8P/OOq0AAAAAAYqEKwG/wo0AAAAAAcT0KQG/wo0AAAAAA/7IzwG6jmUAAAAAAak0zQG6jmUAAAAAA8IVZwAHejEAAAAAAHcklvw6+lkAAAAAAw2Qqu8UgmEAAAAAAxm0kPw6+lkAAAAAAuB5ZQAHejEAAAAAAc2ihP5aykkAAAAAA1xKiv5aykkAAAAAAKH7sP+AtjEAAAAAAjSjtv+AtjEAAAAAAuK97wBSue0AAAAAAOUV7QBSue0AAAAAAnl4ZQHBfg0AAAAAAdLUZwHBfg0AAAAAAXro5QGDlcEAAAAAA7Q06wGDlcEAAAAAAduCMwPCFWUAAAAAAZaqMQPCFWUAAAAAAqvFWQJAxV0AAAAAA3EZXwJAxV0AAAAAA46WZwEa2M0AAAAAA0m+ZQEa2M0AAAAAAHqdwQIv9OUAAAAAA9P1wwIv9OUAAAAAAIEGDQLWmGUAAAAAA6GqDwLWmGUAAAAAAnzyMwMZt7L8AAAAAiPSjwHE9CsAAAAAAIEGDQG1WGcAAAAAA0m+ZQA5PM8AAAAAA07yjQHE9CsAAAAAANBGMQMZt7L8AAAAA+1yrQAisvL8AAAAA6pWSQBBYob8AAAAAOpKrwAisvL8AAAAAVcGSwBBYob8AAAAA+8uWwI9TJL8AAAAA002wwG40QL8AAAAAYqGWQMbcJT8AAAAA8BawQPfkQT8AAAAA+1yrQE2EvT8AAAAA6pWSQJEPoj8AAAAAVTCYwInSXjsAAAAA+u2xwInSXjsAAAAA6gSYQInSXjsAAAAARraxQInSXjsAAAAAObTQwEXYUD8AAAAAIv3EwBrASz8AAAAAYqGWQI9TJL8AAAAA8BawQG40QL8AAAAA+8uWwMbcJT8AAAAA002wwPfkQT8AAAAAVcGSwJEPoj8AAAAAOpKrwE2EvT8AAAAAnzyMwOQU7T8AAAAAiPSjwEymCkAAAAAA07yjQEymCkAAAAAANBGMQOQU7T8AAAAAHqdwQOauOcAAAAAAZaqMQKMjWcAAAAAA3EZXwOviVsAAAAAAqvFWQOviVsAAAAAA7Q06wLyWcMAAAAAAXro5QLyWcMAAAAAAOUV7QMdLe8AAAAAAuK97wMdLe8AAAAAAdLUZwHo2g8AAAAAAnl4ZQHo2g8AAAAAAuB5ZQE+vjMAAAAAA8IVZwE+vjMAAAAAAjSjtv+oEjMAAAAAAKH7sP+oEjMAAAAAA1xKiv86IksAAAAAAc2ihP86IksAAAAAAak0zQGB2mcAAAAAA/7IzwGB2mcAAAAAAHcklv0aUlsAAAAAAxm0kP0aUlsAAAAAAw2Qqu/32l8AAAAAAcT0KQDPEo8AAAAAAYqEKwDPEo8AAAAAA3bW8P4hjq8AAAAAAMne9v4hjq8AAAAAAMlVAPyEfsMAAAAAApb1BvyEfsMAAAAAAw2Qqu3e+scAAAAAASFDSwG8Sg7oAAAAASZ3GwG8Sg7oAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAwABAAAAAwAEAAEAAwAFAAQAAwAGAAUAAwAHAAYAAwAIAAcAAwAJAAgAAwAKAAkAAwALAAoAAwAMAAsADQAMAAMADQAOAAwADQAPAA4ADQAQAA8ADQARABAADQASABEADQATABIADQAUABMADQAVABQADQAWABUADQAXABYADQAYABcADQAZABgADQAaABkADQAbABoAHAAbAA0AHAAdABsAHAAeAB0AHAAfAB4AHAAgAB8AHAAhACAAHAAiACEAHAAjACIAHAAkACMAHAAlACQAHAAmACUAHAAnACYAHAAoACcAHAApACgAHAAqACkAHAArACoAHAAsACsAHAAtACwAHAAuAC0AHAAvAC4AHAAwAC8AHAAxADAAHAAyADEAHAAzADIAHAA0ADMAHAA1ADQAHAA2ADUAHAA3ADYAHAA4ADcAHAA5ADgAHAA6ADkAHAA7ADoAHAA8ADsAHAA9ADwAHAA+AD0AHAA/AD4AHABAAD8AQABBAD8AQQBCAD8AQgBDAD8AHABAAEQAHABEAEUAHABGAEUARgBHAEUARgBIAEcARgBJAEgARgBKAEkARgBLAEoARgBMAEsAHABNAEYAHABOAE0AHABPAE4AHABQAE8AHABRAFAAHABSAFEAUgBTAFEAUgBUAFMAUgBVAFQAUgBWAFUAUgBXAFYAUgBYAFcAHABZAFIAHABaAFkAHABbAFoAHABcAFsAHABdAFwAHABeAF0AHABfAF4AHABgAF8AHABhAGAAHABiAGEAHABjAGIAHABjAGQAZABlAGMAZQBmAGMAHABnAGQAaABpAGoAawBpAGgAbABpAGsAbQBpAGwAbgBpAG0AbwBpAG4AcABpAG8AcQBpAHAAcgBpAHEAcwBpAHIAdABnABwAdAB1AGcAdAB2AHUAdwB4AHkAdwB5AHoAegB5AHsAegB7AHwAfAB7AH0AfAB9AH4AfgB9AH8AfgB/AIAAgQCCAIMAgQCDAIQAhACDAIUAhACFAIYAhgCFAIcAhgCHAIgAiACHAIkAiACJAIoAiwCMAI0AiwCNAI4AjwCKAJAAigCJAJAAkQCSAJMAkQCTAJQAlACTAJUAlACVAJYAlgCVAJcAlgCXAJgAgAB/AIIAgACCAIEAmACXAJkAmACZAJoAmgCZAJsAmgCbAJwAnACbAJ0AnACdAJ4AngCdAHYAngB2AHQAnwB4AHcAoAB4AJ8AoAChAHgAogChAKAAowCkAKUAowCmAKQAowCnAKYAowCoAKcAowCpAKgAowCqAKkAowCrAKoAowCsAKsAowCtAKwAowCuAK0AowCvAK4AowCiAK8AowChAKIAsAChAKMAsQChALAAsgChALEAswChALIAtAChALMAtQChALQAtgChALUAtwChALYAuAChALcAuQChALgAugChALkAuwChALoAvAChALsAvQChALwAvgChAL0AvwChAL4AwAChAL8AwQChAMAAwgChAMEAwwChAMIAxAChAMMAxQChAMQAxgChAMUAxwChAMYAyAChAMcAyQChAMgAygChAMkAywChAMoAzAChAMsAzQChAMwAzgChAM0AzwChAM4A0AChAM8A0QChANAA0gChANEA0wChANIA1AChANMA1QChANQA1gChANUA1wChANYA2AChANcA2QChANgA2gChANkA2wChANoA3AChANsA3QChANwA3gChAN0A3wChAN4A4AChAN8A4QChAOAA4gChAOEA4wChAOIA5AChAOMA5QChAOQA5gChAOUA5wChAOYA6AChAOcA6QChAOgA6gChAOkA6wChAOoA7AChAOsA7QChAOwA7gChAO0A7wChAO4A8AChAO8A8QChAO8A8gChAPEA8wChAPIA9AChAPMA9QChAPQA9gChAPUA9gD3AKEA+AD3APYA+QD3APgA+gD3APkA+wD3APoA/AD3APsA/QD3APwA/gD3AP0A/wD3AP4AAAH3AP8AAQH3AAABAgH3AAEBAwH3AAIBBAH3AAMBBQH3AAQBBgH3AAUBBgEHAfcACAEHAQYBCQEHAQgBCgEHAQkBCwEHAQoBDAEHAQsBDQEHAQwBDgEHAQ0BDwEHAQ4BEAEHAQ8BEQESARMBFAESAREBFAEVARIBFgEVARQBFgEXARUBGAEXARYBGAEZARcBGgEbARgBGwEcARgBHAEZARgBHAEdARkBHQEeARkBHwEeAR0BGgEgARsBIQEeAR8BGgEiASABIwEiARoBIQEkAR4BJQEkASEBIwEmASIBJwEkASUBIwEoASYBKQEoASMBJwEqASQBKwEqAScBKQEsASgBLQEsASkBKwEuASoBLwEuASsBLQEwASwBMQEuAS8BLQEyATABjgCNADMBjgAzATQBNQE2ATcBNQE3ATgBOAE3ATkBOAE5AToBOwE8AT0BOwE9AT4BPwFAAUEBPwFBAUIBPgE9AUMBPgFDAUQBRQFGAUABRQFAAT8BRwFIAZIARwGSAJEASQFKAUYBSQFGAUUBRAFDAUsBRAFLAUwBOgE5AUoBOgFKAUkBTAFLAU0BTAFNAU4BTgFNAU8BTgFPAVABQgFBAVEBQgFRAVIBUgFRAS4BUgEuATEBNAEzATwBNAE8ATsBUwFUATYBUwE2ATUBUAFPATIBUAEyAS0BiwBVAYwAVgFUAVMBiwBXAVUBWAFUAVYBWAFZAVQBWgFXAYsAWgFbAVcBXAFZAVgBXAFdAVkBXgFbAVoBXgFfAVsBYAFdAVwBXgFhAV8BYgFdAWABYgFjAV0BZAFhAV4BZAFlAWEBZgFjAWIBZAFnAWUBZwFjAWYBZAFjAWcBZAFoAWMBaQFoAWQBaQFqAWgBawFqAWkBawFsAWoBbQFsAWsBbQFuAWwBbwFwAUgBbwFIAUcBAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:4428,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:4428,byteOffset:4428,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:2180,byteOffset:8856,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"��ת001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"��ת001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},plane:{accessors:[{name:"Rectangle001_1_0_positions",componentType:5126,count:4,min:[-5,-5,0],max:[5,5,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"Rectangle001_1_0_normals",componentType:5126,count:4,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Rectangle001_1_0_indices",componentType:5123,count:6,min:[0],max:[3],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"plane",byteLength:108,uri:"data:application/octet-stream;base64,AACgQAAAoEAAAAAAAACgwAAAoEAAAAAAAACgwAAAoMAAAAAAAACgQAAAoMAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAgADAAAA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:48,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:48,byteOffset:48,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:12,byteOffset:96,target:34963}],materials:[{name:"wire_225198087",pbrMetallicRoughness:{baseColorFactor:[.8824,.7765,.3412,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Rectangle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Rectangle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},xyzScale:{asset:{generator:"Khronos glTF Blender I/O v1.6.16",version:"2.0"},scene:0,scenes:[{name:"Scene",nodes:[0,1,2,3,4,5,6]}],nodes:[{mesh:0,name:"Cube",scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:1,name:"Cube.001",scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:2,name:"Cube.004",rotation:[0,-.7071068286895752,0,.7071068286895752],scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:3,name:"Cube.003",rotation:[0,-.7071068286895752,0,.7071068286895752],scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:4,name:"Cube.006",rotation:[0,0,.7071068286895752,.7071068286895752],scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:5,name:"Cube.005",rotation:[0,0,.7071068286895752,.7071068286895752],scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:6,name:"Cube.002",scale:[.10000000149011612,.10000000149011612,.10000000149011612]}],materials:[{doubleSided:!0,name:"Material",pbrMetallicRoughness:{baseColorFactor:[.6938720345497131,.020288480445742607,.011612260714173317,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.001",pbrMetallicRoughness:{baseColorFactor:[.6938720345497131,.020288480445742607,.011612260714173317,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.002",pbrMetallicRoughness:{baseColorFactor:[.626582869887352,.626582869887352,.626582869887352,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.006",pbrMetallicRoughness:{baseColorFactor:[.11193240433931351,.5583405494689941,.033104799687862396,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.005",pbrMetallicRoughness:{baseColorFactor:[.11193240433931351,.5583405494689941,.033104799687862396,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.010",pbrMetallicRoughness:{baseColorFactor:[.004391402006149292,.21223078668117523,.5209956169128418,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.009",pbrMetallicRoughness:{baseColorFactor:[.004391402006149292,.21223078668117523,.5209956169128418,1],metallicFactor:0,roughnessFactor:.4000000059604645}}],meshes:[{name:"Cube",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0}]},{name:"Cube.001",primitives:[{attributes:{POSITION:4,NORMAL:5,TEXCOORD_0:6},indices:3,material:1}]},{name:"Cube.006",primitives:[{attributes:{POSITION:10,NORMAL:11,TEXCOORD_0:12},indices:3,material:3}]},{name:"Cube.005",primitives:[{attributes:{POSITION:13,NORMAL:14,TEXCOORD_0:15},indices:3,material:4}]},{name:"Cube.010",primitives:[{attributes:{POSITION:16,NORMAL:17,TEXCOORD_0:18},indices:3,material:5}]},{name:"Cube.009",primitives:[{attributes:{POSITION:19,NORMAL:20,TEXCOORD_0:21},indices:3,material:6}]},{name:"Cube.002",primitives:[{attributes:{POSITION:7,NORMAL:8,TEXCOORD_0:9},indices:3,material:2}]}],accessors:[{bufferView:0,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:1,componentType:5126,count:24,type:"VEC3"},{bufferView:2,componentType:5126,count:24,type:"VEC2"},{bufferView:3,componentType:5123,count:36,type:"SCALAR"},{bufferView:4,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:5,componentType:5126,count:24,type:"VEC3"},{bufferView:6,componentType:5126,count:24,type:"VEC2"},{bufferView:7,componentType:5126,count:24,max:[1,1,1],min:[-1,-1,-1],type:"VEC3"},{bufferView:8,componentType:5126,count:24,type:"VEC3"},{bufferView:9,componentType:5126,count:24,type:"VEC2"},{bufferView:10,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:11,componentType:5126,count:24,type:"VEC3"},{bufferView:12,componentType:5126,count:24,type:"VEC2"},{bufferView:13,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:14,componentType:5126,count:24,type:"VEC3"},{bufferView:15,componentType:5126,count:24,type:"VEC2"},{bufferView:16,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:17,componentType:5126,count:24,type:"VEC3"},{bufferView:18,componentType:5126,count:24,type:"VEC2"},{bufferView:19,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:20,componentType:5126,count:24,type:"VEC3"},{bufferView:21,componentType:5126,count:24,type:"VEC2"}],bufferViews:[{buffer:0,byteLength:288,byteOffset:0},{buffer:0,byteLength:288,byteOffset:288},{buffer:0,byteLength:192,byteOffset:576},{buffer:0,byteLength:72,byteOffset:768},{buffer:0,byteLength:288,byteOffset:840},{buffer:0,byteLength:288,byteOffset:1128},{buffer:0,byteLength:192,byteOffset:1416},{buffer:0,byteLength:288,byteOffset:1608},{buffer:0,byteLength:288,byteOffset:1896},{buffer:0,byteLength:192,byteOffset:2184},{buffer:0,byteLength:288,byteOffset:2376},{buffer:0,byteLength:288,byteOffset:2664},{buffer:0,byteLength:192,byteOffset:2952},{buffer:0,byteLength:288,byteOffset:3144},{buffer:0,byteLength:288,byteOffset:3432},{buffer:0,byteLength:192,byteOffset:3720},{buffer:0,byteLength:288,byteOffset:3912},{buffer:0,byteLength:288,byteOffset:4200},{buffer:0,byteLength:192,byteOffset:4488},{buffer:0,byteLength:288,byteOffset:4680},{buffer:0,byteLength:288,byteOffset:4968},{buffer:0,byteLength:192,byteOffset:5256}],buffers:[{byteLength:5448,uri:"data:application/octet-stream;base64,6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAQAOABQAAQAUAAcACgAGABMACgATABcAFQASAAwAFQAMAA8AEAADAAkAEAAJABYABQACAAgABQAIAAsAEQANAAAAEQAAAAQAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAACAPwAAgD8AAIC/AACAPwAAgD8AAIC/AACAPwAAgD8AAIC/AACAPwAAgL8AAIC/AACAPwAAgL8AAIC/AACAPwAAgL8AAIC/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgL8AAIA/AACAPwAAgL8AAIA/AACAPwAAgL8AAIA/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA"}]}};function yit(t,e,n,i,r,o){const s=[],a=tg([],Sm([],n[0],n[1],n[2]),e,i);var h;return(h=t,new vP.GLTFLoader("",JSON.parse(JSON.stringify(mit[h]))).load().then((t=>t))).then((t=>{yb.exportGLTFPack(t).getMeshesInfo().forEach(((t,h)=>{const l=new T_({color:r||t.materialInfo.baseColorFactor}),u=new z_(t.geometry,l);u.setUniform("uPickingId",o+h);const c=u.getDefines();c.HAS_PICKING_ID=2,u.setDefines(c),u.translate=e,u.rotation=n,u.scaling=i,Hp(u.localTransform,a,t.nodeMatrix),u.originTransform=Fp([],u.localTransform),u.originColor=r||t.materialInfo.baseColorFactor,s.push(u)})),o>100&&(s[0].properties.relatedMeshes=s.slice(1,2),s[1].properties.relatedMeshes=s.slice(0,1),s[2].properties.relatedMeshes=s.slice(3,4),s[3].properties.relatedMeshes=s.slice(2,3),s[4].properties.relatedMeshes=s.slice(5,6),s[5].properties.relatedMeshes=s.slice(4,5),s[6].properties.relatedMeshes=s.slice(0,6))})),s}function vit(t,e){return Math.abs(t)*Math.sign(e)}function _it(t,e){const n=t.getCoordinates(),i=e.coordinateToPointAtRes(n,e.getGLRes()),r=[i.x,i.y,0];gg(r,r,xit(e,t.getTranslation()));const o=(s=e,a=new $0(r[0],r[1]),h=e.getGLRes(),s._pointAtResToContainerPoint(a,h,void 0));var s,a,h;o.x+=85;const l=function(t,e,n){{const i=t.containerPointToCoordinate(e);return t.coordinateToPointAtRes(i,n)}}(e,o,e.getGLRes());return Math.sqrt(Math.pow(l.x-r[0],2)+Math.pow(l.y-r[1],2))/5.272881136101205}function xit(t,e){if(!t)return e;const n=t.distanceToPointAtRes(e[0],e[1],t.getGLRes()),i=t.altitudeToPoint(e[2],t.getGLRes());return pg([],vit(n.x,e[0]),vit(n.y,e[1]),vit(i,e[2]))}let bit=class{constructor(t){this.A=t,this._meshes=this.t()}setCoordinate(t){this.A=t}t(){const t=[],e=340/177,n=yit("jiantou",[1.2*e,0,0],[0,0,90],[e,e,e],[89/255,206/255,147/255,0],7),i=yit("jiantou",[0,1.2*e,0],[0,0,180],[e,e,e],[89/255,206/255,147/255,0],8),r=yit("jiantou",[-1.2*e,0,0],[0,0,270],[e,e,e],[89/255,206/255,147/255,0],9),o=yit("jiantou",[0,-1.2*e,0],[0,0,0],[e,e,e],[89/255,206/255,147/255,0],10);return t.push(n,i,r,o),t}getMeshes(){return this._meshes}},wit=class{constructor(t){this.A=t,this._meshes=this.t()}setCoordinate(t){this.A=t}t(){const t=[],e=340/177,n=yit("xuanzhuan",[0,0,0],[180,0,0],[.5*e,.5*e,.5*e],[50/255,130/255,184/255,.8],11);return t.push(n),t}getMeshes(){return this._meshes}},Cit=class{constructor(t){this.A=t,this._meshes=this.t()}setCoordinate(t){this.A=t}t(){const t=[],e=340/177,n=yit("yuanhuan",[0,0,0],[0,0,0],[.5*e,.5*e,.5*e],[149/255,179/255,199/255,.5],12);return t.push(n),t}getMeshes(){return this._meshes}},Pit=class{constructor(t){this.A=t,this._meshes=this.t()}setCoordinate(t){this.A=t}t(){const t=[],e=yit("plane",[0,0,0],[0,0,0],[10,10,10],[1,0,0,.5],16);return t.push(e),t}getMeshes(){return this._meshes}},Mit=class{constructor(t){this.A=t,this._meshes=this.t()}setCoordinate(t){this.A=t}t(){const t=[],e=yit("xyzScale",[0,0,0],[0,0,0],[2,2,2],null,113);return t.push(e),t}getMeshes(){return this._meshes}};const Tit=[],Sit=[],Iit=[],Eit=[],Oit=[],Rit=[177/170,177/170,177/170],Dit=[],kit=[1,2,3,4,12];let Lit=class{constructor(){this.translate=new bit,this.rotation=new wit,this.scaling=new Cit,this.planeHelper=new Pit,this.xyzScaleHelper=new Mit,this._meshes=this.t(),this.i=!0}t(){const t={};t.translate=this.translate.getMeshes(),t.rotation=this.rotation.getMeshes(),t.scaling=this.scaling.getMeshes(),t.planeHelper=this.planeHelper.getMeshes(),t.xyzScale=this.xyzScaleHelper.getMeshes();const e=340/177,n=yit("yuanhuan41",[-2.745*e,2.745*e,0],[90,0,0],[.5*e,.5*e,.5*e],[149/255,179/255,199/255,.6],1),i=yit("yuanhuan41",[2.745*e,2.745*e,0],[-90,0,180],[.5*e,.5*e,.5*e],[50/255,130/255,184/255,.5],2),r=yit("yuanhuan41",[2.745*e,-2.745*e,0],[90,0,180],[.5*e,.5*e,.5*e],[149/255,179/255,199/255,.6],3),o=yit("yuanhuan41",[-2.745*e,-2.745*e,0],[-90,0,0],[.5*e,.5*e,.5*e],[50/255,130/255,184/255,.5],4),s=yit("yuanpan",[0,0,0],[90,0,0],[.5*e,.5*e,.5*e],[89/255,206/255,147/255,.5],5),a=yit("zzhou",[0,0,6.5],[90,0,0],[1,1,1],[14/255,127/255,191/255,1],6);return t.translate.push(n,i,r,o,s,a),t}updateMatrix(t,e,n,i,r){const o=e.getCoordinates(),s=t.coordinateToPointAtRes(o,t.getGLRes()),a=e.I();pg(Sit,s.x,s.y,a);const h=dg(Tit,r),l=xit(t,e.getTranslation());gg(Sit,Sit,l),gg(Sit,Sit,h);for(const u in this._meshes)for(let r=0;r<this._meshes[u].length;r++){const o=this._meshes[u][r];for(let r=0;r<o.length;r++){const s=o[r],a=s.getUniform("uPickingId"),h=dg(Tit,s.translate);let l=dg(Dit,s.rotation);const c=s.scaling;if(11===a&&(this.i?(l[2]+=n,s.rotation[2]+=n):this.i||(l[2]+=n,s.rotation[2]+=n,l[0]=360,l[2]-=90)),a>100&&1===e.getTargets().length&&(l=e.getTargets()[0].getRotation()),kit.indexOf(a)>-1)if(12!==a)c[0]+=i,c[1]+=i,c[2]+=i;else{const t=this._meshes.translate[4][0];c[0]=1.2*t.scaling[0],c[1]=1.2*t.scaling[0],c[2]=1.2*t.scaling[0]}let A=_it(e,t);if(A=pg(Iit,A,A,A),yg(h,h,A),yg(A,A,c),1===a||2===a||3===a||4===a){const t=yg(Oit,c,Rit);yg(h,h,t)}const f=Sm(Eit,l[0],l[1],l[2]);if(gg(h,h,Sit),"xyzScale"===u){const t=tg([],f,h,A);Hp(s.localTransform,t,s.originTransform)}else tg(s.localTransform,f,h,A)}}}getMeshes(t){const e={};return t?("xyzScale"===t?e[t]=this._meshes[t]:(e.translate=this._meshes.translate,"translate"!==t&&(e[t]=this._meshes[t])),e):e}o(t){this.i=t}dispose(){for(const t in this._meshes)for(let e=0;e<this._meshes[t].length;e++){const n=this._meshes[t][e];for(let t=0;t<n.length;t++){const e=n[t];e.geometry.dispose(),e.dispose()}}}};const Fit=[],Nit=[],zit=[],Bit=new $0(0,0),Hit=[],jit=[],Uit=[],Git=[0,0,0];let Vit=class{constructor(){this.C=[],this.h=[0,0,0],this.l=[1,1,1],this.P=[0,0,0]}D(t){Array.isArray(t)?t.forEach((t=>{this.D(t)})):(t.on("remove",this.u,this),t.m={coordinate:t.getCoordinates(),translation:t.getTranslation(),rotation:t.getRotation(),scale:t.getScale()},this.C.push(t))}B(){this.C.forEach((t=>{t.off("remove",this.u,this)})),this.C=[]}p(t,e,n,i,r,o,s){for(let a=0;a<this.C.length;a++){const s=this.C[a],h=s.getRotation(),l=s.getScale(),u=this.v(o,s,i,n,e);let c=null;c=i>=0?i:i*(this.options&&this.options.scaleStrength||1);const A=gg(Uit,pg(Fit,c*l[0],c*l[1],c*l[2]),l),f=Math.min(...A);if(Math.abs(f)<r){const t=Math.abs(f);A[0]=A[0]*(r/t),A[1]=A[1]*(r/t),A[2]=A[2]*(r/t)}const d=gg(h,n,h);s.setCoordinates(u),this.L(t,A,l);const p=s.getTranslation();s.setTRS(p,d,A)}pg(Uit,i,i,i),gg(this.P,n,this.P),gg(this.l,Uit,this.l),gg(this.h,e,this.h),t.indexOf("translate")>-1?s.fire("positionchange",{action:t,type:"positionchange",target:this.C,center:this.getCoordinates(),scale:this.l,rotation:this.P,translation:this.h,deltaTranslate:e,deltaRotation:n,deltaScale:i}):s.fire("transforming",{action:t,type:"transforming",target:this.C,center:this.C[0].getTransformOrigin(),scale:this.l,rotation:this.P,translation:this.h,deltaTranslate:e,deltaRotation:n,deltaScale:i})}v(t,e,n,i,r){const o=e.getCenter(),s=e.getTransformOrigin(),a=t.getGLRes(),h=t.coordinateToPointAtRes(o,a,Bit);h.z=t.altitudeToPoint(o.z,a),pg(Hit,h.x,h.y,h.z||0);const l=t.coordinateToPointAtRes(s,a,Bit);l.z=t.altitudeToPoint(s.z,a),pg(jit,l.x,l.y,l.z||0);const u=Dg(Fit,Hit,jit),c=Sm(Nit,0,0,i[2]);pg(Uit,n+1,n+1,n+1),Sg(u,u,tg(zit,c,r,Uit)),gg(u,u,jit),Bit.set(u[0],u[1]);const A=t.pointAtResToCoordinate(Bit,a);return A.z=u[2]/t.altitudeToPoint(1,a),A}L(t,e,n){return"x-scale"===t&&(e[1]=n[1],e[2]=n[2]),"y-scale"===t&&(e[0]=n[0],e[2]=n[2]),"z-scale"===t&&(e[0]=n[0],e[1]=n[1]),e}M(){this.C.forEach((t=>{if(t.m){const{coordinate:e,translation:n,rotation:i,scale:r}=t.m;t.setCoordinates(e),t.setTRS(n,i,r)}}))}getScale(){return this.l}getTranslation(){return 1===this.C.length&&this.C[0].getTranslation()||Git}getRotation(){return this.P}O(){return this.C[0]?this.C[0].getLayer():null}getCoordinates(){let t=0,e=0,n=0;const i=this.C.length;if(!i)return null;for(let o=0;o<i;o++){const i=this.C[o].getCenter();t+=i.x,e+=i.y,n+=i.z||0}t/=i,e/=i,n/=i;const r=new F4(t,e,n);for(let o=0;o<i;o++)this.C[o].setTransformOrigin(r);return r}u(t){const e=t.target,n=this.C.indexOf(e);n>-1&&(delete e.m,this.C.splice(n,1))}getTargets(){return this.C}I(){let t=0;const e=this.C.length;for(let n=0;n<e;n++)t+=this.C[n].getPointZ();return t/=e,t}F(){for(let t=0;t<this.C.length;t++)if(this.C[t].isVisible())return!0;return!1}};const Wit=[5,6,7,8,9,10],qit=[5,7,8,9,10],Zit=[2,4,11],Qit=[1,3,12],Xit=[12,16],Yit=[1,2,3,4],Jit=[1,2,3,4,12],Kit=[],$it=[],trt=[],ert=[],nrt=[],irt=[],rrt=[];let ort=class extends(Q3(O4(Y3))){constructor(t={}){super(t),this.options=t,this.mouseAction="moving",this.U=this.options.mode||"translate",this.V=!0,this.TransformHelper=new Lit,this.S=new Vit,this.helperScene=new Y_([]),this.addToMapCount=0,this.k()}setCoordinates(t){this.T.setCoordinates(t),this.transform(this.T)}enable(){return this.V=!0,this.layerRenderer&&this.layerRenderer.setToRedraw(),this}disable(){return this.V=!1,this.layerRenderer&&this.layerRenderer.setToRedraw(),this.map&&this.map.resetCursor(),this}setMode(t){this.U=t,this.H(),this.layerRenderer&&this.layerRenderer.setToRedraw(),this.fire("modechange",{mode:t,type:"modechange"})}getMode(){return this.U}isEnable(){return this.V}J(t){Wit.indexOf(t)>-1?this.U="translate":Zit.indexOf(t)>-1?this.U="rotation":Qit.indexOf(t)>-1?this.U="scaling":"xyzScale"!==this.U&&(this.U="translate")}N(){return this.U}addTo(t){if(this.map)return this.R(),void console.warn("transform control has been added to a map, it suggest remove from the map before");this.addToMapCount++,this.map=t,this._.addTo(this.map),this.container=t.getContainer(),t.on("dom:mousemove",this.K,this),t.on("dom:mousedown",this.G,this),t.on("dom:mouseup",this.j,this),t.on("zooming moving dragrotating",this.Z,this),this.Y()}k(){this._=new R$(`${E1}_transformcontrol`),this.T=new f$([0,0],{symbol:{url:"cube",modelHeight:1,uniforms:{polygonOpacity:.01}}}).addTo(this._)}remove(){this.map&&this.container&&this.layerRenderer&&(this.R(),this.TransformHelper.dispose(),this.layerRenderer.setToRedraw(),this._.remove(),delete this.T,delete this._,delete this.map,delete this.layer,delete this.layerRenderer,delete this.container,delete this.S)}R(){this.container&&this.map&&(this.map.off("dom:mousemove",this.K,this),this.map.off("dom:mousedown",this.G,this),this.map.off("dom:mouseup",this.j,this),this.map.off("zooming moving dragrotating",this.Z,this),this.layer&&this.layer.off("renderend",this.render,this))}K(t){if(this.W()){if(this.currentMousePosition={x:t.containerPoint.x,y:t.containerPoint.y},"moving"===this.mouseAction){const t=this.q();this.currentPickingObject=this.X(this.currentMousePosition,t,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.pickingId?(this.J(this.currentPickingObject.pickingId),this.$(6===this.currentPickingObject.pickingId)):(this.$(!1),this.J()),this.AA()}this.eA(this.currentMousePosition)}}G(t){if(!this.W()||0!==t.domEvent.button)return;const e=this.q();this.currentMousePosition={x:t.containerPoint.x,y:t.containerPoint.y},this.tA=!0,this.currentPickingObject=this.X(this.currentMousePosition,e,"meshes"),this.firstDownPoint=this.X(this.currentMousePosition,e,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.sA(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.layerRenderer&&this.layerRenderer.setToRedraw()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0),this.H()),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=e[this.currentPickingObject.meshId]}j(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.H(),this.tA=!0,this.fire("transformend",{action:this.iA,type:"transformend"})),this.mouseAction="moving","xyzScale"!==this.U&&(this.U="translate"),this.map.config("zoomable",!0),this.map.config("draggable",!0),this.layerRenderer&&this.layerRenderer.setToRedraw()}Z(){const t=this.TransformHelper.planeHelper.getMeshes()[0][0],e=this.map.getBearing();t.rotation[2]=-e,this.nA()}nA(){this.W()&&(this.TransformHelper.updateMatrix(this.map,this.S,0,0,[0,0,0]),this.tA=!0)}picked(t){if(!this.layerRenderer)return!1;const e=this.q();let n=t;t instanceof $0||(n=this.map.coordinateToContainerPoint(new F4(t)));const i=this.X(n,e,"picked");return!(!i||null===i.meshId)}H(){const t=this.TransformHelper.getMeshes("scaling").scaling[0][0],e=340/177;t.scaling=[.6*e,.6*e,.6*e],this.layerRenderer&&(this.IA(t),this.oA())}oA(){this.TransformHelper._meshes.translate.forEach((t=>{for(let e=0;e<t.length;e++){const n=t[e];Yit.indexOf(n.getUniform("uPickingId"))>-1&&n.material.set("color",n.originColor)}}))}IA(t){const e=this.S.getCoordinates(),n=this.map.coordinateToPointAtRes(e,this.map.getGLRes()),i=[n.x,n.y,0],r=xit(this.map,this.S.getTranslation());gg(i,i,r);const o=dg([],t.translate),s=t.scaling;let a=_it(this.S,this.map);a=pg([],a,a,a),yg(o,o,a),yg(a,a,s),gg(o,o,i),tg(t.localTransform,[0,0,0,1],o,a),this.q().forEach((t=>{const e=t.getUniform("uPickingId");if(1===e||3===e||2===e||4===e){const e=dg([],t.translate),n=170/177;t.scaling=[n,n,n];const r=t.scaling,o=t.rotation;let s=_it(this.S,this.map);s=pg([],s,s,s),yg(e,e,s),yg(s,s,r),gg(e,e,i);const a=Sm([],o[0],o[1],o[2]);tg(t.localTransform,a,e,s)}}))}gA(t){const e=this.map.containerPointToCoordinate(t),n=this.map.coordinateToPointAtRes(e,this.map.getGLRes());return{point:[n.x,n.y]}}eA(t){if("transform"===this.mouseAction){const t=this.N(),e=xit(this.map,this.S.getTranslation()),n=this.S.I();let i=null,r=null;if(e[2]+n<.01&&"z-translate"!==this.iA)i=this.gA(this.currentMousePosition),r=this.gA(this.lastMousePosition);else{const t=this.TransformHelper.planeHelper.getMeshes()[0];if(i=this.X(this.currentMousePosition,t,"plane"),r=this.X(this.lastMousePosition,t,"plane"),!i||null===i.meshId||!r||null===r.meshId)return}const o=[0,0,0],s=[0,0,0];let a=0,h=0,l=0;if("translate"===t){if("xy-translate"===this.iA){const t=i.point[1]-r.point[1];o[0]=i.point[0]-r.point[0],o[1]=t}else if("x-translate"===this.iA)o[0]=i.point[0]-r.point[0];else if("y-translate"===this.iA)o[1]=i.point[1]-r.point[1];else if("z-translate"===this.iA){let t=0;if(this.rA()){const e=this.map.getGLRes(),n=this.map._pointAtResToContainerPoint(new $0(r.point[0],r.point[1]),e),o=this.map._pointAtResToContainerPoint(new $0(i.point[0],i.point[1]),e),s=my(ly(ert,i.point[0]-r.point[0],i.point[1]-r.point[1]));t=o.y<n.y?s:-s}else t=i.point[2]-r.point[2];o[2]=t}}else if("rotation"===t)h=this.aA(i.point,r.point),this.TransformHelper.o(h>=0),s[2]+=h;else if("scaling"===t||"xyzScale"===t){const t=this.CA(),e=my(ly(ert,this.firstDownPoint.point[0]-t[0],this.firstDownPoint.point[1]-t[1])),n=my(ly(ert,r.point[0]-t[0],r.point[1]-t[1]));a=this.hA(i.point,r.point,t,n),l=this.hA(i.point,r.point,t,e)}this.TransformHelper.updateMatrix(this.map,this.S,h,l,o),this.S.p(this.iA,o,s,a,.01,this.map,this)}this.lastMousePosition=t,this.lastPickingObject=this.currentPickingObject;const e=this.q();this.lastPickingMesh=e[this.currentPickingObject.meshId]}hA(t,e,n,i,r){const o=(my(ly(ert,t[0]-n[0],t[1]-n[1]))-my(ly(ert,e[0]-n[0],e[1]-n[1])))/i;return r?(r[0]-.01)*o:o}CA(){const t=this.map,e=this.S.getCoordinates(),n=t.coordinateToPointAtRes(e,t.getGLRes()),i=pg(nrt,n.x,n.y,0);return gg(i,i,xit(t,this.S.getTranslation())),i}$(t){const e=this.TransformHelper.planeHelper.getMeshes()[0][0],n=Jp(trt,e.localTransform),i=Kp($it,e.localTransform);let r=Sm(Kit,0,0,0);const o=this.map.getBearing();t&&!this.rA()?(r=Sm(Kit,90,0,-o),0===e.rotation[0]&&(this.tA=!0),pg(e.rotation,90,0,-o)):(90===e.rotation[0]&&(this.tA=!0),pg(e.rotation,0,0,-o)),tg(e.localTransform,r,n,i)}rA(){if(this.map.getPitch())return!1;const t=this.map.cameraPosition,e=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());pg(e,e.x,e.y,0);const n=this.S.getCoordinates(),i=this.map.coordinateToPointAtRes(n,this.map.getGLRes()),r=xit(this.map,this.S.getTranslation()),o=pg(trt,i.x,i.y,0);return Ig(mg([],t,gg(o,o,r)),mg([],t,e))<1/180*Math.PI}AA(){const t=this.q();if(this.currentPickingObject&&null!=this.currentPickingObject.meshId){this.wA(),this.lastPickingObject&&null!=this.lastPickingObject.meshId&&this.lastPickingObject.meshId!==this.currentPickingObject.meshId&&this.cA();const e=t[this.currentPickingObject.meshId];e&&Xit.indexOf(this.currentPickingObject.pickingId)<0&&(this.currentPickingObject.pickingId>100?this.QA(e):(e.material.set("color",[e.originColor[0],e.originColor[1],e.originColor[2],.8]),this.fA(e,.5))),this.layerRenderer.setToRedraw()}else this.lastPickingObject&&null!=this.lastPickingObject.meshId&&(this.map.resetCursor(),this.cA(),this.layerRenderer.setToRedraw())}QA(t){const e=[1,179/255,2/255,1];t.material.set("color",e),t.properties.relatedMeshes&&t.properties.relatedMeshes.forEach((t=>{t.material.set("color",e)}))}wA(){6===this.currentPickingObject.pickingId?this.map.setCursor("ns-resize"):qit.indexOf(this.currentPickingObject.pickingId)>-1?this.map.setCursor("move"):this.map.setCursor("pointer")}cA(){const t=this.lastPickingMesh;if(!t)return;const e=t.getUniform("uPickingId"),n=this.q();qit.indexOf(e)>-1?n.forEach((t=>{qit.indexOf(t.getUniform("uPickingId"))>-1&&t.material.set("color",t.originColor)})):Jit.indexOf(e)>-1?n.forEach((t=>{const e=t.getUniform("uPickingId");Yit.indexOf(e)>-1&&t.material.set("color",t.originColor)})):11===e&&n.forEach((t=>{Yit.indexOf(t.getUniform("uPickingId"))>-1&&t.material.set("color",t.originColor)})),t.material.set("color",t.originColor),t.properties.relatedMeshes&&t.properties.relatedMeshes.forEach((t=>{t.material.set("color",t.originColor)}))}fA(t,e){const n=t.getUniform("uPickingId"),i=this.q();qit.indexOf(n)>-1?i.forEach((n=>{qit.indexOf(n.getUniform("uPickingId"))>-1&&n.getUniform("uPickingId")!==t.getUniform("uPickingId")&&n.material.set("color",[n.originColor[0],n.originColor[1],n.originColor[2],e])})):"scaling"===this.U?i.forEach((t=>{const e=t.getUniform("uPickingId");1!==e&&3!==e&&2!==e&&4!==e||t.material.set("color",[149/255,179/255,199/255,.8])})):"rotation"===this.U&&i.forEach((t=>{const e=t.getUniform("uPickingId");if(1===e||3===e||2===e||4===e){const e=t.originColor;t.material.set("color",[e[0],e[1],e[2],0])}}))}reset(){this.map&&this.S&&(this.S.M(),this.TransformHelper.updateMatrix(this.map,this.S,0,0,[0,0,0]))}aA(t,e){const n=this.CA(),i=ly(irt,e[0]-n[0],e[1]-n[1]),r=ly(rrt,t[0]-n[0],t[1]-n[1]),o=Math.atan2(i[1],i[0]);return(Math.atan2(r[1],r[0])-o)/Math.PI*180}sA(t){return this.iA=113===t||114===t?"x-scale":115===t||116===t?"z-scale":117===t||118===t?"y-scale":119===t?"xyz-scale":5===t?"xy-translate":6===t?"z-translate":7===t||9===t?"x-translate":8===t||10===t?"y-translate":11===t?"z-rotate":"scale",this.iA}transform(t){t&&(this.layerRenderer&&this.layerRenderer.layer&&(this.layerRenderer.layer.off("renderend",this.render),this.layerRenderer.layer.off("resizeCanvas",this.lA)),this.map?(this.S&&(this.S.B(),this.S.D(t)),this.S.getTargets().length&&(this.TransformHelper.updateMatrix(this.map,this.S,0,0,[0,0,0]),this.PA(),this.tA=!0)):console.error("should add to a target first"))}getTransformTarget(){return this.S}u(){delete this.S}PA(){const t=this.S.O();t&&(t.off("renderend",this.render),t.off("resizeCanvas",this.lA));const e=this.map,n=t.getRenderer();this.layerRenderer=n,this.regl=n.regl,this.renderer=n.renderer,this.DA=this.layerRenderer.getFBORayPicking(),this.uA={projViewMatrix:e.projViewMatrix,projMatrix:e.projMatrix,viewMatrix:e.viewMatrix,pointSize:1},t.on("renderend",this.render,this),t.on("resizeCanvas",this.lA,this),n.setToRedraw()}lA(){this.DA.clear(),this.tA=!0}X(t,e,n){const i=this.map;if(!(i&&this.DA&&this.layerRenderer&&this.layerRenderer.canvas))return null;const r=i.getDevicePixelRatio(),o=t.x*r,s=t.y*r,a=this.uA;return(this.tA||this.layerRenderer.canvas.gl&&this.layerRenderer.canvas.gl.wrap||!this.mA||this.mA!==n)&&(this.DA.render(e,a,!0),this.mA=n,this.tA=!1),this.DA.pick(o,s,10,a,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}Y(){const t=this.map.getDevicePixelRatio();this.bA=new mx({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\n\n\nvoid main()\n\n{\n\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n\n\n}\n\n",frag:"precision mediump float;\n\nuniform vec4 color;\n\n\n\nvoid main() {\n\n    gl_FragColor = color;\n\n}\n\n",uniforms:["color",{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp([],e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>this.map?this.map.width*t:1,height:()=>this.map?this.map.height*t:1},depth:{enable:!0,func:"always",mask:!0,range:[0,0]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}},defines:{}})}render(){if(!this.W())return;const t=this.q();this.helperScene.setMeshes(t);const e=this.layerRenderer.getFrameContext();e&&e.renderTarget&&this.layerRenderer.getFrameTimestamp()!==e.timestamp||(this.nA(),this.bA.filter=e&&e.sceneFilter,this.renderer.render(this.bA,this.uA,this.helperScene,e&&e.renderTarget&&e.renderTarget.fbo))}q(){let t=[];const e=this.TransformHelper.getMeshes(this.U);for(const i in e){if("translate"===i)continue;const n=e[i];for(let e=0;e<n.length;e++)t=t.concat(n[e])}const n=e.translate;if(n)for(let i=0;i<n.length;i++)t=t.concat(n[i]);return t}W(){const t=this.layerRenderer,e=t&&t.layer;return t&&this.S&&e&&e.isVisible()&&this.S.F()&&this.regl&&this.V}};ort.mergeOptions({scaleStrength:2});class srt{constructor(t){this.t=t||{}}getJSON(){return art(this.t)}getId(){return this.t.id}getStyle(){return this.t.options?art(this.t.options.style):null}getData(){return this.t.options?art(this.t.options.data):null}getGeometryById(t){const e=this.t.geometries;if(!e)return null;for(let n=0;n<e.length;n++)if(e[n]&&e[n].options&&e[n].options.id===t)return art(e[n]);return null}getGeometries(){return this.t.geometries?art(this.t.geometries):[]}}function art(t){return t?JSON.parse(JSON.stringify(t)):null}for(var hrt=[],lrt=0;lrt<6;lrt++)hrt[lrt]=[];var urt=[];function crt(t,e,n){var i,r,o,s,a,h,l,u,c,A,f,d,p,g,m,y,v;r=(i=t)[0],o=i[1],s=i[2],l=i[5],u=i[6],f=i[9],d=i[10],m=i[13],y=i[14],Art(hrt[0],(a=i[3])-r,(c=i[7])-(h=i[4]),(p=i[11])-(A=i[8]),(v=i[15])-(g=i[12])),Art(hrt[1],a+r,c+h,p+A,v+g),Art(hrt[2],a+o,c+l,p+f,v+m),Art(hrt[3],a-o,c-l,p-f,v-m),Art(hrt[4],a-s,c-u,p-d,v-y),Art(hrt[5],a+s,c+u,p+d,v+y);for(var _=0;_<6;_++){var x=hrt[_];if(urt[0]=x[0]>0?e[1][0]:e[0][0],urt[1]=x[1]>0?e[1][1]:e[0][1],urt[2]=x[2]>0?e[1][2]:e[0][2],frt(x,urt)<0)return!1}return!0}function Art(t,e,n,i,r){var o=1/Math.sqrt(e*e+n*n+i*i);return t[0]=e*o,t[1]=n*o,t[2]=i*o,t[3]=r*o,t}function frt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}const drt={vert:"\n    attribute vec3 aPosition;\n    attribute vec2 aTexCoord;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 positionMatrix;\n    uniform mat4 modelMatrix;\n    varying vec2 vTexCoords;\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        vTexCoords = aTexCoord;\n    }\n",frag:"\n    precision mediump float;\n    uniform sampler2D videoTexture;\n    uniform float opacity;\n\n    varying vec2 vTexCoords;\n    void main() {\n        vec4 color = texture2D(videoTexture, vTexCoords);\n        gl_FragColor = color * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp([],e.projViewMatrix,e.modelMatrix)},"texture","opacity"],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,func:"always"},cull:{enable:!1,face:"back"},frontFace:"cw",blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},prt=[1,0,3,3,2,1];function grt(t,e,n){if(!t)return null;const i=t.coordinateToPointAtRes(e,t.getGLRes());return[i.x,i.y,n]}let mrt=class extends(Do(Qo(Lo))){constructor(t,e){super(e),this.setCoordinates(t),this.I()}setCoordinates(t){this.R=t}getCoordinates(){return this.R}setVideo(t){this.D="stop",this.options.url=t,delete this.options.elementId,this.I()}setElementId(t){this.D="stop",this.options.elementId=t,delete this.options.url,this.I()}I(){this.D="stop";const t=this.options.url;let e=document.getElementById(this.options.elementId);if(t&&(e=document.createElement("video"),e.src=t),!e)throw new Error("there is no element or url setting for video mask");e.autoplay=!0,e.loop=!0,e.muted=!0,e.play(),e.addEventListener("playing",(()=>{this.D="playing",this.fire("playing",{state:this.D,url:t})})),e.addEventListener("pause",(()=>{this.D="pause",this.fire("pause",{state:this.D,url:t})})),e.addEventListener("error",(()=>{throw this.D="pause",this.fire("error",{state:this.D,url:t}),new Error("video resource load error")})),this.video=e}getVideo(){return this.video}L(t){this.j=t}C(){return this.j}addTo(t){if(this.F)throw new Error("VideoSurface cannot be added to two or more layers at the same time.");return t.addSurfaces(this),this}show(){return this.options.visible=!0,this}hide(){return this.options.visible=!1,this}isVisible(){return this.options.visible}play(){this.video&&this.video.play()}pause(){this.video&&this.video.pause()}setAudio(t){this.video.muted=t}setOpacity(t){this.options.opacity=t}getOpacity(){return this.options.opacity}remove(){delete this.video;const t=this.getLayer();t&&t.removeVideoSurfaces(this),this.endEdit()}getLayer(){return this.F}A(){return"playing"===this.D}startEdit(){const t=this.getLayer();if(!t)return void console.warn("videosurface should be added to a map before edit");const e=t.getMap();if(!e)return void console.warn("videosurface should be added to a map before edit");if(this.N(),!this.G){const n=t.getId();this.G=new Cu(`internal_${n}_edit`,{enableAltitude:!0}).addTo(e)}const n=this.getCoordinates();this.H=new Fl(n,{symbol:{lineColor:"#34495e",lineWidth:2,polygonFill:"rgb(135,196,240)",polygonOpacity:.1}}).addTo(this.G),this.H.startEdit({newVertexHandleSymbol:{polygonFill:"rgba(0, 0, 0, 0)",polygonOpacity:0,markerType:"ellipse",markerWidth:1,markerHeight:1}}),this.H.on("shapechange",(e=>{const n=e.target.getCoordinates()[0].slice(0,4).map((t=>[t.x,t.y,0]));this.setCoordinates(n),t.getRenderer().M(this)}),this)}endEdit(){this.G&&(this.H.endEdit(),this.H.remove(),this.G.remove()),delete this.G,delete this.H}N(){this.G&&this.G.clear(),delete this.H}};mrt.mergeOptions({opacity:1,visible:!0});let yrt=class extends sl{constructor(t,e,n){!e||Array.isArray(e)||e instanceof mrt||(n=e,e=null),super(t,n),this.W={},this.videoId=0,this.W={},this.videoId=0,e&&this.addSurfaces(e)}addSurfaces(t){if(t)if(Array.isArray(t))t.forEach((t=>{this.addMarker(t)}));else{t.F=this,this.W[this.videoId]=t,t.L(this.videoId);const e=this.getRenderer();e?e.m()&&e.u(t):this.on("renderercreate",(e=>{e.renderer.m()&&e.renderer.u(t)})),this.videoId++}}showTopAlways(t){this.options.showTopAlways=t;const e=this.getRenderer();e&&e.v()}setDoubleSide(t){this.options.doubleSide=t;const e=this.getRenderer();e&&e.v()}getVideoSurfaces(){const t=[];for(const e in this.W)t.push(this.W[e]);return t}removeVideoSurfaces(t){if(Array.isArray(t))t.forEach((t=>{this.removeVideoSurfaces(t)}));else{const e=t.C(),n=this.getRenderer();n&&n.k(e),delete this.W[e]}}remove(){this.clear(),super.remove()}clear(){const t=this.getVideoSurfaces();for(let e=0;e<t.length;e++)t[e].remove()}};yrt.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,showTopAlways:!0,doubleSide:!0}),yrt.registerJSONType("VideoLayer"),yrt.registerRenderer("gl",class extends Uf.CanvasRenderer{constructor(t){super(t),this.t={}}draw(t,e){this.prepareCanvas(),this.i(e)}drawOnInteracting(t,e,n){this.i(n)}needToRedraw(){return!0}hitDetect(){return!1}createContext(){if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this.o(this.canvas,t),this.regl=id({gl:this.gl,extensions:["ANGLE_instanced_arrays","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","WEBGL_depth_texture"],optionalExtensions:this.layer.options.glExtensions||[]})}this.h(),this.l();const t=this.layer.getVideoSurfaces();for(let e=0;e<t.length;e++)this.u(t[e])}o(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let o=0;o<n.length;++o){try{i=t.getContext(n[o],e)}catch(r){}if(i)break}return i}l(){const t=this.layer.getMap(),e=new j_(this.regl);this.renderer=e,this.p={projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,viewMatrix:t.viewMatrix,halton:[.2107,-.0202],uHalton:[.2107,-.0202],uCameraPosition:t.cameraPosition,cameraPosition:t.cameraPosition,globalTexSize:[t.width,t.height]}}m(){return this.regl}h(){this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.v()}v(){this._&&this._.dispose(),this.layer.options.showTopAlways?(drt.extraCommandProps.depth.mask=!1,drt.extraCommandProps.depth.range=[0,0]):(delete drt.extraCommandProps.depth.mask,delete drt.extraCommandProps.depth.range),drt.extraCommandProps.cull.enable=!this.layer.options.doubleSide,this._=new mx(drt)}u(t){const e=this.regl.texture(),n=new T_({videoTexture:e,opacity:1}),i=t.getCoordinates(),{worldCenter:r,points:o}=this.O(i),s=this.S(o),a=new z_(s,n);this.T(a,r);const h=new Y_(a),l=t.C();this.t[l]=h}M(t){const e=t.C(),n=this.t[e].getMeshes()[0],i=t.getCoordinates();n.geometry.dispose();const{worldCenter:r,points:o}=this.O(i),s=this.S(o);n.geometry=s,this.T(n,r)}i(t){const e=this.layer.getVideoSurfaces().filter((t=>t.isVisible()));if(!e.length)return;const n=this.P(e);if(!n)return;let i=null;t&&(i=t.renderTarget&&t.renderTarget.fbo),this.renderer.render(this._,this.p,n,i)}S(t){return new Jv({POSITION:t,TEXCOORD:[0,0,1,0,1,1,0,1]},prt,0,{primitive:"triangles",positionAttribute:"POSITION",uv0Attribute:"TEXCOORD",normalAttribute:"NORMAL",positionSize:3})}O(t){let e=[];const n=this.getMap(),i=new Fl(t).getCenter(),r=grt(n,i,0);return this.V=r,n&&t.forEach((t=>{const i=new $o(t[0],t[1]),o=n.altitudeToPoint(t[2]||0,n.getGLRes()),s=grt(n,i,o);s[0]=s[0]-r[0],s[1]=s[1]-r[1],e=e.concat(s)})),{worldCenter:r,points:e}}P(t){const e=[],n=this.layer.getMap();for(let i=0;i<t.length;i++){const r=t[i],o=this.t[r.C()];if(!o)continue;const s=o.getMeshes();for(let t=0;t<s.length;t++){const i=s[t],o=i.getMaterial(),a=o.get("videoTexture");a&&r.A()&&(a(r.video),o.set("opacity",r.getOpacity())),crt(n.projViewMatrix,i.getBoundingBox())&&e.push(i)}}return e.length?new Y_(e):null}T(t,e){tg(t.localTransform,Sm([],0,0,0),e,[1,1,1])}remove(){this._&&this._.dispose(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}k(t){const e=this.t[t];e&&e.getMeshes().forEach((t=>{t.geometry.dispose(),t.material&&t.material.dispose(),t.dispose()}))}});const vrt=2048;class _rt{constructor(t,e){this.renderer=t,this.regl=t.regl,this.i=e,this.u()}u(){this.h=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:vrt,height:vrt,wrap:"clamp",mag:"nearest",min:"nearest"}),depth:!0})}l(t,e,n){const i={projViewMatrix:e,minAltitude:0,logDepthBufFC:2/(Math.log(n+1)/Math.LN2)};this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.h}),this.renderer.render(this.C,i,t,this.h)}D(t,e){this.C=new mx({vert:"#include <gl2_vert>\n\n#ifdef HAS_ALTITUDE\n\n    attribute vec2 aPosition;\n\n    attribute float aAltitude;\n\n#else\n\n    attribute vec3 aPosition;\n\n#endif\n\n// uniform mat4 projViewMatrix;\n\n// uniform mat4 modelMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 positionMatrix;\n\nvarying vec2 vHighPrecisionZW;\n\n#include <get_output>\n\nvarying float vFragDepth;\n\n\n\n#ifdef HAS_ALTITUDE\n\n    vec3 unpackVTPosition() {\n\n        return vec3(aPosition, aAltitude);\n\n    }\n\n#endif\n\nvoid main()\n\n{\n\n    #ifdef HAS_ALTITUDE\n\n        vec3 i = unpackVTPosition();\n\n        vec4 j = vec4(i, 1.);\n\n        gl_Position = projViewModelMatrix * j;\n\n    #else\n\n        mat4 localPositionMatrix = getPositionMatrix();\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    #endif\n\n    vFragDepth = 1.0 + gl_Position.w;\n\n    vHighPrecisionZW = gl_Position.zw;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n#include <gl2_frag>\n\n\n\nuniform float logDepthBufFC;\n\nvarying float vFragDepth;\n\nvarying vec2 vHighPrecisionZW;\n\n\n\nconst float PackUpscale = 256. / 255.;\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA(const in float v ) {\n\n    vec4 r = vec4(fract(v * PackFactors), v);\n\n    r.yzw -= r.xyz * ShiftRight8;\n\n    return r * PackUpscale;\n\n}\n\nvoid main() {\n\n    gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n    glFragColor = packDepthToRGBA(fragCoordZ);\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:{x:0,y:0,width:()=>{const n=this.I(t,e);return n?n.width:1},height:()=>{const n=this.I(t,e);return n?n.height:1}}}}),this.C.version=300}I(t,e){return this.m(t,e)?{width:vrt,height:vrt}:null}m(t,e){return t&&e&&t*e>0}dispose(){this.h&&this.h.destroy(),this.C&&this.C.dispose()}}const xrt=[0,0,0,1];class brt extends _rt{u(){this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=[];this.O=new mx({vert:"attribute vec3 aPosition;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n\n\nvoid main() {\n\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,n)=>Hp(t,n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.i}}),this.F=new Y_}render(t,e){return this.U(),this.renderer.clear({color:xrt,depth:1,framebuffer:this.T}),this.F.setMeshes(t),this.renderer.render(this.O,{projViewMatrix:e},this.F,this.T),this.T}U(){const t=gi.isFunction(this.i.width.data)?this.i.width.data():this.i.width,e=gi.isFunction(this.i.height.data)?this.i.height.data():this.i.height;!this.T||this.T.width===t&&this.T.height===e||this.T.resize(t,e)}dispose(){this.T&&(this.T.destroy(),delete this.T),this.O&&(this.O.dispose(),delete this.O)}}function wrt(t,e){return t.altitudeToPoint(e||0,t.getGLRes())}const Crt=new $o(0,0);function Prt(t,e,n,i){if(!t)return null;Crt.set(e,n);const r=t.coordinateToPointAtRes(Crt,t.getGLRes()),o=wrt(t,i);return[r.x,r.y,o]}class Mrt extends(Do(Qo(Lo))){constructor(t){super(t),this.N=!0}addTo(t){return t.getMap()?(this.layer=t,this.j()):t.once("add",(()=>{this.addTo(t)}),this),this}j(){const t=this.layer.getRenderer();t?(this.regl=t.regl,this.S(t)):this.layer.once("renderercreate",(t=>{this.regl=t.renderer.regl,this.S(t.renderer)}),this)}enable(){this.N=!0;const t=this.layer.getRenderer();t&&t.setToRedraw()}disable(){this.N=!1;const t=this.layer.getRenderer();t&&t.setToRedraw()}isEnable(){return this.N}remove(){if(this.layer){const t=this.layer;delete this.layer,t.removeAnalysis(this),this.B&&(this.B.dispose(),delete this.B),this.k&&(this.k.dispose(),delete this.k),this.R&&(this.R.forEach((t=>{t.geometry.dispose(),t.dispose()})),delete this.R),this.G&&(this.G.dispose(),delete this.G)}}update(t,e){this.options[t]=e;const n=this.layer.getRenderer();n&&n.setToRedraw()}getExcludeLayers(){return this.options.excludeLayers||[]}setExcludeLayers(t){this.options.excludeLayers=t}exportAnalysisMap(t){if(!this.isEnable())return null;let e=this.B.render(t,this.q);e=e.meshesMap?e.meshesMap:e;const n=this.layer.getRenderer();if(e&&n){const t=n.regl,i=e.width,r=e.height,o=new Uint8Array(4*i*r);return t.read({data:o,x:0,y:0,framebuffer:e,width:i,height:r}),o}return null}getAnalysisType(){return this.type}V(t){const e=new Fl(t,{symbol:{polygonOpacity:.2}}).getExtent();return this.W(e,t)}W(t,e){const n=this.layer.getMap(),i=n.getCenter(),r=n.getZoom(),o=n.getPitch(),s=n.getBearing(),a=n.getFitZoom(t),h=t.getCenter();n.setZoom(a),n.setCenter(h),n.setPitch(0),n.setBearing(0);const l=n.getExtent();this._=this._||[],Fp(this._,n.projViewMatrix);const u=Prt(n,l.xmin,l.ymin),c=Prt(n,l.xmax,l.ymax),A=[u[0],u[1],c[0],c[1]],f=Prt(n,t.xmin,t.ymin),d=Prt(n,t.xmax,t.ymax),p=[f[0],f[1],d[0],d[1]];if(n.setZoom(r),n.setCenter(i),n.setPitch(o),n.setBearing(s),this.R=this.K(e,h),!this.k){const t=new j_(this.regl);this.k=new brt(t,this.i)}return{extentMap:this.k.render(this.R,this._),extentInWorld:A,extentPolygon:p}}K(t,e){const n=[],i=this.layer.getMap(),r=Prt(i,e.x,e.y,0);for(let l=0;l<t.length;l++){const e=Prt(i,...t[l]);n.push(e[0]-r[0]),n.push(e[1]-r[1]),n.push(0)}const o=Zw(n,null,3);this.R&&(this.R[0].geometry.dispose(),this.R[0].dispose());const s=new Jv({POSITION:n},o,0,{positionAttribute:"POSITION"}),a=new z_(s),h=tg([],ym([]),r,[1,1,1]);return a.localTransform=h,this.R=[a],this.R}}var Trt="attribute vec3 aPosition;\n\nattribute vec2 aTexCoord;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    v_texCoord = aTexCoord;\n\n}\n\n",Srt="#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform sampler2D meshesMap;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        #ifdef HAS_HELPERPARTS\n\n          gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n\n        #else\n\n          gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        #endif\n\n        vec2 v = v_texCoord;\n\n    }\n\n}\n\n";const Irt={helper:{asset:{generator:"Khronos glTF Blender I/O v1.6.16",version:"2.0"},scene:0,scenes:[{name:"Scene",nodes:[0,1,2,3,4,5,6,7]}],nodes:[{mesh:0,name:"角2",scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,0,-9.680065155029297]},{mesh:1,name:"角3",rotation:[1,0,0,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,.04612281173467636,9.669971466064453]},{mesh:2,name:"角1",rotation:[0,0,-1,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,.028526417911052704,-9.667880058288574]},{mesh:3,name:"角4",rotation:[0,-1,0,1910685676922942e-30],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,0,9.639498710632324]},{mesh:4,name:"X轴",translation:[.008500291034579277,0,11.816417694091797]},{mesh:5,name:"平面",scale:[9.5003657913208,9.5003657913208,9.5003657913208]},{mesh:6,name:"Y轴",rotation:[.5384660959243774,.45831674337387085,-.45831674337387085,-.5384663343429565],translation:[11.712308883666992,0,.32547950744628906]},{mesh:7,name:"Z轴",scale:[.49277400970458984,.41999998688697815,.49277400970458984],translation:[.0035659661516547203,1.6771862506866455,-11.201739311218262]}],materials:[{doubleSided:!0,name:"材质.015",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.014",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.016",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.013",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.009",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:"材质.017",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04.006",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:"材质.023",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.022",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:"材质.021",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}}],meshes:[{name:"平面.009",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0}]},{name:"平面.010",primitives:[{attributes:{POSITION:4,NORMAL:5,TEXCOORD_0:6},indices:3,material:1}]},{name:"平面.011",primitives:[{attributes:{POSITION:7,NORMAL:8,TEXCOORD_0:9},indices:3,material:2}]},{name:"平面.012",primitives:[{attributes:{POSITION:10,NORMAL:11,TEXCOORD_0:12},indices:3,material:3}]},{name:"圆环.004",primitives:[{attributes:{POSITION:13,NORMAL:14,TEXCOORD_0:15},indices:16,material:4},{attributes:{POSITION:17,NORMAL:18,TEXCOORD_0:19},indices:20,material:5}]},{name:"平面.015",primitives:[{attributes:{POSITION:21,NORMAL:22,TEXCOORD_0:23},indices:24}]},{name:"圆环.008",primitives:[{attributes:{POSITION:25,NORMAL:26,TEXCOORD_0:27},indices:16,material:6},{attributes:{POSITION:28,NORMAL:29,TEXCOORD_0:30},indices:20,material:7}]},{name:"立方体.011",primitives:[{attributes:{POSITION:31,NORMAL:32,TEXCOORD_0:33},indices:34,material:8},{attributes:{POSITION:35,NORMAL:36,TEXCOORD_0:37},indices:38,material:9},{attributes:{POSITION:39,NORMAL:40,TEXCOORD_0:41},indices:42,material:10}]}],accessors:[{bufferView:0,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:1,componentType:5126,count:68,type:"VEC3"},{bufferView:2,componentType:5126,count:68,type:"VEC2"},{bufferView:3,componentType:5123,count:144,type:"SCALAR"},{bufferView:4,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:5,componentType:5126,count:68,type:"VEC3"},{bufferView:6,componentType:5126,count:68,type:"VEC2"},{bufferView:7,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:8,componentType:5126,count:68,type:"VEC3"},{bufferView:9,componentType:5126,count:68,type:"VEC2"},{bufferView:10,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:11,componentType:5126,count:68,type:"VEC3"},{bufferView:12,componentType:5126,count:68,type:"VEC2"},{bufferView:13,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:14,componentType:5126,count:32,type:"VEC3"},{bufferView:15,componentType:5126,count:32,type:"VEC2"},{bufferView:16,componentType:5123,count:90,type:"SCALAR"},{bufferView:17,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:18,componentType:5126,count:745,type:"VEC3"},{bufferView:19,componentType:5126,count:745,type:"VEC2"},{bufferView:20,componentType:5123,count:1053,type:"SCALAR"},{bufferView:21,componentType:5126,count:4,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:22,componentType:5126,count:4,type:"VEC3"},{bufferView:23,componentType:5126,count:4,type:"VEC2"},{bufferView:24,componentType:5123,count:6,type:"SCALAR"},{bufferView:25,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:26,componentType:5126,count:32,type:"VEC3"},{bufferView:27,componentType:5126,count:32,type:"VEC2"},{bufferView:28,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:29,componentType:5126,count:745,type:"VEC3"},{bufferView:30,componentType:5126,count:745,type:"VEC2"},{bufferView:31,componentType:5126,count:16,max:[1,1,1],min:[-1,-1,-1],type:"VEC3"},{bufferView:32,componentType:5126,count:16,type:"VEC3"},{bufferView:33,componentType:5126,count:16,type:"VEC2"},{bufferView:34,componentType:5123,count:18,type:"SCALAR"},{bufferView:35,componentType:5126,count:16,max:[1.0000004768371582,-6.847862720489502,1.0000038146972656],min:[-.999999463558197,-8.847862243652344,-.9999960660934448],type:"VEC3"},{bufferView:36,componentType:5126,count:16,type:"VEC3"},{bufferView:37,componentType:5126,count:16,type:"VEC2"},{bufferView:38,componentType:5123,count:18,type:"SCALAR"},{bufferView:39,componentType:5126,count:24,max:[.23352710902690887,-.6051979064941406,.20581023395061493],min:[-.16755716502666473,-7.437830924987793,-.19527404010295868],type:"VEC3"},{bufferView:40,componentType:5126,count:24,type:"VEC3"},{bufferView:41,componentType:5126,count:24,type:"VEC2"},{bufferView:42,componentType:5123,count:36,type:"SCALAR"}],bufferViews:[{buffer:0,byteLength:816,byteOffset:0},{buffer:0,byteLength:816,byteOffset:816},{buffer:0,byteLength:544,byteOffset:1632},{buffer:0,byteLength:288,byteOffset:2176},{buffer:0,byteLength:816,byteOffset:2464},{buffer:0,byteLength:816,byteOffset:3280},{buffer:0,byteLength:544,byteOffset:4096},{buffer:0,byteLength:816,byteOffset:4640},{buffer:0,byteLength:816,byteOffset:5456},{buffer:0,byteLength:544,byteOffset:6272},{buffer:0,byteLength:816,byteOffset:6816},{buffer:0,byteLength:816,byteOffset:7632},{buffer:0,byteLength:544,byteOffset:8448},{buffer:0,byteLength:384,byteOffset:8992},{buffer:0,byteLength:384,byteOffset:9376},{buffer:0,byteLength:256,byteOffset:9760},{buffer:0,byteLength:180,byteOffset:10016},{buffer:0,byteLength:8940,byteOffset:10196},{buffer:0,byteLength:8940,byteOffset:19136},{buffer:0,byteLength:5960,byteOffset:28076},{buffer:0,byteLength:2106,byteOffset:34036},{buffer:0,byteLength:48,byteOffset:36144},{buffer:0,byteLength:48,byteOffset:36192},{buffer:0,byteLength:32,byteOffset:36240},{buffer:0,byteLength:12,byteOffset:36272},{buffer:0,byteLength:384,byteOffset:36284},{buffer:0,byteLength:384,byteOffset:36668},{buffer:0,byteLength:256,byteOffset:37052},{buffer:0,byteLength:8940,byteOffset:37308},{buffer:0,byteLength:8940,byteOffset:46248},{buffer:0,byteLength:5960,byteOffset:55188},{buffer:0,byteLength:192,byteOffset:61148},{buffer:0,byteLength:192,byteOffset:61340},{buffer:0,byteLength:128,byteOffset:61532},{buffer:0,byteLength:36,byteOffset:61660},{buffer:0,byteLength:192,byteOffset:61696},{buffer:0,byteLength:192,byteOffset:61888},{buffer:0,byteLength:128,byteOffset:62080},{buffer:0,byteLength:36,byteOffset:62208},{buffer:0,byteLength:288,byteOffset:62244},{buffer:0,byteLength:288,byteOffset:62532},{buffer:0,byteLength:192,byteOffset:62820},{buffer:0,byteLength:72,byteOffset:63012}],buffers:[{byteLength:63084,uri:"data:application/octet-stream;base64,AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAABAAGAAAABgACAAgADAAOAAgADgAKABMAEAAiABMAIgAqAB8AFgAuAB8ALgA3AA0ACQAZAA0AGQAVAAMABwATAAMAEwASAAUAAQARAAUAEQAQAA8ADQAVAA8AFQAeAAkACwAcAAkAHAAZAAcABQAQAAcAEAATAAEAAwASAAEAEgARAAsADwAeAAsAHgAcACgAKwBDACgAQwBAABEAEgAnABEAJwAlABIAEwAqABIAKgAnABAAEQAlABAAJQAiADEANAA2ADEANgAtAD0APwBCAD0AQgA6ACAAIwA7ACAAOwA4ABcAGgAyABcAMgAvACkAIQA5ACkAOQBBACQAJgA+ACQAPgA8ABsAHQA1ABsANQAzABQAGAAwABQAMAAsAAAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9b7f79WWa49UQo6Qdb7f79WWa49UQo6Qdb7f79WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QQAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEa5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8c5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/W+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEAAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAACAv8LFR74AAAAAvhR7vxbvw74AAAAAXoNsv9o5Dr8AAAAAMdtUv/MENb8AAAAA8wQ1vzHbVL8AAAAA2jkOv16DbL8AAAAAFe/Dvr4Ue78AAAAAxMVHvgAAgL8AAAAALr07M74Ue78AAAAAwsVHPl+DbL8AAAAAFO/DPjLbVL8AAAAA2TkOP/MENb8AAAAA8wQ1P9k5Dr8AAAAAMttUPxfvw74AAAAAXoNsP8HFR74AAAAAvxR7Py69uzMAAAAAAACAP73FRz4AAAAAvxR7PxXvwz4AAAAAXoNsP9s5Dj8AAAAAMNtUP/IENT8AAAAA9AQ1Py/bVD8AAAAA3TkOP16DbD8AAAAAGu/DPr4Uez8AAAAAxsVHPgAAgD8AAAAALt5Msr4Uez8AAAAAyMVHvl2DbD8AAAAAG+/DvjPbVD8AAAAA1zkOv/UENT8AAAAA8gQ1v9s5Dj8AAAAAMdtUvxXvwz4AAAAAX4Nsv7zFRz4AAAAAvxR7vwAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAEAAgACAAMABAAEAAUABgAGAAcACAAIAAkACgAKAAsADAAMAA0ADgAOAA8AEAAQABEAEgASABMAFAAUABUAFgAWABcAGAAYABkAGgAaABsAHAAcAB0AHgAeAB8AAAAAAAIABAAEAAYACAAIAAoADAAMAA4AEAAQABIAFAAUABYAGAAYABoAHAAcAB4AAAAAAAQACAAIAAwAEAAQABQAGAAYABwAAAAAAAgAEAAQABgAAAAcfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8McFu+mRx5vOP/r74McFu+mRx5vOP/r74McFu+mRx5vOP/r74Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G7/osCq+oRx5vN/bvL7osCq+oRx5vN/bvL7INe69qBx5vOSPxr7INe69qBx5vOSPxr7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr8APSu8txx5vJ3wz74APSu8txx5vJ3wz77QnjE9vRx5vHt3z77QnjE9vRx5vHt3z7746sU9wxx5vDOLy7746sU9wxx5vDOLy7746sU9wxx5vDOLy74Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA7+MGRg+yBx5vLA7xL6MGRg+yBx5vLA7xL40/Uo+zRx5vGimub40/Uo+zRx5vGimub40/Uo+zRx5vGimub4izto+8Rx5vOq17r4izto+8Rx5vOq17r4izto+8Rx5vOq17r7U0no+0Rx5vA72q77U0no+0Rx5vA72q77U0no+0Rx5vA72q76qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b7SbJM+1Bx5vPdhm77SbJM+1Bx5vPdhm77WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr6yasU+1hx5vCieOr6yasU+1hx5vCieOr6yasU+1hx5vCieOr4+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRztGxYA+xRx5vOoPLL69LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/1Bx5vDBIyT3AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/Zw8i+jRx5vKrq9b7Zw8i+jRx5vKrq9b4k6aa+mRx5vGTRBr8tYee+ghx5vDUk2r4tYee+ghx5vDUk2r4tYee+ghx5vDUk2r6UUje+sBx5vGO9F7+UUje+sBx5vGO9F7+UUje+sBx5vGO9F7/EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur6oz829uxx5vAaJHL+oz829uxx5vAaJHL+oz829uxx5vAaJHL8qggy/bBx5vGs7mL4qggy/bBx5vGs7mL4qggy/bBx5vGs7mL7AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr5QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr8WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL6+spi+ihx5vH6rjb6+spi+ihx5vH6rjb5KoKq+ghx5vHN7cb5KoKq+ghx5vHN7cb4qyrm+exx5vPJ1Q74qyrm+exx5vPJ1Q74c88W+dRx5vE0AEr4c88W+dRx5vE0AEr4O6s6+bxx5vFTEu71x5RM/MMU9PFZTjr69LRw/9Bx5vEj9Ur5x5RM/9Rx5vFZTjr69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY769LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur69LRw/MsU9PEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/1Bx5vDBIyT2JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0+dd8+zhx5vABTRzs+dd8+zhx5vABTRzszFgo/1Bx5vDBIyT1GxYA+xRx5vOoPLL5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL5GxYA+YsU9POoPLL4+dd8+WMU9PABTRzuyasU+UMU9PCieOr5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL6yasU+1hx5vCieOr6yasU+UMU9PCieOr66Yrg+1hx5vJhJZb6yasU+1hx5vCieOr66Yrg+UMU9PJhJZb7WL6c+1Rx5vAYtiL7WL6c+UMU9PAYtiL7SbJM+1Bx5vPdhm77SbJM+UsU9PPdhm77U0no+0Rx5vA72q77U0no+VsU9PA72q740/Uo+zRx5vGimub40/Uo+WsU9PGimub6MGRg+yBx5vLA7xL6MGRg+XsU9PLA7xL746sU9wxx5vDOLy7746sU9YsU9PDOLy77QnjE9aMU9PHt3z77QnjE9vRx5vHt3z74APSu8cMU9PJ3wz74APSu8txx5vJ3wz77Q/IK9dsU9PL30zL7Q/IK9sBx5vL30zL7INe69fsU9POSPxr7INe69qBx5vOSPxr7osCq+hsU9PN/bvL7osCq+oRx5vN/bvL4McFu+jsU9POP/r74McFu+mRx5vOP/r77aSYS+lMU9PM4voL7aSYS+kRx5vM4voL6+spi+nMU9PH6rjb6+spi+ihx5vH6rjb5KoKq+pMU9PHN7cb5KoKq+ghx5vHN7cb4qyrm+qsU9PPJ1Q74qyrm+exx5vPJ1Q74c88W+ssU9PE0AEr4c88W+dRx5vE0AEr4O6s6+uMU9PFTEu70O6s6+bxx5vFTEu70O6s6+uMU9PFTEu70O6s6+uMU9PFTEu70WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4O6s6+bxx5vFTEu70WWhy/zMU9PCkZGL7goBW/xMU9PFxGZr4WWhy/WRx5vCkZGL4WWhy/zMU9PCkZGL7goBW/Yxx5vFxGZr4qggy/usU9PGs7mL4qggy/bBx5vGs7mL7EIgG/sMU9PIu/ur7EIgG/dxx5vIu/ur4tYee+pMU9PDUk2r4tYee+ghx5vDUk2r7Zw8i+mMU9PKrq9b7Zw8i+jRx5vKrq9b4k6aa+jMU9PGTRBr8k6aa+mRx5vGTRBr/AWYK+gsU9PGN2EL/AWYK+pRx5vGN2EL+UUje+dsU9PGO9F7+UUje+sBx5vGO9F7+oz829asU9PAaJHL+oz829uxx5vAaJHL/AvqW8YMU9PPLFHr/AvqW8xhx5vPLFHr9QxXc9VsU9PBVrHr9QxXc90Bx5vBVrHr8Uxg8+TsU9POJ5G78Uxg8+2Bx5vOJ5G78cfF8+4Bx5vDz+Fb8cfF8+RsU9PDz+Fb/K6JU+5xx5vEYODr/K6JU+PsU9PEYODr8Wybk+7Rx5vAjKA78Wybk+OsU9PAjKA78izto+8Rx5vOq17r4izto+NsU9POq17r6qcvg+9Bx5vIbm0b6qcvg+MsU9PIbm0b59Hwk/9Rx5vDiasb59Hwk/MMU9PDiasb7Zw8i+mMU9PKrq9b7Zw8i+mMU9PKrq9b7AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL8k6aa+jMU9PGTRBr8tYee+pMU9PDUk2r4tYee+pMU9PDUk2r4tYee+pMU9PDUk2r6UUje+dsU9PGO9F7+UUje+dsU9PGO9F7+UUje+dsU9PGO9F7/EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur6oz829asU9PAaJHL+oz829asU9PAaJHL+oz829asU9PAaJHL8qggy/usU9PGs7mL4qggy/usU9PGs7mL4qggy/usU9PGs7mL7AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/goBW/xMU9PFxGZr7goBW/xMU9PFxGZr7goBW/xMU9PFxGZr5QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr8WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G7/aSYS+lMU9PM4voL7aSYS+lMU9PM4voL7aSYS+lMU9PM4voL6+spi+nMU9PH6rjb6+spi+nMU9PH6rjb5KoKq+pMU9PHN7cb5KoKq+pMU9PHN7cb4qyrm+qsU9PPJ1Q74qyrm+qsU9PPJ1Q74c88W+ssU9PE0AEr4c88W+ssU9PE0AEr4O6s6+uMU9PFTEu70McFu+jsU9POP/r74McFu+jsU9POP/r74McFu+jsU9POP/r74+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzuyasU+UMU9PCieOr6yasU+UMU9PCieOr6yasU+UMU9PCieOr5GxYA+YsU9POoPLL5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr69LRw/MsU9PEj9Ur69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb/osCq+hsU9PN/bvL7osCq+hsU9PN/bvL7INe69fsU9POSPxr7INe69fsU9POSPxr7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr8APSu8cMU9PJ3wz74APSu8cMU9PJ3wz77QnjE9aMU9PHt3z77QnjE9aMU9PHt3z7746sU9YsU9PDOLy7746sU9YsU9PDOLy7746sU9YsU9PDOLy74Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA7+MGRg+XsU9PLA7xL6MGRg+XsU9PLA7xL40/Uo+WsU9PGimub40/Uo+WsU9PGimub40/Uo+WsU9PGimub4izto+NsU9POq17r4izto+NsU9POq17r4izto+NsU9POq17r7U0no+VsU9PA72q77U0no+VsU9PA72q77U0no+VsU9PA72q76qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b7SbJM+UsU9PPdhm77SbJM+UsU9PPdhm77WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb4JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD4FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+bRx5vA4gWD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz5HOw+/PBx5vCrfpD5HOw+/PBx5vCrfpD5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT56R88+vRx5vOgXPz56R88+vRx5vOgXPz5qPtg+wxx5vLz5Cj6KHsM+thx5vI6NcD6KHsM+thx5vI6NcD6q9LM+rxx5vIhJjz6q9LM+rxx5vIhJjz4aB6I+qBx5vFA3pD4aB6I+qBx5vFA3pD42no0+oBx5vJ67tj42no0+oBx5vJ67tj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj7oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT8LSxo/zxx5vACviT4LSxo/zxx5vACviT4LSxo/zxx5vACviT5Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj74IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T40+0k+gRx5vEwDIz80+0k+gRx5vEwDIz80+0k+gRx5vEwDIz+KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D4eros+jBx5vE68Gz8eros+jBx5vE68Gz8eros+jBx5vE68Gz8yGNI+pBx5vD47Bj8yGNI+pBx5vD47Bj+CPbA+mBx5vEwXEj9OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5eDq++Wxx5vKAwiT5eDq++Wxx5vKAwiT5+252+XBx5vNe4nj5+252+XBx5vNe4nj5+252+XBx5vNe4nj5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT7KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj8kKmi+YRx5vOSBwj4kKmi+YRx5vOSBwj5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D62dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz/UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j5mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT+omaC9bhx5vAgX4j6omaC9bhx5vAgX4j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT/g4+o8exx5vGh85j7g4+o8exx5vGh85j5ITqg9ghx5vJSA4z5ITqg9ghx5vJSA4z6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6UWT0+kRx5vKxn0z6UWT0+kRx5vKxn0z787m2+bRx5vA4gWD787m2+bRx5vA4gWD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+Wxx5vPBLZz787m2+usU9PA4gWD6mNry+zMU9PPBLZz5eDq++Wxx5vKAwiT6mNry+Wxx5vPBLZz5eDq++zMU9PKAwiT5+252+XBx5vNe4nj5+252+ysU9PNe4nj52GIq+Xhx5vMrtsT52GIq+yMU9PMrtsT4kKmi+YRx5vOSBwj4kKmi+xsU9POSBwj5sVDi+ZBx5vDQy0D5sVDi+wsU9PDQy0D7UcAW+aRx5vH7H2j7UcAW+vsU9PH7H2j6omaC9bhx5vAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828dBx5vFAD5j7g4+o8rMU9PGh85j7g4+o8exx5vGh85j5ITqg9pMU9PJSA4z5ITqg9ghx5vJSA4z6kwwk+nsU9PLwb3T6kwwk+iRx5vLwb3T6UWT0+lsU9PKxn0z6UWT0+kRx5vKxn0z68GG4+jsU9PLCLxj68GG4+mBx5vLCLxj42no0+hsU9PJ67tj42no0+oBx5vJ67tj4aB6I+fsU9PFA3pD4aB6I+qBx5vFA3pD6q9LM+dsU9PIhJjz6q9LM+rxx5vIhJjz6KHsM+cMU9PI6NcD6KHsM+thx5vI6NcD56R88+asU9POgXPz56R88+vRx5vOgXPz5qPtg+ZMU9PLz5Cj5qPtg+wxx5vLz5Cj5qPtg+ZMU9PLz5Cj5qPtg+ZMU9PLz5Cj5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5qPtg+wxx5vLz5Cj5DBCE/TsU9PLwwRT5DBCE/2Bx5vLwwRT4LSxo/WMU9PACviT4LSxo/zxx5vACviT5DBCE/TsU9PLwwRT5dLBE/YsU9PDzHrj5dLBE/xRx5vDzHrj7rzAU/bMU9PFxL0T7rzAU/uhx5vFxL0T6KtfA+dsU9PPyv8D6KtfA+rxx5vPyv8D4yGNI+gsU9PD47Bj8yGNI+pBx5vD47Bj+CPbA+jsU9PEwXEj+CPbA+mBx5vEwXEj8eros+msU9PE68Gz8eros+jBx5vE68Gz80+0k+pMU9PEwDIz80+0k+gRx5vEwDIz/4IPM9sMU9PPLOJz/4IPM9dhx5vPLOJz9Qgh09usU9PNgLKj9Qgh09axx5vNgLKj9wIi29xMU9PP6wKT9wIi29Yhx5vP6wKT/oOvq9zsU9PMe/Jj/oOvq9WRx5vMe/Jj9g00y+URx5vChEIT9g00y+1sU9PChEIT9mlIy+Shx5vC1UGT9mlIy+3MU9PC1UGT+2dLC+RBx5vO4PDz+2dLC+4sU9PO4PDz/KedG+QBx5vNygAj/KedG+5sU9PNygAj9MHu++PRx5vF5y6D5MHu++6MU9PF5y6D5OdQS/PBx5vAomyD5OdQS/6sU9PAomyD5HOw+/PBx5vCrfpD5HOw+/6sU9PCrfpD5yeRe/Phx5vIU3gD5yeRe/6MU9PIU3gD5yeRe/Phx5vIU3gD70Lj+//MU9PKvqiD70Lj+/KRx5vKvqiD5yeRe/6MU9PIU3gD4FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+//MU9PKvqiD4FbAW/XRx5vKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT0FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+usU9PA4gWD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz5HOw+/6sU9PCrfpD5HOw+/6sU9PCrfpD5eDq++zMU9PKAwiT5eDq++zMU9PKAwiT5+252+ysU9PNe4nj5+252+ysU9PNe4nj5+252+ysU9PNe4nj5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT7KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj8kKmi+xsU9POSBwj4kKmi+xsU9POSBwj5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D62dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz/UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j5mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT+omaC9uMU9PAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT/g4+o8rMU9PGh85j7g4+o8rMU9PGh85j5ITqg9pMU9PJSA4z5ITqg9pMU9PJSA4z6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T7oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj+UWT0+lsU9PKxn0z6UWT0+lsU9PKxn0z68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj56R88+asU9POgXPz56R88+asU9POgXPz5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5qPtg+ZMU9PLz5Cj6KHsM+cMU9PI6NcD6KHsM+cMU9PI6NcD6q9LM+dsU9PIhJjz6q9LM+dsU9PIhJjz4aB6I+fsU9PFA3pD4aB6I+fsU9PFA3pD42no0+hsU9PJ67tj42no0+hsU9PJ67tj5wIi29xMU9PP6wKT9wIi29xMU9PP6wKT9wIi29xMU9PP6wKT8LSxo/WMU9PACviT4LSxo/WMU9PACviT4LSxo/WMU9PACviT5Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj74IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T40+0k+pMU9PEwDIz80+0k+pMU9PEwDIz80+0k+pMU9PEwDIz+KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D4eros+msU9PE68Gz8eros+msU9PE68Gz8eros+msU9PE68Gz8yGNI+gsU9PD47Bj8yGNI+gsU9PD47Bj+CPbA+jsU9PEwXEj/0Lj+//MU9PKvqiD70Lj+//MU9PKvqiD70Lj+//MU9PKvqiD4JJda+xMU9PLwSJT0JJda+xMU9PLwSJT0FbAW/yMU9PKwxXr387m2+usU9PA4gWD787m2+usU9PA4gWD787m2+usU9PA4gWD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD4eeCG0AACAvyvyJDPYIA20//9/v/jrjTM+Zwm0AACAvwGvAzRUadWzAACAv2wBkzMAAAAAAACAv1sy8rNUadWzAACAv2wBkzMAAAAAAACAv1sy8rMAAAAAAACAv/sMtrMvygK0//9/v6OQjDMt3tWzAACAv4PItjNUadWzAACAv2wBkzMAAAAAAACAv/sMtrM+Zwm0AACAvwGvAzQAAAAAAACAv1sy8rMeeCG0AACAvyvyJDM+Zwm0AACAvwGvAzQeeCG0AACAvyvyJDPYIA20//9/v/jrjTMeeKGzAACAv1bqjzPYIA20//9/v/jrjTPeWvGzAACAv9ZSuDP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMGTcqzAACAv3rnlTP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMGTcqzAACAv46mqzNGxgi0AACAv0PmizOdo/yzAACAv1rInTP9L+6zAACAvyhzjjMGTcqzAACAv46mqzNGxgi0AACAv0PmizMGTcqzAACAv46mqzNexgi0AACAv4iLizNGxgi0AACAv0PmizOdo/yzAACAv1rInTNexgi0AACAv4iLizOdo/yzAACAv1rInTNomu6zAACAv3yUkjP8kR+0AACAv/n0jjNexgi0AACAv4iLizNomu6zAACAv3yUkjP8kR+0AACAv/n0jjPITQK0AACAvzKJojNomu6zAACAv3yUkjPmvK2zAACAvzROtDP8kR+0AACAv/n0jjPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTOCvc+zAACAvze8kTPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTNklMOz//9/v+eNlzPEuQG0AACAvy3imTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOCvc+zAACAvze8kTNklMOz//9/v+eNlzNklMOz//9/v+eNlzO3aO+zAACAv241pTOCvc+zAACAvze8kTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOqIAC0AACAv7IwkjPTFk20AACAvxck/zLKARm0AACAv8NAmzMNM4GzAACAv4MQxDPTFk20AACAvxck/zLKARm0AACAv8NAmzPKARm0AACAv8NAmzPTFk20AACAvxck/zJjBjy0AACAv1jUkjMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjPE8rOzAACAv07jlzMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjMT1vWzAACAv1zarjPE8rOzAACAv07jlzMT1vWzAACAv1zarjP0ZdCzAACAv51NhDPE8rOzAACAv07jlzMT1vWzAACAv1zarjMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzMFsM2zAACAv91zuDO8riO0AACAv7WyjzMt3tWzAACAv4PItjMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzOxluOzAACAv6tQkzMt3tWzAACAv4PItjNHL9OzAACAvxxNvTMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDMAAAAAAACAv/sMtrMB1km0//9/v1NUFzNHL9OzAACAvxxNvTOxluOzAACAv6tQkzNHL9OzAACAvxxNvTP6wPqzAACAv/jvdzOxluOzAACAv6tQkzO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzO4TQK0AACAv6h2lDPFaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r7FaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r5z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9c1S2/wAFgOXjrOz9t1i2/AAAAAEXtOz9i1i2/lvevtk3tOz9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9j1i2/AAAAAEztOz9c1S2/AAAAAHjrOz+uAdc7AP5/PxABCDvX6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj8a3Qy/AAAAAKzBVT8a3Qy/AAAAAKzBVT/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz924To9AAAAAP+5fz924To9AAAAAP+5fz9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj+ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj+8LV4/AAAAAP1R/j68LV4/AAAAAP1R/j7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj7kEXI/AAAAAE2Npj6Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj/ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr7ZXWy/AAAAAImdxL68LV6/AAAAAP1R/r68LV6/AAAAAP1R/r6ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8s0ZW+AAAAAOrJdL8s0ZW+AAAAAOrJdL9dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL+jp1E/AAAAACbjEr+jp1E/AAAAACbjEr8AAAAAAACAP99/b7ToFs0zAACAPztbCbQAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrMAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrPGBA00AACAP04+17MVuM4zAACAPxB8JrNaC/4zAACAP9AmXLPGBA00AACAP04+17NaC/4zAACAP9AmXLNvSAo0AACAPwePZLPGBA00AACAP04+17Ow0OozAACAP6P0tbNaC/4zAACAP9AmXLNvSAo0AACAPwePZLOw0OozAACAP6P0tbNvSAo0AACAPwePZLM4mxA0AACAP94+m7Ow0OozAACAP6P0tbMDsPQzAACAP9OilLM4mxA0AACAP94+m7MDsPQzAACAP9OilLOB+wY0AACAPyWKabM4mxA0AACAP94+m7NMxNwzAACAP09Bs7MDsPQzAACAP9OilLOB+wY0AACAPyWKabPxA7UzAACAP67AxbNMxNwzAACAP09Bs7Oigewz//9/P+Fg1rPR4+4zAACAPwWMmrMINPIzAACAP9R1vbNU4PwzAACAP6VWQrOB+wY0AACAPyWKabNn3g80//9/P5hCdLPus1O1AACAP1RpgrVMxNwzAACAP09Bs7MfDQw0AACAPweLmLNn3g80//9/P5hCdLPus1O1AACAP1RpgrUINPIzAACAP9R1vbNn3g80//9/P5hCdLPxA7UzAACAP67AxbMINPIzAACAP9R1vbPxA7UzAACAP67AxbNU4PwzAACAP6VWQrOigewz//9/P+Fg1rNU4PwzAACAP6VWQrOigewz//9/P+Fg1rPR4+4zAACAPwWMmrPR4+4zAACAPwWMmrPus1O1AACAP1RpgrWDL7y0AACAP8e4RTMfDQw0AACAPweLmLOOm8kzAACAP4A1pbNX6/YzAACAP4WIm7OyGPczAACAP6NlnLNsGvczAACAP7AwkrNx1gE0AACAPzDFo7NX6/YzAACAP4WIm7OyGPczAACAP6NlnLPCqgM0AACAP6X6m7NX6/YzAACAP4WIm7MUIfYzAACAPyr6m7OyGPczAACAP6NlnLNx1gE0AACAPzDFo7PCqgM0AACAP6X6m7OOm8kzAACAP4A1pbNx1gE0AACAPzDFo7OOm8kzAACAP4A1pbNsGvczAACAP7AwkrNsGvczAACAP7AwkrODL7y0AACAP8e4RTM91skzAACAPz/yJLMfDQw0AACAPweLmLM+5Q80AACAPzbdabMZ3mc0//9/P/75HrODL7y0AACAP8e4RTMZ3mc0//9/P/75HrM91skzAACAPz/yJLMZ3mc0//9/P/75HrPPVJIz//9/P5ozCrQ91skzAACAPz/yJLM+5Q80AACAPzbdabPPVJIz//9/P5ozCrQDMO4zAACAP8z6t7NbmQE0AACAP3jnlbM+5Q80AACAPzbdabPT9xg0AACAP8ew/7LPVJIz//9/P5ozCrTT9xg0AACAP8ew/7JbmQE0AACAP3jnlbPT9xg0AACAP8ew/7LNVbczAACAP9yCzLMDMO4zAACAP8z6t7NbmQE0AACAP3jnlbPNVbczAACAP9yCzLMDMO4zAACAP8z6t7PyDfUzAACAPzLsqbOdo/wzAACAP1PInbPNVbczAACAP9yCzLPyDfUzAACAPzLsqbPyDfUzAACAPzLsqbMIwfozAACAP5GLi7Odo/wzAACAP1PInbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLOdo/wzAACAP1PInbPdwPozAACAP97yVbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLPdwPozAACAP97yVbOBo/wzAACAP1gyfLOuTQI0AACAP24GkrPKTQI0AACAPx1RirPdwPozAACAP97yVbOuTQI0AACAP24GkrOk4+4zAACAPzvBurOuTQI0AACAP24GkrPKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PCqgM0AACAP6X6m7PA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDOg9f+7oPV/v7H0grzA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDPA8hK0//9/v4LkkjOg9f+7oPV/v7H0grySF/Sz//9/v1t7mDO/zMw57/9/v8Cotjqg9f+7oPV/v7H0grxtqQW0AACAv4YwpDO/zMw57/9/v8CotjoBQg60AACAv44alzNtqQW0AACAv4YwpDOapuezAACAv5IalzO/zMw57/9/v8CotjptqQW0AACAv4YwpDOapuezAACAv5IalzMeeCG0AACAv6F1vTPbuRe0AACAv5pQkzOCdQS0AACAv06elTOlWvGzAACAv3GmdDOt4+6zAACAvzWBlzPdZeezAACAv/hIlzNI9eOzAACAv3ssqTPQ6+KzAACAv1AdgTMAAAAAAACAv8iawDOt4+6zAACAvzWBlzNI9eOzAACAv3ssqTOt4+6zAACAvzWBlzPbuRe0AACAv5pQkzNI9eOzAACAv3ssqTPbuRe0AACAv5pQkzOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTMAAAAAAACAv8iawDPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTQAAAAAAACAv8iawDMC1AS0//9/v4IBlTOCdQS0AACAv06elTPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTTuNXKzAACAv31SazMn7hi0AACAv3gntzOCdQS0AACAv06elTPdZeezAACAv/hIlzMn7hi0AACAv3gntzNakPKzAACAv2U/mzPdZeezAACAv/hIlzMn7hi0AACAv3gntzNp4wy0AACAv8hMhDNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPT1vWzAACAv0bZrjNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPYC/6zAACAv07jlzPT1vWzAACAv0bZrjPYC/6zAACAv07jlzPT1vWzAACAv0bZrjOGBryzAACAvznWkjPYC/6zAACAv07jlzPHts6zAACAvyQRxDOGBryzAACAvznWkjPHts6zAACAvyQRxDOGBryzAACAvznWkjNDFk2zAACAv2If/zLHts6zAACAvyQRxDNDFk2zAACAv2If/zIAAAAAAACAv65CmzNDFk2zAACAv2If/zIAAAAAAACAv65CmzMAAAAAAACAv65CmzMBQg60AACAv44alzOcpuezAACAvxeJojOapuezAACAv5IalzOjdMOz//9/vx9tljMBQg60AACAv44alzOjdMOz//9/vx9tljNiKQ20AACAvzO7mDOcpuezAACAvxeJojOjdMOz//9/vx9tljNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDOcpuezAACAvxeJojNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDMaLNmzAACAv+FtlzNSyBC0AACAv0C7mDNKW++zAACAv/dUtTNjkeCzAACAv4LInTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjPPXbazAACAvwnmizPKXbaz//9/vx/YoTMAbSi0AACAv0+3kjN7UwS0AACAv9makjMfbeCzAACAv0DolTPKXbaz//9/vx/YoTMfbeCzAACAv0DolTPKXbaz//9/vx/YoTNbkAS0AACAvydkhTN7UwS0AACAv9makjMfbeCzAACAv0DolTNpnRq0AACAv8gDnDMC1AS0//9/v4IBlTNbkAS0AACAvydkhTN7UwS0AACAv9makjNqj6uzAACAv/ODvjNpnRq0AACAv8gDnDNbkAS0AACAvydkhTNpnRq0AACAv8gDnDNqj6uzAACAv/ODvjMC1AS0//9/v4IBlTNqj6uzAACAv/ODvjPuNXKzAACAv31SazOmGs6zAACAv9nYDTTuNXKzAACAv31SazMtBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL8s1ZW+AAAAAOrJdL8s1ZW+AAAAAOrJdL+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr+ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr+8LV6/AAAAAP1R/r68LV6/AAAAAP1R/r7ZXWy/AAAAAImdxL7ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr6Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr/kEXI/AAAAAE2Npj7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj68LV4/AAAAAP1R/j68LV4/AAAAAP1R/j6ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD924To9AAAAAP+5fz924To9AAAAAP+5fz9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT8a2wy/AAAAAKzBVT8a2wy/AAAAAKzBVT9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD+jp1G/AAAAACbjEj+jp1G/AAAAACbjEj/FaWK/AAAAAN7p7j7FaWK/AAAAAN7p7j7Td2m/AAAAAKQB0j7Td2m/AAAAAKQB0j5IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE79rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9xLi0/AAAAAB6IPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9tLi0/AAAAACKIPL+cpuczAACAP706krMJIfYzAACAPwhRirPCTQI0//9/P/wxZLMDQg40AACAP786krOJzEy6q/9/P70fSrsKxd4zAACAPy1doLOcpuczAACAP706krMDQg40AACAP786krMKxd4zAACAPy1doLOcpuczAACAP706krPCTQI0//9/P/wxZLMDQg40AACAP786krMJIfYzAACAPwhRirOXTQI0AACAP5AGkrPCTQI0//9/P/wxZLPqpuczAACAPxfhqLMJIfYzAACAPwhRirOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLNymu4z//9/P33InbN2xgg0AACAPymMi7MgLNkzAACAP46mr7N2xgg0AACAPymMi7NI9eMzAACAP+7rqbNymu4z//9/P33InbN2xgg0AACAPymMi7PLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNymu4z//9/P33InbPLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNSxgg0AACAPzElfLPLjNkzAACAPy7ZirPk3/wzAACAPzzolbOYBAE0AACAP2wCrbNSxgg0AACAPzElfLPk3/wzAACAPzzolbNSxgg0AACAPzElfLOmTcozAACAP2uos7Pk3/wzAACAPzzolbOYBAE0AACAP2wCrbPrd6EzAACAP1VHFbSmTcozAACAP2uos7NaYd0z//9/P4IBlbOYBAE0AACAP2wCrbM8AzU0AACAPxCjSbOmTcozAACAP2uos7M8AzU0AACAPxCjSbPrd6EzAACAP1VHFbQ8AzU0AACAPxCjSbPrd6EzAACAP1VHFbRaYd0z//9/P4IBlbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNaYd0z//9/P4IBlbPQ6+IzAACAPw2bl7O91gU0AACAPz72b7NQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbPQ6+IzAACAPw2bl7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNexgg0AACAPwDwd7Mop7Uz//9/P6h1vbPcr80zAACAPyjNubPQ6+IzAACAPw2bl7Ns4PwzAACAP4RWQrOnTQI0AACAP392lLO91gU0AACAPz72b7P3wgc0AACAPynAxbNexgg0AACAPwDwd7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNs4PwzAACAP4RWQrNexgg0AACAPwDwd7Ns4PwzAACAP4RWQrP3wgc0AACAPynAxbMop7Uz//9/P6h1vbP3wgc0AACAPynAxbMop7Uz//9/P6h1vbPm7jw0AACAP5mawLPcr80zAACAPyjNubML3wE0AACAP+HCirO91gU0AACAPz72b7Pcr80zAACAPyjNubML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprOCnAI0AACAP8CQoLM6phk0AACAP1dkerPh2bszAACAP9rfprNL9gY0AACAP73yJrM6phk0AACAP1dkerNL9gY0AACAP73yJrM6phk0AACAP1dkerMksBw0AACAPwfZHLMVCZszAACAP1pxGrRL9gY0AACAP73yJrMksBw0AACAPwfZHLMvFk0zAACAP/6ZsLMVCZszAACAP1pxGrQksBw0AACAPwfZHLMvFk0zAACAP/6ZsLOBApkzAACAP65Cm7MVCZszAACAP1pxGrQvFk0zAACAP/6ZsLOBApkzAACAP65Cm7OBApkzAACAP65Cm7MAAAAAqv9/P7lLUzsgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzuSF/Qz//9/P1XrkLOJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzsKxd4zAACAPy1doLMAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwMABQAKAAYABAANAAwAAgAPAA4AAAAQABEAAQATABIAFwAZABgAFAAaABsAFgAdABwAFQAhAB4AIgAkACMAHwAmACcAIAApACUAKAAsAC0AKgAwACsALgAyADMAMQA2ADQALwA3ADUAOAA7ADwAOQBAADoAPQBBAEMASABJAEQAQgA+AEcAPwBLAEYASgBNAEUATABOAFAAUwBUAFIATwBVAFcAUQBaAFYAWABbAF0AWQBgAFwAXgBhAGMAXwBmAGIAZQBoAGcAZABqAGkAbAB0AHIAawAJAG4ACAB2AG0AdQB4AHMAeQB7AHEAegB9AHAAfAB/AG8AfgCAAHcACwAHAIEAggCDAIIAgQCEAIYAiACJAIcAhQCKAIwAjgCPAI0AiwCQAJEAlQCXAJYAkwCZAJgAkgCaAJsAlACcAJ0AngCfAJ4AnQCgAKEAogCjAKIAoQCkAKQApQCiAKUApACmAKYApwClAKcApgCoAKgAqQCnAKkAqACqAKoAqwCpAKsAqgCsAKwArQCrAK0ArACuAK4ArwCtAK8ArgCwAK8AsQCyALEArwCwALIAswC0ALMAsgCxALQAtQC2ALUAtACzALYAtwC4ALcAtgC1ALgAuQC6ALkAuAC3ALoAuwC8ALsAugC5ALwAvQC+AL0AvAC7AL4AvwDAAL8AvgC9AMAAwQDCAMEAwAC/AMIAwwDEAMMAwgDBAMQAxQDGAMUAxADDAMYAxwDIAMcAxgDFAMkAywDNAMwAygDOAM8A0ADRANAAzwDSANMA0gDPANIA0wDUANUA1ADTANQA1QDWANcA1gDVANYA1wDYANkA2ADXANgA2QDaANsA2gDZANoA2wDcAN0A3ADbANwA3QDeAN8A3gDdAN4A3wDgAOEA4ADfAOAA4QDiAOMA4gDhAOIA4wDkAOUA5ADjAOQA5QDmAOcA5gDlAOYA5wDoAOcA6QDoAOkA5wDqAOoA6wDpAOsA6gDsAOwA7QDrAO0A7ADuAO4A7wDtAO8A7gDwAPAA8QDvAPEA8ADyAPIA8wDxAPMA8gD0APQAgwDzAIMA9ACBAPUA9wD6APgA9gD7APkA/AD+AAAB/QADAf8AAQEFAQYBAgEIAQQBBwEKAQwBCQEPAQsBDQERARIBDgEZARABFAEcAR4BGgEhASABFwEjASIBEwEkASUBGAEnASYBFQEoASkBFgEqARsBHwErAS8BMwE2ATQBMAE4ATkBMgE8ATsBLgE9AT4BMQE/AS0BQgEdAUABLAFFAUQBRgFIAUEBRwFKAUMBSwFPAUwBSQFRAVABUgFUAU4BUwFXAU0BVgFZAVgBVQFcAVoBXQFeAVsBYAFjAWEBXwFlAWIBZgFoAWcBZAFrAWkBbAFuAWoBbwFyAXABbQFzAXEBdAE3AToBdQE1AXYBeQF7AXoBdwF9AXgBfAF/AYEBfgGFAYABgwGGAYwBkQGTAZIBjgGVAZQBiQGWAZcBiwGZAZgBiAGaAZsBkAGeAZwBjwGhAaABigGlAaYBjQGpAaQBpwGqAawBqAGvAasBrQGwAbIBrgG0AbEBswG2AbgBtQG6AbcBuQG8Ab0BuwG/Ab4BwAHBAYQBxAGHAcIBggHGAcUBxwHKAcMByQHNAcwByAHPAcsBzgHRAdQB0AHWAdIB1QHXAdMB2AHbAdwB2QHeAdoB3QHgAeMB3wHlAeIB5AHoAeEB5wHsAesB5gHvAekB7gHwAe0B8QHzAeoB8gGfAaMB9AH2AaIB9QGdAfcB+QH7AfoB+AH8Af0B/gH/Af4B/QEAAgACAQL+AQECAAICAgICAwIBAgMCAgIEAgQCBQIDAgUCBAIGAgYCBwIFAgcCBgIIAggCCQIHAgkCCAIKAgoCCwIJAgsCCgIMAg0CCwIMAgsCDQIOAg8CDgINAg4CDwIQAhECEAIPAhACEQISAhMCEgIRAhICEwIUAhUCFAITAhQCFQIWAhcCFgIVAhYCFwIYAhkCGAIXAhgCGQIaAhsCGgIZAhoCGwIcAh0CHAIbAhwCHQIeAh8CHgIdAh4CHwIgAiECIAIfAiACIQIiAiMCIgIhAiICIwIkAiUCJwIpAigCJgIqAisCLAItAiwCKwIuAi0CLwIwAi8CLQIsAjACMQIyAjECMAIvAjICMwI0AjMCMgIxAjQCNQI2AjUCNAIzAjYCNwI4AjcCNgI1AjgCOQI6AjkCOAI3AjoCOwI8AjsCOgI5AjwCPQI+Aj0CPAI7Aj4CPwJAAj8CPgI9AkACQQJCAkECQAI/AkICQwJEAkMCQgJBAkMCRQJEAkUCQwJGAkYCRwJFAkcCRgJIAkgCSQJHAkkCSAJKAkoCSwJJAksCSgJMAkwCTQJLAk0CTAJOAk4CTwJNAk8CTgJQAlACUQJPAlECUAJSAlICUwJRAlMCUgJUAlUCVgJXAlYCVQJYAloCXAJdAlsCWQJeAmECYwJkAmICXwJlAmYCYAJnAmgCbgJxAm8CawJzAnICagJ2AnQCaQJ4AnUCeQJ8AnsCdwJ+AnoCfQKBAoICgAKFAoQCfwKIAoMChwKKAokChgKMAosCjwKRApACjQKTApQCjgKYApIClgKaApsCmQKdApwClQKeAp8ClwKiAqACpQKnAqYCoQKoAqsCsQK2ArQCrAK4ArACtwK5ArMCugK8Aq0CuwK9ArUCvgKqAq8CqQKjArICpALBAq4CvwLCAsMCwALGAsQCxwLJAsgCxQLLAsoCzQLPAs4CzALSAtAC0wLWAtUC0QLZAtQC1wLaAtsC2ALcAt4C4ALiAuEC3wLlAuQC3QLnAuMC5gJsAm0C6AJwAgAAAACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAIA/AACAPwAAAAAAAAAAAACAPwAAAAAAAAEAAwAAAAMAAgAAAAAAAAAAAAAAgL/CxUe+AAAAAL4Ue78W78O+AAAAAF6DbL/aOQ6/AAAAADHbVL/zBDW/AAAAAPMENb8x21S/AAAAANo5Dr9eg2y/AAAAABXvw76+FHu/AAAAAMTFR74AAIC/AAAAAC69OzO+FHu/AAAAAMLFRz5fg2y/AAAAABTvwz4y21S/AAAAANk5Dj/zBDW/AAAAAPMENT/ZOQ6/AAAAADLbVD8X78O+AAAAAF6DbD/BxUe+AAAAAL8Uez8uvbszAAAAAAAAgD+9xUc+AAAAAL8Uez8V78M+AAAAAF6DbD/bOQ4/AAAAADDbVD/yBDU/AAAAAPQENT8v21Q/AAAAAN05Dj9eg2w/AAAAABrvwz6+FHs/AAAAAMbFRz4AAIA/AAAAAC7eTLK+FHs/AAAAAMjFR75dg2w/AAAAABvvw74z21Q/AAAAANc5Dr/1BDU/AAAAAPIENb/bOQ4/AAAAADHbVL8V78M+AAAAAF+DbL+8xUc+AAAAAL8Ue78AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/DHBbvpkcebzj/6++DHBbvpkcebzj/6++DHBbvpkcebzj/6++FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/6LAqvqEcebzf27y+6LAqvqEcebzf27y+yDXuvagcebzkj8a+yDXuvagcebzkj8a+0PyCvbAceby99My+0PyCvbAceby99My+0PyCvbAceby99My+yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/AD0rvLccebyd8M++AD0rvLccebyd8M++0J4xPb0cebx7d8++0J4xPb0cebx7d8+++OrFPcMcebwzi8u++OrFPcMcebwzi8u++OrFPcMcebwzi8u+Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/jBkYPsgcebywO8S+jBkYPsgcebywO8S+NP1KPs0cebxoprm+NP1KPs0cebxoprm+NP1KPs0cebxoprm+Is7aPvEcebzqte6+Is7aPvEcebzqte6+Is7aPvEcebzqte6+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+0myTPtQcebz3YZu+0myTPtQcebz3YZu+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+umK4PtYcebyYSWW+umK4PtYcebyYSWW+umK4PtYcebyYSWW+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+smrFPtYcebwonjq+smrFPtYcebwonjq+smrFPtYcebwonjq+PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7RsWAPsUcebzqDyy+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP9QcebwwSMk9wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/2cPIvo0cebyq6vW+2cPIvo0cebyq6vW+JOmmvpkcebxk0Qa/LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+qM/NvbscebwGiRy/qM/NvbscebwGiRy/qM/NvbscebwGiRy/KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/4KAVv2McebxcRma+4KAVv2McebxcRma+4KAVv2McebxcRma+UMV3PdAcebwVax6/UMV3PdAcebwVax6/UMV3PdAcebwVax6/Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+vrKYvoocebx+q42+vrKYvoocebx+q42+SqCqvoIcebxze3G+SqCqvoIcebxze3G+Ksq5vnscebzydUO+Ksq5vnscebzydUO+HPPFvnUcebxNABK+HPPFvnUcebxNABK+DurOvm8cebxUxLu9ceUTPzDFPTxWU46+vS0cP/QcebxI/VK+ceUTP/UcebxWU46+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+vS0cPzLFPTxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP9QcebwwSMk9iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7MxYKP9QcebwwSMk9RsWAPsUcebzqDyy+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+RsWAPmLFPTzqDyy+PnXfPljFPTwAU0c7smrFPlDFPTwonjq+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+smrFPtYcebwonjq+smrFPlDFPTwonjq+umK4PtYcebyYSWW+smrFPtYcebwonjq+umK4PlDFPTyYSWW+1i+nPtUcebwGLYi+1i+nPlDFPTwGLYi+0myTPtQcebz3YZu+0myTPlLFPTz3YZu+1NJ6PtEcebwO9qu+1NJ6PlbFPTwO9qu+NP1KPs0cebxoprm+NP1KPlrFPTxoprm+jBkYPsgcebywO8S+jBkYPl7FPTywO8S++OrFPcMcebwzi8u++OrFPWLFPTwzi8u+0J4xPWjFPTx7d8++0J4xPb0cebx7d8++AD0rvHDFPTyd8M++AD0rvLccebyd8M++0PyCvXbFPTy99My+0PyCvbAceby99My+yDXuvX7FPTzkj8a+yDXuvagcebzkj8a+6LAqvobFPTzf27y+6LAqvqEcebzf27y+DHBbvo7FPTzj/6++DHBbvpkcebzj/6++2kmEvpTFPTzOL6C+2kmEvpEcebzOL6C+vrKYvpzFPTx+q42+vrKYvoocebx+q42+SqCqvqTFPTxze3G+SqCqvoIcebxze3G+Ksq5vqrFPTzydUO+Ksq5vnscebzydUO+HPPFvrLFPTxNABK+HPPFvnUcebxNABK+DurOvrjFPTxUxLu9DurOvm8cebxUxLu9DurOvrjFPTxUxLu9DurOvrjFPTxUxLu9Flocv1kcebwpGRi+Flocv1kcebwpGRi+DurOvm8cebxUxLu9Flocv8zFPTwpGRi+4KAVv8TFPTxcRma+Flocv1kcebwpGRi+Flocv8zFPTwpGRi+4KAVv2McebxcRma+KoIMv7rFPTxrO5i+KoIMv2wcebxrO5i+xCIBv7DFPTyLv7q+xCIBv3ccebyLv7q+LWHnvqTFPTw1JNq+LWHnvoIcebw1JNq+2cPIvpjFPTyq6vW+2cPIvo0cebyq6vW+JOmmvozFPTxk0Qa/JOmmvpkcebxk0Qa/wFmCvoLFPTxjdhC/wFmCvqUcebxjdhC/lFI3vnbFPTxjvRe/lFI3vrAcebxjvRe/qM/NvWrFPTwGiRy/qM/NvbscebwGiRy/wL6lvGDFPTzyxR6/wL6lvMYcebzyxR6/UMV3PVbFPTwVax6/UMV3PdAcebwVax6/FMYPPk7FPTzieRu/FMYPPtgcebzieRu/HHxfPuAcebw8/hW/HHxfPkbFPTw8/hW/yuiVPuccebxGDg6/yuiVPj7FPTxGDg6/Fsm5Pu0cebwIygO/Fsm5PjrFPTwIygO/Is7aPvEcebzqte6+Is7aPjbFPTzqte6+qnL4PvQcebyG5tG+qnL4PjLFPTyG5tG+fR8JP/Ucebw4mrG+fR8JPzDFPTw4mrG+2cPIvpjFPTyq6vW+2cPIvpjFPTyq6vW+wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/JOmmvozFPTxk0Qa/LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+vrKYvpzFPTx+q42+vrKYvpzFPTx+q42+SqCqvqTFPTxze3G+SqCqvqTFPTxze3G+Ksq5vqrFPTzydUO+Ksq5vqrFPTzydUO+HPPFvrLFPTxNABK+HPPFvrLFPTxNABK+DurOvrjFPTxUxLu9DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7smrFPlDFPTwonjq+smrFPlDFPTwonjq+smrFPlDFPTwonjq+RsWAPmLFPTzqDyy+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+vS0cPzLFPTxI/VK+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/6LAqvobFPTzf27y+6LAqvobFPTzf27y+yDXuvX7FPTzkj8a+yDXuvX7FPTzkj8a+0PyCvXbFPTy99My+0PyCvXbFPTy99My+0PyCvXbFPTy99My+yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/AD0rvHDFPTyd8M++AD0rvHDFPTyd8M++0J4xPWjFPTx7d8++0J4xPWjFPTx7d8+++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u+Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/jBkYPl7FPTywO8S+jBkYPl7FPTywO8S+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+0myTPlLFPTz3YZu+0myTPlLFPTz3YZu+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+CSXWvmMceby8EiU9CSXWvmMceby8EiU99C4/vykcebyr6og+9C4/vykcebyr6og+9C4/vykcebyr6og+BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+RzsPvzwcebwq36Q+RzsPvzwcebwq36Q+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+ekfPPr0cebzoFz8+ekfPPr0cebzoFz8+aj7YPsMceby8+Qo+ih7DPrYcebyOjXA+ih7DPrYcebyOjXA+qvSzPq8cebyISY8+qvSzPq8cebyISY8+GgeiPqgcebxQN6Q+GgeiPqgcebxQN6Q+Np6NPqAcebyeu7Y+Np6NPqAcebyeu7Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/cCItvWIcebz+sCk/cCItvWIcebz+sCk/cCItvWIcebz+sCk/C0saP88cebwAr4k+C0saP88cebwAr4k+C0saP88cebwAr4k+UIIdPWscebzYCyo/UIIdPWscebzYCyo/UIIdPWscebzYCyo/XSwRP8Ucebw8x64+XSwRP8Ucebw8x64+XSwRP8Ucebw8x64++CDzPXYcebzyzic/+CDzPXYcebzyzic/+CDzPXYcebzyzic/68wFP7ocebxcS9E+68wFP7ocebxcS9E+68wFP7ocebxcS9E+NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/irXwPq8cebz8r/A+irXwPq8cebz8r/A+irXwPq8cebz8r/A+Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/MhjSPqQcebw+OwY/MhjSPqQcebw+OwY/gj2wPpgcebxMFxI/TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+Xg6vvlscebygMIk+Xg6vvlscebygMIk+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+TB7vvj0cebxecug+TB7vvj0cebxecug+TB7vvj0cebxecug+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/JCpovmEcebzkgcI+JCpovmEcebzkgcI+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/qJmgvW4cebwIF+I+qJmgvW4cebwIF+I+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/4OPqPHscebxofOY+4OPqPHscebxofOY+SE6oPYIcebyUgOM+SE6oPYIcebyUgOM+pMMJPokceby8G90+pMMJPokceby8G90+pMMJPokceby8G90+lFk9PpEcebysZ9M+lFk9PpEcebysZ9M+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vlscebzwS2c+/O5tvrrFPTwOIFg+pja8vszFPTzwS2c+Xg6vvlscebygMIk+pja8vlscebzwS2c+Xg6vvszFPTygMIk+ftudvlwcebzXuJ4+ftudvsrFPTzXuJ4+dhiKvl4cebzK7bE+dhiKvsjFPTzK7bE+JCpovmEcebzkgcI+JCpovsbFPTzkgcI+bFQ4vmQcebw0MtA+bFQ4vsLFPTw0MtA+1HAFvmkcebx+x9o+1HAFvr7FPTx+x9o+qJmgvW4cebwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvHQcebxQA+Y+4OPqPKzFPTxofOY+4OPqPHscebxofOY+SE6oPaTFPTyUgOM+SE6oPYIcebyUgOM+pMMJPp7FPTy8G90+pMMJPokceby8G90+lFk9PpbFPTysZ9M+lFk9PpEcebysZ9M+vBhuPo7FPTywi8Y+vBhuPpgcebywi8Y+Np6NPobFPTyeu7Y+Np6NPqAcebyeu7Y+GgeiPn7FPTxQN6Q+GgeiPqgcebxQN6Q+qvSzPnbFPTyISY8+qvSzPq8cebyISY8+ih7DPnDFPTyOjXA+ih7DPrYcebyOjXA+ekfPPmrFPTzoFz8+ekfPPr0cebzoFz8+aj7YPmTFPTy8+Qo+aj7YPsMceby8+Qo+aj7YPmTFPTy8+Qo+aj7YPmTFPTy8+Qo+QwQhP9gceby8MEU+QwQhP9gceby8MEU+aj7YPsMceby8+Qo+QwQhP07FPTy8MEU+QwQhP9gceby8MEU+C0saP1jFPTwAr4k+C0saP88cebwAr4k+QwQhP07FPTy8MEU+XSwRP2LFPTw8x64+XSwRP8Ucebw8x64+68wFP2zFPTxcS9E+68wFP7ocebxcS9E+irXwPnbFPTz8r/A+irXwPq8cebz8r/A+MhjSPoLFPTw+OwY/MhjSPqQcebw+OwY/gj2wPo7FPTxMFxI/gj2wPpgcebxMFxI/Hq6LPprFPTxOvBs/Hq6LPowcebxOvBs/NPtJPqTFPTxMAyM/NPtJPoEcebxMAyM/+CDzPbDFPTzyzic/+CDzPXYcebzyzic/UIIdPbrFPTzYCyo/UIIdPWscebzYCyo/cCItvcTFPTz+sCk/cCItvWIcebz+sCk/6Dr6vc7FPTzHvyY/6Dr6vVkcebzHvyY/YNNMvlEcebwoRCE/YNNMvtbFPTwoRCE/ZpSMvkocebwtVBk/ZpSMvtzFPTwtVBk/tnSwvkQcebzuDw8/tnSwvuLFPTzuDw8/ynnRvkAcebzcoAI/ynnRvubFPTzcoAI/TB7vvj0cebxecug+TB7vvujFPTxecug+TnUEvzwcebwKJsg+TnUEv+rFPTwKJsg+RzsPvzwcebwq36Q+RzsPv+rFPTwq36Q+cnkXvz4cebyFN4A+cnkXv+jFPTyFN4A+cnkXvz4cebyFN4A+9C4/v/zFPTyr6og+9C4/vykcebyr6og+cnkXv+jFPTyFN4A+BWwFv8jFPTysMV69BWwFv8jFPTysMV699C4/vykcebyr6og+9C4/vykcebyr6og+9C4/v/zFPTyr6og+BWwFv10cebysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69CSXWvmMceby8EiU9CSXWvmMceby8EiU9BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvrrFPTwOIFg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+RzsPv+rFPTwq36Q+RzsPv+rFPTwq36Q+Xg6vvszFPTygMIk+Xg6vvszFPTygMIk+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+TB7vvujFPTxecug+TB7vvujFPTxecug+TB7vvujFPTxecug+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/JCpovsbFPTzkgcI+JCpovsbFPTzkgcI+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/qJmgvbjFPTwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/4OPqPKzFPTxofOY+4OPqPKzFPTxofOY+SE6oPaTFPTyUgOM+SE6oPaTFPTyUgOM+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/lFk9PpbFPTysZ9M+lFk9PpbFPTysZ9M+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+ekfPPmrFPTzoFz8+ekfPPmrFPTzoFz8+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+aj7YPmTFPTy8+Qo+ih7DPnDFPTyOjXA+ih7DPnDFPTyOjXA+qvSzPnbFPTyISY8+qvSzPnbFPTyISY8+GgeiPn7FPTxQN6Q+GgeiPn7FPTxQN6Q+Np6NPobFPTyeu7Y+Np6NPobFPTyeu7Y+cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/XSwRP2LFPTw8x64+XSwRP2LFPTw8x64+XSwRP2LFPTw8x64++CDzPbDFPTzyzic/+CDzPbDFPTzyzic/+CDzPbDFPTzyzic/68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/MhjSPoLFPTw+OwY/MhjSPoLFPTw+OwY/gj2wPo7FPTxMFxI/9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+CSXWvsTFPTy8EiU9CSXWvsTFPTy8EiU9BWwFv8jFPTysMV69/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+HnghtAAAgL8r8iQz2CANtP//f7/4640zPmcJtAAAgL8BrwM0VGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzVGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzAAAAAAAAgL/7DLazL8oCtP//f7+jkIwzLd7VswAAgL+DyLYzVGnVswAAgL9sAZMzAAAAAAAAgL/7DLazPmcJtAAAgL8BrwM0AAAAAAAAgL9bMvKzHnghtAAAgL8r8iQzPmcJtAAAgL8BrwM0HnghtAAAgL8r8iQz2CANtP//f7/4640zHnihswAAgL9W6o8z2CANtP//f7/4640z3lrxswAAgL/WUrgz/S/uswAAgL8oc44zBk3KswAAgL9655UzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzBk3KswAAgL9655Uz/S/uswAAgL8oc44zBk3KswAAgL9655UzBk3KswAAgL+OpqszRsYItAAAgL9D5osznaP8swAAgL9ayJ0z/S/uswAAgL8oc44zBk3KswAAgL+OpqszRsYItAAAgL9D5oszBk3KswAAgL+OpqszXsYItAAAgL+Ii4szRsYItAAAgL9D5osznaP8swAAgL9ayJ0zXsYItAAAgL+Ii4sznaP8swAAgL9ayJ0zaJruswAAgL98lJIz/JEftAAAgL/59I4zXsYItAAAgL+Ii4szaJruswAAgL98lJIz/JEftAAAgL/59I4zyE0CtAAAgL8yiaIzaJruswAAgL98lJIz5rytswAAgL80TrQz/JEftAAAgL/59I4z5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpcznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzgr3PswAAgL83vJEz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzZJTDs///f7/njZczxLkBtAAAgL8t4pkzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzgr3PswAAgL83vJEzZJTDs///f7/njZczZJTDs///f7/njZczt2jvswAAgL9uNaUzgr3PswAAgL83vJEzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzqiAAtAAAgL+yMJIz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszDTOBswAAgL+DEMQz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszygEZtAAAgL/DQJsz0xZNtAAAgL8XJP8yYwY8tAAAgL9Y1JIzDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzxPKzswAAgL9O45czDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzE9b1swAAgL9c2q4zxPKzswAAgL9O45czE9b1swAAgL9c2q4z9GXQswAAgL+dTYQzxPKzswAAgL9O45czE9b1swAAgL9c2q4zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGczBbDNswAAgL/dc7gzvK4jtAAAgL+1so8zLd7VswAAgL+DyLYzBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzuE0CtAAAgL+odpQz+sD6swAAgL/473czsZbjswAAgL+rUJMzLd7VswAAgL+DyLYzRy/TswAAgL8cTb0zBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzAAAAAAAAgL/7DLazAdZJtP//f79TVBczRy/TswAAgL8cTb0zsZbjswAAgL+rUJMzRy/TswAAgL8cTb0z+sD6swAAgL/473czsZbjswAAgL+rUJMzuE0CtAAAgL+odpQz+sD6swAAgL/473czuE0CtAAAgL+odpQzxWliPwAAAADe6e6+03dpPwAAAACkAdK+xWliPwAAAADe6e6+03dpPwAAAACkAdK+c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/XNUtv8ABYDl46zs/bdYtvwAAAABF7Ts/YtYtv5b3r7ZN7Ts/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/Y9YtvwAAAABM7Ts/XNUtvwAAAAB46zs/rgHXOwD+fz8QAQg71+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/Gt0MvwAAAACswVU/Gt0MvwAAAACswVU/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/b5M3PwAAAABlazI/b5M3PwAAAABlazI/mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+5BFyPwAAAABNjaY+mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+2V1svwAAAACJncS+vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/b5M3vwAAAABlazK/b5M3vwAAAABlazK/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/LNGVvgAAAADqyXS/LNGVvgAAAADqyXS/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/GtsMPwAAAACswVW/GtsMPwAAAACswVW/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/o6dRPwAAAAAm4xK/o6dRPwAAAAAm4xK/AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazAAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazxgQNNAAAgD9OPtezFbjOMwAAgD8QfCazWgv+MwAAgD/QJlyzxgQNNAAAgD9OPtezWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzxgQNNAAAgD9OPtezsNDqMwAAgD+j9LWzWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzsNDqMwAAgD+j9LWzb0gKNAAAgD8Hj2SzOJsQNAAAgD/ePpuzsNDqMwAAgD+j9LWzA7D0MwAAgD/TopSzOJsQNAAAgD/ePpuzA7D0MwAAgD/TopSzgfsGNAAAgD8limmzOJsQNAAAgD/ePpuzTMTcMwAAgD9PQbOzA7D0MwAAgD/TopSzgfsGNAAAgD8limmz8QO1MwAAgD+uwMWzTMTcMwAAgD9PQbOzooHsM///fz/hYNaz0ePuMwAAgD8FjJqzCDTyMwAAgD/Udb2zVOD8MwAAgD+lVkKzgfsGNAAAgD8limmzZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1TMTcMwAAgD9PQbOzHw0MNAAAgD8Hi5izZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1CDTyMwAAgD/Udb2zZ94PNP//fz+YQnSz8QO1MwAAgD+uwMWzCDTyMwAAgD/Udb2z8QO1MwAAgD+uwMWzVOD8MwAAgD+lVkKzooHsM///fz/hYNazVOD8MwAAgD+lVkKzooHsM///fz/hYNaz0ePuMwAAgD8FjJqz0ePuMwAAgD8FjJqz7rNTtQAAgD9UaYK1gy+8tAAAgD/HuEUzHw0MNAAAgD8Hi5izjpvJMwAAgD+ANaWzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzbBr3MwAAgD+wMJKzcdYBNAAAgD8wxaOzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzwqoDNAAAgD+l+puzV+v2MwAAgD+FiJuzFCH2MwAAgD8q+puzshj3MwAAgD+jZZyzcdYBNAAAgD8wxaOzwqoDNAAAgD+l+puzjpvJMwAAgD+ANaWzcdYBNAAAgD8wxaOzjpvJMwAAgD+ANaWzbBr3MwAAgD+wMJKzbBr3MwAAgD+wMJKzgy+8tAAAgD/HuEUzPdbJMwAAgD8/8iSzHw0MNAAAgD8Hi5izPuUPNAAAgD823WmzGd5nNP//fz/++R6zgy+8tAAAgD/HuEUzGd5nNP//fz/++R6zPdbJMwAAgD8/8iSzGd5nNP//fz/++R6zz1SSM///fz+aMwq0PdbJMwAAgD8/8iSzPuUPNAAAgD823Wmzz1SSM///fz+aMwq0AzDuMwAAgD/M+rezW5kBNAAAgD9455WzPuUPNAAAgD823Wmz0/cYNAAAgD/HsP+yz1SSM///fz+aMwq00/cYNAAAgD/HsP+yW5kBNAAAgD9455Wz0/cYNAAAgD/HsP+yzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rezW5kBNAAAgD9455WzzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rez8g31MwAAgD8y7KmznaP8MwAAgD9TyJ2zzVW3MwAAgD/cgsyz8g31MwAAgD8y7Kmz8g31MwAAgD8y7KmzCMH6MwAAgD+Ri4uznaP8MwAAgD9TyJ2zCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyznaP8MwAAgD9TyJ2z3cD6MwAAgD/e8lWzCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyz3cD6MwAAgD/e8lWzgaP8MwAAgD9YMnyzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqz3cD6MwAAgD/e8lWzrk0CNAAAgD9uBpKzpOPuMwAAgD87wbqzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzwqoDNAAAgD+l+puzwPIStP//f7+C5JIzkhf0s///f79be5gzoPX/u6D1f7+x9IK8wPIStP//f7+C5JIzkhf0s///f79be5gzwPIStP//f7+C5JIzoPX/u6D1f7+x9IK8khf0s///f79be5gzv8zMOe//f7/AqLY6oPX/u6D1f7+x9IK8bakFtAAAgL+GMKQzv8zMOe//f7/AqLY6AUIOtAAAgL+OGpczbakFtAAAgL+GMKQzmqbnswAAgL+SGpczv8zMOe//f7/AqLY6bakFtAAAgL+GMKQzmqbnswAAgL+SGpczHnghtAAAgL+hdb0z27kXtAAAgL+aUJMzgnUEtAAAgL9OnpUzpVrxswAAgL9xpnQzrePuswAAgL81gZcz3WXnswAAgL/4SJczSPXjswAAgL97LKkz0OviswAAgL9QHYEzAAAAAAAAgL/ImsAzrePuswAAgL81gZczSPXjswAAgL97LKkzrePuswAAgL81gZcz27kXtAAAgL+aUJMzSPXjswAAgL97LKkz27kXtAAAgL+aUJMzpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zAAAAAAAAgL/ImsAz0OviswAAgL9QHYEzphrOswAAgL/Z2A00AAAAAAAAgL/ImsAzAtQEtP//f7+CAZUzgnUEtAAAgL9OnpUz0OviswAAgL9QHYEzphrOswAAgL/Z2A007jVyswAAgL99UmszJ+4YtAAAgL94J7czgnUEtAAAgL9OnpUz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czWpDyswAAgL9lP5sz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czaeMMtAAAgL/ITIQzWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz09b1swAAgL9G2a4zWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz2Av+swAAgL9O45cz09b1swAAgL9G2a4z2Av+swAAgL9O45cz09b1swAAgL9G2a4zhga8swAAgL851pIz2Av+swAAgL9O45czx7bOswAAgL8kEcQzhga8swAAgL851pIzx7bOswAAgL8kEcQzhga8swAAgL851pIzQxZNswAAgL9iH/8yx7bOswAAgL8kEcQzQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszAAAAAAAAgL+uQpszAUIOtAAAgL+OGpcznKbnswAAgL8XiaIzmqbnswAAgL+SGpczo3TDs///f78fbZYzAUIOtAAAgL+OGpczo3TDs///f78fbZYzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzo3TDs///f78fbZYzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gzGizZswAAgL/hbZczUsgQtAAAgL9Au5gzSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zGizZswAAgL/hbZczSlvvswAAgL/3VLUzGizZswAAgL/hbZczSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5IzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5Izz122swAAgL8J5oszyl22s///f78f2KEzAG0otAAAgL9Pt5Ize1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzyl22s///f78f2KEzH23gswAAgL9A6JUzyl22s///f78f2KEzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzaZ0atAAAgL/IA5wzAtQEtP//f7+CAZUzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzao+rswAAgL/zg74zaZ0atAAAgL/IA5wzW5AEtAAAgL8nZIUzaZ0atAAAgL/IA5wzao+rswAAgL/zg74zAtQEtP//f7+CAZUzao+rswAAgL/zg74z7jVyswAAgL99UmszphrOswAAgL/Z2A007jVyswAAgL99UmszLQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/GtsMPwAAAACswVW/GtsMPwAAAACswVW/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/LNWVvgAAAADqyXS/LNWVvgAAAADqyXS/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/b5M3vwAAAABlazK/b5M3vwAAAABlazK/mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+2V1svwAAAACJncS+2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/5BFyPwAAAABNjaY+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/b5M3PwAAAABlazI/b5M3PwAAAABlazI/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/GtsMvwAAAACswVU/GtsMvwAAAACswVU/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/o6dRvwAAAAAm4xI/o6dRvwAAAAAm4xI/xWlivwAAAADe6e4+xWlivwAAAADe6e4+03dpvwAAAACkAdI+03dpvwAAAACkAdI+SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/cS4tPwAAAAAeiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/bS4tPwAAAAAiiDy/nKbnMwAAgD+9OpKzCSH2MwAAgD8IUYqzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzicxMuqv/fz+9H0q7CsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzA0IONAAAgD+/OpKzCsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzwk0CNP//fz/8MWSz6qbnMwAAgD8X4aizCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizcpruM///fz99yJ2zdsYINAAAgD8pjIuzICzZMwAAgD+Opq+zdsYINAAAgD8pjIuzSPXjMwAAgD/u66mzcpruM///fz99yJ2zdsYINAAAgD8pjIuzy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzcpruM///fz99yJ2zy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzUsYINAAAgD8xJXyzy4zZMwAAgD8u2Yqz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2zUsYINAAAgD8xJXyz5N/8MwAAgD886JWzUsYINAAAgD8xJXyzpk3KMwAAgD9rqLOz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2z63ehMwAAgD9VRxW0pk3KMwAAgD9rqLOzWmHdM///fz+CAZWzmAQBNAAAgD9sAq2zPAM1NAAAgD8Qo0mzpk3KMwAAgD9rqLOzPAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0PAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0WmHdM///fz+CAZWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzWmHdM///fz+CAZWz0OviMwAAgD8Nm5ezvdYFNAAAgD8+9m+zUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWz0OviMwAAgD8Nm5ez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzXsYINAAAgD8A8HezKKe1M///fz+odb2z3K/NMwAAgD8ozbmz0OviMwAAgD8Nm5ezbOD8MwAAgD+EVkKzp00CNAAAgD9/dpSzvdYFNAAAgD8+9m+z98IHNAAAgD8pwMWzXsYINAAAgD8A8Hez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzbOD8MwAAgD+EVkKzXsYINAAAgD8A8HezbOD8MwAAgD+EVkKz98IHNAAAgD8pwMWzKKe1M///fz+odb2z98IHNAAAgD8pwMWzKKe1M///fz+odb2z5u48NAAAgD+ZmsCz3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzvdYFNAAAgD8+9m+z3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azgpwCNAAAgD/AkKCzOqYZNAAAgD9XZHqz4dm7MwAAgD/a36azS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzJLAcNAAAgD8H2RyzFQmbMwAAgD9acRq0S/YGNAAAgD+98iazJLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzFQmbMwAAgD9acRq0JLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzFQmbMwAAgD9acRq0LxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzgQKZMwAAgD+uQpuzAAAAAKr/fz+5S1M7IGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7khf0M///fz9V65CzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7CsXeMwAAgD8tXaCzAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8u+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WS/LvnkPgAAAIAAAAAALvnkPi75ZL8AAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAu+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8AAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8u+WQ/LvnkPgAAAIAAAMA+AACAPwAAAD4AAIA+AADAPgAAAAAAACA/AABAPwAAID8AAAA/AAAgPwAAAAAAACA/AACAPgAAwD4AAEA/AAAAPgAAAD8AAMA+AABAPwAAwD4AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAAA/AADAPgAAAD8AAMA+AAAAPwAAAwAHAAkABAAOAA8ABgAMAAsABQACAAgADQAKAAgACgABAPf/f7+xIdvAvv9/v/f/f7+xIdvAvv9/v/f/f7+xIdvAvv9/vwAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96Nvf/f7+xIdvAIACAP/f/f7+xIdvAIACAP/f/f7+xIdvAIACAPwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPy35ZL8u+eS+AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAu+eS+Lflkvy35ZD8v+eS+AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAwD4AAIA/AADAPgAAAAAAAAA+AACAPgAAID8AAEA/AAAgPwAAAD8AACA/AAAAAAAAID8AAIA+AADAPgAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAADAAcACAAEAA0ADwAGAAwACgAFAAEACQAOAAsACQALAAIAG5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/vwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/vwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/PwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/PwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AAADAAkAAAAJAAYACAAKABUACAAVABMAFAAXABEAFAARAA4ADQAPAAQADQAEAAIABwASAAwABwAMAAEAFgALAAUAFgAFABAA"}]}};var Ert="#include <gl2_vert>\n\nattribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float pointSize;\n\n//引入fbo picking的vert相关函数\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    //传入gl_Position的depth值\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n";const Ort=[0,1e5,0],Rrt=[0,0,0],Drt=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],krt=[3,1,0,0,2,3],Lrt=[.1,.1,.1],Frt=[],Nrt=[],zrt=[],Brt=[],Hrt=[],jrt=[],Urt=[],Grt=[],Vrt=[0,-1,0],Wrt={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},qrt={4:[4,5],5:[4,5],7:[7,8],8:[7,8],9:[9,10,11],10:[9,10,11],11:[9,10,11]},Zrt=[6];class Qrt{constructor(t,e,n,i,r){this.map=t,this.renderer=e,this.updateTRS(n,i,r),this.createPickHelper(),this.createHelperMeshes(),this.H(),this.registEvents(),this.mouseAction="moving",this.J=null,this.$=!0}registEvents(){const t=this.map;t.on("dom:mousemove",this.AA,this),t.on("dom:mousedown",this.tA,this),t.on("dom:mouseup",this.nA,this),t.on("zooming moving dragrotating",this.iA,this)}unregistEvents(){const t=this.map;t.off("dom:mousemove",this.AA,this),t.off("dom:mousedown",this.tA,this),t.off("dom:mouseup",this.nA,this),t.off("zooming moving dragrotating",this.iA,this)}AA(t){this.currentMousePosition={x:t.containerPoint.x,y:t.containerPoint.y};const e=this.getCntrollerMeshes();if(this.currentPickingObject=this.rA(this.currentMousePosition,e,"meshes"),"transform"===this.mouseAction){if("z-translate"===this.eA){const t=Jp(zrt,e[9].localTransform);this.sA(!0,t,[this.uA[0]*Math.PI/180,this.uA[1]*Math.PI/180,this.uA[2]*Math.PI/180])}else if("y-rotate"===this.eA){const t=Jp(zrt,e[4].localTransform);this.sA(!0,t,[90*Math.PI/180,0,-this.uA[2]])}else if("z-rotate"===this.eA){const t=Jp(zrt,e[7].localTransform);this.sA(!0,t,[0,0,0])}}else this.sA(!1);this.oA(),this.hA(this.currentMousePosition)}oA(){this.fA(),this.currentPickingObject&&null!=this.currentPickingObject.meshId&&(this.lastPickingMeshId=this.currentPickingObject.pickingId,this.cA(this.currentPickingObject.pickingId,.6)),this.aA()}hA(t){if("transform"===this.mouseAction){const t=this.vA,e=this.rA(this.currentMousePosition,[t],"plane"),n=this.rA(this.lastMousePosition,[t],"plane");if(!e||null===e.meshId||!n||null===n.meshId)return;const i=[0,0,0];let r=0;if("z-translate"===this.eA){i[0]=e.point[0]-n.point[0],i[1]=e.point[1]-n.point[1],i[2]=e.point[2]-n.point[2];const t=this.lA(),r=Ig(i,t),o=Ag(i)*Math.cos(r),s=Math.sign(o)*Math.sqrt(Math.pow(o,2)/(Math.pow(t[0],2)+Math.pow(t[1],2)+Math.pow(t[2],2))),a=pg(Brt,t[0]*s,t[1]*s,t[2]*s);this.wA(a)}else"y-rotate"!==this.eA&&"z-rotate"!==this.eA||(r=this.PA(e.point,n.point,this.eA),this.gA(r,this.eA))}this.lastMousePosition=t,this.lastPickingObject=this.currentPickingObject,this.lastPickingMeshId=this.currentPickingObject.meshId}PA(t,e,n){const i=this.CA;let r,o;"y-rotate"===n?(r=ly(Urt,e[0]-i[0],e[2]-i[2]),o=ly(Grt,t[0]-i[0],t[2]-i[2])):"z-rotate"===n&&(r=ly(Urt,e[0]-i[0],e[1]-i[1]),o=ly(Grt,t[0]-i[0],t[1]-i[1]));const s=Math.atan2(r[1],r[0]);return(Math.atan2(o[1],o[0])-s)/Math.PI*180}wA(t){gg(this.CA,this.CA,t),this.DA()}gA(t,e){"y-rotate"===e?this.uA[1]-=t:"z-rotate"===e&&(this.uA[2]+=t),this.DA()}DA(){const t=this.updateMatrix();Up(t,t,Lrt);const e=this.getCntrollerMeshes();for(let n=0;n<e.length;n++){const i=e[n];let r=t;7!==n&&8!==n||(r=this.updateMatrixExcept(0),Up(r,r,Lrt)),Hp(i.localTransform,r,i.nodeMatrix)}}aA(){this.renderer&&this.renderer.parentRenderer.setToRedraw()}tA(t){this.currentMousePosition={x:t.containerPoint.x,y:t.containerPoint.y};const e=this.getCntrollerMeshes();this.firstDownPoint=this.currentPickingObject=this.rA(this.currentMousePosition,e,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.IA(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.aA()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0)),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=e[this.currentPickingObject.meshId]}IA(t){qrt[9].indexOf(t)>-1?this.eA="z-translate":qrt[4].indexOf(t)>-1?this.eA="y-rotate":qrt[7].indexOf(t)>-1&&(this.eA="z-rotate")}sA(t,e,n){const i=this.vA,r=e||i.originTranslation,o=Kp(Nrt,i.localTransform),s=Sm(Frt,0,0,0);tg(i.localTransform,s,r,o),t&&!this.bA()&&(qp(i.localTransform,i.localTransform,n[2]),Vp(i.localTransform,i.localTransform,n[0]),Wp(i.localTransform,i.localTransform,n[1]))}bA(){if(this.map.getPitch())return!1;const t=this.map.cameraPosition,e=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());pg(e,e.x,e.y,0);const n=this.MA.getCoordinates(),i=this.map.coordinateToPointAtRes(n,this.map.getGLRes()),r=this.MA.getTranslation(),o=pg(zrt,i.x,i.y,0),s=gg(o,o,r);return Ig(mg(Brt,t,s),mg(Brt,t,e))<1/180*Math.PI}nA(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.$=!0),this.mouseAction="moving",this.eA=null,this.map.config("zoomable",!0),this.map.config("draggable",!0),this.aA()}iA(){this.$=!0}fA(){(function(t){return null==t})(this.lastPickingMeshId)||this.cA(this.lastPickingMeshId),this.map.resetCursor()}cA(t,e){const n=this.getCntrollerMeshes();if(Zrt.indexOf(t)<0){const i=qrt[t];if(i)for(let t=0;t<i.length;t++)this.zA(n[i[t]],e);else this.zA(n[t],e)}this.map.setCursor("pointer")}zA(t,e){const n=t.material.get("polygonFill");n[3]=e||t.originOpacity,t.material.set("polygonFill",n)}rA(t,e,n){const i=this.map;if(!(i&&this.G&&this.renderer&&this.renderer.canvas))return null;const r=i.getDevicePixelRatio(),o=t.x*r,s=t.y*r,a={projViewMatrix:this.map.projViewMatrix,pointSize:1};return!this.$&&this.dA&&this.dA===n||(this.G.render(e,a,!0),this.dA=n,this.$=!1),this.G.pick(o,s,10,a,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}updateTRS(t,e,n){this.CA=dg([],t),this.xA=dg([],n),this.uA=dg([],e)}updateMatrix(){const t=this.uA,e=this.CA,n=this.xA,i=ym(Frt);return wm(i,i,t[2]*Math.PI/180),xm(i,i,t[0]*Math.PI/180),bm(i,i,t[1]*Math.PI/180),tg(Hrt,i,e,n)}updateMatrixExcept(){const t=dg([],this.uA);t[0]=0;const e=this.CA,n=this.xA,i=ym(Frt);return wm(i,i,t[2]*Math.PI/180),xm(i,i,t[0]*Math.PI/180),bm(i,i,t[1]*Math.PI/180),tg(jrt,i,e,n)}lA(){const t=this.uA,e=Np([]);return qp(e,e,t[2]*Math.PI/180),Vp(e,e,t[0]*Math.PI/180),Wp(e,e,t[1]*Math.PI/180),Sg(Brt,Vrt,e)}createPickHelper(){const t=new Jv({POSITION:Drt},krt,0,{primitive:"triangles",positionAttribute:"POSITION"}),e=gi.extend({},Wrt,{polygonFill:[0,0,0,.001]});this.vA=new z_(t,new E_(e)),this.vA.setUniform("uPickingId",12);const n=Np([]),i=Sm([],0,0,0);this.vA.originRotation=[0,0,0],tg(n,i,this.CA,[3,3,3]),this.vA.originTranslation=this.CA,this.vA.localTransform=n,this.vA.transparent=!0,this.vA.setDefines({HAS_HELPERPARTS:1,HAS_PICKING_ID:2})}createHelperMeshes(){this.mA=this.yA("helper"),this.pA=[],this.pA.push(...this.mA),this.pA.push(this.vA)}getPickHelperMesh(){return this.vA}getCntrollerMeshes(){return this.mA}getAllMeshes(){return this.pA.length<12&&this.pA.push(...this.mA),this.pA}createProjViewMatrix(){const t=this.updateMatrix(),e=Sg([],Rrt,t),n=Sg([],Ort,t),i=Math.sqrt(Math.pow(n[0]-e[0],2)+Math.pow(n[1]-e[1],2)+Math.pow(n[2]-e[2],2));return Hp([],og([],-this.xA[0],this.xA[1],-this.xA[0],this.xA[1],1,i),sg([],n,e,[0,0,1]))}yA(t){const e=[],n=(r=t,yb.loadGLTF("",Irt[r]).then((t=>t))),i=this.updateMatrix();var r;return Up(i,i,Lrt),n.then((t=>{yb.exportGLTFPack(t).getMeshesInfo().forEach(((t,n)=>{const r=t.materialInfo||{};r.polygonFill=6===n?[1,1,1,.1]:[1,1,1,1],gi.extend(r,Wrt,r);const o=new E_(r),s=new z_(t.geometry,o);s.setUniform("uPickingId",n);const a=s.getDefines();if(a.HAS_HELPERPARTS=1,a.HAS_PICKING_ID=2,s.setDefines(a),s.nodeMatrix=t.nodeMatrix,s.originTransform=Fp([],s.localTransform),7===n||8===n){const t=this.updateMatrixExcept(0);Up(t,t,Lrt),Hp(s.localTransform,t,s.nodeMatrix)}else Hp(s.localTransform,i,s.nodeMatrix);s.originOpacity=6===n?.1:1,s.transparent=!0,e.push(s)}))})),e}H(){this.pickingFBO=this.renderer.regl.framebuffer(this.renderer.canvas.width,this.renderer.canvas.height),this.G=new cw(this.renderer,{vert:Ert,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp([],e.projViewMatrix,e.modelMatrix)}}]},this.pickingFBO,this.map)}LA(){this.unregistEvents(),this.dispose()}dispose(){this.getAllMeshes().forEach((t=>{t.geometry.dispose(),t.dispose()})),this.pickingFBO&&this.pickingFBO.destroy()}resize(t,e){this.pickingFBO.width===t&&this.pickingFBO.height===e||this.pickingFBO.resize(t,e)}}class Xrt extends mx{constructor(t={}){const e=[],n=[],i=t.uniforms,r=[{name:"modelNormalMatrix",type:"function",fn:function(t,n){return Mp(e,n.modelMatrix)}},{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp(n,e.viewMatrix,e.modelMatrix)}}];i&&r.push(...i),super({vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\n#include <line_extrusion_vert>\n\n\n\n#ifdef HAS_MAP\n\n    uniform vec2 uvScale;\n\n    uniform vec2 uvOffset;\n\n    attribute vec2 aTexCoord;\n\n    varying vec2 vTexCoord;\n\n#endif\n\n#if defined(HAS_COLOR)\n\n    attribute vec4 aColor;\n\n    varying vec4 vColor;\n\n#elif defined(HAS_COLOR0)\n\n    attribute vec4 aColor0;\n\n    varying vec4 vColor;\n\n#endif\n\n\n\nvarying vec3 vFragPos;\n\nvarying vec3 vNormal;\n\n\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat3 modelNormalMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform vec2 halton;\n\nuniform vec2 outSize;\n\n\n\nuniform mat4 projViewMatrix;\n\n\n\n#include <get_output>\n\n#include <heatmap_render_vert>\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n    #include <vsm_shadow_vert>\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    attribute float aExtrusionOpacity;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_TANGENT)\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n) {\n\n    n = vec3( 0.0,  0.0,  1.0) +\n\n        vec3( 2.0, -2.0, -2.0) * q.x * q.zwx +\n\n        vec3( 2.0,  2.0, -2.0) * q.y * q.wzy;\n\n}\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n, out highp vec3 t) {\n\n    toTangentFrame(q, n);\n\n    t = vec3( 1.0,  0.0,  0.0) +\n\n        vec3(-2.0,  2.0, -2.0) * q.y * q.yxw +\n\n        vec3(-2.0,  2.0,  2.0) * q.z * q.zwx;\n\n}\n\n\n\n\n\nvoid main()\n\n{\n\n    #ifdef IS_LINE_EXTRUSION\n\n        vec4 localPosition = getPosition(getLineExtrudePosition(aPosition));\n\n    #else\n\n        vec4 localPosition = getPosition(aPosition);\n\n    #endif\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n\n\n    vFragPos = vec3(modelMatrix * localPositionMatrix * localPosition);\n\n\n\n    #if defined(HAS_NORMAL) || defined(HAS_TANGENT)\n\n        mat3 localNormalMatrix = modelNormalMatrix * mat3(localPositionMatrix);\n\n        vec3 Normal;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t;\n\n            toTangentFrame(aTangent, Normal, t);\n\n            vTangent = vec4(localNormalMatrix * t, aTangent.w);\n\n        #else\n\n            #ifdef HAS_DECODE_NORMAL\n\n                Normal = getNormal(aNormal);\n\n            #else\n\n                Normal = aNormal;\n\n            #endif\n\n        #endif\n\n        vec3 localNormal = appendMorphNormal(Normal);\n\n        vNormal = normalize(localNormalMatrix * localNormal);\n\n    #else\n\n        vNormal = vec3(0.0);\n\n    #endif\n\n\n\n    mat4 jitteredProjection = projMatrix;\n\n    jitteredProjection[2].xy += halton.xy / outSize.xy;\n\n    gl_Position = jitteredProjection * modelViewMatrix * localPositionMatrix * localPosition;\n\n    #ifdef HAS_MAP\n\n        vec2 TexCoord = decode_getTexcoord(aTexCoord);\n\n        vTexCoord = TexCoord * uvScale + uvOffset;\n\n    #endif\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        vExtrusionOpacity = aExtrusionOpacity;\n\n    #endif\n\n    #if defined(HAS_COLOR)\n\n        vColor = aColor / 255.0;\n\n    #elif defined(HAS_COLOR0)\n\n        vColor = aColor0 / 255.0;\n\n    #endif\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPositionMatrix * localPosition;\n\n}\n\n",frag:"precision mediump float;\n\n#include <gl2_frag>\n\n\n\nuniform vec4 baseColorFactor;\n\nuniform float materialShininess;//反光度，即影响镜面高光的散射/半径\n\nuniform float opacity;\n\nuniform float environmentExposure;\n\nuniform float specularStrength;\n\n\n\nuniform vec3 light0_viewDirection;\n\nuniform vec3 ambientColor;\n\nuniform vec4 light0_diffuse;\n\nuniform vec3 lightSpecular;\n\nuniform vec3 cameraPosition;\n\n\n\n#ifdef HAS_TANGENT\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\n#ifdef HAS_MAP\n\n    varying vec2 vTexCoord;\n\n#endif\n\nvarying vec3 vNormal;\n\nvarying vec3 vFragPos;\n\n\n\n#ifdef HAS_INSTANCE_COLOR\n\n    varying vec4 vInstanceColor;\n\n#endif\n\n\n\n#ifdef HAS_BASECOLOR_MAP\n\n    uniform sampler2D baseColorTexture;\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    uniform vec2 extrusionOpacityRange;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n    varying vec4 vColor;\n\n#elif defined(IS_LINE_EXTRUSION)\n\n    uniform vec4 lineColor;\n\n#else\n\n    uniform vec4 polygonFill;\n\n#endif\n\n\n\n#ifdef IS_LINE_EXTRUSION\n\n    uniform float lineOpacity;\n\n#else\n\n    uniform float polygonOpacity;\n\n#endif\n\n\n\n#ifdef HAS_OCCLUSION_MAP\n\n    uniform sampler2D occlusionTexture;\n\n#endif\n\n\n\n#ifdef HAS_NORMAL_MAP\n\n    uniform sampler2D normalTexture;\n\n#endif\n\n\n\n#ifdef HAS_EMISSIVE_MAP\n\n    uniform sampler2D emissiveTexture;\n\n#endif\n\n\n\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\n\n    uniform vec4 diffuseFactor;\n\n    uniform vec3 specularFactor;\n\n    #ifdef HAS_DIFFUSE_MAP\n\n        uniform sampler2D diffuseTexture;\n\n    #endif\n\n    #ifdef HAS_SPECULARGLOSSINESS_MAP\n\n        uniform sampler2D specularGlossinessTexture;\n\n    #endif\n\n#endif\n\n#include <heatmap_render_frag>\n\n\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n  #include <vsm_shadow_frag>\n\n#endif\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\nvec3 transformNormal() {\n\n    #if defined(HAS_NORMAL_MAP)\n\n        vec3 n = normalize(vNormal);\n\n        vec3 normal = texture2D(normalTexture, vTexCoord).xyz * 2.0 - 1.0;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t = normalize(vTangent.xyz);\n\n            vec3 b = normalize(cross(n, t) * sign(vTangent.w));\n\n            mat3 tbn = mat3(t, b, n);\n\n            return normalize(tbn * normal);\n\n        #else\n\n            return normalize(normal);\n\n        #endif\n\n    #else\n\n        return normalize(vNormal);\n\n    #endif\n\n}\n\n\n\nvec4 linearTosRGB(const in vec4 color) {\n\n    return vec4( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055, color.a);\n\n}\n\n\n\nvec4 getBaseColor() {\n\n    #if defined(HAS_BASECOLOR_MAP)\n\n        return texture2D(baseColorTexture, vTexCoord);\n\n    #elif defined(HAS_DIFFUSE_MAP)\n\n        return texture2D(diffuseTexture, vTexCoord);\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return diffuseFactor;\n\n    #else\n\n        return baseColorFactor;\n\n    #endif\n\n}\n\n\n\nvec3 getSpecularColor() {\n\n    #if defined(HAS_SPECULARGLOSSINESS_MAP)\n\n        return texture2D(specularGlossinessTexture, vTexCoord).rgb;\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return specularFactor;\n\n    #else\n\n        return vec3(1.0);\n\n    #endif\n\n}\n\n\n\nvoid main() {\n\n    //环境光\n\n    vec4 baseColor = getBaseColor();\n\n    vec3 ambient = environmentExposure * ambientColor * baseColor.rgb;\n\n\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        ambient *= vInstanceColor.rgb;\n\n    #endif\n\n\n\n    //漫反射光\n\n    vec3 norm = transformNormal();\n\n    vec3 lightDir = normalize(-light0_viewDirection);\n\n    float diff = max(dot(norm, lightDir), 0.0);\n\n    vec3 diffuse = light0_diffuse.rgb * diff * baseColor.rgb;\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        vec3 color = vColor.rgb;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        vec3 color = lineColor.rgb;\n\n    #else\n\n        vec3 color = polygonFill.rgb;\n\n    #endif\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        color *= vInstanceColor.rgb;\n\n    #endif\n\n    ambient *= color.rgb;\n\n    diffuse *= color.rgb;\n\n\n\n    //镜面反色光\n\n    vec3 viewDir = normalize(cameraPosition - vFragPos);\n\n    vec3 halfwayDir = normalize(lightDir + viewDir);\n\n    float spec = pow(max(dot(norm, halfwayDir), 0.0), materialShininess);\n\n    vec3 specular = specularStrength * lightSpecular * spec * getSpecularColor();\n\n    #ifdef HAS_OCCLUSION_MAP\n\n        float ao = texture2D(occlusionTexture, vTexCoord).r;\n\n        ambient *= ao;\n\n    #endif\n\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n        float shadowCoeff = shadow_computeShadow();\n\n        diffuse = shadow_blend(diffuse, shadowCoeff).rgb;\n\n        specular = shadow_blend(specular, shadowCoeff).rgb;\n\n    #endif\n\n    vec3 result = ambient + diffuse + specular;\n\n\n\n    #ifdef HAS_EMISSIVE_MAP\n\n        vec3 emit = texture2D(emissiveTexture, vTexCoord).rgb;\n\n        result += emit;\n\n    #endif\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        discard;\n\n    }\n\n    glFragColor = vec4(result, opacity);\n\n    // glFragColor = linearTosRGB(glFragColor);\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        float colorAlpha = vColor.a;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        float colorAlpha = lineColor.a;\n\n    #else\n\n        float colorAlpha = polygonFill.a;\n\n    #endif\n\n        glFragColor *= colorAlpha;\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        float topAlpha = extrusionOpacityRange.x;\n\n        float bottomAlpha = extrusionOpacityRange.y;\n\n        float alpha = topAlpha + vExtrusionOpacity * (bottomAlpha - topAlpha);\n\n        alpha = clamp(alpha, 0.0, 1.0);\n\n        glFragColor *= alpha;\n\n    #endif\n\n\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:r,defines:t.defines||{},extraCommandProps:t.extraCommandProps||{}}),this.version=300}}const Yrt=[0,0,0,1],Jrt={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]};class Krt extends _rt{u(){this.TA=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.OA=new mx({vert:Trt,frag:Srt,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.i}}),this.FA=new mx({vert:Trt,frag:Srt,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.i,depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.UA=new Xrt({extraCommandProps:{viewport:this.i,blend:{enable:(t,e)=>!!e.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}}),this.EA=new Xrt({extraCommandProps:{viewport:this.i,blend:{enable:(t,e)=>!!e.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"},depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.NA=new Y_,this.jA=new Y_,this.F=new Y_}QA(t,e,n,i){this.controller=new Qrt(t,this.renderer,e,n,i)}SA(t,e,n){this.controller&&(this.controller.updateTRS(t,e,n),this.controller.DA(),this.controller.aA())}render(t,e){this.U(),this.renderer.clear({color:Yrt,depth:1,framebuffer:this.T});const n=this.BA(t),i=this.controller.getAllMeshes(),r=this.controller.createProjViewMatrix();return this.kA(n,i,r,e.map),this.RA(n,i,r,e.map),{meshesMap:this.TA,invisibleMap:this.T}}BA(t){const e=[];for(let n=0;n<t.length;n++){const i=gi.extend({},t[n].material.uniforms,Jrt),r=new E_(i),o=new z_(t[n].geometry,r),s=o.getDefines();s.HAS_CUT=1,o.setDefines(s),o.localTransform=t[n].localTransform,e.push(o)}return e}RA(t,e,n,i){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.T});const r={cut_projViewMatrixFromViewpoint:n,projViewMatrix:i.projViewMatrix};this.F.setMeshes(t),this.renderer.render(this.OA,r,this.F,this.T),this.F.setMeshes(e),this.renderer.render(this.FA,r,this.F,this.T)}kA(t,e,n,i){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.TA});const r=gi.isFunction(this.i.width.data)?this.i.width.data():this.i.width,o=gi.isFunction(this.i.height.data)?this.i.height.data():this.i.height,s={projMatrix:i.projMatrix,cut_projViewMatrixFromViewpoint:n,projViewMatrix:i.projViewMatrix,viewMatrix:i.viewMatrix,cameraPosition:i.cameraPosition,altitudeScale:1,outSize:[r,o],halton:[.2107,-.0202],polygonFill:[1,1,1,1],polygonOpacity:1};!function(t,e,n,i){const{iblTexes:r,dfgLUT:o}=Xw.PBRUtils.getIBLResOnCanvas(e);if(n&&n.getLights()){const e=Xw.PBRUtils.getPBRUniforms(n,r,o,i,i),s=n.getLights();t.ambientColor=s.ambient&&s.ambient.color?s.ambient.color:[1,1,1],e&&gi.extend(t,e)}else{const e=Xw.PBRUtils.getPBRUniforms(n,null,o,i,i);gi.extend(t,e)}}(s,this.renderer.canvas,i),this.NA.setMeshes(t),this.renderer.render(this.UA,s,this.NA,this.TA),this.jA.setMeshes(e),this.renderer.render(this.EA,s,this.jA,this.TA)}dispose(){this.T&&this.T.destroy(),this.C&&this.C.dispose(),this.GA&&this.GA.dispose(),this.controller&&this.controller.LA()}U(){const t=gi.isFunction(this.i.width.data)?this.i.width.data():this.i.width,e=gi.isFunction(this.i.height.data)?this.i.height.data():this.i.height;!this.T||this.T.width===t&&this.T.height===e||this.T.resize(t,e),!this.TA||this.TA.width===t&&this.TA.height===e||this.TA.resize(t,e),this.controller&&this.controller.resize(t,e)}}const $rt=[0,0,0,1,1,-1,1,-1,-1,1,-1,1,1,1,1,1,0,0],tot=[0,1,0,2,0,3,0,4,1,2,2,3,3,4,4,1,0,5],eot=[],not=ym([]),iot=ym([]),rot=[],oot=[1,0,0],sot=[],aot=[],hot=[],lot=new ht(0,0),uot=[0,0,0,1];let cot=.01;class Aot extends _rt{u(){super.u(),this.qA=new mx({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 viewshed_projViewMatrixFromViewpoint;\n\nvarying vec4 viewshed_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    viewshed_positionFromViewpoint = viewshed_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 viewshed_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\nuniform float near;\n\nuniform float far;\n\n#ifdef HAS_HELPERLINE\n\n  uniform vec3 lineColor;\n\n#endif\n\n\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1.);\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n\n    return dot(v, UnpackFactors);\n\n}\n\n\n\nfloat linear(float value) {\n\n    float z = value * 2.0 - 1.0;\n\n    return (2.0 * near * far) / (far + near - z * (far - near));\n\n}\n\n\n\nvoid main() {\n\n    #ifdef HAS_HELPERLINE\n\n        gl_FragColor = vec4(lineColor, 0.009);\n\n    #else\n\n        vec3 shadowCoord = (viewshed_positionFromViewpoint.xyz / viewshed_positionFromViewpoint.w)/2.0 + 0.5;\n\n        vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n        float depth = unpackRGBAToDepth(rgbaDepth);\n\n        float linearZ = linear(shadowCoord.z);\n\n        float linearDepth = linear(depth);\n\n        if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && linearZ >= near && linearZ <= far - near) {\n\n            if (linearZ / far <= linearDepth / (far - near)) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//可视区\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//不可视区\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        }\n\n    #endif\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.i}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=new Jv({POSITION:$rt},tot,0,{primitive:"lines",positionAttribute:"POSITION"});this.VA=new z_(t,new T_({lineColor:[.8,.8,.1]}));const e=this.VA.getDefines();e.HAS_HELPERLINE=1,this.VA.setDefines(e),this.F=new Y_}render(t,e){const{eyePos:n,lookPoint:i,horizontalAngle:r,verticalAngle:o}=e;if(!this.m(r,o)||!n||!i)return this.T;this.C||this.D(r,o),this.U(r,o),this.renderer.clear({color:uot,depth:1,framebuffer:this.T}),this.VA.localTransform=this.WA(n,i,r,o),t.push(this.VA),this.F.setMeshes(t);const{projViewMatrixFromViewpoint:s,far:a}=this._A(n,i,o,r);return this.l(this.F,s,a),this.KA(this.F,s,e.projViewMatrix,a),this.T}WA(t,e,n,i){const r=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2));r<=0&&console.warn("both lookpoint and eyePos are in the same position");const o=Np(eot),s=pg(rot,e[0]-t[0],e[1]-t[1],e[2]-t[2]),a=n*Math.PI/360,h=i*Math.PI/360;let l=Ig(oot,pg(sot,s[0],s[1],0));l=s[1]>=0?l:2*Math.PI-l;const u=wm(not,iot,l);let c=Ig(pg(aot,s[0],s[1],0),s);return c=s[0]>=0?-c:2*Math.PI-c,bm(u,u,c),tg(o,u,t,[r,r*Math.tan(a),r*Math.tan(h)]),o}HA(t){const e=this.VA.localTransform,n=[],i=t.getGLRes();for(let r=1;r<($rt.length-3)/3;r++){hot[0]=$rt[3*r],hot[1]=$rt[3*r+1],hot[2]=$rt[3*r+2];const o=Sg([],hot,e);lot.set(o[0],o[1]);const s=t.pointAtResToCoord(lot,i),a=t.pointAtResToAltitude(o[2],i);s.z=a,n.push(s)}return n}KA(t,e,n,i){this.renderer.render(this.qA,{viewshed_projViewMatrixFromViewpoint:e,projViewMatrix:n,near:cot,far:i,depthMap:this.h,minAltitude:0},t,this.T)}_A(t,e,n,i){const r=n/i,o=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2));return cot=o/100,{projViewMatrixFromViewpoint:Hp([],ig([],i*Math.PI/180,r,cot,o),sg([],t,e,[0,1,0])),far:o}}dispose(){super.dispose(),this.T&&this.T.destroy(),this.qA&&this.qA.dispose(),this.VA&&(this.VA.geometry.dispose(),this.VA.dispose())}U(t,e){const n=gi.isFunction(this.i.width.data)?this.i.width.data():this.i.width,i=gi.isFunction(this.i.height.data)?this.i.height.data():this.i.height;if(!this.T||this.T.width===n&&this.T.height===i||this.T.resize(n,i),this.h&&this.h.width/this.h.height!=t/e){const n=this.I(t,e);n&&this.h.resize(n.width,n.height)}}}class fot extends _rt{render(t,{projViewMatrix:e,lineColor:n,lineWidth:i}){return t&&t.length?(this.JA(),this.U(),this.F.setMeshes(t),this.ZA(this.F,e),this.XA(n,i,this.T),this.T):null}u(){this.fboExtent=this.$A();const t=this.i;this.extentShader=new mx({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>  \n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}",frag:"precision highp float;\n\nvoid main() {\n\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\n}",extraCommandProps:{viewport:t,cull:{enable:!1}}}),this.outlineShader=new bx({vert:"#if __VERSION__ == 300\n\n\t#define attribute in\n\n\t#define varying out\n\n#endif\n\n\n\nattribute vec2 aPosition;\n\nattribute vec2 aTexCoord;\n\n\n\nvarying vec2 vTexCoord;\n\n\n\nvoid main()\n\n{\n\n  gl_Position = vec4(aPosition, 0., 1.);\n\n  vTexCoord = aTexCoord;\n\n}\n\n",frag:"precision highp float;\n\nprecision highp int;\n\n\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D maskTexture;\n\nuniform vec2 texSize;\n\nuniform vec3 visibleEdgeColor;\n\nuniform float lineWidth;\n\nvoid main() {\n\n    vec2 invSize = (1.0 / texSize) * lineWidth;\n\n    vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize.x, invSize.y, invSize.x, invSize.y);\n\n    vec4 c1 = texture2D(maskTexture, vTexCoord + uvOffset.xy);\n\n    vec4 c2 = texture2D(maskTexture, vTexCoord - uvOffset.xy);\n\n    vec4 c3 = texture2D(maskTexture, vTexCoord + uvOffset.yw);\n\n    vec4 c4 = texture2D(maskTexture, vTexCoord - uvOffset.yw);\n\n    float diff1 = (c1.r - c2.r)*0.7;\n\n    float diff2 = (c3.r - c4.r)*0.7;\n\n    float d = length(vec2(diff1, diff2) );\n\n    float a1 = min(c1.g, c2.g);\n\n    float a2 = min(c3.g, c4.g);\n\n    float visibilityFactor = min(a1, a2);\n\n    gl_FragColor = 1.0 - visibilityFactor > 0.001 ? vec4(visibleEdgeColor, 1.0) * vec4(d) : vec4(0.0);\n\n}",extraCommandProps:{viewport:t,depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}}),this.T=this.regl.framebuffer({color:this.regl.texture({width:t.width(),height:t.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.F=new Y_}ZA(t,e){this.renderer.render(this.extentShader,{projViewMatrix:e,minAltitude:0},t,this.fboExtent)}XA(t,e,n){this.renderer.render(this.outlineShader,{texSize:[n.width,n.height],visibleEdgeColor:t||[1,0,0],maskTexture:this.fboExtent,lineWidth:e||1,minAltitude:0},null,n)}$A(){return this.regl.framebuffer({color:this.regl.texture({width:2,height:2,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}getRenderMeshes(){return this.F.getMeshes()}JA(){this.regl.clear({color:[1,1,1,1],depth:1,framebuffer:this.fboExtent})}dispose(){this.fboExtent&&(this.fboExtent.destroy(),this.extentShader.dispose(),this.outlineShader.dispose(),delete this.fboExtent),this.T&&(this.T.destroy(),delete this.T)}U(){const t=gi.isFunction(this.i.width.data)?this.i.width.data():this.i.width,e=gi.isFunction(this.i.height.data)?this.i.height.data():this.i.height;this.T.width===t&&this.fboExtent.height===e||this.T.resize(t,e),this.fboExtent.width===t&&this.fboExtent.height===e||this.fboExtent.resize(t,e)}}const dot="undefined"==typeof document?null:document.createElement("canvas");class pot extends _rt{u(){this.O=new mx({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projViewMatrix * worldPosition;\n\n    flood_height = worldPosition.z;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform float waterHeight;\n\nuniform sampler2D extentMap;\n\nuniform float hasExtent;\n\nuniform float type;\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    bool compare = type == 1.0 ? flood_height < waterHeight : flood_height >= waterHeight;\n\n    if (compare) {\n\n        if (hasExtent == 1.0) {\n\n            if (extentColor.r > 0.0) {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n            } else {\n\n                gl_FragColor = vec4(0.0);\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",extraCommandProps:{viewport:this.i}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(t,e){this.U(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T});const n=new Y_(t);return this.it(n,e),this.T}it(t,e){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.renderer.render(this.O,e,t,this.T)}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}U(){const t=gi.isFunction(this.i.width.data)?this.i.width.data():this.i.width,e=gi.isFunction(this.i.height.data)?this.i.height.data():this.i.height;!this.T||this.T.width===t&&this.T.height===e||this.T.resize(t,e)}}const got=[.1451,.2588,.4863],mot=[0,0,0,0];class yot extends Mrt{constructor(t){super(t),this.type="floodAnalysis"}YA(t){const e=this.layer.getMap();if(this.q={},this.q.waterHeight=wrt(e,this.options.waterHeight),this.q.waterOpacity=this.options.waterOpacity,this.q.waterColor=this.options.waterColor,this.q.extent=mot,this.q.extentMap=t.regl.texture({width:2,height:2}),this.q.hasExtent=0,this.q.type=1,this.options.boundary){const{extentMap:t,extentInWorld:e}=this.V(this.options.boundary);this.q.extent=e,this.q.extentMap=t,this.q.hasExtent=1}this.q.projViewMatrix=e.projViewMatrix,this.q.minAltitude=0}S(t){const e=this.i={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(t);const n=new j_(t.regl);this.B=this.B||new pot(n,e),this.layer.addAnalysis(this)}update(t,e){if("boundary"===t){const{extentMap:t,extentInWorld:n,extentPolygon:i}=this.V(e);this.q.extent=n,this.q.extentPolygon=i,this.q.extentMap=t}else if("waterHeight"===t){const t=this.layer.getMap();this.q.waterHeight=t.altitudeToPoint(e||0,t.getGLRes())}else this.q[t]=e;super.update(t,e)}renderAnalysis(t){const e={};return this.options.boundary&&this.k.render(this.R,this._),e.flood_waterColor=this.q.waterColor||got,e.flood_waterOpacity=this.q.waterOpacity||.6,e.floodMap=this.B.render(t,this.q),e}getDefines(){return{HAS_FLOODANALYSE:1}}}const vot=[0,0,0,1,0,0],_ot=[0,1],xot=[],bot=[0,0,0,1];class wot extends _rt{u(){super.u(),this.rt=new mx({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 insight_projViewMatrixFromViewpoint;\n\nvarying vec4 insight_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    insight_positionFromViewpoint = insight_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 insight_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\n\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1.);\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n\n    return dot(v, UnpackFactors);\n\n}\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (insight_positionFromViewpoint.xyz / insight_positionFromViewpoint.w)/2.0 + 0.5;\n\n    vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n    float depth = unpackRGBAToDepth(rgbaDepth); // Retrieve the z-value from R\n\n    if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n\n        if (depth <0.001) {\n\n            gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//可视区,green\n\n        } else {\n\n            if (shadowCoord.z <= depth + 0.002) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//可视区,green\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//不可视区,red\n\n            }\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);//非视野范围,blue\n\n    }\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.i}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=new Jv({POSITION:vot},_ot,0,{primitive:"lines",positionAttribute:"POSITION"});this.et=t,this.VA=new z_(t,new T_({lineColor:[.8,.8,.1]})),this.F=new Y_}render(t,e){const{lines:n,horizontalAngle:i,verticalAngle:r}=e;this.C||this.D(i,r),this.U(i,r),this.renderer.clear({color:bot,depth:1,framebuffer:this.T});const o=Np(xot);this.VA.localTransform=o;for(let s=0;s<n.length;s++){const{from:o,to:a}=n[s];if(!this.m(i,r)||!o||!a)continue;const{projViewMatrixFromViewpoint:h,far:l}=this._A(o,a,i,r);this.F.setMeshes(t),this.l(this.F,h,l),this.st(o,a),this.F.setMeshes(this.VA),this.ut(this.F,h,e.projViewMatrix)}return this.T}st(t,e){this.et&&(this.et.dispose(),this.VA.dispose(),vot[0]=t[0],vot[1]=t[1],vot[2]=t[2],vot[3]=e[0],vot[4]=e[1],vot[5]=e[2],this.et=new Jv({POSITION:vot},_ot,0,{primitive:"lines",positionAttribute:"POSITION"}),this.VA=new z_(this.et,new T_({lineColor:[.8,.8,.1]})))}ut(t,e,n){this.renderer.render(this.rt,{insight_projViewMatrixFromViewpoint:e,projViewMatrix:n,depthMap:this.h},t,this.T)}_A(t,e,n,i){const r=n/i,o=Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2));return{projViewMatrixFromViewpoint:Hp([],ig([],i*Math.PI/180,r,1,o+1e3),sg([],t,e,[0,1,0])),far:o}}dispose(){super.dispose(),this.T&&this.T.destroy(),this.rt&&this.rt.dispose(),this.VA&&(this.VA.geometry.dispose(),this.VA.dispose())}U(t,e){const n=gi.isFunction(this.i.width.data)?this.i.width.data():gi.isFunction(this.i.width)?this.i.width():this.i.width,i=gi.isFunction(this.i.height.data)?this.i.height.data():gi.isFunction(this.i.height)?this.i.height():this.i.height;if(!this.T||this.T.width===n&&this.T.height===i||this.T.resize(n,i),this.h&&this.h.width/this.h.height!=t/e){const n=this.I(t,e);n&&this.h.resize(n.width,n.height)}}}const Cot=[0,0,0,1],Pot=[],Mot=[];class Tot extends _rt{u(){this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.O=new mx({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying vec4 vPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vPosition = worldPosition;\n\n    gl_Position = projViewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n#include <gl2_frag>\n\n\n\nvarying vec4 vPosition;\n\n\n\nconst vec2 range = vec2(-100.0, 1000.0);\n\nvec4 encodeHeight(const in float height) {\n\n    float alpha = 1.0;\n\n    vec4 pack = vec4(0.0);\n\n    pack.a = alpha;\n\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n\n    pack.rgb = vec3(code * height);\n\n    pack.gb = fract(pack.gb);\n\n    pack.rg -= pack.gb * (1.0 / 256.0);\n\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n\n    return pack;\n\n}\n\n\n\nvoid main() {\n\n    float height = (vPosition.z - range.x) / (range.y - range.x);\n\n    glFragColor = encodeHeight(height);\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:(t,e)=>Hp(Pot,e.viewMatrix,e.modelMatrix)},{name:"projViewModelMatrix",type:"function",fn:(t,e)=>Hp(Mot,e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.i,cull:{enable:!0},frontFace:"ccw"}}),this.F=new Y_}render(t,e){return this.U(),this.renderer.clear({color:Cot,depth:1,framebuffer:this.T}),this.F.setMeshes(t),this.renderer.render(this.O,{projViewMatrix:e},this.F,this.T),this.T}U(){const t=gi.isFunction(this.i.width)?this.i.width():this.i.width,e=gi.isFunction(this.i.height)?this.i.height():this.i.height;!this.T||this.T.width===t&&this.T.height===e||this.T.resize(t,e)}dispose(){this.T&&(this.T.destroy(),delete this.T),this.O&&(this.O.dispose(),delete this.O)}}const Sot=kq.getRendererClass("gl");class Iot extends kq{excavate(t){this.N=!0,this.wt=Array.isArray(t)?t:[t];const e=this.getRenderer();e&&(e.Pt(),e.setToRedraw())}getExcavatedLayers(){return this.wt}enable(){this.N=!0,this.Ct()}disable(){this.N=!1,this.Ct()}isEnable(){return this.N}Ct(){const t=this.getRenderer();t&&t.setToRedraw()}}Iot.registerRenderer("gl",class extends Sot{draw(t,e){this.layer.getExcavatedLayers()&&this.layer.isEnable()&&(this.Dt(),super.draw(t,e))}Dt(){this._&&this.It||this.bt(),this.Mt=this.Mt||this.Pt();const t=this.getMap(),e=this.meshes;if(e&&this.Mt){for(let n=0;n<e.length;n++){const i=e[n],r=i.getDefines();r.HAS_EXCAVATE_ANALYSIS=1,i.setDefines(r),i.setUniform("heightmap",this.Mt),i.setUniform("excavateExtent",this.It),i.setUniform("excavateHeight",wrt(t,this.options.height))}this.setToRedraw()}}Pt(){const t=this.layer.getExcavatedLayers();this.zt=[];for(let e=0;e<t.length;e++){const n=t[e].getRenderer();if(!n.getAnalysisMeshes)continue;const i=n.getAnalysisMeshes();gi.pushIn(this.zt,i)}return this.zt.length?(this.B=this.B||this.S(),this.B.render(this.zt,this._)):null}bt(){const t=this.layer.getMap(),e=this.layer.getExtent(),n=t.getCenter(),i=t.getZoom(),r=t.getPitch(),o=t.getBearing(),s=t.getFitZoom(e),a=e.getCenter();t.setZoom(s),t.setCenter(a),t.setPitch(0),t.setBearing(0);const h=t.getExtent();this._=this._||[],Fp(this._,t.projViewMatrix);const l=Prt(t,h.xmin,h.ymin),u=Prt(t,h.xmax,h.ymax);this.It=qg(this.It||[],l[0],l[1],u[0],u[1]),t.setZoom(i),t.setCenter(n),t.setPitch(r),t.setBearing(o)}S(){this.i={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1};const t=new j_(this.regl);return this.B=this.B||new Tot(t,this.i),this.B}dt(){this.bt(),this.setToRedraw()}onGeometryAdd(t){super.onGeometryAdd(t),this.dt()}onGeometryRemove(){super.onGeometryRemove(),this.dt()}remove(){super.remove(),this.B&&this.B.dispose()}});class Eot extends _rt{u(){this.O=new mx({vert:"attribute vec3 aPosition;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 modelViewMatrix;\n\n#include <get_output>\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform sampler2D extentMap;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    if (extentColor.r > 0.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,e){return Hp([],e.viewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:this.i}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(t,e){this.U(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T});const n=new Y_(t);return this.it(n,e),this.T}it(t,e){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.renderer.render(this.O,e,t,this.T)}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}U(){const t=gi.isFunction(this.i.width.data)?this.i.width.data():this.i.width,e=gi.isFunction(this.i.height.data)?this.i.height.data():this.i.height;!this.T||this.T.width===t&&this.T.height===e||this.T.resize(t,e)}}var Oot=6371008.8,Rot={centimeters:100*Oot,centimetres:100*Oot,degrees:Oot/111325,feet:3.28084*Oot,inches:39.37*Oot,kilometers:Oot/1e3,kilometres:Oot/1e3,meters:Oot,metres:Oot,miles:Oot/1609.344,millimeters:1e3*Oot,millimetres:1e3*Oot,nauticalmiles:Oot/1852,radians:1,yards:1.0936*Oot};function Dot(t,e,n){void 0===n&&(n={});var i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=e||{},i.geometry=t,i}function kot(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!jot(t[0])||!jot(t[1]))throw new Error("coordinates must contain numbers");return Dot({type:"Point",coordinates:t},e,n)}function Lot(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return Dot({type:"LineString",coordinates:t},e,n)}function Fot(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function Not(t,e){void 0===e&&(e="kilometers");var n=Rot[e];if(!n)throw new Error(e+" units is invalid");return t*n}function zot(t,e){void 0===e&&(e="kilometers");var n=Rot[e];if(!n)throw new Error(e+" units is invalid");return t/n}function Bot(t){return t%(2*Math.PI)*180/Math.PI}function Hot(t){return t%360*Math.PI/180}function jot(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function Uot(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function Got(t,e,n){if(void 0===n&&(n={}),!0===n.final)return(Got(e,t)+180)%360;var i=Uot(t),r=Uot(e),o=Hot(i[0]),s=Hot(r[0]),a=Hot(i[1]),h=Hot(r[1]),l=Math.sin(s-o)*Math.cos(h),u=Math.cos(a)*Math.sin(h)-Math.sin(a)*Math.cos(h)*Math.cos(s-o);return Bot(Math.atan2(l,u))}function Vot(t,e,n,i){void 0===i&&(i={});var r=Uot(t),o=Hot(r[0]),s=Hot(r[1]),a=Hot(n),h=zot(e,i.units),l=Math.asin(Math.sin(s)*Math.cos(h)+Math.cos(s)*Math.sin(h)*Math.cos(a));return kot([Bot(o+Math.atan2(Math.sin(a)*Math.sin(h)*Math.cos(s),Math.cos(h)-Math.sin(s)*Math.sin(l))),Bot(l)],i.properties)}function Wot(t,e,n){void 0===n&&(n={});var i=Uot(t),r=Uot(e),o=Hot(r[1]-i[1]),s=Hot(r[0]-i[0]),a=Hot(i[1]),h=Hot(r[1]),l=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(a)*Math.cos(h);return Not(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),n.units)}function qot(t,e,n){void 0===n&&(n={});for(var i,r=("Feature"===(i=t).type?i.geometry:i).coordinates,o=0,s=0;s<r.length&&!(e>=o&&s===r.length-1);s++){if(o>=e){var a=e-o;if(a){var h=Got(r[s],r[s-1])-180;return Vot(r[s],a,h,n)}return kot(r[s])}o+=Wot(r[s],r[s+1],n)}return kot(r[r.length-1])}function Zot(t,e,n){if(null!==t)for(var i,r,o,s,a,h,l,u,c=0,A=0,f=t.type,d="FeatureCollection"===f,p="Feature"===f,g=d?t.features.length:1,m=0;m<g;m++){a=(u=!!(l=d?t.features[m].geometry:p?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var y=0;y<a;y++){var v=0,_=0;if(null!==(s=u?l.geometries[y]:l)){h=s.coordinates;var x=s.type;switch(c=0,x){case null:break;case"Point":if(!1===e(h,A,m,v,_))return!1;A++,v++;break;case"LineString":case"MultiPoint":for(i=0;i<h.length;i++){if(!1===e(h[i],A,m,v,_))return!1;A++,"MultiPoint"===x&&v++}"LineString"===x&&v++;break;case"Polygon":case"MultiLineString":for(i=0;i<h.length;i++){for(r=0;r<h[i].length-c;r++){if(!1===e(h[i][r],A,m,v,_))return!1;A++}"MultiLineString"===x&&v++,"Polygon"===x&&_++}"Polygon"===x&&v++;break;case"MultiPolygon":for(i=0;i<h.length;i++){for(_=0,r=0;r<h[i].length;r++){for(o=0;o<h[i][r].length-c;o++){if(!1===e(h[i][r][o],A,m,v,_))return!1;A++}_++}v++}break;case"GeometryCollection":for(i=0;i<s.geometries.length;i++)if(!1===Zot(s.geometries[i],e))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Qot(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function Xot(t,e){var n,i,r,o,s,a,h,l,u,c,A=0,f="FeatureCollection"===t.type,d="Feature"===t.type,p=f?t.features.length:1;for(n=0;n<p;n++){for(l=f?t.features[n].properties:d?t.properties:{},u=f?t.features[n].bbox:d?t.bbox:void 0,c=f?t.features[n].id:d?t.id:void 0,s=(h=!!(a=f?t.features[n].geometry:d?t.geometry:t)&&"GeometryCollection"===a.type)?a.geometries.length:1,r=0;r<s;r++)if(null!==(o=h?a.geometries[r]:a))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,A,l,u,c))return!1;break;case"GeometryCollection":for(i=0;i<o.geometries.length;i++)if(!1===e(o.geometries[i],A,l,u,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,A,l,u,c))return!1;A++}}function Yot(t){var e=[1/0,1/0,-1/0,-1/0];return Zot(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}Yot.default=Yot,"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(null==this)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)e[i]=t,++i;return e},writable:!0}),Number.isFinite=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},Number.isInteger=Number.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(t){return t!=t},Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var Jot=function(){};Jot.prototype.interfaces_=function(){return[]},Jot.prototype.getClass=function(){return Jot},Jot.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var Kot=function(t){function e(e){t.call(this,e),this.name="IllegalArgumentException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),$ot=function(){},tst={MAX_VALUE:{configurable:!0}};$ot.isNaN=function(t){return Number.isNaN(t)},$ot.doubleToLongBits=function(t){return t},$ot.longBitsToDouble=function(t){return t},$ot.isInfinite=function(t){return!Number.isFinite(t)},tst.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties($ot,tst);var est=function(){},nst=function(){},ist=function(){};function rst(){}var ost=function t(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},sst={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};ost.prototype.setOrdinate=function(t,e){switch(t){case ost.X:this.x=e;break;case ost.Y:this.y=e;break;case ost.Z:this.z=e;break;default:throw new Kot("Invalid ordinate index: "+t)}},ost.prototype.equals2D=function(){if(1===arguments.length){var t=arguments[0];return this.x===t.x&&this.y===t.y}if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!Jot.equalsWithTolerance(this.x,e.x,n)&&!!Jot.equalsWithTolerance(this.y,e.y,n)}},ost.prototype.getOrdinate=function(t){switch(t){case ost.X:return this.x;case ost.Y:return this.y;case ost.Z:return this.z}throw new Kot("Invalid ordinate index: "+t)},ost.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||$ot.isNaN(this.z))&&$ot.isNaN(t.z)},ost.prototype.equals=function(t){return t instanceof ost&&this.equals2D(t)},ost.prototype.equalInZ=function(t,e){return Jot.equalsWithTolerance(this.z,t.z,e)},ost.prototype.compareTo=function(t){return this.x<t.x?-1:this.x>t.x?1:this.y<t.y?-1:this.y>t.y?1:0},ost.prototype.clone=function(){},ost.prototype.copy=function(){return new ost(this)},ost.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},ost.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,i=this.z-t.z;return Math.sqrt(e*e+n*n+i*i)},ost.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},ost.prototype.hashCode=function(){var t=17;return 37*(t=37*t+ost.hashCode(this.x))+ost.hashCode(this.y)},ost.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z},ost.prototype.interfaces_=function(){return[est,nst,rst]},ost.prototype.getClass=function(){return ost},ost.hashCode=function(){if(1===arguments.length)return $ot.doubleToLongBits(arguments[0]),Math.trunc(0)},sst.DimensionalComparator.get=function(){return ast},sst.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},sst.NULL_ORDINATE.get=function(){return $ot.NaN},sst.X.get=function(){return 0},sst.Y.get=function(){return 1},sst.Z.get=function(){return 2},Object.defineProperties(ost,sst);var ast=function(t){if(this.xt=2,0===arguments.length);else if(1===arguments.length){var e=arguments[0];if(2!==e&&3!==e)throw new Kot("only 2 or 3 dimensions may be specified");this.xt=e}};ast.prototype.compare=function(t,e){var n=t,i=e,r=ast.compare(n.x,i.x);if(0!==r)return r;var o=ast.compare(n.y,i.y);return 0!==o?o:this.xt<=2?0:ast.compare(n.z,i.z)},ast.prototype.interfaces_=function(){return[ist]},ast.prototype.getClass=function(){return ast},ast.compare=function(t,e){return t<e?-1:t>e?1:$ot.isNaN(t)?$ot.isNaN(e)?0:-1:$ot.isNaN(e)?1:0};var hst=function(){};hst.prototype.create=function(){},hst.prototype.interfaces_=function(){return[]},hst.prototype.getClass=function(){return hst};var lst=function(){},ust={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};lst.prototype.interfaces_=function(){return[]},lst.prototype.getClass=function(){return lst},lst.toLocationSymbol=function(t){switch(t){case lst.EXTERIOR:return"e";case lst.BOUNDARY:return"b";case lst.INTERIOR:return"i";case lst.NONE:return"-"}throw new Kot("Unknown location value: "+t)},ust.INTERIOR.get=function(){return 0},ust.BOUNDARY.get=function(){return 1},ust.EXTERIOR.get=function(){return 2},ust.NONE.get=function(){return-1},Object.defineProperties(lst,ust);var cst=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Ast=function(){},fst={LOG_10:{configurable:!0}};Ast.prototype.interfaces_=function(){return[]},Ast.prototype.getClass=function(){return Ast},Ast.log10=function(t){var e=Math.log(t);return $ot.isInfinite(e)||$ot.isNaN(e)?e:e/Ast.LOG_10},Ast.min=function(t,e,n,i){var r=t;return e<r&&(r=e),n<r&&(r=n),i<r&&(r=i),r},Ast.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],o=arguments[2];return i<r?r:i>o?o:i}},Ast.wrap=function(t,e){return t<0?e- -t%e:t%e},Ast.max=function(){if(3===arguments.length){var t=arguments[1],e=arguments[2],n=arguments[0];return t>n&&(n=t),e>n&&(n=e),n}if(4===arguments.length){var i=arguments[1],r=arguments[2],o=arguments[3],s=arguments[0];return i>s&&(s=i),r>s&&(s=r),o>s&&(s=o),s}},Ast.average=function(t,e){return(t+e)/2},fst.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Ast,fst);var dst=function(t){this.str=t};dst.prototype.append=function(t){this.str+=t},dst.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)},dst.prototype.toString=function(t){return this.str};var pst=function(t){this.value=t};pst.prototype.intValue=function(){return this.value},pst.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0},pst.isNaN=function(t){return Number.isNaN(t)};var gst=function(){};gst.isWhitespace=function(t){return t<=32&&t>=0||127===t},gst.toUpperCase=function(t){return t.toUpperCase()};var mst=function t(){this.yt=0,this.Lt=0,0===arguments.length?this.init(0):1===arguments.length?"number"==typeof arguments[0]||arguments[0]instanceof t?this.init(arguments[0]):"string"==typeof arguments[0]&&t.call(this,t.parse(arguments[0])):2===arguments.length&&this.init(arguments[0],arguments[1])},yst={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};mst.prototype.le=function(t){return(this.yt<t.yt||this.yt===t.yt)&&this.Lt<=t.Lt},mst.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),i=mst.magnitude(n.yt),r=mst.TEN.pow(i);(n=n.divide(r)).gt(mst.TEN)?(n=n.divide(mst.TEN),i+=1):n.lt(mst.ONE)&&(n=n.multiply(mst.TEN),i-=1);for(var o=i+1,s=new dst,a=mst.MAX_PRINT_DIGITS-1,h=0;h<=a;h++){t&&h===o&&s.append(".");var l=Math.trunc(n.yt);if(l<0)break;var u=!1,c=0;l>9?(u=!0,c="9"):c="0"+l,s.append(c),n=n.subtract(mst.valueOf(l)).multiply(mst.TEN),u&&n.selfAdd(mst.TEN);var A=!0,f=mst.magnitude(n.yt);if(f<0&&Math.abs(f)>=a-h&&(A=!1),!A)break}return e[0]=i,s.toString()},mst.prototype.sqr=function(){return this.multiply(this)},mst.prototype.doubleValue=function(){return this.yt+this.Lt},mst.prototype.subtract=function(){return arguments[0]instanceof mst?this.add(arguments[0].negate()):"number"==typeof arguments[0]?this.add(-arguments[0]):void 0},mst.prototype.equals=function(){if(1===arguments.length){var t=arguments[0];return this.yt===t.yt&&this.Lt===t.Lt}},mst.prototype.isZero=function(){return 0===this.yt&&0===this.Lt},mst.prototype.selfSubtract=function(){if(arguments[0]instanceof mst){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t.yt,-t.Lt)}if("number"==typeof arguments[0]){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}},mst.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},mst.prototype.min=function(t){return this.le(t)?this:t},mst.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof mst){var t=arguments[0];return this.selfDivide(t.yt,t.Lt)}if("number"==typeof arguments[0])return this.selfDivide(arguments[0],0)}else if(2===arguments.length){var e,n,i,r,o=arguments[0],s=null,a=null,h=null,l=null;return l=(s=(h=mst.SPLIT*(i=this.yt/o))-(s=h-i))*(a=(l=mst.SPLIT*o)-(a=l-o))-(r=i*o)+s*(n=o-a)+(e=i-s)*a+e*n,l=i+(h=(this.yt-r-l+this.Lt-i*arguments[1])/o),this.yt=l,this.Lt=i-l+h,this}},mst.prototype.dump=function(){return"DD<"+this.yt+", "+this.Lt+">"},mst.prototype.divide=function(){if(arguments[0]instanceof mst){var t,e,n,i,r=arguments[0],o=null,s=null,a=null,h=null;return t=(n=this.yt/r.yt)-(o=(a=mst.SPLIT*n)-(o=a-n)),h=o*(s=(h=mst.SPLIT*r.yt)-(s=h-r.yt))-(i=n*r.yt)+o*(e=r.yt-s)+t*s+t*e,new mst(h=n+(a=(this.yt-i-h+this.Lt-n*r.Lt)/r.yt),n-h+a)}if("number"==typeof arguments[0]){var l=arguments[0];return $ot.isNaN(l)?mst.createNaN():mst.copy(this).selfDivide(l,0)}},mst.prototype.ge=function(t){return(this.yt>t.yt||this.yt===t.yt)&&this.Lt>=t.Lt},mst.prototype.pow=function(t){if(0===t)return mst.valueOf(1);var e=new mst(this),n=mst.valueOf(1),i=Math.abs(t);if(i>1)for(;i>0;)i%2==1&&n.selfMultiply(e),(i/=2)>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n},mst.prototype.ceil=function(){if(this.isNaN())return mst.NaN;var t=Math.ceil(this.yt),e=0;return t===this.yt&&(e=Math.ceil(this.Lt)),new mst(t,e)},mst.prototype.compareTo=function(t){return this.yt<t.yt?-1:this.yt>t.yt?1:this.Lt<t.Lt?-1:this.Lt>t.Lt?1:0},mst.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},mst.prototype.setValue=function(){return arguments[0]instanceof mst||"number"==typeof arguments[0]?(this.init(arguments[0]),this):void 0},mst.prototype.max=function(t){return this.ge(t)?this:t},mst.prototype.sqrt=function(){if(this.isZero())return mst.valueOf(0);if(this.isNegative())return mst.NaN;var t=1/Math.sqrt(this.yt),e=mst.valueOf(this.yt*t),n=this.subtract(e.sqr()).yt*(.5*t);return e.add(n)},mst.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof mst){var t=arguments[0];return this.selfAdd(t.yt,t.Lt)}if("number"==typeof arguments[0]){var e,n,i,r,o,s=arguments[0],a=null;return a=(i=this.yt+s)-(r=i-this.yt),n=(o=(a=s-r+(this.yt-a))+this.Lt)+(i-(e=i+o)),this.yt=e+n,this.Lt=n+(e-this.yt),this}}else if(2===arguments.length){var h,l,u,c,A=arguments[0],f=arguments[1],d=null,p=null,g=null;p=(u=this.yt+A)-(g=u-this.yt),d=(l=this.Lt+f)-(c=l-this.Lt);var m=(h=u+(g=(p=A-g+(this.yt-p))+l))+(g=(d=f-c+(this.Lt-d))+(g+(u-h))),y=g+(h-m);return this.yt=m,this.Lt=y,this}},mst.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof mst){var t=arguments[0];return this.selfMultiply(t.yt,t.Lt)}if("number"==typeof arguments[0])return this.selfMultiply(arguments[0],0)}else if(2===arguments.length){var e,n,i=arguments[0],r=null,o=null,s=null,a=null;r=(s=mst.SPLIT*this.yt)-this.yt,r=s-r;var h=(s=this.yt*i)+(a=r*(o=(a=mst.SPLIT*i)-(o=a-i))-s+r*(n=i-o)+(e=this.yt-r)*o+e*n+(this.yt*arguments[1]+this.Lt*i)),l=a+(r=s-h);return this.yt=h,this.Lt=l,this}},mst.prototype.selfSqr=function(){return this.selfMultiply(this)},mst.prototype.floor=function(){if(this.isNaN())return mst.NaN;var t=Math.floor(this.yt),e=0;return t===this.yt&&(e=Math.floor(this.Lt)),new mst(t,e)},mst.prototype.negate=function(){return this.isNaN()?this:new mst(-this.yt,-this.Lt)},mst.prototype.clone=function(){},mst.prototype.multiply=function(){if(arguments[0]instanceof mst){var t=arguments[0];return t.isNaN()?mst.createNaN():mst.copy(this).selfMultiply(t)}if("number"==typeof arguments[0]){var e=arguments[0];return $ot.isNaN(e)?mst.createNaN():mst.copy(this).selfMultiply(e,0)}},mst.prototype.isNaN=function(){return $ot.isNaN(this.yt)},mst.prototype.intValue=function(){return Math.trunc(this.yt)},mst.prototype.toString=function(){var t=mst.magnitude(this.yt);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()},mst.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),i=e[0]+1,r=n;return"."===n.charAt(0)?r="0"+n:i<0?r="0."+mst.stringOfChar("0",-i)+n:-1===n.indexOf(".")&&(r=n+mst.stringOfChar("0",i-n.length)+".0"),this.isNegative()?"-"+r:r},mst.prototype.reciprocal=function(){var t,e,n,i,r=null,o=null,s=null,a=null;t=(n=1/this.yt)-(r=(s=mst.SPLIT*n)-(r=s-n)),o=(a=mst.SPLIT*this.yt)-this.yt;var h=n+(s=(1-(i=n*this.yt)-(a=r*(o=a-o)-i+r*(e=this.yt-o)+t*o+t*e)-n*this.Lt)/this.yt);return new mst(h,n-h+s)},mst.prototype.toSciNotation=function(){if(this.isZero())return mst.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(null!==t)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),i=mst.SCI_NOT_EXPONENT_CHAR+e[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var o=n.charAt(0)+"."+r;return this.isNegative()?"-"+o+i:o+i},mst.prototype.abs=function(){return this.isNaN()?mst.NaN:this.isNegative()?this.negate():new mst(this)},mst.prototype.isPositive=function(){return(this.yt>0||0===this.yt)&&this.Lt>0},mst.prototype.lt=function(t){return(this.yt<t.yt||this.yt===t.yt)&&this.Lt<t.Lt},mst.prototype.add=function(){if(arguments[0]instanceof mst){var t=arguments[0];return mst.copy(this).selfAdd(t)}if("number"==typeof arguments[0]){var e=arguments[0];return mst.copy(this).selfAdd(e)}},mst.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0])this.yt=arguments[0],this.Lt=0;else if(arguments[0]instanceof mst){var t=arguments[0];this.yt=t.yt,this.Lt=t.Lt}}else if(2===arguments.length){var e=arguments[1];this.yt=arguments[0],this.Lt=e}},mst.prototype.gt=function(t){return(this.yt>t.yt||this.yt===t.yt)&&this.Lt>t.Lt},mst.prototype.isNegative=function(){return(this.yt<0||0===this.yt)&&this.Lt<0},mst.prototype.trunc=function(){return this.isNaN()?mst.NaN:this.isPositive()?this.floor():this.ceil()},mst.prototype.signum=function(){return this.yt>0?1:this.yt<0?-1:this.Lt>0?1:this.Lt<0?-1:0},mst.prototype.interfaces_=function(){return[rst,est,nst]},mst.prototype.getClass=function(){return mst},mst.sqr=function(t){return mst.valueOf(t).selfMultiply(t)},mst.valueOf=function(){return"string"==typeof arguments[0]?mst.parse(arguments[0]):"number"==typeof arguments[0]?new mst(arguments[0]):void 0},mst.sqrt=function(t){return mst.valueOf(t).sqrt()},mst.parse=function(t){for(var e=0,n=t.length;gst.isWhitespace(t.charAt(e));)e++;var i=!1;if(e<n){var r=t.charAt(e);"-"!==r&&"+"!==r||(e++,"-"===r&&(i=!0))}for(var o=new mst,s=0,a=0,h=0;!(e>=n);){var l=t.charAt(e);if(e++,gst.isDigit(l)){var u=l-"0";o.selfMultiply(mst.TEN),o.selfAdd(u),s++}else{if("."!==l){if("e"===l||"E"===l){var c=t.substring(e);try{h=pst.parseInt(c)}catch(g){throw g instanceof Error?new Error("Invalid exponent "+c+" in string "+t):g}break}throw new Error("Unexpected character '"+l+"' at position "+e+" in string "+t)}a=s}}var A=o,f=s-a-h;if(0===f)A=o;else if(f>0){var d=mst.TEN.pow(f);A=o.divide(d)}else if(f<0){var p=mst.TEN.pow(-f);A=o.multiply(p)}return i?A.negate():A},mst.createNaN=function(){return new mst($ot.NaN,$ot.NaN)},mst.copy=function(t){return new mst(t)},mst.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=e&&(i+=1),i},mst.stringOfChar=function(t,e){for(var n=new dst,i=0;i<e;i++)n.append(t);return n.toString()},yst.PI.get=function(){return new mst(3.141592653589793,12246467991473532e-32)},yst.TWO_PI.get=function(){return new mst(6.283185307179586,24492935982947064e-32)},yst.PI_2.get=function(){return new mst(1.5707963267948966,6123233995736766e-32)},yst.E.get=function(){return new mst(2.718281828459045,14456468917292502e-32)},yst.NaN.get=function(){return new mst($ot.NaN,$ot.NaN)},yst.EPS.get=function(){return 123259516440783e-46},yst.SPLIT.get=function(){return 134217729},yst.MAX_PRINT_DIGITS.get=function(){return 32},yst.TEN.get=function(){return mst.valueOf(10)},yst.ONE.get=function(){return mst.valueOf(1)},yst.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},yst.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(mst,yst);var vst=function(){},_st={DP_SAFE_EPSILON:{configurable:!0}};vst.prototype.interfaces_=function(){return[]},vst.prototype.getClass=function(){return vst},vst.orientationIndex=function(t,e,n){var i=vst.orientationIndexFilter(t,e,n);if(i<=1)return i;var r=mst.valueOf(e.x).selfAdd(-t.x),o=mst.valueOf(e.y).selfAdd(-t.y),s=mst.valueOf(n.x).selfAdd(-e.x),a=mst.valueOf(n.y).selfAdd(-e.y);return r.selfMultiply(a).selfSubtract(o.selfMultiply(s)).signum()},vst.signOfDet2x2=function(t,e,n,i){return t.multiply(i).selfSubtract(e.multiply(n)).signum()},vst.intersection=function(t,e,n,i){var r=mst.valueOf(i.y).selfSubtract(n.y).selfMultiply(mst.valueOf(e.x).selfSubtract(t.x)),o=mst.valueOf(i.x).selfSubtract(n.x).selfMultiply(mst.valueOf(e.y).selfSubtract(t.y)),s=r.subtract(o),a=mst.valueOf(i.x).selfSubtract(n.x).selfMultiply(mst.valueOf(t.y).selfSubtract(n.y)),h=mst.valueOf(i.y).selfSubtract(n.y).selfMultiply(mst.valueOf(t.x).selfSubtract(n.x)),l=a.subtract(h).selfDivide(s).doubleValue(),u=mst.valueOf(t.x).selfAdd(mst.valueOf(e.x).selfSubtract(t.x).selfMultiply(l)).doubleValue(),c=mst.valueOf(e.x).selfSubtract(t.x).selfMultiply(mst.valueOf(t.y).selfSubtract(n.y)),A=mst.valueOf(e.y).selfSubtract(t.y).selfMultiply(mst.valueOf(t.x).selfSubtract(n.x)),f=c.subtract(A).selfDivide(s).doubleValue(),d=mst.valueOf(n.y).selfAdd(mst.valueOf(i.y).selfSubtract(n.y).selfMultiply(f)).doubleValue();return new ost(u,d)},vst.orientationIndexFilter=function(t,e,n){var i=null,r=(t.x-n.x)*(e.y-n.y),o=(t.y-n.y)*(e.x-n.x),s=r-o;if(r>0){if(o<=0)return vst.signum(s);i=r+o}else{if(!(r<0))return vst.signum(s);if(o>=0)return vst.signum(s);i=-r-o}var a=vst.DP_SAFE_EPSILON*i;return s>=a||-s>=a?vst.signum(s):2},vst.signum=function(t){return t>0?1:t<0?-1:0},_st.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(vst,_st);var xst=function(){},bst={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};bst.X.get=function(){return 0},bst.Y.get=function(){return 1},bst.Z.get=function(){return 2},bst.M.get=function(){return 3},xst.prototype.setOrdinate=function(t,e,n){},xst.prototype.size=function(){},xst.prototype.getOrdinate=function(t,e){},xst.prototype.getCoordinate=function(){},xst.prototype.getCoordinateCopy=function(t){},xst.prototype.getDimension=function(){},xst.prototype.getX=function(t){},xst.prototype.clone=function(){},xst.prototype.expandEnvelope=function(t){},xst.prototype.copy=function(){},xst.prototype.getY=function(t){},xst.prototype.toCoordinateArray=function(){},xst.prototype.interfaces_=function(){return[nst]},xst.prototype.getClass=function(){return xst},Object.defineProperties(xst,bst);var wst=function(){},Cst=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(wst),Pst=function(){};Pst.arraycopy=function(t,e,n,i,r){for(var o=0,s=e;s<e+r;s++)n[i+o]=t[s],o++},Pst.getProperty=function(t){return{"line.separator":"\n"}[t]};var Mst=function t(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[1];this.x=arguments[0],this.y=n,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var i=arguments[0],r=arguments[1];this.x=i.y*r.w-r.y*i.w,this.y=r.x*i.w-i.x*r.w,this.w=i.x*r.y-r.x*i.y}else if(arguments[0]instanceof ost&&arguments[1]instanceof ost){var o=arguments[0],s=arguments[1];this.x=o.y-s.y,this.y=s.x-o.x,this.w=o.x*s.y-s.x*o.y}}else if(3===arguments.length){var a=arguments[1],h=arguments[2];this.x=arguments[0],this.y=a,this.w=h}else if(4===arguments.length){var l=arguments[0],u=arguments[1],c=arguments[2],A=arguments[3],f=l.y-u.y,d=u.x-l.x,p=l.x*u.y-u.x*l.y,g=c.y-A.y,m=A.x-c.x,y=c.x*A.y-A.x*c.y;this.x=d*y-m*p,this.y=g*p-f*y,this.w=f*m-g*d}};Mst.prototype.getY=function(){var t=this.y/this.w;if($ot.isNaN(t)||$ot.isInfinite(t))throw new Cst;return t},Mst.prototype.getX=function(){var t=this.x/this.w;if($ot.isNaN(t)||$ot.isInfinite(t))throw new Cst;return t},Mst.prototype.getCoordinate=function(){var t=new ost;return t.x=this.getX(),t.y=this.getY(),t},Mst.prototype.interfaces_=function(){return[]},Mst.prototype.getClass=function(){return Mst},Mst.intersection=function(t,e,n,i){var r=t.y-e.y,o=e.x-t.x,s=t.x*e.y-e.x*t.y,a=n.y-i.y,h=i.x-n.x,l=n.x*i.y-i.x*n.y,u=r*h-a*o,c=(o*l-h*s)/u,A=(a*s-r*l)/u;if($ot.isNaN(c)||$ot.isInfinite(c)||$ot.isNaN(A)||$ot.isInfinite(A))throw new Cst;return new ost(c,A)};var Tst=function t(){if(this.Tt=null,this.Ot=null,this.Ft=null,this.Ut=null,0===arguments.length)this.init();else if(1===arguments.length)if(arguments[0]instanceof ost){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else arguments[0]instanceof t&&this.init(arguments[0]);else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else 4===arguments.length&&this.init(arguments[0],arguments[1],arguments[2],arguments[3])},Sst={serialVersionUID:{configurable:!0}};Tst.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Tst.prototype.equals=function(t){if(!(t instanceof Tst))return!1;var e=t;return this.isNull()?e.isNull():this.Ot===e.getMaxX()&&this.Ut===e.getMaxY()&&this.Tt===e.getMinX()&&this.Ft===e.getMinY()},Tst.prototype.intersection=function(t){return this.isNull()||t.isNull()||!this.intersects(t)?new Tst:new Tst(this.Tt>t.Tt?this.Tt:t.Tt,this.Ot<t.Ot?this.Ot:t.Ot,this.Ft>t.Ft?this.Ft:t.Ft,this.Ut<t.Ut?this.Ut:t.Ut)},Tst.prototype.isNull=function(){return this.Ot<this.Tt},Tst.prototype.getMaxX=function(){return this.Ot},Tst.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof ost){var t=arguments[0];return this.covers(t.x,t.y)}if(arguments[0]instanceof Tst){var e=arguments[0];return!this.isNull()&&!e.isNull()&&e.getMinX()>=this.Tt&&e.getMaxX()<=this.Ot&&e.getMinY()>=this.Ft&&e.getMaxY()<=this.Ut}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&n>=this.Tt&&n<=this.Ot&&i>=this.Ft&&i<=this.Ut}},Tst.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Tst){var t=arguments[0];return!this.isNull()&&!t.isNull()&&!(t.Tt>this.Ot||t.Ot<this.Tt||t.Ft>this.Ut||t.Ut<this.Ft)}if(arguments[0]instanceof ost){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&!(n>this.Ot||n<this.Tt||i>this.Ut||i<this.Ft)}},Tst.prototype.getMinY=function(){return this.Ft},Tst.prototype.getMinX=function(){return this.Tt},Tst.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof ost){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof Tst){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this.Tt=e.getMinX(),this.Ot=e.getMaxX(),this.Ft=e.getMinY(),this.Ut=e.getMaxY()):(e.Tt<this.Tt&&(this.Tt=e.Tt),e.Ot>this.Ot&&(this.Ot=e.Ot),e.Ft<this.Ft&&(this.Ft=e.Ft),e.Ut>this.Ut&&(this.Ut=e.Ut))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.isNull()?(this.Tt=n,this.Ot=n,this.Ft=i,this.Ut=i):(n<this.Tt&&(this.Tt=n),n>this.Ot&&(this.Ot=n),i<this.Ft&&(this.Ft=i),i>this.Ut&&(this.Ut=i))}},Tst.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e},Tst.prototype.getWidth=function(){return this.isNull()?0:this.Ot-this.Tt},Tst.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this.Tt<e.Tt?-1:this.Tt>e.Tt?1:this.Ft<e.Ft?-1:this.Ft>e.Ft?1:this.Ot<e.Ot?-1:this.Ot>e.Ot?1:this.Ut<e.Ut?-1:this.Ut>e.Ut?1:0},Tst.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)},Tst.prototype.toString=function(){return"Env["+this.Tt+" : "+this.Ot+", "+this.Ft+" : "+this.Ut+"]"},Tst.prototype.setToNull=function(){this.Tt=0,this.Ot=-1,this.Ft=0,this.Ut=-1},Tst.prototype.getHeight=function(){return this.isNull()?0:this.Ut-this.Ft},Tst.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e},Tst.prototype.expandBy=function(){if(1===arguments.length){var t=arguments[0];this.expandBy(t,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this.Tt-=e,this.Ot+=e,this.Ft-=n,this.Ut+=n,(this.Tt>this.Ot||this.Ft>this.Ut)&&this.setToNull()}},Tst.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Tst)return this.covers(arguments[0]);if(arguments[0]instanceof ost)return this.covers(arguments[0])}else if(2===arguments.length)return this.covers(arguments[0],arguments[1])},Tst.prototype.centre=function(){return this.isNull()?null:new ost((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Tst.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof ost){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof Tst){var e=arguments[0];this.Tt=e.Tt,this.Ot=e.Ot,this.Ft=e.Ft,this.Ut=e.Ut}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2],a=arguments[3];r<o?(this.Tt=r,this.Ot=o):(this.Tt=o,this.Ot=r),s<a?(this.Ft=s,this.Ut=a):(this.Ft=a,this.Ut=s)}},Tst.prototype.getMaxY=function(){return this.Ut},Tst.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this.Ot<t.Tt?e=t.Tt-this.Ot:this.Tt>t.Ot&&(e=this.Tt-t.Ot);var n=0;return this.Ut<t.Ft?n=t.Ft-this.Ut:this.Ft>t.Ut&&(n=this.Ft-t.Ut),0===e?n:0===n?e:Math.sqrt(e*e+n*n)},Tst.prototype.hashCode=function(){var t=17;return 37*(t=37*(t=37*(t=37*t+ost.hashCode(this.Tt))+ost.hashCode(this.Ot))+ost.hashCode(this.Ft))+ost.hashCode(this.Ut)},Tst.prototype.interfaces_=function(){return[est,rst]},Tst.prototype.getClass=function(){return Tst},Tst.intersects=function(){if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=Math.min(o.x,s.x),h=Math.max(o.x,s.x),l=Math.min(i.x,r.x),u=Math.max(i.x,r.x);return!(l>h||u<a||(a=Math.min(o.y,s.y),h=Math.max(o.y,s.y),l=Math.min(i.y,r.y),u=Math.max(i.y,r.y),l>h||u<a))}},Sst.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Tst,Sst);var Ist={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Est=function(t){this.geometryFactory=t||new pht};Est.prototype.read=function(t){var e,n;t=t.replace(/[\n\r]/g," ");var i=Ist.typeStr.exec(t);if(-1!==t.search("EMPTY")&&((i=Ist.emptyTypeStr.exec(t))[2]=void 0),i&&(n=i[1].toLowerCase(),Rst[n]&&(e=Rst[n].apply(this,[i[2]]))),void 0===e)throw new Error("Could not parse WKT "+t);return e},Est.prototype.write=function(t){return this.extractGeometry(t)},Est.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Ost[e])return null;var n=e.toUpperCase();return t.isEmpty()?n+" EMPTY":n+"("+Ost[e].apply(this,[t])+")"};var Ost={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Ost.coordinate.call(this,t.Et.Et[0])},multipoint:function(t){for(var e=[],n=0,i=t.Nt.length;n<i;++n)e.push("("+Ost.point.apply(this,[t.Nt[n]])+")");return e.join(",")},linestring:function(t){for(var e=[],n=0,i=t.jt.Et.length;n<i;++n)e.push(Ost.coordinate.apply(this,[t.jt.Et[n]]));return e.join(",")},linearring:function(t){for(var e=[],n=0,i=t.jt.Et.length;n<i;++n)e.push(Ost.coordinate.apply(this,[t.jt.Et[n]]));return e.join(",")},multilinestring:function(t){for(var e=[],n=0,i=t.Nt.length;n<i;++n)e.push("("+Ost.linestring.apply(this,[t.Nt[n]])+")");return e.join(",")},polygon:function(t){var e=[];e.push("("+Ost.linestring.apply(this,[t.Qt])+")");for(var n=0,i=t.St.length;n<i;++n)e.push("("+Ost.linestring.apply(this,[t.St[n]])+")");return e.join(",")},multipolygon:function(t){for(var e=[],n=0,i=t.Nt.length;n<i;++n)e.push("("+Ost.polygon.apply(this,[t.Nt[n]])+")");return e.join(",")},geometrycollection:function(t){for(var e=[],n=0,i=t.Nt.length;n<i;++n)e.push(this.extractGeometry(t.Nt[n]));return e.join(",")}},Rst={point:function(t){if(void 0===t)return this.geometryFactory.createPoint();var e=t.trim().split(Ist.spaces);return this.geometryFactory.createPoint(new ost(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPoint();for(var n=t.trim().split(","),i=[],r=0,o=n.length;r<o;++r)e=n[r].replace(Ist.trimParens,"$1"),i.push(Rst.point.apply(this,[e]));return this.geometryFactory.createMultiPoint(i)},linestring:function(t){if(void 0===t)return this.geometryFactory.createLineString();for(var e,n=t.trim().split(","),i=[],r=0,o=n.length;r<o;++r)e=n[r].trim().split(Ist.spaces),i.push(new ost(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLineString(i)},linearring:function(t){if(void 0===t)return this.geometryFactory.createLinearRing();for(var e,n=t.trim().split(","),i=[],r=0,o=n.length;r<o;++r)e=n[r].trim().split(Ist.spaces),i.push(new ost(Number.parseFloat(e[0]),Number.parseFloat(e[1])));return this.geometryFactory.createLinearRing(i)},multilinestring:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiLineString();for(var n=t.trim().split(Ist.parenComma),i=[],r=0,o=n.length;r<o;++r)e=n[r].replace(Ist.trimParens,"$1"),i.push(Rst.linestring.apply(this,[e]));return this.geometryFactory.createMultiLineString(i)},polygon:function(t){var e,n,i;if(void 0===t)return this.geometryFactory.createPolygon();for(var r,o=t.trim().split(Ist.parenComma),s=[],a=0,h=o.length;a<h;++a)e=o[a].replace(Ist.trimParens,"$1"),n=Rst.linestring.apply(this,[e]),i=this.geometryFactory.createLinearRing(n.jt),0===a?r=i:s.push(i);return this.geometryFactory.createPolygon(r,s)},multipolygon:function(t){var e;if(void 0===t)return this.geometryFactory.createMultiPolygon();for(var n=t.trim().split(Ist.doubleParenComma),i=[],r=0,o=n.length;r<o;++r)e=n[r].replace(Ist.trimParens,"$1"),i.push(Rst.polygon.apply(this,[e]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(t){if(void 0===t)return this.geometryFactory.createGeometryCollection();for(var e=(t=t.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],i=0,r=e.length;i<r;++i)n.push(this.read(e[i]));return this.geometryFactory.createGeometryCollection(n)}},Dst=function(t){this.parser=new Est(t)};Dst.prototype.write=function(t){return this.parser.write(t)},Dst.toLineString=function(t,e){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var kst=function(t){function e(e){t.call(this,e),this.name="RuntimeException",this.message=e,this.stack=(new t).stack}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),Lst=function(t){function e(){t.call(this),0===arguments.length?t.call(this):1===arguments.length&&t.call(this,arguments[0])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(kst),Fst=function(){};Fst.prototype.interfaces_=function(){return[]},Fst.prototype.getClass=function(){return Fst},Fst.shouldNeverReachHere=function(){if(0===arguments.length)Fst.shouldNeverReachHere(null);else if(1===arguments.length){var t=arguments[0];throw new Lst("Should never reach here"+(null!==t?": "+t:""))}},Fst.isTrue=function(){var t;if(1===arguments.length)Fst.isTrue(arguments[0],null);else if(2===arguments.length&&(t=arguments[1],!arguments[0]))throw null===t?new Lst:new Lst(t)},Fst.equals=function(){var t,e,n;if(2===arguments.length)Fst.equals(t=arguments[0],e=arguments[1],null);else if(3===arguments.length&&(n=arguments[2],!(e=arguments[1]).equals(t=arguments[0])))throw new Lst("Expected "+t+" but encountered "+e+(null!==n?": "+n:""))};var Nst=function(){this.Bt=null,this.kt=Array(2).fill().map((function(){return Array(2)})),this.Rt=new Array(2).fill(null),this.Gt=null,this.Yt=null,this.qt=null,this.Vt=null,this.Wt=null,this.Rt[0]=new ost,this.Rt[1]=new ost,this.qt=this.Rt[0],this.Vt=this.Rt[1],this.Bt=0},zst={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Nst.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this.Gt[t][e]},Nst.prototype.getTopologySummary=function(){var t=new dst;return this.isEndPoint()&&t.append(" endpoint"),this.Yt&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()},Nst.prototype.computeIntersection=function(t,e,n,i){this.kt[0][0]=t,this.kt[0][1]=e,this.kt[1][0]=n,this.kt[1][1]=i,this.Bt=this.computeIntersect(t,e,n,i)},Nst.prototype.getIntersectionNum=function(){return this.Bt},Nst.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this.Gt&&(this.Gt=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var t=arguments[0];this.getEdgeDistance(t,0)>this.getEdgeDistance(t,1)?(this.Gt[t][0]=0,this.Gt[t][1]=1):(this.Gt[t][0]=1,this.Gt[t][1]=0)}},Nst.prototype.isProper=function(){return this.hasIntersection()&&this.Yt},Nst.prototype.setPrecisionModel=function(t){this.Wt=t},Nst.prototype.isInteriorIntersection=function(){var t=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var e=arguments[0],n=0;n<this.Bt;n++)if(!t.Rt[n].equals2D(t.kt[e][0])&&!t.Rt[n].equals2D(t.kt[e][1]))return!0;return!1}},Nst.prototype.getIntersection=function(t){return this.Rt[t]},Nst.prototype.isEndPoint=function(){return this.hasIntersection()&&!this.Yt},Nst.prototype.hasIntersection=function(){return this.Bt!==Nst.NO_INTERSECTION},Nst.prototype.getEdgeDistance=function(t,e){return Nst.computeEdgeDistance(this.Rt[e],this.kt[t][0],this.kt[t][1])},Nst.prototype.isCollinear=function(){return this.Bt===Nst.COLLINEAR_INTERSECTION},Nst.prototype.toString=function(){return Dst.toLineString(this.kt[0][0],this.kt[0][1])+" - "+Dst.toLineString(this.kt[1][0],this.kt[1][1])+this.getTopologySummary()},Nst.prototype.getEndpoint=function(t,e){return this.kt[t][e]},Nst.prototype.isIntersection=function(t){for(var e=0;e<this.Bt;e++)if(this.Rt[e].equals2D(t))return!0;return!1},Nst.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this.Rt[this.Gt[t][e]]},Nst.prototype.interfaces_=function(){return[]},Nst.prototype.getClass=function(){return Nst},Nst.computeEdgeDistance=function(t,e,n){var i=Math.abs(n.x-e.x),r=Math.abs(n.y-e.y),o=-1;if(t.equals(e))o=0;else if(t.equals(n))o=i>r?i:r;else{var s=Math.abs(t.x-e.x),a=Math.abs(t.y-e.y);0!==(o=i>r?s:a)||t.equals(e)||(o=Math.max(s,a))}return Fst.isTrue(!(0===o&&!t.equals(e)),"Bad distance calculation"),o},Nst.nonRobustComputeEdgeDistance=function(t,e,n){var i=t.x-e.x,r=t.y-e.y,o=Math.sqrt(i*i+r*r);return Fst.isTrue(!(0===o&&!t.equals(e)),"Invalid distance calculation"),o},zst.DONT_INTERSECT.get=function(){return 0},zst.DO_INTERSECT.get=function(){return 1},zst.COLLINEAR.get=function(){return 2},zst.NO_INTERSECTION.get=function(){return 0},zst.POINT_INTERSECTION.get=function(){return 1},zst.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(Nst,zst);var Bst=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.isInSegmentEnvelopes=function(t){var e=new Tst(this.kt[0][0],this.kt[0][1]),n=new Tst(this.kt[1][0],this.kt[1][1]);return e.contains(t)&&n.contains(t)},e.prototype.computeIntersection=function(){if(3!==arguments.length)return t.prototype.computeIntersection.apply(this,arguments);var e=arguments[0],n=arguments[1],i=arguments[2];if(this.Yt=!1,Tst.intersects(n,i,e)&&0===Ust.orientationIndex(n,i,e)&&0===Ust.orientationIndex(i,n,e))return this.Yt=!0,(e.equals(n)||e.equals(i))&&(this.Yt=!1),this.Bt=t.POINT_INTERSECTION,null;this.Bt=t.NO_INTERSECTION},e.prototype.normalizeToMinimum=function(t,e,n,i,r){r.x=this.smallestInAbsValue(t.x,e.x,n.x,i.x),r.y=this.smallestInAbsValue(t.y,e.y,n.y,i.y),t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},e.prototype.safeHCoordinateIntersection=function(t,n,i,r){var o=null;try{o=Mst.intersection(t,n,i,r)}catch(s){if(!(s instanceof Cst))throw s;o=e.nearestEndpoint(t,n,i,r)}return o},e.prototype.intersection=function(t,n,i,r){var o=this.intersectionWithNormalization(t,n,i,r);return this.isInSegmentEnvelopes(o)||(o=new ost(e.nearestEndpoint(t,n,i,r))),null!==this.Wt&&this.Wt.makePrecise(o),o},e.prototype.smallestInAbsValue=function(t,e,n,i){var r=t,o=Math.abs(r);return Math.abs(e)<o&&(r=e,o=Math.abs(e)),Math.abs(n)<o&&(r=n,o=Math.abs(n)),Math.abs(i)<o&&(r=i),r},e.prototype.checkDD=function(t,e,n,i,r){var o=vst.intersection(t,e,n,i),s=this.isInSegmentEnvelopes(o);Pst.out.println("DD in env = "+s+"  --------------------- "+o),r.distance(o)>1e-4&&Pst.out.println("Distance = "+r.distance(o))},e.prototype.intersectionWithNormalization=function(t,e,n,i){var r=new ost(t),o=new ost(e),s=new ost(n),a=new ost(i),h=new ost;this.normalizeToEnvCentre(r,o,s,a,h);var l=this.safeHCoordinateIntersection(r,o,s,a);return l.x+=h.x,l.y+=h.y,l},e.prototype.computeCollinearIntersection=function(e,n,i,r){var o=Tst.intersects(e,n,i),s=Tst.intersects(e,n,r),a=Tst.intersects(i,r,e),h=Tst.intersects(i,r,n);return o&&s?(this.Rt[0]=i,this.Rt[1]=r,t.COLLINEAR_INTERSECTION):a&&h?(this.Rt[0]=e,this.Rt[1]=n,t.COLLINEAR_INTERSECTION):o&&a?(this.Rt[0]=i,this.Rt[1]=e,!i.equals(e)||s||h?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):o&&h?(this.Rt[0]=i,this.Rt[1]=n,!i.equals(n)||s||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&a?(this.Rt[0]=r,this.Rt[1]=e,!r.equals(e)||o||h?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):s&&h?(this.Rt[0]=r,this.Rt[1]=n,!r.equals(n)||o||a?t.COLLINEAR_INTERSECTION:t.POINT_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(t,e,n,i,r){var o=t.x<e.x?t.x:e.x,s=t.y<e.y?t.y:e.y,a=t.x>e.x?t.x:e.x,h=t.y>e.y?t.y:e.y,l=n.x<i.x?n.x:i.x,u=n.y<i.y?n.y:i.y,c=n.x>i.x?n.x:i.x,A=n.y>i.y?n.y:i.y,f=((s>u?s:u)+(h<A?h:A))/2;r.x=((o>l?o:l)+(a<c?a:c))/2,r.y=f,t.x-=r.x,t.y-=r.y,e.x-=r.x,e.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},e.prototype.computeIntersect=function(e,n,i,r){if(this.Yt=!1,!Tst.intersects(e,n,i,r))return t.NO_INTERSECTION;var o=Ust.orientationIndex(e,n,i),s=Ust.orientationIndex(e,n,r);if(o>0&&s>0||o<0&&s<0)return t.NO_INTERSECTION;var a=Ust.orientationIndex(i,r,e),h=Ust.orientationIndex(i,r,n);return a>0&&h>0||a<0&&h<0?t.NO_INTERSECTION:0===o&&0===s&&0===a&&0===h?this.computeCollinearIntersection(e,n,i,r):(0===o||0===s||0===a||0===h?(this.Yt=!1,e.equals2D(i)||e.equals2D(r)?this.Rt[0]=e:n.equals2D(i)||n.equals2D(r)?this.Rt[0]=n:0===o?this.Rt[0]=new ost(i):0===s?this.Rt[0]=new ost(r):0===a?this.Rt[0]=new ost(e):0===h&&(this.Rt[0]=new ost(n))):(this.Yt=!0,this.Rt[0]=this.intersection(e,n,i,r)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(t,e,n,i){var r=t,o=Ust.distancePointLine(t,n,i),s=Ust.distancePointLine(e,n,i);return s<o&&(o=s,r=e),(s=Ust.distancePointLine(n,t,e))<o&&(o=s,r=n),(s=Ust.distancePointLine(i,t,e))<o&&(o=s,r=i),r},e}(Nst),Hst=function(){};Hst.prototype.interfaces_=function(){return[]},Hst.prototype.getClass=function(){return Hst},Hst.orientationIndex=function(t,e,n){return Hst.signOfDet2x2(e.x-t.x,e.y-t.y,n.x-e.x,n.y-e.y)},Hst.signOfDet2x2=function(t,e,n,i){var r=null,o=null,s=null;if(r=1,0===t||0===i)return 0===e||0===n?0:e>0?n>0?-r:r:n>0?r:-r;if(0===e||0===n)return i>0?t>0?r:-r:t>0?-r:r;if(e>0?i>0?e<=i||(r=-r,o=t,t=n,n=o,o=e,e=i,i=o):e<=-i?(r=-r,n=-n,i=-i):(o=t,t=-n,n=o,o=e,e=-i,i=o):i>0?-e<=i?(r=-r,t=-t,e=-e):(o=-t,t=n,n=o,o=-e,e=i,i=o):e>=i?(t=-t,e=-e,n=-n,i=-i):(r=-r,o=-t,t=-n,n=o,o=-e,e=-i,i=o),t>0){if(!(n>0))return r;if(!(t<=n))return r}else{if(n>0)return-r;if(!(t>=n))return-r;r=-r,t=-t,n=-n}for(;;){if((i-=(s=Math.floor(n/t))*e)<0)return-r;if(i>e)return r;if(t>(n-=s*t)+n){if(e<i+i)return r}else{if(e>i+i)return-r;n=t-n,i=e-i,r=-r}if(0===i)return 0===n?0:-r;if(0===n)return r;if((e-=(s=Math.floor(t/n))*i)<0)return r;if(e>i)return-r;if(n>(t-=s*n)+t){if(i<e+e)return-r}else{if(i>e+e)return r;t=n-t,e=i-e,r=-r}if(0===e)return 0===t?0:r;if(0===t)return-r}};var jst=function(){this._t=null,this.Kt=0,this.Ht=!1,this._t=arguments[0]};jst.prototype.countSegment=function(t,e){if(t.x<this._t.x&&e.x<this._t.x)return null;if(this._t.x===e.x&&this._t.y===e.y)return this.Ht=!0,null;if(t.y===this._t.y&&e.y===this._t.y){var n=t.x,i=e.x;return n>i&&(n=e.x,i=t.x),this._t.x>=n&&this._t.x<=i&&(this.Ht=!0),null}if(t.y>this._t.y&&e.y<=this._t.y||e.y>this._t.y&&t.y<=this._t.y){var r=t.y-this._t.y,o=e.y-this._t.y,s=Hst.signOfDet2x2(t.x-this._t.x,r,e.x-this._t.x,o);if(0===s)return this.Ht=!0,null;o<r&&(s=-s),s>0&&this.Kt++}},jst.prototype.isPointInPolygon=function(){return this.getLocation()!==lst.EXTERIOR},jst.prototype.getLocation=function(){return this.Ht?lst.BOUNDARY:this.Kt%2==1?lst.INTERIOR:lst.EXTERIOR},jst.prototype.isOnSegment=function(){return this.Ht},jst.prototype.interfaces_=function(){return[]},jst.prototype.getClass=function(){return jst},jst.locatePointInRing=function(){if(arguments[0]instanceof ost&&cst(arguments[1],xst)){for(var t=arguments[1],e=new jst(arguments[0]),n=new ost,i=new ost,r=1;r<t.size();r++)if(t.getCoordinate(r,n),t.getCoordinate(r-1,i),e.countSegment(n,i),e.isOnSegment())return e.getLocation();return e.getLocation()}if(arguments[0]instanceof ost&&arguments[1]instanceof Array){for(var o=arguments[1],s=new jst(arguments[0]),a=1;a<o.length;a++)if(s.countSegment(o[a],o[a-1]),s.isOnSegment())return s.getLocation();return s.getLocation()}};var Ust=function(){},Gst={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};Ust.prototype.interfaces_=function(){return[]},Ust.prototype.getClass=function(){return Ust},Ust.orientationIndex=function(t,e,n){return vst.orientationIndex(t,e,n)},Ust.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,i=1;i<t.length-1;i++)e+=(t[i].x-n)*(t[i-1].y-t[i+1].y);return e/2}if(cst(arguments[0],xst)){var r=arguments[0],o=r.size();if(o<3)return 0;var s=new ost,a=new ost,h=new ost;r.getCoordinate(0,a),r.getCoordinate(1,h);var l=a.x;h.x-=l;for(var u=0,c=1;c<o-1;c++)s.y=a.y,a.x=h.x,a.y=h.y,r.getCoordinate(c+1,h),h.x-=l,u+=a.x*(s.y-h.y);return u/2}},Ust.distanceLineLine=function(t,e,n,i){if(t.equals(e))return Ust.distancePointLine(t,n,i);if(n.equals(i))return Ust.distancePointLine(i,t,e);var r=!1;if(Tst.intersects(t,e,n,i)){var o=(e.x-t.x)*(i.y-n.y)-(e.y-t.y)*(i.x-n.x);if(0===o)r=!0;else{var s=((t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y))/o,a=((t.y-n.y)*(i.x-n.x)-(t.x-n.x)*(i.y-n.y))/o;(a<0||a>1||s<0||s>1)&&(r=!0)}}else r=!0;return r?Ast.min(Ust.distancePointLine(t,n,i),Ust.distancePointLine(e,n,i),Ust.distancePointLine(n,t,e),Ust.distancePointLine(i,t,e)):0},Ust.isPointInRing=function(t,e){return Ust.locatePointInRing(t,e)!==lst.EXTERIOR},Ust.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,i=new ost;t.getCoordinate(0,i);for(var r=i.x,o=i.y,s=1;s<e;s++){t.getCoordinate(s,i);var a=i.x,h=i.y,l=a-r,u=h-o;n+=Math.sqrt(l*l+u*u),r=a,o=h}return n},Ust.isCCW=function(t){var e=t.length-1;if(e<3)throw new Kot("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],i=0,r=1;r<=e;r++){var o=t[r];o.y>n.y&&(n=o,i=r)}var s=i;do{(s-=1)<0&&(s=e)}while(t[s].equals2D(n)&&s!==i);var a=i;do{a=(a+1)%e}while(t[a].equals2D(n)&&a!==i);var h=t[s],l=t[a];if(h.equals2D(n)||l.equals2D(n)||h.equals2D(l))return!1;var u=Ust.computeOrientation(h,n,l);return 0===u?h.x>l.x:u>0},Ust.locatePointInRing=function(t,e){return jst.locatePointInRing(t,e)},Ust.distancePointLinePerpendicular=function(t,e,n){var i=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y);return Math.abs(((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/i)*Math.sqrt(i)},Ust.computeOrientation=function(t,e,n){return Ust.orientationIndex(t,e,n)},Ust.distancePointLine=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(0===e.length)throw new Kot("Line array must contain at least one vertex");for(var n=t.distance(e[0]),i=0;i<e.length-1;i++){var r=Ust.distancePointLine(t,e[i],e[i+1]);r<n&&(n=r)}return n}if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];if(s.x===a.x&&s.y===a.y)return o.distance(s);var h=(a.x-s.x)*(a.x-s.x)+(a.y-s.y)*(a.y-s.y),l=((o.x-s.x)*(a.x-s.x)+(o.y-s.y)*(a.y-s.y))/h;return l<=0?o.distance(s):l>=1?o.distance(a):Math.abs(((s.y-o.y)*(a.x-s.x)-(s.x-o.x)*(a.y-s.y))/h)*Math.sqrt(h)}},Ust.isOnLine=function(t,e){for(var n=new Bst,i=1;i<e.length;i++)if(n.computeIntersection(t,e[i-1],e[i]),n.hasIntersection())return!0;return!1},Gst.CLOCKWISE.get=function(){return-1},Gst.RIGHT.get=function(){return Ust.CLOCKWISE},Gst.COUNTERCLOCKWISE.get=function(){return 1},Gst.LEFT.get=function(){return Ust.COUNTERCLOCKWISE},Gst.COLLINEAR.get=function(){return 0},Gst.STRAIGHT.get=function(){return Ust.COLLINEAR},Object.defineProperties(Ust,Gst);var Vst=function(){};Vst.prototype.filter=function(t){},Vst.prototype.interfaces_=function(){return[]},Vst.prototype.getClass=function(){return Vst};var Wst=function(){var t=arguments[0];this.Jt=null,this.Zt=null,this.Xt=null,this.$t=null,this.Zt=t,this.Xt=t.getSRID()},qst={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Wst.prototype.isGeometryCollection=function(){return this.getSortIndex()===Wst.SORTINDEX_GEOMETRYCOLLECTION},Wst.prototype.getFactory=function(){return this.Zt},Wst.prototype.getGeometryN=function(t){return this},Wst.prototype.getArea=function(){return 0},Wst.prototype.isRectangle=function(){return!1},Wst.prototype.equals=function(){if(arguments[0]instanceof Wst){var t=arguments[0];return null!==t&&this.equalsTopo(t)}if(arguments[0]instanceof Object){var e=arguments[0];return e instanceof Wst&&this.equalsExact(e)}},Wst.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)},Wst.prototype.geometryChanged=function(){this.apply(Wst.geometryChangedFilter)},Wst.prototype.geometryChangedAction=function(){this.Jt=null},Wst.prototype.equalsNorm=function(t){return null!==t&&this.norm().equalsExact(t.norm())},Wst.prototype.getLength=function(){return 0},Wst.prototype.getNumGeometries=function(){return 1},Wst.prototype.compareTo=function(){if(1===arguments.length){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}},Wst.prototype.getUserData=function(){return this.$t},Wst.prototype.getSRID=function(){return this.Xt},Wst.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},Wst.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===Wst.SORTINDEX_GEOMETRYCOLLECTION)throw new Kot("This method does not support GeometryCollection arguments")},Wst.prototype.equal=function(t,e,n){return 0===n?t.equals(e):t.distance(e)<=n},Wst.prototype.norm=function(){var t=this.copy();return t.normalize(),t},Wst.prototype.getPrecisionModel=function(){return this.Zt.getPrecisionModel()},Wst.prototype.getEnvelopeInternal=function(){return null===this.Jt&&(this.Jt=this.computeEnvelopeInternal()),new Tst(this.Jt)},Wst.prototype.setSRID=function(t){this.Xt=t},Wst.prototype.setUserData=function(t){this.$t=t},Wst.prototype.compare=function(t,e){for(var n=t.iterator(),i=e.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),o=i.next(),s=r.compareTo(o);if(0!==s)return s}return n.hasNext()?1:i.hasNext()?-1:0},Wst.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},Wst.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Wst.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Wst.SORTINDEX_MULTIPOINT||this.getSortIndex()===Wst.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Wst.SORTINDEX_MULTIPOLYGON},Wst.prototype.interfaces_=function(){return[nst,est,rst]},Wst.prototype.getClass=function(){return Wst},Wst.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1},Wst.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(null===t[e])return!0;return!1},qst.serialVersionUID.get=function(){return 0x799ea46522854c00},qst.SORTINDEX_POINT.get=function(){return 0},qst.SORTINDEX_MULTIPOINT.get=function(){return 1},qst.SORTINDEX_LINESTRING.get=function(){return 2},qst.SORTINDEX_LINEARRING.get=function(){return 3},qst.SORTINDEX_MULTILINESTRING.get=function(){return 4},qst.SORTINDEX_POLYGON.get=function(){return 5},qst.SORTINDEX_MULTIPOLYGON.get=function(){return 6},qst.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},qst.geometryChangedFilter.get=function(){return Zst},Object.defineProperties(Wst,qst);var Zst=function(){};Zst.interfaces_=function(){return[Vst]},Zst.filter=function(t){t.geometryChangedAction()};var Qst=function(){};Qst.prototype.filter=function(t){},Qst.prototype.interfaces_=function(){return[]},Qst.prototype.getClass=function(){return Qst};var Xst=function(){},Yst={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Xst.prototype.isInBoundary=function(t){},Xst.prototype.interfaces_=function(){return[]},Xst.prototype.getClass=function(){return Xst},Yst.Mod2BoundaryNodeRule.get=function(){return Jst},Yst.EndPointBoundaryNodeRule.get=function(){return Kst},Yst.MultiValentEndPointBoundaryNodeRule.get=function(){return $st},Yst.MonoValentEndPointBoundaryNodeRule.get=function(){return tat},Yst.MOD2_BOUNDARY_RULE.get=function(){return new Jst},Yst.ENDPOINT_BOUNDARY_RULE.get=function(){return new Kst},Yst.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new $st},Yst.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new tat},Yst.OGC_SFS_BOUNDARY_RULE.get=function(){return Xst.MOD2_BOUNDARY_RULE},Object.defineProperties(Xst,Yst);var Jst=function(){};Jst.prototype.isInBoundary=function(t){return t%2==1},Jst.prototype.interfaces_=function(){return[Xst]},Jst.prototype.getClass=function(){return Jst};var Kst=function(){};Kst.prototype.isInBoundary=function(t){return t>0},Kst.prototype.interfaces_=function(){return[Xst]},Kst.prototype.getClass=function(){return Kst};var $st=function(){};$st.prototype.isInBoundary=function(t){return t>1},$st.prototype.interfaces_=function(){return[Xst]},$st.prototype.getClass=function(){return $st};var tat=function(){};tat.prototype.isInBoundary=function(t){return 1===t},tat.prototype.interfaces_=function(){return[Xst]},tat.prototype.getClass=function(){return tat};var eat=function(){};function nat(t){this.message=t||""}eat.prototype.add=function(){},eat.prototype.addAll=function(){},eat.prototype.isEmpty=function(){},eat.prototype.iterator=function(){},eat.prototype.size=function(){},eat.prototype.toArray=function(){},eat.prototype.remove=function(){},(nat.prototype=new Error).name="IndexOutOfBoundsException";var iat=function(){};iat.prototype.hasNext=function(){},iat.prototype.next=function(){},iat.prototype.remove=function(){};var rat=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(eat);function oat(t){this.message=t||""}(oat.prototype=new Error).name="NoSuchElementException";var sat=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof eat&&this.addAll(arguments[0])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,eat]},e.prototype.add=function(t){return 1===arguments.length?this.array_.push(t):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.set=function(t,e){var n=this.array_[t];return this.array_[t]=e,n},e.prototype.iterator=function(){return new aat(this)},e.prototype.get=function(t){if(t<0||t>=this.size())throw new nat;return this.array_[t]},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.remove=function(t){for(var e=!1,n=0,i=this.array_.length;n<i;n++)if(this.array_[n]===t){this.array_.splice(n,1),e=!0;break}return e},e}(rat),aat=function(t){function e(e){t.call(this),this.arrayList_=e,this.position_=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new oat;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(t){return this.arrayList_.set(this.position_-1,t)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(iat),hat=function(t){function e(){if(t.call(this),0===arguments.length);else if(1===arguments.length){var e=arguments[0];this.ensureCapacity(e.length),this.add(e,!0)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.ensureCapacity(n.length),this.add(n,i)}}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(t){return this.get(t)},e.prototype.addAll=function(){if(2===arguments.length){for(var e=arguments[1],n=!1,i=arguments[0].iterator();i.hasNext();)this.add(i.next(),e),n=!0;return n}return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var e=t.prototype.clone.call(this),n=0;n<this.size();n++)e.add(n,this.get(n).copy());return e},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var e=this;if(1===arguments.length)t.prototype.add.call(this,arguments[0]);else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1],!0),!0;if(arguments[0]instanceof ost&&"boolean"==typeof arguments[1]){var n=arguments[0];if(!arguments[1]&&this.size()>=1&&this.get(this.size()-1).equals2D(n))return null;t.prototype.add.call(this,n)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1])return this.add(arguments[0],arguments[1]),!0}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var i=arguments[0],r=arguments[1];if(arguments[2])for(var o=0;o<i.length;o++)e.add(i[o],r);else for(var s=i.length-1;s>=0;s--)e.add(i[s],r);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof ost){var a=arguments[0],h=arguments[1];if(!arguments[2]){var l=this.size();if(l>0){if(a>0&&this.get(a-1).equals2D(h))return null;if(a<l&&this.get(a).equals2D(h))return null}}t.prototype.add.call(this,a,h)}}else if(4===arguments.length){var u=arguments[0],c=arguments[1],A=arguments[2],f=arguments[3],d=1;A>f&&(d=-1);for(var p=A;p!==f;p+=d)e.add(u[p],c);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new ost(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(sat),lat=function(){},uat={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};uat.ForwardComparator.get=function(){return cat},uat.BidirectionalComparator.get=function(){return Aat},uat.coordArrayType.get=function(){return new Array(0).fill(null)},lat.prototype.interfaces_=function(){return[]},lat.prototype.getClass=function(){return lat},lat.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))},lat.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var i=t[n];if(lat.indexOf(i,e)<0)return i}return null},lat.scroll=function(t,e){var n=lat.indexOf(e,t);if(n<0)return null;var i=new Array(t.length).fill(null);Pst.arraycopy(t,n,i,0,t.length-n),Pst.arraycopy(t,0,i,t.length-n,n),Pst.arraycopy(i,0,t,0,t.length)},lat.equals=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var s=0;s<i.length;s++)if(0!==o.compare(i[s],r[s]))return!1;return!0}},lat.intersection=function(t,e){for(var n=new hat,i=0;i<t.length;i++)e.intersects(t[i])&&n.add(t[i],!0);return n.toCoordinateArray()},lat.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1},lat.removeRepeatedPoints=function(t){return lat.hasRepeatedPoints(t)?new hat(t,!1).toCoordinateArray():t},lat.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),i=0;i<=n;i++){var r=t[i];t[i]=t[e-i],t[e-i]=r}},lat.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)null!==t[n]&&e++;var i=new Array(e).fill(null);if(0===e)return i;for(var r=0,o=0;o<t.length;o++)null!==t[o]&&(i[r++]=t[o]);return i},lat.copyDeep=function(){if(1===arguments.length){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new ost(t[n]);return e}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],h=0;h<a;h++)o[s+h]=new ost(i[r+h])},lat.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++)if(0!==t[n].compareTo(e[t.length-n-1]))return!1;return!0},lat.envelope=function(t){for(var e=new Tst,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e},lat.toCoordinateArray=function(t){return t.toArray(lat.coordArrayType)},lat.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]},lat.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1},lat.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t[e].compareTo(t[t.length-1-e]);if(0!==n)return n}return 1},lat.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var i=t[n].compareTo(e[n]);if(0!==i)return i;n++}return n<e.length?-1:n<t.length?1:0},lat.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(null===e||e.compareTo(t[n])>0)&&(e=t[n]);return e},lat.extract=function(t,e,n){e=Ast.clamp(e,0,t.length);var i=(n=Ast.clamp(n,-1,t.length))-e+1;n<0&&(i=0),e>=t.length&&(i=0),n<e&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var o=0,s=e;s<=n;s++)r[o++]=t[s];return r},Object.defineProperties(lat,uat);var cat=function(){};cat.prototype.compare=function(t,e){return lat.compare(t,e)},cat.prototype.interfaces_=function(){return[ist]},cat.prototype.getClass=function(){return cat};var Aat=function(){};Aat.prototype.compare=function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=lat.compare(n,i);return lat.isEqualReversed(n,i)?0:r},Aat.prototype.OLDcompare=function(t,e){var n=t,i=e;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=lat.increasingDirection(n),o=lat.increasingDirection(i),s=r>0?0:n.length-1,a=o>0?0:n.length-1,h=0;h<n.length;h++){var l=n[s].compareTo(i[a]);if(0!==l)return l;s+=r,a+=o}return 0},Aat.prototype.interfaces_=function(){return[ist]},Aat.prototype.getClass=function(){return Aat};var fat=function(){};fat.prototype.get=function(){},fat.prototype.put=function(){},fat.prototype.size=function(){},fat.prototype.values=function(){},fat.prototype.entrySet=function(){};var dat=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(fat);function pat(t){this.message=t||""}function gat(){}(pat.prototype=new Error).name="OperationNotSupported",(gat.prototype=new eat).contains=function(){};var mat=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof eat&&this.addAll(arguments[0])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(this.array_[e]===t)return!0;return!1},e.prototype.add=function(t){return!this.contains(t)&&(this.array_.push(t),!0)},e.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},e.prototype.remove=function(t){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return 0===this.array_.length},e.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},e.prototype.iterator=function(){return new yat(this)},e}(gat),yat=function(t){function e(e){t.call(this),this.hashSet_=e,this.position_=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new oat;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new pat},e}(iat);function vat(t){return null===t?0:t.color}function _at(t){return null===t?null:t.parent}function xat(t,e){null!==t&&(t.color=e)}function bat(t){return null===t?null:t.left}function wat(t){return null===t?null:t.right}function Cat(){this.root_=null,this.size_=0}(Cat.prototype=new dat).get=function(t){for(var e=this.root_;null!==e;){var n=t.compareTo(e.key);if(n<0)e=e.left;else{if(!(n>0))return e.value;e=e.right}}return null},Cat.prototype.put=function(t,e){if(null===this.root_)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,(i=t.compareTo(r.key))<0)r=r.left;else{if(!(i>0)){var o=r.value;return r.value=e,o}r=r.right}}while(null!==r);var s={key:t,left:null,right:null,value:e,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null},Cat.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=1;null!=t&&t!==this.root_&&1===t.parent.color;)if(_at(t)===bat(_at(_at(t)))){var n=wat(_at(_at(t)));1===vat(n)?(xat(_at(t),0),xat(n,0),xat(_at(_at(t)),1),t=_at(_at(t))):(t===wat(_at(t))&&(t=_at(t),e.rotateLeft(t)),xat(_at(t),0),xat(_at(_at(t)),1),e.rotateRight(_at(_at(t))))}else{var i=bat(_at(_at(t)));1===vat(i)?(xat(_at(t),0),xat(i,0),xat(_at(_at(t)),1),t=_at(_at(t))):(t===bat(_at(t))&&(t=_at(t),e.rotateRight(t)),xat(_at(t),0),xat(_at(_at(t)),1),e.rotateLeft(_at(_at(t))))}this.root_.color=0},Cat.prototype.values=function(){var t=new sat,e=this.getFirstEntry();if(null!==e)for(t.add(e.value);null!==(e=Cat.successor(e));)t.add(e.value);return t},Cat.prototype.entrySet=function(){var t=new mat,e=this.getFirstEntry();if(null!==e)for(t.add(e);null!==(e=Cat.successor(e));)t.add(e);return t},Cat.prototype.rotateLeft=function(t){if(null!=t){var e=t.right;t.right=e.left,null!=e.left&&(e.left.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}},Cat.prototype.rotateRight=function(t){if(null!=t){var e=t.left;t.left=e.right,null!=e.right&&(e.right.parent=t),e.parent=t.parent,null===t.parent?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}},Cat.prototype.getFirstEntry=function(){var t=this.root_;if(null!=t)for(;null!=t.left;)t=t.left;return t},Cat.successor=function(t){if(null===t)return null;if(null!==t.right){for(var e=t.right;null!==e.left;)e=e.left;return e}for(var n=t.parent,i=t;null!==n&&i===n.right;)i=n,n=n.parent;return n},Cat.prototype.size=function(){return this.size_};var Pat=function(){};function Mat(){}function Tat(){this.array_=[],arguments[0]instanceof eat&&this.addAll(arguments[0])}Pat.prototype.interfaces_=function(){return[]},Pat.prototype.getClass=function(){return Pat},Mat.prototype=new gat,(Tat.prototype=new Mat).contains=function(t){for(var e=0,n=this.array_.length;e<n;e++)if(0===this.array_[e].compareTo(t))return!0;return!1},Tat.prototype.add=function(t){if(this.contains(t))return!1;for(var e=0,n=this.array_.length;e<n;e++)if(1===this.array_[e].compareTo(t))return this.array_.splice(e,0,t),!0;return this.array_.push(t),!0},Tat.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next());return!0},Tat.prototype.remove=function(t){throw new pat},Tat.prototype.size=function(){return this.array_.length},Tat.prototype.isEmpty=function(){return 0===this.array_.length},Tat.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t},Tat.prototype.iterator=function(){return new Sat(this)};var Sat=function(t){this.treeSet_=t,this.position_=0};Sat.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new oat;return this.treeSet_.array_[this.position_++]},Sat.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Sat.prototype.remove=function(){throw new pat};var Iat=function(){};Iat.sort=function(){var t,e,n,i,r=arguments[0];if(1===arguments.length)i=function(t,e){return t.compareTo(e)},r.sort(i);else if(2===arguments.length)n=arguments[1],i=function(t,e){return n.compare(t,e)},r.sort(i);else if(3===arguments.length){(e=r.slice(arguments[1],arguments[2])).sort();var o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length));for(r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t])}else if(4===arguments.length)for(e=r.slice(arguments[1],arguments[2]),n=arguments[3],i=function(t,e){return n.compare(t,e)},e.sort(i),o=r.slice(0,arguments[1]).concat(e,r.slice(arguments[2],r.length)),r.splice(0,r.length),t=0;t<o.length;t++)r.push(o[t])},Iat.asList=function(t){for(var e=new sat,n=0,i=t.length;n<i;n++)e.add(t[n]);return e};var Eat=function(){},Oat={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Oat.P.get=function(){return 0},Oat.L.get=function(){return 1},Oat.A.get=function(){return 2},Oat.FALSE.get=function(){return-1},Oat.TRUE.get=function(){return-2},Oat.DONTCARE.get=function(){return-3},Oat.SYM_FALSE.get=function(){return"F"},Oat.SYM_TRUE.get=function(){return"T"},Oat.SYM_DONTCARE.get=function(){return"*"},Oat.SYM_P.get=function(){return"0"},Oat.SYM_L.get=function(){return"1"},Oat.SYM_A.get=function(){return"2"},Eat.prototype.interfaces_=function(){return[]},Eat.prototype.getClass=function(){return Eat},Eat.toDimensionSymbol=function(t){switch(t){case Eat.FALSE:return Eat.SYM_FALSE;case Eat.TRUE:return Eat.SYM_TRUE;case Eat.DONTCARE:return Eat.SYM_DONTCARE;case Eat.P:return Eat.SYM_P;case Eat.L:return Eat.SYM_L;case Eat.A:return Eat.SYM_A}throw new Kot("Unknown dimension value: "+t)},Eat.toDimensionValue=function(t){switch(gst.toUpperCase(t)){case Eat.SYM_FALSE:return Eat.FALSE;case Eat.SYM_TRUE:return Eat.TRUE;case Eat.SYM_DONTCARE:return Eat.DONTCARE;case Eat.SYM_P:return Eat.P;case Eat.SYM_L:return Eat.L;case Eat.SYM_A:return Eat.A}throw new Kot("Unknown dimension symbol: "+t)},Object.defineProperties(Eat,Oat);var Rat=function(){};Rat.prototype.filter=function(t){},Rat.prototype.interfaces_=function(){return[]},Rat.prototype.getClass=function(){return Rat};var Dat=function(){};Dat.prototype.filter=function(t,e){},Dat.prototype.isDone=function(){},Dat.prototype.isGeometryChanged=function(){},Dat.prototype.interfaces_=function(){return[]},Dat.prototype.getClass=function(){return Dat};var kat=function(t){function e(e,n){if(t.call(this,n),this.Nt=e||[],t.hasNullElements(this.Nt))throw new Kot("geometries must not contain null elements")}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var t=new Tst,e=0;e<this.Nt.length;e++)t.expandToInclude(this.Nt[e].getEnvelopeInternal());return t},e.prototype.getGeometryN=function(t){return this.Nt[t]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=0;n<this.Nt.length;n++)for(var i=this.Nt[n].getCoordinates(),r=0;r<i.length;r++)t[++e]=i[r];return t},e.prototype.getArea=function(){for(var t=0,e=0;e<this.Nt.length;e++)t+=this.Nt[e].getArea();return t},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e;if(this.Nt.length!==i.Nt.length)return!1;for(var r=0;r<this.Nt.length;r++)if(!this.Nt[r].equalsExact(i.Nt[r],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=0;t<this.Nt.length;t++)this.Nt[t].normalize();Iat.sort(this.Nt)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this.Nt[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var t=Eat.FALSE,e=0;e<this.Nt.length;e++)t=Math.max(t,this.Nt[e].getBoundaryDimension());return t},e.prototype.getDimension=function(){for(var t=Eat.FALSE,e=0;e<this.Nt.length;e++)t=Math.max(t,this.Nt[e].getDimension());return t},e.prototype.getLength=function(){for(var t=0,e=0;e<this.Nt.length;e++)t+=this.Nt[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=0,e=0;e<this.Nt.length;e++)t+=this.Nt[e].getNumPoints();return t},e.prototype.getNumGeometries=function(){return this.Nt.length},e.prototype.reverse=function(){for(var t=new Array(this.Nt.length).fill(null),e=0;e<this.Nt.length;e++)t[e]=this.Nt[e].reverse();return this.getFactory().createGeometryCollection(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0],e=new Tat(Iat.asList(this.Nt)),n=new Tat(Iat.asList(t.Nt));return this.compare(e,n)}if(2===arguments.length){for(var i=arguments[1],r=arguments[0],o=this.getNumGeometries(),s=r.getNumGeometries(),a=0;a<o&&a<s;){var h=this.getGeometryN(a),l=r.getGeometryN(a),u=h.compareToSameClass(l,i);if(0!==u)return u;a++}return a<o?1:a<s?-1:0}},e.prototype.apply=function(){var t=this;if(cst(arguments[0],Qst))for(var e=arguments[0],n=0;n<this.Nt.length;n++)t.Nt[n].apply(e);else if(cst(arguments[0],Dat)){var i=arguments[0];if(0===this.Nt.length)return null;for(var r=0;r<this.Nt.length&&(t.Nt[r].apply(i),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(cst(arguments[0],Rat)){var o=arguments[0];o.filter(this);for(var s=0;s<this.Nt.length;s++)t.Nt[s].apply(o)}else if(cst(arguments[0],Vst)){var a=arguments[0];a.filter(this);for(var h=0;h<this.Nt.length;h++)t.Nt[h].apply(a)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),Fst.shouldNeverReachHere(),null},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e.Nt=new Array(this.Nt.length).fill(null);for(var n=0;n<this.Nt.length;n++)e.Nt[n]=this.Nt[n].clone();return e},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var t=new Array(this.Nt.length).fill(null),n=0;n<t.length;n++)t[n]=this.Nt[n].copy();return new e(t,this.Zt)},e.prototype.isEmpty=function(){for(var t=0;t<this.Nt.length;t++)if(!this.Nt[t].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(e,n),e}(Wst),Lat=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Wst.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Eat.FALSE:0},e.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var t=0;t<this.Nt.length;t++)if(!this.Nt[t].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var t=this.Nt.length,e=new Array(t).fill(null),n=0;n<this.Nt.length;n++)e[t-1-n]=this.Nt[n].reverse();return this.getFactory().createMultiLineString(e)},e.prototype.getBoundary=function(){return new Fat(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var t=new Array(this.Nt.length).fill(null),n=0;n<t.length;n++)t[n]=this.Nt[n].copy();return new e(t,this.Zt)},e.prototype.interfaces_=function(){return[Pat]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(e,n),e}(kat),Fat=function(){if(this.An=null,this.tn=null,this.nn=null,this.rn=null,1===arguments.length){var t=arguments[0],e=Xst.MOD2_BOUNDARY_RULE;this.An=t,this.tn=t.getFactory(),this.nn=e}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.An=n,this.tn=n.getFactory(),this.nn=i}};Fat.prototype.boundaryMultiLineString=function(t){if(this.An.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return 1===e.length?this.tn.createPoint(e[0]):this.tn.createMultiPointFromCoords(e)},Fat.prototype.getBoundary=function(){return this.An instanceof Zat?this.boundaryLineString(this.An):this.An instanceof Lat?this.boundaryMultiLineString(this.An):this.An.getBoundary()},Fat.prototype.boundaryLineString=function(t){return this.An.isEmpty()?this.getEmptyMultiPoint():t.isClosed()?this.nn.isInBoundary(2)?t.getStartPoint():this.tn.createMultiPoint():this.tn.createMultiPoint([t.getStartPoint(),t.getEndPoint()])},Fat.prototype.getEmptyMultiPoint=function(){return this.tn.createMultiPoint()},Fat.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new sat;this.rn=new Cat;for(var i=0;i<t.getNumGeometries();i++){var r=t.getGeometryN(i);0!==r.getNumPoints()&&(e.addEndpoint(r.getCoordinateN(0)),e.addEndpoint(r.getCoordinateN(r.getNumPoints()-1)))}for(var o=this.rn.entrySet().iterator();o.hasNext();){var s=o.next(),a=s.getValue().count;e.nn.isInBoundary(a)&&n.add(s.getKey())}return lat.toCoordinateArray(n)},Fat.prototype.addEndpoint=function(t){var e=this.rn.get(t);null===e&&(e=new Nat,this.rn.put(t,e)),e.count++},Fat.prototype.interfaces_=function(){return[]},Fat.prototype.getClass=function(){return Fat},Fat.getBoundary=function(){return 1===arguments.length?new Fat(arguments[0]).getBoundary():2===arguments.length?new Fat(arguments[0],arguments[1]).getBoundary():void 0};var Nat=function(){this.count=null};function zat(){}function Bat(){}Nat.prototype.interfaces_=function(){return[]},Nat.prototype.getClass=function(){return Nat};var Hat=function(){};function jat(){}function Uat(){}function Gat(){}var Vat=function(){},Wat={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Vat.prototype.interfaces_=function(){return[]},Vat.prototype.getClass=function(){return Vat},Vat.chars=function(t,e){for(var n=new Array(e).fill(null),i=0;i<e;i++)n[i]=t;return String(n)},Vat.getStackTrace=function(){if(1===arguments.length){var t=arguments[0],e=new jat,n=new zat;return t.printStackTrace(n),e.toString()}if(2===arguments.length){var i=arguments[1],r="";new Bat(Vat.getStackTrace(arguments[0]));for(var o=new Gat,s=0;s<i;s++)try{r+=o.readLine()+Vat.NEWLINE}catch(a){if(!(a instanceof Uat))throw a;Fst.shouldNeverReachHere()}return r}},Vat.split=function(t,e){for(var n=e.length,i=new sat,r=""+t,o=r.indexOf(e);o>=0;){var s=r.substring(0,o);i.add(s),o=(r=r.substring(o+n)).indexOf(e)}r.length>0&&i.add(r);for(var a=new Array(i.size()).fill(null),h=0;h<a.length;h++)a[h]=i.get(h);return a},Vat.toString=function(){if(1===arguments.length)return Vat.SIMPLE_ORDINATE_FORMAT.format(arguments[0])},Vat.spaces=function(t){return Vat.chars(" ",t)},Wat.NEWLINE.get=function(){return Pst.getProperty("line.separator")},Wat.SIMPLE_ORDINATE_FORMAT.get=function(){return new Hat},Object.defineProperties(Vat,Wat);var qat=function(){};qat.prototype.interfaces_=function(){return[]},qat.prototype.getClass=function(){return qat},qat.copyCoord=function(t,e,n,i){for(var r=Math.min(t.getDimension(),n.getDimension()),o=0;o<r;o++)n.setOrdinate(i,o,t.getOrdinate(e,o))},qat.isRing=function(t){var e=t.size();return 0===e||!(e<=3)&&t.getOrdinate(0,xst.X)===t.getOrdinate(e-1,xst.X)&&t.getOrdinate(0,xst.Y)===t.getOrdinate(e-1,xst.Y)},qat.isEqual=function(t,e){var n=t.size();if(n!==e.size())return!1;for(var i=Math.min(t.getDimension(),e.getDimension()),r=0;r<n;r++)for(var o=0;o<i;o++){var s=t.getOrdinate(r,o),a=e.getOrdinate(r,o);if(!(t.getOrdinate(r,o)===e.getOrdinate(r,o)||$ot.isNaN(s)&&$ot.isNaN(a)))return!1}return!0},qat.extend=function(t,e,n){var i=t.create(n,e.getDimension()),r=e.size();if(qat.copy(e,0,i,0,r),r>0)for(var o=r;o<n;o++)qat.copy(e,r-1,i,o,1);return i},qat.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),i=0;i<=n;i++)qat.swap(t,i,e-i)},qat.swap=function(t,e,n){if(e===n)return null;for(var i=0;i<t.getDimension();i++){var r=t.getOrdinate(e,i);t.setOrdinate(e,i,t.getOrdinate(n,i)),t.setOrdinate(n,i,r)}},qat.copy=function(t,e,n,i,r){for(var o=0;o<r;o++)qat.copyCoord(t,e+o,n,i+o)},qat.toString=function(){if(1===arguments.length){var t=arguments[0],e=t.size();if(0===e)return"()";var n=t.getDimension(),i=new dst;i.append("(");for(var r=0;r<e;r++){r>0&&i.append(" ");for(var o=0;o<n;o++)o>0&&i.append(","),i.append(Vat.toString(t.getOrdinate(r,o)))}return i.append(")"),i.toString()}},qat.ensureValidRing=function(t,e){var n=e.size();return 0===n?e:n<=3?qat.createClosedRing(t,e,4):e.getOrdinate(0,xst.X)===e.getOrdinate(n-1,xst.X)&&e.getOrdinate(0,xst.Y)===e.getOrdinate(n-1,xst.Y)?e:qat.createClosedRing(t,e,n+1)},qat.createClosedRing=function(t,e,n){var i=t.create(n,e.getDimension()),r=e.size();qat.copy(e,0,i,0,r);for(var o=r;o<n;o++)qat.copy(e,0,i,o,1);return i};var Zat=function(t){function e(e,n){t.call(this,n),this.jt=null,this.init(e)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Tst:this.jt.expandEnvelope(new Tst)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this.jt.toCoordinateArray()},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e;if(this.jt.size()!==i.jt.size())return!1;for(var r=0;r<this.jt.size();r++)if(!this.equal(this.jt.getCoordinate(r),i.jt.getCoordinate(r),n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var t=this,e=0;e<Math.trunc(this.jt.size()/2);e++){var n=t.jt.size()-1-e;if(!t.jt.getCoordinate(e).equals(t.jt.getCoordinate(n)))return t.jt.getCoordinate(e).compareTo(t.jt.getCoordinate(n))>0&&qat.reverse(t.jt),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this.jt.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Eat.FALSE:0},e.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return Ust.computeLength(this.jt)},e.prototype.getNumPoints=function(){return this.jt.size()},e.prototype.reverse=function(){var t=this.jt.copy();return qat.reverse(t),this.getFactory().createLineString(t)},e.prototype.compareToSameClass=function(){if(1===arguments.length){for(var t=arguments[0],e=0,n=0;e<this.jt.size()&&n<t.jt.size();){var i=this.jt.getCoordinate(e).compareTo(t.jt.getCoordinate(n));if(0!==i)return i;e++,n++}return e<this.jt.size()?1:n<t.jt.size()?-1:0}if(2===arguments.length)return arguments[1].compare(this.jt,arguments[0].jt)},e.prototype.apply=function(){if(cst(arguments[0],Qst))for(var t=arguments[0],e=0;e<this.jt.size();e++)t.filter(this.jt.getCoordinate(e));else if(cst(arguments[0],Dat)){var n=arguments[0];if(0===this.jt.size())return null;for(var i=0;i<this.jt.size()&&(n.filter(this.jt,i),!n.isDone());i++);n.isGeometryChanged()&&this.geometryChanged()}else(cst(arguments[0],Rat)||cst(arguments[0],Vst))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return new Fat(this).getBoundary()},e.prototype.isEquivalentClass=function(t){return t instanceof e},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e.jt=this.jt.clone(),e},e.prototype.getCoordinateN=function(t){return this.jt.getCoordinate(t)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this.jt.copy(),this.Zt)},e.prototype.getCoordinateSequence=function(){return this.jt},e.prototype.isEmpty=function(){return 0===this.jt.size()},e.prototype.init=function(t){if(null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),1===t.size())throw new Kot("Invalid number of points in LineString (found "+t.size()+" - must be 0 or >= 2)");this.jt=t},e.prototype.isCoordinate=function(t){for(var e=0;e<this.jt.size();e++)if(this.jt.getCoordinate(e).equals(t))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(t){return this.getFactory().createPoint(this.jt.getCoordinate(t))},e.prototype.interfaces_=function(){return[Pat]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(Wst),Qat=function(){};Qat.prototype.interfaces_=function(){return[]},Qat.prototype.getClass=function(){return Qat};var Xat=function(t){function e(e,n){t.call(this,n),this.Et=e||null,this.init(this.Et)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Tst;var t=new Tst;return t.expandToInclude(this.Et.getX(0),this.Et.getY(0)),t},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&(!(!this.isEmpty()||!e.isEmpty())||this.isEmpty()===e.isEmpty()&&this.equal(e.getCoordinate(),this.getCoordinate(),n))}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return 0!==this.Et.size()?this.Et.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Eat.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(1===arguments.length){var t=arguments[0];return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length)return arguments[1].compare(this.Et,arguments[0].Et)},e.prototype.apply=function(){if(cst(arguments[0],Qst)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.getCoordinate())}else if(cst(arguments[0],Dat)){var e=arguments[0];if(this.isEmpty())return null;e.filter(this.Et,0),e.isGeometryChanged()&&this.geometryChanged()}else(cst(arguments[0],Rat)||cst(arguments[0],Vst))&&arguments[0].filter(this)},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);return e.Et=this.Et.clone(),e},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this.Et.copy(),this.Zt)},e.prototype.getCoordinateSequence=function(){return this.Et},e.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return 0===this.Et.size()},e.prototype.init=function(t){null===t&&(t=this.getFactory().getCoordinateSequenceFactory().create([])),Fst.isTrue(t.size()<=1),this.Et=t},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Qat]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(e,n),e}(Wst),Yat=function(){};Yat.prototype.interfaces_=function(){return[]},Yat.prototype.getClass=function(){return Yat};var Jat=function(t){function e(e,n,i){if(t.call(this,i),this.Qt=null,this.St=null,null===e&&(e=this.getFactory().createLinearRing()),null===n&&(n=[]),t.hasNullElements(n))throw new Kot("holes must not contain null elements");if(e.isEmpty()&&t.hasNonEmptyElements(n))throw new Kot("shell is empty but holes are not");this.Qt=e,this.St=n}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.Qt.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var t=new Array(this.getNumPoints()).fill(null),e=-1,n=this.Qt.getCoordinates(),i=0;i<n.length;i++)t[++e]=n[i];for(var r=0;r<this.St.length;r++)for(var o=this.St[r].getCoordinates(),s=0;s<o.length;s++)t[++e]=o[s];return t},e.prototype.getArea=function(){var t=0;t+=Math.abs(Ust.signedArea(this.Qt.getCoordinateSequence()));for(var e=0;e<this.St.length;e++)t-=Math.abs(Ust.signedArea(this.St[e].getCoordinateSequence()));return t},e.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this.Qt)return!1;if(5!==this.Qt.getNumPoints())return!1;for(var t=this.Qt.getCoordinateSequence(),e=this.getEnvelopeInternal(),n=0;n<5;n++){var i=t.getX(n);if(i!==e.getMinX()&&i!==e.getMaxX())return!1;var r=t.getY(n);if(r!==e.getMinY()&&r!==e.getMaxY())return!1}for(var o=t.getX(0),s=t.getY(0),a=1;a<=4;a++){var h=t.getX(a),l=t.getY(a);if(h!==o==(l!==s))return!1;o=h,s=l}return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];if(!this.isEquivalentClass(e))return!1;var i=e;if(!this.Qt.equalsExact(i.Qt,n))return!1;if(this.St.length!==i.St.length)return!1;for(var r=0;r<this.St.length;r++)if(!this.St[r].equalsExact(i.St[r],n))return!1;return!0}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){if(0===arguments.length){this.normalize(this.Qt,!0);for(var t=0;t<this.St.length;t++)this.normalize(this.St[t],!1);Iat.sort(this.St)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(e.isEmpty())return null;var i=new Array(e.getCoordinates().length-1).fill(null);Pst.arraycopy(e.getCoordinates(),0,i,0,i.length);var r=lat.minCoordinate(e.getCoordinates());lat.scroll(i,r),Pst.arraycopy(i,0,e.getCoordinates(),0,i.length),e.getCoordinates()[i.length]=i[0],Ust.isCCW(e.getCoordinates())===n&&lat.reverse(e.getCoordinates())}},e.prototype.getCoordinate=function(){return this.Qt.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this.St.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var t=0;t+=this.Qt.getLength();for(var e=0;e<this.St.length;e++)t+=this.St[e].getLength();return t},e.prototype.getNumPoints=function(){for(var t=this.Qt.getNumPoints(),e=0;e<this.St.length;e++)t+=this.St[e].getNumPoints();return t},e.prototype.reverse=function(){var t=this.copy();t.Qt=this.Qt.copy().reverse(),t.St=new Array(this.St.length).fill(null);for(var e=0;e<this.St.length;e++)t.St[e]=this.St[e].copy().reverse();return t},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){if(1===arguments.length)return this.Qt.compareToSameClass(arguments[0].Qt);if(2===arguments.length){var t=arguments[1],e=arguments[0],n=this.Qt.compareToSameClass(e.Qt,t);if(0!==n)return n;for(var i=this.getNumInteriorRing(),r=e.getNumInteriorRing(),o=0;o<i&&o<r;){var s=this.getInteriorRingN(o),a=e.getInteriorRingN(o),h=s.compareToSameClass(a,t);if(0!==h)return h;o++}return o<i?1:o<r?-1:0}},e.prototype.apply=function(t){var e=this;if(cst(t,Qst)){this.Qt.apply(t);for(var n=0;n<this.St.length;n++)e.St[n].apply(t)}else if(cst(t,Dat)){if(this.Qt.apply(t),!t.isDone())for(var i=0;i<this.St.length&&(e.St[i].apply(t),!t.isDone());i++);t.isGeometryChanged()&&this.geometryChanged()}else if(cst(t,Rat))t.filter(this);else if(cst(t,Vst)){t.filter(this),this.Qt.apply(t);for(var r=0;r<this.St.length;r++)e.St[r].apply(t)}},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var t=new Array(this.St.length+1).fill(null);t[0]=this.Qt;for(var e=0;e<this.St.length;e++)t[e+1]=this.St[e];return t.length<=1?this.getFactory().createLinearRing(t[0].getCoordinateSequence()):this.getFactory().createMultiLineString(t)},e.prototype.clone=function(){var e=t.prototype.clone.call(this);e.Qt=this.Qt.clone(),e.St=new Array(this.St.length).fill(null);for(var n=0;n<this.St.length;n++)e.St[n]=this.St[n].clone();return e},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var t=this.Qt.copy(),n=new Array(this.St.length).fill(null),i=0;i<n.length;i++)n[i]=this.St[i].copy();return new e(t,n,this.Zt)},e.prototype.getExteriorRing=function(){return this.Qt},e.prototype.isEmpty=function(){return this.Qt.isEmpty()},e.prototype.getInteriorRingN=function(t){return this.St[t]},e.prototype.interfaces_=function(){return[Yat]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(Wst),Kat=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Wst.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){return 1===arguments.length?this.Nt[arguments[0]].getCoordinate():t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Eat.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var t=new Array(this.Nt.length).fill(null),n=0;n<t.length;n++)t[n]=this.Nt[n].copy();return new e(t,this.Zt)},e.prototype.interfaces_=function(){return[Qat]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(e,n),e}(kat),$at=function(t){function e(e,n){e instanceof ost&&n instanceof pht&&(e=n.getCoordinateSequenceFactory().create(e)),t.call(this,e,n),this.validateConstruction()}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Wst.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Eat.FALSE},e.prototype.isClosed=function(){return!!this.isEmpty()||t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var t=this.jt.copy();return qat.reverse(t),this.getFactory().createLinearRing(t)},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new Kot("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new Kot("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this.jt.copy(),this.Zt)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(Zat),tht=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Wst.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(2===arguments.length){var e=arguments[0],n=arguments[1];return!!this.isEquivalentClass(e)&&t.prototype.equalsExact.call(this,e,n)}return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var t=new Array(this.Nt.length).fill(null),e=0;e<this.Nt.length;e++)t[e]=this.Nt[e].reverse();return this.getFactory().createMultiPolygon(t)},e.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var t=new sat,e=0;e<this.Nt.length;e++)for(var n=this.Nt[e].getBoundary(),i=0;i<n.getNumGeometries();i++)t.add(n.getGeometryN(i));var r=new Array(t.size()).fill(null);return this.getFactory().createMultiLineString(t.toArray(r))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var t=new Array(this.Nt.length).fill(null),n=0;n<t.length;n++)t[n]=this.Nt[n].copy();return new e(t,this.Zt)},e.prototype.interfaces_=function(){return[Yat]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(kat),eht=function(t){this.Zt=t||null,this.en=!1},nht={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};eht.prototype.setCopyUserData=function(t){this.en=t},eht.prototype.edit=function(t,e){if(null===t)return null;var n=this.editInternal(t,e);return this.en&&n.setUserData(t.getUserData()),n},eht.prototype.editInternal=function(t,e){return null===this.Zt&&(this.Zt=t.getFactory()),t instanceof kat?this.editGeometryCollection(t,e):t instanceof Jat?this.editPolygon(t,e):t instanceof Xat||t instanceof Zat?e.edit(t,this.Zt):(Fst.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)},eht.prototype.editGeometryCollection=function(t,e){for(var n=e.edit(t,this.Zt),i=new sat,r=0;r<n.getNumGeometries();r++){var o=this.edit(n.getGeometryN(r),e);null===o||o.isEmpty()||i.add(o)}return n.getClass()===Kat?this.Zt.createMultiPoint(i.toArray([])):n.getClass()===Lat?this.Zt.createMultiLineString(i.toArray([])):n.getClass()===tht?this.Zt.createMultiPolygon(i.toArray([])):this.Zt.createGeometryCollection(i.toArray([]))},eht.prototype.editPolygon=function(t,e){var n=e.edit(t,this.Zt);if(null===n&&(n=this.Zt.createPolygon(null)),n.isEmpty())return n;var i=this.edit(n.getExteriorRing(),e);if(null===i||i.isEmpty())return this.Zt.createPolygon();for(var r=new sat,o=0;o<n.getNumInteriorRing();o++){var s=this.edit(n.getInteriorRingN(o),e);null===s||s.isEmpty()||r.add(s)}return this.Zt.createPolygon(i,r.toArray([]))},eht.prototype.interfaces_=function(){return[]},eht.prototype.getClass=function(){return eht},eht.GeometryEditorOperation=function(){},nht.NoOpGeometryOperation.get=function(){return iht},nht.CoordinateOperation.get=function(){return rht},nht.CoordinateSequenceOperation.get=function(){return oht},Object.defineProperties(eht,nht);var iht=function(){};iht.prototype.edit=function(t,e){return t},iht.prototype.interfaces_=function(){return[eht.GeometryEditorOperation]},iht.prototype.getClass=function(){return iht};var rht=function(){};rht.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return null===n?t:t instanceof $at?e.createLinearRing(n):t instanceof Zat?e.createLineString(n):t instanceof Xat?n.length>0?e.createPoint(n[0]):e.createPoint():t},rht.prototype.interfaces_=function(){return[eht.GeometryEditorOperation]},rht.prototype.getClass=function(){return rht};var oht=function(){};oht.prototype.edit=function(t,e){return t instanceof $at?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Zat?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Xat?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t},oht.prototype.interfaces_=function(){return[eht.GeometryEditorOperation]},oht.prototype.getClass=function(){return oht};var sht=function(){var t=this;if(this.sn=3,this.Et=null,1===arguments.length){if(arguments[0]instanceof Array)this.Et=arguments[0],this.sn=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this.Et=new Array(e).fill(null);for(var n=0;n<e;n++)t.Et[n]=new ost}else if(cst(arguments[0],xst)){var i=arguments[0];if(null===i)return this.Et=new Array(0).fill(null),null;this.sn=i.getDimension(),this.Et=new Array(i.size()).fill(null);for(var r=0;r<this.Et.length;r++)t.Et[r]=i.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var o=arguments[0],s=arguments[1];this.Et=o,this.sn=s,null===o&&(this.Et=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var a=arguments[0],h=arguments[1];this.Et=new Array(a).fill(null),this.sn=h;for(var l=0;l<a;l++)t.Et[l]=new ost}},aht={serialVersionUID:{configurable:!0}};sht.prototype.setOrdinate=function(t,e,n){switch(e){case xst.X:this.Et[t].x=n;break;case xst.Y:this.Et[t].y=n;break;case xst.Z:this.Et[t].z=n;break;default:throw new Kot("invalid ordinateIndex")}},sht.prototype.size=function(){return this.Et.length},sht.prototype.getOrdinate=function(t,e){switch(e){case xst.X:return this.Et[t].x;case xst.Y:return this.Et[t].y;case xst.Z:return this.Et[t].z}return $ot.NaN},sht.prototype.getCoordinate=function(){if(1===arguments.length)return this.Et[arguments[0]];if(2===arguments.length){var t=arguments[0],e=arguments[1];e.x=this.Et[t].x,e.y=this.Et[t].y,e.z=this.Et[t].z}},sht.prototype.getCoordinateCopy=function(t){return new ost(this.Et[t])},sht.prototype.getDimension=function(){return this.sn},sht.prototype.getX=function(t){return this.Et[t].x},sht.prototype.clone=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this.Et.length;e++)t[e]=this.Et[e].clone();return new sht(t,this.sn)},sht.prototype.expandEnvelope=function(t){for(var e=0;e<this.Et.length;e++)t.expandToInclude(this.Et[e]);return t},sht.prototype.copy=function(){for(var t=new Array(this.size()).fill(null),e=0;e<this.Et.length;e++)t[e]=this.Et[e].copy();return new sht(t,this.sn)},sht.prototype.toString=function(){if(this.Et.length>0){var t=new dst(17*this.Et.length);t.append("("),t.append(this.Et[0]);for(var e=1;e<this.Et.length;e++)t.append(", "),t.append(this.Et[e]);return t.append(")"),t.toString()}return"()"},sht.prototype.getY=function(t){return this.Et[t].y},sht.prototype.toCoordinateArray=function(){return this.Et},sht.prototype.interfaces_=function(){return[xst,rst]},sht.prototype.getClass=function(){return sht},aht.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(sht,aht);var hht=function(){},lht={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};hht.prototype.readResolve=function(){return hht.instance()},hht.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array)return new sht(arguments[0]);if(cst(arguments[0],xst))return new sht(arguments[0])}else if(2===arguments.length){var t=arguments[0],e=arguments[1];return e>3&&(e=3),e<2?new sht(t):new sht(t,e)}},hht.prototype.interfaces_=function(){return[hst,rst]},hht.prototype.getClass=function(){return hht},hht.instance=function(){return hht.instanceObject},lht.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},lht.instanceObject.get=function(){return new hht},Object.defineProperties(hht,lht);var uht=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return this.map_.get(t)||null},e.prototype.put=function(t,e){return this.map_.set(t,e),e},e.prototype.values=function(){for(var t=new sat,e=this.map_.values(),n=e.next();!n.done;)t.add(n.value),n=e.next();return t},e.prototype.entrySet=function(){var t=new mat;return this.map_.entries().forEach((function(e){return t.add(e)})),t},e.prototype.size=function(){return this.map_.size()},e}(fat),cht=function t(){if(this.un=null,this.xA=null,0===arguments.length)this.un=t.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof fht){var e=arguments[0];this.un=e,e===t.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this.un=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var i=arguments[0];this.un=i.un,this.xA=i.xA}},Aht={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};cht.prototype.equals=function(t){return t instanceof cht&&this.un===t.un&&this.xA===t.xA},cht.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),i=e.getMaximumSignificantDigits();return new pst(n).compareTo(new pst(i))},cht.prototype.getScale=function(){return this.xA},cht.prototype.isFloating=function(){return this.un===cht.FLOATING||this.un===cht.FLOATING_SINGLE},cht.prototype.getType=function(){return this.un},cht.prototype.toString=function(){var t="UNKNOWN";return this.un===cht.FLOATING?t="Floating":this.un===cht.FLOATING_SINGLE?t="Floating-Single":this.un===cht.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t},cht.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var t=arguments[0];return $ot.isNaN(t)||this.un===cht.FLOATING_SINGLE?t:this.un===cht.FIXED?Math.round(t*this.xA)/this.xA:t}if(arguments[0]instanceof ost){var e=arguments[0];if(this.un===cht.FLOATING)return null;e.x=this.makePrecise(e.x),e.y=this.makePrecise(e.y)}},cht.prototype.getMaximumSignificantDigits=function(){var t=16;return this.un===cht.FLOATING?t=16:this.un===cht.FLOATING_SINGLE?t=6:this.un===cht.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t},cht.prototype.setScale=function(t){this.xA=Math.abs(t)},cht.prototype.interfaces_=function(){return[rst,est]},cht.prototype.getClass=function(){return cht},cht.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e},Aht.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Aht.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(cht,Aht);var fht=function t(e){this.hn=e||null,t.nameToTypeMap.put(e,this)},dht={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};fht.prototype.readResolve=function(){return fht.nameToTypeMap.get(this.hn)},fht.prototype.toString=function(){return this.hn},fht.prototype.interfaces_=function(){return[rst]},fht.prototype.getClass=function(){return fht},dht.serialVersionUID.get=function(){return-552860263173159e4},dht.nameToTypeMap.get=function(){return new uht},Object.defineProperties(fht,dht),cht.Type=fht,cht.FIXED=new fht("FIXED"),cht.FLOATING=new fht("FLOATING"),cht.FLOATING_SINGLE=new fht("FLOATING SINGLE");var pht=function t(){this.Wt=new cht,this.Xt=0,this.cn=t.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?cst(arguments[0],hst)?this.cn=arguments[0]:arguments[0]instanceof cht&&(this.Wt=arguments[0]):2===arguments.length?(this.Wt=arguments[0],this.Xt=arguments[1]):3===arguments.length&&(this.Wt=arguments[0],this.Xt=arguments[1],this.cn=arguments[2]))},ght={serialVersionUID:{configurable:!0}};pht.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new ost(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new ost(t.getMinX(),t.getMinY()),new ost(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new ost(t.getMinX(),t.getMinY()),new ost(t.getMinX(),t.getMaxY()),new ost(t.getMaxX(),t.getMaxY()),new ost(t.getMaxX(),t.getMinY()),new ost(t.getMinX(),t.getMinY())]),null)},pht.prototype.createLineString=function(t){return t?t instanceof Array?new Zat(this.getCoordinateSequenceFactory().create(t),this):cst(t,xst)?new Zat(t,this):void 0:new Zat(this.getCoordinateSequenceFactory().create([]),this)},pht.prototype.createMultiLineString=function(){return 0===arguments.length?new Lat(null,this):1===arguments.length?new Lat(arguments[0],this):void 0},pht.prototype.buildGeometry=function(t){for(var e=null,n=!1,i=!1,r=t.iterator();r.hasNext();){var o=r.next(),s=o.getClass();null===e&&(e=s),s!==e&&(n=!0),o.isGeometryCollectionOrDerived()&&(i=!0)}if(null===e)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(pht.toGeometryArray(t));var a=t.iterator().next();if(t.size()>1){if(a instanceof Jat)return this.createMultiPolygon(pht.toPolygonArray(t));if(a instanceof Zat)return this.createMultiLineString(pht.toLineStringArray(t));if(a instanceof Xat)return this.createMultiPoint(pht.toPointArray(t));Fst.shouldNeverReachHere("Unhandled class: "+a.getClass().getName())}return a},pht.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)},pht.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof ost){var t=arguments[0];return this.createPoint(null!==t?this.getCoordinateSequenceFactory().create([t]):null)}if(cst(arguments[0],xst))return new Xat(arguments[0],this)}},pht.prototype.getCoordinateSequenceFactory=function(){return this.cn},pht.prototype.createPolygon=function(){if(0===arguments.length)return new Jat(null,null,this);if(1===arguments.length){if(cst(arguments[0],xst))return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof Array)return this.createPolygon(this.createLinearRing(arguments[0]));if(arguments[0]instanceof $at)return this.createPolygon(arguments[0],null)}else if(2===arguments.length)return new Jat(arguments[0],arguments[1],this)},pht.prototype.getSRID=function(){return this.Xt},pht.prototype.createGeometryCollection=function(){return 0===arguments.length?new kat(null,this):1===arguments.length?new kat(arguments[0],this):void 0},pht.prototype.createGeometry=function(t){return new eht(this).edit(t,{edit:function(){if(2===arguments.length)return this.cn.create(arguments[0])}})},pht.prototype.getPrecisionModel=function(){return this.Wt},pht.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(cst(arguments[0],xst))return new $at(arguments[0],this)}},pht.prototype.createMultiPolygon=function(){return 0===arguments.length?new tht(null,this):1===arguments.length?new tht(arguments[0],this):void 0},pht.prototype.createMultiPoint=function(){if(0===arguments.length)return new Kat(null,this);if(1===arguments.length){if(arguments[0]instanceof Array)return new Kat(arguments[0],this);if(arguments[0]instanceof Array){var t=arguments[0];return this.createMultiPoint(null!==t?this.getCoordinateSequenceFactory().create(t):null)}if(cst(arguments[0],xst)){var e=arguments[0];if(null===e)return this.createMultiPoint(new Array(0).fill(null));for(var n=new Array(e.size()).fill(null),i=0;i<e.size();i++){var r=this.getCoordinateSequenceFactory().create(1,e.getDimension());qat.copy(e,i,r,0,1),n[i]=this.createPoint(r)}return this.createMultiPoint(n)}}},pht.prototype.interfaces_=function(){return[rst]},pht.prototype.getClass=function(){return pht},pht.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},pht.toGeometryArray=function(t){if(null===t)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)},pht.getDefaultCoordinateSequenceFactory=function(){return hht.instance()},pht.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},pht.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},pht.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},pht.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},pht.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},pht.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)},pht.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)},ght.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(pht,ght);var mht=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],yht=function(t){this.geometryFactory=t||new pht};yht.prototype.read=function(t){var e,n=(e="string"==typeof t?JSON.parse(t):t).type;if(!vht[n])throw new Error("Unknown GeoJSON type: "+e.type);return-1!==mht.indexOf(n)?vht[n].apply(this,[e.coordinates]):vht[n].apply(this,"GeometryCollection"===n?[e.geometries]:[e])},yht.prototype.write=function(t){var e=t.getGeometryType();if(!_ht[e])throw new Error("Geometry is not supported");return _ht[e].apply(this,[t])};var vht={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){if(!vht[t.geometry.type])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=vht.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e={};if(t.features){e.features=[];for(var n=0;n<t.features.length;++n)e.features.push(this.read(t.features[n]))}return t.bbox&&(e.bbox=this.parse.bbox.apply(this,[t.bbox])),e},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var i=t[n];e.push(new ost(i[0],i[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new ost(t[0],t[1]),new ost(t[2],t[1]),new ost(t[2],t[3]),new ost(t[0],t[3]),new ost(t[0],t[1])])},Point:function(t){var e=new ost(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=[],n=0;n<t.length;++n)e.push(vht.Point.apply(this,[t[n]]));return this.geometryFactory.createMultiPoint(e)},LineString:function(t){var e=vht.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=[],n=0;n<t.length;++n)e.push(vht.LineString.apply(this,[t[n]]));return this.geometryFactory.createMultiLineString(e)},Polygon:function(t){for(var e=vht.coordinates.apply(this,[t[0]]),n=this.geometryFactory.createLinearRing(e),i=[],r=1;r<t.length;++r){var o=vht.coordinates.apply(this,[t[r]]),s=this.geometryFactory.createLinearRing(o);i.push(s)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(t){for(var e=[],n=0;n<t.length;++n)e.push(vht.Polygon.apply(this,[t[n]]));return this.geometryFactory.createMultiPolygon(e)},GeometryCollection:function(t){for(var e=[],n=0;n<t.length;++n)e.push(this.read(t[n]));return this.geometryFactory.createGeometryCollection(e)}},_ht={coordinate:function(t){return[t.x,t.y]},Point:function(t){return{type:"Point",coordinates:_ht.coordinate.apply(this,[t.getCoordinate()])}},MultiPoint:function(t){for(var e=[],n=0;n<t.Nt.length;++n){var i=_ht.Point.apply(this,[t.Nt[n]]);e.push(i.coordinates)}return{type:"MultiPoint",coordinates:e}},LineString:function(t){for(var e=[],n=t.getCoordinates(),i=0;i<n.length;++i)e.push(_ht.coordinate.apply(this,[n[i]]));return{type:"LineString",coordinates:e}},MultiLineString:function(t){for(var e=[],n=0;n<t.Nt.length;++n){var i=_ht.LineString.apply(this,[t.Nt[n]]);e.push(i.coordinates)}return{type:"MultiLineString",coordinates:e}},Polygon:function(t){var e=[],n=_ht.LineString.apply(this,[t.Qt]);e.push(n.coordinates);for(var i=0;i<t.St.length;++i){var r=_ht.LineString.apply(this,[t.St[i]]);e.push(r.coordinates)}return{type:"Polygon",coordinates:e}},MultiPolygon:function(t){for(var e=[],n=0;n<t.Nt.length;++n){var i=_ht.Polygon.apply(this,[t.Nt[n]]);e.push(i.coordinates)}return{type:"MultiPolygon",coordinates:e}},GeometryCollection:function(t){for(var e=[],n=0;n<t.Nt.length;++n){var i=t.Nt[n],r=i.getGeometryType();e.push(_ht[r].apply(this,[i]))}return{type:"GeometryCollection",geometries:e}}},xht=function(t){this.geometryFactory=t||new pht,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new yht(this.geometryFactory)};xht.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===cht.FIXED&&this.reducePrecision(e),e},xht.prototype.reducePrecision=function(t){var e,n;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(e=0,n=t.points.length;e<n;e++)this.precisionModel.makePrecise(t.points[e]);else if(t.geometries)for(e=0,n=t.geometries.length;e<n;e++)this.reducePrecision(t.geometries[e])};var bht=function(){this.parser=new yht(this.geometryFactory)};bht.prototype.write=function(t){return this.parser.write(t)};var wht=function(){},Cht={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function Pht(t){this.message=t||""}function Mht(){this.array_=[]}wht.prototype.interfaces_=function(){return[]},wht.prototype.getClass=function(){return wht},wht.opposite=function(t){return t===wht.LEFT?wht.RIGHT:t===wht.RIGHT?wht.LEFT:t},Cht.ON.get=function(){return 0},Cht.LEFT.get=function(){return 1},Cht.RIGHT.get=function(){return 2},Object.defineProperties(wht,Cht),(Pht.prototype=new Error).name="EmptyStackException",(Mht.prototype=new rat).add=function(t){return this.array_.push(t),!0},Mht.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]},Mht.prototype.push=function(t){return this.array_.push(t),t},Mht.prototype.pop=function(t){if(0===this.array_.length)throw new Pht;return this.array_.pop()},Mht.prototype.peek=function(){if(0===this.array_.length)throw new Pht;return this.array_[this.array_.length-1]},Mht.prototype.empty=function(){return 0===this.array_.length},Mht.prototype.isEmpty=function(){return this.empty()},Mht.prototype.search=function(t){return this.array_.indexOf(t)},Mht.prototype.size=function(){return this.array_.length},Mht.prototype.toArray=function(){for(var t=[],e=0,n=this.array_.length;e<n;e++)t.push(this.array_[e]);return t};var Tht=function(){this.an=-1,this.vn=null,this.ln=null,this.wn=null};Tht.prototype.getCoordinate=function(){return this.vn},Tht.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this.vn=null,this.checkForRightmostCoordinate(t)),n},Tht.prototype.findRightmostEdgeAtVertex=function(){var t=this.ln.getEdge().getCoordinates();Fst.isTrue(this.an>0&&this.an<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this.an-1],n=t[this.an+1],i=Ust.computeOrientation(this.vn,n,e),r=!1;(e.y<this.vn.y&&n.y<this.vn.y&&i===Ust.COUNTERCLOCKWISE||e.y>this.vn.y&&n.y>this.vn.y&&i===Ust.CLOCKWISE)&&(r=!0),r&&(this.an=this.an-1)},Tht.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge().getCoordinates();if(e<0||e+1>=n.length)return-1;if(n[e].y===n[e+1].y)return-1;var i=wht.LEFT;return n[e].y<n[e+1].y&&(i=wht.RIGHT),i},Tht.prototype.getEdge=function(){return this.wn},Tht.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),i=0;i<n.length-1;i++)(null===e.vn||n[i].x>e.vn.x)&&(e.ln=t,e.an=i,e.vn=n[i])},Tht.prototype.findRightmostEdgeAtNode=function(){var t=this.ln.getNode().getEdges();this.ln=t.getRightmostEdge(),this.ln.isForward()||(this.ln=this.ln.getSym(),this.an=this.ln.getEdge().getCoordinates().length-1)},Tht.prototype.findEdge=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.isForward()&&this.checkForRightmostCoordinate(n)}Fst.isTrue(0!==this.an||this.vn.equals(this.ln.getCoordinate()),"inconsistency in rightmost processing"),0===this.an?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.wn=this.ln,this.getRightmostSide(this.ln,this.an)===wht.LEFT&&(this.wn=this.ln.getSym())},Tht.prototype.interfaces_=function(){return[]},Tht.prototype.getClass=function(){return Tht};var Sht=function(t){function e(n,i){t.call(this,e.msgWithCoord(n,i)),this.pt=i?new ost(i):null,this.name="TopologyException"}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(t,e){return e?t:t+" [ "+e+" ]"},e}(kst),Iht=function(){this.array_=[]};Iht.prototype.addLast=function(t){this.array_.push(t)},Iht.prototype.removeFirst=function(){return this.array_.shift()},Iht.prototype.isEmpty=function(){return 0===this.array_.length};var Eht=function(){this.Pn=null,this.gn=new sat,this.Cn=new sat,this.Dn=null,this.In=null,this.Pn=new Tht};Eht.prototype.clearVisitedEdges=function(){for(var t=this.gn.iterator();t.hasNext();)t.next().setVisited(!1)},Eht.prototype.getRightmostCoordinate=function(){return this.Dn},Eht.prototype.computeNodeDepth=function(t){for(var e=null,n=t.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){e=i;break}}if(null===e)throw new Sht("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(e);for(var r=t.getEdges().iterator();r.hasNext();){var o=r.next();o.setVisited(!0),this.copySymDepths(o)}},Eht.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this.Pn.getEdge();e.setEdgeDepths(wht.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)},Eht.prototype.create=function(t){this.addReachable(t),this.Pn.findEdge(this.gn),this.Dn=this.Pn.getCoordinate()},Eht.prototype.findResultEdges=function(){for(var t=this.gn.iterator();t.hasNext();){var e=t.next();e.getDepth(wht.RIGHT)>=1&&e.getDepth(wht.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}},Eht.prototype.computeDepths=function(t){var e=new mat,n=new Iht,i=t.getNode();for(n.addLast(i),e.add(i),t.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();e.add(r),this.computeNodeDepth(r);for(var o=r.getEdges().iterator();o.hasNext();){var s=o.next().getSym();if(!s.isVisited()){var a=s.getNode();e.contains(a)||(n.addLast(a),e.add(a))}}}},Eht.prototype.compareTo=function(t){return this.Dn.x<t.Dn.x?-1:this.Dn.x>t.Dn.x?1:0},Eht.prototype.getEnvelope=function(){if(null===this.In){for(var t=new Tst,e=this.gn.iterator();e.hasNext();)for(var n=e.next().getEdge().getCoordinates(),i=0;i<n.length-1;i++)t.expandToInclude(n[i]);this.In=t}return this.In},Eht.prototype.addReachable=function(t){var e=new Mht;for(e.add(t);!e.empty();){var n=e.pop();this.add(n,e)}},Eht.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(wht.LEFT,t.getDepth(wht.RIGHT)),e.setDepth(wht.RIGHT,t.getDepth(wht.LEFT))},Eht.prototype.add=function(t,e){t.setVisited(!0),this.Cn.add(t);for(var n=t.getEdges().iterator();n.hasNext();){var i=n.next();this.gn.add(i);var r=i.getSym().getNode();r.isVisited()||e.push(r)}},Eht.prototype.getNodes=function(){return this.Cn},Eht.prototype.getDirectedEdges=function(){return this.gn},Eht.prototype.interfaces_=function(){return[est]},Eht.prototype.getClass=function(){return Eht};var Oht=function t(){if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array)this.init(arguments[0].length);else if(Number.isInteger(arguments[0])){var e=arguments[0];this.init(1),this.location[wht.ON]=e}else if(arguments[0]instanceof t){var n=arguments[0];if(this.init(n.location.length),null!==n)for(var i=0;i<this.location.length;i++)this.location[i]=n.location[i]}}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];this.init(3),this.location[wht.ON]=r,this.location[wht.LEFT]=o,this.location[wht.RIGHT]=s}};Oht.prototype.setAllLocations=function(t){for(var e=0;e<this.location.length;e++)this.location[e]=t},Oht.prototype.isNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]!==lst.NONE)return!1;return!0},Oht.prototype.setAllLocationsIfNull=function(t){for(var e=0;e<this.location.length;e++)this.location[e]===lst.NONE&&(this.location[e]=t)},Oht.prototype.isLine=function(){return 1===this.location.length},Oht.prototype.merge=function(t){if(t.location.length>this.location.length){var e=new Array(3).fill(null);e[wht.ON]=this.location[wht.ON],e[wht.LEFT]=lst.NONE,e[wht.RIGHT]=lst.NONE,this.location=e}for(var n=0;n<this.location.length;n++)this.location[n]===lst.NONE&&n<t.location.length&&(this.location[n]=t.location[n])},Oht.prototype.getLocations=function(){return this.location},Oht.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[wht.LEFT];this.location[wht.LEFT]=this.location[wht.RIGHT],this.location[wht.RIGHT]=t},Oht.prototype.toString=function(){var t=new dst;return this.location.length>1&&t.append(lst.toLocationSymbol(this.location[wht.LEFT])),t.append(lst.toLocationSymbol(this.location[wht.ON])),this.location.length>1&&t.append(lst.toLocationSymbol(this.location[wht.RIGHT])),t.toString()},Oht.prototype.setLocations=function(t,e,n){this.location[wht.ON]=t,this.location[wht.LEFT]=e,this.location[wht.RIGHT]=n},Oht.prototype.get=function(t){return t<this.location.length?this.location[t]:lst.NONE},Oht.prototype.isArea=function(){return this.location.length>1},Oht.prototype.isAnyNull=function(){for(var t=0;t<this.location.length;t++)if(this.location[t]===lst.NONE)return!0;return!1},Oht.prototype.setLocation=function(){1===arguments.length?this.setLocation(wht.ON,arguments[0]):2===arguments.length&&(this.location[arguments[0]]=arguments[1])},Oht.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(lst.NONE)},Oht.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]},Oht.prototype.allPositionsEqual=function(t){for(var e=0;e<this.location.length;e++)if(this.location[e]!==t)return!1;return!0},Oht.prototype.interfaces_=function(){return[]},Oht.prototype.getClass=function(){return Oht};var Rht=function t(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new Oht(e),this.elt[1]=new Oht(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new Oht(n.elt[0]),this.elt[1]=new Oht(n.elt[1])}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.elt[0]=new Oht(lst.NONE),this.elt[1]=new Oht(lst.NONE),this.elt[i].setLocation(r)}else if(3===arguments.length){var o=arguments[0],s=arguments[1],a=arguments[2];this.elt[0]=new Oht(o,s,a),this.elt[1]=new Oht(o,s,a)}else if(4===arguments.length){var h=arguments[0],l=arguments[1],u=arguments[2],c=arguments[3];this.elt[0]=new Oht(lst.NONE,lst.NONE,lst.NONE),this.elt[1]=new Oht(lst.NONE,lst.NONE,lst.NONE),this.elt[h].setLocations(l,u,c)}};Rht.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t},Rht.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)},Rht.prototype.isNull=function(t){return this.elt[t].isNull()},Rht.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else 2===arguments.length&&this.elt[arguments[0]].setAllLocationsIfNull(arguments[1])},Rht.prototype.isLine=function(t){return this.elt[t].isLine()},Rht.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)null===e.elt[n]&&null!==t.elt[n]?e.elt[n]=new Oht(t.elt[n]):e.elt[n].merge(t.elt[n])},Rht.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},Rht.prototype.getLocation=function(){return 1===arguments.length?this.elt[arguments[0]].get(wht.ON):2===arguments.length?this.elt[arguments[0]].get(arguments[1]):void 0},Rht.prototype.toString=function(){var t=new dst;return null!==this.elt[0]&&(t.append("A:"),t.append(this.elt[0].toString())),null!==this.elt[1]&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()},Rht.prototype.isArea=function(){return 0===arguments.length?this.elt[0].isArea()||this.elt[1].isArea():1===arguments.length?this.elt[arguments[0]].isArea():void 0},Rht.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()},Rht.prototype.setLocation=function(){2===arguments.length?this.elt[arguments[0]].setLocation(wht.ON,arguments[1]):3===arguments.length&&this.elt[arguments[0]].setLocation(arguments[1],arguments[2])},Rht.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)},Rht.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)},Rht.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new Oht(this.elt[t].location[0]))},Rht.prototype.interfaces_=function(){return[]},Rht.prototype.getClass=function(){return Rht},Rht.toLineLabel=function(t){for(var e=new Rht(lst.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var Dht=function(){this.bn=null,this.Mn=-1,this.zn=new sat,this.dn=new sat,this.xn=new Rht(lst.NONE),this.mn=null,this.yn=null,this.Qt=null,this.St=new sat,this.pn=null;var t=arguments[0];this.pn=arguments[1],this.computePoints(t),this.computeRing()};Dht.prototype.computeRing=function(){if(null!==this.mn)return null;for(var t=new Array(this.dn.size()).fill(null),e=0;e<this.dn.size();e++)t[e]=this.dn.get(e);this.mn=this.pn.createLinearRing(t),this.yn=Ust.isCCW(this.mn.getCoordinates())},Dht.prototype.isIsolated=function(){return 1===this.xn.getGeometryCount()},Dht.prototype.computePoints=function(t){var e=this;this.bn=t;var n=t,i=!0;do{if(null===n)throw new Sht("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new Sht("Directed Edge visited twice during ring-building at "+n.getCoordinate());e.zn.add(n);var r=n.getLabel();Fst.isTrue(r.isArea()),e.mergeLabel(r),e.addPoints(n.getEdge(),n.isForward(),i),i=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this.bn)},Dht.prototype.getLinearRing=function(){return this.mn},Dht.prototype.getCoordinate=function(t){return this.dn.get(t)},Dht.prototype.computeMaxNodeDegree=function(){var t=this;this.Mn=0;var e=this.bn;do{var n=e.getNode().getEdges().getOutgoingDegree(t);n>t.Mn&&(t.Mn=n),e=t.getNext(e)}while(e!==this.bn);this.Mn*=2},Dht.prototype.addPoints=function(t,e,n){var i=t.getCoordinates();if(e){var r=1;n&&(r=0);for(var o=r;o<i.length;o++)this.dn.add(i[o])}else{var s=i.length-2;n&&(s=i.length-1);for(var a=s;a>=0;a--)this.dn.add(i[a])}},Dht.prototype.isHole=function(){return this.yn},Dht.prototype.setInResult=function(){var t=this.bn;do{t.getEdge().setInResult(!0),t=t.getNext()}while(t!==this.bn)},Dht.prototype.containsPoint=function(t){var e=this.getLinearRing();if(!e.getEnvelopeInternal().contains(t))return!1;if(!Ust.isPointInRing(t,e.getCoordinates()))return!1;for(var n=this.St.iterator();n.hasNext();)if(n.next().containsPoint(t))return!1;return!0},Dht.prototype.addHole=function(t){this.St.add(t)},Dht.prototype.isShell=function(){return null===this.Qt},Dht.prototype.getLabel=function(){return this.xn},Dht.prototype.getEdges=function(){return this.zn},Dht.prototype.getMaxNodeDegree=function(){return this.Mn<0&&this.computeMaxNodeDegree(),this.Mn},Dht.prototype.getShell=function(){return this.Qt},Dht.prototype.mergeLabel=function(){if(1===arguments.length){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(2===arguments.length){var e=arguments[1],n=arguments[0].getLocation(e,wht.RIGHT);if(n===lst.NONE)return null;if(this.xn.getLocation(e)===lst.NONE)return this.xn.setLocation(e,n),null}},Dht.prototype.setShell=function(t){this.Qt=t,null!==t&&t.addHole(this)},Dht.prototype.toPolygon=function(t){for(var e=new Array(this.St.size()).fill(null),n=0;n<this.St.size();n++)e[n]=this.St.get(n).getLinearRing();return t.createPolygon(this.getLinearRing(),e)},Dht.prototype.interfaces_=function(){return[]},Dht.prototype.getClass=function(){return Dht};var kht=function(t){function e(){t.call(this,arguments[0],arguments[1])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setEdgeRing=function(t,e){t.setMinEdgeRing(e)},e.prototype.getNext=function(t){return t.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Dht),Lht=function(t){function e(){t.call(this,arguments[0],arguments[1])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.buildMinimalRings=function(){var t=new sat,e=this.bn;do{if(null===e.getMinEdgeRing()){var n=new kht(e,this.pn);t.add(n)}e=e.getNext()}while(e!==this.bn);return t},e.prototype.setEdgeRing=function(t,e){t.setEdgeRing(e)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var t=this.bn;do{t.getNode().getEdges().linkMinimalDirectedEdges(this),t=t.getNext()}while(t!==this.bn)},e.prototype.getNext=function(t){return t.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Dht),Fht=function(){this.xn=null,this.Ln=!1,this.Tn=!1,this.On=!1,this.Fn=!1,0===arguments.length||1===arguments.length&&(this.xn=arguments[0])};Fht.prototype.setVisited=function(t){this.Fn=t},Fht.prototype.setInResult=function(t){this.Ln=t},Fht.prototype.isCovered=function(){return this.Tn},Fht.prototype.isCoveredSet=function(){return this.On},Fht.prototype.setLabel=function(t){this.xn=t},Fht.prototype.getLabel=function(){return this.xn},Fht.prototype.setCovered=function(t){this.Tn=t,this.On=!0},Fht.prototype.updateIM=function(t){Fst.isTrue(this.xn.getGeometryCount()>=2,"found partial label"),this.computeIM(t)},Fht.prototype.isInResult=function(){return this.Ln},Fht.prototype.isVisited=function(){return this.Fn},Fht.prototype.interfaces_=function(){return[]},Fht.prototype.getClass=function(){return Fht};var Nht=function(t){function e(){t.call(this),this.Un=null,this.zn=null;var e=arguments[1];this.Un=arguments[0],this.zn=e,this.xn=new Rht(0,lst.NONE)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var t=this.getEdges().getEdges().iterator();t.hasNext();)if(t.next().getEdge().isInResult())return!0;return!1},e.prototype.isIsolated=function(){return 1===this.xn.getGeometryCount()},e.prototype.getCoordinate=function(){return this.Un},e.prototype.print=function(t){t.println("node "+this.Un+" lbl: "+this.xn)},e.prototype.computeIM=function(t){},e.prototype.computeMergedLocation=function(t,e){var n=lst.NONE;if(n=this.xn.getLocation(e),!t.isNull(e)){var i=t.getLocation(e);n!==lst.BOUNDARY&&(n=i)}return n},e.prototype.setLabel=function(){if(2!==arguments.length)return t.prototype.setLabel.apply(this,arguments);var e=arguments[0],n=arguments[1];null===this.xn?this.xn=new Rht(e,n):this.xn.setLocation(e,n)},e.prototype.getEdges=function(){return this.zn},e.prototype.mergeLabel=function(){var t=this;if(arguments[0]instanceof e)this.mergeLabel(arguments[0].xn);else if(arguments[0]instanceof Rht)for(var n=arguments[0],i=0;i<2;i++){var r=t.computeMergedLocation(n,i);t.xn.getLocation(i)===lst.NONE&&t.xn.setLocation(i,r)}},e.prototype.add=function(t){this.zn.insert(t),t.setNode(this)},e.prototype.setLabelBoundary=function(t){if(null===this.xn)return null;var e=lst.NONE;null!==this.xn&&(e=this.xn.getLocation(t)),this.xn.setLocation(t,e===lst.BOUNDARY?lst.INTERIOR:lst.BOUNDARY)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Fht),zht=function(){this.nodeMap=new Cat,this.nodeFact=null,this.nodeFact=arguments[0]};zht.prototype.find=function(t){return this.nodeMap.get(t)},zht.prototype.addNode=function(){if(arguments[0]instanceof ost){var t=arguments[0],e=this.nodeMap.get(t);return null===e&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}if(arguments[0]instanceof Nht){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return null===i?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}},zht.prototype.print=function(t){for(var e=this.iterator();e.hasNext();)e.next().print(t)},zht.prototype.iterator=function(){return this.nodeMap.values().iterator()},zht.prototype.values=function(){return this.nodeMap.values()},zht.prototype.getBoundaryNodes=function(t){for(var e=new sat,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(t)===lst.BOUNDARY&&e.add(i)}return e},zht.prototype.add=function(t){var e=t.getCoordinate();this.addNode(e).add(t)},zht.prototype.interfaces_=function(){return[]},zht.prototype.getClass=function(){return zht};var Bht=function(){},Hht={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Bht.prototype.interfaces_=function(){return[]},Bht.prototype.getClass=function(){return Bht},Bht.isNorthern=function(t){return t===Bht.NE||t===Bht.NW},Bht.isOpposite=function(t,e){return t!==e&&2==(t-e+4)%4},Bht.commonHalfPlane=function(t,e){if(t===e)return t;if(2==(t-e+4)%4)return-1;var n=t<e?t:e;return 0===n&&3===(t>e?t:e)?3:n},Bht.isInHalfPlane=function(t,e){return e===Bht.SE?t===Bht.SE||t===Bht.SW:t===e||t===e+1},Bht.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new Kot("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Bht.NE:Bht.SE:e>=0?Bht.NW:Bht.SW}if(arguments[0]instanceof ost&&arguments[1]instanceof ost){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new Kot("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?Bht.NE:Bht.SE:i.y>=n.y?Bht.NW:Bht.SW}},Hht.NE.get=function(){return 0},Hht.NW.get=function(){return 1},Hht.SW.get=function(){return 2},Hht.SE.get=function(){return 3},Object.defineProperties(Bht,Hht);var jht=function(){if(this.En=null,this.xn=null,this.Nn=null,this.jn=null,this.Qn=null,this.Sn=null,this.Bn=null,this.kn=null,1===arguments.length)this.En=arguments[0];else if(3===arguments.length){var t=arguments[1],e=arguments[2];this.En=arguments[0],this.init(t,e),this.xn=null}else if(4===arguments.length){var n=arguments[1],i=arguments[2],r=arguments[3];this.En=arguments[0],this.init(n,i),this.xn=r}};jht.prototype.compareDirection=function(t){return this.Sn===t.Sn&&this.Bn===t.Bn?0:this.kn>t.kn?1:this.kn<t.kn?-1:Ust.computeOrientation(t.jn,t.Qn,this.Qn)},jht.prototype.getDy=function(){return this.Bn},jht.prototype.getCoordinate=function(){return this.jn},jht.prototype.setNode=function(t){this.Nn=t},jht.prototype.print=function(t){var e=Math.atan2(this.Bn,this.Sn),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);t.print("  "+r+": "+this.jn+" - "+this.Qn+" "+this.kn+":"+e+"   "+this.xn)},jht.prototype.compareTo=function(t){return this.compareDirection(t)},jht.prototype.getDirectedCoordinate=function(){return this.Qn},jht.prototype.getDx=function(){return this.Sn},jht.prototype.getLabel=function(){return this.xn},jht.prototype.getEdge=function(){return this.En},jht.prototype.getQuadrant=function(){return this.kn},jht.prototype.getNode=function(){return this.Nn},jht.prototype.toString=function(){var t=Math.atan2(this.Bn,this.Sn),e=this.getClass().getName(),n=e.lastIndexOf(".");return"  "+e.substring(n+1)+": "+this.jn+" - "+this.Qn+" "+this.kn+":"+t+"   "+this.xn},jht.prototype.computeLabel=function(t){},jht.prototype.init=function(t,e){this.jn=t,this.Qn=e,this.Sn=e.x-t.x,this.Bn=e.y-t.y,this.kn=Bht.quadrant(this.Sn,this.Bn),Fst.isTrue(!(0===this.Sn&&0===this.Bn),"EdgeEnd with identical endpoints found")},jht.prototype.interfaces_=function(){return[est]},jht.prototype.getClass=function(){return jht};var Uht=function(t){function e(){var e=arguments[0],n=arguments[1];if(t.call(this,e),this.Rn=null,this.Ln=!1,this.Fn=!1,this.Gn=null,this.Yn=null,this.qn=null,this.Vn=null,this.Wn=null,this._n=[0,-999,-999],this.Rn=n,n)this.init(e.getCoordinate(0),e.getCoordinate(1));else{var i=e.getNumPoints()-1;this.init(e.getCoordinate(i),e.getCoordinate(i-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getNextMin=function(){return this.qn},e.prototype.getDepth=function(t){return this._n[t]},e.prototype.setVisited=function(t){this.Fn=t},e.prototype.computeDirectedLabel=function(){this.xn=new Rht(this.En.getLabel()),this.Rn||this.xn.flip()},e.prototype.getNext=function(){return this.Yn},e.prototype.setDepth=function(t,e){if(-999!==this._n[t]&&this._n[t]!==e)throw new Sht("assigned depths do not match",this.getCoordinate());this._n[t]=e},e.prototype.isInteriorAreaEdge=function(){for(var t=this,e=!0,n=0;n<2;n++)t.xn.isArea(n)&&t.xn.getLocation(n,wht.LEFT)===lst.INTERIOR&&t.xn.getLocation(n,wht.RIGHT)===lst.INTERIOR||(e=!1);return e},e.prototype.setNextMin=function(t){this.qn=t},e.prototype.print=function(e){t.prototype.print.call(this,e),e.print(" "+this._n[wht.LEFT]+"/"+this._n[wht.RIGHT]),e.print(" ("+this.getDepthDelta()+")"),this.Ln&&e.print(" inResult")},e.prototype.setMinEdgeRing=function(t){this.Wn=t},e.prototype.isLineEdge=function(){var t=this.xn.isLine(0)||this.xn.isLine(1),e=!this.xn.isArea(0)||this.xn.allPositionsEqual(0,lst.EXTERIOR),n=!this.xn.isArea(1)||this.xn.allPositionsEqual(1,lst.EXTERIOR);return t&&e&&n},e.prototype.setEdgeRing=function(t){this.Vn=t},e.prototype.getMinEdgeRing=function(){return this.Wn},e.prototype.getDepthDelta=function(){var t=this.En.getDepthDelta();return this.Rn||(t=-t),t},e.prototype.setInResult=function(t){this.Ln=t},e.prototype.getSym=function(){return this.Gn},e.prototype.isForward=function(){return this.Rn},e.prototype.getEdge=function(){return this.En},e.prototype.printEdge=function(t){this.print(t),t.print(" "),this.Rn?this.En.print(t):this.En.printReverse(t)},e.prototype.setSym=function(t){this.Gn=t},e.prototype.setVisitedEdge=function(t){this.setVisited(t),this.Gn.setVisited(t)},e.prototype.setEdgeDepths=function(t,e){var n=this.getEdge().getDepthDelta();this.Rn||(n=-n);var i=1;t===wht.LEFT&&(i=-1);var r=wht.opposite(t),o=e+n*i;this.setDepth(t,e),this.setDepth(r,o)},e.prototype.getEdgeRing=function(){return this.Vn},e.prototype.isInResult=function(){return this.Ln},e.prototype.setNext=function(t){this.Yn=t},e.prototype.isVisited=function(){return this.Fn},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(t,e){return t===lst.EXTERIOR&&e===lst.INTERIOR?1:t===lst.INTERIOR&&e===lst.EXTERIOR?-1:0},e}(jht),Ght=function(){};Ght.prototype.createNode=function(t){return new Nht(t,null)},Ght.prototype.interfaces_=function(){return[]},Ght.prototype.getClass=function(){return Ght};var Vht=function(){this.zn=new sat,this.Cn=null,this.Kn=new sat,0===arguments.length?this.Cn=new zht(new Ght):1===arguments.length&&(this.Cn=new zht(arguments[0]))};Vht.prototype.printEdges=function(t){t.println("Edges:");for(var e=0;e<this.zn.size();e++){t.println("edge "+e+":");var n=this.zn.get(e);n.print(t),n.eiList.print(t)}},Vht.prototype.find=function(t){return this.Cn.find(t)},Vht.prototype.addNode=function(){return arguments[0]instanceof Nht||arguments[0]instanceof ost?this.Cn.addNode(arguments[0]):void 0},Vht.prototype.getNodeIterator=function(){return this.Cn.iterator()},Vht.prototype.linkResultDirectedEdges=function(){for(var t=this.Cn.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()},Vht.prototype.debugPrintln=function(t){Pst.out.println(t)},Vht.prototype.isBoundaryNode=function(t,e){var n=this.Cn.find(e);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(t)===lst.BOUNDARY},Vht.prototype.linkAllDirectedEdges=function(){for(var t=this.Cn.iterator();t.hasNext();)t.next().getEdges().linkAllDirectedEdges()},Vht.prototype.matchInSameDirection=function(t,e,n,i){return!!t.equals(n)&&Ust.computeOrientation(t,e,i)===Ust.COLLINEAR&&Bht.quadrant(t,e)===Bht.quadrant(n,i)},Vht.prototype.getEdgeEnds=function(){return this.Kn},Vht.prototype.debugPrint=function(t){Pst.out.print(t)},Vht.prototype.getEdgeIterator=function(){return this.zn.iterator()},Vht.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,i=0;i<this.zn.size();i++){var r=n.zn.get(i),o=r.getCoordinates();if(n.matchInSameDirection(t,e,o[0],o[1]))return r;if(n.matchInSameDirection(t,e,o[o.length-1],o[o.length-2]))return r}return null},Vht.prototype.insertEdge=function(t){this.zn.add(t)},Vht.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null},Vht.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var i=n.next();e.zn.add(i);var r=new Uht(i,!0),o=new Uht(i,!1);r.setSym(o),o.setSym(r),e.add(r),e.add(o)}},Vht.prototype.add=function(t){this.Cn.add(t),this.Kn.add(t)},Vht.prototype.getNodes=function(){return this.Cn.values()},Vht.prototype.findEdge=function(t,e){for(var n=0;n<this.zn.size();n++){var i=this.zn.get(n),r=i.getCoordinates();if(t.equals(r[0])&&e.equals(r[1]))return i}return null},Vht.prototype.interfaces_=function(){return[]},Vht.prototype.getClass=function(){return Vht},Vht.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();)e.next().getEdges().linkResultDirectedEdges()};var Wht=function(){this.pn=null,this.Hn=new sat,this.pn=arguments[0]};Wht.prototype.sortShellsAndHoles=function(t,e,n){for(var i=t.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):e.add(r)}},Wht.prototype.computePolygons=function(t){for(var e=new sat,n=t.iterator();n.hasNext();){var i=n.next().toPolygon(this.pn);e.add(i)}return e},Wht.prototype.placeFreeHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();if(null===i.getShell()){var r=this.findEdgeRingContaining(i,t);if(null===r)throw new Sht("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(r)}}},Wht.prototype.buildMinimalEdgeRings=function(t,e,n){for(var i=new sat,r=t.iterator();r.hasNext();){var o=r.next();if(o.getMaxNodeDegree()>2){o.linkDirectedEdgesForMinimalEdgeRings();var s=o.buildMinimalRings(),a=this.findShell(s);null!==a?(this.placePolygonHoles(a,s),e.add(a)):n.addAll(s)}else i.add(o)}return i},Wht.prototype.containsPoint=function(t){for(var e=this.Hn.iterator();e.hasNext();)if(e.next().containsPoint(t))return!0;return!1},Wht.prototype.buildMaximalEdgeRings=function(t){for(var e=new sat,n=t.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new Lht(i,this.pn);e.add(r),r.setInResult()}}return e},Wht.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(t)}},Wht.prototype.getPolygons=function(){return this.computePolygons(this.Hn)},Wht.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),o=null,s=null,a=e.iterator();a.hasNext();){var h=a.next(),l=h.getLinearRing(),u=l.getEnvelopeInternal();null!==o&&(s=o.getLinearRing().getEnvelopeInternal());var c=!1;u.contains(i)&&Ust.isPointInRing(r,l.getCoordinates())&&(c=!0),c&&(null===o||s.contains(u))&&(o=h)}return o},Wht.prototype.findShell=function(t){for(var e=0,n=null,i=t.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,e++)}return Fst.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n},Wht.prototype.add=function(){if(1===arguments.length){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(2===arguments.length){var e=arguments[0];Vht.linkResultDirectedEdges(arguments[1]);var n=this.buildMaximalEdgeRings(e),i=new sat,r=this.buildMinimalEdgeRings(n,this.Hn,i);this.sortShellsAndHoles(r,this.Hn,i),this.placeFreeHoles(this.Hn,i)}},Wht.prototype.interfaces_=function(){return[]},Wht.prototype.getClass=function(){return Wht};var qht=function(){};qht.prototype.getBounds=function(){},qht.prototype.interfaces_=function(){return[]},qht.prototype.getClass=function(){return qht};var Zht=function(){this.Jn=null,this.Zn=null;var t=arguments[1];this.Jn=arguments[0],this.Zn=t};Zht.prototype.getItem=function(){return this.Zn},Zht.prototype.getBounds=function(){return this.Jn},Zht.prototype.interfaces_=function(){return[qht,rst]},Zht.prototype.getClass=function(){return Zht};var Qht=function(){this.Xn=null,this.$n=null,this.Xn=0,this.$n=new sat,this.$n.add(null)};Qht.prototype.poll=function(){if(this.isEmpty())return null;var t=this.$n.get(1);return this.$n.set(1,this.$n.get(this.Xn)),this.Xn-=1,this.reorder(1),t},Qht.prototype.size=function(){return this.Xn},Qht.prototype.reorder=function(t){for(var e=this,n=null,i=this.$n.get(t);2*t<=this.Xn&&((n=2*t)!==e.Xn&&e.$n.get(n+1).compareTo(e.$n.get(n))<0&&n++,e.$n.get(n).compareTo(i)<0);t=n)e.$n.set(t,e.$n.get(n));this.$n.set(t,i)},Qht.prototype.clear=function(){this.Xn=0,this.$n.clear()},Qht.prototype.isEmpty=function(){return 0===this.Xn},Qht.prototype.add=function(t){this.$n.add(null),this.Xn+=1;var e=this.Xn;for(this.$n.set(0,t);t.compareTo(this.$n.get(Math.trunc(e/2)))<0;e/=2)this.$n.set(e,this.$n.get(Math.trunc(e/2)));this.$n.set(e,t)},Qht.prototype.interfaces_=function(){return[]},Qht.prototype.getClass=function(){return Qht};var Xht=function(){};Xht.prototype.visitItem=function(t){},Xht.prototype.interfaces_=function(){return[]},Xht.prototype.getClass=function(){return Xht};var Yht=function(){};Yht.prototype.insert=function(t,e){},Yht.prototype.remove=function(t,e){},Yht.prototype.query=function(){},Yht.prototype.interfaces_=function(){return[]},Yht.prototype.getClass=function(){return Yht};var Jht=function(){this.Ai=new sat,this.Jn=null,this.ti=null,0===arguments.length||1===arguments.length&&(this.ti=arguments[0])},Kht={serialVersionUID:{configurable:!0}};Jht.prototype.getLevel=function(){return this.ti},Jht.prototype.size=function(){return this.Ai.size()},Jht.prototype.getChildBoundables=function(){return this.Ai},Jht.prototype.addChildBoundable=function(t){Fst.isTrue(null===this.Jn),this.Ai.add(t)},Jht.prototype.isEmpty=function(){return this.Ai.isEmpty()},Jht.prototype.getBounds=function(){return null===this.Jn&&(this.Jn=this.computeBounds()),this.Jn},Jht.prototype.interfaces_=function(){return[qht,rst]},Jht.prototype.getClass=function(){return Jht},Kht.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Jht,Kht);var $ht=function(){};$ht.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}},$ht.min=function(t){return $ht.sort(t),t.get(0)},$ht.sort=function(t,e){var n=t.toArray();e?Iat.sort(n,e):Iat.sort(n);for(var i=t.iterator(),r=0,o=n.length;r<o;r++)i.next(),i.set(n[r])},$ht.singletonList=function(t){var e=new sat;return e.add(t),e};var tlt=function(){this.ni=null,this.ii=null,this.ri=null,this.ei=null;var t=arguments[1],e=arguments[2];this.ni=arguments[0],this.ii=t,this.ei=e,this.ri=this.distance()};tlt.prototype.expandToQueue=function(t,e){var n=tlt.isComposite(this.ni),i=tlt.isComposite(this.ii);if(n&&i)return tlt.area(this.ni)>tlt.area(this.ii)?(this.expand(this.ni,this.ii,t,e),null):(this.expand(this.ii,this.ni,t,e),null);if(n)return this.expand(this.ni,this.ii,t,e),null;if(i)return this.expand(this.ii,this.ni,t,e),null;throw new Kot("neither boundable is composite")},tlt.prototype.isLeaves=function(){return!(tlt.isComposite(this.ni)||tlt.isComposite(this.ii))},tlt.prototype.compareTo=function(t){return this.ri<t.ri?-1:this.ri>t.ri?1:0},tlt.prototype.expand=function(t,e,n,i){for(var r=t.getChildBoundables().iterator();r.hasNext();){var o=r.next(),s=new tlt(o,e,this.ei);s.getDistance()<i&&n.add(s)}},tlt.prototype.getBoundable=function(t){return 0===t?this.ni:this.ii},tlt.prototype.getDistance=function(){return this.ri},tlt.prototype.distance=function(){return this.isLeaves()?this.ei.distance(this.ni,this.ii):this.ni.getBounds().distance(this.ii.getBounds())},tlt.prototype.interfaces_=function(){return[est]},tlt.prototype.getClass=function(){return tlt},tlt.area=function(t){return t.getBounds().getArea()},tlt.isComposite=function(t){return t instanceof Jht};var elt=function t(){if(this.si=null,this.ui=!1,this.oi=new sat,this.hi=null,0===arguments.length)this.hi=t.DEFAULT_NODE_CAPACITY;else if(1===arguments.length){var e=arguments[0];Fst.isTrue(e>1,"Node capacity must be greater than 1"),this.hi=e}},nlt={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};elt.prototype.getNodeCapacity=function(){return this.hi},elt.prototype.lastNode=function(t){return t.get(t.size()-1)},elt.prototype.size=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this.si));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();n instanceof Jht?t+=this.size(n):n instanceof Zht&&(t+=1)}return t}},elt.prototype.removeItem=function(t,e){for(var n=null,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof Zht&&r.getItem()===e&&(n=r)}return null!==n&&(t.getChildBoundables().remove(n),!0)},elt.prototype.itemsTree=function(){if(0===arguments.length){this.build();var t=this.itemsTree(this.si);return null===t?new sat:t}if(1===arguments.length){for(var e=arguments[0],n=new sat,i=e.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof Jht){var o=this.itemsTree(r);null!==o&&n.add(o)}else r instanceof Zht?n.add(r.getItem()):Fst.shouldNeverReachHere()}return n.size()<=0?null:n}},elt.prototype.insert=function(t,e){Fst.isTrue(!this.ui,"Cannot insert items into an STR packed R-tree after it has been built."),this.oi.add(new Zht(t,e))},elt.prototype.boundablesAtLevel=function(){if(1===arguments.length){var t=arguments[0],e=new sat;return this.boundablesAtLevel(t,this.si,e),e}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];if(Fst.isTrue(n>-2),i.getLevel()===n)return r.add(i),null;for(var o=i.getChildBoundables().iterator();o.hasNext();){var s=o.next();s instanceof Jht?this.boundablesAtLevel(n,s,r):(Fst.isTrue(s instanceof Zht),-1===n&&r.add(s))}return null}},elt.prototype.query=function(){var t=this;if(1===arguments.length){var e=arguments[0];this.build();var n=new sat;return this.isEmpty()||this.getIntersectsOp().intersects(this.si.getBounds(),e)&&this.query(e,this.si,n),n}if(2===arguments.length){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this.si.getBounds(),i)&&this.query(i,this.si,r)}else if(3===arguments.length)if(cst(arguments[2],Xht)&&arguments[0]instanceof Object&&arguments[1]instanceof Jht)for(var o=arguments[0],s=arguments[2],a=arguments[1].getChildBoundables(),h=0;h<a.size();h++){var l=a.get(h);t.getIntersectsOp().intersects(l.getBounds(),o)&&(l instanceof Jht?t.query(o,l,s):l instanceof Zht?s.visitItem(l.getItem()):Fst.shouldNeverReachHere())}else if(cst(arguments[2],rat)&&arguments[0]instanceof Object&&arguments[1]instanceof Jht)for(var u=arguments[0],c=arguments[2],A=arguments[1].getChildBoundables(),f=0;f<A.size();f++){var d=A.get(f);t.getIntersectsOp().intersects(d.getBounds(),u)&&(d instanceof Jht?t.query(u,d,c):d instanceof Zht?c.add(d.getItem()):Fst.shouldNeverReachHere())}},elt.prototype.build=function(){if(this.ui)return null;this.si=this.oi.isEmpty()?this.createNode(0):this.createHigherLevels(this.oi,-1),this.oi=null,this.ui=!0},elt.prototype.getRoot=function(){return this.build(),this.si},elt.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this.si.getBounds(),t)&&this.remove(t,this.si,e)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],o=this.removeItem(i,r);if(o)return!0;for(var s=null,a=i.getChildBoundables().iterator();a.hasNext();){var h=a.next();if(this.getIntersectsOp().intersects(h.getBounds(),n)&&h instanceof Jht&&(o=this.remove(n,h,r))){s=h;break}}return null!==s&&s.getChildBoundables().isEmpty()&&i.getChildBoundables().remove(s),o}},elt.prototype.createHigherLevels=function(t,e){Fst.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,e+1)},elt.prototype.depth=function(){if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this.si));if(1===arguments.length){for(var t=0,e=arguments[0].getChildBoundables().iterator();e.hasNext();){var n=e.next();if(n instanceof Jht){var i=this.depth(n);i>t&&(t=i)}}return t+1}},elt.prototype.createParentBoundables=function(t,e){var n=this;Fst.isTrue(!t.isEmpty());var i=new sat;i.add(this.createNode(e));var r=new sat(t);$ht.sort(r,this.getComparator());for(var o=r.iterator();o.hasNext();){var s=o.next();n.lastNode(i).getChildBoundables().size()===n.getNodeCapacity()&&i.add(n.createNode(e)),n.lastNode(i).addChildBoundable(s)}return i},elt.prototype.isEmpty=function(){return this.ui?this.si.isEmpty():this.oi.isEmpty()},elt.prototype.interfaces_=function(){return[rst]},elt.prototype.getClass=function(){return elt},elt.compareDoubles=function(t,e){return t>e?1:t<e?-1:0},nlt.IntersectsOp.get=function(){return ilt},nlt.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},nlt.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(elt,nlt);var ilt=function(){},rlt=function(){};rlt.prototype.distance=function(t,e){},rlt.prototype.interfaces_=function(){return[]},rlt.prototype.getClass=function(){return rlt};var olt=function(t){function e(n){t.call(this,n=n||e.DEFAULT_NODE_CAPACITY)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(t,e){Fst.isTrue(t.length>0);for(var n=new sat,i=0;i<t.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(t[i],e));return n},e.prototype.createNode=function(t){return new slt(t)},e.prototype.size=function(){return 0===arguments.length?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(2!==arguments.length)return t.prototype.insert.apply(this,arguments);var e=arguments[0],n=arguments[1];if(e.isNull())return null;t.prototype.insert.call(this,e,n)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(t,e){for(var n=Math.trunc(Math.ceil(t.size()/e)),i=new Array(e).fill(null),r=t.iterator(),o=0;o<e;o++){i[o]=new sat;for(var s=0;r.hasNext()&&s<n;){var a=r.next();i[o].add(a),s++}}return i},e.prototype.query=function(){if(1===arguments.length)return t.prototype.query.call(this,arguments[0]);2===arguments.length?t.prototype.query.call(this,arguments[0],arguments[1]):3===arguments.length&&(cst(arguments[2],Xht)&&arguments[0]instanceof Object&&arguments[1]instanceof Jht||cst(arguments[2],rat)&&arguments[0]instanceof Object&&arguments[1]instanceof Jht)&&t.prototype.query.call(this,arguments[0],arguments[1],arguments[2])},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(e,n){return t.prototype.createParentBoundables.call(this,e,n)},e.prototype.remove=function(){return 2===arguments.length?t.prototype.remove.call(this,arguments[0],arguments[1]):t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return 0===arguments.length?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(t,n){Fst.isTrue(!t.isEmpty());var i=Math.trunc(Math.ceil(t.size()/this.getNodeCapacity())),r=new sat(t);$ht.sort(r,e.xComparator);var o=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(i))));return this.createParentBoundablesFromVerticalSlices(o,n)},e.prototype.nearestNeighbour=function(){if(1===arguments.length){if(cst(arguments[0],rlt)){var t=arguments[0],n=new tlt(this.getRoot(),this.getRoot(),t);return this.nearestNeighbour(n)}if(arguments[0]instanceof tlt)return this.nearestNeighbour(arguments[0],$ot.POSITIVE_INFINITY)}else if(2===arguments.length){if(arguments[0]instanceof e&&cst(arguments[1],rlt)){var i=arguments[0],r=arguments[1],o=new tlt(this.getRoot(),i.getRoot(),r);return this.nearestNeighbour(o)}if(arguments[0]instanceof tlt&&"number"==typeof arguments[1]){var s=arguments[0],a=arguments[1],h=null,l=new Qht;for(l.add(s);!l.isEmpty()&&a>0;){var u=l.poll(),c=u.getDistance();if(c>=a)break;u.isLeaves()?(a=c,h=u):u.expandToQueue(l,a)}return[h.getBoundable(0).getItem(),h.getBoundable(1).getItem()]}}else if(3===arguments.length){var A=arguments[2],f=new Zht(arguments[0],arguments[1]),d=new tlt(this.getRoot(),f,A);return this.nearestNeighbour(d)[0]}},e.prototype.interfaces_=function(){return[Yht,rst]},e.prototype.getClass=function(){return e},e.centreX=function(t){return e.avg(t.getMinX(),t.getMaxX())},e.avg=function(t,e){return(t+e)/2},e.centreY=function(t){return e.avg(t.getMinY(),t.getMaxY())},n.STRtreeNode.get=function(){return slt},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[ist]},compare:function(n,i){return t.compareDoubles(e.centreX(n.getBounds()),e.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[ist]},compare:function(n,i){return t.compareDoubles(e.centreY(n.getBounds()),e.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(t,e){return t.intersects(e)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(elt),slt=function(t){function e(){t.call(this,arguments[0])}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.computeBounds=function(){for(var t=null,e=this.getChildBoundables().iterator();e.hasNext();){var n=e.next();null===t?t=new Tst(n.getBounds()):t.expandToInclude(n.getBounds())}return t},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Jht),alt=function(){};alt.prototype.interfaces_=function(){return[]},alt.prototype.getClass=function(){return alt},alt.relativeSign=function(t,e){return t<e?-1:t>e?1:0},alt.compare=function(t,e,n){if(e.equals2D(n))return 0;var i=alt.relativeSign(e.x,n.x),r=alt.relativeSign(e.y,n.y);switch(t){case 0:return alt.compareValue(i,r);case 1:return alt.compareValue(r,i);case 2:return alt.compareValue(r,-i);case 3:return alt.compareValue(-i,r);case 4:return alt.compareValue(-i,-r);case 5:return alt.compareValue(-r,-i);case 6:return alt.compareValue(-r,i);case 7:return alt.compareValue(i,-r)}return Fst.shouldNeverReachHere("invalid octant value"),0},alt.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var hlt=function(){this.fi=null,this.coord=null,this.segmentIndex=null,this.ci=null,this.ai=null;var t=arguments[0],e=arguments[1],n=arguments[2],i=arguments[3];this.fi=t,this.coord=new ost(e),this.segmentIndex=n,this.ci=i,this.ai=!e.equals2D(t.getCoordinate(n))};hlt.prototype.getCoordinate=function(){return this.coord},hlt.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)},hlt.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:alt.compare(this.ci,this.coord,e.coord)},hlt.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&!this.ai||this.segmentIndex===t},hlt.prototype.isInterior=function(){return this.ai},hlt.prototype.interfaces_=function(){return[est]},hlt.prototype.getClass=function(){return hlt};var llt=function(){this.vi=new Cat,this.En=null,this.En=arguments[0]};llt.prototype.getSplitCoordinates=function(){var t=new hat;this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next();this.addEdgeCoordinates(n,i,t),n=i}return t.toCoordinateArray()},llt.prototype.addCollapsedNodes=function(){var t=new sat;this.findCollapsesFromInsertedNodes(t),this.findCollapsesFromExistingVertices(t);for(var e=t.iterator();e.hasNext();){var n=e.next().intValue();this.add(this.En.getCoordinate(n),n)}},llt.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},llt.prototype.findCollapsesFromExistingVertices=function(t){for(var e=0;e<this.En.size()-2;e++){var n=this.En.getCoordinate(e),i=this.En.getCoordinate(e+2);n.equals2D(i)&&t.add(new pst(e+1))}},llt.prototype.addEdgeCoordinates=function(t,e,n){var i=this.En.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(i);n.add(new ost(t.coord),!1);for(var o=t.segmentIndex+1;o<=e.segmentIndex;o++)n.add(this.En.getCoordinate(o));r&&n.add(new ost(e.coord))},llt.prototype.iterator=function(){return this.vi.values().iterator()},llt.prototype.addSplitEdges=function(t){this.addEndpoints(),this.addCollapsedNodes();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}},llt.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var i=e.segmentIndex-t.segmentIndex;return e.isInterior()||i--,1===i&&(n[0]=t.segmentIndex+1,!0)},llt.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,e)&&t.add(new pst(e[0])),i=r}},llt.prototype.getEdge=function(){return this.En},llt.prototype.addEndpoints=function(){var t=this.En.size()-1;this.add(this.En.getCoordinate(0),0),this.add(this.En.getCoordinate(t),t)},llt.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=this.En.getCoordinate(e.segmentIndex),r=e.isInterior()||!e.coord.equals2D(i);r||n--;var o=new Array(n).fill(null),s=0;o[s++]=new ost(t.coord);for(var a=t.segmentIndex+1;a<=e.segmentIndex;a++)o[s++]=this.En.getCoordinate(a);return r&&(o[s]=new ost(e.coord)),new flt(o,this.En.getData())},llt.prototype.add=function(t,e){var n=new hlt(this.En,t,e,this.En.getSegmentOctant(e)),i=this.vi.get(n);return null!==i?(Fst.isTrue(i.coord.equals2D(t),"Found equal nodes with different coordinates"),i):(this.vi.put(n,n),n)},llt.prototype.checkSplitEdgesCorrectness=function(t){var e=this.En.getCoordinates(),n=t.get(0).getCoordinate(0);if(!n.equals2D(e[0]))throw new kst("bad split edge start point at "+n);var i=t.get(t.size()-1).getCoordinates(),r=i[i.length-1];if(!r.equals2D(e[e.length-1]))throw new kst("bad split edge end point at "+r)},llt.prototype.interfaces_=function(){return[]},llt.prototype.getClass=function(){return llt};var ult=function(){};ult.prototype.interfaces_=function(){return[]},ult.prototype.getClass=function(){return ult},ult.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var t=arguments[0],e=arguments[1];if(0===t&&0===e)throw new Kot("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),i=Math.abs(e);return t>=0?e>=0?n>=i?0:1:n>=i?7:6:e>=0?n>=i?3:2:n>=i?4:5}if(arguments[0]instanceof ost&&arguments[1]instanceof ost){var r=arguments[0],o=arguments[1],s=o.x-r.x,a=o.y-r.y;if(0===s&&0===a)throw new Kot("Cannot compute the octant for two identical points "+r);return ult.octant(s,a)}};var clt=function(){};clt.prototype.getCoordinates=function(){},clt.prototype.size=function(){},clt.prototype.getCoordinate=function(t){},clt.prototype.isClosed=function(){},clt.prototype.setData=function(t){},clt.prototype.getData=function(){},clt.prototype.interfaces_=function(){return[]},clt.prototype.getClass=function(){return clt};var Alt=function(){};Alt.prototype.addIntersection=function(t,e){},Alt.prototype.interfaces_=function(){return[clt]},Alt.prototype.getClass=function(){return Alt};var flt=function(){this.li=new llt(this),this.dn=null,this.wi=null;var t=arguments[1];this.dn=arguments[0],this.wi=t};flt.prototype.getCoordinates=function(){return this.dn},flt.prototype.size=function(){return this.dn.length},flt.prototype.getCoordinate=function(t){return this.dn[t]},flt.prototype.isClosed=function(){return this.dn[0].equals(this.dn[this.dn.length-1])},flt.prototype.getSegmentOctant=function(t){return t===this.dn.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))},flt.prototype.setData=function(t){this.wi=t},flt.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:ult.octant(t,e)},flt.prototype.getData=function(){return this.wi},flt.prototype.addIntersection=function(){if(2===arguments.length)this.addIntersectionNode(arguments[0],arguments[1]);else if(4===arguments.length){var t=arguments[1],e=new ost(arguments[0].getIntersection(arguments[3]));this.addIntersection(e,t)}},flt.prototype.toString=function(){return Dst.toLineString(new sht(this.dn))},flt.prototype.getNodeList=function(){return this.li},flt.prototype.addIntersectionNode=function(t,e){var n=e,i=n+1;return i<this.dn.length&&t.equals2D(this.dn[i])&&(n=i),this.li.add(t,n)},flt.prototype.addIntersections=function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)},flt.prototype.interfaces_=function(){return[Alt]},flt.prototype.getClass=function(){return flt},flt.getNodedSubstrings=function(){if(1===arguments.length){var t=arguments[0],e=new sat;return flt.getNodedSubstrings(t,e),e}if(2===arguments.length)for(var n=arguments[1],i=arguments[0].iterator();i.hasNext();)i.next().getNodeList().addSplitEdges(n)};var dlt=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new ost,this.p1=new ost;else if(1===arguments.length){var t=arguments[0];this.p0=new ost(t.p0),this.p1=new ost(t.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var e=arguments[2],n=arguments[3];this.p0=new ost(arguments[0],arguments[1]),this.p1=new ost(e,n)}},plt={serialVersionUID:{configurable:!0}};dlt.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},dlt.prototype.orientationIndex=function(){if(arguments[0]instanceof dlt){var t=arguments[0],e=Ust.orientationIndex(this.p0,this.p1,t.p0),n=Ust.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}if(arguments[0]instanceof ost)return Ust.orientationIndex(this.p0,this.p1,arguments[0])},dlt.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])},dlt.prototype.isVertical=function(){return this.p0.x===this.p1.x},dlt.prototype.equals=function(t){if(!(t instanceof dlt))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)},dlt.prototype.intersection=function(t){var e=new Bst;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null},dlt.prototype.project=function(){if(arguments[0]instanceof ost){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new ost(t);var e=this.projectionFactor(t),n=new ost;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof dlt){var i=arguments[0],r=this.projectionFactor(i.p0),o=this.projectionFactor(i.p1);if(r>=1&&o>=1)return null;if(r<=0&&o<=0)return null;var s=this.project(i.p0);r<0&&(s=this.p0),r>1&&(s=this.p1);var a=this.project(i.p1);return o<0&&(a=this.p0),o>1&&(a=this.p1),new dlt(s,a)}},dlt.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},dlt.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},dlt.prototype.getCoordinate=function(t){return 0===t?this.p0:this.p1},dlt.prototype.distancePerpendicular=function(t){return Ust.distancePointLinePerpendicular(t,this.p0,this.p1)},dlt.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},dlt.prototype.midPoint=function(){return dlt.midPoint(this.p0,this.p1)},dlt.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=e*e+n*n;return i<=0?$ot.NaN:((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/i},dlt.prototype.closestPoints=function(t){var e=this.intersection(t);if(null!==e)return[e,e];var n=new Array(2).fill(null),i=$ot.MAX_VALUE,r=null,o=this.closestPoint(t.p0);i=o.distance(t.p0),n[0]=o,n[1]=t.p0;var s=this.closestPoint(t.p1);(r=s.distance(t.p1))<i&&(i=r,n[0]=s,n[1]=t.p1);var a=t.closestPoint(this.p0);(r=a.distance(this.p0))<i&&(i=r,n[0]=this.p0,n[1]=a);var h=t.closestPoint(this.p1);return(r=h.distance(this.p1))<i&&(i=r,n[0]=this.p1,n[1]=h),n},dlt.prototype.closestPoint=function(t){var e=this.projectionFactor(t);return e>0&&e<1?this.project(t):this.p0.distance(t)<this.p1.distance(t)?this.p0:this.p1},dlt.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},dlt.prototype.getLength=function(){return this.p0.distance(this.p1)},dlt.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return 0!==n?n:this.p1.compareTo(e.p1)},dlt.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t},dlt.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)},dlt.prototype.lineIntersection=function(t){try{return Mst.intersection(this.p0,this.p1,t.p0,t.p1)}catch(e){if(!(e instanceof Cst))throw e}return null},dlt.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},dlt.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),i=this.p0.y+t*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,o=this.p1.y-this.p0.y,s=Math.sqrt(r*r+o*o),a=0,h=0;if(0!==e){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");a=e*r/s,h=e*o/s}return new ost(n-h,i+a)},dlt.prototype.setCoordinates=function(){if(1===arguments.length){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(2===arguments.length){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}},dlt.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||$ot.isNaN(e))&&(e=1),e},dlt.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},dlt.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},dlt.prototype.distance=function(){if(arguments[0]instanceof dlt){var t=arguments[0];return Ust.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}if(arguments[0]instanceof ost)return Ust.distancePointLine(arguments[0],this.p0,this.p1)},dlt.prototype.pointAlong=function(t){var e=new ost;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e},dlt.prototype.hashCode=function(){var t=$ot.doubleToLongBits(this.p0.x);t^=31*$ot.doubleToLongBits(this.p0.y);var e=Math.trunc(t)^Math.trunc(t>>32),n=$ot.doubleToLongBits(this.p1.x);return n^=31*$ot.doubleToLongBits(this.p1.y),e^Math.trunc(n)^Math.trunc(n>>32)},dlt.prototype.interfaces_=function(){return[est,rst]},dlt.prototype.getClass=function(){return dlt},dlt.midPoint=function(t,e){return new ost((t.x+e.x)/2,(t.y+e.y)/2)},plt.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(dlt,plt);var glt=function(){this.tempEnv1=new Tst,this.tempEnv2=new Tst,this.Pi=new dlt,this.gi=new dlt};glt.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var t=arguments[2],e=arguments[3];arguments[0].getLineSegment(arguments[1],this.Pi),t.getLineSegment(e,this.gi),this.overlap(this.Pi,this.gi)}},glt.prototype.interfaces_=function(){return[]},glt.prototype.getClass=function(){return glt};var mlt=function(){this.dn=null,this.Ci=null,this.Di=null,this.In=null,this.Ii=null,this.bi=null;var t=arguments[1],e=arguments[2],n=arguments[3];this.dn=arguments[0],this.Ci=t,this.Di=e,this.Ii=n};mlt.prototype.getLineSegment=function(t,e){e.p0=this.dn[t],e.p1=this.dn[t+1]},mlt.prototype.computeSelect=function(t,e,n,i){if(i.tempEnv1.init(this.dn[e],this.dn[n]),n-e==1)return i.select(this,e),null;if(!t.intersects(i.tempEnv1))return null;var r=Math.trunc((e+n)/2);e<r&&this.computeSelect(t,e,r,i),r<n&&this.computeSelect(t,r,n,i)},mlt.prototype.getCoordinates=function(){for(var t=new Array(this.Di-this.Ci+1).fill(null),e=0,n=this.Ci;n<=this.Di;n++)t[e++]=this.dn[n];return t},mlt.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this.Ci,this.Di,t,t.Ci,t.Di,e)},mlt.prototype.setId=function(t){this.bi=t},mlt.prototype.select=function(t,e){this.computeSelect(t,this.Ci,this.Di,e)},mlt.prototype.getEnvelope=function(){return null===this.In&&(this.In=new Tst(this.dn[this.Ci],this.dn[this.Di])),this.In},mlt.prototype.getEndIndex=function(){return this.Di},mlt.prototype.getStartIndex=function(){return this.Ci},mlt.prototype.getContext=function(){return this.Ii},mlt.prototype.getId=function(){return this.bi},mlt.prototype.computeOverlapsInternal=function(t,e,n,i,r,o){var s=this.dn[t],a=this.dn[e],h=n.dn[i],l=n.dn[r];if(e-t==1&&r-i==1)return o.overlap(this,t,n,i),null;if(o.tempEnv1.init(s,a),o.tempEnv2.init(h,l),!o.tempEnv1.intersects(o.tempEnv2))return null;var u=Math.trunc((t+e)/2),c=Math.trunc((i+r)/2);t<u&&(i<c&&this.computeOverlapsInternal(t,u,n,i,c,o),c<r&&this.computeOverlapsInternal(t,u,n,c,r,o)),u<e&&(i<c&&this.computeOverlapsInternal(u,e,n,i,c,o),c<r&&this.computeOverlapsInternal(u,e,n,c,r,o))},mlt.prototype.interfaces_=function(){return[]},mlt.prototype.getClass=function(){return mlt};var ylt=function(){};ylt.prototype.interfaces_=function(){return[]},ylt.prototype.getClass=function(){return ylt},ylt.getChainStartIndices=function(t){var e=0,n=new sat;n.add(new pst(e));do{var i=ylt.findChainEnd(t,e);n.add(new pst(i)),e=i}while(e<t.length-1);return ylt.toIntArray(n)},ylt.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var i=Bht.quadrant(t[n],t[n+1]),r=e+1;r<t.length&&(t[r-1].equals2D(t[r])||Bht.quadrant(t[r-1],t[r])===i);)r++;return r-1},ylt.getChains=function(){if(1===arguments.length)return ylt.getChains(arguments[0],null);if(2===arguments.length){for(var t=arguments[0],e=arguments[1],n=new sat,i=ylt.getChainStartIndices(t),r=0;r<i.length-1;r++){var o=new mlt(t,i[r],i[r+1],e);n.add(o)}return n}},ylt.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var vlt=function(){};vlt.prototype.computeNodes=function(t){},vlt.prototype.getNodedSubstrings=function(){},vlt.prototype.interfaces_=function(){return[]},vlt.prototype.getClass=function(){return vlt};var _lt=function(){this.Mi=null,0===arguments.length||1===arguments.length&&this.setSegmentIntersector(arguments[0])};_lt.prototype.setSegmentIntersector=function(t){this.Mi=t},_lt.prototype.interfaces_=function(){return[vlt]},_lt.prototype.getClass=function(){return _lt};var xlt=function(t){function e(e){e?t.call(this,e):t.call(this),this.zi=new sat,this.di=new olt,this.xi=0,this.mi=null,this.yi=0}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this.zi},e.prototype.getNodedSubstrings=function(){return flt.getNodedSubstrings(this.mi)},e.prototype.getIndex=function(){return this.di},e.prototype.add=function(t){for(var e=this,n=ylt.getChains(t.getCoordinates(),t).iterator();n.hasNext();){var i=n.next();i.setId(e.xi++),e.di.insert(i.getEnvelope(),i),e.zi.add(i)}},e.prototype.computeNodes=function(t){this.mi=t;for(var e=t.iterator();e.hasNext();)this.add(e.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var t=this,e=new blt(this.Mi),n=this.zi.iterator();n.hasNext();)for(var i=n.next(),r=t.di.query(i.getEnvelope()).iterator();r.hasNext();){var o=r.next();if(o.getId()>i.getId()&&(i.computeOverlaps(o,e),t.yi++),t.Mi.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return blt},Object.defineProperties(e,n),e}(_lt),blt=function(t){function e(){t.call(this),this.pi=null,this.pi=arguments[0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.overlap=function(){if(4!==arguments.length)return t.prototype.overlap.apply(this,arguments);var e=arguments[1],n=arguments[2],i=arguments[3],r=arguments[0].getContext(),o=n.getContext();this.pi.processIntersections(r,e,o,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(glt),wlt=function t(){if(this.Li=t.DEFAULT_QUADRANT_SEGMENTS,this.Ti=t.CAP_ROUND,this.Oi=t.JOIN_ROUND,this.Fi=t.DEFAULT_MITRE_LIMIT,this.Ui=!1,this.Ei=t.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length)this.setQuadrantSegments(arguments[0]);else if(2===arguments.length){var e=arguments[1];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(e)}else if(4===arguments.length){var n=arguments[1],i=arguments[2],r=arguments[3];this.setQuadrantSegments(arguments[0]),this.setEndCapStyle(n),this.setJoinStyle(i),this.setMitreLimit(r)}},Clt={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};wlt.prototype.getEndCapStyle=function(){return this.Ti},wlt.prototype.isSingleSided=function(){return this.Ui},wlt.prototype.setQuadrantSegments=function(t){this.Li=t,0===this.Li&&(this.Oi=wlt.JOIN_BEVEL),this.Li<0&&(this.Oi=wlt.JOIN_MITRE,this.Fi=Math.abs(this.Li)),t<=0&&(this.Li=1),this.Oi!==wlt.JOIN_ROUND&&(this.Li=wlt.DEFAULT_QUADRANT_SEGMENTS)},wlt.prototype.getJoinStyle=function(){return this.Oi},wlt.prototype.setJoinStyle=function(t){this.Oi=t},wlt.prototype.setSimplifyFactor=function(t){this.Ei=t<0?0:t},wlt.prototype.getSimplifyFactor=function(){return this.Ei},wlt.prototype.getQuadrantSegments=function(){return this.Li},wlt.prototype.setEndCapStyle=function(t){this.Ti=t},wlt.prototype.getMitreLimit=function(){return this.Fi},wlt.prototype.setMitreLimit=function(t){this.Fi=t},wlt.prototype.setSingleSided=function(t){this.Ui=t},wlt.prototype.interfaces_=function(){return[]},wlt.prototype.getClass=function(){return wlt},wlt.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)},Clt.CAP_ROUND.get=function(){return 1},Clt.CAP_FLAT.get=function(){return 2},Clt.CAP_SQUARE.get=function(){return 3},Clt.JOIN_ROUND.get=function(){return 1},Clt.JOIN_MITRE.get=function(){return 2},Clt.JOIN_BEVEL.get=function(){return 3},Clt.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Clt.DEFAULT_MITRE_LIMIT.get=function(){return 5},Clt.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(wlt,Clt);var Plt=function(t){this.Ni=null,this.ji=null,this.Qi=Ust.COUNTERCLOCKWISE,this.Si=t||null},Mlt={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Plt.prototype.isDeletable=function(t,e,n,i){var r=this.Si[t],o=this.Si[e],s=this.Si[n];return!!this.isConcave(r,o,s)&&!!this.isShallow(r,o,s,i)&&this.isShallowSampled(r,o,t,n,i)},Plt.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),i=this.findNextNonDeletedIndex(n),r=!1;i<this.Si.length;){var o=!1;t.isDeletable(e,n,i,t.Ni)&&(t.ji[n]=Plt.DELETE,o=!0,r=!0),n=t.findNextNonDeletedIndex(e=o?i:n),i=t.findNextNonDeletedIndex(n)}return r},Plt.prototype.isShallowConcavity=function(t,e,n,i){return Ust.computeOrientation(t,e,n)===this.Qi&&Ust.distancePointLine(e,t,n)<i},Plt.prototype.isShallowSampled=function(t,e,n,i,r){var o=Math.trunc((i-n)/Plt.NUM_PTS_TO_CHECK);o<=0&&(o=1);for(var s=n;s<i;s+=o)if(!this.isShallow(t,e,this.Si[s],r))return!1;return!0},Plt.prototype.isConcave=function(t,e,n){return Ust.computeOrientation(t,e,n)===this.Qi},Plt.prototype.simplify=function(t){this.Ni=Math.abs(t),t<0&&(this.Qi=Ust.CLOCKWISE),this.ji=new Array(this.Si.length).fill(null);var e=!1;do{e=this.deleteShallowConcavities()}while(e);return this.collapseLine()},Plt.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this.Si.length&&this.ji[e]===Plt.DELETE;)e++;return e},Plt.prototype.isShallow=function(t,e,n,i){return Ust.distancePointLine(e,t,n)<i},Plt.prototype.collapseLine=function(){for(var t=new hat,e=0;e<this.Si.length;e++)this.ji[e]!==Plt.DELETE&&t.add(this.Si[e]);return t.toCoordinateArray()},Plt.prototype.interfaces_=function(){return[]},Plt.prototype.getClass=function(){return Plt},Plt.simplify=function(t,e){return new Plt(t).simplify(e)},Mlt.INIT.get=function(){return 0},Mlt.DELETE.get=function(){return 1},Mlt.KEEP.get=function(){return 1},Mlt.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(Plt,Mlt);var Tlt=function(){this.Bi=null,this.Wt=null,this.ki=0,this.Bi=new sat},Slt={COORDINATE_ARRAY_TYPE:{configurable:!0}};Tlt.prototype.getCoordinates=function(){return this.Bi.toArray(Tlt.COORDINATE_ARRAY_TYPE)},Tlt.prototype.setPrecisionModel=function(t){this.Wt=t},Tlt.prototype.addPt=function(t){var e=new ost(t);if(this.Wt.makePrecise(e),this.isRedundant(e))return null;this.Bi.add(e)},Tlt.prototype.revere=function(){},Tlt.prototype.addPts=function(t,e){if(e)for(var n=0;n<t.length;n++)this.addPt(t[n]);else for(var i=t.length-1;i>=0;i--)this.addPt(t[i])},Tlt.prototype.isRedundant=function(t){if(this.Bi.size()<1)return!1;var e=this.Bi.get(this.Bi.size()-1);return t.distance(e)<this.ki},Tlt.prototype.toString=function(){return(new pht).createLineString(this.getCoordinates()).toString()},Tlt.prototype.closeRing=function(){if(this.Bi.size()<1)return null;var t=new ost(this.Bi.get(0)),e=this.Bi.get(this.Bi.size()-1);if(t.equals(e))return null;this.Bi.add(t)},Tlt.prototype.setMinimumVertexDistance=function(t){this.ki=t},Tlt.prototype.interfaces_=function(){return[]},Tlt.prototype.getClass=function(){return Tlt},Slt.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Tlt,Slt);var Ilt=function(){},Elt={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Ilt.prototype.interfaces_=function(){return[]},Ilt.prototype.getClass=function(){return Ilt},Ilt.toDegrees=function(t){return 180*t/Math.PI},Ilt.normalize=function(t){for(;t>Math.PI;)t-=Ilt.PI_TIMES_2;for(;t<=-Math.PI;)t+=Ilt.PI_TIMES_2;return t},Ilt.angle=function(){if(1===arguments.length){var t=arguments[0];return Math.atan2(t.y,t.x)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return Math.atan2(n.y-e.y,n.x-e.x)}},Ilt.isAcute=function(t,e,n){return(t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y)>0},Ilt.isObtuse=function(t,e,n){return(t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y)<0},Ilt.interiorAngle=function(t,e,n){var i=Ilt.angle(e,t),r=Ilt.angle(e,n);return Math.abs(r-i)},Ilt.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Ilt.PI_TIMES_2;t>=Ilt.PI_TIMES_2&&(t=0)}else{for(;t>=Ilt.PI_TIMES_2;)t-=Ilt.PI_TIMES_2;t<0&&(t=0)}return t},Ilt.angleBetween=function(t,e,n){var i=Ilt.angle(e,t),r=Ilt.angle(e,n);return Ilt.diff(i,r)},Ilt.diff=function(t,e){var n=null;return(n=t<e?e-t:t-e)>Math.PI&&(n=2*Math.PI-n),n},Ilt.toRadians=function(t){return t*Math.PI/180},Ilt.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Ilt.COUNTERCLOCKWISE:n<0?Ilt.CLOCKWISE:Ilt.NONE},Ilt.angleBetweenOriented=function(t,e,n){var i=Ilt.angle(e,t),r=Ilt.angle(e,n)-i;return r<=-Math.PI?r+Ilt.PI_TIMES_2:r>Math.PI?r-Ilt.PI_TIMES_2:r},Elt.PI_TIMES_2.get=function(){return 2*Math.PI},Elt.PI_OVER_2.get=function(){return Math.PI/2},Elt.PI_OVER_4.get=function(){return Math.PI/4},Elt.COUNTERCLOCKWISE.get=function(){return Ust.COUNTERCLOCKWISE},Elt.CLOCKWISE.get=function(){return Ust.CLOCKWISE},Elt.NONE.get=function(){return Ust.COLLINEAR},Object.defineProperties(Ilt,Elt);var Olt=function t(){this.Ri=0,this.Gi=null,this.Yi=1,this.qi=null,this.ri=0,this.Wt=null,this.Vi=null,this.Wi=null,this._i=null,this.Ki=null,this.Hi=null,this.Ji=new dlt,this.Zi=new dlt,this.Xi=new dlt,this.$i=new dlt,this.Ar=0,this.tr=!1;var e=arguments[1],n=arguments[2];this.Wt=arguments[0],this.Vi=e,this.Wi=new Bst,this.Gi=Math.PI/2/e.getQuadrantSegments(),e.getQuadrantSegments()>=8&&e.getJoinStyle()===wlt.JOIN_ROUND&&(this.Yi=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(n)},Rlt={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Olt.prototype.addNextSegment=function(t,e){if(this._i=this.Ki,this.Ki=this.Hi,this.Hi=t,this.Ji.setCoordinates(this._i,this.Ki),this.computeOffsetSegment(this.Ji,this.Ar,this.ri,this.Xi),this.Zi.setCoordinates(this.Ki,this.Hi),this.computeOffsetSegment(this.Zi,this.Ar,this.ri,this.$i),this.Ki.equals(this.Hi))return null;var n=Ust.computeOrientation(this._i,this.Ki,this.Hi),i=n===Ust.CLOCKWISE&&this.Ar===wht.LEFT||n===Ust.COUNTERCLOCKWISE&&this.Ar===wht.RIGHT;0===n?this.addCollinear(e):i?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)},Olt.prototype.addLineEndCap=function(t,e){var n=new dlt(t,e),i=new dlt;this.computeOffsetSegment(n,wht.LEFT,this.ri,i);var r=new dlt;this.computeOffsetSegment(n,wht.RIGHT,this.ri,r);var o=Math.atan2(e.y-t.y,e.x-t.x);switch(this.Vi.getEndCapStyle()){case wlt.CAP_ROUND:this.qi.addPt(i.p1),this.addFilletArc(e,o+Math.PI/2,o-Math.PI/2,Ust.CLOCKWISE,this.ri),this.qi.addPt(r.p1);break;case wlt.CAP_FLAT:this.qi.addPt(i.p1),this.qi.addPt(r.p1);break;case wlt.CAP_SQUARE:var s=new ost;s.x=Math.abs(this.ri)*Math.cos(o),s.y=Math.abs(this.ri)*Math.sin(o);var a=new ost(i.p1.x+s.x,i.p1.y+s.y),h=new ost(r.p1.x+s.x,r.p1.y+s.y);this.qi.addPt(a),this.qi.addPt(h)}},Olt.prototype.getCoordinates=function(){return this.qi.getCoordinates()},Olt.prototype.addMitreJoin=function(t,e,n,i){var r=!0,o=null;try{o=Mst.intersection(e.p0,e.p1,n.p0,n.p1),(i<=0?1:o.distance(t)/Math.abs(i))>this.Vi.getMitreLimit()&&(r=!1)}catch(s){if(!(s instanceof Cst))throw s;o=new ost(0,0),r=!1}r?this.qi.addPt(o):this.addLimitedMitreJoin(e,n,i,this.Vi.getMitreLimit())},Olt.prototype.addFilletCorner=function(t,e,n,i,r){var o=Math.atan2(e.y-t.y,e.x-t.x),s=Math.atan2(n.y-t.y,n.x-t.x);i===Ust.CLOCKWISE?o<=s&&(o+=2*Math.PI):o>=s&&(o-=2*Math.PI),this.qi.addPt(e),this.addFilletArc(t,o,s,i,r),this.qi.addPt(n)},Olt.prototype.addOutsideTurn=function(t,e){if(this.Xi.p1.distance(this.$i.p0)<this.ri*Olt.OFFSET_SEGMENT_SEPARATION_FACTOR)return this.qi.addPt(this.Xi.p1),null;this.Vi.getJoinStyle()===wlt.JOIN_MITRE?this.addMitreJoin(this.Ki,this.Xi,this.$i,this.ri):this.Vi.getJoinStyle()===wlt.JOIN_BEVEL?this.addBevelJoin(this.Xi,this.$i):(e&&this.qi.addPt(this.Xi.p1),this.addFilletCorner(this.Ki,this.Xi.p1,this.$i.p0,t,this.ri),this.qi.addPt(this.$i.p0))},Olt.prototype.createSquare=function(t){this.qi.addPt(new ost(t.x+this.ri,t.y+this.ri)),this.qi.addPt(new ost(t.x+this.ri,t.y-this.ri)),this.qi.addPt(new ost(t.x-this.ri,t.y-this.ri)),this.qi.addPt(new ost(t.x-this.ri,t.y+this.ri)),this.qi.closeRing()},Olt.prototype.addSegments=function(t,e){this.qi.addPts(t,e)},Olt.prototype.addFirstSegment=function(){this.qi.addPt(this.$i.p0)},Olt.prototype.addLastSegment=function(){this.qi.addPt(this.$i.p1)},Olt.prototype.initSideSegments=function(t,e,n){this.Ki=t,this.Hi=e,this.Ar=n,this.Zi.setCoordinates(t,e),this.computeOffsetSegment(this.Zi,n,this.ri,this.$i)},Olt.prototype.addLimitedMitreJoin=function(t,e,n,i){var r=this.Ji.p1,o=Ilt.angle(r,this.Ji.p0),s=Ilt.angleBetweenOriented(this.Ji.p0,r,this.Zi.p1)/2,a=Ilt.normalize(o+s),h=Ilt.normalize(a+Math.PI),l=i*n,u=n-l*Math.abs(Math.sin(s)),c=r.x+l*Math.cos(h),A=r.y+l*Math.sin(h),f=new ost(c,A),d=new dlt(r,f),p=d.pointAlongOffset(1,u),g=d.pointAlongOffset(1,-u);this.Ar===wht.LEFT?(this.qi.addPt(p),this.qi.addPt(g)):(this.qi.addPt(g),this.qi.addPt(p))},Olt.prototype.computeOffsetSegment=function(t,e,n,i){var r=e===wht.LEFT?1:-1,o=t.p1.x-t.p0.x,s=t.p1.y-t.p0.y,a=Math.sqrt(o*o+s*s),h=r*n*o/a,l=r*n*s/a;i.p0.x=t.p0.x-l,i.p0.y=t.p0.y+h,i.p1.x=t.p1.x-l,i.p1.y=t.p1.y+h},Olt.prototype.addFilletArc=function(t,e,n,i,r){var o=i===Ust.CLOCKWISE?-1:1,s=Math.abs(e-n),a=Math.trunc(s/this.Gi+.5);if(a<1)return null;for(var h=s/a,l=0,u=new ost;l<s;){var c=e+o*l;u.x=t.x+r*Math.cos(c),u.y=t.y+r*Math.sin(c),this.qi.addPt(u),l+=h}},Olt.prototype.addInsideTurn=function(t,e){if(this.Wi.computeIntersection(this.Xi.p0,this.Xi.p1,this.$i.p0,this.$i.p1),this.Wi.hasIntersection())this.qi.addPt(this.Wi.getIntersection(0));else if(this.tr=!0,this.Xi.p1.distance(this.$i.p0)<this.ri*Olt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.qi.addPt(this.Xi.p1);else{if(this.qi.addPt(this.Xi.p1),this.Yi>0){var n=new ost((this.Yi*this.Xi.p1.x+this.Ki.x)/(this.Yi+1),(this.Yi*this.Xi.p1.y+this.Ki.y)/(this.Yi+1));this.qi.addPt(n);var i=new ost((this.Yi*this.$i.p0.x+this.Ki.x)/(this.Yi+1),(this.Yi*this.$i.p0.y+this.Ki.y)/(this.Yi+1));this.qi.addPt(i)}else this.qi.addPt(this.Ki);this.qi.addPt(this.$i.p0)}},Olt.prototype.createCircle=function(t){var e=new ost(t.x+this.ri,t.y);this.qi.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this.ri),this.qi.closeRing()},Olt.prototype.addBevelJoin=function(t,e){this.qi.addPt(t.p1),this.qi.addPt(e.p0)},Olt.prototype.init=function(t){this.ri=t,this.Ri=t*(1-Math.cos(this.Gi/2)),this.qi=new Tlt,this.qi.setPrecisionModel(this.Wt),this.qi.setMinimumVertexDistance(t*Olt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Olt.prototype.addCollinear=function(t){this.Wi.computeIntersection(this._i,this.Ki,this.Ki,this.Hi),this.Wi.getIntersectionNum()>=2&&(this.Vi.getJoinStyle()===wlt.JOIN_BEVEL||this.Vi.getJoinStyle()===wlt.JOIN_MITRE?(t&&this.qi.addPt(this.Xi.p1),this.qi.addPt(this.$i.p0)):this.addFilletCorner(this.Ki,this.Xi.p1,this.$i.p0,Ust.CLOCKWISE,this.ri))},Olt.prototype.closeRing=function(){this.qi.closeRing()},Olt.prototype.hasNarrowConcaveAngle=function(){return this.tr},Olt.prototype.interfaces_=function(){return[]},Olt.prototype.getClass=function(){return Olt},Rlt.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},Rlt.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},Rlt.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},Rlt.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Olt,Rlt);var Dlt=function(){this.ri=0,this.Wt=null,this.Vi=null;var t=arguments[1];this.Wt=arguments[0],this.Vi=t};Dlt.prototype.getOffsetCurve=function(t,e){if(this.ri=e,0===e)return null;var n=e<0,i=Math.abs(e),r=this.getSegGen(i);t.length<=1?this.computePointCurve(t[0],r):this.computeOffsetCurve(t,n,r);var o=r.getCoordinates();return n&&lat.reverse(o),o},Dlt.prototype.computeSingleSidedBufferCurve=function(t,e,n){var i=this.simplifyTolerance(this.ri);if(e){n.addSegments(t,!0);var r=Plt.simplify(t,-i),o=r.length-1;n.initSideSegments(r[o],r[o-1],wht.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{n.addSegments(t,!1);var a=Plt.simplify(t,i),h=a.length-1;n.initSideSegments(a[0],a[1],wht.LEFT),n.addFirstSegment();for(var l=2;l<=h;l++)n.addNextSegment(a[l],!0)}n.addLastSegment(),n.closeRing()},Dlt.prototype.computeRingBufferCurve=function(t,e,n){var i=this.simplifyTolerance(this.ri);e===wht.RIGHT&&(i=-i);var r=Plt.simplify(t,i),o=r.length-1;n.initSideSegments(r[o-1],r[0],e);for(var s=1;s<=o;s++)n.addNextSegment(r[s],1!==s);n.closeRing()},Dlt.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this.ri),i=Plt.simplify(t,n),r=i.length-1;e.initSideSegments(i[0],i[1],wht.LEFT);for(var o=2;o<=r;o++)e.addNextSegment(i[o],!0);e.addLastSegment(),e.addLineEndCap(i[r-1],i[r]);var s=Plt.simplify(t,-n),a=s.length-1;e.initSideSegments(s[a],s[a-1],wht.LEFT);for(var h=a-2;h>=0;h--)e.addNextSegment(s[h],!0);e.addLastSegment(),e.addLineEndCap(s[1],s[0]),e.closeRing()},Dlt.prototype.computePointCurve=function(t,e){switch(this.Vi.getEndCapStyle()){case wlt.CAP_ROUND:e.createCircle(t);break;case wlt.CAP_SQUARE:e.createSquare(t)}},Dlt.prototype.getLineCurve=function(t,e){if(this.ri=e,e<0&&!this.Vi.isSingleSided())return null;if(0===e)return null;var n=Math.abs(e),i=this.getSegGen(n);return t.length<=1?this.computePointCurve(t[0],i):this.Vi.isSingleSided()?this.computeSingleSidedBufferCurve(t,e<0,i):this.computeLineBufferCurve(t,i),i.getCoordinates()},Dlt.prototype.getBufferParameters=function(){return this.Vi},Dlt.prototype.simplifyTolerance=function(t){return t*this.Vi.getSimplifyFactor()},Dlt.prototype.getRingCurve=function(t,e,n){if(this.ri=n,t.length<=2)return this.getLineCurve(t,n);if(0===n)return Dlt.copyCoordinates(t);var i=this.getSegGen(n);return this.computeRingBufferCurve(t,e,i),i.getCoordinates()},Dlt.prototype.computeOffsetCurve=function(t,e,n){var i=this.simplifyTolerance(this.ri);if(e){var r=Plt.simplify(t,-i),o=r.length-1;n.initSideSegments(r[o],r[o-1],wht.LEFT),n.addFirstSegment();for(var s=o-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{var a=Plt.simplify(t,i),h=a.length-1;n.initSideSegments(a[0],a[1],wht.LEFT),n.addFirstSegment();for(var l=2;l<=h;l++)n.addNextSegment(a[l],!0)}n.addLastSegment()},Dlt.prototype.getSegGen=function(t){return new Olt(this.Wt,this.Vi,t)},Dlt.prototype.interfaces_=function(){return[]},Dlt.prototype.getClass=function(){return Dlt},Dlt.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new ost(t[n]);return e};var klt=function(){this.nr=null,this.ir=new dlt,this.rr=new Ust,this.nr=arguments[0]},Llt={DepthSegment:{configurable:!0}};klt.prototype.findStabbedSegments=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=new sat,i=this.nr.iterator();i.hasNext();){var r=i.next(),o=r.getEnvelope();e.y<o.getMinY()||e.y>o.getMaxY()||t.findStabbedSegments(e,r.getDirectedEdges(),n)}return n}if(3===arguments.length)if(cst(arguments[2],rat)&&arguments[0]instanceof ost&&arguments[1]instanceof Uht){for(var s=arguments[0],a=arguments[1],h=arguments[2],l=a.getEdge().getCoordinates(),u=0;u<l.length-1;u++)if(t.ir.p0=l[u],t.ir.p1=l[u+1],t.ir.p0.y>t.ir.p1.y&&t.ir.reverse(),!(Math.max(t.ir.p0.x,t.ir.p1.x)<s.x||t.ir.isHorizontal()||s.y<t.ir.p0.y||s.y>t.ir.p1.y||Ust.computeOrientation(t.ir.p0,t.ir.p1,s)===Ust.RIGHT)){var c=a.getDepth(wht.LEFT);t.ir.p0.equals(l[u])||(c=a.getDepth(wht.RIGHT));var A=new Flt(t.ir,c);h.add(A)}}else if(cst(arguments[2],rat)&&arguments[0]instanceof ost&&cst(arguments[1],rat))for(var f=arguments[0],d=arguments[2],p=arguments[1].iterator();p.hasNext();){var g=p.next();g.isForward()&&t.findStabbedSegments(f,g,d)}},klt.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);return 0===e.size()?0:$ht.min(e).er},klt.prototype.interfaces_=function(){return[]},klt.prototype.getClass=function(){return klt},Llt.DepthSegment.get=function(){return Flt},Object.defineProperties(klt,Llt);var Flt=function(){this.sr=null,this.er=null;var t=arguments[1];this.sr=new dlt(arguments[0]),this.er=t};Flt.prototype.compareTo=function(t){var e=t;if(this.sr.minX()>=e.sr.maxX())return 1;if(this.sr.maxX()<=e.sr.minX())return-1;var n=this.sr.orientationIndex(e.sr);return 0!==n||0!=(n=-1*e.sr.orientationIndex(this.sr))?n:this.sr.compareTo(e.sr)},Flt.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return 0!==n?n:t.p1.compareTo(e.p1)},Flt.prototype.toString=function(){return this.sr.toString()},Flt.prototype.interfaces_=function(){return[est]},Flt.prototype.getClass=function(){return Flt};var Nlt=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};Nlt.prototype.area=function(){return Nlt.area(this.p0,this.p1,this.p2)},Nlt.prototype.signedArea=function(){return Nlt.signedArea(this.p0,this.p1,this.p2)},Nlt.prototype.interpolateZ=function(t){if(null===t)throw new Kot("Supplied point is null.");return Nlt.interpolateZ(t,this.p0,this.p1,this.p2)},Nlt.prototype.longestSideLength=function(){return Nlt.longestSideLength(this.p0,this.p1,this.p2)},Nlt.prototype.isAcute=function(){return Nlt.isAcute(this.p0,this.p1,this.p2)},Nlt.prototype.circumcentre=function(){return Nlt.circumcentre(this.p0,this.p1,this.p2)},Nlt.prototype.area3D=function(){return Nlt.area3D(this.p0,this.p1,this.p2)},Nlt.prototype.centroid=function(){return Nlt.centroid(this.p0,this.p1,this.p2)},Nlt.prototype.inCentre=function(){return Nlt.inCentre(this.p0,this.p1,this.p2)},Nlt.prototype.interfaces_=function(){return[]},Nlt.prototype.getClass=function(){return Nlt},Nlt.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)},Nlt.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2},Nlt.det=function(t,e,n,i){return t*i-e*n},Nlt.interpolateZ=function(t,e,n,i){var r=e.x,o=e.y,s=n.x-r,a=i.x-r,h=n.y-o,l=i.y-o,u=s*l-a*h,c=t.x-r,A=t.y-o;return e.z+(l*c-a*A)/u*(n.z-e.z)+(-h*c+s*A)/u*(i.z-e.z)},Nlt.longestSideLength=function(t,e,n){var i=t.distance(e),r=e.distance(n),o=n.distance(t),s=i;return r>s&&(s=r),o>s&&(s=o),s},Nlt.isAcute=function(t,e,n){return!!Ilt.isAcute(t,e,n)&&!!Ilt.isAcute(e,n,t)&&!!Ilt.isAcute(n,t,e)},Nlt.circumcentre=function(t,e,n){var i=n.x,r=n.y,o=t.x-i,s=t.y-r,a=e.x-i,h=e.y-r,l=2*Nlt.det(o,s,a,h),u=Nlt.det(s,o*o+s*s,h,a*a+h*h),c=Nlt.det(o,o*o+s*s,a,a*a+h*h);return new ost(i-u/l,r+c/l)},Nlt.perpendicularBisector=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=new Mst(t.x+n/2,t.y+i/2,1),o=new Mst(t.x-i+n/2,t.y+n+i/2,1);return new Mst(r,o)},Nlt.angleBisector=function(t,e,n){var i=e.distance(t),r=i/(i+e.distance(n));return new ost(t.x+r*(n.x-t.x),t.y+r*(n.y-t.y))},Nlt.area3D=function(t,e,n){var i=e.x-t.x,r=e.y-t.y,o=e.z-t.z,s=n.x-t.x,a=n.y-t.y,h=n.z-t.z,l=r*h-o*a,u=o*s-i*h,c=i*a-r*s;return Math.sqrt(l*l+u*u+c*c)/2},Nlt.centroid=function(t,e,n){return new ost((t.x+e.x+n.x)/3,(t.y+e.y+n.y)/3)},Nlt.inCentre=function(t,e,n){var i=e.distance(n),r=t.distance(n),o=t.distance(e),s=i+r+o;return new ost((i*t.x+r*e.x+o*n.x)/s,(i*t.y+r*e.y+o*n.y)/s)};var zlt=function(){this.ur=null,this.ri=null,this.hr=null,this.cr=new sat;var t=arguments[1],e=arguments[2];this.ur=arguments[0],this.ri=t,this.hr=e};zlt.prototype.addPoint=function(t){if(this.ri<=0)return null;var e=t.getCoordinates(),n=this.hr.getLineCurve(e,this.ri);this.addCurve(n,lst.EXTERIOR,lst.INTERIOR)},zlt.prototype.addPolygon=function(t){var e=this,n=this.ri,i=wht.LEFT;this.ri<0&&(n=-this.ri,i=wht.RIGHT);var r=t.getExteriorRing(),o=lat.removeRepeatedPoints(r.getCoordinates());if(this.ri<0&&this.isErodedCompletely(r,this.ri))return null;if(this.ri<=0&&o.length<3)return null;this.addPolygonRing(o,n,i,lst.EXTERIOR,lst.INTERIOR);for(var s=0;s<t.getNumInteriorRing();s++){var a=t.getInteriorRingN(s),h=lat.removeRepeatedPoints(a.getCoordinates());e.ri>0&&e.isErodedCompletely(a,-e.ri)||e.addPolygonRing(h,n,wht.opposite(i),lst.INTERIOR,lst.EXTERIOR)}},zlt.prototype.isTriangleErodedCompletely=function(t,e){var n=new Nlt(t[0],t[1],t[2]),i=n.inCentre();return Ust.distancePointLine(i,n.p0,n.p1)<Math.abs(e)},zlt.prototype.addLineString=function(t){if(this.ri<=0&&!this.hr.getBufferParameters().isSingleSided())return null;var e=lat.removeRepeatedPoints(t.getCoordinates()),n=this.hr.getLineCurve(e,this.ri);this.addCurve(n,lst.EXTERIOR,lst.INTERIOR)},zlt.prototype.addCurve=function(t,e,n){if(null===t||t.length<2)return null;var i=new flt(t,new Rht(0,lst.BOUNDARY,e,n));this.cr.add(i)},zlt.prototype.getCurves=function(){return this.add(this.ur),this.cr},zlt.prototype.addPolygonRing=function(t,e,n,i,r){if(0===e&&t.length<$at.MINIMUM_VALID_SIZE)return null;var o=i,s=r;t.length>=$at.MINIMUM_VALID_SIZE&&Ust.isCCW(t)&&(o=r,s=i,n=wht.opposite(n));var a=this.hr.getRingCurve(t,n,e);this.addCurve(a,o,s)},zlt.prototype.add=function(t){if(t.isEmpty())return null;t instanceof Jat?this.addPolygon(t):t instanceof Zat?this.addLineString(t):t instanceof Xat?this.addPoint(t):(t instanceof Kat||t instanceof Lat||t instanceof tht||t instanceof kat)&&this.addCollection(t)},zlt.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(4===n.length)return this.isTriangleErodedCompletely(n,e);var i=t.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return e<0&&2*Math.abs(e)>r},zlt.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},zlt.prototype.interfaces_=function(){return[]},zlt.prototype.getClass=function(){return zlt};var Blt=function(){};Blt.prototype.locate=function(t){},Blt.prototype.interfaces_=function(){return[]},Blt.prototype.getClass=function(){return Blt};var Hlt=function(){this.ar=null,this.vr=null,this.lr=null,this.di=null,this.wr=null;var t=arguments[0];this.ar=t,this.vr=!0,this.di=0,this.lr=t.getNumGeometries()};Hlt.prototype.next=function(){if(this.vr)return this.vr=!1,Hlt.isAtomic(this.ar)&&this.di++,this.ar;if(null!==this.wr){if(this.wr.hasNext())return this.wr.next();this.wr=null}if(this.di>=this.lr)throw new oat;var t=this.ar.getGeometryN(this.di++);return t instanceof kat?(this.wr=new Hlt(t),this.wr.next()):t},Hlt.prototype.remove=function(){throw new Error(this.getClass().getName())},Hlt.prototype.hasNext=function(){if(this.vr)return!0;if(null!==this.wr){if(this.wr.hasNext())return!0;this.wr=null}return!(this.di>=this.lr)},Hlt.prototype.interfaces_=function(){return[iat]},Hlt.prototype.getClass=function(){return Hlt},Hlt.isAtomic=function(t){return!(t instanceof kat)};var jlt=function(){this.An=null,this.An=arguments[0]};jlt.prototype.locate=function(t){return jlt.locate(t,this.An)},jlt.prototype.interfaces_=function(){return[Blt]},jlt.prototype.getClass=function(){return jlt},jlt.isPointInRing=function(t,e){return!!e.getEnvelopeInternal().intersects(t)&&Ust.isPointInRing(t,e.getCoordinates())},jlt.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!jlt.isPointInRing(t,n))return!1;for(var i=0;i<e.getNumInteriorRing();i++){var r=e.getInteriorRingN(i);if(jlt.isPointInRing(t,r))return!1}return!0},jlt.containsPoint=function(t,e){if(e instanceof Jat)return jlt.containsPointInPolygon(t,e);if(e instanceof kat)for(var n=new Hlt(e);n.hasNext();){var i=n.next();if(i!==e&&jlt.containsPoint(t,i))return!0}return!1},jlt.locate=function(t,e){return e.isEmpty()?lst.EXTERIOR:jlt.containsPoint(t,e)?lst.INTERIOR:lst.EXTERIOR};var Ult=function(){this.Pr=new Cat,this.gr=null,this.Cr=[lst.NONE,lst.NONE]};Ult.prototype.getNextCW=function(t){this.getEdges();var e=this.gr.indexOf(t),n=e-1;return 0===e&&(n=this.gr.size()-1),this.gr.get(n)},Ult.prototype.propagateSideLabels=function(t){for(var e=lst.NONE,n=this.iterator();n.hasNext();){var i=n.next().getLabel();i.isArea(t)&&i.getLocation(t,wht.LEFT)!==lst.NONE&&(e=i.getLocation(t,wht.LEFT))}if(e===lst.NONE)return null;for(var r=e,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getLabel();if(a.getLocation(t,wht.ON)===lst.NONE&&a.setLocation(t,wht.ON,r),a.isArea(t)){var h=a.getLocation(t,wht.LEFT),l=a.getLocation(t,wht.RIGHT);if(l!==lst.NONE){if(l!==r)throw new Sht("side location conflict",s.getCoordinate());h===lst.NONE&&Fst.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),r=h}else Fst.isTrue(a.getLocation(t,wht.LEFT)===lst.NONE,"found single null side"),a.setLocation(t,wht.RIGHT,r),a.setLocation(t,wht.LEFT,r)}}},Ult.prototype.getCoordinate=function(){var t=this.iterator();return t.hasNext()?t.next().getCoordinate():null},Ult.prototype.print=function(t){Pst.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();)e.next().print(t)},Ult.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},Ult.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,i=e.get(n).getLabel().getLocation(t,wht.LEFT);Fst.isTrue(i!==lst.NONE,"Found unlabelled area edge");for(var r=i,o=this.iterator();o.hasNext();){var s=o.next().getLabel();Fst.isTrue(s.isArea(t),"Found non-area edge");var a=s.getLocation(t,wht.LEFT),h=s.getLocation(t,wht.RIGHT);if(a===h)return!1;if(h!==r)return!1;r=a}return!0},Ult.prototype.findIndex=function(t){this.iterator();for(var e=0;e<this.gr.size();e++)if(this.gr.get(e)===t)return e;return-1},Ult.prototype.iterator=function(){return this.getEdges().iterator()},Ult.prototype.getEdges=function(){return null===this.gr&&(this.gr=new sat(this.Pr.values())),this.gr},Ult.prototype.getLocation=function(t,e,n){return this.Cr[t]===lst.NONE&&(this.Cr[t]=jlt.locate(e,n[t].getGeometry())),this.Cr[t]},Ult.prototype.toString=function(){var t=new dst;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append("\n");for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append("\n")}return t.toString()},Ult.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();)e.next().computeLabel(t)},Ult.prototype.computeLabelling=function(t){this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var e=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next().getLabel(),r=0;r<2;r++)i.isLine(r)&&i.getLocation(r)===lst.BOUNDARY&&(e[r]=!0);for(var o=this.iterator();o.hasNext();)for(var s=o.next(),a=s.getLabel(),h=0;h<2;h++)if(a.isAnyNull(h)){var l=lst.NONE;if(e[h])l=lst.EXTERIOR;else{var u=s.getCoordinate();l=this.getLocation(h,u,t)}a.setAllLocationsIfNull(h,l)}},Ult.prototype.getDegree=function(){return this.Pr.size()},Ult.prototype.insertEdgeEnd=function(t,e){this.Pr.put(t,e),this.gr=null},Ult.prototype.interfaces_=function(){return[]},Ult.prototype.getClass=function(){return Ult};var Glt=function(t){function e(){t.call(this),this.Dr=null,this.xn=null,this.Ir=1,this.br=2}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.linkResultDirectedEdges=function(){var t=this;this.getResultAreaEdges();for(var e=null,n=null,i=this.Ir,r=0;r<this.Dr.size();r++){var o=t.Dr.get(r),s=o.getSym();if(o.getLabel().isArea())switch(null===e&&o.isInResult()&&(e=o),i){case t.Ir:if(!s.isInResult())continue;n=s,i=t.br;break;case t.br:if(!o.isInResult())continue;n.setNext(o),i=t.Ir}}if(i===this.br){if(null===e)throw new Sht("no outgoing dirEdge found",this.getCoordinate());Fst.isTrue(e.isInResult(),"unable to link last incoming dirEdge"),n.setNext(e)}},e.prototype.insert=function(t){this.insertEdgeEnd(t,t)},e.prototype.getRightmostEdge=function(){var t=this.getEdges(),e=t.size();if(e<1)return null;var n=t.get(0);if(1===e)return n;var i=t.get(e-1),r=n.getQuadrant(),o=i.getQuadrant();return Bht.isNorthern(r)&&Bht.isNorthern(o)?n:Bht.isNorthern(r)||Bht.isNorthern(o)?0!==n.getDy()?n:0!==i.getDy()?i:(Fst.shouldNeverReachHere("found two horizontal edges incident on node"),null):i},e.prototype.print=function(t){Pst.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();t.print("out "),n.print(t),t.println(),t.print("in "),n.getSym().print(t),t.println()}},e.prototype.getResultAreaEdges=function(){if(null!==this.Dr)return this.Dr;this.Dr=new sat;for(var t=this.iterator();t.hasNext();){var e=t.next();(e.isInResult()||e.getSym().isInResult())&&this.Dr.add(e)}return this.Dr},e.prototype.updateLabelling=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next().getLabel();n.setAllLocationsIfNull(0,t.getLocation(0)),n.setAllLocationsIfNull(1,t.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var t=null,e=null,n=this.gr.size()-1;n>=0;n--){var i=this.gr.get(n),r=i.getSym();null===e&&(e=r),null!==t&&r.setNext(t),t=i}e.setNext(t)},e.prototype.computeDepths=function(){if(1===arguments.length){var t=arguments[0],e=this.findIndex(t),n=t.getDepth(wht.LEFT),i=t.getDepth(wht.RIGHT),r=this.computeDepths(e+1,this.gr.size(),n);if(this.computeDepths(0,e,r)!==i)throw new Sht("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var o=arguments[1],s=arguments[2],a=arguments[0];a<o;a++){var h=this.gr.get(a);h.setEdgeDepths(wht.RIGHT,s),s=h.getDepth(wht.LEFT)}return s}},e.prototype.mergeSymLabels=function(){for(var t=this.iterator();t.hasNext();){var e=t.next();e.getLabel().merge(e.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(t){for(var e=this,n=null,i=null,r=this.Ir,o=this.Dr.size()-1;o>=0;o--){var s=e.Dr.get(o),a=s.getSym();switch(null===n&&s.getEdgeRing()===t&&(n=s),r){case e.Ir:if(a.getEdgeRing()!==t)continue;i=a,r=e.br;break;case e.br:if(s.getEdgeRing()!==t)continue;i.setNextMin(s),r=e.Ir}}r===this.br&&(Fst.isTrue(null!==n,"found null for first outgoing dirEdge"),Fst.isTrue(n.getEdgeRing()===t,"unable to link last incoming dirEdge"),i.setNextMin(n))},e.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var t=0,e=this.iterator();e.hasNext();)e.next().isInResult()&&t++;return t}if(1===arguments.length){for(var n=arguments[0],i=0,r=this.iterator();r.hasNext();)r.next().getEdgeRing()===n&&i++;return i}},e.prototype.getLabel=function(){return this.xn},e.prototype.findCoveredLineEdges=function(){for(var t=lst.NONE,e=this.iterator();e.hasNext();){var n=e.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){t=lst.INTERIOR;break}if(i.isInResult()){t=lst.EXTERIOR;break}}}if(t===lst.NONE)return null;for(var r=t,o=this.iterator();o.hasNext();){var s=o.next(),a=s.getSym();s.isLineEdge()?s.getEdge().setCovered(r===lst.INTERIOR):(s.isInResult()&&(r=lst.EXTERIOR),a.isInResult()&&(r=lst.INTERIOR))}},e.prototype.computeLabelling=function(e){t.prototype.computeLabelling.call(this,e),this.xn=new Rht(lst.NONE);for(var n=this.iterator();n.hasNext();)for(var i=n.next().getEdge().getLabel(),r=0;r<2;r++){var o=i.getLocation(r);o!==lst.INTERIOR&&o!==lst.BOUNDARY||this.xn.setLocation(r,lst.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ult),Vlt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createNode=function(t){return new Nht(t,new Glt)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ght),Wlt=function t(){this.dn=null,this.Mr=null;var e=arguments[0];this.dn=e,this.Mr=t.orientation(e)};Wlt.prototype.compareTo=function(t){return Wlt.compareOriented(this.dn,this.Mr,t.dn,t.Mr)},Wlt.prototype.interfaces_=function(){return[est]},Wlt.prototype.getClass=function(){return Wlt},Wlt.orientation=function(t){return 1===lat.increasingDirection(t)},Wlt.compareOriented=function(t,e,n,i){for(var r=e?1:-1,o=i?1:-1,s=e?t.length:-1,a=i?n.length:-1,h=e?0:t.length-1,l=i?0:n.length-1;;){var u=t[h].compareTo(n[l]);if(0!==u)return u;var c=(h+=r)===s,A=(l+=o)===a;if(c&&!A)return-1;if(!c&&A)return 1;if(c&&A)return 0}};var qlt=function(){this.zn=new sat,this.zr=new Cat};qlt.prototype.print=function(t){t.print("MULTILINESTRING ( ");for(var e=0;e<this.zn.size();e++){var n=this.zn.get(e);e>0&&t.print(","),t.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&t.print(","),t.print(i[r].x+" "+i[r].y);t.println(")")}t.print(")  ")},qlt.prototype.addAll=function(t){for(var e=t.iterator();e.hasNext();)this.add(e.next())},qlt.prototype.findEdgeIndex=function(t){for(var e=0;e<this.zn.size();e++)if(this.zn.get(e).equals(t))return e;return-1},qlt.prototype.iterator=function(){return this.zn.iterator()},qlt.prototype.getEdges=function(){return this.zn},qlt.prototype.get=function(t){return this.zn.get(t)},qlt.prototype.findEqualEdge=function(t){var e=new Wlt(t.getCoordinates());return this.zr.get(e)},qlt.prototype.add=function(t){this.zn.add(t);var e=new Wlt(t.getCoordinates());this.zr.put(e,t)},qlt.prototype.interfaces_=function(){return[]},qlt.prototype.getClass=function(){return qlt};var Zlt=function(){};Zlt.prototype.processIntersections=function(t,e,n,i){},Zlt.prototype.isDone=function(){},Zlt.prototype.interfaces_=function(){return[]},Zlt.prototype.getClass=function(){return Zlt};var Qlt=function(){this.dr=!1,this.mr=!1,this.yr=!1,this.pr=!1,this.Lr=null,this.Wi=null,this.Tr=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0,this.Wi=arguments[0]};Qlt.prototype.isTrivialIntersection=function(t,e,n,i){if(t===n&&1===this.Wi.getIntersectionNum()){if(Qlt.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var r=t.size()-1;if(0===e&&i===r||0===i&&e===r)return!0}}return!1},Qlt.prototype.getProperIntersectionPoint=function(){return this.Lr},Qlt.prototype.hasProperInteriorIntersection=function(){return this.yr},Qlt.prototype.getLineIntersector=function(){return this.Wi},Qlt.prototype.hasProperIntersection=function(){return this.mr},Qlt.prototype.processIntersections=function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this.Wi.computeIntersection(r,o,s,a),this.Wi.hasIntersection()&&(this.numIntersections++,this.Wi.isInteriorIntersection()&&(this.numInteriorIntersections++,this.pr=!0),this.isTrivialIntersection(t,e,n,i)||(this.dr=!0,t.addIntersections(this.Wi,e,0),n.addIntersections(this.Wi,i,1),this.Wi.isProper()&&(this.numProperIntersections++,this.mr=!0,this.yr=!0)))},Qlt.prototype.hasIntersection=function(){return this.dr},Qlt.prototype.isDone=function(){return!1},Qlt.prototype.hasInteriorIntersection=function(){return this.pr},Qlt.prototype.interfaces_=function(){return[Zlt]},Qlt.prototype.getClass=function(){return Qlt},Qlt.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var Xlt=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[1],e=arguments[2];this.coord=new ost(arguments[0]),this.segmentIndex=t,this.dist=e};Xlt.prototype.getSegmentIndex=function(){return this.segmentIndex},Xlt.prototype.getCoordinate=function(){return this.coord},Xlt.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)},Xlt.prototype.compareTo=function(t){return this.compare(t.segmentIndex,t.dist)},Xlt.prototype.isEndPoint=function(t){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===t},Xlt.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Xlt.prototype.getDistance=function(){return this.dist},Xlt.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0},Xlt.prototype.interfaces_=function(){return[est]},Xlt.prototype.getClass=function(){return Xlt};var Ylt=function(){this.vi=new Cat,this.edge=null,this.edge=arguments[0]};Ylt.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();)e.next().print(t)},Ylt.prototype.iterator=function(){return this.vi.values().iterator()},Ylt.prototype.addSplitEdges=function(t){this.addEndpoints();for(var e=this.iterator(),n=e.next();e.hasNext();){var i=e.next(),r=this.createSplitEdge(n,i);t.add(r),n=i}},Ylt.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)},Ylt.prototype.createSplitEdge=function(t,e){var n=e.segmentIndex-t.segmentIndex+2,i=e.dist>0||!e.coord.equals2D(this.edge.pts[e.segmentIndex]);i||n--;var r=new Array(n).fill(null),o=0;r[o++]=new ost(t.coord);for(var s=t.segmentIndex+1;s<=e.segmentIndex;s++)r[o++]=this.edge.pts[s];return i&&(r[o]=e.coord),new eut(r,new Rht(this.edge.xn))},Ylt.prototype.add=function(t,e,n){var i=new Xlt(t,e,n),r=this.vi.get(i);return null!==r?r:(this.vi.put(i,i),i)},Ylt.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();)if(e.next().coord.equals(t))return!0;return!1},Ylt.prototype.interfaces_=function(){return[]},Ylt.prototype.getClass=function(){return Ylt};var Jlt=function(){};Jlt.prototype.getChainStartIndices=function(t){var e=0,n=new sat;n.add(new pst(e));do{var i=this.findChainEnd(t,e);n.add(new pst(i)),e=i}while(e<t.length-1);return Jlt.toIntArray(n)},Jlt.prototype.findChainEnd=function(t,e){for(var n=Bht.quadrant(t[e],t[e+1]),i=e+1;i<t.length&&Bht.quadrant(t[i-1],t[i])===n;)i++;return i-1},Jlt.prototype.interfaces_=function(){return[]},Jlt.prototype.getClass=function(){return Jlt},Jlt.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Klt=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Tst,this.env2=new Tst;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new Jlt;this.startIndex=e.getChainStartIndices(this.pts)};Klt.prototype.getCoordinates=function(){return this.pts},Klt.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n},Klt.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n},Klt.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],arguments[3])}else if(6===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],s=arguments[3],a=arguments[4],h=arguments[5],l=this.pts[i],u=this.pts[r],c=o.pts[s],A=o.pts[a];if(r-i==1&&a-s==1)return h.addIntersections(this.e,i,o.e,s),null;if(this.env1.init(l,u),this.env2.init(c,A),!this.env1.intersects(this.env2))return null;var f=Math.trunc((i+r)/2),d=Math.trunc((s+a)/2);i<f&&(s<d&&this.computeIntersectsForChain(i,f,o,s,d,h),d<a&&this.computeIntersectsForChain(i,f,o,d,a,h)),f<r&&(s<d&&this.computeIntersectsForChain(f,r,o,s,d,h),d<a&&this.computeIntersectsForChain(f,r,o,d,a,h))}},Klt.prototype.getStartIndexes=function(){return this.startIndex},Klt.prototype.computeIntersects=function(t,e){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<t.startIndex.length-1;i++)this.computeIntersectsForChain(n,t,i,e)},Klt.prototype.interfaces_=function(){return[]},Klt.prototype.getClass=function(){return Klt};var $lt=function t(){this._n=Array(2).fill().map((function(){return Array(3)}));for(var e=0;e<2;e++)for(var n=0;n<3;n++)this._n[e][n]=t.NULL_VALUE},tut={NULL_VALUE:{configurable:!0}};$lt.prototype.getDepth=function(t,e){return this._n[t][e]},$lt.prototype.setDepth=function(t,e,n){this._n[t][e]=n},$lt.prototype.isNull=function(){if(0===arguments.length){for(var t=0;t<2;t++)for(var e=0;e<3;e++)if(this._n[t][e]!==$lt.NULL_VALUE)return!1;return!0}return 1===arguments.length?this._n[arguments[0]][1]===$lt.NULL_VALUE:2===arguments.length?this._n[arguments[0]][arguments[1]]===$lt.NULL_VALUE:void 0},$lt.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._n[e][1];t._n[e][2]<n&&(n=t._n[e][2]),n<0&&(n=0);for(var i=1;i<3;i++){var r=0;t._n[e][i]>n&&(r=1),t._n[e][i]=r}}},$lt.prototype.getDelta=function(t){return this._n[t][wht.RIGHT]-this._n[t][wht.LEFT]},$lt.prototype.getLocation=function(t,e){return this._n[t][e]<=0?lst.EXTERIOR:lst.INTERIOR},$lt.prototype.toString=function(){return"A: "+this._n[0][1]+","+this._n[0][2]+" B: "+this._n[1][1]+","+this._n[1][2]},$lt.prototype.add=function(){var t=this;if(1===arguments.length)for(var e=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=e.getLocation(n,i);r!==lst.EXTERIOR&&r!==lst.INTERIOR||(t.isNull(n,i)?t._n[n][i]=$lt.depthAtLocation(r):t._n[n][i]+=$lt.depthAtLocation(r))}else 3===arguments.length&&arguments[2]===lst.INTERIOR&&this._n[arguments[0]][arguments[1]]++},$lt.prototype.interfaces_=function(){return[]},$lt.prototype.getClass=function(){return $lt},$lt.depthAtLocation=function(t){return t===lst.EXTERIOR?0:t===lst.INTERIOR?1:$lt.NULL_VALUE},tut.NULL_VALUE.get=function(){return-1},Object.defineProperties($lt,tut);var eut=function(t){function e(){if(t.call(this),this.pts=null,this.In=null,this.eiList=new Ylt(this),this.hn=null,this.Or=null,this.Fr=!0,this._n=new $lt,this.Ur=0,1===arguments.length)e.call(this,arguments[0],null);else if(2===arguments.length){var n=arguments[1];this.pts=arguments[0],this.xn=n}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDepth=function(){return this._n},e.prototype.getCollapsedEdge=function(){var t=new Array(2).fill(null);return t[0]=this.pts[0],t[1]=this.pts[1],new e(t,Rht.toLineLabel(this.xn))},e.prototype.isIsolated=function(){return this.Fr},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(t){this.Fr=t},e.prototype.setName=function(t){this.hn=t},e.prototype.equals=function(t){if(!(t instanceof e))return!1;var n=t;if(this.pts.length!==n.pts.length)return!1;for(var i=!0,r=!0,o=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(n.pts[s])||(i=!1),this.pts[s].equals2D(n.pts[--o])||(r=!1),!i&&!r)return!1;return!0},e.prototype.getCoordinate=function(){return 0===arguments.length?this.pts.length>0?this.pts[0]:null:1===arguments.length?this.pts[arguments[0]]:void 0},e.prototype.print=function(t){t.print("edge "+this.hn+": "),t.print("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.print(","),t.print(this.pts[e].x+" "+this.pts[e].y);t.print(")  "+this.xn+" "+this.Ur)},e.prototype.computeIM=function(t){e.updateIM(this.xn,t)},e.prototype.isCollapsed=function(){return!!this.xn.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this.Ur},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(t){t.print("edge "+this.hn+": ");for(var e=this.pts.length-1;e>=0;e--)t.print(this.pts[e]+" ");t.println("")},e.prototype.getMonotoneChainEdge=function(){return null===this.Or&&(this.Or=new Klt(this)),this.Or},e.prototype.getEnvelope=function(){if(null===this.In){this.In=new Tst;for(var t=0;t<this.pts.length;t++)this.In.expandToInclude(this.pts[t])}return this.In},e.prototype.addIntersection=function(t,e,n,i){var r=new ost(t.getIntersection(i)),o=e,s=t.getEdgeDistance(n,i),a=o+1;a<this.pts.length&&r.equals2D(this.pts[a])&&(o=a,s=0),this.eiList.add(r,o,s)},e.prototype.toString=function(){var t=new dst;t.append("edge "+this.hn+": "),t.append("LINESTRING (");for(var e=0;e<this.pts.length;e++)e>0&&t.append(","),t.append(this.pts[e].x+" "+this.pts[e].y);return t.append(")  "+this.xn+" "+this.Ur),t.toString()},e.prototype.isPointwiseEqual=function(t){if(this.pts.length!==t.pts.length)return!1;for(var e=0;e<this.pts.length;e++)if(!this.pts[e].equals2D(t.pts[e]))return!1;return!0},e.prototype.setDepthDelta=function(t){this.Ur=t},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++)this.addIntersection(t,e,n,i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(2!==arguments.length)return t.prototype.updateIM.apply(this,arguments);var e=arguments[0],n=arguments[1];n.setAtLeastIfValid(e.getLocation(0,wht.ON),e.getLocation(1,wht.ON),1),e.isArea()&&(n.setAtLeastIfValid(e.getLocation(0,wht.LEFT),e.getLocation(1,wht.LEFT),2),n.setAtLeastIfValid(e.getLocation(0,wht.RIGHT),e.getLocation(1,wht.RIGHT),2))},e}(Fht),nut=function(t){this.Er=null,this.Nr=null,this.tn=null,this.jr=null,this.gr=new qlt,this.Vi=t||null};nut.prototype.setWorkingPrecisionModel=function(t){this.Er=t},nut.prototype.insertUniqueEdge=function(t){var e=this.gr.findEqualEdge(t);if(null!==e){var n=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new Rht(t.getLabel())).flip(),n.merge(i);var r=nut.depthDelta(i),o=e.getDepthDelta()+r;e.setDepthDelta(o)}else this.gr.add(t),t.setDepthDelta(nut.depthDelta(t.getLabel()))},nut.prototype.buildSubgraphs=function(t,e){for(var n=new sat,i=t.iterator();i.hasNext();){var r=i.next(),o=r.getRightmostCoordinate(),s=new klt(n).getDepth(o);r.computeDepth(s),r.findResultEdges(),n.add(r),e.add(r.getDirectedEdges(),r.getNodes())}},nut.prototype.createSubgraphs=function(t){for(var e=new sat,n=t.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new Eht;r.create(i),e.add(r)}}return $ht.sort(e,$ht.reverseOrder()),e},nut.prototype.createEmptyResultGeometry=function(){return this.tn.createPolygon()},nut.prototype.getNoder=function(t){if(null!==this.Nr)return this.Nr;var e=new xlt,n=new Bst;return n.setPrecisionModel(t),e.setSegmentIntersector(new Qlt(n)),e},nut.prototype.buffer=function(t,e){var n=this.Er;null===n&&(n=t.getPrecisionModel()),this.tn=t.getFactory();var i=new Dlt(n,this.Vi),r=new zlt(t,e,i).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,n),this.jr=new Vht(new Vlt),this.jr.addEdges(this.gr.getEdges());var o=this.createSubgraphs(this.jr),s=new Wht(this.tn);this.buildSubgraphs(o,s);var a=s.getPolygons();return a.size()<=0?this.createEmptyResultGeometry():this.tn.buildGeometry(a)},nut.prototype.computeNodedEdges=function(t,e){var n=this.getNoder(e);n.computeNodes(t);for(var i=n.getNodedSubstrings().iterator();i.hasNext();){var r=i.next(),o=r.getCoordinates();if(2!==o.length||!o[0].equals2D(o[1])){var s=r.getData(),a=new eut(r.getCoordinates(),new Rht(s));this.insertUniqueEdge(a)}}},nut.prototype.setNoder=function(t){this.Nr=t},nut.prototype.interfaces_=function(){return[]},nut.prototype.getClass=function(){return nut},nut.depthDelta=function(t){var e=t.getLocation(0,wht.LEFT),n=t.getLocation(0,wht.RIGHT);return e===lst.INTERIOR&&n===lst.EXTERIOR?1:e===lst.EXTERIOR&&n===lst.INTERIOR?-1:0},nut.convertSegStrings=function(t){for(var e=new pht,n=new sat;t.hasNext();){var i=t.next(),r=e.createLineString(i.getCoordinates());n.add(r)}return e.buildGeometry(n)};var iut=function(){if(this.Qr=null,this.Sr=null,this.Br=null,this.kr=null,this.Rr=!1,2===arguments.length){var t=arguments[1];this.Qr=arguments[0],this.Sr=t,this.Br=0,this.kr=0,this.Rr=!this.isIntegerPrecision()}else if(4===arguments.length){var e=arguments[1],n=arguments[2],i=arguments[3];this.Qr=arguments[0],this.Sr=e,this.Br=n,this.kr=i,this.Rr=!this.isIntegerPrecision()}};iut.prototype.rescale=function(){var t=this;if(cst(arguments[0],eat))for(var e=arguments[0].iterator();e.hasNext();){var n=e.next();t.rescale(n.getCoordinates())}else if(arguments[0]instanceof Array){for(var i=arguments[0],r=0;r<i.length;r++)i[r].x=i[r].x/t.Sr+t.Br,i[r].y=i[r].y/t.Sr+t.kr;2===i.length&&i[0].equals2D(i[1])&&Pst.out.println(i)}},iut.prototype.scale=function(){var t=this;if(cst(arguments[0],eat)){for(var e=arguments[0],n=new sat,i=e.iterator();i.hasNext();){var r=i.next();n.add(new flt(t.scale(r.getCoordinates()),r.getData()))}return n}if(arguments[0]instanceof Array){for(var o=arguments[0],s=new Array(o.length).fill(null),a=0;a<o.length;a++)s[a]=new ost(Math.round((o[a].x-t.Br)*t.Sr),Math.round((o[a].y-t.kr)*t.Sr),o[a].z);return lat.removeRepeatedPoints(s)}},iut.prototype.isIntegerPrecision=function(){return 1===this.Sr},iut.prototype.getNodedSubstrings=function(){var t=this.Qr.getNodedSubstrings();return this.Rr&&this.rescale(t),t},iut.prototype.computeNodes=function(t){var e=t;this.Rr&&(e=this.scale(t)),this.Qr.computeNodes(e)},iut.prototype.interfaces_=function(){return[vlt]},iut.prototype.getClass=function(){return iut};var rut=function(){this.Wi=new Bst,this.Gr=null,this.Gr=arguments[0]},out={fact:{configurable:!0}};rut.prototype.checkEndPtVertexIntersections=function(){var t=this;if(0===arguments.length)for(var e=this.Gr.iterator();e.hasNext();){var n=e.next().getCoordinates();t.checkEndPtVertexIntersections(n[0],t.Gr),t.checkEndPtVertexIntersections(n[n.length-1],t.Gr)}else if(2===arguments.length)for(var i=arguments[0],r=arguments[1].iterator();r.hasNext();)for(var o=r.next().getCoordinates(),s=1;s<o.length-1;s++)if(o[s].equals(i))throw new kst("found endpt/interior pt intersection at index "+s+" :pt "+i)},rut.prototype.checkInteriorIntersections=function(){if(0===arguments.length)for(var t=this.Gr.iterator();t.hasNext();)for(var e=t.next(),n=this.Gr.iterator();n.hasNext();){var i=n.next();this.checkInteriorIntersections(e,i)}else if(2===arguments.length)for(var r=arguments[0],o=arguments[1],s=r.getCoordinates(),a=o.getCoordinates(),h=0;h<s.length-1;h++)for(var l=0;l<a.length-1;l++)this.checkInteriorIntersections(r,h,o,l);else if(4===arguments.length){var u=arguments[0],c=arguments[1],A=arguments[2],f=arguments[3];if(u===A&&c===f)return null;var d=u.getCoordinates()[c],p=u.getCoordinates()[c+1],g=A.getCoordinates()[f],m=A.getCoordinates()[f+1];if(this.Wi.computeIntersection(d,p,g,m),this.Wi.hasIntersection()&&(this.Wi.isProper()||this.hasInteriorIntersection(this.Wi,d,p)||this.hasInteriorIntersection(this.Wi,g,m)))throw new kst("found non-noded intersection at "+d+"-"+p+" and "+g+"-"+m)}},rut.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},rut.prototype.checkCollapses=function(){if(0===arguments.length)for(var t=this.Gr.iterator();t.hasNext();){var e=t.next();this.checkCollapses(e)}else if(1===arguments.length)for(var n=arguments[0].getCoordinates(),i=0;i<n.length-2;i++)this.checkCollapse(n[i],n[i+1],n[i+2])},rut.prototype.hasInteriorIntersection=function(t,e,n){for(var i=0;i<t.getIntersectionNum();i++){var r=t.getIntersection(i);if(!r.equals(e)&&!r.equals(n))return!0}return!1},rut.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new kst("found non-noded collapse at "+rut.fact.createLineString([t,e,n]))},rut.prototype.interfaces_=function(){return[]},rut.prototype.getClass=function(){return rut},out.fact.get=function(){return new pht},Object.defineProperties(rut,out);var sut=function(){this.Wi=null,this.Yr=null,this.qr=null,this.Vr=null,this.Wr=null,this._r=null,this.Sr=null,this.Tt=null,this.Ot=null,this.Ft=null,this.Ut=null,this.Kr=new Array(4).fill(null),this.Hr=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this.qr=t,this.Yr=t,this.Sr=e,this.Wi=n,e<=0)throw new Kot("Scale factor must be non-zero");1!==e&&(this.Yr=new ost(this.scale(t.x),this.scale(t.y)),this.Wr=new ost,this._r=new ost),this.initCorners(this.Yr)},aut={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};sut.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),i=Math.max(t.x,e.x),r=Math.min(t.y,e.y),o=Math.max(t.y,e.y),s=this.Ot<n||this.Tt>i||this.Ut<r||this.Ft>o;if(s)return!1;var a=this.intersectsToleranceSquare(t,e);return Fst.isTrue(!(s&&a),"Found bad envelope test"),a},sut.prototype.initCorners=function(t){var e=.5;this.Tt=t.x-e,this.Ot=t.x+e,this.Ft=t.y-e,this.Ut=t.y+e,this.Kr[0]=new ost(this.Ot,this.Ut),this.Kr[1]=new ost(this.Tt,this.Ut),this.Kr[2]=new ost(this.Tt,this.Ft),this.Kr[3]=new ost(this.Ot,this.Ft)},sut.prototype.intersects=function(t,e){return 1===this.Sr?this.intersectsScaled(t,e):(this.copyScaled(t,this.Wr),this.copyScaled(e,this._r),this.intersectsScaled(this.Wr,this._r))},sut.prototype.scale=function(t){return Math.round(t*this.Sr)},sut.prototype.getCoordinate=function(){return this.qr},sut.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)},sut.prototype.getSafeEnvelope=function(){if(null===this.Hr){var t=sut.SAFE_ENV_EXPANSION_FACTOR/this.Sr;this.Hr=new Tst(this.qr.x-t,this.qr.x+t,this.qr.y-t,this.qr.y+t)}return this.Hr},sut.prototype.intersectsPixelClosure=function(t,e){return this.Wi.computeIntersection(t,e,this.Kr[0],this.Kr[1]),!!(this.Wi.hasIntersection()||(this.Wi.computeIntersection(t,e,this.Kr[1],this.Kr[2]),this.Wi.hasIntersection()||(this.Wi.computeIntersection(t,e,this.Kr[2],this.Kr[3]),this.Wi.hasIntersection()||(this.Wi.computeIntersection(t,e,this.Kr[3],this.Kr[0]),this.Wi.hasIntersection()))))},sut.prototype.intersectsToleranceSquare=function(t,e){var n=!1,i=!1;return this.Wi.computeIntersection(t,e,this.Kr[0],this.Kr[1]),!!(this.Wi.isProper()||(this.Wi.computeIntersection(t,e,this.Kr[1],this.Kr[2]),this.Wi.isProper()||(this.Wi.hasIntersection()&&(n=!0),this.Wi.computeIntersection(t,e,this.Kr[2],this.Kr[3]),this.Wi.isProper()||(this.Wi.hasIntersection()&&(i=!0),this.Wi.computeIntersection(t,e,this.Kr[3],this.Kr[0]),this.Wi.isProper()||n&&i||t.equals(this.Yr)||e.equals(this.Yr)))))},sut.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),i=t.getCoordinate(e+1);return!!this.intersects(n,i)&&(t.addIntersection(this.getCoordinate(),e),!0)},sut.prototype.interfaces_=function(){return[]},sut.prototype.getClass=function(){return sut},aut.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(sut,aut);var hut=function(){this.tempEnv1=new Tst,this.selectedSegment=new dlt};hut.prototype.select=function(){1===arguments.length||2===arguments.length&&(arguments[0].getLineSegment(arguments[1],this.selectedSegment),this.select(this.selectedSegment))},hut.prototype.interfaces_=function(){return[]},hut.prototype.getClass=function(){return hut};var lut=function(){this.di=null,this.di=arguments[0]},uut={HotPixelSnapAction:{configurable:!0}};lut.prototype.snap=function(){if(1===arguments.length)return this.snap(arguments[0],null,-1);if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2],i=t.getSafeEnvelope(),r=new cut(t,e,n);return this.di.query(i,{interfaces_:function(){return[Xht]},visitItem:function(t){t.select(i,r)}}),r.isNodeAdded()}},lut.prototype.interfaces_=function(){return[]},lut.prototype.getClass=function(){return lut},uut.HotPixelSnapAction.get=function(){return cut},Object.defineProperties(lut,uut);var cut=function(t){function e(){t.call(this),this.Jr=null,this.Zr=null,this.Xr=null,this.$r=!1;var e=arguments[1],n=arguments[2];this.Jr=arguments[0],this.Zr=e,this.Xr=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.isNodeAdded=function(){return this.$r},e.prototype.select=function(){if(2!==arguments.length)return t.prototype.select.apply(this,arguments);var e=arguments[1],n=arguments[0].getContext();if(null!==this.Zr&&n===this.Zr&&e===this.Xr)return null;this.$r=this.Jr.addSnappedNode(n,e)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(hut),Aut=function(){this.Wi=null,this.Ae=null,this.Wi=arguments[0],this.Ae=new sat};Aut.prototype.processIntersections=function(t,e,n,i){if(t===n&&e===i)return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[i],a=n.getCoordinates()[i+1];if(this.Wi.computeIntersection(r,o,s,a),this.Wi.hasIntersection()&&this.Wi.isInteriorIntersection()){for(var h=0;h<this.Wi.getIntersectionNum();h++)this.Ae.add(this.Wi.getIntersection(h));t.addIntersections(this.Wi,e,0),n.addIntersections(this.Wi,i,1)}},Aut.prototype.isDone=function(){return!1},Aut.prototype.getInteriorIntersections=function(){return this.Ae},Aut.prototype.interfaces_=function(){return[Zlt]},Aut.prototype.getClass=function(){return Aut};var fut=function(){this.te=null,this.Wi=null,this.Sr=null,this.Qr=null,this.ne=null,this.mi=null;var t=arguments[0];this.te=t,this.Wi=new Bst,this.Wi.setPrecisionModel(t),this.Sr=t.getScale()};fut.prototype.checkCorrectness=function(t){var e=flt.getNodedSubstrings(t),n=new rut(e);try{n.checkValid()}catch(i){if(!(i instanceof wst))throw i;i.printStackTrace()}},fut.prototype.getNodedSubstrings=function(){return flt.getNodedSubstrings(this.mi)},fut.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)},fut.prototype.findInteriorIntersections=function(t,e){var n=new Aut(e);return this.Qr.setSegmentIntersector(n),this.Qr.computeNodes(t),n.getInteriorIntersections()},fut.prototype.computeVertexSnaps=function(){var t=this;if(cst(arguments[0],eat))for(var e=arguments[0].iterator();e.hasNext();){var n=e.next();t.computeVertexSnaps(n)}else if(arguments[0]instanceof flt)for(var i=arguments[0],r=i.getCoordinates(),o=0;o<r.length;o++){var s=new sut(r[o],t.Sr,t.Wi);t.ne.snap(s,i,o)&&i.addIntersection(r[o],o)}},fut.prototype.computeNodes=function(t){this.mi=t,this.Qr=new xlt,this.ne=new lut(this.Qr.getIndex()),this.snapRound(t,this.Wi)},fut.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var i=n.next(),r=new sut(i,e.Sr,e.Wi);e.ne.snap(r)}},fut.prototype.interfaces_=function(){return[vlt]},fut.prototype.getClass=function(){return fut};var dut=function(){if(this.ie=null,this.ri=null,this.Vi=new wlt,this.re=null,this.ee=null,1===arguments.length)this.ie=arguments[0];else if(2===arguments.length){var t=arguments[1];this.ie=arguments[0],this.Vi=t}},put={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};dut.prototype.bufferFixedPrecision=function(t){var e=new iut(new fut(new cht(1)),t.getScale()),n=new nut(this.Vi);n.setWorkingPrecisionModel(t),n.setNoder(e),this.re=n.buffer(this.ie,this.ri)},dut.prototype.bufferReducedPrecision=function(){var t=this;if(0===arguments.length){for(var e=dut.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(r){if(!(r instanceof Sht))throw r;t.ee=r}if(null!==t.re)return null}throw this.ee}if(1===arguments.length){var n=dut.precisionScaleFactor(this.ie,this.ri,arguments[0]),i=new cht(n);this.bufferFixedPrecision(i)}},dut.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this.re)return null;var t=this.ie.getFactory().getPrecisionModel();t.getType()===cht.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()},dut.prototype.setQuadrantSegments=function(t){this.Vi.setQuadrantSegments(t)},dut.prototype.bufferOriginalPrecision=function(){try{var t=new nut(this.Vi);this.re=t.buffer(this.ie,this.ri)}catch(e){if(!(e instanceof kst))throw e;this.ee=e}},dut.prototype.getResultGeometry=function(t){return this.ri=t,this.computeGeometry(),this.re},dut.prototype.setEndCapStyle=function(t){this.Vi.setEndCapStyle(t)},dut.prototype.interfaces_=function(){return[]},dut.prototype.getClass=function(){return dut},dut.bufferOp=function(){if(2===arguments.length){var t=arguments[1];return new dut(arguments[0]).getResultGeometry(t)}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Wst&&"number"==typeof arguments[1]){var e=arguments[1],n=arguments[2],i=new dut(arguments[0]);return i.setQuadrantSegments(n),i.getResultGeometry(e)}if(arguments[2]instanceof wlt&&arguments[0]instanceof Wst&&"number"==typeof arguments[1]){var r=arguments[1];return new dut(arguments[0],arguments[2]).getResultGeometry(r)}}else if(4===arguments.length){var o=arguments[1],s=arguments[2],a=arguments[3],h=new dut(arguments[0]);return h.setQuadrantSegments(s),h.setEndCapStyle(a),h.getResultGeometry(o)}},dut.precisionScaleFactor=function(t,e,n){var i=t.getEnvelopeInternal(),r=Ast.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY()))+2*(e>0?e:0),o=n-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,o)},put.CAP_ROUND.get=function(){return wlt.CAP_ROUND},put.CAP_BUTT.get=function(){return wlt.CAP_FLAT},put.CAP_FLAT.get=function(){return wlt.CAP_FLAT},put.CAP_SQUARE.get=function(){return wlt.CAP_SQUARE},put.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(dut,put);var gut=function(){this.Yr=[new ost,new ost],this.ri=$ot.NaN,this.se=!0};gut.prototype.getCoordinates=function(){return this.Yr},gut.prototype.getCoordinate=function(t){return this.Yr[t]},gut.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t.Yr[0],t.Yr[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.se)return this.initialize(e,n),null;var i=e.distance(n);i<this.ri&&this.initialize(e,n,i)}},gut.prototype.initialize=function(){if(0===arguments.length)this.se=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this.Yr[0].setCoordinate(t),this.Yr[1].setCoordinate(e),this.ri=t.distance(e),this.se=!1}else if(3===arguments.length){var n=arguments[1],i=arguments[2];this.Yr[0].setCoordinate(arguments[0]),this.Yr[1].setCoordinate(n),this.ri=i,this.se=!1}},gut.prototype.getDistance=function(){return this.ri},gut.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t.Yr[0],t.Yr[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.se)return this.initialize(e,n),null;var i=e.distance(n);i>this.ri&&this.initialize(e,n,i)}},gut.prototype.interfaces_=function(){return[]},gut.prototype.getClass=function(){return gut};var mut=function(){};mut.prototype.interfaces_=function(){return[]},mut.prototype.getClass=function(){return mut},mut.computeDistance=function(){if(arguments[2]instanceof gut&&arguments[0]instanceof Zat&&arguments[1]instanceof ost)for(var t=arguments[1],e=arguments[2],n=arguments[0].getCoordinates(),i=new dlt,r=0;r<n.length-1;r++){i.setCoordinates(n[r],n[r+1]);var o=i.closestPoint(t);e.setMinimum(o,t)}else if(arguments[2]instanceof gut&&arguments[0]instanceof Jat&&arguments[1]instanceof ost){var s=arguments[0],a=arguments[1],h=arguments[2];mut.computeDistance(s.getExteriorRing(),a,h);for(var l=0;l<s.getNumInteriorRing();l++)mut.computeDistance(s.getInteriorRingN(l),a,h)}else if(arguments[2]instanceof gut&&arguments[0]instanceof Wst&&arguments[1]instanceof ost){var u=arguments[0],c=arguments[1],A=arguments[2];if(u instanceof Zat)mut.computeDistance(u,c,A);else if(u instanceof Jat)mut.computeDistance(u,c,A);else if(u instanceof kat)for(var f=u,d=0;d<f.getNumGeometries();d++){var p=f.getGeometryN(d);mut.computeDistance(p,c,A)}else A.setMinimum(u.getCoordinate(),c)}else if(arguments[2]instanceof gut&&arguments[0]instanceof dlt&&arguments[1]instanceof ost){var g=arguments[1],m=arguments[2],y=arguments[0].closestPoint(g);m.setMinimum(y,g)}};var yut=function(t){this.ue=new gut,this.ur=t||null},vut={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};yut.prototype.computeMaxMidpointDistance=function(t){var e=new xut(this.ur);t.apply(e),this.ue.setMaximum(e.getMaxPointDistance())},yut.prototype.computeMaxVertexDistance=function(t){var e=new _ut(this.ur);t.apply(e),this.ue.setMaximum(e.getMaxPointDistance())},yut.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this.ue.getDistance()},yut.prototype.getDistancePoints=function(){return this.ue},yut.prototype.interfaces_=function(){return[]},yut.prototype.getClass=function(){return yut},vut.MaxPointDistanceFilter.get=function(){return _ut},vut.MaxMidpointDistanceFilter.get=function(){return xut},Object.defineProperties(yut,vut);var _ut=function(t){this.ue=new gut,this.oe=new gut,this.An=t||null};_ut.prototype.filter=function(t){this.oe.initialize(),mut.computeDistance(this.An,t,this.oe),this.ue.setMaximum(this.oe)},_ut.prototype.getMaxPointDistance=function(){return this.ue},_ut.prototype.interfaces_=function(){return[Qst]},_ut.prototype.getClass=function(){return _ut};var xut=function(t){this.ue=new gut,this.oe=new gut,this.An=t||null};xut.prototype.filter=function(t,e){if(0===e)return null;var n=t.getCoordinate(e-1),i=t.getCoordinate(e),r=new ost((n.x+i.x)/2,(n.y+i.y)/2);this.oe.initialize(),mut.computeDistance(this.An,r,this.oe),this.ue.setMaximum(this.oe)},xut.prototype.isDone=function(){return!1},xut.prototype.isGeometryChanged=function(){return!1},xut.prototype.getMaxPointDistance=function(){return this.ue},xut.prototype.interfaces_=function(){return[Dat]},xut.prototype.getClass=function(){return xut};var but=function(t){this.he=t||null};but.prototype.filter=function(t){t instanceof Jat&&this.he.add(t)},but.prototype.interfaces_=function(){return[Rat]},but.prototype.getClass=function(){return but},but.getPolygons=function(){if(1===arguments.length)return but.getPolygons(arguments[0],new sat);if(2===arguments.length){var t=arguments[0],e=arguments[1];return t instanceof Jat?e.add(t):t instanceof kat&&t.apply(new but(e)),e}};var wut=function(){if(this.ot=null,this.fe=!1,1===arguments.length)this.ot=arguments[0];else if(2===arguments.length){var t=arguments[1];this.ot=arguments[0],this.fe=t}};wut.prototype.filter=function(t){if(this.fe&&t instanceof $at){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this.ot.add(e),null}t instanceof Zat&&this.ot.add(t)},wut.prototype.setForceToLineString=function(t){this.fe=t},wut.prototype.interfaces_=function(){return[Vst]},wut.prototype.getClass=function(){return wut},wut.getGeometry=function(){if(1===arguments.length){var t=arguments[0];return t.getFactory().buildGeometry(wut.getLines(t))}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(wut.getLines(e,n))}},wut.getLines=function(){if(1===arguments.length)return wut.getLines(arguments[0],!1);if(2===arguments.length){if(cst(arguments[0],eat)&&cst(arguments[1],eat)){for(var t=arguments[1],e=arguments[0].iterator();e.hasNext();){var n=e.next();wut.getLines(n,t)}return t}if(arguments[0]instanceof Wst&&"boolean"==typeof arguments[1]){var i=arguments[0],r=arguments[1],o=new sat;return i.apply(new wut(o,r)),o}if(arguments[0]instanceof Wst&&cst(arguments[1],eat)){var s=arguments[0],a=arguments[1];return s instanceof Zat?a.add(s):s.apply(new wut(a)),a}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&cst(arguments[0],eat)&&cst(arguments[1],eat)){for(var h=arguments[1],l=arguments[2],u=arguments[0].iterator();u.hasNext();){var c=u.next();wut.getLines(c,h,l)}return h}if("boolean"==typeof arguments[2]&&arguments[0]instanceof Wst&&cst(arguments[1],eat)){var A=arguments[1];return arguments[0].apply(new wut(A,arguments[2])),A}}};var Cut=function(){if(this.ce=Xst.OGC_SFS_BOUNDARY_RULE,this.ae=null,this.ve=null,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(null===t)throw new Kot("Rule must be non-null");this.ce=t}};Cut.prototype.locateInternal=function(){if(arguments[0]instanceof ost&&arguments[1]instanceof Jat){var t=arguments[0],e=arguments[1];if(e.isEmpty())return lst.EXTERIOR;var n=e.getExteriorRing(),i=this.locateInPolygonRing(t,n);if(i===lst.EXTERIOR)return lst.EXTERIOR;if(i===lst.BOUNDARY)return lst.BOUNDARY;for(var r=0;r<e.getNumInteriorRing();r++){var o=e.getInteriorRingN(r),s=this.locateInPolygonRing(t,o);if(s===lst.INTERIOR)return lst.EXTERIOR;if(s===lst.BOUNDARY)return lst.BOUNDARY}return lst.INTERIOR}if(arguments[0]instanceof ost&&arguments[1]instanceof Zat){var a=arguments[0],h=arguments[1];if(!h.getEnvelopeInternal().intersects(a))return lst.EXTERIOR;var l=h.getCoordinates();return h.isClosed()||!a.equals(l[0])&&!a.equals(l[l.length-1])?Ust.isOnLine(a,l)?lst.INTERIOR:lst.EXTERIOR:lst.BOUNDARY}if(arguments[0]instanceof ost&&arguments[1]instanceof Xat){var u=arguments[0];return arguments[1].getCoordinate().equals2D(u)?lst.INTERIOR:lst.EXTERIOR}},Cut.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?Ust.locatePointInRing(t,e.getCoordinates()):lst.EXTERIOR},Cut.prototype.intersects=function(t,e){return this.locate(t,e)!==lst.EXTERIOR},Cut.prototype.updateLocationInfo=function(t){t===lst.INTERIOR&&(this.ae=!0),t===lst.BOUNDARY&&this.ve++},Cut.prototype.computeLocation=function(t,e){var n=this;if(e instanceof Xat&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Zat)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Jat)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof Lat)for(var i=e,r=0;r<i.getNumGeometries();r++){var o=i.getGeometryN(r);n.updateLocationInfo(n.locateInternal(t,o))}else if(e instanceof tht)for(var s=e,a=0;a<s.getNumGeometries();a++){var h=s.getGeometryN(a);n.updateLocationInfo(n.locateInternal(t,h))}else if(e instanceof kat)for(var l=new Hlt(e);l.hasNext();){var u=l.next();u!==e&&n.computeLocation(t,u)}},Cut.prototype.locate=function(t,e){return e.isEmpty()?lst.EXTERIOR:e instanceof Zat||e instanceof Jat?this.locateInternal(t,e):(this.ae=!1,this.ve=0,this.computeLocation(t,e),this.ce.isInBoundary(this.ve)?lst.BOUNDARY:this.ve>0||this.ae?lst.INTERIOR:lst.EXTERIOR)},Cut.prototype.interfaces_=function(){return[]},Cut.prototype.getClass=function(){return Cut};var Put=function t(){if(this.we=null,this.Pe=null,this.Yr=null,2===arguments.length)t.call(this,arguments[0],t.INSIDE_AREA,arguments[1]);else if(3===arguments.length){var e=arguments[1],n=arguments[2];this.we=arguments[0],this.Pe=e,this.Yr=n}},Mut={INSIDE_AREA:{configurable:!0}};Put.prototype.isInsideArea=function(){return this.Pe===Put.INSIDE_AREA},Put.prototype.getCoordinate=function(){return this.Yr},Put.prototype.getGeometryComponent=function(){return this.we},Put.prototype.getSegmentIndex=function(){return this.Pe},Put.prototype.interfaces_=function(){return[]},Put.prototype.getClass=function(){return Put},Mut.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Put,Mut);var Tut=function(t){this.dn=t||null};Tut.prototype.filter=function(t){t instanceof Xat&&this.dn.add(t)},Tut.prototype.interfaces_=function(){return[Rat]},Tut.prototype.getClass=function(){return Tut},Tut.getPoints=function(){if(1===arguments.length){var t=arguments[0];return t instanceof Xat?$ht.singletonList(t):Tut.getPoints(t,new sat)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e instanceof Xat?n.add(e):e instanceof kat&&e.apply(new Tut(n)),n}};var Sut=function(){this.Ce=null,this.Ce=arguments[0]};Sut.prototype.filter=function(t){(t instanceof Xat||t instanceof Zat||t instanceof Jat)&&this.Ce.add(new Put(t,0,t.getCoordinate()))},Sut.prototype.interfaces_=function(){return[Rat]},Sut.prototype.getClass=function(){return Sut},Sut.getLocations=function(t){var e=new sat;return t.apply(new Sut(e)),e};var Iut=function(){if(this.An=null,this.De=0,this.Ie=new Cut,this.be=null,this.Me=$ot.MAX_VALUE,2===arguments.length)this.An=[arguments[0],arguments[1]],this.De=0;else if(3===arguments.length){var t=arguments[0],e=arguments[1],n=arguments[2];this.An=new Array(2).fill(null),this.An[0]=t,this.An[1]=e,this.De=n}};Iut.prototype.computeContainmentDistance=function(){var t=this;if(0===arguments.length){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this.Me<=this.De)return null;this.computeContainmentDistance(1,e)}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=1-n,o=but.getPolygons(this.An[n]);if(o.size()>0){var s=Sut.getLocations(this.An[r]);if(this.computeContainmentDistance(s,o,i),this.Me<=this.De)return this.be[r]=i[0],this.be[n]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&cst(arguments[0],rat)&&cst(arguments[1],rat)){for(var a=arguments[0],h=arguments[1],l=arguments[2],u=0;u<a.size();u++)for(var c=a.get(u),A=0;A<h.size();A++)if(t.computeContainmentDistance(c,h.get(A),l),t.Me<=t.De)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Put&&arguments[1]instanceof Jat){var f=arguments[0],d=arguments[1],p=arguments[2],g=f.getCoordinate();if(lst.EXTERIOR!==this.Ie.locate(g,d))return this.Me=0,p[0]=f,p[1]=new Put(d,g),null}},Iut.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var i=this,r=0;r<t.size();r++)for(var o=t.get(r),s=0;s<e.size();s++){var a=e.get(s);if(i.computeMinDistance(o,a,n),i.Me<=i.De)return null}},Iut.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=wut.getLines(this.An[0]),n=wut.getLines(this.An[1]),i=Tut.getPoints(this.An[0]),r=Tut.getPoints(this.An[1]);return this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this.Me<=this.De?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,r,t),this.updateMinDistance(t,!1),this.Me<=this.De?null:(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,i,t),this.updateMinDistance(t,!0),this.Me<=this.De?null:(t[0]=null,t[1]=null,this.computeMinDistancePoints(i,r,t),void this.updateMinDistance(t,!1))))},Iut.prototype.nearestLocations=function(){return this.computeMinDistance(),this.be},Iut.prototype.updateMinDistance=function(t,e){if(null===t[0])return null;e?(this.be[0]=t[1],this.be[1]=t[0]):(this.be[0]=t[0],this.be[1]=t[1])},Iut.prototype.nearestPoints=function(){return this.computeMinDistance(),[this.be[0].getCoordinate(),this.be[1].getCoordinate()]},Iut.prototype.computeMinDistance=function(){var t=this;if(0===arguments.length){if(null!==this.be)return null;if(this.be=new Array(2).fill(null),this.computeContainmentDistance(),this.Me<=this.De)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof Zat&&arguments[1]instanceof Xat){var e=arguments[0],n=arguments[1],i=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this.Me)return null;for(var r=e.getCoordinates(),o=n.getCoordinate(),s=0;s<r.length-1;s++){var a=Ust.distancePointLine(o,r[s],r[s+1]);if(a<t.Me){t.Me=a;var h=new dlt(r[s],r[s+1]).closestPoint(o);i[0]=new Put(e,s,h),i[1]=new Put(n,0,o)}if(t.Me<=t.De)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Zat&&arguments[1]instanceof Zat){var l=arguments[0],u=arguments[1],c=arguments[2];if(l.getEnvelopeInternal().distance(u.getEnvelopeInternal())>this.Me)return null;for(var A=l.getCoordinates(),f=u.getCoordinates(),d=0;d<A.length-1;d++)for(var p=0;p<f.length-1;p++){var g=Ust.distanceLineLine(A[d],A[d+1],f[p],f[p+1]);if(g<t.Me){t.Me=g;var m=new dlt(A[d],A[d+1]),y=new dlt(f[p],f[p+1]),v=m.closestPoints(y);c[0]=new Put(l,d,v[0]),c[1]=new Put(u,p,v[1])}if(t.Me<=t.De)return null}}},Iut.prototype.computeMinDistancePoints=function(t,e,n){for(var i=this,r=0;r<t.size();r++)for(var o=t.get(r),s=0;s<e.size();s++){var a=e.get(s),h=o.getCoordinate().distance(a.getCoordinate());if(h<i.Me&&(i.Me=h,n[0]=new Put(o,0,o.getCoordinate()),n[1]=new Put(a,0,a.getCoordinate())),i.Me<=i.De)return null}},Iut.prototype.distance=function(){if(null===this.An[0]||null===this.An[1])throw new Kot("null geometries are not supported");return this.An[0].isEmpty()||this.An[1].isEmpty()?0:(this.computeMinDistance(),this.Me)},Iut.prototype.computeMinDistanceLines=function(t,e,n){for(var i=this,r=0;r<t.size();r++)for(var o=t.get(r),s=0;s<e.size();s++){var a=e.get(s);if(i.computeMinDistance(o,a,n),i.Me<=i.De)return null}},Iut.prototype.interfaces_=function(){return[]},Iut.prototype.getClass=function(){return Iut},Iut.distance=function(t,e){return new Iut(t,e).distance()},Iut.isWithinDistance=function(t,e,n){return new Iut(t,e,n).distance()<=n},Iut.nearestPoints=function(t,e){return new Iut(t,e).nearestPoints()};var Eut=function(){this.Yr=[new ost,new ost],this.ri=$ot.NaN,this.se=!0};Eut.prototype.getCoordinates=function(){return this.Yr},Eut.prototype.getCoordinate=function(t){return this.Yr[t]},Eut.prototype.setMinimum=function(){if(1===arguments.length){var t=arguments[0];this.setMinimum(t.Yr[0],t.Yr[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.se)return this.initialize(e,n),null;var i=e.distance(n);i<this.ri&&this.initialize(e,n,i)}},Eut.prototype.initialize=function(){if(0===arguments.length)this.se=!0;else if(2===arguments.length){var t=arguments[0],e=arguments[1];this.Yr[0].setCoordinate(t),this.Yr[1].setCoordinate(e),this.ri=t.distance(e),this.se=!1}else if(3===arguments.length){var n=arguments[1],i=arguments[2];this.Yr[0].setCoordinate(arguments[0]),this.Yr[1].setCoordinate(n),this.ri=i,this.se=!1}},Eut.prototype.toString=function(){return Dst.toLineString(this.Yr[0],this.Yr[1])},Eut.prototype.getDistance=function(){return this.ri},Eut.prototype.setMaximum=function(){if(1===arguments.length){var t=arguments[0];this.setMaximum(t.Yr[0],t.Yr[1])}else if(2===arguments.length){var e=arguments[0],n=arguments[1];if(this.se)return this.initialize(e,n),null;var i=e.distance(n);i>this.ri&&this.initialize(e,n,i)}},Eut.prototype.interfaces_=function(){return[]},Eut.prototype.getClass=function(){return Eut};var Out=function(){};Out.prototype.interfaces_=function(){return[]},Out.prototype.getClass=function(){return Out},Out.computeDistance=function(){if(arguments[2]instanceof Eut&&arguments[0]instanceof Zat&&arguments[1]instanceof ost)for(var t=arguments[0],e=arguments[1],n=arguments[2],i=new dlt,r=t.getCoordinates(),o=0;o<r.length-1;o++){i.setCoordinates(r[o],r[o+1]);var s=i.closestPoint(e);n.setMinimum(s,e)}else if(arguments[2]instanceof Eut&&arguments[0]instanceof Jat&&arguments[1]instanceof ost){var a=arguments[0],h=arguments[1],l=arguments[2];Out.computeDistance(a.getExteriorRing(),h,l);for(var u=0;u<a.getNumInteriorRing();u++)Out.computeDistance(a.getInteriorRingN(u),h,l)}else if(arguments[2]instanceof Eut&&arguments[0]instanceof Wst&&arguments[1]instanceof ost){var c=arguments[0],A=arguments[1],f=arguments[2];if(c instanceof Zat)Out.computeDistance(c,A,f);else if(c instanceof Jat)Out.computeDistance(c,A,f);else if(c instanceof kat)for(var d=c,p=0;p<d.getNumGeometries();p++){var g=d.getGeometryN(p);Out.computeDistance(g,A,f)}else f.setMinimum(c.getCoordinate(),A)}else if(arguments[2]instanceof Eut&&arguments[0]instanceof dlt&&arguments[1]instanceof ost){var m=arguments[1],y=arguments[2],v=arguments[0].closestPoint(m);y.setMinimum(v,m)}};var Rut=function(){this.ze=null,this.de=null,this.xe=new Eut,this.me=0;var t=arguments[1];this.ze=arguments[0],this.de=t},Dut={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Rut.prototype.getCoordinates=function(){return this.xe.getCoordinates()},Rut.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new Kot("Fraction is not in range (0.0 - 1.0]");this.me=t},Rut.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this.xe),this.computeOrientedDistance(e,t,this.xe)},Rut.prototype.distance=function(){return this.compute(this.ze,this.de),this.xe.getDistance()},Rut.prototype.computeOrientedDistance=function(t,e,n){var i=new kut(e);if(t.apply(i),n.setMaximum(i.getMaxPointDistance()),this.me>0){var r=new Lut(e,this.me);t.apply(r),n.setMaximum(r.getMaxPointDistance())}},Rut.prototype.orientedDistance=function(){return this.computeOrientedDistance(this.ze,this.de,this.xe),this.xe.getDistance()},Rut.prototype.interfaces_=function(){return[]},Rut.prototype.getClass=function(){return Rut},Rut.distance=function(){if(2===arguments.length)return new Rut(arguments[0],arguments[1]).distance();if(3===arguments.length){var t=arguments[2],e=new Rut(arguments[0],arguments[1]);return e.setDensifyFraction(t),e.distance()}},Dut.MaxPointDistanceFilter.get=function(){return kut},Dut.MaxDensifiedByFractionDistanceFilter.get=function(){return Lut},Object.defineProperties(Rut,Dut);var kut=function(){this.ue=new Eut,this.oe=new Eut,this.ye=new Out,this.An=null,this.An=arguments[0]};kut.prototype.filter=function(t){this.oe.initialize(),Out.computeDistance(this.An,t,this.oe),this.ue.setMaximum(this.oe)},kut.prototype.getMaxPointDistance=function(){return this.ue},kut.prototype.interfaces_=function(){return[Qst]},kut.prototype.getClass=function(){return kut};var Lut=function(){this.ue=new Eut,this.oe=new Eut,this.An=null,this.pe=0;var t=arguments[1];this.An=arguments[0],this.pe=Math.trunc(Math.round(1/t))};Lut.prototype.filter=function(t,e){var n=this;if(0===e)return null;for(var i=t.getCoordinate(e-1),r=t.getCoordinate(e),o=(r.x-i.x)/this.pe,s=(r.y-i.y)/this.pe,a=0;a<this.pe;a++){var h=new ost(i.x+a*o,i.y+a*s);n.oe.initialize(),Out.computeDistance(n.An,h,n.oe),n.ue.setMaximum(n.oe)}},Lut.prototype.isDone=function(){return!1},Lut.prototype.isGeometryChanged=function(){return!1},Lut.prototype.getMaxPointDistance=function(){return this.ue},Lut.prototype.interfaces_=function(){return[Dat]},Lut.prototype.getClass=function(){return Lut};var Fut=function(t,e,n){this.Le=null,this.Te=null,this.Oe=null,this.Fe=null,this.Ue=!0,this.Ee=null,this.Ne=null,this.je=null,this.Qe=t||null,this.Se=e||null,this.Bt=n||null},Nut={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Fut.prototype.checkMaximumDistance=function(t,e,n){var i=new Rut(e,t);if(i.setDensifyFraction(.25),this.Fe=i.orientedDistance(),this.Fe>n){this.Ue=!1;var r=i.getCoordinates();this.Ne=r[1],this.je=t.getFactory().createLineString(r),this.Ee="Distance between buffer curve and input is too large ("+this.Fe+" at "+Dst.toLineString(r[0],r[1])+")"}},Fut.prototype.isValid=function(){var t=Math.abs(this.Se),e=Fut.MAX_DISTANCE_DIFF_FRAC*t;return this.Le=t-e,this.Te=t+e,!(!this.Qe.isEmpty()&&!this.Bt.isEmpty())||(this.Se>0?this.checkPositiveValid():this.checkNegativeValid(),Fut.VERBOSE&&Pst.out.println("Min Dist= "+this.Oe+"  err= "+(1-this.Oe/this.Se)+"  Max Dist= "+this.Fe+"  err= "+(this.Fe/this.Se-1)),this.Ue)},Fut.prototype.checkNegativeValid=function(){if(!(this.Qe instanceof Jat||this.Qe instanceof tht||this.Qe instanceof kat))return null;var t=this.getPolygonLines(this.Qe);if(this.checkMinimumDistance(t,this.Bt,this.Le),!this.Ue)return null;this.checkMaximumDistance(t,this.Bt,this.Te)},Fut.prototype.getErrorIndicator=function(){return this.je},Fut.prototype.checkMinimumDistance=function(t,e,n){var i=new Iut(t,e,n);if(this.Oe=i.distance(),this.Oe<n){this.Ue=!1;var r=i.nearestPoints();this.Ne=i.nearestPoints()[1],this.je=t.getFactory().createLineString(r),this.Ee="Distance between buffer curve and input is too small ("+this.Oe+" at "+Dst.toLineString(r[0],r[1])+" )"}},Fut.prototype.checkPositiveValid=function(){var t=this.Bt.getBoundary();if(this.checkMinimumDistance(this.Qe,t,this.Le),!this.Ue)return null;this.checkMaximumDistance(this.Qe,t,this.Te)},Fut.prototype.getErrorLocation=function(){return this.Ne},Fut.prototype.getPolygonLines=function(t){for(var e=new sat,n=new wut(e),i=but.getPolygons(t).iterator();i.hasNext();)i.next().apply(n);return t.getFactory().buildGeometry(e)},Fut.prototype.getErrorMessage=function(){return this.Ee},Fut.prototype.interfaces_=function(){return[]},Fut.prototype.getClass=function(){return Fut},Nut.VERBOSE.get=function(){return!1},Nut.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(Fut,Nut);var zut=function(t,e,n){this.Ue=!0,this.Be=null,this.Ne=null,this.je=null,this.Qe=t||null,this.ri=e||null,this.Bt=n||null},But={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};zut.prototype.isValid=function(){return this.checkPolygonal(),this.Ue?(this.checkExpectedEmpty(),this.Ue?(this.checkEnvelope(),this.Ue?(this.checkArea(),this.Ue?(this.checkDistance(),this.Ue):this.Ue):this.Ue):this.Ue):this.Ue},zut.prototype.checkEnvelope=function(){if(this.ri<0)return null;var t=this.ri*zut.MAX_ENV_DIFF_FRAC;0===t&&(t=.001);var e=new Tst(this.Qe.getEnvelopeInternal());e.expandBy(this.ri);var n=new Tst(this.Bt.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this.Ue=!1,this.Be="Buffer envelope is incorrect",this.je=this.Qe.getFactory().toGeometry(n)),this.report("Envelope")},zut.prototype.checkDistance=function(){var t=new Fut(this.Qe,this.ri,this.Bt);t.isValid()||(this.Ue=!1,this.Be=t.getErrorMessage(),this.Ne=t.getErrorLocation(),this.je=t.getErrorIndicator()),this.report("Distance")},zut.prototype.checkArea=function(){var t=this.Qe.getArea(),e=this.Bt.getArea();this.ri>0&&t>e&&(this.Ue=!1,this.Be="Area of positive buffer is smaller than input",this.je=this.Bt),this.ri<0&&t<e&&(this.Ue=!1,this.Be="Area of negative buffer is larger than input",this.je=this.Bt),this.report("Area")},zut.prototype.checkPolygonal=function(){this.Bt instanceof Jat||this.Bt instanceof tht||(this.Ue=!1),this.Be="Result is not polygonal",this.je=this.Bt,this.report("Polygonal")},zut.prototype.getErrorIndicator=function(){return this.je},zut.prototype.getErrorLocation=function(){return this.Ne},zut.prototype.checkExpectedEmpty=function(){return this.Qe.getDimension()>=2||this.ri>0?null:(this.Bt.isEmpty()||(this.Ue=!1,this.Be="Result is non-empty",this.je=this.Bt),void this.report("ExpectedEmpty"))},zut.prototype.report=function(t){if(!zut.VERBOSE)return null;Pst.out.println("Check "+t+": "+(this.Ue?"passed":"FAILED"))},zut.prototype.getErrorMessage=function(){return this.Be},zut.prototype.interfaces_=function(){return[]},zut.prototype.getClass=function(){return zut},zut.isValidMsg=function(t,e,n){var i=new zut(t,e,n);return i.isValid()?null:i.getErrorMessage()},zut.isValid=function(t,e,n){return!!new zut(t,e,n).isValid()},But.VERBOSE.get=function(){return!1},But.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(zut,But);var Hut=function(){this.dn=null,this.wi=null;var t=arguments[1];this.dn=arguments[0],this.wi=t};Hut.prototype.getCoordinates=function(){return this.dn},Hut.prototype.size=function(){return this.dn.length},Hut.prototype.getCoordinate=function(t){return this.dn[t]},Hut.prototype.isClosed=function(){return this.dn[0].equals(this.dn[this.dn.length-1])},Hut.prototype.getSegmentOctant=function(t){return t===this.dn.length-1?-1:ult.octant(this.getCoordinate(t),this.getCoordinate(t+1))},Hut.prototype.setData=function(t){this.wi=t},Hut.prototype.getData=function(){return this.wi},Hut.prototype.toString=function(){return Dst.toLineString(new sht(this.dn))},Hut.prototype.interfaces_=function(){return[clt]},Hut.prototype.getClass=function(){return Hut};var jut=function(){this.ke=!1,this.Re=!1,this.Wi=null,this.Ge=null,this.Ye=null,this.qe=new sat,this.Ve=0,this.We=!0,this.Wi=arguments[0],this.Ge=null};jut.prototype.getInteriorIntersection=function(){return this.Ge},jut.prototype.setCheckEndSegmentsOnly=function(t){this.Re=t},jut.prototype.getIntersectionSegments=function(){return this.Ye},jut.prototype.count=function(){return this.Ve},jut.prototype.getIntersections=function(){return this.qe},jut.prototype.setFindAllIntersections=function(t){this.ke=t},jut.prototype.setKeepIntersections=function(t){this.We=t},jut.prototype.processIntersections=function(t,e,n,i){if(!this.ke&&this.hasIntersection())return null;if(t===n&&e===i)return null;if(this.Re&&!this.isEndSegment(t,e)&&!this.isEndSegment(n,i))return null;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this.Wi.computeIntersection(r,o,s,a),this.Wi.hasIntersection()&&this.Wi.isInteriorIntersection()&&(this.Ye=new Array(4).fill(null),this.Ye[0]=r,this.Ye[1]=o,this.Ye[2]=s,this.Ye[3]=a,this.Ge=this.Wi.getIntersection(0),this.We&&this.qe.add(this.Ge),this.Ve++)},jut.prototype.isEndSegment=function(t,e){return 0===e||e>=t.size()-2},jut.prototype.hasIntersection=function(){return null!==this.Ge},jut.prototype.isDone=function(){return!this.ke&&null!==this.Ge},jut.prototype.interfaces_=function(){return[Zlt]},jut.prototype.getClass=function(){return jut},jut.createAllIntersectionsFinder=function(t){var e=new jut(t);return e.setFindAllIntersections(!0),e},jut.createAnyIntersectionFinder=function(t){return new jut(t)},jut.createIntersectionCounter=function(t){var e=new jut(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var Uut=function(){this.Wi=new Bst,this.Gr=null,this.ke=!1,this.Mi=null,this.Ue=!0,this.Gr=arguments[0]};Uut.prototype.execute=function(){if(null!==this.Mi)return null;this.checkInteriorIntersections()},Uut.prototype.getIntersections=function(){return this.Mi.getIntersections()},Uut.prototype.isValid=function(){return this.execute(),this.Ue},Uut.prototype.setFindAllIntersections=function(t){this.ke=t},Uut.prototype.checkInteriorIntersections=function(){this.Ue=!0,this.Mi=new jut(this.Wi),this.Mi.setFindAllIntersections(this.ke);var t=new xlt;if(t.setSegmentIntersector(this.Mi),t.computeNodes(this.Gr),this.Mi.hasIntersection())return this.Ue=!1,null},Uut.prototype.checkValid=function(){if(this.execute(),!this.Ue)throw new Sht(this.getErrorMessage(),this.Mi.getInteriorIntersection())},Uut.prototype.getErrorMessage=function(){if(this.Ue)return"no intersections found";var t=this.Mi.getIntersectionSegments();return"found non-noded intersection between "+Dst.toLineString(t[0],t[1])+" and "+Dst.toLineString(t[2],t[3])},Uut.prototype.interfaces_=function(){return[]},Uut.prototype.getClass=function(){return Uut},Uut.computeIntersections=function(t){var e=new Uut(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var Gut=function t(){this._e=null,this._e=new Uut(t.toSegmentStrings(arguments[0]))};Gut.prototype.checkValid=function(){this._e.checkValid()},Gut.prototype.interfaces_=function(){return[]},Gut.prototype.getClass=function(){return Gut},Gut.toSegmentStrings=function(t){for(var e=new sat,n=t.iterator();n.hasNext();){var i=n.next();e.add(new Hut(i.getCoordinates(),i))}return e},Gut.checkValid=function(t){new Gut(t).checkValid()};var Vut=function(t){this.Ke=t};Vut.prototype.map=function(t){for(var e=new sat,n=0;n<t.getNumGeometries();n++){var i=this.Ke.map(t.getGeometryN(n));i.isEmpty()||e.add(i)}return t.getFactory().createGeometryCollection(pht.toGeometryArray(e))},Vut.prototype.interfaces_=function(){return[]},Vut.prototype.getClass=function(){return Vut},Vut.map=function(t,e){return new Vut(e).map(t)};var Wut=function(){this.He=null,this.pn=null,this.Ie=null,this.Je=new sat,this.Ze=new sat;var t=arguments[1],e=arguments[2];this.He=arguments[0],this.pn=t,this.Ie=e};Wut.prototype.collectLines=function(t){for(var e=this,n=this.He.getGraph().getEdgeEnds().iterator();n.hasNext();){var i=n.next();e.collectLineEdge(i,t,e.Je),e.collectBoundaryTouchEdge(i,t,e.Je)}},Wut.prototype.labelIsolatedLine=function(t,e){var n=this.Ie.locate(t.getCoordinate(),this.He.getArgGeometry(e));t.getLabel().setLocation(e,n)},Wut.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this.Ze},Wut.prototype.collectLineEdge=function(t,e,n){var i=t.getLabel(),r=t.getEdge();t.isLineEdge()&&(t.isVisited()||!Pct.isResultOfOp(i,e)||r.isCovered()||(n.add(r),t.setVisitedEdge(!0)))},Wut.prototype.findCoveredLineEdges=function(){for(var t=this.He.getGraph().getNodes().iterator();t.hasNext();)t.next().getEdges().findCoveredLineEdges();for(var e=this.He.getGraph().getEdgeEnds().iterator();e.hasNext();){var n=e.next(),i=n.getEdge();if(n.isLineEdge()&&!i.isCoveredSet()){var r=this.He.isCoveredByA(n.getCoordinate());i.setCovered(r)}}},Wut.prototype.labelIsolatedLines=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},Wut.prototype.buildLines=function(t){for(var e=this.Je.iterator();e.hasNext();){var n=e.next(),i=this.pn.createLineString(n.getCoordinates());this.Ze.add(i),n.setInResult(!0)}},Wut.prototype.collectBoundaryTouchEdge=function(t,e,n){var i=t.getLabel();return t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult()?null:(Fst.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),void(Pct.isResultOfOp(i,e)&&e===Pct.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))))},Wut.prototype.interfaces_=function(){return[]},Wut.prototype.getClass=function(){return Wut};var qut=function(){this.He=null,this.pn=null,this.Xe=new sat;var t=arguments[1];this.He=arguments[0],this.pn=t};qut.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this.He.isCoveredByLA(e)){var n=this.pn.createPoint(e);this.Xe.add(n)}},qut.prototype.extractNonCoveredResultNodes=function(t){for(var e=this.He.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&t!==Pct.INTERSECTION)){var i=n.getLabel();Pct.isResultOfOp(i,t)&&this.filterCoveredNodeToPoint(n)}}},qut.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this.Xe},qut.prototype.interfaces_=function(){return[]},qut.prototype.getClass=function(){return qut};var Zut=function(){this.ur=null,this.Zt=null,this.$e=!0,this.As=!0,this.ts=!1,this.ns=!1};Zut.prototype.transformPoint=function(t,e){return this.Zt.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))},Zut.prototype.transformPolygon=function(t,e){var n=!0,i=this.transformLinearRing(t.getExteriorRing(),t);null!==i&&i instanceof $at&&!i.isEmpty()||(n=!1);for(var r=new sat,o=0;o<t.getNumInteriorRing();o++){var s=this.transformLinearRing(t.getInteriorRingN(o),t);null===s||s.isEmpty()||(s instanceof $at||(n=!1),r.add(s))}if(n)return this.Zt.createPolygon(i,r.toArray([]));var a=new sat;return null!==i&&a.add(i),a.addAll(r),this.Zt.buildGeometry(a)},Zut.prototype.createCoordinateSequence=function(t){return this.Zt.getCoordinateSequenceFactory().create(t)},Zut.prototype.getInputGeometry=function(){return this.ur},Zut.prototype.transformMultiLineString=function(t,e){for(var n=new sat,i=0;i<t.getNumGeometries();i++){var r=this.transformLineString(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.Zt.buildGeometry(n)},Zut.prototype.transformCoordinates=function(t,e){return this.copy(t)},Zut.prototype.transformLineString=function(t,e){return this.Zt.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))},Zut.prototype.transformMultiPoint=function(t,e){for(var n=new sat,i=0;i<t.getNumGeometries();i++){var r=this.transformPoint(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.Zt.buildGeometry(n)},Zut.prototype.transformMultiPolygon=function(t,e){for(var n=new sat,i=0;i<t.getNumGeometries();i++){var r=this.transformPolygon(t.getGeometryN(i),t);null!==r&&(r.isEmpty()||n.add(r))}return this.Zt.buildGeometry(n)},Zut.prototype.copy=function(t){return t.copy()},Zut.prototype.transformGeometryCollection=function(t,e){for(var n=new sat,i=0;i<t.getNumGeometries();i++){var r=this.transform(t.getGeometryN(i));null!==r&&(this.$e&&r.isEmpty()||n.add(r))}return this.As?this.Zt.createGeometryCollection(pht.toGeometryArray(n)):this.Zt.buildGeometry(n)},Zut.prototype.transform=function(t){if(this.ur=t,this.Zt=t.getFactory(),t instanceof Xat)return this.transformPoint(t,null);if(t instanceof Kat)return this.transformMultiPoint(t,null);if(t instanceof $at)return this.transformLinearRing(t,null);if(t instanceof Zat)return this.transformLineString(t,null);if(t instanceof Lat)return this.transformMultiLineString(t,null);if(t instanceof Jat)return this.transformPolygon(t,null);if(t instanceof tht)return this.transformMultiPolygon(t,null);if(t instanceof kat)return this.transformGeometryCollection(t,null);throw new Kot("Unknown Geometry subtype: "+t.getClass().getName())},Zut.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(null===n)return this.Zt.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this.ns?this.Zt.createLineString(n):this.Zt.createLinearRing(n)},Zut.prototype.interfaces_=function(){return[]},Zut.prototype.getClass=function(){return Zut};var Qut=function t(){if(this.rs=0,this.es=null,this.ir=new dlt,this.ss=!1,this.us=!1,arguments[0]instanceof Zat&&"number"==typeof arguments[1]){var e=arguments[1];t.call(this,arguments[0].getCoordinates(),e)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.es=n,this.us=t.isClosed(n),this.rs=i}};Qut.prototype.snapVertices=function(t,e){for(var n=this.us?t.size()-1:t.size(),i=0;i<n;i++){var r=t.get(i),o=this.findSnapForVertex(r,e);null!==o&&(t.set(i,new ost(o)),0===i&&this.us&&t.set(t.size()-1,new ost(o)))}},Qut.prototype.findSnapForVertex=function(t,e){for(var n=0;n<e.length;n++){if(t.equals2D(e[n]))return null;if(t.distance(e[n])<this.rs)return e[n]}return null},Qut.prototype.snapTo=function(t){var e=new hat(this.es);return this.snapVertices(e,t),this.snapSegments(e,t),e.toCoordinateArray()},Qut.prototype.snapSegments=function(t,e){if(0===e.length)return null;var n=e.length;e[0].equals2D(e[e.length-1])&&(n=e.length-1);for(var i=0;i<n;i++){var r=e[i],o=this.findSegmentIndexToSnap(r,t);o>=0&&t.add(o+1,new ost(r),!1)}},Qut.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,i=$ot.MAX_VALUE,r=-1,o=0;o<e.size()-1;o++){if(n.ir.p0=e.get(o),n.ir.p1=e.get(o+1),n.ir.p0.equals2D(t)||n.ir.p1.equals2D(t)){if(n.ss)continue;return-1}var s=n.ir.distance(t);s<n.rs&&s<i&&(i=s,r=o)}return r},Qut.prototype.setAllowSnappingToSourceVertices=function(t){this.ss=t},Qut.prototype.interfaces_=function(){return[]},Qut.prototype.getClass=function(){return Qut},Qut.isClosed=function(t){return!(t.length<=1)&&t[0].equals2D(t[t.length-1])};var Xut=function(t){this.os=t||null},Yut={SNAP_PRECISION_FACTOR:{configurable:!0}};Xut.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t);return new Jut(e,n).transform(this.os)},Xut.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this.os),i=new Jut(t,n,!0).transform(this.os),r=i;return e&&cst(r,Yat)&&(r=i.buffer(0)),r},Xut.prototype.computeSnapTolerance=function(t){return this.computeMinimumSegmentLength(t)/10},Xut.prototype.extractTargetCoordinates=function(t){for(var e=new Tat,n=t.getCoordinates(),i=0;i<n.length;i++)e.add(n[i]);return e.toArray(new Array(0).fill(null))},Xut.prototype.computeMinimumSegmentLength=function(t){for(var e=$ot.MAX_VALUE,n=0;n<t.length-1;n++){var i=t[n].distance(t[n+1]);i<e&&(e=i)}return e},Xut.prototype.interfaces_=function(){return[]},Xut.prototype.getClass=function(){return Xut},Xut.snap=function(t,e,n){var i=new Array(2).fill(null),r=new Xut(t);i[0]=r.snapTo(e,n);var o=new Xut(e);return i[1]=o.snapTo(i[0],n),i},Xut.computeOverlaySnapTolerance=function(){if(1===arguments.length){var t=arguments[0],e=Xut.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===cht.FIXED){var i=1/n.getScale()*2/1.415;i>e&&(e=i)}return e}if(2===arguments.length){var r=arguments[1];return Math.min(Xut.computeOverlaySnapTolerance(arguments[0]),Xut.computeOverlaySnapTolerance(r))}},Xut.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal();return Math.min(e.getHeight(),e.getWidth())*Xut.SNAP_PRECISION_FACTOR},Xut.snapToSelf=function(t,e,n){return new Xut(t).snapToSelf(e,n)},Yut.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Xut,Yut);var Jut=function(t){function e(e,n,i){t.call(this),this.rs=e||null,this.hs=n||null,this.fs=void 0!==i&&i}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.snapLine=function(t,e){var n=new Qut(t,this.rs);return n.setAllowSnappingToSourceVertices(this.fs),n.snapTo(e)},e.prototype.transformCoordinates=function(t,e){var n=t.toCoordinateArray(),i=this.snapLine(n,this.hs);return this.Zt.getCoordinateSequenceFactory().create(i)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zut),Kut=function(){this.cs=!0,this.vs=53,this.ls=0,this.ws=null};Kut.prototype.getCommon=function(){return $ot.longBitsToDouble(this.ls)},Kut.prototype.add=function(t){var e=$ot.doubleToLongBits(t);return this.cs?(this.ls=e,this.ws=Kut.signExpBits(this.ls),this.cs=!1,null):Kut.signExpBits(e)!==this.ws?(this.ls=0,null):(this.vs=Kut.numCommonMostSigMantissaBits(this.ls,e),void(this.ls=Kut.zeroLowerBits(this.ls,64-(12+this.vs))))},Kut.prototype.toString=function(){if(1===arguments.length){var t=arguments[0],e=$ot.longBitsToDouble(t),n="0000000000000000000000000000000000000000000000000000000000000000"+$ot.toBinaryString(t),i=n.substring(n.length-64);return i.substring(0,1)+"  "+i.substring(1,12)+"(exp) "+i.substring(12)+" [ "+e+" ]"}},Kut.prototype.interfaces_=function(){return[]},Kut.prototype.getClass=function(){return Kut},Kut.getBit=function(t,e){return t&1<<e?1:0},Kut.signExpBits=function(t){return t>>52},Kut.zeroLowerBits=function(t,e){return t&~((1<<e)-1)},Kut.numCommonMostSigMantissaBits=function(t,e){for(var n=0,i=52;i>=0;i--){if(Kut.getBit(t,i)!==Kut.getBit(e,i))return n;n++}return 52};var $ut=function(){this.Ps=null,this.gs=new ect},tct={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};$ut.prototype.addCommonBits=function(t){var e=new nct(this.Ps);t.apply(e),t.geometryChanged()},$ut.prototype.removeCommonBits=function(t){if(0===this.Ps.x&&0===this.Ps.y)return t;var e=new ost(this.Ps);e.x=-e.x,e.y=-e.y;var n=new nct(e);return t.apply(n),t.geometryChanged(),t},$ut.prototype.getCommonCoordinate=function(){return this.Ps},$ut.prototype.add=function(t){t.apply(this.gs),this.Ps=this.gs.getCommonCoordinate()},$ut.prototype.interfaces_=function(){return[]},$ut.prototype.getClass=function(){return $ut},tct.CommonCoordinateFilter.get=function(){return ect},tct.Translater.get=function(){return nct},Object.defineProperties($ut,tct);var ect=function(){this.Cs=new Kut,this.Ds=new Kut};ect.prototype.filter=function(t){this.Cs.add(t.x),this.Ds.add(t.y)},ect.prototype.getCommonCoordinate=function(){return new ost(this.Cs.getCommon(),this.Ds.getCommon())},ect.prototype.interfaces_=function(){return[Qst]},ect.prototype.getClass=function(){return ect};var nct=function(){this.trans=null,this.trans=arguments[0]};nct.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,i=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,i)},nct.prototype.isDone=function(){return!1},nct.prototype.isGeometryChanged=function(){return!0},nct.prototype.interfaces_=function(){return[Dat]},nct.prototype.getClass=function(){return nct};var ict=function(t,e){this.An=new Array(2).fill(null),this.rs=null,this.Is=null,this.An[0]=t,this.An[1]=e,this.computeSnapTolerance()};ict.prototype.selfSnap=function(t){return new Xut(t).snapTo(t,this.rs)},ict.prototype.removeCommonBits=function(t){this.Is=new $ut,this.Is.add(t[0]),this.Is.add(t[1]);var e=new Array(2).fill(null);return e[0]=this.Is.removeCommonBits(t[0].copy()),e[1]=this.Is.removeCommonBits(t[1].copy()),e},ict.prototype.prepareResult=function(t){return this.Is.addCommonBits(t),t},ict.prototype.getResultGeometry=function(t){var e=this.snap(this.An),n=Pct.overlayOp(e[0],e[1],t);return this.prepareResult(n)},ict.prototype.checkValid=function(t){t.isValid()||Pst.out.println("Snapped geometry is invalid")},ict.prototype.computeSnapTolerance=function(){this.rs=Xut.computeOverlaySnapTolerance(this.An[0],this.An[1])},ict.prototype.snap=function(t){var e=this.removeCommonBits(t);return Xut.snap(e[0],e[1],this.rs)},ict.prototype.interfaces_=function(){return[]},ict.prototype.getClass=function(){return ict},ict.overlayOp=function(t,e,n){return new ict(t,e).getResultGeometry(n)},ict.union=function(t,e){return ict.overlayOp(t,e,Pct.UNION)},ict.intersection=function(t,e){return ict.overlayOp(t,e,Pct.INTERSECTION)},ict.symDifference=function(t,e){return ict.overlayOp(t,e,Pct.SYMDIFFERENCE)},ict.difference=function(t,e){return ict.overlayOp(t,e,Pct.DIFFERENCE)};var rct=function(t,e){this.An=new Array(2).fill(null),this.An[0]=t,this.An[1]=e};rct.prototype.getResultGeometry=function(t){var e=null,n=!1,i=null;try{e=Pct.overlayOp(this.An[0],this.An[1],t),n=!0}catch(r){if(!(r instanceof kst))throw r;i=r}if(!n)try{e=ict.overlayOp(this.An[0],this.An[1],t)}catch(r){throw r instanceof kst?i:r}return e},rct.prototype.interfaces_=function(){return[]},rct.prototype.getClass=function(){return rct},rct.overlayOp=function(t,e,n){return new rct(t,e).getResultGeometry(n)},rct.union=function(t,e){return rct.overlayOp(t,e,Pct.UNION)},rct.intersection=function(t,e){return rct.overlayOp(t,e,Pct.INTERSECTION)},rct.symDifference=function(t,e){return rct.overlayOp(t,e,Pct.SYMDIFFERENCE)},rct.difference=function(t,e){return rct.overlayOp(t,e,Pct.DIFFERENCE)};var oct=function(){this.mce=null,this.chainIndex=null;var t=arguments[1];this.mce=arguments[0],this.chainIndex=t};oct.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)},oct.prototype.interfaces_=function(){return[]},oct.prototype.getClass=function(){return oct};var sct=function t(){if(this.xn=null,this.bs=null,this.Ms=null,this.zs=null,this.ds=null,this.xs=null,2===arguments.length){var e=arguments[0],n=arguments[1];this.Ms=t.DELETE,this.bs=e,this.zs=n}else if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2];this.Ms=t.INSERT,this.xn=i,this.bs=r,this.xs=o}},act={INSERT:{configurable:!0},DELETE:{configurable:!0}};sct.prototype.isDelete=function(){return this.Ms===sct.DELETE},sct.prototype.setDeleteEventIndex=function(t){this.ds=t},sct.prototype.getObject=function(){return this.xs},sct.prototype.compareTo=function(t){return this.bs<t.bs?-1:this.bs>t.bs?1:this.Ms<t.Ms?-1:this.Ms>t.Ms?1:0},sct.prototype.getInsertEvent=function(){return this.zs},sct.prototype.isInsert=function(){return this.Ms===sct.INSERT},sct.prototype.isSameLabel=function(t){return null!==this.xn&&this.xn===t.xn},sct.prototype.getDeleteEventIndex=function(){return this.ds},sct.prototype.interfaces_=function(){return[est]},sct.prototype.getClass=function(){return sct},act.INSERT.get=function(){return 1},act.DELETE.get=function(){return 2},Object.defineProperties(sct,act);var hct=function(){};hct.prototype.interfaces_=function(){return[]},hct.prototype.getClass=function(){return hct};var lct=function(){this.dr=!1,this.mr=!1,this.yr=!1,this.Lr=null,this.Wi=null,this.ys=null,this.ps=null,this.Tr=null,this.Ls=0,this.numTests=0,this.Ts=null,this.Os=!1,this.Fs=!1;var t=arguments[1],e=arguments[2];this.Wi=arguments[0],this.ys=t,this.ps=e};lct.prototype.isTrivialIntersection=function(t,e,n,i){if(t===n&&1===this.Wi.getIntersectionNum()){if(lct.isAdjacentSegments(e,i))return!0;if(t.isClosed()){var r=t.getNumPoints()-1;if(0===e&&i===r||0===i&&e===r)return!0}}return!1},lct.prototype.getProperIntersectionPoint=function(){return this.Lr},lct.prototype.setIsDoneIfProperInt=function(t){this.Fs=t},lct.prototype.hasProperInteriorIntersection=function(){return this.yr},lct.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next().getCoordinate();if(t.isIntersection(i))return!0}return!1},lct.prototype.hasProperIntersection=function(){return this.mr},lct.prototype.hasIntersection=function(){return this.dr},lct.prototype.isDone=function(){return this.Os},lct.prototype.isBoundaryPoint=function(t,e){return!(null===e||!this.isBoundaryPointInternal(t,e[0])&&!this.isBoundaryPointInternal(t,e[1]))},lct.prototype.setBoundaryNodes=function(t,e){this.Ts=new Array(2).fill(null),this.Ts[0]=t,this.Ts[1]=e},lct.prototype.addIntersections=function(t,e,n,i){if(t===n&&e===i)return null;this.numTests++;var r=t.getCoordinates()[e],o=t.getCoordinates()[e+1],s=n.getCoordinates()[i],a=n.getCoordinates()[i+1];this.Wi.computeIntersection(r,o,s,a),this.Wi.hasIntersection()&&(this.ps&&(t.setIsolated(!1),n.setIsolated(!1)),this.Ls++,this.isTrivialIntersection(t,e,n,i)||(this.dr=!0,!this.ys&&this.Wi.isProper()||(t.addIntersections(this.Wi,e,0),n.addIntersections(this.Wi,i,1)),this.Wi.isProper()&&(this.Lr=this.Wi.getIntersection(0).copy(),this.mr=!0,this.Fs&&(this.Os=!0),this.isBoundaryPoint(this.Wi,this.Ts)||(this.yr=!0))))},lct.prototype.interfaces_=function(){return[]},lct.prototype.getClass=function(){return lct},lct.isAdjacentSegments=function(t,e){return 1===Math.abs(t-e)};var uct=function(t){function e(){t.call(this),this.events=new sat,this.nOverlaps=null}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.prepareEvents=function(){$ht.sort(this.events);for(var t=0;t<this.events.size();t++){var e=this.events.get(t);e.isDelete()&&e.getInsertEvent().setDeleteEventIndex(t)}},e.prototype.computeIntersections=function(){if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var e=0;e<this.events.size();e++){var n=this.events.get(e);if(n.isInsert()&&this.processOverlaps(e,n.getDeleteEventIndex(),n,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof lct&&cst(arguments[0],rat)&&cst(arguments[1],rat)){var i=arguments[0],r=arguments[1],o=arguments[2];this.addEdges(i,i),this.addEdges(r,r),this.computeIntersections(o)}else if("boolean"==typeof arguments[2]&&cst(arguments[0],rat)&&arguments[1]instanceof lct){var s=arguments[0],a=arguments[1];arguments[2]?this.addEdges(s,null):this.addEdges(s),this.computeIntersections(a)}},e.prototype.addEdge=function(t,e){for(var n=t.getMonotoneChainEdge(),i=n.getStartIndexes(),r=0;r<i.length-1;r++){var o=new oct(n,r),s=new sct(e,n.getMinX(r),o);this.events.add(s),this.events.add(new sct(n.getMaxX(r),s))}},e.prototype.processOverlaps=function(t,e,n,i){for(var r=n.getObject(),o=t;o<e;o++){var s=this.events.get(o);if(s.isInsert()){var a=s.getObject();n.isSameLabel(s)||(r.computeIntersections(a,i),this.nOverlaps++)}}},e.prototype.addEdges=function(){if(1===arguments.length)for(var t=arguments[0].iterator();t.hasNext();){var e=t.next();this.addEdge(e,e)}else if(2===arguments.length)for(var n=arguments[1],i=arguments[0].iterator();i.hasNext();){var r=i.next();this.addEdge(r,n)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(hct),cct=function(){this.Us=$ot.POSITIVE_INFINITY,this.lr=$ot.NEGATIVE_INFINITY},Act={NodeComparator:{configurable:!0}};cct.prototype.getMin=function(){return this.Us},cct.prototype.intersects=function(t,e){return!(this.Us>e||this.lr<t)},cct.prototype.getMax=function(){return this.lr},cct.prototype.toString=function(){return Dst.toLineString(new ost(this.Us,0),new ost(this.lr,0))},cct.prototype.interfaces_=function(){return[]},cct.prototype.getClass=function(){return cct},Act.NodeComparator.get=function(){return fct},Object.defineProperties(cct,Act);var fct=function(){};fct.prototype.compare=function(t,e){var n=(t.Us+t.lr)/2,i=(e.Us+e.lr)/2;return n<i?-1:n>i?1:0},fct.prototype.interfaces_=function(){return[ist]},fct.prototype.getClass=function(){return fct};var dct=function(t){function e(){t.call(this),this.Zn=null;var e=arguments[1],n=arguments[2];this.Us=arguments[0],this.lr=e,this.Zn=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;n.visitItem(this.Zn)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cct),pct=function(t){function e(){t.call(this),this.Es=null,this.Ns=null;var e=arguments[1];this.Es=arguments[0],this.Ns=e,this.buildExtent(this.Es,this.Ns)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.buildExtent=function(t,e){this.Us=Math.min(t.Us,e.Us),this.lr=Math.max(t.lr,e.lr)},e.prototype.query=function(t,e,n){if(!this.intersects(t,e))return null;null!==this.Es&&this.Es.query(t,e,n),null!==this.Ns&&this.Ns.query(t,e,n)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cct),gct=function(){this.js=new sat,this.si=null,this.ti=0};gct.prototype.buildTree=function(){$ht.sort(this.js,new cct.NodeComparator);for(var t=this.js,e=null,n=new sat;;){if(this.buildLevel(t,n),1===n.size())return n.get(0);e=t,t=n,n=e}},gct.prototype.insert=function(t,e,n){if(null!==this.si)throw new Error("Index cannot be added to once it has been queried");this.js.add(new dct(t,e,n))},gct.prototype.query=function(t,e,n){this.init(),this.si.query(t,e,n)},gct.prototype.buildRoot=function(){if(null!==this.si)return null;this.si=this.buildTree()},gct.prototype.printNode=function(t){Pst.out.println(Dst.toLineString(new ost(t.Us,this.ti),new ost(t.lr,this.ti)))},gct.prototype.init=function(){if(null!==this.si)return null;this.buildRoot()},gct.prototype.buildLevel=function(t,e){this.ti++,e.clear();for(var n=0;n<t.size();n+=2){var i=t.get(n);if(null===(n+1<t.size()?t.get(n):null))e.add(i);else{var r=new pct(t.get(n),t.get(n+1));e.add(r)}}},gct.prototype.interfaces_=function(){return[]},gct.prototype.getClass=function(){return gct};var mct=function(){this.$n=new sat};mct.prototype.visitItem=function(t){this.$n.add(t)},mct.prototype.getItems=function(){return this.$n},mct.prototype.interfaces_=function(){return[Xht]},mct.prototype.getClass=function(){return mct};var yct=function(){this.di=null;var t=arguments[0];if(!cst(t,Yat))throw new Kot("Argument must be Polygonal");this.di=new xct(t)},vct={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};yct.prototype.locate=function(t){var e=new jst(t),n=new _ct(e);return this.di.query(t.y,t.y,n),e.getLocation()},yct.prototype.interfaces_=function(){return[Blt]},yct.prototype.getClass=function(){return yct},vct.SegmentVisitor.get=function(){return _ct},vct.IntervalIndexedGeometry.get=function(){return xct},Object.defineProperties(yct,vct);var _ct=function(){this.Qs=null,this.Qs=arguments[0]};_ct.prototype.visitItem=function(t){var e=t;this.Qs.countSegment(e.getCoordinate(0),e.getCoordinate(1))},_ct.prototype.interfaces_=function(){return[Xht]},_ct.prototype.getClass=function(){return _ct};var xct=function(){this.di=new gct,this.init(arguments[0])};xct.prototype.init=function(t){for(var e=wut.getLines(t).iterator();e.hasNext();){var n=e.next().getCoordinates();this.addLine(n)}},xct.prototype.addLine=function(t){for(var e=1;e<t.length;e++){var n=new dlt(t[e-1],t[e]),i=Math.min(n.p0.y,n.p1.y),r=Math.max(n.p0.y,n.p1.y);this.di.insert(i,r,n)}},xct.prototype.query=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new mct;return this.di.query(t,e,n),n.getItems()}3===arguments.length&&this.di.query(arguments[0],arguments[1],arguments[2])},xct.prototype.interfaces_=function(){return[]},xct.prototype.getClass=function(){return xct};var bct=function(t){function e(){if(t.call(this),this.Ss=null,this.Bs=new uht,this.ks=null,this.Rs=!0,this.Gs=null,this.Ys=null,this.qs=!1,this.Vs=null,this.Ws=null,this.Ie=new Cut,2===arguments.length){var e=arguments[1],n=Xst.OGC_SFS_BOUNDARY_RULE;this.Gs=arguments[0],this.Ss=e,this.ks=n,null!==e&&this.add(e)}else if(3===arguments.length){var i=arguments[1],r=arguments[2];this.Gs=arguments[0],this.Ss=i,this.ks=r,null!==i&&this.add(i)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.insertBoundaryPoint=function(t,n){var i=this.Cn.addNode(n).getLabel(),r=1;i.getLocation(t,wht.ON)===lst.BOUNDARY&&r++;var o=e.determineBoundary(this.ks,r);i.setLocation(t,o)},e.prototype.computeSelfNodes=function(){if(2===arguments.length)return this.computeSelfNodes(arguments[0],arguments[1],!1);if(3===arguments.length){var t=arguments[1],e=arguments[2],n=new lct(arguments[0],!0,!1);return n.setIsDoneIfProperInt(e),this.createEdgeSetIntersector().computeIntersections(this.zn,n,t||!(this.Ss instanceof $at||this.Ss instanceof Jat||this.Ss instanceof tht)),this.addSelfIntersectionNodes(this.Gs),n}},e.prototype.computeSplitEdges=function(t){for(var e=this.zn.iterator();e.hasNext();)e.next().eiList.addSplitEdges(t)},e.prototype.computeEdgeIntersections=function(t,e,n){var i=new lct(e,n,!0);return i.setBoundaryNodes(this.getBoundaryNodes(),t.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this.zn,t.zn,i),i},e.prototype.getGeometry=function(){return this.Ss},e.prototype.getBoundaryNodeRule=function(){return this.ks},e.prototype.hasTooFewPoints=function(){return this.qs},e.prototype.addPoint=function(){if(arguments[0]instanceof Xat){var t=arguments[0].getCoordinate();this.insertPoint(this.Gs,t,lst.INTERIOR)}else arguments[0]instanceof ost&&this.insertPoint(this.Gs,arguments[0],lst.INTERIOR)},e.prototype.addPolygon=function(t){this.addPolygonRing(t.getExteriorRing(),lst.EXTERIOR,lst.INTERIOR);for(var e=0;e<t.getNumInteriorRing();e++){var n=t.getInteriorRingN(e);this.addPolygonRing(n,lst.INTERIOR,lst.EXTERIOR)}},e.prototype.addEdge=function(t){this.insertEdge(t);var e=t.getCoordinates();this.insertPoint(this.Gs,e[0],lst.BOUNDARY),this.insertPoint(this.Gs,e[e.length-1],lst.BOUNDARY)},e.prototype.addLineString=function(t){var e=lat.removeRepeatedPoints(t.getCoordinates());if(e.length<2)return this.qs=!0,this.Vs=e[0],null;var n=new eut(e,new Rht(this.Gs,lst.INTERIOR));this.Bs.put(t,n),this.insertEdge(n),Fst.isTrue(e.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this.Gs,e[0]),this.insertBoundaryPoint(this.Gs,e[e.length-1])},e.prototype.getInvalidPoint=function(){return this.Vs},e.prototype.getBoundaryPoints=function(){for(var t=this.getBoundaryNodes(),e=new Array(t.size()).fill(null),n=0,i=t.iterator();i.hasNext();){var r=i.next();e[n++]=r.getCoordinate().copy()}return e},e.prototype.getBoundaryNodes=function(){return null===this.Ys&&(this.Ys=this.Cn.getBoundaryNodes(this.Gs)),this.Ys},e.prototype.addSelfIntersectionNode=function(t,e,n){if(this.isBoundaryNode(t,e))return null;n===lst.BOUNDARY&&this.Rs?this.insertBoundaryPoint(t,e):this.insertPoint(t,e,n)},e.prototype.addPolygonRing=function(t,e,n){if(t.isEmpty())return null;var i=lat.removeRepeatedPoints(t.getCoordinates());if(i.length<4)return this.qs=!0,this.Vs=i[0],null;var r=e,o=n;Ust.isCCW(i)&&(r=n,o=e);var s=new eut(i,new Rht(this.Gs,lst.BOUNDARY,r,o));this.Bs.put(t,s),this.insertEdge(s),this.insertPoint(this.Gs,i[0],lst.BOUNDARY)},e.prototype.insertPoint=function(t,e,n){var i=this.Cn.addNode(e),r=i.getLabel();null===r?i.xn=new Rht(t,n):r.setLocation(t,n)},e.prototype.createEdgeSetIntersector=function(){return new uct},e.prototype.addSelfIntersectionNodes=function(t){for(var e=this.zn.iterator();e.hasNext();)for(var n=e.next(),i=n.getLabel().getLocation(t),r=n.eiList.iterator();r.hasNext();){var o=r.next();this.addSelfIntersectionNode(t,o.coord,i)}},e.prototype.add=function(){if(1!==arguments.length)return t.prototype.add.apply(this,arguments);var e=arguments[0];if(e.isEmpty())return null;if(e instanceof tht&&(this.Rs=!1),e instanceof Jat)this.addPolygon(e);else if(e instanceof Zat)this.addLineString(e);else if(e instanceof Xat)this.addPoint(e);else if(e instanceof Kat)this.addCollection(e);else if(e instanceof Lat)this.addCollection(e);else if(e instanceof tht)this.addCollection(e);else{if(!(e instanceof kat))throw new Error(e.getClass().getName());this.addCollection(e)}},e.prototype.addCollection=function(t){for(var e=0;e<t.getNumGeometries();e++){var n=t.getGeometryN(e);this.add(n)}},e.prototype.locate=function(t){return cst(this.Ss,Yat)&&this.Ss.getNumGeometries()>50?(null===this.Ws&&(this.Ws=new yct(this.Ss)),this.Ws.locate(t)):this.Ie.locate(t,this.Ss)},e.prototype.findEdge=function(){return 1===arguments.length?this.Bs.get(arguments[0]):t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(t,e){return t.isInBoundary(e)?lst.BOUNDARY:lst.INTERIOR},e}(Vht),wct=function(){if(this.Wi=new Bst,this._s=null,this.Ks=null,1===arguments.length){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this.Ks=new Array(1).fill(null),this.Ks[0]=new bct(0,t)}else if(2===arguments.length){var e=arguments[0],n=arguments[1],i=Xst.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this.Ks=new Array(2).fill(null),this.Ks[0]=new bct(0,e,i),this.Ks[1]=new bct(1,n,i)}else if(3===arguments.length){var r=arguments[0],o=arguments[1],s=arguments[2];r.getPrecisionModel().compareTo(o.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(o.getPrecisionModel()),this.Ks=new Array(2).fill(null),this.Ks[0]=new bct(0,r,s),this.Ks[1]=new bct(1,o,s)}};wct.prototype.getArgGeometry=function(t){return this.Ks[t].getGeometry()},wct.prototype.setComputationPrecision=function(t){this._s=t,this.Wi.setPrecisionModel(this._s)},wct.prototype.interfaces_=function(){return[]},wct.prototype.getClass=function(){return wct};var Cct=function(){};Cct.prototype.interfaces_=function(){return[]},Cct.prototype.getClass=function(){return Cct},Cct.map=function(){if(arguments[0]instanceof Wst&&cst(arguments[1],Cct.MapOp)){for(var t=arguments[0],e=arguments[1],n=new sat,i=0;i<t.getNumGeometries();i++){var r=e.map(t.getGeometryN(i));null!==r&&n.add(r)}return t.getFactory().buildGeometry(n)}if(cst(arguments[0],eat)&&cst(arguments[1],Cct.MapOp)){for(var o=arguments[0],s=arguments[1],a=new sat,h=o.iterator();h.hasNext();){var l=h.next(),u=s.map(l);null!==u&&a.add(u)}return a}},Cct.MapOp=function(){};var Pct=function(t){function e(){var e=arguments[0];t.call(this,e,arguments[1]),this.Ie=new Cut,this.tn=null,this.Hs=null,this.jr=null,this.gr=new qlt,this.Js=new sat,this.Ze=new sat,this.Xe=new sat,this.jr=new Vht(new Vlt),this.tn=e.getFactory()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.insertUniqueEdge=function(t){var e=this.gr.findEqualEdge(t);if(null!==e){var n=e.getLabel(),i=t.getLabel();e.isPointwiseEqual(t)||(i=new Rht(t.getLabel())).flip();var r=e.getDepth();r.isNull()&&r.add(n),r.add(i),n.merge(i)}else this.gr.add(t)},e.prototype.getGraph=function(){return this.jr},e.prototype.cancelDuplicateResultEdges=function(){for(var t=this.jr.getEdgeEnds().iterator();t.hasNext();){var e=t.next(),n=e.getSym();e.isInResult()&&n.isInResult()&&(e.setInResult(!1),n.setInResult(!1))}},e.prototype.isCoveredByLA=function(t){return!!this.isCovered(t,this.Ze)||!!this.isCovered(t,this.Js)},e.prototype.computeGeometry=function(t,n,i,r){var o=new sat;return o.addAll(t),o.addAll(n),o.addAll(i),o.isEmpty()?e.createEmptyResult(r,this.Ks[0].getGeometry(),this.Ks[1].getGeometry(),this.tn):this.tn.buildGeometry(o)},e.prototype.mergeSymLabels=function(){for(var t=this.jr.getNodes().iterator();t.hasNext();)t.next().getEdges().mergeSymLabels()},e.prototype.isCovered=function(t,e){for(var n=e.iterator();n.hasNext();){var i=n.next();if(this.Ie.locate(t,i)!==lst.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var t=new sat,e=this.gr.iterator();e.hasNext();){var n=e.next();n.isCollapsed()&&(e.remove(),t.add(n.getCollapsedEdge()))}this.gr.addAll(t)},e.prototype.updateNodeLabelling=function(){for(var t=this.jr.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getEdges().getLabel();e.getLabel().merge(n)}},e.prototype.getResultGeometry=function(t){return this.computeOverlay(t),this.Hs},e.prototype.insertUniqueEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();this.insertUniqueEdge(n)}},e.prototype.computeOverlay=function(t){this.copyPoints(0),this.copyPoints(1),this.Ks[0].computeSelfNodes(this.Wi,!1),this.Ks[1].computeSelfNodes(this.Wi,!1),this.Ks[0].computeEdgeIntersections(this.Ks[1],this.Wi,!0);var e=new sat;this.Ks[0].computeSplitEdges(e),this.Ks[1].computeSplitEdges(e),this.insertUniqueEdges(e),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),Gut.checkValid(this.gr.getEdges()),this.jr.addEdges(this.gr.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(t),this.cancelDuplicateResultEdges();var n=new Wht(this.tn);n.add(this.jr),this.Js=n.getPolygons();var i=new Wut(this,this.tn,this.Ie);this.Ze=i.build(t);var r=new qut(this,this.tn,this.Ie);this.Xe=r.build(t),this.Hs=this.computeGeometry(this.Xe,this.Ze,this.Js,t)},e.prototype.labelIncompleteNode=function(t,e){var n=this.Ie.locate(t.getCoordinate(),this.Ks[e].getGeometry());t.getLabel().setLocation(e,n)},e.prototype.copyPoints=function(t){for(var e=this.Ks[t].getNodeIterator();e.hasNext();){var n=e.next();this.jr.addNode(n.getCoordinate()).setLabel(t,n.getLabel().getLocation(t))}},e.prototype.findResultAreaEdges=function(t){for(var n=this.jr.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea()&&!i.isInteriorAreaEdge()&&e.isResultOfOp(r.getLocation(0,wht.RIGHT),r.getLocation(1,wht.RIGHT),t)&&i.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var t=this.gr.iterator();t.hasNext();){var e=t.next(),n=e.getLabel(),i=e.getDepth();if(!i.isNull()){i.normalize();for(var r=0;r<2;r++)n.isNull(r)||!n.isArea()||i.isNull(r)||(0===i.getDelta(r)?n.toLine(r):(Fst.isTrue(!i.isNull(r,wht.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(r,wht.LEFT,i.getLocation(r,wht.LEFT)),Fst.isTrue(!i.isNull(r,wht.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(r,wht.RIGHT,i.getLocation(r,wht.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var t=this.jr.getNodes().iterator();t.hasNext();)t.next().getEdges().computeLabelling(this.Ks);this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var t=this.jr.getNodes().iterator();t.hasNext();){var e=t.next(),n=e.getLabel();e.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(e,0):this.labelIncompleteNode(e,1)),e.getEdges().updateLabelling(n)}},e.prototype.isCoveredByA=function(t){return!!this.isCovered(t,this.Js)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(wct);Pct.overlayOp=function(t,e,n){return new Pct(t,e).getResultGeometry(n)},Pct.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return Pct.createEmptyResult(Pct.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return Vut.map(t,{interfaces_:function(){return[Cct.MapOp]},map:function(t){return t.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),rct.overlayOp(t,e,Pct.INTERSECTION)},Pct.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Pct.createEmptyResult(Pct.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),rct.overlayOp(t,e,Pct.SYMDIFFERENCE)},Pct.resultDimension=function(t,e,n){var i=e.getDimension(),r=n.getDimension(),o=-1;switch(t){case Pct.INTERSECTION:o=Math.min(i,r);break;case Pct.UNION:o=Math.max(i,r);break;case Pct.DIFFERENCE:o=i;break;case Pct.SYMDIFFERENCE:o=Math.max(i,r)}return o},Pct.createEmptyResult=function(t,e,n,i){var r=null;switch(Pct.resultDimension(t,e,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon()}return r},Pct.difference=function(t,e){return t.isEmpty()?Pct.createEmptyResult(Pct.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),rct.overlayOp(t,e,Pct.DIFFERENCE))},Pct.isResultOfOp=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=t.getLocation(0),i=t.getLocation(1);return Pct.isResultOfOp(n,i,e)}if(3===arguments.length){var r=arguments[0],o=arguments[1];switch(r===lst.BOUNDARY&&(r=lst.INTERIOR),o===lst.BOUNDARY&&(o=lst.INTERIOR),arguments[2]){case Pct.INTERSECTION:return r===lst.INTERIOR&&o===lst.INTERIOR;case Pct.UNION:return r===lst.INTERIOR||o===lst.INTERIOR;case Pct.DIFFERENCE:return r===lst.INTERIOR&&o!==lst.INTERIOR;case Pct.SYMDIFFERENCE:return r===lst.INTERIOR&&o!==lst.INTERIOR||r!==lst.INTERIOR&&o===lst.INTERIOR}return!1}},Pct.INTERSECTION=1,Pct.UNION=2,Pct.DIFFERENCE=3,Pct.SYMDIFFERENCE=4;var Mct=function(){this.Zs=null,this.Xs=null,this.$s=null,this.Ie=new Cut,this.ir=new dlt;var t=arguments[0],e=arguments[1];this.Zs=t,this.Xs=e,this.$s=this.extractLinework(t)};Mct.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this.$s.getNumGeometries();n++)for(var i=e.$s.getGeometryN(n).getCoordinateSequence(),r=0;r<i.size()-1;r++)if(i.getCoordinate(r,e.ir.p0),i.getCoordinate(r+1,e.ir.p1),e.ir.distance(t)<=e.Xs)return!0;return!1},Mct.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?lst.BOUNDARY:this.Ie.locate(t,this.Zs)},Mct.prototype.extractLinework=function(t){var e=new Tct;t.apply(e);var n=e.getLinework(),i=pht.toLineStringArray(n);return t.getFactory().createMultiLineString(i)},Mct.prototype.interfaces_=function(){return[]},Mct.prototype.getClass=function(){return Mct};var Tct=function(){this.$s=null,this.$s=new sat};Tct.prototype.getLinework=function(){return this.$s},Tct.prototype.filter=function(t){if(t instanceof Jat){var e=t;this.$s.add(e.getExteriorRing());for(var n=0;n<e.getNumInteriorRing();n++)this.$s.add(e.getInteriorRingN(n))}},Tct.prototype.interfaces_=function(){return[Rat]},Tct.prototype.getClass=function(){return Tct};var Sct=function(){this.Zs=null,this.Au=!0,this.tu=!0,this.Zs=arguments[0]};Sct.prototype.extractPoints=function(t,e,n){for(var i=t.getCoordinates(),r=0;r<i.length-1;r++)this.computeOffsetPoints(i[r],i[r+1],e,n)},Sct.prototype.setSidesToGenerate=function(t,e){this.Au=t,this.tu=e},Sct.prototype.getPoints=function(t){for(var e=new sat,n=wut.getLines(this.Zs).iterator();n.hasNext();){var i=n.next();this.extractPoints(i,t,e)}return e},Sct.prototype.computeOffsetPoints=function(t,e,n,i){var r=e.x-t.x,o=e.y-t.y,s=Math.sqrt(r*r+o*o),a=n*r/s,h=n*o/s,l=(e.x+t.x)/2,u=(e.y+t.y)/2;if(this.Au){var c=new ost(l-h,u+a);i.add(c)}if(this.tu){var A=new ost(l+h,u-a);i.add(A)}},Sct.prototype.interfaces_=function(){return[]},Sct.prototype.getClass=function(){return Sct};var Ict=function t(){this.An=null,this.nu=null,this.iu=new Array(3).fill(null),this.ru=null,this.Xs=t.TOLERANCE,this.eu=new sat;var e=arguments[0],n=arguments[1],i=arguments[2];this.Xs=t.computeBoundaryDistanceTolerance(e,n),this.An=[e,n,i],this.nu=[new Mct(this.An[0],this.Xs),new Mct(this.An[1],this.Xs),new Mct(this.An[2],this.Xs)]},Ect={TOLERANCE:{configurable:!0}};Ict.prototype.reportResult=function(t,e,n){Pst.out.println("Overlay result invalid - A:"+lst.toLocationSymbol(e[0])+" B:"+lst.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+lst.toLocationSymbol(e[2]))},Ict.prototype.isValid=function(t){return this.addTestPts(this.An[0]),this.addTestPts(this.An[1]),this.checkValid(t)},Ict.prototype.checkValid=function(){var t=this;if(1===arguments.length){for(var e=arguments[0],n=0;n<this.eu.size();n++){var i=t.eu.get(n);if(!t.checkValid(e,i))return t.ru=i,!1}return!0}if(2===arguments.length){var r=arguments[0],o=arguments[1];return this.iu[0]=this.nu[0].getLocation(o),this.iu[1]=this.nu[1].getLocation(o),this.iu[2]=this.nu[2].getLocation(o),!!Ict.hasLocation(this.iu,lst.BOUNDARY)||this.isValidResult(r,this.iu)}},Ict.prototype.addTestPts=function(t){var e=new Sct(t);this.eu.addAll(e.getPoints(5*this.Xs))},Ict.prototype.isValidResult=function(t,e){var n=Pct.isResultOfOp(e[0],e[1],t),i=!(n^e[2]===lst.INTERIOR);return i||this.reportResult(t,e,n),i},Ict.prototype.getInvalidLocation=function(){return this.ru},Ict.prototype.interfaces_=function(){return[]},Ict.prototype.getClass=function(){return Ict},Ict.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1},Ict.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Xut.computeSizeBasedSnapTolerance(t),Xut.computeSizeBasedSnapTolerance(e))},Ict.isValid=function(t,e,n,i){return new Ict(t,e,i).isValid(n)},Ect.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Ict,Ect);var Oct=function t(e){this.su=null,this.uu=!1,this.ou=null,this.su=t.extractFactory(e),this.ou=e};Oct.prototype.extractElements=function(t,e){if(null===t)return null;for(var n=0;n<t.getNumGeometries();n++){var i=t.getGeometryN(n);this.uu&&i.isEmpty()||e.add(i)}},Oct.prototype.combine=function(){for(var t=new sat,e=this.ou.iterator();e.hasNext();){var n=e.next();this.extractElements(n,t)}return 0===t.size()?null!==this.su?this.su.createGeometryCollection(null):null:this.su.buildGeometry(t)},Oct.prototype.interfaces_=function(){return[]},Oct.prototype.getClass=function(){return Oct},Oct.combine=function(){return 1===arguments.length?new Oct(arguments[0]).combine():2===arguments.length?new Oct(Oct.createList(arguments[0],arguments[1])).combine():3===arguments.length?new Oct(Oct.createList(arguments[0],arguments[1],arguments[2])).combine():void 0},Oct.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()},Oct.createList=function(){if(2===arguments.length){var t=arguments[0],e=arguments[1],n=new sat;return n.add(t),n.add(e),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],o=arguments[2],s=new sat;return s.add(i),s.add(r),s.add(o),s}};var Rct=function(){this.hu=null,this.su=null,this.hu=arguments[0],null===this.hu&&(this.hu=new sat)},Dct={STRTREE_NODE_CAPACITY:{configurable:!0}};Rct.prototype.reduceToGeometries=function(t){for(var e=new sat,n=t.iterator();n.hasNext();){var i=n.next(),r=null;cst(i,rat)?r=this.unionTree(i):i instanceof Wst&&(r=i),e.add(r)}return e},Rct.prototype.extractByEnvelope=function(t,e,n){for(var i=new sat,r=0;r<e.getNumGeometries();r++){var o=e.getGeometryN(r);o.getEnvelopeInternal().intersects(t)?i.add(o):n.add(o)}return this.su.buildGeometry(i)},Rct.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),i=e.getEnvelopeInternal();if(!n.intersects(i))return Oct.combine(t,e);if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var r=n.intersection(i);return this.unionUsingEnvelopeIntersection(t,e,r)},Rct.prototype.union=function(){if(null===this.hu)throw new Error("union() method cannot be called twice");if(this.hu.isEmpty())return null;this.su=this.hu.iterator().next().getFactory();for(var t=new olt(Rct.STRTREE_NODE_CAPACITY),e=this.hu.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this.hu=null;var i=t.itemsTree();return this.unionTree(i)},Rct.prototype.binaryUnion=function(){if(1===arguments.length){var t=arguments[0];return this.binaryUnion(t,0,t.size())}if(3===arguments.length){var e=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=Rct.getGeometry(e,n);return this.unionSafe(r,null)}if(i-n==2)return this.unionSafe(Rct.getGeometry(e,n),Rct.getGeometry(e,n+1));var o=Math.trunc((i+n)/2),s=this.binaryUnion(e,n,o),a=this.binaryUnion(e,o,i);return this.unionSafe(s,a)}},Rct.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var i=n.next();e=null===e?i.copy():e.union(i)}return e},Rct.prototype.unionSafe=function(t,e){return null===t&&null===e?null:null===t?e.copy():null===e?t.copy():this.unionOptimized(t,e)},Rct.prototype.unionActual=function(t,e){return Rct.restrictToPolygons(t.union(e))},Rct.prototype.unionTree=function(t){var e=this.reduceToGeometries(t);return this.binaryUnion(e)},Rct.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var i=new sat,r=this.extractByEnvelope(n,t,i),o=this.extractByEnvelope(n,e,i),s=this.unionActual(r,o);return i.add(s),Oct.combine(i)},Rct.prototype.bufferUnion=function(){if(1===arguments.length){var t=arguments[0];return t.get(0).getFactory().buildGeometry(t).buffer(0)}if(2===arguments.length){var e=arguments[0],n=arguments[1];return e.getFactory().createGeometryCollection([e,n]).buffer(0)}},Rct.prototype.interfaces_=function(){return[]},Rct.prototype.getClass=function(){return Rct},Rct.restrictToPolygons=function(t){if(cst(t,Yat))return t;var e=but.getPolygons(t);return 1===e.size()?e.get(0):t.getFactory().createMultiPolygon(pht.toPolygonArray(e))},Rct.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)},Rct.union=function(t){return new Rct(t).union()},Dct.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties(Rct,Dct);var kct=function(){};function Lct(){return new Fct}function Fct(){this.reset()}kct.prototype.interfaces_=function(){return[]},kct.prototype.getClass=function(){return kct},kct.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return Pct.createEmptyResult(Pct.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),rct.overlayOp(t,e,Pct.UNION)},Fct.prototype={constructor:Fct,reset:function(){this.s=this.t=0},add:function(t){zct(Nct,t,this.t),zct(this,Nct.s,this.s),this.s?this.t+=Nct.t:this.s=Nct.t},valueOf:function(){return this.s}};var Nct=new Fct;function zct(t,e,n){var i=t.s=e+n,r=i-e;t.t=e-(i-r)+(n-r)}var Bct=1e-6,Hct=Math.PI,jct=Hct/2,Uct=Hct/4,Gct=2*Hct,Vct=180/Hct,Wct=Hct/180,qct=Math.abs,Zct=Math.atan,Qct=Math.atan2,Xct=Math.cos,Yct=Math.sin,Jct=Math.sqrt;function Kct(t){return t>1?0:t<-1?Hct:Math.acos(t)}function $ct(t){return t>1?jct:t<-1?-jct:Math.asin(t)}function tAt(){}function eAt(t,e){t&&oAt.hasOwnProperty(t.type)&&oAt[t.type](t,e)}var nAt,iAt,rAt={Feature:function(t,e){eAt(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,i=-1,r=n.length;++i<r;)eAt(n[i].geometry,e)}},oAt={Sphere:function(t,e){e.sphere()},Point:function(t,e){e.point((t=t.coordinates)[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)e.point((t=n[i])[0],t[1],t[2])},LineString:function(t,e){sAt(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)sAt(n[i],e,0)},Polygon:function(t,e){aAt(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,i=-1,r=n.length;++i<r;)aAt(n[i],e)},GeometryCollection:function(t,e){for(var n=t.geometries,i=-1,r=n.length;++i<r;)eAt(n[i],e)}};function sAt(t,e,n){var i,r=-1,o=t.length-n;for(e.lineStart();++r<o;)e.point((i=t[r])[0],i[1],i[2]);e.lineEnd()}function aAt(t,e){var n=-1,i=t.length;for(e.polygonStart();++n<i;)sAt(t[n],e,1);e.polygonEnd()}function hAt(t){return[Qct(t[1],t[0]),$ct(t[2])]}function lAt(t){var e=t[0],n=t[1],i=Xct(n);return[i*Xct(e),i*Yct(e),Yct(n)]}function uAt(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function cAt(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function AAt(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function fAt(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function dAt(t){var e=Jct(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}function pAt(t,e){function n(n,i){return n=t(n,i),e(n[0],n[1])}return t.invert&&e.invert&&(n.invert=function(n,i){return(n=e.invert(n,i))&&t.invert(n[0],n[1])}),n}function gAt(t,e){return[t>Hct?t-Gct:t<-Hct?t+Gct:t,e]}function mAt(t){return function(e,n){return[(e+=t)>Hct?e-Gct:e<-Hct?e+Gct:e,n]}}function yAt(t){var e=mAt(t);return e.invert=mAt(-t),e}function vAt(t,e){var n=Xct(t),i=Yct(t),r=Xct(e),o=Yct(e);function s(t,e){var s=Xct(e),a=Xct(t)*s,h=Yct(t)*s,l=Yct(e),u=l*n+a*i;return[Qct(h*r-u*o,a*n-l*i),$ct(u*r+h*o)]}return s.invert=function(t,e){var s=Xct(e),a=Xct(t)*s,h=Yct(t)*s,l=Yct(e),u=l*r-h*o;return[Qct(h*r+l*o,a*n+u*i),$ct(u*n-a*i)]},s}function _At(t,e){(e=lAt(e))[0]-=t,dAt(e);var n=Kct(-e[1]);return((-e[2]<0?-n:n)+Gct-Bct)%Gct}function xAt(){var t,e=[];return{point:function(e,n){t.push([e,n])},lineStart:function(){e.push(t=[])},lineEnd:tAt,rejoin:function(){e.length>1&&e.push(e.pop().concat(e.shift()))},result:function(){var n=e;return e=[],t=null,n}}}function bAt(t,e){return qct(t[0]-e[0])<Bct&&qct(t[1]-e[1])<Bct}function wAt(t,e,n,i){this.x=t,this.z=e,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function CAt(t,e,n,i,r){var o,s,a=[],h=[];if(t.forEach((function(t){if(!((e=t.length-1)<=0)){var e,n,i=t[0],s=t[e];if(bAt(i,s)){for(r.lineStart(),o=0;o<e;++o)r.point((i=t[o])[0],i[1]);r.lineEnd()}else a.push(n=new wAt(i,t,null,!0)),h.push(n.o=new wAt(i,null,n,!1)),a.push(n=new wAt(s,t,null,!1)),h.push(n.o=new wAt(s,null,n,!0))}})),a.length){for(h.sort(e),PAt(a),PAt(h),o=0,s=h.length;o<s;++o)h[o].e=n=!n;for(var l,u,c=a[0];;){for(var A=c,f=!0;A.v;)if((A=A.n)===c)return;l=A.z,r.lineStart();do{if(A.v=A.o.v=!0,A.e){if(f)for(o=0,s=l.length;o<s;++o)r.point((u=l[o])[0],u[1]);else i(A.x,A.n.x,1,r);A=A.n}else{if(f)for(o=(l=A.p.z).length-1;o>=0;--o)r.point((u=l[o])[0],u[1]);else i(A.x,A.p.x,-1,r);A=A.p}l=(A=A.o).z,f=!f}while(!A.v);r.lineEnd()}}}function PAt(t){if(e=t.length){for(var e,n,i=0,r=t[0];++i<e;)r.n=n=t[i],n.p=r,r=n;r.n=n=t[0],n.p=r}}function MAt(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function TAt(t){for(var e,n,i,r=t.length,o=-1,s=0;++o<r;)s+=t[o].length;for(n=new Array(s);--r>=0;)for(e=(i=t[r]).length;--e>=0;)n[--s]=i[e];return n}Lct(),Lct(),Lct(),gAt.invert=gAt,1===(nAt=MAt).length&&(iAt=nAt,nAt=function(t,e){return MAt(iAt(t),e)});var SAt=1e9,IAt=-SAt,EAt=Lct();function OAt(t){return t}Lct(),Lct(),Lct();var RAt=1/0,DAt=RAt,kAt=-RAt,LAt=kAt,FAt={point:function(t,e){t<RAt&&(RAt=t),t>kAt&&(kAt=t),e<DAt&&(DAt=e),e>LAt&&(LAt=e)},lineStart:tAt,lineEnd:tAt,polygonStart:tAt,polygonEnd:tAt,result:function(){var t=[[RAt,DAt],[kAt,LAt]];return kAt=LAt=-(DAt=RAt=1/0),t}};function NAt(t,e,n,i){return function(r,o){var s,a,h,l=e(o),u=r.invert(i[0],i[1]),c=xAt(),A=e(c),f=!1,d={point:p,lineStart:m,lineEnd:y,polygonStart:function(){d.point=v,d.lineStart=_,d.lineEnd=x,a=[],s=[]},polygonEnd:function(){d.point=p,d.lineStart=m,d.lineEnd=y,a=TAt(a);var t=function(t,e){var n=e[0],i=e[1],r=[Yct(n),-Xct(n),0],o=0,s=0;EAt.reset();for(var a=0,h=t.length;a<h;++a)if(u=(l=t[a]).length)for(var l,u,c=l[u-1],A=c[0],f=c[1]/2+Uct,d=Yct(f),p=Xct(f),g=0;g<u;++g,A=y,d=_,p=x,c=m){var m=l[g],y=m[0],v=m[1]/2+Uct,_=Yct(v),x=Xct(v),b=y-A,w=b>=0?1:-1,C=w*b,P=C>Hct,M=d*_;if(EAt.add(Qct(M*w*Yct(C),p*x+M*Xct(C))),o+=P?b+w*Gct:b,P^A>=n^y>=n){var T=cAt(lAt(c),lAt(m));dAt(T);var S=cAt(r,T);dAt(S);var I=(P^b>=0?-1:1)*$ct(S[2]);(i>I||i===I&&(T[0]||T[1]))&&(s+=P^b>=0?1:-1)}}return(o<-Bct||o<Bct&&EAt<-Bct)^1&s}(s,u);a.length?(f||(o.polygonStart(),f=!0),CAt(a,BAt,t,n,o)):t&&(f||(o.polygonStart(),f=!0),o.lineStart(),n(null,null,1,o),o.lineEnd()),f&&(o.polygonEnd(),f=!1),a=s=null},sphere:function(){o.polygonStart(),o.lineStart(),n(null,null,1,o),o.lineEnd(),o.polygonEnd()}};function p(e,n){var i=r(e,n);t(e=i[0],n=i[1])&&o.point(e,n)}function g(t,e){var n=r(t,e);l.point(n[0],n[1])}function m(){d.point=g,l.lineStart()}function y(){d.point=p,l.lineEnd()}function v(t,e){h.push([t,e]);var n=r(t,e);A.point(n[0],n[1])}function _(){A.lineStart(),h=[]}function x(){v(h[0][0],h[0][1]),A.lineEnd();var t,e,n,i,r=A.clean(),l=c.result(),u=l.length;if(h.pop(),s.push(h),h=null,u)if(1&r){if((e=(n=l[0]).length-1)>0){for(f||(o.polygonStart(),f=!0),o.lineStart(),t=0;t<e;++t)o.point((i=n[t])[0],i[1]);o.lineEnd()}}else u>1&&2&r&&l.push(l.pop().concat(l.shift())),a.push(l.filter(zAt))}return d}}function zAt(t){return t.length>1}function BAt(t,e){return((t=t.x)[0]<0?t[1]-jct-Bct:jct-t[1])-((e=e.x)[0]<0?e[1]-jct-Bct:jct-e[1])}Lct();var HAt=NAt((function(){return!0}),(function(t){var e,n=NaN,i=NaN,r=NaN;return{lineStart:function(){t.lineStart(),e=1},point:function(o,s){var a,h,l,u,c,A,f,d=o>0?Hct:-Hct,p=qct(o-n);qct(p-Hct)<Bct?(t.point(n,i=(i+s)/2>0?jct:-jct),t.point(r,i),t.lineEnd(),t.lineStart(),t.point(d,i),t.point(o,i),e=0):r!==d&&p>=Hct&&(qct(n-r)<Bct&&(n-=r*Bct),qct(o-d)<Bct&&(o-=d*Bct),h=i,u=s,f=Yct((a=n)-(l=o)),i=qct(f)>Bct?Zct((Yct(h)*(A=Xct(u))*Yct(l)-Yct(u)*(c=Xct(h))*Yct(a))/(c*A*f)):(h+u)/2,t.point(r,i),t.lineEnd(),t.lineStart(),t.point(d,i),e=0),t.point(n=o,i=s),r=d},lineEnd:function(){t.lineEnd(),n=i=NaN},clean:function(){return 2-e}}}),(function(t,e,n,i){var r;if(null==t)i.point(-Hct,r=n*jct),i.point(0,r),i.point(Hct,r),i.point(Hct,0),i.point(Hct,-r),i.point(0,-r),i.point(-Hct,-r),i.point(-Hct,0),i.point(-Hct,r);else if(qct(t[0]-e[0])>Bct){var o=t[0]<e[0]?Hct:-Hct;i.point(-o,r=n*o/2),i.point(0,r),i.point(o,r)}else i.point(e[0],e[1])}),[-Hct,-jct]);function jAt(t){return function(e){var n=new UAt;for(var i in t)n[i]=t[i];return n.stream=e,n}}function UAt(){}function GAt(t,e,n){var i,r,o=e[1][0]-e[0][0],s=e[1][1]-e[0][1],a=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),null!=a&&t.clipExtent(null),i=n,r=t.stream(FAt),i&&rAt.hasOwnProperty(i.type)?rAt[i.type](i,r):eAt(i,r);var h=FAt.result(),l=Math.min(o/(h[1][0]-h[0][0]),s/(h[1][1]-h[0][1])),u=+e[0][0]+(o-l*(h[1][0]+h[0][0]))/2,c=+e[0][1]+(s-l*(h[1][1]+h[0][1]))/2;return null!=a&&t.clipExtent(a),t.scale(150*l).translate([u,c])}UAt.prototype={constructor:UAt,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var VAt=16,WAt=Xct(30*Wct);function qAt(t,e){return+e?function(t,e){function n(i,r,o,s,a,h,l,u,c,A,f,d,p,g){var m=l-i,y=u-r,v=m*m+y*y;if(v>4*e&&p--){var _=s+A,x=a+f,b=h+d,w=Jct(_*_+x*x+b*b),C=$ct(b/=w),P=qct(qct(b)-1)<Bct||qct(o-c)<Bct?(o+c)/2:Qct(x,_),M=t(P,C),T=M[0],S=M[1],I=T-i,E=S-r,O=y*I-m*E;(O*O/v>e||qct((m*I+y*E)/v-.5)>.3||s*A+a*f+h*d<WAt)&&(n(i,r,o,s,a,h,T,S,P,_/=w,x/=w,b,p,g),g.point(T,S),n(T,S,P,_,x,b,l,u,c,A,f,d,p,g))}}return function(e){var i,r,o,s,a,h,l,u,c,A,f,d,p={point:g,lineStart:m,lineEnd:v,polygonStart:function(){e.polygonStart(),p.lineStart=_},polygonEnd:function(){e.polygonEnd(),p.lineStart=m}};function g(n,i){n=t(n,i),e.point(n[0],n[1])}function m(){u=NaN,p.point=y,e.lineStart()}function y(i,r){var o=lAt([i,r]),s=t(i,r);n(u,c,l,A,f,d,u=s[0],c=s[1],l=i,A=o[0],f=o[1],d=o[2],VAt,e),e.point(u,c)}function v(){p.point=g,e.lineEnd()}function _(){m(),p.point=x,p.lineEnd=b}function x(t,e){y(i=t,e),r=u,o=c,s=A,a=f,h=d,p.point=y}function b(){n(u,c,l,A,f,d,r,o,i,s,a,h,VAt,e),p.lineEnd=v,v()}return p}}(t,e):(n=t,jAt({point:function(t,e){t=n(t,e),this.stream.point(t[0],t[1])}}));var n}var ZAt=jAt({point:function(t,e){this.stream.point(t*Wct,e*Wct)}});function QAt(t){return function(t){var e,n,i,r,o,s,a,h,l,u,c=150,A=480,f=250,d=0,p=0,g=0,m=0,y=0,v=null,_=HAt,x=null,b=OAt,w=.5,C=qAt(T,w);function P(t){return[(t=o(t[0]*Wct,t[1]*Wct))[0]*c+n,i-t[1]*c]}function M(t){return(t=o.invert((t[0]-n)/c,(i-t[1])/c))&&[t[0]*Vct,t[1]*Vct]}function T(t,r){return[(t=e(t,r))[0]*c+n,i-t[1]*c]}function S(){var t,s,a;o=pAt((t=g,s=m,a=y,r=(t%=Gct)?s||a?pAt(yAt(t),vAt(s,a)):yAt(t):s||a?vAt(s,a):gAt),e);var h=e(d,p);return n=A-h[0]*c,i=f+h[1]*c,I()}function I(){return l=u=null,P}return P.stream=function(t){return l&&u===t?l:l=ZAt(_(r,C(b(u=t))))},P.clipAngle=function(t){return arguments.length?(_=+t?function(t,e){var n=Xct(t),i=n>0,r=qct(n)>Bct;function o(t,e){return Xct(t)*Xct(e)>n}function s(t,e,i){var r=[1,0,0],o=cAt(lAt(t),lAt(e)),s=uAt(o,o),a=o[0],h=s-a*a;if(!h)return!i&&t;var l=n*s/h,u=-n*a/h,c=cAt(r,o),A=fAt(r,l);AAt(A,fAt(o,u));var f=c,d=uAt(A,f),p=uAt(f,f),g=d*d-p*(uAt(A,A)-1);if(!(g<0)){var m=Jct(g),y=fAt(f,(-d-m)/p);if(AAt(y,A),y=hAt(y),!i)return y;var v,_=t[0],x=e[0],b=t[1],w=e[1];x<_&&(v=_,_=x,x=v);var C=x-_,P=qct(C-Hct)<Bct;if(!P&&w<b&&(v=b,b=w,w=v),P||C<Bct?P?b+w>0^y[1]<(qct(y[0]-_)<Bct?b:w):b<=y[1]&&y[1]<=w:C>Hct^(_<=y[0]&&y[0]<=x)){var M=fAt(f,(-d+m)/p);return AAt(M,A),[y,hAt(M)]}}}function a(e,n){var r=i?t:Hct-t,o=0;return e<-r?o|=1:e>r&&(o|=2),n<-r?o|=4:n>r&&(o|=8),o}return NAt(o,(function(t){var e,n,h,l,u;return{lineStart:function(){l=h=!1,u=1},point:function(c,A){var f,d=[c,A],p=o(c,A),g=i?p?0:a(c,A):p?a(c+(c<0?Hct:-Hct),A):0;if(!e&&(l=h=p)&&t.lineStart(),p!==h&&(!(f=s(e,d))||bAt(e,f)||bAt(d,f))&&(d[0]+=Bct,d[1]+=Bct,p=o(d[0],d[1])),p!==h)u=0,p?(t.lineStart(),f=s(d,e),t.point(f[0],f[1])):(f=s(e,d),t.point(f[0],f[1]),t.lineEnd()),e=f;else if(r&&e&&i^p){var m;g&n||!(m=s(d,e,!0))||(u=0,i?(t.lineStart(),t.point(m[0][0],m[0][1]),t.point(m[1][0],m[1][1]),t.lineEnd()):(t.point(m[1][0],m[1][1]),t.lineEnd(),t.lineStart(),t.point(m[0][0],m[0][1])))}!p||e&&bAt(e,d)||t.point(d[0],d[1]),e=d,h=p,n=g},lineEnd:function(){h&&t.lineEnd(),e=null},clean:function(){return u|(l&&h)<<1}}}),(function(n,i,r,o){!function(t,e,n,i,r,o){if(n){var s=Xct(e),a=Yct(e),h=i*n;null==r?(r=e+i*Gct,o=e-h/2):(r=_At(s,r),o=_At(s,o),(i>0?r<o:r>o)&&(r+=i*Gct));for(var l,u=r;i>0?u>o:u<o;u-=h)l=hAt([s,-a*Xct(u),-a*Yct(u)]),t.point(l[0],l[1])}}(o,t,e,r,n,i)}),i?[0,-t]:[-Hct,t-Hct])}(v=t*Wct,6*Wct):(v=null,HAt),I()):v*Vct},P.clipExtent=function(t){return arguments.length?(b=null==t?(x=s=a=h=null,OAt):function(t,e,n,i){function r(r,o){return t<=r&&r<=n&&e<=o&&o<=i}function o(r,o,a,l){var u=0,c=0;if(null==r||(u=s(r,a))!==(c=s(o,a))||h(r,o)<0^a>0)do{l.point(0===u||3===u?t:n,u>1?i:e)}while((u=(u+a+4)%4)!==c);else l.point(o[0],o[1])}function s(i,r){return qct(i[0]-t)<Bct?r>0?0:3:qct(i[0]-n)<Bct?r>0?2:1:qct(i[1]-e)<Bct?r>0?1:0:r>0?3:2}function a(t,e){return h(t.x,e.x)}function h(t,e){var n=s(t,1),i=s(e,1);return n!==i?n-i:0===n?e[1]-t[1]:1===n?t[0]-e[0]:2===n?t[1]-e[1]:e[0]-t[0]}return function(s){var h,l,u,c,A,f,d,p,g,m,y,v=s,_=xAt(),x={point:b,lineStart:function(){x.point=w,l&&l.push(u=[]),m=!0,g=!1,d=p=NaN},lineEnd:function(){h&&(w(c,A),f&&g&&_.rejoin(),h.push(_.result())),x.point=b,g&&v.lineEnd()},polygonStart:function(){v=_,h=[],l=[],y=!0},polygonEnd:function(){var e=function(){for(var e=0,n=0,r=l.length;n<r;++n)for(var o,s,a=l[n],h=1,u=a.length,c=a[0],A=c[0],f=c[1];h<u;++h)o=A,s=f,A=(c=a[h])[0],f=c[1],s<=i?f>i&&(A-o)*(i-s)>(f-s)*(t-o)&&++e:f<=i&&(A-o)*(i-s)<(f-s)*(t-o)&&--e;return e}(),n=y&&e,r=(h=TAt(h)).length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),o(null,null,1,s),s.lineEnd()),r&&CAt(h,a,e,o,s),s.polygonEnd()),v=s,h=l=u=null}};function b(t,e){r(t,e)&&v.point(t,e)}function w(o,s){var a=r(o,s);if(l&&u.push([o,s]),m)c=o,A=s,f=a,m=!1,a&&(v.lineStart(),v.point(o,s));else if(a&&g)v.point(o,s);else{var h=[d=Math.max(IAt,Math.min(SAt,d)),p=Math.max(IAt,Math.min(SAt,p))],_=[o=Math.max(IAt,Math.min(SAt,o)),s=Math.max(IAt,Math.min(SAt,s))];!function(t,e,n,i,r,o){var s,a=t[0],h=t[1],l=0,u=1,c=e[0]-a,A=e[1]-h;if(s=n-a,c||!(s>0)){if(s/=c,c<0){if(s<l)return;s<u&&(u=s)}else if(c>0){if(s>u)return;s>l&&(l=s)}if(s=r-a,c||!(s<0)){if(s/=c,c<0){if(s>u)return;s>l&&(l=s)}else if(c>0){if(s<l)return;s<u&&(u=s)}if(s=i-h,A||!(s>0)){if(s/=A,A<0){if(s<l)return;s<u&&(u=s)}else if(A>0){if(s>u)return;s>l&&(l=s)}if(s=o-h,A||!(s<0)){if(s/=A,A<0){if(s>u)return;s>l&&(l=s)}else if(A>0){if(s<l)return;s<u&&(u=s)}return l>0&&(t[0]=a+l*c,t[1]=h+l*A),u<1&&(e[0]=a+u*c,e[1]=h+u*A),!0}}}}}(h,_,t,e,n,i)?a&&(v.lineStart(),v.point(o,s),y=!1):(g||(v.lineStart(),v.point(h[0],h[1])),v.point(_[0],_[1]),a||v.lineEnd(),y=!1)}d=o,p=s,g=a}return x}}(x=+t[0][0],s=+t[0][1],a=+t[1][0],h=+t[1][1]),I()):null==x?null:[[x,s],[a,h]]},P.scale=function(t){return arguments.length?(c=+t,S()):c},P.translate=function(t){return arguments.length?(A=+t[0],f=+t[1],S()):[A,f]},P.center=function(t){return arguments.length?(d=t[0]%360*Wct,p=t[1]%360*Wct,S()):[d*Vct,p*Vct]},P.rotate=function(t){return arguments.length?(g=t[0]%360*Wct,m=t[1]%360*Wct,y=t.length>2?t[2]%360*Wct:0,S()):[g*Vct,m*Vct,y*Vct]},P.precision=function(t){return arguments.length?(C=qAt(T,w=t*t),I()):Jct(w)},P.fitExtent=function(t,e){return GAt(P,t,e)},P.fitSize=function(t,e){return GAt(P,[[0,0],t],e)},function(){return e=t.apply(this,arguments),P.invert=e.invert&&M,S()}}((function(){return t}))()}function XAt(t){return function(e,n){var i=Xct(e),r=Xct(n),o=t(i*r);return[o*r*Yct(e),o*Yct(n)]}}function YAt(t){return function(e,n){var i=Jct(e*e+n*n),r=t(i),o=Yct(r),s=Xct(r);return[Qct(e*o,i*s),$ct(i&&n*o/i)]}}XAt((function(t){return Jct(2/(1+t))})).invert=YAt((function(t){return 2*$ct(t/2)}));var JAt=XAt((function(t){return(t=Kct(t))&&t/Yct(t)}));function KAt(t,e){return[t,e]}function $At(t,e,n,i){var r=t.properties||{},o="Feature"===t.type?t.geometry:t;if("GeometryCollection"===o.type){var s=[];return Xot(t,(function(t){var r=$At(t,e,n,i);r&&s.push(r)})),Fot(s)}var a,h,l=(a=function(t,e){void 0===e&&(e={});var n=Yot(t);return kot([(n[0]+n[2])/2,(n[1]+n[3])/2],e.properties,e)}(o).geometry.coordinates,h=[-a[0],-a[1]],QAt(JAt).scale(79.4188).clipAngle(179.999).rotate(h).scale(Oot)),u={type:o.type,coordinates:eft(o.coordinates,l)},c=(new xht).read(u),A=Not(zot(e,n),"meters"),f=dut.bufferOp(c,A,i);if(!tft((f=(new bht).write(f)).coordinates))return Dot({type:f.type,coordinates:nft(f.coordinates,l)},r)}function tft(t){return Array.isArray(t[0])?tft(t[0]):isNaN(t[0])}function eft(t,e){return"object"!=typeof t[0]?e(t):t.map((function(t){return eft(t,e)}))}function nft(t,e){return"object"!=typeof t[0]?e.invert(t):t.map((function(t){return nft(t,e)}))}JAt.invert=YAt((function(t){return t})),KAt.invert=KAt;const ift=[.8451,.2588,.4863],rft=[],oft=[],sft=[],aft=[.8,.1,.1];class hft extends Iu{constructor(t){super(t),this.on("enable",this.Du,this),this.on("disable",this.Iu,this),this.bu=[]}addTo(t){return t&&(super.addTo(t),this.Mu=t,this.zu()),this}zu(){this.Mu.getLayer(Gt+"drawtool").hide()}Du(){this.on("drawstart",this.du,this).on("drawvertex",this.xu,this).on("mousemove",this.mu,this).on("drawend",this.yu,this)}Iu(){this.off("drawstart",this.du,this).off("drawvertex",this.xu,this).off("mousemove",this.mu,this).off("drawend",this.yu,this)}pu(t){const{coordinate:e,containerPoint:n}=t,i=this.Mu.getLayers((t=>t.queryTerrainAtPoint))[0];if(!i)return e.z=e.z||0,e;const r=i.identify(e,{includeInternals:!1})[0];let o=null;if(r&&r.coordinate?o=new $o(r.coordinate):(e.z=e.z||0,o=e),i.getTerrainLayer()){const t=i.queryTerrainAtPoint(n);return t&&t.z>o.z?t:o}return o}du(t){const e=this.pu(t);e&&(this.Lu=!0,this.bu.push(e),this.Tu(e))}xu(t){const e=this.pu(t);e&&(this.Lu=!0,this.bu[this.bu.length-1]=e,this.Ou())}mu(t){const e=this.pu(t);e&&(this.Lu?this.bu.push(e):this.bu[this.bu.length-1]=e,this.Ou(),this.Lu=!1)}yu(t){const e=this.pu(t);e&&(this.bu.push(e),this.Fu())}Fu(){this.Ou(),this.bu=[],this.et=null,this.xn=null}remove(){this.Uu&&this.Uu.remove(),this.Eu&&this.Eu.remove()}clear(){this.Uu&&this.Uu.clear(),this.Eu&&this.Eu.clear()}}hft.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,once:!0,symbol:{lineColor:"#e8542b",lineWidth:2,polygonFill:"#eee",polygonOpacity:.5},vertexSymbol:{markerType:"ellipse",markerFill:"#e8542b",markerLineColor:"#fff",markerLineWidth:2,markerWidth:10,markerHeight:10,markerDy:0},labelSymbol:{boxStyle:{padding:[15,6],verticalAlignment:"top",horizontalAlignment:"left",minWidth:150,minHeight:30,symbol:{markerType:"square",markerFill:"rgb(60, 60, 60)",markerFillOpacity:.8,markerLineColor:"#fff",markerLineWidth:2,textDx:-110}},textSymbol:{textFill:"#fff",textSize:16,textVerticalAlignment:"top"}}});const lft=[["直线距离","垂直高度","水平距离"],["spatial distance","vertical height","horizontal distance"]];"undefined"!=typeof window&&(window.maptalksgl=window.maptalksgl||{},window.maptalksgl.transcoders=window.maptalksgl.transcoders||cE),e.AEMarker=class extends T${constructor(t,e){super(t,e);const n=gi.extend({},Y$,this.options.symbol);this.setSymbol(n);const i=gi.extend({},J$,this.options.symbol.uniforms);this.setUniforms(i)}},e.Ajax=Xe,e.ArcConnectorLine=yu,e.ArcCurve=au,e.Area3DTool=class extends hft{zu(){super.zu(),this.Uu=new Cu(Gt+"_area3dtool",{enableAltitude:!0}).addTo(this.Mu),this.Eu=new Cu(Gt+"_area3dtool_marker",{enableAltitude:!0}).addTo(this.Mu)}Ou(){const t=this.Bu(this.bu);this.et.setCoordinates(t),this.ku.setCoordinates(t);const e=this.Eu.getGeometries(),n=this.Uu.getGeometries().length;for(let i=0;i<e.length;i++){const t=e[i].getId();t!=="label"+n&&t.indexOf(`${n}_`)>-1&&e[i].remove()}for(let i=0;i<this.bu.length;i++)new Bl(this.bu[i],{id:n+"_"+i,symbol:this.options.vertexSymbol}).addTo(this.Eu);this.Nu()}Bu(t){const e=t.map((t=>t));return t.length>2&&e.push(t[0]),e}Nu(){const t=this.getMeasureResult(),e=("zh-CN"!==this.options.language?"area: ":"面积: ")+this.ju(t),n=this.bu[this.bu.length-1],i=this.Uu.getGeometries().length,r=gi.extend({id:"label"+i},this.options.labelSymbol);this.xn?(this.xn.setContent(e),this.xn.setCoordinates(n)):this.xn=new du(e,n,r).addTo(this.Eu)}ju(t){let e;e="zh-CN"===this.options.language?[" 平方米"," 平方公里"," 平方英尺"," 平方英里"]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];let n="";if(this.options.metric&&(this.Qu=t<1e6?t.toFixed(2):(t/1e6).toFixed(2),this.Su=t<1e6?e[0]:e[1]),this.options.imperial){n.length>0&&(n+="\n");const i=27878400;this.Qu=(t*=3.2808399)<i?t.toFixed(2):(t/i).toFixed(2),this.Su=t<i?e[2]:e[3]}return n+=this.Qu+this.Su,n}Tu(t){this.et||(this.et=new jl([t],{symbol:this.options.symbol}).addTo(this.Uu),this.ku=new Fl([t])),this.Ou(),this.Lu=!0}getMeasureResult(){return this.ku.getArea()}},e.AreaTool=rc,e.B3DMLoader=_K,e.BBOXUtil=Ni,e.BoxInsideClipMask=aE,e.BoxOutsideClipMask=hE,e.Browser=Q,e.CMPTLoader=class t{constructor(t,e,n,i){this.Re=n,this.Dn=t,this.Fn=e||tp,this.Gn=i}load(t,e,n=0,i=0,r){return e?this.zn(t,e,n,i,r):kd.getArrayBuffer(t,{}).then((e=>this.zn(t,e.data,n,i)))}zn(e,n,i,r,o){r||(r=n.byteLength);const s=this.Qn(n,e,i,r),a=[];for(let h=0;h<s.length;h++){let i;if("b3dm"===s[h].magic)i=new _K(this.Dn,this.Fn,this.Re);else if("i3dm"===s[h].magic)i=new xK(this.Dn,this.Fn,this.Re,this.Gn);else if("pnts"===s[h].magic)i=new PK;else{if("cmpt"!==s[h].magic){console.warn("Unsupported magic in CMPT tile:",s[h].magic);continue}i=new t(this.Dn,this.Fn,this.Re,this.Gn)}a.push(i.load(e,n,s[h].offset,s[h].byteLength,o).then((t=>t)))}return Promise.all(a).then((t=>({magic:"cmpt",tiles:t})))}Qn(t,e,n,i){const r=new DataView(t,n,i),o=r.getUint32(4,!0);if(1!==o){const t="Unsupported cmpt version: "+o+", url:"+e;return console.warn(t),{error:t}}if(16===r.byteLength)return[];const s=[],a=r.getUint32(12,!0);let h=16;for(let l=0;l<a;l++){const e=qQ(r,h),i=r.getUint32(h+8,!0);s.push({magic:e,buffer:t,offset:h+n,byteLength:i}),h+=i}return s}},e.COLOR_PROPERTIES=Xt,e.CRS=ts,e.Canvas=Mo,e.CanvasLayer=WA,e.CanvasTileLayer=vA,e.Circle=eu,e.Class=Lo,e.ClipInsideMask=QI,e.ClipOutsideMask=XI,e.CollisionIndex=so,e.ColorMask=$I,e.ConnectorLine=mu,e.ContextUtil=$T,e.Coordinate=$o,e.CrossCutAnalysis=class extends Mrt{constructor(t){super(t),this.type="crosscutAnalysis",this.$=!0}YA(){const t=this.layer.getMap();this.q={};const{extentMap:e,extentInWorld:n}=this.fu(this.options.cutLine);this.q.extent=n,this.q.extentMap=e,this.q.projMatrix=t.projMatrix,this.q.viewMatrix=t.viewMatrix,this.q.minAltitude=0;const i=new jl(this.options.cutLine);this.cu=i.getExtent()}getAltitudes(t){const e=Lot(this.options.cutLine);let n=0;for(let c=0;c<this.options.cutLine.length-1;c++)n+=Wot(this.options.cutLine[c],this.options.cutLine[c+1]);const i=n/t,r=[],o=[];for(let c=0;c<t;c++){const t=qot(e,i*(c+1));o.push(t.geometry.coordinates)}const s=this.layer.getMap(),a=s.getDevicePixelRatio(),{projViewMatrix:h,projMatrix:l,viewMatrix:u}=this.au(o);for(let c=0;c<o.length;c++){const t=this.vu(o[c],o),e=this.lu(t.x*a,t.y*a,h,l,u);if(!e)continue;const n=s.pointAtResToAltitude(e[2],s.getGLRes()),A=s.pointAtResToCoordinate(new ht(e[0],e[1]),s.getGLRes());r.push({coordinate:new $o(A.x,A.y,n),distance:i*c})}return r}fu(t){const e=function(t,e,n){var i=(n=n||{}).units||"kilometers",r=n.steps||8;if(!t)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(r<=0)throw new Error("steps must be greater than 0");var o=[];switch(t.type){case"GeometryCollection":return Xot(t,(function(t){var n=$At(t,e,i,r);n&&o.push(n)})),Fot(o);case"FeatureCollection":return Qot(t,(function(t){var n=$At(t,e,i,r);n&&Qot(n,(function(t){t&&o.push(t)}))})),Fot(o)}return $At(t,e,i,r)}(Lot(t),.001);return this.V(e.geometry.coordinates[0])}S(t){const e=this.i={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(t),this.wu(t);const n=new j_(t.regl);this.B=this.B||new Eot(n,e),this.layer.addAnalysis(this)}wu(t){const e=this.layer.getMap();this.pickingFBO=t.canvas.pickingFBO||t.regl.framebuffer(t.canvas.width,t.canvas.height);const n=new j_(t.regl);this.G=new cw(n,{vert:Ert,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return Hp([],e.projViewMatrix,e.modelMatrix)}}]},this.pickingFBO,e)}au(){if(this.Pu)return this.Pu;const t=this.layer.getMap(),{precenter:e,prezoom:n,prepitch:i,prebearing:r}=this.gu();return Fp(rft,t.projViewMatrix),Fp(oft,t.projMatrix),Fp(sft,t.viewMatrix),t.setZoom(n),t.setCenter(e),t.setPitch(i),t.setBearing(r),this.Pu={projViewMatrix:rft,projMatrix:oft,viewMatrix:sft},this.Pu}gu(){const t=this.cu,e=this.layer.getMap(),n=e.getCenter(),i=e.getZoom(),r=e.getPitch(),o=e.getBearing(),s=e.getFitZoom(t);return e.setZoom(s),e.setCenter(t.getCenter()),e.setPitch(0),{precenter:n,prezoom:i,prepitch:r,prebearing:o}}vu(t){const{precenter:e,prezoom:n,prepitch:i,prebearing:r}=this.gu(),o=this.layer.getMap(),s=o.coordinateToContainerPoint(new $o(t));return o.setZoom(n),o.setCenter(e),o.setPitch(i),o.setBearing(r),s}lu(t,e,n,i,r,o={}){if(this.$){if(!this.Cu||0===this.Cu.length)return null;const t=this.Cu;t.forEach((t=>{const e=t.getDefines();e.HAS_PICKING_ID=2,t.setDefines(e),t.setUniform("uPickingId",1)})),this.G.render(t,{projViewMatrix:n,minAltitude:this.q.minAltitude},!0),this.$=!1}const{point:s}=this.G.pick(t,e,o.tolerance||3,{projViewMatrix:n,minAltitude:this.q.minAltitude},{viewMatrix:r,projMatrix:i,returnPoint:!0});return s}update(t,e){if(super.update(t,e),"cutLine"===t){const{extentMap:t,extentInWorld:n}=this.fu(e);this.q.extent=n,this.q.extentMap=t;const i=new jl(this.options.cutLine);this.cu=i.getExtent(),this.$=!0,delete this.Pu}else this.q[t]=e}renderAnalysis(t){const e={};return this.k.render(this.R,this._),e.cutLineColor=this.options.cutLineColor||ift,e.crosscutMap=this.B.render(t,this.q),this.Cu=t,e}getDefines(){return{HAS_CROSSCUT:1}}},e.CubicBezierCurve=hu,e.Curve=su,e.CutAnalysis=class extends Mrt{constructor(t){super(t),this.type="cut"}update(t,e){if("eyePos"===t||"lookPoint"===t){const n=this.layer.getMap();this.q[t]=Prt(n,...e)}else this.q[t]=e;super.update(t,e)}reset(){this.B&&this.B.SA(this.q.position,this.q.rotation,this.q.scale)}YA(){const t=this.layer.getMap();this.q={},this.q.position=Prt(t,...this.options.position),this.q.rotation=this.options.rotation||[0,0,0],this.q.scale=this.options.scale||[1,1,1],this.q.projViewMatrix=t.projViewMatrix,this.q.minAltitude=0}S(t){const e={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1},n=new j_(t.regl);n.canvas=t.canvas,n.parentRenderer=t,this.YA(),this.B=new Krt(n,e)||this.B;const i=this.layer.getMap();this.B.QA(i,this.q.position,this.q.rotation,this.q.scale),this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(t){const e={};this.q.map=this.layer.getMap();const{meshesMap:n,invisibleMap:i}=this.B.render(t,this.q);return e.meshesMap=n,e.invisibleMap=i,e}getDefines(){return{HAS_CUT:1}}},e.DEFAULT_TEXT_SIZE=Yt,e.Distance3DTool=class extends hft{zu(){super.zu(),this.Uu=new Cu(Gt+"_distance3dtool",{enableAltitude:!0}).addTo(this.Mu),this.Eu=new Cu(Gt+"_distance3dtool_marker",{enableAltitude:!0}).addTo(this.Mu)}Ou(){this.et.setCoordinates(this.bu);const t=this.Eu.getGeometries(),e=this.Uu.getGeometries().length;for(let n=0;n<t.length;n++){const i=t[n].getId();i!=="label"+e&&i.indexOf(`${e}_`)>-1&&t[n].remove()}for(let n=0;n<this.bu.length;n++)new Bl(this.bu[n],{id:e+"_"+n,symbol:this.options.vertexSymbol}).addTo(this.Eu);this.Nu()}Nu(){const t=this.getMeasureResult(),e=("zh-CN"!==this.options.language?"distance: ":"距离: ")+this.ju(t),n=this.bu[this.bu.length-1],i=this.Uu.getGeometries().length,r=gi.extend({id:"label"+i},this.options.labelSymbol);this.xn?(this.xn.setContent(e),this.xn.setCoordinates(n)):this.xn=new du(e,n,r).addTo(this.Eu)}ju(t){let e;e="zh-CN"===this.options.language?[" 米"," 公里"," 英尺"," 英里"]:[" m"," km"," feet"," mile"];let n="";return this.options.metric&&(this.Qu=t<1e3?t.toFixed(1):(t/1e3).toFixed(2),this.Su=t<1e3?e[0]:e[1]),this.options.imperial&&(n.length>0&&(n+="\n"),this.Qu=(t*=3.2808399)<5280?t.toFixed(1):(t/5280).toFixed(2),this.Su=t<5280?e[2]:e[3]),n+=this.Qu+this.Su,n}Tu(t){this.et||(this.et=new jl([t],{symbol:this.options.symbol}).addTo(this.Uu)),this.Ou(),this.Lu=!0}getMeasureResult(){return this.et.getLength()}},e.DistanceTool=ic,e.DomUtil=Qe,e.DragHandler=Ko,e.DrawTool=Iu,e.EffectLayer=U$,e.EffectLine=class extends T${constructor(t,e){super(t,e);const n=gi.extend({},W$,this.options.symbol);this.setSymbol(n);const i=gi.extend({},q$,this.options.symbol.uniforms);this.setUniforms(i),this.setShader("effectline"),this.h="effectmarker"}getEffectType(){return"sequence"}setTexture(t){return this.setUniform("texture",t),this}setHeight(t){return this.setUniform("modelHeight",t),this}setStartOpacity(t){return this.setUniform("startOpacity",t),this}setEndOpacity(t){return this.setUniform("endOpacity",t),this}},e.EffectLineLayer=Z$,e.EffectMarker=T$,e.EffectRing=class extends f${constructor(t,e){super(t,e);const n=gi.extend({},Q$,this.options.symbol.uniforms);this.setUniforms(n),this.setShader("effectring"),this.h="effectring"}},e.EffectRingLayer=X$,e.ElevateMask=eE,e.Ellipse=iu,e.Eventable=Do,e.ExcavateAnalysis=Iot,e.Extent=fs,e.ExtrudePolygonLayer=kq,e.FillPainter=Mj,e.FillPlugin=GV,e.FilterUtil=KF,e.FlatInsideMask=JI,e.FlatOutsideMask=KI,e.FloodAnalysis=yot,e.GEOJSON_TYPES=Wt,e.GEOMETRY_COLLECTION_TYPES=Vt,e.GLContext=lC,e.GLTFGeometry=class extends f${$(t){const e=this.getMap(),n=e.getGLRes(),i=e.distanceToPointAtRes(100,100,n,this.getCenter()),r=e.altitudeToPoint(100,n);return t[0]*=i.x/100,t[1]*=i.y/100,t[2]*=r/100,t}},e.GLTFLayer=R$,e.GLTFLineString=z$,e.GLTFMarker=f$,e.GLTFMercatorGeometry=class extends f${$(t){const e=this.getMap(),n=e.getGLRes(),i=this.getCoordinates(),r=e.coordToPointAtRes(i,n,L$),o=ea.EPSG3857.project(i,D$)._add(1,1),s=ea.EPSG3857.unproject(o,k$),a=e.coordToPointAtRes(s,n,F$),h=a.x-r.x,l=a.y-r.y,u=e.altitudeToPoint(100,n);return t[0]*=h,t[1]*=l,t[2]*=u/100,t}},e.GLTFPhongPlugin=$V,e.GLTFStandardPlugin=tW,e.Geo3DTilesLayer=uK,e.Geo3DTilesUtil=lQ,e.Geo3DTransform=VQ,e.GeoJSON=tu,e.GeoJSONVectorTileLayer=oW,e.Geometry=Kh,e.GeometryCollection=Gl,e.GlobalConfig=r,e.GlobalEvent=No,e.GlowMarker=G$,e.GlowMarkerLayer=V$,e.GroundPainter=WM,e.GroupGLLayer=CI,e.GroupTileLayer=dA,e.Handler=ko,e.Handlerable=Qo,e.HeatmapPlugin=eW,e.HeatmapProcess=qI,e.Height3DTool=class extends hft{zu(){super.zu(),this.Eu=new Cu(Gt+"_height3dtool_marker",{enableAltitude:!0}).addTo(this.Mu).bringToFront(),this.Uu=new Cu(Gt+"_height3dtool",{enableAltitude:!0}).addTo(this.Mu).bringToFront()}xu(t){super.xu(t),this.bu.length>1&&(this.Fu(),this.disable())}Ou(){const t=this.Eu.getGeometries(),e=this.Uu.getGeometries().length;for(let i=0;i<t.length;i++){const n=t[i].getId();n!=="label"+e+"_"+i&&0===n.indexOf(`${e}_`)&&t[i].remove()}for(let i=0;i<this.bu.length;i++)new Bl(this.bu[i],{id:e+"_"+i,symbol:this.options.vertexSymbol}).addTo(this.Eu);const n=this.bu.length;if(n>1){const t=new $o([this.bu[n-1].x,this.bu[n-1].y,this.bu[n-2].z]);new Bl(t,{id:e+"_2",symbol:this.options.vertexSymbol}).addTo(this.Eu);const i=[].concat(this.bu);i.push(t),i.push(this.bu[0]);const r=i.map((t=>t.z));this.et.setCoordinates(i),this.et.setProperties({altitude:r});const o=this.Mu.getProjection().measureLenBetween(i[0],i[2]),s=i[1].z-i[2].z,a=Math.sqrt(Math.pow(o,2)+Math.pow(s,2));this.Nu(i,[a,s,o])}}Nu(t,e){for(let n=0;n<t.length-1;n++){const i=t[n],r=t[n+1],o="zh-CN"===this.options.language?0:1,s=this.ju(e[n]),a=lft[o][n]+":"+s,h="label"+this.Uu.getGeometries().length+"_"+n,l=JSON.parse(JSON.stringify(this.options.labelSymbol));l.id=h,n<2&&(l.boxStyle.symbol.textDx*=-1);const u=1===n?i:new $o((i.x+r.x)/2,(i.y+r.y)/2,(i.z+r.z)/2),c=this.Eu.getGeometryById(h),A=`${h}_marker`,f=this.Eu.getGeometryById(A);c?(c.setContent(a),c.setCoordinates(u),f.setCoordinates(u)):(new du(a,u,l).addTo(this.Eu),new Bl(u,{id:A,symbol:this.options.vertexSymbol}).addTo(this.Eu))}}ju(t){let e;e="zh-CN"===this.options.language?[" 米"," 公里"," 英尺"," 英里"]:[" m"," km"," feet"," mile"];let n="";return this.options.metric&&(this.Qu=t<1e3?t.toFixed(1):(t/1e3).toFixed(2),this.Su=t<1e3?e[0]:e[1]),this.options.imperial&&(n.length>0&&(n+="\n"),this.Qu=(t*=3.2808399)<5280?t.toFixed(1):(t/5280).toFixed(2),this.Su=t<5280?e[2]:e[3]),n+=this.Qu+this.Su,n}Tu(t){this.et||(this.et=new jl([t],{symbol:this.options.symbol}).addTo(this.Uu)),this.Ou(),this.Lu=!0}getMeasureResult(){return this.et.getLength()}},e.HeightLimitAnalysis=class extends yot{constructor(t){super(t),this.type="heightLimitAnalysis"}YA(t){super.YA(t);const e=this.layer.getMap();this.q.waterHeight=wrt(e,this.options.limitHeight),this.q.type=2}update(t,e){if(super.update(t,e),"limitHeight"===t){const t=this.layer.getMap();this.q.waterHeight=t.altitudeToPoint(e||0,t.getGLRes())}}renderAnalysis(t){const e=super.renderAnalysis(t);return e.heightLimitMap=e.floodMap,e.limitColor=this.options.limitColor||aft,e}getDefines(){return{HAS_HEIGHTLIMIT:1}}},e.HighlightUtil=VI,e.INTERNAL_LAYER_PREFIX=Gt,e.IconPainter=sG,e.IconPlugin=qV,e.ImageLayer=zA,e.InSightAnalysis=class extends Mrt{constructor(t){super(t),this.ot=t.lines||[],this.ht=new gI,this.type="insight"}update(t,e){"lines"===t?this.setLines(e):this.q[t]=e,super.update(t,e)}addLine(t){const{from:e,to:n}=t;e&&n&&this.ot.push(t),this.ft()}removeLine(t){const e=this.ot.indexOf(t);e>-1&&this.ot.splice(e,1),this.ft()}getLines(){return this.ot}setLines(t){this.ot=t,this.ft()}clearLines(){this.ot=[],this.ft()}getIntersetction(){const t=[];if(!this.ct)return t;const e=this.layer.getMap();for(let n=0;n<this.ot.length;n++){const{from:i,to:r}=this.ot[n];this.ht.setFromPoint(i),this.ht.setToPoint(r);const o=this.ht.test(this.ct,e);if(o&&o.length){const e={inSightLine:this.ot[n],intersects:[]};o.forEach((t=>{const n=this.vt(t);n&&e.intersects.push(n)})),t.push(e)}}return t}vt(t){const e=[],n=this.layer;if(!n)return e;const{mesh:i,coordinates:r}=t,o=this.getExcludeLayers();return n.getLayers().forEach((t=>{const n=t.getId(),s=t.getRenderer();if(o.indexOf(n)<0&&s&&s.getRayCastData&&r.length){const t=s.getRayCastData(i,r[0].indices[0]);t&&e.push({data:t,coordinates:r})}})),e}ft(){this.YA();const t=this.layer.getRenderer();t&&t.setToRedraw()}YA(){const t=this.layer.getMap();this.q={},this.q.lines=this.ot.map((e=>{const{from:n,to:i}=e;return{from:Prt(t,n.x||n[0],n.y||n[1],n.z||n[2]),to:Prt(t,i.x||i[0],i.y||i[1],i.z||i[2])}})),this.q.visibleColor=this.options.visibleColor,this.q.invisibleColor=this.options.invisibleColor,this.q.projViewMatrix=t.projViewMatrix,this.q.horizontalAngle=45,this.q.verticalAngle=45,this.q.minAltitude=0}S(t){const e={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA();const n=new j_(t.regl);this.B=this.B||new wot(n,e),this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(t){const e={};this.ct=t;const n=this.B.render(t,this.q);return e.insightMap=n,e.insight_visibleColor=this.q.visibleColor||[0,1,0,1],e.insight_invisibleColor=this.q.invisibleColor||[1,0,0,1],e}getDefines(){return{HAS_INSIGHT:1}}},e.JSONAble=Zo,e.LRUCache=zr,e.Label=du,e.Layer=sl,e.LineGradientPlugin=WV,e.LinePainter=Ej,e.LinePlugin=VV,e.LineString=jl,e.LineStringLayer=LW,e.LitPlugin=JV,e.MSDJSONLoader=class{constructor(t){this.i=t||{}}load(){const t=this.i.data;let e=this.i.basePath;if("string"==typeof(n=t)||null!==n.constructor&&n.constructor===String){const n=this.i.fetchFunction||fetch,i=this.i.fetchOptions;if(!e){const n=t.lastIndexOf("/");e=n<0?"./":t.substring(0,n)}return n(t,i).then((t=>t.json())).then((t=>(this.s(t,e),this)))}return this.s(t,e||"./"),Promise.resolve(this);var n}getMSDJSON(){return art(this.h)}getMapJSON(){return art(this.t)}getView(){if(!this.t)return null;const{center:t,zoom:e,pitch:n,bearing:i}=this.t;return{center:t,zoom:e,pitch:n,bearing:i}}getLights(){return this.t&&this.t.options.lights}getSceneConfig(){return this.t&&this.t.layers[0].options.sceneConfig}s(t,e){if("./"!==e&&"."!==e){"/"!==e[e.length-1]&&(e+="/"),this.h=t;let n=JSON.stringify(t);n=n.replace(/".\/res/g,'"'+e+"res"),t=JSON.parse(n)}else this.h=art(t);var n;this.t=t||{},this.u=(n=t.layers[0]).layers?n.layers.map((t=>t?new srt(t):null)):[]}getLayer(t){const e=this.u;if(!e)return null;for(let n=0;n<e.length;n++){const i=e[n];if(i&&t===i.getId())return i}return null}getLayers(){return this.u||[]}},e.Map=Al,e.MapTool=Mu,e.MapboxUtil=Gn,e.MapboxVectorTileLayer=iW,e.Marker=Bl,e.MaskLayerMixin=qS,e.MaskRendererMixin=dS,e.MicroTask=kr,e.MultiGLTFMarker=x$,e.MultiLineString=Ql,e.MultiPoint=ql,e.MultiPolygon=Xl,e.NUMERICAL_PROPERTIES=Qt,e.NativeLinePainter=$G,e.NativeLinePlugin=QV,e.NativePointPainter=YG,e.OverlayLayer=xu,e.PackUtil=Wz,e.ParticleLayer=ZA,e.PhongPainter=AV,e.PhongPlugin=XV,e.Point=ht,e.PointExtent=ps,e.PointLayer=kW,e.Polygon=Fl,e.PolygonLayer=NW,e.QuadBezierCurve=lu,e.RESOURCE_PROPERTIES=qt,e.RESOURCE_SIZE_PROPERTIES=Zt,e.RayCaster=gI,e.Rectangle=ru,e.ResourceProxy=$e,e.SYMBOLS_NEED_REBUILD_IN_VECTOR=Kz,e.SYMBOLS_NEED_REBUILD_IN_VT=Jz,e.Sector=ou,e.Size=Jt,e.SkylineAnalysis=class extends Mrt{constructor(t){super(t),this.type="skyline"}YA(){const t=this.layer.getMap();this.q={},this.q.lineColor=this.options.lineColor,this.q.lineWidth=this.options.lineWidth,this.q.projViewMatrix=t.projViewMatrix,this.q.minAltitude=0}S(t){const e={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(),this.renderer=new j_(t.regl),this.B=new fot(this.renderer,e)||this.B,this.layer.addAnalysis(this),this.At=this.tt(t.regl)}renderAnalysis(t){this.At=this.At||this.tt(this.renderer.regl);const e=this.layer.getMap();this.nt(e);const n={},i=t.concat([this.At]);return this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.T=this.B.render(i,this.q),n.skylineMap=this.T,n}exportSkylineMap(t){if(!dot||!this.isEnable())return null;t||(t={});const e=this.B.getRenderMeshes(),n=this.exportAnalysisMap(e),i=this.T.width,r=this.T.height,o=new Uint8ClampedArray(n.length);for(let h=0;h<i;h++)for(let t=0;t<r;t++)o[4*(t*i+h)]=n[4*((r-t)*i+h)],o[4*(t*i+h)+1]=n[4*((r-t)*i+h)+1],o[4*(t*i+h)+2]=n[4*((r-t)*i+h)+2],o[4*(t*i+h)+3]=n[4*((r-t)*i+h)+3],0===o[4*(t*i+h)]&&0===o[4*(t*i+h)+1]&&0===o[4*(t*i+h)+2]&&(o[4*(t*i+h)+3]=0);dot.width=i,dot.height=r;const s=new ImageData(o,i,r);dot.getContext("2d").putImageData(s,0,0);const a=dot.toDataURL();if(t.save){const e=document.createElement("a");e.download=t.filename||"export",e.href=a,document.body.appendChild(e),e.click(),document.body.removeChild(e)}return a}update(t,e){this.q[t]=e,super.update(t,e)}tt(t){const e=new ax;return e.generateBuffers(t),e.data.aTexCoord=new Float32Array(8),new z_(e)}nt(t){const e=WM.getGroundTransform(this.At.localTransform,t);this.At.setLocalTransform(e)}remove(){super.remove(),this.At&&(this.At.geometry.dispose(),this.At.dispose(),delete this.At)}getDefines(){return{HAS_SKYLINE:1}}},e.SpatialReference=Qh,e.StringUtil=me,e.TextBox=fu,e.TextMarker=Au,e.TextPainter=WG,e.TextPlugin=ZV,e.TileConfig=Hc,e.TileLayer=lA,e.TileSystem=zc,e.TransformControl=ort,e.Transformation=gs,e.TubePlugin=KV,e.Util=gi,e.Vector3DLayer=wH,e.VectorLayer=Cu,e.VectorTileLayer=gH,e.VectorTileLayerRenderer=oH,e.VideoLayer=yrt,e.VideoMask=tE,e.VideoSurface=mrt,e.ViewshedAnalysis=class extends Mrt{constructor(t){super(t),this.type="viewshed"}update(t,e){if("eyePos"===t||"lookPoint"===t){const n=this.layer.getMap();this.q[t]=Prt(n,...e)}else this.q[t]=e;super.update(t,e)}YA(){const t=this.layer.getMap();this.q={},this.q.eyePos=Prt(t,...this.options.eyePos),this.q.lookPoint=Prt(t,...this.options.lookPoint),this.q.verticalAngle=this.options.verticalAngle,this.q.horizontalAngle=this.options.horizontalAngle,this.q.visibleColor=this.options.visibleColor,this.q.invisibleColor=this.options.invisibleColor,this.q.projViewMatrix=t.projViewMatrix,this.q.minAltitude=0}S(t){const e={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA();const n=new j_(t.regl);this.B=new Aot(n,e)||this.B,this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(t){const e={},n=this.B.render(t,this.q);return e.viewshedMap=n,e.viewshed_visibleColor=this.q.visibleColor||[0,1,0,.3],e.viewshed_invisibleColor=this.q.invisibleColor||[1,0,0,.3],e}getVertexCoordinates(){const t=this.layer.getMap();return t?this.B.HA(t):[]}getDefines(){return{HAS_VIEWSHED:1}}},e.WMSTileLayer=yA,e.WaterPlugin=nW,e.WireframePainter=dV,e.WireframePlugin=YV,e.animate=Il,e.animation=El,e.color=lM,e.control=Nc,e.createREGL=id,e.earcut=Zw,e.formatResourceUrl=tn,e.getDefaultSpatialReference=function(){return JSON.parse(JSON.stringify(Zh))},e.glMatrix=gp,e.gltf=vP,e.mat2=xp,e.mat2d=Cp,e.mat3=kp,e.mat4=ug,e.math=rr,e.measurer=Ss,e.parseSVG=rn,e.projection=ea,e.quat=ty,e.quat2=sy,e.registerWorkerAdapter=cr,e.renderer=Uf,e.reshader=Yw,e.symbolizer=Ch,e.transcoders=cE,e.ui=Cc,e.vec2=Oy,e.vec3=jg,e.vec4=gm,e.worker=$f}(e.exports);var n=e.exports;export{n as m};
